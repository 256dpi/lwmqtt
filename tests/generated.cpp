#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\GS'O\GS\157L:\160!\232\238\251\210\SOH\149\247[\200\206V\228NIF", _pubPktID = 10712, _pubBody =
// "g\175\150\CANu\230<(Z\145\145 g\177\217P7\ENQ`V\167\212k\177\SUB.", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x33, 0x36, 0x0,  0x18, 0x1d, 0x27, 0x4f, 0x1d, 0x9d, 0x4c, 0x3a, 0xa0, 0x21, 0xe8,
                   0xee, 0xfb, 0xd2, 0x1,  0x95, 0xf7, 0x5b, 0xc8, 0xce, 0x56, 0xe4, 0x4e, 0x49, 0x46,
                   0x29, 0xd8, 0x67, 0xaf, 0x96, 0x18, 0x75, 0xe6, 0x3c, 0x28, 0x5a, 0x91, 0x91, 0x20,
                   0x67, 0xb1, 0xd9, 0x50, 0x37, 0x5,  0x60, 0x56, 0xa7, 0xd4, 0x6b, 0xb1, 0x1a, 0x2e};

  uint8_t buf[66] = {0};

  uint8_t topic_bytes[] = {0x1d, 0x27, 0x4f, 0x1d, 0x9d, 0x4c, 0x3a, 0xa0, 0x21, 0xe8, 0xee, 0xfb,
                           0xd2, 0x1,  0x95, 0xf7, 0x5b, 0xc8, 0xce, 0x56, 0xe4, 0x4e, 0x49, 0x46};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x67, 0xaf, 0x96, 0x18, 0x75, 0xe6, 0x3c, 0x28, 0x5a, 0x91, 0x91, 0x20, 0x67,
                         0xb1, 0xd9, 0x50, 0x37, 0x5,  0x60, 0x56, 0xa7, 0xd4, 0x6b, 0xb1, 0x1a, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10712, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "q\140\EOT\210\163\254Vg\160L\221g\182\231\149f3\239k\200\DC2", _pubPktID = 10731, _pubBody =
// "\229\183\252?\173\165\FS\181?\130", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0x23, 0x0,  0x15, 0x71, 0x8c, 0x4,  0xd2, 0xa3, 0xfe, 0x56, 0x67, 0xa0,
                   0x4c, 0xdd, 0x67, 0xb6, 0xe7, 0x95, 0x66, 0x33, 0xef, 0x6b, 0xc8, 0x12, 0x29,
                   0xeb, 0xe5, 0xb7, 0xfc, 0x3f, 0xad, 0xa5, 0x1c, 0xb5, 0x3f, 0x82};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0x71, 0x8c, 0x4,  0xd2, 0xa3, 0xfe, 0x56, 0x67, 0xa0, 0x4c, 0xdd,
                           0x67, 0xb6, 0xe7, 0x95, 0x66, 0x33, 0xef, 0x6b, 0xc8, 0x12};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe5, 0xb7, 0xfc, 0x3f, 0xad, 0xa5, 0x1c, 0xb5, 0x3f, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10731, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "I0\v\142\237", _pubPktID = 7560,
// _pubBody = "`\189\255\237\166\235-D\NAK", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0x12, 0x0,  0x5,  0x49, 0x30, 0xb,  0x8e, 0xed, 0x1d,
                   0x88, 0x60, 0xbd, 0xff, 0xed, 0xa6, 0xeb, 0x2d, 0x44, 0x15};

  uint8_t buf[30] = {0};

  uint8_t topic_bytes[] = {0x49, 0x30, 0xb, 0x8e, 0xed};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xbd, 0xff, 0xed, 0xa6, 0xeb, 0x2d, 0x44, 0x15};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7560, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\214d)\246\152\n-f", _pubPktID =
// 27404, _pubBody = "\187\167\151\192YY\244\252\216W\216\180S\218A\187\255\140'\172dG\187", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3b, 0x23, 0x0,  0x8,  0xd6, 0x64, 0x29, 0xf6, 0x98, 0xa,  0x2d, 0x66, 0x6b,
                   0xc,  0xbb, 0xa7, 0x97, 0xc0, 0x59, 0x59, 0xf4, 0xfc, 0xd8, 0x57, 0xd8, 0xb4,
                   0x53, 0xda, 0x41, 0xbb, 0xff, 0x8c, 0x27, 0xac, 0x64, 0x47, 0xbb};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0xd6, 0x64, 0x29, 0xf6, 0x98, 0xa, 0x2d, 0x66};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xa7, 0x97, 0xc0, 0x59, 0x59, 0xf4, 0xfc, 0xd8, 0x57, 0xd8, 0xb4,
                         0x53, 0xda, 0x41, 0xbb, 0xff, 0x8c, 0x27, 0xac, 0x64, 0x47, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 27404, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\243i\174@\215\136\140u\b,",
// _pubPktID = 0, _pubBody = "_\166K\178hd\ETX^Q", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x38, 0x15, 0x0,  0xa,  0xf3, 0x69, 0xae, 0x40, 0xd7, 0x88, 0x8c, 0x75,
                   0x8,  0x2c, 0x5f, 0xa6, 0x4b, 0xb2, 0x68, 0x64, 0x3,  0x5e, 0x51};

  uint8_t buf[33] = {0};

  uint8_t topic_bytes[] = {0xf3, 0x69, 0xae, 0x40, 0xd7, 0x88, 0x8c, 0x75, 0x8, 0x2c};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5f, 0xa6, 0x4b, 0xb2, 0x68, 0x64, 0x3, 0x5e, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\n-yh\SO\210\US\ESC\254\242a",
// _pubPktID = 15060, _pubBody = "\DEL\SOH0>\190\215\246)N\183\&0R\194\153\164\140'6\243X", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x3b, 0x23, 0x0,  0xb,  0xa,  0x2d, 0x79, 0x68, 0xe,  0xd2, 0x1f, 0x1b, 0xfe,
                   0xf2, 0x61, 0x3a, 0xd4, 0x7f, 0x1,  0x30, 0x3e, 0xbe, 0xd7, 0xf6, 0x29, 0x4e,
                   0xb7, 0x30, 0x52, 0xc2, 0x99, 0xa4, 0x8c, 0x27, 0x36, 0xf3, 0x58};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0xa, 0x2d, 0x79, 0x68, 0xe, 0xd2, 0x1f, 0x1b, 0xfe, 0xf2, 0x61};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7f, 0x1,  0x30, 0x3e, 0xbe, 0xd7, 0xf6, 0x29, 0x4e, 0xb7,
                         0x30, 0x52, 0xc2, 0x99, 0xa4, 0x8c, 0x27, 0x36, 0xf3, 0x58};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15060, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "5\132\234\246Z", _pubPktID = 0,
// _pubBody = "+", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x31, 0x8, 0x0, 0x5, 0x35, 0x84, 0xea, 0xf6, 0x5a, 0x2b};

  uint8_t buf[20] = {0};

  uint8_t topic_bytes[] = {0x35, 0x84, 0xea, 0xf6, 0x5a};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\212\222", _pubPktID = 0, _pubBody
// = "f", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x5, 0x0, 0x2, 0xd4, 0xde, 0x66};

  uint8_t buf[17] = {0};

  uint8_t topic_bytes[] = {0xd4, 0xde};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "u\ESC\171:\189\192\SUB\242!\162\203\208Z\212\177\&5\248\255\138k\213\183+\SUB\132\GS#M\192", _pubPktID = 13057,
// _pubBody = "\168\129\191\243\158\250'%~\DEL0\ESC\210%qk\220\ENQ\241\199", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3a, 0x35, 0x0,  0x1d, 0x75, 0x1b, 0xab, 0x3a, 0xbd, 0xc0, 0x1a, 0xf2, 0x21, 0xa2,
                   0xcb, 0xd0, 0x5a, 0xd4, 0xb1, 0x35, 0xf8, 0xff, 0x8a, 0x6b, 0xd5, 0xb7, 0x2b, 0x1a,
                   0x84, 0x1d, 0x23, 0x4d, 0xc0, 0x33, 0x1,  0xa8, 0x81, 0xbf, 0xf3, 0x9e, 0xfa, 0x27,
                   0x25, 0x7e, 0x7f, 0x30, 0x1b, 0xd2, 0x25, 0x71, 0x6b, 0xdc, 0x5,  0xf1, 0xc7};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0x75, 0x1b, 0xab, 0x3a, 0xbd, 0xc0, 0x1a, 0xf2, 0x21, 0xa2, 0xcb, 0xd0, 0x5a, 0xd4, 0xb1,
                           0x35, 0xf8, 0xff, 0x8a, 0x6b, 0xd5, 0xb7, 0x2b, 0x1a, 0x84, 0x1d, 0x23, 0x4d, 0xc0};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa8, 0x81, 0xbf, 0xf3, 0x9e, 0xfa, 0x27, 0x25, 0x7e, 0x7f,
                         0x30, 0x1b, 0xd2, 0x25, 0x71, 0x6b, 0xdc, 0x5,  0xf1, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 13057, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\186l\242\SOH;D}W:\172\197",
// _pubPktID = 15309, _pubBody = "-\137a\203_YG\210\138\172yL\224>", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3d, 0x1e, 0x0,  0xc,  0xfd, 0xba, 0x6c, 0xf2, 0x1,  0x3b, 0x44, 0x7d, 0x57, 0x3a, 0xac, 0xc5,
                   0x3b, 0xcd, 0x2d, 0x89, 0x61, 0xcb, 0x5f, 0x59, 0x47, 0xd2, 0x8a, 0xac, 0x79, 0x4c, 0xe0, 0x3e};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0xfd, 0xba, 0x6c, 0xf2, 0x1, 0x3b, 0x44, 0x7d, 0x57, 0x3a, 0xac, 0xc5};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2d, 0x89, 0x61, 0xcb, 0x5f, 0x59, 0x47, 0xd2, 0x8a, 0xac, 0x79, 0x4c, 0xe0, 0x3e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15309, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\DC3\NAK:\DEL\206\213^_\254\174f\203\221\160U", _pubPktID = 0, _pubBody = "\211\130}", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x30, 0x15, 0x0,  0x10, 0x4d, 0x13, 0x15, 0x3a, 0x7f, 0xce, 0xd5, 0x5e,
                   0x5f, 0xfe, 0xae, 0x66, 0xcb, 0xdd, 0xa0, 0x55, 0xd3, 0x82, 0x7d};

  uint8_t buf[33] = {0};

  uint8_t topic_bytes[] = {0x4d, 0x13, 0x15, 0x3a, 0x7f, 0xce, 0xd5, 0x5e,
                           0x5f, 0xfe, 0xae, 0x66, 0xcb, 0xdd, 0xa0, 0x55};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd3, 0x82, 0x7d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\169|\146E2\GS{\237\&3\166",
// _pubPktID = 0, _pubBody = "#\227\217]\US\238S\163\139\232\165\210\243-", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x31, 0x1a, 0x0,  0xa,  0xa9, 0x7c, 0x92, 0x45, 0x32, 0x1d, 0x7b, 0xed, 0x33, 0xa6,
                   0x23, 0xe3, 0xd9, 0x5d, 0x1f, 0xee, 0x53, 0xa3, 0x8b, 0xe8, 0xa5, 0xd2, 0xf3, 0x2d};

  uint8_t buf[38] = {0};

  uint8_t topic_bytes[] = {0xa9, 0x7c, 0x92, 0x45, 0x32, 0x1d, 0x7b, 0xed, 0x33, 0xa6};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x23, 0xe3, 0xd9, 0x5d, 0x1f, 0xee, 0x53, 0xa3, 0x8b, 0xe8, 0xa5, 0xd2, 0xf3, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\187\253\202u\190\\@\215", _pubPktID
// = 27515, _pubBody = "\146q\173U}?\142kjA\ETX\187\155\EOT#K\207\&8x\224\244\133\241\t\146I\241", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x3c, 0x27, 0x0,  0x8,  0xbb, 0xfd, 0xca, 0x75, 0xbe, 0x5c, 0x40, 0xd7, 0x6b, 0x7b,
                   0x92, 0x71, 0xad, 0x55, 0x7d, 0x3f, 0x8e, 0x6b, 0x6a, 0x41, 0x3,  0xbb, 0x9b, 0x4,
                   0x23, 0x4b, 0xcf, 0x38, 0x78, 0xe0, 0xf4, 0x85, 0xf1, 0x9,  0x92, 0x49, 0xf1};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0xbb, 0xfd, 0xca, 0x75, 0xbe, 0x5c, 0x40, 0xd7};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0x71, 0xad, 0x55, 0x7d, 0x3f, 0x8e, 0x6b, 0x6a, 0x41, 0x3,  0xbb, 0x9b, 0x4,
                         0x23, 0x4b, 0xcf, 0x38, 0x78, 0xe0, 0xf4, 0x85, 0xf1, 0x9,  0x92, 0x49, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 27515, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\163\147\204\140\129\152\150A\187\249", _pubPktID = 15054, _pubBody = "C\207+gu\184\240\&5~z\148f", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x3d, 0x1a, 0x0,  0xa,  0xa3, 0x93, 0xcc, 0x8c, 0x81, 0x98, 0x96, 0x41, 0xbb, 0xf9,
                   0x3a, 0xce, 0x43, 0xcf, 0x2b, 0x67, 0x75, 0xb8, 0xf0, 0x35, 0x7e, 0x7a, 0x94, 0x66};

  uint8_t buf[38] = {0};

  uint8_t topic_bytes[] = {0xa3, 0x93, 0xcc, 0x8c, 0x81, 0x98, 0x96, 0x41, 0xbb, 0xf9};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x43, 0xcf, 0x2b, 0x67, 0x75, 0xb8, 0xf0, 0x35, 0x7e, 0x7a, 0x94, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15054, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// ",\210m\249\173\143u\208k\181Kou]5\211\141\204M\133+$\153", _pubPktID = 0, _pubBody = "\154\157s\228", _pubProps =
// []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x38, 0x1d, 0x0,  0x17, 0x2c, 0xd2, 0x6d, 0xf9, 0xad, 0x8f, 0x75, 0xd0, 0x6b, 0xb5, 0x4b, 0x6f,
                   0x75, 0x5d, 0x35, 0xd3, 0x8d, 0xcc, 0x4d, 0x85, 0x2b, 0x24, 0x99, 0x9a, 0x9d, 0x73, 0xe4};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0x2c, 0xd2, 0x6d, 0xf9, 0xad, 0x8f, 0x75, 0xd0, 0x6b, 0xb5, 0x4b, 0x6f,
                           0x75, 0x5d, 0x35, 0xd3, 0x8d, 0xcc, 0x4d, 0x85, 0x2b, 0x24, 0x99};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0x9d, 0x73, 0xe4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\NUL\DEL\203\RS\240:\141&\173E\160ge\161\253\204@\CANsE\DC4\250-\170\139\170\173", _pubPktID = 16148, _pubBody =
// "\217\SOH\255\&9\132\DC1ce\133\DLE\176\244\r\ti\207a\239X\210\160\160\224v\216\t", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x3a, 0x39, 0x0,  0x1b, 0x0,  0x7f, 0xcb, 0x1e, 0xf0, 0x3a, 0x8d, 0x26, 0xad, 0x45, 0xa0,
                   0x67, 0x65, 0xa1, 0xfd, 0xcc, 0x40, 0x18, 0x73, 0x45, 0x14, 0xfa, 0x2d, 0xaa, 0x8b, 0xaa,
                   0xad, 0x3f, 0x14, 0xd9, 0x1,  0xff, 0x39, 0x84, 0x11, 0x63, 0x65, 0x85, 0x10, 0xb0, 0xf4,
                   0xd,  0x9,  0x69, 0xcf, 0x61, 0xef, 0x58, 0xd2, 0xa0, 0xa0, 0xe0, 0x76, 0xd8, 0x9};

  uint8_t buf[69] = {0};

  uint8_t topic_bytes[] = {0x0,  0x7f, 0xcb, 0x1e, 0xf0, 0x3a, 0x8d, 0x26, 0xad, 0x45, 0xa0, 0x67, 0x65, 0xa1,
                           0xfd, 0xcc, 0x40, 0x18, 0x73, 0x45, 0x14, 0xfa, 0x2d, 0xaa, 0x8b, 0xaa, 0xad};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd9, 0x1,  0xff, 0x39, 0x84, 0x11, 0x63, 0x65, 0x85, 0x10, 0xb0, 0xf4, 0xd,
                         0x9,  0x69, 0xcf, 0x61, 0xef, 0x58, 0xd2, 0xa0, 0xa0, 0xe0, 0x76, 0xd8, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16148, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\225\180\242F\ENQ\203\138\241\216i%\241\223n\157\150\bT\255", _pubPktID = 0, _pubBody = "'", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x30, 0x16, 0x0,  0x13, 0xe1, 0xb4, 0xf2, 0x46, 0x5, 0xcb, 0x8a, 0xf1,
                   0xd8, 0x69, 0x25, 0xf1, 0xdf, 0x6e, 0x9d, 0x96, 0x8, 0x54, 0xff, 0x27};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0xe1, 0xb4, 0xf2, 0x46, 0x5,  0xcb, 0x8a, 0xf1, 0xd8, 0x69,
                           0x25, 0xf1, 0xdf, 0x6e, 0x9d, 0x96, 0x8,  0x54, 0xff};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\206\166\&9}z\170\226\207\169\157\f{\160_\198\DEL\151\NAK'|\145", _pubPktID = 0, _pubBody = "\178\190\186$\148^\SO
// Y\222\245\255\204\180\166\231cl\175A\164x\152\234W\209\251\249\n`", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x31, 0x35, 0x0,  0x15, 0xce, 0xa6, 0x39, 0x7d, 0x7a, 0xaa, 0xe2, 0xcf, 0xa9, 0x9d,
                   0xc,  0x7b, 0xa0, 0x5f, 0xc6, 0x7f, 0x97, 0x15, 0x27, 0x7c, 0x91, 0xb2, 0xbe, 0xba,
                   0x24, 0x94, 0x5e, 0xe,  0x20, 0x59, 0xde, 0xf5, 0xff, 0xcc, 0xb4, 0xa6, 0xe7, 0x63,
                   0x6c, 0xaf, 0x41, 0xa4, 0x78, 0x98, 0xea, 0x57, 0xd1, 0xfb, 0xf9, 0xa,  0x60};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0xce, 0xa6, 0x39, 0x7d, 0x7a, 0xaa, 0xe2, 0xcf, 0xa9, 0x9d, 0xc,
                           0x7b, 0xa0, 0x5f, 0xc6, 0x7f, 0x97, 0x15, 0x27, 0x7c, 0x91};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2, 0xbe, 0xba, 0x24, 0x94, 0x5e, 0xe,  0x20, 0x59, 0xde, 0xf5, 0xff, 0xcc, 0xb4, 0xa6,
                         0xe7, 0x63, 0x6c, 0xaf, 0x41, 0xa4, 0x78, 0x98, 0xea, 0x57, 0xd1, 0xfb, 0xf9, 0xa,  0x60};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\225\242\168", _pubPktID = 30037,
// _pubBody = "\216-7\221q<\RS\"U\210-\130\232\161\248)\248\169\151", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x3a, 0x1a, 0x0,  0x3,  0xe1, 0xf2, 0xa8, 0x75, 0x55, 0xd8, 0x2d, 0x37, 0xdd, 0x71,
                   0x3c, 0x1e, 0x22, 0x55, 0xd2, 0x2d, 0x82, 0xe8, 0xa1, 0xf8, 0x29, 0xf8, 0xa9, 0x97};

  uint8_t buf[38] = {0};

  uint8_t topic_bytes[] = {0xe1, 0xf2, 0xa8};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd8, 0x2d, 0x37, 0xdd, 0x71, 0x3c, 0x1e, 0x22, 0x55, 0xd2,
                         0x2d, 0x82, 0xe8, 0xa1, 0xf8, 0x29, 0xf8, 0xa9, 0x97};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 30037, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\209\144\244\190\138\251", _pubPktID
// = 1548, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x3c, 0xa, 0x0, 0x6, 0xd1, 0x90, 0xf4, 0xbe, 0x8a, 0xfb, 0x6, 0xc};

  uint8_t buf[22] = {0};

  uint8_t topic_bytes[] = {0xd1, 0x90, 0xf4, 0xbe, 0x8a, 0xfb};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1548, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\136\140\179}\STX;", _pubPktID =
// 6476, _pubBody = "Jj\SO\241\ENQ\137\DC1", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x35, 0x12, 0x0,  0x7,  0xfd, 0x88, 0x8c, 0xb3, 0x7d, 0x2,
                   0x3b, 0x19, 0x4c, 0x4a, 0x6a, 0xe,  0xf1, 0x5,  0x89, 0x11};

  uint8_t buf[30] = {0};

  uint8_t topic_bytes[] = {0xfd, 0x88, 0x8c, 0xb3, 0x7d, 0x2, 0x3b};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x6a, 0xe, 0xf1, 0x5, 0x89, 0x11};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 6476, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\242\232\197\SOHHe\ETX>/
// \232\220\247\251\tq\198\197nl\247\249", _pubPktID = 2029, _pubBody = "v_\GSO8\202C0\RS\247#\141\209\DEL", _pubProps =
// []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x3a, 0x28, 0x0,  0x16, 0xf2, 0xe8, 0xc5, 0x1,  0x48, 0x65, 0x3,  0x3e, 0x2f, 0x20,
                   0xe8, 0xdc, 0xf7, 0xfb, 0x9,  0x71, 0xc6, 0xc5, 0x6e, 0x6c, 0xf7, 0xf9, 0x7,  0xed,
                   0x76, 0x5f, 0x1d, 0x4f, 0x38, 0xca, 0x43, 0x30, 0x1e, 0xf7, 0x23, 0x8d, 0xd1, 0x7f};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0xf2, 0xe8, 0xc5, 0x1, 0x48, 0x65, 0x3,  0x3e, 0x2f, 0x20, 0xe8,
                           0xdc, 0xf7, 0xfb, 0x9, 0x71, 0xc6, 0xc5, 0x6e, 0x6c, 0xf7, 0xf9};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x76, 0x5f, 0x1d, 0x4f, 0x38, 0xca, 0x43, 0x30, 0x1e, 0xf7, 0x23, 0x8d, 0xd1, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 2029, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Y\NUL&\156\t\157<\215\152R\173\212.\245\207\197\188\163\208\&2", _pubPktID = 5733, _pubBody =
// "\SOHe\184~\148\245\199\143\205\235\200U", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x3d, 0x24, 0x0,  0x14, 0x59, 0x0,  0x26, 0x9c, 0x9,  0x9d, 0x3c, 0xd7, 0x98,
                   0x52, 0xad, 0xd4, 0x2e, 0xf5, 0xcf, 0xc5, 0xbc, 0xa3, 0xd0, 0x32, 0x16, 0x65,
                   0x1,  0x65, 0xb8, 0x7e, 0x94, 0xf5, 0xc7, 0x8f, 0xcd, 0xeb, 0xc8, 0x55};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0x59, 0x0,  0x26, 0x9c, 0x9,  0x9d, 0x3c, 0xd7, 0x98, 0x52,
                           0xad, 0xd4, 0x2e, 0xf5, 0xcf, 0xc5, 0xbc, 0xa3, 0xd0, 0x32};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x65, 0xb8, 0x7e, 0x94, 0xf5, 0xc7, 0x8f, 0xcd, 0xeb, 0xc8, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5733, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\224\201\GS?\232\255!\161\220\244B\129\&6\US\205R_8\191\154\217\186?\231\245\224\170", _pubPktID = 14690, _pubBody =
// "\196\183%\243\214\152\&5U;\186\194\206\128[\236B~\144\236\247\187\144Ze\ETX\176", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x35, 0x39, 0x0,  0x1b, 0xe0, 0xc9, 0x1d, 0x3f, 0xe8, 0xff, 0x21, 0xa1, 0xdc, 0xf4, 0x42,
                   0x81, 0x36, 0x1f, 0xcd, 0x52, 0x5f, 0x38, 0xbf, 0x9a, 0xd9, 0xba, 0x3f, 0xe7, 0xf5, 0xe0,
                   0xaa, 0x39, 0x62, 0xc4, 0xb7, 0x25, 0xf3, 0xd6, 0x98, 0x35, 0x55, 0x3b, 0xba, 0xc2, 0xce,
                   0x80, 0x5b, 0xec, 0x42, 0x7e, 0x90, 0xec, 0xf7, 0xbb, 0x90, 0x5a, 0x65, 0x3,  0xb0};

  uint8_t buf[69] = {0};

  uint8_t topic_bytes[] = {0xe0, 0xc9, 0x1d, 0x3f, 0xe8, 0xff, 0x21, 0xa1, 0xdc, 0xf4, 0x42, 0x81, 0x36, 0x1f,
                           0xcd, 0x52, 0x5f, 0x38, 0xbf, 0x9a, 0xd9, 0xba, 0x3f, 0xe7, 0xf5, 0xe0, 0xaa};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc4, 0xb7, 0x25, 0xf3, 0xd6, 0x98, 0x35, 0x55, 0x3b, 0xba, 0xc2, 0xce, 0x80,
                         0x5b, 0xec, 0x42, 0x7e, 0x90, 0xec, 0xf7, 0xbb, 0x90, 0x5a, 0x65, 0x3,  0xb0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 14690, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\128\EOT^\158\STX\"\210\232\166U\219\154N\225\218\228\153Z\152\250\224\246\211;E\155", _pubPktID = 16370, _pubBody =
// "V", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x3b, 0x1f, 0x0,  0x1a, 0x80, 0x4,  0x5e, 0x9e, 0x2,  0x22, 0xd2, 0xe8, 0xa6, 0x55, 0xdb, 0x9a, 0x4e,
                   0xe1, 0xda, 0xe4, 0x99, 0x5a, 0x98, 0xfa, 0xe0, 0xf6, 0xd3, 0x3b, 0x45, 0x9b, 0x3f, 0xf2, 0x56};

  uint8_t buf[43] = {0};

  uint8_t topic_bytes[] = {0x80, 0x4,  0x5e, 0x9e, 0x2,  0x22, 0xd2, 0xe8, 0xa6, 0x55, 0xdb, 0x9a, 0x4e,
                           0xe1, 0xda, 0xe4, 0x99, 0x5a, 0x98, 0xfa, 0xe0, 0xf6, 0xd3, 0x3b, 0x45, 0x9b};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x56};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "c\215A4\142\182\&2\162\191V\143t$A0\142", _pubPktID = 0, _pubBody = "\221\195:\163\203\239\168%\160", _pubProps =
// []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0x1b, 0x0,  0x10, 0x63, 0xd7, 0x41, 0x34, 0x8e, 0xb6, 0x32, 0xa2, 0xbf, 0x56, 0x8f,
                   0x74, 0x24, 0x41, 0x30, 0x8e, 0xdd, 0xc3, 0x3a, 0xa3, 0xcb, 0xef, 0xa8, 0x25, 0xa0};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0x63, 0xd7, 0x41, 0x34, 0x8e, 0xb6, 0x32, 0xa2,
                           0xbf, 0x56, 0x8f, 0x74, 0x24, 0x41, 0x30, 0x8e};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0xc3, 0x3a, 0xa3, 0xcb, 0xef, 0xa8, 0x25, 0xa0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\161\166\175\235\223\210\143\180\219\210\209\129\230\195\173\&1\t\ENQy\206\250\146\214\205\161\212{?\157", _pubPktID
// = 0, _pubBody = "\206W9\140\ESC6\211\206\212d\US\141\189`a9\182\130,\ETX", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x30, 0x33, 0x0,  0x1d, 0xa1, 0xa6, 0xaf, 0xeb, 0xdf, 0xd2, 0x8f, 0xb4, 0xdb, 0xd2,
                   0xd1, 0x81, 0xe6, 0xc3, 0xad, 0x31, 0x9,  0x5,  0x79, 0xce, 0xfa, 0x92, 0xd6, 0xcd,
                   0xa1, 0xd4, 0x7b, 0x3f, 0x9d, 0xce, 0x57, 0x39, 0x8c, 0x1b, 0x36, 0xd3, 0xce, 0xd4,
                   0x64, 0x1f, 0x8d, 0xbd, 0x60, 0x61, 0x39, 0xb6, 0x82, 0x2c, 0x3};

  uint8_t buf[63] = {0};

  uint8_t topic_bytes[] = {0xa1, 0xa6, 0xaf, 0xeb, 0xdf, 0xd2, 0x8f, 0xb4, 0xdb, 0xd2, 0xd1, 0x81, 0xe6, 0xc3, 0xad,
                           0x31, 0x9,  0x5,  0x79, 0xce, 0xfa, 0x92, 0xd6, 0xcd, 0xa1, 0xd4, 0x7b, 0x3f, 0x9d};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xce, 0x57, 0x39, 0x8c, 0x1b, 0x36, 0xd3, 0xce, 0xd4, 0x64,
                         0x1f, 0x8d, 0xbd, 0x60, 0x61, 0x39, 0xb6, 0x82, 0x2c, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\196\184\STXD\DC3\206\DC2E\138\172a\226\203\SYN\241E)", _pubPktID = 6876, _pubBody =
// "\152k\DEL:{\247\144\fs\215\252\234\162HI", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x3c, 0x25, 0x0,  0x12, 0x7b, 0xc4, 0xb8, 0x2,  0x44, 0x13, 0xce, 0x12, 0x45,
                   0x8a, 0xac, 0x61, 0xe2, 0xcb, 0x16, 0xf1, 0x45, 0x29, 0x1a, 0xdc, 0x98, 0x6b,
                   0x7f, 0x3a, 0x7b, 0xf7, 0x90, 0xc,  0x73, 0xd7, 0xfc, 0xea, 0xa2, 0x48, 0x49};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0x7b, 0xc4, 0xb8, 0x2,  0x44, 0x13, 0xce, 0x12, 0x45,
                           0x8a, 0xac, 0x61, 0xe2, 0xcb, 0x16, 0xf1, 0x45, 0x29};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x98, 0x6b, 0x7f, 0x3a, 0x7b, 0xf7, 0x90, 0xc, 0x73, 0xd7, 0xfc, 0xea, 0xa2, 0x48, 0x49};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6876, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\STXa7W", _pubPktID = 0, _pubBody =
// "\169#\136\219\142\&7\196\149\&4d\246j\146\254\188ch\168$T\135Q*\170\138\DC3!", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0x4,  0x2,  0x61, 0x37, 0x57, 0xa9, 0x23, 0x88, 0xdb,
                   0x8e, 0x37, 0xc4, 0x95, 0x34, 0x64, 0xf6, 0x6a, 0x92, 0xfe, 0xbc, 0x63,
                   0x68, 0xa8, 0x24, 0x54, 0x87, 0x51, 0x2a, 0xaa, 0x8a, 0x13, 0x21};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0x2, 0x61, 0x37, 0x57};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa9, 0x23, 0x88, 0xdb, 0x8e, 0x37, 0xc4, 0x95, 0x34, 0x64, 0xf6, 0x6a, 0x92, 0xfe,
                         0xbc, 0x63, 0x68, 0xa8, 0x24, 0x54, 0x87, 0x51, 0x2a, 0xaa, 0x8a, 0x13, 0x21};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Q\201\132\175[\206\183.\204\200p\224X\173\163MF\ETB\251\223T~\f\bW\241\179\180", _pubPktID = 2085, _pubBody =
// "\240\236\155\SOp\221\217'\225\163K\128", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x3d, 0x2c, 0x0,  0x1c, 0x51, 0xc9, 0x84, 0xaf, 0x5b, 0xce, 0xb7, 0x2e, 0xcc, 0xc8, 0x70, 0xe0,
                   0x58, 0xad, 0xa3, 0x4d, 0x46, 0x17, 0xfb, 0xdf, 0x54, 0x7e, 0xc,  0x8,  0x57, 0xf1, 0xb3, 0xb4,
                   0x8,  0x25, 0xf0, 0xec, 0x9b, 0xe,  0x70, 0xdd, 0xd9, 0x27, 0xe1, 0xa3, 0x4b, 0x80};

  uint8_t buf[56] = {0};

  uint8_t topic_bytes[] = {0x51, 0xc9, 0x84, 0xaf, 0x5b, 0xce, 0xb7, 0x2e, 0xcc, 0xc8, 0x70, 0xe0, 0x58, 0xad,
                           0xa3, 0x4d, 0x46, 0x17, 0xfb, 0xdf, 0x54, 0x7e, 0xc,  0x8,  0x57, 0xf1, 0xb3, 0xb4};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf0, 0xec, 0x9b, 0xe, 0x70, 0xdd, 0xd9, 0x27, 0xe1, 0xa3, 0x4b, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 2085, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\162\236\175\234}", _pubPktID =
// 21077, _pubBody = "T\207i\212;Q", _pubProps = []}
TEST(Publish311QCTest, Encode31) {
  uint8_t pkt[] = {0x33, 0xf, 0x0, 0x5, 0xa2, 0xec, 0xaf, 0xea, 0x7d, 0x52, 0x55, 0x54, 0xcf, 0x69, 0xd4, 0x3b, 0x51};

  uint8_t buf[27] = {0};

  uint8_t topic_bytes[] = {0xa2, 0xec, 0xaf, 0xea, 0x7d};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x54, 0xcf, 0x69, 0xd4, 0x3b, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 21077, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "(E<Sa", _pubPktID = 9852, _pubBody =
// "VJ7\212\SYN\205\162\203\131\160\209\DC2\ACK<\208\135s\183rT\171\162%XrO\173qk", _pubProps = []}
TEST(Publish311QCTest, Encode32) {
  uint8_t pkt[] = {0x3a, 0x26, 0x0,  0x5,  0x28, 0x45, 0x3c, 0x53, 0x61, 0x26, 0x7c, 0x56, 0x4a, 0x37,
                   0xd4, 0x16, 0xcd, 0xa2, 0xcb, 0x83, 0xa0, 0xd1, 0x12, 0x6,  0x3c, 0xd0, 0x87, 0x73,
                   0xb7, 0x72, 0x54, 0xab, 0xa2, 0x25, 0x58, 0x72, 0x4f, 0xad, 0x71, 0x6b};

  uint8_t buf[50] = {0};

  uint8_t topic_bytes[] = {0x28, 0x45, 0x3c, 0x53, 0x61};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x56, 0x4a, 0x37, 0xd4, 0x16, 0xcd, 0xa2, 0xcb, 0x83, 0xa0, 0xd1, 0x12, 0x6,  0x3c, 0xd0,
                         0x87, 0x73, 0xb7, 0x72, 0x54, 0xab, 0xa2, 0x25, 0x58, 0x72, 0x4f, 0xad, 0x71, 0x6b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 9852, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\160", _pubPktID = 20635, _pubBody =
// "\220\193\SOH\ESC\150\212\SUB\t\156\222\ETB\160\148h", _pubProps = []}
TEST(Publish311QCTest, Encode33) {
  uint8_t pkt[] = {0x3d, 0x13, 0x0,  0x1, 0xa0, 0x50, 0x9b, 0xdc, 0xc1, 0x1, 0x1b,
                   0x96, 0xd4, 0x1a, 0x9, 0x9c, 0xde, 0x17, 0xa0, 0x94, 0x68};

  uint8_t buf[31] = {0};

  uint8_t topic_bytes[] = {0xa0};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdc, 0xc1, 0x1, 0x1b, 0x96, 0xd4, 0x1a, 0x9, 0x9c, 0xde, 0x17, 0xa0, 0x94, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 20635, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\196\196\197
// \157\210\229\244\227\218\220\203\176\251\&4\NUL\171\DLE#\251\&9\174+\EM\197\STXt", _pubPktID = 5923, _pubBody =
// "\US[\n\SI=4\153\142(\NAK", _pubProps = []}
TEST(Publish311QCTest, Encode34) {
  uint8_t pkt[] = {0x34, 0x29, 0x0,  0x1b, 0xc4, 0xc4, 0xc5, 0x20, 0x9d, 0xd2, 0xe5, 0xf4, 0xe3, 0xda, 0xdc,
                   0xcb, 0xb0, 0xfb, 0x34, 0x0,  0xab, 0x10, 0x23, 0xfb, 0x39, 0xae, 0x2b, 0x19, 0xc5, 0x2,
                   0x74, 0x17, 0x23, 0x1f, 0x5b, 0xa,  0xf,  0x3d, 0x34, 0x99, 0x8e, 0x28, 0x15};

  uint8_t buf[53] = {0};

  uint8_t topic_bytes[] = {0xc4, 0xc4, 0xc5, 0x20, 0x9d, 0xd2, 0xe5, 0xf4, 0xe3, 0xda, 0xdc, 0xcb, 0xb0, 0xfb,
                           0x34, 0x0,  0xab, 0x10, 0x23, 0xfb, 0x39, 0xae, 0x2b, 0x19, 0xc5, 0x2,  0x74};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1f, 0x5b, 0xa, 0xf, 0x3d, 0x34, 0x99, 0x8e, 0x28, 0x15};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 5923, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\158\"Y{N(\209\&3h\199\152\255\233\186\191", _pubPktID = 26160, _pubBody =
// "\EM\255\ESCWL\245\184\&2\192\185X\214\233t\187 \133\DC4Q", _pubProps = []}
TEST(Publish311QCTest, Encode35) {
  uint8_t pkt[] = {0x3d, 0x26, 0x0,  0xf,  0x9e, 0x22, 0x59, 0x7b, 0x4e, 0x28, 0xd1, 0x33, 0x68, 0xc7,
                   0x98, 0xff, 0xe9, 0xba, 0xbf, 0x66, 0x30, 0x19, 0xff, 0x1b, 0x57, 0x4c, 0xf5, 0xb8,
                   0x32, 0xc0, 0xb9, 0x58, 0xd6, 0xe9, 0x74, 0xbb, 0x20, 0x85, 0x14, 0x51};

  uint8_t buf[50] = {0};

  uint8_t topic_bytes[] = {0x9e, 0x22, 0x59, 0x7b, 0x4e, 0x28, 0xd1, 0x33, 0x68, 0xc7, 0x98, 0xff, 0xe9, 0xba, 0xbf};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x19, 0xff, 0x1b, 0x57, 0x4c, 0xf5, 0xb8, 0x32, 0xc0, 0xb9,
                         0x58, 0xd6, 0xe9, 0x74, 0xbb, 0x20, 0x85, 0x14, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 26160, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\151", _pubPktID = 0, _pubBody =
// "\216N\144\&7\CAN\136\v\176\152", _pubProps = []}
TEST(Publish311QCTest, Encode36) {
  uint8_t pkt[] = {0x39, 0xc, 0x0, 0x1, 0x97, 0xd8, 0x4e, 0x90, 0x37, 0x18, 0x88, 0xb, 0xb0, 0x98};

  uint8_t buf[24] = {0};

  uint8_t topic_bytes[] = {0x97};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0x4e, 0x90, 0x37, 0x18, 0x88, 0xb, 0xb0, 0x98};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\f\n|\ACK", _pubPktID = 0, _pubBody
// = "%\192\&0", _pubProps = []}
TEST(Publish311QCTest, Encode37) {
  uint8_t pkt[] = {0x38, 0x9, 0x0, 0x4, 0xc, 0xa, 0x7c, 0x6, 0x25, 0xc0, 0x30};

  uint8_t buf[21] = {0};

  uint8_t topic_bytes[] = {0xc, 0xa, 0x7c, 0x6};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0xc0, 0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SUB\161\156|\172\155*2\212e\184\252<\195\a\180C\177\162\130\159\166L\200\SYN_", _pubPktID = 14022, _pubBody =
// "01c\156c\152\DC3@\149/\USy\FS\147\184,n\243\245\134Kc?E\206\131\ESC ;", _pubProps = []}
TEST(Publish311QCTest, Encode38) {
  uint8_t pkt[] = {0x32, 0x3b, 0x0,  0x1a, 0x1a, 0xa1, 0x9c, 0x7c, 0xac, 0x9b, 0x2a, 0x32, 0xd4, 0x65, 0xb8, 0xfc,
                   0x3c, 0xc3, 0x7,  0xb4, 0x43, 0xb1, 0xa2, 0x82, 0x9f, 0xa6, 0x4c, 0xc8, 0x16, 0x5f, 0x36, 0xc6,
                   0x30, 0x31, 0x63, 0x9c, 0x63, 0x98, 0x13, 0x40, 0x95, 0x2f, 0x1f, 0x79, 0x1c, 0x93, 0xb8, 0x2c,
                   0x6e, 0xf3, 0xf5, 0x86, 0x4b, 0x63, 0x3f, 0x45, 0xce, 0x83, 0x1b, 0x20, 0x3b};

  uint8_t buf[71] = {0};

  uint8_t topic_bytes[] = {0x1a, 0xa1, 0x9c, 0x7c, 0xac, 0x9b, 0x2a, 0x32, 0xd4, 0x65, 0xb8, 0xfc, 0x3c,
                           0xc3, 0x7,  0xb4, 0x43, 0xb1, 0xa2, 0x82, 0x9f, 0xa6, 0x4c, 0xc8, 0x16, 0x5f};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x30, 0x31, 0x63, 0x9c, 0x63, 0x98, 0x13, 0x40, 0x95, 0x2f, 0x1f, 0x79, 0x1c, 0x93, 0xb8,
                         0x2c, 0x6e, 0xf3, 0xf5, 0x86, 0x4b, 0x63, 0x3f, 0x45, 0xce, 0x83, 0x1b, 0x20, 0x3b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 14022, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\186Kx\255\202i[\182\SUBu\242L\148\153\157\182\GSY)", _pubPktID = 16446, _pubBody =
// "\STX\188u\179*\236\174\253@\ACK\219x\192d\168\200\210\177-\181\250\207\176\230", _pubProps = []}
TEST(Publish311QCTest, Encode39) {
  uint8_t pkt[] = {0x35, 0x2f, 0x0,  0x13, 0xba, 0x4b, 0x78, 0xff, 0xca, 0x69, 0x5b, 0xb6, 0x1a, 0x75, 0xf2, 0x4c, 0x94,
                   0x99, 0x9d, 0xb6, 0x1d, 0x59, 0x29, 0x40, 0x3e, 0x2,  0xbc, 0x75, 0xb3, 0x2a, 0xec, 0xae, 0xfd, 0x40,
                   0x6,  0xdb, 0x78, 0xc0, 0x64, 0xa8, 0xc8, 0xd2, 0xb1, 0x2d, 0xb5, 0xfa, 0xcf, 0xb0, 0xe6};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0xba, 0x4b, 0x78, 0xff, 0xca, 0x69, 0x5b, 0xb6, 0x1a, 0x75,
                           0xf2, 0x4c, 0x94, 0x99, 0x9d, 0xb6, 0x1d, 0x59, 0x29};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2,  0xbc, 0x75, 0xb3, 0x2a, 0xec, 0xae, 0xfd, 0x40, 0x6,  0xdb, 0x78,
                         0xc0, 0x64, 0xa8, 0xc8, 0xd2, 0xb1, 0x2d, 0xb5, 0xfa, 0xcf, 0xb0, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16446, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\252\171\ETB\146\NUL\152K`)b\NAK\180\148v\174B%\160\203\135\202\RS,\162aK\ESCF\183\140", _pubPktID = 0, _pubBody = "
// \173\153\209\219\234pW\207F\221\202q\136\227\190\"\199\130", _pubProps = []}
TEST(Publish311QCTest, Encode40) {
  uint8_t pkt[] = {0x30, 0x33, 0x0,  0x1e, 0xfc, 0xab, 0x17, 0x92, 0x0,  0x98, 0x4b, 0x60, 0x29, 0x62,
                   0x15, 0xb4, 0x94, 0x76, 0xae, 0x42, 0x25, 0xa0, 0xcb, 0x87, 0xca, 0x1e, 0x2c, 0xa2,
                   0x61, 0x4b, 0x1b, 0x46, 0xb7, 0x8c, 0x20, 0xad, 0x99, 0xd1, 0xdb, 0xea, 0x70, 0x57,
                   0xcf, 0x46, 0xdd, 0xca, 0x71, 0x88, 0xe3, 0xbe, 0x22, 0xc7, 0x82};

  uint8_t buf[63] = {0};

  uint8_t topic_bytes[] = {0xfc, 0xab, 0x17, 0x92, 0x0,  0x98, 0x4b, 0x60, 0x29, 0x62, 0x15, 0xb4, 0x94, 0x76, 0xae,
                           0x42, 0x25, 0xa0, 0xcb, 0x87, 0xca, 0x1e, 0x2c, 0xa2, 0x61, 0x4b, 0x1b, 0x46, 0xb7, 0x8c};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x20, 0xad, 0x99, 0xd1, 0xdb, 0xea, 0x70, 0x57, 0xcf, 0x46,
                         0xdd, 0xca, 0x71, 0x88, 0xe3, 0xbe, 0x22, 0xc7, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\166z\ENQ\171\210s\190J\237\153\219\210", _pubPktID = 15842, _pubBody = "\221-AF\157\205\a\153)\165QYh", _pubProps =
// []}
TEST(Publish311QCTest, Encode41) {
  uint8_t pkt[] = {0x35, 0x1d, 0x0,  0xc,  0xa6, 0x7a, 0x5,  0xab, 0xd2, 0x73, 0xbe, 0x4a, 0xed, 0x99, 0xdb, 0xd2,
                   0x3d, 0xe2, 0xdd, 0x2d, 0x41, 0x46, 0x9d, 0xcd, 0x7,  0x99, 0x29, 0xa5, 0x51, 0x59, 0x68};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0xa6, 0x7a, 0x5, 0xab, 0xd2, 0x73, 0xbe, 0x4a, 0xed, 0x99, 0xdb, 0xd2};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0x2d, 0x41, 0x46, 0x9d, 0xcd, 0x7, 0x99, 0x29, 0xa5, 0x51, 0x59, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 15842, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\206v6D\250\210o\GS\204\139H\184\vu\245\236z", _pubPktID = 6705, _pubBody =
// "\f\211\163\197\&3\254\185\161\DC2\198\aX\255", _pubProps = []}
TEST(Publish311QCTest, Encode42) {
  uint8_t pkt[] = {0x3d, 0x22, 0x0,  0x11, 0xce, 0x76, 0x36, 0x44, 0xfa, 0xd2, 0x6f, 0x1d,
                   0xcc, 0x8b, 0x48, 0xb8, 0xb,  0x75, 0xf5, 0xec, 0x7a, 0x1a, 0x31, 0xc,
                   0xd3, 0xa3, 0xc5, 0x33, 0xfe, 0xb9, 0xa1, 0x12, 0xc6, 0x7,  0x58, 0xff};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0xce, 0x76, 0x36, 0x44, 0xfa, 0xd2, 0x6f, 0x1d, 0xcc,
                           0x8b, 0x48, 0xb8, 0xb,  0x75, 0xf5, 0xec, 0x7a};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc, 0xd3, 0xa3, 0xc5, 0x33, 0xfe, 0xb9, 0xa1, 0x12, 0xc6, 0x7, 0x58, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6705, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146n\207\252s\SOHt\253N\US(M?\NAK&\NAKR\139\193\&4\SOH\152\179\v", _pubPktID = 0, _pubBody =
// "\139b\185\b\186\&5\RS\EOT\166\STXV\149\135/\DEL$\167\144u", _pubProps = []}
TEST(Publish311QCTest, Encode43) {
  uint8_t pkt[] = {0x31, 0x2d, 0x0,  0x18, 0x92, 0x6e, 0xcf, 0xfc, 0x73, 0x1,  0x74, 0xfd, 0x4e, 0x1f, 0x28, 0x4d,
                   0x3f, 0x15, 0x26, 0x15, 0x52, 0x8b, 0xc1, 0x34, 0x1,  0x98, 0xb3, 0xb,  0x8b, 0x62, 0xb9, 0x8,
                   0xba, 0x35, 0x1e, 0x4,  0xa6, 0x2,  0x56, 0x95, 0x87, 0x2f, 0x7f, 0x24, 0xa7, 0x90, 0x75};

  uint8_t buf[57] = {0};

  uint8_t topic_bytes[] = {0x92, 0x6e, 0xcf, 0xfc, 0x73, 0x1,  0x74, 0xfd, 0x4e, 0x1f, 0x28, 0x4d,
                           0x3f, 0x15, 0x26, 0x15, 0x52, 0x8b, 0xc1, 0x34, 0x1,  0x98, 0xb3, 0xb};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8b, 0x62, 0xb9, 0x8,  0xba, 0x35, 0x1e, 0x4,  0xa6, 0x2,
                         0x56, 0x95, 0x87, 0x2f, 0x7f, 0x24, 0xa7, 0x90, 0x75};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\205\235\&9L\b\236\187\184{\199\135G\165c\200\144\SO\NUL\234u\SYN\142O\177N:\161\&8", _pubPktID = 0, _pubBody =
// "Z \DEL\193\197\&7K\147\137\199b]\243}\248\161\248.Y\218bb\132\156\GS\DC2>\224", _pubProps = []}
TEST(Publish311QCTest, Encode44) {
  uint8_t pkt[] = {0x31, 0x3b, 0x0,  0x1d, 0xa8, 0xcd, 0xeb, 0x39, 0x4c, 0x8,  0xec, 0xbb, 0xb8, 0x7b, 0xc7, 0x87,
                   0x47, 0xa5, 0x63, 0xc8, 0x90, 0xe,  0x0,  0xea, 0x75, 0x16, 0x8e, 0x4f, 0xb1, 0x4e, 0x3a, 0xa1,
                   0x38, 0x5a, 0x20, 0x7f, 0xc1, 0xc5, 0x37, 0x4b, 0x93, 0x89, 0xc7, 0x62, 0x5d, 0xf3, 0x7d, 0xf8,
                   0xa1, 0xf8, 0x2e, 0x59, 0xda, 0x62, 0x62, 0x84, 0x9c, 0x1d, 0x12, 0x3e, 0xe0};

  uint8_t buf[71] = {0};

  uint8_t topic_bytes[] = {0xa8, 0xcd, 0xeb, 0x39, 0x4c, 0x8,  0xec, 0xbb, 0xb8, 0x7b, 0xc7, 0x87, 0x47, 0xa5, 0x63,
                           0xc8, 0x90, 0xe,  0x0,  0xea, 0x75, 0x16, 0x8e, 0x4f, 0xb1, 0x4e, 0x3a, 0xa1, 0x38};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5a, 0x20, 0x7f, 0xc1, 0xc5, 0x37, 0x4b, 0x93, 0x89, 0xc7, 0x62, 0x5d, 0xf3, 0x7d,
                         0xf8, 0xa1, 0xf8, 0x2e, 0x59, 0xda, 0x62, 0x62, 0x84, 0x9c, 0x1d, 0x12, 0x3e, 0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\165r\DEL\n\202\133kb\136",
// _pubPktID = 7921, _pubBody = "O\248\206?\215\168\&4\DC1\131\187<1\176\200\EOTW \FSu\ETB3\128\222N\241\193\180",
// _pubProps = []}
TEST(Publish311QCTest, Encode45) {
  uint8_t pkt[] = {0x3c, 0x28, 0x0,  0x9,  0xa5, 0x72, 0x7f, 0xa,  0xca, 0x85, 0x6b, 0x62, 0x88, 0x1e,
                   0xf1, 0x4f, 0xf8, 0xce, 0x3f, 0xd7, 0xa8, 0x34, 0x11, 0x83, 0xbb, 0x3c, 0x31, 0xb0,
                   0xc8, 0x4,  0x57, 0x20, 0x1c, 0x75, 0x17, 0x33, 0x80, 0xde, 0x4e, 0xf1, 0xc1, 0xb4};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0xa5, 0x72, 0x7f, 0xa, 0xca, 0x85, 0x6b, 0x62, 0x88};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4f, 0xf8, 0xce, 0x3f, 0xd7, 0xa8, 0x34, 0x11, 0x83, 0xbb, 0x3c, 0x31, 0xb0, 0xc8,
                         0x4,  0x57, 0x20, 0x1c, 0x75, 0x17, 0x33, 0x80, 0xde, 0x4e, 0xf1, 0xc1, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7921, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\228\161\&1\220\142H\211q3\179%~Q\148", _pubPktID = 29868, _pubBody = "nP\243G", _pubProps = []}
TEST(Publish311QCTest, Encode46) {
  uint8_t pkt[] = {0x33, 0x16, 0x0,  0xe,  0xe4, 0xa1, 0x31, 0xdc, 0x8e, 0x48, 0xd3, 0x71,
                   0x33, 0xb3, 0x25, 0x7e, 0x51, 0x94, 0x74, 0xac, 0x6e, 0x50, 0xf3, 0x47};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0xe4, 0xa1, 0x31, 0xdc, 0x8e, 0x48, 0xd3, 0x71, 0x33, 0xb3, 0x25, 0x7e, 0x51, 0x94};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0x50, 0xf3, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29868, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\NUL\211nNzt\150\194r\182+\179\199\146", _pubPktID = 0, _pubBody =
// "]8\167\v\179vF\250\130{$\169\150w^\190QS]U\227C\205\189\179[\ENQ\131\SUB\200", _pubProps = []}
TEST(Publish311QCTest, Encode47) {
  uint8_t pkt[] = {0x38, 0x2e, 0x0,  0xe,  0x0,  0xd3, 0x6e, 0x4e, 0x7a, 0x74, 0x96, 0xc2, 0x72, 0xb6, 0x2b, 0xb3,
                   0xc7, 0x92, 0x5d, 0x38, 0xa7, 0xb,  0xb3, 0x76, 0x46, 0xfa, 0x82, 0x7b, 0x24, 0xa9, 0x96, 0x77,
                   0x5e, 0xbe, 0x51, 0x53, 0x5d, 0x55, 0xe3, 0x43, 0xcd, 0xbd, 0xb3, 0x5b, 0x5,  0x83, 0x1a, 0xc8};

  uint8_t buf[58] = {0};

  uint8_t topic_bytes[] = {0x0, 0xd3, 0x6e, 0x4e, 0x7a, 0x74, 0x96, 0xc2, 0x72, 0xb6, 0x2b, 0xb3, 0xc7, 0x92};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5d, 0x38, 0xa7, 0xb,  0xb3, 0x76, 0x46, 0xfa, 0x82, 0x7b, 0x24, 0xa9, 0x96, 0x77, 0x5e,
                         0xbe, 0x51, 0x53, 0x5d, 0x55, 0xe3, 0x43, 0xcd, 0xbd, 0xb3, 0x5b, 0x5,  0x83, 0x1a, 0xc8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "'\245\224\138\229\155\&6\241\GS\"t\ETX5%4?\146\ETB", _pubPktID = 0, _pubBody = "\SUB)\222", _pubProps = []}
TEST(Publish311QCTest, Encode48) {
  uint8_t pkt[] = {0x39, 0x17, 0x0, 0x12, 0x27, 0xf5, 0xe0, 0x8a, 0xe5, 0x9b, 0x36, 0xf1, 0x1d,
                   0x22, 0x74, 0x3, 0x35, 0x25, 0x34, 0x3f, 0x92, 0x17, 0x1a, 0x29, 0xde};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0x27, 0xf5, 0xe0, 0x8a, 0xe5, 0x9b, 0x36, 0xf1, 0x1d,
                           0x22, 0x74, 0x3,  0x35, 0x25, 0x34, 0x3f, 0x92, 0x17};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1a, 0x29, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\200Z\225i^_\STX\231\193\STX",
// _pubPktID = 16826, _pubBody = "\206\193\194\217\177\152\142,\163\145\149Q\237?7\131k\n\177[^\153ti\134sYl\140\174",
// _pubProps = []}
TEST(Publish311QCTest, Encode49) {
  uint8_t pkt[] = {0x3d, 0x2c, 0x0,  0xa,  0xc8, 0x5a, 0xe1, 0x69, 0x5e, 0x5f, 0x2,  0xe7, 0xc1, 0x2,  0x41, 0xba,
                   0xce, 0xc1, 0xc2, 0xd9, 0xb1, 0x98, 0x8e, 0x2c, 0xa3, 0x91, 0x95, 0x51, 0xed, 0x3f, 0x37, 0x83,
                   0x6b, 0xa,  0xb1, 0x5b, 0x5e, 0x99, 0x74, 0x69, 0x86, 0x73, 0x59, 0x6c, 0x8c, 0xae};

  uint8_t buf[56] = {0};

  uint8_t topic_bytes[] = {0xc8, 0x5a, 0xe1, 0x69, 0x5e, 0x5f, 0x2, 0xe7, 0xc1, 0x2};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xce, 0xc1, 0xc2, 0xd9, 0xb1, 0x98, 0x8e, 0x2c, 0xa3, 0x91, 0x95, 0x51, 0xed, 0x3f, 0x37,
                         0x83, 0x6b, 0xa,  0xb1, 0x5b, 0x5e, 0x99, 0x74, 0x69, 0x86, 0x73, 0x59, 0x6c, 0x8c, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16826, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\161\178\167\170\164+\151g\137\n",
// _pubPktID = 11219, _pubBody = "R\146a\229\236\247\197\178\199\136\159_\251", _pubProps = []}
TEST(Publish311QCTest, Encode50) {
  uint8_t pkt[] = {0x3b, 0x1b, 0x0,  0xa,  0xa1, 0xb2, 0xa7, 0xaa, 0xa4, 0x2b, 0x97, 0x67, 0x89, 0xa, 0x2b,
                   0xd3, 0x52, 0x92, 0x61, 0xe5, 0xec, 0xf7, 0xc5, 0xb2, 0xc7, 0x88, 0x9f, 0x5f, 0xfb};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0xa1, 0xb2, 0xa7, 0xaa, 0xa4, 0x2b, 0x97, 0x67, 0x89, 0xa};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x52, 0x92, 0x61, 0xe5, 0xec, 0xf7, 0xc5, 0xb2, 0xc7, 0x88, 0x9f, 0x5f, 0xfb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 11219, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "R\\\164\224\200+\254\\\233t@\GS\144\&5|\243\244@%\240\170\193\150V\252\133q", _pubPktID = 23768, _pubBody =
// "\RS.\158\236\175|6'\152C\151\NUL\138o\230\242\236\184,\ENQ\201^\185\t", _pubProps = []}
TEST(Publish311QCTest, Encode51) {
  uint8_t pkt[] = {0x3c, 0x37, 0x0,  0x1b, 0x52, 0x5c, 0xa4, 0xe0, 0xc8, 0x2b, 0xfe, 0x5c, 0xe9, 0x74, 0x40,
                   0x1d, 0x90, 0x35, 0x7c, 0xf3, 0xf4, 0x40, 0x25, 0xf0, 0xaa, 0xc1, 0x96, 0x56, 0xfc, 0x85,
                   0x71, 0x5c, 0xd8, 0x1e, 0x2e, 0x9e, 0xec, 0xaf, 0x7c, 0x36, 0x27, 0x98, 0x43, 0x97, 0x0,
                   0x8a, 0x6f, 0xe6, 0xf2, 0xec, 0xb8, 0x2c, 0x5,  0xc9, 0x5e, 0xb9, 0x9};

  uint8_t buf[67] = {0};

  uint8_t topic_bytes[] = {0x52, 0x5c, 0xa4, 0xe0, 0xc8, 0x2b, 0xfe, 0x5c, 0xe9, 0x74, 0x40, 0x1d, 0x90, 0x35,
                           0x7c, 0xf3, 0xf4, 0x40, 0x25, 0xf0, 0xaa, 0xc1, 0x96, 0x56, 0xfc, 0x85, 0x71};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1e, 0x2e, 0x9e, 0xec, 0xaf, 0x7c, 0x36, 0x27, 0x98, 0x43, 0x97, 0x0,
                         0x8a, 0x6f, 0xe6, 0xf2, 0xec, 0xb8, 0x2c, 0x5,  0xc9, 0x5e, 0xb9, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 23768, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\EOT+\243\179\223\201\tb\221\175W<\221L\a", _pubPktID = 32599, _pubBody =
// "\187\221\219\249%\DC1M\195%\227~\ETBcZ\232\f\141\254\253\223", _pubProps = []}
TEST(Publish311QCTest, Encode52) {
  uint8_t pkt[] = {0x3b, 0x27, 0x0,  0xf,  0x4,  0x2b, 0xf3, 0xb3, 0xdf, 0xc9, 0x9,  0x62, 0xdd, 0xaf,
                   0x57, 0x3c, 0xdd, 0x4c, 0x7,  0x7f, 0x57, 0xbb, 0xdd, 0xdb, 0xf9, 0x25, 0x11, 0x4d,
                   0xc3, 0x25, 0xe3, 0x7e, 0x17, 0x63, 0x5a, 0xe8, 0xc,  0x8d, 0xfe, 0xfd, 0xdf};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x4, 0x2b, 0xf3, 0xb3, 0xdf, 0xc9, 0x9, 0x62, 0xdd, 0xaf, 0x57, 0x3c, 0xdd, 0x4c, 0x7};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xdd, 0xdb, 0xf9, 0x25, 0x11, 0x4d, 0xc3, 0x25, 0xe3,
                         0x7e, 0x17, 0x63, 0x5a, 0xe8, 0xc,  0x8d, 0xfe, 0xfd, 0xdf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 32599, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "k6\170c0\139\149-", _pubPktID =
// 24880, _pubBody = "q\181r\196\216Eo\234\"\ENQ\138\207\210-\196\182\157\139\DC2\178?b\a4\250\ETB\168\131", _pubProps =
// []}
TEST(Publish311QCTest, Encode53) {
  uint8_t pkt[] = {0x32, 0x28, 0x0,  0x8,  0x6b, 0x36, 0xaa, 0x63, 0x30, 0x8b, 0x95, 0x2d, 0x61, 0x30,
                   0x71, 0xb5, 0x72, 0xc4, 0xd8, 0x45, 0x6f, 0xea, 0x22, 0x5,  0x8a, 0xcf, 0xd2, 0x2d,
                   0xc4, 0xb6, 0x9d, 0x8b, 0x12, 0xb2, 0x3f, 0x62, 0x7,  0x34, 0xfa, 0x17, 0xa8, 0x83};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0x6b, 0x36, 0xaa, 0x63, 0x30, 0x8b, 0x95, 0x2d};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x71, 0xb5, 0x72, 0xc4, 0xd8, 0x45, 0x6f, 0xea, 0x22, 0x5,  0x8a, 0xcf, 0xd2, 0x2d,
                         0xc4, 0xb6, 0x9d, 0x8b, 0x12, 0xb2, 0x3f, 0x62, 0x7,  0x34, 0xfa, 0x17, 0xa8, 0x83};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24880, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\164]\137\161\184\189\ETB_L\r+\255\233u\227\NAK\SI\199\CANG\211_\141", _pubPktID = 0, _pubBody =
// "n\169\136j,\137\228\208\162\164aL\186\EOT\241\GS\230d\142\177N\138P", _pubProps = []}
TEST(Publish311QCTest, Encode54) {
  uint8_t pkt[] = {0x38, 0x30, 0x0,  0x17, 0xa4, 0x5d, 0x89, 0xa1, 0xb8, 0xbd, 0x17, 0x5f, 0x4c, 0xd,  0x2b, 0xff, 0xe9,
                   0x75, 0xe3, 0x15, 0xf,  0xc7, 0x18, 0x47, 0xd3, 0x5f, 0x8d, 0x6e, 0xa9, 0x88, 0x6a, 0x2c, 0x89, 0xe4,
                   0xd0, 0xa2, 0xa4, 0x61, 0x4c, 0xba, 0x4,  0xf1, 0x1d, 0xe6, 0x64, 0x8e, 0xb1, 0x4e, 0x8a, 0x50};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0xa4, 0x5d, 0x89, 0xa1, 0xb8, 0xbd, 0x17, 0x5f, 0x4c, 0xd,  0x2b, 0xff,
                           0xe9, 0x75, 0xe3, 0x15, 0xf,  0xc7, 0x18, 0x47, 0xd3, 0x5f, 0x8d};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6e, 0xa9, 0x88, 0x6a, 0x2c, 0x89, 0xe4, 0xd0, 0xa2, 0xa4, 0x61, 0x4c,
                         0xba, 0x4,  0xf1, 0x1d, 0xe6, 0x64, 0x8e, 0xb1, 0x4e, 0x8a, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "_\225\NAK\164\f\128V", _pubPktID =
// 0, _pubBody = "\146\161JU\174P\208og\201\149\132e\190\182\\!e\203q\201\194\SYN\147O\178\173{\DC2F", _pubProps = []}
TEST(Publish311QCTest, Encode55) {
  uint8_t pkt[] = {0x30, 0x27, 0x0,  0x7,  0x5f, 0xe1, 0x15, 0xa4, 0xc,  0x80, 0x56, 0x92, 0xa1, 0x4a,
                   0x55, 0xae, 0x50, 0xd0, 0x6f, 0x67, 0xc9, 0x95, 0x84, 0x65, 0xbe, 0xb6, 0x5c, 0x21,
                   0x65, 0xcb, 0x71, 0xc9, 0xc2, 0x16, 0x93, 0x4f, 0xb2, 0xad, 0x7b, 0x12, 0x46};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x5f, 0xe1, 0x15, 0xa4, 0xc, 0x80, 0x56};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0xa1, 0x4a, 0x55, 0xae, 0x50, 0xd0, 0x6f, 0x67, 0xc9, 0x95, 0x84, 0x65, 0xbe, 0xb6,
                         0x5c, 0x21, 0x65, 0xcb, 0x71, 0xc9, 0xc2, 0x16, 0x93, 0x4f, 0xb2, 0xad, 0x7b, 0x12, 0x46};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\b\240\fA@\206\204-;
// R\nS$\n\194\ESCh\DC1P2\229\135$", _pubPktID = 32117, _pubBody = "[\a", _pubProps = []}
TEST(Publish311QCTest, Encode56) {
  uint8_t pkt[] = {0x35, 0x1e, 0x0, 0x18, 0x8,  0xf0, 0xc,  0x41, 0x40, 0xce, 0xcc, 0x2d, 0x3b, 0x20, 0x52, 0xa,
                   0x53, 0x24, 0xa, 0xc2, 0x1b, 0x68, 0x11, 0x50, 0x32, 0xe5, 0x87, 0x24, 0x7d, 0x75, 0x5b, 0x7};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x8,  0xf0, 0xc, 0x41, 0x40, 0xce, 0xcc, 0x2d, 0x3b, 0x20, 0x52, 0xa,
                           0x53, 0x24, 0xa, 0xc2, 0x1b, 0x68, 0x11, 0x50, 0x32, 0xe5, 0x87, 0x24};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 32117, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\169\247+\235\ACK\192\145",
// _pubPktID = 0, _pubBody = "\a\197\204\DEL\222\198\153\205\174\176a\153\233u\246\203~z\166\212\229\207sp\US`\225",
// _pubProps = []}
TEST(Publish311QCTest, Encode57) {
  uint8_t pkt[] = {0x31, 0x24, 0x0,  0x7,  0xa9, 0xf7, 0x2b, 0xeb, 0x6,  0xc0, 0x91, 0x7,  0xc5,
                   0xcc, 0x7f, 0xde, 0xc6, 0x99, 0xcd, 0xae, 0xb0, 0x61, 0x99, 0xe9, 0x75, 0xf6,
                   0xcb, 0x7e, 0x7a, 0xa6, 0xd4, 0xe5, 0xcf, 0x73, 0x70, 0x1f, 0x60, 0xe1};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0xa9, 0xf7, 0x2b, 0xeb, 0x6, 0xc0, 0x91};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7,  0xc5, 0xcc, 0x7f, 0xde, 0xc6, 0x99, 0xcd, 0xae, 0xb0, 0x61, 0x99, 0xe9, 0x75,
                         0xf6, 0xcb, 0x7e, 0x7a, 0xa6, 0xd4, 0xe5, 0xcf, 0x73, 0x70, 0x1f, 0x60, 0xe1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\150\251\130\251\166R)\184\\I^\183\212@\189\150\222", _pubPktID = 0, _pubBody = "\139}\228\225\&9", _pubProps = []}
TEST(Publish311QCTest, Encode58) {
  uint8_t pkt[] = {0x30, 0x18, 0x0,  0x11, 0x96, 0xfb, 0x82, 0xfb, 0xa6, 0x52, 0x29, 0xb8, 0x5c,
                   0x49, 0x5e, 0xb7, 0xd4, 0x40, 0xbd, 0x96, 0xde, 0x8b, 0x7d, 0xe4, 0xe1, 0x39};

  uint8_t buf[36] = {0};

  uint8_t topic_bytes[] = {0x96, 0xfb, 0x82, 0xfb, 0xa6, 0x52, 0x29, 0xb8, 0x5c,
                           0x49, 0x5e, 0xb7, 0xd4, 0x40, 0xbd, 0x96, 0xde};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0x7d, 0xe4, 0xe1, 0x39};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\161n\174\237\249", _pubPktID = 0,
// _pubBody = "YFq\199\251\158-\155S\194}\250\NULjMrM\ESC/6f\DC3\140", _pubProps = []}
TEST(Publish311QCTest, Encode59) {
  uint8_t pkt[] = {0x38, 0x1e, 0x0,  0x5,  0xa1, 0x6e, 0xae, 0xed, 0xf9, 0x59, 0x46, 0x71, 0xc7, 0xfb, 0x9e, 0x2d,
                   0x9b, 0x53, 0xc2, 0x7d, 0xfa, 0x0,  0x6a, 0x4d, 0x72, 0x4d, 0x1b, 0x2f, 0x36, 0x66, 0x13, 0x8c};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0xa1, 0x6e, 0xae, 0xed, 0xf9};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x59, 0x46, 0x71, 0xc7, 0xfb, 0x9e, 0x2d, 0x9b, 0x53, 0xc2, 0x7d, 0xfa,
                         0x0,  0x6a, 0x4d, 0x72, 0x4d, 0x1b, 0x2f, 0x36, 0x66, 0x13, 0x8c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 4694, _pubBody =
// "\137\179ML\236", _pubProps = []}
TEST(Publish311QCTest, Encode60) {
  uint8_t pkt[] = {0x3c, 0x9, 0x0, 0x0, 0x12, 0x56, 0x89, 0xb3, 0x4d, 0x4c, 0xec};

  uint8_t buf[21] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x89, 0xb3, 0x4d, 0x4c, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 4694, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\ETB2\218\142q%", _pubPktID = 16088,
// _pubBody = "\251hR\153\SI\f\226", _pubProps = []}
TEST(Publish311QCTest, Encode61) {
  uint8_t pkt[] = {0x33, 0x11, 0x0,  0x6,  0x17, 0x32, 0xda, 0x8e, 0x71, 0x25,
                   0x3e, 0xd8, 0xfb, 0x68, 0x52, 0x99, 0xf,  0xc,  0xe2};

  uint8_t buf[29] = {0};

  uint8_t topic_bytes[] = {0x17, 0x32, 0xda, 0x8e, 0x71, 0x25};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x68, 0x52, 0x99, 0xf, 0xc, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16088, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\DC3\188\&0\t6w\FS", _pubPktID =
// 7577, _pubBody = "9\176{\185\134p\216\206\208\GS\EM?", _pubProps = []}
TEST(Publish311QCTest, Encode62) {
  uint8_t pkt[] = {0x32, 0x17, 0x0,  0x7,  0x13, 0xbc, 0x30, 0x9,  0x36, 0x77, 0x1c, 0x1d, 0x99,
                   0x39, 0xb0, 0x7b, 0xb9, 0x86, 0x70, 0xd8, 0xce, 0xd0, 0x1d, 0x19, 0x3f};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0x13, 0xbc, 0x30, 0x9, 0x36, 0x77, 0x1c};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x39, 0xb0, 0x7b, 0xb9, 0x86, 0x70, 0xd8, 0xce, 0xd0, 0x1d, 0x19, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7577, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\DC2a\165\SO(\131\154\NAKm\b\STX\243\250\178\197H", _pubPktID = 13200, _pubBody = "\164V\204\140", _pubProps = []}
TEST(Publish311QCTest, Encode63) {
  uint8_t pkt[] = {0x3c, 0x18, 0x0,  0x10, 0x12, 0x61, 0xa5, 0xe,  0x28, 0x83, 0x9a, 0x15, 0x6d,
                   0x8,  0x2,  0xf3, 0xfa, 0xb2, 0xc5, 0x48, 0x33, 0x90, 0xa4, 0x56, 0xcc, 0x8c};

  uint8_t buf[36] = {0};

  uint8_t topic_bytes[] = {0x12, 0x61, 0xa5, 0xe, 0x28, 0x83, 0x9a, 0x15, 0x6d, 0x8, 0x2, 0xf3, 0xfa, 0xb2, 0xc5, 0x48};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa4, 0x56, 0xcc, 0x8c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 13200, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\136\199\135\133\171\252+\211d\DC3\\\170>\250\GS\GS\250\ETX\238", _pubPktID = 15457, _pubBody =
// "f\244\166\DLE\197\195\242\206\199<\FS\ETB$\STX \236\135\235\232\196\229\b`n\216,v\233V\177", _pubProps = []}
TEST(Publish311QCTest, Encode64) {
  uint8_t pkt[] = {0x3b, 0x35, 0x0,  0x13, 0x88, 0xc7, 0x87, 0x85, 0xab, 0xfc, 0x2b, 0xd3, 0x64, 0x13,
                   0x5c, 0xaa, 0x3e, 0xfa, 0x1d, 0x1d, 0xfa, 0x3,  0xee, 0x3c, 0x61, 0x66, 0xf4, 0xa6,
                   0x10, 0xc5, 0xc3, 0xf2, 0xce, 0xc7, 0x3c, 0x1c, 0x17, 0x24, 0x2,  0x20, 0xec, 0x87,
                   0xeb, 0xe8, 0xc4, 0xe5, 0x8,  0x60, 0x6e, 0xd8, 0x2c, 0x76, 0xe9, 0x56, 0xb1};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0x88, 0xc7, 0x87, 0x85, 0xab, 0xfc, 0x2b, 0xd3, 0x64, 0x13,
                           0x5c, 0xaa, 0x3e, 0xfa, 0x1d, 0x1d, 0xfa, 0x3,  0xee};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x66, 0xf4, 0xa6, 0x10, 0xc5, 0xc3, 0xf2, 0xce, 0xc7, 0x3c, 0x1c, 0x17, 0x24, 0x2,  0x20,
                         0xec, 0x87, 0xeb, 0xe8, 0xc4, 0xe5, 0x8,  0x60, 0x6e, 0xd8, 0x2c, 0x76, 0xe9, 0x56, 0xb1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15457, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 29420, _pubBody =
// "F\146\254\ETB\174Cu^\188$\218\201\215$\253\&7\184\236S\169\243\ETXn\180\US\fC\220\137\SYN", _pubProps = []}
TEST(Publish311QCTest, Encode65) {
  uint8_t pkt[] = {0x33, 0x22, 0x0,  0x0,  0x72, 0xec, 0x46, 0x92, 0xfe, 0x17, 0xae, 0x43,
                   0x75, 0x5e, 0xbc, 0x24, 0xda, 0xc9, 0xd7, 0x24, 0xfd, 0x37, 0xb8, 0xec,
                   0x53, 0xa9, 0xf3, 0x3,  0x6e, 0xb4, 0x1f, 0xc,  0x43, 0xdc, 0x89, 0x16};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x46, 0x92, 0xfe, 0x17, 0xae, 0x43, 0x75, 0x5e, 0xbc, 0x24, 0xda, 0xc9, 0xd7, 0x24, 0xfd,
                         0x37, 0xb8, 0xec, 0x53, 0xa9, 0xf3, 0x3,  0x6e, 0xb4, 0x1f, 0xc,  0x43, 0xdc, 0x89, 0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29420, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\220\DC4\187\155", _pubPktID =
// 28673, _pubBody = "\160\255\248\156YF\148S\164\194~\t\212\134\149`\202l", _pubProps = []}
TEST(Publish311QCTest, Encode66) {
  uint8_t pkt[] = {0x35, 0x1b, 0x0,  0x5,  0xfd, 0xdc, 0x14, 0xbb, 0x9b, 0x70, 0x1,  0xa0, 0xff, 0xf8, 0x9c,
                   0x59, 0x46, 0x94, 0x53, 0xa4, 0xc2, 0x7e, 0x9,  0xd4, 0x86, 0x95, 0x60, 0xca, 0x6c};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0xfd, 0xdc, 0x14, 0xbb, 0x9b};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa0, 0xff, 0xf8, 0x9c, 0x59, 0x46, 0x94, 0x53, 0xa4,
                         0xc2, 0x7e, 0x9,  0xd4, 0x86, 0x95, 0x60, 0xca, 0x6c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 28673, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\141\195\131\143\248w\207",
// _pubPktID = 574, _pubBody = "x\\\156a}\224\130S\US%\153\187\181\217\RS\201{", _pubProps = []}
TEST(Publish311QCTest, Encode67) {
  uint8_t pkt[] = {0x33, 0x1c, 0x0,  0x7,  0x8d, 0xc3, 0x83, 0x8f, 0xf8, 0x77, 0xcf, 0x2,  0x3e, 0x78, 0x5c,
                   0x9c, 0x61, 0x7d, 0xe0, 0x82, 0x53, 0x1f, 0x25, 0x99, 0xbb, 0xb5, 0xd9, 0x1e, 0xc9, 0x7b};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0x8d, 0xc3, 0x83, 0x8f, 0xf8, 0x77, 0xcf};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x78, 0x5c, 0x9c, 0x61, 0x7d, 0xe0, 0x82, 0x53, 0x1f,
                         0x25, 0x99, 0xbb, 0xb5, 0xd9, 0x1e, 0xc9, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 574, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "Mq\234\146\239\150W\FS1\177",
// _pubPktID = 0, _pubBody = "0\141\201\&8\139\&4\ETX>\239\RS\238\229t\225\198|\194W\186]\200\244|\171\DLE\163\193",
// _pubProps = []}
TEST(Publish311QCTest, Encode68) {
  uint8_t pkt[] = {0x38, 0x27, 0x0,  0xa,  0x4d, 0x71, 0xea, 0x92, 0xef, 0x96, 0x57, 0x1c, 0x31, 0xb1,
                   0x30, 0x8d, 0xc9, 0x38, 0x8b, 0x34, 0x3,  0x3e, 0xef, 0x1e, 0xee, 0xe5, 0x74, 0xe1,
                   0xc6, 0x7c, 0xc2, 0x57, 0xba, 0x5d, 0xc8, 0xf4, 0x7c, 0xab, 0x10, 0xa3, 0xc1};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x4d, 0x71, 0xea, 0x92, 0xef, 0x96, 0x57, 0x1c, 0x31, 0xb1};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x30, 0x8d, 0xc9, 0x38, 0x8b, 0x34, 0x3,  0x3e, 0xef, 0x1e, 0xee, 0xe5, 0x74, 0xe1,
                         0xc6, 0x7c, 0xc2, 0x57, 0xba, 0x5d, 0xc8, 0xf4, 0x7c, 0xab, 0x10, 0xa3, 0xc1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "h\155\209\SYNBX\251\201\213\188",
// _pubPktID = 12728, _pubBody = "\SI\140\187\174(F\161\145", _pubProps = []}
TEST(Publish311QCTest, Encode69) {
  uint8_t pkt[] = {0x3a, 0x16, 0x0,  0xa,  0x68, 0x9b, 0xd1, 0x16, 0x42, 0x58, 0xfb, 0xc9,
                   0xd5, 0xbc, 0x31, 0xb8, 0xf,  0x8c, 0xbb, 0xae, 0x28, 0x46, 0xa1, 0x91};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0x68, 0x9b, 0xd1, 0x16, 0x42, 0x58, 0xfb, 0xc9, 0xd5, 0xbc};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf, 0x8c, 0xbb, 0xae, 0x28, 0x46, 0xa1, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 12728, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "kH\169\156\ACK\a\235\&2Q\128\148\FS\135\142\FS]\168j\246\208", _pubPktID = 23840, _pubBody = "D\195\164", _pubProps
// = []}
TEST(Publish311QCTest, Encode70) {
  uint8_t pkt[] = {0x33, 0x1b, 0x0,  0x14, 0x6b, 0x48, 0xa9, 0x9c, 0x6,  0x7,  0xeb, 0x32, 0x51, 0x80, 0x94,
                   0x1c, 0x87, 0x8e, 0x1c, 0x5d, 0xa8, 0x6a, 0xf6, 0xd0, 0x5d, 0x20, 0x44, 0xc3, 0xa4};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0x6b, 0x48, 0xa9, 0x9c, 0x6,  0x7,  0xeb, 0x32, 0x51, 0x80,
                           0x94, 0x1c, 0x87, 0x8e, 0x1c, 0x5d, 0xa8, 0x6a, 0xf6, 0xd0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x44, 0xc3, 0xa4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 23840, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "P\147\149\202g\200\140\&8\251",
// _pubPktID = 0, _pubBody = "\161k\226l\198m\147.\232\136\&3>\222>\138\225{\176s\227!\217C\RS\209_", _pubProps = []}
TEST(Publish311QCTest, Encode71) {
  uint8_t pkt[] = {0x31, 0x25, 0x0,  0x9,  0x50, 0x93, 0x95, 0xca, 0x67, 0xc8, 0x8c, 0x38, 0xfb,
                   0xa1, 0x6b, 0xe2, 0x6c, 0xc6, 0x6d, 0x93, 0x2e, 0xe8, 0x88, 0x33, 0x3e, 0xde,
                   0x3e, 0x8a, 0xe1, 0x7b, 0xb0, 0x73, 0xe3, 0x21, 0xd9, 0x43, 0x1e, 0xd1, 0x5f};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0x50, 0x93, 0x95, 0xca, 0x67, 0xc8, 0x8c, 0x38, 0xfb};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa1, 0x6b, 0xe2, 0x6c, 0xc6, 0x6d, 0x93, 0x2e, 0xe8, 0x88, 0x33, 0x3e, 0xde,
                         0x3e, 0x8a, 0xe1, 0x7b, 0xb0, 0x73, 0xe3, 0x21, 0xd9, 0x43, 0x1e, 0xd1, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\251\215\CAN[sS\SO<n\CAN2\177G\ACK\183\153\199\222\140`c\178@\151", _pubPktID = 0, _pubBody =
// "\165\168\138O\228N9et\191\199,\DEL\244$P\196\ACK\233rc", _pubProps = []}
TEST(Publish311QCTest, Encode72) {
  uint8_t pkt[] = {0x30, 0x2f, 0x0,  0x18, 0xfb, 0xd7, 0x18, 0x5b, 0x73, 0x53, 0xe,  0x3c, 0x6e, 0x18, 0x32, 0xb1, 0x47,
                   0x6,  0xb7, 0x99, 0xc7, 0xde, 0x8c, 0x60, 0x63, 0xb2, 0x40, 0x97, 0xa5, 0xa8, 0x8a, 0x4f, 0xe4, 0x4e,
                   0x39, 0x65, 0x74, 0xbf, 0xc7, 0x2c, 0x7f, 0xf4, 0x24, 0x50, 0xc4, 0x6,  0xe9, 0x72, 0x63};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0xfb, 0xd7, 0x18, 0x5b, 0x73, 0x53, 0xe,  0x3c, 0x6e, 0x18, 0x32, 0xb1,
                           0x47, 0x6,  0xb7, 0x99, 0xc7, 0xde, 0x8c, 0x60, 0x63, 0xb2, 0x40, 0x97};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0xa8, 0x8a, 0x4f, 0xe4, 0x4e, 0x39, 0x65, 0x74, 0xbf, 0xc7,
                         0x2c, 0x7f, 0xf4, 0x24, 0x50, 0xc4, 0x6,  0xe9, 0x72, 0x63};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29047, _pubBody =
// "l-\198\144%\200:}\215\167\168\213&!\132`\221\FSl\\\157?@-\132&\136", _pubProps = []}
TEST(Publish311QCTest, Encode73) {
  uint8_t pkt[] = {0x3c, 0x1f, 0x0,  0x0,  0x71, 0x77, 0x6c, 0x2d, 0xc6, 0x90, 0x25, 0xc8, 0x3a, 0x7d, 0xd7, 0xa7, 0xa8,
                   0xd5, 0x26, 0x21, 0x84, 0x60, 0xdd, 0x1c, 0x6c, 0x5c, 0x9d, 0x3f, 0x40, 0x2d, 0x84, 0x26, 0x88};

  uint8_t buf[43] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6c, 0x2d, 0xc6, 0x90, 0x25, 0xc8, 0x3a, 0x7d, 0xd7, 0xa7, 0xa8, 0xd5, 0x26, 0x21,
                         0x84, 0x60, 0xdd, 0x1c, 0x6c, 0x5c, 0x9d, 0x3f, 0x40, 0x2d, 0x84, 0x26, 0x88};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29047, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E\209", _pubPktID = 7404, _pubBody
// = "\235\ETX\185\192\212\183\ACK\\+\188\165\230>\\U", _pubProps = []}
TEST(Publish311QCTest, Encode74) {
  uint8_t pkt[] = {0x32, 0x15, 0x0, 0x2,  0x45, 0xd1, 0x1c, 0xec, 0xeb, 0x3,  0xb9, 0xc0,
                   0xd4, 0xb7, 0x6, 0x5c, 0x2b, 0xbc, 0xa5, 0xe6, 0x3e, 0x5c, 0x55};

  uint8_t buf[33] = {0};

  uint8_t topic_bytes[] = {0x45, 0xd1};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xeb, 0x3, 0xb9, 0xc0, 0xd4, 0xb7, 0x6, 0x5c, 0x2b, 0xbc, 0xa5, 0xe6, 0x3e, 0x5c, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7404, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\198\225\DC4\245\&5\248\178f[\186\216.\218\247", _pubPktID = 16102, _pubBody = "\213@o\181\227\224\214\214UA",
// _pubProps = []}
TEST(Publish311QCTest, Encode75) {
  uint8_t pkt[] = {0x32, 0x1c, 0x0,  0xe,  0xc6, 0xe1, 0x14, 0xf5, 0x35, 0xf8, 0xb2, 0x66, 0x5b, 0xba, 0xd8,
                   0x2e, 0xda, 0xf7, 0x3e, 0xe6, 0xd5, 0x40, 0x6f, 0xb5, 0xe3, 0xe0, 0xd6, 0xd6, 0x55, 0x41};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0xc6, 0xe1, 0x14, 0xf5, 0x35, 0xf8, 0xb2, 0x66, 0x5b, 0xba, 0xd8, 0x2e, 0xda, 0xf7};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd5, 0x40, 0x6f, 0xb5, 0xe3, 0xe0, 0xd6, 0xd6, 0x55, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16102, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 19098, _pubBody =
// "\216\241'G\183\&2\SO\NAK\254\130\&1\161\176A=\131x\SUB\190", _pubProps = []}
TEST(Publish311QCTest, Encode76) {
  uint8_t pkt[] = {0x3b, 0x17, 0x0,  0x0,  0x4a, 0x9a, 0xd8, 0xf1, 0x27, 0x47, 0xb7, 0x32, 0xe,
                   0x15, 0xfe, 0x82, 0x31, 0xa1, 0xb0, 0x41, 0x3d, 0x83, 0x78, 0x1a, 0xbe};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0xf1, 0x27, 0x47, 0xb7, 0x32, 0xe,  0x15, 0xfe, 0x82,
                         0x31, 0xa1, 0xb0, 0x41, 0x3d, 0x83, 0x78, 0x1a, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 19098, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "'\243\208\&5\245\172=e^\165",
// _pubPktID = 6458, _pubBody = "\222#/ q\128\&4\174k'\135\SI:O\193\DC4\153[", _pubProps = []}
TEST(Publish311QCTest, Encode77) {
  uint8_t pkt[] = {0x33, 0x20, 0x0,  0xa,  0x27, 0xf3, 0xd0, 0x35, 0xf5, 0xac, 0x3d, 0x65,
                   0x5e, 0xa5, 0x19, 0x3a, 0xde, 0x23, 0x2f, 0x20, 0x71, 0x80, 0x34, 0xae,
                   0x6b, 0x27, 0x87, 0xf,  0x3a, 0x4f, 0xc1, 0x14, 0x99, 0x5b};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0x27, 0xf3, 0xd0, 0x35, 0xf5, 0xac, 0x3d, 0x65, 0x5e, 0xa5};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xde, 0x23, 0x2f, 0x20, 0x71, 0x80, 0x34, 0xae, 0x6b,
                         0x27, 0x87, 0xf,  0x3a, 0x4f, 0xc1, 0x14, 0x99, 0x5b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 6458, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "I\168PH\213\245]<\203\142\255\147\"\251", _pubPktID = 23705, _pubBody =
// "\136\177\214\217\&8;\253\STX\147\206\151\161\183?\r\SUB\151\230c\DLE5h\249\177\236", _pubProps = []}
TEST(Publish311QCTest, Encode78) {
  uint8_t pkt[] = {0x33, 0x2b, 0x0,  0xe,  0x49, 0xa8, 0x50, 0x48, 0xd5, 0xf5, 0x5d, 0x3c, 0xcb, 0x8e, 0xff,
                   0x93, 0x22, 0xfb, 0x5c, 0x99, 0x88, 0xb1, 0xd6, 0xd9, 0x38, 0x3b, 0xfd, 0x2,  0x93, 0xce,
                   0x97, 0xa1, 0xb7, 0x3f, 0xd,  0x1a, 0x97, 0xe6, 0x63, 0x10, 0x35, 0x68, 0xf9, 0xb1, 0xec};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0x49, 0xa8, 0x50, 0x48, 0xd5, 0xf5, 0x5d, 0x3c, 0xcb, 0x8e, 0xff, 0x93, 0x22, 0xfb};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x88, 0xb1, 0xd6, 0xd9, 0x38, 0x3b, 0xfd, 0x2,  0x93, 0xce, 0x97, 0xa1, 0xb7,
                         0x3f, 0xd,  0x1a, 0x97, 0xe6, 0x63, 0x10, 0x35, 0x68, 0xf9, 0xb1, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 23705, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(cp\130q\251\181\SUB\133\251\228jBh\139\191\SOH\192\213\219Q1", _pubPktID = 14770, _pubBody =
// "\155j|4h\141\198\RS\162\240\168]\208C", _pubProps = []}
TEST(Publish311QCTest, Encode79) {
  uint8_t pkt[] = {0x3a, 0x28, 0x0,  0x16, 0x28, 0x63, 0x70, 0x82, 0x71, 0xfb, 0xb5, 0x1a, 0x85, 0xfb,
                   0xe4, 0x6a, 0x42, 0x68, 0x8b, 0xbf, 0x1,  0xc0, 0xd5, 0xdb, 0x51, 0x31, 0x39, 0xb2,
                   0x9b, 0x6a, 0x7c, 0x34, 0x68, 0x8d, 0xc6, 0x1e, 0xa2, 0xf0, 0xa8, 0x5d, 0xd0, 0x43};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0x28, 0x63, 0x70, 0x82, 0x71, 0xfb, 0xb5, 0x1a, 0x85, 0xfb, 0xe4,
                           0x6a, 0x42, 0x68, 0x8b, 0xbf, 0x1,  0xc0, 0xd5, 0xdb, 0x51, 0x31};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9b, 0x6a, 0x7c, 0x34, 0x68, 0x8d, 0xc6, 0x1e, 0xa2, 0xf0, 0xa8, 0x5d, 0xd0, 0x43};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 14770, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "4\USH\SYN\210z\160\141\155\238\230\171\a\233\243\192t", _pubPktID = 24524, _pubBody =
// "%\173_\207\173p\210\131\129\ESC\231\SOH\143\255\163\&4\182?LS", _pubProps = []}
TEST(Publish311QCTest, Encode80) {
  uint8_t pkt[] = {0x3a, 0x29, 0x0,  0x11, 0x34, 0x1f, 0x48, 0x16, 0xd2, 0x7a, 0xa0, 0x8d, 0x9b, 0xee, 0xe6,
                   0xab, 0x7,  0xe9, 0xf3, 0xc0, 0x74, 0x5f, 0xcc, 0x25, 0xad, 0x5f, 0xcf, 0xad, 0x70, 0xd2,
                   0x83, 0x81, 0x1b, 0xe7, 0x1,  0x8f, 0xff, 0xa3, 0x34, 0xb6, 0x3f, 0x4c, 0x53};

  uint8_t buf[53] = {0};

  uint8_t topic_bytes[] = {0x34, 0x1f, 0x48, 0x16, 0xd2, 0x7a, 0xa0, 0x8d, 0x9b,
                           0xee, 0xe6, 0xab, 0x7,  0xe9, 0xf3, 0xc0, 0x74};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0xad, 0x5f, 0xcf, 0xad, 0x70, 0xd2, 0x83, 0x81, 0x1b,
                         0xe7, 0x1,  0x8f, 0xff, 0xa3, 0x34, 0xb6, 0x3f, 0x4c, 0x53};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 24524, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\214u\192\231\177\&7\SYN\253\141i\217\&0\158", _pubPktID = 0, _pubBody =
// "\169\SI\241H\190p\151Qw\209\217/\163\156\&5", _pubProps = []}
TEST(Publish311QCTest, Encode81) {
  uint8_t pkt[] = {0x39, 0x1e, 0x0, 0xd,  0xd6, 0x75, 0xc0, 0xe7, 0xb1, 0x37, 0x16, 0xfd, 0x8d, 0x69, 0xd9, 0x30,
                   0x9e, 0xa9, 0xf, 0xf1, 0x48, 0xbe, 0x70, 0x97, 0x51, 0x77, 0xd1, 0xd9, 0x2f, 0xa3, 0x9c, 0x35};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0xd6, 0x75, 0xc0, 0xe7, 0xb1, 0x37, 0x16, 0xfd, 0x8d, 0x69, 0xd9, 0x30, 0x9e};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xf, 0xf1, 0x48, 0xbe, 0x70, 0x97, 0x51, 0x77, 0xd1, 0xd9, 0x2f, 0xa3, 0x9c, 0x35};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NUL%\184|4\245A", _pubPktID = 9669,
// _pubBody = "\170\148\223\170\SOH\189\188m;\173\149\203\NUL_B\STX\209\128\FSH\211\202R*$\DC4\t\241J", _pubProps = []}
TEST(Publish311QCTest, Encode82) {
  uint8_t pkt[] = {0x3a, 0x28, 0x0,  0x7,  0x0,  0x25, 0xb8, 0x7c, 0x34, 0xf5, 0x41, 0x25, 0xc5, 0xaa,
                   0x94, 0xdf, 0xaa, 0x1,  0xbd, 0xbc, 0x6d, 0x3b, 0xad, 0x95, 0xcb, 0x0,  0x5f, 0x42,
                   0x2,  0xd1, 0x80, 0x1c, 0x48, 0xd3, 0xca, 0x52, 0x2a, 0x24, 0x14, 0x9,  0xf1, 0x4a};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0x0, 0x25, 0xb8, 0x7c, 0x34, 0xf5, 0x41};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xaa, 0x94, 0xdf, 0xaa, 0x1,  0xbd, 0xbc, 0x6d, 0x3b, 0xad, 0x95, 0xcb, 0x0,  0x5f, 0x42,
                         0x2,  0xd1, 0x80, 0x1c, 0x48, 0xd3, 0xca, 0x52, 0x2a, 0x24, 0x14, 0x9,  0xf1, 0x4a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 9669, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "
// o\209~\209\242\176\161LlEV\DC1\133\143\237'Y6\212\133H\a\241\&0a", _pubPktID = 1466, _pubBody =
// "0\192\223\GS\205\153\241>N\167\&8l\DC4\151x\170\229\FS\DC3s\128\135\222", _pubProps = []}
TEST(Publish311QCTest, Encode83) {
  uint8_t pkt[] = {0x33, 0x35, 0x0,  0x1a, 0x20, 0x6f, 0xd1, 0x7e, 0xd1, 0xf2, 0xb0, 0xa1, 0x4c, 0x6c,
                   0x45, 0x56, 0x11, 0x85, 0x8f, 0xed, 0x27, 0x59, 0x36, 0xd4, 0x85, 0x48, 0x7,  0xf1,
                   0x30, 0x61, 0x5,  0xba, 0x30, 0xc0, 0xdf, 0x1d, 0xcd, 0x99, 0xf1, 0x3e, 0x4e, 0xa7,
                   0x38, 0x6c, 0x14, 0x97, 0x78, 0xaa, 0xe5, 0x1c, 0x13, 0x73, 0x80, 0x87, 0xde};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0x20, 0x6f, 0xd1, 0x7e, 0xd1, 0xf2, 0xb0, 0xa1, 0x4c, 0x6c, 0x45, 0x56, 0x11,
                           0x85, 0x8f, 0xed, 0x27, 0x59, 0x36, 0xd4, 0x85, 0x48, 0x7,  0xf1, 0x30, 0x61};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x30, 0xc0, 0xdf, 0x1d, 0xcd, 0x99, 0xf1, 0x3e, 0x4e, 0xa7, 0x38, 0x6c,
                         0x14, 0x97, 0x78, 0xaa, 0xe5, 0x1c, 0x13, 0x73, 0x80, 0x87, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 1466, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\201%\197.\f\247\DC3\198kM\237D\184\RS\ENQ<\183\215\RS\217\200", _pubPktID = 0, _pubBody = ">@1E\209$\188\249zd",
// _pubProps = []}
TEST(Publish311QCTest, Encode84) {
  uint8_t pkt[] = {0x30, 0x21, 0x0,  0x15, 0xc9, 0x25, 0xc5, 0x2e, 0xc,  0xf7, 0x13, 0xc6,
                   0x6b, 0x4d, 0xed, 0x44, 0xb8, 0x1e, 0x5,  0x3c, 0xb7, 0xd7, 0x1e, 0xd9,
                   0xc8, 0x3e, 0x40, 0x31, 0x45, 0xd1, 0x24, 0xbc, 0xf9, 0x7a, 0x64};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0xc9, 0x25, 0xc5, 0x2e, 0xc,  0xf7, 0x13, 0xc6, 0x6b, 0x4d, 0xed,
                           0x44, 0xb8, 0x1e, 0x5,  0x3c, 0xb7, 0xd7, 0x1e, 0xd9, 0xc8};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3e, 0x40, 0x31, 0x45, 0xd1, 0x24, 0xbc, 0xf9, 0x7a, 0x64};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\ACK\180\\\144\214%\183\192\168\129",
// _pubPktID = 5193, _pubBody = "\SOH\135\136&\\\133\174\132\244\244\"", _pubProps = []}
TEST(Publish311QCTest, Encode85) {
  uint8_t pkt[] = {0x3b, 0x19, 0x0, 0xa,  0x6,  0xb4, 0x5c, 0x90, 0xd6, 0x25, 0xb7, 0xc0, 0xa8, 0x81,
                   0x14, 0x49, 0x1, 0x87, 0x88, 0x26, 0x5c, 0x85, 0xae, 0x84, 0xf4, 0xf4, 0x22};

  uint8_t buf[37] = {0};

  uint8_t topic_bytes[] = {0x6, 0xb4, 0x5c, 0x90, 0xd6, 0x25, 0xb7, 0xc0, 0xa8, 0x81};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x87, 0x88, 0x26, 0x5c, 0x85, 0xae, 0x84, 0xf4, 0xf4, 0x22};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5193, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\235c\197\&9\FS\179\195b6\STX\195n\216\&3\213\vpu\137v\147o\200\233", _pubPktID = 40, _pubBody =
// "\150\169\128N}\US\133\146\160\ENQ\253N\247", _pubProps = []}
TEST(Publish311QCTest, Encode86) {
  uint8_t pkt[] = {0x35, 0x29, 0x0,  0x18, 0xeb, 0x63, 0xc5, 0x39, 0x1c, 0xb3, 0xc3, 0x62, 0x36, 0x2, 0xc3,
                   0x6e, 0xd8, 0x33, 0xd5, 0xb,  0x70, 0x75, 0x89, 0x76, 0x93, 0x6f, 0xc8, 0xe9, 0x0, 0x28,
                   0x96, 0xa9, 0x80, 0x4e, 0x7d, 0x1f, 0x85, 0x92, 0xa0, 0x5,  0xfd, 0x4e, 0xf7};

  uint8_t buf[53] = {0};

  uint8_t topic_bytes[] = {0xeb, 0x63, 0xc5, 0x39, 0x1c, 0xb3, 0xc3, 0x62, 0x36, 0x2,  0xc3, 0x6e,
                           0xd8, 0x33, 0xd5, 0xb,  0x70, 0x75, 0x89, 0x76, 0x93, 0x6f, 0xc8, 0xe9};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x96, 0xa9, 0x80, 0x4e, 0x7d, 0x1f, 0x85, 0x92, 0xa0, 0x5, 0xfd, 0x4e, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 40, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\SIM;=\ETX\220\ETX\214o\159\228\157\195\144\184+\216gpE\208\DC3\228\211\238W\212\&2", _pubPktID = 0, _pubBody =
// "\ETX\175\STXN\144\216\212\205c\184|\142\&5i", _pubProps = []}
TEST(Publish311QCTest, Encode87) {
  uint8_t pkt[] = {0x31, 0x2c, 0x0,  0x1c, 0xf,  0x4d, 0x3b, 0x3d, 0x3,  0xdc, 0x3,  0xd6, 0x6f, 0x9f, 0xe4, 0x9d,
                   0xc3, 0x90, 0xb8, 0x2b, 0xd8, 0x67, 0x70, 0x45, 0xd0, 0x13, 0xe4, 0xd3, 0xee, 0x57, 0xd4, 0x32,
                   0x3,  0xaf, 0x2,  0x4e, 0x90, 0xd8, 0xd4, 0xcd, 0x63, 0xb8, 0x7c, 0x8e, 0x35, 0x69};

  uint8_t buf[56] = {0};

  uint8_t topic_bytes[] = {0xf,  0x4d, 0x3b, 0x3d, 0x3,  0xdc, 0x3,  0xd6, 0x6f, 0x9f, 0xe4, 0x9d, 0xc3, 0x90,
                           0xb8, 0x2b, 0xd8, 0x67, 0x70, 0x45, 0xd0, 0x13, 0xe4, 0xd3, 0xee, 0x57, 0xd4, 0x32};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3, 0xaf, 0x2, 0x4e, 0x90, 0xd8, 0xd4, 0xcd, 0x63, 0xb8, 0x7c, 0x8e, 0x35, 0x69};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "p\185X\177s\138d\DLE.", _pubPktID =
// 29654, _pubBody = "\195o\ndF\GS\152\131\191\195;\253\248+\187y\251\129 4\244\145", _pubProps = []}
TEST(Publish311QCTest, Encode88) {
  uint8_t pkt[] = {0x3c, 0x23, 0x0,  0x9,  0x70, 0xb9, 0x58, 0xb1, 0x73, 0x8a, 0x64, 0x10, 0x2e,
                   0x73, 0xd6, 0xc3, 0x6f, 0xa,  0x64, 0x46, 0x1d, 0x98, 0x83, 0xbf, 0xc3, 0x3b,
                   0xfd, 0xf8, 0x2b, 0xbb, 0x79, 0xfb, 0x81, 0x20, 0x34, 0xf4, 0x91};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0x70, 0xb9, 0x58, 0xb1, 0x73, 0x8a, 0x64, 0x10, 0x2e};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc3, 0x6f, 0xa,  0x64, 0x46, 0x1d, 0x98, 0x83, 0xbf, 0xc3, 0x3b,
                         0xfd, 0xf8, 0x2b, 0xbb, 0x79, 0xfb, 0x81, 0x20, 0x34, 0xf4, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29654, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\238\SYN\GSq4\148\154&", _pubPktID
// = 4746, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode89) {
  uint8_t pkt[] = {0x32, 0xc, 0x0, 0x8, 0xee, 0x16, 0x1d, 0x71, 0x34, 0x94, 0x9a, 0x26, 0x12, 0x8a};

  uint8_t buf[24] = {0};

  uint8_t topic_bytes[] = {0xee, 0x16, 0x1d, 0x71, 0x34, 0x94, 0x9a, 0x26};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 4746, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(\217\244\EOT\224\136\232\225\248Q\237\240\138\187\152\v<\194\216B\158\SYN\158\203t\205", _pubPktID = 13686,
// _pubBody = "g\t?\199\SOHX\128\158_", _pubProps = []}
TEST(Publish311QCTest, Encode90) {
  uint8_t pkt[] = {0x32, 0x27, 0x0,  0x1a, 0x28, 0xd9, 0xf4, 0x4,  0xe0, 0x88, 0xe8, 0xe1, 0xf8, 0x51,
                   0xed, 0xf0, 0x8a, 0xbb, 0x98, 0xb,  0x3c, 0xc2, 0xd8, 0x42, 0x9e, 0x16, 0x9e, 0xcb,
                   0x74, 0xcd, 0x35, 0x76, 0x67, 0x9,  0x3f, 0xc7, 0x1,  0x58, 0x80, 0x9e, 0x5f};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x28, 0xd9, 0xf4, 0x4,  0xe0, 0x88, 0xe8, 0xe1, 0xf8, 0x51, 0xed, 0xf0, 0x8a,
                           0xbb, 0x98, 0xb,  0x3c, 0xc2, 0xd8, 0x42, 0x9e, 0x16, 0x9e, 0xcb, 0x74, 0xcd};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x67, 0x9, 0x3f, 0xc7, 0x1, 0x58, 0x80, 0x9e, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 13686, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "FL\240\156\182\192\&3\212\166\234!\162i#\233\190}'N\176", _pubPktID = 7951, _pubBody =
// "\246\168g\152\239\&8\214\227\217R=w3\173\155\210Y\155@", _pubProps = []}
TEST(Publish311QCTest, Encode91) {
  uint8_t pkt[] = {0x3c, 0x2b, 0x0,  0x14, 0x46, 0x4c, 0xf0, 0x9c, 0xb6, 0xc0, 0x33, 0xd4, 0xa6, 0xea, 0x21,
                   0xa2, 0x69, 0x23, 0xe9, 0xbe, 0x7d, 0x27, 0x4e, 0xb0, 0x1f, 0xf,  0xf6, 0xa8, 0x67, 0x98,
                   0xef, 0x38, 0xd6, 0xe3, 0xd9, 0x52, 0x3d, 0x77, 0x33, 0xad, 0x9b, 0xd2, 0x59, 0x9b, 0x40};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0x46, 0x4c, 0xf0, 0x9c, 0xb6, 0xc0, 0x33, 0xd4, 0xa6, 0xea,
                           0x21, 0xa2, 0x69, 0x23, 0xe9, 0xbe, 0x7d, 0x27, 0x4e, 0xb0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf6, 0xa8, 0x67, 0x98, 0xef, 0x38, 0xd6, 0xe3, 0xd9, 0x52,
                         0x3d, 0x77, 0x33, 0xad, 0x9b, 0xd2, 0x59, 0x9b, 0x40};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\232\175\EOT\145\DEL\254\166\230\212MM\131\&6R\177A\217", _pubPktID = 26125, _pubBody = "\229\&1", _pubProps = []}
TEST(Publish311QCTest, Encode92) {
  uint8_t pkt[] = {0x35, 0x17, 0x0,  0x11, 0xe8, 0xaf, 0x4,  0x91, 0x7f, 0xfe, 0xa6, 0xe6, 0xd4,
                   0x4d, 0x4d, 0x83, 0x36, 0x52, 0xb1, 0x41, 0xd9, 0x66, 0xd,  0xe5, 0x31};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0xe8, 0xaf, 0x4,  0x91, 0x7f, 0xfe, 0xa6, 0xe6, 0xd4,
                           0x4d, 0x4d, 0x83, 0x36, 0x52, 0xb1, 0x41, 0xd9};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe5, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 26125, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\249\223\224\153M\215\191\241/z\197=\210\196\197T-", _pubPktID = 4023, _pubBody = "\146G", _pubProps = []}
TEST(Publish311QCTest, Encode93) {
  uint8_t pkt[] = {0x32, 0x17, 0x0,  0x11, 0xf9, 0xdf, 0xe0, 0x99, 0x4d, 0xd7, 0xbf, 0xf1, 0x2f,
                   0x7a, 0xc5, 0x3d, 0xd2, 0xc4, 0xc5, 0x54, 0x2d, 0xf,  0xb7, 0x92, 0x47};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0xf9, 0xdf, 0xe0, 0x99, 0x4d, 0xd7, 0xbf, 0xf1, 0x2f,
                           0x7a, 0xc5, 0x3d, 0xd2, 0xc4, 0xc5, 0x54, 0x2d};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 4023, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "1\188?\134-\151\130\165\DC3\149\&0\188\151\r\192q\134Wi\255\238\204\193\225\205\231\164", _pubPktID = 3250, _pubBody
// = "\209\151\165\147\252]\131\r\145p\242\&6\155z\255", _pubProps = []}
TEST(Publish311QCTest, Encode94) {
  uint8_t pkt[] = {0x35, 0x2e, 0x0,  0x1b, 0x31, 0xbc, 0x3f, 0x86, 0x2d, 0x97, 0x82, 0xa5, 0x13, 0x95, 0x30, 0xbc,
                   0x97, 0xd,  0xc0, 0x71, 0x86, 0x57, 0x69, 0xff, 0xee, 0xcc, 0xc1, 0xe1, 0xcd, 0xe7, 0xa4, 0xc,
                   0xb2, 0xd1, 0x97, 0xa5, 0x93, 0xfc, 0x5d, 0x83, 0xd,  0x91, 0x70, 0xf2, 0x36, 0x9b, 0x7a, 0xff};

  uint8_t buf[58] = {0};

  uint8_t topic_bytes[] = {0x31, 0xbc, 0x3f, 0x86, 0x2d, 0x97, 0x82, 0xa5, 0x13, 0x95, 0x30, 0xbc, 0x97, 0xd,
                           0xc0, 0x71, 0x86, 0x57, 0x69, 0xff, 0xee, 0xcc, 0xc1, 0xe1, 0xcd, 0xe7, 0xa4};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd1, 0x97, 0xa5, 0x93, 0xfc, 0x5d, 0x83, 0xd, 0x91, 0x70, 0xf2, 0x36, 0x9b, 0x7a, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 3250, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\149y\148\SOH\133\136\STX\n\242",
// _pubPktID = 27162, _pubBody =
// "\163\212\196\ENQ\196\186w\152\RS\219\243>k~\167\130o^\157\\\197C\128\130\185\247\201\148C\197", _pubProps = []}
TEST(Publish311QCTest, Encode95) {
  uint8_t pkt[] = {0x3b, 0x2b, 0x0,  0x9,  0x95, 0x79, 0x94, 0x1,  0x85, 0x88, 0x2,  0xa,  0xf2, 0x6a, 0x1a,
                   0xa3, 0xd4, 0xc4, 0x5,  0xc4, 0xba, 0x77, 0x98, 0x1e, 0xdb, 0xf3, 0x3e, 0x6b, 0x7e, 0xa7,
                   0x82, 0x6f, 0x5e, 0x9d, 0x5c, 0xc5, 0x43, 0x80, 0x82, 0xb9, 0xf7, 0xc9, 0x94, 0x43, 0xc5};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0x95, 0x79, 0x94, 0x1, 0x85, 0x88, 0x2, 0xa, 0xf2};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa3, 0xd4, 0xc4, 0x5,  0xc4, 0xba, 0x77, 0x98, 0x1e, 0xdb, 0xf3, 0x3e, 0x6b, 0x7e, 0xa7,
                         0x82, 0x6f, 0x5e, 0x9d, 0x5c, 0xc5, 0x43, 0x80, 0x82, 0xb9, 0xf7, 0xc9, 0x94, 0x43, 0xc5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 27162, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\133\236\215", _pubPktID = 29262,
// _pubBody = "\150|7\US\164%\USi\129\ACK\161\142\139\207", _pubProps = []}
TEST(Publish311QCTest, Encode96) {
  uint8_t pkt[] = {0x35, 0x15, 0x0,  0x3,  0x85, 0xec, 0xd7, 0x72, 0x4e, 0x96, 0x7c, 0x37,
                   0x1f, 0xa4, 0x25, 0x1f, 0x69, 0x81, 0x6,  0xa1, 0x8e, 0x8b, 0xcf};

  uint8_t buf[33] = {0};

  uint8_t topic_bytes[] = {0x85, 0xec, 0xd7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x96, 0x7c, 0x37, 0x1f, 0xa4, 0x25, 0x1f, 0x69, 0x81, 0x6, 0xa1, 0x8e, 0x8b, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29262, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "5b0\195\142R\129\205", _pubPktID =
// 25975, _pubBody = ":\135\203\145\&6\148\180\155\&28\243", _pubProps = []}
TEST(Publish311QCTest, Encode97) {
  uint8_t pkt[] = {0x33, 0x17, 0x0,  0x8,  0x35, 0x62, 0x30, 0xc3, 0x8e, 0x52, 0x81, 0xcd, 0x65,
                   0x77, 0x3a, 0x87, 0xcb, 0x91, 0x36, 0x94, 0xb4, 0x9b, 0x32, 0x38, 0xf3};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0x35, 0x62, 0x30, 0xc3, 0x8e, 0x52, 0x81, 0xcd};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3a, 0x87, 0xcb, 0x91, 0x36, 0x94, 0xb4, 0x9b, 0x32, 0x38, 0xf3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25975, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\213Jr\201\234\223\158\NULA\172F$x\203\226", _pubPktID = 5740, _pubBody =
// "\v\DC4\158\192\171F\249\ESC\192U\254\"\152\151", _pubProps = []}
TEST(Publish311QCTest, Encode98) {
  uint8_t pkt[] = {0x3b, 0x21, 0x0,  0xf,  0xd5, 0x4a, 0x72, 0xc9, 0xea, 0xdf, 0x9e, 0x0,
                   0x41, 0xac, 0x46, 0x24, 0x78, 0xcb, 0xe2, 0x16, 0x6c, 0xb,  0x14, 0x9e,
                   0xc0, 0xab, 0x46, 0xf9, 0x1b, 0xc0, 0x55, 0xfe, 0x22, 0x98, 0x97};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0xd5, 0x4a, 0x72, 0xc9, 0xea, 0xdf, 0x9e, 0x0, 0x41, 0xac, 0x46, 0x24, 0x78, 0xcb, 0xe2};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb, 0x14, 0x9e, 0xc0, 0xab, 0x46, 0xf9, 0x1b, 0xc0, 0x55, 0xfe, 0x22, 0x98, 0x97};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5740, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\t\CAN\145\171\148w\238,P\186\ETBHJo\217H\202\133\175\171.\147\134f\238\240X\231\137", _pubPktID = 1370, _pubBody =
// "`\241\GS\145\216\168\157\253JO\171\208j1]K\RSL<\242\&4", _pubProps = []}
TEST(Publish311QCTest, Encode99) {
  uint8_t pkt[] = {0x32, 0x36, 0x0,  0x1d, 0x9,  0x18, 0x91, 0xab, 0x94, 0x77, 0xee, 0x2c, 0x50, 0xba,
                   0x17, 0x48, 0x4a, 0x6f, 0xd9, 0x48, 0xca, 0x85, 0xaf, 0xab, 0x2e, 0x93, 0x86, 0x66,
                   0xee, 0xf0, 0x58, 0xe7, 0x89, 0x5,  0x5a, 0x60, 0xf1, 0x1d, 0x91, 0xd8, 0xa8, 0x9d,
                   0xfd, 0x4a, 0x4f, 0xab, 0xd0, 0x6a, 0x31, 0x5d, 0x4b, 0x1e, 0x4c, 0x3c, 0xf2, 0x34};

  uint8_t buf[66] = {0};

  uint8_t topic_bytes[] = {0x9,  0x18, 0x91, 0xab, 0x94, 0x77, 0xee, 0x2c, 0x50, 0xba, 0x17, 0x48, 0x4a, 0x6f, 0xd9,
                           0x48, 0xca, 0x85, 0xaf, 0xab, 0x2e, 0x93, 0x86, 0x66, 0xee, 0xf0, 0x58, 0xe7, 0x89};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x60, 0xf1, 0x1d, 0x91, 0xd8, 0xa8, 0x9d, 0xfd, 0x4a, 0x4f, 0xab,
                         0xd0, 0x6a, 0x31, 0x5d, 0x4b, 0x1e, 0x4c, 0x3c, 0xf2, 0x34};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 1370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164.\DC1\135\131x\231n\143\DC3\247\SYN\189D\158\166\166\171\143\129\137\215", _pubPktID = 27834, _pubBody =
// "e8`\SO\145\RS`\179\229\146", _pubProps = []}
TEST(Publish311QCTest, Encode100) {
  uint8_t pkt[] = {0x3b, 0x24, 0x0,  0x16, 0xa4, 0x2e, 0x11, 0x87, 0x83, 0x78, 0xe7, 0x6e, 0x8f,
                   0x13, 0xf7, 0x16, 0xbd, 0x44, 0x9e, 0xa6, 0xa6, 0xab, 0x8f, 0x81, 0x89, 0xd7,
                   0x6c, 0xba, 0x65, 0x38, 0x60, 0xe,  0x91, 0x1e, 0x60, 0xb3, 0xe5, 0x92};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0xa4, 0x2e, 0x11, 0x87, 0x83, 0x78, 0xe7, 0x6e, 0x8f, 0x13, 0xf7,
                           0x16, 0xbd, 0x44, 0x9e, 0xa6, 0xa6, 0xab, 0x8f, 0x81, 0x89, 0xd7};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x65, 0x38, 0x60, 0xe, 0x91, 0x1e, 0x60, 0xb3, 0xe5, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 27834, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\GS'O\GS\157L:\160!\232\238\251\210\SOH\149\247[\200\206V\228NIF", _pubPktID = 10712, _pubBody =
// "g\175\150\CANu\230<(Z\145\145 g\177\217P7\ENQ`V\167\212k\177\SUB.", _pubProps = [PropReasonString
// "\ACK\206\206\216\&0\SYN\150\147%\197;\149\141\"(\DC2>@\SI\237\215",PropServerReference
// "\153\168\222t9\240\&3\202.p\239\aF.\139i\168\221\251\"\227",PropMaximumPacketSize 27829,PropTopicAlias
// 4075,PropMessageExpiryInterval 10312,PropTopicAlias 19253,PropResponseTopic "\205\177B",PropReasonString
// "\SO\163L\178(\204\242\131\132R\213V*\175|\GS|\STX",PropTopicAlias 10427,PropSubscriptionIdentifierAvailable
// 197,PropRequestResponseInformation 111,PropServerReference
// "\142\226\140\189J\253\DC3p\220\&0F\157\170\142",PropTopicAlias 13732,PropRequestProblemInformation
// 181,PropReceiveMaximum 2850,PropMaximumQoS 66,PropWildcardSubscriptionAvailable 208,PropSharedSubscriptionAvailable
// 255]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x33, 0xb9, 0x1,  0x0,  0x18, 0x1d, 0x27, 0x4f, 0x1d, 0x9d, 0x4c, 0x3a, 0xa0, 0x21, 0xe8, 0xee, 0xfb, 0xd2, 0x1,
      0x95, 0xf7, 0x5b, 0xc8, 0xce, 0x56, 0xe4, 0x4e, 0x49, 0x46, 0x29, 0xd8, 0x81, 0x1,  0x1f, 0x0,  0x15, 0x6,  0xce,
      0xce, 0xd8, 0x30, 0x16, 0x96, 0x93, 0x25, 0xc5, 0x3b, 0x95, 0x8d, 0x22, 0x28, 0x12, 0x3e, 0x40, 0xf,  0xed, 0xd7,
      0x1c, 0x0,  0x15, 0x99, 0xa8, 0xde, 0x74, 0x39, 0xf0, 0x33, 0xca, 0x2e, 0x70, 0xef, 0x7,  0x46, 0x2e, 0x8b, 0x69,
      0xa8, 0xdd, 0xfb, 0x22, 0xe3, 0x27, 0x0,  0x0,  0x6c, 0xb5, 0x23, 0xf,  0xeb, 0x2,  0x0,  0x0,  0x28, 0x48, 0x23,
      0x4b, 0x35, 0x8,  0x0,  0x3,  0xcd, 0xb1, 0x42, 0x1f, 0x0,  0x12, 0xe,  0xa3, 0x4c, 0xb2, 0x28, 0xcc, 0xf2, 0x83,
      0x84, 0x52, 0xd5, 0x56, 0x2a, 0xaf, 0x7c, 0x1d, 0x7c, 0x2,  0x23, 0x28, 0xbb, 0x29, 0xc5, 0x19, 0x6f, 0x1c, 0x0,
      0xe,  0x8e, 0xe2, 0x8c, 0xbd, 0x4a, 0xfd, 0x13, 0x70, 0xdc, 0x30, 0x46, 0x9d, 0xaa, 0x8e, 0x23, 0x35, 0xa4, 0x17,
      0xb5, 0x21, 0xb,  0x22, 0x24, 0x42, 0x28, 0xd0, 0x2a, 0xff, 0x67, 0xaf, 0x96, 0x18, 0x75, 0xe6, 0x3c, 0x28, 0x5a,
      0x91, 0x91, 0x20, 0x67, 0xb1, 0xd9, 0x50, 0x37, 0x5,  0x60, 0x56, 0xa7, 0xd4, 0x6b, 0xb1, 0x1a, 0x2e};

  uint8_t buf[198] = {0};

  uint8_t topic_bytes[] = {0x1d, 0x27, 0x4f, 0x1d, 0x9d, 0x4c, 0x3a, 0xa0, 0x21, 0xe8, 0xee, 0xfb,
                           0xd2, 0x1,  0x95, 0xf7, 0x5b, 0xc8, 0xce, 0x56, 0xe4, 0x4e, 0x49, 0x46};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x67, 0xaf, 0x96, 0x18, 0x75, 0xe6, 0x3c, 0x28, 0x5a, 0x91, 0x91, 0x20, 0x67,
                         0xb1, 0xd9, 0x50, 0x37, 0x5,  0x60, 0x56, 0xa7, 0xd4, 0x6b, 0xb1, 0x1a, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x6,  0xce, 0xce, 0xd8, 0x30, 0x16, 0x96, 0x93, 0x25, 0xc5, 0x3b,
                           0x95, 0x8d, 0x22, 0x28, 0x12, 0x3e, 0x40, 0xf,  0xed, 0xd7};
  uint8_t bytesprops1[] = {0x99, 0xa8, 0xde, 0x74, 0x39, 0xf0, 0x33, 0xca, 0x2e, 0x70, 0xef,
                           0x7,  0x46, 0x2e, 0x8b, 0x69, 0xa8, 0xdd, 0xfb, 0x22, 0xe3};
  uint8_t bytesprops2[] = {0xcd, 0xb1, 0x42};
  uint8_t bytesprops3[] = {0xe,  0xa3, 0x4c, 0xb2, 0x28, 0xcc, 0xf2, 0x83, 0x84,
                           0x52, 0xd5, 0x56, 0x2a, 0xaf, 0x7c, 0x1d, 0x7c, 0x2};
  uint8_t bytesprops4[] = {0x8e, 0xe2, 0x8c, 0xbd, 0x4a, 0xfd, 0x13, 0x70, 0xdc, 0x30, 0x46, 0x9d, 0xaa, 0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27829}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4075}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10312}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19253}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10427}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13732}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2850}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 255}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10712, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "q\140\EOT\210\163\254Vg\160L\221g\182\231\149f3\239k\200\DC2", _pubPktID = 10731, _pubBody =
// "\229\183\252?\173\165\FS\181?\130", _pubProps = [PropMaximumPacketSize 8227,PropResponseInformation
// "\SUB\179\237\128+i\162P\210\239\&4.\CAN\200\157x",PropAssignedClientIdentifier
// "\ESC\144\133\137\148{\244\242_\166^\246M\156\151\213\170I\129\168\165\217\195\209",PropServerReference
// "G4z\SI\GS@\238U\FSqbh",PropResponseInformation "8\SI3]\CAN"]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0x6e, 0x0,  0x15, 0x71, 0x8c, 0x4,  0xd2, 0xa3, 0xfe, 0x56, 0x67, 0xa0, 0x4c, 0xdd, 0x67,
                   0xb6, 0xe7, 0x95, 0x66, 0x33, 0xef, 0x6b, 0xc8, 0x12, 0x29, 0xeb, 0x4a, 0x27, 0x0,  0x0,  0x20,
                   0x23, 0x1a, 0x0,  0x10, 0x1a, 0xb3, 0xed, 0x80, 0x2b, 0x69, 0xa2, 0x50, 0xd2, 0xef, 0x34, 0x2e,
                   0x18, 0xc8, 0x9d, 0x78, 0x12, 0x0,  0x18, 0x1b, 0x90, 0x85, 0x89, 0x94, 0x7b, 0xf4, 0xf2, 0x5f,
                   0xa6, 0x5e, 0xf6, 0x4d, 0x9c, 0x97, 0xd5, 0xaa, 0x49, 0x81, 0xa8, 0xa5, 0xd9, 0xc3, 0xd1, 0x1c,
                   0x0,  0xc,  0x47, 0x34, 0x7a, 0xf,  0x1d, 0x40, 0xee, 0x55, 0x1c, 0x71, 0x62, 0x68, 0x1a, 0x0,
                   0x5,  0x38, 0xf,  0x33, 0x5d, 0x18, 0xe5, 0xb7, 0xfc, 0x3f, 0xad, 0xa5, 0x1c, 0xb5, 0x3f, 0x82};

  uint8_t buf[122] = {0};

  uint8_t topic_bytes[] = {0x71, 0x8c, 0x4,  0xd2, 0xa3, 0xfe, 0x56, 0x67, 0xa0, 0x4c, 0xdd,
                           0x67, 0xb6, 0xe7, 0x95, 0x66, 0x33, 0xef, 0x6b, 0xc8, 0x12};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe5, 0xb7, 0xfc, 0x3f, 0xad, 0xa5, 0x1c, 0xb5, 0x3f, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x1a, 0xb3, 0xed, 0x80, 0x2b, 0x69, 0xa2, 0x50,
                           0xd2, 0xef, 0x34, 0x2e, 0x18, 0xc8, 0x9d, 0x78};
  uint8_t bytesprops1[] = {0x1b, 0x90, 0x85, 0x89, 0x94, 0x7b, 0xf4, 0xf2, 0x5f, 0xa6, 0x5e, 0xf6,
                           0x4d, 0x9c, 0x97, 0xd5, 0xaa, 0x49, 0x81, 0xa8, 0xa5, 0xd9, 0xc3, 0xd1};
  uint8_t bytesprops2[] = {0x47, 0x34, 0x7a, 0xf, 0x1d, 0x40, 0xee, 0x55, 0x1c, 0x71, 0x62, 0x68};
  uint8_t bytesprops3[] = {0x38, 0xf, 0x33, 0x5d, 0x18};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8227}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10731, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "I0\v\142\237", _pubPktID = 7560,
// _pubBody = "`\189\255\237\166\235-D\NAK", _pubProps = [PropSubscriptionIdentifier 18,PropRequestResponseInformation
// 149,PropTopicAlias 26028,PropServerKeepAlive 15158,PropResponseInformation
// "f\128\219\163\&6rQ",PropAuthenticationData "\203\ACK_\165\155\220\158\b\178o",PropContentType
// "\241\234\158\227\CANUWN\242\249L\228h\153\167+\129\&6/"]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0x4a, 0x0,  0x5,  0x49, 0x30, 0xb,  0x8e, 0xed, 0x1d, 0x88, 0x37, 0xb,  0x12, 0x19, 0x95,
                   0x23, 0x65, 0xac, 0x13, 0x3b, 0x36, 0x1a, 0x0,  0x7,  0x66, 0x80, 0xdb, 0xa3, 0x36, 0x72, 0x51,
                   0x16, 0x0,  0xa,  0xcb, 0x6,  0x5f, 0xa5, 0x9b, 0xdc, 0x9e, 0x8,  0xb2, 0x6f, 0x3,  0x0,  0x13,
                   0xf1, 0xea, 0x9e, 0xe3, 0x18, 0x55, 0x57, 0x4e, 0xf2, 0xf9, 0x4c, 0xe4, 0x68, 0x99, 0xa7, 0x2b,
                   0x81, 0x36, 0x2f, 0x60, 0xbd, 0xff, 0xed, 0xa6, 0xeb, 0x2d, 0x44, 0x15};

  uint8_t buf[86] = {0};

  uint8_t topic_bytes[] = {0x49, 0x30, 0xb, 0x8e, 0xed};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xbd, 0xff, 0xed, 0xa6, 0xeb, 0x2d, 0x44, 0x15};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x66, 0x80, 0xdb, 0xa3, 0x36, 0x72, 0x51};
  uint8_t bytesprops1[] = {0xcb, 0x6, 0x5f, 0xa5, 0x9b, 0xdc, 0x9e, 0x8, 0xb2, 0x6f};
  uint8_t bytesprops2[] = {0xf1, 0xea, 0x9e, 0xe3, 0x18, 0x55, 0x57, 0x4e, 0xf2, 0xf9,
                           0x4c, 0xe4, 0x68, 0x99, 0xa7, 0x2b, 0x81, 0x36, 0x2f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26028}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15158}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7560, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\214d)\246\152\n-f", _pubPktID =
// 27404, _pubBody = "\187\167\151\192YY\244\252\216W\216\180S\218A\187\255\140'\172dG\187", _pubProps =
// [PropSubscriptionIdentifierAvailable 99,PropPayloadFormatIndicator 40,PropTopicAliasMaximum
// 4746,PropSharedSubscriptionAvailable 89,PropServerReference
// "&\b\229+\163\&5\132\203\213J\bW\228\161",PropRequestResponseInformation 65,PropSharedSubscriptionAvailable
// 57,PropContentType
// "\148\136\244\ENQ\154\253\142*\231ac\179\CAN\135-X\213\DC4^\137v\240nL`\187\\.\159",PropWillDelayInterval
// 22673,PropServerReference "\167\163\166\RS\ESC\140h\197\243 F\169I\233\195\226$\ACK\189a",PropMaximumPacketSize
// 19749,PropServerReference
// "H\155\148\ETXS\DEL9\219_\203\128\DLEAV\180\184\160I+t\152#\209\SO\132\220\214\225k\213",PropMaximumPacketSize
// 19964,PropServerKeepAlive 772,PropAuthenticationData
// "\209\209f\208ds%\155T\181\173\148\221\179\205\191G\DLE\213\149\235\237",PropSharedSubscriptionAvailable
// 146,PropResponseInformation "en\DC2\141\SYN!\151\183\166\145,7\147",PropMaximumQoS 12,PropReasonString
// "\225}\172\212\US\153\150&\245\147\EOTL\178^\250sY#wo+\215_/\217\SOH",PropMessageExpiryInterval
// 6189,PropSubscriptionIdentifier 6,PropTopicAlias 16029,PropWillDelayInterval 5712,PropMessageExpiryInterval
// 11452,PropRequestResponseInformation 28,PropRequestResponseInformation 206,PropUserProperty
// "\NAKl\244\164\SOH\179\138S\US\167\\\239sVkE\151\&8P\203u\211\249\239" "",PropTopicAliasMaximum
// 25654,PropWillDelayInterval 28483]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x3b, 0xb4, 0x2,  0x0,  0x8,  0xd6, 0x64, 0x29, 0xf6, 0x98, 0xa,  0x2d, 0x66, 0x6b, 0xc,  0x8f, 0x2,  0x29, 0x63,
      0x1,  0x28, 0x22, 0x12, 0x8a, 0x2a, 0x59, 0x1c, 0x0,  0xe,  0x26, 0x8,  0xe5, 0x2b, 0xa3, 0x35, 0x84, 0xcb, 0xd5,
      0x4a, 0x8,  0x57, 0xe4, 0xa1, 0x19, 0x41, 0x2a, 0x39, 0x3,  0x0,  0x1d, 0x94, 0x88, 0xf4, 0x5,  0x9a, 0xfd, 0x8e,
      0x2a, 0xe7, 0x61, 0x63, 0xb3, 0x18, 0x87, 0x2d, 0x58, 0xd5, 0x14, 0x5e, 0x89, 0x76, 0xf0, 0x6e, 0x4c, 0x60, 0xbb,
      0x5c, 0x2e, 0x9f, 0x18, 0x0,  0x0,  0x58, 0x91, 0x1c, 0x0,  0x14, 0xa7, 0xa3, 0xa6, 0x1e, 0x1b, 0x8c, 0x68, 0xc5,
      0xf3, 0x20, 0x46, 0xa9, 0x49, 0xe9, 0xc3, 0xe2, 0x24, 0x6,  0xbd, 0x61, 0x27, 0x0,  0x0,  0x4d, 0x25, 0x1c, 0x0,
      0x1e, 0x48, 0x9b, 0x94, 0x3,  0x53, 0x7f, 0x39, 0xdb, 0x5f, 0xcb, 0x80, 0x10, 0x41, 0x56, 0xb4, 0xb8, 0xa0, 0x49,
      0x2b, 0x74, 0x98, 0x23, 0xd1, 0xe,  0x84, 0xdc, 0xd6, 0xe1, 0x6b, 0xd5, 0x27, 0x0,  0x0,  0x4d, 0xfc, 0x13, 0x3,
      0x4,  0x16, 0x0,  0x16, 0xd1, 0xd1, 0x66, 0xd0, 0x64, 0x73, 0x25, 0x9b, 0x54, 0xb5, 0xad, 0x94, 0xdd, 0xb3, 0xcd,
      0xbf, 0x47, 0x10, 0xd5, 0x95, 0xeb, 0xed, 0x2a, 0x92, 0x1a, 0x0,  0xd,  0x65, 0x6e, 0x12, 0x8d, 0x16, 0x21, 0x97,
      0xb7, 0xa6, 0x91, 0x2c, 0x37, 0x93, 0x24, 0xc,  0x1f, 0x0,  0x1a, 0xe1, 0x7d, 0xac, 0xd4, 0x1f, 0x99, 0x96, 0x26,
      0xf5, 0x93, 0x4,  0x4c, 0xb2, 0x5e, 0xfa, 0x73, 0x59, 0x23, 0x77, 0x6f, 0x2b, 0xd7, 0x5f, 0x2f, 0xd9, 0x1,  0x2,
      0x0,  0x0,  0x18, 0x2d, 0xb,  0x6,  0x23, 0x3e, 0x9d, 0x18, 0x0,  0x0,  0x16, 0x50, 0x2,  0x0,  0x0,  0x2c, 0xbc,
      0x19, 0x1c, 0x19, 0xce, 0x26, 0x0,  0x18, 0x15, 0x6c, 0xf4, 0xa4, 0x1,  0xb3, 0x8a, 0x53, 0x1f, 0xa7, 0x5c, 0xef,
      0x73, 0x56, 0x6b, 0x45, 0x97, 0x38, 0x50, 0xcb, 0x75, 0xd3, 0xf9, 0xef, 0x0,  0x0,  0x22, 0x64, 0x36, 0x18, 0x0,
      0x0,  0x6f, 0x43, 0xbb, 0xa7, 0x97, 0xc0, 0x59, 0x59, 0xf4, 0xfc, 0xd8, 0x57, 0xd8, 0xb4, 0x53, 0xda, 0x41, 0xbb,
      0xff, 0x8c, 0x27, 0xac, 0x64, 0x47, 0xbb};

  uint8_t buf[321] = {0};

  uint8_t topic_bytes[] = {0xd6, 0x64, 0x29, 0xf6, 0x98, 0xa, 0x2d, 0x66};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xa7, 0x97, 0xc0, 0x59, 0x59, 0xf4, 0xfc, 0xd8, 0x57, 0xd8, 0xb4,
                         0x53, 0xda, 0x41, 0xbb, 0xff, 0x8c, 0x27, 0xac, 0x64, 0x47, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x26, 0x8, 0xe5, 0x2b, 0xa3, 0x35, 0x84, 0xcb, 0xd5, 0x4a, 0x8, 0x57, 0xe4, 0xa1};
  uint8_t bytesprops1[] = {0x94, 0x88, 0xf4, 0x5,  0x9a, 0xfd, 0x8e, 0x2a, 0xe7, 0x61, 0x63, 0xb3, 0x18, 0x87, 0x2d,
                           0x58, 0xd5, 0x14, 0x5e, 0x89, 0x76, 0xf0, 0x6e, 0x4c, 0x60, 0xbb, 0x5c, 0x2e, 0x9f};
  uint8_t bytesprops2[] = {0xa7, 0xa3, 0xa6, 0x1e, 0x1b, 0x8c, 0x68, 0xc5, 0xf3, 0x20,
                           0x46, 0xa9, 0x49, 0xe9, 0xc3, 0xe2, 0x24, 0x6,  0xbd, 0x61};
  uint8_t bytesprops3[] = {0x48, 0x9b, 0x94, 0x3,  0x53, 0x7f, 0x39, 0xdb, 0x5f, 0xcb, 0x80, 0x10, 0x41, 0x56, 0xb4,
                           0xb8, 0xa0, 0x49, 0x2b, 0x74, 0x98, 0x23, 0xd1, 0xe,  0x84, 0xdc, 0xd6, 0xe1, 0x6b, 0xd5};
  uint8_t bytesprops4[] = {0xd1, 0xd1, 0x66, 0xd0, 0x64, 0x73, 0x25, 0x9b, 0x54, 0xb5, 0xad,
                           0x94, 0xdd, 0xb3, 0xcd, 0xbf, 0x47, 0x10, 0xd5, 0x95, 0xeb, 0xed};
  uint8_t bytesprops5[] = {0x65, 0x6e, 0x12, 0x8d, 0x16, 0x21, 0x97, 0xb7, 0xa6, 0x91, 0x2c, 0x37, 0x93};
  uint8_t bytesprops6[] = {0xe1, 0x7d, 0xac, 0xd4, 0x1f, 0x99, 0x96, 0x26, 0xf5, 0x93, 0x4,  0x4c, 0xb2,
                           0x5e, 0xfa, 0x73, 0x59, 0x23, 0x77, 0x6f, 0x2b, 0xd7, 0x5f, 0x2f, 0xd9, 0x1};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops7[] = {0x15, 0x6c, 0xf4, 0xa4, 0x1,  0xb3, 0x8a, 0x53, 0x1f, 0xa7, 0x5c, 0xef,
                           0x73, 0x56, 0x6b, 0x45, 0x97, 0x38, 0x50, 0xcb, 0x75, 0xd3, 0xf9, 0xef};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4746}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22673}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19749}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19964}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 772}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6189}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16029}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5712}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11452}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops7}, .v = {0, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25654}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28483}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 27404, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\243i\174@\215\136\140u\b,",
// _pubPktID = 0, _pubBody = "_\166K\178hd\ETX^Q", _pubProps = [PropTopicAliasMaximum 15843,PropSubscriptionIdentifier
// 31,PropWillDelayInterval 17605,PropPayloadFormatIndicator 133,PropReceiveMaximum 27638,PropRequestResponseInformation
// 74,PropResponseInformation
// "\238f\225\128\220h\182ACyl\154\206\186M\165\225\187\&1?\USW\201",PropAssignedClientIdentifier
// "\167\186/\DC3\196\a\193\249\226\SUB!\NUL\160\&8\ETX\DC4b\FS>&JL(\216\n\ETBZ\235",PropSubscriptionIdentifierAvailable
// 221,PropWillDelayInterval 32718,PropRequestResponseInformation 240,PropRequestResponseInformation
// 83,PropCorrelationData "\168\&6\\\239D\214\220;\245\FS\DC1\ETB-\DC3tE\184\214\161.e\181F\201",PropMaximumPacketSize
// 3242]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x38, 0x8b, 0x1,  0x0,  0xa,  0xf3, 0x69, 0xae, 0x40, 0xd7, 0x88, 0x8c, 0x75, 0x8,  0x2c, 0x75,
                   0x22, 0x3d, 0xe3, 0xb,  0x1f, 0x18, 0x0,  0x0,  0x44, 0xc5, 0x1,  0x85, 0x21, 0x6b, 0xf6, 0x19,
                   0x4a, 0x1a, 0x0,  0x17, 0xee, 0x66, 0xe1, 0x80, 0xdc, 0x68, 0xb6, 0x41, 0x43, 0x79, 0x6c, 0x9a,
                   0xce, 0xba, 0x4d, 0xa5, 0xe1, 0xbb, 0x31, 0x3f, 0x1f, 0x57, 0xc9, 0x12, 0x0,  0x1c, 0xa7, 0xba,
                   0x2f, 0x13, 0xc4, 0x7,  0xc1, 0xf9, 0xe2, 0x1a, 0x21, 0x0,  0xa0, 0x38, 0x3,  0x14, 0x62, 0x1c,
                   0x3e, 0x26, 0x4a, 0x4c, 0x28, 0xd8, 0xa,  0x17, 0x5a, 0xeb, 0x29, 0xdd, 0x18, 0x0,  0x0,  0x7f,
                   0xce, 0x19, 0xf0, 0x19, 0x53, 0x9,  0x0,  0x18, 0xa8, 0x36, 0x5c, 0xef, 0x44, 0xd6, 0xdc, 0x3b,
                   0xf5, 0x1c, 0x11, 0x17, 0x2d, 0x13, 0x74, 0x45, 0xb8, 0xd6, 0xa1, 0x2e, 0x65, 0xb5, 0x46, 0xc9,
                   0x27, 0x0,  0x0,  0xc,  0xaa, 0x5f, 0xa6, 0x4b, 0xb2, 0x68, 0x64, 0x3,  0x5e, 0x51};

  uint8_t buf[152] = {0};

  uint8_t topic_bytes[] = {0xf3, 0x69, 0xae, 0x40, 0xd7, 0x88, 0x8c, 0x75, 0x8, 0x2c};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5f, 0xa6, 0x4b, 0xb2, 0x68, 0x64, 0x3, 0x5e, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0xee, 0x66, 0xe1, 0x80, 0xdc, 0x68, 0xb6, 0x41, 0x43, 0x79, 0x6c, 0x9a,
                           0xce, 0xba, 0x4d, 0xa5, 0xe1, 0xbb, 0x31, 0x3f, 0x1f, 0x57, 0xc9};
  uint8_t bytesprops1[] = {0xa7, 0xba, 0x2f, 0x13, 0xc4, 0x7,  0xc1, 0xf9, 0xe2, 0x1a, 0x21, 0x0,  0xa0, 0x38,
                           0x3,  0x14, 0x62, 0x1c, 0x3e, 0x26, 0x4a, 0x4c, 0x28, 0xd8, 0xa,  0x17, 0x5a, 0xeb};
  uint8_t bytesprops2[] = {0xa8, 0x36, 0x5c, 0xef, 0x44, 0xd6, 0xdc, 0x3b, 0xf5, 0x1c, 0x11, 0x17,
                           0x2d, 0x13, 0x74, 0x45, 0xb8, 0xd6, 0xa1, 0x2e, 0x65, 0xb5, 0x46, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15843}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17605}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27638}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32718}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3242}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\n-yh\SO\210\US\ESC\254\242a",
// _pubPktID = 15060, _pubBody = "\DEL\SOH0>\190\215\246)N\183\&0R\194\153\164\140'6\243X", _pubProps =
// [PropSharedSubscriptionAvailable 195,PropMessageExpiryInterval 17613,PropWildcardSubscriptionAvailable
// 230,PropServerKeepAlive 23700,PropMessageExpiryInterval 25511,PropResponseTopic
// "\232\240e",PropRequestProblemInformation 220,PropResponseInformation
// "\178\215\172\193\&2^\185\240fz[\254\167\138+L\192\\\183",PropMessageExpiryInterval 5480,PropResponseTopic
// "M\190\249\239\234\134\&1j\188\159\r\ENQ\242\232\167\241\144\136D\155\239QM\245G",PropAuthenticationData "
// \242",PropRequestResponseInformation 206,PropAuthenticationData
// "9/\176\STX\253A\217\189\209\217\207\154\RS\228-\169\128\&39r\208",PropContentType
// "\227\NUL+X\248\129L\241\246\SYN\230\129pui*@:\ESCg\241$\f",PropWillDelayInterval
// 29400,PropRequestResponseInformation 197]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x3b, 0xb5, 0x1,  0x0,  0xb,  0xa,  0x2d, 0x79, 0x68, 0xe,  0xd2, 0x1f, 0x1b, 0xfe, 0xf2, 0x61, 0x3a,
                   0xd4, 0x90, 0x1,  0x2a, 0xc3, 0x2,  0x0,  0x0,  0x44, 0xcd, 0x28, 0xe6, 0x13, 0x5c, 0x94, 0x2,  0x0,
                   0x0,  0x63, 0xa7, 0x8,  0x0,  0x3,  0xe8, 0xf0, 0x65, 0x17, 0xdc, 0x1a, 0x0,  0x13, 0xb2, 0xd7, 0xac,
                   0xc1, 0x32, 0x5e, 0xb9, 0xf0, 0x66, 0x7a, 0x5b, 0xfe, 0xa7, 0x8a, 0x2b, 0x4c, 0xc0, 0x5c, 0xb7, 0x2,
                   0x0,  0x0,  0x15, 0x68, 0x8,  0x0,  0x19, 0x4d, 0xbe, 0xf9, 0xef, 0xea, 0x86, 0x31, 0x6a, 0xbc, 0x9f,
                   0xd,  0x5,  0xf2, 0xe8, 0xa7, 0xf1, 0x90, 0x88, 0x44, 0x9b, 0xef, 0x51, 0x4d, 0xf5, 0x47, 0x16, 0x0,
                   0x2,  0x20, 0xf2, 0x19, 0xce, 0x16, 0x0,  0x15, 0x39, 0x2f, 0xb0, 0x2,  0xfd, 0x41, 0xd9, 0xbd, 0xd1,
                   0xd9, 0xcf, 0x9a, 0x1e, 0xe4, 0x2d, 0xa9, 0x80, 0x33, 0x39, 0x72, 0xd0, 0x3,  0x0,  0x17, 0xe3, 0x0,
                   0x2b, 0x58, 0xf8, 0x81, 0x4c, 0xf1, 0xf6, 0x16, 0xe6, 0x81, 0x70, 0x75, 0x69, 0x2a, 0x40, 0x3a, 0x1b,
                   0x67, 0xf1, 0x24, 0xc,  0x18, 0x0,  0x0,  0x72, 0xd8, 0x19, 0xc5, 0x7f, 0x1,  0x30, 0x3e, 0xbe, 0xd7,
                   0xf6, 0x29, 0x4e, 0xb7, 0x30, 0x52, 0xc2, 0x99, 0xa4, 0x8c, 0x27, 0x36, 0xf3, 0x58};

  uint8_t buf[194] = {0};

  uint8_t topic_bytes[] = {0xa, 0x2d, 0x79, 0x68, 0xe, 0xd2, 0x1f, 0x1b, 0xfe, 0xf2, 0x61};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7f, 0x1,  0x30, 0x3e, 0xbe, 0xd7, 0xf6, 0x29, 0x4e, 0xb7,
                         0x30, 0x52, 0xc2, 0x99, 0xa4, 0x8c, 0x27, 0x36, 0xf3, 0x58};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0xe8, 0xf0, 0x65};
  uint8_t bytesprops1[] = {0xb2, 0xd7, 0xac, 0xc1, 0x32, 0x5e, 0xb9, 0xf0, 0x66, 0x7a,
                           0x5b, 0xfe, 0xa7, 0x8a, 0x2b, 0x4c, 0xc0, 0x5c, 0xb7};
  uint8_t bytesprops2[] = {0x4d, 0xbe, 0xf9, 0xef, 0xea, 0x86, 0x31, 0x6a, 0xbc, 0x9f, 0xd,  0x5, 0xf2,
                           0xe8, 0xa7, 0xf1, 0x90, 0x88, 0x44, 0x9b, 0xef, 0x51, 0x4d, 0xf5, 0x47};
  uint8_t bytesprops3[] = {0x20, 0xf2};
  uint8_t bytesprops4[] = {0x39, 0x2f, 0xb0, 0x2,  0xfd, 0x41, 0xd9, 0xbd, 0xd1, 0xd9, 0xcf,
                           0x9a, 0x1e, 0xe4, 0x2d, 0xa9, 0x80, 0x33, 0x39, 0x72, 0xd0};
  uint8_t bytesprops5[] = {0xe3, 0x0,  0x2b, 0x58, 0xf8, 0x81, 0x4c, 0xf1, 0xf6, 0x16, 0xe6, 0x81,
                           0x70, 0x75, 0x69, 0x2a, 0x40, 0x3a, 0x1b, 0x67, 0xf1, 0x24, 0xc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17613}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23700}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25511}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5480}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29400}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15060, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "5\132\234\246Z", _pubPktID = 0,
// _pubBody = "+", _pubProps = [PropResponseTopic
// "\n\201\DC2H\138\247\247\201\217\176&\DC4\211\240\198\206E\185",PropWillDelayInterval
// 30260,PropPayloadFormatIndicator 24,PropWillDelayInterval 12867,PropReceiveMaximum 28350,PropReceiveMaximum
// 7251,PropCorrelationData
// "\173\138\ACK\t\146\EOT{\167\SI\DC4\129\b\SOH\232\SO\"\254\184\210\199\SYN\238",PropSubscriptionIdentifierAvailable
// 191,PropRequestProblemInformation 31,PropRetainAvailable 118,PropContentType "\DEL\183",PropRetainAvailable 188]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x31, 0x56, 0x0,  0x5,  0x35, 0x84, 0xea, 0xf6, 0x5a, 0x4d, 0x8,  0x0,  0x12, 0xa,  0xc9,
                   0x12, 0x48, 0x8a, 0xf7, 0xf7, 0xc9, 0xd9, 0xb0, 0x26, 0x14, 0xd3, 0xf0, 0xc6, 0xce, 0x45,
                   0xb9, 0x18, 0x0,  0x0,  0x76, 0x34, 0x1,  0x18, 0x18, 0x0,  0x0,  0x32, 0x43, 0x21, 0x6e,
                   0xbe, 0x21, 0x1c, 0x53, 0x9,  0x0,  0x16, 0xad, 0x8a, 0x6,  0x9,  0x92, 0x4,  0x7b, 0xa7,
                   0xf,  0x14, 0x81, 0x8,  0x1,  0xe8, 0xe,  0x22, 0xfe, 0xb8, 0xd2, 0xc7, 0x16, 0xee, 0x29,
                   0xbf, 0x17, 0x1f, 0x25, 0x76, 0x3,  0x0,  0x2,  0x7f, 0xb7, 0x25, 0xbc, 0x2b};

  uint8_t buf[98] = {0};

  uint8_t topic_bytes[] = {0x35, 0x84, 0xea, 0xf6, 0x5a};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xa,  0xc9, 0x12, 0x48, 0x8a, 0xf7, 0xf7, 0xc9, 0xd9,
                           0xb0, 0x26, 0x14, 0xd3, 0xf0, 0xc6, 0xce, 0x45, 0xb9};
  uint8_t bytesprops1[] = {0xad, 0x8a, 0x6,  0x9, 0x92, 0x4,  0x7b, 0xa7, 0xf,  0x14, 0x81,
                           0x8,  0x1,  0xe8, 0xe, 0x22, 0xfe, 0xb8, 0xd2, 0xc7, 0x16, 0xee};
  uint8_t bytesprops2[] = {0x7f, 0xb7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30260}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12867}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28350}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7251}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\212\222", _pubPktID = 0, _pubBody
// = "f", _pubProps = [PropSubscriptionIdentifierAvailable 31,PropCorrelationData
// "\250\232\245Rf\128P\RS\t\195\FS\146\&2x\ESC\222H\SOH\136\NUL\198\228\GS\UShfi\164",PropReasonString
// "\144\215V",PropSubscriptionIdentifierAvailable 51,PropMessageExpiryInterval 16252,PropMessageExpiryInterval
// 9192,PropWildcardSubscriptionAvailable 91,PropRequestProblemInformation 221,PropTopicAliasMaximum
// 21616,PropPayloadFormatIndicator 184,PropSubscriptionIdentifierAvailable 34]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x44, 0x0,  0x2,  0xd4, 0xde, 0x3e, 0x29, 0x1f, 0x9,  0x0,  0x1c, 0xfa, 0xe8,
                   0xf5, 0x52, 0x66, 0x80, 0x50, 0x1e, 0x9,  0xc3, 0x1c, 0x92, 0x32, 0x78, 0x1b, 0xde,
                   0x48, 0x1,  0x88, 0x0,  0xc6, 0xe4, 0x1d, 0x1f, 0x68, 0x66, 0x69, 0xa4, 0x1f, 0x0,
                   0x3,  0x90, 0xd7, 0x56, 0x29, 0x33, 0x2,  0x0,  0x0,  0x3f, 0x7c, 0x2,  0x0,  0x0,
                   0x23, 0xe8, 0x28, 0x5b, 0x17, 0xdd, 0x22, 0x54, 0x70, 0x1,  0xb8, 0x29, 0x22, 0x66};

  uint8_t buf[80] = {0};

  uint8_t topic_bytes[] = {0xd4, 0xde};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xfa, 0xe8, 0xf5, 0x52, 0x66, 0x80, 0x50, 0x1e, 0x9,  0xc3, 0x1c, 0x92, 0x32, 0x78,
                           0x1b, 0xde, 0x48, 0x1,  0x88, 0x0,  0xc6, 0xe4, 0x1d, 0x1f, 0x68, 0x66, 0x69, 0xa4};
  uint8_t bytesprops1[] = {0x90, 0xd7, 0x56};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16252}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9192}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21616}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "u\ESC\171:\189\192\SUB\242!\162\203\208Z\212\177\&5\248\255\138k\213\183+\SUB\132\GS#M\192", _pubPktID = 13057,
// _pubBody = "\168\129\191\243\158\250'%~\DEL0\ESC\210%qk\220\ENQ\241\199", _pubProps = [PropContentType
// "^XfM'v\226[:l\182\185\146N\223\238\187z\143n",PropPayloadFormatIndicator 91,PropMessageExpiryInterval
// 3229,PropAssignedClientIdentifier
// "\212\197\197\&7\RS\167qC\142\237V\175\171\177\246i\198\227\&9I\222",PropContentType
// "\251OiAP\US\202t\135\147>\245\149\228\ETB\233\&8\142 \150\146Mo",PropAssignedClientIdentifier
// "\241\a\180\n\208\207\147\254\207\170 n\142",PropRetainAvailable 241,PropTopicAliasMaximum 12654,PropServerKeepAlive
// 6608,PropTopicAliasMaximum 31149,PropServerReference
// ">5\217\170\139\151\237i\b\186\197z>\173\&5\230?~m",PropRetainAvailable 112,PropSharedSubscriptionAvailable
// 191,PropPayloadFormatIndicator 134,PropSubscriptionIdentifier 20,PropReceiveMaximum 32298,PropRetainAvailable
// 232,PropMessageExpiryInterval 23304,PropAuthenticationData "\187:n\138\182\FS+3",PropReasonString
// "\134\&3\bh\148E\241\SOH\225\135\221o\210\164\245\148",PropRequestResponseInformation 252,PropTopicAliasMaximum
// 413,PropSubscriptionIdentifierAvailable 212,PropRequestResponseInformation 211,PropSubscriptionIdentifier
// 23,PropResponseTopic "\196<\230r\SYN\221\255",PropRequestProblemInformation 99,PropUserProperty "i\SUB\239*\253#\158"
// "L\NUL,u\234\180~Yk\ENQ\202\226_\139a(\178\ETB\194\144o",PropSessionExpiryInterval 32543,PropResponseInformation
// "\205T\201\163\199\187\135o\NUL.QrO\134\172C"]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x3a, 0xb8, 0x2,  0x0,  0x1d, 0x75, 0x1b, 0xab, 0x3a, 0xbd, 0xc0, 0x1a, 0xf2, 0x21, 0xa2, 0xcb, 0xd0, 0x5a, 0xd4,
      0xb1, 0x35, 0xf8, 0xff, 0x8a, 0x6b, 0xd5, 0xb7, 0x2b, 0x1a, 0x84, 0x1d, 0x23, 0x4d, 0xc0, 0x33, 0x1,  0x81, 0x2,
      0x3,  0x0,  0x14, 0x5e, 0x58, 0x66, 0x4d, 0x27, 0x76, 0xe2, 0x5b, 0x3a, 0x6c, 0xb6, 0xb9, 0x92, 0x4e, 0xdf, 0xee,
      0xbb, 0x7a, 0x8f, 0x6e, 0x1,  0x5b, 0x2,  0x0,  0x0,  0xc,  0x9d, 0x12, 0x0,  0x15, 0xd4, 0xc5, 0xc5, 0x37, 0x1e,
      0xa7, 0x71, 0x43, 0x8e, 0xed, 0x56, 0xaf, 0xab, 0xb1, 0xf6, 0x69, 0xc6, 0xe3, 0x39, 0x49, 0xde, 0x3,  0x0,  0x17,
      0xfb, 0x4f, 0x69, 0x41, 0x50, 0x1f, 0xca, 0x74, 0x87, 0x93, 0x3e, 0xf5, 0x95, 0xe4, 0x17, 0xe9, 0x38, 0x8e, 0x20,
      0x96, 0x92, 0x4d, 0x6f, 0x12, 0x0,  0xd,  0xf1, 0x7,  0xb4, 0xa,  0xd0, 0xcf, 0x93, 0xfe, 0xcf, 0xaa, 0x20, 0x6e,
      0x8e, 0x25, 0xf1, 0x22, 0x31, 0x6e, 0x13, 0x19, 0xd0, 0x22, 0x79, 0xad, 0x1c, 0x0,  0x13, 0x3e, 0x35, 0xd9, 0xaa,
      0x8b, 0x97, 0xed, 0x69, 0x8,  0xba, 0xc5, 0x7a, 0x3e, 0xad, 0x35, 0xe6, 0x3f, 0x7e, 0x6d, 0x25, 0x70, 0x2a, 0xbf,
      0x1,  0x86, 0xb,  0x14, 0x21, 0x7e, 0x2a, 0x25, 0xe8, 0x2,  0x0,  0x0,  0x5b, 0x8,  0x16, 0x0,  0x8,  0xbb, 0x3a,
      0x6e, 0x8a, 0xb6, 0x1c, 0x2b, 0x33, 0x1f, 0x0,  0x10, 0x86, 0x33, 0x8,  0x68, 0x94, 0x45, 0xf1, 0x1,  0xe1, 0x87,
      0xdd, 0x6f, 0xd2, 0xa4, 0xf5, 0x94, 0x19, 0xfc, 0x22, 0x1,  0x9d, 0x29, 0xd4, 0x19, 0xd3, 0xb,  0x17, 0x8,  0x0,
      0x7,  0xc4, 0x3c, 0xe6, 0x72, 0x16, 0xdd, 0xff, 0x17, 0x63, 0x26, 0x0,  0x7,  0x69, 0x1a, 0xef, 0x2a, 0xfd, 0x23,
      0x9e, 0x0,  0x15, 0x4c, 0x0,  0x2c, 0x75, 0xea, 0xb4, 0x7e, 0x59, 0x6b, 0x5,  0xca, 0xe2, 0x5f, 0x8b, 0x61, 0x28,
      0xb2, 0x17, 0xc2, 0x90, 0x6f, 0x11, 0x0,  0x0,  0x7f, 0x1f, 0x1a, 0x0,  0x10, 0xcd, 0x54, 0xc9, 0xa3, 0xc7, 0xbb,
      0x87, 0x6f, 0x0,  0x2e, 0x51, 0x72, 0x4f, 0x86, 0xac, 0x43, 0xa8, 0x81, 0xbf, 0xf3, 0x9e, 0xfa, 0x27, 0x25, 0x7e,
      0x7f, 0x30, 0x1b, 0xd2, 0x25, 0x71, 0x6b, 0xdc, 0x5,  0xf1, 0xc7};

  uint8_t buf[325] = {0};

  uint8_t topic_bytes[] = {0x75, 0x1b, 0xab, 0x3a, 0xbd, 0xc0, 0x1a, 0xf2, 0x21, 0xa2, 0xcb, 0xd0, 0x5a, 0xd4, 0xb1,
                           0x35, 0xf8, 0xff, 0x8a, 0x6b, 0xd5, 0xb7, 0x2b, 0x1a, 0x84, 0x1d, 0x23, 0x4d, 0xc0};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa8, 0x81, 0xbf, 0xf3, 0x9e, 0xfa, 0x27, 0x25, 0x7e, 0x7f,
                         0x30, 0x1b, 0xd2, 0x25, 0x71, 0x6b, 0xdc, 0x5,  0xf1, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x5e, 0x58, 0x66, 0x4d, 0x27, 0x76, 0xe2, 0x5b, 0x3a, 0x6c,
                           0xb6, 0xb9, 0x92, 0x4e, 0xdf, 0xee, 0xbb, 0x7a, 0x8f, 0x6e};
  uint8_t bytesprops1[] = {0xd4, 0xc5, 0xc5, 0x37, 0x1e, 0xa7, 0x71, 0x43, 0x8e, 0xed, 0x56,
                           0xaf, 0xab, 0xb1, 0xf6, 0x69, 0xc6, 0xe3, 0x39, 0x49, 0xde};
  uint8_t bytesprops2[] = {0xfb, 0x4f, 0x69, 0x41, 0x50, 0x1f, 0xca, 0x74, 0x87, 0x93, 0x3e, 0xf5,
                           0x95, 0xe4, 0x17, 0xe9, 0x38, 0x8e, 0x20, 0x96, 0x92, 0x4d, 0x6f};
  uint8_t bytesprops3[] = {0xf1, 0x7, 0xb4, 0xa, 0xd0, 0xcf, 0x93, 0xfe, 0xcf, 0xaa, 0x20, 0x6e, 0x8e};
  uint8_t bytesprops4[] = {0x3e, 0x35, 0xd9, 0xaa, 0x8b, 0x97, 0xed, 0x69, 0x8, 0xba,
                           0xc5, 0x7a, 0x3e, 0xad, 0x35, 0xe6, 0x3f, 0x7e, 0x6d};
  uint8_t bytesprops5[] = {0xbb, 0x3a, 0x6e, 0x8a, 0xb6, 0x1c, 0x2b, 0x33};
  uint8_t bytesprops6[] = {0x86, 0x33, 0x8,  0x68, 0x94, 0x45, 0xf1, 0x1,
                           0xe1, 0x87, 0xdd, 0x6f, 0xd2, 0xa4, 0xf5, 0x94};
  uint8_t bytesprops7[] = {0xc4, 0x3c, 0xe6, 0x72, 0x16, 0xdd, 0xff};
  uint8_t bytesprops9[] = {0x4c, 0x0,  0x2c, 0x75, 0xea, 0xb4, 0x7e, 0x59, 0x6b, 0x5, 0xca,
                           0xe2, 0x5f, 0x8b, 0x61, 0x28, 0xb2, 0x17, 0xc2, 0x90, 0x6f};
  uint8_t bytesprops8[] = {0x69, 0x1a, 0xef, 0x2a, 0xfd, 0x23, 0x9e};
  uint8_t bytesprops10[] = {0xcd, 0x54, 0xc9, 0xa3, 0xc7, 0xbb, 0x87, 0x6f,
                            0x0,  0x2e, 0x51, 0x72, 0x4f, 0x86, 0xac, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3229}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12654}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6608}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31149}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32298}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23304}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 413}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops8}, .v = {21, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32543}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 13057, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\186l\242\SOH;D}W:\172\197",
// _pubPktID = 15309, _pubBody = "-\137a\203_YG\210\138\172yL\224>", _pubProps = [PropResponseInformation
// "7M\191\DC1\154",PropPayloadFormatIndicator 204,PropMaximumQoS 99,PropResponseInformation
// "\173\DLE-z\GS\DC2\130n\179",PropWillDelayInterval 22264,PropMaximumPacketSize 9076,PropAuthenticationMethod
// "`\235xe$J\213a\207\213\va\233\182\248\201m\151rn`z{;T",PropMessageExpiryInterval 12687,PropTopicAliasMaximum 22086]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x3d, 0x65, 0x0,  0xc,  0xfd, 0xba, 0x6c, 0xf2, 0x1,  0x3b, 0x44, 0x7d, 0x57, 0x3a, 0xac,
                   0xc5, 0x3b, 0xcd, 0x46, 0x1a, 0x0,  0x5,  0x37, 0x4d, 0xbf, 0x11, 0x9a, 0x1,  0xcc, 0x24,
                   0x63, 0x1a, 0x0,  0x9,  0xad, 0x10, 0x2d, 0x7a, 0x1d, 0x12, 0x82, 0x6e, 0xb3, 0x18, 0x0,
                   0x0,  0x56, 0xf8, 0x27, 0x0,  0x0,  0x23, 0x74, 0x15, 0x0,  0x19, 0x60, 0xeb, 0x78, 0x65,
                   0x24, 0x4a, 0xd5, 0x61, 0xcf, 0xd5, 0xb,  0x61, 0xe9, 0xb6, 0xf8, 0xc9, 0x6d, 0x97, 0x72,
                   0x6e, 0x60, 0x7a, 0x7b, 0x3b, 0x54, 0x2,  0x0,  0x0,  0x31, 0x8f, 0x22, 0x56, 0x46, 0x2d,
                   0x89, 0x61, 0xcb, 0x5f, 0x59, 0x47, 0xd2, 0x8a, 0xac, 0x79, 0x4c, 0xe0, 0x3e};

  uint8_t buf[113] = {0};

  uint8_t topic_bytes[] = {0xfd, 0xba, 0x6c, 0xf2, 0x1, 0x3b, 0x44, 0x7d, 0x57, 0x3a, 0xac, 0xc5};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2d, 0x89, 0x61, 0xcb, 0x5f, 0x59, 0x47, 0xd2, 0x8a, 0xac, 0x79, 0x4c, 0xe0, 0x3e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x37, 0x4d, 0xbf, 0x11, 0x9a};
  uint8_t bytesprops1[] = {0xad, 0x10, 0x2d, 0x7a, 0x1d, 0x12, 0x82, 0x6e, 0xb3};
  uint8_t bytesprops2[] = {0x60, 0xeb, 0x78, 0x65, 0x24, 0x4a, 0xd5, 0x61, 0xcf, 0xd5, 0xb,  0x61, 0xe9,
                           0xb6, 0xf8, 0xc9, 0x6d, 0x97, 0x72, 0x6e, 0x60, 0x7a, 0x7b, 0x3b, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22264}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9076}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12687}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22086}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15309, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\DC3\NAK:\DEL\206\213^_\254\174f\203\221\160U", _pubPktID = 0, _pubBody = "\211\130}", _pubProps =
// [PropAuthenticationData
// "\140\160J\DLE\230\SOH\191\&6\201j\208\f\136]\FS\229V\174\158b<\ACK|\139\192\FS\202\\\200",PropMessageExpiryInterval
// 24738,PropSubscriptionIdentifierAvailable 9,PropRetainAvailable 74,PropWildcardSubscriptionAvailable
// 189,PropSubscriptionIdentifier 21,PropMaximumQoS 102,PropServerKeepAlive 10663,PropWildcardSubscriptionAvailable
// 130,PropMessageExpiryInterval 28057,PropContentType
// "\253V\243.\248#\199R\178\&8\167\209\245f0\ACK\b\165h\255\175\190",PropReceiveMaximum 10701]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x30, 0x6b, 0x0,  0x10, 0x4d, 0x13, 0x15, 0x3a, 0x7f, 0xce, 0xd5, 0x5e, 0x5f, 0xfe, 0xae, 0x66,
                   0xcb, 0xdd, 0xa0, 0x55, 0x55, 0x16, 0x0,  0x1d, 0x8c, 0xa0, 0x4a, 0x10, 0xe6, 0x1,  0xbf, 0x36,
                   0xc9, 0x6a, 0xd0, 0xc,  0x88, 0x5d, 0x1c, 0xe5, 0x56, 0xae, 0x9e, 0x62, 0x3c, 0x6,  0x7c, 0x8b,
                   0xc0, 0x1c, 0xca, 0x5c, 0xc8, 0x2,  0x0,  0x0,  0x60, 0xa2, 0x29, 0x9,  0x25, 0x4a, 0x28, 0xbd,
                   0xb,  0x15, 0x24, 0x66, 0x13, 0x29, 0xa7, 0x28, 0x82, 0x2,  0x0,  0x0,  0x6d, 0x99, 0x3,  0x0,
                   0x16, 0xfd, 0x56, 0xf3, 0x2e, 0xf8, 0x23, 0xc7, 0x52, 0xb2, 0x38, 0xa7, 0xd1, 0xf5, 0x66, 0x30,
                   0x6,  0x8,  0xa5, 0x68, 0xff, 0xaf, 0xbe, 0x21, 0x29, 0xcd, 0xd3, 0x82, 0x7d};

  uint8_t buf[119] = {0};

  uint8_t topic_bytes[] = {0x4d, 0x13, 0x15, 0x3a, 0x7f, 0xce, 0xd5, 0x5e,
                           0x5f, 0xfe, 0xae, 0x66, 0xcb, 0xdd, 0xa0, 0x55};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd3, 0x82, 0x7d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x8c, 0xa0, 0x4a, 0x10, 0xe6, 0x1,  0xbf, 0x36, 0xc9, 0x6a, 0xd0, 0xc,  0x88, 0x5d, 0x1c,
                           0xe5, 0x56, 0xae, 0x9e, 0x62, 0x3c, 0x6,  0x7c, 0x8b, 0xc0, 0x1c, 0xca, 0x5c, 0xc8};
  uint8_t bytesprops1[] = {0xfd, 0x56, 0xf3, 0x2e, 0xf8, 0x23, 0xc7, 0x52, 0xb2, 0x38, 0xa7,
                           0xd1, 0xf5, 0x66, 0x30, 0x6,  0x8,  0xa5, 0x68, 0xff, 0xaf, 0xbe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24738}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10663}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28057}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10701}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\169|\146E2\GS{\237\&3\166",
// _pubPktID = 0, _pubBody = "#\227\217]\US\238S\163\139\232\165\210\243-", _pubProps = [PropResponseInformation
// "\ESCo\b\237\EOT\t\235|\197m~*\176\f\245\253\171`6F\133\161Z",PropMaximumQoS 238,PropPayloadFormatIndicator
// 177,PropPayloadFormatIndicator 90,PropPayloadFormatIndicator 72,PropResponseTopic "",PropServerReference
// "\138K\245\149\146\CAN\167\ESC\196\&8\ESC6G\246\205\221\182\199",PropPayloadFormatIndicator 182,PropServerReference
// "\239\&02\SO\128",PropReasonString "",PropSessionExpiryInterval 27592,PropServerReference
// "PvV\183\184c\166\227\SUB\238m\154\DC1`\192\227-\244VRh\226\146\\",PropAuthenticationMethod
// "W\DC2`\164/\150\DLE\186\219[\130\176\&8\SUB\148\CAN]J\151E\CAN7b\220\CAN\137\&0~O",PropMaximumQoS
// 158,PropSubscriptionIdentifier 17,PropSubscriptionIdentifier 9,PropUserProperty
// "\198\195\243\232\200\192\nz\157\SYN\199\140\201\242\242}\226\ENQ\208\168\&3>"
// "\SOH\150\146\145",PropSubscriptionIdentifier 1,PropReceiveMaximum 29802,PropRequestProblemInformation
// 219,PropTopicAlias 19865,PropMessageExpiryInterval 11509,PropSessionExpiryInterval 27755]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x31, 0xdc, 0x1,  0x0,  0xa,  0xa9, 0x7c, 0x92, 0x45, 0x32, 0x1d, 0x7b, 0xed, 0x33, 0xa6, 0xc0, 0x1,  0x1a, 0x0,
      0x17, 0x1b, 0x6f, 0x8,  0xed, 0x4,  0x9,  0xeb, 0x7c, 0xc5, 0x6d, 0x7e, 0x2a, 0xb0, 0xc,  0xf5, 0xfd, 0xab, 0x60,
      0x36, 0x46, 0x85, 0xa1, 0x5a, 0x24, 0xee, 0x1,  0xb1, 0x1,  0x5a, 0x1,  0x48, 0x8,  0x0,  0x0,  0x1c, 0x0,  0x12,
      0x8a, 0x4b, 0xf5, 0x95, 0x92, 0x18, 0xa7, 0x1b, 0xc4, 0x38, 0x1b, 0x36, 0x47, 0xf6, 0xcd, 0xdd, 0xb6, 0xc7, 0x1,
      0xb6, 0x1c, 0x0,  0x5,  0xef, 0x30, 0x32, 0xe,  0x80, 0x1f, 0x0,  0x0,  0x11, 0x0,  0x0,  0x6b, 0xc8, 0x1c, 0x0,
      0x18, 0x50, 0x76, 0x56, 0xb7, 0xb8, 0x63, 0xa6, 0xe3, 0x1a, 0xee, 0x6d, 0x9a, 0x11, 0x60, 0xc0, 0xe3, 0x2d, 0xf4,
      0x56, 0x52, 0x68, 0xe2, 0x92, 0x5c, 0x15, 0x0,  0x1d, 0x57, 0x12, 0x60, 0xa4, 0x2f, 0x96, 0x10, 0xba, 0xdb, 0x5b,
      0x82, 0xb0, 0x38, 0x1a, 0x94, 0x18, 0x5d, 0x4a, 0x97, 0x45, 0x18, 0x37, 0x62, 0xdc, 0x18, 0x89, 0x30, 0x7e, 0x4f,
      0x24, 0x9e, 0xb,  0x11, 0xb,  0x9,  0x26, 0x0,  0x16, 0xc6, 0xc3, 0xf3, 0xe8, 0xc8, 0xc0, 0xa,  0x7a, 0x9d, 0x16,
      0xc7, 0x8c, 0xc9, 0xf2, 0xf2, 0x7d, 0xe2, 0x5,  0xd0, 0xa8, 0x33, 0x3e, 0x0,  0x4,  0x1,  0x96, 0x92, 0x91, 0xb,
      0x1,  0x21, 0x74, 0x6a, 0x17, 0xdb, 0x23, 0x4d, 0x99, 0x2,  0x0,  0x0,  0x2c, 0xf5, 0x11, 0x0,  0x0,  0x6c, 0x6b,
      0x23, 0xe3, 0xd9, 0x5d, 0x1f, 0xee, 0x53, 0xa3, 0x8b, 0xe8, 0xa5, 0xd2, 0xf3, 0x2d};

  uint8_t buf[233] = {0};

  uint8_t topic_bytes[] = {0xa9, 0x7c, 0x92, 0x45, 0x32, 0x1d, 0x7b, 0xed, 0x33, 0xa6};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x23, 0xe3, 0xd9, 0x5d, 0x1f, 0xee, 0x53, 0xa3, 0x8b, 0xe8, 0xa5, 0xd2, 0xf3, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x1b, 0x6f, 0x8,  0xed, 0x4,  0x9,  0xeb, 0x7c, 0xc5, 0x6d, 0x7e, 0x2a,
                           0xb0, 0xc,  0xf5, 0xfd, 0xab, 0x60, 0x36, 0x46, 0x85, 0xa1, 0x5a};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x8a, 0x4b, 0xf5, 0x95, 0x92, 0x18, 0xa7, 0x1b, 0xc4,
                           0x38, 0x1b, 0x36, 0x47, 0xf6, 0xcd, 0xdd, 0xb6, 0xc7};
  uint8_t bytesprops3[] = {0xef, 0x30, 0x32, 0xe, 0x80};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0x50, 0x76, 0x56, 0xb7, 0xb8, 0x63, 0xa6, 0xe3, 0x1a, 0xee, 0x6d, 0x9a,
                           0x11, 0x60, 0xc0, 0xe3, 0x2d, 0xf4, 0x56, 0x52, 0x68, 0xe2, 0x92, 0x5c};
  uint8_t bytesprops6[] = {0x57, 0x12, 0x60, 0xa4, 0x2f, 0x96, 0x10, 0xba, 0xdb, 0x5b, 0x82, 0xb0, 0x38, 0x1a, 0x94,
                           0x18, 0x5d, 0x4a, 0x97, 0x45, 0x18, 0x37, 0x62, 0xdc, 0x18, 0x89, 0x30, 0x7e, 0x4f};
  uint8_t bytesprops8[] = {0x1, 0x96, 0x92, 0x91};
  uint8_t bytesprops7[] = {0xc6, 0xc3, 0xf3, 0xe8, 0xc8, 0xc0, 0xa, 0x7a, 0x9d, 0x16, 0xc7,
                           0x8c, 0xc9, 0xf2, 0xf2, 0x7d, 0xe2, 0x5, 0xd0, 0xa8, 0x33, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27592}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops7}, .v = {4, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29802}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19865}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11509}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27755}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\187\253\202u\190\\@\215", _pubPktID
// = 27515, _pubBody = "\146q\173U}?\142kjA\ETX\187\155\EOT#K\207\&8x\224\244\133\241\t\146I\241", _pubProps =
// [PropPayloadFormatIndicator 160,PropResponseTopic "\226\202
// \245S\205Z\129\227_\136\241\"B}\235\&3\NUL\SOHO\213",PropPayloadFormatIndicator 23,PropWillDelayInterval
// 9922,PropTopicAlias 26620,PropResponseInformation
// "\SUB]\213t\222\SUB\162\230\206\"\ESC\236\199{Nq\251",PropRequestProblemInformation 175,PropMaximumQoS
// 94,PropContentType "\NUL\215Y\228q.\ESC\ETB",PropMessageExpiryInterval 26757,PropReceiveMaximum 30209,PropContentType
// "-\f1\223",PropResponseInformation
// "\174\208\149\t\161\194jG\FSz\238\227\242\145\243\194\239B=\229",PropMessageExpiryInterval
// 4476,PropRequestProblemInformation 106,PropCorrelationData
// "h=\216\237\192\192>\223~\140\153\197\193\191\"\170\SOHF\240\131+d\205\252",PropAuthenticationMethod
// "Z(9\177\156\221\ETBe\156\&8\205`\132\132l\f",PropServerReference
// "\130UyI\211\GSr\202\216k^\255\220\NULq\US",PropAuthenticationMethod "\248\"\195K\CAN4r",PropAuthenticationData
// "\135\151\255\231v\246",PropServerReference
// "J\169s\207D\146qo\GS\n\156\151\134\186&\134\SYN\\\243\141\136",PropMessageExpiryInterval 11426]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x3c, 0x8e, 0x2,  0x0,  0x8,  0xbb, 0xfd, 0xca, 0x75, 0xbe, 0x5c, 0x40, 0xd7, 0x6b, 0x7b, 0xe5, 0x1,  0x1,  0xa0,
      0x8,  0x0,  0x15, 0xe2, 0xca, 0x20, 0xf5, 0x53, 0xcd, 0x5a, 0x81, 0xe3, 0x5f, 0x88, 0xf1, 0x22, 0x42, 0x7d, 0xeb,
      0x33, 0x0,  0x1,  0x4f, 0xd5, 0x1,  0x17, 0x18, 0x0,  0x0,  0x26, 0xc2, 0x23, 0x67, 0xfc, 0x1a, 0x0,  0x11, 0x1a,
      0x5d, 0xd5, 0x74, 0xde, 0x1a, 0xa2, 0xe6, 0xce, 0x22, 0x1b, 0xec, 0xc7, 0x7b, 0x4e, 0x71, 0xfb, 0x17, 0xaf, 0x24,
      0x5e, 0x3,  0x0,  0x8,  0x0,  0xd7, 0x59, 0xe4, 0x71, 0x2e, 0x1b, 0x17, 0x2,  0x0,  0x0,  0x68, 0x85, 0x21, 0x76,
      0x1,  0x3,  0x0,  0x4,  0x2d, 0xc,  0x31, 0xdf, 0x1a, 0x0,  0x14, 0xae, 0xd0, 0x95, 0x9,  0xa1, 0xc2, 0x6a, 0x47,
      0x1c, 0x7a, 0xee, 0xe3, 0xf2, 0x91, 0xf3, 0xc2, 0xef, 0x42, 0x3d, 0xe5, 0x2,  0x0,  0x0,  0x11, 0x7c, 0x17, 0x6a,
      0x9,  0x0,  0x18, 0x68, 0x3d, 0xd8, 0xed, 0xc0, 0xc0, 0x3e, 0xdf, 0x7e, 0x8c, 0x99, 0xc5, 0xc1, 0xbf, 0x22, 0xaa,
      0x1,  0x46, 0xf0, 0x83, 0x2b, 0x64, 0xcd, 0xfc, 0x15, 0x0,  0x10, 0x5a, 0x28, 0x39, 0xb1, 0x9c, 0xdd, 0x17, 0x65,
      0x9c, 0x38, 0xcd, 0x60, 0x84, 0x84, 0x6c, 0xc,  0x1c, 0x0,  0x10, 0x82, 0x55, 0x79, 0x49, 0xd3, 0x1d, 0x72, 0xca,
      0xd8, 0x6b, 0x5e, 0xff, 0xdc, 0x0,  0x71, 0x1f, 0x15, 0x0,  0x7,  0xf8, 0x22, 0xc3, 0x4b, 0x18, 0x34, 0x72, 0x16,
      0x0,  0x6,  0x87, 0x97, 0xff, 0xe7, 0x76, 0xf6, 0x1c, 0x0,  0x15, 0x4a, 0xa9, 0x73, 0xcf, 0x44, 0x92, 0x71, 0x6f,
      0x1d, 0xa,  0x9c, 0x97, 0x86, 0xba, 0x26, 0x86, 0x16, 0x5c, 0xf3, 0x8d, 0x88, 0x2,  0x0,  0x0,  0x2c, 0xa2, 0x92,
      0x71, 0xad, 0x55, 0x7d, 0x3f, 0x8e, 0x6b, 0x6a, 0x41, 0x3,  0xbb, 0x9b, 0x4,  0x23, 0x4b, 0xcf, 0x38, 0x78, 0xe0,
      0xf4, 0x85, 0xf1, 0x9,  0x92, 0x49, 0xf1};

  uint8_t buf[283] = {0};

  uint8_t topic_bytes[] = {0xbb, 0xfd, 0xca, 0x75, 0xbe, 0x5c, 0x40, 0xd7};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0x71, 0xad, 0x55, 0x7d, 0x3f, 0x8e, 0x6b, 0x6a, 0x41, 0x3,  0xbb, 0x9b, 0x4,
                         0x23, 0x4b, 0xcf, 0x38, 0x78, 0xe0, 0xf4, 0x85, 0xf1, 0x9,  0x92, 0x49, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0xe2, 0xca, 0x20, 0xf5, 0x53, 0xcd, 0x5a, 0x81, 0xe3, 0x5f, 0x88,
                           0xf1, 0x22, 0x42, 0x7d, 0xeb, 0x33, 0x0,  0x1,  0x4f, 0xd5};
  uint8_t bytesprops1[] = {0x1a, 0x5d, 0xd5, 0x74, 0xde, 0x1a, 0xa2, 0xe6, 0xce,
                           0x22, 0x1b, 0xec, 0xc7, 0x7b, 0x4e, 0x71, 0xfb};
  uint8_t bytesprops2[] = {0x0, 0xd7, 0x59, 0xe4, 0x71, 0x2e, 0x1b, 0x17};
  uint8_t bytesprops3[] = {0x2d, 0xc, 0x31, 0xdf};
  uint8_t bytesprops4[] = {0xae, 0xd0, 0x95, 0x9,  0xa1, 0xc2, 0x6a, 0x47, 0x1c, 0x7a,
                           0xee, 0xe3, 0xf2, 0x91, 0xf3, 0xc2, 0xef, 0x42, 0x3d, 0xe5};
  uint8_t bytesprops5[] = {0x68, 0x3d, 0xd8, 0xed, 0xc0, 0xc0, 0x3e, 0xdf, 0x7e, 0x8c, 0x99, 0xc5,
                           0xc1, 0xbf, 0x22, 0xaa, 0x1,  0x46, 0xf0, 0x83, 0x2b, 0x64, 0xcd, 0xfc};
  uint8_t bytesprops6[] = {0x5a, 0x28, 0x39, 0xb1, 0x9c, 0xdd, 0x17, 0x65,
                           0x9c, 0x38, 0xcd, 0x60, 0x84, 0x84, 0x6c, 0xc};
  uint8_t bytesprops7[] = {0x82, 0x55, 0x79, 0x49, 0xd3, 0x1d, 0x72, 0xca,
                           0xd8, 0x6b, 0x5e, 0xff, 0xdc, 0x0,  0x71, 0x1f};
  uint8_t bytesprops8[] = {0xf8, 0x22, 0xc3, 0x4b, 0x18, 0x34, 0x72};
  uint8_t bytesprops9[] = {0x87, 0x97, 0xff, 0xe7, 0x76, 0xf6};
  uint8_t bytesprops10[] = {0x4a, 0xa9, 0x73, 0xcf, 0x44, 0x92, 0x71, 0x6f, 0x1d, 0xa, 0x9c,
                            0x97, 0x86, 0xba, 0x26, 0x86, 0x16, 0x5c, 0xf3, 0x8d, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9922}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26620}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26757}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30209}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4476}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11426}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 27515, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\163\147\204\140\129\152\150A\187\249", _pubPktID = 15054, _pubBody = "C\207+gu\184\240\&5~z\148f", _pubProps =
// [PropWillDelayInterval 13896,PropTopicAliasMaximum 22435,PropAssignedClientIdentifier
// "\145\215\253Ef0y\b\184,1\173r\243\241\194\b\213\184P%",PropSharedSubscriptionAvailable 98,PropSessionExpiryInterval
// 13964,PropTopicAlias 11550,PropMaximumPacketSize 31812,PropSubscriptionIdentifierAvailable 140,PropWillDelayInterval
// 22185,PropTopicAliasMaximum 25699,PropSessionExpiryInterval 4043,PropTopicAliasMaximum 14577,PropUserProperty
// "-:\192\STX\171\252$\215\198)\204"
// "vMG\132s\143\225-\244\136\ETX'\199^O\215\211\181\235u\221=\157~\189\145d",PropSubscriptionIdentifierAvailable
// 172,PropReceiveMaximum 21448,PropWildcardSubscriptionAvailable 18,PropPayloadFormatIndicator
// 210,PropWillDelayInterval 31421,PropAssignedClientIdentifier "j\149\157",PropContentType
// "\211I\142\244\176\ETX\199\223\SUB\245\188l\207o\"\141\174V\237\146x\201",PropResponseInformation
// "\SIo\203\"\176\187\DC1\179I\""]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {0x3d, 0xc2, 0x1,  0x0,  0xa,  0xa3, 0x93, 0xcc, 0x8c, 0x81, 0x98, 0x96, 0x41, 0xbb, 0xf9, 0x3a, 0xce,
                   0xa6, 0x1,  0x18, 0x0,  0x0,  0x36, 0x48, 0x22, 0x57, 0xa3, 0x12, 0x0,  0x15, 0x91, 0xd7, 0xfd, 0x45,
                   0x66, 0x30, 0x79, 0x8,  0xb8, 0x2c, 0x31, 0xad, 0x72, 0xf3, 0xf1, 0xc2, 0x8,  0xd5, 0xb8, 0x50, 0x25,
                   0x2a, 0x62, 0x11, 0x0,  0x0,  0x36, 0x8c, 0x23, 0x2d, 0x1e, 0x27, 0x0,  0x0,  0x7c, 0x44, 0x29, 0x8c,
                   0x18, 0x0,  0x0,  0x56, 0xa9, 0x22, 0x64, 0x63, 0x11, 0x0,  0x0,  0xf,  0xcb, 0x22, 0x38, 0xf1, 0x26,
                   0x0,  0xb,  0x2d, 0x3a, 0xc0, 0x2,  0xab, 0xfc, 0x24, 0xd7, 0xc6, 0x29, 0xcc, 0x0,  0x1b, 0x76, 0x4d,
                   0x47, 0x84, 0x73, 0x8f, 0xe1, 0x2d, 0xf4, 0x88, 0x3,  0x27, 0xc7, 0x5e, 0x4f, 0xd7, 0xd3, 0xb5, 0xeb,
                   0x75, 0xdd, 0x3d, 0x9d, 0x7e, 0xbd, 0x91, 0x64, 0x29, 0xac, 0x21, 0x53, 0xc8, 0x28, 0x12, 0x1,  0xd2,
                   0x18, 0x0,  0x0,  0x7a, 0xbd, 0x12, 0x0,  0x3,  0x6a, 0x95, 0x9d, 0x3,  0x0,  0x16, 0xd3, 0x49, 0x8e,
                   0xf4, 0xb0, 0x3,  0xc7, 0xdf, 0x1a, 0xf5, 0xbc, 0x6c, 0xcf, 0x6f, 0x22, 0x8d, 0xae, 0x56, 0xed, 0x92,
                   0x78, 0xc9, 0x1a, 0x0,  0xa,  0xf,  0x6f, 0xcb, 0x22, 0xb0, 0xbb, 0x11, 0xb3, 0x49, 0x22, 0x43, 0xcf,
                   0x2b, 0x67, 0x75, 0xb8, 0xf0, 0x35, 0x7e, 0x7a, 0x94, 0x66};

  uint8_t buf[207] = {0};

  uint8_t topic_bytes[] = {0xa3, 0x93, 0xcc, 0x8c, 0x81, 0x98, 0x96, 0x41, 0xbb, 0xf9};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x43, 0xcf, 0x2b, 0x67, 0x75, 0xb8, 0xf0, 0x35, 0x7e, 0x7a, 0x94, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x91, 0xd7, 0xfd, 0x45, 0x66, 0x30, 0x79, 0x8,  0xb8, 0x2c, 0x31,
                           0xad, 0x72, 0xf3, 0xf1, 0xc2, 0x8,  0xd5, 0xb8, 0x50, 0x25};
  uint8_t bytesprops2[] = {0x76, 0x4d, 0x47, 0x84, 0x73, 0x8f, 0xe1, 0x2d, 0xf4, 0x88, 0x3,  0x27, 0xc7, 0x5e,
                           0x4f, 0xd7, 0xd3, 0xb5, 0xeb, 0x75, 0xdd, 0x3d, 0x9d, 0x7e, 0xbd, 0x91, 0x64};
  uint8_t bytesprops1[] = {0x2d, 0x3a, 0xc0, 0x2, 0xab, 0xfc, 0x24, 0xd7, 0xc6, 0x29, 0xcc};
  uint8_t bytesprops3[] = {0x6a, 0x95, 0x9d};
  uint8_t bytesprops4[] = {0xd3, 0x49, 0x8e, 0xf4, 0xb0, 0x3,  0xc7, 0xdf, 0x1a, 0xf5, 0xbc,
                           0x6c, 0xcf, 0x6f, 0x22, 0x8d, 0xae, 0x56, 0xed, 0x92, 0x78, 0xc9};
  uint8_t bytesprops5[] = {0xf, 0x6f, 0xcb, 0x22, 0xb0, 0xbb, 0x11, 0xb3, 0x49, 0x22};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13896}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22435}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13964}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11550}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31812}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25699}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4043}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14577}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21448}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31421}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15054, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// ",\210m\249\173\143u\208k\181Kou]5\211\141\204M\133+$\153", _pubPktID = 0, _pubBody = "\154\157s\228", _pubProps =
// [PropSessionExpiryInterval 6761,PropReceiveMaximum 25461,PropSubscriptionIdentifier 29,PropMaximumPacketSize
// 956,PropResponseInformation
// "\DLEL&\177\178\193\134\189\214\131\&9\139\SI\182L\177dH\237\160#\143\178\EM\199$E",PropSubscriptionIdentifierAvailable
// 210,PropAuthenticationData "!/",PropAuthenticationMethod "\ETB<\173\DC20\f7\163
// \NAK(\195\166\237Wa?W0Wo\US\135\139\ENQ",PropContentType
// "\169\246\SUBA\220\157{Yj\136:m\140#\251\144\&7K\128\219\SO",PropAssignedClientIdentifier
// ">\207",PropAuthenticationMethod "",PropUserProperty "X\211\SIY"
// "Q\203\192\221\167\162U\204\226]X\DC1)4\170+\158\187\&4",PropAuthenticationMethod "8|N\RSd\SYN",PropRetainAvailable
// 86,PropPayloadFormatIndicator 113,PropMessageExpiryInterval 29994,PropTopicAlias 6445,PropSessionExpiryInterval
// 20260,PropMessageExpiryInterval 14963,PropRetainAvailable 23,PropMessageExpiryInterval
// 13983,PropRequestResponseInformation 103,PropMaximumPacketSize 8958,PropTopicAliasMaximum
// 13547,PropMessageExpiryInterval 23419,PropServerReference "\135\195\156Z",PropPayloadFormatIndicator
// 143,PropRequestResponseInformation 0,PropReasonString "\228\233"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x38, 0xf0, 0x1,  0x0,  0x17, 0x2c, 0xd2, 0x6d, 0xf9, 0xad, 0x8f, 0x75, 0xd0, 0x6b, 0xb5, 0x4b, 0x6f, 0x75, 0x5d,
      0x35, 0xd3, 0x8d, 0xcc, 0x4d, 0x85, 0x2b, 0x24, 0x99, 0xd1, 0x1,  0x11, 0x0,  0x0,  0x1a, 0x69, 0x21, 0x63, 0x75,
      0xb,  0x1d, 0x27, 0x0,  0x0,  0x3,  0xbc, 0x1a, 0x0,  0x1b, 0x10, 0x4c, 0x26, 0xb1, 0xb2, 0xc1, 0x86, 0xbd, 0xd6,
      0x83, 0x39, 0x8b, 0xf,  0xb6, 0x4c, 0xb1, 0x64, 0x48, 0xed, 0xa0, 0x23, 0x8f, 0xb2, 0x19, 0xc7, 0x24, 0x45, 0x29,
      0xd2, 0x16, 0x0,  0x2,  0x21, 0x2f, 0x15, 0x0,  0x19, 0x17, 0x3c, 0xad, 0x12, 0x30, 0xc,  0x37, 0xa3, 0x20, 0x15,
      0x28, 0xc3, 0xa6, 0xed, 0x57, 0x61, 0x3f, 0x57, 0x30, 0x57, 0x6f, 0x1f, 0x87, 0x8b, 0x5,  0x3,  0x0,  0x15, 0xa9,
      0xf6, 0x1a, 0x41, 0xdc, 0x9d, 0x7b, 0x59, 0x6a, 0x88, 0x3a, 0x6d, 0x8c, 0x23, 0xfb, 0x90, 0x37, 0x4b, 0x80, 0xdb,
      0xe,  0x12, 0x0,  0x2,  0x3e, 0xcf, 0x15, 0x0,  0x0,  0x26, 0x0,  0x4,  0x58, 0xd3, 0xf,  0x59, 0x0,  0x13, 0x51,
      0xcb, 0xc0, 0xdd, 0xa7, 0xa2, 0x55, 0xcc, 0xe2, 0x5d, 0x58, 0x11, 0x29, 0x34, 0xaa, 0x2b, 0x9e, 0xbb, 0x34, 0x15,
      0x0,  0x6,  0x38, 0x7c, 0x4e, 0x1e, 0x64, 0x16, 0x25, 0x56, 0x1,  0x71, 0x2,  0x0,  0x0,  0x75, 0x2a, 0x23, 0x19,
      0x2d, 0x11, 0x0,  0x0,  0x4f, 0x24, 0x2,  0x0,  0x0,  0x3a, 0x73, 0x25, 0x17, 0x2,  0x0,  0x0,  0x36, 0x9f, 0x19,
      0x67, 0x27, 0x0,  0x0,  0x22, 0xfe, 0x22, 0x34, 0xeb, 0x2,  0x0,  0x0,  0x5b, 0x7b, 0x1c, 0x0,  0x4,  0x87, 0xc3,
      0x9c, 0x5a, 0x1,  0x8f, 0x19, 0x0,  0x1f, 0x0,  0x2,  0xe4, 0xe9, 0x9a, 0x9d, 0x73, 0xe4};

  uint8_t buf[253] = {0};

  uint8_t topic_bytes[] = {0x2c, 0xd2, 0x6d, 0xf9, 0xad, 0x8f, 0x75, 0xd0, 0x6b, 0xb5, 0x4b, 0x6f,
                           0x75, 0x5d, 0x35, 0xd3, 0x8d, 0xcc, 0x4d, 0x85, 0x2b, 0x24, 0x99};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0x9d, 0x73, 0xe4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0x10, 0x4c, 0x26, 0xb1, 0xb2, 0xc1, 0x86, 0xbd, 0xd6, 0x83, 0x39, 0x8b, 0xf, 0xb6,
                           0x4c, 0xb1, 0x64, 0x48, 0xed, 0xa0, 0x23, 0x8f, 0xb2, 0x19, 0xc7, 0x24, 0x45};
  uint8_t bytesprops1[] = {0x21, 0x2f};
  uint8_t bytesprops2[] = {0x17, 0x3c, 0xad, 0x12, 0x30, 0xc,  0x37, 0xa3, 0x20, 0x15, 0x28, 0xc3, 0xa6,
                           0xed, 0x57, 0x61, 0x3f, 0x57, 0x30, 0x57, 0x6f, 0x1f, 0x87, 0x8b, 0x5};
  uint8_t bytesprops3[] = {0xa9, 0xf6, 0x1a, 0x41, 0xdc, 0x9d, 0x7b, 0x59, 0x6a, 0x88, 0x3a,
                           0x6d, 0x8c, 0x23, 0xfb, 0x90, 0x37, 0x4b, 0x80, 0xdb, 0xe};
  uint8_t bytesprops4[] = {0x3e, 0xcf};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops7[] = {0x51, 0xcb, 0xc0, 0xdd, 0xa7, 0xa2, 0x55, 0xcc, 0xe2, 0x5d,
                           0x58, 0x11, 0x29, 0x34, 0xaa, 0x2b, 0x9e, 0xbb, 0x34};
  uint8_t bytesprops6[] = {0x58, 0xd3, 0xf, 0x59};
  uint8_t bytesprops8[] = {0x38, 0x7c, 0x4e, 0x1e, 0x64, 0x16};
  uint8_t bytesprops9[] = {0x87, 0xc3, 0x9c, 0x5a};
  uint8_t bytesprops10[] = {0xe4, 0xe9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6761}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25461}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 956}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops6}, .v = {19, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29994}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6445}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20260}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14963}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13983}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8958}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13547}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23419}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\NUL\DEL\203\RS\240:\141&\173E\160ge\161\253\204@\CANsE\DC4\250-\170\139\170\173", _pubPktID = 16148, _pubBody =
// "\217\SOH\255\&9\132\DC1ce\133\DLE\176\244\r\ti\207a\239X\210\160\160\224v\216\t", _pubProps =
// [PropWildcardSubscriptionAvailable 154,PropCorrelationData "\191r\216",PropMessageExpiryInterval
// 24076,PropAuthenticationData "G1\138V\146\SO",PropSubscriptionIdentifierAvailable 148,PropRequestProblemInformation
// 135,PropWillDelayInterval 31841,PropMaximumQoS 13,PropAuthenticationData
// "\151\163B\254\223\172\ETB",PropRequestResponseInformation 190,PropSessionExpiryInterval 4965,PropUserProperty
// "q\131C \NAK\236\142\210\148\230" "\251\226\r\US\196,.\RS`R1}\DC2s\143\n",PropWildcardSubscriptionAvailable
// 0,PropTopicAlias 13696,PropAuthenticationData
// "j\171\243\197\NUL\173&\172\148\176\215Md\174\\\246\ACK1\132",PropMessageExpiryInterval 7797,PropAuthenticationData
// "\\]>\164\143",PropSubscriptionIdentifierAvailable 133,PropRequestResponseInformation 196,PropMessageExpiryInterval
// 8000,PropRetainAvailable 41,PropContentType "\186H\129\176\NAK\238\tB\ENQ3\158n\143\178\175\180\145\t\218\144\222vVl
// -",PropRetainAvailable 95]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x3a, 0xde, 0x1,  0x0,  0x1b, 0x0,  0x7f, 0xcb, 0x1e, 0xf0, 0x3a, 0x8d, 0x26, 0xad, 0x45, 0xa0, 0x67, 0x65, 0xa1,
      0xfd, 0xcc, 0x40, 0x18, 0x73, 0x45, 0x14, 0xfa, 0x2d, 0xaa, 0x8b, 0xaa, 0xad, 0x3f, 0x14, 0xa3, 0x1,  0x28, 0x9a,
      0x9,  0x0,  0x3,  0xbf, 0x72, 0xd8, 0x2,  0x0,  0x0,  0x5e, 0xc,  0x16, 0x0,  0x6,  0x47, 0x31, 0x8a, 0x56, 0x92,
      0xe,  0x29, 0x94, 0x17, 0x87, 0x18, 0x0,  0x0,  0x7c, 0x61, 0x24, 0xd,  0x16, 0x0,  0x7,  0x97, 0xa3, 0x42, 0xfe,
      0xdf, 0xac, 0x17, 0x19, 0xbe, 0x11, 0x0,  0x0,  0x13, 0x65, 0x26, 0x0,  0xa,  0x71, 0x83, 0x43, 0x20, 0x15, 0xec,
      0x8e, 0xd2, 0x94, 0xe6, 0x0,  0x10, 0xfb, 0xe2, 0xd,  0x1f, 0xc4, 0x2c, 0x2e, 0x1e, 0x60, 0x52, 0x31, 0x7d, 0x12,
      0x73, 0x8f, 0xa,  0x28, 0x0,  0x23, 0x35, 0x80, 0x16, 0x0,  0x13, 0x6a, 0xab, 0xf3, 0xc5, 0x0,  0xad, 0x26, 0xac,
      0x94, 0xb0, 0xd7, 0x4d, 0x64, 0xae, 0x5c, 0xf6, 0x6,  0x31, 0x84, 0x2,  0x0,  0x0,  0x1e, 0x75, 0x16, 0x0,  0x5,
      0x5c, 0x5d, 0x3e, 0xa4, 0x8f, 0x29, 0x85, 0x19, 0xc4, 0x2,  0x0,  0x0,  0x1f, 0x40, 0x25, 0x29, 0x3,  0x0,  0x1a,
      0xba, 0x48, 0x81, 0xb0, 0x15, 0xee, 0x9,  0x42, 0x5,  0x33, 0x9e, 0x6e, 0x8f, 0xb2, 0xaf, 0xb4, 0x91, 0x9,  0xda,
      0x90, 0xde, 0x76, 0x56, 0x6c, 0x20, 0x2d, 0x25, 0x5f, 0xd9, 0x1,  0xff, 0x39, 0x84, 0x11, 0x63, 0x65, 0x85, 0x10,
      0xb0, 0xf4, 0xd,  0x9,  0x69, 0xcf, 0x61, 0xef, 0x58, 0xd2, 0xa0, 0xa0, 0xe0, 0x76, 0xd8, 0x9};

  uint8_t buf[235] = {0};

  uint8_t topic_bytes[] = {0x0,  0x7f, 0xcb, 0x1e, 0xf0, 0x3a, 0x8d, 0x26, 0xad, 0x45, 0xa0, 0x67, 0x65, 0xa1,
                           0xfd, 0xcc, 0x40, 0x18, 0x73, 0x45, 0x14, 0xfa, 0x2d, 0xaa, 0x8b, 0xaa, 0xad};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd9, 0x1,  0xff, 0x39, 0x84, 0x11, 0x63, 0x65, 0x85, 0x10, 0xb0, 0xf4, 0xd,
                         0x9,  0x69, 0xcf, 0x61, 0xef, 0x58, 0xd2, 0xa0, 0xa0, 0xe0, 0x76, 0xd8, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xbf, 0x72, 0xd8};
  uint8_t bytesprops1[] = {0x47, 0x31, 0x8a, 0x56, 0x92, 0xe};
  uint8_t bytesprops2[] = {0x97, 0xa3, 0x42, 0xfe, 0xdf, 0xac, 0x17};
  uint8_t bytesprops4[] = {0xfb, 0xe2, 0xd,  0x1f, 0xc4, 0x2c, 0x2e, 0x1e,
                           0x60, 0x52, 0x31, 0x7d, 0x12, 0x73, 0x8f, 0xa};
  uint8_t bytesprops3[] = {0x71, 0x83, 0x43, 0x20, 0x15, 0xec, 0x8e, 0xd2, 0x94, 0xe6};
  uint8_t bytesprops5[] = {0x6a, 0xab, 0xf3, 0xc5, 0x0,  0xad, 0x26, 0xac, 0x94, 0xb0,
                           0xd7, 0x4d, 0x64, 0xae, 0x5c, 0xf6, 0x6,  0x31, 0x84};
  uint8_t bytesprops6[] = {0x5c, 0x5d, 0x3e, 0xa4, 0x8f};
  uint8_t bytesprops7[] = {0xba, 0x48, 0x81, 0xb0, 0x15, 0xee, 0x9,  0x42, 0x5,  0x33, 0x9e, 0x6e, 0x8f,
                           0xb2, 0xaf, 0xb4, 0x91, 0x9,  0xda, 0x90, 0xde, 0x76, 0x56, 0x6c, 0x20, 0x2d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24076}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31841}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4965}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops3}, .v = {16, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13696}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7797}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8000}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16148, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\225\180\242F\ENQ\203\138\241\216i%\241\223n\157\150\bT\255", _pubPktID = 0, _pubBody = "'", _pubProps =
// [PropSharedSubscriptionAvailable 118,PropReasonString "$g\220\202=\249}",PropContentType
// "\230\237-\186\DLE\158\ACK(\231\187\136i\194%\238\131\200",PropAuthenticationData
// ">*\NAK9\254W\137i\244@\252:@[",PropCorrelationData "OpE\199\243\"z\164\"\239\216\161{\237e\USH\237",PropUserProperty
// "" "\163T\203\128f",PropReceiveMaximum 10674,PropSubscriptionIdentifier 28,PropSharedSubscriptionAvailable
// 40,PropContentType "7\253\&7\132\134\227\168z\247\176",PropMaximumQoS 81,PropMaximumQoS
// 252,PropAssignedClientIdentifier "i:}k\230\196\190\ETXg\SI",PropTopicAlias 24243,PropReasonString
// "\249\234n\235\146G\210",PropAssignedClientIdentifier "\232~\206\136\FS\244\EOT
// \206\150\251@\140\180\176\192\aca\156",PropMessageExpiryInterval 30666,PropSubscriptionIdentifierAvailable
// 184,PropContentType "\t\209H\246K\b4R\160#\200\223z\SOH&\153\&6i\142\203#\199@C",PropServerKeepAlive
// 5395,PropResponseTopic "\228\251\216Q\207+\163\224\184\252\173",PropMessageExpiryInterval 203,PropResponseInformation
// "",PropServerKeepAlive 2025,PropWillDelayInterval 31464,PropUserProperty
// "\135\194\DC49\149\NAK3\193$\ACK\245\208\&6Y\173\223\214I" "\228\147",PropMessageExpiryInterval
// 4928,PropRetainAvailable 255,PropRetainAvailable 156,PropWillDelayInterval 28241]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {0x30, 0x9b, 0x2,  0x0,  0x13, 0xe1, 0xb4, 0xf2, 0x46, 0x5,  0xcb, 0x8a, 0xf1, 0xd8, 0x69, 0x25, 0xf1,
                   0xdf, 0x6e, 0x9d, 0x96, 0x8,  0x54, 0xff, 0x83, 0x2,  0x2a, 0x76, 0x1f, 0x0,  0x7,  0x24, 0x67, 0xdc,
                   0xca, 0x3d, 0xf9, 0x7d, 0x3,  0x0,  0x11, 0xe6, 0xed, 0x2d, 0xba, 0x10, 0x9e, 0x6,  0x28, 0xe7, 0xbb,
                   0x88, 0x69, 0xc2, 0x25, 0xee, 0x83, 0xc8, 0x16, 0x0,  0xe,  0x3e, 0x2a, 0x15, 0x39, 0xfe, 0x57, 0x89,
                   0x69, 0xf4, 0x40, 0xfc, 0x3a, 0x40, 0x5b, 0x9,  0x0,  0x12, 0x4f, 0x70, 0x45, 0xc7, 0xf3, 0x22, 0x7a,
                   0xa4, 0x22, 0xef, 0xd8, 0xa1, 0x7b, 0xed, 0x65, 0x1f, 0x48, 0xed, 0x26, 0x0,  0x0,  0x0,  0x5,  0xa3,
                   0x54, 0xcb, 0x80, 0x66, 0x21, 0x29, 0xb2, 0xb,  0x1c, 0x2a, 0x28, 0x3,  0x0,  0xa,  0x37, 0xfd, 0x37,
                   0x84, 0x86, 0xe3, 0xa8, 0x7a, 0xf7, 0xb0, 0x24, 0x51, 0x24, 0xfc, 0x12, 0x0,  0xa,  0x69, 0x3a, 0x7d,
                   0x6b, 0xe6, 0xc4, 0xbe, 0x3,  0x67, 0xf,  0x23, 0x5e, 0xb3, 0x1f, 0x0,  0x7,  0xf9, 0xea, 0x6e, 0xeb,
                   0x92, 0x47, 0xd2, 0x12, 0x0,  0x14, 0xe8, 0x7e, 0xce, 0x88, 0x1c, 0xf4, 0x4,  0x20, 0xce, 0x96, 0xfb,
                   0x40, 0x8c, 0xb4, 0xb0, 0xc0, 0x7,  0x63, 0x61, 0x9c, 0x2,  0x0,  0x0,  0x77, 0xca, 0x29, 0xb8, 0x3,
                   0x0,  0x18, 0x9,  0xd1, 0x48, 0xf6, 0x4b, 0x8,  0x34, 0x52, 0xa0, 0x23, 0xc8, 0xdf, 0x7a, 0x1,  0x26,
                   0x99, 0x36, 0x69, 0x8e, 0xcb, 0x23, 0xc7, 0x40, 0x43, 0x13, 0x15, 0x13, 0x8,  0x0,  0xb,  0xe4, 0xfb,
                   0xd8, 0x51, 0xcf, 0x2b, 0xa3, 0xe0, 0xb8, 0xfc, 0xad, 0x2,  0x0,  0x0,  0x0,  0xcb, 0x1a, 0x0,  0x0,
                   0x13, 0x7,  0xe9, 0x18, 0x0,  0x0,  0x7a, 0xe8, 0x26, 0x0,  0x12, 0x87, 0xc2, 0x14, 0x39, 0x95, 0x15,
                   0x33, 0xc1, 0x24, 0x6,  0xf5, 0xd0, 0x36, 0x59, 0xad, 0xdf, 0xd6, 0x49, 0x0,  0x2,  0xe4, 0x93, 0x2,
                   0x0,  0x0,  0x13, 0x40, 0x25, 0xff, 0x25, 0x9c, 0x18, 0x0,  0x0,  0x6e, 0x51, 0x27};

  uint8_t buf[296] = {0};

  uint8_t topic_bytes[] = {0xe1, 0xb4, 0xf2, 0x46, 0x5,  0xcb, 0x8a, 0xf1, 0xd8, 0x69,
                           0x25, 0xf1, 0xdf, 0x6e, 0x9d, 0x96, 0x8,  0x54, 0xff};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x24, 0x67, 0xdc, 0xca, 0x3d, 0xf9, 0x7d};
  uint8_t bytesprops1[] = {0xe6, 0xed, 0x2d, 0xba, 0x10, 0x9e, 0x6,  0x28, 0xe7,
                           0xbb, 0x88, 0x69, 0xc2, 0x25, 0xee, 0x83, 0xc8};
  uint8_t bytesprops2[] = {0x3e, 0x2a, 0x15, 0x39, 0xfe, 0x57, 0x89, 0x69, 0xf4, 0x40, 0xfc, 0x3a, 0x40, 0x5b};
  uint8_t bytesprops3[] = {0x4f, 0x70, 0x45, 0xc7, 0xf3, 0x22, 0x7a, 0xa4, 0x22,
                           0xef, 0xd8, 0xa1, 0x7b, 0xed, 0x65, 0x1f, 0x48, 0xed};
  uint8_t bytesprops5[] = {0xa3, 0x54, 0xcb, 0x80, 0x66};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops6[] = {0x37, 0xfd, 0x37, 0x84, 0x86, 0xe3, 0xa8, 0x7a, 0xf7, 0xb0};
  uint8_t bytesprops7[] = {0x69, 0x3a, 0x7d, 0x6b, 0xe6, 0xc4, 0xbe, 0x3, 0x67, 0xf};
  uint8_t bytesprops8[] = {0xf9, 0xea, 0x6e, 0xeb, 0x92, 0x47, 0xd2};
  uint8_t bytesprops9[] = {0xe8, 0x7e, 0xce, 0x88, 0x1c, 0xf4, 0x4, 0x20, 0xce, 0x96,
                           0xfb, 0x40, 0x8c, 0xb4, 0xb0, 0xc0, 0x7, 0x63, 0x61, 0x9c};
  uint8_t bytesprops10[] = {0x9,  0xd1, 0x48, 0xf6, 0x4b, 0x8,  0x34, 0x52, 0xa0, 0x23, 0xc8, 0xdf,
                            0x7a, 0x1,  0x26, 0x99, 0x36, 0x69, 0x8e, 0xcb, 0x23, 0xc7, 0x40, 0x43};
  uint8_t bytesprops11[] = {0xe4, 0xfb, 0xd8, 0x51, 0xcf, 0x2b, 0xa3, 0xe0, 0xb8, 0xfc, 0xad};
  uint8_t bytesprops12[] = {0};
  uint8_t bytesprops14[] = {0xe4, 0x93};
  uint8_t bytesprops13[] = {0x87, 0xc2, 0x14, 0x39, 0x95, 0x15, 0x33, 0xc1, 0x24,
                            0x6,  0xf5, 0xd0, 0x36, 0x59, 0xad, 0xdf, 0xd6, 0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops4}, .v = {5, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10674}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24243}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30666}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5395}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 203}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2025}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31464}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops13}, .v = {2, (char*)&bytesprops14}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4928}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28241}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\206\166\&9}z\170\226\207\169\157\f{\160_\198\DEL\151\NAK'|\145", _pubPktID = 0, _pubBody = "\178\190\186$\148^\SO
// Y\222\245\255\204\180\166\231cl\175A\164x\152\234W\209\251\249\n`", _pubProps = [PropAuthenticationMethod
// "\SYN\201\191\145\165\203",PropContentType
// "4n\152\243)\215\212\204\149\175\DLE\204*}\186\210\NUL\193qY\206\&1L?}>\DC2\216",PropUserProperty "n\227OB\139
// \195+\a\186F\159C\DC1.H\f\209\168o\252\160O\SUB\220qg\246"
// "\239\DC2F\134\174;\166\144v(pO\252\128\243",PropMaximumPacketSize 19354,PropContentType
// "\141",PropAuthenticationMethod
// "\149(\DELw\\\208\192\232^\232\240\190P\SYN]Y$\179\186\199M!\206\176",PropSubscriptionIdentifierAvailable
// 68,PropResponseTopic "\184\225,\172/G\234u\159[k\232\DLE\169\ne\DC4A\153\246\DLE",PropTopicAlias
// 14033,PropResponseInformation "m11\187\NULN\199^\192CO\237",PropMaximumPacketSize 5887,PropAuthenticationMethod
// "{\143\167\a\180\212\198\230\242\214\254|\222dj\f{\219\140\238x8\150",PropSharedSubscriptionAvailable
// 71,PropWildcardSubscriptionAvailable 139,PropSessionExpiryInterval 24881,PropRequestResponseInformation
// 105,PropMaximumQoS 233,PropWillDelayInterval 32182,PropSessionExpiryInterval 15444,PropAuthenticationMethod
// "\141\RS$",PropWildcardSubscriptionAvailable 69,PropWillDelayInterval 18160,PropReceiveMaximum
// 7546,PropAuthenticationMethod "\215\138g\131\227",PropRequestProblemInformation 32,PropAuthenticationMethod
// "\220\GS\249,~\206NI22b^4S\240\254\137\155\DEL\EOT2\196\SOG\129\149",PropTopicAlias 29532,PropServerReference
// "\194"]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x31, 0xd3, 0x2,  0x0,  0x15, 0xce, 0xa6, 0x39, 0x7d, 0x7a, 0xaa, 0xe2, 0xcf, 0xa9, 0x9d, 0xc,  0x7b, 0xa0, 0x5f,
      0xc6, 0x7f, 0x97, 0x15, 0x27, 0x7c, 0x91, 0x9c, 0x2,  0x15, 0x0,  0x6,  0x16, 0xc9, 0xbf, 0x91, 0xa5, 0xcb, 0x3,
      0x0,  0x1c, 0x34, 0x6e, 0x98, 0xf3, 0x29, 0xd7, 0xd4, 0xcc, 0x95, 0xaf, 0x10, 0xcc, 0x2a, 0x7d, 0xba, 0xd2, 0x0,
      0xc1, 0x71, 0x59, 0xce, 0x31, 0x4c, 0x3f, 0x7d, 0x3e, 0x12, 0xd8, 0x26, 0x0,  0x1c, 0x6e, 0xe3, 0x4f, 0x42, 0x8b,
      0x20, 0xc3, 0x2b, 0x7,  0xba, 0x46, 0x9f, 0x43, 0x11, 0x2e, 0x48, 0xc,  0xd1, 0xa8, 0x6f, 0xfc, 0xa0, 0x4f, 0x1a,
      0xdc, 0x71, 0x67, 0xf6, 0x0,  0xf,  0xef, 0x12, 0x46, 0x86, 0xae, 0x3b, 0xa6, 0x90, 0x76, 0x28, 0x70, 0x4f, 0xfc,
      0x80, 0xf3, 0x27, 0x0,  0x0,  0x4b, 0x9a, 0x3,  0x0,  0x1,  0x8d, 0x15, 0x0,  0x18, 0x95, 0x28, 0x7f, 0x77, 0x5c,
      0xd0, 0xc0, 0xe8, 0x5e, 0xe8, 0xf0, 0xbe, 0x50, 0x16, 0x5d, 0x59, 0x24, 0xb3, 0xba, 0xc7, 0x4d, 0x21, 0xce, 0xb0,
      0x29, 0x44, 0x8,  0x0,  0x15, 0xb8, 0xe1, 0x2c, 0xac, 0x2f, 0x47, 0xea, 0x75, 0x9f, 0x5b, 0x6b, 0xe8, 0x10, 0xa9,
      0xa,  0x65, 0x14, 0x41, 0x99, 0xf6, 0x10, 0x23, 0x36, 0xd1, 0x1a, 0x0,  0xc,  0x6d, 0x31, 0x31, 0xbb, 0x0,  0x4e,
      0xc7, 0x5e, 0xc0, 0x43, 0x4f, 0xed, 0x27, 0x0,  0x0,  0x16, 0xff, 0x15, 0x0,  0x17, 0x7b, 0x8f, 0xa7, 0x7,  0xb4,
      0xd4, 0xc6, 0xe6, 0xf2, 0xd6, 0xfe, 0x7c, 0xde, 0x64, 0x6a, 0xc,  0x7b, 0xdb, 0x8c, 0xee, 0x78, 0x38, 0x96, 0x2a,
      0x47, 0x28, 0x8b, 0x11, 0x0,  0x0,  0x61, 0x31, 0x19, 0x69, 0x24, 0xe9, 0x18, 0x0,  0x0,  0x7d, 0xb6, 0x11, 0x0,
      0x0,  0x3c, 0x54, 0x15, 0x0,  0x3,  0x8d, 0x1e, 0x24, 0x28, 0x45, 0x18, 0x0,  0x0,  0x46, 0xf0, 0x21, 0x1d, 0x7a,
      0x15, 0x0,  0x5,  0xd7, 0x8a, 0x67, 0x83, 0xe3, 0x17, 0x20, 0x15, 0x0,  0x1a, 0xdc, 0x1d, 0xf9, 0x2c, 0x7e, 0xce,
      0x4e, 0x49, 0x32, 0x32, 0x62, 0x5e, 0x34, 0x53, 0xf0, 0xfe, 0x89, 0x9b, 0x7f, 0x4,  0x32, 0xc4, 0xe,  0x47, 0x81,
      0x95, 0x23, 0x73, 0x5c, 0x1c, 0x0,  0x1,  0xc2, 0xb2, 0xbe, 0xba, 0x24, 0x94, 0x5e, 0xe,  0x20, 0x59, 0xde, 0xf5,
      0xff, 0xcc, 0xb4, 0xa6, 0xe7, 0x63, 0x6c, 0xaf, 0x41, 0xa4, 0x78, 0x98, 0xea, 0x57, 0xd1, 0xfb, 0xf9, 0xa,  0x60};

  uint8_t buf[352] = {0};

  uint8_t topic_bytes[] = {0xce, 0xa6, 0x39, 0x7d, 0x7a, 0xaa, 0xe2, 0xcf, 0xa9, 0x9d, 0xc,
                           0x7b, 0xa0, 0x5f, 0xc6, 0x7f, 0x97, 0x15, 0x27, 0x7c, 0x91};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2, 0xbe, 0xba, 0x24, 0x94, 0x5e, 0xe,  0x20, 0x59, 0xde, 0xf5, 0xff, 0xcc, 0xb4, 0xa6,
                         0xe7, 0x63, 0x6c, 0xaf, 0x41, 0xa4, 0x78, 0x98, 0xea, 0x57, 0xd1, 0xfb, 0xf9, 0xa,  0x60};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0x16, 0xc9, 0xbf, 0x91, 0xa5, 0xcb};
  uint8_t bytesprops1[] = {0x34, 0x6e, 0x98, 0xf3, 0x29, 0xd7, 0xd4, 0xcc, 0x95, 0xaf, 0x10, 0xcc, 0x2a, 0x7d,
                           0xba, 0xd2, 0x0,  0xc1, 0x71, 0x59, 0xce, 0x31, 0x4c, 0x3f, 0x7d, 0x3e, 0x12, 0xd8};
  uint8_t bytesprops3[] = {0xef, 0x12, 0x46, 0x86, 0xae, 0x3b, 0xa6, 0x90, 0x76, 0x28, 0x70, 0x4f, 0xfc, 0x80, 0xf3};
  uint8_t bytesprops2[] = {0x6e, 0xe3, 0x4f, 0x42, 0x8b, 0x20, 0xc3, 0x2b, 0x7,  0xba, 0x46, 0x9f, 0x43, 0x11,
                           0x2e, 0x48, 0xc,  0xd1, 0xa8, 0x6f, 0xfc, 0xa0, 0x4f, 0x1a, 0xdc, 0x71, 0x67, 0xf6};
  uint8_t bytesprops4[] = {0x8d};
  uint8_t bytesprops5[] = {0x95, 0x28, 0x7f, 0x77, 0x5c, 0xd0, 0xc0, 0xe8, 0x5e, 0xe8, 0xf0, 0xbe,
                           0x50, 0x16, 0x5d, 0x59, 0x24, 0xb3, 0xba, 0xc7, 0x4d, 0x21, 0xce, 0xb0};
  uint8_t bytesprops6[] = {0xb8, 0xe1, 0x2c, 0xac, 0x2f, 0x47, 0xea, 0x75, 0x9f, 0x5b, 0x6b,
                           0xe8, 0x10, 0xa9, 0xa,  0x65, 0x14, 0x41, 0x99, 0xf6, 0x10};
  uint8_t bytesprops7[] = {0x6d, 0x31, 0x31, 0xbb, 0x0, 0x4e, 0xc7, 0x5e, 0xc0, 0x43, 0x4f, 0xed};
  uint8_t bytesprops8[] = {0x7b, 0x8f, 0xa7, 0x7, 0xb4, 0xd4, 0xc6, 0xe6, 0xf2, 0xd6, 0xfe, 0x7c,
                           0xde, 0x64, 0x6a, 0xc, 0x7b, 0xdb, 0x8c, 0xee, 0x78, 0x38, 0x96};
  uint8_t bytesprops9[] = {0x8d, 0x1e, 0x24};
  uint8_t bytesprops10[] = {0xd7, 0x8a, 0x67, 0x83, 0xe3};
  uint8_t bytesprops11[] = {0xdc, 0x1d, 0xf9, 0x2c, 0x7e, 0xce, 0x4e, 0x49, 0x32, 0x32, 0x62, 0x5e, 0x34,
                            0x53, 0xf0, 0xfe, 0x89, 0x9b, 0x7f, 0x4,  0x32, 0xc4, 0xe,  0x47, 0x81, 0x95};
  uint8_t bytesprops12[] = {0xc2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops2}, .v = {15, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19354}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14033}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5887}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24881}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32182}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15444}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18160}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7546}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29532}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\225\242\168", _pubPktID = 30037,
// _pubBody = "\216-7\221q<\RS\"U\210-\130\232\161\248)\248\169\151", _pubProps = [PropRetainAvailable
// 149,PropMaximumQoS 109,PropResponseInformation "\191\207\DLE",PropMessageExpiryInterval
// 32121,PropWildcardSubscriptionAvailable 88,PropResponseTopic
// "\215\FS\"\249\139\186\219\220|\184\230N8'\225()\ESC\193"]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {0x3a, 0x42, 0x0,  0x3,  0xe1, 0xf2, 0xa8, 0x75, 0x55, 0x27, 0x25, 0x95, 0x24, 0x6d,
                   0x1a, 0x0,  0x3,  0xbf, 0xcf, 0x10, 0x2,  0x0,  0x0,  0x7d, 0x79, 0x28, 0x58, 0x8,
                   0x0,  0x13, 0xd7, 0x1c, 0x22, 0xf9, 0x8b, 0xba, 0xdb, 0xdc, 0x7c, 0xb8, 0xe6, 0x4e,
                   0x38, 0x27, 0xe1, 0x28, 0x29, 0x1b, 0xc1, 0xd8, 0x2d, 0x37, 0xdd, 0x71, 0x3c, 0x1e,
                   0x22, 0x55, 0xd2, 0x2d, 0x82, 0xe8, 0xa1, 0xf8, 0x29, 0xf8, 0xa9, 0x97};

  uint8_t buf[78] = {0};

  uint8_t topic_bytes[] = {0xe1, 0xf2, 0xa8};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd8, 0x2d, 0x37, 0xdd, 0x71, 0x3c, 0x1e, 0x22, 0x55, 0xd2,
                         0x2d, 0x82, 0xe8, 0xa1, 0xf8, 0x29, 0xf8, 0xa9, 0x97};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xbf, 0xcf, 0x10};
  uint8_t bytesprops1[] = {0xd7, 0x1c, 0x22, 0xf9, 0x8b, 0xba, 0xdb, 0xdc, 0x7c, 0xb8,
                           0xe6, 0x4e, 0x38, 0x27, 0xe1, 0x28, 0x29, 0x1b, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32121}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 30037, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\209\144\244\190\138\251", _pubPktID
// = 1548, _pubBody = "", _pubProps = [PropMaximumPacketSize 10765,PropAssignedClientIdentifier
// "u\161e\154\RS?\SI\212E\NAK\ESCJ\217\172\231\247}\246#\198\231(",PropResponseInformation
// "8\190\199\r`\EM\219\&0`\162{\184\151\197\239\151\137\129",PropResponseTopic "R",PropSessionExpiryInterval
// 22783,PropMessageExpiryInterval 1022,PropCorrelationData "G\207C\USCW",PropUserProperty
// "\221\155S>r\US\202\160W\137y\208\238\195)\GS\238\144\&6" "m\184",PropSessionExpiryInterval 25105,PropCorrelationData
// "\191\vA\CAN\161S\129\255r=ER1\236\157\US\223N\221\n\176\&7_\186\194\245\234"]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {0x3c, 0x93, 0x1,  0x0,  0x6,  0xd1, 0x90, 0xf4, 0xbe, 0x8a, 0xfb, 0x6,  0xc,  0x87, 0x1,  0x27, 0x0,
                   0x0,  0x2a, 0xd,  0x12, 0x0,  0x16, 0x75, 0xa1, 0x65, 0x9a, 0x1e, 0x3f, 0xf,  0xd4, 0x45, 0x15, 0x1b,
                   0x4a, 0xd9, 0xac, 0xe7, 0xf7, 0x7d, 0xf6, 0x23, 0xc6, 0xe7, 0x28, 0x1a, 0x0,  0x12, 0x38, 0xbe, 0xc7,
                   0xd,  0x60, 0x19, 0xdb, 0x30, 0x60, 0xa2, 0x7b, 0xb8, 0x97, 0xc5, 0xef, 0x97, 0x89, 0x81, 0x8,  0x0,
                   0x1,  0x52, 0x11, 0x0,  0x0,  0x58, 0xff, 0x2,  0x0,  0x0,  0x3,  0xfe, 0x9,  0x0,  0x6,  0x47, 0xcf,
                   0x43, 0x1f, 0x43, 0x57, 0x26, 0x0,  0x13, 0xdd, 0x9b, 0x53, 0x3e, 0x72, 0x1f, 0xca, 0xa0, 0x57, 0x89,
                   0x79, 0xd0, 0xee, 0xc3, 0x29, 0x1d, 0xee, 0x90, 0x36, 0x0,  0x2,  0x6d, 0xb8, 0x11, 0x0,  0x0,  0x62,
                   0x11, 0x9,  0x0,  0x1b, 0xbf, 0xb,  0x41, 0x18, 0xa1, 0x53, 0x81, 0xff, 0x72, 0x3d, 0x45, 0x52, 0x31,
                   0xec, 0x9d, 0x1f, 0xdf, 0x4e, 0xdd, 0xa,  0xb0, 0x37, 0x5f, 0xba, 0xc2, 0xf5, 0xea};

  uint8_t buf[160] = {0};

  uint8_t topic_bytes[] = {0xd1, 0x90, 0xf4, 0xbe, 0x8a, 0xfb};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x75, 0xa1, 0x65, 0x9a, 0x1e, 0x3f, 0xf,  0xd4, 0x45, 0x15, 0x1b,
                           0x4a, 0xd9, 0xac, 0xe7, 0xf7, 0x7d, 0xf6, 0x23, 0xc6, 0xe7, 0x28};
  uint8_t bytesprops1[] = {0x38, 0xbe, 0xc7, 0xd,  0x60, 0x19, 0xdb, 0x30, 0x60,
                           0xa2, 0x7b, 0xb8, 0x97, 0xc5, 0xef, 0x97, 0x89, 0x81};
  uint8_t bytesprops2[] = {0x52};
  uint8_t bytesprops3[] = {0x47, 0xcf, 0x43, 0x1f, 0x43, 0x57};
  uint8_t bytesprops5[] = {0x6d, 0xb8};
  uint8_t bytesprops4[] = {0xdd, 0x9b, 0x53, 0x3e, 0x72, 0x1f, 0xca, 0xa0, 0x57, 0x89,
                           0x79, 0xd0, 0xee, 0xc3, 0x29, 0x1d, 0xee, 0x90, 0x36};
  uint8_t bytesprops6[] = {0xbf, 0xb,  0x41, 0x18, 0xa1, 0x53, 0x81, 0xff, 0x72, 0x3d, 0x45, 0x52, 0x31, 0xec,
                           0x9d, 0x1f, 0xdf, 0x4e, 0xdd, 0xa,  0xb0, 0x37, 0x5f, 0xba, 0xc2, 0xf5, 0xea};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10765}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22783}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1022}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25105}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1548, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\136\140\179}\STX;", _pubPktID =
// 6476, _pubBody = "Jj\SO\241\ENQ\137\DC1", _pubProps = [PropAuthenticationData
// "7\208\172)\143\239",PropMessageExpiryInterval 14862,PropMaximumPacketSize 7271,PropResponseTopic
// "\145\169Bn'",PropCorrelationData "\205\221\229\194\205\195B\162\170\166\248\239>\EOT",PropSubscriptionIdentifier
// 11,PropServerKeepAlive 3502,PropAuthenticationMethod
// "\231\188*I\DC1\211E\139\224\222\DLE\bE\141\f\220\157\&7[P\ETX\130O:\233j\223\207",PropWillDelayInterval
// 25003,PropAuthenticationData "\\g-",PropResponseTopic
// "7\248\"\198\245\216x\144\247\173&8\164&e\SOH\152\226i\225\239\238s",PropRequestResponseInformation
// 142,PropMaximumPacketSize 9884,PropSubscriptionIdentifierAvailable 226,PropResponseTopic "",PropResponseTopic
// "\140W\224\230\217@\176\254\162\161\157\201\135\138\153\GS",PropResponseTopic
// "\177\238\190k\SIb\170",PropReasonString "\239\SOH\204\154\193",PropSharedSubscriptionAvailable 52]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x35, 0xbc, 0x1,  0x0,  0x7,  0xfd, 0x88, 0x8c, 0xb3, 0x7d, 0x2,  0x3b, 0x19, 0x4c, 0xa8, 0x1,
                   0x16, 0x0,  0x6,  0x37, 0xd0, 0xac, 0x29, 0x8f, 0xef, 0x2,  0x0,  0x0,  0x3a, 0xe,  0x27, 0x0,
                   0x0,  0x1c, 0x67, 0x8,  0x0,  0x5,  0x91, 0xa9, 0x42, 0x6e, 0x27, 0x9,  0x0,  0xe,  0xcd, 0xdd,
                   0xe5, 0xc2, 0xcd, 0xc3, 0x42, 0xa2, 0xaa, 0xa6, 0xf8, 0xef, 0x3e, 0x4,  0xb,  0xb,  0x13, 0xd,
                   0xae, 0x15, 0x0,  0x1c, 0xe7, 0xbc, 0x2a, 0x49, 0x11, 0xd3, 0x45, 0x8b, 0xe0, 0xde, 0x10, 0x8,
                   0x45, 0x8d, 0xc,  0xdc, 0x9d, 0x37, 0x5b, 0x50, 0x3,  0x82, 0x4f, 0x3a, 0xe9, 0x6a, 0xdf, 0xcf,
                   0x18, 0x0,  0x0,  0x61, 0xab, 0x16, 0x0,  0x3,  0x5c, 0x67, 0x2d, 0x8,  0x0,  0x17, 0x37, 0xf8,
                   0x22, 0xc6, 0xf5, 0xd8, 0x78, 0x90, 0xf7, 0xad, 0x26, 0x38, 0xa4, 0x26, 0x65, 0x1,  0x98, 0xe2,
                   0x69, 0xe1, 0xef, 0xee, 0x73, 0x19, 0x8e, 0x27, 0x0,  0x0,  0x26, 0x9c, 0x29, 0xe2, 0x8,  0x0,
                   0x0,  0x8,  0x0,  0x10, 0x8c, 0x57, 0xe0, 0xe6, 0xd9, 0x40, 0xb0, 0xfe, 0xa2, 0xa1, 0x9d, 0xc9,
                   0x87, 0x8a, 0x99, 0x1d, 0x8,  0x0,  0x7,  0xb1, 0xee, 0xbe, 0x6b, 0xf,  0x62, 0xaa, 0x1f, 0x0,
                   0x5,  0xef, 0x1,  0xcc, 0x9a, 0xc1, 0x2a, 0x34, 0x4a, 0x6a, 0xe,  0xf1, 0x5,  0x89, 0x11};

  uint8_t buf[201] = {0};

  uint8_t topic_bytes[] = {0xfd, 0x88, 0x8c, 0xb3, 0x7d, 0x2, 0x3b};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x6a, 0xe, 0xf1, 0x5, 0x89, 0x11};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x37, 0xd0, 0xac, 0x29, 0x8f, 0xef};
  uint8_t bytesprops1[] = {0x91, 0xa9, 0x42, 0x6e, 0x27};
  uint8_t bytesprops2[] = {0xcd, 0xdd, 0xe5, 0xc2, 0xcd, 0xc3, 0x42, 0xa2, 0xaa, 0xa6, 0xf8, 0xef, 0x3e, 0x4};
  uint8_t bytesprops3[] = {0xe7, 0xbc, 0x2a, 0x49, 0x11, 0xd3, 0x45, 0x8b, 0xe0, 0xde, 0x10, 0x8,  0x45, 0x8d,
                           0xc,  0xdc, 0x9d, 0x37, 0x5b, 0x50, 0x3,  0x82, 0x4f, 0x3a, 0xe9, 0x6a, 0xdf, 0xcf};
  uint8_t bytesprops4[] = {0x5c, 0x67, 0x2d};
  uint8_t bytesprops5[] = {0x37, 0xf8, 0x22, 0xc6, 0xf5, 0xd8, 0x78, 0x90, 0xf7, 0xad, 0x26, 0x38,
                           0xa4, 0x26, 0x65, 0x1,  0x98, 0xe2, 0x69, 0xe1, 0xef, 0xee, 0x73};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x8c, 0x57, 0xe0, 0xe6, 0xd9, 0x40, 0xb0, 0xfe,
                           0xa2, 0xa1, 0x9d, 0xc9, 0x87, 0x8a, 0x99, 0x1d};
  uint8_t bytesprops8[] = {0xb1, 0xee, 0xbe, 0x6b, 0xf, 0x62, 0xaa};
  uint8_t bytesprops9[] = {0xef, 0x1, 0xcc, 0x9a, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14862}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7271}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3502}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25003}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9884}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 52}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 6476, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\242\232\197\SOHHe\ETX>/
// \232\220\247\251\tq\198\197nl\247\249", _pubPktID = 2029, _pubBody = "v_\GSO8\202C0\RS\247#\141\209\DEL", _pubProps =
// [PropUserProperty "\236\FS\154<r\145#I\198\r\159I0\ETBe\231jz\ETX(" "\157",PropRequestProblemInformation
// 120,PropSharedSubscriptionAvailable 224,PropReasonString
// "\128{\188\136\249\179\155\146\155\252\&76\136\211I\152\ETXI\129\189\ESC\195m=m\171\SOHa",PropMessageExpiryInterval
// 4306,PropAuthenticationMethod "wI\188#|\134;\209\133\&8",PropMessageExpiryInterval 21270,PropSessionExpiryInterval
// 14803,PropCorrelationData
// "\136\142\177\SOHw\DC4\DEL\160/\232\255P\145\&8\135\DEL\a\241\183\129\241x\242\129",PropRetainAvailable
// 104,PropContentType
// "K\236\191%\GSw\FS\222\199\238i\vL@\199\212I\152\203\240\138\199\215T*S",PropPayloadFormatIndicator
// 53,PropResponseInformation "\254\150 \GSv\199\215\&6\139\162",PropRequestResponseInformation 244]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x3a, 0xce, 0x1,  0x0,  0x16, 0xf2, 0xe8, 0xc5, 0x1,  0x48, 0x65, 0x3,  0x3e, 0x2f, 0x20, 0xe8, 0xdc, 0xf7, 0xfb,
      0x9,  0x71, 0xc6, 0xc5, 0x6e, 0x6c, 0xf7, 0xf9, 0x7,  0xed, 0xa4, 0x1,  0x26, 0x0,  0x14, 0xec, 0x1c, 0x9a, 0x3c,
      0x72, 0x91, 0x23, 0x49, 0xc6, 0xd,  0x9f, 0x49, 0x30, 0x17, 0x65, 0xe7, 0x6a, 0x7a, 0x3,  0x28, 0x0,  0x1,  0x9d,
      0x17, 0x78, 0x2a, 0xe0, 0x1f, 0x0,  0x1c, 0x80, 0x7b, 0xbc, 0x88, 0xf9, 0xb3, 0x9b, 0x92, 0x9b, 0xfc, 0x37, 0x36,
      0x88, 0xd3, 0x49, 0x98, 0x3,  0x49, 0x81, 0xbd, 0x1b, 0xc3, 0x6d, 0x3d, 0x6d, 0xab, 0x1,  0x61, 0x2,  0x0,  0x0,
      0x10, 0xd2, 0x15, 0x0,  0xa,  0x77, 0x49, 0xbc, 0x23, 0x7c, 0x86, 0x3b, 0xd1, 0x85, 0x38, 0x2,  0x0,  0x0,  0x53,
      0x16, 0x11, 0x0,  0x0,  0x39, 0xd3, 0x9,  0x0,  0x18, 0x88, 0x8e, 0xb1, 0x1,  0x77, 0x14, 0x7f, 0xa0, 0x2f, 0xe8,
      0xff, 0x50, 0x91, 0x38, 0x87, 0x7f, 0x7,  0xf1, 0xb7, 0x81, 0xf1, 0x78, 0xf2, 0x81, 0x25, 0x68, 0x3,  0x0,  0x1a,
      0x4b, 0xec, 0xbf, 0x25, 0x1d, 0x77, 0x1c, 0xde, 0xc7, 0xee, 0x69, 0xb,  0x4c, 0x40, 0xc7, 0xd4, 0x49, 0x98, 0xcb,
      0xf0, 0x8a, 0xc7, 0xd7, 0x54, 0x2a, 0x53, 0x1,  0x35, 0x1a, 0x0,  0xa,  0xfe, 0x96, 0x20, 0x1d, 0x76, 0xc7, 0xd7,
      0x36, 0x8b, 0xa2, 0x19, 0xf4, 0x76, 0x5f, 0x1d, 0x4f, 0x38, 0xca, 0x43, 0x30, 0x1e, 0xf7, 0x23, 0x8d, 0xd1, 0x7f};

  uint8_t buf[219] = {0};

  uint8_t topic_bytes[] = {0xf2, 0xe8, 0xc5, 0x1, 0x48, 0x65, 0x3,  0x3e, 0x2f, 0x20, 0xe8,
                           0xdc, 0xf7, 0xfb, 0x9, 0x71, 0xc6, 0xc5, 0x6e, 0x6c, 0xf7, 0xf9};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x76, 0x5f, 0x1d, 0x4f, 0x38, 0xca, 0x43, 0x30, 0x1e, 0xf7, 0x23, 0x8d, 0xd1, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops1[] = {0x9d};
  uint8_t bytesprops0[] = {0xec, 0x1c, 0x9a, 0x3c, 0x72, 0x91, 0x23, 0x49, 0xc6, 0xd,
                           0x9f, 0x49, 0x30, 0x17, 0x65, 0xe7, 0x6a, 0x7a, 0x3,  0x28};
  uint8_t bytesprops2[] = {0x80, 0x7b, 0xbc, 0x88, 0xf9, 0xb3, 0x9b, 0x92, 0x9b, 0xfc, 0x37, 0x36, 0x88, 0xd3,
                           0x49, 0x98, 0x3,  0x49, 0x81, 0xbd, 0x1b, 0xc3, 0x6d, 0x3d, 0x6d, 0xab, 0x1,  0x61};
  uint8_t bytesprops3[] = {0x77, 0x49, 0xbc, 0x23, 0x7c, 0x86, 0x3b, 0xd1, 0x85, 0x38};
  uint8_t bytesprops4[] = {0x88, 0x8e, 0xb1, 0x1,  0x77, 0x14, 0x7f, 0xa0, 0x2f, 0xe8, 0xff, 0x50,
                           0x91, 0x38, 0x87, 0x7f, 0x7,  0xf1, 0xb7, 0x81, 0xf1, 0x78, 0xf2, 0x81};
  uint8_t bytesprops5[] = {0x4b, 0xec, 0xbf, 0x25, 0x1d, 0x77, 0x1c, 0xde, 0xc7, 0xee, 0x69, 0xb,  0x4c,
                           0x40, 0xc7, 0xd4, 0x49, 0x98, 0xcb, 0xf0, 0x8a, 0xc7, 0xd7, 0x54, 0x2a, 0x53};
  uint8_t bytesprops6[] = {0xfe, 0x96, 0x20, 0x1d, 0x76, 0xc7, 0xd7, 0x36, 0x8b, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops0}, .v = {1, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4306}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21270}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14803}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 244}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 2029, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Y\NUL&\156\t\157<\215\152R\173\212.\245\207\197\188\163\208\&2", _pubPktID = 5733, _pubBody =
// "\SOHe\184~\148\245\199\143\205\235\200U", _pubProps = [PropRetainAvailable 142,PropResponseTopic
// "\185D9Jn,\b%\165\252\236n\fl\209J\211\212\182\218\251y",PropSessionExpiryInterval 13312,PropServerKeepAlive
// 14391,PropMaximumQoS 75,PropRetainAvailable 18,PropRequestProblemInformation 240,PropSessionExpiryInterval
// 27873,PropRetainAvailable 61,PropSessionExpiryInterval 9987,PropAssignedClientIdentifier
// "aw\152\253\239\185\237W\155|\198",PropAuthenticationData ""]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x3d, 0x6b, 0x0,  0x14, 0x59, 0x0,  0x26, 0x9c, 0x9,  0x9d, 0x3c, 0xd7, 0x98, 0x52, 0xad, 0xd4,
                   0x2e, 0xf5, 0xcf, 0xc5, 0xbc, 0xa3, 0xd0, 0x32, 0x16, 0x65, 0x46, 0x25, 0x8e, 0x8,  0x0,  0x16,
                   0xb9, 0x44, 0x39, 0x4a, 0x6e, 0x2c, 0x8,  0x25, 0xa5, 0xfc, 0xec, 0x6e, 0xc,  0x6c, 0xd1, 0x4a,
                   0xd3, 0xd4, 0xb6, 0xda, 0xfb, 0x79, 0x11, 0x0,  0x0,  0x34, 0x0,  0x13, 0x38, 0x37, 0x24, 0x4b,
                   0x25, 0x12, 0x17, 0xf0, 0x11, 0x0,  0x0,  0x6c, 0xe1, 0x25, 0x3d, 0x11, 0x0,  0x0,  0x27, 0x3,
                   0x12, 0x0,  0xb,  0x61, 0x77, 0x98, 0xfd, 0xef, 0xb9, 0xed, 0x57, 0x9b, 0x7c, 0xc6, 0x16, 0x0,
                   0x0,  0x1,  0x65, 0xb8, 0x7e, 0x94, 0xf5, 0xc7, 0x8f, 0xcd, 0xeb, 0xc8, 0x55};

  uint8_t buf[119] = {0};

  uint8_t topic_bytes[] = {0x59, 0x0,  0x26, 0x9c, 0x9,  0x9d, 0x3c, 0xd7, 0x98, 0x52,
                           0xad, 0xd4, 0x2e, 0xf5, 0xcf, 0xc5, 0xbc, 0xa3, 0xd0, 0x32};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x65, 0xb8, 0x7e, 0x94, 0xf5, 0xc7, 0x8f, 0xcd, 0xeb, 0xc8, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0xb9, 0x44, 0x39, 0x4a, 0x6e, 0x2c, 0x8,  0x25, 0xa5, 0xfc, 0xec,
                           0x6e, 0xc,  0x6c, 0xd1, 0x4a, 0xd3, 0xd4, 0xb6, 0xda, 0xfb, 0x79};
  uint8_t bytesprops1[] = {0x61, 0x77, 0x98, 0xfd, 0xef, 0xb9, 0xed, 0x57, 0x9b, 0x7c, 0xc6};
  uint8_t bytesprops2[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13312}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14391}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27873}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9987}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5733, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\224\201\GS?\232\255!\161\220\244B\129\&6\US\205R_8\191\154\217\186?\231\245\224\170", _pubPktID = 14690, _pubBody =
// "\196\183%\243\214\152\&5U;\186\194\206\128[\236B~\144\236\247\187\144Ze\ETX\176", _pubProps =
// [PropResponseInformation "\148\GSf\FSj\NAK\SI\148\ETB\137\190\194\201}\170\150c\232\&7\SI\t\169\DC3",PropMaximumQoS
// 12,PropUserProperty "\185\DC2tlZ*~@TG\177\204o\226\217z.\135" "\171\196\151\249\180!\SUBg\ESC\218\240\r\172
// bB\188\167"]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x35, 0x7f, 0x0,  0x1b, 0xe0, 0xc9, 0x1d, 0x3f, 0xe8, 0xff, 0x21, 0xa1, 0xdc, 0xf4, 0x42, 0x81, 0x36,
                   0x1f, 0xcd, 0x52, 0x5f, 0x38, 0xbf, 0x9a, 0xd9, 0xba, 0x3f, 0xe7, 0xf5, 0xe0, 0xaa, 0x39, 0x62, 0x45,
                   0x1a, 0x0,  0x17, 0x94, 0x1d, 0x66, 0x1c, 0x6a, 0x15, 0xf,  0x94, 0x17, 0x89, 0xbe, 0xc2, 0xc9, 0x7d,
                   0xaa, 0x96, 0x63, 0xe8, 0x37, 0xf,  0x9,  0xa9, 0x13, 0x24, 0xc,  0x26, 0x0,  0x12, 0xb9, 0x12, 0x74,
                   0x6c, 0x5a, 0x2a, 0x7e, 0x40, 0x54, 0x47, 0xb1, 0xcc, 0x6f, 0xe2, 0xd9, 0x7a, 0x2e, 0x87, 0x0,  0x12,
                   0xab, 0xc4, 0x97, 0xf9, 0xb4, 0x21, 0x1a, 0x67, 0x1b, 0xda, 0xf0, 0xd,  0xac, 0x20, 0x62, 0x42, 0xbc,
                   0xa7, 0xc4, 0xb7, 0x25, 0xf3, 0xd6, 0x98, 0x35, 0x55, 0x3b, 0xba, 0xc2, 0xce, 0x80, 0x5b, 0xec, 0x42,
                   0x7e, 0x90, 0xec, 0xf7, 0xbb, 0x90, 0x5a, 0x65, 0x3,  0xb0};

  uint8_t buf[139] = {0};

  uint8_t topic_bytes[] = {0xe0, 0xc9, 0x1d, 0x3f, 0xe8, 0xff, 0x21, 0xa1, 0xdc, 0xf4, 0x42, 0x81, 0x36, 0x1f,
                           0xcd, 0x52, 0x5f, 0x38, 0xbf, 0x9a, 0xd9, 0xba, 0x3f, 0xe7, 0xf5, 0xe0, 0xaa};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc4, 0xb7, 0x25, 0xf3, 0xd6, 0x98, 0x35, 0x55, 0x3b, 0xba, 0xc2, 0xce, 0x80,
                         0x5b, 0xec, 0x42, 0x7e, 0x90, 0xec, 0xf7, 0xbb, 0x90, 0x5a, 0x65, 0x3,  0xb0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x94, 0x1d, 0x66, 0x1c, 0x6a, 0x15, 0xf,  0x94, 0x17, 0x89, 0xbe, 0xc2,
                           0xc9, 0x7d, 0xaa, 0x96, 0x63, 0xe8, 0x37, 0xf,  0x9,  0xa9, 0x13};
  uint8_t bytesprops2[] = {0xab, 0xc4, 0x97, 0xf9, 0xb4, 0x21, 0x1a, 0x67, 0x1b,
                           0xda, 0xf0, 0xd,  0xac, 0x20, 0x62, 0x42, 0xbc, 0xa7};
  uint8_t bytesprops1[] = {0xb9, 0x12, 0x74, 0x6c, 0x5a, 0x2a, 0x7e, 0x40, 0x54,
                           0x47, 0xb1, 0xcc, 0x6f, 0xe2, 0xd9, 0x7a, 0x2e, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 14690, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\128\EOT^\158\STX\"\210\232\166U\219\154N\225\218\228\153Z\152\250\224\246\211;E\155", _pubPktID = 16370, _pubBody =
// "V", _pubProps = [PropContentType "\202G\166-\168#\170\148\175\DLE\192\140\141\&54\206\217]",PropWillDelayInterval
// 23790,PropSubscriptionIdentifierAvailable 17,PropMessageExpiryInterval 27141,PropServerKeepAlive
// 11447,PropCorrelationData "d\147\235\165\&2\197C\185\143?\245\b3\185'\SO\205\240",PropMaximumQoS
// 121,PropTopicAliasMaximum 22069,PropReceiveMaximum 28169,PropReceiveMaximum 6265,PropCorrelationData "sx\t\165
// !\DC2k\134C\SUBf\191\250\141\f)\168\246\186\204d\139#\160\230",PropServerReference
// "",PropSubscriptionIdentifierAvailable 221,PropWillDelayInterval 20730,PropAssignedClientIdentifier
// "w\135=\234f\243T\DC1\251\154\ESC;k\227\157|\190\SOH!",PropMaximumPacketSize 28283,PropPayloadFormatIndicator 165]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x3b, 0xa9, 0x1,  0x0,  0x1a, 0x80, 0x4,  0x5e, 0x9e, 0x2,  0x22, 0xd2, 0xe8, 0xa6, 0x55, 0xdb,
                   0x9a, 0x4e, 0xe1, 0xda, 0xe4, 0x99, 0x5a, 0x98, 0xfa, 0xe0, 0xf6, 0xd3, 0x3b, 0x45, 0x9b, 0x3f,
                   0xf2, 0x88, 0x1,  0x3,  0x0,  0x12, 0xca, 0x47, 0xa6, 0x2d, 0xa8, 0x23, 0xaa, 0x94, 0xaf, 0x10,
                   0xc0, 0x8c, 0x8d, 0x35, 0x34, 0xce, 0xd9, 0x5d, 0x18, 0x0,  0x0,  0x5c, 0xee, 0x29, 0x11, 0x2,
                   0x0,  0x0,  0x6a, 0x5,  0x13, 0x2c, 0xb7, 0x9,  0x0,  0x12, 0x64, 0x93, 0xeb, 0xa5, 0x32, 0xc5,
                   0x43, 0xb9, 0x8f, 0x3f, 0xf5, 0x8,  0x33, 0xb9, 0x27, 0xe,  0xcd, 0xf0, 0x24, 0x79, 0x22, 0x56,
                   0x35, 0x21, 0x6e, 0x9,  0x21, 0x18, 0x79, 0x9,  0x0,  0x1a, 0x73, 0x78, 0x9,  0xa5, 0x20, 0x21,
                   0x12, 0x6b, 0x86, 0x43, 0x1a, 0x66, 0xbf, 0xfa, 0x8d, 0xc,  0x29, 0xa8, 0xf6, 0xba, 0xcc, 0x64,
                   0x8b, 0x23, 0xa0, 0xe6, 0x1c, 0x0,  0x0,  0x29, 0xdd, 0x18, 0x0,  0x0,  0x50, 0xfa, 0x12, 0x0,
                   0x13, 0x77, 0x87, 0x3d, 0xea, 0x66, 0xf3, 0x54, 0x11, 0xfb, 0x9a, 0x1b, 0x3b, 0x6b, 0xe3, 0x9d,
                   0x7c, 0xbe, 0x1,  0x21, 0x27, 0x0,  0x0,  0x6e, 0x7b, 0x1,  0xa5, 0x56};

  uint8_t buf[182] = {0};

  uint8_t topic_bytes[] = {0x80, 0x4,  0x5e, 0x9e, 0x2,  0x22, 0xd2, 0xe8, 0xa6, 0x55, 0xdb, 0x9a, 0x4e,
                           0xe1, 0xda, 0xe4, 0x99, 0x5a, 0x98, 0xfa, 0xe0, 0xf6, 0xd3, 0x3b, 0x45, 0x9b};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x56};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xca, 0x47, 0xa6, 0x2d, 0xa8, 0x23, 0xaa, 0x94, 0xaf,
                           0x10, 0xc0, 0x8c, 0x8d, 0x35, 0x34, 0xce, 0xd9, 0x5d};
  uint8_t bytesprops1[] = {0x64, 0x93, 0xeb, 0xa5, 0x32, 0xc5, 0x43, 0xb9, 0x8f,
                           0x3f, 0xf5, 0x8,  0x33, 0xb9, 0x27, 0xe,  0xcd, 0xf0};
  uint8_t bytesprops2[] = {0x73, 0x78, 0x9, 0xa5, 0x20, 0x21, 0x12, 0x6b, 0x86, 0x43, 0x1a, 0x66, 0xbf,
                           0xfa, 0x8d, 0xc, 0x29, 0xa8, 0xf6, 0xba, 0xcc, 0x64, 0x8b, 0x23, 0xa0, 0xe6};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x77, 0x87, 0x3d, 0xea, 0x66, 0xf3, 0x54, 0x11, 0xfb, 0x9a,
                           0x1b, 0x3b, 0x6b, 0xe3, 0x9d, 0x7c, 0xbe, 0x1,  0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23790}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27141}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11447}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22069}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28169}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6265}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20730}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28283}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 165}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "c\215A4\142\182\&2\162\191V\143t$A0\142", _pubPktID = 0, _pubBody = "\221\195:\163\203\239\168%\160", _pubProps =
// [PropWildcardSubscriptionAvailable 147,PropTopicAliasMaximum 24199,PropWildcardSubscriptionAvailable
// 160,PropCorrelationData "n6/\211,\146\245\206jJ\n\DELUD\ACK\b",PropResponseTopic
// "%nfm\223X\DLE\210\210\199\239\135D\160\&24Fj\232\230\147\199\&8\159J\233\EOT\128",PropMaximumQoS
// 189,PropResponseTopic "|O\178\204U\155\139W\165y\SUBKP#u?\DEL\151nl{\247\230B",PropResponseTopic
// "",PropSharedSubscriptionAvailable 12,PropUserProperty
// "\209,\153V\198\200\208\&5;\231\196IQv\152\230\SO&U\216]S\a\229\216"
// "\221\242\ACK\239\132\EOT\219AM\134~\251I\254)+(\245#\129\255_\ETB",PropSharedSubscriptionAvailable 44,PropMaximumQoS
// 37,PropMaximumPacketSize 19948,PropMaximumQoS 126,PropContentType
// "\DC4\194\190%\SOH\201\218\203\147\134\255f-X.\252T",PropCorrelationData "\241\&6_\152\230Z,V\157",PropUserProperty
// "\184\137Qr\222\NAK\179\144/\a\233\139\196-\241\NUL\SO\DC2\ETX\254\233\160/\172\197\179\157I"
// "s\205\154\CAN\206Q\227\254#\DLE\188\169\131.\129OE\220\242\&0n\172\149YD",PropWildcardSubscriptionAvailable
// 197,PropPayloadFormatIndicator 186,PropAuthenticationMethod "\196\RS",PropReceiveMaximum
// 22903,PropMessageExpiryInterval 9152,PropSubscriptionIdentifierAvailable 229,PropSubscriptionIdentifier
// 7,PropContentType "#<\ACKH\197\135U2{n\135\247\236Hb~\134\134",PropReceiveMaximum 10637,PropPayloadFormatIndicator
// 84]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x31, 0xc1, 0x2,  0x0,  0x10, 0x63, 0xd7, 0x41, 0x34, 0x8e, 0xb6, 0x32, 0xa2, 0xbf, 0x56, 0x8f, 0x74, 0x24,
      0x41, 0x30, 0x8e, 0xa4, 0x2,  0x28, 0x93, 0x22, 0x5e, 0x87, 0x28, 0xa0, 0x9,  0x0,  0x10, 0x6e, 0x36, 0x2f,
      0xd3, 0x2c, 0x92, 0xf5, 0xce, 0x6a, 0x4a, 0xa,  0x7f, 0x55, 0x44, 0x6,  0x8,  0x8,  0x0,  0x1c, 0x25, 0x6e,
      0x66, 0x6d, 0xdf, 0x58, 0x10, 0xd2, 0xd2, 0xc7, 0xef, 0x87, 0x44, 0xa0, 0x32, 0x34, 0x46, 0x6a, 0xe8, 0xe6,
      0x93, 0xc7, 0x38, 0x9f, 0x4a, 0xe9, 0x4,  0x80, 0x24, 0xbd, 0x8,  0x0,  0x18, 0x7c, 0x4f, 0xb2, 0xcc, 0x55,
      0x9b, 0x8b, 0x57, 0xa5, 0x79, 0x1a, 0x4b, 0x50, 0x23, 0x75, 0x3f, 0x7f, 0x97, 0x6e, 0x6c, 0x7b, 0xf7, 0xe6,
      0x42, 0x8,  0x0,  0x0,  0x2a, 0xc,  0x26, 0x0,  0x19, 0xd1, 0x2c, 0x99, 0x56, 0xc6, 0xc8, 0xd0, 0x35, 0x3b,
      0xe7, 0xc4, 0x49, 0x51, 0x76, 0x98, 0xe6, 0xe,  0x26, 0x55, 0xd8, 0x5d, 0x53, 0x7,  0xe5, 0xd8, 0x0,  0x17,
      0xdd, 0xf2, 0x6,  0xef, 0x84, 0x4,  0xdb, 0x41, 0x4d, 0x86, 0x7e, 0xfb, 0x49, 0xfe, 0x29, 0x2b, 0x28, 0xf5,
      0x23, 0x81, 0xff, 0x5f, 0x17, 0x2a, 0x2c, 0x24, 0x25, 0x27, 0x0,  0x0,  0x4d, 0xec, 0x24, 0x7e, 0x3,  0x0,
      0x11, 0x14, 0xc2, 0xbe, 0x25, 0x1,  0xc9, 0xda, 0xcb, 0x93, 0x86, 0xff, 0x66, 0x2d, 0x58, 0x2e, 0xfc, 0x54,
      0x9,  0x0,  0x9,  0xf1, 0x36, 0x5f, 0x98, 0xe6, 0x5a, 0x2c, 0x56, 0x9d, 0x26, 0x0,  0x1c, 0xb8, 0x89, 0x51,
      0x72, 0xde, 0x15, 0xb3, 0x90, 0x2f, 0x7,  0xe9, 0x8b, 0xc4, 0x2d, 0xf1, 0x0,  0xe,  0x12, 0x3,  0xfe, 0xe9,
      0xa0, 0x2f, 0xac, 0xc5, 0xb3, 0x9d, 0x49, 0x0,  0x19, 0x73, 0xcd, 0x9a, 0x18, 0xce, 0x51, 0xe3, 0xfe, 0x23,
      0x10, 0xbc, 0xa9, 0x83, 0x2e, 0x81, 0x4f, 0x45, 0xdc, 0xf2, 0x30, 0x6e, 0xac, 0x95, 0x59, 0x44, 0x28, 0xc5,
      0x1,  0xba, 0x15, 0x0,  0x2,  0xc4, 0x1e, 0x21, 0x59, 0x77, 0x2,  0x0,  0x0,  0x23, 0xc0, 0x29, 0xe5, 0xb,
      0x7,  0x3,  0x0,  0x12, 0x23, 0x3c, 0x6,  0x48, 0xc5, 0x87, 0x55, 0x32, 0x7b, 0x6e, 0x87, 0xf7, 0xec, 0x48,
      0x62, 0x7e, 0x86, 0x86, 0x21, 0x29, 0x8d, 0x1,  0x54, 0xdd, 0xc3, 0x3a, 0xa3, 0xcb, 0xef, 0xa8, 0x25, 0xa0};

  uint8_t buf[334] = {0};

  uint8_t topic_bytes[] = {0x63, 0xd7, 0x41, 0x34, 0x8e, 0xb6, 0x32, 0xa2,
                           0xbf, 0x56, 0x8f, 0x74, 0x24, 0x41, 0x30, 0x8e};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0xc3, 0x3a, 0xa3, 0xcb, 0xef, 0xa8, 0x25, 0xa0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x6e, 0x36, 0x2f, 0xd3, 0x2c, 0x92, 0xf5, 0xce, 0x6a, 0x4a, 0xa, 0x7f, 0x55, 0x44, 0x6, 0x8};
  uint8_t bytesprops1[] = {0x25, 0x6e, 0x66, 0x6d, 0xdf, 0x58, 0x10, 0xd2, 0xd2, 0xc7, 0xef, 0x87, 0x44, 0xa0,
                           0x32, 0x34, 0x46, 0x6a, 0xe8, 0xe6, 0x93, 0xc7, 0x38, 0x9f, 0x4a, 0xe9, 0x4,  0x80};
  uint8_t bytesprops2[] = {0x7c, 0x4f, 0xb2, 0xcc, 0x55, 0x9b, 0x8b, 0x57, 0xa5, 0x79, 0x1a, 0x4b,
                           0x50, 0x23, 0x75, 0x3f, 0x7f, 0x97, 0x6e, 0x6c, 0x7b, 0xf7, 0xe6, 0x42};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops5[] = {0xdd, 0xf2, 0x6,  0xef, 0x84, 0x4,  0xdb, 0x41, 0x4d, 0x86, 0x7e, 0xfb,
                           0x49, 0xfe, 0x29, 0x2b, 0x28, 0xf5, 0x23, 0x81, 0xff, 0x5f, 0x17};
  uint8_t bytesprops4[] = {0xd1, 0x2c, 0x99, 0x56, 0xc6, 0xc8, 0xd0, 0x35, 0x3b, 0xe7, 0xc4, 0x49, 0x51,
                           0x76, 0x98, 0xe6, 0xe,  0x26, 0x55, 0xd8, 0x5d, 0x53, 0x7,  0xe5, 0xd8};
  uint8_t bytesprops6[] = {0x14, 0xc2, 0xbe, 0x25, 0x1,  0xc9, 0xda, 0xcb, 0x93,
                           0x86, 0xff, 0x66, 0x2d, 0x58, 0x2e, 0xfc, 0x54};
  uint8_t bytesprops7[] = {0xf1, 0x36, 0x5f, 0x98, 0xe6, 0x5a, 0x2c, 0x56, 0x9d};
  uint8_t bytesprops9[] = {0x73, 0xcd, 0x9a, 0x18, 0xce, 0x51, 0xe3, 0xfe, 0x23, 0x10, 0xbc, 0xa9, 0x83,
                           0x2e, 0x81, 0x4f, 0x45, 0xdc, 0xf2, 0x30, 0x6e, 0xac, 0x95, 0x59, 0x44};
  uint8_t bytesprops8[] = {0xb8, 0x89, 0x51, 0x72, 0xde, 0x15, 0xb3, 0x90, 0x2f, 0x7,  0xe9, 0x8b, 0xc4, 0x2d,
                           0xf1, 0x0,  0xe,  0x12, 0x3,  0xfe, 0xe9, 0xa0, 0x2f, 0xac, 0xc5, 0xb3, 0x9d, 0x49};
  uint8_t bytesprops10[] = {0xc4, 0x1e};
  uint8_t bytesprops11[] = {0x23, 0x3c, 0x6,  0x48, 0xc5, 0x87, 0x55, 0x32, 0x7b,
                            0x6e, 0x87, 0xf7, 0xec, 0x48, 0x62, 0x7e, 0x86, 0x86};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24199}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops4}, .v = {23, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19948}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops8}, .v = {25, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22903}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9152}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10637}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 84}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\161\166\175\235\223\210\143\180\219\210\209\129\230\195\173\&1\t\ENQy\206\250\146\214\205\161\212{?\157", _pubPktID
// = 0, _pubBody = "\206W9\140\ESC6\211\206\212d\US\141\189`a9\182\130,\ETX", _pubProps = [PropRequestProblemInformation
// 98,PropMaximumQoS 10]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x30, 0x38, 0x0,  0x1d, 0xa1, 0xa6, 0xaf, 0xeb, 0xdf, 0xd2, 0x8f, 0xb4, 0xdb, 0xd2, 0xd1,
                   0x81, 0xe6, 0xc3, 0xad, 0x31, 0x9,  0x5,  0x79, 0xce, 0xfa, 0x92, 0xd6, 0xcd, 0xa1, 0xd4,
                   0x7b, 0x3f, 0x9d, 0x4,  0x17, 0x62, 0x24, 0xa,  0xce, 0x57, 0x39, 0x8c, 0x1b, 0x36, 0xd3,
                   0xce, 0xd4, 0x64, 0x1f, 0x8d, 0xbd, 0x60, 0x61, 0x39, 0xb6, 0x82, 0x2c, 0x3};

  uint8_t buf[68] = {0};

  uint8_t topic_bytes[] = {0xa1, 0xa6, 0xaf, 0xeb, 0xdf, 0xd2, 0x8f, 0xb4, 0xdb, 0xd2, 0xd1, 0x81, 0xe6, 0xc3, 0xad,
                           0x31, 0x9,  0x5,  0x79, 0xce, 0xfa, 0x92, 0xd6, 0xcd, 0xa1, 0xd4, 0x7b, 0x3f, 0x9d};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xce, 0x57, 0x39, 0x8c, 0x1b, 0x36, 0xd3, 0xce, 0xd4, 0x64,
                         0x1f, 0x8d, 0xbd, 0x60, 0x61, 0x39, 0xb6, 0x82, 0x2c, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 10}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\196\184\STXD\DC3\206\DC2E\138\172a\226\203\SYN\241E)", _pubPktID = 6876, _pubBody =
// "\152k\DEL:{\247\144\fs\215\252\234\162HI", _pubProps = [PropRequestProblemInformation 43,PropResponseInformation
// "\145;\DC3\221^\224\DC2\211\213\178mp\167\184-\216h",PropServerReference
// "\228\202\ACK4\177\156a\162\ETX\231j\150h\194_\220\GS\161\204E\147\245|",PropWildcardSubscriptionAvailable
// 205,PropWillDelayInterval 11586,PropSubscriptionIdentifierAvailable 90,PropRequestResponseInformation
// 157,PropRequestResponseInformation 193,PropPayloadFormatIndicator 104,PropPayloadFormatIndicator 24]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x3c, 0x67, 0x0,  0x12, 0x7b, 0xc4, 0xb8, 0x2,  0x44, 0x13, 0xce, 0x12, 0x45, 0x8a, 0xac,
                   0x61, 0xe2, 0xcb, 0x16, 0xf1, 0x45, 0x29, 0x1a, 0xdc, 0x41, 0x17, 0x2b, 0x1a, 0x0,  0x11,
                   0x91, 0x3b, 0x13, 0xdd, 0x5e, 0xe0, 0x12, 0xd3, 0xd5, 0xb2, 0x6d, 0x70, 0xa7, 0xb8, 0x2d,
                   0xd8, 0x68, 0x1c, 0x0,  0x17, 0xe4, 0xca, 0x6,  0x34, 0xb1, 0x9c, 0x61, 0xa2, 0x3,  0xe7,
                   0x6a, 0x96, 0x68, 0xc2, 0x5f, 0xdc, 0x1d, 0xa1, 0xcc, 0x45, 0x93, 0xf5, 0x7c, 0x28, 0xcd,
                   0x18, 0x0,  0x0,  0x2d, 0x42, 0x29, 0x5a, 0x19, 0x9d, 0x19, 0xc1, 0x1,  0x68, 0x1,  0x18,
                   0x98, 0x6b, 0x7f, 0x3a, 0x7b, 0xf7, 0x90, 0xc,  0x73, 0xd7, 0xfc, 0xea, 0xa2, 0x48, 0x49};

  uint8_t buf[115] = {0};

  uint8_t topic_bytes[] = {0x7b, 0xc4, 0xb8, 0x2,  0x44, 0x13, 0xce, 0x12, 0x45,
                           0x8a, 0xac, 0x61, 0xe2, 0xcb, 0x16, 0xf1, 0x45, 0x29};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x98, 0x6b, 0x7f, 0x3a, 0x7b, 0xf7, 0x90, 0xc, 0x73, 0xd7, 0xfc, 0xea, 0xa2, 0x48, 0x49};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x91, 0x3b, 0x13, 0xdd, 0x5e, 0xe0, 0x12, 0xd3, 0xd5,
                           0xb2, 0x6d, 0x70, 0xa7, 0xb8, 0x2d, 0xd8, 0x68};
  uint8_t bytesprops1[] = {0xe4, 0xca, 0x6,  0x34, 0xb1, 0x9c, 0x61, 0xa2, 0x3,  0xe7, 0x6a, 0x96,
                           0x68, 0xc2, 0x5f, 0xdc, 0x1d, 0xa1, 0xcc, 0x45, 0x93, 0xf5, 0x7c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11586}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 24}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6876, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\STXa7W", _pubPktID = 0, _pubBody =
// "\169#\136\219\142\&7\196\149\&4d\246j\146\254\188ch\168$T\135Q*\170\138\DC3!", _pubProps = [PropReasonString
// "",PropReasonString "@\t\140\194\183\210\222\194
// f\243\tX\234\&8k\151O\207\EM\ETBV\197\&4\f\245\203",PropWildcardSubscriptionAvailable 80,PropMaximumPacketSize
// 28790,PropWildcardSubscriptionAvailable 38,PropPayloadFormatIndicator 125,PropTopicAlias 6534,PropTopicAliasMaximum
// 11429,PropPayloadFormatIndicator 157,PropSessionExpiryInterval 24063,PropServerReference
// "\183I\FS!xyu\173\158_\237\173\EOTF\r/\219\b\167O\132\228",PropMaximumPacketSize 23219,PropWillDelayInterval
// 24499,PropServerReference "\240\217*\GS\132=\195H!;\223\225(",PropRequestResponseInformation 169,PropServerKeepAlive
// 6359,PropResponseInformation
// "{\224^\223\DLE:\253zb]>\DC2#\208\DLE\ENQ\168\SO+\148L\244\185\184",PropSharedSubscriptionAvailable
// 254,PropPayloadFormatIndicator 153]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x38, 0xb3, 0x1,  0x0,  0x4,  0x2,  0x61, 0x37, 0x57, 0x90, 0x1,  0x1f, 0x0,  0x0,  0x1f, 0x0,  0x1b,
                   0x40, 0x9,  0x8c, 0xc2, 0xb7, 0xd2, 0xde, 0xc2, 0x20, 0x66, 0xf3, 0x9,  0x58, 0xea, 0x38, 0x6b, 0x97,
                   0x4f, 0xcf, 0x19, 0x17, 0x56, 0xc5, 0x34, 0xc,  0xf5, 0xcb, 0x28, 0x50, 0x27, 0x0,  0x0,  0x70, 0x76,
                   0x28, 0x26, 0x1,  0x7d, 0x23, 0x19, 0x86, 0x22, 0x2c, 0xa5, 0x1,  0x9d, 0x11, 0x0,  0x0,  0x5d, 0xff,
                   0x1c, 0x0,  0x16, 0xb7, 0x49, 0x1c, 0x21, 0x78, 0x79, 0x75, 0xad, 0x9e, 0x5f, 0xed, 0xad, 0x4,  0x46,
                   0xd,  0x2f, 0xdb, 0x8,  0xa7, 0x4f, 0x84, 0xe4, 0x27, 0x0,  0x0,  0x5a, 0xb3, 0x18, 0x0,  0x0,  0x5f,
                   0xb3, 0x1c, 0x0,  0xd,  0xf0, 0xd9, 0x2a, 0x1d, 0x84, 0x3d, 0xc3, 0x48, 0x21, 0x3b, 0xdf, 0xe1, 0x28,
                   0x19, 0xa9, 0x13, 0x18, 0xd7, 0x1a, 0x0,  0x18, 0x7b, 0xe0, 0x5e, 0xdf, 0x10, 0x3a, 0xfd, 0x7a, 0x62,
                   0x5d, 0x3e, 0x12, 0x23, 0xd0, 0x10, 0x5,  0xa8, 0xe,  0x2b, 0x94, 0x4c, 0xf4, 0xb9, 0xb8, 0x2a, 0xfe,
                   0x1,  0x99, 0xa9, 0x23, 0x88, 0xdb, 0x8e, 0x37, 0xc4, 0x95, 0x34, 0x64, 0xf6, 0x6a, 0x92, 0xfe, 0xbc,
                   0x63, 0x68, 0xa8, 0x24, 0x54, 0x87, 0x51, 0x2a, 0xaa, 0x8a, 0x13, 0x21};

  uint8_t buf[192] = {0};

  uint8_t topic_bytes[] = {0x2, 0x61, 0x37, 0x57};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa9, 0x23, 0x88, 0xdb, 0x8e, 0x37, 0xc4, 0x95, 0x34, 0x64, 0xf6, 0x6a, 0x92, 0xfe,
                         0xbc, 0x63, 0x68, 0xa8, 0x24, 0x54, 0x87, 0x51, 0x2a, 0xaa, 0x8a, 0x13, 0x21};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x40, 0x9,  0x8c, 0xc2, 0xb7, 0xd2, 0xde, 0xc2, 0x20, 0x66, 0xf3, 0x9,  0x58, 0xea,
                           0x38, 0x6b, 0x97, 0x4f, 0xcf, 0x19, 0x17, 0x56, 0xc5, 0x34, 0xc,  0xf5, 0xcb};
  uint8_t bytesprops2[] = {0xb7, 0x49, 0x1c, 0x21, 0x78, 0x79, 0x75, 0xad, 0x9e, 0x5f, 0xed,
                           0xad, 0x4,  0x46, 0xd,  0x2f, 0xdb, 0x8,  0xa7, 0x4f, 0x84, 0xe4};
  uint8_t bytesprops3[] = {0xf0, 0xd9, 0x2a, 0x1d, 0x84, 0x3d, 0xc3, 0x48, 0x21, 0x3b, 0xdf, 0xe1, 0x28};
  uint8_t bytesprops4[] = {0x7b, 0xe0, 0x5e, 0xdf, 0x10, 0x3a, 0xfd, 0x7a, 0x62, 0x5d, 0x3e, 0x12,
                           0x23, 0xd0, 0x10, 0x5,  0xa8, 0xe,  0x2b, 0x94, 0x4c, 0xf4, 0xb9, 0xb8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28790}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6534}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11429}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24063}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23219}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24499}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6359}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Q\201\132\175[\206\183.\204\200p\224X\173\163MF\ETB\251\223T~\f\bW\241\179\180", _pubPktID = 2085, _pubBody =
// "\240\236\155\SOp\221\217'\225\163K\128", _pubProps = [PropSessionExpiryInterval 29496,PropResponseInformation
// "\155\EOTAK\NUL\174\220,K]i\DC1\157\&1\136\251r\168Z]\n\189\240h\152\EOT",PropResponseInformation
// "\189\243\170W\221\129\214\162\202\250d",PropTopicAliasMaximum 19828,PropRequestProblemInformation 123,PropTopicAlias
// 29886,PropSharedSubscriptionAvailable 149,PropTopicAlias 9028,PropAuthenticationMethod
// "\RS\217\243B\169\129\173\239\154",PropServerReference
// "\162\158\238nS\SI.\161\&9\195\179\184\ETB\131\141K3\172\174;y\160\SUBh",PropSubscriptionIdentifier
// 30,PropResponseTopic "\f*\191\179\193\251\132g\150MW\200\138\202",PropUserProperty "\SUB&k"
// "\247R\"\156\151)\150\DC3\156Mn\STX",PropMessageExpiryInterval 25601,PropMaximumPacketSize 30013,PropServerKeepAlive
// 2730,PropRequestProblemInformation 204,PropServerReference "z\169\217\248\202\183)\170",PropResponseTopic
// "~\213\169\&6Q\150\138\DC1\146\189Z\157\230\193\178\152\252\149\218\217",PropTopicAlias 3653,PropMaximumPacketSize
// 11018,PropRequestProblemInformation 73,PropTopicAliasMaximum 20508,PropAuthenticationMethod "\247\STX
// \138YJ\227\NAKF\137",PropSubscriptionIdentifierAvailable 13]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x3d, 0x86, 0x2,  0x0,  0x1c, 0x51, 0xc9, 0x84, 0xaf, 0x5b, 0xce, 0xb7, 0x2e, 0xcc, 0xc8, 0x70, 0xe0, 0x58, 0xad,
      0xa3, 0x4d, 0x46, 0x17, 0xfb, 0xdf, 0x54, 0x7e, 0xc,  0x8,  0x57, 0xf1, 0xb3, 0xb4, 0x8,  0x25, 0xd8, 0x1,  0x11,
      0x0,  0x0,  0x73, 0x38, 0x1a, 0x0,  0x1a, 0x9b, 0x4,  0x41, 0x4b, 0x0,  0xae, 0xdc, 0x2c, 0x4b, 0x5d, 0x69, 0x11,
      0x9d, 0x31, 0x88, 0xfb, 0x72, 0xa8, 0x5a, 0x5d, 0xa,  0xbd, 0xf0, 0x68, 0x98, 0x4,  0x1a, 0x0,  0xb,  0xbd, 0xf3,
      0xaa, 0x57, 0xdd, 0x81, 0xd6, 0xa2, 0xca, 0xfa, 0x64, 0x22, 0x4d, 0x74, 0x17, 0x7b, 0x23, 0x74, 0xbe, 0x2a, 0x95,
      0x23, 0x23, 0x44, 0x15, 0x0,  0x9,  0x1e, 0xd9, 0xf3, 0x42, 0xa9, 0x81, 0xad, 0xef, 0x9a, 0x1c, 0x0,  0x18, 0xa2,
      0x9e, 0xee, 0x6e, 0x53, 0xf,  0x2e, 0xa1, 0x39, 0xc3, 0xb3, 0xb8, 0x17, 0x83, 0x8d, 0x4b, 0x33, 0xac, 0xae, 0x3b,
      0x79, 0xa0, 0x1a, 0x68, 0xb,  0x1e, 0x8,  0x0,  0xe,  0xc,  0x2a, 0xbf, 0xb3, 0xc1, 0xfb, 0x84, 0x67, 0x96, 0x4d,
      0x57, 0xc8, 0x8a, 0xca, 0x26, 0x0,  0x3,  0x1a, 0x26, 0x6b, 0x0,  0xc,  0xf7, 0x52, 0x22, 0x9c, 0x97, 0x29, 0x96,
      0x13, 0x9c, 0x4d, 0x6e, 0x2,  0x2,  0x0,  0x0,  0x64, 0x1,  0x27, 0x0,  0x0,  0x75, 0x3d, 0x13, 0xa,  0xaa, 0x17,
      0xcc, 0x1c, 0x0,  0x8,  0x7a, 0xa9, 0xd9, 0xf8, 0xca, 0xb7, 0x29, 0xaa, 0x8,  0x0,  0x14, 0x7e, 0xd5, 0xa9, 0x36,
      0x51, 0x96, 0x8a, 0x11, 0x92, 0xbd, 0x5a, 0x9d, 0xe6, 0xc1, 0xb2, 0x98, 0xfc, 0x95, 0xda, 0xd9, 0x23, 0xe,  0x45,
      0x27, 0x0,  0x0,  0x2b, 0xa,  0x17, 0x49, 0x22, 0x50, 0x1c, 0x15, 0x0,  0xa,  0xf7, 0x2,  0x20, 0x8a, 0x59, 0x4a,
      0xe3, 0x15, 0x46, 0x89, 0x29, 0xd,  0xf0, 0xec, 0x9b, 0xe,  0x70, 0xdd, 0xd9, 0x27, 0xe1, 0xa3, 0x4b, 0x80};

  uint8_t buf[275] = {0};

  uint8_t topic_bytes[] = {0x51, 0xc9, 0x84, 0xaf, 0x5b, 0xce, 0xb7, 0x2e, 0xcc, 0xc8, 0x70, 0xe0, 0x58, 0xad,
                           0xa3, 0x4d, 0x46, 0x17, 0xfb, 0xdf, 0x54, 0x7e, 0xc,  0x8,  0x57, 0xf1, 0xb3, 0xb4};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf0, 0xec, 0x9b, 0xe, 0x70, 0xdd, 0xd9, 0x27, 0xe1, 0xa3, 0x4b, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x9b, 0x4,  0x41, 0x4b, 0x0,  0xae, 0xdc, 0x2c, 0x4b, 0x5d, 0x69, 0x11, 0x9d,
                           0x31, 0x88, 0xfb, 0x72, 0xa8, 0x5a, 0x5d, 0xa,  0xbd, 0xf0, 0x68, 0x98, 0x4};
  uint8_t bytesprops1[] = {0xbd, 0xf3, 0xaa, 0x57, 0xdd, 0x81, 0xd6, 0xa2, 0xca, 0xfa, 0x64};
  uint8_t bytesprops2[] = {0x1e, 0xd9, 0xf3, 0x42, 0xa9, 0x81, 0xad, 0xef, 0x9a};
  uint8_t bytesprops3[] = {0xa2, 0x9e, 0xee, 0x6e, 0x53, 0xf,  0x2e, 0xa1, 0x39, 0xc3, 0xb3, 0xb8,
                           0x17, 0x83, 0x8d, 0x4b, 0x33, 0xac, 0xae, 0x3b, 0x79, 0xa0, 0x1a, 0x68};
  uint8_t bytesprops4[] = {0xc, 0x2a, 0xbf, 0xb3, 0xc1, 0xfb, 0x84, 0x67, 0x96, 0x4d, 0x57, 0xc8, 0x8a, 0xca};
  uint8_t bytesprops6[] = {0xf7, 0x52, 0x22, 0x9c, 0x97, 0x29, 0x96, 0x13, 0x9c, 0x4d, 0x6e, 0x2};
  uint8_t bytesprops5[] = {0x1a, 0x26, 0x6b};
  uint8_t bytesprops7[] = {0x7a, 0xa9, 0xd9, 0xf8, 0xca, 0xb7, 0x29, 0xaa};
  uint8_t bytesprops8[] = {0x7e, 0xd5, 0xa9, 0x36, 0x51, 0x96, 0x8a, 0x11, 0x92, 0xbd,
                           0x5a, 0x9d, 0xe6, 0xc1, 0xb2, 0x98, 0xfc, 0x95, 0xda, 0xd9};
  uint8_t bytesprops9[] = {0xf7, 0x2, 0x20, 0x8a, 0x59, 0x4a, 0xe3, 0x15, 0x46, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29496}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19828}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29886}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9028}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops5}, .v = {12, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25601}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30013}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2730}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3653}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11018}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20508}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 2085, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\162\236\175\234}", _pubPktID =
// 21077, _pubBody = "T\207i\212;Q", _pubProps = [PropResponseTopic ""]}
TEST(Publish5QCTest, Encode31) {
  uint8_t pkt[] = {0x33, 0x13, 0x0, 0x5, 0xa2, 0xec, 0xaf, 0xea, 0x7d, 0x52, 0x55,
                   0x3,  0x8,  0x0, 0x0, 0x54, 0xcf, 0x69, 0xd4, 0x3b, 0x51};

  uint8_t buf[31] = {0};

  uint8_t topic_bytes[] = {0xa2, 0xec, 0xaf, 0xea, 0x7d};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x54, 0xcf, 0x69, 0xd4, 0x3b, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 21077, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "(E<Sa", _pubPktID = 9852, _pubBody =
// "VJ7\212\SYN\205\162\203\131\160\209\DC2\ACK<\208\135s\183rT\171\162%XrO\173qk", _pubProps = [PropMaximumQoS
// 223,PropServerKeepAlive 17295,PropUserProperty "'\NAK\157" "\151",PropMaximumPacketSize 11623,PropTopicAlias
// 6795,PropTopicAliasMaximum 4317,PropAssignedClientIdentifier "\188m\173\221",PropCorrelationData "",PropUserProperty
// "4\155\n\173\157\165W-\247\225\253\DLE"
// "x\201\172@+\179\ETX5\235\169\192\209\183\174\214\206\169\214\229\130\137",PropMessageExpiryInterval
// 22445,PropReceiveMaximum 11205,PropAuthenticationData "2z\214\DC1[-\247\168\SUB",PropRequestProblemInformation
// 191,PropCorrelationData "\243\143",PropMaximumQoS 90,PropAuthenticationData "\DC4\137{",PropResponseInformation
// "\248K\226\244X\213ez\180\217\152;VS\RS\n\DLE\229[Y\193<,PeQB\ESC\227",PropServerKeepAlive
// 17287,PropMaximumPacketSize 7806,PropWildcardSubscriptionAvailable 11,PropSubscriptionIdentifier
// 28,PropMessageExpiryInterval 2764,PropMessageExpiryInterval 7341,PropReceiveMaximum 24078,PropServerReference
// "\244\\",PropSubscriptionIdentifier 30,PropTopicAliasMaximum 17035,PropRetainAvailable 35]}
TEST(Publish5QCTest, Encode32) {
  uint8_t pkt[] = {0x3a, 0xd9, 0x1,  0x0,  0x5,  0x28, 0x45, 0x3c, 0x53, 0x61, 0x26, 0x7c, 0xb1, 0x1,  0x24, 0xdf, 0x13,
                   0x43, 0x8f, 0x26, 0x0,  0x3,  0x27, 0x15, 0x9d, 0x0,  0x1,  0x97, 0x27, 0x0,  0x0,  0x2d, 0x67, 0x23,
                   0x1a, 0x8b, 0x22, 0x10, 0xdd, 0x12, 0x0,  0x4,  0xbc, 0x6d, 0xad, 0xdd, 0x9,  0x0,  0x0,  0x26, 0x0,
                   0xc,  0x34, 0x9b, 0xa,  0xad, 0x9d, 0xa5, 0x57, 0x2d, 0xf7, 0xe1, 0xfd, 0x10, 0x0,  0x15, 0x78, 0xc9,
                   0xac, 0x40, 0x2b, 0xb3, 0x3,  0x35, 0xeb, 0xa9, 0xc0, 0xd1, 0xb7, 0xae, 0xd6, 0xce, 0xa9, 0xd6, 0xe5,
                   0x82, 0x89, 0x2,  0x0,  0x0,  0x57, 0xad, 0x21, 0x2b, 0xc5, 0x16, 0x0,  0x9,  0x32, 0x7a, 0xd6, 0x11,
                   0x5b, 0x2d, 0xf7, 0xa8, 0x1a, 0x17, 0xbf, 0x9,  0x0,  0x2,  0xf3, 0x8f, 0x24, 0x5a, 0x16, 0x0,  0x3,
                   0x14, 0x89, 0x7b, 0x1a, 0x0,  0x1d, 0xf8, 0x4b, 0xe2, 0xf4, 0x58, 0xd5, 0x65, 0x7a, 0xb4, 0xd9, 0x98,
                   0x3b, 0x56, 0x53, 0x1e, 0xa,  0x10, 0xe5, 0x5b, 0x59, 0xc1, 0x3c, 0x2c, 0x50, 0x65, 0x51, 0x42, 0x1b,
                   0xe3, 0x13, 0x43, 0x87, 0x27, 0x0,  0x0,  0x1e, 0x7e, 0x28, 0xb,  0xb,  0x1c, 0x2,  0x0,  0x0,  0xa,
                   0xcc, 0x2,  0x0,  0x0,  0x1c, 0xad, 0x21, 0x5e, 0xe,  0x1c, 0x0,  0x2,  0xf4, 0x5c, 0xb,  0x1e, 0x22,
                   0x42, 0x8b, 0x25, 0x23, 0x56, 0x4a, 0x37, 0xd4, 0x16, 0xcd, 0xa2, 0xcb, 0x83, 0xa0, 0xd1, 0x12, 0x6,
                   0x3c, 0xd0, 0x87, 0x73, 0xb7, 0x72, 0x54, 0xab, 0xa2, 0x25, 0x58, 0x72, 0x4f, 0xad, 0x71, 0x6b};

  uint8_t buf[230] = {0};

  uint8_t topic_bytes[] = {0x28, 0x45, 0x3c, 0x53, 0x61};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x56, 0x4a, 0x37, 0xd4, 0x16, 0xcd, 0xa2, 0xcb, 0x83, 0xa0, 0xd1, 0x12, 0x6,  0x3c, 0xd0,
                         0x87, 0x73, 0xb7, 0x72, 0x54, 0xab, 0xa2, 0x25, 0x58, 0x72, 0x4f, 0xad, 0x71, 0x6b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops1[] = {0x97};
  uint8_t bytesprops0[] = {0x27, 0x15, 0x9d};
  uint8_t bytesprops2[] = {0xbc, 0x6d, 0xad, 0xdd};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops5[] = {0x78, 0xc9, 0xac, 0x40, 0x2b, 0xb3, 0x3,  0x35, 0xeb, 0xa9, 0xc0,
                           0xd1, 0xb7, 0xae, 0xd6, 0xce, 0xa9, 0xd6, 0xe5, 0x82, 0x89};
  uint8_t bytesprops4[] = {0x34, 0x9b, 0xa, 0xad, 0x9d, 0xa5, 0x57, 0x2d, 0xf7, 0xe1, 0xfd, 0x10};
  uint8_t bytesprops6[] = {0x32, 0x7a, 0xd6, 0x11, 0x5b, 0x2d, 0xf7, 0xa8, 0x1a};
  uint8_t bytesprops7[] = {0xf3, 0x8f};
  uint8_t bytesprops8[] = {0x14, 0x89, 0x7b};
  uint8_t bytesprops9[] = {0xf8, 0x4b, 0xe2, 0xf4, 0x58, 0xd5, 0x65, 0x7a, 0xb4, 0xd9, 0x98, 0x3b, 0x56, 0x53, 0x1e,
                           0xa,  0x10, 0xe5, 0x5b, 0x59, 0xc1, 0x3c, 0x2c, 0x50, 0x65, 0x51, 0x42, 0x1b, 0xe3};
  uint8_t bytesprops10[] = {0xf4, 0x5c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17295}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops0}, .v = {1, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11623}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6795}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4317}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops4}, .v = {21, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22445}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11205}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17287}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7806}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2764}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7341}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24078}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17035}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 9852, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\160", _pubPktID = 20635, _pubBody =
// "\220\193\SOH\ESC\150\212\SUB\t\156\222\ETB\160\148h", _pubProps = [PropResponseTopic "\174=\157\128\173"]}
TEST(Publish5QCTest, Encode33) {
  uint8_t pkt[] = {0x3d, 0x1c, 0x0,  0x1, 0xa0, 0x50, 0x9b, 0x8,  0x8, 0x0,  0x5,  0xae, 0x3d, 0x9d, 0x80,
                   0xad, 0xdc, 0xc1, 0x1, 0x1b, 0x96, 0xd4, 0x1a, 0x9, 0x9c, 0xde, 0x17, 0xa0, 0x94, 0x68};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0xa0};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdc, 0xc1, 0x1, 0x1b, 0x96, 0xd4, 0x1a, 0x9, 0x9c, 0xde, 0x17, 0xa0, 0x94, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xae, 0x3d, 0x9d, 0x80, 0xad};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 20635, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\196\196\197
// \157\210\229\244\227\218\220\203\176\251\&4\NUL\171\DLE#\251\&9\174+\EM\197\STXt", _pubPktID = 5923, _pubBody =
// "\US[\n\SI=4\153\142(\NAK", _pubProps = [PropRequestProblemInformation 156,PropCorrelationData
// "`\155\153d\US\178\244\177\&8\195B\197\187v\248\GS\180~\154\140G",PropTopicAlias 14650,PropMaximumPacketSize
// 22984,PropAssignedClientIdentifier
// "5C^\212\n\USz\255\191\"\ETB\247\135\144\166i\134\\7?6?",PropWildcardSubscriptionAvailable 16,PropCorrelationData
// "\176*\EM_j\199\&1",PropServerKeepAlive 3990,PropAssignedClientIdentifier
// "EU4\136:\n\186\239\DC2\241R\160\133\SUB\205C\ACK\135\199\234cYV\226Iw\156\243\&4",PropAssignedClientIdentifier
// "A\243\226\158\SO\186\SI\\F_\v\252\140\180\DC2\250<\165\129\SUB",PropWildcardSubscriptionAvailable 203]}
TEST(Publish5QCTest, Encode34) {
  uint8_t pkt[] = {0x34, 0xae, 0x1,  0x0,  0x1b, 0xc4, 0xc4, 0xc5, 0x20, 0x9d, 0xd2, 0xe5, 0xf4, 0xe3, 0xda, 0xdc, 0xcb,
                   0xb0, 0xfb, 0x34, 0x0,  0xab, 0x10, 0x23, 0xfb, 0x39, 0xae, 0x2b, 0x19, 0xc5, 0x2,  0x74, 0x17, 0x23,
                   0x83, 0x1,  0x17, 0x9c, 0x9,  0x0,  0x15, 0x60, 0x9b, 0x99, 0x64, 0x1f, 0xb2, 0xf4, 0xb1, 0x38, 0xc3,
                   0x42, 0xc5, 0xbb, 0x76, 0xf8, 0x1d, 0xb4, 0x7e, 0x9a, 0x8c, 0x47, 0x23, 0x39, 0x3a, 0x27, 0x0,  0x0,
                   0x59, 0xc8, 0x12, 0x0,  0x16, 0x35, 0x43, 0x5e, 0xd4, 0xa,  0x1f, 0x7a, 0xff, 0xbf, 0x22, 0x17, 0xf7,
                   0x87, 0x90, 0xa6, 0x69, 0x86, 0x5c, 0x37, 0x3f, 0x36, 0x3f, 0x28, 0x10, 0x9,  0x0,  0x7,  0xb0, 0x2a,
                   0x19, 0x5f, 0x6a, 0xc7, 0x31, 0x13, 0xf,  0x96, 0x12, 0x0,  0x1d, 0x45, 0x55, 0x34, 0x88, 0x3a, 0xa,
                   0xba, 0xef, 0x12, 0xf1, 0x52, 0xa0, 0x85, 0x1a, 0xcd, 0x43, 0x6,  0x87, 0xc7, 0xea, 0x63, 0x59, 0x56,
                   0xe2, 0x49, 0x77, 0x9c, 0xf3, 0x34, 0x12, 0x0,  0x14, 0x41, 0xf3, 0xe2, 0x9e, 0xe,  0xba, 0xf,  0x5c,
                   0x46, 0x5f, 0xb,  0xfc, 0x8c, 0xb4, 0x12, 0xfa, 0x3c, 0xa5, 0x81, 0x1a, 0x28, 0xcb, 0x1f, 0x5b, 0xa,
                   0xf,  0x3d, 0x34, 0x99, 0x8e, 0x28, 0x15};

  uint8_t buf[187] = {0};

  uint8_t topic_bytes[] = {0xc4, 0xc4, 0xc5, 0x20, 0x9d, 0xd2, 0xe5, 0xf4, 0xe3, 0xda, 0xdc, 0xcb, 0xb0, 0xfb,
                           0x34, 0x0,  0xab, 0x10, 0x23, 0xfb, 0x39, 0xae, 0x2b, 0x19, 0xc5, 0x2,  0x74};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1f, 0x5b, 0xa, 0xf, 0x3d, 0x34, 0x99, 0x8e, 0x28, 0x15};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x60, 0x9b, 0x99, 0x64, 0x1f, 0xb2, 0xf4, 0xb1, 0x38, 0xc3, 0x42,
                           0xc5, 0xbb, 0x76, 0xf8, 0x1d, 0xb4, 0x7e, 0x9a, 0x8c, 0x47};
  uint8_t bytesprops1[] = {0x35, 0x43, 0x5e, 0xd4, 0xa,  0x1f, 0x7a, 0xff, 0xbf, 0x22, 0x17,
                           0xf7, 0x87, 0x90, 0xa6, 0x69, 0x86, 0x5c, 0x37, 0x3f, 0x36, 0x3f};
  uint8_t bytesprops2[] = {0xb0, 0x2a, 0x19, 0x5f, 0x6a, 0xc7, 0x31};
  uint8_t bytesprops3[] = {0x45, 0x55, 0x34, 0x88, 0x3a, 0xa,  0xba, 0xef, 0x12, 0xf1, 0x52, 0xa0, 0x85, 0x1a, 0xcd,
                           0x43, 0x6,  0x87, 0xc7, 0xea, 0x63, 0x59, 0x56, 0xe2, 0x49, 0x77, 0x9c, 0xf3, 0x34};
  uint8_t bytesprops4[] = {0x41, 0xf3, 0xe2, 0x9e, 0xe,  0xba, 0xf,  0x5c, 0x46, 0x5f,
                           0xb,  0xfc, 0x8c, 0xb4, 0x12, 0xfa, 0x3c, 0xa5, 0x81, 0x1a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14650}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22984}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3990}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 203}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 5923, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\158\"Y{N(\209\&3h\199\152\255\233\186\191", _pubPktID = 26160, _pubBody =
// "\EM\255\ESCWL\245\184\&2\192\185X\214\233t\187 \133\DC4Q", _pubProps = [PropAssignedClientIdentifier
// "\DEL;\188\154\215\\\v\247j\134",PropMaximumQoS 41,PropSharedSubscriptionAvailable 165,PropMessageExpiryInterval
// 27721,PropSubscriptionIdentifier 3,PropAuthenticationData
// "\ACK\242\166\181\172vZ\174\162\US\158\144",PropAssignedClientIdentifier
// "\GS\180_\225\221o",PropSharedSubscriptionAvailable 126,PropSubscriptionIdentifierAvailable 129]}
TEST(Publish5QCTest, Encode35) {
  uint8_t pkt[] = {0x3d, 0x5b, 0x0,  0xf,  0x9e, 0x22, 0x59, 0x7b, 0x4e, 0x28, 0xd1, 0x33, 0x68, 0xc7, 0x98, 0xff,
                   0xe9, 0xba, 0xbf, 0x66, 0x30, 0x34, 0x12, 0x0,  0xa,  0x7f, 0x3b, 0xbc, 0x9a, 0xd7, 0x5c, 0xb,
                   0xf7, 0x6a, 0x86, 0x24, 0x29, 0x2a, 0xa5, 0x2,  0x0,  0x0,  0x6c, 0x49, 0xb,  0x3,  0x16, 0x0,
                   0xc,  0x6,  0xf2, 0xa6, 0xb5, 0xac, 0x76, 0x5a, 0xae, 0xa2, 0x1f, 0x9e, 0x90, 0x12, 0x0,  0x6,
                   0x1d, 0xb4, 0x5f, 0xe1, 0xdd, 0x6f, 0x2a, 0x7e, 0x29, 0x81, 0x19, 0xff, 0x1b, 0x57, 0x4c, 0xf5,
                   0xb8, 0x32, 0xc0, 0xb9, 0x58, 0xd6, 0xe9, 0x74, 0xbb, 0x20, 0x85, 0x14, 0x51};

  uint8_t buf[103] = {0};

  uint8_t topic_bytes[] = {0x9e, 0x22, 0x59, 0x7b, 0x4e, 0x28, 0xd1, 0x33, 0x68, 0xc7, 0x98, 0xff, 0xe9, 0xba, 0xbf};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x19, 0xff, 0x1b, 0x57, 0x4c, 0xf5, 0xb8, 0x32, 0xc0, 0xb9,
                         0x58, 0xd6, 0xe9, 0x74, 0xbb, 0x20, 0x85, 0x14, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x7f, 0x3b, 0xbc, 0x9a, 0xd7, 0x5c, 0xb, 0xf7, 0x6a, 0x86};
  uint8_t bytesprops1[] = {0x6, 0xf2, 0xa6, 0xb5, 0xac, 0x76, 0x5a, 0xae, 0xa2, 0x1f, 0x9e, 0x90};
  uint8_t bytesprops2[] = {0x1d, 0xb4, 0x5f, 0xe1, 0xdd, 0x6f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27721}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 129}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 26160, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\151", _pubPktID = 0, _pubBody =
// "\216N\144\&7\CAN\136\v\176\152", _pubProps = [PropUserProperty
// "\189\239\214\"\236'\198\247.\STX\r\138U\133\244\&8\SOH\167\216\SI\255eT6\158" "",PropTopicAlias
// 5174,PropReceiveMaximum 15173,PropUserProperty "\208\&6GO\242\248\172\188"
// "\"\233C\148X@F6\128\b\164",PropSubscriptionIdentifier 2,PropTopicAlias 18460,PropSubscriptionIdentifierAvailable
// 89,PropRequestProblemInformation 159,PropResponseTopic "",PropReasonString "\ETX\253\141\&6K\"\241\182l\246\252\208
// Q\170p\168\167\139}\EOT\220",PropWillDelayInterval 12822,PropUserProperty
// "@\175\167\247\137c\SIi\183\172\248\149m\NAK\SOH\146Y\128\201)\201S\159hP\DC2\251\187kz"
// "o\211\244\255\173\195\219\156,7\189OK\t\218qv\138#\US$\218b\232\132\&3\131\180\163\RS"]}
TEST(Publish5QCTest, Encode36) {
  uint8_t pkt[] = {0x39, 0xb5, 0x1,  0x0,  0x1,  0x97, 0xa7, 0x1,  0x26, 0x0,  0x19, 0xbd, 0xef, 0xd6, 0x22, 0xec, 0x27,
                   0xc6, 0xf7, 0x2e, 0x2,  0xd,  0x8a, 0x55, 0x85, 0xf4, 0x38, 0x1,  0xa7, 0xd8, 0xf,  0xff, 0x65, 0x54,
                   0x36, 0x9e, 0x0,  0x0,  0x23, 0x14, 0x36, 0x21, 0x3b, 0x45, 0x26, 0x0,  0x8,  0xd0, 0x36, 0x47, 0x4f,
                   0xf2, 0xf8, 0xac, 0xbc, 0x0,  0xb,  0x22, 0xe9, 0x43, 0x94, 0x58, 0x40, 0x46, 0x36, 0x80, 0x8,  0xa4,
                   0xb,  0x2,  0x23, 0x48, 0x1c, 0x29, 0x59, 0x17, 0x9f, 0x8,  0x0,  0x0,  0x1f, 0x0,  0x16, 0x3,  0xfd,
                   0x8d, 0x36, 0x4b, 0x22, 0xf1, 0xb6, 0x6c, 0xf6, 0xfc, 0xd0, 0x20, 0x51, 0xaa, 0x70, 0xa8, 0xa7, 0x8b,
                   0x7d, 0x4,  0xdc, 0x18, 0x0,  0x0,  0x32, 0x16, 0x26, 0x0,  0x1e, 0x40, 0xaf, 0xa7, 0xf7, 0x89, 0x63,
                   0xf,  0x69, 0xb7, 0xac, 0xf8, 0x95, 0x6d, 0x15, 0x1,  0x92, 0x59, 0x80, 0xc9, 0x29, 0xc9, 0x53, 0x9f,
                   0x68, 0x50, 0x12, 0xfb, 0xbb, 0x6b, 0x7a, 0x0,  0x1e, 0x6f, 0xd3, 0xf4, 0xff, 0xad, 0xc3, 0xdb, 0x9c,
                   0x2c, 0x37, 0xbd, 0x4f, 0x4b, 0x9,  0xda, 0x71, 0x76, 0x8a, 0x23, 0x1f, 0x24, 0xda, 0x62, 0xe8, 0x84,
                   0x33, 0x83, 0xb4, 0xa3, 0x1e, 0xd8, 0x4e, 0x90, 0x37, 0x18, 0x88, 0xb,  0xb0, 0x98};

  uint8_t buf[194] = {0};

  uint8_t topic_bytes[] = {0x97};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0x4e, 0x90, 0x37, 0x18, 0x88, 0xb, 0xb0, 0x98};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0xbd, 0xef, 0xd6, 0x22, 0xec, 0x27, 0xc6, 0xf7, 0x2e, 0x2,  0xd,  0x8a, 0x55,
                           0x85, 0xf4, 0x38, 0x1,  0xa7, 0xd8, 0xf,  0xff, 0x65, 0x54, 0x36, 0x9e};
  uint8_t bytesprops3[] = {0x22, 0xe9, 0x43, 0x94, 0x58, 0x40, 0x46, 0x36, 0x80, 0x8, 0xa4};
  uint8_t bytesprops2[] = {0xd0, 0x36, 0x47, 0x4f, 0xf2, 0xf8, 0xac, 0xbc};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0x3,  0xfd, 0x8d, 0x36, 0x4b, 0x22, 0xf1, 0xb6, 0x6c, 0xf6, 0xfc,
                           0xd0, 0x20, 0x51, 0xaa, 0x70, 0xa8, 0xa7, 0x8b, 0x7d, 0x4,  0xdc};
  uint8_t bytesprops7[] = {0x6f, 0xd3, 0xf4, 0xff, 0xad, 0xc3, 0xdb, 0x9c, 0x2c, 0x37, 0xbd, 0x4f, 0x4b, 0x9,  0xda,
                           0x71, 0x76, 0x8a, 0x23, 0x1f, 0x24, 0xda, 0x62, 0xe8, 0x84, 0x33, 0x83, 0xb4, 0xa3, 0x1e};
  uint8_t bytesprops6[] = {0x40, 0xaf, 0xa7, 0xf7, 0x89, 0x63, 0xf,  0x69, 0xb7, 0xac, 0xf8, 0x95, 0x6d, 0x15, 0x1,
                           0x92, 0x59, 0x80, 0xc9, 0x29, 0xc9, 0x53, 0x9f, 0x68, 0x50, 0x12, 0xfb, 0xbb, 0x6b, 0x7a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5174}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15173}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops2}, .v = {11, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18460}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12822}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops6}, .v = {30, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\f\n|\ACK", _pubPktID = 0, _pubBody
// = "%\192\&0", _pubProps = [PropWildcardSubscriptionAvailable 134,PropResponseTopic
// "e\133\154\181\f\191",PropResponseInformation
// ",\192\238\248\212Sf\212j\DLE/\230\&2\216\241>\198",PropAuthenticationMethod
// "\153\GS\198\252\NUL\231J\172(\157\204J\155-\134\GS\177\217\"}\ESC:\DLE\181\156>\230>\254",PropMessageExpiryInterval
// 10851,PropSharedSubscriptionAvailable 75,PropMessageExpiryInterval 21060,PropRequestProblemInformation
// 25,PropContentType "\GS{",PropContentType ":=1'}\197\212\SOHMJ\DC2\ETX\DC4",PropResponseTopic
// "\128\177\246c?\SO\"V'\214\226\rb\EM\130;H\162\163xY;\173\215\165\SOH",PropCorrelationData
// "\r\215K\166\193\&2\v\216\169.\180$e\240H\212Ky\158\207(E\DLE\158\224\196\187\f",PropAuthenticationData
// "XRgE\190r\131\193\&0\174\181\223x\176.\nEi\250\219\157P!\n\238e",PropReceiveMaximum 11426,PropAuthenticationData
// "\244K:\153\208\210\160\&7B\238\162\158",PropRetainAvailable 20,PropMaximumQoS 9,PropSubscriptionIdentifier 25]}
TEST(Publish5QCTest, Encode37) {
  uint8_t pkt[] = {
      0x38, 0xde, 0x1,  0x0,  0x4,  0xc,  0xa,  0x7c, 0x6,  0xd3, 0x1,  0x28, 0x86, 0x8,  0x0,  0x6,  0x65, 0x85, 0x9a,
      0xb5, 0xc,  0xbf, 0x1a, 0x0,  0x11, 0x2c, 0xc0, 0xee, 0xf8, 0xd4, 0x53, 0x66, 0xd4, 0x6a, 0x10, 0x2f, 0xe6, 0x32,
      0xd8, 0xf1, 0x3e, 0xc6, 0x15, 0x0,  0x1d, 0x99, 0x1d, 0xc6, 0xfc, 0x0,  0xe7, 0x4a, 0xac, 0x28, 0x9d, 0xcc, 0x4a,
      0x9b, 0x2d, 0x86, 0x1d, 0xb1, 0xd9, 0x22, 0x7d, 0x1b, 0x3a, 0x10, 0xb5, 0x9c, 0x3e, 0xe6, 0x3e, 0xfe, 0x2,  0x0,
      0x0,  0x2a, 0x63, 0x2a, 0x4b, 0x2,  0x0,  0x0,  0x52, 0x44, 0x17, 0x19, 0x3,  0x0,  0x2,  0x1d, 0x7b, 0x3,  0x0,
      0xd,  0x3a, 0x3d, 0x31, 0x27, 0x7d, 0xc5, 0xd4, 0x1,  0x4d, 0x4a, 0x12, 0x3,  0x14, 0x8,  0x0,  0x1a, 0x80, 0xb1,
      0xf6, 0x63, 0x3f, 0xe,  0x22, 0x56, 0x27, 0xd6, 0xe2, 0xd,  0x62, 0x19, 0x82, 0x3b, 0x48, 0xa2, 0xa3, 0x78, 0x59,
      0x3b, 0xad, 0xd7, 0xa5, 0x1,  0x9,  0x0,  0x1c, 0xd,  0xd7, 0x4b, 0xa6, 0xc1, 0x32, 0xb,  0xd8, 0xa9, 0x2e, 0xb4,
      0x24, 0x65, 0xf0, 0x48, 0xd4, 0x4b, 0x79, 0x9e, 0xcf, 0x28, 0x45, 0x10, 0x9e, 0xe0, 0xc4, 0xbb, 0xc,  0x16, 0x0,
      0x1a, 0x58, 0x52, 0x67, 0x45, 0xbe, 0x72, 0x83, 0xc1, 0x30, 0xae, 0xb5, 0xdf, 0x78, 0xb0, 0x2e, 0xa,  0x45, 0x69,
      0xfa, 0xdb, 0x9d, 0x50, 0x21, 0xa,  0xee, 0x65, 0x21, 0x2c, 0xa2, 0x16, 0x0,  0xc,  0xf4, 0x4b, 0x3a, 0x99, 0xd0,
      0xd2, 0xa0, 0x37, 0x42, 0xee, 0xa2, 0x9e, 0x25, 0x14, 0x24, 0x9,  0xb,  0x19, 0x25, 0xc0, 0x30};

  uint8_t buf[235] = {0};

  uint8_t topic_bytes[] = {0xc, 0xa, 0x7c, 0x6};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0xc0, 0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x65, 0x85, 0x9a, 0xb5, 0xc, 0xbf};
  uint8_t bytesprops1[] = {0x2c, 0xc0, 0xee, 0xf8, 0xd4, 0x53, 0x66, 0xd4, 0x6a,
                           0x10, 0x2f, 0xe6, 0x32, 0xd8, 0xf1, 0x3e, 0xc6};
  uint8_t bytesprops2[] = {0x99, 0x1d, 0xc6, 0xfc, 0x0,  0xe7, 0x4a, 0xac, 0x28, 0x9d, 0xcc, 0x4a, 0x9b, 0x2d, 0x86,
                           0x1d, 0xb1, 0xd9, 0x22, 0x7d, 0x1b, 0x3a, 0x10, 0xb5, 0x9c, 0x3e, 0xe6, 0x3e, 0xfe};
  uint8_t bytesprops3[] = {0x1d, 0x7b};
  uint8_t bytesprops4[] = {0x3a, 0x3d, 0x31, 0x27, 0x7d, 0xc5, 0xd4, 0x1, 0x4d, 0x4a, 0x12, 0x3, 0x14};
  uint8_t bytesprops5[] = {0x80, 0xb1, 0xf6, 0x63, 0x3f, 0xe,  0x22, 0x56, 0x27, 0xd6, 0xe2, 0xd,  0x62,
                           0x19, 0x82, 0x3b, 0x48, 0xa2, 0xa3, 0x78, 0x59, 0x3b, 0xad, 0xd7, 0xa5, 0x1};
  uint8_t bytesprops6[] = {0xd,  0xd7, 0x4b, 0xa6, 0xc1, 0x32, 0xb,  0xd8, 0xa9, 0x2e, 0xb4, 0x24, 0x65, 0xf0,
                           0x48, 0xd4, 0x4b, 0x79, 0x9e, 0xcf, 0x28, 0x45, 0x10, 0x9e, 0xe0, 0xc4, 0xbb, 0xc};
  uint8_t bytesprops7[] = {0x58, 0x52, 0x67, 0x45, 0xbe, 0x72, 0x83, 0xc1, 0x30, 0xae, 0xb5, 0xdf, 0x78,
                           0xb0, 0x2e, 0xa,  0x45, 0x69, 0xfa, 0xdb, 0x9d, 0x50, 0x21, 0xa,  0xee, 0x65};
  uint8_t bytesprops8[] = {0xf4, 0x4b, 0x3a, 0x99, 0xd0, 0xd2, 0xa0, 0x37, 0x42, 0xee, 0xa2, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10851}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21060}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11426}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SUB\161\156|\172\155*2\212e\184\252<\195\a\180C\177\162\130\159\166L\200\SYN_", _pubPktID = 14022, _pubBody =
// "01c\156c\152\DC3@\149/\USy\FS\147\184,n\243\245\134Kc?E\206\131\ESC ;", _pubProps = [PropRequestResponseInformation
// 116,PropAuthenticationData "\RS\160\130\&3\210\DEL\194\EOT\216\176:Rx\175\213\186V\232",PropSessionExpiryInterval
// 23836,PropRetainAvailable 106,PropReceiveMaximum 21264,PropCorrelationData "\235\254M\143\199n
// &NMG(\ACK\221",PropMaximumPacketSize 3816,PropReceiveMaximum 24077,PropTopicAlias
// 11181,PropSubscriptionIdentifierAvailable 210,PropAssignedClientIdentifier "\187Z{\181\148\236\189 "]}
TEST(Publish5QCTest, Encode38) {
  uint8_t pkt[] = {0x32, 0x86, 0x1,  0x0,  0x1a, 0x1a, 0xa1, 0x9c, 0x7c, 0xac, 0x9b, 0x2a, 0x32, 0xd4, 0x65, 0xb8,
                   0xfc, 0x3c, 0xc3, 0x7,  0xb4, 0x43, 0xb1, 0xa2, 0x82, 0x9f, 0xa6, 0x4c, 0xc8, 0x16, 0x5f, 0x36,
                   0xc6, 0x4a, 0x19, 0x74, 0x16, 0x0,  0x12, 0x1e, 0xa0, 0x82, 0x33, 0xd2, 0x7f, 0xc2, 0x4,  0xd8,
                   0xb0, 0x3a, 0x52, 0x78, 0xaf, 0xd5, 0xba, 0x56, 0xe8, 0x11, 0x0,  0x0,  0x5d, 0x1c, 0x25, 0x6a,
                   0x21, 0x53, 0x10, 0x9,  0x0,  0xe,  0xeb, 0xfe, 0x4d, 0x8f, 0xc7, 0x6e, 0x20, 0x26, 0x4e, 0x4d,
                   0x47, 0x28, 0x6,  0xdd, 0x27, 0x0,  0x0,  0xe,  0xe8, 0x21, 0x5e, 0xd,  0x23, 0x2b, 0xad, 0x29,
                   0xd2, 0x12, 0x0,  0x8,  0xbb, 0x5a, 0x7b, 0xb5, 0x94, 0xec, 0xbd, 0x20, 0x30, 0x31, 0x63, 0x9c,
                   0x63, 0x98, 0x13, 0x40, 0x95, 0x2f, 0x1f, 0x79, 0x1c, 0x93, 0xb8, 0x2c, 0x6e, 0xf3, 0xf5, 0x86,
                   0x4b, 0x63, 0x3f, 0x45, 0xce, 0x83, 0x1b, 0x20, 0x3b};

  uint8_t buf[147] = {0};

  uint8_t topic_bytes[] = {0x1a, 0xa1, 0x9c, 0x7c, 0xac, 0x9b, 0x2a, 0x32, 0xd4, 0x65, 0xb8, 0xfc, 0x3c,
                           0xc3, 0x7,  0xb4, 0x43, 0xb1, 0xa2, 0x82, 0x9f, 0xa6, 0x4c, 0xc8, 0x16, 0x5f};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x30, 0x31, 0x63, 0x9c, 0x63, 0x98, 0x13, 0x40, 0x95, 0x2f, 0x1f, 0x79, 0x1c, 0x93, 0xb8,
                         0x2c, 0x6e, 0xf3, 0xf5, 0x86, 0x4b, 0x63, 0x3f, 0x45, 0xce, 0x83, 0x1b, 0x20, 0x3b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x1e, 0xa0, 0x82, 0x33, 0xd2, 0x7f, 0xc2, 0x4,  0xd8,
                           0xb0, 0x3a, 0x52, 0x78, 0xaf, 0xd5, 0xba, 0x56, 0xe8};
  uint8_t bytesprops1[] = {0xeb, 0xfe, 0x4d, 0x8f, 0xc7, 0x6e, 0x20, 0x26, 0x4e, 0x4d, 0x47, 0x28, 0x6, 0xdd};
  uint8_t bytesprops2[] = {0xbb, 0x5a, 0x7b, 0xb5, 0x94, 0xec, 0xbd, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23836}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21264}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3816}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24077}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11181}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 14022, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\186Kx\255\202i[\182\SUBu\242L\148\153\157\182\GSY)", _pubPktID = 16446, _pubBody =
// "\STX\188u\179*\236\174\253@\ACK\219x\192d\168\200\210\177-\181\250\207\176\230", _pubProps = [PropResponseTopic
// "",PropAssignedClientIdentifier "\193\144\&4\243\214\158\&0\222pH\139\128\&7}\ENQ\230",PropUserProperty "\185"
// "Uh\191\185\223\151\247M\r\ACK",PropMessageExpiryInterval 18691]}
TEST(Publish5QCTest, Encode39) {
  uint8_t pkt[] = {0x35, 0x5b, 0x0,  0x13, 0xba, 0x4b, 0x78, 0xff, 0xca, 0x69, 0x5b, 0xb6, 0x1a, 0x75, 0xf2, 0x4c,
                   0x94, 0x99, 0x9d, 0xb6, 0x1d, 0x59, 0x29, 0x40, 0x3e, 0x2b, 0x8,  0x0,  0x0,  0x12, 0x0,  0x10,
                   0xc1, 0x90, 0x34, 0xf3, 0xd6, 0x9e, 0x30, 0xde, 0x70, 0x48, 0x8b, 0x80, 0x37, 0x7d, 0x5,  0xe6,
                   0x26, 0x0,  0x1,  0xb9, 0x0,  0xa,  0x55, 0x68, 0xbf, 0xb9, 0xdf, 0x97, 0xf7, 0x4d, 0xd,  0x6,
                   0x2,  0x0,  0x0,  0x49, 0x3,  0x2,  0xbc, 0x75, 0xb3, 0x2a, 0xec, 0xae, 0xfd, 0x40, 0x6,  0xdb,
                   0x78, 0xc0, 0x64, 0xa8, 0xc8, 0xd2, 0xb1, 0x2d, 0xb5, 0xfa, 0xcf, 0xb0, 0xe6};

  uint8_t buf[103] = {0};

  uint8_t topic_bytes[] = {0xba, 0x4b, 0x78, 0xff, 0xca, 0x69, 0x5b, 0xb6, 0x1a, 0x75,
                           0xf2, 0x4c, 0x94, 0x99, 0x9d, 0xb6, 0x1d, 0x59, 0x29};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2,  0xbc, 0x75, 0xb3, 0x2a, 0xec, 0xae, 0xfd, 0x40, 0x6,  0xdb, 0x78,
                         0xc0, 0x64, 0xa8, 0xc8, 0xd2, 0xb1, 0x2d, 0xb5, 0xfa, 0xcf, 0xb0, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xc1, 0x90, 0x34, 0xf3, 0xd6, 0x9e, 0x30, 0xde,
                           0x70, 0x48, 0x8b, 0x80, 0x37, 0x7d, 0x5,  0xe6};
  uint8_t bytesprops3[] = {0x55, 0x68, 0xbf, 0xb9, 0xdf, 0x97, 0xf7, 0x4d, 0xd, 0x6};
  uint8_t bytesprops2[] = {0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops2}, .v = {10, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18691}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16446, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\252\171\ETB\146\NUL\152K`)b\NAK\180\148v\174B%\160\203\135\202\RS,\162aK\ESCF\183\140", _pubPktID = 0, _pubBody = "
// \173\153\209\219\234pW\207F\221\202q\136\227\190\"\199\130", _pubProps = [PropCorrelationData
// "\250h\141\206S\214R:",PropSubscriptionIdentifier 14,PropMaximumQoS 192,PropPayloadFormatIndicator
// 128,PropWillDelayInterval 12161,PropResponseInformation "\162\STX\182$P\222^\197^\168",PropMessageExpiryInterval
// 23150,PropRequestResponseInformation 246,PropRequestProblemInformation 60,PropUserProperty
// "=\t8\189\247\151?b\160\143\212\193\195m\210p\190\137u\RS\250"
// "\226\NAK\233J\197\224x\149~\222\206L",PropWillDelayInterval 20295,PropRequestProblemInformation 222,PropMaximumQoS
// 208,PropRequestProblemInformation 70,PropAuthenticationMethod
// "P\SUB\165\182\254\SO\224\128>b\t6\199\r\253\170\174\202\189tz2\243\&5\138\236P\192\200"]}
TEST(Publish5QCTest, Encode40) {
  uint8_t pkt[] = {0x30, 0xb1, 0x1,  0x0,  0x1e, 0xfc, 0xab, 0x17, 0x92, 0x0,  0x98, 0x4b, 0x60, 0x29, 0x62, 0x15, 0xb4,
                   0x94, 0x76, 0xae, 0x42, 0x25, 0xa0, 0xcb, 0x87, 0xca, 0x1e, 0x2c, 0xa2, 0x61, 0x4b, 0x1b, 0x46, 0xb7,
                   0x8c, 0x7d, 0x9,  0x0,  0x8,  0xfa, 0x68, 0x8d, 0xce, 0x53, 0xd6, 0x52, 0x3a, 0xb,  0xe,  0x24, 0xc0,
                   0x1,  0x80, 0x18, 0x0,  0x0,  0x2f, 0x81, 0x1a, 0x0,  0xa,  0xa2, 0x2,  0xb6, 0x24, 0x50, 0xde, 0x5e,
                   0xc5, 0x5e, 0xa8, 0x2,  0x0,  0x0,  0x5a, 0x6e, 0x19, 0xf6, 0x17, 0x3c, 0x26, 0x0,  0x15, 0x3d, 0x9,
                   0x38, 0xbd, 0xf7, 0x97, 0x3f, 0x62, 0xa0, 0x8f, 0xd4, 0xc1, 0xc3, 0x6d, 0xd2, 0x70, 0xbe, 0x89, 0x75,
                   0x1e, 0xfa, 0x0,  0xc,  0xe2, 0x15, 0xe9, 0x4a, 0xc5, 0xe0, 0x78, 0x95, 0x7e, 0xde, 0xce, 0x4c, 0x18,
                   0x0,  0x0,  0x4f, 0x47, 0x17, 0xde, 0x24, 0xd0, 0x17, 0x46, 0x15, 0x0,  0x1d, 0x50, 0x1a, 0xa5, 0xb6,
                   0xfe, 0xe,  0xe0, 0x80, 0x3e, 0x62, 0x9,  0x36, 0xc7, 0xd,  0xfd, 0xaa, 0xae, 0xca, 0xbd, 0x74, 0x7a,
                   0x32, 0xf3, 0x35, 0x8a, 0xec, 0x50, 0xc0, 0xc8, 0x20, 0xad, 0x99, 0xd1, 0xdb, 0xea, 0x70, 0x57, 0xcf,
                   0x46, 0xdd, 0xca, 0x71, 0x88, 0xe3, 0xbe, 0x22, 0xc7, 0x82};

  uint8_t buf[190] = {0};

  uint8_t topic_bytes[] = {0xfc, 0xab, 0x17, 0x92, 0x0,  0x98, 0x4b, 0x60, 0x29, 0x62, 0x15, 0xb4, 0x94, 0x76, 0xae,
                           0x42, 0x25, 0xa0, 0xcb, 0x87, 0xca, 0x1e, 0x2c, 0xa2, 0x61, 0x4b, 0x1b, 0x46, 0xb7, 0x8c};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x20, 0xad, 0x99, 0xd1, 0xdb, 0xea, 0x70, 0x57, 0xcf, 0x46,
                         0xdd, 0xca, 0x71, 0x88, 0xe3, 0xbe, 0x22, 0xc7, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xfa, 0x68, 0x8d, 0xce, 0x53, 0xd6, 0x52, 0x3a};
  uint8_t bytesprops1[] = {0xa2, 0x2, 0xb6, 0x24, 0x50, 0xde, 0x5e, 0xc5, 0x5e, 0xa8};
  uint8_t bytesprops3[] = {0xe2, 0x15, 0xe9, 0x4a, 0xc5, 0xe0, 0x78, 0x95, 0x7e, 0xde, 0xce, 0x4c};
  uint8_t bytesprops2[] = {0x3d, 0x9,  0x38, 0xbd, 0xf7, 0x97, 0x3f, 0x62, 0xa0, 0x8f, 0xd4,
                           0xc1, 0xc3, 0x6d, 0xd2, 0x70, 0xbe, 0x89, 0x75, 0x1e, 0xfa};
  uint8_t bytesprops4[] = {0x50, 0x1a, 0xa5, 0xb6, 0xfe, 0xe,  0xe0, 0x80, 0x3e, 0x62, 0x9,  0x36, 0xc7, 0xd, 0xfd,
                           0xaa, 0xae, 0xca, 0xbd, 0x74, 0x7a, 0x32, 0xf3, 0x35, 0x8a, 0xec, 0x50, 0xc0, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12161}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23150}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops2}, .v = {12, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20295}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\166z\ENQ\171\210s\190J\237\153\219\210", _pubPktID = 15842, _pubBody = "\221-AF\157\205\a\153)\165QYh", _pubProps =
// [PropServerReference "\255R\216}\b\237\189\223\&8\SOH<\231\232<\SOH\142-;\184\212;\193u",PropServerReference
// "@QM\241\217\236\SUB\168a\236\188Y\191\214\189L\192",PropReasonString
// "\US\n\178\DC3\222\SOq\213\ETX\SUB",PropTopicAliasMaximum 23180,PropAssignedClientIdentifier
// "\217\203u\EM0\136\170\141\199\159L\225\207):\233\200\242",PropAuthenticationData "\EM\164(",PropUserProperty
// "o\ENQ9\184Y)\143\210\218/\181<(W\194\&4\146\164\171\174\160Nc\STX\207\249\196\242\169"
// "\128vU\185\186\&0\205\216\171C\148\241\SUB\ESC\235\247\139\137n?\"\233\231\180p\188\165",PropAuthenticationData
// "x\161\189\255#\152\163\214",PropMessageExpiryInterval 10220,PropReasonString "\172\232\145H\188",PropCorrelationData
// "\205ep\159\228O\174\143\ETB(LL\212\191KL\US}\153\235\188'\190\DC2\180\217u\RS%k",PropMaximumPacketSize 19148]}
TEST(Publish5QCTest, Encode41) {
  uint8_t pkt[] = {
      0x35, 0xf3, 0x1,  0x0,  0xc,  0xa6, 0x7a, 0x5,  0xab, 0xd2, 0x73, 0xbe, 0x4a, 0xed, 0x99, 0xdb, 0xd2, 0x3d, 0xe2,
      0xd4, 0x1,  0x1c, 0x0,  0x17, 0xff, 0x52, 0xd8, 0x7d, 0x8,  0xed, 0xbd, 0xdf, 0x38, 0x1,  0x3c, 0xe7, 0xe8, 0x3c,
      0x1,  0x8e, 0x2d, 0x3b, 0xb8, 0xd4, 0x3b, 0xc1, 0x75, 0x1c, 0x0,  0x11, 0x40, 0x51, 0x4d, 0xf1, 0xd9, 0xec, 0x1a,
      0xa8, 0x61, 0xec, 0xbc, 0x59, 0xbf, 0xd6, 0xbd, 0x4c, 0xc0, 0x1f, 0x0,  0xa,  0x1f, 0xa,  0xb2, 0x13, 0xde, 0xe,
      0x71, 0xd5, 0x3,  0x1a, 0x22, 0x5a, 0x8c, 0x12, 0x0,  0x12, 0xd9, 0xcb, 0x75, 0x19, 0x30, 0x88, 0xaa, 0x8d, 0xc7,
      0x9f, 0x4c, 0xe1, 0xcf, 0x29, 0x3a, 0xe9, 0xc8, 0xf2, 0x16, 0x0,  0x3,  0x19, 0xa4, 0x28, 0x26, 0x0,  0x1d, 0x6f,
      0x5,  0x39, 0xb8, 0x59, 0x29, 0x8f, 0xd2, 0xda, 0x2f, 0xb5, 0x3c, 0x28, 0x57, 0xc2, 0x34, 0x92, 0xa4, 0xab, 0xae,
      0xa0, 0x4e, 0x63, 0x2,  0xcf, 0xf9, 0xc4, 0xf2, 0xa9, 0x0,  0x1b, 0x80, 0x76, 0x55, 0xb9, 0xba, 0x30, 0xcd, 0xd8,
      0xab, 0x43, 0x94, 0xf1, 0x1a, 0x1b, 0xeb, 0xf7, 0x8b, 0x89, 0x6e, 0x3f, 0x22, 0xe9, 0xe7, 0xb4, 0x70, 0xbc, 0xa5,
      0x16, 0x0,  0x8,  0x78, 0xa1, 0xbd, 0xff, 0x23, 0x98, 0xa3, 0xd6, 0x2,  0x0,  0x0,  0x27, 0xec, 0x1f, 0x0,  0x5,
      0xac, 0xe8, 0x91, 0x48, 0xbc, 0x9,  0x0,  0x1e, 0xcd, 0x65, 0x70, 0x9f, 0xe4, 0x4f, 0xae, 0x8f, 0x17, 0x28, 0x4c,
      0x4c, 0xd4, 0xbf, 0x4b, 0x4c, 0x1f, 0x7d, 0x99, 0xeb, 0xbc, 0x27, 0xbe, 0x12, 0xb4, 0xd9, 0x75, 0x1e, 0x25, 0x6b,
      0x27, 0x0,  0x0,  0x4a, 0xcc, 0xdd, 0x2d, 0x41, 0x46, 0x9d, 0xcd, 0x7,  0x99, 0x29, 0xa5, 0x51, 0x59, 0x68};

  uint8_t buf[256] = {0};

  uint8_t topic_bytes[] = {0xa6, 0x7a, 0x5, 0xab, 0xd2, 0x73, 0xbe, 0x4a, 0xed, 0x99, 0xdb, 0xd2};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0x2d, 0x41, 0x46, 0x9d, 0xcd, 0x7, 0x99, 0x29, 0xa5, 0x51, 0x59, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0xff, 0x52, 0xd8, 0x7d, 0x8,  0xed, 0xbd, 0xdf, 0x38, 0x1,  0x3c, 0xe7,
                           0xe8, 0x3c, 0x1,  0x8e, 0x2d, 0x3b, 0xb8, 0xd4, 0x3b, 0xc1, 0x75};
  uint8_t bytesprops1[] = {0x40, 0x51, 0x4d, 0xf1, 0xd9, 0xec, 0x1a, 0xa8, 0x61,
                           0xec, 0xbc, 0x59, 0xbf, 0xd6, 0xbd, 0x4c, 0xc0};
  uint8_t bytesprops2[] = {0x1f, 0xa, 0xb2, 0x13, 0xde, 0xe, 0x71, 0xd5, 0x3, 0x1a};
  uint8_t bytesprops3[] = {0xd9, 0xcb, 0x75, 0x19, 0x30, 0x88, 0xaa, 0x8d, 0xc7,
                           0x9f, 0x4c, 0xe1, 0xcf, 0x29, 0x3a, 0xe9, 0xc8, 0xf2};
  uint8_t bytesprops4[] = {0x19, 0xa4, 0x28};
  uint8_t bytesprops6[] = {0x80, 0x76, 0x55, 0xb9, 0xba, 0x30, 0xcd, 0xd8, 0xab, 0x43, 0x94, 0xf1, 0x1a, 0x1b,
                           0xeb, 0xf7, 0x8b, 0x89, 0x6e, 0x3f, 0x22, 0xe9, 0xe7, 0xb4, 0x70, 0xbc, 0xa5};
  uint8_t bytesprops5[] = {0x6f, 0x5,  0x39, 0xb8, 0x59, 0x29, 0x8f, 0xd2, 0xda, 0x2f, 0xb5, 0x3c, 0x28, 0x57, 0xc2,
                           0x34, 0x92, 0xa4, 0xab, 0xae, 0xa0, 0x4e, 0x63, 0x2,  0xcf, 0xf9, 0xc4, 0xf2, 0xa9};
  uint8_t bytesprops7[] = {0x78, 0xa1, 0xbd, 0xff, 0x23, 0x98, 0xa3, 0xd6};
  uint8_t bytesprops8[] = {0xac, 0xe8, 0x91, 0x48, 0xbc};
  uint8_t bytesprops9[] = {0xcd, 0x65, 0x70, 0x9f, 0xe4, 0x4f, 0xae, 0x8f, 0x17, 0x28, 0x4c, 0x4c, 0xd4, 0xbf, 0x4b,
                           0x4c, 0x1f, 0x7d, 0x99, 0xeb, 0xbc, 0x27, 0xbe, 0x12, 0xb4, 0xd9, 0x75, 0x1e, 0x25, 0x6b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23180}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops5}, .v = {27, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10220}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19148}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 15842, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\206v6D\250\210o\GS\204\139H\184\vu\245\236z", _pubPktID = 6705, _pubBody =
// "\f\211\163\197\&3\254\185\161\DC2\198\aX\255", _pubProps = [PropReceiveMaximum 9095,PropReasonString
// ".\200\nrz\149\201\143\162>\209\221\174\158i\161\132IN",PropPayloadFormatIndicator 233]}
TEST(Publish5QCTest, Encode42) {
  uint8_t pkt[] = {0x3d, 0x3e, 0x0,  0x11, 0xce, 0x76, 0x36, 0x44, 0xfa, 0xd2, 0x6f, 0x1d, 0xcc, 0x8b, 0x48, 0xb8,
                   0xb,  0x75, 0xf5, 0xec, 0x7a, 0x1a, 0x31, 0x1b, 0x21, 0x23, 0x87, 0x1f, 0x0,  0x13, 0x2e, 0xc8,
                   0xa,  0x72, 0x7a, 0x95, 0xc9, 0x8f, 0xa2, 0x3e, 0xd1, 0xdd, 0xae, 0x9e, 0x69, 0xa1, 0x84, 0x49,
                   0x4e, 0x1,  0xe9, 0xc,  0xd3, 0xa3, 0xc5, 0x33, 0xfe, 0xb9, 0xa1, 0x12, 0xc6, 0x7,  0x58, 0xff};

  uint8_t buf[74] = {0};

  uint8_t topic_bytes[] = {0xce, 0x76, 0x36, 0x44, 0xfa, 0xd2, 0x6f, 0x1d, 0xcc,
                           0x8b, 0x48, 0xb8, 0xb,  0x75, 0xf5, 0xec, 0x7a};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc, 0xd3, 0xa3, 0xc5, 0x33, 0xfe, 0xb9, 0xa1, 0x12, 0xc6, 0x7, 0x58, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x2e, 0xc8, 0xa,  0x72, 0x7a, 0x95, 0xc9, 0x8f, 0xa2, 0x3e,
                           0xd1, 0xdd, 0xae, 0x9e, 0x69, 0xa1, 0x84, 0x49, 0x4e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9095}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6705, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146n\207\252s\SOHt\253N\US(M?\NAK&\NAKR\139\193\&4\SOH\152\179\v", _pubPktID = 0, _pubBody =
// "\139b\185\b\186\&5\RS\EOT\166\STXV\149\135/\DEL$\167\144u", _pubProps = [PropContentType
// "\210\147A\224\DC4&\222\175_ l\189${",PropWildcardSubscriptionAvailable 216,PropTopicAliasMaximum
// 7359,PropSubscriptionIdentifierAvailable 158,PropTopicAliasMaximum 2955,PropAuthenticationMethod
// "\247\157\221\203\228B\EM\170\209\236\176\&6\DEL\208",PropReasonString
// "\SUB\177n\245\222`\165@\185\205\253m\146X\231\131W\181\238\232\203",PropSessionExpiryInterval
// 24406,PropTopicAliasMaximum 25543,PropMessageExpiryInterval 21136,PropTopicAlias 21657,PropSessionExpiryInterval
// 11033,PropAuthenticationData "\128pR\231\225\221>A\224",PropSharedSubscriptionAvailable
// 110,PropWildcardSubscriptionAvailable 106,PropResponseInformation
// "\221>%\139L\205\b\142\f\215\134|\172\147*\228\b\229\140\194(\SO\226\186\b",PropContentType "\SOHN!\156M\188"]}
TEST(Publish5QCTest, Encode43) {
  uint8_t pkt[] = {0x31, 0xbd, 0x1,  0x0,  0x18, 0x92, 0x6e, 0xcf, 0xfc, 0x73, 0x1,  0x74, 0xfd, 0x4e, 0x1f, 0x28,
                   0x4d, 0x3f, 0x15, 0x26, 0x15, 0x52, 0x8b, 0xc1, 0x34, 0x1,  0x98, 0xb3, 0xb,  0x8e, 0x1,  0x3,
                   0x0,  0xe,  0xd2, 0x93, 0x41, 0xe0, 0x14, 0x26, 0xde, 0xaf, 0x5f, 0x20, 0x6c, 0xbd, 0x24, 0x7b,
                   0x28, 0xd8, 0x22, 0x1c, 0xbf, 0x29, 0x9e, 0x22, 0xb,  0x8b, 0x15, 0x0,  0xe,  0xf7, 0x9d, 0xdd,
                   0xcb, 0xe4, 0x42, 0x19, 0xaa, 0xd1, 0xec, 0xb0, 0x36, 0x7f, 0xd0, 0x1f, 0x0,  0x15, 0x1a, 0xb1,
                   0x6e, 0xf5, 0xde, 0x60, 0xa5, 0x40, 0xb9, 0xcd, 0xfd, 0x6d, 0x92, 0x58, 0xe7, 0x83, 0x57, 0xb5,
                   0xee, 0xe8, 0xcb, 0x11, 0x0,  0x0,  0x5f, 0x56, 0x22, 0x63, 0xc7, 0x2,  0x0,  0x0,  0x52, 0x90,
                   0x23, 0x54, 0x99, 0x11, 0x0,  0x0,  0x2b, 0x19, 0x16, 0x0,  0x9,  0x80, 0x70, 0x52, 0xe7, 0xe1,
                   0xdd, 0x3e, 0x41, 0xe0, 0x2a, 0x6e, 0x28, 0x6a, 0x1a, 0x0,  0x19, 0xdd, 0x3e, 0x25, 0x8b, 0x4c,
                   0xcd, 0x8,  0x8e, 0xc,  0xd7, 0x86, 0x7c, 0xac, 0x93, 0x2a, 0xe4, 0x8,  0xe5, 0x8c, 0xc2, 0x28,
                   0xe,  0xe2, 0xba, 0x8,  0x3,  0x0,  0x6,  0x1,  0x4e, 0x21, 0x9c, 0x4d, 0xbc, 0x8b, 0x62, 0xb9,
                   0x8,  0xba, 0x35, 0x1e, 0x4,  0xa6, 0x2,  0x56, 0x95, 0x87, 0x2f, 0x7f, 0x24, 0xa7, 0x90, 0x75};

  uint8_t buf[202] = {0};

  uint8_t topic_bytes[] = {0x92, 0x6e, 0xcf, 0xfc, 0x73, 0x1,  0x74, 0xfd, 0x4e, 0x1f, 0x28, 0x4d,
                           0x3f, 0x15, 0x26, 0x15, 0x52, 0x8b, 0xc1, 0x34, 0x1,  0x98, 0xb3, 0xb};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8b, 0x62, 0xb9, 0x8,  0xba, 0x35, 0x1e, 0x4,  0xa6, 0x2,
                         0x56, 0x95, 0x87, 0x2f, 0x7f, 0x24, 0xa7, 0x90, 0x75};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xd2, 0x93, 0x41, 0xe0, 0x14, 0x26, 0xde, 0xaf, 0x5f, 0x20, 0x6c, 0xbd, 0x24, 0x7b};
  uint8_t bytesprops1[] = {0xf7, 0x9d, 0xdd, 0xcb, 0xe4, 0x42, 0x19, 0xaa, 0xd1, 0xec, 0xb0, 0x36, 0x7f, 0xd0};
  uint8_t bytesprops2[] = {0x1a, 0xb1, 0x6e, 0xf5, 0xde, 0x60, 0xa5, 0x40, 0xb9, 0xcd, 0xfd,
                           0x6d, 0x92, 0x58, 0xe7, 0x83, 0x57, 0xb5, 0xee, 0xe8, 0xcb};
  uint8_t bytesprops3[] = {0x80, 0x70, 0x52, 0xe7, 0xe1, 0xdd, 0x3e, 0x41, 0xe0};
  uint8_t bytesprops4[] = {0xdd, 0x3e, 0x25, 0x8b, 0x4c, 0xcd, 0x8,  0x8e, 0xc, 0xd7, 0x86, 0x7c, 0xac,
                           0x93, 0x2a, 0xe4, 0x8,  0xe5, 0x8c, 0xc2, 0x28, 0xe, 0xe2, 0xba, 0x8};
  uint8_t bytesprops5[] = {0x1, 0x4e, 0x21, 0x9c, 0x4d, 0xbc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7359}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2955}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24406}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25543}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21136}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21657}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11033}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\205\235\&9L\b\236\187\184{\199\135G\165c\200\144\SO\NUL\234u\SYN\142O\177N:\161\&8", _pubPktID = 0, _pubBody =
// "Z \DEL\193\197\&7K\147\137\199b]\243}\248\161\248.Y\218bb\132\156\GS\DC2>\224", _pubProps =
// [PropSharedSubscriptionAvailable 130,PropTopicAlias 27548,PropSubscriptionIdentifier 11,PropAssignedClientIdentifier
// "\192#\158\221\154Z\129\236\235",PropServerReference "\216",PropServerKeepAlive 15984]}
TEST(Publish5QCTest, Encode44) {
  uint8_t pkt[] = {0x31, 0x56, 0x0,  0x1d, 0xa8, 0xcd, 0xeb, 0x39, 0x4c, 0x8,  0xec, 0xbb, 0xb8, 0x7b, 0xc7,
                   0x87, 0x47, 0xa5, 0x63, 0xc8, 0x90, 0xe,  0x0,  0xea, 0x75, 0x16, 0x8e, 0x4f, 0xb1, 0x4e,
                   0x3a, 0xa1, 0x38, 0x1a, 0x2a, 0x82, 0x23, 0x6b, 0x9c, 0xb,  0xb,  0x12, 0x0,  0x9,  0xc0,
                   0x23, 0x9e, 0xdd, 0x9a, 0x5a, 0x81, 0xec, 0xeb, 0x1c, 0x0,  0x1,  0xd8, 0x13, 0x3e, 0x70,
                   0x5a, 0x20, 0x7f, 0xc1, 0xc5, 0x37, 0x4b, 0x93, 0x89, 0xc7, 0x62, 0x5d, 0xf3, 0x7d, 0xf8,
                   0xa1, 0xf8, 0x2e, 0x59, 0xda, 0x62, 0x62, 0x84, 0x9c, 0x1d, 0x12, 0x3e, 0xe0};

  uint8_t buf[98] = {0};

  uint8_t topic_bytes[] = {0xa8, 0xcd, 0xeb, 0x39, 0x4c, 0x8,  0xec, 0xbb, 0xb8, 0x7b, 0xc7, 0x87, 0x47, 0xa5, 0x63,
                           0xc8, 0x90, 0xe,  0x0,  0xea, 0x75, 0x16, 0x8e, 0x4f, 0xb1, 0x4e, 0x3a, 0xa1, 0x38};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5a, 0x20, 0x7f, 0xc1, 0xc5, 0x37, 0x4b, 0x93, 0x89, 0xc7, 0x62, 0x5d, 0xf3, 0x7d,
                         0xf8, 0xa1, 0xf8, 0x2e, 0x59, 0xda, 0x62, 0x62, 0x84, 0x9c, 0x1d, 0x12, 0x3e, 0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0xc0, 0x23, 0x9e, 0xdd, 0x9a, 0x5a, 0x81, 0xec, 0xeb};
  uint8_t bytesprops1[] = {0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27548}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15984}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\165r\DEL\n\202\133kb\136",
// _pubPktID = 7921, _pubBody = "O\248\206?\215\168\&4\DC1\131\187<1\176\200\EOTW \FSu\ETB3\128\222N\241\193\180",
// _pubProps = [PropCorrelationData
// "\230\STX\158\128\DC1\131or\DC3\252\217\177\229\&1\166\252w\EOT*\US",PropServerKeepAlive 21189,PropAuthenticationData
// "H\135\248\221\220@\NUL\229\RS\153\224",PropAuthenticationMethod
// "\135\ESC\251\189<\EM\"(b\158\211\250\ETXX",PropSubscriptionIdentifier 12,PropRetainAvailable
// 59,PropTopicAliasMaximum 27318,PropServerKeepAlive 18157,PropCorrelationData "~\254\CAN\SYN",PropCorrelationData
// "v\137\254\DC2\200a",PropWillDelayInterval 19675,PropResponseInformation
// "P\190\205z'E\151/\229]8,\215\244\&9e}F_",PropWillDelayInterval 4361]}
TEST(Publish5QCTest, Encode45) {
  uint8_t pkt[] = {0x3c, 0x9c, 0x1,  0x0,  0x9,  0xa5, 0x72, 0x7f, 0xa,  0xca, 0x85, 0x6b, 0x62, 0x88, 0x1e, 0xf1,
                   0x73, 0x9,  0x0,  0x14, 0xe6, 0x2,  0x9e, 0x80, 0x11, 0x83, 0x6f, 0x72, 0x13, 0xfc, 0xd9, 0xb1,
                   0xe5, 0x31, 0xa6, 0xfc, 0x77, 0x4,  0x2a, 0x1f, 0x13, 0x52, 0xc5, 0x16, 0x0,  0xb,  0x48, 0x87,
                   0xf8, 0xdd, 0xdc, 0x40, 0x0,  0xe5, 0x1e, 0x99, 0xe0, 0x15, 0x0,  0xe,  0x87, 0x1b, 0xfb, 0xbd,
                   0x3c, 0x19, 0x22, 0x28, 0x62, 0x9e, 0xd3, 0xfa, 0x3,  0x58, 0xb,  0xc,  0x25, 0x3b, 0x22, 0x6a,
                   0xb6, 0x13, 0x46, 0xed, 0x9,  0x0,  0x4,  0x7e, 0xfe, 0x18, 0x16, 0x9,  0x0,  0x6,  0x76, 0x89,
                   0xfe, 0x12, 0xc8, 0x61, 0x18, 0x0,  0x0,  0x4c, 0xdb, 0x1a, 0x0,  0x13, 0x50, 0xbe, 0xcd, 0x7a,
                   0x27, 0x45, 0x97, 0x2f, 0xe5, 0x5d, 0x38, 0x2c, 0xd7, 0xf4, 0x39, 0x65, 0x7d, 0x46, 0x5f, 0x18,
                   0x0,  0x0,  0x11, 0x9,  0x4f, 0xf8, 0xce, 0x3f, 0xd7, 0xa8, 0x34, 0x11, 0x83, 0xbb, 0x3c, 0x31,
                   0xb0, 0xc8, 0x4,  0x57, 0x20, 0x1c, 0x75, 0x17, 0x33, 0x80, 0xde, 0x4e, 0xf1, 0xc1, 0xb4};

  uint8_t buf[169] = {0};

  uint8_t topic_bytes[] = {0xa5, 0x72, 0x7f, 0xa, 0xca, 0x85, 0x6b, 0x62, 0x88};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4f, 0xf8, 0xce, 0x3f, 0xd7, 0xa8, 0x34, 0x11, 0x83, 0xbb, 0x3c, 0x31, 0xb0, 0xc8,
                         0x4,  0x57, 0x20, 0x1c, 0x75, 0x17, 0x33, 0x80, 0xde, 0x4e, 0xf1, 0xc1, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0xe6, 0x2,  0x9e, 0x80, 0x11, 0x83, 0x6f, 0x72, 0x13, 0xfc,
                           0xd9, 0xb1, 0xe5, 0x31, 0xa6, 0xfc, 0x77, 0x4,  0x2a, 0x1f};
  uint8_t bytesprops1[] = {0x48, 0x87, 0xf8, 0xdd, 0xdc, 0x40, 0x0, 0xe5, 0x1e, 0x99, 0xe0};
  uint8_t bytesprops2[] = {0x87, 0x1b, 0xfb, 0xbd, 0x3c, 0x19, 0x22, 0x28, 0x62, 0x9e, 0xd3, 0xfa, 0x3, 0x58};
  uint8_t bytesprops3[] = {0x7e, 0xfe, 0x18, 0x16};
  uint8_t bytesprops4[] = {0x76, 0x89, 0xfe, 0x12, 0xc8, 0x61};
  uint8_t bytesprops5[] = {0x50, 0xbe, 0xcd, 0x7a, 0x27, 0x45, 0x97, 0x2f, 0xe5, 0x5d,
                           0x38, 0x2c, 0xd7, 0xf4, 0x39, 0x65, 0x7d, 0x46, 0x5f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21189}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27318}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18157}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19675}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4361}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7921, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\228\161\&1\220\142H\211q3\179%~Q\148", _pubPktID = 29868, _pubBody = "nP\243G", _pubProps = [PropMaximumQoS
// 80,PropRequestResponseInformation 5,PropTopicAliasMaximum 5247,PropAssignedClientIdentifier
// "?\ESC\SOP\ETB",PropAuthenticationMethod
// "\200F7\169sZ\200\254\158/R\203\134O\206\STX\218\ACK\245",PropSharedSubscriptionAvailable 68,PropRetainAvailable 26]}
TEST(Publish5QCTest, Encode46) {
  uint8_t pkt[] = {0x33, 0x40, 0x0,  0xe,  0xe4, 0xa1, 0x31, 0xdc, 0x8e, 0x48, 0xd3, 0x71, 0x33, 0xb3, 0x25, 0x7e, 0x51,
                   0x94, 0x74, 0xac, 0x29, 0x24, 0x50, 0x19, 0x5,  0x22, 0x14, 0x7f, 0x12, 0x0,  0x5,  0x3f, 0x1b, 0xe,
                   0x50, 0x17, 0x15, 0x0,  0x13, 0xc8, 0x46, 0x37, 0xa9, 0x73, 0x5a, 0xc8, 0xfe, 0x9e, 0x2f, 0x52, 0xcb,
                   0x86, 0x4f, 0xce, 0x2,  0xda, 0x6,  0xf5, 0x2a, 0x44, 0x25, 0x1a, 0x6e, 0x50, 0xf3, 0x47};

  uint8_t buf[76] = {0};

  uint8_t topic_bytes[] = {0xe4, 0xa1, 0x31, 0xdc, 0x8e, 0x48, 0xd3, 0x71, 0x33, 0xb3, 0x25, 0x7e, 0x51, 0x94};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0x50, 0xf3, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0x3f, 0x1b, 0xe, 0x50, 0x17};
  uint8_t bytesprops1[] = {0xc8, 0x46, 0x37, 0xa9, 0x73, 0x5a, 0xc8, 0xfe, 0x9e, 0x2f,
                           0x52, 0xcb, 0x86, 0x4f, 0xce, 0x2,  0xda, 0x6,  0xf5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5247}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 26}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29868, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\NUL\211nNzt\150\194r\182+\179\199\146", _pubPktID = 0, _pubBody =
// "]8\167\v\179vF\250\130{$\169\150w^\190QS]U\227C\205\189\179[\ENQ\131\SUB\200", _pubProps = [PropContentType
// "\242q\192\128\132ia{",PropRetainAvailable 127,PropRequestResponseInformation 135,PropReasonString
// "",PropResponseInformation "\185oz7|\184\129\146",PropServerKeepAlive 7156,PropRequestProblemInformation
// 81,PropMaximumQoS 92,PropPayloadFormatIndicator 243,PropMessageExpiryInterval 16726,PropRequestResponseInformation
// 54,PropResponseTopic "\199UC\206\132\STX\130\&47z\147",PropSubscriptionIdentifierAvailable
// 238,PropWildcardSubscriptionAvailable 239,PropServerKeepAlive 1245,PropSubscriptionIdentifierAvailable
// 57,PropAuthenticationData "\218\245\DC3\r\167\241n8xP\250\207v,;\169\&5n\r"]}
TEST(Publish5QCTest, Encode47) {
  uint8_t pkt[] = {0x38, 0x89, 0x1,  0x0,  0xe,  0x0,  0xd3, 0x6e, 0x4e, 0x7a, 0x74, 0x96, 0xc2, 0x72, 0xb6, 0x2b,
                   0xb3, 0xc7, 0x92, 0x5a, 0x3,  0x0,  0x8,  0xf2, 0x71, 0xc0, 0x80, 0x84, 0x69, 0x61, 0x7b, 0x25,
                   0x7f, 0x19, 0x87, 0x1f, 0x0,  0x0,  0x1a, 0x0,  0x8,  0xb9, 0x6f, 0x7a, 0x37, 0x7c, 0xb8, 0x81,
                   0x92, 0x13, 0x1b, 0xf4, 0x17, 0x51, 0x24, 0x5c, 0x1,  0xf3, 0x2,  0x0,  0x0,  0x41, 0x56, 0x19,
                   0x36, 0x8,  0x0,  0xb,  0xc7, 0x55, 0x43, 0xce, 0x84, 0x2,  0x82, 0x34, 0x37, 0x7a, 0x93, 0x29,
                   0xee, 0x28, 0xef, 0x13, 0x4,  0xdd, 0x29, 0x39, 0x16, 0x0,  0x13, 0xda, 0xf5, 0x13, 0xd,  0xa7,
                   0xf1, 0x6e, 0x38, 0x78, 0x50, 0xfa, 0xcf, 0x76, 0x2c, 0x3b, 0xa9, 0x35, 0x6e, 0xd,  0x5d, 0x38,
                   0xa7, 0xb,  0xb3, 0x76, 0x46, 0xfa, 0x82, 0x7b, 0x24, 0xa9, 0x96, 0x77, 0x5e, 0xbe, 0x51, 0x53,
                   0x5d, 0x55, 0xe3, 0x43, 0xcd, 0xbd, 0xb3, 0x5b, 0x5,  0x83, 0x1a, 0xc8};

  uint8_t buf[150] = {0};

  uint8_t topic_bytes[] = {0x0, 0xd3, 0x6e, 0x4e, 0x7a, 0x74, 0x96, 0xc2, 0x72, 0xb6, 0x2b, 0xb3, 0xc7, 0x92};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5d, 0x38, 0xa7, 0xb,  0xb3, 0x76, 0x46, 0xfa, 0x82, 0x7b, 0x24, 0xa9, 0x96, 0x77, 0x5e,
                         0xbe, 0x51, 0x53, 0x5d, 0x55, 0xe3, 0x43, 0xcd, 0xbd, 0xb3, 0x5b, 0x5,  0x83, 0x1a, 0xc8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xf2, 0x71, 0xc0, 0x80, 0x84, 0x69, 0x61, 0x7b};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xb9, 0x6f, 0x7a, 0x37, 0x7c, 0xb8, 0x81, 0x92};
  uint8_t bytesprops3[] = {0xc7, 0x55, 0x43, 0xce, 0x84, 0x2, 0x82, 0x34, 0x37, 0x7a, 0x93};
  uint8_t bytesprops4[] = {0xda, 0xf5, 0x13, 0xd,  0xa7, 0xf1, 0x6e, 0x38, 0x78, 0x50,
                           0xfa, 0xcf, 0x76, 0x2c, 0x3b, 0xa9, 0x35, 0x6e, 0xd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7156}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16726}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1245}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "'\245\224\138\229\155\&6\241\GS\"t\ETX5%4?\146\ETB", _pubPktID = 0, _pubBody = "\SUB)\222", _pubProps =
// [PropWildcardSubscriptionAvailable 255,PropSessionExpiryInterval 647,PropRequestResponseInformation
// 228,PropTopicAliasMaximum 30065,PropAssignedClientIdentifier
// "\250_\139\fO\183\233\217\212\218~\194,p\159\&5\226\198\145\DC1\131]",PropWillDelayInterval 18202,PropMaximumQoS
// 132,PropUserProperty "\197WY\US\250\217\138\GSy\ACKa@\240R\RS\ETX\182\195t\175G\161\GS\151\r\185\151\216\247"
// "&tr\176\249\201\233\RS\DLE\209\239\194*\148",PropAuthenticationMethod "\161",PropReceiveMaximum
// 12170,PropAssignedClientIdentifier "H\168\154\242j{\n\128{\"v",PropTopicAliasMaximum 18145,PropResponseTopic
// "\148\129q\206\189\205\191\254\150.\247\STX\142\151\162d>\141\228\SOH\181\"\178\ACK\248\136E\181\US",PropServerKeepAlive
// 29047,PropServerKeepAlive 21427,PropContentType "\246\\\183\&6gu\251\ETBq\151\165[c",PropSubscriptionIdentifier
// 23,PropTopicAliasMaximum 24626,PropPayloadFormatIndicator 144,PropResponseInformation
// "\DC1\143/\171\ETB\202\r+\238\254#\206G\138\139\231h\177\210aB*\210m\252\239\236\152",PropRequestProblemInformation
// 26,PropAssignedClientIdentifier "\237\171\195\186\160H\223\131\128a:",PropAuthenticationData
// "\ESC\178\249\EOT\201\224\234C?\ESC\139\147k\174\158\STX\SUB6\193",PropPayloadFormatIndicator
// 18,PropSharedSubscriptionAvailable 65]}
TEST(Publish5QCTest, Encode48) {
  uint8_t pkt[] = {
      0x39, 0x93, 0x2,  0x0,  0x12, 0x27, 0xf5, 0xe0, 0x8a, 0xe5, 0x9b, 0x36, 0xf1, 0x1d, 0x22, 0x74, 0x3,  0x35, 0x25,
      0x34, 0x3f, 0x92, 0x17, 0xfa, 0x1,  0x28, 0xff, 0x11, 0x0,  0x0,  0x2,  0x87, 0x19, 0xe4, 0x22, 0x75, 0x71, 0x12,
      0x0,  0x16, 0xfa, 0x5f, 0x8b, 0xc,  0x4f, 0xb7, 0xe9, 0xd9, 0xd4, 0xda, 0x7e, 0xc2, 0x2c, 0x70, 0x9f, 0x35, 0xe2,
      0xc6, 0x91, 0x11, 0x83, 0x5d, 0x18, 0x0,  0x0,  0x47, 0x1a, 0x24, 0x84, 0x26, 0x0,  0x1d, 0xc5, 0x57, 0x59, 0x1f,
      0xfa, 0xd9, 0x8a, 0x1d, 0x79, 0x6,  0x61, 0x40, 0xf0, 0x52, 0x1e, 0x3,  0xb6, 0xc3, 0x74, 0xaf, 0x47, 0xa1, 0x1d,
      0x97, 0xd,  0xb9, 0x97, 0xd8, 0xf7, 0x0,  0xe,  0x26, 0x74, 0x72, 0xb0, 0xf9, 0xc9, 0xe9, 0x1e, 0x10, 0xd1, 0xef,
      0xc2, 0x2a, 0x94, 0x15, 0x0,  0x1,  0xa1, 0x21, 0x2f, 0x8a, 0x12, 0x0,  0xb,  0x48, 0xa8, 0x9a, 0xf2, 0x6a, 0x7b,
      0xa,  0x80, 0x7b, 0x22, 0x76, 0x22, 0x46, 0xe1, 0x8,  0x0,  0x1d, 0x94, 0x81, 0x71, 0xce, 0xbd, 0xcd, 0xbf, 0xfe,
      0x96, 0x2e, 0xf7, 0x2,  0x8e, 0x97, 0xa2, 0x64, 0x3e, 0x8d, 0xe4, 0x1,  0xb5, 0x22, 0xb2, 0x6,  0xf8, 0x88, 0x45,
      0xb5, 0x1f, 0x13, 0x71, 0x77, 0x13, 0x53, 0xb3, 0x3,  0x0,  0xd,  0xf6, 0x5c, 0xb7, 0x36, 0x67, 0x75, 0xfb, 0x17,
      0x71, 0x97, 0xa5, 0x5b, 0x63, 0xb,  0x17, 0x22, 0x60, 0x32, 0x1,  0x90, 0x1a, 0x0,  0x1c, 0x11, 0x8f, 0x2f, 0xab,
      0x17, 0xca, 0xd,  0x2b, 0xee, 0xfe, 0x23, 0xce, 0x47, 0x8a, 0x8b, 0xe7, 0x68, 0xb1, 0xd2, 0x61, 0x42, 0x2a, 0xd2,
      0x6d, 0xfc, 0xef, 0xec, 0x98, 0x17, 0x1a, 0x12, 0x0,  0xb,  0xed, 0xab, 0xc3, 0xba, 0xa0, 0x48, 0xdf, 0x83, 0x80,
      0x61, 0x3a, 0x16, 0x0,  0x13, 0x1b, 0xb2, 0xf9, 0x4,  0xc9, 0xe0, 0xea, 0x43, 0x3f, 0x1b, 0x8b, 0x93, 0x6b, 0xae,
      0x9e, 0x2,  0x1a, 0x36, 0xc1, 0x1,  0x12, 0x2a, 0x41, 0x1a, 0x29, 0xde};

  uint8_t buf[288] = {0};

  uint8_t topic_bytes[] = {0x27, 0xf5, 0xe0, 0x8a, 0xe5, 0x9b, 0x36, 0xf1, 0x1d,
                           0x22, 0x74, 0x3,  0x35, 0x25, 0x34, 0x3f, 0x92, 0x17};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1a, 0x29, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xfa, 0x5f, 0x8b, 0xc,  0x4f, 0xb7, 0xe9, 0xd9, 0xd4, 0xda, 0x7e,
                           0xc2, 0x2c, 0x70, 0x9f, 0x35, 0xe2, 0xc6, 0x91, 0x11, 0x83, 0x5d};
  uint8_t bytesprops2[] = {0x26, 0x74, 0x72, 0xb0, 0xf9, 0xc9, 0xe9, 0x1e, 0x10, 0xd1, 0xef, 0xc2, 0x2a, 0x94};
  uint8_t bytesprops1[] = {0xc5, 0x57, 0x59, 0x1f, 0xfa, 0xd9, 0x8a, 0x1d, 0x79, 0x6, 0x61, 0x40, 0xf0, 0x52, 0x1e,
                           0x3,  0xb6, 0xc3, 0x74, 0xaf, 0x47, 0xa1, 0x1d, 0x97, 0xd, 0xb9, 0x97, 0xd8, 0xf7};
  uint8_t bytesprops3[] = {0xa1};
  uint8_t bytesprops4[] = {0x48, 0xa8, 0x9a, 0xf2, 0x6a, 0x7b, 0xa, 0x80, 0x7b, 0x22, 0x76};
  uint8_t bytesprops5[] = {0x94, 0x81, 0x71, 0xce, 0xbd, 0xcd, 0xbf, 0xfe, 0x96, 0x2e, 0xf7, 0x2,  0x8e, 0x97, 0xa2,
                           0x64, 0x3e, 0x8d, 0xe4, 0x1,  0xb5, 0x22, 0xb2, 0x6,  0xf8, 0x88, 0x45, 0xb5, 0x1f};
  uint8_t bytesprops6[] = {0xf6, 0x5c, 0xb7, 0x36, 0x67, 0x75, 0xfb, 0x17, 0x71, 0x97, 0xa5, 0x5b, 0x63};
  uint8_t bytesprops7[] = {0x11, 0x8f, 0x2f, 0xab, 0x17, 0xca, 0xd,  0x2b, 0xee, 0xfe, 0x23, 0xce, 0x47, 0x8a,
                           0x8b, 0xe7, 0x68, 0xb1, 0xd2, 0x61, 0x42, 0x2a, 0xd2, 0x6d, 0xfc, 0xef, 0xec, 0x98};
  uint8_t bytesprops8[] = {0xed, 0xab, 0xc3, 0xba, 0xa0, 0x48, 0xdf, 0x83, 0x80, 0x61, 0x3a};
  uint8_t bytesprops9[] = {0x1b, 0xb2, 0xf9, 0x4,  0xc9, 0xe0, 0xea, 0x43, 0x3f, 0x1b,
                           0x8b, 0x93, 0x6b, 0xae, 0x9e, 0x2,  0x1a, 0x36, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 647}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30065}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18202}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {14, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12170}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18145}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29047}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21427}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24626}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 65}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\200Z\225i^_\STX\231\193\STX",
// _pubPktID = 16826, _pubBody = "\206\193\194\217\177\152\142,\163\145\149Q\237?7\131k\n\177[^\153ti\134sYl\140\174",
// _pubProps = [PropMaximumQoS 178,PropAuthenticationMethod "",PropSessionExpiryInterval 27303,PropMessageExpiryInterval
// 30007,PropWillDelayInterval 3447,PropMaximumQoS 79,PropCorrelationData "\228\150"]}
TEST(Publish5QCTest, Encode49) {
  uint8_t pkt[] = {0x3d, 0x48, 0x0,  0xa,  0xc8, 0x5a, 0xe1, 0x69, 0x5e, 0x5f, 0x2,  0xe7, 0xc1, 0x2,  0x41,
                   0xba, 0x1b, 0x24, 0xb2, 0x15, 0x0,  0x0,  0x11, 0x0,  0x0,  0x6a, 0xa7, 0x2,  0x0,  0x0,
                   0x75, 0x37, 0x18, 0x0,  0x0,  0xd,  0x77, 0x24, 0x4f, 0x9,  0x0,  0x2,  0xe4, 0x96, 0xce,
                   0xc1, 0xc2, 0xd9, 0xb1, 0x98, 0x8e, 0x2c, 0xa3, 0x91, 0x95, 0x51, 0xed, 0x3f, 0x37, 0x83,
                   0x6b, 0xa,  0xb1, 0x5b, 0x5e, 0x99, 0x74, 0x69, 0x86, 0x73, 0x59, 0x6c, 0x8c, 0xae};

  uint8_t buf[84] = {0};

  uint8_t topic_bytes[] = {0xc8, 0x5a, 0xe1, 0x69, 0x5e, 0x5f, 0x2, 0xe7, 0xc1, 0x2};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xce, 0xc1, 0xc2, 0xd9, 0xb1, 0x98, 0x8e, 0x2c, 0xa3, 0x91, 0x95, 0x51, 0xed, 0x3f, 0x37,
                         0x83, 0x6b, 0xa,  0xb1, 0x5b, 0x5e, 0x99, 0x74, 0x69, 0x86, 0x73, 0x59, 0x6c, 0x8c, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xe4, 0x96};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27303}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30007}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3447}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16826, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\161\178\167\170\164+\151g\137\n",
// _pubPktID = 11219, _pubBody = "R\146a\229\236\247\197\178\199\136\159_\251", _pubProps = [PropWillDelayInterval
// 18228,PropServerReference "\RS\193\246;\172",PropRequestProblemInformation 24,PropTopicAliasMaximum
// 9254,PropSharedSubscriptionAvailable 218,PropUserProperty
// "r\SYN\215\149,\139\187r\155c\FS\144E\241\201\143\180\DC4J\211v\223L\198\DLE"
// "\244\&3\218\205\193M\209\STX\203\ETX>!e\148\212\165QY'\162)\160\141\178\204\186",PropMaximumQoS
// 37,PropSubscriptionIdentifierAvailable 146,PropSharedSubscriptionAvailable 166,PropSubscriptionIdentifierAvailable
// 56,PropPayloadFormatIndicator 133,PropPayloadFormatIndicator 41,PropMaximumQoS 35,PropSessionExpiryInterval
// 20605,PropAssignedClientIdentifier
// "\206|\235a\173\199\152\211\169\DC3\208(*\164\197\ETX\154s\217\232@PP\247",PropTopicAlias
// 28005,PropRequestProblemInformation 192,PropSubscriptionIdentifierAvailable 108,PropSessionExpiryInterval
// 24769,PropRequestResponseInformation 91,PropSubscriptionIdentifierAvailable 67,PropServerReference
// "\193",PropPayloadFormatIndicator 5,PropWillDelayInterval 20234,PropTopicAliasMaximum
// 21992,PropSubscriptionIdentifier 24,PropContentType "\131#\246#\254]\246\246",PropMessageExpiryInterval 19685]}
TEST(Publish5QCTest, Encode50) {
  uint8_t pkt[] = {0x3b, 0xc7, 0x1,  0x0,  0xa,  0xa1, 0xb2, 0xa7, 0xaa, 0xa4, 0x2b, 0x97, 0x67, 0x89, 0xa,  0x2b, 0xd3,
                   0xaa, 0x1,  0x18, 0x0,  0x0,  0x47, 0x34, 0x1c, 0x0,  0x5,  0x1e, 0xc1, 0xf6, 0x3b, 0xac, 0x17, 0x18,
                   0x22, 0x24, 0x26, 0x2a, 0xda, 0x26, 0x0,  0x19, 0x72, 0x16, 0xd7, 0x95, 0x2c, 0x8b, 0xbb, 0x72, 0x9b,
                   0x63, 0x1c, 0x90, 0x45, 0xf1, 0xc9, 0x8f, 0xb4, 0x14, 0x4a, 0xd3, 0x76, 0xdf, 0x4c, 0xc6, 0x10, 0x0,
                   0x1a, 0xf4, 0x33, 0xda, 0xcd, 0xc1, 0x4d, 0xd1, 0x2,  0xcb, 0x3,  0x3e, 0x21, 0x65, 0x94, 0xd4, 0xa5,
                   0x51, 0x59, 0x27, 0xa2, 0x29, 0xa0, 0x8d, 0xb2, 0xcc, 0xba, 0x24, 0x25, 0x29, 0x92, 0x2a, 0xa6, 0x29,
                   0x38, 0x1,  0x85, 0x1,  0x29, 0x24, 0x23, 0x11, 0x0,  0x0,  0x50, 0x7d, 0x12, 0x0,  0x18, 0xce, 0x7c,
                   0xeb, 0x61, 0xad, 0xc7, 0x98, 0xd3, 0xa9, 0x13, 0xd0, 0x28, 0x2a, 0xa4, 0xc5, 0x3,  0x9a, 0x73, 0xd9,
                   0xe8, 0x40, 0x50, 0x50, 0xf7, 0x23, 0x6d, 0x65, 0x17, 0xc0, 0x29, 0x6c, 0x11, 0x0,  0x0,  0x60, 0xc1,
                   0x19, 0x5b, 0x29, 0x43, 0x1c, 0x0,  0x1,  0xc1, 0x1,  0x5,  0x18, 0x0,  0x0,  0x4f, 0xa,  0x22, 0x55,
                   0xe8, 0xb,  0x18, 0x3,  0x0,  0x8,  0x83, 0x23, 0xf6, 0x23, 0xfe, 0x5d, 0xf6, 0xf6, 0x2,  0x0,  0x0,
                   0x4c, 0xe5, 0x52, 0x92, 0x61, 0xe5, 0xec, 0xf7, 0xc5, 0xb2, 0xc7, 0x88, 0x9f, 0x5f, 0xfb};

  uint8_t buf[212] = {0};

  uint8_t topic_bytes[] = {0xa1, 0xb2, 0xa7, 0xaa, 0xa4, 0x2b, 0x97, 0x67, 0x89, 0xa};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x52, 0x92, 0x61, 0xe5, 0xec, 0xf7, 0xc5, 0xb2, 0xc7, 0x88, 0x9f, 0x5f, 0xfb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x1e, 0xc1, 0xf6, 0x3b, 0xac};
  uint8_t bytesprops2[] = {0xf4, 0x33, 0xda, 0xcd, 0xc1, 0x4d, 0xd1, 0x2,  0xcb, 0x3,  0x3e, 0x21, 0x65,
                           0x94, 0xd4, 0xa5, 0x51, 0x59, 0x27, 0xa2, 0x29, 0xa0, 0x8d, 0xb2, 0xcc, 0xba};
  uint8_t bytesprops1[] = {0x72, 0x16, 0xd7, 0x95, 0x2c, 0x8b, 0xbb, 0x72, 0x9b, 0x63, 0x1c, 0x90, 0x45,
                           0xf1, 0xc9, 0x8f, 0xb4, 0x14, 0x4a, 0xd3, 0x76, 0xdf, 0x4c, 0xc6, 0x10};
  uint8_t bytesprops3[] = {0xce, 0x7c, 0xeb, 0x61, 0xad, 0xc7, 0x98, 0xd3, 0xa9, 0x13, 0xd0, 0x28,
                           0x2a, 0xa4, 0xc5, 0x3,  0x9a, 0x73, 0xd9, 0xe8, 0x40, 0x50, 0x50, 0xf7};
  uint8_t bytesprops4[] = {0xc1};
  uint8_t bytesprops5[] = {0x83, 0x23, 0xf6, 0x23, 0xfe, 0x5d, 0xf6, 0xf6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18228}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9254}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {26, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20605}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28005}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24769}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20234}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21992}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19685}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 11219, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "R\\\164\224\200+\254\\\233t@\GS\144\&5|\243\244@%\240\170\193\150V\252\133q", _pubPktID = 23768, _pubBody =
// "\RS.\158\236\175|6'\152C\151\NUL\138o\230\242\236\184,\ENQ\201^\185\t", _pubProps = [PropSubscriptionIdentifier
// 13,PropUserProperty "\160!\152E\225\161\241#\ETXS\211\SYN\SYN\206\128\130\207$o"
// "Shx\SI\ETBGtG\164\FS\206\175o\231\&1",PropAuthenticationMethod
// "\143\ETB\235^\196\180\226\235\226\246\&3\226D6\bV*1\163P\211\233#53FFZ",PropUserProperty "?|\177\NAK\169{sj"
// "J\224n\163\190uG\169`\f)\228c_b",PropContentType
// "h\176p\SUB\181)\215\192P\239\228\v^ijNZ(rw\GS",PropTopicAliasMaximum 26777,PropResponseInformation
// "\DLEq\200\174\&9z\181X\172\254i\SUBs\207\145\208\217\135\233\SYN]"]}
TEST(Publish5QCTest, Encode51) {
  uint8_t pkt[] = {0x3c, 0xd0, 0x1,  0x0,  0x1b, 0x52, 0x5c, 0xa4, 0xe0, 0xc8, 0x2b, 0xfe, 0x5c, 0xe9, 0x74, 0x40, 0x1d,
                   0x90, 0x35, 0x7c, 0xf3, 0xf4, 0x40, 0x25, 0xf0, 0xaa, 0xc1, 0x96, 0x56, 0xfc, 0x85, 0x71, 0x5c, 0xd8,
                   0x97, 0x1,  0xb,  0xd,  0x26, 0x0,  0x13, 0xa0, 0x21, 0x98, 0x45, 0xe1, 0xa1, 0xf1, 0x23, 0x3,  0x53,
                   0xd3, 0x16, 0x16, 0xce, 0x80, 0x82, 0xcf, 0x24, 0x6f, 0x0,  0xf,  0x53, 0x68, 0x78, 0xf,  0x17, 0x47,
                   0x74, 0x47, 0xa4, 0x1c, 0xce, 0xaf, 0x6f, 0xe7, 0x31, 0x15, 0x0,  0x1c, 0x8f, 0x17, 0xeb, 0x5e, 0xc4,
                   0xb4, 0xe2, 0xeb, 0xe2, 0xf6, 0x33, 0xe2, 0x44, 0x36, 0x8,  0x56, 0x2a, 0x31, 0xa3, 0x50, 0xd3, 0xe9,
                   0x23, 0x35, 0x33, 0x46, 0x46, 0x5a, 0x26, 0x0,  0x8,  0x3f, 0x7c, 0xb1, 0x15, 0xa9, 0x7b, 0x73, 0x6a,
                   0x0,  0xf,  0x4a, 0xe0, 0x6e, 0xa3, 0xbe, 0x75, 0x47, 0xa9, 0x60, 0xc,  0x29, 0xe4, 0x63, 0x5f, 0x62,
                   0x3,  0x0,  0x15, 0x68, 0xb0, 0x70, 0x1a, 0xb5, 0x29, 0xd7, 0xc0, 0x50, 0xef, 0xe4, 0xb,  0x5e, 0x69,
                   0x6a, 0x4e, 0x5a, 0x28, 0x72, 0x77, 0x1d, 0x22, 0x68, 0x99, 0x1a, 0x0,  0x15, 0x10, 0x71, 0xc8, 0xae,
                   0x39, 0x7a, 0xb5, 0x58, 0xac, 0xfe, 0x69, 0x1a, 0x73, 0xcf, 0x91, 0xd0, 0xd9, 0x87, 0xe9, 0x16, 0x5d,
                   0x1e, 0x2e, 0x9e, 0xec, 0xaf, 0x7c, 0x36, 0x27, 0x98, 0x43, 0x97, 0x0,  0x8a, 0x6f, 0xe6, 0xf2, 0xec,
                   0xb8, 0x2c, 0x5,  0xc9, 0x5e, 0xb9, 0x9};

  uint8_t buf[221] = {0};

  uint8_t topic_bytes[] = {0x52, 0x5c, 0xa4, 0xe0, 0xc8, 0x2b, 0xfe, 0x5c, 0xe9, 0x74, 0x40, 0x1d, 0x90, 0x35,
                           0x7c, 0xf3, 0xf4, 0x40, 0x25, 0xf0, 0xaa, 0xc1, 0x96, 0x56, 0xfc, 0x85, 0x71};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1e, 0x2e, 0x9e, 0xec, 0xaf, 0x7c, 0x36, 0x27, 0x98, 0x43, 0x97, 0x0,
                         0x8a, 0x6f, 0xe6, 0xf2, 0xec, 0xb8, 0x2c, 0x5,  0xc9, 0x5e, 0xb9, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops1[] = {0x53, 0x68, 0x78, 0xf, 0x17, 0x47, 0x74, 0x47, 0xa4, 0x1c, 0xce, 0xaf, 0x6f, 0xe7, 0x31};
  uint8_t bytesprops0[] = {0xa0, 0x21, 0x98, 0x45, 0xe1, 0xa1, 0xf1, 0x23, 0x3, 0x53,
                           0xd3, 0x16, 0x16, 0xce, 0x80, 0x82, 0xcf, 0x24, 0x6f};
  uint8_t bytesprops2[] = {0x8f, 0x17, 0xeb, 0x5e, 0xc4, 0xb4, 0xe2, 0xeb, 0xe2, 0xf6, 0x33, 0xe2, 0x44, 0x36,
                           0x8,  0x56, 0x2a, 0x31, 0xa3, 0x50, 0xd3, 0xe9, 0x23, 0x35, 0x33, 0x46, 0x46, 0x5a};
  uint8_t bytesprops4[] = {0x4a, 0xe0, 0x6e, 0xa3, 0xbe, 0x75, 0x47, 0xa9, 0x60, 0xc, 0x29, 0xe4, 0x63, 0x5f, 0x62};
  uint8_t bytesprops3[] = {0x3f, 0x7c, 0xb1, 0x15, 0xa9, 0x7b, 0x73, 0x6a};
  uint8_t bytesprops5[] = {0x68, 0xb0, 0x70, 0x1a, 0xb5, 0x29, 0xd7, 0xc0, 0x50, 0xef, 0xe4,
                           0xb,  0x5e, 0x69, 0x6a, 0x4e, 0x5a, 0x28, 0x72, 0x77, 0x1d};
  uint8_t bytesprops6[] = {0x10, 0x71, 0xc8, 0xae, 0x39, 0x7a, 0xb5, 0x58, 0xac, 0xfe, 0x69,
                           0x1a, 0x73, 0xcf, 0x91, 0xd0, 0xd9, 0x87, 0xe9, 0x16, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops0}, .v = {15, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops3}, .v = {15, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26777}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 23768, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\EOT+\243\179\223\201\tb\221\175W<\221L\a", _pubPktID = 32599, _pubBody =
// "\187\221\219\249%\DC1M\195%\227~\ETBcZ\232\f\141\254\253\223", _pubProps = [PropRequestResponseInformation
// 75,PropRequestResponseInformation 72,PropServerReference
// "W\v\250p^\151{p_\169\224\131\EOT{\219\131%\207$\192+",PropAssignedClientIdentifier
// "L\216\&8\134\146\254\201\DELm\138~YZ\233|\244S\131\213Nt\254Bl\208\149",PropRequestProblemInformation 238]}
TEST(Publish5QCTest, Encode52) {
  uint8_t pkt[] = {0x3b, 0x63, 0x0,  0xf,  0x4,  0x2b, 0xf3, 0xb3, 0xdf, 0xc9, 0x9,  0x62, 0xdd, 0xaf, 0x57, 0x3c, 0xdd,
                   0x4c, 0x7,  0x7f, 0x57, 0x3b, 0x19, 0x4b, 0x19, 0x48, 0x1c, 0x0,  0x15, 0x57, 0xb,  0xfa, 0x70, 0x5e,
                   0x97, 0x7b, 0x70, 0x5f, 0xa9, 0xe0, 0x83, 0x4,  0x7b, 0xdb, 0x83, 0x25, 0xcf, 0x24, 0xc0, 0x2b, 0x12,
                   0x0,  0x1a, 0x4c, 0xd8, 0x38, 0x86, 0x92, 0xfe, 0xc9, 0x7f, 0x6d, 0x8a, 0x7e, 0x59, 0x5a, 0xe9, 0x7c,
                   0xf4, 0x53, 0x83, 0xd5, 0x4e, 0x74, 0xfe, 0x42, 0x6c, 0xd0, 0x95, 0x17, 0xee, 0xbb, 0xdd, 0xdb, 0xf9,
                   0x25, 0x11, 0x4d, 0xc3, 0x25, 0xe3, 0x7e, 0x17, 0x63, 0x5a, 0xe8, 0xc,  0x8d, 0xfe, 0xfd, 0xdf};

  uint8_t buf[111] = {0};

  uint8_t topic_bytes[] = {0x4, 0x2b, 0xf3, 0xb3, 0xdf, 0xc9, 0x9, 0x62, 0xdd, 0xaf, 0x57, 0x3c, 0xdd, 0x4c, 0x7};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xdd, 0xdb, 0xf9, 0x25, 0x11, 0x4d, 0xc3, 0x25, 0xe3,
                         0x7e, 0x17, 0x63, 0x5a, 0xe8, 0xc,  0x8d, 0xfe, 0xfd, 0xdf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x57, 0xb, 0xfa, 0x70, 0x5e, 0x97, 0x7b, 0x70, 0x5f, 0xa9, 0xe0,
                           0x83, 0x4, 0x7b, 0xdb, 0x83, 0x25, 0xcf, 0x24, 0xc0, 0x2b};
  uint8_t bytesprops1[] = {0x4c, 0xd8, 0x38, 0x86, 0x92, 0xfe, 0xc9, 0x7f, 0x6d, 0x8a, 0x7e, 0x59, 0x5a,
                           0xe9, 0x7c, 0xf4, 0x53, 0x83, 0xd5, 0x4e, 0x74, 0xfe, 0x42, 0x6c, 0xd0, 0x95};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 238}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 32599, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "k6\170c0\139\149-", _pubPktID =
// 24880, _pubBody = "q\181r\196\216Eo\234\"\ENQ\138\207\210-\196\182\157\139\DC2\178?b\a4\250\ETB\168\131", _pubProps =
// [PropResponseTopic "\194\253P1\177\165\ETB\236\228\\;",PropResponseInformation
// "\143\DEL\169\206\155\248\193\163\&6\181\NUL\v5\180",PropRetainAvailable 58,PropSubscriptionIdentifier
// 26,PropSubscriptionIdentifierAvailable 200,PropSubscriptionIdentifier 28,PropSubscriptionIdentifier
// 27,PropAuthenticationData "\197\DC2#",PropAuthenticationMethod "H",PropAuthenticationData
// "\204\226Q\174\&9\190\172\174\135\&6\255\130\203\152\216\201|\180?\234\DC1\175\169\181\&7X",PropMaximumQoS
// 208,PropMaximumPacketSize 31599,PropMaximumQoS 143,PropServerKeepAlive 4529]}
TEST(Publish5QCTest, Encode53) {
  uint8_t pkt[] = {0x32, 0x85, 0x1,  0x0,  0x8,  0x6b, 0x36, 0xaa, 0x63, 0x30, 0x8b, 0x95, 0x2d, 0x61, 0x30, 0x5c,
                   0x8,  0x0,  0xb,  0xc2, 0xfd, 0x50, 0x31, 0xb1, 0xa5, 0x17, 0xec, 0xe4, 0x5c, 0x3b, 0x1a, 0x0,
                   0xe,  0x8f, 0x7f, 0xa9, 0xce, 0x9b, 0xf8, 0xc1, 0xa3, 0x36, 0xb5, 0x0,  0xb,  0x35, 0xb4, 0x25,
                   0x3a, 0xb,  0x1a, 0x29, 0xc8, 0xb,  0x1c, 0xb,  0x1b, 0x16, 0x0,  0x3,  0xc5, 0x12, 0x23, 0x15,
                   0x0,  0x1,  0x48, 0x16, 0x0,  0x1a, 0xcc, 0xe2, 0x51, 0xae, 0x39, 0xbe, 0xac, 0xae, 0x87, 0x36,
                   0xff, 0x82, 0xcb, 0x98, 0xd8, 0xc9, 0x7c, 0xb4, 0x3f, 0xea, 0x11, 0xaf, 0xa9, 0xb5, 0x37, 0x58,
                   0x24, 0xd0, 0x27, 0x0,  0x0,  0x7b, 0x6f, 0x24, 0x8f, 0x13, 0x11, 0xb1, 0x71, 0xb5, 0x72, 0xc4,
                   0xd8, 0x45, 0x6f, 0xea, 0x22, 0x5,  0x8a, 0xcf, 0xd2, 0x2d, 0xc4, 0xb6, 0x9d, 0x8b, 0x12, 0xb2,
                   0x3f, 0x62, 0x7,  0x34, 0xfa, 0x17, 0xa8, 0x83};

  uint8_t buf[146] = {0};

  uint8_t topic_bytes[] = {0x6b, 0x36, 0xaa, 0x63, 0x30, 0x8b, 0x95, 0x2d};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x71, 0xb5, 0x72, 0xc4, 0xd8, 0x45, 0x6f, 0xea, 0x22, 0x5,  0x8a, 0xcf, 0xd2, 0x2d,
                         0xc4, 0xb6, 0x9d, 0x8b, 0x12, 0xb2, 0x3f, 0x62, 0x7,  0x34, 0xfa, 0x17, 0xa8, 0x83};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0xc2, 0xfd, 0x50, 0x31, 0xb1, 0xa5, 0x17, 0xec, 0xe4, 0x5c, 0x3b};
  uint8_t bytesprops1[] = {0x8f, 0x7f, 0xa9, 0xce, 0x9b, 0xf8, 0xc1, 0xa3, 0x36, 0xb5, 0x0, 0xb, 0x35, 0xb4};
  uint8_t bytesprops2[] = {0xc5, 0x12, 0x23};
  uint8_t bytesprops3[] = {0x48};
  uint8_t bytesprops4[] = {0xcc, 0xe2, 0x51, 0xae, 0x39, 0xbe, 0xac, 0xae, 0x87, 0x36, 0xff, 0x82, 0xcb,
                           0x98, 0xd8, 0xc9, 0x7c, 0xb4, 0x3f, 0xea, 0x11, 0xaf, 0xa9, 0xb5, 0x37, 0x58};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31599}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4529}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24880, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\164]\137\161\184\189\ETB_L\r+\255\233u\227\NAK\SI\199\CANG\211_\141", _pubPktID = 0, _pubBody =
// "n\169\136j,\137\228\208\162\164aL\186\EOT\241\GS\230d\142\177N\138P", _pubProps = [PropAuthenticationMethod
// "\150\NULS\SUB\129",PropSubscriptionIdentifierAvailable 115,PropMessageExpiryInterval
// 16352,PropRequestProblemInformation 184,PropAssignedClientIdentifier "\t",PropAuthenticationMethod
// "\152\247\214J\179\245\255\166\STX\252\255\130\243\141L`",PropTopicAliasMaximum 17674]}
TEST(Publish5QCTest, Encode54) {
  uint8_t pkt[] = {0x38, 0x5c, 0x0,  0x17, 0xa4, 0x5d, 0x89, 0xa1, 0xb8, 0xbd, 0x17, 0x5f, 0x4c, 0xd,  0x2b, 0xff,
                   0xe9, 0x75, 0xe3, 0x15, 0xf,  0xc7, 0x18, 0x47, 0xd3, 0x5f, 0x8d, 0x2b, 0x15, 0x0,  0x5,  0x96,
                   0x0,  0x53, 0x1a, 0x81, 0x29, 0x73, 0x2,  0x0,  0x0,  0x3f, 0xe0, 0x17, 0xb8, 0x12, 0x0,  0x1,
                   0x9,  0x15, 0x0,  0x10, 0x98, 0xf7, 0xd6, 0x4a, 0xb3, 0xf5, 0xff, 0xa6, 0x2,  0xfc, 0xff, 0x82,
                   0xf3, 0x8d, 0x4c, 0x60, 0x22, 0x45, 0xa,  0x6e, 0xa9, 0x88, 0x6a, 0x2c, 0x89, 0xe4, 0xd0, 0xa2,
                   0xa4, 0x61, 0x4c, 0xba, 0x4,  0xf1, 0x1d, 0xe6, 0x64, 0x8e, 0xb1, 0x4e, 0x8a, 0x50};

  uint8_t buf[104] = {0};

  uint8_t topic_bytes[] = {0xa4, 0x5d, 0x89, 0xa1, 0xb8, 0xbd, 0x17, 0x5f, 0x4c, 0xd,  0x2b, 0xff,
                           0xe9, 0x75, 0xe3, 0x15, 0xf,  0xc7, 0x18, 0x47, 0xd3, 0x5f, 0x8d};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6e, 0xa9, 0x88, 0x6a, 0x2c, 0x89, 0xe4, 0xd0, 0xa2, 0xa4, 0x61, 0x4c,
                         0xba, 0x4,  0xf1, 0x1d, 0xe6, 0x64, 0x8e, 0xb1, 0x4e, 0x8a, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x96, 0x0, 0x53, 0x1a, 0x81};
  uint8_t bytesprops1[] = {0x9};
  uint8_t bytesprops2[] = {0x98, 0xf7, 0xd6, 0x4a, 0xb3, 0xf5, 0xff, 0xa6,
                           0x2,  0xfc, 0xff, 0x82, 0xf3, 0x8d, 0x4c, 0x60};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16352}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17674}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "_\225\NAK\164\f\128V", _pubPktID =
// 0, _pubBody = "\146\161JU\174P\208og\201\149\132e\190\182\\!e\203q\201\194\SYN\147O\178\173{\DC2F", _pubProps =
// [PropTopicAliasMaximum 23589,PropSubscriptionIdentifier 23,PropResponseTopic
// "\251\131\ESC\ESC\140\241u\a\144\132r\t\144",PropSubscriptionIdentifier 7,PropAuthenticationData
// "\250\GS\208\170\DC1\r\163\251\DC1\230\240\212uC"]}
TEST(Publish5QCTest, Encode55) {
  uint8_t pkt[] = {0x30, 0x50, 0x0,  0x7,  0x5f, 0xe1, 0x15, 0xa4, 0xc,  0x80, 0x56, 0x28, 0x22, 0x5c, 0x25, 0xb,  0x17,
                   0x8,  0x0,  0xd,  0xfb, 0x83, 0x1b, 0x1b, 0x8c, 0xf1, 0x75, 0x7,  0x90, 0x84, 0x72, 0x9,  0x90, 0xb,
                   0x7,  0x16, 0x0,  0xe,  0xfa, 0x1d, 0xd0, 0xaa, 0x11, 0xd,  0xa3, 0xfb, 0x11, 0xe6, 0xf0, 0xd4, 0x75,
                   0x43, 0x92, 0xa1, 0x4a, 0x55, 0xae, 0x50, 0xd0, 0x6f, 0x67, 0xc9, 0x95, 0x84, 0x65, 0xbe, 0xb6, 0x5c,
                   0x21, 0x65, 0xcb, 0x71, 0xc9, 0xc2, 0x16, 0x93, 0x4f, 0xb2, 0xad, 0x7b, 0x12, 0x46};

  uint8_t buf[92] = {0};

  uint8_t topic_bytes[] = {0x5f, 0xe1, 0x15, 0xa4, 0xc, 0x80, 0x56};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0xa1, 0x4a, 0x55, 0xae, 0x50, 0xd0, 0x6f, 0x67, 0xc9, 0x95, 0x84, 0x65, 0xbe, 0xb6,
                         0x5c, 0x21, 0x65, 0xcb, 0x71, 0xc9, 0xc2, 0x16, 0x93, 0x4f, 0xb2, 0xad, 0x7b, 0x12, 0x46};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xfb, 0x83, 0x1b, 0x1b, 0x8c, 0xf1, 0x75, 0x7, 0x90, 0x84, 0x72, 0x9, 0x90};
  uint8_t bytesprops1[] = {0xfa, 0x1d, 0xd0, 0xaa, 0x11, 0xd, 0xa3, 0xfb, 0x11, 0xe6, 0xf0, 0xd4, 0x75, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23589}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\b\240\fA@\206\204-;
// R\nS$\n\194\ESCh\DC1P2\229\135$", _pubPktID = 32117, _pubBody = "[\a", _pubProps = [PropAuthenticationMethod
// "\245\213H\ACK\ETB\r(\216&\154",PropAuthenticationMethod "\EOT\250\167n;@\194V\250",PropRequestResponseInformation
// 56,PropResponseInformation "",PropMaximumQoS 212,PropAuthenticationMethod
// "\ETB\213\236\r/\SI\147\243\249i\147\246+@\137\157\139\211",PropSessionExpiryInterval 120,PropReceiveMaximum
// 5986,PropRequestProblemInformation 16,PropMessageExpiryInterval 30265,PropResponseInformation
// "\USA\218\200\232\ETB\ETB\142\184^`\253\227\247\243\143b\255\149\167\183\&15$[\211\228Q\200",PropCorrelationData
// "\144\236\151",PropSubscriptionIdentifier 22,PropResponseTopic "",PropSubscriptionIdentifier 23,PropWillDelayInterval
// 3333,PropMessageExpiryInterval 11209,PropMessageExpiryInterval 5188,PropTopicAliasMaximum 1410,PropReasonString
// "",PropResponseInformation "\129y\251\136",PropWillDelayInterval 13435,PropMaximumPacketSize 30116,PropReceiveMaximum
// 22947,PropSharedSubscriptionAvailable 223]}
TEST(Publish5QCTest, Encode56) {
  uint8_t pkt[] = {0x35, 0xbc, 0x1,  0x0,  0x18, 0x8,  0xf0, 0xc,  0x41, 0x40, 0xce, 0xcc, 0x2d, 0x3b, 0x20, 0x52,
                   0xa,  0x53, 0x24, 0xa,  0xc2, 0x1b, 0x68, 0x11, 0x50, 0x32, 0xe5, 0x87, 0x24, 0x7d, 0x75, 0x9c,
                   0x1,  0x15, 0x0,  0xa,  0xf5, 0xd5, 0x48, 0x6,  0x17, 0xd,  0x28, 0xd8, 0x26, 0x9a, 0x15, 0x0,
                   0x9,  0x4,  0xfa, 0xa7, 0x6e, 0x3b, 0x40, 0xc2, 0x56, 0xfa, 0x19, 0x38, 0x1a, 0x0,  0x0,  0x24,
                   0xd4, 0x15, 0x0,  0x12, 0x17, 0xd5, 0xec, 0xd,  0x2f, 0xf,  0x93, 0xf3, 0xf9, 0x69, 0x93, 0xf6,
                   0x2b, 0x40, 0x89, 0x9d, 0x8b, 0xd3, 0x11, 0x0,  0x0,  0x0,  0x78, 0x21, 0x17, 0x62, 0x17, 0x10,
                   0x2,  0x0,  0x0,  0x76, 0x39, 0x1a, 0x0,  0x1d, 0x1f, 0x41, 0xda, 0xc8, 0xe8, 0x17, 0x17, 0x8e,
                   0xb8, 0x5e, 0x60, 0xfd, 0xe3, 0xf7, 0xf3, 0x8f, 0x62, 0xff, 0x95, 0xa7, 0xb7, 0x31, 0x35, 0x24,
                   0x5b, 0xd3, 0xe4, 0x51, 0xc8, 0x9,  0x0,  0x3,  0x90, 0xec, 0x97, 0xb,  0x16, 0x8,  0x0,  0x0,
                   0xb,  0x17, 0x18, 0x0,  0x0,  0xd,  0x5,  0x2,  0x0,  0x0,  0x2b, 0xc9, 0x2,  0x0,  0x0,  0x14,
                   0x44, 0x22, 0x5,  0x82, 0x1f, 0x0,  0x0,  0x1a, 0x0,  0x4,  0x81, 0x79, 0xfb, 0x88, 0x18, 0x0,
                   0x0,  0x34, 0x7b, 0x27, 0x0,  0x0,  0x75, 0xa4, 0x21, 0x59, 0xa3, 0x2a, 0xdf, 0x5b, 0x7};

  uint8_t buf[201] = {0};

  uint8_t topic_bytes[] = {0x8,  0xf0, 0xc, 0x41, 0x40, 0xce, 0xcc, 0x2d, 0x3b, 0x20, 0x52, 0xa,
                           0x53, 0x24, 0xa, 0xc2, 0x1b, 0x68, 0x11, 0x50, 0x32, 0xe5, 0x87, 0x24};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0xf5, 0xd5, 0x48, 0x6, 0x17, 0xd, 0x28, 0xd8, 0x26, 0x9a};
  uint8_t bytesprops1[] = {0x4, 0xfa, 0xa7, 0x6e, 0x3b, 0x40, 0xc2, 0x56, 0xfa};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x17, 0xd5, 0xec, 0xd,  0x2f, 0xf,  0x93, 0xf3, 0xf9,
                           0x69, 0x93, 0xf6, 0x2b, 0x40, 0x89, 0x9d, 0x8b, 0xd3};
  uint8_t bytesprops4[] = {0x1f, 0x41, 0xda, 0xc8, 0xe8, 0x17, 0x17, 0x8e, 0xb8, 0x5e, 0x60, 0xfd, 0xe3, 0xf7, 0xf3,
                           0x8f, 0x62, 0xff, 0x95, 0xa7, 0xb7, 0x31, 0x35, 0x24, 0x5b, 0xd3, 0xe4, 0x51, 0xc8};
  uint8_t bytesprops5[] = {0x90, 0xec, 0x97};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x81, 0x79, 0xfb, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 120}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5986}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30265}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3333}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11209}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5188}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1410}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13435}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30116}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22947}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 223}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 32117, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\169\247+\235\ACK\192\145",
// _pubPktID = 0, _pubBody = "\a\197\204\DEL\222\198\153\205\174\176a\153\233u\246\203~z\166\212\229\207sp\US`\225",
// _pubProps = [PropReasonString "",PropAuthenticationMethod "\SIo{\154@\229\196\DEL\129EZ\159C",PropResponseInformation
// "\238\&9",PropTopicAliasMaximum 31169,PropResponseTopic
// "\131Xsu\250\206l\231\160WT\167\135\151\231\128\248\148\GS8p\189",PropRetainAvailable 70,PropResponseTopic
// "\238X\170{zo\223\233e\239\216y,\212\bt[\255\226\&3w\242",PropUserProperty "\162\ACKX"
// "\220\STX\197\249w\RS\160\244I&+\153\214\216\240fG\222\228\132",PropRequestResponseInformation 69,PropRetainAvailable
// 52,PropMaximumQoS 226,PropContentType "e\186\147\165\221\149\235`\244J\DC1\129\246",PropTopicAlias
// 28871,PropReceiveMaximum 22463]}
TEST(Publish5QCTest, Encode57) {
  uint8_t pkt[] = {0x31, 0xad, 0x1,  0x0,  0x7,  0xa9, 0xf7, 0x2b, 0xeb, 0x6,  0xc0, 0x91, 0x87, 0x1,  0x1f, 0x0,
                   0x0,  0x15, 0x0,  0xd,  0xf,  0x6f, 0x7b, 0x9a, 0x40, 0xe5, 0xc4, 0x7f, 0x81, 0x45, 0x5a, 0x9f,
                   0x43, 0x1a, 0x0,  0x2,  0xee, 0x39, 0x22, 0x79, 0xc1, 0x8,  0x0,  0x16, 0x83, 0x58, 0x73, 0x75,
                   0xfa, 0xce, 0x6c, 0xe7, 0xa0, 0x57, 0x54, 0xa7, 0x87, 0x97, 0xe7, 0x80, 0xf8, 0x94, 0x1d, 0x38,
                   0x70, 0xbd, 0x25, 0x46, 0x8,  0x0,  0x16, 0xee, 0x58, 0xaa, 0x7b, 0x7a, 0x6f, 0xdf, 0xe9, 0x65,
                   0xef, 0xd8, 0x79, 0x2c, 0xd4, 0x8,  0x74, 0x5b, 0xff, 0xe2, 0x33, 0x77, 0xf2, 0x26, 0x0,  0x3,
                   0xa2, 0x6,  0x58, 0x0,  0x14, 0xdc, 0x2,  0xc5, 0xf9, 0x77, 0x1e, 0xa0, 0xf4, 0x49, 0x26, 0x2b,
                   0x99, 0xd6, 0xd8, 0xf0, 0x66, 0x47, 0xde, 0xe4, 0x84, 0x19, 0x45, 0x25, 0x34, 0x24, 0xe2, 0x3,
                   0x0,  0xd,  0x65, 0xba, 0x93, 0xa5, 0xdd, 0x95, 0xeb, 0x60, 0xf4, 0x4a, 0x11, 0x81, 0xf6, 0x23,
                   0x70, 0xc7, 0x21, 0x57, 0xbf, 0x7,  0xc5, 0xcc, 0x7f, 0xde, 0xc6, 0x99, 0xcd, 0xae, 0xb0, 0x61,
                   0x99, 0xe9, 0x75, 0xf6, 0xcb, 0x7e, 0x7a, 0xa6, 0xd4, 0xe5, 0xcf, 0x73, 0x70, 0x1f, 0x60, 0xe1};

  uint8_t buf[186] = {0};

  uint8_t topic_bytes[] = {0xa9, 0xf7, 0x2b, 0xeb, 0x6, 0xc0, 0x91};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7,  0xc5, 0xcc, 0x7f, 0xde, 0xc6, 0x99, 0xcd, 0xae, 0xb0, 0x61, 0x99, 0xe9, 0x75,
                         0xf6, 0xcb, 0x7e, 0x7a, 0xa6, 0xd4, 0xe5, 0xcf, 0x73, 0x70, 0x1f, 0x60, 0xe1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xf, 0x6f, 0x7b, 0x9a, 0x40, 0xe5, 0xc4, 0x7f, 0x81, 0x45, 0x5a, 0x9f, 0x43};
  uint8_t bytesprops2[] = {0xee, 0x39};
  uint8_t bytesprops3[] = {0x83, 0x58, 0x73, 0x75, 0xfa, 0xce, 0x6c, 0xe7, 0xa0, 0x57, 0x54,
                           0xa7, 0x87, 0x97, 0xe7, 0x80, 0xf8, 0x94, 0x1d, 0x38, 0x70, 0xbd};
  uint8_t bytesprops4[] = {0xee, 0x58, 0xaa, 0x7b, 0x7a, 0x6f, 0xdf, 0xe9, 0x65, 0xef, 0xd8,
                           0x79, 0x2c, 0xd4, 0x8,  0x74, 0x5b, 0xff, 0xe2, 0x33, 0x77, 0xf2};
  uint8_t bytesprops6[] = {0xdc, 0x2,  0xc5, 0xf9, 0x77, 0x1e, 0xa0, 0xf4, 0x49, 0x26,
                           0x2b, 0x99, 0xd6, 0xd8, 0xf0, 0x66, 0x47, 0xde, 0xe4, 0x84};
  uint8_t bytesprops5[] = {0xa2, 0x6, 0x58};
  uint8_t bytesprops7[] = {0x65, 0xba, 0x93, 0xa5, 0xdd, 0x95, 0xeb, 0x60, 0xf4, 0x4a, 0x11, 0x81, 0xf6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31169}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops5}, .v = {20, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28871}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22463}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\150\251\130\251\166R)\184\\I^\183\212@\189\150\222", _pubPktID = 0, _pubBody = "\139}\228\225\&9", _pubProps =
// [PropCorrelationData "\170\SUB",PropWildcardSubscriptionAvailable 102,PropSharedSubscriptionAvailable
// 236,PropSubscriptionIdentifierAvailable 89,PropServerReference
// "n\142\NAK\184TnXQ!f~Y\SO\b\CAN\ESC\138\178\197\243\SOHg\ACK\178eH<",PropReceiveMaximum
// 22935,PropSubscriptionIdentifierAvailable 136,PropServerKeepAlive 3204]}
TEST(Publish5QCTest, Encode58) {
  uint8_t pkt[] = {0x30, 0x4a, 0x0,  0x11, 0x96, 0xfb, 0x82, 0xfb, 0xa6, 0x52, 0x29, 0xb8, 0x5c, 0x49, 0x5e, 0xb7,
                   0xd4, 0x40, 0xbd, 0x96, 0xde, 0x31, 0x9,  0x0,  0x2,  0xaa, 0x1a, 0x28, 0x66, 0x2a, 0xec, 0x29,
                   0x59, 0x1c, 0x0,  0x1b, 0x6e, 0x8e, 0x15, 0xb8, 0x54, 0x6e, 0x58, 0x51, 0x21, 0x66, 0x7e, 0x59,
                   0xe,  0x8,  0x18, 0x1b, 0x8a, 0xb2, 0xc5, 0xf3, 0x1,  0x67, 0x6,  0xb2, 0x65, 0x48, 0x3c, 0x21,
                   0x59, 0x97, 0x29, 0x88, 0x13, 0xc,  0x84, 0x8b, 0x7d, 0xe4, 0xe1, 0x39};

  uint8_t buf[86] = {0};

  uint8_t topic_bytes[] = {0x96, 0xfb, 0x82, 0xfb, 0xa6, 0x52, 0x29, 0xb8, 0x5c,
                           0x49, 0x5e, 0xb7, 0xd4, 0x40, 0xbd, 0x96, 0xde};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0x7d, 0xe4, 0xe1, 0x39};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0xaa, 0x1a};
  uint8_t bytesprops1[] = {0x6e, 0x8e, 0x15, 0xb8, 0x54, 0x6e, 0x58, 0x51, 0x21, 0x66, 0x7e, 0x59, 0xe, 0x8,
                           0x18, 0x1b, 0x8a, 0xb2, 0xc5, 0xf3, 0x1,  0x67, 0x6,  0xb2, 0x65, 0x48, 0x3c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22935}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3204}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\161n\174\237\249", _pubPktID = 0,
// _pubBody = "YFq\199\251\158-\155S\194}\250\NULjMrM\ESC/6f\DC3\140", _pubProps = [PropMaximumQoS
// 255,PropAuthenticationData
// "!\241\DC4%K\DC1\226\&2\DLE\162\189\&7\190x\249\140\196\218$kI\167P\207\155\166x\132x\201",PropSubscriptionIdentifier
// 7,PropAuthenticationMethod
// "\"j_\212zR\159\CAN\207\248\207+b\159\DEL\EOT\163\225\203\192\NAK\129\240#\215\ACK'\185\155",PropServerReference
// "\SYNa{q&\206\\\245\177\195Mk",PropTopicAlias 14546,PropUserProperty
// "\237\STX\247\154?l\fK\189\242\234B\224\f\DC3\233\212\158\219\183\157\163\200\202\EOT"
// "\ACK\174",PropMessageExpiryInterval 18572,PropResponseInformation
// "\160\ACK\142\179\155\168\252(\235\128n2\249t\\=EiQ\202\SOH\ACK.\135\131\194",PropRequestProblemInformation
// 27,PropReceiveMaximum 31642,PropCorrelationData "~\143Y\242\NAK\FS\202\180\SO\137+\226\GS\205|\229",PropTopicAlias
// 1761,PropTopicAlias 14795,PropMessageExpiryInterval 9727]}
TEST(Publish5QCTest, Encode59) {
  uint8_t pkt[] = {
      0x38, 0xdc, 0x1,  0x0,  0x5,  0xa1, 0x6e, 0xae, 0xed, 0xf9, 0xbc, 0x1,  0x24, 0xff, 0x16, 0x0,  0x1e, 0x21, 0xf1,
      0x14, 0x25, 0x4b, 0x11, 0xe2, 0x32, 0x10, 0xa2, 0xbd, 0x37, 0xbe, 0x78, 0xf9, 0x8c, 0xc4, 0xda, 0x24, 0x6b, 0x49,
      0xa7, 0x50, 0xcf, 0x9b, 0xa6, 0x78, 0x84, 0x78, 0xc9, 0xb,  0x7,  0x15, 0x0,  0x1d, 0x22, 0x6a, 0x5f, 0xd4, 0x7a,
      0x52, 0x9f, 0x18, 0xcf, 0xf8, 0xcf, 0x2b, 0x62, 0x9f, 0x7f, 0x4,  0xa3, 0xe1, 0xcb, 0xc0, 0x15, 0x81, 0xf0, 0x23,
      0xd7, 0x6,  0x27, 0xb9, 0x9b, 0x1c, 0x0,  0xc,  0x16, 0x61, 0x7b, 0x71, 0x26, 0xce, 0x5c, 0xf5, 0xb1, 0xc3, 0x4d,
      0x6b, 0x23, 0x38, 0xd2, 0x26, 0x0,  0x19, 0xed, 0x2,  0xf7, 0x9a, 0x3f, 0x6c, 0xc,  0x4b, 0xbd, 0xf2, 0xea, 0x42,
      0xe0, 0xc,  0x13, 0xe9, 0xd4, 0x9e, 0xdb, 0xb7, 0x9d, 0xa3, 0xc8, 0xca, 0x4,  0x0,  0x2,  0x6,  0xae, 0x2,  0x0,
      0x0,  0x48, 0x8c, 0x1a, 0x0,  0x1a, 0xa0, 0x6,  0x8e, 0xb3, 0x9b, 0xa8, 0xfc, 0x28, 0xeb, 0x80, 0x6e, 0x32, 0xf9,
      0x74, 0x5c, 0x3d, 0x45, 0x69, 0x51, 0xca, 0x1,  0x6,  0x2e, 0x87, 0x83, 0xc2, 0x17, 0x1b, 0x21, 0x7b, 0x9a, 0x9,
      0x0,  0x10, 0x7e, 0x8f, 0x59, 0xf2, 0x15, 0x1c, 0xca, 0xb4, 0xe,  0x89, 0x2b, 0xe2, 0x1d, 0xcd, 0x7c, 0xe5, 0x23,
      0x6,  0xe1, 0x23, 0x39, 0xcb, 0x2,  0x0,  0x0,  0x25, 0xff, 0x59, 0x46, 0x71, 0xc7, 0xfb, 0x9e, 0x2d, 0x9b, 0x53,
      0xc2, 0x7d, 0xfa, 0x0,  0x6a, 0x4d, 0x72, 0x4d, 0x1b, 0x2f, 0x36, 0x66, 0x13, 0x8c};

  uint8_t buf[233] = {0};

  uint8_t topic_bytes[] = {0xa1, 0x6e, 0xae, 0xed, 0xf9};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x59, 0x46, 0x71, 0xc7, 0xfb, 0x9e, 0x2d, 0x9b, 0x53, 0xc2, 0x7d, 0xfa,
                         0x0,  0x6a, 0x4d, 0x72, 0x4d, 0x1b, 0x2f, 0x36, 0x66, 0x13, 0x8c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x21, 0xf1, 0x14, 0x25, 0x4b, 0x11, 0xe2, 0x32, 0x10, 0xa2, 0xbd, 0x37, 0xbe, 0x78, 0xf9,
                           0x8c, 0xc4, 0xda, 0x24, 0x6b, 0x49, 0xa7, 0x50, 0xcf, 0x9b, 0xa6, 0x78, 0x84, 0x78, 0xc9};
  uint8_t bytesprops1[] = {0x22, 0x6a, 0x5f, 0xd4, 0x7a, 0x52, 0x9f, 0x18, 0xcf, 0xf8, 0xcf, 0x2b, 0x62, 0x9f, 0x7f,
                           0x4,  0xa3, 0xe1, 0xcb, 0xc0, 0x15, 0x81, 0xf0, 0x23, 0xd7, 0x6,  0x27, 0xb9, 0x9b};
  uint8_t bytesprops2[] = {0x16, 0x61, 0x7b, 0x71, 0x26, 0xce, 0x5c, 0xf5, 0xb1, 0xc3, 0x4d, 0x6b};
  uint8_t bytesprops4[] = {0x6, 0xae};
  uint8_t bytesprops3[] = {0xed, 0x2,  0xf7, 0x9a, 0x3f, 0x6c, 0xc,  0x4b, 0xbd, 0xf2, 0xea, 0x42, 0xe0,
                           0xc,  0x13, 0xe9, 0xd4, 0x9e, 0xdb, 0xb7, 0x9d, 0xa3, 0xc8, 0xca, 0x4};
  uint8_t bytesprops5[] = {0xa0, 0x6,  0x8e, 0xb3, 0x9b, 0xa8, 0xfc, 0x28, 0xeb, 0x80, 0x6e, 0x32, 0xf9,
                           0x74, 0x5c, 0x3d, 0x45, 0x69, 0x51, 0xca, 0x1,  0x6,  0x2e, 0x87, 0x83, 0xc2};
  uint8_t bytesprops6[] = {0x7e, 0x8f, 0x59, 0xf2, 0x15, 0x1c, 0xca, 0xb4,
                           0xe,  0x89, 0x2b, 0xe2, 0x1d, 0xcd, 0x7c, 0xe5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14546}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops3}, .v = {2, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18572}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31642}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1761}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14795}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9727}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 4694, _pubBody =
// "\137\179ML\236", _pubProps = [PropAssignedClientIdentifier "\206\DC4\RS\153\211c,\210UO\209R{o@{\184\147\195\183
// \197(\129\129\232<k",PropResponseInformation "\220\tm0\190\\\RS\ENQ\145\250\&8\224",PropAuthenticationMethod
// "h\212\EOT",PropSessionExpiryInterval 14480,PropReceiveMaximum 26531,PropMaximumPacketSize 23124,PropUserProperty
// "\185\134\242\v\NAK\231@-IG"
// "\223\238\177\206\163\213[\203&\a\240\DC3ogHp\ENQ\169\151P\143\&1\201\192\187",PropMessageExpiryInterval
// 115,PropServerKeepAlive 26127,PropSubscriptionIdentifierAvailable 214,PropAssignedClientIdentifier
// "\161;\NAK\169",PropResponseInformation "\EM\159\216G\US\247",PropSharedSubscriptionAvailable
// 47,PropAuthenticationMethod "",PropRequestResponseInformation 214,PropResponseInformation
// "\a\166u\217\&9\239m\249NQ%\146\252\188yJW\EOT\206#\186\EOT\157y\164"]}
TEST(Publish5QCTest, Encode60) {
  uint8_t pkt[] = {0x3c, 0xb1, 0x1,  0x0,  0x0,  0x12, 0x56, 0xa6, 0x1,  0x12, 0x0,  0x1c, 0xce, 0x14, 0x1e, 0x99, 0xd3,
                   0x63, 0x2c, 0xd2, 0x55, 0x4f, 0xd1, 0x52, 0x7b, 0x6f, 0x40, 0x7b, 0xb8, 0x93, 0xc3, 0xb7, 0x20, 0xc5,
                   0x28, 0x81, 0x81, 0xe8, 0x3c, 0x6b, 0x1a, 0x0,  0xc,  0xdc, 0x9,  0x6d, 0x30, 0xbe, 0x5c, 0x1e, 0x5,
                   0x91, 0xfa, 0x38, 0xe0, 0x15, 0x0,  0x3,  0x68, 0xd4, 0x4,  0x11, 0x0,  0x0,  0x38, 0x90, 0x21, 0x67,
                   0xa3, 0x27, 0x0,  0x0,  0x5a, 0x54, 0x26, 0x0,  0xa,  0xb9, 0x86, 0xf2, 0xb,  0x15, 0xe7, 0x40, 0x2d,
                   0x49, 0x47, 0x0,  0x19, 0xdf, 0xee, 0xb1, 0xce, 0xa3, 0xd5, 0x5b, 0xcb, 0x26, 0x7,  0xf0, 0x13, 0x6f,
                   0x67, 0x48, 0x70, 0x5,  0xa9, 0x97, 0x50, 0x8f, 0x31, 0xc9, 0xc0, 0xbb, 0x2,  0x0,  0x0,  0x0,  0x73,
                   0x13, 0x66, 0xf,  0x29, 0xd6, 0x12, 0x0,  0x4,  0xa1, 0x3b, 0x15, 0xa9, 0x1a, 0x0,  0x6,  0x19, 0x9f,
                   0xd8, 0x47, 0x1f, 0xf7, 0x2a, 0x2f, 0x15, 0x0,  0x0,  0x19, 0xd6, 0x1a, 0x0,  0x19, 0x7,  0xa6, 0x75,
                   0xd9, 0x39, 0xef, 0x6d, 0xf9, 0x4e, 0x51, 0x25, 0x92, 0xfc, 0xbc, 0x79, 0x4a, 0x57, 0x4,  0xce, 0x23,
                   0xba, 0x4,  0x9d, 0x79, 0xa4, 0x89, 0xb3, 0x4d, 0x4c, 0xec};

  uint8_t buf[190] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x89, 0xb3, 0x4d, 0x4c, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0xce, 0x14, 0x1e, 0x99, 0xd3, 0x63, 0x2c, 0xd2, 0x55, 0x4f, 0xd1, 0x52, 0x7b, 0x6f,
                           0x40, 0x7b, 0xb8, 0x93, 0xc3, 0xb7, 0x20, 0xc5, 0x28, 0x81, 0x81, 0xe8, 0x3c, 0x6b};
  uint8_t bytesprops1[] = {0xdc, 0x9, 0x6d, 0x30, 0xbe, 0x5c, 0x1e, 0x5, 0x91, 0xfa, 0x38, 0xe0};
  uint8_t bytesprops2[] = {0x68, 0xd4, 0x4};
  uint8_t bytesprops4[] = {0xdf, 0xee, 0xb1, 0xce, 0xa3, 0xd5, 0x5b, 0xcb, 0x26, 0x7,  0xf0, 0x13, 0x6f,
                           0x67, 0x48, 0x70, 0x5,  0xa9, 0x97, 0x50, 0x8f, 0x31, 0xc9, 0xc0, 0xbb};
  uint8_t bytesprops3[] = {0xb9, 0x86, 0xf2, 0xb, 0x15, 0xe7, 0x40, 0x2d, 0x49, 0x47};
  uint8_t bytesprops5[] = {0xa1, 0x3b, 0x15, 0xa9};
  uint8_t bytesprops6[] = {0x19, 0x9f, 0xd8, 0x47, 0x1f, 0xf7};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x7,  0xa6, 0x75, 0xd9, 0x39, 0xef, 0x6d, 0xf9, 0x4e, 0x51, 0x25, 0x92, 0xfc,
                           0xbc, 0x79, 0x4a, 0x57, 0x4,  0xce, 0x23, 0xba, 0x4,  0x9d, 0x79, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14480}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26531}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23124}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops3}, .v = {25, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 115}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26127}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 4694, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\ETB2\218\142q%", _pubPktID = 16088,
// _pubBody = "\251hR\153\SI\f\226", _pubProps = [PropAuthenticationData
// "oo\241\145\181\245\143-\161x6\246.L\172\172\US&\140Ab\222^\222K\SO\136",PropContentType
// "\172\190\FSD_\DLEP\f\140M\133\213\212Y\145U#\247\170",PropContentType "\CAN
// ES:\196\200\173\155\187Ro",PropUserProperty "0" "\233\248\DC4\211\167\211\&5\230\177\v\143",PropMaximumQoS
// 229,PropWildcardSubscriptionAvailable 16,PropRequestProblemInformation 71,PropMessageExpiryInterval
// 20628,PropUserProperty "eyX!+\220o" "\"\167\173\154ue\STXA",PropAssignedClientIdentifier
// ":\167\208R\vsQ^\EOTa:?\231&z",PropAssignedClientIdentifier "\201\243i\243\137\ENQ\ENQ\165\181",PropContentType
// "\149",PropResponseInformation "\246\ESC~,\238\215\&8$",PropMaximumQoS 172,PropMessageExpiryInterval
// 26351,PropRequestResponseInformation 138,PropRequestProblemInformation 224,PropContentType
// "\225\160'7j\US\228\ETB\163\204\198#\227\RS\DLE\179\141\SI\166",PropUserProperty
// "\255\215\b\189E\128@\RS\169\138\132\232\DC2Vot\165\174\209\177\237\ETX\179\205iI-\251s\210"
// "\195/\184\193\DC4\142\216",PropPayloadFormatIndicator 253,PropSubscriptionIdentifier 24,PropWillDelayInterval
// 23656,PropServerKeepAlive 11331,PropSubscriptionIdentifierAvailable 5,PropTopicAlias 16169,PropMaximumQoS 126]}
TEST(Publish5QCTest, Encode61) {
  uint8_t pkt[] = {
      0x33, 0x91, 0x2,  0x0,  0x6,  0x17, 0x32, 0xda, 0x8e, 0x71, 0x25, 0x3e, 0xd8, 0xfe, 0x1,  0x16, 0x0,  0x1b, 0x6f,
      0x6f, 0xf1, 0x91, 0xb5, 0xf5, 0x8f, 0x2d, 0xa1, 0x78, 0x36, 0xf6, 0x2e, 0x4c, 0xac, 0xac, 0x1f, 0x26, 0x8c, 0x41,
      0x62, 0xde, 0x5e, 0xde, 0x4b, 0xe,  0x88, 0x3,  0x0,  0x13, 0xac, 0xbe, 0x1c, 0x44, 0x5f, 0x10, 0x50, 0xc,  0x8c,
      0x4d, 0x85, 0xd5, 0xd4, 0x59, 0x91, 0x55, 0x23, 0xf7, 0xaa, 0x3,  0x0,  0xc,  0x18, 0x20, 0x45, 0x53, 0x3a, 0xc4,
      0xc8, 0xad, 0x9b, 0xbb, 0x52, 0x6f, 0x26, 0x0,  0x1,  0x30, 0x0,  0xb,  0xe9, 0xf8, 0x14, 0xd3, 0xa7, 0xd3, 0x35,
      0xe6, 0xb1, 0xb,  0x8f, 0x24, 0xe5, 0x28, 0x10, 0x17, 0x47, 0x2,  0x0,  0x0,  0x50, 0x94, 0x26, 0x0,  0x7,  0x65,
      0x79, 0x58, 0x21, 0x2b, 0xdc, 0x6f, 0x0,  0x8,  0x22, 0xa7, 0xad, 0x9a, 0x75, 0x65, 0x2,  0x41, 0x12, 0x0,  0xf,
      0x3a, 0xa7, 0xd0, 0x52, 0xb,  0x73, 0x51, 0x5e, 0x4,  0x61, 0x3a, 0x3f, 0xe7, 0x26, 0x7a, 0x12, 0x0,  0x9,  0xc9,
      0xf3, 0x69, 0xf3, 0x89, 0x5,  0x5,  0xa5, 0xb5, 0x3,  0x0,  0x1,  0x95, 0x1a, 0x0,  0x8,  0xf6, 0x1b, 0x7e, 0x2c,
      0xee, 0xd7, 0x38, 0x24, 0x24, 0xac, 0x2,  0x0,  0x0,  0x66, 0xef, 0x19, 0x8a, 0x17, 0xe0, 0x3,  0x0,  0x13, 0xe1,
      0xa0, 0x27, 0x37, 0x6a, 0x1f, 0xe4, 0x17, 0xa3, 0xcc, 0xc6, 0x23, 0xe3, 0x1e, 0x10, 0xb3, 0x8d, 0xf,  0xa6, 0x26,
      0x0,  0x1e, 0xff, 0xd7, 0x8,  0xbd, 0x45, 0x80, 0x40, 0x1e, 0xa9, 0x8a, 0x84, 0xe8, 0x12, 0x56, 0x6f, 0x74, 0xa5,
      0xae, 0xd1, 0xb1, 0xed, 0x3,  0xb3, 0xcd, 0x69, 0x49, 0x2d, 0xfb, 0x73, 0xd2, 0x0,  0x7,  0xc3, 0x2f, 0xb8, 0xc1,
      0x14, 0x8e, 0xd8, 0x1,  0xfd, 0xb,  0x18, 0x18, 0x0,  0x0,  0x5c, 0x68, 0x13, 0x2c, 0x43, 0x29, 0x5,  0x23, 0x3f,
      0x29, 0x24, 0x7e, 0xfb, 0x68, 0x52, 0x99, 0xf,  0xc,  0xe2};

  uint8_t buf[286] = {0};

  uint8_t topic_bytes[] = {0x17, 0x32, 0xda, 0x8e, 0x71, 0x25};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x68, 0x52, 0x99, 0xf, 0xc, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x6f, 0x6f, 0xf1, 0x91, 0xb5, 0xf5, 0x8f, 0x2d, 0xa1, 0x78, 0x36, 0xf6, 0x2e, 0x4c,
                           0xac, 0xac, 0x1f, 0x26, 0x8c, 0x41, 0x62, 0xde, 0x5e, 0xde, 0x4b, 0xe,  0x88};
  uint8_t bytesprops1[] = {0xac, 0xbe, 0x1c, 0x44, 0x5f, 0x10, 0x50, 0xc,  0x8c, 0x4d,
                           0x85, 0xd5, 0xd4, 0x59, 0x91, 0x55, 0x23, 0xf7, 0xaa};
  uint8_t bytesprops2[] = {0x18, 0x20, 0x45, 0x53, 0x3a, 0xc4, 0xc8, 0xad, 0x9b, 0xbb, 0x52, 0x6f};
  uint8_t bytesprops4[] = {0xe9, 0xf8, 0x14, 0xd3, 0xa7, 0xd3, 0x35, 0xe6, 0xb1, 0xb, 0x8f};
  uint8_t bytesprops3[] = {0x30};
  uint8_t bytesprops6[] = {0x22, 0xa7, 0xad, 0x9a, 0x75, 0x65, 0x2, 0x41};
  uint8_t bytesprops5[] = {0x65, 0x79, 0x58, 0x21, 0x2b, 0xdc, 0x6f};
  uint8_t bytesprops7[] = {0x3a, 0xa7, 0xd0, 0x52, 0xb, 0x73, 0x51, 0x5e, 0x4, 0x61, 0x3a, 0x3f, 0xe7, 0x26, 0x7a};
  uint8_t bytesprops8[] = {0xc9, 0xf3, 0x69, 0xf3, 0x89, 0x5, 0x5, 0xa5, 0xb5};
  uint8_t bytesprops9[] = {0x95};
  uint8_t bytesprops10[] = {0xf6, 0x1b, 0x7e, 0x2c, 0xee, 0xd7, 0x38, 0x24};
  uint8_t bytesprops11[] = {0xe1, 0xa0, 0x27, 0x37, 0x6a, 0x1f, 0xe4, 0x17, 0xa3, 0xcc,
                            0xc6, 0x23, 0xe3, 0x1e, 0x10, 0xb3, 0x8d, 0xf,  0xa6};
  uint8_t bytesprops13[] = {0xc3, 0x2f, 0xb8, 0xc1, 0x14, 0x8e, 0xd8};
  uint8_t bytesprops12[] = {0xff, 0xd7, 0x8,  0xbd, 0x45, 0x80, 0x40, 0x1e, 0xa9, 0x8a, 0x84, 0xe8, 0x12, 0x56, 0x6f,
                            0x74, 0xa5, 0xae, 0xd1, 0xb1, 0xed, 0x3,  0xb3, 0xcd, 0x69, 0x49, 0x2d, 0xfb, 0x73, 0xd2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops3}, .v = {11, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20628}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops5}, .v = {8, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26351}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops12}, .v = {7, (char*)&bytesprops13}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23656}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11331}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16169}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 126}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16088, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\DC3\188\&0\t6w\FS", _pubPktID =
// 7577, _pubBody = "9\176{\185\134p\216\206\208\GS\EM?", _pubProps = [PropTopicAlias 9405,PropResponseInformation
// "y\233\208\212\193\SO\201",PropCorrelationData "\EM\ESCrbQ\251\DC1\159W\160\177@i",PropRequestProblemInformation
// 166,PropSharedSubscriptionAvailable 26,PropMessageExpiryInterval 18671,PropServerKeepAlive
// 13351,PropSubscriptionIdentifier 29]}
TEST(Publish5QCTest, Encode62) {
  uint8_t pkt[] = {0x32, 0x43, 0x0,  0x7,  0x13, 0xbc, 0x30, 0x9,  0x36, 0x77, 0x1c, 0x1d, 0x99, 0x2b,
                   0x23, 0x24, 0xbd, 0x1a, 0x0,  0x7,  0x79, 0xe9, 0xd0, 0xd4, 0xc1, 0xe,  0xc9, 0x9,
                   0x0,  0xd,  0x19, 0x1b, 0x72, 0x62, 0x51, 0xfb, 0x11, 0x9f, 0x57, 0xa0, 0xb1, 0x40,
                   0x69, 0x17, 0xa6, 0x2a, 0x1a, 0x2,  0x0,  0x0,  0x48, 0xef, 0x13, 0x34, 0x27, 0xb,
                   0x1d, 0x39, 0xb0, 0x7b, 0xb9, 0x86, 0x70, 0xd8, 0xce, 0xd0, 0x1d, 0x19, 0x3f};

  uint8_t buf[79] = {0};

  uint8_t topic_bytes[] = {0x13, 0xbc, 0x30, 0x9, 0x36, 0x77, 0x1c};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x39, 0xb0, 0x7b, 0xb9, 0x86, 0x70, 0xd8, 0xce, 0xd0, 0x1d, 0x19, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x79, 0xe9, 0xd0, 0xd4, 0xc1, 0xe, 0xc9};
  uint8_t bytesprops1[] = {0x19, 0x1b, 0x72, 0x62, 0x51, 0xfb, 0x11, 0x9f, 0x57, 0xa0, 0xb1, 0x40, 0x69};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9405}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18671}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13351}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7577, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\DC2a\165\SO(\131\154\NAKm\b\STX\243\250\178\197H", _pubPktID = 13200, _pubBody = "\164V\204\140", _pubProps =
// [PropAssignedClientIdentifier "\137\145\227\SOH\NULW\159\162",PropMessageExpiryInterval
// 3339,PropSubscriptionIdentifierAvailable 23,PropRequestResponseInformation 192,PropWillDelayInterval
// 22813,PropMaximumQoS 26,PropRequestResponseInformation 5,PropCorrelationData "\232\164%\154'",PropServerReference
// "\228W\253R\139E^\vA)",PropServerKeepAlive 15699,PropWildcardSubscriptionAvailable 48,PropMessageExpiryInterval
// 5022,PropPayloadFormatIndicator 55,PropRequestProblemInformation 204,PropRequestResponseInformation
// 118,PropSubscriptionIdentifier 7,PropServerReference "\197",PropSessionExpiryInterval 11778,PropServerKeepAlive
// 14548,PropServerKeepAlive 24117,PropRequestProblemInformation 242,PropSubscriptionIdentifier 30,PropTopicAlias
// 5877,PropWillDelayInterval 7490]}
TEST(Publish5QCTest, Encode63) {
  uint8_t pkt[] = {0x3c, 0x78, 0x0,  0x10, 0x12, 0x61, 0xa5, 0xe,  0x28, 0x83, 0x9a, 0x15, 0x6d, 0x8,  0x2,  0xf3,
                   0xfa, 0xb2, 0xc5, 0x48, 0x33, 0x90, 0x5f, 0x12, 0x0,  0x8,  0x89, 0x91, 0xe3, 0x1,  0x0,  0x57,
                   0x9f, 0xa2, 0x2,  0x0,  0x0,  0xd,  0xb,  0x29, 0x17, 0x19, 0xc0, 0x18, 0x0,  0x0,  0x59, 0x1d,
                   0x24, 0x1a, 0x19, 0x5,  0x9,  0x0,  0x5,  0xe8, 0xa4, 0x25, 0x9a, 0x27, 0x1c, 0x0,  0xa,  0xe4,
                   0x57, 0xfd, 0x52, 0x8b, 0x45, 0x5e, 0xb,  0x41, 0x29, 0x13, 0x3d, 0x53, 0x28, 0x30, 0x2,  0x0,
                   0x0,  0x13, 0x9e, 0x1,  0x37, 0x17, 0xcc, 0x19, 0x76, 0xb,  0x7,  0x1c, 0x0,  0x1,  0xc5, 0x11,
                   0x0,  0x0,  0x2e, 0x2,  0x13, 0x38, 0xd4, 0x13, 0x5e, 0x35, 0x17, 0xf2, 0xb,  0x1e, 0x23, 0x16,
                   0xf5, 0x18, 0x0,  0x0,  0x1d, 0x42, 0xa4, 0x56, 0xcc, 0x8c};

  uint8_t buf[132] = {0};

  uint8_t topic_bytes[] = {0x12, 0x61, 0xa5, 0xe, 0x28, 0x83, 0x9a, 0x15, 0x6d, 0x8, 0x2, 0xf3, 0xfa, 0xb2, 0xc5, 0x48};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa4, 0x56, 0xcc, 0x8c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0x89, 0x91, 0xe3, 0x1, 0x0, 0x57, 0x9f, 0xa2};
  uint8_t bytesprops1[] = {0xe8, 0xa4, 0x25, 0x9a, 0x27};
  uint8_t bytesprops2[] = {0xe4, 0x57, 0xfd, 0x52, 0x8b, 0x45, 0x5e, 0xb, 0x41, 0x29};
  uint8_t bytesprops3[] = {0xc5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3339}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22813}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15699}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5022}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11778}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14548}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24117}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5877}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7490}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 13200, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\136\199\135\133\171\252+\211d\DC3\\\170>\250\GS\GS\250\ETX\238", _pubPktID = 15457, _pubBody =
// "f\244\166\DLE\197\195\242\206\199<\FS\ETB$\STX \236\135\235\232\196\229\b`n\216,v\233V\177", _pubProps =
// [PropServerReference
// "\189|\165\GS`\199\151O\183$\228Y\158(%Ym\176\229\241d\233\196\196\138\209\146\142",PropAuthenticationData
// "\153\167\232\&2",PropSharedSubscriptionAvailable 174,PropAuthenticationMethod "}/",PropWildcardSubscriptionAvailable
// 206,PropTopicAlias 32469,PropWillDelayInterval 18902,PropReasonString
// "\217\251\241\147@`\v-\a\253\209\184",PropWildcardSubscriptionAvailable 200,PropRequestResponseInformation
// 100,PropCorrelationData
// "{\185a\t\EM\234\142{oa\ESC\b?\209\t\138\"\194{dDx\157\SOH",PropSubscriptionIdentifierAvailable
// 97,PropCorrelationData "\232)BS\179l\175\196\GS",PropSubscriptionIdentifierAvailable 226,PropResponseInformation
// "\164\rp\193\236\186u\224\t\168q\230\166\153ngOL\"\USA\191\131\&2\\\252\142)\147\219",PropMessageExpiryInterval
// 3303,PropSharedSubscriptionAvailable 214,PropAuthenticationData
// "\249w\"\132\217[\255E\189\DLE^\a\197?\141%\224\RSJ\207\188Fd1\240v",PropSubscriptionIdentifierAvailable
// 177,PropResponseInformation "\160e\210P\218\248\ESC}\225\146\SUB\245$A\246\&3B\171\146\255Vk\ENQsZK"]}
TEST(Publish5QCTest, Encode64) {
  uint8_t pkt[] = {
      0x3b, 0x90, 0x2,  0x0,  0x13, 0x88, 0xc7, 0x87, 0x85, 0xab, 0xfc, 0x2b, 0xd3, 0x64, 0x13, 0x5c, 0xaa, 0x3e, 0xfa,
      0x1d, 0x1d, 0xfa, 0x3,  0xee, 0x3c, 0x61, 0xd9, 0x1,  0x1c, 0x0,  0x1c, 0xbd, 0x7c, 0xa5, 0x1d, 0x60, 0xc7, 0x97,
      0x4f, 0xb7, 0x24, 0xe4, 0x59, 0x9e, 0x28, 0x25, 0x59, 0x6d, 0xb0, 0xe5, 0xf1, 0x64, 0xe9, 0xc4, 0xc4, 0x8a, 0xd1,
      0x92, 0x8e, 0x16, 0x0,  0x4,  0x99, 0xa7, 0xe8, 0x32, 0x2a, 0xae, 0x15, 0x0,  0x2,  0x7d, 0x2f, 0x28, 0xce, 0x23,
      0x7e, 0xd5, 0x18, 0x0,  0x0,  0x49, 0xd6, 0x1f, 0x0,  0xc,  0xd9, 0xfb, 0xf1, 0x93, 0x40, 0x60, 0xb,  0x2d, 0x7,
      0xfd, 0xd1, 0xb8, 0x28, 0xc8, 0x19, 0x64, 0x9,  0x0,  0x18, 0x7b, 0xb9, 0x61, 0x9,  0x19, 0xea, 0x8e, 0x7b, 0x6f,
      0x61, 0x1b, 0x8,  0x3f, 0xd1, 0x9,  0x8a, 0x22, 0xc2, 0x7b, 0x64, 0x44, 0x78, 0x9d, 0x1,  0x29, 0x61, 0x9,  0x0,
      0x9,  0xe8, 0x29, 0x42, 0x53, 0xb3, 0x6c, 0xaf, 0xc4, 0x1d, 0x29, 0xe2, 0x1a, 0x0,  0x1e, 0xa4, 0xd,  0x70, 0xc1,
      0xec, 0xba, 0x75, 0xe0, 0x9,  0xa8, 0x71, 0xe6, 0xa6, 0x99, 0x6e, 0x67, 0x4f, 0x4c, 0x22, 0x1f, 0x41, 0xbf, 0x83,
      0x32, 0x5c, 0xfc, 0x8e, 0x29, 0x93, 0xdb, 0x2,  0x0,  0x0,  0xc,  0xe7, 0x2a, 0xd6, 0x16, 0x0,  0x1a, 0xf9, 0x77,
      0x22, 0x84, 0xd9, 0x5b, 0xff, 0x45, 0xbd, 0x10, 0x5e, 0x7,  0xc5, 0x3f, 0x8d, 0x25, 0xe0, 0x1e, 0x4a, 0xcf, 0xbc,
      0x46, 0x64, 0x31, 0xf0, 0x76, 0x29, 0xb1, 0x1a, 0x0,  0x1a, 0xa0, 0x65, 0xd2, 0x50, 0xda, 0xf8, 0x1b, 0x7d, 0xe1,
      0x92, 0x1a, 0xf5, 0x24, 0x41, 0xf6, 0x33, 0x42, 0xab, 0x92, 0xff, 0x56, 0x6b, 0x5,  0x73, 0x5a, 0x4b, 0x66, 0xf4,
      0xa6, 0x10, 0xc5, 0xc3, 0xf2, 0xce, 0xc7, 0x3c, 0x1c, 0x17, 0x24, 0x2,  0x20, 0xec, 0x87, 0xeb, 0xe8, 0xc4, 0xe5,
      0x8,  0x60, 0x6e, 0xd8, 0x2c, 0x76, 0xe9, 0x56, 0xb1};

  uint8_t buf[285] = {0};

  uint8_t topic_bytes[] = {0x88, 0xc7, 0x87, 0x85, 0xab, 0xfc, 0x2b, 0xd3, 0x64, 0x13,
                           0x5c, 0xaa, 0x3e, 0xfa, 0x1d, 0x1d, 0xfa, 0x3,  0xee};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x66, 0xf4, 0xa6, 0x10, 0xc5, 0xc3, 0xf2, 0xce, 0xc7, 0x3c, 0x1c, 0x17, 0x24, 0x2,  0x20,
                         0xec, 0x87, 0xeb, 0xe8, 0xc4, 0xe5, 0x8,  0x60, 0x6e, 0xd8, 0x2c, 0x76, 0xe9, 0x56, 0xb1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xbd, 0x7c, 0xa5, 0x1d, 0x60, 0xc7, 0x97, 0x4f, 0xb7, 0x24, 0xe4, 0x59, 0x9e, 0x28,
                           0x25, 0x59, 0x6d, 0xb0, 0xe5, 0xf1, 0x64, 0xe9, 0xc4, 0xc4, 0x8a, 0xd1, 0x92, 0x8e};
  uint8_t bytesprops1[] = {0x99, 0xa7, 0xe8, 0x32};
  uint8_t bytesprops2[] = {0x7d, 0x2f};
  uint8_t bytesprops3[] = {0xd9, 0xfb, 0xf1, 0x93, 0x40, 0x60, 0xb, 0x2d, 0x7, 0xfd, 0xd1, 0xb8};
  uint8_t bytesprops4[] = {0x7b, 0xb9, 0x61, 0x9,  0x19, 0xea, 0x8e, 0x7b, 0x6f, 0x61, 0x1b, 0x8,
                           0x3f, 0xd1, 0x9,  0x8a, 0x22, 0xc2, 0x7b, 0x64, 0x44, 0x78, 0x9d, 0x1};
  uint8_t bytesprops5[] = {0xe8, 0x29, 0x42, 0x53, 0xb3, 0x6c, 0xaf, 0xc4, 0x1d};
  uint8_t bytesprops6[] = {0xa4, 0xd,  0x70, 0xc1, 0xec, 0xba, 0x75, 0xe0, 0x9,  0xa8, 0x71, 0xe6, 0xa6, 0x99, 0x6e,
                           0x67, 0x4f, 0x4c, 0x22, 0x1f, 0x41, 0xbf, 0x83, 0x32, 0x5c, 0xfc, 0x8e, 0x29, 0x93, 0xdb};
  uint8_t bytesprops7[] = {0xf9, 0x77, 0x22, 0x84, 0xd9, 0x5b, 0xff, 0x45, 0xbd, 0x10, 0x5e, 0x7,  0xc5,
                           0x3f, 0x8d, 0x25, 0xe0, 0x1e, 0x4a, 0xcf, 0xbc, 0x46, 0x64, 0x31, 0xf0, 0x76};
  uint8_t bytesprops8[] = {0xa0, 0x65, 0xd2, 0x50, 0xda, 0xf8, 0x1b, 0x7d, 0xe1, 0x92, 0x1a, 0xf5, 0x24,
                           0x41, 0xf6, 0x33, 0x42, 0xab, 0x92, 0xff, 0x56, 0x6b, 0x5,  0x73, 0x5a, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32469}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18902}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3303}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15457, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 29420, _pubBody =
// "F\146\254\ETB\174Cu^\188$\218\201\215$\253\&7\184\236S\169\243\ETXn\180\US\fC\220\137\SYN", _pubProps =
// [PropSessionExpiryInterval 27347,PropServerKeepAlive 18294,PropTopicAliasMaximum 11531,PropAuthenticationMethod
// "\254\189\195{",PropResponseTopic
// "\CAN\139\240<\247\132\164F\228\&9w\DC3\139\221P'Y$\140\230\223S\247\149\206",PropMessageExpiryInterval
// 30913,PropSubscriptionIdentifier 6,PropAuthenticationMethod
// "\148\195\136\v\131\176\171\141\150@\f\f1\201",PropRetainAvailable 184,PropContentType "\158\bQU\201"]}
TEST(Publish5QCTest, Encode65) {
  uint8_t pkt[] = {0x33, 0x73, 0x0,  0x0,  0x72, 0xec, 0x50, 0x11, 0x0,  0x0,  0x6a, 0xd3, 0x13, 0x47, 0x76, 0x22, 0x2d,
                   0xb,  0x15, 0x0,  0x4,  0xfe, 0xbd, 0xc3, 0x7b, 0x8,  0x0,  0x19, 0x18, 0x8b, 0xf0, 0x3c, 0xf7, 0x84,
                   0xa4, 0x46, 0xe4, 0x39, 0x77, 0x13, 0x8b, 0xdd, 0x50, 0x27, 0x59, 0x24, 0x8c, 0xe6, 0xdf, 0x53, 0xf7,
                   0x95, 0xce, 0x2,  0x0,  0x0,  0x78, 0xc1, 0xb,  0x6,  0x15, 0x0,  0xe,  0x94, 0xc3, 0x88, 0xb,  0x83,
                   0xb0, 0xab, 0x8d, 0x96, 0x40, 0xc,  0xc,  0x31, 0xc9, 0x25, 0xb8, 0x3,  0x0,  0x5,  0x9e, 0x8,  0x51,
                   0x55, 0xc9, 0x46, 0x92, 0xfe, 0x17, 0xae, 0x43, 0x75, 0x5e, 0xbc, 0x24, 0xda, 0xc9, 0xd7, 0x24, 0xfd,
                   0x37, 0xb8, 0xec, 0x53, 0xa9, 0xf3, 0x3,  0x6e, 0xb4, 0x1f, 0xc,  0x43, 0xdc, 0x89, 0x16};

  uint8_t buf[127] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x46, 0x92, 0xfe, 0x17, 0xae, 0x43, 0x75, 0x5e, 0xbc, 0x24, 0xda, 0xc9, 0xd7, 0x24, 0xfd,
                         0x37, 0xb8, 0xec, 0x53, 0xa9, 0xf3, 0x3,  0x6e, 0xb4, 0x1f, 0xc,  0x43, 0xdc, 0x89, 0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xfe, 0xbd, 0xc3, 0x7b};
  uint8_t bytesprops1[] = {0x18, 0x8b, 0xf0, 0x3c, 0xf7, 0x84, 0xa4, 0x46, 0xe4, 0x39, 0x77, 0x13, 0x8b,
                           0xdd, 0x50, 0x27, 0x59, 0x24, 0x8c, 0xe6, 0xdf, 0x53, 0xf7, 0x95, 0xce};
  uint8_t bytesprops2[] = {0x94, 0xc3, 0x88, 0xb, 0x83, 0xb0, 0xab, 0x8d, 0x96, 0x40, 0xc, 0xc, 0x31, 0xc9};
  uint8_t bytesprops3[] = {0x9e, 0x8, 0x51, 0x55, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27347}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18294}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11531}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30913}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29420, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\253\220\DC4\187\155", _pubPktID =
// 28673, _pubBody = "\160\255\248\156YF\148S\164\194~\t\212\134\149`\202l", _pubProps = [PropPayloadFormatIndicator
// 176,PropWillDelayInterval 3215,PropReceiveMaximum 13425,PropReasonString
// "\216\221Ld\140\&1\193\179\163\NULN\204\151\ETB9\SO\143\153\216\ENQ\130\209()\139i\251\171",PropPayloadFormatIndicator
// 115,PropRequestProblemInformation 180,PropUserProperty
// "\241\SI\145\166\164v\239*\151\181.C?\198f\252\224\153O\190@Q\"\226r\239u\152\194\249"
// "\222\r\236IU\t\175M\165F\168zy\202\SYN2\172\228\253\250\SI\178M\130\bSj\180",PropUserProperty
// "\229Sk\DELQ\173\163\FS7\142\131\NAKU\204\132\180"
// "\232\155\&6&\185Z\178\DC4\231i'$\185\132\SOH$Qf\ETBPp\249\250",PropResponseTopic
// "\150^\217u\190\b\a\SO\139\250\&6\NAK\199|/\164`\147\164\247\&5gU\214\185",PropSharedSubscriptionAvailable
// 227,PropMaximumQoS 172,PropMaximumQoS 108,PropWillDelayInterval 7918,PropMaximumPacketSize 10821]}
TEST(Publish5QCTest, Encode66) {
  uint8_t pkt[] = {
      0x35, 0xe1, 0x1,  0x0,  0x5,  0xfd, 0xdc, 0x14, 0xbb, 0x9b, 0x70, 0x1,  0xc4, 0x1,  0x1,  0xb0, 0x18, 0x0,  0x0,
      0xc,  0x8f, 0x21, 0x34, 0x71, 0x1f, 0x0,  0x1c, 0xd8, 0xdd, 0x4c, 0x64, 0x8c, 0x31, 0xc1, 0xb3, 0xa3, 0x0,  0x4e,
      0xcc, 0x97, 0x17, 0x39, 0xe,  0x8f, 0x99, 0xd8, 0x5,  0x82, 0xd1, 0x28, 0x29, 0x8b, 0x69, 0xfb, 0xab, 0x1,  0x73,
      0x17, 0xb4, 0x26, 0x0,  0x1e, 0xf1, 0xf,  0x91, 0xa6, 0xa4, 0x76, 0xef, 0x2a, 0x97, 0xb5, 0x2e, 0x43, 0x3f, 0xc6,
      0x66, 0xfc, 0xe0, 0x99, 0x4f, 0xbe, 0x40, 0x51, 0x22, 0xe2, 0x72, 0xef, 0x75, 0x98, 0xc2, 0xf9, 0x0,  0x1c, 0xde,
      0xd,  0xec, 0x49, 0x55, 0x9,  0xaf, 0x4d, 0xa5, 0x46, 0xa8, 0x7a, 0x79, 0xca, 0x16, 0x32, 0xac, 0xe4, 0xfd, 0xfa,
      0xf,  0xb2, 0x4d, 0x82, 0x8,  0x53, 0x6a, 0xb4, 0x26, 0x0,  0x10, 0xe5, 0x53, 0x6b, 0x7f, 0x51, 0xad, 0xa3, 0x1c,
      0x37, 0x8e, 0x83, 0x15, 0x55, 0xcc, 0x84, 0xb4, 0x0,  0x17, 0xe8, 0x9b, 0x36, 0x26, 0xb9, 0x5a, 0xb2, 0x14, 0xe7,
      0x69, 0x27, 0x24, 0xb9, 0x84, 0x1,  0x24, 0x51, 0x66, 0x17, 0x50, 0x70, 0xf9, 0xfa, 0x8,  0x0,  0x19, 0x96, 0x5e,
      0xd9, 0x75, 0xbe, 0x8,  0x7,  0xe,  0x8b, 0xfa, 0x36, 0x15, 0xc7, 0x7c, 0x2f, 0xa4, 0x60, 0x93, 0xa4, 0xf7, 0x35,
      0x67, 0x55, 0xd6, 0xb9, 0x2a, 0xe3, 0x24, 0xac, 0x24, 0x6c, 0x18, 0x0,  0x0,  0x1e, 0xee, 0x27, 0x0,  0x0,  0x2a,
      0x45, 0xa0, 0xff, 0xf8, 0x9c, 0x59, 0x46, 0x94, 0x53, 0xa4, 0xc2, 0x7e, 0x9,  0xd4, 0x86, 0x95, 0x60, 0xca, 0x6c};

  uint8_t buf[238] = {0};

  uint8_t topic_bytes[] = {0xfd, 0xdc, 0x14, 0xbb, 0x9b};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa0, 0xff, 0xf8, 0x9c, 0x59, 0x46, 0x94, 0x53, 0xa4,
                         0xc2, 0x7e, 0x9,  0xd4, 0x86, 0x95, 0x60, 0xca, 0x6c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0xd8, 0xdd, 0x4c, 0x64, 0x8c, 0x31, 0xc1, 0xb3, 0xa3, 0x0,  0x4e, 0xcc, 0x97, 0x17,
                           0x39, 0xe,  0x8f, 0x99, 0xd8, 0x5,  0x82, 0xd1, 0x28, 0x29, 0x8b, 0x69, 0xfb, 0xab};
  uint8_t bytesprops2[] = {0xde, 0xd,  0xec, 0x49, 0x55, 0x9,  0xaf, 0x4d, 0xa5, 0x46, 0xa8, 0x7a, 0x79, 0xca,
                           0x16, 0x32, 0xac, 0xe4, 0xfd, 0xfa, 0xf,  0xb2, 0x4d, 0x82, 0x8,  0x53, 0x6a, 0xb4};
  uint8_t bytesprops1[] = {0xf1, 0xf,  0x91, 0xa6, 0xa4, 0x76, 0xef, 0x2a, 0x97, 0xb5, 0x2e, 0x43, 0x3f, 0xc6, 0x66,
                           0xfc, 0xe0, 0x99, 0x4f, 0xbe, 0x40, 0x51, 0x22, 0xe2, 0x72, 0xef, 0x75, 0x98, 0xc2, 0xf9};
  uint8_t bytesprops4[] = {0xe8, 0x9b, 0x36, 0x26, 0xb9, 0x5a, 0xb2, 0x14, 0xe7, 0x69, 0x27, 0x24,
                           0xb9, 0x84, 0x1,  0x24, 0x51, 0x66, 0x17, 0x50, 0x70, 0xf9, 0xfa};
  uint8_t bytesprops3[] = {0xe5, 0x53, 0x6b, 0x7f, 0x51, 0xad, 0xa3, 0x1c,
                           0x37, 0x8e, 0x83, 0x15, 0x55, 0xcc, 0x84, 0xb4};
  uint8_t bytesprops5[] = {0x96, 0x5e, 0xd9, 0x75, 0xbe, 0x8,  0x7,  0xe,  0x8b, 0xfa, 0x36, 0x15, 0xc7,
                           0x7c, 0x2f, 0xa4, 0x60, 0x93, 0xa4, 0xf7, 0x35, 0x67, 0x55, 0xd6, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3215}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13425}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops1}, .v = {28, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops3}, .v = {23, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7918}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10821}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 28673, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\141\195\131\143\248w\207",
// _pubPktID = 574, _pubBody = "x\\\156a}\224\130S\US%\153\187\181\217\RS\201{", _pubProps = [PropMaximumQoS
// 87,PropRequestProblemInformation 231,PropUserProperty "\171\248\247\215S\157" "1\GS\241wj\178\191_\130\240[Z\ACK"]}
TEST(Publish5QCTest, Encode67) {
  uint8_t pkt[] = {0x33, 0x39, 0x0,  0x7,  0x8d, 0xc3, 0x83, 0x8f, 0xf8, 0x77, 0xcf, 0x2,  0x3e, 0x1c, 0x24,
                   0x57, 0x17, 0xe7, 0x26, 0x0,  0x6,  0xab, 0xf8, 0xf7, 0xd7, 0x53, 0x9d, 0x0,  0xd,  0x31,
                   0x1d, 0xf1, 0x77, 0x6a, 0xb2, 0xbf, 0x5f, 0x82, 0xf0, 0x5b, 0x5a, 0x6,  0x78, 0x5c, 0x9c,
                   0x61, 0x7d, 0xe0, 0x82, 0x53, 0x1f, 0x25, 0x99, 0xbb, 0xb5, 0xd9, 0x1e, 0xc9, 0x7b};

  uint8_t buf[69] = {0};

  uint8_t topic_bytes[] = {0x8d, 0xc3, 0x83, 0x8f, 0xf8, 0x77, 0xcf};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x78, 0x5c, 0x9c, 0x61, 0x7d, 0xe0, 0x82, 0x53, 0x1f,
                         0x25, 0x99, 0xbb, 0xb5, 0xd9, 0x1e, 0xc9, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops1[] = {0x31, 0x1d, 0xf1, 0x77, 0x6a, 0xb2, 0xbf, 0x5f, 0x82, 0xf0, 0x5b, 0x5a, 0x6};
  uint8_t bytesprops0[] = {0xab, 0xf8, 0xf7, 0xd7, 0x53, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {13, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 574, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "Mq\234\146\239\150W\FS1\177",
// _pubPktID = 0, _pubBody = "0\141\201\&8\139\&4\ETX>\239\RS\238\229t\225\198|\194W\186]\200\244|\171\DLE\163\193",
// _pubProps = [PropMaximumPacketSize 8091,PropTopicAliasMaximum 14682,PropUserProperty
// "\170`[\143\144<\181\138\154\150\&2[" "\197\171U(\DC1\249:aYH\248\175\t:\209 hc\210\222",PropCorrelationData
// "\169\207;\130S!n\178\ESC\247-\218\220w\225\176\140\252",PropRequestProblemInformation
// 89,PropSubscriptionIdentifierAvailable 119,PropAssignedClientIdentifier ">n\204\133\&0q",PropRetainAvailable
// 145,PropRequestResponseInformation 157]}
TEST(Publish5QCTest, Encode68) {
  uint8_t pkt[] = {0x38, 0x7b, 0x0,  0xa,  0x4d, 0x71, 0xea, 0x92, 0xef, 0x96, 0x57, 0x1c, 0x31, 0xb1, 0x53, 0x27,
                   0x0,  0x0,  0x1f, 0x9b, 0x22, 0x39, 0x5a, 0x26, 0x0,  0xc,  0xaa, 0x60, 0x5b, 0x8f, 0x90, 0x3c,
                   0xb5, 0x8a, 0x9a, 0x96, 0x32, 0x5b, 0x0,  0x14, 0xc5, 0xab, 0x55, 0x28, 0x11, 0xf9, 0x3a, 0x61,
                   0x59, 0x48, 0xf8, 0xaf, 0x9,  0x3a, 0xd1, 0x20, 0x68, 0x63, 0xd2, 0xde, 0x9,  0x0,  0x12, 0xa9,
                   0xcf, 0x3b, 0x82, 0x53, 0x21, 0x6e, 0xb2, 0x1b, 0xf7, 0x2d, 0xda, 0xdc, 0x77, 0xe1, 0xb0, 0x8c,
                   0xfc, 0x17, 0x59, 0x29, 0x77, 0x12, 0x0,  0x6,  0x3e, 0x6e, 0xcc, 0x85, 0x30, 0x71, 0x25, 0x91,
                   0x19, 0x9d, 0x30, 0x8d, 0xc9, 0x38, 0x8b, 0x34, 0x3,  0x3e, 0xef, 0x1e, 0xee, 0xe5, 0x74, 0xe1,
                   0xc6, 0x7c, 0xc2, 0x57, 0xba, 0x5d, 0xc8, 0xf4, 0x7c, 0xab, 0x10, 0xa3, 0xc1};

  uint8_t buf[135] = {0};

  uint8_t topic_bytes[] = {0x4d, 0x71, 0xea, 0x92, 0xef, 0x96, 0x57, 0x1c, 0x31, 0xb1};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x30, 0x8d, 0xc9, 0x38, 0x8b, 0x34, 0x3,  0x3e, 0xef, 0x1e, 0xee, 0xe5, 0x74, 0xe1,
                         0xc6, 0x7c, 0xc2, 0x57, 0xba, 0x5d, 0xc8, 0xf4, 0x7c, 0xab, 0x10, 0xa3, 0xc1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops1[] = {0xc5, 0xab, 0x55, 0x28, 0x11, 0xf9, 0x3a, 0x61, 0x59, 0x48,
                           0xf8, 0xaf, 0x9,  0x3a, 0xd1, 0x20, 0x68, 0x63, 0xd2, 0xde};
  uint8_t bytesprops0[] = {0xaa, 0x60, 0x5b, 0x8f, 0x90, 0x3c, 0xb5, 0x8a, 0x9a, 0x96, 0x32, 0x5b};
  uint8_t bytesprops2[] = {0xa9, 0xcf, 0x3b, 0x82, 0x53, 0x21, 0x6e, 0xb2, 0x1b,
                           0xf7, 0x2d, 0xda, 0xdc, 0x77, 0xe1, 0xb0, 0x8c, 0xfc};
  uint8_t bytesprops3[] = {0x3e, 0x6e, 0xcc, 0x85, 0x30, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8091}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14682}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "h\155\209\SYNBX\251\201\213\188",
// _pubPktID = 12728, _pubBody = "\SI\140\187\174(F\161\145", _pubProps = [PropWildcardSubscriptionAvailable
// 108,PropWildcardSubscriptionAvailable 247,PropMessageExpiryInterval 30096,PropCorrelationData
// "\138\254J\"~fp\SO\165\170\187\"\204'\182\RS"]}
TEST(Publish5QCTest, Encode69) {
  uint8_t pkt[] = {0x3a, 0x33, 0x0,  0xa,  0x68, 0x9b, 0xd1, 0x16, 0x42, 0x58, 0xfb, 0xc9, 0xd5, 0xbc,
                   0x31, 0xb8, 0x1c, 0x28, 0x6c, 0x28, 0xf7, 0x2,  0x0,  0x0,  0x75, 0x90, 0x9,  0x0,
                   0x10, 0x8a, 0xfe, 0x4a, 0x22, 0x7e, 0x66, 0x70, 0xe,  0xa5, 0xaa, 0xbb, 0x22, 0xcc,
                   0x27, 0xb6, 0x1e, 0xf,  0x8c, 0xbb, 0xae, 0x28, 0x46, 0xa1, 0x91};

  uint8_t buf[63] = {0};

  uint8_t topic_bytes[] = {0x68, 0x9b, 0xd1, 0x16, 0x42, 0x58, 0xfb, 0xc9, 0xd5, 0xbc};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf, 0x8c, 0xbb, 0xae, 0x28, 0x46, 0xa1, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops0[] = {0x8a, 0xfe, 0x4a, 0x22, 0x7e, 0x66, 0x70, 0xe,
                           0xa5, 0xaa, 0xbb, 0x22, 0xcc, 0x27, 0xb6, 0x1e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30096}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 12728, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "kH\169\156\ACK\a\235\&2Q\128\148\FS\135\142\FS]\168j\246\208", _pubPktID = 23840, _pubBody = "D\195\164", _pubProps
// = [PropCorrelationData
// "\135\165\202T\199\STX\150\US&\171b\171\147\234\NUL*{(\215\227\252\218\246\168|:\154<\DC1",PropTopicAliasMaximum
// 16471,PropReasonString "'\135\228(\156\&3:\US3\186e\DC4",PropMaximumPacketSize 22772,PropAssignedClientIdentifier
// "5",PropServerReference "\173}\150\243\255\t\161\&0#\234",PropReceiveMaximum 5843,PropAuthenticationData
// "\219h\207s\DC37Y",PropMaximumPacketSize 14127,PropAssignedClientIdentifier
// "vn=}\185\245Z\DC3\201\170\ACK\171\212\210\157\NUL:\140\229g\SI1\ENQL",PropWildcardSubscriptionAvailable
// 204,PropCorrelationData
// ">\NAK\183\160ii\247\191\206\222j((\US6D6M\174\196g\212\223\222\234\166",PropMessageExpiryInterval
// 25815,PropRequestResponseInformation 149,PropSubscriptionIdentifierAvailable 115,PropMessageExpiryInterval
// 9063,PropRequestProblemInformation 12,PropMaximumPacketSize 4463,PropAuthenticationMethod
// "\ACK\205+\179\a&\224\183\200\146\142yk\181\r\GSJ\192:\236\&1\ETB\183",PropSharedSubscriptionAvailable
// 125,PropResponseTopic
// "\200\130\NUL\213\EM\208h\239\171D\202\134\178\ETBY\\\212(\157\&3c\173P9(",PropSubscriptionIdentifier
// 28,PropAuthenticationData "\135\183\NAK\DEL\245\189\162J\223\ESC",PropMaximumPacketSize 28065]}
TEST(Publish5QCTest, Encode70) {
  uint8_t pkt[] = {
      0x33, 0x92, 0x2,  0x0,  0x14, 0x6b, 0x48, 0xa9, 0x9c, 0x6,  0x7,  0xeb, 0x32, 0x51, 0x80, 0x94, 0x1c, 0x87, 0x8e,
      0x1c, 0x5d, 0xa8, 0x6a, 0xf6, 0xd0, 0x5d, 0x20, 0xf5, 0x1,  0x9,  0x0,  0x1d, 0x87, 0xa5, 0xca, 0x54, 0xc7, 0x2,
      0x96, 0x1f, 0x26, 0xab, 0x62, 0xab, 0x93, 0xea, 0x0,  0x2a, 0x7b, 0x28, 0xd7, 0xe3, 0xfc, 0xda, 0xf6, 0xa8, 0x7c,
      0x3a, 0x9a, 0x3c, 0x11, 0x22, 0x40, 0x57, 0x1f, 0x0,  0xc,  0x27, 0x87, 0xe4, 0x28, 0x9c, 0x33, 0x3a, 0x1f, 0x33,
      0xba, 0x65, 0x14, 0x27, 0x0,  0x0,  0x58, 0xf4, 0x12, 0x0,  0x1,  0x35, 0x1c, 0x0,  0xa,  0xad, 0x7d, 0x96, 0xf3,
      0xff, 0x9,  0xa1, 0x30, 0x23, 0xea, 0x21, 0x16, 0xd3, 0x16, 0x0,  0x7,  0xdb, 0x68, 0xcf, 0x73, 0x13, 0x37, 0x59,
      0x27, 0x0,  0x0,  0x37, 0x2f, 0x12, 0x0,  0x18, 0x76, 0x6e, 0x3d, 0x7d, 0xb9, 0xf5, 0x5a, 0x13, 0xc9, 0xaa, 0x6,
      0xab, 0xd4, 0xd2, 0x9d, 0x0,  0x3a, 0x8c, 0xe5, 0x67, 0xf,  0x31, 0x5,  0x4c, 0x28, 0xcc, 0x9,  0x0,  0x1a, 0x3e,
      0x15, 0xb7, 0xa0, 0x69, 0x69, 0xf7, 0xbf, 0xce, 0xde, 0x6a, 0x28, 0x28, 0x1f, 0x36, 0x44, 0x36, 0x4d, 0xae, 0xc4,
      0x67, 0xd4, 0xdf, 0xde, 0xea, 0xa6, 0x2,  0x0,  0x0,  0x64, 0xd7, 0x19, 0x95, 0x29, 0x73, 0x2,  0x0,  0x0,  0x23,
      0x67, 0x17, 0xc,  0x27, 0x0,  0x0,  0x11, 0x6f, 0x15, 0x0,  0x17, 0x6,  0xcd, 0x2b, 0xb3, 0x7,  0x26, 0xe0, 0xb7,
      0xc8, 0x92, 0x8e, 0x79, 0x6b, 0xb5, 0xd,  0x1d, 0x4a, 0xc0, 0x3a, 0xec, 0x31, 0x17, 0xb7, 0x2a, 0x7d, 0x8,  0x0,
      0x19, 0xc8, 0x82, 0x0,  0xd5, 0x19, 0xd0, 0x68, 0xef, 0xab, 0x44, 0xca, 0x86, 0xb2, 0x17, 0x59, 0x5c, 0xd4, 0x28,
      0x9d, 0x33, 0x63, 0xad, 0x50, 0x39, 0x28, 0xb,  0x1c, 0x16, 0x0,  0xa,  0x87, 0xb7, 0x15, 0x7f, 0xf5, 0xbd, 0xa2,
      0x4a, 0xdf, 0x1b, 0x27, 0x0,  0x0,  0x6d, 0xa1, 0x44, 0xc3, 0xa4};

  uint8_t buf[287] = {0};

  uint8_t topic_bytes[] = {0x6b, 0x48, 0xa9, 0x9c, 0x6,  0x7,  0xeb, 0x32, 0x51, 0x80,
                           0x94, 0x1c, 0x87, 0x8e, 0x1c, 0x5d, 0xa8, 0x6a, 0xf6, 0xd0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x44, 0xc3, 0xa4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x87, 0xa5, 0xca, 0x54, 0xc7, 0x2,  0x96, 0x1f, 0x26, 0xab, 0x62, 0xab, 0x93, 0xea, 0x0,
                           0x2a, 0x7b, 0x28, 0xd7, 0xe3, 0xfc, 0xda, 0xf6, 0xa8, 0x7c, 0x3a, 0x9a, 0x3c, 0x11};
  uint8_t bytesprops1[] = {0x27, 0x87, 0xe4, 0x28, 0x9c, 0x33, 0x3a, 0x1f, 0x33, 0xba, 0x65, 0x14};
  uint8_t bytesprops2[] = {0x35};
  uint8_t bytesprops3[] = {0xad, 0x7d, 0x96, 0xf3, 0xff, 0x9, 0xa1, 0x30, 0x23, 0xea};
  uint8_t bytesprops4[] = {0xdb, 0x68, 0xcf, 0x73, 0x13, 0x37, 0x59};
  uint8_t bytesprops5[] = {0x76, 0x6e, 0x3d, 0x7d, 0xb9, 0xf5, 0x5a, 0x13, 0xc9, 0xaa, 0x6, 0xab,
                           0xd4, 0xd2, 0x9d, 0x0,  0x3a, 0x8c, 0xe5, 0x67, 0xf,  0x31, 0x5, 0x4c};
  uint8_t bytesprops6[] = {0x3e, 0x15, 0xb7, 0xa0, 0x69, 0x69, 0xf7, 0xbf, 0xce, 0xde, 0x6a, 0x28, 0x28,
                           0x1f, 0x36, 0x44, 0x36, 0x4d, 0xae, 0xc4, 0x67, 0xd4, 0xdf, 0xde, 0xea, 0xa6};
  uint8_t bytesprops7[] = {0x6,  0xcd, 0x2b, 0xb3, 0x7,  0x26, 0xe0, 0xb7, 0xc8, 0x92, 0x8e, 0x79,
                           0x6b, 0xb5, 0xd,  0x1d, 0x4a, 0xc0, 0x3a, 0xec, 0x31, 0x17, 0xb7};
  uint8_t bytesprops8[] = {0xc8, 0x82, 0x0,  0xd5, 0x19, 0xd0, 0x68, 0xef, 0xab, 0x44, 0xca, 0x86, 0xb2,
                           0x17, 0x59, 0x5c, 0xd4, 0x28, 0x9d, 0x33, 0x63, 0xad, 0x50, 0x39, 0x28};
  uint8_t bytesprops9[] = {0x87, 0xb7, 0x15, 0x7f, 0xf5, 0xbd, 0xa2, 0x4a, 0xdf, 0x1b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16471}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22772}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5843}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14127}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25815}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9063}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4463}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28065}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 23840, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "P\147\149\202g\200\140\&8\251",
// _pubPktID = 0, _pubBody = "\161k\226l\198m\147.\232\136\&3>\222>\138\225{\176s\227!\217C\RS\209_", _pubProps =
// [PropSubscriptionIdentifier 13,PropAuthenticationMethod "\234\v
// \227;i\206\135\130\220\158q{\216\161\246",PropMaximumQoS 236,PropServerReference
// "\ETXdV\185\248\140\206\132\190\165\195\147\128\"\DLE\147",PropReceiveMaximum 97,PropTopicAlias 16366]}
TEST(Publish5QCTest, Encode71) {
  uint8_t pkt[] = {0x31, 0x56, 0x0,  0x9,  0x50, 0x93, 0x95, 0xca, 0x67, 0xc8, 0x8c, 0x38, 0xfb, 0x30, 0xb,
                   0xd,  0x15, 0x0,  0x10, 0xea, 0xb,  0x20, 0xe3, 0x3b, 0x69, 0xce, 0x87, 0x82, 0xdc, 0x9e,
                   0x71, 0x7b, 0xd8, 0xa1, 0xf6, 0x24, 0xec, 0x1c, 0x0,  0x10, 0x3,  0x64, 0x56, 0xb9, 0xf8,
                   0x8c, 0xce, 0x84, 0xbe, 0xa5, 0xc3, 0x93, 0x80, 0x22, 0x10, 0x93, 0x21, 0x0,  0x61, 0x23,
                   0x3f, 0xee, 0xa1, 0x6b, 0xe2, 0x6c, 0xc6, 0x6d, 0x93, 0x2e, 0xe8, 0x88, 0x33, 0x3e, 0xde,
                   0x3e, 0x8a, 0xe1, 0x7b, 0xb0, 0x73, 0xe3, 0x21, 0xd9, 0x43, 0x1e, 0xd1, 0x5f};

  uint8_t buf[98] = {0};

  uint8_t topic_bytes[] = {0x50, 0x93, 0x95, 0xca, 0x67, 0xc8, 0x8c, 0x38, 0xfb};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa1, 0x6b, 0xe2, 0x6c, 0xc6, 0x6d, 0x93, 0x2e, 0xe8, 0x88, 0x33, 0x3e, 0xde,
                         0x3e, 0x8a, 0xe1, 0x7b, 0xb0, 0x73, 0xe3, 0x21, 0xd9, 0x43, 0x1e, 0xd1, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xea, 0xb,  0x20, 0xe3, 0x3b, 0x69, 0xce, 0x87,
                           0x82, 0xdc, 0x9e, 0x71, 0x7b, 0xd8, 0xa1, 0xf6};
  uint8_t bytesprops1[] = {0x3,  0x64, 0x56, 0xb9, 0xf8, 0x8c, 0xce, 0x84,
                           0xbe, 0xa5, 0xc3, 0x93, 0x80, 0x22, 0x10, 0x93};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 97}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16366}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\251\215\CAN[sS\SO<n\CAN2\177G\ACK\183\153\199\222\140`c\178@\151", _pubPktID = 0, _pubBody =
// "\165\168\138O\228N9et\191\199,\DEL\244$P\196\ACK\233rc", _pubProps = [PropRetainAvailable
// 201,PropRequestProblemInformation 62,PropRequestProblemInformation 171,PropReasonString
// "\224+/\160\219$\"\194o\128\SO\DC3Y\167B",PropSubscriptionIdentifier 31,PropAuthenticationMethod
// "\154g\227\176\&3\215]\152\EOT\v\221u",PropAuthenticationData
// "c\189\206\253s\146Tp\255\148\132\212\177~",PropAuthenticationData
// "\213\184\143\161\212h\207&\156\165\195!\204\250b\SYNz\214F",PropMessageExpiryInterval
// 4337,PropRequestResponseInformation 56,PropTopicAlias 3677,PropResponseInformation
// "\160\"J\146\252\239\209NpX\138\238\191\137",PropMessageExpiryInterval 15052,PropSessionExpiryInterval
// 32355,PropRequestResponseInformation 185,PropTopicAliasMaximum 16275,PropContentType
// "\188e\n\134",PropRequestProblemInformation 132,PropRequestResponseInformation 148,PropResponseTopic
// "y\182'CP>f75^!\161\178\EM\198Ir\ACK*\ETXO\202\255",PropMessageExpiryInterval 3225,PropRequestProblemInformation
// 186,PropSharedSubscriptionAvailable 215,PropRetainAvailable 131,PropResponseTopic
// "P\137\NAK\DC1\165v\243\148\DC29\219-\159\145\239 \NUL\174\254\157\&62\RS\250\144)\"\238$\226",PropCorrelationData
// "\197\146\f\170\ETX\151N\212^",PropRetainAvailable 42,PropSessionExpiryInterval 15247]}
TEST(Publish5QCTest, Encode72) {
  uint8_t pkt[] = {
      0x30, 0x8f, 0x2,  0x0,  0x18, 0xfb, 0xd7, 0x18, 0x5b, 0x73, 0x53, 0xe,  0x3c, 0x6e, 0x18, 0x32, 0xb1, 0x47, 0x6,
      0xb7, 0x99, 0xc7, 0xde, 0x8c, 0x60, 0x63, 0xb2, 0x40, 0x97, 0xde, 0x1,  0x25, 0xc9, 0x17, 0x3e, 0x17, 0xab, 0x1f,
      0x0,  0xf,  0xe0, 0x2b, 0x2f, 0xa0, 0xdb, 0x24, 0x22, 0xc2, 0x6f, 0x80, 0xe,  0x13, 0x59, 0xa7, 0x42, 0xb,  0x1f,
      0x15, 0x0,  0xc,  0x9a, 0x67, 0xe3, 0xb0, 0x33, 0xd7, 0x5d, 0x98, 0x4,  0xb,  0xdd, 0x75, 0x16, 0x0,  0xe,  0x63,
      0xbd, 0xce, 0xfd, 0x73, 0x92, 0x54, 0x70, 0xff, 0x94, 0x84, 0xd4, 0xb1, 0x7e, 0x16, 0x0,  0x13, 0xd5, 0xb8, 0x8f,
      0xa1, 0xd4, 0x68, 0xcf, 0x26, 0x9c, 0xa5, 0xc3, 0x21, 0xcc, 0xfa, 0x62, 0x16, 0x7a, 0xd6, 0x46, 0x2,  0x0,  0x0,
      0x10, 0xf1, 0x19, 0x38, 0x23, 0xe,  0x5d, 0x1a, 0x0,  0xe,  0xa0, 0x22, 0x4a, 0x92, 0xfc, 0xef, 0xd1, 0x4e, 0x70,
      0x58, 0x8a, 0xee, 0xbf, 0x89, 0x2,  0x0,  0x0,  0x3a, 0xcc, 0x11, 0x0,  0x0,  0x7e, 0x63, 0x19, 0xb9, 0x22, 0x3f,
      0x93, 0x3,  0x0,  0x4,  0xbc, 0x65, 0xa,  0x86, 0x17, 0x84, 0x19, 0x94, 0x8,  0x0,  0x17, 0x79, 0xb6, 0x27, 0x43,
      0x50, 0x3e, 0x66, 0x37, 0x35, 0x5e, 0x21, 0xa1, 0xb2, 0x19, 0xc6, 0x49, 0x72, 0x6,  0x2a, 0x3,  0x4f, 0xca, 0xff,
      0x2,  0x0,  0x0,  0xc,  0x99, 0x17, 0xba, 0x2a, 0xd7, 0x25, 0x83, 0x8,  0x0,  0x1e, 0x50, 0x89, 0x15, 0x11, 0xa5,
      0x76, 0xf3, 0x94, 0x12, 0x39, 0xdb, 0x2d, 0x9f, 0x91, 0xef, 0x20, 0x0,  0xae, 0xfe, 0x9d, 0x36, 0x32, 0x1e, 0xfa,
      0x90, 0x29, 0x22, 0xee, 0x24, 0xe2, 0x9,  0x0,  0x9,  0xc5, 0x92, 0xc,  0xaa, 0x3,  0x97, 0x4e, 0xd4, 0x5e, 0x25,
      0x2a, 0x11, 0x0,  0x0,  0x3b, 0x8f, 0xa5, 0xa8, 0x8a, 0x4f, 0xe4, 0x4e, 0x39, 0x65, 0x74, 0xbf, 0xc7, 0x2c, 0x7f,
      0xf4, 0x24, 0x50, 0xc4, 0x6,  0xe9, 0x72, 0x63};

  uint8_t buf[284] = {0};

  uint8_t topic_bytes[] = {0xfb, 0xd7, 0x18, 0x5b, 0x73, 0x53, 0xe,  0x3c, 0x6e, 0x18, 0x32, 0xb1,
                           0x47, 0x6,  0xb7, 0x99, 0xc7, 0xde, 0x8c, 0x60, 0x63, 0xb2, 0x40, 0x97};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0xa8, 0x8a, 0x4f, 0xe4, 0x4e, 0x39, 0x65, 0x74, 0xbf, 0xc7,
                         0x2c, 0x7f, 0xf4, 0x24, 0x50, 0xc4, 0x6,  0xe9, 0x72, 0x63};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xe0, 0x2b, 0x2f, 0xa0, 0xdb, 0x24, 0x22, 0xc2, 0x6f, 0x80, 0xe, 0x13, 0x59, 0xa7, 0x42};
  uint8_t bytesprops1[] = {0x9a, 0x67, 0xe3, 0xb0, 0x33, 0xd7, 0x5d, 0x98, 0x4, 0xb, 0xdd, 0x75};
  uint8_t bytesprops2[] = {0x63, 0xbd, 0xce, 0xfd, 0x73, 0x92, 0x54, 0x70, 0xff, 0x94, 0x84, 0xd4, 0xb1, 0x7e};
  uint8_t bytesprops3[] = {0xd5, 0xb8, 0x8f, 0xa1, 0xd4, 0x68, 0xcf, 0x26, 0x9c, 0xa5,
                           0xc3, 0x21, 0xcc, 0xfa, 0x62, 0x16, 0x7a, 0xd6, 0x46};
  uint8_t bytesprops4[] = {0xa0, 0x22, 0x4a, 0x92, 0xfc, 0xef, 0xd1, 0x4e, 0x70, 0x58, 0x8a, 0xee, 0xbf, 0x89};
  uint8_t bytesprops5[] = {0xbc, 0x65, 0xa, 0x86};
  uint8_t bytesprops6[] = {0x79, 0xb6, 0x27, 0x43, 0x50, 0x3e, 0x66, 0x37, 0x35, 0x5e, 0x21, 0xa1,
                           0xb2, 0x19, 0xc6, 0x49, 0x72, 0x6,  0x2a, 0x3,  0x4f, 0xca, 0xff};
  uint8_t bytesprops7[] = {0x50, 0x89, 0x15, 0x11, 0xa5, 0x76, 0xf3, 0x94, 0x12, 0x39, 0xdb, 0x2d, 0x9f, 0x91, 0xef,
                           0x20, 0x0,  0xae, 0xfe, 0x9d, 0x36, 0x32, 0x1e, 0xfa, 0x90, 0x29, 0x22, 0xee, 0x24, 0xe2};
  uint8_t bytesprops8[] = {0xc5, 0x92, 0xc, 0xaa, 0x3, 0x97, 0x4e, 0xd4, 0x5e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4337}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3677}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15052}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32355}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16275}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3225}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15247}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29047, _pubBody =
// "l-\198\144%\200:}\215\167\168\213&!\132`\221\FSl\\\157?@-\132&\136", _pubProps = [PropSharedSubscriptionAvailable
// 251,PropTopicAliasMaximum 28572]}
TEST(Publish5QCTest, Encode73) {
  uint8_t pkt[] = {0x3c, 0x25, 0x0,  0x0,  0x71, 0x77, 0x5,  0x2a, 0xfb, 0x22, 0x6f, 0x9c, 0x6c,
                   0x2d, 0xc6, 0x90, 0x25, 0xc8, 0x3a, 0x7d, 0xd7, 0xa7, 0xa8, 0xd5, 0x26, 0x21,
                   0x84, 0x60, 0xdd, 0x1c, 0x6c, 0x5c, 0x9d, 0x3f, 0x40, 0x2d, 0x84, 0x26, 0x88};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6c, 0x2d, 0xc6, 0x90, 0x25, 0xc8, 0x3a, 0x7d, 0xd7, 0xa7, 0xa8, 0xd5, 0x26, 0x21,
                         0x84, 0x60, 0xdd, 0x1c, 0x6c, 0x5c, 0x9d, 0x3f, 0x40, 0x2d, 0x84, 0x26, 0x88};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28572}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29047, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E\209", _pubPktID = 7404, _pubBody
// = "\235\ETX\185\192\212\183\ACK\\+\188\165\230>\\U", _pubProps = [PropMaximumPacketSize
// 18479,PropAuthenticationMethod
// "O\166\166e\146\135mG+\NAK\SUB\247\190\242\FS\180X&J\250)\SI\a=\249",PropServerKeepAlive 28420,PropReceiveMaximum
// 1572,PropAuthenticationMethod "\150\DC4ior`r\248m",PropPayloadFormatIndicator 10,PropMaximumPacketSize
// 17799,PropPayloadFormatIndicator 90,PropRequestProblemInformation 236,PropRetainAvailable
// 72,PropPayloadFormatIndicator 83,PropSessionExpiryInterval 12274,PropSubscriptionIdentifierAvailable 121]}
TEST(Publish5QCTest, Encode74) {
  uint8_t pkt[] = {0x32, 0x5f, 0x0,  0x2,  0x45, 0xd1, 0x1c, 0xec, 0x49, 0x27, 0x0,  0x0,  0x48, 0x2f, 0x15, 0x0,  0x19,
                   0x4f, 0xa6, 0xa6, 0x65, 0x92, 0x87, 0x6d, 0x47, 0x2b, 0x15, 0x1a, 0xf7, 0xbe, 0xf2, 0x1c, 0xb4, 0x58,
                   0x26, 0x4a, 0xfa, 0x29, 0xf,  0x7,  0x3d, 0xf9, 0x13, 0x6f, 0x4,  0x21, 0x6,  0x24, 0x15, 0x0,  0x9,
                   0x96, 0x14, 0x69, 0x6f, 0x72, 0x60, 0x72, 0xf8, 0x6d, 0x1,  0xa,  0x27, 0x0,  0x0,  0x45, 0x87, 0x1,
                   0x5a, 0x17, 0xec, 0x25, 0x48, 0x1,  0x53, 0x11, 0x0,  0x0,  0x2f, 0xf2, 0x29, 0x79, 0xeb, 0x3,  0xb9,
                   0xc0, 0xd4, 0xb7, 0x6,  0x5c, 0x2b, 0xbc, 0xa5, 0xe6, 0x3e, 0x5c, 0x55};

  uint8_t buf[107] = {0};

  uint8_t topic_bytes[] = {0x45, 0xd1};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xeb, 0x3, 0xb9, 0xc0, 0xd4, 0xb7, 0x6, 0x5c, 0x2b, 0xbc, 0xa5, 0xe6, 0x3e, 0x5c, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x4f, 0xa6, 0xa6, 0x65, 0x92, 0x87, 0x6d, 0x47, 0x2b, 0x15, 0x1a, 0xf7, 0xbe,
                           0xf2, 0x1c, 0xb4, 0x58, 0x26, 0x4a, 0xfa, 0x29, 0xf,  0x7,  0x3d, 0xf9};
  uint8_t bytesprops1[] = {0x96, 0x14, 0x69, 0x6f, 0x72, 0x60, 0x72, 0xf8, 0x6d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18479}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28420}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1572}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17799}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12274}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7404, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\198\225\DC4\245\&5\248\178f[\186\216.\218\247", _pubPktID = 16102, _pubBody = "\213@o\181\227\224\214\214UA",
// _pubProps = [PropMaximumQoS 70,PropServerReference "F\230yxn{S\217\FS\250\193\172\225f\SYN\158"]}
TEST(Publish5QCTest, Encode75) {
  uint8_t pkt[] = {0x32, 0x32, 0x0,  0xe,  0xc6, 0xe1, 0x14, 0xf5, 0x35, 0xf8, 0xb2, 0x66, 0x5b,
                   0xba, 0xd8, 0x2e, 0xda, 0xf7, 0x3e, 0xe6, 0x15, 0x24, 0x46, 0x1c, 0x0,  0x10,
                   0x46, 0xe6, 0x79, 0x78, 0x6e, 0x7b, 0x53, 0xd9, 0x1c, 0xfa, 0xc1, 0xac, 0xe1,
                   0x66, 0x16, 0x9e, 0xd5, 0x40, 0x6f, 0xb5, 0xe3, 0xe0, 0xd6, 0xd6, 0x55, 0x41};

  uint8_t buf[62] = {0};

  uint8_t topic_bytes[] = {0xc6, 0xe1, 0x14, 0xf5, 0x35, 0xf8, 0xb2, 0x66, 0x5b, 0xba, 0xd8, 0x2e, 0xda, 0xf7};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd5, 0x40, 0x6f, 0xb5, 0xe3, 0xe0, 0xd6, 0xd6, 0x55, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x46, 0xe6, 0x79, 0x78, 0x6e, 0x7b, 0x53, 0xd9,
                           0x1c, 0xfa, 0xc1, 0xac, 0xe1, 0x66, 0x16, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16102, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 19098, _pubBody =
// "\216\241'G\183\&2\SO\NAK\254\130\&1\161\176A=\131x\SUB\190", _pubProps = [PropWildcardSubscriptionAvailable
// 221,PropSharedSubscriptionAvailable 221,PropReceiveMaximum 23497,PropSessionExpiryInterval 18379,PropTopicAlias
// 21052,PropWildcardSubscriptionAvailable 53,PropResponseTopic
// "\232\203\230\130T\137t\149Y\153\204\STX\148",PropSessionExpiryInterval 27272,PropRequestResponseInformation
// 206,PropWillDelayInterval 31,PropAuthenticationData
// "@\199\n7]\241\t\ESC\159\159\230k]\206#\232I\129Gs",PropRequestResponseInformation 120,PropResponseTopic
// "^\142\168r\238\161p\161\255\185\ESC\USd\182\&4\213",PropSubscriptionIdentifier 9]}
TEST(Publish5QCTest, Encode76) {
  uint8_t pkt[] = {0x3b, 0x73, 0x0,  0x0,  0x4a, 0x9a, 0x5b, 0x28, 0xdd, 0x2a, 0xdd, 0x21, 0x5b, 0xc9, 0x11, 0x0,  0x0,
                   0x47, 0xcb, 0x23, 0x52, 0x3c, 0x28, 0x35, 0x8,  0x0,  0xd,  0xe8, 0xcb, 0xe6, 0x82, 0x54, 0x89, 0x74,
                   0x95, 0x59, 0x99, 0xcc, 0x2,  0x94, 0x11, 0x0,  0x0,  0x6a, 0x88, 0x19, 0xce, 0x18, 0x0,  0x0,  0x0,
                   0x1f, 0x16, 0x0,  0x14, 0x40, 0xc7, 0xa,  0x37, 0x5d, 0xf1, 0x9,  0x1b, 0x9f, 0x9f, 0xe6, 0x6b, 0x5d,
                   0xce, 0x23, 0xe8, 0x49, 0x81, 0x47, 0x73, 0x19, 0x78, 0x8,  0x0,  0x10, 0x5e, 0x8e, 0xa8, 0x72, 0xee,
                   0xa1, 0x70, 0xa1, 0xff, 0xb9, 0x1b, 0x1f, 0x64, 0xb6, 0x34, 0xd5, 0xb,  0x9,  0xd8, 0xf1, 0x27, 0x47,
                   0xb7, 0x32, 0xe,  0x15, 0xfe, 0x82, 0x31, 0xa1, 0xb0, 0x41, 0x3d, 0x83, 0x78, 0x1a, 0xbe};

  uint8_t buf[127] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0xf1, 0x27, 0x47, 0xb7, 0x32, 0xe,  0x15, 0xfe, 0x82,
                         0x31, 0xa1, 0xb0, 0x41, 0x3d, 0x83, 0x78, 0x1a, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xe8, 0xcb, 0xe6, 0x82, 0x54, 0x89, 0x74, 0x95, 0x59, 0x99, 0xcc, 0x2, 0x94};
  uint8_t bytesprops1[] = {0x40, 0xc7, 0xa,  0x37, 0x5d, 0xf1, 0x9,  0x1b, 0x9f, 0x9f,
                           0xe6, 0x6b, 0x5d, 0xce, 0x23, 0xe8, 0x49, 0x81, 0x47, 0x73};
  uint8_t bytesprops2[] = {0x5e, 0x8e, 0xa8, 0x72, 0xee, 0xa1, 0x70, 0xa1,
                           0xff, 0xb9, 0x1b, 0x1f, 0x64, 0xb6, 0x34, 0xd5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23497}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18379}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21052}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27272}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 19098, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "'\243\208\&5\245\172=e^\165",
// _pubPktID = 6458, _pubBody = "\222#/ q\128\&4\174k'\135\SI:O\193\DC4\153[", _pubProps =
// [PropRequestResponseInformation 83,PropWillDelayInterval 25748,PropSharedSubscriptionAvailable
// 74,PropSessionExpiryInterval 11787,PropWildcardSubscriptionAvailable 45,PropSessionExpiryInterval
// 19470,PropTopicAliasMaximum 8721,PropSubscriptionIdentifier 19,PropServerKeepAlive 18440,PropRetainAvailable
// 171,PropSessionExpiryInterval 10776,PropAuthenticationMethod "\138",PropRetainAvailable 45,PropReceiveMaximum
// 31306,PropResponseTopic ";t\NUL\182\143\NUL\131+P",PropServerKeepAlive 26319,PropWillDelayInterval
// 31656,PropAuthenticationData "\159\189\DC4\142\220\169\173\246\135\206\227Q\245\197|",PropMaximumPacketSize
// 7616,PropMessageExpiryInterval 15526,PropSessionExpiryInterval 12963,PropRequestResponseInformation 185]}
TEST(Publish5QCTest, Encode77) {
  uint8_t pkt[] = {0x33, 0x85, 0x1,  0x0,  0xa,  0x27, 0xf3, 0xd0, 0x35, 0xf5, 0xac, 0x3d, 0x65, 0x5e, 0xa5, 0x19,
                   0x3a, 0x64, 0x19, 0x53, 0x18, 0x0,  0x0,  0x64, 0x94, 0x2a, 0x4a, 0x11, 0x0,  0x0,  0x2e, 0xb,
                   0x28, 0x2d, 0x11, 0x0,  0x0,  0x4c, 0xe,  0x22, 0x22, 0x11, 0xb,  0x13, 0x13, 0x48, 0x8,  0x25,
                   0xab, 0x11, 0x0,  0x0,  0x2a, 0x18, 0x15, 0x0,  0x1,  0x8a, 0x25, 0x2d, 0x21, 0x7a, 0x4a, 0x8,
                   0x0,  0x9,  0x3b, 0x74, 0x0,  0xb6, 0x8f, 0x0,  0x83, 0x2b, 0x50, 0x13, 0x66, 0xcf, 0x18, 0x0,
                   0x0,  0x7b, 0xa8, 0x16, 0x0,  0xf,  0x9f, 0xbd, 0x14, 0x8e, 0xdc, 0xa9, 0xad, 0xf6, 0x87, 0xce,
                   0xe3, 0x51, 0xf5, 0xc5, 0x7c, 0x27, 0x0,  0x0,  0x1d, 0xc0, 0x2,  0x0,  0x0,  0x3c, 0xa6, 0x11,
                   0x0,  0x0,  0x32, 0xa3, 0x19, 0xb9, 0xde, 0x23, 0x2f, 0x20, 0x71, 0x80, 0x34, 0xae, 0x6b, 0x27,
                   0x87, 0xf,  0x3a, 0x4f, 0xc1, 0x14, 0x99, 0x5b};

  uint8_t buf[146] = {0};

  uint8_t topic_bytes[] = {0x27, 0xf3, 0xd0, 0x35, 0xf5, 0xac, 0x3d, 0x65, 0x5e, 0xa5};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xde, 0x23, 0x2f, 0x20, 0x71, 0x80, 0x34, 0xae, 0x6b,
                         0x27, 0x87, 0xf,  0x3a, 0x4f, 0xc1, 0x14, 0x99, 0x5b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0x8a};
  uint8_t bytesprops1[] = {0x3b, 0x74, 0x0, 0xb6, 0x8f, 0x0, 0x83, 0x2b, 0x50};
  uint8_t bytesprops2[] = {0x9f, 0xbd, 0x14, 0x8e, 0xdc, 0xa9, 0xad, 0xf6, 0x87, 0xce, 0xe3, 0x51, 0xf5, 0xc5, 0x7c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25748}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11787}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19470}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8721}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18440}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10776}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31306}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26319}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31656}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7616}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15526}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12963}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 185}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 6458, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "I\168PH\213\245]<\203\142\255\147\"\251", _pubPktID = 23705, _pubBody =
// "\136\177\214\217\&8;\253\STX\147\206\151\161\183?\r\SUB\151\230c\DLE5h\249\177\236", _pubProps =
// [PropMaximumPacketSize 12446,PropPayloadFormatIndicator 141,PropMaximumPacketSize 17105,PropMessageExpiryInterval
// 25409,PropPayloadFormatIndicator 219,PropPayloadFormatIndicator 187,PropWillDelayInterval
// 2545,PropAssignedClientIdentifier "\fA\150\166\183\170\SYN",PropMaximumQoS 249,PropMessageExpiryInterval
// 27889,PropContentType "\254\248[\251Z\ACK\171\136@z]\250\240\149\161\GS\176\SUBjM\176\183",PropResponseInformation
// "\222\f\255\239\209\159\171=v$\174\t_r\190\ACK\150u\139\198\193\225\162Qm",PropSessionExpiryInterval
// 18095,PropUserProperty "~q\143z\SI\248k\DC4\149"
// "H\237\247q]1r\f\160\142\150\149g6\246\DC4\203\190\DC3\176\209",PropSubscriptionIdentifier
// 15,PropRequestResponseInformation 74,PropSessionExpiryInterval 5607,PropRetainAvailable
// 195,PropSharedSubscriptionAvailable 217,PropContentType "\146\204\243\219\177",PropMessageExpiryInterval
// 12779,PropReasonString "f\181\t\190\137\152\128\172\226l\132\215\252q",PropServerKeepAlive
// 9876,PropSharedSubscriptionAvailable 170,PropRetainAvailable 140,PropSharedSubscriptionAvailable 79]}
TEST(Publish5QCTest, Encode78) {
  uint8_t pkt[] = {0x33, 0xe9, 0x1,  0x0,  0xe,  0x49, 0xa8, 0x50, 0x48, 0xd5, 0xf5, 0x5d, 0x3c, 0xcb, 0x8e, 0xff, 0x93,
                   0x22, 0xfb, 0x5c, 0x99, 0xbc, 0x1,  0x27, 0x0,  0x0,  0x30, 0x9e, 0x1,  0x8d, 0x27, 0x0,  0x0,  0x42,
                   0xd1, 0x2,  0x0,  0x0,  0x63, 0x41, 0x1,  0xdb, 0x1,  0xbb, 0x18, 0x0,  0x0,  0x9,  0xf1, 0x12, 0x0,
                   0x7,  0xc,  0x41, 0x96, 0xa6, 0xb7, 0xaa, 0x16, 0x24, 0xf9, 0x2,  0x0,  0x0,  0x6c, 0xf1, 0x3,  0x0,
                   0x16, 0xfe, 0xf8, 0x5b, 0xfb, 0x5a, 0x6,  0xab, 0x88, 0x40, 0x7a, 0x5d, 0xfa, 0xf0, 0x95, 0xa1, 0x1d,
                   0xb0, 0x1a, 0x6a, 0x4d, 0xb0, 0xb7, 0x1a, 0x0,  0x19, 0xde, 0xc,  0xff, 0xef, 0xd1, 0x9f, 0xab, 0x3d,
                   0x76, 0x24, 0xae, 0x9,  0x5f, 0x72, 0xbe, 0x6,  0x96, 0x75, 0x8b, 0xc6, 0xc1, 0xe1, 0xa2, 0x51, 0x6d,
                   0x11, 0x0,  0x0,  0x46, 0xaf, 0x26, 0x0,  0x9,  0x7e, 0x71, 0x8f, 0x7a, 0xf,  0xf8, 0x6b, 0x14, 0x95,
                   0x0,  0x15, 0x48, 0xed, 0xf7, 0x71, 0x5d, 0x31, 0x72, 0xc,  0xa0, 0x8e, 0x96, 0x95, 0x67, 0x36, 0xf6,
                   0x14, 0xcb, 0xbe, 0x13, 0xb0, 0xd1, 0xb,  0xf,  0x19, 0x4a, 0x11, 0x0,  0x0,  0x15, 0xe7, 0x25, 0xc3,
                   0x2a, 0xd9, 0x3,  0x0,  0x5,  0x92, 0xcc, 0xf3, 0xdb, 0xb1, 0x2,  0x0,  0x0,  0x31, 0xeb, 0x1f, 0x0,
                   0xe,  0x66, 0xb5, 0x9,  0xbe, 0x89, 0x98, 0x80, 0xac, 0xe2, 0x6c, 0x84, 0xd7, 0xfc, 0x71, 0x13, 0x26,
                   0x94, 0x2a, 0xaa, 0x25, 0x8c, 0x2a, 0x4f, 0x88, 0xb1, 0xd6, 0xd9, 0x38, 0x3b, 0xfd, 0x2,  0x93, 0xce,
                   0x97, 0xa1, 0xb7, 0x3f, 0xd,  0x1a, 0x97, 0xe6, 0x63, 0x10, 0x35, 0x68, 0xf9, 0xb1, 0xec};

  uint8_t buf[246] = {0};

  uint8_t topic_bytes[] = {0x49, 0xa8, 0x50, 0x48, 0xd5, 0xf5, 0x5d, 0x3c, 0xcb, 0x8e, 0xff, 0x93, 0x22, 0xfb};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x88, 0xb1, 0xd6, 0xd9, 0x38, 0x3b, 0xfd, 0x2,  0x93, 0xce, 0x97, 0xa1, 0xb7,
                         0x3f, 0xd,  0x1a, 0x97, 0xe6, 0x63, 0x10, 0x35, 0x68, 0xf9, 0xb1, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops0[] = {0xc, 0x41, 0x96, 0xa6, 0xb7, 0xaa, 0x16};
  uint8_t bytesprops1[] = {0xfe, 0xf8, 0x5b, 0xfb, 0x5a, 0x6,  0xab, 0x88, 0x40, 0x7a, 0x5d,
                           0xfa, 0xf0, 0x95, 0xa1, 0x1d, 0xb0, 0x1a, 0x6a, 0x4d, 0xb0, 0xb7};
  uint8_t bytesprops2[] = {0xde, 0xc,  0xff, 0xef, 0xd1, 0x9f, 0xab, 0x3d, 0x76, 0x24, 0xae, 0x9, 0x5f,
                           0x72, 0xbe, 0x6,  0x96, 0x75, 0x8b, 0xc6, 0xc1, 0xe1, 0xa2, 0x51, 0x6d};
  uint8_t bytesprops4[] = {0x48, 0xed, 0xf7, 0x71, 0x5d, 0x31, 0x72, 0xc,  0xa0, 0x8e, 0x96,
                           0x95, 0x67, 0x36, 0xf6, 0x14, 0xcb, 0xbe, 0x13, 0xb0, 0xd1};
  uint8_t bytesprops3[] = {0x7e, 0x71, 0x8f, 0x7a, 0xf, 0xf8, 0x6b, 0x14, 0x95};
  uint8_t bytesprops5[] = {0x92, 0xcc, 0xf3, 0xdb, 0xb1};
  uint8_t bytesprops6[] = {0x66, 0xb5, 0x9, 0xbe, 0x89, 0x98, 0x80, 0xac, 0xe2, 0x6c, 0x84, 0xd7, 0xfc, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12446}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17105}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25409}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2545}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27889}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18095}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops3}, .v = {21, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5607}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12779}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9876}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 23705, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(cp\130q\251\181\SUB\133\251\228jBh\139\191\SOH\192\213\219Q1", _pubPktID = 14770, _pubBody =
// "\155j|4h\141\198\RS\162\240\168]\208C", _pubProps = [PropServerReference
// "\249\133\222O\138\161\&1\255\f\205\134\250\254\191"]}
TEST(Publish5QCTest, Encode79) {
  uint8_t pkt[] = {0x3a, 0x3a, 0x0,  0x16, 0x28, 0x63, 0x70, 0x82, 0x71, 0xfb, 0xb5, 0x1a, 0x85, 0xfb, 0xe4,
                   0x6a, 0x42, 0x68, 0x8b, 0xbf, 0x1,  0xc0, 0xd5, 0xdb, 0x51, 0x31, 0x39, 0xb2, 0x11, 0x1c,
                   0x0,  0xe,  0xf9, 0x85, 0xde, 0x4f, 0x8a, 0xa1, 0x31, 0xff, 0xc,  0xcd, 0x86, 0xfa, 0xfe,
                   0xbf, 0x9b, 0x6a, 0x7c, 0x34, 0x68, 0x8d, 0xc6, 0x1e, 0xa2, 0xf0, 0xa8, 0x5d, 0xd0, 0x43};

  uint8_t buf[70] = {0};

  uint8_t topic_bytes[] = {0x28, 0x63, 0x70, 0x82, 0x71, 0xfb, 0xb5, 0x1a, 0x85, 0xfb, 0xe4,
                           0x6a, 0x42, 0x68, 0x8b, 0xbf, 0x1,  0xc0, 0xd5, 0xdb, 0x51, 0x31};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9b, 0x6a, 0x7c, 0x34, 0x68, 0x8d, 0xc6, 0x1e, 0xa2, 0xf0, 0xa8, 0x5d, 0xd0, 0x43};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xf9, 0x85, 0xde, 0x4f, 0x8a, 0xa1, 0x31, 0xff, 0xc, 0xcd, 0x86, 0xfa, 0xfe, 0xbf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 14770, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "4\USH\SYN\210z\160\141\155\238\230\171\a\233\243\192t", _pubPktID = 24524, _pubBody =
// "%\173_\207\173p\210\131\129\ESC\231\SOH\143\255\163\&4\182?LS", _pubProps = [PropCorrelationData
// "\172\&8\220\180\205\ETX\181\228\&0\DEL:_\135\211\163K\191\174\252\142\139\ENQ\185\192\181y\ETXo!",PropSubscriptionIdentifier
// 5,PropAssignedClientIdentifier
// "vc\194\156h\DC4\131]\SOH+\128uX\133S\251V\220\170\132\141:\RS\DC1~{P\SOH\142",PropWillDelayInterval
// 22759,PropRetainAvailable 19,PropWillDelayInterval 9648,PropAuthenticationData
// "\158\US\170\131\158\238\172",PropAuthenticationMethod "\228B\221\t\"\222Wk\186\189\&20",PropMessageExpiryInterval
// 21169,PropMessageExpiryInterval 20864,PropResponseInformation
// "\223\206$\bO?}\142\&7\251\167\n\234\FS\140\138\SOH^\NAKO",PropMessageExpiryInterval
// 25217,PropRequestProblemInformation 19,PropTopicAlias 22170,PropRequestResponseInformation 205,PropMaximumQoS
// 211,PropAuthenticationData "\232\217x\ETX\DLE\230B~",PropServerKeepAlive 4487,PropSessionExpiryInterval
// 17004,PropAssignedClientIdentifier ""]}
TEST(Publish5QCTest, Encode80) {
  uint8_t pkt[] = {0x3a, 0xd7, 0x1,  0x0,  0x11, 0x34, 0x1f, 0x48, 0x16, 0xd2, 0x7a, 0xa0, 0x8d, 0x9b, 0xee, 0xe6, 0xab,
                   0x7,  0xe9, 0xf3, 0xc0, 0x74, 0x5f, 0xcc, 0xac, 0x1,  0x9,  0x0,  0x1d, 0xac, 0x38, 0xdc, 0xb4, 0xcd,
                   0x3,  0xb5, 0xe4, 0x30, 0x7f, 0x3a, 0x5f, 0x87, 0xd3, 0xa3, 0x4b, 0xbf, 0xae, 0xfc, 0x8e, 0x8b, 0x5,
                   0xb9, 0xc0, 0xb5, 0x79, 0x3,  0x6f, 0x21, 0xb,  0x5,  0x12, 0x0,  0x1d, 0x76, 0x63, 0xc2, 0x9c, 0x68,
                   0x14, 0x83, 0x5d, 0x1,  0x2b, 0x80, 0x75, 0x58, 0x85, 0x53, 0xfb, 0x56, 0xdc, 0xaa, 0x84, 0x8d, 0x3a,
                   0x1e, 0x11, 0x7e, 0x7b, 0x50, 0x1,  0x8e, 0x18, 0x0,  0x0,  0x58, 0xe7, 0x25, 0x13, 0x18, 0x0,  0x0,
                   0x25, 0xb0, 0x16, 0x0,  0x7,  0x9e, 0x1f, 0xaa, 0x83, 0x9e, 0xee, 0xac, 0x15, 0x0,  0xc,  0xe4, 0x42,
                   0xdd, 0x9,  0x22, 0xde, 0x57, 0x6b, 0xba, 0xbd, 0x32, 0x30, 0x2,  0x0,  0x0,  0x52, 0xb1, 0x2,  0x0,
                   0x0,  0x51, 0x80, 0x1a, 0x0,  0x14, 0xdf, 0xce, 0x24, 0x8,  0x4f, 0x3f, 0x7d, 0x8e, 0x37, 0xfb, 0xa7,
                   0xa,  0xea, 0x1c, 0x8c, 0x8a, 0x1,  0x5e, 0x15, 0x4f, 0x2,  0x0,  0x0,  0x62, 0x81, 0x17, 0x13, 0x23,
                   0x56, 0x9a, 0x19, 0xcd, 0x24, 0xd3, 0x16, 0x0,  0x8,  0xe8, 0xd9, 0x78, 0x3,  0x10, 0xe6, 0x42, 0x7e,
                   0x13, 0x11, 0x87, 0x11, 0x0,  0x0,  0x42, 0x6c, 0x12, 0x0,  0x0,  0x25, 0xad, 0x5f, 0xcf, 0xad, 0x70,
                   0xd2, 0x83, 0x81, 0x1b, 0xe7, 0x1,  0x8f, 0xff, 0xa3, 0x34, 0xb6, 0x3f, 0x4c, 0x53};

  uint8_t buf[228] = {0};

  uint8_t topic_bytes[] = {0x34, 0x1f, 0x48, 0x16, 0xd2, 0x7a, 0xa0, 0x8d, 0x9b,
                           0xee, 0xe6, 0xab, 0x7,  0xe9, 0xf3, 0xc0, 0x74};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0xad, 0x5f, 0xcf, 0xad, 0x70, 0xd2, 0x83, 0x81, 0x1b,
                         0xe7, 0x1,  0x8f, 0xff, 0xa3, 0x34, 0xb6, 0x3f, 0x4c, 0x53};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0xac, 0x38, 0xdc, 0xb4, 0xcd, 0x3,  0xb5, 0xe4, 0x30, 0x7f, 0x3a, 0x5f, 0x87, 0xd3, 0xa3,
                           0x4b, 0xbf, 0xae, 0xfc, 0x8e, 0x8b, 0x5,  0xb9, 0xc0, 0xb5, 0x79, 0x3,  0x6f, 0x21};
  uint8_t bytesprops1[] = {0x76, 0x63, 0xc2, 0x9c, 0x68, 0x14, 0x83, 0x5d, 0x1,  0x2b, 0x80, 0x75, 0x58, 0x85, 0x53,
                           0xfb, 0x56, 0xdc, 0xaa, 0x84, 0x8d, 0x3a, 0x1e, 0x11, 0x7e, 0x7b, 0x50, 0x1,  0x8e};
  uint8_t bytesprops2[] = {0x9e, 0x1f, 0xaa, 0x83, 0x9e, 0xee, 0xac};
  uint8_t bytesprops3[] = {0xe4, 0x42, 0xdd, 0x9, 0x22, 0xde, 0x57, 0x6b, 0xba, 0xbd, 0x32, 0x30};
  uint8_t bytesprops4[] = {0xdf, 0xce, 0x24, 0x8,  0x4f, 0x3f, 0x7d, 0x8e, 0x37, 0xfb,
                           0xa7, 0xa,  0xea, 0x1c, 0x8c, 0x8a, 0x1,  0x5e, 0x15, 0x4f};
  uint8_t bytesprops5[] = {0xe8, 0xd9, 0x78, 0x3, 0x10, 0xe6, 0x42, 0x7e};
  uint8_t bytesprops6[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22759}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9648}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21169}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20864}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25217}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22170}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4487}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17004}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 24524, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\214u\192\231\177\&7\SYN\253\141i\217\&0\158", _pubPktID = 0, _pubBody =
// "\169\SI\241H\190p\151Qw\209\217/\163\156\&5", _pubProps = [PropSubscriptionIdentifier
// 21,PropWildcardSubscriptionAvailable 137,PropCorrelationData "PZXh\248\181\246\177j-\EM",PropAuthenticationMethod
// "\185\170\217",PropRequestResponseInformation 181,PropTopicAliasMaximum 16439,PropAuthenticationMethod
// "+\208\209X\155[b\255\157<,N",PropMaximumPacketSize 2703,PropTopicAliasMaximum 12373,PropUserProperty
// "\175,\192kC\221\220\&6\251co.\177\154\166\132\225k\248=n\150\229S\241\183\198\a"
// "\NAKC\232\185\187\244\DC43t\232\210Z\236\240\ESC\199",PropSharedSubscriptionAvailable 84,PropAuthenticationData
// "\157H(\211,\248\171\202\207\NUL\187\242\SI",PropAssignedClientIdentifier "\GS\221\156",PropMessageExpiryInterval
// 20204,PropContentType "`\138\aF\r\\\184I:c\144M\221x4\226\161J\139\&4\DC4\157",PropRequestProblemInformation
// 35,PropReasonString "/t\233\ENQ\198Z \197\200\218h\197\146\147M\DC1\220|dN\195\SYNG",PropTopicAliasMaximum
// 32647,PropResponseInformation
// "\151\\;Jx\150\255\225\252\132\145\187n\206\&7\STXl\172\196[\204\180",PropSubscriptionIdentifier
// 21,PropCorrelationData "51\167\168 \218"]}
TEST(Publish5QCTest, Encode81) {
  uint8_t pkt[] = {
      0x39, 0xfe, 0x1,  0x0,  0xd,  0xd6, 0x75, 0xc0, 0xe7, 0xb1, 0x37, 0x16, 0xfd, 0x8d, 0x69, 0xd9, 0x30, 0x9e, 0xde,
      0x1,  0xb,  0x15, 0x28, 0x89, 0x9,  0x0,  0xb,  0x50, 0x5a, 0x58, 0x68, 0xf8, 0xb5, 0xf6, 0xb1, 0x6a, 0x2d, 0x19,
      0x15, 0x0,  0x3,  0xb9, 0xaa, 0xd9, 0x19, 0xb5, 0x22, 0x40, 0x37, 0x15, 0x0,  0xc,  0x2b, 0xd0, 0xd1, 0x58, 0x9b,
      0x5b, 0x62, 0xff, 0x9d, 0x3c, 0x2c, 0x4e, 0x27, 0x0,  0x0,  0xa,  0x8f, 0x22, 0x30, 0x55, 0x26, 0x0,  0x1c, 0xaf,
      0x2c, 0xc0, 0x6b, 0x43, 0xdd, 0xdc, 0x36, 0xfb, 0x63, 0x6f, 0x2e, 0xb1, 0x9a, 0xa6, 0x84, 0xe1, 0x6b, 0xf8, 0x3d,
      0x6e, 0x96, 0xe5, 0x53, 0xf1, 0xb7, 0xc6, 0x7,  0x0,  0x10, 0x15, 0x43, 0xe8, 0xb9, 0xbb, 0xf4, 0x14, 0x33, 0x74,
      0xe8, 0xd2, 0x5a, 0xec, 0xf0, 0x1b, 0xc7, 0x2a, 0x54, 0x16, 0x0,  0xd,  0x9d, 0x48, 0x28, 0xd3, 0x2c, 0xf8, 0xab,
      0xca, 0xcf, 0x0,  0xbb, 0xf2, 0xf,  0x12, 0x0,  0x3,  0x1d, 0xdd, 0x9c, 0x2,  0x0,  0x0,  0x4e, 0xec, 0x3,  0x0,
      0x16, 0x60, 0x8a, 0x7,  0x46, 0xd,  0x5c, 0xb8, 0x49, 0x3a, 0x63, 0x90, 0x4d, 0xdd, 0x78, 0x34, 0xe2, 0xa1, 0x4a,
      0x8b, 0x34, 0x14, 0x9d, 0x17, 0x23, 0x1f, 0x0,  0x17, 0x2f, 0x74, 0xe9, 0x5,  0xc6, 0x5a, 0x20, 0xc5, 0xc8, 0xda,
      0x68, 0xc5, 0x92, 0x93, 0x4d, 0x11, 0xdc, 0x7c, 0x64, 0x4e, 0xc3, 0x16, 0x47, 0x22, 0x7f, 0x87, 0x1a, 0x0,  0x16,
      0x97, 0x5c, 0x3b, 0x4a, 0x78, 0x96, 0xff, 0xe1, 0xfc, 0x84, 0x91, 0xbb, 0x6e, 0xce, 0x37, 0x2,  0x6c, 0xac, 0xc4,
      0x5b, 0xcc, 0xb4, 0xb,  0x15, 0x9,  0x0,  0x6,  0x35, 0x31, 0xa7, 0xa8, 0x20, 0xda, 0xa9, 0xf,  0xf1, 0x48, 0xbe,
      0x70, 0x97, 0x51, 0x77, 0xd1, 0xd9, 0x2f, 0xa3, 0x9c, 0x35};

  uint8_t buf[267] = {0};

  uint8_t topic_bytes[] = {0xd6, 0x75, 0xc0, 0xe7, 0xb1, 0x37, 0x16, 0xfd, 0x8d, 0x69, 0xd9, 0x30, 0x9e};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xf, 0xf1, 0x48, 0xbe, 0x70, 0x97, 0x51, 0x77, 0xd1, 0xd9, 0x2f, 0xa3, 0x9c, 0x35};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x50, 0x5a, 0x58, 0x68, 0xf8, 0xb5, 0xf6, 0xb1, 0x6a, 0x2d, 0x19};
  uint8_t bytesprops1[] = {0xb9, 0xaa, 0xd9};
  uint8_t bytesprops2[] = {0x2b, 0xd0, 0xd1, 0x58, 0x9b, 0x5b, 0x62, 0xff, 0x9d, 0x3c, 0x2c, 0x4e};
  uint8_t bytesprops4[] = {0x15, 0x43, 0xe8, 0xb9, 0xbb, 0xf4, 0x14, 0x33,
                           0x74, 0xe8, 0xd2, 0x5a, 0xec, 0xf0, 0x1b, 0xc7};
  uint8_t bytesprops3[] = {0xaf, 0x2c, 0xc0, 0x6b, 0x43, 0xdd, 0xdc, 0x36, 0xfb, 0x63, 0x6f, 0x2e, 0xb1, 0x9a,
                           0xa6, 0x84, 0xe1, 0x6b, 0xf8, 0x3d, 0x6e, 0x96, 0xe5, 0x53, 0xf1, 0xb7, 0xc6, 0x7};
  uint8_t bytesprops5[] = {0x9d, 0x48, 0x28, 0xd3, 0x2c, 0xf8, 0xab, 0xca, 0xcf, 0x0, 0xbb, 0xf2, 0xf};
  uint8_t bytesprops6[] = {0x1d, 0xdd, 0x9c};
  uint8_t bytesprops7[] = {0x60, 0x8a, 0x7,  0x46, 0xd,  0x5c, 0xb8, 0x49, 0x3a, 0x63, 0x90,
                           0x4d, 0xdd, 0x78, 0x34, 0xe2, 0xa1, 0x4a, 0x8b, 0x34, 0x14, 0x9d};
  uint8_t bytesprops8[] = {0x2f, 0x74, 0xe9, 0x5,  0xc6, 0x5a, 0x20, 0xc5, 0xc8, 0xda, 0x68, 0xc5,
                           0x92, 0x93, 0x4d, 0x11, 0xdc, 0x7c, 0x64, 0x4e, 0xc3, 0x16, 0x47};
  uint8_t bytesprops9[] = {0x97, 0x5c, 0x3b, 0x4a, 0x78, 0x96, 0xff, 0xe1, 0xfc, 0x84, 0x91,
                           0xbb, 0x6e, 0xce, 0x37, 0x2,  0x6c, 0xac, 0xc4, 0x5b, 0xcc, 0xb4};
  uint8_t bytesprops10[] = {0x35, 0x31, 0xa7, 0xa8, 0x20, 0xda};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16439}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2703}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12373}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops3}, .v = {16, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20204}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32647}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NUL%\184|4\245A", _pubPktID = 9669,
// _pubBody = "\170\148\223\170\SOH\189\188m;\173\149\203\NUL_B\STX\209\128\FSH\211\202R*$\DC4\t\241J", _pubProps =
// [PropAuthenticationMethod "\133\130\171\253DL)v@\199j\228\134\212\250\224\134\EMe)\DC3\242\DC1\231",PropMaximumQoS
// 121,PropMaximumPacketSize 26562,PropRequestProblemInformation 233,PropTopicAliasMaximum
// 21040,PropSubscriptionIdentifierAvailable 223,PropMessageExpiryInterval 4754,PropSubscriptionIdentifier
// 30,PropReasonString "2<\152\236\226\DC1\220.\NAKkZW\US\t\169",PropSharedSubscriptionAvailable
// 24,PropAuthenticationData "\217A3&_FD\140x\150m}z_\253\SUB\151'\EOT\249c\252]\129",PropRequestProblemInformation
// 168,PropPayloadFormatIndicator 156,PropMaximumQoS 149,PropPayloadFormatIndicator 71,PropSharedSubscriptionAvailable
// 243,PropResponseInformation "\r\150&\179E\ENQ,",PropMaximumQoS 6,PropServerKeepAlive 12988,PropMessageExpiryInterval
// 450,PropMaximumPacketSize 13232,PropSharedSubscriptionAvailable 1]}
TEST(Publish5QCTest, Encode82) {
  uint8_t pkt[] = {0x3a, 0xae, 0x1,  0x0,  0x7,  0x0,  0x25, 0xb8, 0x7c, 0x34, 0xf5, 0x41, 0x25, 0xc5, 0x84, 0x1,  0x15,
                   0x0,  0x18, 0x85, 0x82, 0xab, 0xfd, 0x44, 0x4c, 0x29, 0x76, 0x40, 0xc7, 0x6a, 0xe4, 0x86, 0xd4, 0xfa,
                   0xe0, 0x86, 0x19, 0x65, 0x29, 0x13, 0xf2, 0x11, 0xe7, 0x24, 0x79, 0x27, 0x0,  0x0,  0x67, 0xc2, 0x17,
                   0xe9, 0x22, 0x52, 0x30, 0x29, 0xdf, 0x2,  0x0,  0x0,  0x12, 0x92, 0xb,  0x1e, 0x1f, 0x0,  0xf,  0x32,
                   0x3c, 0x98, 0xec, 0xe2, 0x11, 0xdc, 0x2e, 0x15, 0x6b, 0x5a, 0x57, 0x1f, 0x9,  0xa9, 0x2a, 0x18, 0x16,
                   0x0,  0x18, 0xd9, 0x41, 0x33, 0x26, 0x5f, 0x46, 0x44, 0x8c, 0x78, 0x96, 0x6d, 0x7d, 0x7a, 0x5f, 0xfd,
                   0x1a, 0x97, 0x27, 0x4,  0xf9, 0x63, 0xfc, 0x5d, 0x81, 0x17, 0xa8, 0x1,  0x9c, 0x24, 0x95, 0x1,  0x47,
                   0x2a, 0xf3, 0x1a, 0x0,  0x7,  0xd,  0x96, 0x26, 0xb3, 0x45, 0x5,  0x2c, 0x24, 0x6,  0x13, 0x32, 0xbc,
                   0x2,  0x0,  0x0,  0x1,  0xc2, 0x27, 0x0,  0x0,  0x33, 0xb0, 0x2a, 0x1,  0xaa, 0x94, 0xdf, 0xaa, 0x1,
                   0xbd, 0xbc, 0x6d, 0x3b, 0xad, 0x95, 0xcb, 0x0,  0x5f, 0x42, 0x2,  0xd1, 0x80, 0x1c, 0x48, 0xd3, 0xca,
                   0x52, 0x2a, 0x24, 0x14, 0x9,  0xf1, 0x4a};

  uint8_t buf[187] = {0};

  uint8_t topic_bytes[] = {0x0, 0x25, 0xb8, 0x7c, 0x34, 0xf5, 0x41};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xaa, 0x94, 0xdf, 0xaa, 0x1,  0xbd, 0xbc, 0x6d, 0x3b, 0xad, 0x95, 0xcb, 0x0,  0x5f, 0x42,
                         0x2,  0xd1, 0x80, 0x1c, 0x48, 0xd3, 0xca, 0x52, 0x2a, 0x24, 0x14, 0x9,  0xf1, 0x4a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x85, 0x82, 0xab, 0xfd, 0x44, 0x4c, 0x29, 0x76, 0x40, 0xc7, 0x6a, 0xe4,
                           0x86, 0xd4, 0xfa, 0xe0, 0x86, 0x19, 0x65, 0x29, 0x13, 0xf2, 0x11, 0xe7};
  uint8_t bytesprops1[] = {0x32, 0x3c, 0x98, 0xec, 0xe2, 0x11, 0xdc, 0x2e, 0x15, 0x6b, 0x5a, 0x57, 0x1f, 0x9, 0xa9};
  uint8_t bytesprops2[] = {0xd9, 0x41, 0x33, 0x26, 0x5f, 0x46, 0x44, 0x8c, 0x78, 0x96, 0x6d, 0x7d,
                           0x7a, 0x5f, 0xfd, 0x1a, 0x97, 0x27, 0x4,  0xf9, 0x63, 0xfc, 0x5d, 0x81};
  uint8_t bytesprops3[] = {0xd, 0x96, 0x26, 0xb3, 0x45, 0x5, 0x2c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26562}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21040}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4754}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12988}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 450}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13232}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 1}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 9669, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "
// o\209~\209\242\176\161LlEV\DC1\133\143\237'Y6\212\133H\a\241\&0a", _pubPktID = 1466, _pubBody =
// "0\192\223\GS\205\153\241>N\167\&8l\DC4\151x\170\229\FS\DC3s\128\135\222", _pubProps = [PropResponseInformation
// "d\230\222_\235\DC3\t\249\239\214^z\190\212\146;\183Y_\251",PropAuthenticationMethod
// "/\161\143;\FSB\160E\NAK9er\154\151HQ\254\169R",PropAuthenticationMethod "\248\SOH\169
// %\148\181\248[<\128\247k",PropResponseInformation
// "\196qU2Lz\146\223yZ\ENQ\253\&2\DC2h\136\155c;\201\DEL",PropSharedSubscriptionAvailable 231,PropMaximumQoS
// 182,PropUserProperty "T\166\248\237\150\n\218\ENQ\NAK%\242\187\217\166&/}\163\DEL\243\DEL\253\152\148\159"
// "\213A",PropReasonString "y\170\226\DC42$n!\237F\136\FS9\180\158\&4zG\130|\GS!\132",PropServerKeepAlive
// 19917,PropRequestProblemInformation 106,PropSharedSubscriptionAvailable 200,PropRequestResponseInformation
// 126,PropRequestProblemInformation 139,PropWildcardSubscriptionAvailable 178,PropSessionExpiryInterval
// 21423,PropRequestProblemInformation 122,PropRetainAvailable 170,PropContentType
// "\235\191^1\239\207{\139f\195",PropReceiveMaximum 2421,PropPayloadFormatIndicator 171,PropAuthenticationMethod
// "n\USj\187\ACK\142\213\NAK\220",PropRetainAvailable 210,PropAuthenticationMethod
// "K\173\189o3'\DC1\EM\197\181\144\152.\157",PropAuthenticationMethod "\242/\152\208",PropAuthenticationData
// "\DC4\141bJ\171o\SUBlv\220\DC3\233\203\ETX4\NUL\241\195S\182\145\n\240"]}
TEST(Publish5QCTest, Encode83) {
  uint8_t pkt[] = {
      0x33, 0xb2, 0x2,  0x0,  0x1a, 0x20, 0x6f, 0xd1, 0x7e, 0xd1, 0xf2, 0xb0, 0xa1, 0x4c, 0x6c, 0x45, 0x56, 0x11, 0x85,
      0x8f, 0xed, 0x27, 0x59, 0x36, 0xd4, 0x85, 0x48, 0x7,  0xf1, 0x30, 0x61, 0x5,  0xba, 0xfb, 0x1,  0x1a, 0x0,  0x14,
      0x64, 0xe6, 0xde, 0x5f, 0xeb, 0x13, 0x9,  0xf9, 0xef, 0xd6, 0x5e, 0x7a, 0xbe, 0xd4, 0x92, 0x3b, 0xb7, 0x59, 0x5f,
      0xfb, 0x15, 0x0,  0x13, 0x2f, 0xa1, 0x8f, 0x3b, 0x1c, 0x42, 0xa0, 0x45, 0x15, 0x39, 0x65, 0x72, 0x9a, 0x97, 0x48,
      0x51, 0xfe, 0xa9, 0x52, 0x15, 0x0,  0xd,  0xf8, 0x1,  0xa9, 0x20, 0x25, 0x94, 0xb5, 0xf8, 0x5b, 0x3c, 0x80, 0xf7,
      0x6b, 0x1a, 0x0,  0x15, 0xc4, 0x71, 0x55, 0x32, 0x4c, 0x7a, 0x92, 0xdf, 0x79, 0x5a, 0x5,  0xfd, 0x32, 0x12, 0x68,
      0x88, 0x9b, 0x63, 0x3b, 0xc9, 0x7f, 0x2a, 0xe7, 0x24, 0xb6, 0x26, 0x0,  0x19, 0x54, 0xa6, 0xf8, 0xed, 0x96, 0xa,
      0xda, 0x5,  0x15, 0x25, 0xf2, 0xbb, 0xd9, 0xa6, 0x26, 0x2f, 0x7d, 0xa3, 0x7f, 0xf3, 0x7f, 0xfd, 0x98, 0x94, 0x9f,
      0x0,  0x2,  0xd5, 0x41, 0x1f, 0x0,  0x17, 0x79, 0xaa, 0xe2, 0x14, 0x32, 0x24, 0x6e, 0x21, 0xed, 0x46, 0x88, 0x1c,
      0x39, 0xb4, 0x9e, 0x34, 0x7a, 0x47, 0x82, 0x7c, 0x1d, 0x21, 0x84, 0x13, 0x4d, 0xcd, 0x17, 0x6a, 0x2a, 0xc8, 0x19,
      0x7e, 0x17, 0x8b, 0x28, 0xb2, 0x11, 0x0,  0x0,  0x53, 0xaf, 0x17, 0x7a, 0x25, 0xaa, 0x3,  0x0,  0xa,  0xeb, 0xbf,
      0x5e, 0x31, 0xef, 0xcf, 0x7b, 0x8b, 0x66, 0xc3, 0x21, 0x9,  0x75, 0x1,  0xab, 0x15, 0x0,  0x9,  0x6e, 0x1f, 0x6a,
      0xbb, 0x6,  0x8e, 0xd5, 0x15, 0xdc, 0x25, 0xd2, 0x15, 0x0,  0xe,  0x4b, 0xad, 0xbd, 0x6f, 0x33, 0x27, 0x11, 0x19,
      0xc5, 0xb5, 0x90, 0x98, 0x2e, 0x9d, 0x15, 0x0,  0x4,  0xf2, 0x2f, 0x98, 0xd0, 0x16, 0x0,  0x17, 0x14, 0x8d, 0x62,
      0x4a, 0xab, 0x6f, 0x1a, 0x6c, 0x76, 0xdc, 0x13, 0xe9, 0xcb, 0x3,  0x34, 0x0,  0xf1, 0xc3, 0x53, 0xb6, 0x91, 0xa,
      0xf0, 0x30, 0xc0, 0xdf, 0x1d, 0xcd, 0x99, 0xf1, 0x3e, 0x4e, 0xa7, 0x38, 0x6c, 0x14, 0x97, 0x78, 0xaa, 0xe5, 0x1c,
      0x13, 0x73, 0x80, 0x87, 0xde};

  uint8_t buf[319] = {0};

  uint8_t topic_bytes[] = {0x20, 0x6f, 0xd1, 0x7e, 0xd1, 0xf2, 0xb0, 0xa1, 0x4c, 0x6c, 0x45, 0x56, 0x11,
                           0x85, 0x8f, 0xed, 0x27, 0x59, 0x36, 0xd4, 0x85, 0x48, 0x7,  0xf1, 0x30, 0x61};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x30, 0xc0, 0xdf, 0x1d, 0xcd, 0x99, 0xf1, 0x3e, 0x4e, 0xa7, 0x38, 0x6c,
                         0x14, 0x97, 0x78, 0xaa, 0xe5, 0x1c, 0x13, 0x73, 0x80, 0x87, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x64, 0xe6, 0xde, 0x5f, 0xeb, 0x13, 0x9,  0xf9, 0xef, 0xd6,
                           0x5e, 0x7a, 0xbe, 0xd4, 0x92, 0x3b, 0xb7, 0x59, 0x5f, 0xfb};
  uint8_t bytesprops1[] = {0x2f, 0xa1, 0x8f, 0x3b, 0x1c, 0x42, 0xa0, 0x45, 0x15, 0x39,
                           0x65, 0x72, 0x9a, 0x97, 0x48, 0x51, 0xfe, 0xa9, 0x52};
  uint8_t bytesprops2[] = {0xf8, 0x1, 0xa9, 0x20, 0x25, 0x94, 0xb5, 0xf8, 0x5b, 0x3c, 0x80, 0xf7, 0x6b};
  uint8_t bytesprops3[] = {0xc4, 0x71, 0x55, 0x32, 0x4c, 0x7a, 0x92, 0xdf, 0x79, 0x5a, 0x5,
                           0xfd, 0x32, 0x12, 0x68, 0x88, 0x9b, 0x63, 0x3b, 0xc9, 0x7f};
  uint8_t bytesprops5[] = {0xd5, 0x41};
  uint8_t bytesprops4[] = {0x54, 0xa6, 0xf8, 0xed, 0x96, 0xa,  0xda, 0x5,  0x15, 0x25, 0xf2, 0xbb, 0xd9,
                           0xa6, 0x26, 0x2f, 0x7d, 0xa3, 0x7f, 0xf3, 0x7f, 0xfd, 0x98, 0x94, 0x9f};
  uint8_t bytesprops6[] = {0x79, 0xaa, 0xe2, 0x14, 0x32, 0x24, 0x6e, 0x21, 0xed, 0x46, 0x88, 0x1c,
                           0x39, 0xb4, 0x9e, 0x34, 0x7a, 0x47, 0x82, 0x7c, 0x1d, 0x21, 0x84};
  uint8_t bytesprops7[] = {0xeb, 0xbf, 0x5e, 0x31, 0xef, 0xcf, 0x7b, 0x8b, 0x66, 0xc3};
  uint8_t bytesprops8[] = {0x6e, 0x1f, 0x6a, 0xbb, 0x6, 0x8e, 0xd5, 0x15, 0xdc};
  uint8_t bytesprops9[] = {0x4b, 0xad, 0xbd, 0x6f, 0x33, 0x27, 0x11, 0x19, 0xc5, 0xb5, 0x90, 0x98, 0x2e, 0x9d};
  uint8_t bytesprops10[] = {0xf2, 0x2f, 0x98, 0xd0};
  uint8_t bytesprops11[] = {0x14, 0x8d, 0x62, 0x4a, 0xab, 0x6f, 0x1a, 0x6c, 0x76, 0xdc, 0x13, 0xe9,
                            0xcb, 0x3,  0x34, 0x0,  0xf1, 0xc3, 0x53, 0xb6, 0x91, 0xa,  0xf0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19917}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21423}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2421}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 1466, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\201%\197.\f\247\DC3\198kM\237D\184\RS\ENQ<\183\215\RS\217\200", _pubPktID = 0, _pubBody = ">@1E\209$\188\249zd",
// _pubProps = [PropServerReference "\ETX-_",PropMessageExpiryInterval 25845,PropMaximumQoS
// 144,PropMessageExpiryInterval 5141,PropSessionExpiryInterval 28057,PropContentType
// "y\DC3b\131#\DC3\EOT\205\ETB-\226\223\247",PropContentType "}%\ETX\t",PropReasonString "D\ENQ",PropServerKeepAlive
// 23556,PropMessageExpiryInterval 5144,PropAssignedClientIdentifier
// "\191\136'\152\SO\194\SUB\175\214\149",PropAuthenticationMethod
// "\185G1\255!\218\NULt\212\230(\221,\214`5\252)@\217<\234\161\194\190\128#\135\227v",PropReceiveMaximum
// 20953,PropCorrelationData "\197I\b\242,\220\160\207b3\188\n\SIo\185",PropContentType
// "\SOH;K\129\173\&7^\218\205P\191HC\USK",PropRequestProblemInformation 89]}
TEST(Publish5QCTest, Encode84) {
  uint8_t pkt[] = {0x30, 0xb5, 0x1,  0x0,  0x15, 0xc9, 0x25, 0xc5, 0x2e, 0xc,  0xf7, 0x13, 0xc6, 0x6b, 0x4d, 0xed, 0x44,
                   0xb8, 0x1e, 0x5,  0x3c, 0xb7, 0xd7, 0x1e, 0xd9, 0xc8, 0x92, 0x1,  0x1c, 0x0,  0x3,  0x3,  0x2d, 0x5f,
                   0x2,  0x0,  0x0,  0x64, 0xf5, 0x24, 0x90, 0x2,  0x0,  0x0,  0x14, 0x15, 0x11, 0x0,  0x0,  0x6d, 0x99,
                   0x3,  0x0,  0xd,  0x79, 0x13, 0x62, 0x83, 0x23, 0x13, 0x4,  0xcd, 0x17, 0x2d, 0xe2, 0xdf, 0xf7, 0x3,
                   0x0,  0x4,  0x7d, 0x25, 0x3,  0x9,  0x1f, 0x0,  0x2,  0x44, 0x5,  0x13, 0x5c, 0x4,  0x2,  0x0,  0x0,
                   0x14, 0x18, 0x12, 0x0,  0xa,  0xbf, 0x88, 0x27, 0x98, 0xe,  0xc2, 0x1a, 0xaf, 0xd6, 0x95, 0x15, 0x0,
                   0x1e, 0xb9, 0x47, 0x31, 0xff, 0x21, 0xda, 0x0,  0x74, 0xd4, 0xe6, 0x28, 0xdd, 0x2c, 0xd6, 0x60, 0x35,
                   0xfc, 0x29, 0x40, 0xd9, 0x3c, 0xea, 0xa1, 0xc2, 0xbe, 0x80, 0x23, 0x87, 0xe3, 0x76, 0x21, 0x51, 0xd9,
                   0x9,  0x0,  0xf,  0xc5, 0x49, 0x8,  0xf2, 0x2c, 0xdc, 0xa0, 0xcf, 0x62, 0x33, 0xbc, 0xa,  0xf,  0x6f,
                   0xb9, 0x3,  0x0,  0xf,  0x1,  0x3b, 0x4b, 0x81, 0xad, 0x37, 0x5e, 0xda, 0xcd, 0x50, 0xbf, 0x48, 0x43,
                   0x1f, 0x4b, 0x17, 0x59, 0x3e, 0x40, 0x31, 0x45, 0xd1, 0x24, 0xbc, 0xf9, 0x7a, 0x64};

  uint8_t buf[194] = {0};

  uint8_t topic_bytes[] = {0xc9, 0x25, 0xc5, 0x2e, 0xc,  0xf7, 0x13, 0xc6, 0x6b, 0x4d, 0xed,
                           0x44, 0xb8, 0x1e, 0x5,  0x3c, 0xb7, 0xd7, 0x1e, 0xd9, 0xc8};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3e, 0x40, 0x31, 0x45, 0xd1, 0x24, 0xbc, 0xf9, 0x7a, 0x64};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x3, 0x2d, 0x5f};
  uint8_t bytesprops1[] = {0x79, 0x13, 0x62, 0x83, 0x23, 0x13, 0x4, 0xcd, 0x17, 0x2d, 0xe2, 0xdf, 0xf7};
  uint8_t bytesprops2[] = {0x7d, 0x25, 0x3, 0x9};
  uint8_t bytesprops3[] = {0x44, 0x5};
  uint8_t bytesprops4[] = {0xbf, 0x88, 0x27, 0x98, 0xe, 0xc2, 0x1a, 0xaf, 0xd6, 0x95};
  uint8_t bytesprops5[] = {0xb9, 0x47, 0x31, 0xff, 0x21, 0xda, 0x0,  0x74, 0xd4, 0xe6, 0x28, 0xdd, 0x2c, 0xd6, 0x60,
                           0x35, 0xfc, 0x29, 0x40, 0xd9, 0x3c, 0xea, 0xa1, 0xc2, 0xbe, 0x80, 0x23, 0x87, 0xe3, 0x76};
  uint8_t bytesprops6[] = {0xc5, 0x49, 0x8, 0xf2, 0x2c, 0xdc, 0xa0, 0xcf, 0x62, 0x33, 0xbc, 0xa, 0xf, 0x6f, 0xb9};
  uint8_t bytesprops7[] = {0x1, 0x3b, 0x4b, 0x81, 0xad, 0x37, 0x5e, 0xda, 0xcd, 0x50, 0xbf, 0x48, 0x43, 0x1f, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25845}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5141}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28057}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23556}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5144}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20953}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\ACK\180\\\144\214%\183\192\168\129",
// _pubPktID = 5193, _pubBody = "\SOH\135\136&\\\133\174\132\244\244\"", _pubProps = [PropContentType
// "o\175\134\150\199\168V!\a\193\243v\192\DC2\226l",PropReceiveMaximum 26703,PropMessageExpiryInterval
// 25645,PropMessageExpiryInterval 13097,PropServerKeepAlive 22523,PropWildcardSubscriptionAvailable 183,PropContentType
// "\241\&0\251P$\221\223\&8#",PropWillDelayInterval 13818,PropSessionExpiryInterval 9707,PropRetainAvailable
// 49,PropRequestProblemInformation 189,PropContentType
// "\209jJ\151`E\239\220m\184T4$f9\200\STX\CAN?#\196\201)\151\225\196",PropMessageExpiryInterval
// 26226,PropMessageExpiryInterval 28825,PropSubscriptionIdentifier 0,PropReceiveMaximum 23784,PropWillDelayInterval
// 23963,PropResponseTopic "\152UD\222\149Uk",PropWildcardSubscriptionAvailable 60,PropReceiveMaximum
// 19669,PropMaximumQoS 175,PropResponseInformation "'\229!\138\183\&1*\173",PropReceiveMaximum 13680,PropResponseTopic
// "\163\233\152\FSt\200\157\154H\246\SO"]}
TEST(Publish5QCTest, Encode85) {
  uint8_t pkt[] = {
      0x3b, 0xb8, 0x1,  0x0,  0xa,  0x6,  0xb4, 0x5c, 0x90, 0xd6, 0x25, 0xb7, 0xc0, 0xa8, 0x81, 0x14, 0x49, 0x9d, 0x1,
      0x3,  0x0,  0x10, 0x6f, 0xaf, 0x86, 0x96, 0xc7, 0xa8, 0x56, 0x21, 0x7,  0xc1, 0xf3, 0x76, 0xc0, 0x12, 0xe2, 0x6c,
      0x21, 0x68, 0x4f, 0x2,  0x0,  0x0,  0x64, 0x2d, 0x2,  0x0,  0x0,  0x33, 0x29, 0x13, 0x57, 0xfb, 0x28, 0xb7, 0x3,
      0x0,  0x9,  0xf1, 0x30, 0xfb, 0x50, 0x24, 0xdd, 0xdf, 0x38, 0x23, 0x18, 0x0,  0x0,  0x35, 0xfa, 0x11, 0x0,  0x0,
      0x25, 0xeb, 0x25, 0x31, 0x17, 0xbd, 0x3,  0x0,  0x1a, 0xd1, 0x6a, 0x4a, 0x97, 0x60, 0x45, 0xef, 0xdc, 0x6d, 0xb8,
      0x54, 0x34, 0x24, 0x66, 0x39, 0xc8, 0x2,  0x18, 0x3f, 0x23, 0xc4, 0xc9, 0x29, 0x97, 0xe1, 0xc4, 0x2,  0x0,  0x0,
      0x66, 0x72, 0x2,  0x0,  0x0,  0x70, 0x99, 0xb,  0x0,  0x21, 0x5c, 0xe8, 0x18, 0x0,  0x0,  0x5d, 0x9b, 0x8,  0x0,
      0x7,  0x98, 0x55, 0x44, 0xde, 0x95, 0x55, 0x6b, 0x28, 0x3c, 0x21, 0x4c, 0xd5, 0x24, 0xaf, 0x1a, 0x0,  0x8,  0x27,
      0xe5, 0x21, 0x8a, 0xb7, 0x31, 0x2a, 0xad, 0x21, 0x35, 0x70, 0x8,  0x0,  0xb,  0xa3, 0xe9, 0x98, 0x1c, 0x74, 0xc8,
      0x9d, 0x9a, 0x48, 0xf6, 0xe,  0x1,  0x87, 0x88, 0x26, 0x5c, 0x85, 0xae, 0x84, 0xf4, 0xf4, 0x22};

  uint8_t buf[197] = {0};

  uint8_t topic_bytes[] = {0x6, 0xb4, 0x5c, 0x90, 0xd6, 0x25, 0xb7, 0xc0, 0xa8, 0x81};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x87, 0x88, 0x26, 0x5c, 0x85, 0xae, 0x84, 0xf4, 0xf4, 0x22};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x6f, 0xaf, 0x86, 0x96, 0xc7, 0xa8, 0x56, 0x21,
                           0x7,  0xc1, 0xf3, 0x76, 0xc0, 0x12, 0xe2, 0x6c};
  uint8_t bytesprops1[] = {0xf1, 0x30, 0xfb, 0x50, 0x24, 0xdd, 0xdf, 0x38, 0x23};
  uint8_t bytesprops2[] = {0xd1, 0x6a, 0x4a, 0x97, 0x60, 0x45, 0xef, 0xdc, 0x6d, 0xb8, 0x54, 0x34, 0x24,
                           0x66, 0x39, 0xc8, 0x2,  0x18, 0x3f, 0x23, 0xc4, 0xc9, 0x29, 0x97, 0xe1, 0xc4};
  uint8_t bytesprops3[] = {0x98, 0x55, 0x44, 0xde, 0x95, 0x55, 0x6b};
  uint8_t bytesprops4[] = {0x27, 0xe5, 0x21, 0x8a, 0xb7, 0x31, 0x2a, 0xad};
  uint8_t bytesprops5[] = {0xa3, 0xe9, 0x98, 0x1c, 0x74, 0xc8, 0x9d, 0x9a, 0x48, 0xf6, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26703}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25645}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13097}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22523}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13818}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9707}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26226}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28825}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23784}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23963}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19669}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13680}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5193, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\235c\197\&9\FS\179\195b6\STX\195n\216\&3\213\vpu\137v\147o\200\233", _pubPktID = 40, _pubBody =
// "\150\169\128N}\US\133\146\160\ENQ\253N\247", _pubProps = [PropWildcardSubscriptionAvailable
// 17,PropAssignedClientIdentifier "a\176\US",PropTopicAlias 25003,PropServerReference
// "\198~d\245\202w\CAN\SO\157\149~s=\254",PropUserProperty "\SUB&\223\DC3i\242\249\&5\\\144"
// "\135\DC2;>H\187\234\ENQ`\162\160\168`\141\134\209\156\146D\229\133\255\219\243\196`\DC3\217",PropServerKeepAlive
// 9027,PropWillDelayInterval 14049,PropUserProperty
// "x|I\173\&9\165av\NAKz\168%\EOT\192\RS\244\243$\240\NAKn\190\220a\171\172\DEL\135"
// "\234\192:",PropMessageExpiryInterval 17923]}
TEST(Publish5QCTest, Encode86) {
  uint8_t pkt[] = {0x35, 0xa2, 0x1,  0x0,  0x18, 0xeb, 0x63, 0xc5, 0x39, 0x1c, 0xb3, 0xc3, 0x62, 0x36, 0x2,  0xc3, 0x6e,
                   0xd8, 0x33, 0xd5, 0xb,  0x70, 0x75, 0x89, 0x76, 0x93, 0x6f, 0xc8, 0xe9, 0x0,  0x28, 0x78, 0x28, 0x11,
                   0x12, 0x0,  0x3,  0x61, 0xb0, 0x1f, 0x23, 0x61, 0xab, 0x1c, 0x0,  0xe,  0xc6, 0x7e, 0x64, 0xf5, 0xca,
                   0x77, 0x18, 0xe,  0x9d, 0x95, 0x7e, 0x73, 0x3d, 0xfe, 0x26, 0x0,  0xa,  0x1a, 0x26, 0xdf, 0x13, 0x69,
                   0xf2, 0xf9, 0x35, 0x5c, 0x90, 0x0,  0x1c, 0x87, 0x12, 0x3b, 0x3e, 0x48, 0xbb, 0xea, 0x5,  0x60, 0xa2,
                   0xa0, 0xa8, 0x60, 0x8d, 0x86, 0xd1, 0x9c, 0x92, 0x44, 0xe5, 0x85, 0xff, 0xdb, 0xf3, 0xc4, 0x60, 0x13,
                   0xd9, 0x13, 0x23, 0x43, 0x18, 0x0,  0x0,  0x36, 0xe1, 0x26, 0x0,  0x1c, 0x78, 0x7c, 0x49, 0xad, 0x39,
                   0xa5, 0x61, 0x76, 0x15, 0x7a, 0xa8, 0x25, 0x4,  0xc0, 0x1e, 0xf4, 0xf3, 0x24, 0xf0, 0x15, 0x6e, 0xbe,
                   0xdc, 0x61, 0xab, 0xac, 0x7f, 0x87, 0x0,  0x3,  0xea, 0xc0, 0x3a, 0x2,  0x0,  0x0,  0x46, 0x3,  0x96,
                   0xa9, 0x80, 0x4e, 0x7d, 0x1f, 0x85, 0x92, 0xa0, 0x5,  0xfd, 0x4e, 0xf7};

  uint8_t buf[175] = {0};

  uint8_t topic_bytes[] = {0xeb, 0x63, 0xc5, 0x39, 0x1c, 0xb3, 0xc3, 0x62, 0x36, 0x2,  0xc3, 0x6e,
                           0xd8, 0x33, 0xd5, 0xb,  0x70, 0x75, 0x89, 0x76, 0x93, 0x6f, 0xc8, 0xe9};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x96, 0xa9, 0x80, 0x4e, 0x7d, 0x1f, 0x85, 0x92, 0xa0, 0x5, 0xfd, 0x4e, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x61, 0xb0, 0x1f};
  uint8_t bytesprops1[] = {0xc6, 0x7e, 0x64, 0xf5, 0xca, 0x77, 0x18, 0xe, 0x9d, 0x95, 0x7e, 0x73, 0x3d, 0xfe};
  uint8_t bytesprops3[] = {0x87, 0x12, 0x3b, 0x3e, 0x48, 0xbb, 0xea, 0x5,  0x60, 0xa2, 0xa0, 0xa8, 0x60, 0x8d,
                           0x86, 0xd1, 0x9c, 0x92, 0x44, 0xe5, 0x85, 0xff, 0xdb, 0xf3, 0xc4, 0x60, 0x13, 0xd9};
  uint8_t bytesprops2[] = {0x1a, 0x26, 0xdf, 0x13, 0x69, 0xf2, 0xf9, 0x35, 0x5c, 0x90};
  uint8_t bytesprops5[] = {0xea, 0xc0, 0x3a};
  uint8_t bytesprops4[] = {0x78, 0x7c, 0x49, 0xad, 0x39, 0xa5, 0x61, 0x76, 0x15, 0x7a, 0xa8, 0x25, 0x4,  0xc0,
                           0x1e, 0xf4, 0xf3, 0x24, 0xf0, 0x15, 0x6e, 0xbe, 0xdc, 0x61, 0xab, 0xac, 0x7f, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25003}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {28, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9027}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14049}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops4}, .v = {3, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17923}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 40, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\SIM;=\ETX\220\ETX\214o\159\228\157\195\144\184+\216gpE\208\DC3\228\211\238W\212\&2", _pubPktID = 0, _pubBody =
// "\ETX\175\STXN\144\216\212\205c\184|\142\&5i", _pubProps = [PropSubscriptionIdentifier 10,PropResponseTopic
// "O\193\137\GS_&gG\144\252#^Z\EM\200>\151j\136\253w\DC3x{\ETB(",PropMessageExpiryInterval 23659,PropMaximumQoS 14]}
TEST(Publish5QCTest, Encode87) {
  uint8_t pkt[] = {0x31, 0x53, 0x0,  0x1c, 0xf,  0x4d, 0x3b, 0x3d, 0x3,  0xdc, 0x3,  0xd6, 0x6f, 0x9f, 0xe4,
                   0x9d, 0xc3, 0x90, 0xb8, 0x2b, 0xd8, 0x67, 0x70, 0x45, 0xd0, 0x13, 0xe4, 0xd3, 0xee, 0x57,
                   0xd4, 0x32, 0x26, 0xb,  0xa,  0x8,  0x0,  0x1a, 0x4f, 0xc1, 0x89, 0x1d, 0x5f, 0x26, 0x67,
                   0x47, 0x90, 0xfc, 0x23, 0x5e, 0x5a, 0x19, 0xc8, 0x3e, 0x97, 0x6a, 0x88, 0xfd, 0x77, 0x13,
                   0x78, 0x7b, 0x17, 0x28, 0x2,  0x0,  0x0,  0x5c, 0x6b, 0x24, 0xe,  0x3,  0xaf, 0x2,  0x4e,
                   0x90, 0xd8, 0xd4, 0xcd, 0x63, 0xb8, 0x7c, 0x8e, 0x35, 0x69};

  uint8_t buf[95] = {0};

  uint8_t topic_bytes[] = {0xf,  0x4d, 0x3b, 0x3d, 0x3,  0xdc, 0x3,  0xd6, 0x6f, 0x9f, 0xe4, 0x9d, 0xc3, 0x90,
                           0xb8, 0x2b, 0xd8, 0x67, 0x70, 0x45, 0xd0, 0x13, 0xe4, 0xd3, 0xee, 0x57, 0xd4, 0x32};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3, 0xaf, 0x2, 0x4e, 0x90, 0xd8, 0xd4, 0xcd, 0x63, 0xb8, 0x7c, 0x8e, 0x35, 0x69};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x4f, 0xc1, 0x89, 0x1d, 0x5f, 0x26, 0x67, 0x47, 0x90, 0xfc, 0x23, 0x5e, 0x5a,
                           0x19, 0xc8, 0x3e, 0x97, 0x6a, 0x88, 0xfd, 0x77, 0x13, 0x78, 0x7b, 0x17, 0x28};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23659}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 14}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "p\185X\177s\138d\DLE.", _pubPktID =
// 29654, _pubBody = "\195o\ndF\GS\152\131\191\195;\253\248+\187y\251\129 4\244\145", _pubProps = [PropServerKeepAlive
// 26757,PropCorrelationData "\208l\212\236\139+\158\156Y\SUBdY\148\193\198\137\210*\205\208S\208D\209",PropUserProperty
// "\FS\203\241o\n" "@B\187\ETB!\214\DLE<!SZ[\173\205",PropServerReference "\212aZ
// \167F\235\228\211",PropRequestProblemInformation 98,PropSharedSubscriptionAvailable 172,PropMessageExpiryInterval
// 11518,PropSubscriptionIdentifier 18,PropAssignedClientIdentifier "\245\244\163>_\189P\205",PropAuthenticationData
// "\187\US\232\141\aQ",PropMessageExpiryInterval 30502,PropMessageExpiryInterval 11882,PropContentType
// "7I:b\193\246s\173\214\&7\t\f_\v"]}
TEST(Publish5QCTest, Encode88) {
  uint8_t pkt[] = {0x3c, 0xa0, 0x1,  0x0,  0x9,  0x70, 0xb9, 0x58, 0xb1, 0x73, 0x8a, 0x64, 0x10, 0x2e, 0x73, 0xd6, 0x7c,
                   0x13, 0x68, 0x85, 0x9,  0x0,  0x18, 0xd0, 0x6c, 0xd4, 0xec, 0x8b, 0x2b, 0x9e, 0x9c, 0x59, 0x1a, 0x64,
                   0x59, 0x94, 0xc1, 0xc6, 0x89, 0xd2, 0x2a, 0xcd, 0xd0, 0x53, 0xd0, 0x44, 0xd1, 0x26, 0x0,  0x5,  0x1c,
                   0xcb, 0xf1, 0x6f, 0xa,  0x0,  0xe,  0x40, 0x42, 0xbb, 0x17, 0x21, 0xd6, 0x10, 0x3c, 0x21, 0x53, 0x5a,
                   0x5b, 0xad, 0xcd, 0x1c, 0x0,  0x9,  0xd4, 0x61, 0x5a, 0x20, 0xa7, 0x46, 0xeb, 0xe4, 0xd3, 0x17, 0x62,
                   0x2a, 0xac, 0x2,  0x0,  0x0,  0x2c, 0xfe, 0xb,  0x12, 0x12, 0x0,  0x8,  0xf5, 0xf4, 0xa3, 0x3e, 0x5f,
                   0xbd, 0x50, 0xcd, 0x16, 0x0,  0x6,  0xbb, 0x1f, 0xe8, 0x8d, 0x7,  0x51, 0x2,  0x0,  0x0,  0x77, 0x26,
                   0x2,  0x0,  0x0,  0x2e, 0x6a, 0x3,  0x0,  0xe,  0x37, 0x49, 0x3a, 0x62, 0xc1, 0xf6, 0x73, 0xad, 0xd6,
                   0x37, 0x9,  0xc,  0x5f, 0xb,  0xc3, 0x6f, 0xa,  0x64, 0x46, 0x1d, 0x98, 0x83, 0xbf, 0xc3, 0x3b, 0xfd,
                   0xf8, 0x2b, 0xbb, 0x79, 0xfb, 0x81, 0x20, 0x34, 0xf4, 0x91};

  uint8_t buf[173] = {0};

  uint8_t topic_bytes[] = {0x70, 0xb9, 0x58, 0xb1, 0x73, 0x8a, 0x64, 0x10, 0x2e};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc3, 0x6f, 0xa,  0x64, 0x46, 0x1d, 0x98, 0x83, 0xbf, 0xc3, 0x3b,
                         0xfd, 0xf8, 0x2b, 0xbb, 0x79, 0xfb, 0x81, 0x20, 0x34, 0xf4, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0xd0, 0x6c, 0xd4, 0xec, 0x8b, 0x2b, 0x9e, 0x9c, 0x59, 0x1a, 0x64, 0x59,
                           0x94, 0xc1, 0xc6, 0x89, 0xd2, 0x2a, 0xcd, 0xd0, 0x53, 0xd0, 0x44, 0xd1};
  uint8_t bytesprops2[] = {0x40, 0x42, 0xbb, 0x17, 0x21, 0xd6, 0x10, 0x3c, 0x21, 0x53, 0x5a, 0x5b, 0xad, 0xcd};
  uint8_t bytesprops1[] = {0x1c, 0xcb, 0xf1, 0x6f, 0xa};
  uint8_t bytesprops3[] = {0xd4, 0x61, 0x5a, 0x20, 0xa7, 0x46, 0xeb, 0xe4, 0xd3};
  uint8_t bytesprops4[] = {0xf5, 0xf4, 0xa3, 0x3e, 0x5f, 0xbd, 0x50, 0xcd};
  uint8_t bytesprops5[] = {0xbb, 0x1f, 0xe8, 0x8d, 0x7, 0x51};
  uint8_t bytesprops6[] = {0x37, 0x49, 0x3a, 0x62, 0xc1, 0xf6, 0x73, 0xad, 0xd6, 0x37, 0x9, 0xc, 0x5f, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26757}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops1}, .v = {14, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11518}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30502}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11882}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29654, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\238\SYN\GSq4\148\154&", _pubPktID
// = 4746, _pubBody = "", _pubProps = [PropPayloadFormatIndicator 218,PropReasonString "p\t\158\r\134",PropMaximumQoS
// 42,PropPayloadFormatIndicator 36,PropUserProperty "\196" "\n|\204\152\233\210\153\140",PropResponseTopic
// "\149\218V+OX[",PropServerKeepAlive 8879,PropTopicAlias 12682,PropTopicAlias 1639,PropAuthenticationMethod
// "\219\214\231\236u\217\140\215NsP\184\191\\\229\NAK\236\144\CAN4\225\239",PropMaximumQoS
// 252,PropMessageExpiryInterval 24151,PropServerKeepAlive 13405,PropPayloadFormatIndicator 119,PropMaximumQoS
// 37,PropAuthenticationData
// "So\173>T\"\221J\RS\230\185\128\252\172$\ACK\DC1\177\157\159n>\219\DC2",PropMessageExpiryInterval
// 19289,PropServerReference "J\DC2\204R\191\147\146\231\227\212\189H\238K\136\187\v/",PropTopicAliasMaximum
// 21397,PropAuthenticationMethod "\184c\168\130^\153\201\225\245lG",PropAuthenticationMethod
// "\231\206e\135\134S\250y\227",PropTopicAlias 2018,PropRequestResponseInformation 95,PropMaximumPacketSize
// 20599,PropSharedSubscriptionAvailable 167,PropTopicAliasMaximum 10330]}
TEST(Publish5QCTest, Encode89) {
  uint8_t pkt[] = {0x32, 0xc5, 0x1,  0x0,  0x8,  0xee, 0x16, 0x1d, 0x71, 0x34, 0x94, 0x9a, 0x26, 0x12, 0x8a, 0xb7, 0x1,
                   0x1,  0xda, 0x1f, 0x0,  0x5,  0x70, 0x9,  0x9e, 0xd,  0x86, 0x24, 0x2a, 0x1,  0x24, 0x26, 0x0,  0x1,
                   0xc4, 0x0,  0x8,  0xa,  0x7c, 0xcc, 0x98, 0xe9, 0xd2, 0x99, 0x8c, 0x8,  0x0,  0x7,  0x95, 0xda, 0x56,
                   0x2b, 0x4f, 0x58, 0x5b, 0x13, 0x22, 0xaf, 0x23, 0x31, 0x8a, 0x23, 0x6,  0x67, 0x15, 0x0,  0x16, 0xdb,
                   0xd6, 0xe7, 0xec, 0x75, 0xd9, 0x8c, 0xd7, 0x4e, 0x73, 0x50, 0xb8, 0xbf, 0x5c, 0xe5, 0x15, 0xec, 0x90,
                   0x18, 0x34, 0xe1, 0xef, 0x24, 0xfc, 0x2,  0x0,  0x0,  0x5e, 0x57, 0x13, 0x34, 0x5d, 0x1,  0x77, 0x24,
                   0x25, 0x16, 0x0,  0x18, 0x53, 0x6f, 0xad, 0x3e, 0x54, 0x22, 0xdd, 0x4a, 0x1e, 0xe6, 0xb9, 0x80, 0xfc,
                   0xac, 0x24, 0x6,  0x11, 0xb1, 0x9d, 0x9f, 0x6e, 0x3e, 0xdb, 0x12, 0x2,  0x0,  0x0,  0x4b, 0x59, 0x1c,
                   0x0,  0x12, 0x4a, 0x12, 0xcc, 0x52, 0xbf, 0x93, 0x92, 0xe7, 0xe3, 0xd4, 0xbd, 0x48, 0xee, 0x4b, 0x88,
                   0xbb, 0xb,  0x2f, 0x22, 0x53, 0x95, 0x15, 0x0,  0xb,  0xb8, 0x63, 0xa8, 0x82, 0x5e, 0x99, 0xc9, 0xe1,
                   0xf5, 0x6c, 0x47, 0x15, 0x0,  0x9,  0xe7, 0xce, 0x65, 0x87, 0x86, 0x53, 0xfa, 0x79, 0xe3, 0x23, 0x7,
                   0xe2, 0x19, 0x5f, 0x27, 0x0,  0x0,  0x50, 0x77, 0x2a, 0xa7, 0x22, 0x28, 0x5a};

  uint8_t buf[210] = {0};

  uint8_t topic_bytes[] = {0xee, 0x16, 0x1d, 0x71, 0x34, 0x94, 0x9a, 0x26};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x70, 0x9, 0x9e, 0xd, 0x86};
  uint8_t bytesprops2[] = {0xa, 0x7c, 0xcc, 0x98, 0xe9, 0xd2, 0x99, 0x8c};
  uint8_t bytesprops1[] = {0xc4};
  uint8_t bytesprops3[] = {0x95, 0xda, 0x56, 0x2b, 0x4f, 0x58, 0x5b};
  uint8_t bytesprops4[] = {0xdb, 0xd6, 0xe7, 0xec, 0x75, 0xd9, 0x8c, 0xd7, 0x4e, 0x73, 0x50,
                           0xb8, 0xbf, 0x5c, 0xe5, 0x15, 0xec, 0x90, 0x18, 0x34, 0xe1, 0xef};
  uint8_t bytesprops5[] = {0x53, 0x6f, 0xad, 0x3e, 0x54, 0x22, 0xdd, 0x4a, 0x1e, 0xe6, 0xb9, 0x80,
                           0xfc, 0xac, 0x24, 0x6,  0x11, 0xb1, 0x9d, 0x9f, 0x6e, 0x3e, 0xdb, 0x12};
  uint8_t bytesprops6[] = {0x4a, 0x12, 0xcc, 0x52, 0xbf, 0x93, 0x92, 0xe7, 0xe3,
                           0xd4, 0xbd, 0x48, 0xee, 0x4b, 0x88, 0xbb, 0xb,  0x2f};
  uint8_t bytesprops7[] = {0xb8, 0x63, 0xa8, 0x82, 0x5e, 0x99, 0xc9, 0xe1, 0xf5, 0x6c, 0x47};
  uint8_t bytesprops8[] = {0xe7, 0xce, 0x65, 0x87, 0x86, 0x53, 0xfa, 0x79, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8879}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12682}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1639}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24151}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13405}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19289}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21397}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2018}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20599}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10330}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 4746, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(\217\244\EOT\224\136\232\225\248Q\237\240\138\187\152\v<\194\216B\158\SYN\158\203t\205", _pubPktID = 13686,
// _pubBody = "g\t?\199\SOHX\128\158_", _pubProps = [PropSharedSubscriptionAvailable 137,PropUserProperty
// "p\DC4\158\167\&1u\200\FS\145q\ETB\179\217m\178K\STXP\169\216N" "\182\253",PropServerKeepAlive
// 32094,PropSubscriptionIdentifierAvailable 163,PropServerKeepAlive 30000,PropSessionExpiryInterval
// 25741,PropWildcardSubscriptionAvailable 223,PropTopicAliasMaximum 22073,PropServerKeepAlive
// 20239,PropSharedSubscriptionAvailable 136,PropMaximumPacketSize 30256,PropWillDelayInterval
// 10219,PropSubscriptionIdentifier 2,PropAuthenticationMethod
// "\242\201Pp6=\b?L\232\206\a\DC47\168&\130\167\SUB\234\237\143"]}
TEST(Publish5QCTest, Encode90) {
  uint8_t pkt[] = {0x32, 0x82, 0x1,  0x0,  0x1a, 0x28, 0xd9, 0xf4, 0x4,  0xe0, 0x88, 0xe8, 0xe1, 0xf8, 0x51, 0xed, 0xf0,
                   0x8a, 0xbb, 0x98, 0xb,  0x3c, 0xc2, 0xd8, 0x42, 0x9e, 0x16, 0x9e, 0xcb, 0x74, 0xcd, 0x35, 0x76, 0x5a,
                   0x2a, 0x89, 0x26, 0x0,  0x15, 0x70, 0x14, 0x9e, 0xa7, 0x31, 0x75, 0xc8, 0x1c, 0x91, 0x71, 0x17, 0xb3,
                   0xd9, 0x6d, 0xb2, 0x4b, 0x2,  0x50, 0xa9, 0xd8, 0x4e, 0x0,  0x2,  0xb6, 0xfd, 0x13, 0x7d, 0x5e, 0x29,
                   0xa3, 0x13, 0x75, 0x30, 0x11, 0x0,  0x0,  0x64, 0x8d, 0x28, 0xdf, 0x22, 0x56, 0x39, 0x13, 0x4f, 0xf,
                   0x2a, 0x88, 0x27, 0x0,  0x0,  0x76, 0x30, 0x18, 0x0,  0x0,  0x27, 0xeb, 0xb,  0x2,  0x15, 0x0,  0x16,
                   0xf2, 0xc9, 0x50, 0x70, 0x36, 0x3d, 0x8,  0x3f, 0x4c, 0xe8, 0xce, 0x7,  0x14, 0x37, 0xa8, 0x26, 0x82,
                   0xa7, 0x1a, 0xea, 0xed, 0x8f, 0x67, 0x9,  0x3f, 0xc7, 0x1,  0x58, 0x80, 0x9e, 0x5f};

  uint8_t buf[143] = {0};

  uint8_t topic_bytes[] = {0x28, 0xd9, 0xf4, 0x4,  0xe0, 0x88, 0xe8, 0xe1, 0xf8, 0x51, 0xed, 0xf0, 0x8a,
                           0xbb, 0x98, 0xb,  0x3c, 0xc2, 0xd8, 0x42, 0x9e, 0x16, 0x9e, 0xcb, 0x74, 0xcd};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x67, 0x9, 0x3f, 0xc7, 0x1, 0x58, 0x80, 0x9e, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops1[] = {0xb6, 0xfd};
  uint8_t bytesprops0[] = {0x70, 0x14, 0x9e, 0xa7, 0x31, 0x75, 0xc8, 0x1c, 0x91, 0x71, 0x17,
                           0xb3, 0xd9, 0x6d, 0xb2, 0x4b, 0x2,  0x50, 0xa9, 0xd8, 0x4e};
  uint8_t bytesprops2[] = {0xf2, 0xc9, 0x50, 0x70, 0x36, 0x3d, 0x8,  0x3f, 0x4c, 0xe8, 0xce,
                           0x7,  0x14, 0x37, 0xa8, 0x26, 0x82, 0xa7, 0x1a, 0xea, 0xed, 0x8f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops0}, .v = {2, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32094}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30000}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25741}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22073}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20239}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30256}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10219}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 13686, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "FL\240\156\182\192\&3\212\166\234!\162i#\233\190}'N\176", _pubPktID = 7951, _pubBody =
// "\246\168g\152\239\&8\214\227\217R=w3\173\155\210Y\155@", _pubProps = [PropRetainAvailable
// 78,PropAssignedClientIdentifier
// "k\233\247\216l5n\202N\233\218\\\DC4\241\173/{\249\239C\ACK\214Z\218\204",PropRequestResponseInformation
// 204,PropReasonString "\136+\156",PropRetainAvailable 111,PropRequestProblemInformation 233,PropTopicAlias
// 5145,PropServerReference
// "p\RS2\145\232}\145\DC1#P\152-\DEL\137(UV\v\183F\245\209\241l\143\130\244k",PropServerReference
// "B\ad\148\164\235\140\t\145\171nR "]}
TEST(Publish5QCTest, Encode91) {
  uint8_t pkt[] = {0x3c, 0x88, 0x1,  0x0,  0x14, 0x46, 0x4c, 0xf0, 0x9c, 0xb6, 0xc0, 0x33, 0xd4, 0xa6, 0xea, 0x21,
                   0xa2, 0x69, 0x23, 0xe9, 0xbe, 0x7d, 0x27, 0x4e, 0xb0, 0x1f, 0xf,  0x5c, 0x25, 0x4e, 0x12, 0x0,
                   0x19, 0x6b, 0xe9, 0xf7, 0xd8, 0x6c, 0x35, 0x6e, 0xca, 0x4e, 0xe9, 0xda, 0x5c, 0x14, 0xf1, 0xad,
                   0x2f, 0x7b, 0xf9, 0xef, 0x43, 0x6,  0xd6, 0x5a, 0xda, 0xcc, 0x19, 0xcc, 0x1f, 0x0,  0x3,  0x88,
                   0x2b, 0x9c, 0x25, 0x6f, 0x17, 0xe9, 0x23, 0x14, 0x19, 0x1c, 0x0,  0x1c, 0x70, 0x1e, 0x32, 0x91,
                   0xe8, 0x7d, 0x91, 0x11, 0x23, 0x50, 0x98, 0x2d, 0x7f, 0x89, 0x28, 0x55, 0x56, 0xb,  0xb7, 0x46,
                   0xf5, 0xd1, 0xf1, 0x6c, 0x8f, 0x82, 0xf4, 0x6b, 0x1c, 0x0,  0xd,  0x42, 0x7,  0x64, 0x94, 0xa4,
                   0xeb, 0x8c, 0x9,  0x91, 0xab, 0x6e, 0x52, 0x20, 0xf6, 0xa8, 0x67, 0x98, 0xef, 0x38, 0xd6, 0xe3,
                   0xd9, 0x52, 0x3d, 0x77, 0x33, 0xad, 0x9b, 0xd2, 0x59, 0x9b, 0x40};

  uint8_t buf[149] = {0};

  uint8_t topic_bytes[] = {0x46, 0x4c, 0xf0, 0x9c, 0xb6, 0xc0, 0x33, 0xd4, 0xa6, 0xea,
                           0x21, 0xa2, 0x69, 0x23, 0xe9, 0xbe, 0x7d, 0x27, 0x4e, 0xb0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf6, 0xa8, 0x67, 0x98, 0xef, 0x38, 0xd6, 0xe3, 0xd9, 0x52,
                         0x3d, 0x77, 0x33, 0xad, 0x9b, 0xd2, 0x59, 0x9b, 0x40};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x6b, 0xe9, 0xf7, 0xd8, 0x6c, 0x35, 0x6e, 0xca, 0x4e, 0xe9, 0xda, 0x5c, 0x14,
                           0xf1, 0xad, 0x2f, 0x7b, 0xf9, 0xef, 0x43, 0x6,  0xd6, 0x5a, 0xda, 0xcc};
  uint8_t bytesprops1[] = {0x88, 0x2b, 0x9c};
  uint8_t bytesprops2[] = {0x70, 0x1e, 0x32, 0x91, 0xe8, 0x7d, 0x91, 0x11, 0x23, 0x50, 0x98, 0x2d, 0x7f, 0x89,
                           0x28, 0x55, 0x56, 0xb,  0xb7, 0x46, 0xf5, 0xd1, 0xf1, 0x6c, 0x8f, 0x82, 0xf4, 0x6b};
  uint8_t bytesprops3[] = {0x42, 0x7, 0x64, 0x94, 0xa4, 0xeb, 0x8c, 0x9, 0x91, 0xab, 0x6e, 0x52, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5145}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\232\175\EOT\145\DEL\254\166\230\212MM\131\&6R\177A\217", _pubPktID = 26125, _pubBody = "\229\&1", _pubProps =
// [PropSharedSubscriptionAvailable 46,PropMaximumQoS 133,PropSubscriptionIdentifierAvailable 212,PropServerReference
// "\130",PropReasonString
// "7\133A>\210\220\244\f\237\128\185D\173\ETB\170U\DC3A>\230\237x\128N.\SYN:\251\202",PropAssignedClientIdentifier
// "\153\EOT\231\185\244",PropContentType
// "\251\DC3T\201\219(ozL\219g\201\166S\205\144=\f\n\194A\USQ(\219\161\162E\244\228",PropAuthenticationMethod
// "",PropTopicAlias 20730,PropAssignedClientIdentifier "R\242\197\138Z\246x\140\161\203",PropServerKeepAlive
// 7460,PropUserProperty "-m\162\172\254F\156\234&v\142\166\RS_\141\217\201\164C\152\DC3\212\224\154"
// "2\153M\249\129",PropSessionExpiryInterval 20348,PropCorrelationData
// "\184z\132\132\173\239\168\SO\194\153wk\211P\179;\246OS\ETB",PropAuthenticationData "",PropContentType
// "\213\&2\RS",PropSessionExpiryInterval 31013,PropReceiveMaximum 10571,PropResponseInformation
// "\168\239\b\253\212\129]\158\154\SI\143\ESC\242\245\163\211\205\185\203\175s\142\181rX\225\240",PropReceiveMaximum
// 11056,PropMaximumPacketSize 22864,PropReasonString
// "\209m\142\246+L\157\ETB\151\201b.\ETX\239\163\140\bhD\202\NAK\255\139j\214\199"]}
TEST(Publish5QCTest, Encode92) {
  uint8_t pkt[] = {
      0x35, 0x94, 0x2,  0x0,  0x11, 0xe8, 0xaf, 0x4,  0x91, 0x7f, 0xfe, 0xa6, 0xe6, 0xd4, 0x4d, 0x4d, 0x83, 0x36, 0x52,
      0xb1, 0x41, 0xd9, 0x66, 0xd,  0xfb, 0x1,  0x2a, 0x2e, 0x24, 0x85, 0x29, 0xd4, 0x1c, 0x0,  0x1,  0x82, 0x1f, 0x0,
      0x1d, 0x37, 0x85, 0x41, 0x3e, 0xd2, 0xdc, 0xf4, 0xc,  0xed, 0x80, 0xb9, 0x44, 0xad, 0x17, 0xaa, 0x55, 0x13, 0x41,
      0x3e, 0xe6, 0xed, 0x78, 0x80, 0x4e, 0x2e, 0x16, 0x3a, 0xfb, 0xca, 0x12, 0x0,  0x5,  0x99, 0x4,  0xe7, 0xb9, 0xf4,
      0x3,  0x0,  0x1e, 0xfb, 0x13, 0x54, 0xc9, 0xdb, 0x28, 0x6f, 0x7a, 0x4c, 0xdb, 0x67, 0xc9, 0xa6, 0x53, 0xcd, 0x90,
      0x3d, 0xc,  0xa,  0xc2, 0x41, 0x1f, 0x51, 0x28, 0xdb, 0xa1, 0xa2, 0x45, 0xf4, 0xe4, 0x15, 0x0,  0x0,  0x23, 0x50,
      0xfa, 0x12, 0x0,  0xa,  0x52, 0xf2, 0xc5, 0x8a, 0x5a, 0xf6, 0x78, 0x8c, 0xa1, 0xcb, 0x13, 0x1d, 0x24, 0x26, 0x0,
      0x18, 0x2d, 0x6d, 0xa2, 0xac, 0xfe, 0x46, 0x9c, 0xea, 0x26, 0x76, 0x8e, 0xa6, 0x1e, 0x5f, 0x8d, 0xd9, 0xc9, 0xa4,
      0x43, 0x98, 0x13, 0xd4, 0xe0, 0x9a, 0x0,  0x5,  0x32, 0x99, 0x4d, 0xf9, 0x81, 0x11, 0x0,  0x0,  0x4f, 0x7c, 0x9,
      0x0,  0x14, 0xb8, 0x7a, 0x84, 0x84, 0xad, 0xef, 0xa8, 0xe,  0xc2, 0x99, 0x77, 0x6b, 0xd3, 0x50, 0xb3, 0x3b, 0xf6,
      0x4f, 0x53, 0x17, 0x16, 0x0,  0x0,  0x3,  0x0,  0x3,  0xd5, 0x32, 0x1e, 0x11, 0x0,  0x0,  0x79, 0x25, 0x21, 0x29,
      0x4b, 0x1a, 0x0,  0x1b, 0xa8, 0xef, 0x8,  0xfd, 0xd4, 0x81, 0x5d, 0x9e, 0x9a, 0xf,  0x8f, 0x1b, 0xf2, 0xf5, 0xa3,
      0xd3, 0xcd, 0xb9, 0xcb, 0xaf, 0x73, 0x8e, 0xb5, 0x72, 0x58, 0xe1, 0xf0, 0x21, 0x2b, 0x30, 0x27, 0x0,  0x0,  0x59,
      0x50, 0x1f, 0x0,  0x1a, 0xd1, 0x6d, 0x8e, 0xf6, 0x2b, 0x4c, 0x9d, 0x17, 0x97, 0xc9, 0x62, 0x2e, 0x3,  0xef, 0xa3,
      0x8c, 0x8,  0x68, 0x44, 0xca, 0x15, 0xff, 0x8b, 0x6a, 0xd6, 0xc7, 0xe5, 0x31};

  uint8_t buf[289] = {0};

  uint8_t topic_bytes[] = {0xe8, 0xaf, 0x4,  0x91, 0x7f, 0xfe, 0xa6, 0xe6, 0xd4,
                           0x4d, 0x4d, 0x83, 0x36, 0x52, 0xb1, 0x41, 0xd9};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe5, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0x82};
  uint8_t bytesprops1[] = {0x37, 0x85, 0x41, 0x3e, 0xd2, 0xdc, 0xf4, 0xc,  0xed, 0x80, 0xb9, 0x44, 0xad, 0x17, 0xaa,
                           0x55, 0x13, 0x41, 0x3e, 0xe6, 0xed, 0x78, 0x80, 0x4e, 0x2e, 0x16, 0x3a, 0xfb, 0xca};
  uint8_t bytesprops2[] = {0x99, 0x4, 0xe7, 0xb9, 0xf4};
  uint8_t bytesprops3[] = {0xfb, 0x13, 0x54, 0xc9, 0xdb, 0x28, 0x6f, 0x7a, 0x4c, 0xdb, 0x67, 0xc9, 0xa6, 0x53, 0xcd,
                           0x90, 0x3d, 0xc,  0xa,  0xc2, 0x41, 0x1f, 0x51, 0x28, 0xdb, 0xa1, 0xa2, 0x45, 0xf4, 0xe4};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0x52, 0xf2, 0xc5, 0x8a, 0x5a, 0xf6, 0x78, 0x8c, 0xa1, 0xcb};
  uint8_t bytesprops7[] = {0x32, 0x99, 0x4d, 0xf9, 0x81};
  uint8_t bytesprops6[] = {0x2d, 0x6d, 0xa2, 0xac, 0xfe, 0x46, 0x9c, 0xea, 0x26, 0x76, 0x8e, 0xa6,
                           0x1e, 0x5f, 0x8d, 0xd9, 0xc9, 0xa4, 0x43, 0x98, 0x13, 0xd4, 0xe0, 0x9a};
  uint8_t bytesprops8[] = {0xb8, 0x7a, 0x84, 0x84, 0xad, 0xef, 0xa8, 0xe,  0xc2, 0x99,
                           0x77, 0x6b, 0xd3, 0x50, 0xb3, 0x3b, 0xf6, 0x4f, 0x53, 0x17};
  uint8_t bytesprops9[] = {0};
  uint8_t bytesprops10[] = {0xd5, 0x32, 0x1e};
  uint8_t bytesprops11[] = {0xa8, 0xef, 0x8,  0xfd, 0xd4, 0x81, 0x5d, 0x9e, 0x9a, 0xf,  0x8f, 0x1b, 0xf2, 0xf5,
                            0xa3, 0xd3, 0xcd, 0xb9, 0xcb, 0xaf, 0x73, 0x8e, 0xb5, 0x72, 0x58, 0xe1, 0xf0};
  uint8_t bytesprops12[] = {0xd1, 0x6d, 0x8e, 0xf6, 0x2b, 0x4c, 0x9d, 0x17, 0x97, 0xc9, 0x62, 0x2e, 0x3,
                            0xef, 0xa3, 0x8c, 0x8,  0x68, 0x44, 0xca, 0x15, 0xff, 0x8b, 0x6a, 0xd6, 0xc7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20730}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7460}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops6}, .v = {5, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20348}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31013}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10571}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11056}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22864}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 26125, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\249\223\224\153M\215\191\241/z\197=\210\196\197T-", _pubPktID = 4023, _pubBody = "\146G", _pubProps =
// [PropRetainAvailable 91,PropMessageExpiryInterval 9270,PropReceiveMaximum 4788]}
TEST(Publish5QCTest, Encode93) {
  uint8_t pkt[] = {0x32, 0x22, 0x0,  0x11, 0xf9, 0xdf, 0xe0, 0x99, 0x4d, 0xd7, 0xbf, 0xf1,
                   0x2f, 0x7a, 0xc5, 0x3d, 0xd2, 0xc4, 0xc5, 0x54, 0x2d, 0xf,  0xb7, 0xa,
                   0x25, 0x5b, 0x2,  0x0,  0x0,  0x24, 0x36, 0x21, 0x12, 0xb4, 0x92, 0x47};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0xf9, 0xdf, 0xe0, 0x99, 0x4d, 0xd7, 0xbf, 0xf1, 0x2f,
                           0x7a, 0xc5, 0x3d, 0xd2, 0xc4, 0xc5, 0x54, 0x2d};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x92, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9270}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4788}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 4023, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "1\188?\134-\151\130\165\DC3\149\&0\188\151\r\192q\134Wi\255\238\204\193\225\205\231\164", _pubPktID = 3250, _pubBody
// = "\209\151\165\147\252]\131\r\145p\242\&6\155z\255", _pubProps = [PropMaximumQoS 34,PropSubscriptionIdentifier
// 27,PropContentType "\218\230\197\bgVnD#\155\136\193\208\141\230x\174\130>\196\179v\239r]",PropMessageExpiryInterval
// 32234,PropResponseTopic "bA\ACKy\246\186\239\153X6`\155\SYNi",PropAuthenticationMethod
// "\an|$3\239\231\240R",PropMaximumPacketSize 14841]}
TEST(Publish5QCTest, Encode94) {
  uint8_t pkt[] = {0x35, 0x76, 0x0,  0x1b, 0x31, 0xbc, 0x3f, 0x86, 0x2d, 0x97, 0x82, 0xa5, 0x13, 0x95, 0x30,
                   0xbc, 0x97, 0xd,  0xc0, 0x71, 0x86, 0x57, 0x69, 0xff, 0xee, 0xcc, 0xc1, 0xe1, 0xcd, 0xe7,
                   0xa4, 0xc,  0xb2, 0x47, 0x24, 0x22, 0xb,  0x1b, 0x3,  0x0,  0x19, 0xda, 0xe6, 0xc5, 0x8,
                   0x67, 0x56, 0x6e, 0x44, 0x23, 0x9b, 0x88, 0xc1, 0xd0, 0x8d, 0xe6, 0x78, 0xae, 0x82, 0x3e,
                   0xc4, 0xb3, 0x76, 0xef, 0x72, 0x5d, 0x2,  0x0,  0x0,  0x7d, 0xea, 0x8,  0x0,  0xe,  0x62,
                   0x41, 0x6,  0x79, 0xf6, 0xba, 0xef, 0x99, 0x58, 0x36, 0x60, 0x9b, 0x16, 0x69, 0x15, 0x0,
                   0x9,  0x7,  0x6e, 0x7c, 0x24, 0x33, 0xef, 0xe7, 0xf0, 0x52, 0x27, 0x0,  0x0,  0x39, 0xf9,
                   0xd1, 0x97, 0xa5, 0x93, 0xfc, 0x5d, 0x83, 0xd,  0x91, 0x70, 0xf2, 0x36, 0x9b, 0x7a, 0xff};

  uint8_t buf[130] = {0};

  uint8_t topic_bytes[] = {0x31, 0xbc, 0x3f, 0x86, 0x2d, 0x97, 0x82, 0xa5, 0x13, 0x95, 0x30, 0xbc, 0x97, 0xd,
                           0xc0, 0x71, 0x86, 0x57, 0x69, 0xff, 0xee, 0xcc, 0xc1, 0xe1, 0xcd, 0xe7, 0xa4};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd1, 0x97, 0xa5, 0x93, 0xfc, 0x5d, 0x83, 0xd, 0x91, 0x70, 0xf2, 0x36, 0x9b, 0x7a, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0xda, 0xe6, 0xc5, 0x8,  0x67, 0x56, 0x6e, 0x44, 0x23, 0x9b, 0x88, 0xc1, 0xd0,
                           0x8d, 0xe6, 0x78, 0xae, 0x82, 0x3e, 0xc4, 0xb3, 0x76, 0xef, 0x72, 0x5d};
  uint8_t bytesprops1[] = {0x62, 0x41, 0x6, 0x79, 0xf6, 0xba, 0xef, 0x99, 0x58, 0x36, 0x60, 0x9b, 0x16, 0x69};
  uint8_t bytesprops2[] = {0x7, 0x6e, 0x7c, 0x24, 0x33, 0xef, 0xe7, 0xf0, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32234}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14841}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 3250, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\149y\148\SOH\133\136\STX\n\242",
// _pubPktID = 27162, _pubBody =
// "\163\212\196\ENQ\196\186w\152\RS\219\243>k~\167\130o^\157\\\197C\128\130\185\247\201\148C\197", _pubProps =
// [PropTopicAlias 16230,PropWillDelayInterval 28392,PropAuthenticationData
// "\194\t7\142\236\197<\157\209\220\232\r\142\ETB[\239\183\144\179\SYN\140\f\246\255\&8",PropWildcardSubscriptionAvailable
// 163,PropSharedSubscriptionAvailable 254,PropResponseInformation
// "\200\228\&8e;V\178p^\188I\\<={t\234n\154,\230\253\CAN#/\197\236\174\246",PropSessionExpiryInterval
// 4151,PropMaximumQoS 240]}
TEST(Publish5QCTest, Encode95) {
  uint8_t pkt[] = {0x3b, 0x7b, 0x0,  0x9,  0x95, 0x79, 0x94, 0x1,  0x85, 0x88, 0x2,  0xa,  0xf2, 0x6a, 0x1a, 0x4f,
                   0x23, 0x3f, 0x66, 0x18, 0x0,  0x0,  0x6e, 0xe8, 0x16, 0x0,  0x19, 0xc2, 0x9,  0x37, 0x8e, 0xec,
                   0xc5, 0x3c, 0x9d, 0xd1, 0xdc, 0xe8, 0xd,  0x8e, 0x17, 0x5b, 0xef, 0xb7, 0x90, 0xb3, 0x16, 0x8c,
                   0xc,  0xf6, 0xff, 0x38, 0x28, 0xa3, 0x2a, 0xfe, 0x1a, 0x0,  0x1d, 0xc8, 0xe4, 0x38, 0x65, 0x3b,
                   0x56, 0xb2, 0x70, 0x5e, 0xbc, 0x49, 0x5c, 0x3c, 0x3d, 0x7b, 0x74, 0xea, 0x6e, 0x9a, 0x2c, 0xe6,
                   0xfd, 0x18, 0x23, 0x2f, 0xc5, 0xec, 0xae, 0xf6, 0x11, 0x0,  0x0,  0x10, 0x37, 0x24, 0xf0, 0xa3,
                   0xd4, 0xc4, 0x5,  0xc4, 0xba, 0x77, 0x98, 0x1e, 0xdb, 0xf3, 0x3e, 0x6b, 0x7e, 0xa7, 0x82, 0x6f,
                   0x5e, 0x9d, 0x5c, 0xc5, 0x43, 0x80, 0x82, 0xb9, 0xf7, 0xc9, 0x94, 0x43, 0xc5};

  uint8_t buf[135] = {0};

  uint8_t topic_bytes[] = {0x95, 0x79, 0x94, 0x1, 0x85, 0x88, 0x2, 0xa, 0xf2};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa3, 0xd4, 0xc4, 0x5,  0xc4, 0xba, 0x77, 0x98, 0x1e, 0xdb, 0xf3, 0x3e, 0x6b, 0x7e, 0xa7,
                         0x82, 0x6f, 0x5e, 0x9d, 0x5c, 0xc5, 0x43, 0x80, 0x82, 0xb9, 0xf7, 0xc9, 0x94, 0x43, 0xc5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xc2, 0x9,  0x37, 0x8e, 0xec, 0xc5, 0x3c, 0x9d, 0xd1, 0xdc, 0xe8, 0xd, 0x8e,
                           0x17, 0x5b, 0xef, 0xb7, 0x90, 0xb3, 0x16, 0x8c, 0xc,  0xf6, 0xff, 0x38};
  uint8_t bytesprops1[] = {0xc8, 0xe4, 0x38, 0x65, 0x3b, 0x56, 0xb2, 0x70, 0x5e, 0xbc, 0x49, 0x5c, 0x3c, 0x3d, 0x7b,
                           0x74, 0xea, 0x6e, 0x9a, 0x2c, 0xe6, 0xfd, 0x18, 0x23, 0x2f, 0xc5, 0xec, 0xae, 0xf6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16230}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28392}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4151}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 240}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 27162, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\133\236\215", _pubPktID = 29262,
// _pubBody = "\150|7\US\164%\USi\129\ACK\161\142\139\207", _pubProps = [PropContentType
// "\220\b<+\DC3\245\ENQ\200\DEL0s\138b\223\245\&6\GS\190\149\182\DC3m\180\142<\181",PropMaximumQoS
// 238,PropWillDelayInterval 4046,PropAssignedClientIdentifier "\150\174\238\247^",PropMessageExpiryInterval
// 19374,PropServerKeepAlive 30717,PropMaximumPacketSize 22891,PropSharedSubscriptionAvailable
// 29,PropPayloadFormatIndicator 133,PropServerKeepAlive 16285,PropRequestResponseInformation 123,PropReasonString
// "",PropRequestProblemInformation 107,PropSharedSubscriptionAvailable 60,PropSharedSubscriptionAvailable
// 98,PropTopicAlias 27866,PropServerReference "\235-\158\236<Z",PropSubscriptionIdentifierAvailable
// 144,PropUserProperty "k\180\236FN\245H\240\216\237\254X2Yt\\Vm\205\FSvT\178{"
// "\240r\227D\163",PropPayloadFormatIndicator 251,PropWildcardSubscriptionAvailable 89,PropAssignedClientIdentifier
// "e\251\f\200\237>\241\n"]}
TEST(Publish5QCTest, Encode96) {
  uint8_t pkt[] = {0x35, 0xa1, 0x1,  0x0,  0x3,  0x85, 0xec, 0xd7, 0x72, 0x4e, 0x8a, 0x1,  0x3,  0x0,  0x1a, 0xdc, 0x8,
                   0x3c, 0x2b, 0x13, 0xf5, 0x5,  0xc8, 0x7f, 0x30, 0x73, 0x8a, 0x62, 0xdf, 0xf5, 0x36, 0x1d, 0xbe, 0x95,
                   0xb6, 0x13, 0x6d, 0xb4, 0x8e, 0x3c, 0xb5, 0x24, 0xee, 0x18, 0x0,  0x0,  0xf,  0xce, 0x12, 0x0,  0x5,
                   0x96, 0xae, 0xee, 0xf7, 0x5e, 0x2,  0x0,  0x0,  0x4b, 0xae, 0x13, 0x77, 0xfd, 0x27, 0x0,  0x0,  0x59,
                   0x6b, 0x2a, 0x1d, 0x1,  0x85, 0x13, 0x3f, 0x9d, 0x19, 0x7b, 0x1f, 0x0,  0x0,  0x17, 0x6b, 0x2a, 0x3c,
                   0x2a, 0x62, 0x23, 0x6c, 0xda, 0x1c, 0x0,  0x6,  0xeb, 0x2d, 0x9e, 0xec, 0x3c, 0x5a, 0x29, 0x90, 0x26,
                   0x0,  0x18, 0x6b, 0xb4, 0xec, 0x46, 0x4e, 0xf5, 0x48, 0xf0, 0xd8, 0xed, 0xfe, 0x58, 0x32, 0x59, 0x74,
                   0x5c, 0x56, 0x6d, 0xcd, 0x1c, 0x76, 0x54, 0xb2, 0x7b, 0x0,  0x5,  0xf0, 0x72, 0xe3, 0x44, 0xa3, 0x1,
                   0xfb, 0x28, 0x59, 0x12, 0x0,  0x8,  0x65, 0xfb, 0xc,  0xc8, 0xed, 0x3e, 0xf1, 0xa,  0x96, 0x7c, 0x37,
                   0x1f, 0xa4, 0x25, 0x1f, 0x69, 0x81, 0x6,  0xa1, 0x8e, 0x8b, 0xcf};

  uint8_t buf[174] = {0};

  uint8_t topic_bytes[] = {0x85, 0xec, 0xd7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x96, 0x7c, 0x37, 0x1f, 0xa4, 0x25, 0x1f, 0x69, 0x81, 0x6, 0xa1, 0x8e, 0x8b, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xdc, 0x8,  0x3c, 0x2b, 0x13, 0xf5, 0x5,  0xc8, 0x7f, 0x30, 0x73, 0x8a, 0x62,
                           0xdf, 0xf5, 0x36, 0x1d, 0xbe, 0x95, 0xb6, 0x13, 0x6d, 0xb4, 0x8e, 0x3c, 0xb5};
  uint8_t bytesprops1[] = {0x96, 0xae, 0xee, 0xf7, 0x5e};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0xeb, 0x2d, 0x9e, 0xec, 0x3c, 0x5a};
  uint8_t bytesprops5[] = {0xf0, 0x72, 0xe3, 0x44, 0xa3};
  uint8_t bytesprops4[] = {0x6b, 0xb4, 0xec, 0x46, 0x4e, 0xf5, 0x48, 0xf0, 0xd8, 0xed, 0xfe, 0x58,
                           0x32, 0x59, 0x74, 0x5c, 0x56, 0x6d, 0xcd, 0x1c, 0x76, 0x54, 0xb2, 0x7b};
  uint8_t bytesprops6[] = {0x65, 0xfb, 0xc, 0xc8, 0xed, 0x3e, 0xf1, 0xa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4046}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19374}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30717}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22891}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16285}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27866}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops4}, .v = {5, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29262, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "5b0\195\142R\129\205", _pubPktID =
// 25975, _pubBody = ":\135\203\145\&6\148\180\155\&28\243", _pubProps = [PropSubscriptionIdentifier 1]}
TEST(Publish5QCTest, Encode97) {
  uint8_t pkt[] = {0x33, 0x1a, 0x0, 0x8,  0x35, 0x62, 0x30, 0xc3, 0x8e, 0x52, 0x81, 0xcd, 0x65, 0x77,
                   0x2,  0xb,  0x1, 0x3a, 0x87, 0xcb, 0x91, 0x36, 0x94, 0xb4, 0x9b, 0x32, 0x38, 0xf3};

  uint8_t buf[38] = {0};

  uint8_t topic_bytes[] = {0x35, 0x62, 0x30, 0xc3, 0x8e, 0x52, 0x81, 0xcd};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3a, 0x87, 0xcb, 0x91, 0x36, 0x94, 0xb4, 0x9b, 0x32, 0x38, 0xf3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25975, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\213Jr\201\234\223\158\NULA\172F$x\203\226", _pubPktID = 5740, _pubBody =
// "\v\DC4\158\192\171F\249\ESC\192U\254\"\152\151", _pubProps = [PropTopicAliasMaximum 31021,PropPayloadFormatIndicator
// 129,PropWildcardSubscriptionAvailable 110,PropAuthenticationMethod
// "\165\200\f\130\b\178\175\170\160d\253\186g\214L\t\181\NUL\152",PropMaximumPacketSize 18785,PropRetainAvailable
// 128,PropTopicAliasMaximum 8682,PropWildcardSubscriptionAvailable 123,PropAuthenticationMethod
// "\170\169\r\206<\NAKs\FS98\163\187\DC1Mx6\183M\238'\SINNHu\164",PropPayloadFormatIndicator
// 120,PropSubscriptionIdentifier 7,PropAssignedClientIdentifier "\SUBf\240.[8-c\173\240\&8\EOT\EM\n",PropResponseTopic
// "\224\198",PropServerReference
// "\200\132\249\200\203\DC4\239D\205\172\185P\173\210,c\159\137IC\224M.e\159\253\225",PropSessionExpiryInterval
// 27500,PropRequestProblemInformation 55,PropResponseTopic
// "\161\168\&9\SYN\215\203A\129\143_\183\204u\NUL#M\142\CAN\ap\167",PropAuthenticationMethod "",PropCorrelationData
// "\159\NAK=\"ew\SYN3\246\164b|\ETB\NUL{\139\190\200\182\ETX\251Nq\144\129\SYN\212Q",PropUserProperty
// "\DC1\190\247\SI\225" "z\fT\SUB[\229\135xjol\223\DLE\195\189\158\SYN\DC3\191{q\190\f^^\227<\243",PropMaximumQoS
// 49,PropServerKeepAlive 14505,PropRetainAvailable 171,PropResponseTopic
// "\240\EOT\255\SO\251\&3B\213",PropServerKeepAlive 26936,PropServerKeepAlive 24077,PropResponseTopic
// "P\206\198\253\163 \185\184\ENQ\207\188\189\141cf1",PropContentType "\189\168j~b\168",PropSharedSubscriptionAvailable
// 178,PropWildcardSubscriptionAvailable 218]}
TEST(Publish5QCTest, Encode98) {
  uint8_t pkt[] = {
      0x3b, 0xc0, 0x2,  0x0,  0xf,  0xd5, 0x4a, 0x72, 0xc9, 0xea, 0xdf, 0x9e, 0x0,  0x41, 0xac, 0x46, 0x24, 0x78, 0xcb,
      0xe2, 0x16, 0x6c, 0x9d, 0x2,  0x22, 0x79, 0x2d, 0x1,  0x81, 0x28, 0x6e, 0x15, 0x0,  0x13, 0xa5, 0xc8, 0xc,  0x82,
      0x8,  0xb2, 0xaf, 0xaa, 0xa0, 0x64, 0xfd, 0xba, 0x67, 0xd6, 0x4c, 0x9,  0xb5, 0x0,  0x98, 0x27, 0x0,  0x0,  0x49,
      0x61, 0x25, 0x80, 0x22, 0x21, 0xea, 0x28, 0x7b, 0x15, 0x0,  0x1a, 0xaa, 0xa9, 0xd,  0xce, 0x3c, 0x15, 0x73, 0x1c,
      0x39, 0x38, 0xa3, 0xbb, 0x11, 0x4d, 0x78, 0x36, 0xb7, 0x4d, 0xee, 0x27, 0xf,  0x4e, 0x4e, 0x48, 0x75, 0xa4, 0x1,
      0x78, 0xb,  0x7,  0x12, 0x0,  0xe,  0x1a, 0x66, 0xf0, 0x2e, 0x5b, 0x38, 0x2d, 0x63, 0xad, 0xf0, 0x38, 0x4,  0x19,
      0xa,  0x8,  0x0,  0x2,  0xe0, 0xc6, 0x1c, 0x0,  0x1b, 0xc8, 0x84, 0xf9, 0xc8, 0xcb, 0x14, 0xef, 0x44, 0xcd, 0xac,
      0xb9, 0x50, 0xad, 0xd2, 0x2c, 0x63, 0x9f, 0x89, 0x49, 0x43, 0xe0, 0x4d, 0x2e, 0x65, 0x9f, 0xfd, 0xe1, 0x11, 0x0,
      0x0,  0x6b, 0x6c, 0x17, 0x37, 0x8,  0x0,  0x15, 0xa1, 0xa8, 0x39, 0x16, 0xd7, 0xcb, 0x41, 0x81, 0x8f, 0x5f, 0xb7,
      0xcc, 0x75, 0x0,  0x23, 0x4d, 0x8e, 0x18, 0x7,  0x70, 0xa7, 0x15, 0x0,  0x0,  0x9,  0x0,  0x1c, 0x9f, 0x15, 0x3d,
      0x22, 0x65, 0x77, 0x16, 0x33, 0xf6, 0xa4, 0x62, 0x7c, 0x17, 0x0,  0x7b, 0x8b, 0xbe, 0xc8, 0xb6, 0x3,  0xfb, 0x4e,
      0x71, 0x90, 0x81, 0x16, 0xd4, 0x51, 0x26, 0x0,  0x5,  0x11, 0xbe, 0xf7, 0xf,  0xe1, 0x0,  0x1c, 0x7a, 0xc,  0x54,
      0x1a, 0x5b, 0xe5, 0x87, 0x78, 0x6a, 0x6f, 0x6c, 0xdf, 0x10, 0xc3, 0xbd, 0x9e, 0x16, 0x13, 0xbf, 0x7b, 0x71, 0xbe,
      0xc,  0x5e, 0x5e, 0xe3, 0x3c, 0xf3, 0x24, 0x31, 0x13, 0x38, 0xa9, 0x25, 0xab, 0x8,  0x0,  0x8,  0xf0, 0x4,  0xff,
      0xe,  0xfb, 0x33, 0x42, 0xd5, 0x13, 0x69, 0x38, 0x13, 0x5e, 0xd,  0x8,  0x0,  0x10, 0x50, 0xce, 0xc6, 0xfd, 0xa3,
      0x20, 0xb9, 0xb8, 0x5,  0xcf, 0xbc, 0xbd, 0x8d, 0x63, 0x66, 0x31, 0x3,  0x0,  0x6,  0xbd, 0xa8, 0x6a, 0x7e, 0x62,
      0xa8, 0x2a, 0xb2, 0x28, 0xda, 0xb,  0x14, 0x9e, 0xc0, 0xab, 0x46, 0xf9, 0x1b, 0xc0, 0x55, 0xfe, 0x22, 0x98, 0x97};

  uint8_t buf[333] = {0};

  uint8_t topic_bytes[] = {0xd5, 0x4a, 0x72, 0xc9, 0xea, 0xdf, 0x9e, 0x0, 0x41, 0xac, 0x46, 0x24, 0x78, 0xcb, 0xe2};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb, 0x14, 0x9e, 0xc0, 0xab, 0x46, 0xf9, 0x1b, 0xc0, 0x55, 0xfe, 0x22, 0x98, 0x97};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xa5, 0xc8, 0xc,  0x82, 0x8,  0xb2, 0xaf, 0xaa, 0xa0, 0x64,
                           0xfd, 0xba, 0x67, 0xd6, 0x4c, 0x9,  0xb5, 0x0,  0x98};
  uint8_t bytesprops1[] = {0xaa, 0xa9, 0xd,  0xce, 0x3c, 0x15, 0x73, 0x1c, 0x39, 0x38, 0xa3, 0xbb, 0x11,
                           0x4d, 0x78, 0x36, 0xb7, 0x4d, 0xee, 0x27, 0xf,  0x4e, 0x4e, 0x48, 0x75, 0xa4};
  uint8_t bytesprops2[] = {0x1a, 0x66, 0xf0, 0x2e, 0x5b, 0x38, 0x2d, 0x63, 0xad, 0xf0, 0x38, 0x4, 0x19, 0xa};
  uint8_t bytesprops3[] = {0xe0, 0xc6};
  uint8_t bytesprops4[] = {0xc8, 0x84, 0xf9, 0xc8, 0xcb, 0x14, 0xef, 0x44, 0xcd, 0xac, 0xb9, 0x50, 0xad, 0xd2,
                           0x2c, 0x63, 0x9f, 0x89, 0x49, 0x43, 0xe0, 0x4d, 0x2e, 0x65, 0x9f, 0xfd, 0xe1};
  uint8_t bytesprops5[] = {0xa1, 0xa8, 0x39, 0x16, 0xd7, 0xcb, 0x41, 0x81, 0x8f, 0x5f, 0xb7,
                           0xcc, 0x75, 0x0,  0x23, 0x4d, 0x8e, 0x18, 0x7,  0x70, 0xa7};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x9f, 0x15, 0x3d, 0x22, 0x65, 0x77, 0x16, 0x33, 0xf6, 0xa4, 0x62, 0x7c, 0x17, 0x0,
                           0x7b, 0x8b, 0xbe, 0xc8, 0xb6, 0x3,  0xfb, 0x4e, 0x71, 0x90, 0x81, 0x16, 0xd4, 0x51};
  uint8_t bytesprops9[] = {0x7a, 0xc,  0x54, 0x1a, 0x5b, 0xe5, 0x87, 0x78, 0x6a, 0x6f, 0x6c, 0xdf, 0x10, 0xc3,
                           0xbd, 0x9e, 0x16, 0x13, 0xbf, 0x7b, 0x71, 0xbe, 0xc,  0x5e, 0x5e, 0xe3, 0x3c, 0xf3};
  uint8_t bytesprops8[] = {0x11, 0xbe, 0xf7, 0xf, 0xe1};
  uint8_t bytesprops10[] = {0xf0, 0x4, 0xff, 0xe, 0xfb, 0x33, 0x42, 0xd5};
  uint8_t bytesprops11[] = {0x50, 0xce, 0xc6, 0xfd, 0xa3, 0x20, 0xb9, 0xb8,
                            0x5,  0xcf, 0xbc, 0xbd, 0x8d, 0x63, 0x66, 0x31};
  uint8_t bytesprops12[] = {0xbd, 0xa8, 0x6a, 0x7e, 0x62, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31021}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18785}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8682}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27500}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops8}, .v = {28, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14505}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26936}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24077}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 218}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5740, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\t\CAN\145\171\148w\238,P\186\ETBHJo\217H\202\133\175\171.\147\134f\238\240X\231\137", _pubPktID = 1370, _pubBody =
// "`\241\GS\145\216\168\157\253JO\171\208j1]K\RSL<\242\&4", _pubProps = [PropCorrelationData
// "~\SO\252\191",PropTopicAliasMaximum 29794,PropTopicAlias 18581,PropSubscriptionIdentifier 28,PropTopicAliasMaximum
// 24754,PropAssignedClientIdentifier "",PropMessageExpiryInterval 19074,PropSessionExpiryInterval
// 19069,PropCorrelationData "\176\187'QX\\\183\&7\243\230\237",PropRequestResponseInformation 117,PropServerKeepAlive
// 809,PropReasonString "",PropResponseInformation "\227'\148#\197\&8N\193\242\159",PropMessageExpiryInterval
// 9394,PropRequestResponseInformation 20,PropAuthenticationData "=\170\v@\229\161o\202Q\134\184q\165\157n\205"]}
TEST(Publish5QCTest, Encode99) {
  uint8_t pkt[] = {0x32, 0x93, 0x1,  0x0,  0x1d, 0x9,  0x18, 0x91, 0xab, 0x94, 0x77, 0xee, 0x2c, 0x50, 0xba, 0x17, 0x48,
                   0x4a, 0x6f, 0xd9, 0x48, 0xca, 0x85, 0xaf, 0xab, 0x2e, 0x93, 0x86, 0x66, 0xee, 0xf0, 0x58, 0xe7, 0x89,
                   0x5,  0x5a, 0x5c, 0x9,  0x0,  0x4,  0x7e, 0xe,  0xfc, 0xbf, 0x22, 0x74, 0x62, 0x23, 0x48, 0x95, 0xb,
                   0x1c, 0x22, 0x60, 0xb2, 0x12, 0x0,  0x0,  0x2,  0x0,  0x0,  0x4a, 0x82, 0x11, 0x0,  0x0,  0x4a, 0x7d,
                   0x9,  0x0,  0xb,  0xb0, 0xbb, 0x27, 0x51, 0x58, 0x5c, 0xb7, 0x37, 0xf3, 0xe6, 0xed, 0x19, 0x75, 0x13,
                   0x3,  0x29, 0x1f, 0x0,  0x0,  0x1a, 0x0,  0xa,  0xe3, 0x27, 0x94, 0x23, 0xc5, 0x38, 0x4e, 0xc1, 0xf2,
                   0x9f, 0x2,  0x0,  0x0,  0x24, 0xb2, 0x19, 0x14, 0x16, 0x0,  0x10, 0x3d, 0xaa, 0xb,  0x40, 0xe5, 0xa1,
                   0x6f, 0xca, 0x51, 0x86, 0xb8, 0x71, 0xa5, 0x9d, 0x6e, 0xcd, 0x60, 0xf1, 0x1d, 0x91, 0xd8, 0xa8, 0x9d,
                   0xfd, 0x4a, 0x4f, 0xab, 0xd0, 0x6a, 0x31, 0x5d, 0x4b, 0x1e, 0x4c, 0x3c, 0xf2, 0x34};

  uint8_t buf[160] = {0};

  uint8_t topic_bytes[] = {0x9,  0x18, 0x91, 0xab, 0x94, 0x77, 0xee, 0x2c, 0x50, 0xba, 0x17, 0x48, 0x4a, 0x6f, 0xd9,
                           0x48, 0xca, 0x85, 0xaf, 0xab, 0x2e, 0x93, 0x86, 0x66, 0xee, 0xf0, 0x58, 0xe7, 0x89};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x60, 0xf1, 0x1d, 0x91, 0xd8, 0xa8, 0x9d, 0xfd, 0x4a, 0x4f, 0xab,
                         0xd0, 0x6a, 0x31, 0x5d, 0x4b, 0x1e, 0x4c, 0x3c, 0xf2, 0x34};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x7e, 0xe, 0xfc, 0xbf};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xb0, 0xbb, 0x27, 0x51, 0x58, 0x5c, 0xb7, 0x37, 0xf3, 0xe6, 0xed};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xe3, 0x27, 0x94, 0x23, 0xc5, 0x38, 0x4e, 0xc1, 0xf2, 0x9f};
  uint8_t bytesprops5[] = {0x3d, 0xaa, 0xb,  0x40, 0xe5, 0xa1, 0x6f, 0xca,
                           0x51, 0x86, 0xb8, 0x71, 0xa5, 0x9d, 0x6e, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29794}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18581}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24754}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19074}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19069}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 809}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9394}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 1370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164.\DC1\135\131x\231n\143\DC3\247\SYN\189D\158\166\166\171\143\129\137\215", _pubPktID = 27834, _pubBody =
// "e8`\SO\145\RS`\179\229\146", _pubProps = [PropMessageExpiryInterval 10598,PropAuthenticationData
// "\n",PropUserProperty "S\201\134$>\130W\199K\133/\196\210\&5L\ESC,\230W\134"
// "?\245\DLE\245\254\164\162)\238Hbc",PropReasonString "\196\&5\176mF=\\",PropCorrelationData
// ";%\255=\149.A\207\233\235&m]\182->=r<@\139\252\vD<",PropResponseInformation
// "\137\155\145\173\231\SI]2z\219c\194\166\DEL{g",PropAuthenticationMethod
// "P\193G\237]\163jl\206\229\&6m\250C*:\141>7\157\139\128\161\EM\128?,a=\168",PropCorrelationData
// "\155\137\206\235\179\166\196'y\DC2:P\133l\SUB\171",PropReceiveMaximum 18094,PropRequestProblemInformation
// 7,PropTopicAlias 25296,PropSessionExpiryInterval 22146,PropPayloadFormatIndicator 34,PropRetainAvailable
// 111,PropContentType "\170\208\249OW\147"]}
TEST(Publish5QCTest, Encode100) {
  uint8_t pkt[] = {
      0x3b, 0xdb, 0x1,  0x0,  0x16, 0xa4, 0x2e, 0x11, 0x87, 0x83, 0x78, 0xe7, 0x6e, 0x8f, 0x13, 0xf7, 0x16, 0xbd, 0x44,
      0x9e, 0xa6, 0xa6, 0xab, 0x8f, 0x81, 0x89, 0xd7, 0x6c, 0xba, 0xb5, 0x1,  0x2,  0x0,  0x0,  0x29, 0x66, 0x16, 0x0,
      0x1,  0xa,  0x26, 0x0,  0x14, 0x53, 0xc9, 0x86, 0x24, 0x3e, 0x82, 0x57, 0xc7, 0x4b, 0x85, 0x2f, 0xc4, 0xd2, 0x35,
      0x4c, 0x1b, 0x2c, 0xe6, 0x57, 0x86, 0x0,  0xc,  0x3f, 0xf5, 0x10, 0xf5, 0xfe, 0xa4, 0xa2, 0x29, 0xee, 0x48, 0x62,
      0x63, 0x1f, 0x0,  0x7,  0xc4, 0x35, 0xb0, 0x6d, 0x46, 0x3d, 0x5c, 0x9,  0x0,  0x19, 0x3b, 0x25, 0xff, 0x3d, 0x95,
      0x2e, 0x41, 0xcf, 0xe9, 0xeb, 0x26, 0x6d, 0x5d, 0xb6, 0x2d, 0x3e, 0x3d, 0x72, 0x3c, 0x40, 0x8b, 0xfc, 0xb,  0x44,
      0x3c, 0x1a, 0x0,  0x10, 0x89, 0x9b, 0x91, 0xad, 0xe7, 0xf,  0x5d, 0x32, 0x7a, 0xdb, 0x63, 0xc2, 0xa6, 0x7f, 0x7b,
      0x67, 0x15, 0x0,  0x1e, 0x50, 0xc1, 0x47, 0xed, 0x5d, 0xa3, 0x6a, 0x6c, 0xce, 0xe5, 0x36, 0x6d, 0xfa, 0x43, 0x2a,
      0x3a, 0x8d, 0x3e, 0x37, 0x9d, 0x8b, 0x80, 0xa1, 0x19, 0x80, 0x3f, 0x2c, 0x61, 0x3d, 0xa8, 0x9,  0x0,  0x10, 0x9b,
      0x89, 0xce, 0xeb, 0xb3, 0xa6, 0xc4, 0x27, 0x79, 0x12, 0x3a, 0x50, 0x85, 0x6c, 0x1a, 0xab, 0x21, 0x46, 0xae, 0x17,
      0x7,  0x23, 0x62, 0xd0, 0x11, 0x0,  0x0,  0x56, 0x82, 0x1,  0x22, 0x25, 0x6f, 0x3,  0x0,  0x6,  0xaa, 0xd0, 0xf9,
      0x4f, 0x57, 0x93, 0x65, 0x38, 0x60, 0xe,  0x91, 0x1e, 0x60, 0xb3, 0xe5, 0x92};

  uint8_t buf[232] = {0};

  uint8_t topic_bytes[] = {0xa4, 0x2e, 0x11, 0x87, 0x83, 0x78, 0xe7, 0x6e, 0x8f, 0x13, 0xf7,
                           0x16, 0xbd, 0x44, 0x9e, 0xa6, 0xa6, 0xab, 0x8f, 0x81, 0x89, 0xd7};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x65, 0x38, 0x60, 0xe, 0x91, 0x1e, 0x60, 0xb3, 0xe5, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0xa};
  uint8_t bytesprops2[] = {0x3f, 0xf5, 0x10, 0xf5, 0xfe, 0xa4, 0xa2, 0x29, 0xee, 0x48, 0x62, 0x63};
  uint8_t bytesprops1[] = {0x53, 0xc9, 0x86, 0x24, 0x3e, 0x82, 0x57, 0xc7, 0x4b, 0x85,
                           0x2f, 0xc4, 0xd2, 0x35, 0x4c, 0x1b, 0x2c, 0xe6, 0x57, 0x86};
  uint8_t bytesprops3[] = {0xc4, 0x35, 0xb0, 0x6d, 0x46, 0x3d, 0x5c};
  uint8_t bytesprops4[] = {0x3b, 0x25, 0xff, 0x3d, 0x95, 0x2e, 0x41, 0xcf, 0xe9, 0xeb, 0x26, 0x6d, 0x5d,
                           0xb6, 0x2d, 0x3e, 0x3d, 0x72, 0x3c, 0x40, 0x8b, 0xfc, 0xb,  0x44, 0x3c};
  uint8_t bytesprops5[] = {0x89, 0x9b, 0x91, 0xad, 0xe7, 0xf,  0x5d, 0x32,
                           0x7a, 0xdb, 0x63, 0xc2, 0xa6, 0x7f, 0x7b, 0x67};
  uint8_t bytesprops6[] = {0x50, 0xc1, 0x47, 0xed, 0x5d, 0xa3, 0x6a, 0x6c, 0xce, 0xe5, 0x36, 0x6d, 0xfa, 0x43, 0x2a,
                           0x3a, 0x8d, 0x3e, 0x37, 0x9d, 0x8b, 0x80, 0xa1, 0x19, 0x80, 0x3f, 0x2c, 0x61, 0x3d, 0xa8};
  uint8_t bytesprops7[] = {0x9b, 0x89, 0xce, 0xeb, 0xb3, 0xa6, 0xc4, 0x27,
                           0x79, 0x12, 0x3a, 0x50, 0x85, 0x6c, 0x1a, 0xab};
  uint8_t bytesprops8[] = {0xaa, 0xd0, 0xf9, 0x4f, 0x57, 0x93};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10598}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {12, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18094}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25296}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22146}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 27834, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "F\171\131\SI\DC4\132\f\236\247\252", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\246\240", _willMsg =
// "\169\154\b\180\t3\183\199\&9\250\194", _willProps = []}), _cleanSession = True, _keepAlive = 3250, _connID = "
// \241\DC2\ACK\157\190\v\161\205=\\\156dS\184{", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x2d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0xc,  0xb2, 0x0,  0x10, 0x20, 0xf1,
                   0x12, 0x6,  0x9d, 0xbe, 0xb,  0xa1, 0xcd, 0x3d, 0x5c, 0x9c, 0x64, 0x53, 0xb8, 0x7b, 0x0,  0x2,
                   0xf6, 0xf0, 0x0,  0xb,  0xa9, 0x9a, 0x8,  0xb4, 0x9,  0x33, 0xb7, 0xc7, 0x39, 0xfa, 0xc2};

  uint8_t buf[57] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf6, 0xf0};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa9, 0x9a, 0x8, 0xb4, 0x9, 0x33, 0xb7, 0xc7, 0x39, 0xfa, 0xc2};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3250;
  uint8_t client_id_bytes[] = {0x20, 0xf1, 0x12, 0x6,  0x9d, 0xbe, 0xb,  0xa1,
                               0xcd, 0x3d, 0x5c, 0x9c, 0x64, 0x53, 0xb8, 0x7b};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x46, 0xab, 0x83, 0xf, 0x14, 0x84, 0xc, 0xec, 0xf7, 0xfc};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\185\211\STX\225\EOT\134\DC4\DC2", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "y\133\f\222\RS\142", _willMsg =
// "\252\142\185\165\252\211e|\US\228\205\SYN\193\227\255\173\EOT$", _willProps = []}), _cleanSession = False,
// _keepAlive = 15842, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x32, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0x3d, 0xe2, 0x0,
                   0x0,  0x0,  0x6,  0x79, 0x85, 0xc,  0xde, 0x1e, 0x8e, 0x0,  0x12, 0xfc, 0x8e,
                   0xb9, 0xa5, 0xfc, 0xd3, 0x65, 0x7c, 0x1f, 0xe4, 0xcd, 0x16, 0xc1, 0xe3, 0xff,
                   0xad, 0x4,  0x24, 0x0,  0x8,  0xb9, 0xd3, 0x2,  0xe1, 0x4,  0x86, 0x14, 0x12};

  uint8_t buf[62] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x79, 0x85, 0xc, 0xde, 0x1e, 0x8e};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfc, 0x8e, 0xb9, 0xa5, 0xfc, 0xd3, 0x65, 0x7c, 0x1f,
                                  0xe4, 0xcd, 0x16, 0xc1, 0xe3, 0xff, 0xad, 0x4,  0x24};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15842;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0xd3, 0x2, 0xe1, 0x4, 0x86, 0x14, 0x12};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "eb:\159\169fA~\133\\\r6A7\139\&2\174\229Ue", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\255\245V\194\148\209\GS\f\218\140\201\EM/;H\146\135\176\253}\184\207V7.", _willMsg =
// "\SOH11\t\238\217?\210\\\EOT\223k\192\250?\156\178<\236+\SIQ\209\ACK\177\204\163", _willProps = []}), _cleanSession =
// False, _keepAlive = 29642, _connID = "\212eR", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2c, 0x73, 0xca, 0x0,  0x3,  0xd4,
                   0x65, 0x52, 0x0,  0x19, 0xff, 0xf5, 0x56, 0xc2, 0x94, 0xd1, 0x1d, 0xc,  0xda, 0x8c, 0xc9,
                   0x19, 0x2f, 0x3b, 0x48, 0x92, 0x87, 0xb0, 0xfd, 0x7d, 0xb8, 0xcf, 0x56, 0x37, 0x2e, 0x0,
                   0x1b, 0x1,  0x31, 0x31, 0x9,  0xee, 0xd9, 0x3f, 0xd2, 0x5c, 0x4,  0xdf, 0x6b, 0xc0, 0xfa,
                   0x3f, 0x9c, 0xb2, 0x3c, 0xec, 0x2b, 0xf,  0x51, 0xd1, 0x6,  0xb1, 0xcc, 0xa3};

  uint8_t buf[83] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xff, 0xf5, 0x56, 0xc2, 0x94, 0xd1, 0x1d, 0xc,  0xda, 0x8c, 0xc9, 0x19, 0x2f,
                                0x3b, 0x48, 0x92, 0x87, 0xb0, 0xfd, 0x7d, 0xb8, 0xcf, 0x56, 0x37, 0x2e};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1,  0x31, 0x31, 0x9,  0xee, 0xd9, 0x3f, 0xd2, 0x5c, 0x4, 0xdf, 0x6b, 0xc0, 0xfa,
                                  0x3f, 0x9c, 0xb2, 0x3c, 0xec, 0x2b, 0xf,  0x51, 0xd1, 0x6, 0xb1, 0xcc, 0xa3};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29642;
  uint8_t client_id_bytes[] = {0xd4, 0x65, 0x52};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x65, 0x62, 0x3a, 0x9f, 0xa9, 0x66, 0x41, 0x7e, 0x85, 0x5c,
                              0xd,  0x36, 0x41, 0x37, 0x8b, 0x32, 0xae, 0xe5, 0x55, 0x65};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\197\244\208\172eI\158\208\&4\a\235\DC4\182d\132\GS\189\130O\128\228\192 ", _willMsg =
// "\162T\168%T\161[\138\\\156~t\191\154\206\ETX", _willProps = []}), _cleanSession = False, _keepAlive = 5339, _connID
// = "\194\163\154\203\EOTLMG`#\161l", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0x14, 0xdb, 0x0,  0xc,
                   0xc2, 0xa3, 0x9a, 0xcb, 0x4,  0x4c, 0x4d, 0x47, 0x60, 0x23, 0xa1, 0x6c, 0x0,  0x17,
                   0xc5, 0xf4, 0xd0, 0xac, 0x65, 0x49, 0x9e, 0xd0, 0x34, 0x7,  0xeb, 0x14, 0xb6, 0x64,
                   0x84, 0x1d, 0xbd, 0x82, 0x4f, 0x80, 0xe4, 0xc0, 0x20, 0x0,  0x10, 0xa2, 0x54, 0xa8,
                   0x25, 0x54, 0xa1, 0x5b, 0x8a, 0x5c, 0x9c, 0x7e, 0x74, 0xbf, 0x9a, 0xce, 0x3};

  uint8_t buf[79] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc5, 0xf4, 0xd0, 0xac, 0x65, 0x49, 0x9e, 0xd0, 0x34, 0x7,  0xeb, 0x14,
                                0xb6, 0x64, 0x84, 0x1d, 0xbd, 0x82, 0x4f, 0x80, 0xe4, 0xc0, 0x20};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa2, 0x54, 0xa8, 0x25, 0x54, 0xa1, 0x5b, 0x8a,
                                  0x5c, 0x9c, 0x7e, 0x74, 0xbf, 0x9a, 0xce, 0x3};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 5339;
  uint8_t client_id_bytes[] = {0xc2, 0xa3, 0x9a, 0xcb, 0x4, 0x4c, 0x4d, 0x47, 0x60, 0x23, 0xa1, 0x6c};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\185\GSc\246\205\210\\\233\183w\EOT\252|-\224", _password = Nothing, _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\154\135@Q", _willMsg =
// "=\135\DEL\152\&4.\238\216\245h\157\130\aq\223\150:WI\169k\RS\149", _willProps = []}), _cleanSession = False,
// _keepAlive = 23142, _connID = "J\242", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x3e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x5a, 0x66, 0x0,  0x2,  0x4a, 0xf2,
                   0x0,  0x4,  0x9a, 0x87, 0x40, 0x51, 0x0,  0x17, 0x3d, 0x87, 0x7f, 0x98, 0x34, 0x2e, 0xee, 0xd8,
                   0xf5, 0x68, 0x9d, 0x82, 0x7,  0x71, 0xdf, 0x96, 0x3a, 0x57, 0x49, 0xa9, 0x6b, 0x1e, 0x95, 0x0,
                   0xf,  0xb9, 0x1d, 0x63, 0xf6, 0xcd, 0xd2, 0x5c, 0xe9, 0xb7, 0x77, 0x4,  0xfc, 0x7c, 0x2d, 0xe0};

  uint8_t buf[74] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9a, 0x87, 0x40, 0x51};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3d, 0x87, 0x7f, 0x98, 0x34, 0x2e, 0xee, 0xd8, 0xf5, 0x68, 0x9d, 0x82,
                                  0x7,  0x71, 0xdf, 0x96, 0x3a, 0x57, 0x49, 0xa9, 0x6b, 0x1e, 0x95};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23142;
  uint8_t client_id_bytes[] = {0x4a, 0xf2};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0x1d, 0x63, 0xf6, 0xcd, 0xd2, 0x5c, 0xe9, 0xb7, 0x77, 0x4, 0xfc, 0x7c, 0x2d, 0xe0};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\240\223\219|\165/\216\169G\212Ta\158=\151\215\242\164\220\199\164\236\142\249\194\194\EMU\245\214", _password =
// Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 11621, _connID = "Y", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x2d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x2d, 0x65, 0x0,  0x1,  0x59, 0x0,
                   0x1e, 0xf0, 0xdf, 0xdb, 0x7c, 0xa5, 0x2f, 0xd8, 0xa9, 0x47, 0xd4, 0x54, 0x61, 0x9e, 0x3d, 0x97,
                   0xd7, 0xf2, 0xa4, 0xdc, 0xc7, 0xa4, 0xec, 0x8e, 0xf9, 0xc2, 0xc2, 0x19, 0x55, 0xf5, 0xd6};

  uint8_t buf[57] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11621;
  uint8_t client_id_bytes[] = {0x59};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf0, 0xdf, 0xdb, 0x7c, 0xa5, 0x2f, 0xd8, 0xa9, 0x47, 0xd4, 0x54, 0x61, 0x9e, 0x3d, 0x97,
                              0xd7, 0xf2, 0xa4, 0xdc, 0xc7, 0xa4, 0xec, 0x8e, 0xf9, 0xc2, 0xc2, 0x19, 0x55, 0xf5, 0xd6};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "]\218\DC2\160G\231\&5\185\137ZQ", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 32745, _connID = "\248\163cDx\241\168\&8\140/\228\161\192\&3o\168\223",
// _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x1d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x7f, 0xe9, 0x0,  0x11, 0xf8, 0xa3,
                   0x63, 0x44, 0x78, 0xf1, 0xa8, 0x38, 0x8c, 0x2f, 0xe4, 0xa1, 0xc0, 0x33, 0x6f, 0xa8, 0xdf};

  uint8_t buf[41] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32745;
  uint8_t client_id_bytes[] = {0xf8, 0xa3, 0x63, 0x44, 0x78, 0xf1, 0xa8, 0x38, 0x8c,
                               0x2f, 0xe4, 0xa1, 0xc0, 0x33, 0x6f, 0xa8, 0xdf};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5d, 0xda, 0x12, 0xa0, 0x47, 0xe7, 0x35, 0xb9, 0x89, 0x5a, 0x51};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\NUL\136\181", _password = Just
// "d%\139\252\SUB\v\232)\218\ESC\DC3\212F\DC1\238\243j\SO\251\168", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 14321, _connID = "\SOHH\187\196\DEL\173\132\&0wH\SI\210C\131\DC4", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x36, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x37, 0xf1, 0x0,  0xf,
                   0x1,  0x48, 0xbb, 0xc4, 0x7f, 0xad, 0x84, 0x30, 0x77, 0x48, 0xf,  0xd2, 0x43, 0x83,
                   0x14, 0x0,  0x3,  0x0,  0x88, 0xb5, 0x0,  0x14, 0x64, 0x25, 0x8b, 0xfc, 0x1a, 0xb,
                   0xe8, 0x29, 0xda, 0x1b, 0x13, 0xd4, 0x46, 0x11, 0xee, 0xf3, 0x6a, 0xe,  0xfb, 0xa8};

  uint8_t buf[66] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14321;
  uint8_t client_id_bytes[] = {0x1, 0x48, 0xbb, 0xc4, 0x7f, 0xad, 0x84, 0x30, 0x77, 0x48, 0xf, 0xd2, 0x43, 0x83, 0x14};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x0, 0x88, 0xb5};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0x25, 0x8b, 0xfc, 0x1a, 0xb,  0xe8, 0x29, 0xda, 0x1b,
                              0x13, 0xd4, 0x46, 0x11, 0xee, 0xf3, 0x6a, 0xe,  0xfb, 0xa8};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\142\224!;+'mV", _password = Just
// "{h\173\&5]\vz\\P\196\181X.\"B~\207\241\156]f\195X\DC1\203u\149\151\249", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "S]\n\ETB[\ACK)\233\177\225N\218\162\EM\240p\239O", _willMsg = "\183",
// _willProps = []}), _cleanSession = False, _keepAlive = 24734, _connID = "gYE\207\225\215\192", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x60, 0x9e, 0x0,  0x7,  0x67,
                   0x59, 0x45, 0xcf, 0xe1, 0xd7, 0xc0, 0x0,  0x12, 0x53, 0x5d, 0xa,  0x17, 0x5b, 0x6,  0x29,
                   0xe9, 0xb1, 0xe1, 0x4e, 0xda, 0xa2, 0x19, 0xf0, 0x70, 0xef, 0x4f, 0x0,  0x1,  0xb7, 0x0,
                   0x8,  0x8e, 0xe0, 0x21, 0x3b, 0x2b, 0x27, 0x6d, 0x56, 0x0,  0x1d, 0x7b, 0x68, 0xad, 0x35,
                   0x5d, 0xb,  0x7a, 0x5c, 0x50, 0xc4, 0xb5, 0x58, 0x2e, 0x22, 0x42, 0x7e, 0xcf, 0xf1, 0x9c,
                   0x5d, 0x66, 0xc3, 0x58, 0x11, 0xcb, 0x75, 0x95, 0x97, 0xf9};

  uint8_t buf[95] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x53, 0x5d, 0xa,  0x17, 0x5b, 0x6,  0x29, 0xe9, 0xb1,
                                0xe1, 0x4e, 0xda, 0xa2, 0x19, 0xf0, 0x70, 0xef, 0x4f};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24734;
  uint8_t client_id_bytes[] = {0x67, 0x59, 0x45, 0xcf, 0xe1, 0xd7, 0xc0};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8e, 0xe0, 0x21, 0x3b, 0x2b, 0x27, 0x6d, 0x56};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x7b, 0x68, 0xad, 0x35, 0x5d, 0xb,  0x7a, 0x5c, 0x50, 0xc4, 0xb5, 0x58, 0x2e, 0x22, 0x42,
                              0x7e, 0xcf, 0xf1, 0x9c, 0x5d, 0x66, 0xc3, 0x58, 0x11, 0xcb, 0x75, 0x95, 0x97, 0xf9};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\r7\"\154\EOT", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\\\131\211\214\209\183\242\162", _willMsg = ")&", _willProps = []}),
// _cleanSession = False, _keepAlive = 17778, _connID = "\160\202\220\&9^\188\ENQ\223w\149\158\233", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x2d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8c, 0x45, 0x72, 0x0,  0xc,  0xa0, 0xca,
                   0xdc, 0x39, 0x5e, 0xbc, 0x5,  0xdf, 0x77, 0x95, 0x9e, 0xe9, 0x0,  0x8,  0x5c, 0x83, 0xd3, 0xd6,
                   0xd1, 0xb7, 0xf2, 0xa2, 0x0,  0x2,  0x29, 0x26, 0x0,  0x5,  0xd,  0x37, 0x22, 0x9a, 0x4};

  uint8_t buf[57] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0x83, 0xd3, 0xd6, 0xd1, 0xb7, 0xf2, 0xa2};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x29, 0x26};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17778;
  uint8_t client_id_bytes[] = {0xa0, 0xca, 0xdc, 0x39, 0x5e, 0xbc, 0x5, 0xdf, 0x77, 0x95, 0x9e, 0xe9};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd, 0x37, 0x22, 0x9a, 0x4};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\181\bX\195\NULZ\169\250\173\230E\239g\209\226\145:pJ ^\SO\192\SYN,V\138\226",
// _password = Just "b\129\SOH\222>\130\229h\251\208QM\146\255\&3 \190\166T<A1\147!\174@\205e\165\140", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\217\DLE\EM\DEL\205\167\138", _willMsg =
// "V\249Z)\b\177\215\ESCv\149\f8\250I.\156~R\166P\227\146\t\n\"\217\201\DC2", _willProps = []}), _cleanSession = True,
// _keepAlive = 28502, _connID = "WL\207o\234\255\227", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x78, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x6f, 0x56, 0x0,  0x7,  0x57, 0x4c,
                   0xcf, 0x6f, 0xea, 0xff, 0xe3, 0x0,  0x7,  0xd9, 0x10, 0x19, 0x7f, 0xcd, 0xa7, 0x8a, 0x0,  0x1c,
                   0x56, 0xf9, 0x5a, 0x29, 0x8,  0xb1, 0xd7, 0x1b, 0x76, 0x95, 0xc,  0x38, 0xfa, 0x49, 0x2e, 0x9c,
                   0x7e, 0x52, 0xa6, 0x50, 0xe3, 0x92, 0x9,  0xa,  0x22, 0xd9, 0xc9, 0x12, 0x0,  0x1c, 0xb5, 0x8,
                   0x58, 0xc3, 0x0,  0x5a, 0xa9, 0xfa, 0xad, 0xe6, 0x45, 0xef, 0x67, 0xd1, 0xe2, 0x91, 0x3a, 0x70,
                   0x4a, 0x20, 0x5e, 0xe,  0xc0, 0x16, 0x2c, 0x56, 0x8a, 0xe2, 0x0,  0x1e, 0x62, 0x81, 0x1,  0xde,
                   0x3e, 0x82, 0xe5, 0x68, 0xfb, 0xd0, 0x51, 0x4d, 0x92, 0xff, 0x33, 0x20, 0xbe, 0xa6, 0x54, 0x3c,
                   0x41, 0x31, 0x93, 0x21, 0xae, 0x40, 0xcd, 0x65, 0xa5, 0x8c};

  uint8_t buf[132] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x10, 0x19, 0x7f, 0xcd, 0xa7, 0x8a};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x56, 0xf9, 0x5a, 0x29, 0x8,  0xb1, 0xd7, 0x1b, 0x76, 0x95, 0xc,  0x38, 0xfa, 0x49,
                                  0x2e, 0x9c, 0x7e, 0x52, 0xa6, 0x50, 0xe3, 0x92, 0x9,  0xa,  0x22, 0xd9, 0xc9, 0x12};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28502;
  uint8_t client_id_bytes[] = {0x57, 0x4c, 0xcf, 0x6f, 0xea, 0xff, 0xe3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb5, 0x8,  0x58, 0xc3, 0x0,  0x5a, 0xa9, 0xfa, 0xad, 0xe6, 0x45, 0xef, 0x67, 0xd1,
                              0xe2, 0x91, 0x3a, 0x70, 0x4a, 0x20, 0x5e, 0xe,  0xc0, 0x16, 0x2c, 0x56, 0x8a, 0xe2};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x62, 0x81, 0x1,  0xde, 0x3e, 0x82, 0xe5, 0x68, 0xfb, 0xd0, 0x51, 0x4d, 0x92, 0xff, 0x33,
                              0x20, 0xbe, 0xa6, 0x54, 0x3c, 0x41, 0x31, 0x93, 0x21, 0xae, 0x40, 0xcd, 0x65, 0xa5, 0x8c};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\CAN)\136\200B\171\FS\156\&3q\206\134pb\SI\201\229", _password = Just
// "q\245t\178\174\247\185\150\156\217\237\FS\250\249\129\SO\177", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 25650, _connID = "\a\218\185}5\175\246g\140@\DC4", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x64, 0x32, 0x0,  0xb,  0x7,  0xda,
                   0xb9, 0x7d, 0x35, 0xaf, 0xf6, 0x67, 0x8c, 0x40, 0x14, 0x0,  0x11, 0x18, 0x29, 0x88, 0xc8, 0x42,
                   0xab, 0x1c, 0x9c, 0x33, 0x71, 0xce, 0x86, 0x70, 0x62, 0xf,  0xc9, 0xe5, 0x0,  0x11, 0x71, 0xf5,
                   0x74, 0xb2, 0xae, 0xf7, 0xb9, 0x96, 0x9c, 0xd9, 0xed, 0x1c, 0xfa, 0xf9, 0x81, 0xe,  0xb1};

  uint8_t buf[73] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25650;
  uint8_t client_id_bytes[] = {0x7, 0xda, 0xb9, 0x7d, 0x35, 0xaf, 0xf6, 0x67, 0x8c, 0x40, 0x14};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x18, 0x29, 0x88, 0xc8, 0x42, 0xab, 0x1c, 0x9c, 0x33,
                              0x71, 0xce, 0x86, 0x70, 0x62, 0xf,  0xc9, 0xe5};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x71, 0xf5, 0x74, 0xb2, 0xae, 0xf7, 0xb9, 0x96, 0x9c,
                              0xd9, 0xed, 0x1c, 0xfa, 0xf9, 0x81, 0xe,  0xb1};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\177\ETXK\189\246\n\194\160\SYN%\217\238", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\197\NAK\205\181i\DEL", _willMsg = "1", _willProps =
// []}), _cleanSession = False, _keepAlive = 14932, _connID =
// "y\NUL\146M\ENQ\251\223\140\223q7\254\134\155\148NC\229\180\141\171b\RS\194\ESC\136\244", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa4, 0x3a, 0x54, 0x0,  0x1b, 0x79, 0x0,  0x92,
                   0x4d, 0x5,  0xfb, 0xdf, 0x8c, 0xdf, 0x71, 0x37, 0xfe, 0x86, 0x9b, 0x94, 0x4e, 0x43, 0xe5, 0xb4, 0x8d,
                   0xab, 0x62, 0x1e, 0xc2, 0x1b, 0x88, 0xf4, 0x0,  0x6,  0xc5, 0x15, 0xcd, 0xb5, 0x69, 0x7f, 0x0,  0x1,
                   0x31, 0x0,  0xc,  0xb1, 0x3,  0x4b, 0xbd, 0xf6, 0xa,  0xc2, 0xa0, 0x16, 0x25, 0xd9, 0xee};

  uint8_t buf[76] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc5, 0x15, 0xcd, 0xb5, 0x69, 0x7f};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14932;
  uint8_t client_id_bytes[] = {0x79, 0x0,  0x92, 0x4d, 0x5,  0xfb, 0xdf, 0x8c, 0xdf, 0x71, 0x37, 0xfe, 0x86, 0x9b,
                               0x94, 0x4e, 0x43, 0xe5, 0xb4, 0x8d, 0xab, 0x62, 0x1e, 0xc2, 0x1b, 0x88, 0xf4};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb1, 0x3, 0x4b, 0xbd, 0xf6, 0xa, 0xc2, 0xa0, 0x16, 0x25, 0xd9, 0xee};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\217\134\182", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "*\211,\239(\140\217<Q\205\219\128h\201\228\230\161\233", _willMsg =
// "\233\a^_\166\157v%+", _willProps = []}), _cleanSession = False, _keepAlive = 3108, _connID =
// "\211\250\245_\185\238\&6\147\133\144c\168\US\246\SUB\175\170|HZ\184\nE", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0xc,  0x24, 0x0,  0x17, 0xd3,
                   0xfa, 0xf5, 0x5f, 0xb9, 0xee, 0x36, 0x93, 0x85, 0x90, 0x63, 0xa8, 0x1f, 0xf6, 0x1a, 0xaf,
                   0xaa, 0x7c, 0x48, 0x5a, 0xb8, 0xa,  0x45, 0x0,  0x12, 0x2a, 0xd3, 0x2c, 0xef, 0x28, 0x8c,
                   0xd9, 0x3c, 0x51, 0xcd, 0xdb, 0x80, 0x68, 0xc9, 0xe4, 0xe6, 0xa1, 0xe9, 0x0,  0x9,  0xe9,
                   0x7,  0x5e, 0x5f, 0xa6, 0x9d, 0x76, 0x25, 0x2b, 0x0,  0x3,  0xd9, 0x86, 0xb6};

  uint8_t buf[83] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2a, 0xd3, 0x2c, 0xef, 0x28, 0x8c, 0xd9, 0x3c, 0x51,
                                0xcd, 0xdb, 0x80, 0x68, 0xc9, 0xe4, 0xe6, 0xa1, 0xe9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe9, 0x7, 0x5e, 0x5f, 0xa6, 0x9d, 0x76, 0x25, 0x2b};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3108;
  uint8_t client_id_bytes[] = {0xd3, 0xfa, 0xf5, 0x5f, 0xb9, 0xee, 0x36, 0x93, 0x85, 0x90, 0x63, 0xa8,
                               0x1f, 0xf6, 0x1a, 0xaf, 0xaa, 0x7c, 0x48, 0x5a, 0xb8, 0xa,  0x45};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd9, 0x86, 0xb6};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "]*\250E|\140H\246\144\236\ACK\196\152\216@\SO\EOTK\248
// \199\&6\n\STX=\149s\235\206R", _password = Just "o\197\204\215\153\171tJ\230U\196K\209xYvu\252\206a\129\\", _lastWill
// = Nothing, _cleanSession = False, _keepAlive = 2582, _connID =
// "Zj\DC2\237\243_-\201=\176\154\233\163\196\234\210\176!", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0xa,  0x16, 0x0,  0x12, 0x5a,
                   0x6a, 0x12, 0xed, 0xf3, 0x5f, 0x2d, 0xc9, 0x3d, 0xb0, 0x9a, 0xe9, 0xa3, 0xc4, 0xea, 0xd2,
                   0xb0, 0x21, 0x0,  0x1e, 0x5d, 0x2a, 0xfa, 0x45, 0x7c, 0x8c, 0x48, 0xf6, 0x90, 0xec, 0x6,
                   0xc4, 0x98, 0xd8, 0x40, 0xe,  0x4,  0x4b, 0xf8, 0x20, 0xc7, 0x36, 0xa,  0x2,  0x3d, 0x95,
                   0x73, 0xeb, 0xce, 0x52, 0x0,  0x16, 0x6f, 0xc5, 0xcc, 0xd7, 0x99, 0xab, 0x74, 0x4a, 0xe6,
                   0x55, 0xc4, 0x4b, 0xd1, 0x78, 0x59, 0x76, 0x75, 0xfc, 0xce, 0x61, 0x81, 0x5c};

  uint8_t buf[98] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2582;
  uint8_t client_id_bytes[] = {0x5a, 0x6a, 0x12, 0xed, 0xf3, 0x5f, 0x2d, 0xc9, 0x3d,
                               0xb0, 0x9a, 0xe9, 0xa3, 0xc4, 0xea, 0xd2, 0xb0, 0x21};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0x2a, 0xfa, 0x45, 0x7c, 0x8c, 0x48, 0xf6, 0x90, 0xec, 0x6,  0xc4, 0x98, 0xd8, 0x40,
                              0xe,  0x4,  0x4b, 0xf8, 0x20, 0xc7, 0x36, 0xa,  0x2,  0x3d, 0x95, 0x73, 0xeb, 0xce, 0x52};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xc5, 0xcc, 0xd7, 0x99, 0xab, 0x74, 0x4a, 0xe6, 0x55, 0xc4,
                              0x4b, 0xd1, 0x78, 0x59, 0x76, 0x75, 0xfc, 0xce, 0x61, 0x81, 0x5c};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\EOTG\170Y\132\235\193\STX\132\236", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 14063, _connID = "\253gc\224:\148 v\185T^gmf\158Z\DC1#\211\SYN#[~", _properties =
// []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x23, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x36, 0xef, 0x0,
                   0x17, 0xfd, 0x67, 0x63, 0xe0, 0x3a, 0x94, 0x20, 0x76, 0xb9, 0x54, 0x5e, 0x67,
                   0x6d, 0x66, 0x9e, 0x5a, 0x11, 0x23, 0xd3, 0x16, 0x23, 0x5b, 0x7e};

  uint8_t buf[47] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14063;
  uint8_t client_id_bytes[] = {0xfd, 0x67, 0x63, 0xe0, 0x3a, 0x94, 0x20, 0x76, 0xb9, 0x54, 0x5e, 0x67,
                               0x6d, 0x66, 0x9e, 0x5a, 0x11, 0x23, 0xd3, 0x16, 0x23, 0x5b, 0x7e};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4, 0x47, 0xaa, 0x59, 0x84, 0xeb, 0xc1, 0x2, 0x84, 0xec};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\t\222\159S\165\157.L\191\219\SUB\249\GSF@\235\241t\\\r\130\&4\255\216K\204\246Z\255", _willMsg =
// "\153*>%QC\v\RS\n\183 &\205&Em", _willProps = []}), _cleanSession = True, _keepAlive = 8661, _connID =
// "\213\183*l\161!\168\252p\153\208\254\DC1<\235", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x4c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x21, 0xd5, 0x0,  0xf,  0xd5, 0xb7,
                   0x2a, 0x6c, 0xa1, 0x21, 0xa8, 0xfc, 0x70, 0x99, 0xd0, 0xfe, 0x11, 0x3c, 0xeb, 0x0,  0x1d, 0x9,
                   0xde, 0x9f, 0x53, 0xa5, 0x9d, 0x2e, 0x4c, 0xbf, 0xdb, 0x1a, 0xf9, 0x1d, 0x46, 0x40, 0xeb, 0xf1,
                   0x74, 0x5c, 0xd,  0x82, 0x34, 0xff, 0xd8, 0x4b, 0xcc, 0xf6, 0x5a, 0xff, 0x0,  0x10, 0x99, 0x2a,
                   0x3e, 0x25, 0x51, 0x43, 0xb,  0x1e, 0xa,  0xb7, 0x20, 0x26, 0xcd, 0x26, 0x45, 0x6d};

  uint8_t buf[88] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9,  0xde, 0x9f, 0x53, 0xa5, 0x9d, 0x2e, 0x4c, 0xbf, 0xdb,
                                0x1a, 0xf9, 0x1d, 0x46, 0x40, 0xeb, 0xf1, 0x74, 0x5c, 0xd,
                                0x82, 0x34, 0xff, 0xd8, 0x4b, 0xcc, 0xf6, 0x5a, 0xff};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x99, 0x2a, 0x3e, 0x25, 0x51, 0x43, 0xb,  0x1e,
                                  0xa,  0xb7, 0x20, 0x26, 0xcd, 0x26, 0x45, 0x6d};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8661;
  uint8_t client_id_bytes[] = {0xd5, 0xb7, 0x2a, 0x6c, 0xa1, 0x21, 0xa8, 0xfc,
                               0x70, 0x99, 0xd0, 0xfe, 0x11, 0x3c, 0xeb};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic =
// "\\\255\246\RS<\212+\220\248\199\236\132\185\US]D\137\186\&5\193\r\n\237\181\231\246\&6\238\211\221", _willMsg =
// "#%`lDh\222\147\201\155e\153\136\131 [9l\GS\225\NUL^", _willProps = []}), _cleanSession = True, _keepAlive = 1275,
// _connID = "^\232\215\163\208\190\139\233T\239\SI\139\vz6}", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x54, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x4,  0xfb, 0x0,  0x10, 0x5e,
                   0xe8, 0xd7, 0xa3, 0xd0, 0xbe, 0x8b, 0xe9, 0x54, 0xef, 0xf,  0x8b, 0xb,  0x7a, 0x36, 0x7d,
                   0x0,  0x1e, 0x5c, 0xff, 0xf6, 0x1e, 0x3c, 0xd4, 0x2b, 0xdc, 0xf8, 0xc7, 0xec, 0x84, 0xb9,
                   0x1f, 0x5d, 0x44, 0x89, 0xba, 0x35, 0xc1, 0xd,  0xa,  0xed, 0xb5, 0xe7, 0xf6, 0x36, 0xee,
                   0xd3, 0xdd, 0x0,  0x16, 0x23, 0x25, 0x60, 0x6c, 0x44, 0x68, 0xde, 0x93, 0xc9, 0x9b, 0x65,
                   0x99, 0x88, 0x83, 0x20, 0x5b, 0x39, 0x6c, 0x1d, 0xe1, 0x0,  0x5e};

  uint8_t buf[96] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0xff, 0xf6, 0x1e, 0x3c, 0xd4, 0x2b, 0xdc, 0xf8, 0xc7,
                                0xec, 0x84, 0xb9, 0x1f, 0x5d, 0x44, 0x89, 0xba, 0x35, 0xc1,
                                0xd,  0xa,  0xed, 0xb5, 0xe7, 0xf6, 0x36, 0xee, 0xd3, 0xdd};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x23, 0x25, 0x60, 0x6c, 0x44, 0x68, 0xde, 0x93, 0xc9, 0x9b, 0x65,
                                  0x99, 0x88, 0x83, 0x20, 0x5b, 0x39, 0x6c, 0x1d, 0xe1, 0x0,  0x5e};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1275;
  uint8_t client_id_bytes[] = {0x5e, 0xe8, 0xd7, 0xa3, 0xd0, 0xbe, 0x8b, 0xe9,
                               0x54, 0xef, 0xf,  0x8b, 0xb,  0x7a, 0x36, 0x7d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\212\226\154\ACK\136\237\149\159E\153\b\253\235\250\216\160\201\EM3P\152^\232", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "\128\194\131j\171v\201pWuH\170{=\145O\211\DC3'", _willMsg =
// "\190\132\174 \"\169\179\253\204\&5T\243\160\140^\179\204\131\218H\"6\191lW\184\171d\161K", _willProps = []}),
// _cleanSession = True, _keepAlive = 30712, _connID = "6", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x77, 0xf8, 0x0,  0x1,
                   0x36, 0x0,  0x13, 0x80, 0xc2, 0x83, 0x6a, 0xab, 0x76, 0xc9, 0x70, 0x57, 0x75, 0x48,
                   0xaa, 0x7b, 0x3d, 0x91, 0x4f, 0xd3, 0x13, 0x27, 0x0,  0x1e, 0xbe, 0x84, 0xae, 0x20,
                   0x22, 0xa9, 0xb3, 0xfd, 0xcc, 0x35, 0x54, 0xf3, 0xa0, 0x8c, 0x5e, 0xb3, 0xcc, 0x83,
                   0xda, 0x48, 0x22, 0x36, 0xbf, 0x6c, 0x57, 0xb8, 0xab, 0x64, 0xa1, 0x4b};

  uint8_t buf[78] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0xc2, 0x83, 0x6a, 0xab, 0x76, 0xc9, 0x70, 0x57, 0x75,
                                0x48, 0xaa, 0x7b, 0x3d, 0x91, 0x4f, 0xd3, 0x13, 0x27};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbe, 0x84, 0xae, 0x20, 0x22, 0xa9, 0xb3, 0xfd, 0xcc, 0x35,
                                  0x54, 0xf3, 0xa0, 0x8c, 0x5e, 0xb3, 0xcc, 0x83, 0xda, 0x48,
                                  0x22, 0x36, 0xbf, 0x6c, 0x57, 0xb8, 0xab, 0x64, 0xa1, 0x4b};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30712;
  uint8_t client_id_bytes[] = {0x36};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd4, 0xe2, 0x9a, 0x6,  0x88, 0xed, 0x95, 0x9f, 0x45, 0x99, 0x8, 0xfd,
                              0xeb, 0xfa, 0xd8, 0xa0, 0xc9, 0x19, 0x33, 0x50, 0x98, 0x5e, 0xe8};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\RSd\"\EOT.m'\DLE%\174\130S\229\172\198\176\&1\140&\228\RS\149\248\232\234",
// _password = Just "\216\183u\FS\184\187\239\148\140X\251\143\153s\176\218\&3s\168", _lastWill = Nothing, _cleanSession
// = True, _keepAlive = 24465, _connID = "\145\244\189\239z\131f", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x44, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x5f, 0x91, 0x0,  0x7,
                   0x91, 0xf4, 0xbd, 0xef, 0x7a, 0x83, 0x66, 0x0,  0x1a, 0x4a, 0x1e, 0x64, 0x22, 0x4,
                   0x2e, 0x6d, 0x27, 0x10, 0x25, 0xae, 0x82, 0x53, 0xe5, 0xac, 0xc6, 0xb0, 0x31, 0x8c,
                   0x26, 0xe4, 0x1e, 0x95, 0xf8, 0xe8, 0xea, 0x0,  0x13, 0xd8, 0xb7, 0x75, 0x1c, 0xb8,
                   0xbb, 0xef, 0x94, 0x8c, 0x58, 0xfb, 0x8f, 0x99, 0x73, 0xb0, 0xda, 0x33, 0x73, 0xa8};

  uint8_t buf[80] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24465;
  uint8_t client_id_bytes[] = {0x91, 0xf4, 0xbd, 0xef, 0x7a, 0x83, 0x66};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x1e, 0x64, 0x22, 0x4,  0x2e, 0x6d, 0x27, 0x10, 0x25, 0xae, 0x82, 0x53,
                              0xe5, 0xac, 0xc6, 0xb0, 0x31, 0x8c, 0x26, 0xe4, 0x1e, 0x95, 0xf8, 0xe8, 0xea};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd8, 0xb7, 0x75, 0x1c, 0xb8, 0xbb, 0xef, 0x94, 0x8c, 0x58,
                              0xfb, 0x8f, 0x99, 0x73, 0xb0, 0xda, 0x33, 0x73, 0xa8};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\168\152\190:\152\"\217OGs\207_\233\129\248**\131N\190\167q;\253\ETB", _password =
// Just "hq\130\190\144\NUL\227\253\208\215\224\167\FS\203\EOT(\169\158\166\134)g\184\233\145\138*u", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 147, _connID = "\198@\194\222\146s", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x0,  0x93, 0x0,  0x6,  0xc6, 0x40,
                   0xc2, 0xde, 0x92, 0x73, 0x0,  0x19, 0xa8, 0x98, 0xbe, 0x3a, 0x98, 0x22, 0xd9, 0x4f, 0x47, 0x73,
                   0xcf, 0x5f, 0xe9, 0x81, 0xf8, 0x2a, 0x2a, 0x83, 0x4e, 0xbe, 0xa7, 0x71, 0x3b, 0xfd, 0x17, 0x0,
                   0x1c, 0x68, 0x71, 0x82, 0xbe, 0x90, 0x0,  0xe3, 0xfd, 0xd0, 0xd7, 0xe0, 0xa7, 0x1c, 0xcb, 0x4,
                   0x28, 0xa9, 0x9e, 0xa6, 0x86, 0x29, 0x67, 0xb8, 0xe9, 0x91, 0x8a, 0x2a, 0x75};

  uint8_t buf[87] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 147;
  uint8_t client_id_bytes[] = {0xc6, 0x40, 0xc2, 0xde, 0x92, 0x73};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa8, 0x98, 0xbe, 0x3a, 0x98, 0x22, 0xd9, 0x4f, 0x47, 0x73, 0xcf, 0x5f, 0xe9,
                              0x81, 0xf8, 0x2a, 0x2a, 0x83, 0x4e, 0xbe, 0xa7, 0x71, 0x3b, 0xfd, 0x17};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x68, 0x71, 0x82, 0xbe, 0x90, 0x0,  0xe3, 0xfd, 0xd0, 0xd7, 0xe0, 0xa7, 0x1c, 0xcb,
                              0x4,  0x28, 0xa9, 0x9e, 0xa6, 0x86, 0x29, 0x67, 0xb8, 0xe9, 0x91, 0x8a, 0x2a, 0x75};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "9?\213\ESC\211\DLE", _lastWill = Nothing, _cleanSession =
// False, _keepAlive = 13768, _connID =
// "x\172\tI\199\244\238\243\130\&9.\206\172\ETB\SYN\164\GS\EM\128\142S\217\184\NAK]Q\209;\SUBN", _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x2a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x35, 0xc8, 0x0,  0x1e, 0x78,
                   0xac, 0x9,  0x49, 0xc7, 0xf4, 0xee, 0xf3, 0x82, 0x39, 0x2e, 0xce, 0xac, 0x17, 0x16, 0xa4,
                   0x1d, 0x19, 0x80, 0x8e, 0x53, 0xd9, 0xb8, 0x15, 0x5d, 0x51, 0xd1, 0x3b, 0x1a, 0x4e};

  uint8_t buf[54] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13768;
  uint8_t client_id_bytes[] = {0x78, 0xac, 0x9,  0x49, 0xc7, 0xf4, 0xee, 0xf3, 0x82, 0x39,
                               0x2e, 0xce, 0xac, 0x17, 0x16, 0xa4, 0x1d, 0x19, 0x80, 0x8e,
                               0x53, 0xd9, 0xb8, 0x15, 0x5d, 0x51, 0xd1, 0x3b, 0x1a, 0x4e};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x39, 0x3f, 0xd5, 0x1b, 0xd3, 0x10};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// ";\152\206s\182\199\197\227\135\ACK\251\"Z\DLE\203\162ab\203\169\203\208\172\230\&6\EOT8eS`", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "", _willMsg = "\157\160\156\193A", _willProps = []}),
// _cleanSession = False, _keepAlive = 23561, _connID = "\228\240", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x17, 0x0,  0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,  0x2c, 0x5c, 0x9, 0x0,
                   0x2,  0xe4, 0xf0, 0x0, 0x0,  0x0,  0x5,  0x9d, 0xa0, 0x9c, 0xc1, 0x41};

  uint8_t buf[35] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9d, 0xa0, 0x9c, 0xc1, 0x41};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23561;
  uint8_t client_id_bytes[] = {0xe4, 0xf0};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x3b, 0x98, 0xce, 0x73, 0xb6, 0xc7, 0xc5, 0xe3, 0x87, 0x6,  0xfb, 0x22, 0x5a, 0x10, 0xcb,
                              0xa2, 0x61, 0x62, 0xcb, 0xa9, 0xcb, 0xd0, 0xac, 0xe6, 0x36, 0x4,  0x38, 0x65, 0x53, 0x60};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\254\245:\136]\202n\222\DC3n\218\215\210", _password = Just
// "6\234}\152\181\DC2\ACKM\245:\DC2\ENQ\249\205q+", _lastWill = Nothing, _cleanSession = True, _keepAlive = 2628,
// _connID = "\131/w\176\163", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x32, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0xa,  0x44, 0x0,
                   0x5,  0x83, 0x2f, 0x77, 0xb0, 0xa3, 0x0,  0xd,  0xfe, 0xf5, 0x3a, 0x88, 0x5d,
                   0xca, 0x6e, 0xde, 0x13, 0x6e, 0xda, 0xd7, 0xd2, 0x0,  0x10, 0x36, 0xea, 0x7d,
                   0x98, 0xb5, 0x12, 0x6,  0x4d, 0xf5, 0x3a, 0x12, 0x5,  0xf9, 0xcd, 0x71, 0x2b};

  uint8_t buf[62] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2628;
  uint8_t client_id_bytes[] = {0x83, 0x2f, 0x77, 0xb0, 0xa3};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfe, 0xf5, 0x3a, 0x88, 0x5d, 0xca, 0x6e, 0xde, 0x13, 0x6e, 0xda, 0xd7, 0xd2};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x36, 0xea, 0x7d, 0x98, 0xb5, 0x12, 0x6,  0x4d,
                              0xf5, 0x3a, 0x12, 0x5,  0xf9, 0xcd, 0x71, 0x2b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\155\217\NUL\219N>c\218$.jM\158\CAN\213\ENQA;\185\148\147T\180\244", _password =
// Just "\167\228\243\219\223\142\140\SUB-\206\&0\STXF\ACK\146\186V\DC1\167&Nk\SOH8\132", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 23808, _connID =
// "\240\217\175\155|O\226\&49\201\243L\176\239f\233\177`\130\154\221", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x5d, 0x0,  0x0,  0x15, 0xf0,
                   0xd9, 0xaf, 0x9b, 0x7c, 0x4f, 0xe2, 0x34, 0x39, 0xc9, 0xf3, 0x4c, 0xb0, 0xef, 0x66, 0xe9,
                   0xb1, 0x60, 0x82, 0x9a, 0xdd, 0x0,  0x18, 0x9b, 0xd9, 0x0,  0xdb, 0x4e, 0x3e, 0x63, 0xda,
                   0x24, 0x2e, 0x6a, 0x4d, 0x9e, 0x18, 0xd5, 0x5,  0x41, 0x3b, 0xb9, 0x94, 0x93, 0x54, 0xb4,
                   0xf4, 0x0,  0x19, 0xa7, 0xe4, 0xf3, 0xdb, 0xdf, 0x8e, 0x8c, 0x1a, 0x2d, 0xce, 0x30, 0x2,
                   0x46, 0x6,  0x92, 0xba, 0x56, 0x11, 0xa7, 0x26, 0x4e, 0x6b, 0x1,  0x38, 0x84};

  uint8_t buf[98] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23808;
  uint8_t client_id_bytes[] = {0xf0, 0xd9, 0xaf, 0x9b, 0x7c, 0x4f, 0xe2, 0x34, 0x39, 0xc9, 0xf3,
                               0x4c, 0xb0, 0xef, 0x66, 0xe9, 0xb1, 0x60, 0x82, 0x9a, 0xdd};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9b, 0xd9, 0x0,  0xdb, 0x4e, 0x3e, 0x63, 0xda, 0x24, 0x2e, 0x6a, 0x4d,
                              0x9e, 0x18, 0xd5, 0x5,  0x41, 0x3b, 0xb9, 0x94, 0x93, 0x54, 0xb4, 0xf4};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa7, 0xe4, 0xf3, 0xdb, 0xdf, 0x8e, 0x8c, 0x1a, 0x2d, 0xce, 0x30, 0x2, 0x46,
                              0x6,  0x92, 0xba, 0x56, 0x11, 0xa7, 0x26, 0x4e, 0x6b, 0x1,  0x38, 0x84};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\147\ENQI\173\FS\139y\171U\167\&2\200\241\231_S\207A\193.'\DC3-\t", _password =
// Just "\224M\229\196\155\f", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "4g\167(\247", _willMsg = "e\SYNy\187{\214", _willProps = []}), _cleanSession = False, _keepAlive = 32591, _connID =
// "5\226G\145\159\238\225\NAK\DC2\SUB\RSc\ENQ\ACKr\238+\128\191\218\DC2\230\143X", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x7f, 0x4f, 0x0,  0x18, 0x35,
                   0xe2, 0x47, 0x91, 0x9f, 0xee, 0xe1, 0x15, 0x12, 0x1a, 0x1e, 0x63, 0x5,  0x6,  0x72, 0xee,
                   0x2b, 0x80, 0xbf, 0xda, 0x12, 0xe6, 0x8f, 0x58, 0x0,  0x5,  0x34, 0x67, 0xa7, 0x28, 0xf7,
                   0x0,  0x6,  0x65, 0x16, 0x79, 0xbb, 0x7b, 0xd6, 0x0,  0x18, 0x93, 0x5,  0x49, 0xad, 0x1c,
                   0x8b, 0x79, 0xab, 0x55, 0xa7, 0x32, 0xc8, 0xf1, 0xe7, 0x5f, 0x53, 0xcf, 0x41, 0xc1, 0x2e,
                   0x27, 0x13, 0x2d, 0x9,  0x0,  0x6,  0xe0, 0x4d, 0xe5, 0xc4, 0x9b, 0xc};

  uint8_t buf[97] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x34, 0x67, 0xa7, 0x28, 0xf7};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x65, 0x16, 0x79, 0xbb, 0x7b, 0xd6};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32591;
  uint8_t client_id_bytes[] = {0x35, 0xe2, 0x47, 0x91, 0x9f, 0xee, 0xe1, 0x15, 0x12, 0x1a, 0x1e, 0x63,
                               0x5,  0x6,  0x72, 0xee, 0x2b, 0x80, 0xbf, 0xda, 0x12, 0xe6, 0x8f, 0x58};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x93, 0x5,  0x49, 0xad, 0x1c, 0x8b, 0x79, 0xab, 0x55, 0xa7, 0x32, 0xc8,
                              0xf1, 0xe7, 0x5f, 0x53, 0xcf, 0x41, 0xc1, 0x2e, 0x27, 0x13, 0x2d, 0x9};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0x4d, 0xe5, 0xc4, 0x9b, 0xc};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\135n\ACK\DEL\252\NAKj", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "\227\242\SOH2\209\GS\241P\197$1", _willMsg =
// "\203\232{\205\152\239\158\DEL\251r\EOTy\\e\148\159p\ETX8Kg", _willProps = []}), _cleanSession = True, _keepAlive =
// 27175, _connID = "\CAN\SYN\222\163\&6J<\227\240.\181\138\158\223b_\ETB\234\SYN\232\223", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x6a, 0x27, 0x0,  0x15, 0x18, 0x16,
                   0xde, 0xa3, 0x36, 0x4a, 0x3c, 0xe3, 0xf0, 0x2e, 0xb5, 0x8a, 0x9e, 0xdf, 0x62, 0x5f, 0x17, 0xea,
                   0x16, 0xe8, 0xdf, 0x0,  0xb,  0xe3, 0xf2, 0x1,  0x32, 0xd1, 0x1d, 0xf1, 0x50, 0xc5, 0x24, 0x31,
                   0x0,  0x15, 0xcb, 0xe8, 0x7b, 0xcd, 0x98, 0xef, 0x9e, 0x7f, 0xfb, 0x72, 0x4,  0x79, 0x5c, 0x65,
                   0x94, 0x9f, 0x70, 0x3,  0x38, 0x4b, 0x67, 0x0,  0x7,  0x87, 0x6e, 0x6,  0x7f, 0xfc, 0x15, 0x6a};

  uint8_t buf[90] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xf2, 0x1, 0x32, 0xd1, 0x1d, 0xf1, 0x50, 0xc5, 0x24, 0x31};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xcb, 0xe8, 0x7b, 0xcd, 0x98, 0xef, 0x9e, 0x7f, 0xfb, 0x72, 0x4,
                                  0x79, 0x5c, 0x65, 0x94, 0x9f, 0x70, 0x3,  0x38, 0x4b, 0x67};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27175;
  uint8_t client_id_bytes[] = {0x18, 0x16, 0xde, 0xa3, 0x36, 0x4a, 0x3c, 0xe3, 0xf0, 0x2e, 0xb5,
                               0x8a, 0x9e, 0xdf, 0x62, 0x5f, 0x17, 0xea, 0x16, 0xe8, 0xdf};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x87, 0x6e, 0x6, 0x7f, 0xfc, 0x15, 0x6a};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\206\232\167N\216a\154\199\224\218QM\240^\233", _password = Just
// "\192/:\231\250i\229m\149\209\226\189\247\RS", _lastWill = Nothing, _cleanSession = True, _keepAlive = 19539, _connID
// = "\243\a_w\224\230\220\172\186\STX\157\251\SUB\221\132\ACK1\230\148", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x4c, 0x53, 0x0,  0x13, 0xf3, 0x7,  0x5f,
                   0x77, 0xe0, 0xe6, 0xdc, 0xac, 0xba, 0x2,  0x9d, 0xfb, 0x1a, 0xdd, 0x84, 0x6,  0x31, 0xe6, 0x94, 0x0,
                   0xf,  0xce, 0xe8, 0xa7, 0x4e, 0xd8, 0x61, 0x9a, 0xc7, 0xe0, 0xda, 0x51, 0x4d, 0xf0, 0x5e, 0xe9, 0x0,
                   0xe,  0xc0, 0x2f, 0x3a, 0xe7, 0xfa, 0x69, 0xe5, 0x6d, 0x95, 0xd1, 0xe2, 0xbd, 0xf7, 0x1e};

  uint8_t buf[76] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19539;
  uint8_t client_id_bytes[] = {0xf3, 0x7,  0x5f, 0x77, 0xe0, 0xe6, 0xdc, 0xac, 0xba, 0x2,
                               0x9d, 0xfb, 0x1a, 0xdd, 0x84, 0x6,  0x31, 0xe6, 0x94};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xce, 0xe8, 0xa7, 0x4e, 0xd8, 0x61, 0x9a, 0xc7, 0xe0, 0xda, 0x51, 0x4d, 0xf0, 0x5e, 0xe9};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc0, 0x2f, 0x3a, 0xe7, 0xfa, 0x69, 0xe5, 0x6d, 0x95, 0xd1, 0xe2, 0xbd, 0xf7, 0x1e};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "m\215\134\182\200\&4", _password = Just
// ">\213T\DC4\232\214\180e\168@Q\130\234\201\227#\248\153`\161\244\138\218\201/xr\DEL", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "k\208\247&\US\224\153\252\216", _willMsg = "\v\157\214H\186",
// _willProps = []}), _cleanSession = False, _keepAlive = 24596, _connID = "\198\140\ETX", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x60, 0x14, 0x0,  0x3,  0xc6,
                   0x8c, 0x3,  0x0,  0x9,  0x6b, 0xd0, 0xf7, 0x26, 0x1f, 0xe0, 0x99, 0xfc, 0xd8, 0x0,  0x5,
                   0xb,  0x9d, 0xd6, 0x48, 0xba, 0x0,  0x6,  0x6d, 0xd7, 0x86, 0xb6, 0xc8, 0x34, 0x0,  0x1c,
                   0x3e, 0xd5, 0x54, 0x14, 0xe8, 0xd6, 0xb4, 0x65, 0xa8, 0x40, 0x51, 0x82, 0xea, 0xc9, 0xe3,
                   0x23, 0xf8, 0x99, 0x60, 0xa1, 0xf4, 0x8a, 0xda, 0xc9, 0x2f, 0x78, 0x72, 0x7f};

  uint8_t buf[83] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6b, 0xd0, 0xf7, 0x26, 0x1f, 0xe0, 0x99, 0xfc, 0xd8};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb, 0x9d, 0xd6, 0x48, 0xba};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24596;
  uint8_t client_id_bytes[] = {0xc6, 0x8c, 0x3};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6d, 0xd7, 0x86, 0xb6, 0xc8, 0x34};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3e, 0xd5, 0x54, 0x14, 0xe8, 0xd6, 0xb4, 0x65, 0xa8, 0x40, 0x51, 0x82, 0xea, 0xc9,
                              0xe3, 0x23, 0xf8, 0x99, 0x60, 0xa1, 0xf4, 0x8a, 0xda, 0xc9, 0x2f, 0x78, 0x72, 0x7f};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "e\ESCs", _password = Just "\183mF\183H", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 16377, _connID = "Ky\SOj\t\188i\157\233_I\201\187\143\DELY\175_\140}\230\&5\206\SUBqb+P0", _properties =
// []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x35, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x3f, 0xf9, 0x0,  0x1d,
                   0x4b, 0x79, 0xe,  0x6a, 0x9,  0xbc, 0x69, 0x9d, 0xe9, 0x5f, 0x49, 0xc9, 0xbb, 0x8f,
                   0x7f, 0x59, 0xaf, 0x5f, 0x8c, 0x7d, 0xe6, 0x35, 0xce, 0x1a, 0x71, 0x62, 0x2b, 0x50,
                   0x30, 0x0,  0x3,  0x65, 0x1b, 0x73, 0x0,  0x5,  0xb7, 0x6d, 0x46, 0xb7, 0x48};

  uint8_t buf[65] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16377;
  uint8_t client_id_bytes[] = {0x4b, 0x79, 0xe,  0x6a, 0x9,  0xbc, 0x69, 0x9d, 0xe9, 0x5f, 0x49, 0xc9, 0xbb, 0x8f, 0x7f,
                               0x59, 0xaf, 0x5f, 0x8c, 0x7d, 0xe6, 0x35, 0xce, 0x1a, 0x71, 0x62, 0x2b, 0x50, 0x30};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x65, 0x1b, 0x73};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb7, 0x6d, 0x46, 0xb7, 0x48};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\238zO", _password = Just
// "\183xW\149\225\255\ACK\160\227\147\208\185\174P\148l\216\&6B\183J\152", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\192G3\202\231\255\195\177\168\239\233\234\161\DC3\186Q\230\"\t\146\ACK",
// _willMsg = "\GS\230a\199\205<}", _willProps = []}), _cleanSession = True, _keepAlive = 18523, _connID =
// "\232\204\f\212 \185\241-\229\183\230\160\202i\225\DC1_2\224\152\198v[\219md\170", _properties = []}
TEST(Connect311QCTest, Encode31) {
  uint8_t pkt[] = {0x10, 0x64, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x48, 0x5b, 0x0,  0x1b, 0xe8,
                   0xcc, 0xc,  0xd4, 0x20, 0xb9, 0xf1, 0x2d, 0xe5, 0xb7, 0xe6, 0xa0, 0xca, 0x69, 0xe1, 0x11,
                   0x5f, 0x32, 0xe0, 0x98, 0xc6, 0x76, 0x5b, 0xdb, 0x6d, 0x64, 0xaa, 0x0,  0x15, 0xc0, 0x47,
                   0x33, 0xca, 0xe7, 0xff, 0xc3, 0xb1, 0xa8, 0xef, 0xe9, 0xea, 0xa1, 0x13, 0xba, 0x51, 0xe6,
                   0x22, 0x9,  0x92, 0x6,  0x0,  0x7,  0x1d, 0xe6, 0x61, 0xc7, 0xcd, 0x3c, 0x7d, 0x0,  0x3,
                   0xee, 0x7a, 0x4f, 0x0,  0x16, 0xb7, 0x78, 0x57, 0x95, 0xe1, 0xff, 0x6,  0xa0, 0xe3, 0x93,
                   0xd0, 0xb9, 0xae, 0x50, 0x94, 0x6c, 0xd8, 0x36, 0x42, 0xb7, 0x4a, 0x98};

  uint8_t buf[112] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc0, 0x47, 0x33, 0xca, 0xe7, 0xff, 0xc3, 0xb1, 0xa8, 0xef, 0xe9,
                                0xea, 0xa1, 0x13, 0xba, 0x51, 0xe6, 0x22, 0x9,  0x92, 0x6};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0xe6, 0x61, 0xc7, 0xcd, 0x3c, 0x7d};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18523;
  uint8_t client_id_bytes[] = {0xe8, 0xcc, 0xc,  0xd4, 0x20, 0xb9, 0xf1, 0x2d, 0xe5, 0xb7, 0xe6, 0xa0, 0xca, 0x69,
                               0xe1, 0x11, 0x5f, 0x32, 0xe0, 0x98, 0xc6, 0x76, 0x5b, 0xdb, 0x6d, 0x64, 0xaa};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xee, 0x7a, 0x4f};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb7, 0x78, 0x57, 0x95, 0xe1, 0xff, 0x6,  0xa0, 0xe3, 0x93, 0xd0,
                              0xb9, 0xae, 0x50, 0x94, 0x6c, 0xd8, 0x36, 0x42, 0xb7, 0x4a, 0x98};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ae\200\161\175\235\ETX\154", _password = Just
// "\ESCm\NULa\222\180jD\243e\212[\t7\DC1\143\247~\DC4=\196NJ\FS<\201\150\171\151", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\FS;\251\141\v\199\239\NUL\196T{\DC3x?\154\217\156_", _willMsg =
// "_'9\US\219\b\147\&0\133+-\148\&7G\249\172\205[\147\208\DC3\ESCC", _willProps = []}), _cleanSession = False,
// _keepAlive = 11629, _connID = "\\X\222", _properties = []}
TEST(Connect311QCTest, Encode32) {
  uint8_t pkt[] = {0x10, 0x65, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x2d, 0x6d, 0x0,  0x3,  0x5c,
                   0x58, 0xde, 0x0,  0x12, 0x1c, 0x3b, 0xfb, 0x8d, 0xb,  0xc7, 0xef, 0x0,  0xc4, 0x54, 0x7b,
                   0x13, 0x78, 0x3f, 0x9a, 0xd9, 0x9c, 0x5f, 0x0,  0x17, 0x5f, 0x27, 0x39, 0x1f, 0xdb, 0x8,
                   0x93, 0x30, 0x85, 0x2b, 0x2d, 0x94, 0x37, 0x47, 0xf9, 0xac, 0xcd, 0x5b, 0x93, 0xd0, 0x13,
                   0x1b, 0x43, 0x0,  0x8,  0x41, 0x65, 0xc8, 0xa1, 0xaf, 0xeb, 0x3,  0x9a, 0x0,  0x1d, 0x1b,
                   0x6d, 0x0,  0x61, 0xde, 0xb4, 0x6a, 0x44, 0xf3, 0x65, 0xd4, 0x5b, 0x9,  0x37, 0x11, 0x8f,
                   0xf7, 0x7e, 0x14, 0x3d, 0xc4, 0x4e, 0x4a, 0x1c, 0x3c, 0xc9, 0x96, 0xab, 0x97};

  uint8_t buf[113] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1c, 0x3b, 0xfb, 0x8d, 0xb,  0xc7, 0xef, 0x0,  0xc4,
                                0x54, 0x7b, 0x13, 0x78, 0x3f, 0x9a, 0xd9, 0x9c, 0x5f};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5f, 0x27, 0x39, 0x1f, 0xdb, 0x8,  0x93, 0x30, 0x85, 0x2b, 0x2d, 0x94,
                                  0x37, 0x47, 0xf9, 0xac, 0xcd, 0x5b, 0x93, 0xd0, 0x13, 0x1b, 0x43};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11629;
  uint8_t client_id_bytes[] = {0x5c, 0x58, 0xde};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0x65, 0xc8, 0xa1, 0xaf, 0xeb, 0x3, 0x9a};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1b, 0x6d, 0x0,  0x61, 0xde, 0xb4, 0x6a, 0x44, 0xf3, 0x65, 0xd4, 0x5b, 0x9,  0x37, 0x11,
                              0x8f, 0xf7, 0x7e, 0x14, 0x3d, 0xc4, 0x4e, 0x4a, 0x1c, 0x3c, 0xc9, 0x96, 0xab, 0x97};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\150\147\177\160\218r%'C\139\159\&6\178", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\158/9\141", _willMsg =
// "\189\DC4a\NUL\243\231@W\178\194\&7\212\\\150W\244\244\226Y=\164\138\228\154qi\129(\SOH}", _willProps = []}),
// _cleanSession = True, _keepAlive = 6008, _connID = "3\252\rE\195\SYNO^\160\182\243\US\166\254\183
// \NAK\SUB\159\173\196\\\150\179D\245", _properties = []}
TEST(Connect311QCTest, Encode33) {
  uint8_t pkt[] = {0x10, 0x4c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x17, 0x78, 0x0,  0x1a, 0x33, 0xfc,
                   0xd,  0x45, 0xc3, 0x16, 0x4f, 0x5e, 0xa0, 0xb6, 0xf3, 0x1f, 0xa6, 0xfe, 0xb7, 0x20, 0x15, 0x1a,
                   0x9f, 0xad, 0xc4, 0x5c, 0x96, 0xb3, 0x44, 0xf5, 0x0,  0x4,  0x9e, 0x2f, 0x39, 0x8d, 0x0,  0x1e,
                   0xbd, 0x14, 0x61, 0x0,  0xf3, 0xe7, 0x40, 0x57, 0xb2, 0xc2, 0x37, 0xd4, 0x5c, 0x96, 0x57, 0xf4,
                   0xf4, 0xe2, 0x59, 0x3d, 0xa4, 0x8a, 0xe4, 0x9a, 0x71, 0x69, 0x81, 0x28, 0x1,  0x7d};

  uint8_t buf[88] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9e, 0x2f, 0x39, 0x8d};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0x14, 0x61, 0x0,  0xf3, 0xe7, 0x40, 0x57, 0xb2, 0xc2,
                                  0x37, 0xd4, 0x5c, 0x96, 0x57, 0xf4, 0xf4, 0xe2, 0x59, 0x3d,
                                  0xa4, 0x8a, 0xe4, 0x9a, 0x71, 0x69, 0x81, 0x28, 0x1,  0x7d};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6008;
  uint8_t client_id_bytes[] = {0x33, 0xfc, 0xd,  0x45, 0xc3, 0x16, 0x4f, 0x5e, 0xa0, 0xb6, 0xf3, 0x1f, 0xa6,
                               0xfe, 0xb7, 0x20, 0x15, 0x1a, 0x9f, 0xad, 0xc4, 0x5c, 0x96, 0xb3, 0x44, 0xf5};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x96, 0x93, 0xb1, 0xa0, 0xda, 0x72, 0x25, 0x27, 0x43, 0x8b, 0x9f, 0x36, 0xb2};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Y\v>5Bm\227", _password = Just "\138\203", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic = "\206v\171\156\146%.\249$W", _willMsg = "\bH\DC4H", _willProps = []}),
// _cleanSession = True, _keepAlive = 23415, _connID =
// "\204wCr\148\250tb\RS\139\204\142\r\206\180\231\DC26Cv\254+\STX\ETX\250\t", _properties = []}
TEST(Connect311QCTest, Encode34) {
  uint8_t pkt[] = {0x10, 0x45, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x5b, 0x77, 0x0,  0x1a, 0xcc,
                   0x77, 0x43, 0x72, 0x94, 0xfa, 0x74, 0x62, 0x1e, 0x8b, 0xcc, 0x8e, 0xd,  0xce, 0xb4, 0xe7,
                   0x12, 0x36, 0x43, 0x76, 0xfe, 0x2b, 0x2,  0x3,  0xfa, 0x9,  0x0,  0xa,  0xce, 0x76, 0xab,
                   0x9c, 0x92, 0x25, 0x2e, 0xf9, 0x24, 0x57, 0x0,  0x4,  0x8,  0x48, 0x14, 0x48, 0x0,  0x7,
                   0x59, 0xb,  0x3e, 0x35, 0x42, 0x6d, 0xe3, 0x0,  0x2,  0x8a, 0xcb};

  uint8_t buf[81] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xce, 0x76, 0xab, 0x9c, 0x92, 0x25, 0x2e, 0xf9, 0x24, 0x57};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8, 0x48, 0x14, 0x48};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23415;
  uint8_t client_id_bytes[] = {0xcc, 0x77, 0x43, 0x72, 0x94, 0xfa, 0x74, 0x62, 0x1e, 0x8b, 0xcc, 0x8e, 0xd,
                               0xce, 0xb4, 0xe7, 0x12, 0x36, 0x43, 0x76, 0xfe, 0x2b, 0x2,  0x3,  0xfa, 0x9};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x59, 0xb, 0x3e, 0x35, 0x42, 0x6d, 0xe3};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x8a, 0xcb};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "]\153\135\145US\141\240H\229\241g\ETX", _willMsg = "S\147\227\222\204\171\172K", _willProps =
// []}), _cleanSession = True, _keepAlive = 12605, _connID = "\213?\SO\227\212\225\234\193\164'\SYN0,6\152", _properties
// = []}
TEST(Connect311QCTest, Encode35) {
  uint8_t pkt[] = {0x10, 0x34, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x31, 0x3d, 0x0,  0xf,
                   0xd5, 0x3f, 0xe, 0xe3, 0xd4, 0xe1, 0xea, 0xc1, 0xa4, 0x27, 0x16, 0x30, 0x2c, 0x36,
                   0x98, 0x0,  0xd, 0x5d, 0x99, 0x87, 0x91, 0x55, 0x53, 0x8d, 0xf0, 0x48, 0xe5, 0xf1,
                   0x67, 0x3,  0x0, 0x8,  0x53, 0x93, 0xe3, 0xde, 0xcc, 0xab, 0xac, 0x4b};

  uint8_t buf[64] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5d, 0x99, 0x87, 0x91, 0x55, 0x53, 0x8d, 0xf0, 0x48, 0xe5, 0xf1, 0x67, 0x3};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x53, 0x93, 0xe3, 0xde, 0xcc, 0xab, 0xac, 0x4b};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12605;
  uint8_t client_id_bytes[] = {0xd5, 0x3f, 0xe, 0xe3, 0xd4, 0xe1, 0xea, 0xc1, 0xa4, 0x27, 0x16, 0x30, 0x2c, 0x36, 0x98};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "&\ETX\DC1tJ\204\211Q`", _password = Just "\128c\191.\162\253\GS\162q\130\138\188Y",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\245\221o", _willMsg =
// "\235\SOH,nQ&\DC1bJ\DC4\177\178\194\181\239\243I\167\232\150\179|^\185\241\164Wv\211", _willProps = []}),
// _cleanSession = True, _keepAlive = 6922, _connID = "\132\211\DC4\175\183\DC4\ETB\170Y", _properties = []}
TEST(Connect311QCTest, Encode36) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x1b, 0xa,  0x0,  0x9,  0x84,
                   0xd3, 0x14, 0xaf, 0xb7, 0x14, 0x17, 0xaa, 0x59, 0x0,  0x3,  0xf5, 0xdd, 0x6f, 0x0,  0x1d,
                   0xeb, 0x1,  0x2c, 0x6e, 0x51, 0x26, 0x11, 0x62, 0x4a, 0x14, 0xb1, 0xb2, 0xc2, 0xb5, 0xef,
                   0xf3, 0x49, 0xa7, 0xe8, 0x96, 0xb3, 0x7c, 0x5e, 0xb9, 0xf1, 0xa4, 0x57, 0x76, 0xd3, 0x0,
                   0x9,  0x26, 0x3,  0x11, 0x74, 0x4a, 0xcc, 0xd3, 0x51, 0x60, 0x0,  0xd,  0x80, 0x63, 0xbf,
                   0x2e, 0xa2, 0xfd, 0x1d, 0xa2, 0x71, 0x82, 0x8a, 0xbc, 0x59};

  uint8_t buf[95] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf5, 0xdd, 0x6f};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xeb, 0x1,  0x2c, 0x6e, 0x51, 0x26, 0x11, 0x62, 0x4a, 0x14,
                                  0xb1, 0xb2, 0xc2, 0xb5, 0xef, 0xf3, 0x49, 0xa7, 0xe8, 0x96,
                                  0xb3, 0x7c, 0x5e, 0xb9, 0xf1, 0xa4, 0x57, 0x76, 0xd3};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6922;
  uint8_t client_id_bytes[] = {0x84, 0xd3, 0x14, 0xaf, 0xb7, 0x14, 0x17, 0xaa, 0x59};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x26, 0x3, 0x11, 0x74, 0x4a, 0xcc, 0xd3, 0x51, 0x60};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x80, 0x63, 0xbf, 0x2e, 0xa2, 0xfd, 0x1d, 0xa2, 0x71, 0x82, 0x8a, 0xbc, 0x59};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\"\142.S\145\159\133VvX<\209\161", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\136Rv", _willMsg =
// "v\SUB58p+]s\v\SYN\DC3!\220\199\192'K\140d\n@\133\188\CAN\174\209\SYNK", _willProps = []}), _cleanSession = False,
// _keepAlive = 25116, _connID = "\SOR\"\166}\168\197\211\153\NAK\249\165\138\211", _properties = []}
TEST(Connect311QCTest, Encode37) {
  uint8_t pkt[] = {0x10, 0x4d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x62, 0x1c, 0x0,  0xe,  0xe,  0x52,
                   0x22, 0xa6, 0x7d, 0xa8, 0xc5, 0xd3, 0x99, 0x15, 0xf9, 0xa5, 0x8a, 0xd3, 0x0,  0x3,  0x88, 0x52,
                   0x76, 0x0,  0x1c, 0x76, 0x1a, 0x35, 0x38, 0x70, 0x2b, 0x5d, 0x73, 0xb,  0x16, 0x13, 0x21, 0xdc,
                   0xc7, 0xc0, 0x27, 0x4b, 0x8c, 0x64, 0xa,  0x40, 0x85, 0xbc, 0x18, 0xae, 0xd1, 0x16, 0x4b, 0x0,
                   0xe,  0xa9, 0x22, 0x8e, 0x2e, 0x53, 0x91, 0x9f, 0x85, 0x56, 0x76, 0x58, 0x3c, 0xd1, 0xa1};

  uint8_t buf[89] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x88, 0x52, 0x76};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x76, 0x1a, 0x35, 0x38, 0x70, 0x2b, 0x5d, 0x73, 0xb,  0x16, 0x13, 0x21, 0xdc, 0xc7,
                                  0xc0, 0x27, 0x4b, 0x8c, 0x64, 0xa,  0x40, 0x85, 0xbc, 0x18, 0xae, 0xd1, 0x16, 0x4b};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25116;
  uint8_t client_id_bytes[] = {0xe, 0x52, 0x22, 0xa6, 0x7d, 0xa8, 0xc5, 0xd3, 0x99, 0x15, 0xf9, 0xa5, 0x8a, 0xd3};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0x22, 0x8e, 0x2e, 0x53, 0x91, 0x9f, 0x85, 0x56, 0x76, 0x58, 0x3c, 0xd1, 0xa1};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "j3`=\194\212\200O\134\155v\212", _password = Just "\SI\FS=Y\232J\158\196\230\170",
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 1881, _connID = "c\207n(N\155H\154,\158u\205*\f\182\SO",
// _properties = []}
TEST(Connect311QCTest, Encode38) {
  uint8_t pkt[] = {0x10, 0x36, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x7,  0x59, 0x0,  0x10,
                   0x63, 0xcf, 0x6e, 0x28, 0x4e, 0x9b, 0x48, 0x9a, 0x2c, 0x9e, 0x75, 0xcd, 0x2a, 0xc,
                   0xb6, 0xe,  0x0,  0xc,  0x6a, 0x33, 0x60, 0x3d, 0xc2, 0xd4, 0xc8, 0x4f, 0x86, 0x9b,
                   0x76, 0xd4, 0x0,  0xa,  0xf,  0x1c, 0x3d, 0x59, 0xe8, 0x4a, 0x9e, 0xc4, 0xe6, 0xaa};

  uint8_t buf[66] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1881;
  uint8_t client_id_bytes[] = {0x63, 0xcf, 0x6e, 0x28, 0x4e, 0x9b, 0x48, 0x9a,
                               0x2c, 0x9e, 0x75, 0xcd, 0x2a, 0xc,  0xb6, 0xe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6a, 0x33, 0x60, 0x3d, 0xc2, 0xd4, 0xc8, 0x4f, 0x86, 0x9b, 0x76, 0xd4};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf, 0x1c, 0x3d, 0x59, 0xe8, 0x4a, 0x9e, 0xc4, 0xe6, 0xaa};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETXp\147\149\&7", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "\218G\228", _willMsg =
// "\133\141;\199\135\145\&1\NAK\215\162H\224\199q\ft\156F\STX\178\162\152\147f\SI\229\248", _willProps = []}),
// _cleanSession = False, _keepAlive = 3338, _connID =
// "\244\164\&6\SYN\146\249\SOHR|b\175e~\146x\233H\240C\208\249M\233v\234\194\203\189\230\222", _properties = []}
TEST(Connect311QCTest, Encode39) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0xd,  0xa,  0x0,  0x1e, 0xf4,
                   0xa4, 0x36, 0x16, 0x92, 0xf9, 0x1,  0x52, 0x7c, 0x62, 0xaf, 0x65, 0x7e, 0x92, 0x78, 0xe9,
                   0x48, 0xf0, 0x43, 0xd0, 0xf9, 0x4d, 0xe9, 0x76, 0xea, 0xc2, 0xcb, 0xbd, 0xe6, 0xde, 0x0,
                   0x3,  0xda, 0x47, 0xe4, 0x0,  0x1b, 0x85, 0x8d, 0x3b, 0xc7, 0x87, 0x91, 0x31, 0x15, 0xd7,
                   0xa2, 0x48, 0xe0, 0xc7, 0x71, 0xc,  0x74, 0x9c, 0x46, 0x2,  0xb2, 0xa2, 0x98, 0x93, 0x66,
                   0xf,  0xe5, 0xf8, 0x0,  0x5,  0x3,  0x70, 0x93, 0x95, 0x37};

  uint8_t buf[95] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0x47, 0xe4};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x85, 0x8d, 0x3b, 0xc7, 0x87, 0x91, 0x31, 0x15, 0xd7, 0xa2, 0x48, 0xe0, 0xc7, 0x71,
                                  0xc,  0x74, 0x9c, 0x46, 0x2,  0xb2, 0xa2, 0x98, 0x93, 0x66, 0xf,  0xe5, 0xf8};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3338;
  uint8_t client_id_bytes[] = {0xf4, 0xa4, 0x36, 0x16, 0x92, 0xf9, 0x1,  0x52, 0x7c, 0x62,
                               0xaf, 0x65, 0x7e, 0x92, 0x78, 0xe9, 0x48, 0xf0, 0x43, 0xd0,
                               0xf9, 0x4d, 0xe9, 0x76, 0xea, 0xc2, 0xcb, 0xbd, 0xe6, 0xde};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3, 0x70, 0x93, 0x95, 0x37};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%s%1", _password = Just "JZ\188v\194\151\206\232\FS8\227", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "<3\134\&3\210\ai\247\172", _willMsg =
// "\195Z\ACK\163\170\202", _willProps = []}), _cleanSession = False, _keepAlive = 21786, _connID =
// "$\218\249\238\250,\NUL\129\DC2\162H\219_\168K\DC1\212\231\195p\167\157\177D\149", _properties = []}
TEST(Connect311QCTest, Encode40) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x55, 0x1a, 0x0,  0x19, 0x24, 0xda,
                   0xf9, 0xee, 0xfa, 0x2c, 0x0,  0x81, 0x12, 0xa2, 0x48, 0xdb, 0x5f, 0xa8, 0x4b, 0x11, 0xd4, 0xe7,
                   0xc3, 0x70, 0xa7, 0x9d, 0xb1, 0x44, 0x95, 0x0,  0x9,  0x3c, 0x33, 0x86, 0x33, 0xd2, 0x7,  0x69,
                   0xf7, 0xac, 0x0,  0x6,  0xc3, 0x5a, 0x6,  0xa3, 0xaa, 0xca, 0x0,  0x4,  0x25, 0x73, 0x25, 0x31,
                   0x0,  0xb,  0x4a, 0x5a, 0xbc, 0x76, 0xc2, 0x97, 0xce, 0xe8, 0x1c, 0x38, 0xe3};

  uint8_t buf[87] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3c, 0x33, 0x86, 0x33, 0xd2, 0x7, 0x69, 0xf7, 0xac};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc3, 0x5a, 0x6, 0xa3, 0xaa, 0xca};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21786;
  uint8_t client_id_bytes[] = {0x24, 0xda, 0xf9, 0xee, 0xfa, 0x2c, 0x0,  0x81, 0x12, 0xa2, 0x48, 0xdb, 0x5f,
                               0xa8, 0x4b, 0x11, 0xd4, 0xe7, 0xc3, 0x70, 0xa7, 0x9d, 0xb1, 0x44, 0x95};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x73, 0x25, 0x31};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4a, 0x5a, 0xbc, 0x76, 0xc2, 0x97, 0xce, 0xe8, 0x1c, 0x38, 0xe3};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\"\192-\143\173\214\ETXL\182X\SOHQ", _password = Just
// "\210\SI4\163\NUL>\DC1}2x\SOHq\134\ETX\245\&0\169\180", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\227\NAK\133\240\173\&0\r", _willMsg = "\197 \US<Q\vIe_\159d6'\157\b\FS}\207\152b\153L\201\203",
// _willProps = []}), _cleanSession = True, _keepAlive = 22592, _connID = "XA\237\251\186s\FS(W\ESC\157\194",
// _properties = []}
TEST(Connect311QCTest, Encode41) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x58, 0x40, 0x0,  0xc,  0x58, 0x41,
                   0xed, 0xfb, 0xba, 0x73, 0x1c, 0x28, 0x57, 0x1b, 0x9d, 0xc2, 0x0,  0x7,  0xe3, 0x15, 0x85, 0xf0,
                   0xad, 0x30, 0xd,  0x0,  0x18, 0xc5, 0x20, 0x1f, 0x3c, 0x51, 0xb,  0x49, 0x65, 0x5f, 0x9f, 0x64,
                   0x36, 0x27, 0x9d, 0x8,  0x1c, 0x7d, 0xcf, 0x98, 0x62, 0x99, 0x4c, 0xc9, 0xcb, 0x0,  0xc,  0x22,
                   0xc0, 0x2d, 0x8f, 0xad, 0xd6, 0x3,  0x4c, 0xb6, 0x58, 0x1,  0x51, 0x0,  0x12, 0xd2, 0xf,  0x34,
                   0xa3, 0x0,  0x3e, 0x11, 0x7d, 0x32, 0x78, 0x1,  0x71, 0x86, 0x3,  0xf5, 0x30, 0xa9, 0xb4};

  uint8_t buf[105] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0x15, 0x85, 0xf0, 0xad, 0x30, 0xd};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc5, 0x20, 0x1f, 0x3c, 0x51, 0xb,  0x49, 0x65, 0x5f, 0x9f, 0x64, 0x36,
                                  0x27, 0x9d, 0x8,  0x1c, 0x7d, 0xcf, 0x98, 0x62, 0x99, 0x4c, 0xc9, 0xcb};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22592;
  uint8_t client_id_bytes[] = {0x58, 0x41, 0xed, 0xfb, 0xba, 0x73, 0x1c, 0x28, 0x57, 0x1b, 0x9d, 0xc2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x22, 0xc0, 0x2d, 0x8f, 0xad, 0xd6, 0x3, 0x4c, 0xb6, 0x58, 0x1, 0x51};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd2, 0xf, 0x34, 0xa3, 0x0, 0x3e, 0x11, 0x7d, 0x32,
                              0x78, 0x1, 0x71, 0x86, 0x3, 0xf5, 0x30, 0xa9, 0xb4};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "~\DC3\ESCh\220\132\&9~\FS\213\139\205\242\158t\242\208o4\175\134\143(\192\207nL\188)\202", _password = Nothing,
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 18216, _connID = "&6r\145{\232\157\f\225\197\135!\STX",
// _properties = []}
TEST(Connect311QCTest, Encode42) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x47, 0x28, 0x0,  0xd,  0x26,
                   0x36, 0x72, 0x91, 0x7b, 0xe8, 0x9d, 0xc,  0xe1, 0xc5, 0x87, 0x21, 0x2,  0x0,  0x1e, 0x7e,
                   0x13, 0x1b, 0x68, 0xdc, 0x84, 0x39, 0x7e, 0x1c, 0xd5, 0x8b, 0xcd, 0xf2, 0x9e, 0x74, 0xf2,
                   0xd0, 0x6f, 0x34, 0xaf, 0x86, 0x8f, 0x28, 0xc0, 0xcf, 0x6e, 0x4c, 0xbc, 0x29, 0xca};

  uint8_t buf[69] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18216;
  uint8_t client_id_bytes[] = {0x26, 0x36, 0x72, 0x91, 0x7b, 0xe8, 0x9d, 0xc, 0xe1, 0xc5, 0x87, 0x21, 0x2};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7e, 0x13, 0x1b, 0x68, 0xdc, 0x84, 0x39, 0x7e, 0x1c, 0xd5, 0x8b, 0xcd, 0xf2, 0x9e, 0x74,
                              0xf2, 0xd0, 0x6f, 0x34, 0xaf, 0x86, 0x8f, 0x28, 0xc0, 0xcf, 0x6e, 0x4c, 0xbc, 0x29, 0xca};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "p\148\STX\193*\195\130\ENQ\162\247\v\\b\139\240\152", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\186C\NAK\197\179", _willMsg =
// "Y7%\242\197D\157\238\130\226\186.\212Q\183\ETX\181S\159!-HG", _willProps = []}), _cleanSession = False, _keepAlive =
// 11046, _connID = ":\131J\139+\"\230V\245\180D\161E\203\254\141[\169e", _properties = []}
TEST(Connect311QCTest, Encode43) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x2b, 0x26, 0x0,  0x13, 0x3a, 0x83, 0x4a,
                   0x8b, 0x2b, 0x22, 0xe6, 0x56, 0xf5, 0xb4, 0x44, 0xa1, 0x45, 0xcb, 0xfe, 0x8d, 0x5b, 0xa9, 0x65, 0x0,
                   0x5,  0xba, 0x43, 0x15, 0xc5, 0xb3, 0x0,  0x17, 0x59, 0x37, 0x25, 0xf2, 0xc5, 0x44, 0x9d, 0xee, 0x82,
                   0xe2, 0xba, 0x2e, 0xd4, 0x51, 0xb7, 0x3,  0xb5, 0x53, 0x9f, 0x21, 0x2d, 0x48, 0x47, 0x0,  0x10, 0x70,
                   0x94, 0x2,  0xc1, 0x2a, 0xc3, 0x82, 0x5,  0xa2, 0xf7, 0xb,  0x5c, 0x62, 0x8b, 0xf0, 0x98};

  uint8_t buf[93] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xba, 0x43, 0x15, 0xc5, 0xb3};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x59, 0x37, 0x25, 0xf2, 0xc5, 0x44, 0x9d, 0xee, 0x82, 0xe2, 0xba, 0x2e,
                                  0xd4, 0x51, 0xb7, 0x3,  0xb5, 0x53, 0x9f, 0x21, 0x2d, 0x48, 0x47};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11046;
  uint8_t client_id_bytes[] = {0x3a, 0x83, 0x4a, 0x8b, 0x2b, 0x22, 0xe6, 0x56, 0xf5, 0xb4,
                               0x44, 0xa1, 0x45, 0xcb, 0xfe, 0x8d, 0x5b, 0xa9, 0x65};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x70, 0x94, 0x2, 0xc1, 0x2a, 0xc3, 0x82, 0x5,
                              0xa2, 0xf7, 0xb, 0x5c, 0x62, 0x8b, 0xf0, 0x98};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "y\222\SYN\215\SUB\192\219^\vN+w\212\186\&5\ETB\141)\207)1W$\150\SI", _password =
// Just "H\153[\FSZ}Q\\K\255\ENQ\212\182Kf\159K\NAK", _lastWill = Nothing, _cleanSession = False, _keepAlive = 19248,
// _connID = "\212\139\234\143\196\158v#\137\a\221GH", _properties = []}
TEST(Connect311QCTest, Encode44) {
  uint8_t pkt[] = {0x10, 0x48, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x4b, 0x30, 0x0,  0xd,  0xd4,
                   0x8b, 0xea, 0x8f, 0xc4, 0x9e, 0x76, 0x23, 0x89, 0x7,  0xdd, 0x47, 0x48, 0x0,  0x19, 0x79,
                   0xde, 0x16, 0xd7, 0x1a, 0xc0, 0xdb, 0x5e, 0xb,  0x4e, 0x2b, 0x77, 0xd4, 0xba, 0x35, 0x17,
                   0x8d, 0x29, 0xcf, 0x29, 0x31, 0x57, 0x24, 0x96, 0xf,  0x0,  0x12, 0x48, 0x99, 0x5b, 0x1c,
                   0x5a, 0x7d, 0x51, 0x5c, 0x4b, 0xff, 0x5,  0xd4, 0xb6, 0x4b, 0x66, 0x9f, 0x4b, 0x15};

  uint8_t buf[84] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19248;
  uint8_t client_id_bytes[] = {0xd4, 0x8b, 0xea, 0x8f, 0xc4, 0x9e, 0x76, 0x23, 0x89, 0x7, 0xdd, 0x47, 0x48};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x79, 0xde, 0x16, 0xd7, 0x1a, 0xc0, 0xdb, 0x5e, 0xb,  0x4e, 0x2b, 0x77, 0xd4,
                              0xba, 0x35, 0x17, 0x8d, 0x29, 0xcf, 0x29, 0x31, 0x57, 0x24, 0x96, 0xf};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x48, 0x99, 0x5b, 0x1c, 0x5a, 0x7d, 0x51, 0x5c, 0x4b,
                              0xff, 0x5,  0xd4, 0xb6, 0x4b, 0x66, 0x9f, 0x4b, 0x15};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "%\204\185\&3\ETB&\174\163\f\195%\205\&3[>\DEL\147\243\248\SI9\198\187\\\219\146\152\229\214\233", _lastWill =
// Nothing, _cleanSession = False, _keepAlive = 30703, _connID = "3\193)\173", _properties = []}
TEST(Connect311QCTest, Encode45) {
  uint8_t pkt[] = {0x10, 0x10, 0x0,  0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,
                   0x0,  0x77, 0xef, 0x0, 0x4,  0x33, 0xc1, 0x29, 0xad};

  uint8_t buf[28] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30703;
  uint8_t client_id_bytes[] = {0x33, 0xc1, 0x29, 0xad};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x25, 0xcc, 0xb9, 0x33, 0x17, 0x26, 0xae, 0xa3, 0xc,  0xc3, 0x25, 0xcd, 0x33, 0x5b, 0x3e,
                              0x7f, 0x93, 0xf3, 0xf8, 0xf,  0x39, 0xc6, 0xbb, 0x5c, 0xdb, 0x92, 0x98, 0xe5, 0xd6, 0xe9};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "]\193c\STX\r\223\249r\ETXZ\v\aN1\DEL\172q\RS\210\169\176i\147\FS\191\181\200Vk%",
// _password = Just "\150\212\ESC\162~(\188%\191\133\243l", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 9661, _connID = "l\v\146\230\194\DC4X\149\219\171 \169y\188\176\&4\144O", _properties = []}
TEST(Connect311QCTest, Encode46) {
  uint8_t pkt[] = {0x10, 0x4c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x25, 0xbd, 0x0,  0x12, 0x6c, 0xb,
                   0x92, 0xe6, 0xc2, 0x14, 0x58, 0x95, 0xdb, 0xab, 0x20, 0xa9, 0x79, 0xbc, 0xb0, 0x34, 0x90, 0x4f,
                   0x0,  0x1e, 0x5d, 0xc1, 0x63, 0x2,  0xd,  0xdf, 0xf9, 0x72, 0x3,  0x5a, 0xb,  0x7,  0x4e, 0x31,
                   0x7f, 0xac, 0x71, 0x1e, 0xd2, 0xa9, 0xb0, 0x69, 0x93, 0x1c, 0xbf, 0xb5, 0xc8, 0x56, 0x6b, 0x25,
                   0x0,  0xc,  0x96, 0xd4, 0x1b, 0xa2, 0x7e, 0x28, 0xbc, 0x25, 0xbf, 0x85, 0xf3, 0x6c};

  uint8_t buf[88] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9661;
  uint8_t client_id_bytes[] = {0x6c, 0xb,  0x92, 0xe6, 0xc2, 0x14, 0x58, 0x95, 0xdb,
                               0xab, 0x20, 0xa9, 0x79, 0xbc, 0xb0, 0x34, 0x90, 0x4f};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0xc1, 0x63, 0x2,  0xd,  0xdf, 0xf9, 0x72, 0x3,  0x5a, 0xb,  0x7,  0x4e, 0x31, 0x7f,
                              0xac, 0x71, 0x1e, 0xd2, 0xa9, 0xb0, 0x69, 0x93, 0x1c, 0xbf, 0xb5, 0xc8, 0x56, 0x6b, 0x25};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0xd4, 0x1b, 0xa2, 0x7e, 0x28, 0xbc, 0x25, 0xbf, 0x85, 0xf3, 0x6c};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "HK\160A\236!\215\217", _password = Just "\172", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "_#", _willMsg = "}\199!\254\224\b\154\&2\232\184\163\213?\186",
// _willProps = []}), _cleanSession = True, _keepAlive = 8375, _connID = "{iE\207H\USn\DLE\193\b\245\216JK", _properties
// = []}
TEST(Connect311QCTest, Encode47) {
  uint8_t pkt[] = {0x10, 0x3b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x20, 0xb7, 0x0,  0xe,  0x7b, 0x69,
                   0x45, 0xcf, 0x48, 0x1f, 0x6e, 0x10, 0xc1, 0x8,  0xf5, 0xd8, 0x4a, 0x4b, 0x0,  0x2,  0x5f, 0x23,
                   0x0,  0xe,  0x7d, 0xc7, 0x21, 0xfe, 0xe0, 0x8,  0x9a, 0x32, 0xe8, 0xb8, 0xa3, 0xd5, 0x3f, 0xba,
                   0x0,  0x8,  0x48, 0x4b, 0xa0, 0x41, 0xec, 0x21, 0xd7, 0xd9, 0x0,  0x1,  0xac};

  uint8_t buf[71] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0x23};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7d, 0xc7, 0x21, 0xfe, 0xe0, 0x8, 0x9a, 0x32, 0xe8, 0xb8, 0xa3, 0xd5, 0x3f, 0xba};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8375;
  uint8_t client_id_bytes[] = {0x7b, 0x69, 0x45, 0xcf, 0x48, 0x1f, 0x6e, 0x10, 0xc1, 0x8, 0xf5, 0xd8, 0x4a, 0x4b};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x48, 0x4b, 0xa0, 0x41, 0xec, 0x21, 0xd7, 0xd9};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xac};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "s\249\NAK\192\197\&1\198#\180\SOH2\136\150\183B\199\209W@\DC3a\DLE\246\148\187\246\"", _password = Just
// "\224\236\147\252C\148\166\DEL\185\157\241m\242\132\SO\\q", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "\tqP", _willMsg = "o\SO.\159", _willProps = []}), _cleanSession = False, _keepAlive = 1422,
// _connID = "\184\233(\195\247\\\DC28i\FSj\135", _properties = []}
TEST(Connect311QCTest, Encode48) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x5,  0x8e, 0x0,  0xc,  0xb8,
                   0xe9, 0x28, 0xc3, 0xf7, 0x5c, 0x12, 0x38, 0x69, 0x1c, 0x6a, 0x87, 0x0,  0x3,  0x9,  0x71,
                   0x50, 0x0,  0x4,  0x6f, 0xe,  0x2e, 0x9f, 0x0,  0x1b, 0x73, 0xf9, 0x15, 0xc0, 0xc5, 0x31,
                   0xc6, 0x23, 0xb4, 0x1,  0x32, 0x88, 0x96, 0xb7, 0x42, 0xc7, 0xd1, 0x57, 0x40, 0x13, 0x61,
                   0x10, 0xf6, 0x94, 0xbb, 0xf6, 0x22, 0x0,  0x11, 0xe0, 0xec, 0x93, 0xfc, 0x43, 0x94, 0xa6,
                   0x7f, 0xb9, 0x9d, 0xf1, 0x6d, 0xf2, 0x84, 0xe,  0x5c, 0x71};

  uint8_t buf[95] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9, 0x71, 0x50};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6f, 0xe, 0x2e, 0x9f};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1422;
  uint8_t client_id_bytes[] = {0xb8, 0xe9, 0x28, 0xc3, 0xf7, 0x5c, 0x12, 0x38, 0x69, 0x1c, 0x6a, 0x87};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x73, 0xf9, 0x15, 0xc0, 0xc5, 0x31, 0xc6, 0x23, 0xb4, 0x1,  0x32, 0x88, 0x96, 0xb7,
                              0x42, 0xc7, 0xd1, 0x57, 0x40, 0x13, 0x61, 0x10, 0xf6, 0x94, 0xbb, 0xf6, 0x22};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xec, 0x93, 0xfc, 0x43, 0x94, 0xa6, 0x7f, 0xb9,
                              0x9d, 0xf1, 0x6d, 0xf2, 0x84, 0xe,  0x5c, 0x71};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\ESC-v\215\228\195+\251.F6\r\221\213nfx\221", _password = Just "\193\152",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 20170, _connID =
// "9\b4\231\247\150H\ETB\GS\236t\185o\189\144\173\203P\207z\173", _properties = []}
TEST(Connect311QCTest, Encode49) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x4e, 0xca, 0x0,  0x15, 0x39,
                   0x8,  0x34, 0xe7, 0xf7, 0x96, 0x48, 0x17, 0x1d, 0xec, 0x74, 0xb9, 0x6f, 0xbd, 0x90, 0xad,
                   0xcb, 0x50, 0xcf, 0x7a, 0xad, 0x0,  0x13, 0xcc, 0x1b, 0x2d, 0x76, 0xd7, 0xe4, 0xc3, 0x2b,
                   0xfb, 0x2e, 0x46, 0x36, 0xd,  0xdd, 0xd5, 0x6e, 0x66, 0x78, 0xdd, 0x0,  0x2,  0xc1, 0x98};

  uint8_t buf[70] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20170;
  uint8_t client_id_bytes[] = {0x39, 0x8,  0x34, 0xe7, 0xf7, 0x96, 0x48, 0x17, 0x1d, 0xec, 0x74,
                               0xb9, 0x6f, 0xbd, 0x90, 0xad, 0xcb, 0x50, 0xcf, 0x7a, 0xad};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x1b, 0x2d, 0x76, 0xd7, 0xe4, 0xc3, 0x2b, 0xfb, 0x2e,
                              0x46, 0x36, 0xd,  0xdd, 0xd5, 0x6e, 0x66, 0x78, 0xdd};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc1, 0x98};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "t\239", _password = Just "\r%\148", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\r\226_c,\248", _willMsg = "\151\168\141\183G\198", _willProps = []}), _cleanSession =
// False, _keepAlive = 29236, _connID = "\202\219", _properties = []}
TEST(Connect311QCTest, Encode50) {
  uint8_t pkt[] = {0x10, 0x27, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x72, 0x34, 0x0,  0x2,
                   0xca, 0xdb, 0x0,  0x6,  0xd,  0xe2, 0x5f, 0x63, 0x2c, 0xf8, 0x0,  0x6,  0x97, 0xa8,
                   0x8d, 0xb7, 0x47, 0xc6, 0x0,  0x2,  0x74, 0xef, 0x0,  0x3,  0xd,  0x25, 0x94};

  uint8_t buf[51] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd, 0xe2, 0x5f, 0x63, 0x2c, 0xf8};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0xa8, 0x8d, 0xb7, 0x47, 0xc6};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29236;
  uint8_t client_id_bytes[] = {0xca, 0xdb};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x74, 0xef};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd, 0x25, 0x94};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\144:3}\185E\246k\210Hp\221\197\245\&6\148\135m\216\143p\136\185\STX\ENQ\186\149?",
// _password = Just "\DC3\NAK\168)\SUB\234>\CAN\168\155\253RB\142?\137D\181y\170\&3O!+", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\227\205\234\251\"J\133\178\154\154[\STX\135\DC4[\a@\245[e\SUBR1\234\201\192'\vam", _willMsg = "\CAN\230\GS",
// _willProps = []}), _cleanSession = False, _keepAlive = 542, _connID =
// ")\ESC\193I>\"[\SO\187G\\\182\199yj\DC4o\204\229yV\"n+\138u\223", _properties = []}
TEST(Connect311QCTest, Encode51) {
  uint8_t pkt[] = {0x10, 0x84, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x2,  0x1e, 0x0,  0x1b, 0x29, 0x1b,
                   0xc1, 0x49, 0x3e, 0x22, 0x5b, 0xe,  0xbb, 0x47, 0x5c, 0xb6, 0xc7, 0x79, 0x6a, 0x14, 0x6f, 0xcc, 0xe5,
                   0x79, 0x56, 0x22, 0x6e, 0x2b, 0x8a, 0x75, 0xdf, 0x0,  0x1e, 0xe3, 0xcd, 0xea, 0xfb, 0x22, 0x4a, 0x85,
                   0xb2, 0x9a, 0x9a, 0x5b, 0x2,  0x87, 0x14, 0x5b, 0x7,  0x40, 0xf5, 0x5b, 0x65, 0x1a, 0x52, 0x31, 0xea,
                   0xc9, 0xc0, 0x27, 0xb,  0x61, 0x6d, 0x0,  0x3,  0x18, 0xe6, 0x1d, 0x0,  0x1c, 0x90, 0x3a, 0x33, 0x7d,
                   0xb9, 0x45, 0xf6, 0x6b, 0xd2, 0x48, 0x70, 0xdd, 0xc5, 0xf5, 0x36, 0x94, 0x87, 0x6d, 0xd8, 0x8f, 0x70,
                   0x88, 0xb9, 0x2,  0x5,  0xba, 0x95, 0x3f, 0x0,  0x18, 0x13, 0x15, 0xa8, 0x29, 0x1a, 0xea, 0x3e, 0x18,
                   0xa8, 0x9b, 0xfd, 0x52, 0x42, 0x8e, 0x3f, 0x89, 0x44, 0xb5, 0x79, 0xaa, 0x33, 0x4f, 0x21, 0x2b};

  uint8_t buf[145] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xcd, 0xea, 0xfb, 0x22, 0x4a, 0x85, 0xb2, 0x9a, 0x9a,
                                0x5b, 0x2,  0x87, 0x14, 0x5b, 0x7,  0x40, 0xf5, 0x5b, 0x65,
                                0x1a, 0x52, 0x31, 0xea, 0xc9, 0xc0, 0x27, 0xb,  0x61, 0x6d};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x18, 0xe6, 0x1d};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 542;
  uint8_t client_id_bytes[] = {0x29, 0x1b, 0xc1, 0x49, 0x3e, 0x22, 0x5b, 0xe,  0xbb, 0x47, 0x5c, 0xb6, 0xc7, 0x79,
                               0x6a, 0x14, 0x6f, 0xcc, 0xe5, 0x79, 0x56, 0x22, 0x6e, 0x2b, 0x8a, 0x75, 0xdf};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x90, 0x3a, 0x33, 0x7d, 0xb9, 0x45, 0xf6, 0x6b, 0xd2, 0x48, 0x70, 0xdd, 0xc5, 0xf5,
                              0x36, 0x94, 0x87, 0x6d, 0xd8, 0x8f, 0x70, 0x88, 0xb9, 0x2,  0x5,  0xba, 0x95, 0x3f};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x13, 0x15, 0xa8, 0x29, 0x1a, 0xea, 0x3e, 0x18, 0xa8, 0x9b, 0xfd, 0x52,
                              0x42, 0x8e, 0x3f, 0x89, 0x44, 0xb5, 0x79, 0xaa, 0x33, 0x4f, 0x21, 0x2b};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "LW\149,C?\222\163x\147\176\166e\163!\187}@2\213\n", _password = Just
// "\166\&1Vn<\147O\v\178i\245g:\SUB", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\243\244O\221\ETX\229\192\137;\183\197D/\221!m\211\162", _willMsg =
// "\239M(\237\209\235\215\"\SI\220v\217\205\n\228\156\205s\250\244\167K\185\SI-\ETB\SOq\r", _willProps = []}),
// _cleanSession = False, _keepAlive = 32428, _connID =
// "\SYN\217\207Z5\137\241\224\174\144\248\192*\233\218Z\230\DEL\198I9", _properties = []}
TEST(Connect311QCTest, Encode52) {
  uint8_t pkt[] = {0x10, 0x7b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x7e, 0xac, 0x0,  0x15, 0x16, 0xd9,
                   0xcf, 0x5a, 0x35, 0x89, 0xf1, 0xe0, 0xae, 0x90, 0xf8, 0xc0, 0x2a, 0xe9, 0xda, 0x5a, 0xe6, 0x7f,
                   0xc6, 0x49, 0x39, 0x0,  0x12, 0xf3, 0xf4, 0x4f, 0xdd, 0x3,  0xe5, 0xc0, 0x89, 0x3b, 0xb7, 0xc5,
                   0x44, 0x2f, 0xdd, 0x21, 0x6d, 0xd3, 0xa2, 0x0,  0x1d, 0xef, 0x4d, 0x28, 0xed, 0xd1, 0xeb, 0xd7,
                   0x22, 0xf,  0xdc, 0x76, 0xd9, 0xcd, 0xa,  0xe4, 0x9c, 0xcd, 0x73, 0xfa, 0xf4, 0xa7, 0x4b, 0xb9,
                   0xf,  0x2d, 0x17, 0xe,  0x71, 0xd,  0x0,  0x15, 0x4c, 0x57, 0x95, 0x2c, 0x43, 0x3f, 0xde, 0xa3,
                   0x78, 0x93, 0xb0, 0xa6, 0x65, 0xa3, 0x21, 0xbb, 0x7d, 0x40, 0x32, 0xd5, 0xa,  0x0,  0xe,  0xa6,
                   0x31, 0x56, 0x6e, 0x3c, 0x93, 0x4f, 0xb,  0xb2, 0x69, 0xf5, 0x67, 0x3a, 0x1a};

  uint8_t buf[135] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf3, 0xf4, 0x4f, 0xdd, 0x3,  0xe5, 0xc0, 0x89, 0x3b,
                                0xb7, 0xc5, 0x44, 0x2f, 0xdd, 0x21, 0x6d, 0xd3, 0xa2};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xef, 0x4d, 0x28, 0xed, 0xd1, 0xeb, 0xd7, 0x22, 0xf,  0xdc,
                                  0x76, 0xd9, 0xcd, 0xa,  0xe4, 0x9c, 0xcd, 0x73, 0xfa, 0xf4,
                                  0xa7, 0x4b, 0xb9, 0xf,  0x2d, 0x17, 0xe,  0x71, 0xd};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32428;
  uint8_t client_id_bytes[] = {0x16, 0xd9, 0xcf, 0x5a, 0x35, 0x89, 0xf1, 0xe0, 0xae, 0x90, 0xf8,
                               0xc0, 0x2a, 0xe9, 0xda, 0x5a, 0xe6, 0x7f, 0xc6, 0x49, 0x39};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4c, 0x57, 0x95, 0x2c, 0x43, 0x3f, 0xde, 0xa3, 0x78, 0x93, 0xb0,
                              0xa6, 0x65, 0xa3, 0x21, 0xbb, 0x7d, 0x40, 0x32, 0xd5, 0xa};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa6, 0x31, 0x56, 0x6e, 0x3c, 0x93, 0x4f, 0xb, 0xb2, 0x69, 0xf5, 0x67, 0x3a, 0x1a};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\230\206\252H\237\141\SIb\136w \172Y\159\155sC\141\159\"s\246{\DEL\254\208~\130",
// _password = Just "o\191Q<34\244\255\186\STXo\235,\210\v\SYN_\234\"x\219X\242\159.D\231", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\204\DC4\226:25\172", _willMsg = "\NAK\232\175\221\193,",
// _willProps = []}), _cleanSession = False, _keepAlive = 4766, _connID =
// "p\205\137>X(\171\175\246\NAKr\254\223H\232\252\254\236\198<", _properties = []}
TEST(Connect311QCTest, Encode53) {
  uint8_t pkt[] = {0x10, 0x6c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x12, 0x9e, 0x0,  0x14, 0x70, 0xcd,
                   0x89, 0x3e, 0x58, 0x28, 0xab, 0xaf, 0xf6, 0x15, 0x72, 0xfe, 0xdf, 0x48, 0xe8, 0xfc, 0xfe, 0xec,
                   0xc6, 0x3c, 0x0,  0x7,  0xcc, 0x14, 0xe2, 0x3a, 0x32, 0x35, 0xac, 0x0,  0x6,  0x15, 0xe8, 0xaf,
                   0xdd, 0xc1, 0x2c, 0x0,  0x1c, 0xe6, 0xce, 0xfc, 0x48, 0xed, 0x8d, 0xf,  0x62, 0x88, 0x77, 0x20,
                   0xac, 0x59, 0x9f, 0x9b, 0x73, 0x43, 0x8d, 0x9f, 0x22, 0x73, 0xf6, 0x7b, 0x7f, 0xfe, 0xd0, 0x7e,
                   0x82, 0x0,  0x1b, 0x6f, 0xbf, 0x51, 0x3c, 0x33, 0x34, 0xf4, 0xff, 0xba, 0x2,  0x6f, 0xeb, 0x2c,
                   0xd2, 0xb,  0x16, 0x5f, 0xea, 0x22, 0x78, 0xdb, 0x58, 0xf2, 0x9f, 0x2e, 0x44, 0xe7};

  uint8_t buf[120] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcc, 0x14, 0xe2, 0x3a, 0x32, 0x35, 0xac};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x15, 0xe8, 0xaf, 0xdd, 0xc1, 0x2c};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4766;
  uint8_t client_id_bytes[] = {0x70, 0xcd, 0x89, 0x3e, 0x58, 0x28, 0xab, 0xaf, 0xf6, 0x15,
                               0x72, 0xfe, 0xdf, 0x48, 0xe8, 0xfc, 0xfe, 0xec, 0xc6, 0x3c};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe6, 0xce, 0xfc, 0x48, 0xed, 0x8d, 0xf,  0x62, 0x88, 0x77, 0x20, 0xac, 0x59, 0x9f,
                              0x9b, 0x73, 0x43, 0x8d, 0x9f, 0x22, 0x73, 0xf6, 0x7b, 0x7f, 0xfe, 0xd0, 0x7e, 0x82};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xbf, 0x51, 0x3c, 0x33, 0x34, 0xf4, 0xff, 0xba, 0x2,  0x6f, 0xeb, 0x2c, 0xd2,
                              0xb,  0x16, 0x5f, 0xea, 0x22, 0x78, 0xdb, 0x58, 0xf2, 0x9f, 0x2e, 0x44, 0xe7};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "<\n\149R0\\\216K\NAK\157\239\187b\243\172\NAKU", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\n", _willMsg =
// "w9\217yM\186\161\166g\136\140\154\178\SYN5\150\228\212\FSHP\235\202\224\242D;", _willProps = []}), _cleanSession =
// False, _keepAlive = 6302, _connID = "5\175\175\181'H\173\161[\157\&8\175BY\182|\179", _properties = []}
TEST(Connect311QCTest, Encode54) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x18, 0x9e, 0x0,  0x11, 0x35, 0xaf,
                   0xaf, 0xb5, 0x27, 0x48, 0xad, 0xa1, 0x5b, 0x9d, 0x38, 0xaf, 0x42, 0x59, 0xb6, 0x7c, 0xb3, 0x0,
                   0x1,  0xa,  0x0,  0x1b, 0x77, 0x39, 0xd9, 0x79, 0x4d, 0xba, 0xa1, 0xa6, 0x67, 0x88, 0x8c, 0x9a,
                   0xb2, 0x16, 0x35, 0x96, 0xe4, 0xd4, 0x1c, 0x48, 0x50, 0xeb, 0xca, 0xe0, 0xf2, 0x44, 0x3b};

  uint8_t buf[73] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x77, 0x39, 0xd9, 0x79, 0x4d, 0xba, 0xa1, 0xa6, 0x67, 0x88, 0x8c, 0x9a, 0xb2, 0x16,
                                  0x35, 0x96, 0xe4, 0xd4, 0x1c, 0x48, 0x50, 0xeb, 0xca, 0xe0, 0xf2, 0x44, 0x3b};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6302;
  uint8_t client_id_bytes[] = {0x35, 0xaf, 0xaf, 0xb5, 0x27, 0x48, 0xad, 0xa1, 0x5b,
                               0x9d, 0x38, 0xaf, 0x42, 0x59, 0xb6, 0x7c, 0xb3};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x3c, 0xa,  0x95, 0x52, 0x30, 0x5c, 0xd8, 0x4b, 0x15,
                              0x9d, 0xef, 0xbb, 0x62, 0xf3, 0xac, 0x15, 0x55};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7x\204\136o\US\ESC\232\vI\211", _password = Just "m", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 16891, _connID = "\152\237\162\129\182]", _properties = []}
TEST(Connect311QCTest, Encode55) {
  uint8_t pkt[] = {0x10, 0x22, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x41, 0xfb,
                   0x0,  0x6,  0x98, 0xed, 0xa2, 0x81, 0xb6, 0x5d, 0x0,  0xb,  0x37, 0x78,
                   0xcc, 0x88, 0x6f, 0x1f, 0x1b, 0xe8, 0xb,  0x49, 0xd3, 0x0,  0x1,  0x6d};

  uint8_t buf[46] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16891;
  uint8_t client_id_bytes[] = {0x98, 0xed, 0xa2, 0x81, 0xb6, 0x5d};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x78, 0xcc, 0x88, 0x6f, 0x1f, 0x1b, 0xe8, 0xb, 0x49, 0xd3};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\189J\246\DC4Ep\136e]\182\253\DEL\n\DC2\"\\\134&\162\252D\144", _password =
// Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 32242, _connID =
// "\218P?\172\167\243\&3_s\246\DC4\EOT\EM\139\169\186?", _properties = []}
TEST(Connect311QCTest, Encode56) {
  uint8_t pkt[] = {0x10, 0x35, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x7d, 0xf2, 0x0,  0x11,
                   0xda, 0x50, 0x3f, 0xac, 0xa7, 0xf3, 0x33, 0x5f, 0x73, 0xf6, 0x14, 0x4,  0x19, 0x8b,
                   0xa9, 0xba, 0x3f, 0x0,  0x16, 0xbd, 0x4a, 0xf6, 0x14, 0x45, 0x70, 0x88, 0x65, 0x5d,
                   0xb6, 0xfd, 0x7f, 0xa,  0x12, 0x22, 0x5c, 0x86, 0x26, 0xa2, 0xfc, 0x44, 0x90};

  uint8_t buf[65] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32242;
  uint8_t client_id_bytes[] = {0xda, 0x50, 0x3f, 0xac, 0xa7, 0xf3, 0x33, 0x5f, 0x73,
                               0xf6, 0x14, 0x4,  0x19, 0x8b, 0xa9, 0xba, 0x3f};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbd, 0x4a, 0xf6, 0x14, 0x45, 0x70, 0x88, 0x65, 0x5d, 0xb6, 0xfd,
                              0x7f, 0xa,  0x12, 0x22, 0x5c, 0x86, 0x26, 0xa2, 0xfc, 0x44, 0x90};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Au`\168A\188\232\r\137)\223\STX\199%\136", _password = Just
// "d\160\254\DEL\EOT\147\231-\152", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\199M\"\227Xv\NUL", _willMsg = "\201Z\208~\134\159\213", _willProps = []}), _cleanSession = True, _keepAlive =
// 16538, _connID = "\ENQ\184\173\135\NAK", _properties = []}
TEST(Connect311QCTest, Encode57) {
  uint8_t pkt[] = {0x10, 0x3f, 0x0,  0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x40, 0x9a, 0x0,  0x5,  0x5,  0xb8, 0xad,
                   0x87, 0x15, 0x0,  0x7, 0xc7, 0x4d, 0x22, 0xe3, 0x58, 0x76, 0x0,  0x0,  0x7,  0xc9, 0x5a, 0xd0, 0x7e,
                   0x86, 0x9f, 0xd5, 0x0, 0xf,  0x41, 0x75, 0x60, 0xa8, 0x41, 0xbc, 0xe8, 0xd,  0x89, 0x29, 0xdf, 0x2,
                   0xc7, 0x25, 0x88, 0x0, 0x9,  0x64, 0xa0, 0xfe, 0x7f, 0x4,  0x93, 0xe7, 0x2d, 0x98};

  uint8_t buf[75] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x4d, 0x22, 0xe3, 0x58, 0x76, 0x0};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc9, 0x5a, 0xd0, 0x7e, 0x86, 0x9f, 0xd5};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16538;
  uint8_t client_id_bytes[] = {0x5, 0xb8, 0xad, 0x87, 0x15};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0x75, 0x60, 0xa8, 0x41, 0xbc, 0xe8, 0xd, 0x89, 0x29, 0xdf, 0x2, 0xc7, 0x25, 0x88};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0xa0, 0xfe, 0x7f, 0x4, 0x93, 0xe7, 0x2d, 0x98};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "I", _password = Just
// "\187\133u\SYN\172\178^\135<\224\244\171\211k\255\158\148\EOT\255\STX1\SI\184", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic =
// "s\241\244i\ETX6\STXo?H<\137\172\RS\203\US\236\ESC\214\218\&9\SIg.", _willMsg =
// "\242en\210E\149\254\131\167\&8\178\242\SOH@#)\215\245\175\160\206e\EMy", _willProps = []}), _cleanSession = True,
// _keepAlive = 29587, _connID = "\192\178\157\213%\235i\USou\STX\245\201\145\\>J", _properties = []}
TEST(Connect311QCTest, Encode58) {
  uint8_t pkt[] = {0x10, 0x6d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x73, 0x93, 0x0,  0x11, 0xc0, 0xb2,
                   0x9d, 0xd5, 0x25, 0xeb, 0x69, 0x1f, 0x6f, 0x75, 0x2,  0xf5, 0xc9, 0x91, 0x5c, 0x3e, 0x4a, 0x0,
                   0x18, 0x73, 0xf1, 0xf4, 0x69, 0x3,  0x36, 0x2,  0x6f, 0x3f, 0x48, 0x3c, 0x89, 0xac, 0x1e, 0xcb,
                   0x1f, 0xec, 0x1b, 0xd6, 0xda, 0x39, 0xf,  0x67, 0x2e, 0x0,  0x18, 0xf2, 0x65, 0x6e, 0xd2, 0x45,
                   0x95, 0xfe, 0x83, 0xa7, 0x38, 0xb2, 0xf2, 0x1,  0x40, 0x23, 0x29, 0xd7, 0xf5, 0xaf, 0xa0, 0xce,
                   0x65, 0x19, 0x79, 0x0,  0x1,  0x49, 0x0,  0x17, 0xbb, 0x85, 0x75, 0x16, 0xac, 0xb2, 0x5e, 0x87,
                   0x3c, 0xe0, 0xf4, 0xab, 0xd3, 0x6b, 0xff, 0x9e, 0x94, 0x4,  0xff, 0x2,  0x31, 0xf,  0xb8};

  uint8_t buf[121] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x73, 0xf1, 0xf4, 0x69, 0x3,  0x36, 0x2,  0x6f, 0x3f, 0x48, 0x3c, 0x89,
                                0xac, 0x1e, 0xcb, 0x1f, 0xec, 0x1b, 0xd6, 0xda, 0x39, 0xf,  0x67, 0x2e};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0x65, 0x6e, 0xd2, 0x45, 0x95, 0xfe, 0x83, 0xa7, 0x38, 0xb2, 0xf2,
                                  0x1,  0x40, 0x23, 0x29, 0xd7, 0xf5, 0xaf, 0xa0, 0xce, 0x65, 0x19, 0x79};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29587;
  uint8_t client_id_bytes[] = {0xc0, 0xb2, 0x9d, 0xd5, 0x25, 0xeb, 0x69, 0x1f, 0x6f,
                               0x75, 0x2,  0xf5, 0xc9, 0x91, 0x5c, 0x3e, 0x4a};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbb, 0x85, 0x75, 0x16, 0xac, 0xb2, 0x5e, 0x87, 0x3c, 0xe0, 0xf4, 0xab,
                              0xd3, 0x6b, 0xff, 0x9e, 0x94, 0x4,  0xff, 0x2,  0x31, 0xf,  0xb8};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 12978, _connID = "\160X\221W2^\230o\163\&7\179s\156", _properties = []}
TEST(Connect311QCTest, Encode59) {
  uint8_t pkt[] = {0x10, 0x19, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x32, 0xb2, 0x0, 0xd,
                   0xa0, 0x58, 0xdd, 0x57, 0x32, 0x5e, 0xe6, 0x6f, 0xa3, 0x37, 0xb3, 0x73, 0x9c};

  uint8_t buf[37] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12978;
  uint8_t client_id_bytes[] = {0xa0, 0x58, 0xdd, 0x57, 0x32, 0x5e, 0xe6, 0x6f, 0xa3, 0x37, 0xb3, 0x73, 0x9c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "^\134", _lastWill = Nothing, _cleanSession = False, _keepAlive
// = 22655, _connID = "\134^\vF\DC1{\207R", _properties = []}
TEST(Connect311QCTest, Encode60) {
  uint8_t pkt[] = {0x10, 0x14, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x58,
                   0x7f, 0x0,  0x8, 0x86, 0x5e, 0xb,  0x46, 0x11, 0x7b, 0xcf, 0x52};

  uint8_t buf[32] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 22655;
  uint8_t client_id_bytes[] = {0x86, 0x5e, 0xb, 0x46, 0x11, 0x7b, 0xcf, 0x52};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5e, 0x86};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 30398, _connID = "\GSv\DC4zn\ETX\185\219i\199/\131\157\245", _properties = []}
TEST(Connect311QCTest, Encode61) {
  uint8_t pkt[] = {0x10, 0x1a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x76, 0xbe, 0x0,  0xe,
                   0x1d, 0x76, 0x14, 0x7a, 0x6e, 0x3,  0xb9, 0xdb, 0x69, 0xc7, 0x2f, 0x83, 0x9d, 0xf5};

  uint8_t buf[38] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30398;
  uint8_t client_id_bytes[] = {0x1d, 0x76, 0x14, 0x7a, 0x6e, 0x3, 0xb9, 0xdb, 0x69, 0xc7, 0x2f, 0x83, 0x9d, 0xf5};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\142\168\DC2Z\a\229\255\250\192\177\&6\172\240D2", _password = Just
// "\r\137\ETBtR\130C*\DC1\223\202\169\147\197\232", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1,
// _willTopic = "\209\194%\251R\ETX%3\CAN\136\174\167\169\139\167\186C)\184*n\154\ETBmG\209T\186\DC1", _willMsg =
// "#yp(#!>\196O\247\DC1\176\253\150\238\214\216\212f\161Xl\t", _willProps = []}), _cleanSession = True, _keepAlive =
// 1871, _connID = "s\ETXN", _properties = []}
TEST(Connect311QCTest, Encode62) {
  uint8_t pkt[] = {0x10, 0x69, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x7,  0x4f, 0x0,  0x3,  0x73, 0x3,
                   0x4e, 0x0,  0x1d, 0xd1, 0xc2, 0x25, 0xfb, 0x52, 0x3,  0x25, 0x33, 0x18, 0x88, 0xae, 0xa7, 0xa9,
                   0x8b, 0xa7, 0xba, 0x43, 0x29, 0xb8, 0x2a, 0x6e, 0x9a, 0x17, 0x6d, 0x47, 0xd1, 0x54, 0xba, 0x11,
                   0x0,  0x17, 0x23, 0x79, 0x70, 0x28, 0x23, 0x21, 0x3e, 0xc4, 0x4f, 0xf7, 0x11, 0xb0, 0xfd, 0x96,
                   0xee, 0xd6, 0xd8, 0xd4, 0x66, 0xa1, 0x58, 0x6c, 0x9,  0x0,  0xf,  0x8e, 0xa8, 0x12, 0x5a, 0x7,
                   0xe5, 0xff, 0xfa, 0xc0, 0xb1, 0x36, 0xac, 0xf0, 0x44, 0x32, 0x0,  0xf,  0xd,  0x89, 0x17, 0x74,
                   0x52, 0x82, 0x43, 0x2a, 0x11, 0xdf, 0xca, 0xa9, 0x93, 0xc5, 0xe8};

  uint8_t buf[117] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0xc2, 0x25, 0xfb, 0x52, 0x3,  0x25, 0x33, 0x18, 0x88,
                                0xae, 0xa7, 0xa9, 0x8b, 0xa7, 0xba, 0x43, 0x29, 0xb8, 0x2a,
                                0x6e, 0x9a, 0x17, 0x6d, 0x47, 0xd1, 0x54, 0xba, 0x11};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x23, 0x79, 0x70, 0x28, 0x23, 0x21, 0x3e, 0xc4, 0x4f, 0xf7, 0x11, 0xb0,
                                  0xfd, 0x96, 0xee, 0xd6, 0xd8, 0xd4, 0x66, 0xa1, 0x58, 0x6c, 0x9};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1871;
  uint8_t client_id_bytes[] = {0x73, 0x3, 0x4e};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8e, 0xa8, 0x12, 0x5a, 0x7, 0xe5, 0xff, 0xfa, 0xc0, 0xb1, 0x36, 0xac, 0xf0, 0x44, 0x32};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd, 0x89, 0x17, 0x74, 0x52, 0x82, 0x43, 0x2a, 0x11, 0xdf, 0xca, 0xa9, 0x93, 0xc5, 0xe8};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "^t\USER\139\244\152'\220\244", _willMsg =
// "\199\STX\191\&2ISE$\SOH}\221O\DC3,P\242\185\245\181\192\\\237\251p\237\247\198\203", _willProps = []}),
// _cleanSession = False, _keepAlive = 13191, _connID = "\152G\DC3\220\161\183\214\153L\231", _properties = []}
TEST(Connect311QCTest, Encode63) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x33, 0x87, 0x0,  0xa,  0x98, 0x47, 0x13,
                   0xdc, 0xa1, 0xb7, 0xd6, 0x99, 0x4c, 0xe7, 0x0,  0xb,  0x5e, 0x74, 0x1f, 0x45, 0x52, 0x8b, 0xf4, 0x98,
                   0x27, 0xdc, 0xf4, 0x0,  0x1c, 0xc7, 0x2,  0xbf, 0x32, 0x49, 0x53, 0x45, 0x24, 0x1,  0x7d, 0xdd, 0x4f,
                   0x13, 0x2c, 0x50, 0xf2, 0xb9, 0xf5, 0xb5, 0xc0, 0x5c, 0xed, 0xfb, 0x70, 0xed, 0xf7, 0xc6, 0xcb};

  uint8_t buf[77] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5e, 0x74, 0x1f, 0x45, 0x52, 0x8b, 0xf4, 0x98, 0x27, 0xdc, 0xf4};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc7, 0x2,  0xbf, 0x32, 0x49, 0x53, 0x45, 0x24, 0x1,  0x7d, 0xdd, 0x4f, 0x13, 0x2c,
                                  0x50, 0xf2, 0xb9, 0xf5, 0xb5, 0xc0, 0x5c, 0xed, 0xfb, 0x70, 0xed, 0xf7, 0xc6, 0xcb};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13191;
  uint8_t client_id_bytes[] = {0x98, 0x47, 0x13, 0xdc, 0xa1, 0xb7, 0xd6, 0x99, 0x4c, 0xe7};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "4\159\162&\FS(\185Vz\159#", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\178\222\199o\DLE`0%\253\145qK;\128\218", _willMsg =
// "\130\&9Pt\tC\201\176\147", _willProps = []}), _cleanSession = False, _keepAlive = 3727, _connID = "\DEL\250\165",
// _properties = []}
TEST(Connect311QCTest, Encode64) {
  uint8_t pkt[] = {0x10, 0x2b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0xe,  0x8f, 0x0,  0x3,  0x7f,
                   0xfa, 0xa5, 0x0,  0xf,  0xb2, 0xde, 0xc7, 0x6f, 0x10, 0x60, 0x30, 0x25, 0xfd, 0x91, 0x71,
                   0x4b, 0x3b, 0x80, 0xda, 0x0,  0x9,  0x82, 0x39, 0x50, 0x74, 0x9,  0x43, 0xc9, 0xb0, 0x93};

  uint8_t buf[55] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xde, 0xc7, 0x6f, 0x10, 0x60, 0x30, 0x25,
                                0xfd, 0x91, 0x71, 0x4b, 0x3b, 0x80, 0xda};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x39, 0x50, 0x74, 0x9, 0x43, 0xc9, 0xb0, 0x93};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3727;
  uint8_t client_id_bytes[] = {0x7f, 0xfa, 0xa5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x34, 0x9f, 0xa2, 0x26, 0x1c, 0x28, 0xb9, 0x56, 0x7a, 0x9f, 0x23};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\RSt\221\140\178\180\155#r\255\&3\212\203w\206\137L\202\190\SUB G\227\FS",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "~^x\SYN6\181\252#\192\a\231\220>\DC2e\NAK", _willMsg =
// "\202S\US{\160\165\GS\f\165\SUB\183D\191\212\150\157\f\SUBwj\204\SYN\167\237\251\161\189", _willProps = []}),
// _cleanSession = False, _keepAlive = 3670, _connID = "H\SI\178\231o\172\&9\153", _properties = []}
TEST(Connect311QCTest, Encode65) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0xe,  0x56, 0x0,  0x8,  0x48, 0xf,
                   0xb2, 0xe7, 0x6f, 0xac, 0x39, 0x99, 0x0,  0x10, 0x7e, 0x5e, 0x78, 0x16, 0x36, 0xb5, 0xfc, 0x23,
                   0xc0, 0x7,  0xe7, 0xdc, 0x3e, 0x12, 0x65, 0x15, 0x0,  0x1b, 0xca, 0x53, 0x1f, 0x7b, 0xa0, 0xa5,
                   0x1d, 0xc,  0xa5, 0x1a, 0xb7, 0x44, 0xbf, 0xd4, 0x96, 0x9d, 0xc,  0x1a, 0x77, 0x6a, 0xcc, 0x16,
                   0xa7, 0xed, 0xfb, 0xa1, 0xbd, 0x0,  0x18, 0x1e, 0x74, 0xdd, 0x8c, 0xb2, 0xb4, 0x9b, 0x23, 0x72,
                   0xff, 0x33, 0xd4, 0xcb, 0x77, 0xce, 0x89, 0x4c, 0xca, 0xbe, 0x1a, 0x20, 0x47, 0xe3, 0x1c};

  uint8_t buf[105] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7e, 0x5e, 0x78, 0x16, 0x36, 0xb5, 0xfc, 0x23,
                                0xc0, 0x7,  0xe7, 0xdc, 0x3e, 0x12, 0x65, 0x15};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x53, 0x1f, 0x7b, 0xa0, 0xa5, 0x1d, 0xc,  0xa5, 0x1a, 0xb7, 0x44, 0xbf, 0xd4,
                                  0x96, 0x9d, 0xc,  0x1a, 0x77, 0x6a, 0xcc, 0x16, 0xa7, 0xed, 0xfb, 0xa1, 0xbd};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3670;
  uint8_t client_id_bytes[] = {0x48, 0xf, 0xb2, 0xe7, 0x6f, 0xac, 0x39, 0x99};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1e, 0x74, 0xdd, 0x8c, 0xb2, 0xb4, 0x9b, 0x23, 0x72, 0xff, 0x33, 0xd4,
                              0xcb, 0x77, 0xce, 0x89, 0x4c, 0xca, 0xbe, 0x1a, 0x20, 0x47, 0xe3, 0x1c};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DC1M\180\r\a\252wp^bZ\135\DEL2@Z\253\165\DC2y\209\226r]\164",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "a\214\153~t\218\159\237r\222\195'\246(\175", _willMsg = "\224\207\248\\\EM\EM/u\n7rM\210", _willProps = []}),
// _cleanSession = True, _keepAlive = 15606, _connID =
// "\DC2O:m\245\197\216\200\\\t\162\221\172w\235d1\138\240\144\RSX%\208C\SOPC\199", _properties = []}
TEST(Connect311QCTest, Encode66) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x3c, 0xf6, 0x0,  0x1d, 0x12,
                   0x4f, 0x3a, 0x6d, 0xf5, 0xc5, 0xd8, 0xc8, 0x5c, 0x9,  0xa2, 0xdd, 0xac, 0x77, 0xeb, 0x64,
                   0x31, 0x8a, 0xf0, 0x90, 0x1e, 0x58, 0x25, 0xd0, 0x43, 0xe,  0x50, 0x43, 0xc7, 0x0,  0xf,
                   0x61, 0xd6, 0x99, 0x7e, 0x74, 0xda, 0x9f, 0xed, 0x72, 0xde, 0xc3, 0x27, 0xf6, 0x28, 0xaf,
                   0x0,  0xd,  0xe0, 0xcf, 0xf8, 0x5c, 0x19, 0x19, 0x2f, 0x75, 0xa,  0x37, 0x72, 0x4d, 0xd2};

  uint8_t buf[85] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x61, 0xd6, 0x99, 0x7e, 0x74, 0xda, 0x9f, 0xed,
                                0x72, 0xde, 0xc3, 0x27, 0xf6, 0x28, 0xaf};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe0, 0xcf, 0xf8, 0x5c, 0x19, 0x19, 0x2f, 0x75, 0xa, 0x37, 0x72, 0x4d, 0xd2};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15606;
  uint8_t client_id_bytes[] = {0x12, 0x4f, 0x3a, 0x6d, 0xf5, 0xc5, 0xd8, 0xc8, 0x5c, 0x9,  0xa2, 0xdd, 0xac, 0x77, 0xeb,
                               0x64, 0x31, 0x8a, 0xf0, 0x90, 0x1e, 0x58, 0x25, 0xd0, 0x43, 0xe,  0x50, 0x43, 0xc7};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x11, 0x4d, 0xb4, 0xd,  0x7,  0xfc, 0x77, 0x70, 0x5e, 0x62, 0x5a, 0x87, 0x7f,
                              0x32, 0x40, 0x5a, 0xfd, 0xa5, 0x12, 0x79, 0xd1, 0xe2, 0x72, 0x5d, 0xa4};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7y&\a\226\163R-*\143C\172?T4\174\227\&4$\202\150\&2\DLE\231\243", _password =
// Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive = 6271, _connID =
// "\193=\232\&0\251\248\&3\179\238?E\142", _properties = []}
TEST(Connect311QCTest, Encode67) {
  uint8_t pkt[] = {0x10, 0x33, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x18, 0x7f, 0x0,  0xc,
                   0xc1, 0x3d, 0xe8, 0x30, 0xfb, 0xf8, 0x33, 0xb3, 0xee, 0x3f, 0x45, 0x8e, 0x0,  0x19,
                   0x37, 0x79, 0x26, 0x7,  0xe2, 0xa3, 0x52, 0x2d, 0x2a, 0x8f, 0x43, 0xac, 0x3f, 0x54,
                   0x34, 0xae, 0xe3, 0x34, 0x24, 0xca, 0x96, 0x32, 0x10, 0xe7, 0xf3};

  uint8_t buf[63] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6271;
  uint8_t client_id_bytes[] = {0xc1, 0x3d, 0xe8, 0x30, 0xfb, 0xf8, 0x33, 0xb3, 0xee, 0x3f, 0x45, 0x8e};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x79, 0x26, 0x7,  0xe2, 0xa3, 0x52, 0x2d, 0x2a, 0x8f, 0x43, 0xac, 0x3f,
                              0x54, 0x34, 0xae, 0xe3, 0x34, 0x24, 0xca, 0x96, 0x32, 0x10, 0xe7, 0xf3};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\NAK=\230S\192\217KW\211\176\174\190\213\179a\138\ENQR\222",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\218\251\CAN\137\184\196\247\&0u\SYNZ", _willMsg = "\140\162\226\246\\\158,\b\141\157Z$+", _willProps = []}),
// _cleanSession = False, _keepAlive = 18470, _connID =
// "\145\177\179\193o\203\219\238Y:\131\b\140\246\195\211\214\210p\177", _properties = []}
TEST(Connect311QCTest, Encode68) {
  uint8_t pkt[] = {0x10, 0x3c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0x48, 0x26, 0x0,  0x14, 0x91, 0xb1,
                   0xb3, 0xc1, 0x6f, 0xcb, 0xdb, 0xee, 0x59, 0x3a, 0x83, 0x8,  0x8c, 0xf6, 0xc3, 0xd3, 0xd6, 0xd2,
                   0x70, 0xb1, 0x0,  0xb,  0xda, 0xfb, 0x18, 0x89, 0xb8, 0xc4, 0xf7, 0x30, 0x75, 0x16, 0x5a, 0x0,
                   0xd,  0x8c, 0xa2, 0xe2, 0xf6, 0x5c, 0x9e, 0x2c, 0x8,  0x8d, 0x9d, 0x5a, 0x24, 0x2b};

  uint8_t buf[72] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0xfb, 0x18, 0x89, 0xb8, 0xc4, 0xf7, 0x30, 0x75, 0x16, 0x5a};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8c, 0xa2, 0xe2, 0xf6, 0x5c, 0x9e, 0x2c, 0x8, 0x8d, 0x9d, 0x5a, 0x24, 0x2b};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18470;
  uint8_t client_id_bytes[] = {0x91, 0xb1, 0xb3, 0xc1, 0x6f, 0xcb, 0xdb, 0xee, 0x59, 0x3a,
                               0x83, 0x8,  0x8c, 0xf6, 0xc3, 0xd3, 0xd6, 0xd2, 0x70, 0xb1};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x15, 0x3d, 0xe6, 0x53, 0xc0, 0xd9, 0x4b, 0x57, 0xd3, 0xb0,
                              0xae, 0xbe, 0xd5, 0xb3, 0x61, 0x8a, 0x5,  0x52, 0xde};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\SOH\253\128h\214\136>\244<\255\153", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "n\221.g\231\209[a*n'\214al\147\241$\175'-J\140\217\175\152\130\155\232", _willMsg =
// "\US\161\236\DC2\138\211_\ESC\244", _willProps = []}), _cleanSession = True, _keepAlive = 9181, _connID =
// "M\156\DC4\133Z\205\NAK&", _properties = []}
TEST(Connect311QCTest, Encode69) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x23, 0xdd, 0x0,  0x8,  0x4d, 0x9c,
                   0x14, 0x85, 0x5a, 0xcd, 0x15, 0x26, 0x0,  0x1c, 0x6e, 0xdd, 0x2e, 0x67, 0xe7, 0xd1, 0x5b, 0x61,
                   0x2a, 0x6e, 0x27, 0xd6, 0x61, 0x6c, 0x93, 0xf1, 0x24, 0xaf, 0x27, 0x2d, 0x4a, 0x8c, 0xd9, 0xaf,
                   0x98, 0x82, 0x9b, 0xe8, 0x0,  0x9,  0x1f, 0xa1, 0xec, 0x12, 0x8a, 0xd3, 0x5f, 0x1b, 0xf4};

  uint8_t buf[73] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6e, 0xdd, 0x2e, 0x67, 0xe7, 0xd1, 0x5b, 0x61, 0x2a, 0x6e, 0x27, 0xd6, 0x61, 0x6c,
                                0x93, 0xf1, 0x24, 0xaf, 0x27, 0x2d, 0x4a, 0x8c, 0xd9, 0xaf, 0x98, 0x82, 0x9b, 0xe8};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1f, 0xa1, 0xec, 0x12, 0x8a, 0xd3, 0x5f, 0x1b, 0xf4};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9181;
  uint8_t client_id_bytes[] = {0x4d, 0x9c, 0x14, 0x85, 0x5a, 0xcd, 0x15, 0x26};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1, 0xfd, 0x80, 0x68, 0xd6, 0x88, 0x3e, 0xf4, 0x3c, 0xff, 0x99};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\227\ESCQ", _password = Just "\231\239\188\247\236\FSU\172\t\232D", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "(7<,XJ9\ETB\231t\245\245\214\208\FSj\131",
// _willMsg = "", _willProps = []}), _cleanSession = False, _keepAlive = 70, _connID =
// "\226\&9\142F\US\236\161\186\252\236\147\229\210E\130\EMh\128\129\DC3axe\165\179\238Vi\169\245", _properties = []}
TEST(Connect311QCTest, Encode70) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x0,  0x46, 0x0,  0x1e, 0xe2, 0x39, 0x8e,
                   0x46, 0x1f, 0xec, 0xa1, 0xba, 0xfc, 0xec, 0x93, 0xe5, 0xd2, 0x45, 0x82, 0x19, 0x68, 0x80, 0x81, 0x13,
                   0x61, 0x78, 0x65, 0xa5, 0xb3, 0xee, 0x56, 0x69, 0xa9, 0xf5, 0x0,  0x11, 0x28, 0x37, 0x3c, 0x2c, 0x58,
                   0x4a, 0x39, 0x17, 0xe7, 0x74, 0xf5, 0xf5, 0xd6, 0xd0, 0x1c, 0x6a, 0x83, 0x0,  0x0,  0x0,  0x3,  0xe3,
                   0x1b, 0x51, 0x0,  0xb,  0xe7, 0xef, 0xbc, 0xf7, 0xec, 0x1c, 0x55, 0xac, 0x9,  0xe8, 0x44};

  uint8_t buf[93] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x28, 0x37, 0x3c, 0x2c, 0x58, 0x4a, 0x39, 0x17, 0xe7,
                                0x74, 0xf5, 0xf5, 0xd6, 0xd0, 0x1c, 0x6a, 0x83};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 70;
  uint8_t client_id_bytes[] = {0xe2, 0x39, 0x8e, 0x46, 0x1f, 0xec, 0xa1, 0xba, 0xfc, 0xec,
                               0x93, 0xe5, 0xd2, 0x45, 0x82, 0x19, 0x68, 0x80, 0x81, 0x13,
                               0x61, 0x78, 0x65, 0xa5, 0xb3, 0xee, 0x56, 0x69, 0xa9, 0xf5};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe3, 0x1b, 0x51};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe7, 0xef, 0xbc, 0xf7, 0xec, 0x1c, 0x55, 0xac, 0x9, 0xe8, 0x44};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\a.\173\189\187\192\&5\DC1\242@\ETXGI\174r\189\191\213\CAN4\233\SOH\196", _password
// = Just "i\DC1lU\210\253\204\211\224\DC4\228", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "\CAN\228\137ea\b\DC1\230\188B\b\185\161\213\250:\214\RSLYL\193\157K\189R~", _willMsg =
// "^\188x\173\231\249S\128\&9\STX%\133l\173s\135{F\221\169T\254", _willProps = []}), _cleanSession = False, _keepAlive
// = 3405, _connID = "\229sD\131\227v\232^4n0", _properties = []}
TEST(Connect311QCTest, Encode71) {
  uint8_t pkt[] = {0x10, 0x72, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0xd,  0x4d, 0x0,  0xb,  0xe5, 0x73, 0x44,
                   0x83, 0xe3, 0x76, 0xe8, 0x5e, 0x34, 0x6e, 0x30, 0x0,  0x1b, 0x18, 0xe4, 0x89, 0x65, 0x61, 0x8,  0x11,
                   0xe6, 0xbc, 0x42, 0x8,  0xb9, 0xa1, 0xd5, 0xfa, 0x3a, 0xd6, 0x1e, 0x4c, 0x59, 0x4c, 0xc1, 0x9d, 0x4b,
                   0xbd, 0x52, 0x7e, 0x0,  0x16, 0x5e, 0xbc, 0x78, 0xad, 0xe7, 0xf9, 0x53, 0x80, 0x39, 0x2,  0x25, 0x85,
                   0x6c, 0xad, 0x73, 0x87, 0x7b, 0x46, 0xdd, 0xa9, 0x54, 0xfe, 0x0,  0x17, 0x7,  0x2e, 0xad, 0xbd, 0xbb,
                   0xc0, 0x35, 0x11, 0xf2, 0x40, 0x3,  0x47, 0x49, 0xae, 0x72, 0xbd, 0xbf, 0xd5, 0x18, 0x34, 0xe9, 0x1,
                   0xc4, 0x0,  0xb,  0x69, 0x11, 0x6c, 0x55, 0xd2, 0xfd, 0xcc, 0xd3, 0xe0, 0x14, 0xe4};

  uint8_t buf[126] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0xe4, 0x89, 0x65, 0x61, 0x8,  0x11, 0xe6, 0xbc, 0x42, 0x8,  0xb9, 0xa1, 0xd5,
                                0xfa, 0x3a, 0xd6, 0x1e, 0x4c, 0x59, 0x4c, 0xc1, 0x9d, 0x4b, 0xbd, 0x52, 0x7e};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5e, 0xbc, 0x78, 0xad, 0xe7, 0xf9, 0x53, 0x80, 0x39, 0x2,  0x25,
                                  0x85, 0x6c, 0xad, 0x73, 0x87, 0x7b, 0x46, 0xdd, 0xa9, 0x54, 0xfe};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3405;
  uint8_t client_id_bytes[] = {0xe5, 0x73, 0x44, 0x83, 0xe3, 0x76, 0xe8, 0x5e, 0x34, 0x6e, 0x30};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7,  0x2e, 0xad, 0xbd, 0xbb, 0xc0, 0x35, 0x11, 0xf2, 0x40, 0x3, 0x47,
                              0x49, 0xae, 0x72, 0xbd, 0xbf, 0xd5, 0x18, 0x34, 0xe9, 0x1,  0xc4};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x69, 0x11, 0x6c, 0x55, 0xd2, 0xfd, 0xcc, 0xd3, 0xe0, 0x14, 0xe4};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "a", _password = Just "@\CAN\194hS*r\ESC'\162\SUB\222P\218g\250\&5\aN\nf\ETX\246",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\135!\172j\177\193\187\202+&FH\SO",
// _willMsg = "g\144@\161F\215\147>\217\b\228\146\186\ETB\234\252\208\201", _willProps = []}), _cleanSession = True,
// _keepAlive = 19693, _connID = "\140\204\191\171.BtU+cj", _properties = []}
TEST(Connect311QCTest, Encode72) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x4c, 0xed, 0x0,  0xb,  0x8c,
                   0xcc, 0xbf, 0xab, 0x2e, 0x42, 0x74, 0x55, 0x2b, 0x63, 0x6a, 0x0,  0xd,  0x87, 0x21, 0xac,
                   0x6a, 0xb1, 0xc1, 0xbb, 0xca, 0x2b, 0x26, 0x46, 0x48, 0xe,  0x0,  0x12, 0x67, 0x90, 0x40,
                   0xa1, 0x46, 0xd7, 0x93, 0x3e, 0xd9, 0x8,  0xe4, 0x92, 0xba, 0x17, 0xea, 0xfc, 0xd0, 0xc9,
                   0x0,  0x1,  0x61, 0x0,  0x17, 0x40, 0x18, 0xc2, 0x68, 0x53, 0x2a, 0x72, 0x1b, 0x27, 0xa2,
                   0x1a, 0xde, 0x50, 0xda, 0x67, 0xfa, 0x35, 0x7,  0x4e, 0xa,  0x66, 0x3,  0xf6};

  uint8_t buf[98] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x21, 0xac, 0x6a, 0xb1, 0xc1, 0xbb, 0xca, 0x2b, 0x26, 0x46, 0x48, 0xe};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x67, 0x90, 0x40, 0xa1, 0x46, 0xd7, 0x93, 0x3e, 0xd9,
                                  0x8,  0xe4, 0x92, 0xba, 0x17, 0xea, 0xfc, 0xd0, 0xc9};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19693;
  uint8_t client_id_bytes[] = {0x8c, 0xcc, 0xbf, 0xab, 0x2e, 0x42, 0x74, 0x55, 0x2b, 0x63, 0x6a};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x61};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x40, 0x18, 0xc2, 0x68, 0x53, 0x2a, 0x72, 0x1b, 0x27, 0xa2, 0x1a, 0xde,
                              0x50, 0xda, 0x67, 0xfa, 0x35, 0x7,  0x4e, 0xa,  0x66, 0x3,  0xf6};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\172\219m,\215\&1j\218
// $\179\198q\177c\172\251|\145\151)\ACKk\199\226\192\131\161\SO", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\253X\142\n\160\NUL\146\171ng\\\NAK\186Q\142\165\NUL\ETX6\212\255d\134|\252\181!av)",
// _willMsg = "}1\182T-u\251\128", _willProps = []}), _cleanSession = False, _keepAlive = 12479, _connID =
// "\160\198\DC2f\138Q\188Q\138!y\131\141\&4\255\149\228$=Tx\SOHa\231", _properties = []}
TEST(Connect311QCTest, Encode73) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x30, 0xbf, 0x0,  0x18, 0xa0, 0xc6,
                   0x12, 0x66, 0x8a, 0x51, 0xbc, 0x51, 0x8a, 0x21, 0x79, 0x83, 0x8d, 0x34, 0xff, 0x95, 0xe4, 0x24,
                   0x3d, 0x54, 0x78, 0x1,  0x61, 0xe7, 0x0,  0x1e, 0xfd, 0x58, 0x8e, 0xa,  0xa0, 0x0,  0x92, 0xab,
                   0x6e, 0x67, 0x5c, 0x15, 0xba, 0x51, 0x8e, 0xa5, 0x0,  0x3,  0x36, 0xd4, 0xff, 0x64, 0x86, 0x7c,
                   0xfc, 0xb5, 0x21, 0x61, 0x76, 0x29, 0x0,  0x8,  0x7d, 0x31, 0xb6, 0x54, 0x2d, 0x75, 0xfb, 0x80};

  uint8_t buf[90] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfd, 0x58, 0x8e, 0xa,  0xa0, 0x0,  0x92, 0xab, 0x6e, 0x67,
                                0x5c, 0x15, 0xba, 0x51, 0x8e, 0xa5, 0x0,  0x3,  0x36, 0xd4,
                                0xff, 0x64, 0x86, 0x7c, 0xfc, 0xb5, 0x21, 0x61, 0x76, 0x29};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7d, 0x31, 0xb6, 0x54, 0x2d, 0x75, 0xfb, 0x80};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12479;
  uint8_t client_id_bytes[] = {0xa0, 0xc6, 0x12, 0x66, 0x8a, 0x51, 0xbc, 0x51, 0x8a, 0x21, 0x79, 0x83,
                               0x8d, 0x34, 0xff, 0x95, 0xe4, 0x24, 0x3d, 0x54, 0x78, 0x1,  0x61, 0xe7};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xac, 0xdb, 0x6d, 0x2c, 0xd7, 0x31, 0x6a, 0xda, 0x20, 0x24, 0xb3, 0xc6, 0x71, 0xb1, 0x63,
                              0xac, 0xfb, 0x7c, 0x91, 0x97, 0x29, 0x6,  0x6b, 0xc7, 0xe2, 0xc0, 0x83, 0xa1, 0xe};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\186>\208\176\160\b\130H\DC3\FS\nw@\180M\223\f}~\163s\234_", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "h ", _willMsg =
// "\136Jb\133\241\194\237\174\234.J\DEL\213\CAN\189A\167\182", _willProps = []}), _cleanSession = False, _keepAlive =
// 15269, _connID = "\151O\SUBd\191\216\184\130k$\237[9\159\\\STX\130\196~\DLE\222\ESC\198}\157\129w\n", _properties =
// []}
TEST(Connect311QCTest, Encode74) {
  uint8_t pkt[] = {0x10, 0x59, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x3b, 0xa5, 0x0,  0x1c, 0x97, 0x4f,
                   0x1a, 0x64, 0xbf, 0xd8, 0xb8, 0x82, 0x6b, 0x24, 0xed, 0x5b, 0x39, 0x9f, 0x5c, 0x2,  0x82, 0xc4,
                   0x7e, 0x10, 0xde, 0x1b, 0xc6, 0x7d, 0x9d, 0x81, 0x77, 0xa,  0x0,  0x2,  0x68, 0x20, 0x0,  0x12,
                   0x88, 0x4a, 0x62, 0x85, 0xf1, 0xc2, 0xed, 0xae, 0xea, 0x2e, 0x4a, 0x7f, 0xd5, 0x18, 0xbd, 0x41,
                   0xa7, 0xb6, 0x0,  0x17, 0xba, 0x3e, 0xd0, 0xb0, 0xa0, 0x8,  0x82, 0x48, 0x13, 0x1c, 0xa,  0x77,
                   0x40, 0xb4, 0x4d, 0xdf, 0xc,  0x7d, 0x7e, 0xa3, 0x73, 0xea, 0x5f};

  uint8_t buf[101] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x68, 0x20};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x88, 0x4a, 0x62, 0x85, 0xf1, 0xc2, 0xed, 0xae, 0xea,
                                  0x2e, 0x4a, 0x7f, 0xd5, 0x18, 0xbd, 0x41, 0xa7, 0xb6};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15269;
  uint8_t client_id_bytes[] = {0x97, 0x4f, 0x1a, 0x64, 0xbf, 0xd8, 0xb8, 0x82, 0x6b, 0x24, 0xed, 0x5b, 0x39, 0x9f,
                               0x5c, 0x2,  0x82, 0xc4, 0x7e, 0x10, 0xde, 0x1b, 0xc6, 0x7d, 0x9d, 0x81, 0x77, 0xa};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xba, 0x3e, 0xd0, 0xb0, 0xa0, 0x8,  0x82, 0x48, 0x13, 0x1c, 0xa, 0x77,
                              0x40, 0xb4, 0x4d, 0xdf, 0xc,  0x7d, 0x7e, 0xa3, 0x73, 0xea, 0x5f};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%_f0P\185\133\159\152\SOH\185\161\133\186\242\&0'", _password = Just
// "\166\165\148d\NAKy%\142\222\189,", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\222\254\185A\161\232i\ACK\180Z\146\192\254\182-\206\&8H\211\132", _willMsg =
// "\218\212\ACK\ESC\DC2_y\169\196A\228\195N\209;\219\138G\r\GS", _willProps = []}), _cleanSession = True, _keepAlive =
// 20166, _connID = "\ETBG\233\139e\tY\235MPwMH\208", _properties = []}
TEST(Connect311QCTest, Encode75) {
  uint8_t pkt[] = {0x10, 0x66, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x4e, 0xc6, 0x0,  0xe,  0x17,
                   0x47, 0xe9, 0x8b, 0x65, 0x9,  0x59, 0xeb, 0x4d, 0x50, 0x77, 0x4d, 0x48, 0xd0, 0x0,  0x14,
                   0xde, 0xfe, 0xb9, 0x41, 0xa1, 0xe8, 0x69, 0x6,  0xb4, 0x5a, 0x92, 0xc0, 0xfe, 0xb6, 0x2d,
                   0xce, 0x38, 0x48, 0xd3, 0x84, 0x0,  0x14, 0xda, 0xd4, 0x6,  0x1b, 0x12, 0x5f, 0x79, 0xa9,
                   0xc4, 0x41, 0xe4, 0xc3, 0x4e, 0xd1, 0x3b, 0xdb, 0x8a, 0x47, 0xd,  0x1d, 0x0,  0x11, 0x25,
                   0x5f, 0x66, 0x30, 0x50, 0xb9, 0x85, 0x9f, 0x98, 0x1,  0xb9, 0xa1, 0x85, 0xba, 0xf2, 0x30,
                   0x27, 0x0,  0xb,  0xa6, 0xa5, 0x94, 0x64, 0x15, 0x79, 0x25, 0x8e, 0xde, 0xbd, 0x2c};

  uint8_t buf[114] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xde, 0xfe, 0xb9, 0x41, 0xa1, 0xe8, 0x69, 0x6,  0xb4, 0x5a,
                                0x92, 0xc0, 0xfe, 0xb6, 0x2d, 0xce, 0x38, 0x48, 0xd3, 0x84};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xd4, 0x6,  0x1b, 0x12, 0x5f, 0x79, 0xa9, 0xc4, 0x41,
                                  0xe4, 0xc3, 0x4e, 0xd1, 0x3b, 0xdb, 0x8a, 0x47, 0xd,  0x1d};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20166;
  uint8_t client_id_bytes[] = {0x17, 0x47, 0xe9, 0x8b, 0x65, 0x9, 0x59, 0xeb, 0x4d, 0x50, 0x77, 0x4d, 0x48, 0xd0};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x5f, 0x66, 0x30, 0x50, 0xb9, 0x85, 0x9f, 0x98,
                              0x1,  0xb9, 0xa1, 0x85, 0xba, 0xf2, 0x30, 0x27};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa6, 0xa5, 0x94, 0x64, 0x15, 0x79, 0x25, 0x8e, 0xde, 0xbd, 0x2c};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\172\206\237\DLE\254_Q2\226B'S\147k\177*D!\230\185<\130", _password = Just
// ".\STX\240p\196\191\165l\140\230\214\188\253\220\166\224I\197\241\153&3;\249", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "\DC1o\221b\189\141f\242\228\CAN\219\141,e\230\221\166\&7Ar\GS",
// _willMsg = "", _willProps = []}), _cleanSession = False, _keepAlive = 20633, _connID =
// "x]*\241\253\180\253\181\DC4%\n\245\187\"\138\DLE\212b\182\171\131J\193\&0\176C", _properties = []}
TEST(Connect311QCTest, Encode76) {
  uint8_t pkt[] = {0x10, 0x71, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x50, 0x99, 0x0,  0x1a, 0x78, 0x5d, 0x2a,
                   0xf1, 0xfd, 0xb4, 0xfd, 0xb5, 0x14, 0x25, 0xa,  0xf5, 0xbb, 0x22, 0x8a, 0x10, 0xd4, 0x62, 0xb6, 0xab,
                   0x83, 0x4a, 0xc1, 0x30, 0xb0, 0x43, 0x0,  0x15, 0x11, 0x6f, 0xdd, 0x62, 0xbd, 0x8d, 0x66, 0xf2, 0xe4,
                   0x18, 0xdb, 0x8d, 0x2c, 0x65, 0xe6, 0xdd, 0xa6, 0x37, 0x41, 0x72, 0x1d, 0x0,  0x0,  0x0,  0x16, 0xac,
                   0xce, 0xed, 0x10, 0xfe, 0x5f, 0x51, 0x32, 0xe2, 0x42, 0x27, 0x53, 0x93, 0x6b, 0xb1, 0x2a, 0x44, 0x21,
                   0xe6, 0xb9, 0x3c, 0x82, 0x0,  0x18, 0x2e, 0x2,  0xf0, 0x70, 0xc4, 0xbf, 0xa5, 0x6c, 0x8c, 0xe6, 0xd6,
                   0xbc, 0xfd, 0xdc, 0xa6, 0xe0, 0x49, 0xc5, 0xf1, 0x99, 0x26, 0x33, 0x3b, 0xf9};

  uint8_t buf[125] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0x6f, 0xdd, 0x62, 0xbd, 0x8d, 0x66, 0xf2, 0xe4, 0x18, 0xdb,
                                0x8d, 0x2c, 0x65, 0xe6, 0xdd, 0xa6, 0x37, 0x41, 0x72, 0x1d};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20633;
  uint8_t client_id_bytes[] = {0x78, 0x5d, 0x2a, 0xf1, 0xfd, 0xb4, 0xfd, 0xb5, 0x14, 0x25, 0xa,  0xf5, 0xbb,
                               0x22, 0x8a, 0x10, 0xd4, 0x62, 0xb6, 0xab, 0x83, 0x4a, 0xc1, 0x30, 0xb0, 0x43};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xac, 0xce, 0xed, 0x10, 0xfe, 0x5f, 0x51, 0x32, 0xe2, 0x42, 0x27,
                              0x53, 0x93, 0x6b, 0xb1, 0x2a, 0x44, 0x21, 0xe6, 0xb9, 0x3c, 0x82};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2e, 0x2,  0xf0, 0x70, 0xc4, 0xbf, 0xa5, 0x6c, 0x8c, 0xe6, 0xd6, 0xbc,
                              0xfd, 0xdc, 0xa6, 0xe0, 0x49, 0xc5, 0xf1, 0x99, 0x26, 0x33, 0x3b, 0xf9};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "z@\a", _password = Just "\253\197(\t}\238J\253\251\192\135j", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\129B\175B", _willMsg = "S\233k'\183[ryq\189X\218",
// _willProps = []}), _cleanSession = False, _keepAlive = 32764, _connID = "d\173\189", _properties = []}
TEST(Connect311QCTest, Encode77) {
  uint8_t pkt[] = {0x10, 0x36, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x7f, 0xfc, 0x0,  0x3,
                   0x64, 0xad, 0xbd, 0x0,  0x4,  0x81, 0x42, 0xaf, 0x42, 0x0,  0xc,  0x53, 0xe9, 0x6b,
                   0x27, 0xb7, 0x5b, 0x72, 0x79, 0x71, 0xbd, 0x58, 0xda, 0x0,  0x3,  0x7a, 0x40, 0x7,
                   0x0,  0xc,  0xfd, 0xc5, 0x28, 0x9,  0x7d, 0xee, 0x4a, 0xfd, 0xfb, 0xc0, 0x87, 0x6a};

  uint8_t buf[66] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0x42, 0xaf, 0x42};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x53, 0xe9, 0x6b, 0x27, 0xb7, 0x5b, 0x72, 0x79, 0x71, 0xbd, 0x58, 0xda};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32764;
  uint8_t client_id_bytes[] = {0x64, 0xad, 0xbd};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7a, 0x40, 0x7};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xfd, 0xc5, 0x28, 0x9, 0x7d, 0xee, 0x4a, 0xfd, 0xfb, 0xc0, 0x87, 0x6a};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "vo\255\134\EM\214ra~\221QTH]\236\&1\203\133f\193%", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\143\219\228T\SIP\210\NULp\216b\230\191\b\DC1\190\218\139\178\174\179\138\176z", _willMsg =
// "\\\196Q\224Q\138\232\DC4\230u\194\&6\147\197\138o\202\247&\180\179\RSB,\244\153h\STX", _willProps = []}),
// _cleanSession = False, _keepAlive = 18519, _connID = "cX\140\&9\221\ETXY\131\GS", _properties = []}
TEST(Connect311QCTest, Encode78) {
  uint8_t pkt[] = {0x10, 0x64, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0x48, 0x57, 0x0,  0x9,  0x63,
                   0x58, 0x8c, 0x39, 0xdd, 0x3,  0x59, 0x83, 0x1d, 0x0,  0x18, 0x8f, 0xdb, 0xe4, 0x54, 0xf,
                   0x50, 0xd2, 0x0,  0x70, 0xd8, 0x62, 0xe6, 0xbf, 0x8,  0x11, 0xbe, 0xda, 0x8b, 0xb2, 0xae,
                   0xb3, 0x8a, 0xb0, 0x7a, 0x0,  0x1c, 0x5c, 0xc4, 0x51, 0xe0, 0x51, 0x8a, 0xe8, 0x14, 0xe6,
                   0x75, 0xc2, 0x36, 0x93, 0xc5, 0x8a, 0x6f, 0xca, 0xf7, 0x26, 0xb4, 0xb3, 0x1e, 0x42, 0x2c,
                   0xf4, 0x99, 0x68, 0x2,  0x0,  0x15, 0x76, 0x6f, 0xff, 0x86, 0x19, 0xd6, 0x72, 0x61, 0x7e,
                   0xdd, 0x51, 0x54, 0x48, 0x5d, 0xec, 0x31, 0xcb, 0x85, 0x66, 0xc1, 0x25};

  uint8_t buf[112] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0xdb, 0xe4, 0x54, 0xf,  0x50, 0xd2, 0x0,  0x70, 0xd8, 0x62, 0xe6,
                                0xbf, 0x8,  0x11, 0xbe, 0xda, 0x8b, 0xb2, 0xae, 0xb3, 0x8a, 0xb0, 0x7a};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5c, 0xc4, 0x51, 0xe0, 0x51, 0x8a, 0xe8, 0x14, 0xe6, 0x75, 0xc2, 0x36, 0x93, 0xc5,
                                  0x8a, 0x6f, 0xca, 0xf7, 0x26, 0xb4, 0xb3, 0x1e, 0x42, 0x2c, 0xf4, 0x99, 0x68, 0x2};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18519;
  uint8_t client_id_bytes[] = {0x63, 0x58, 0x8c, 0x39, 0xdd, 0x3, 0x59, 0x83, 0x1d};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x76, 0x6f, 0xff, 0x86, 0x19, 0xd6, 0x72, 0x61, 0x7e, 0xdd, 0x51,
                              0x54, 0x48, 0x5d, 0xec, 0x31, 0xcb, 0x85, 0x66, 0xc1, 0x25};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\157\ETB\161\194\193\144\143\222H\bK\137S\211\183P\248e#\158\140\132\232~", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic = "\234\218\131\206!/\185r4\200\241\199\174\200\229", _willMsg =
// "?\198\253\173(", _willProps = []}), _cleanSession = True, _keepAlive = 5462, _connID =
// "~Zt\220\FS\b\166{\135\185\244Q\248@\a^", _properties = []}
TEST(Connect311QCTest, Encode79) {
  uint8_t pkt[] = {0x10, 0x34, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x15, 0x56, 0x0,  0x10,
                   0x7e, 0x5a, 0x74, 0xdc, 0x1c, 0x8,  0xa6, 0x7b, 0x87, 0xb9, 0xf4, 0x51, 0xf8, 0x40,
                   0x7,  0x5e, 0x0,  0xf,  0xea, 0xda, 0x83, 0xce, 0x21, 0x2f, 0xb9, 0x72, 0x34, 0xc8,
                   0xf1, 0xc7, 0xae, 0xc8, 0xe5, 0x0,  0x5,  0x3f, 0xc6, 0xfd, 0xad, 0x28};

  uint8_t buf[64] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xea, 0xda, 0x83, 0xce, 0x21, 0x2f, 0xb9, 0x72,
                                0x34, 0xc8, 0xf1, 0xc7, 0xae, 0xc8, 0xe5};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3f, 0xc6, 0xfd, 0xad, 0x28};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5462;
  uint8_t client_id_bytes[] = {0x7e, 0x5a, 0x74, 0xdc, 0x1c, 0x8,  0xa6, 0x7b,
                               0x87, 0xb9, 0xf4, 0x51, 0xf8, 0x40, 0x7,  0x5e};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9d, 0x17, 0xa1, 0xc2, 0xc1, 0x90, 0x8f, 0xde, 0x48, 0x8,  0x4b, 0x89,
                              0x53, 0xd3, 0xb7, 0x50, 0xf8, 0x65, 0x23, 0x9e, 0x8c, 0x84, 0xe8, 0x7e};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\147{'Z\192?r8#\DLEU\192\236\160\237v\192p\NUL\171;\EOT", _password = Just
// "\160J\202\185\172\&2\153\200\SYN\a\130n\179\133f\207\&5\n8\245\n\144\220", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\145K\248\242\218\139\203", _willMsg =
// "\166\252\SI\215\181\NUL\150dX7\178\210", _willProps = []}), _cleanSession = True, _keepAlive = 25664, _connID =
// "\GS\225\&4\DC4\182", _properties = []}
TEST(Connect311QCTest, Encode80) {
  uint8_t pkt[] = {0x10, 0x59, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x64, 0x40, 0x0,  0x5,  0x1d, 0xe1,
                   0x34, 0x14, 0xb6, 0x0,  0x7,  0x91, 0x4b, 0xf8, 0xf2, 0xda, 0x8b, 0xcb, 0x0,  0xc,  0xa6, 0xfc,
                   0xf,  0xd7, 0xb5, 0x0,  0x96, 0x64, 0x58, 0x37, 0xb2, 0xd2, 0x0,  0x16, 0x93, 0x7b, 0x27, 0x5a,
                   0xc0, 0x3f, 0x72, 0x38, 0x23, 0x10, 0x55, 0xc0, 0xec, 0xa0, 0xed, 0x76, 0xc0, 0x70, 0x0,  0xab,
                   0x3b, 0x4,  0x0,  0x17, 0xa0, 0x4a, 0xca, 0xb9, 0xac, 0x32, 0x99, 0xc8, 0x16, 0x7,  0x82, 0x6e,
                   0xb3, 0x85, 0x66, 0xcf, 0x35, 0xa,  0x38, 0xf5, 0xa,  0x90, 0xdc};

  uint8_t buf[101] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x91, 0x4b, 0xf8, 0xf2, 0xda, 0x8b, 0xcb};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa6, 0xfc, 0xf, 0xd7, 0xb5, 0x0, 0x96, 0x64, 0x58, 0x37, 0xb2, 0xd2};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25664;
  uint8_t client_id_bytes[] = {0x1d, 0xe1, 0x34, 0x14, 0xb6};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x93, 0x7b, 0x27, 0x5a, 0xc0, 0x3f, 0x72, 0x38, 0x23, 0x10, 0x55,
                              0xc0, 0xec, 0xa0, 0xed, 0x76, 0xc0, 0x70, 0x0,  0xab, 0x3b, 0x4};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa0, 0x4a, 0xca, 0xb9, 0xac, 0x32, 0x99, 0xc8, 0x16, 0x7,  0x82, 0x6e,
                              0xb3, 0x85, 0x66, 0xcf, 0x35, 0xa,  0x38, 0xf5, 0xa,  0x90, 0xdc};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\178\243\183\172\137\232\212\r~N\252\145\212h\230\DC1\144z}\209\&6\247\DLE\192iq",
// _password = Just "mU", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "A\148M\202\195\195\r\GS\240\235\193_b)\178\176\218-Z\176`\186\164\FSk\134\175", _willMsg =
// "4|gQ1\225\226&\214N\213\135\232\220Gm\242\172", _willProps = []}), _cleanSession = True, _keepAlive = 1343, _connID
// = "\162\&4og*T\SYN\194c\EOT\129~z\215\170\t\a\172\172xu", _properties = []}
TEST(Connect311QCTest, Encode81) {
  uint8_t pkt[] = {0x10, 0x73, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x5,  0x3f, 0x0,  0x15, 0xa2, 0x34, 0x6f,
                   0x67, 0x2a, 0x54, 0x16, 0xc2, 0x63, 0x4,  0x81, 0x7e, 0x7a, 0xd7, 0xaa, 0x9,  0x7,  0xac, 0xac, 0x78,
                   0x75, 0x0,  0x1b, 0x41, 0x94, 0x4d, 0xca, 0xc3, 0xc3, 0xd,  0x1d, 0xf0, 0xeb, 0xc1, 0x5f, 0x62, 0x29,
                   0xb2, 0xb0, 0xda, 0x2d, 0x5a, 0xb0, 0x60, 0xba, 0xa4, 0x1c, 0x6b, 0x86, 0xaf, 0x0,  0x12, 0x34, 0x7c,
                   0x67, 0x51, 0x31, 0xe1, 0xe2, 0x26, 0xd6, 0x4e, 0xd5, 0x87, 0xe8, 0xdc, 0x47, 0x6d, 0xf2, 0xac, 0x0,
                   0x1b, 0x50, 0xb2, 0xf3, 0xb7, 0xac, 0x89, 0xe8, 0xd4, 0xd,  0x7e, 0x4e, 0xfc, 0x91, 0xd4, 0x68, 0xe6,
                   0x11, 0x90, 0x7a, 0x7d, 0xd1, 0x36, 0xf7, 0x10, 0xc0, 0x69, 0x71, 0x0,  0x2,  0x6d, 0x55};

  uint8_t buf[127] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x94, 0x4d, 0xca, 0xc3, 0xc3, 0xd,  0x1d, 0xf0, 0xeb, 0xc1, 0x5f, 0x62, 0x29,
                                0xb2, 0xb0, 0xda, 0x2d, 0x5a, 0xb0, 0x60, 0xba, 0xa4, 0x1c, 0x6b, 0x86, 0xaf};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x34, 0x7c, 0x67, 0x51, 0x31, 0xe1, 0xe2, 0x26, 0xd6,
                                  0x4e, 0xd5, 0x87, 0xe8, 0xdc, 0x47, 0x6d, 0xf2, 0xac};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1343;
  uint8_t client_id_bytes[] = {0xa2, 0x34, 0x6f, 0x67, 0x2a, 0x54, 0x16, 0xc2, 0x63, 0x4, 0x81,
                               0x7e, 0x7a, 0xd7, 0xaa, 0x9,  0x7,  0xac, 0xac, 0x78, 0x75};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xb2, 0xf3, 0xb7, 0xac, 0x89, 0xe8, 0xd4, 0xd,  0x7e, 0x4e, 0xfc, 0x91, 0xd4,
                              0x68, 0xe6, 0x11, 0x90, 0x7a, 0x7d, 0xd1, 0x36, 0xf7, 0x10, 0xc0, 0x69, 0x71};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d, 0x55};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\r)\190_\138\DC4\SO\163\226j\189
// ~*BN\SI\EOT-\217\128\232\223\239\129m\a\DLEG\254", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "+\177\246\187~\133", _willMsg = "\151\189\&3\RS\175\198\166j", _willProps = []}), _cleanSession =
// False, _keepAlive = 4479, _connID =
// "\148\233\210e\EM\168\130\133\253\SOH\232\207f\173\220\238\167\166vG\v\141\190\";", _properties = []}
TEST(Connect311QCTest, Encode82) {
  uint8_t pkt[] = {0x10, 0x37, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x11, 0x7f, 0x0,  0x19, 0x94,
                   0xe9, 0xd2, 0x65, 0x19, 0xa8, 0x82, 0x85, 0xfd, 0x1,  0xe8, 0xcf, 0x66, 0xad, 0xdc, 0xee,
                   0xa7, 0xa6, 0x76, 0x47, 0xb,  0x8d, 0xbe, 0x22, 0x3b, 0x0,  0x6,  0x2b, 0xb1, 0xf6, 0xbb,
                   0x7e, 0x85, 0x0,  0x8,  0x97, 0xbd, 0x33, 0x1e, 0xaf, 0xc6, 0xa6, 0x6a};

  uint8_t buf[67] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2b, 0xb1, 0xf6, 0xbb, 0x7e, 0x85};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0xbd, 0x33, 0x1e, 0xaf, 0xc6, 0xa6, 0x6a};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4479;
  uint8_t client_id_bytes[] = {0x94, 0xe9, 0xd2, 0x65, 0x19, 0xa8, 0x82, 0x85, 0xfd, 0x1,  0xe8, 0xcf, 0x66,
                               0xad, 0xdc, 0xee, 0xa7, 0xa6, 0x76, 0x47, 0xb,  0x8d, 0xbe, 0x22, 0x3b};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd,  0x29, 0xbe, 0x5f, 0x8a, 0x14, 0xe,  0xa3, 0xe2, 0x6a, 0xbd, 0x20, 0x7e, 0x2a, 0x42,
                              0x4e, 0xf,  0x4,  0x2d, 0xd9, 0x80, 0xe8, 0xdf, 0xef, 0x81, 0x6d, 0x7,  0x10, 0x47, 0xfe};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\193=\216", _password = Nothing, _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 20616, _connID = "H\197jy\150\206eUf&\224\&9\ACK", _properties = []}
TEST(Connect311QCTest, Encode83) {
  uint8_t pkt[] = {0x10, 0x1e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x50, 0x88, 0x0, 0xd,  0x48, 0xc5,
                   0x6a, 0x79, 0x96, 0xce, 0x65, 0x55, 0x66, 0x26, 0xe0, 0x39, 0x6,  0x0,  0x3, 0xc1, 0x3d, 0xd8};

  uint8_t buf[42] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20616;
  uint8_t client_id_bytes[] = {0x48, 0xc5, 0x6a, 0x79, 0x96, 0xce, 0x65, 0x55, 0x66, 0x26, 0xe0, 0x39, 0x6};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc1, 0x3d, 0xd8};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\DLE\162\233\185\169\148\163\FS\DLE\DLE\EM\128\172$0\v\163\NAK\171\178o\152\247\162", _password = Just
// "\SYN)'\EMZ{&\170*\141\175\195\166\136\153%P\165\171Q\221Ps\200", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic =
// "\179j\234\186\173`\r5\139\224\166\231v\170\206~\241\ENQ7\249\230\240\135\&2\249\173ou\130", _willMsg =
// "\184\198C\184", _willProps = []}), _cleanSession = True, _keepAlive = 23215, _connID = "'\ESC", _properties = []}
TEST(Connect311QCTest, Encode84) {
  uint8_t pkt[] = {0x10, 0x67, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x5a, 0xaf, 0x0,  0x2,  0x27,
                   0x1b, 0x0,  0x1d, 0xb3, 0x6a, 0xea, 0xba, 0xad, 0x60, 0xd,  0x35, 0x8b, 0xe0, 0xa6, 0xe7,
                   0x76, 0xaa, 0xce, 0x7e, 0xf1, 0x5,  0x37, 0xf9, 0xe6, 0xf0, 0x87, 0x32, 0xf9, 0xad, 0x6f,
                   0x75, 0x82, 0x0,  0x4,  0xb8, 0xc6, 0x43, 0xb8, 0x0,  0x18, 0x10, 0xa2, 0xe9, 0xb9, 0xa9,
                   0x94, 0xa3, 0x1c, 0x10, 0x10, 0x19, 0x80, 0xac, 0x24, 0x30, 0xb,  0xa3, 0x15, 0xab, 0xb2,
                   0x6f, 0x98, 0xf7, 0xa2, 0x0,  0x18, 0x16, 0x29, 0x27, 0x19, 0x5a, 0x7b, 0x26, 0xaa, 0x2a,
                   0x8d, 0xaf, 0xc3, 0xa6, 0x88, 0x99, 0x25, 0x50, 0xa5, 0xab, 0x51, 0xdd, 0x50, 0x73, 0xc8};

  uint8_t buf[115] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb3, 0x6a, 0xea, 0xba, 0xad, 0x60, 0xd,  0x35, 0x8b, 0xe0,
                                0xa6, 0xe7, 0x76, 0xaa, 0xce, 0x7e, 0xf1, 0x5,  0x37, 0xf9,
                                0xe6, 0xf0, 0x87, 0x32, 0xf9, 0xad, 0x6f, 0x75, 0x82};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb8, 0xc6, 0x43, 0xb8};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23215;
  uint8_t client_id_bytes[] = {0x27, 0x1b};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x10, 0xa2, 0xe9, 0xb9, 0xa9, 0x94, 0xa3, 0x1c, 0x10, 0x10, 0x19, 0x80,
                              0xac, 0x24, 0x30, 0xb,  0xa3, 0x15, 0xab, 0xb2, 0x6f, 0x98, 0xf7, 0xa2};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x16, 0x29, 0x27, 0x19, 0x5a, 0x7b, 0x26, 0xaa, 0x2a, 0x8d, 0xaf, 0xc3,
                              0xa6, 0x88, 0x99, 0x25, 0x50, 0xa5, 0xab, 0x51, 0xdd, 0x50, 0x73, 0xc8};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\214", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\162\190\DC4\DC4\rt\172-\134\146\171Y\SUB\181GJ\232\223", _willMsg = "", _willProps =
// []}), _cleanSession = False, _keepAlive = 3268, _connID =
// "X\ENQ\249\146\ti\193j\128\159\242\ACK\200\143\vTWH]\156\DEL", _properties = []}
TEST(Connect311QCTest, Encode85) {
  uint8_t pkt[] = {0x10, 0x37, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0xc,  0xc4, 0x0,  0x15, 0x58,
                   0x5,  0xf9, 0x92, 0x9,  0x69, 0xc1, 0x6a, 0x80, 0x9f, 0xf2, 0x6,  0xc8, 0x8f, 0xb,  0x54,
                   0x57, 0x48, 0x5d, 0x9c, 0x7f, 0x0,  0x12, 0xa2, 0xbe, 0x14, 0x14, 0xd,  0x74, 0xac, 0x2d,
                   0x86, 0x92, 0xab, 0x59, 0x1a, 0xb5, 0x47, 0x4a, 0xe8, 0xdf, 0x0,  0x0};

  uint8_t buf[67] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa2, 0xbe, 0x14, 0x14, 0xd,  0x74, 0xac, 0x2d, 0x86,
                                0x92, 0xab, 0x59, 0x1a, 0xb5, 0x47, 0x4a, 0xe8, 0xdf};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3268;
  uint8_t client_id_bytes[] = {0x58, 0x5,  0xf9, 0x92, 0x9,  0x69, 0xc1, 0x6a, 0x80, 0x9f, 0xf2,
                               0x6,  0xc8, 0x8f, 0xb,  0x54, 0x57, 0x48, 0x5d, 0x9c, 0x7f};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd6};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// ")\156AQ\231\191\SYN\185h\225\178\137\238\&3\EOT\138\248\&7R\EM,*\SYN=\n\224\DC2", _lastWill = Nothing, _cleanSession
// = True, _keepAlive = 28678, _connID =
// "\189\132\188/]\224s+\NULTF\196\233U\GS\250L\167\176\EM\133\NUL\254\161Ol\136\162\209", _properties = []}
TEST(Connect311QCTest, Encode86) {
  uint8_t pkt[] = {0x10, 0x29, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x70, 0x6,  0x0,  0x1d, 0xbd,
                   0x84, 0xbc, 0x2f, 0x5d, 0xe0, 0x73, 0x2b, 0x0,  0x54, 0x46, 0xc4, 0xe9, 0x55, 0x1d, 0xfa,
                   0x4c, 0xa7, 0xb0, 0x19, 0x85, 0x0,  0xfe, 0xa1, 0x4f, 0x6c, 0x88, 0xa2, 0xd1};

  uint8_t buf[53] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28678;
  uint8_t client_id_bytes[] = {0xbd, 0x84, 0xbc, 0x2f, 0x5d, 0xe0, 0x73, 0x2b, 0x0,  0x54, 0x46, 0xc4, 0xe9, 0x55, 0x1d,
                               0xfa, 0x4c, 0xa7, 0xb0, 0x19, 0x85, 0x0,  0xfe, 0xa1, 0x4f, 0x6c, 0x88, 0xa2, 0xd1};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x29, 0x9c, 0x41, 0x51, 0xe7, 0xbf, 0x16, 0xb9, 0x68, 0xe1, 0xb2, 0x89, 0xee, 0x33,
                              0x4,  0x8a, 0xf8, 0x37, 0x52, 0x19, 0x2c, 0x2a, 0x16, 0x3d, 0xa,  0xe0, 0x12};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\231\136\157", _password = Nothing, _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 27015, _connID = "c\202.c\142W#U\130p\148q(O\219m", _properties = []}
TEST(Connect311QCTest, Encode87) {
  uint8_t pkt[] = {0x10, 0x21, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x69, 0x87,
                   0x0,  0x10, 0x63, 0xca, 0x2e, 0x63, 0x8e, 0x57, 0x23, 0x55, 0x82, 0x70,
                   0x94, 0x71, 0x28, 0x4f, 0xdb, 0x6d, 0x0,  0x3,  0xe7, 0x88, 0x9d};

  uint8_t buf[45] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27015;
  uint8_t client_id_bytes[] = {0x63, 0xca, 0x2e, 0x63, 0x8e, 0x57, 0x23, 0x55,
                               0x82, 0x70, 0x94, 0x71, 0x28, 0x4f, 0xdb, 0x6d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe7, 0x88, 0x9d};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "U\185M\196", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 28907, _connID = ";&\203q}", _properties = []}
TEST(Connect311QCTest, Encode88) {
  uint8_t pkt[] = {0x10, 0x11, 0x0, 0x4, 0x4d, 0x51, 0x54, 0x54, 0x4, 0x2,
                   0x70, 0xeb, 0x0, 0x5, 0x3b, 0x26, 0xcb, 0x71, 0x7d};

  uint8_t buf[29] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28907;
  uint8_t client_id_bytes[] = {0x3b, 0x26, 0xcb, 0x71, 0x7d};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x55, 0xb9, 0x4d, 0xc4};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "t\171o\168\ETB\EOT\EOT\226\b\SI\205\166J\SOj\164\ETB\SUB\166\245\US\SUB", _password
// = Just "\NAK\169_\251\NAK\186\DLE\215\169kW3J\b\199", _lastWill = Nothing, _cleanSession = False, _keepAlive = 28413,
// _connID = "\215\188:\SYN]?\n\214\176\&2i", _properties = []}
TEST(Connect311QCTest, Encode89) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x6e, 0xfd, 0x0,  0xb,  0xd7, 0xbc, 0x3a,
                   0x16, 0x5d, 0x3f, 0xa,  0xd6, 0xb0, 0x32, 0x69, 0x0,  0x16, 0x74, 0xab, 0x6f, 0xa8, 0x17, 0x4,  0x4,
                   0xe2, 0x8,  0xf,  0xcd, 0xa6, 0x4a, 0xe,  0x6a, 0xa4, 0x17, 0x1a, 0xa6, 0xf5, 0x1f, 0x1a, 0x0,  0xf,
                   0x15, 0xa9, 0x5f, 0xfb, 0x15, 0xba, 0x10, 0xd7, 0xa9, 0x6b, 0x57, 0x33, 0x4a, 0x8,  0xc7};

  uint8_t buf[76] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28413;
  uint8_t client_id_bytes[] = {0xd7, 0xbc, 0x3a, 0x16, 0x5d, 0x3f, 0xa, 0xd6, 0xb0, 0x32, 0x69};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x74, 0xab, 0x6f, 0xa8, 0x17, 0x4,  0x4,  0xe2, 0x8,  0xf,  0xcd,
                              0xa6, 0x4a, 0xe,  0x6a, 0xa4, 0x17, 0x1a, 0xa6, 0xf5, 0x1f, 0x1a};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x15, 0xa9, 0x5f, 0xfb, 0x15, 0xba, 0x10, 0xd7, 0xa9, 0x6b, 0x57, 0x33, 0x4a, 0x8, 0xc7};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "M", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\163\147\EOT\177\219J\221\FSm_\STX\RS\rK\130D\159\n}", _willProps = []}),
// _cleanSession = True, _keepAlive = 6707, _connID =
// "\248\222\190\&6\US\171Z\135\192\253\DEL\205\US\238\ETXR\201|\SUB", _properties = []}
TEST(Connect311QCTest, Encode90) {
  uint8_t pkt[] = {0x10, 0x36, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x1a, 0x33, 0x0,  0x13,
                   0xf8, 0xde, 0xbe, 0x36, 0x1f, 0xab, 0x5a, 0x87, 0xc0, 0xfd, 0x7f, 0xcd, 0x1f, 0xee,
                   0x3,  0x52, 0xc9, 0x7c, 0x1a, 0x0,  0x0,  0x0,  0x13, 0xa3, 0x93, 0x4,  0xb1, 0xdb,
                   0x4a, 0xdd, 0x1c, 0x6d, 0x5f, 0x2,  0x1e, 0xd,  0x4b, 0x82, 0x44, 0x9f, 0xa,  0x7d};

  uint8_t buf[66] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa3, 0x93, 0x4, 0xb1, 0xdb, 0x4a, 0xdd, 0x1c, 0x6d, 0x5f,
                                  0x2,  0x1e, 0xd, 0x4b, 0x82, 0x44, 0x9f, 0xa,  0x7d};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6707;
  uint8_t client_id_bytes[] = {0xf8, 0xde, 0xbe, 0x36, 0x1f, 0xab, 0x5a, 0x87, 0xc0, 0xfd,
                               0x7f, 0xcd, 0x1f, 0xee, 0x3,  0x52, 0xc9, 0x7c, 0x1a};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\135\167", _password = Just "do\ETX\170V\239N\235\129|\168G\SO\218O\245SW\228",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\198\149\RSL\143\254\166!", _willMsg =
// ":\215\\\152\141^\ETXb\198", _willProps = []}), _cleanSession = True, _keepAlive = 1501, _connID =
// "\234YO\DC3;\148\207\&0\153n\199\142\146\206\254\155:", _properties = []}
TEST(Connect311QCTest, Encode91) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x5,  0xdd, 0x0,  0x11, 0xea, 0x59,
                   0x4f, 0x13, 0x3b, 0x94, 0xcf, 0x30, 0x99, 0x6e, 0xc7, 0x8e, 0x92, 0xce, 0xfe, 0x9b, 0x3a, 0x0,
                   0x8,  0xc6, 0x95, 0x1e, 0x4c, 0x8f, 0xfe, 0xa6, 0x21, 0x0,  0x9,  0x3a, 0xd7, 0x5c, 0x98, 0x8d,
                   0x5e, 0x3,  0x62, 0xc6, 0x0,  0x2,  0x87, 0xa7, 0x0,  0x13, 0x64, 0x6f, 0x3,  0xaa, 0x56, 0xef,
                   0x4e, 0xeb, 0x81, 0x7c, 0xa8, 0x47, 0xe,  0xda, 0x4f, 0xf5, 0x53, 0x57, 0xe4};

  uint8_t buf[87] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc6, 0x95, 0x1e, 0x4c, 0x8f, 0xfe, 0xa6, 0x21};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0xd7, 0x5c, 0x98, 0x8d, 0x5e, 0x3, 0x62, 0xc6};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1501;
  uint8_t client_id_bytes[] = {0xea, 0x59, 0x4f, 0x13, 0x3b, 0x94, 0xcf, 0x30, 0x99,
                               0x6e, 0xc7, 0x8e, 0x92, 0xce, 0xfe, 0x9b, 0x3a};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x87, 0xa7};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0x6f, 0x3, 0xaa, 0x56, 0xef, 0x4e, 0xeb, 0x81, 0x7c,
                              0xa8, 0x47, 0xe, 0xda, 0x4f, 0xf5, 0x53, 0x57, 0xe4};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J3\245R\234g\199\SUBe\f]Y\184\155\252O\131", _password = Just
// "N\130Z\162\174\221xV\181", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "L\149\222\209\ETB6\200tmGe\184\245\DLEg\135|\138v", _willMsg =
// "\240S\t;\152\130\197\DEL\227\191\221\138y|D\US\188\DC2\\\198@\207\&5\174\DC4w\GS1", _willProps = []}), _cleanSession
// = True, _keepAlive = 7620, _connID = "\180X\169B\252{L\217vd\b\249L\137\219\253\249W\166\245\152\SOnJJE\131\213",
// _properties = []}
TEST(Connect311QCTest, Encode92) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x1d, 0xc4, 0x0,  0x1c, 0xb4, 0x58,
                   0xa9, 0x42, 0xfc, 0x7b, 0x4c, 0xd9, 0x76, 0x64, 0x8,  0xf9, 0x4c, 0x89, 0xdb, 0xfd, 0xf9, 0x57,
                   0xa6, 0xf5, 0x98, 0xe,  0x6e, 0x4a, 0x4a, 0x45, 0x83, 0xd5, 0x0,  0x13, 0x4c, 0x95, 0xde, 0xd1,
                   0x17, 0x36, 0xc8, 0x74, 0x6d, 0x47, 0x65, 0xb8, 0xf5, 0x10, 0x67, 0x87, 0x7c, 0x8a, 0x76, 0x0,
                   0x1c, 0xf0, 0x53, 0x9,  0x3b, 0x98, 0x82, 0xc5, 0x7f, 0xe3, 0xbf, 0xdd, 0x8a, 0x79, 0x7c, 0x44,
                   0x1f, 0xbc, 0x12, 0x5c, 0xc6, 0x40, 0xcf, 0x35, 0xae, 0x14, 0x77, 0x1d, 0x31, 0x0,  0x11, 0x4a,
                   0x33, 0xf5, 0x52, 0xea, 0x67, 0xc7, 0x1a, 0x65, 0xc,  0x5d, 0x59, 0xb8, 0x9b, 0xfc, 0x4f, 0x83,
                   0x0,  0x9,  0x4e, 0x82, 0x5a, 0xa2, 0xae, 0xdd, 0x78, 0x56, 0xb5};

  uint8_t buf[133] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4c, 0x95, 0xde, 0xd1, 0x17, 0x36, 0xc8, 0x74, 0x6d, 0x47,
                                0x65, 0xb8, 0xf5, 0x10, 0x67, 0x87, 0x7c, 0x8a, 0x76};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0x53, 0x9,  0x3b, 0x98, 0x82, 0xc5, 0x7f, 0xe3, 0xbf, 0xdd, 0x8a, 0x79, 0x7c,
                                  0x44, 0x1f, 0xbc, 0x12, 0x5c, 0xc6, 0x40, 0xcf, 0x35, 0xae, 0x14, 0x77, 0x1d, 0x31};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7620;
  uint8_t client_id_bytes[] = {0xb4, 0x58, 0xa9, 0x42, 0xfc, 0x7b, 0x4c, 0xd9, 0x76, 0x64, 0x8,  0xf9, 0x4c, 0x89,
                               0xdb, 0xfd, 0xf9, 0x57, 0xa6, 0xf5, 0x98, 0xe,  0x6e, 0x4a, 0x4a, 0x45, 0x83, 0xd5};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x33, 0xf5, 0x52, 0xea, 0x67, 0xc7, 0x1a, 0x65,
                              0xc,  0x5d, 0x59, 0xb8, 0x9b, 0xfc, 0x4f, 0x83};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4e, 0x82, 0x5a, 0xa2, 0xae, 0xdd, 0x78, 0x56, 0xb5};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DC2\145\228\152*\178X", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\143\&2Gc]\253N\249\243\153\145\225\185\215sp\SOHs\192\221\&7{",
// _willMsg = "\NUL\211NA\197", _willProps = []}), _cleanSession = True, _keepAlive = 29972, _connID =
// "\ETB8\187\183q0\214H5\201\SI\199\183B\212u[\143\253\152\199W\EOT\206\149", _properties = []}
TEST(Connect311QCTest, Encode93) {
  uint8_t pkt[] = {0x10, 0x44, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x75, 0x14, 0x0,  0x19,
                   0x17, 0x38, 0xbb, 0xb7, 0x71, 0x30, 0xd6, 0x48, 0x35, 0xc9, 0xf,  0xc7, 0xb7, 0x42,
                   0xd4, 0x75, 0x5b, 0x8f, 0xfd, 0x98, 0xc7, 0x57, 0x4,  0xce, 0x95, 0x0,  0x16, 0x8f,
                   0x32, 0x47, 0x63, 0x5d, 0xfd, 0x4e, 0xf9, 0xf3, 0x99, 0x91, 0xe1, 0xb9, 0xd7, 0x73,
                   0x70, 0x1,  0x73, 0xc0, 0xdd, 0x37, 0x7b, 0x0,  0x5,  0x0,  0xd3, 0x4e, 0x41, 0xc5};

  uint8_t buf[80] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0x32, 0x47, 0x63, 0x5d, 0xfd, 0x4e, 0xf9, 0xf3, 0x99, 0x91,
                                0xe1, 0xb9, 0xd7, 0x73, 0x70, 0x1,  0x73, 0xc0, 0xdd, 0x37, 0x7b};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x0, 0xd3, 0x4e, 0x41, 0xc5};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29972;
  uint8_t client_id_bytes[] = {0x17, 0x38, 0xbb, 0xb7, 0x71, 0x30, 0xd6, 0x48, 0x35, 0xc9, 0xf,  0xc7, 0xb7,
                               0x42, 0xd4, 0x75, 0x5b, 0x8f, 0xfd, 0x98, 0xc7, 0x57, 0x4,  0xce, 0x95};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x12, 0x91, 0xe4, 0x98, 0x2a, 0xb2, 0x58};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ",dA\164\202\NUL\161\212\169\183\&0", _password = Just "\CAN\SUB\238\&0", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\GS\187\&5\157[*n\166\233S\168\&8\155\DC4\177$\168q\204\218\r\rJ", _willMsg =
// "\236[s\ESCz\217dW\STX\222\151\&0\SYNB\149\b\189fKjA", _willProps = []}), _cleanSession = True, _keepAlive = 488,
// _connID = "/\152\131mx1\208\&5", _properties = []}
TEST(Connect311QCTest, Encode94) {
  uint8_t pkt[] = {0x10, 0x57, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x1,  0xe8, 0x0,  0x8,  0x2f,
                   0x98, 0x83, 0x6d, 0x78, 0x31, 0xd0, 0x35, 0x0,  0x17, 0x1d, 0xbb, 0x35, 0x9d, 0x5b, 0x2a,
                   0x6e, 0xa6, 0xe9, 0x53, 0xa8, 0x38, 0x9b, 0x14, 0xb1, 0x24, 0xa8, 0x71, 0xcc, 0xda, 0xd,
                   0xd,  0x4a, 0x0,  0x15, 0xec, 0x5b, 0x73, 0x1b, 0x7a, 0xd9, 0x64, 0x57, 0x2,  0xde, 0x97,
                   0x30, 0x16, 0x42, 0x95, 0x8,  0xbd, 0x66, 0x4b, 0x6a, 0x41, 0x0,  0xb,  0x2c, 0x64, 0x41,
                   0xa4, 0xca, 0x0,  0xa1, 0xd4, 0xa9, 0xb7, 0x30, 0x0,  0x4,  0x18, 0x1a, 0xee, 0x30};

  uint8_t buf[99] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1d, 0xbb, 0x35, 0x9d, 0x5b, 0x2a, 0x6e, 0xa6, 0xe9, 0x53, 0xa8, 0x38,
                                0x9b, 0x14, 0xb1, 0x24, 0xa8, 0x71, 0xcc, 0xda, 0xd,  0xd,  0x4a};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xec, 0x5b, 0x73, 0x1b, 0x7a, 0xd9, 0x64, 0x57, 0x2,  0xde, 0x97,
                                  0x30, 0x16, 0x42, 0x95, 0x8,  0xbd, 0x66, 0x4b, 0x6a, 0x41};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 488;
  uint8_t client_id_bytes[] = {0x2f, 0x98, 0x83, 0x6d, 0x78, 0x31, 0xd0, 0x35};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2c, 0x64, 0x41, 0xa4, 0xca, 0x0, 0xa1, 0xd4, 0xa9, 0xb7, 0x30};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x1a, 0xee, 0x30};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "ox\192\209\133\220~\DC29B\182\239=\196Sa[R\ETB\NUL\US\248E",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\214ht\202Q:u\DC3\190\SYN\SYN\246\225\130\232X\196k%\RSV*\144\154\215\184\227", _willMsg = "t
// \164\CAN)\191\132\223\226\201\230\149\253N\189\218\215\&4\182Gy\247y\201", _willProps = []}), _cleanSession = True,
// _keepAlive = 24570, _connID = "K\"%j\DLE\STXu~\ESC\236\178\204S\151(?\245\214w;\r\255\&5!", _properties = []}
TEST(Connect311QCTest, Encode95) {
  uint8_t pkt[] = {0x10, 0x5b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x5f, 0xfa, 0x0,  0x18, 0x4b, 0x22,
                   0x25, 0x6a, 0x10, 0x2,  0x75, 0x7e, 0x1b, 0xec, 0xb2, 0xcc, 0x53, 0x97, 0x28, 0x3f, 0xf5, 0xd6,
                   0x77, 0x3b, 0xd,  0xff, 0x35, 0x21, 0x0,  0x1b, 0xd6, 0x68, 0x74, 0xca, 0x51, 0x3a, 0x75, 0x13,
                   0xbe, 0x16, 0x16, 0xf6, 0xe1, 0x82, 0xe8, 0x58, 0xc4, 0x6b, 0x25, 0x1e, 0x56, 0x2a, 0x90, 0x9a,
                   0xd7, 0xb8, 0xe3, 0x0,  0x18, 0x74, 0x20, 0xa4, 0x18, 0x29, 0xbf, 0x84, 0xdf, 0xe2, 0xc9, 0xe6,
                   0x95, 0xfd, 0x4e, 0xbd, 0xda, 0xd7, 0x34, 0xb6, 0x47, 0x79, 0xf7, 0x79, 0xc9};

  uint8_t buf[103] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd6, 0x68, 0x74, 0xca, 0x51, 0x3a, 0x75, 0x13, 0xbe, 0x16, 0x16, 0xf6, 0xe1, 0x82,
                                0xe8, 0x58, 0xc4, 0x6b, 0x25, 0x1e, 0x56, 0x2a, 0x90, 0x9a, 0xd7, 0xb8, 0xe3};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x74, 0x20, 0xa4, 0x18, 0x29, 0xbf, 0x84, 0xdf, 0xe2, 0xc9, 0xe6, 0x95,
                                  0xfd, 0x4e, 0xbd, 0xda, 0xd7, 0x34, 0xb6, 0x47, 0x79, 0xf7, 0x79, 0xc9};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24570;
  uint8_t client_id_bytes[] = {0x4b, 0x22, 0x25, 0x6a, 0x10, 0x2,  0x75, 0x7e, 0x1b, 0xec, 0xb2, 0xcc,
                               0x53, 0x97, 0x28, 0x3f, 0xf5, 0xd6, 0x77, 0x3b, 0xd,  0xff, 0x35, 0x21};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x6f, 0x78, 0xc0, 0xd1, 0x85, 0xdc, 0x7e, 0x12, 0x39, 0x42, 0xb6, 0xef,
                              0x3d, 0xc4, 0x53, 0x61, 0x5b, 0x52, 0x17, 0x0,  0x1f, 0xf8, 0x45};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\157LD\210\143*\189\134\&0\231\250\253\DC3\210\ETXh\178",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "|\157\175oRO\236\200|s\252\165x\155\f\205{\227\229\134\251u\146\144\248.", _willMsg =
// "R\242;\DC1D\209@\146\213\194Qz\230\DC3\213\RSk`\189a5\DLE\245", _willProps = []}), _cleanSession = False, _keepAlive
// = 10064, _connID = "\192u\185\&3\177\222-3\142\DLE\172\172\163\242\228P\178\180\ETB\198]c\131", _properties = []}
TEST(Connect311QCTest, Encode96) {
  uint8_t pkt[] = {0x10, 0x58, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x27, 0x50, 0x0,  0x17, 0xc0,
                   0x75, 0xb9, 0x33, 0xb1, 0xde, 0x2d, 0x33, 0x8e, 0x10, 0xac, 0xac, 0xa3, 0xf2, 0xe4, 0x50,
                   0xb2, 0xb4, 0x17, 0xc6, 0x5d, 0x63, 0x83, 0x0,  0x1a, 0x7c, 0x9d, 0xaf, 0x6f, 0x52, 0x4f,
                   0xec, 0xc8, 0x7c, 0x73, 0xfc, 0xa5, 0x78, 0x9b, 0xc,  0xcd, 0x7b, 0xe3, 0xe5, 0x86, 0xfb,
                   0x75, 0x92, 0x90, 0xf8, 0x2e, 0x0,  0x17, 0x52, 0xf2, 0x3b, 0x11, 0x44, 0xd1, 0x40, 0x92,
                   0xd5, 0xc2, 0x51, 0x7a, 0xe6, 0x13, 0xd5, 0x1e, 0x6b, 0x60, 0xbd, 0x61, 0x35, 0x10, 0xf5};

  uint8_t buf[100] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x9d, 0xaf, 0x6f, 0x52, 0x4f, 0xec, 0xc8, 0x7c, 0x73, 0xfc, 0xa5, 0x78,
                                0x9b, 0xc,  0xcd, 0x7b, 0xe3, 0xe5, 0x86, 0xfb, 0x75, 0x92, 0x90, 0xf8, 0x2e};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x52, 0xf2, 0x3b, 0x11, 0x44, 0xd1, 0x40, 0x92, 0xd5, 0xc2, 0x51, 0x7a,
                                  0xe6, 0x13, 0xd5, 0x1e, 0x6b, 0x60, 0xbd, 0x61, 0x35, 0x10, 0xf5};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10064;
  uint8_t client_id_bytes[] = {0xc0, 0x75, 0xb9, 0x33, 0xb1, 0xde, 0x2d, 0x33, 0x8e, 0x10, 0xac, 0xac,
                               0xa3, 0xf2, 0xe4, 0x50, 0xb2, 0xb4, 0x17, 0xc6, 0x5d, 0x63, 0x83};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9d, 0x4c, 0x44, 0xd2, 0x8f, 0x2a, 0xbd, 0x86, 0x30,
                              0xe7, 0xfa, 0xfd, 0x13, 0xd2, 0x3,  0x68, 0xb2};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\136a6\248", _password = Just "aW\205\150\ACK*\208", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 27816, _connID = "\200\194\195y\163\178", _properties = []}
TEST(Connect311QCTest, Encode97) {
  uint8_t pkt[] = {0x10, 0x21, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4, 0xc2, 0x6c, 0xa8,
                   0x0,  0x6,  0xc8, 0xc2, 0xc3, 0x79, 0xa3, 0xb2, 0x0, 0x4,  0x88, 0x61,
                   0x36, 0xf8, 0x0,  0x7,  0x61, 0x57, 0xcd, 0x96, 0x6, 0x2a, 0xd0};

  uint8_t buf[45] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27816;
  uint8_t client_id_bytes[] = {0xc8, 0xc2, 0xc3, 0x79, 0xa3, 0xb2};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x88, 0x61, 0x36, 0xf8};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x61, 0x57, 0xcd, 0x96, 0x6, 0x2a, 0xd0};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Y2\vz\196.", _password = Just
// "Z+\195-\233*,\232\192\178w\"\201\188X\DELI\165\144\170\n\161bdTr", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = ":\152<\197\228\170\235[\NUL\207I\169=\149\NAK\225$\r\224\220\173\133EX", _willMsg =
// "E\225^YZ\STX\161\CANS\130>\215e\rU", _willProps = []}), _cleanSession = False, _keepAlive = 12906, _connID =
// "e\161\220F\196\187*\\H\151\188i\177\188\172\240", _properties = []}
TEST(Connect311QCTest, Encode98) {
  uint8_t pkt[] = {0x10, 0x6b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x32, 0x6a, 0x0,  0x10, 0x65, 0xa1,
                   0xdc, 0x46, 0xc4, 0xbb, 0x2a, 0x5c, 0x48, 0x97, 0xbc, 0x69, 0xb1, 0xbc, 0xac, 0xf0, 0x0,  0x18,
                   0x3a, 0x98, 0x3c, 0xc5, 0xe4, 0xaa, 0xeb, 0x5b, 0x0,  0xcf, 0x49, 0xa9, 0x3d, 0x95, 0x15, 0xe1,
                   0x24, 0xd,  0xe0, 0xdc, 0xad, 0x85, 0x45, 0x58, 0x0,  0xf,  0x45, 0xe1, 0x5e, 0x59, 0x5a, 0x2,
                   0xa1, 0x18, 0x53, 0x82, 0x3e, 0xd7, 0x65, 0xd,  0x55, 0x0,  0x6,  0x59, 0x32, 0xb,  0x7a, 0xc4,
                   0x2e, 0x0,  0x1a, 0x5a, 0x2b, 0xc3, 0x2d, 0xe9, 0x2a, 0x2c, 0xe8, 0xc0, 0xb2, 0x77, 0x22, 0xc9,
                   0xbc, 0x58, 0x7f, 0x49, 0xa5, 0x90, 0xaa, 0xa,  0xa1, 0x62, 0x64, 0x54, 0x72};

  uint8_t buf[119] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3a, 0x98, 0x3c, 0xc5, 0xe4, 0xaa, 0xeb, 0x5b, 0x0,  0xcf, 0x49, 0xa9,
                                0x3d, 0x95, 0x15, 0xe1, 0x24, 0xd,  0xe0, 0xdc, 0xad, 0x85, 0x45, 0x58};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x45, 0xe1, 0x5e, 0x59, 0x5a, 0x2, 0xa1, 0x18,
                                  0x53, 0x82, 0x3e, 0xd7, 0x65, 0xd, 0x55};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12906;
  uint8_t client_id_bytes[] = {0x65, 0xa1, 0xdc, 0x46, 0xc4, 0xbb, 0x2a, 0x5c,
                               0x48, 0x97, 0xbc, 0x69, 0xb1, 0xbc, 0xac, 0xf0};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x59, 0x32, 0xb, 0x7a, 0xc4, 0x2e};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5a, 0x2b, 0xc3, 0x2d, 0xe9, 0x2a, 0x2c, 0xe8, 0xc0, 0xb2, 0x77, 0x22, 0xc9,
                              0xbc, 0x58, 0x7f, 0x49, 0xa5, 0x90, 0xaa, 0xa,  0xa1, 0x62, 0x64, 0x54, 0x72};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 19412, _connID = "\188=\183\NAK\DLE~\SYN\241", _properties = []}
TEST(Connect311QCTest, Encode99) {
  uint8_t pkt[] = {0x10, 0x14, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x4b,
                   0xd4, 0x0,  0x8, 0xbc, 0x3d, 0xb7, 0x15, 0x10, 0x7e, 0x16, 0xf1};

  uint8_t buf[32] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19412;
  uint8_t client_id_bytes[] = {0xbc, 0x3d, 0xb7, 0x15, 0x10, 0x7e, 0x16, 0xf1};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\213Z6\DC4\128\136\188%", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "|\RS\164\178\193a", _willMsg =
// "O\197\240\214\DC1$j5y^\EM\222\253+\DC1\147}", _willProps = []}), _cleanSession = True, _keepAlive = 19592, _connID =
// "\132\175\ETX\n\219\137\SI\183V\196\219\251\145t\244\200AZ[\156\a\212\252\177\154\245%@\249", _properties = []}
TEST(Connect311QCTest, Encode100) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xae, 0x4c, 0x88, 0x0,  0x1d, 0x84, 0xaf,
                   0x3,  0xa,  0xdb, 0x89, 0xf,  0xb7, 0x56, 0xc4, 0xdb, 0xfb, 0x91, 0x74, 0xf4, 0xc8, 0x41, 0x5a,
                   0x5b, 0x9c, 0x7,  0xd4, 0xfc, 0xb1, 0x9a, 0xf5, 0x25, 0x40, 0xf9, 0x0,  0x6,  0x7c, 0x1e, 0xa4,
                   0xb2, 0xc1, 0x61, 0x0,  0x11, 0x4f, 0xc5, 0xf0, 0xd6, 0x11, 0x24, 0x6a, 0x35, 0x79, 0x5e, 0x19,
                   0xde, 0xfd, 0x2b, 0x11, 0x93, 0x7d, 0x0,  0x8,  0xd5, 0x5a, 0x36, 0x14, 0x80, 0x88, 0xbc, 0x25};

  uint8_t buf[90] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x1e, 0xa4, 0xb2, 0xc1, 0x61};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0xc5, 0xf0, 0xd6, 0x11, 0x24, 0x6a, 0x35, 0x79,
                                  0x5e, 0x19, 0xde, 0xfd, 0x2b, 0x11, 0x93, 0x7d};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19592;
  uint8_t client_id_bytes[] = {0x84, 0xaf, 0x3,  0xa,  0xdb, 0x89, 0xf,  0xb7, 0x56, 0xc4, 0xdb, 0xfb, 0x91, 0x74, 0xf4,
                               0xc8, 0x41, 0x5a, 0x5b, 0x9c, 0x7,  0xd4, 0xfc, 0xb1, 0x9a, 0xf5, 0x25, 0x40, 0xf9};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd5, 0x5a, 0x36, 0x14, 0x80, 0x88, 0xbc, 0x25};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "F\171\131\SI\DC4\132\f\236\247\252", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\246\240", _willMsg =
// "\169\154\b\180\t3\183\199\&9\250\194", _willProps = [PropServerKeepAlive 10579,PropTopicAliasMaximum
// 32315,PropPayloadFormatIndicator 155,PropTopicAliasMaximum 4930,PropServerKeepAlive 17639,PropServerReference
// "u3\DC3~\157\133\235\254\208\177\SI\224>\ESCqM\155-\252\233F\CAN\GS\216&\EOT\235\&1z",PropWildcardSubscriptionAvailable
// 229,PropServerReference "\252NS\232\153\255\US\NAK\171\168\227\232\n\208\208\200",PropSubscriptionIdentifierAvailable
// 182,PropResponseInformation "\191",PropWildcardSubscriptionAvailable 52,PropAssignedClientIdentifier
// "\DLE\227\&8T\182J\"m;",PropReasonString
// "g\167i\254\232\166\198#\179\185Z\r\128\247\251hd\243\170\&7",PropRetainAvailable 68,PropReceiveMaximum
// 13425,PropWildcardSubscriptionAvailable 85,PropResponseInformation
// "3\212\219\SOH\201v5+\SUB\150\STX",PropRequestResponseInformation 166,PropReceiveMaximum 21964]}), _cleanSession =
// True, _keepAlive = 3250, _connID = " \241\DC2\ACK\157\190\v\161\205=\\\156dS\184{", _properties = []}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0xb8, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0xc,  0xb2, 0x0,  0x0,  0x10, 0x20, 0xf1, 0x12,
      0x6,  0x9d, 0xbe, 0xb,  0xa1, 0xcd, 0x3d, 0x5c, 0x9c, 0x64, 0x53, 0xb8, 0x7b, 0x88, 0x1,  0x13, 0x29, 0x53, 0x22,
      0x7e, 0x3b, 0x1,  0x9b, 0x22, 0x13, 0x42, 0x13, 0x44, 0xe7, 0x1c, 0x0,  0x1d, 0x75, 0x33, 0x13, 0x7e, 0x9d, 0x85,
      0xeb, 0xfe, 0xd0, 0xb1, 0xf,  0xe0, 0x3e, 0x1b, 0x71, 0x4d, 0x9b, 0x2d, 0xfc, 0xe9, 0x46, 0x18, 0x1d, 0xd8, 0x26,
      0x4,  0xeb, 0x31, 0x7a, 0x28, 0xe5, 0x1c, 0x0,  0x10, 0xfc, 0x4e, 0x53, 0xe8, 0x99, 0xff, 0x1f, 0x15, 0xab, 0xa8,
      0xe3, 0xe8, 0xa,  0xd0, 0xd0, 0xc8, 0x29, 0xb6, 0x1a, 0x0,  0x1,  0xbf, 0x28, 0x34, 0x12, 0x0,  0x9,  0x10, 0xe3,
      0x38, 0x54, 0xb6, 0x4a, 0x22, 0x6d, 0x3b, 0x1f, 0x0,  0x14, 0x67, 0xa7, 0x69, 0xfe, 0xe8, 0xa6, 0xc6, 0x23, 0xb3,
      0xb9, 0x5a, 0xd,  0x80, 0xf7, 0xfb, 0x68, 0x64, 0xf3, 0xaa, 0x37, 0x25, 0x44, 0x21, 0x34, 0x71, 0x28, 0x55, 0x1a,
      0x0,  0xb,  0x33, 0xd4, 0xdb, 0x1,  0xc9, 0x76, 0x35, 0x2b, 0x1a, 0x96, 0x2,  0x19, 0xa6, 0x21, 0x55, 0xcc, 0x0,
      0x2,  0xf6, 0xf0, 0x0,  0xb,  0xa9, 0x9a, 0x8,  0xb4, 0x9,  0x33, 0xb7, 0xc7, 0x39, 0xfa, 0xc2};

  uint8_t buf[197] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x75, 0x33, 0x13, 0x7e, 0x9d, 0x85, 0xeb, 0xfe, 0xd0, 0xb1, 0xf, 0xe0, 0x3e, 0x1b, 0x71,
                               0x4d, 0x9b, 0x2d, 0xfc, 0xe9, 0x46, 0x18, 0x1d, 0xd8, 0x26, 0x4, 0xeb, 0x31, 0x7a};
  uint8_t byteswillprops1[] = {0xfc, 0x4e, 0x53, 0xe8, 0x99, 0xff, 0x1f, 0x15,
                               0xab, 0xa8, 0xe3, 0xe8, 0xa,  0xd0, 0xd0, 0xc8};
  uint8_t byteswillprops2[] = {0xbf};
  uint8_t byteswillprops3[] = {0x10, 0xe3, 0x38, 0x54, 0xb6, 0x4a, 0x22, 0x6d, 0x3b};
  uint8_t byteswillprops4[] = {0x67, 0xa7, 0x69, 0xfe, 0xe8, 0xa6, 0xc6, 0x23, 0xb3, 0xb9,
                               0x5a, 0xd,  0x80, 0xf7, 0xfb, 0x68, 0x64, 0xf3, 0xaa, 0x37};
  uint8_t byteswillprops5[] = {0x33, 0xd4, 0xdb, 0x1, 0xc9, 0x76, 0x35, 0x2b, 0x1a, 0x96, 0x2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10579}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32315}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4930}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17639}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13425}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21964}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf6, 0xf0};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa9, 0x9a, 0x8, 0xb4, 0x9, 0x33, 0xb7, 0xc7, 0x39, 0xfa, 0xc2};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3250;
  uint8_t client_id_bytes[] = {0x20, 0xf1, 0x12, 0x6,  0x9d, 0xbe, 0xb,  0xa1,
                               0xcd, 0x3d, 0x5c, 0x9c, 0x64, 0x53, 0xb8, 0x7b};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x46, 0xab, 0x83, 0xf, 0x14, 0x84, 0xc, 0xec, 0xf7, 0xfc};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\185\211\STX\225\EOT\134\DC4\DC2", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "y\133\f\222\RS\142", _willMsg =
// "\252\142\185\165\252\211e|\US\228\205\SYN\193\227\255\173\EOT$", _willProps = [PropTopicAliasMaximum
// 13488,PropPayloadFormatIndicator 204,PropSessionExpiryInterval 32098,PropMaximumQoS 149,PropResponseTopic
// "\161#\151O\188\187",PropResponseTopic "\ENQ\f\SO\ETX\200\NUL\196\137V\173HO\170R<",PropSharedSubscriptionAvailable
// 177,PropContentType "",PropSubscriptionIdentifier 6,PropRetainAvailable 121,PropMaximumQoS 0,PropReceiveMaximum
// 18726,PropAuthenticationData
// "\194\DLE\239U\170\b\197\234[\210\b\141\156\242\136,%:\245\212\ETX8",PropMaximumPacketSize 16300,PropServerKeepAlive
// 29904,PropMaximumPacketSize 3698,PropTopicAlias 6587,PropWildcardSubscriptionAvailable 175,PropMaximumPacketSize
// 20654,PropReceiveMaximum 20352,PropRetainAvailable 170,PropSubscriptionIdentifier 7,PropPayloadFormatIndicator
// 143,PropResponseTopic "\252H\151s\248=\209\175>\128\133\186\150eq1g\224ht\SOH\223\168>\DC2",PropTopicAliasMaximum
// 30495,PropSubscriptionIdentifierAvailable 49,PropSubscriptionIdentifierAvailable 126]}), _cleanSession = False,
// _keepAlive = 15842, _connID = "", _properties = [PropSubscriptionIdentifierAvailable 221,PropResponseInformation
// "\197\158\218\225\175\251\166\207\156_Dq\238*\223",PropReceiveMaximum 28123,PropSubscriptionIdentifier
// 22,PropWildcardSubscriptionAvailable 143,PropMessageExpiryInterval 25705,PropAssignedClientIdentifier
// "\236\ETXO",PropRequestResponseInformation 187,PropTopicAlias 10652,PropPayloadFormatIndicator 166,PropReceiveMaximum
// 4455,PropMessageExpiryInterval 9441,PropMessageExpiryInterval 27038,PropMessageExpiryInterval
// 19854,PropRequestProblemInformation 43,PropTopicAlias 1994,PropContentType
// "0K\218\NAK\187\180\213",PropServerKeepAlive 4973,PropSessionExpiryInterval 30803,PropRequestResponseInformation
// 104,PropResponseTopic "\203\US\230\154\176\FS?\138\235\226\ACK\141&i\161\250",PropPayloadFormatIndicator
// 69,PropContentType
// "n\DC2\201<\143K\205\EM\139\252h\223\171\250\174\161~*vBw:\DC1\255\135\FS\159",PropAssignedClientIdentifier
// "\171%\176q\186\&0\225\247\&8q\ACK\144\ESC0\211wC\167\r\ACK",PropTopicAlias 11156,PropContentType
// "\204&\217~cc\185\212zoU\220\156\201\234m\243[,\158\131W\223\236",PropMaximumQoS 255,PropAuthenticationData
// ">\f7j\201\186\146d_\224\212\192\163\183\141'\SOH\242\EOT\132\226\243l\232?T",PropMaximumPacketSize
// 12789,PropPayloadFormatIndicator 23]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0xad, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0x3d, 0xe2, 0xe6, 0x1,  0x29, 0xdd, 0x1a, 0x0,
      0xf,  0xc5, 0x9e, 0xda, 0xe1, 0xaf, 0xfb, 0xa6, 0xcf, 0x9c, 0x5f, 0x44, 0x71, 0xee, 0x2a, 0xdf, 0x21, 0x6d, 0xdb,
      0xb,  0x16, 0x28, 0x8f, 0x2,  0x0,  0x0,  0x64, 0x69, 0x12, 0x0,  0x3,  0xec, 0x3,  0x4f, 0x19, 0xbb, 0x23, 0x29,
      0x9c, 0x1,  0xa6, 0x21, 0x11, 0x67, 0x2,  0x0,  0x0,  0x24, 0xe1, 0x2,  0x0,  0x0,  0x69, 0x9e, 0x2,  0x0,  0x0,
      0x4d, 0x8e, 0x17, 0x2b, 0x23, 0x7,  0xca, 0x3,  0x0,  0x7,  0x30, 0x4b, 0xda, 0x15, 0xbb, 0xb4, 0xd5, 0x13, 0x13,
      0x6d, 0x11, 0x0,  0x0,  0x78, 0x53, 0x19, 0x68, 0x8,  0x0,  0x10, 0xcb, 0x1f, 0xe6, 0x9a, 0xb0, 0x1c, 0x3f, 0x8a,
      0xeb, 0xe2, 0x6,  0x8d, 0x26, 0x69, 0xa1, 0xfa, 0x1,  0x45, 0x3,  0x0,  0x1b, 0x6e, 0x12, 0xc9, 0x3c, 0x8f, 0x4b,
      0xcd, 0x19, 0x8b, 0xfc, 0x68, 0xdf, 0xab, 0xfa, 0xae, 0xa1, 0x7e, 0x2a, 0x76, 0x42, 0x77, 0x3a, 0x11, 0xff, 0x87,
      0x1c, 0x9f, 0x12, 0x0,  0x14, 0xab, 0x25, 0xb0, 0x71, 0xba, 0x30, 0xe1, 0xf7, 0x38, 0x71, 0x6,  0x90, 0x1b, 0x30,
      0xd3, 0x77, 0x43, 0xa7, 0xd,  0x6,  0x23, 0x2b, 0x94, 0x3,  0x0,  0x18, 0xcc, 0x26, 0xd9, 0x7e, 0x63, 0x63, 0xb9,
      0xd4, 0x7a, 0x6f, 0x55, 0xdc, 0x9c, 0xc9, 0xea, 0x6d, 0xf3, 0x5b, 0x2c, 0x9e, 0x83, 0x57, 0xdf, 0xec, 0x24, 0xff,
      0x16, 0x0,  0x1a, 0x3e, 0xc,  0x37, 0x6a, 0xc9, 0xba, 0x92, 0x64, 0x5f, 0xe0, 0xd4, 0xc0, 0xa3, 0xb7, 0x8d, 0x27,
      0x1,  0xf2, 0x4,  0x84, 0xe2, 0xf3, 0x6c, 0xe8, 0x3f, 0x54, 0x27, 0x0,  0x0,  0x31, 0xf5, 0x1,  0x17, 0x0,  0x0,
      0x91, 0x1,  0x22, 0x34, 0xb0, 0x1,  0xcc, 0x11, 0x0,  0x0,  0x7d, 0x62, 0x24, 0x95, 0x8,  0x0,  0x6,  0xa1, 0x23,
      0x97, 0x4f, 0xbc, 0xbb, 0x8,  0x0,  0xf,  0x5,  0xc,  0xe,  0x3,  0xc8, 0x0,  0xc4, 0x89, 0x56, 0xad, 0x48, 0x4f,
      0xaa, 0x52, 0x3c, 0x2a, 0xb1, 0x3,  0x0,  0x0,  0xb,  0x6,  0x25, 0x79, 0x24, 0x0,  0x21, 0x49, 0x26, 0x16, 0x0,
      0x16, 0xc2, 0x10, 0xef, 0x55, 0xaa, 0x8,  0xc5, 0xea, 0x5b, 0xd2, 0x8,  0x8d, 0x9c, 0xf2, 0x88, 0x2c, 0x25, 0x3a,
      0xf5, 0xd4, 0x3,  0x38, 0x27, 0x0,  0x0,  0x3f, 0xac, 0x13, 0x74, 0xd0, 0x27, 0x0,  0x0,  0xe,  0x72, 0x23, 0x19,
      0xbb, 0x28, 0xaf, 0x27, 0x0,  0x0,  0x50, 0xae, 0x21, 0x4f, 0x80, 0x25, 0xaa, 0xb,  0x7,  0x1,  0x8f, 0x8,  0x0,
      0x19, 0xfc, 0x48, 0x97, 0x73, 0xf8, 0x3d, 0xd1, 0xaf, 0x3e, 0x80, 0x85, 0xba, 0x96, 0x65, 0x71, 0x31, 0x67, 0xe0,
      0x68, 0x74, 0x1,  0xdf, 0xa8, 0x3e, 0x12, 0x22, 0x77, 0x1f, 0x29, 0x31, 0x29, 0x7e, 0x0,  0x6,  0x79, 0x85, 0xc,
      0xde, 0x1e, 0x8e, 0x0,  0x12, 0xfc, 0x8e, 0xb9, 0xa5, 0xfc, 0xd3, 0x65, 0x7c, 0x1f, 0xe4, 0xcd, 0x16, 0xc1, 0xe3,
      0xff, 0xad, 0x4,  0x24, 0x0,  0x8,  0xb9, 0xd3, 0x2,  0xe1, 0x4,  0x86, 0x14, 0x12};

  uint8_t buf[442] = {0};

  uint8_t bytesprops0[] = {0xc5, 0x9e, 0xda, 0xe1, 0xaf, 0xfb, 0xa6, 0xcf, 0x9c, 0x5f, 0x44, 0x71, 0xee, 0x2a, 0xdf};
  uint8_t bytesprops1[] = {0xec, 0x3, 0x4f};
  uint8_t bytesprops2[] = {0x30, 0x4b, 0xda, 0x15, 0xbb, 0xb4, 0xd5};
  uint8_t bytesprops3[] = {0xcb, 0x1f, 0xe6, 0x9a, 0xb0, 0x1c, 0x3f, 0x8a,
                           0xeb, 0xe2, 0x6,  0x8d, 0x26, 0x69, 0xa1, 0xfa};
  uint8_t bytesprops4[] = {0x6e, 0x12, 0xc9, 0x3c, 0x8f, 0x4b, 0xcd, 0x19, 0x8b, 0xfc, 0x68, 0xdf, 0xab, 0xfa,
                           0xae, 0xa1, 0x7e, 0x2a, 0x76, 0x42, 0x77, 0x3a, 0x11, 0xff, 0x87, 0x1c, 0x9f};
  uint8_t bytesprops5[] = {0xab, 0x25, 0xb0, 0x71, 0xba, 0x30, 0xe1, 0xf7, 0x38, 0x71,
                           0x6,  0x90, 0x1b, 0x30, 0xd3, 0x77, 0x43, 0xa7, 0xd,  0x6};
  uint8_t bytesprops6[] = {0xcc, 0x26, 0xd9, 0x7e, 0x63, 0x63, 0xb9, 0xd4, 0x7a, 0x6f, 0x55, 0xdc,
                           0x9c, 0xc9, 0xea, 0x6d, 0xf3, 0x5b, 0x2c, 0x9e, 0x83, 0x57, 0xdf, 0xec};
  uint8_t bytesprops7[] = {0x3e, 0xc,  0x37, 0x6a, 0xc9, 0xba, 0x92, 0x64, 0x5f, 0xe0, 0xd4, 0xc0, 0xa3,
                           0xb7, 0x8d, 0x27, 0x1,  0xf2, 0x4,  0x84, 0xe2, 0xf3, 0x6c, 0xe8, 0x3f, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28123}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25705}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10652}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4455}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9441}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27038}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19854}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1994}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4973}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30803}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11156}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12789}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa1, 0x23, 0x97, 0x4f, 0xbc, 0xbb};
  uint8_t byteswillprops1[] = {0x5, 0xc, 0xe, 0x3, 0xc8, 0x0, 0xc4, 0x89, 0x56, 0xad, 0x48, 0x4f, 0xaa, 0x52, 0x3c};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0xc2, 0x10, 0xef, 0x55, 0xaa, 0x8,  0xc5, 0xea, 0x5b, 0xd2, 0x8,
                               0x8d, 0x9c, 0xf2, 0x88, 0x2c, 0x25, 0x3a, 0xf5, 0xd4, 0x3,  0x38};
  uint8_t byteswillprops4[] = {0xfc, 0x48, 0x97, 0x73, 0xf8, 0x3d, 0xd1, 0xaf, 0x3e, 0x80, 0x85, 0xba, 0x96,
                               0x65, 0x71, 0x31, 0x67, 0xe0, 0x68, 0x74, 0x1,  0xdf, 0xa8, 0x3e, 0x12};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13488}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32098}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18726}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16300}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29904}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3698}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6587}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20654}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20352}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30495}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 126}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x79, 0x85, 0xc, 0xde, 0x1e, 0x8e};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfc, 0x8e, 0xb9, 0xa5, 0xfc, 0xd3, 0x65, 0x7c, 0x1f,
                                  0xe4, 0xcd, 0x16, 0xc1, 0xe3, 0xff, 0xad, 0x4,  0x24};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15842;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0xd3, 0x2, 0xe1, 0x4, 0x86, 0x14, 0x12};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "eb:\159\169fA~\133\\\r6A7\139\&2\174\229Ue", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\255\245V\194\148\209\GS\f\218\140\201\EM/;H\146\135\176\253}\184\207V7.", _willMsg =
// "\SOH11\t\238\217?\210\\\EOT\223k\192\250?\156\178<\236+\SIQ\209\ACK\177\204\163", _willProps =
// [PropSessionExpiryInterval 26338,PropMessageExpiryInterval 482,PropWillDelayInterval
// 26497,PropRequestResponseInformation 255,PropSharedSubscriptionAvailable 121,PropMessageExpiryInterval
// 31822,PropRetainAvailable 10,PropAuthenticationData
// "\194\224\156f}\240\RSe\228\233JE\177s\133\ETB6\233P\NAK\n",PropRetainAvailable 150,PropSessionExpiryInterval
// 52,PropMaximumPacketSize 1043,PropReasonString "=(Q6\153\153H\167\151Q\217;\189\188F",PropResponseInformation
// "\196Z\175:\252\193Jd^]",PropTopicAliasMaximum 13915,PropAssignedClientIdentifier
// "\n\ETB\185z",PropResponseInformation "\144\SYN\182\ESC`\186\ETB\SO\137A\SO9Ix\SO\164yG",PropResponseInformation
// "F*O\232\147HTs\b\146?\146\EOT-\216\NAK\249\176\196\170\134s\248\&4\136\225\249\226\&2\134",PropWillDelayInterval
// 19003,PropResponseInformation "Z\143#\189\213V\174J\vn\SUB\228\186\230N\149A\165\156\&3",PropRetainAvailable
// 144,PropAssignedClientIdentifier "\161T\206\166%~+B\137B\SYN6\ACK\234"]}), _cleanSession = False, _keepAlive = 29642,
// _connID = "\212eR", _properties = [PropReceiveMaximum 17349]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2c, 0x73, 0xca, 0x3,  0x21, 0x43, 0xc5, 0x0,  0x3,
      0xd4, 0x65, 0x52, 0xcc, 0x1,  0x11, 0x0,  0x0,  0x66, 0xe2, 0x2,  0x0,  0x0,  0x1,  0xe2, 0x18, 0x0,  0x0,  0x67,
      0x81, 0x19, 0xff, 0x2a, 0x79, 0x2,  0x0,  0x0,  0x7c, 0x4e, 0x25, 0xa,  0x16, 0x0,  0x15, 0xc2, 0xe0, 0x9c, 0x66,
      0x7d, 0xf0, 0x1e, 0x65, 0xe4, 0xe9, 0x4a, 0x45, 0xb1, 0x73, 0x85, 0x17, 0x36, 0xe9, 0x50, 0x15, 0xa,  0x25, 0x96,
      0x11, 0x0,  0x0,  0x0,  0x34, 0x27, 0x0,  0x0,  0x4,  0x13, 0x1f, 0x0,  0xf,  0x3d, 0x28, 0x51, 0x36, 0x99, 0x99,
      0x48, 0xa7, 0x97, 0x51, 0xd9, 0x3b, 0xbd, 0xbc, 0x46, 0x1a, 0x0,  0xa,  0xc4, 0x5a, 0xaf, 0x3a, 0xfc, 0xc1, 0x4a,
      0x64, 0x5e, 0x5d, 0x22, 0x36, 0x5b, 0x12, 0x0,  0x4,  0xa,  0x17, 0xb9, 0x7a, 0x1a, 0x0,  0x12, 0x90, 0x16, 0xb6,
      0x1b, 0x60, 0xba, 0x17, 0xe,  0x89, 0x41, 0xe,  0x39, 0x49, 0x78, 0xe,  0xa4, 0x79, 0x47, 0x1a, 0x0,  0x1e, 0x46,
      0x2a, 0x4f, 0xe8, 0x93, 0x48, 0x54, 0x73, 0x8,  0x92, 0x3f, 0x92, 0x4,  0x2d, 0xd8, 0x15, 0xf9, 0xb0, 0xc4, 0xaa,
      0x86, 0x73, 0xf8, 0x34, 0x88, 0xe1, 0xf9, 0xe2, 0x32, 0x86, 0x18, 0x0,  0x0,  0x4a, 0x3b, 0x1a, 0x0,  0x14, 0x5a,
      0x8f, 0x23, 0xbd, 0xd5, 0x56, 0xae, 0x4a, 0xb,  0x6e, 0x1a, 0xe4, 0xba, 0xe6, 0x4e, 0x95, 0x41, 0xa5, 0x9c, 0x33,
      0x25, 0x90, 0x12, 0x0,  0xe,  0xa1, 0x54, 0xce, 0xa6, 0x25, 0x7e, 0x2b, 0x42, 0x89, 0x42, 0x16, 0x36, 0x6,  0xea,
      0x0,  0x19, 0xff, 0xf5, 0x56, 0xc2, 0x94, 0xd1, 0x1d, 0xc,  0xda, 0x8c, 0xc9, 0x19, 0x2f, 0x3b, 0x48, 0x92, 0x87,
      0xb0, 0xfd, 0x7d, 0xb8, 0xcf, 0x56, 0x37, 0x2e, 0x0,  0x1b, 0x1,  0x31, 0x31, 0x9,  0xee, 0xd9, 0x3f, 0xd2, 0x5c,
      0x4,  0xdf, 0x6b, 0xc0, 0xfa, 0x3f, 0x9c, 0xb2, 0x3c, 0xec, 0x2b, 0xf,  0x51, 0xd1, 0x6,  0xb1, 0xcc, 0xa3};

  uint8_t buf[294] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17349}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc2, 0xe0, 0x9c, 0x66, 0x7d, 0xf0, 0x1e, 0x65, 0xe4, 0xe9, 0x4a,
                               0x45, 0xb1, 0x73, 0x85, 0x17, 0x36, 0xe9, 0x50, 0x15, 0xa};
  uint8_t byteswillprops1[] = {0x3d, 0x28, 0x51, 0x36, 0x99, 0x99, 0x48, 0xa7,
                               0x97, 0x51, 0xd9, 0x3b, 0xbd, 0xbc, 0x46};
  uint8_t byteswillprops2[] = {0xc4, 0x5a, 0xaf, 0x3a, 0xfc, 0xc1, 0x4a, 0x64, 0x5e, 0x5d};
  uint8_t byteswillprops3[] = {0xa, 0x17, 0xb9, 0x7a};
  uint8_t byteswillprops4[] = {0x90, 0x16, 0xb6, 0x1b, 0x60, 0xba, 0x17, 0xe,  0x89,
                               0x41, 0xe,  0x39, 0x49, 0x78, 0xe,  0xa4, 0x79, 0x47};
  uint8_t byteswillprops5[] = {0x46, 0x2a, 0x4f, 0xe8, 0x93, 0x48, 0x54, 0x73, 0x8,  0x92,
                               0x3f, 0x92, 0x4,  0x2d, 0xd8, 0x15, 0xf9, 0xb0, 0xc4, 0xaa,
                               0x86, 0x73, 0xf8, 0x34, 0x88, 0xe1, 0xf9, 0xe2, 0x32, 0x86};
  uint8_t byteswillprops6[] = {0x5a, 0x8f, 0x23, 0xbd, 0xd5, 0x56, 0xae, 0x4a, 0xb,  0x6e,
                               0x1a, 0xe4, 0xba, 0xe6, 0x4e, 0x95, 0x41, 0xa5, 0x9c, 0x33};
  uint8_t byteswillprops7[] = {0xa1, 0x54, 0xce, 0xa6, 0x25, 0x7e, 0x2b, 0x42, 0x89, 0x42, 0x16, 0x36, 0x6, 0xea};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26338}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 482}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26497}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31822}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 52}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1043}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13915}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19003}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xff, 0xf5, 0x56, 0xc2, 0x94, 0xd1, 0x1d, 0xc,  0xda, 0x8c, 0xc9, 0x19, 0x2f,
                                0x3b, 0x48, 0x92, 0x87, 0xb0, 0xfd, 0x7d, 0xb8, 0xcf, 0x56, 0x37, 0x2e};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1,  0x31, 0x31, 0x9,  0xee, 0xd9, 0x3f, 0xd2, 0x5c, 0x4, 0xdf, 0x6b, 0xc0, 0xfa,
                                  0x3f, 0x9c, 0xb2, 0x3c, 0xec, 0x2b, 0xf,  0x51, 0xd1, 0x6, 0xb1, 0xcc, 0xa3};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29642;
  uint8_t client_id_bytes[] = {0xd4, 0x65, 0x52};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x65, 0x62, 0x3a, 0x9f, 0xa9, 0x66, 0x41, 0x7e, 0x85, 0x5c,
                              0xd,  0x36, 0x41, 0x37, 0x8b, 0x32, 0xae, 0xe5, 0x55, 0x65};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\197\244\208\172eI\158\208\&4\a\235\DC4\182d\132\GS\189\130O\128\228\192 ", _willMsg =
// "\162T\168%T\161[\138\\\156~t\191\154\206\ETX", _willProps = [PropSharedSubscriptionAvailable
// 43,PropAssignedClientIdentifier
// "\151_\230h\aq}\US\DC1\150\190&\233\165y<\233\227\149\235\\!\DC1\186\254\208~\210",PropAuthenticationMethod
// "\128\\\158v\216}\183)\RS?\227\216\178D\ETB\US\246\153\a^za\202\152@",PropTopicAliasMaximum 14418,PropCorrelationData
// "[\188\234?\ETX\\",PropReceiveMaximum 29737,PropAuthenticationMethod
// "\207\157\198U\DC23\FS\137D\168\194\178\197,V\DC3\222Y\219\251\133.\SYN",PropPayloadFormatIndicator
// 164,PropTopicAlias 845,PropReceiveMaximum 23247,PropServerKeepAlive 6641,PropServerReference
// "\223\144\143=",PropServerKeepAlive 8003,PropAuthenticationMethod "\DC4\255\223i\148",PropWillDelayInterval
// 19857,PropContentType "\GS\v*,\184P\242-",PropUserProperty "\139[" "",PropMessageExpiryInterval 4340]}),
// _cleanSession = False, _keepAlive = 5339, _connID = "\194\163\154\203\EOTLMG`#\161l", _properties = [PropReasonString
// "\FS\203\156\EM\157nb\215\ETB\220\178\218\167\DC2\237\DC2\183\\b\CANR+g ",PropServerReference
// "\171\155\234\219?T\NUL\149o\192\234",PropAssignedClientIdentifier
// "i\210\&6\233\216\228\NAKf|\197\245",PropResponseInformation
// "'\185\237C\232g\163\183}\155'\198*%\204r\131",PropSubscriptionIdentifier 20,PropWildcardSubscriptionAvailable
// 62,PropResponseTopic "\225VS\179\DEL\"f\181O\149\164=\SOH\145",PropTopicAlias 28388,PropRequestResponseInformation
// 169,PropReceiveMaximum 20392,PropRequestProblemInformation 88,PropMessageExpiryInterval
// 9798,PropRequestProblemInformation 72,PropRetainAvailable 245,PropAuthenticationMethod "
// \136\205\&2\249\147\234\SOH(\185\183\SO\174\214V\132",PropUserProperty "\217\182dn\209j~\215\FS\211\203\205\192"
// "\DC1j\245x\NAK\176\206\188\192\251\149;\180}\DC3\195\NAK",PropTopicAliasMaximum 14104,PropTopicAliasMaximum
// 3973,PropReceiveMaximum 14160,PropWildcardSubscriptionAvailable 78,PropSubscriptionIdentifierAvailable
// 175,PropSessionExpiryInterval 31059,PropReceiveMaximum 29504,PropSessionExpiryInterval
// 27510,PropAssignedClientIdentifier ".\251M+0\162\fT\227\&8\"\141E&\186\t",PropResponseTopic
// "\158\DC2\160$\SUB\244\214"]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xc6, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x24, 0x14, 0xdb, 0xe0, 0x1,  0x1f, 0x0,  0x18, 0x1c,
      0xcb, 0x9c, 0x19, 0x9d, 0x6e, 0x62, 0xd7, 0x17, 0xdc, 0xb2, 0xda, 0xa7, 0x12, 0xed, 0x12, 0xb7, 0x5c, 0x62, 0x18,
      0x52, 0x2b, 0x67, 0x20, 0x1c, 0x0,  0xb,  0xab, 0x9b, 0xea, 0xdb, 0x3f, 0x54, 0x0,  0x95, 0x6f, 0xc0, 0xea, 0x12,
      0x0,  0xb,  0x69, 0xd2, 0x36, 0xe9, 0xd8, 0xe4, 0x15, 0x66, 0x7c, 0xc5, 0xf5, 0x1a, 0x0,  0x11, 0x27, 0xb9, 0xed,
      0x43, 0xe8, 0x67, 0xa3, 0xb7, 0x7d, 0x9b, 0x27, 0xc6, 0x2a, 0x25, 0xcc, 0x72, 0x83, 0xb,  0x14, 0x28, 0x3e, 0x8,
      0x0,  0xe,  0xe1, 0x56, 0x53, 0xb3, 0x7f, 0x22, 0x66, 0xb5, 0x4f, 0x95, 0xa4, 0x3d, 0x1,  0x91, 0x23, 0x6e, 0xe4,
      0x19, 0xa9, 0x21, 0x4f, 0xa8, 0x17, 0x58, 0x2,  0x0,  0x0,  0x26, 0x46, 0x17, 0x48, 0x25, 0xf5, 0x15, 0x0,  0x10,
      0x20, 0x88, 0xcd, 0x32, 0xf9, 0x93, 0xea, 0x1,  0x28, 0xb9, 0xb7, 0xe,  0xae, 0xd6, 0x56, 0x84, 0x26, 0x0,  0xd,
      0xd9, 0xb6, 0x64, 0x6e, 0xd1, 0x6a, 0x7e, 0xd7, 0x1c, 0xd3, 0xcb, 0xcd, 0xc0, 0x0,  0x11, 0x11, 0x6a, 0xf5, 0x78,
      0x15, 0xb0, 0xce, 0xbc, 0xc0, 0xfb, 0x95, 0x3b, 0xb4, 0x7d, 0x13, 0xc3, 0x15, 0x22, 0x37, 0x18, 0x22, 0xf,  0x85,
      0x21, 0x37, 0x50, 0x28, 0x4e, 0x29, 0xaf, 0x11, 0x0,  0x0,  0x79, 0x53, 0x21, 0x73, 0x40, 0x11, 0x0,  0x0,  0x6b,
      0x76, 0x12, 0x0,  0x10, 0x2e, 0xfb, 0x4d, 0x2b, 0x30, 0xa2, 0xc,  0x54, 0xe3, 0x38, 0x22, 0x8d, 0x45, 0x26, 0xba,
      0x9,  0x8,  0x0,  0x7,  0x9e, 0x12, 0xa0, 0x24, 0x1a, 0xf4, 0xd6, 0x0,  0xc,  0xc2, 0xa3, 0x9a, 0xcb, 0x4,  0x4c,
      0x4d, 0x47, 0x60, 0x23, 0xa1, 0x6c, 0x9f, 0x1,  0x2a, 0x2b, 0x12, 0x0,  0x1c, 0x97, 0x5f, 0xe6, 0x68, 0x7,  0x71,
      0x7d, 0x1f, 0x11, 0x96, 0xbe, 0x26, 0xe9, 0xa5, 0x79, 0x3c, 0xe9, 0xe3, 0x95, 0xeb, 0x5c, 0x21, 0x11, 0xba, 0xfe,
      0xd0, 0x7e, 0xd2, 0x15, 0x0,  0x19, 0x80, 0x5c, 0x9e, 0x76, 0xd8, 0x7d, 0xb7, 0x29, 0x1e, 0x3f, 0xe3, 0xd8, 0xb2,
      0x44, 0x17, 0x1f, 0xf6, 0x99, 0x7,  0x5e, 0x7a, 0x61, 0xca, 0x98, 0x40, 0x22, 0x38, 0x52, 0x9,  0x0,  0x6,  0x5b,
      0xbc, 0xea, 0x3f, 0x3,  0x5c, 0x21, 0x74, 0x29, 0x15, 0x0,  0x17, 0xcf, 0x9d, 0xc6, 0x55, 0x12, 0x33, 0x1c, 0x89,
      0x44, 0xa8, 0xc2, 0xb2, 0xc5, 0x2c, 0x56, 0x13, 0xde, 0x59, 0xdb, 0xfb, 0x85, 0x2e, 0x16, 0x1,  0xa4, 0x23, 0x3,
      0x4d, 0x21, 0x5a, 0xcf, 0x13, 0x19, 0xf1, 0x1c, 0x0,  0x4,  0xdf, 0x90, 0x8f, 0x3d, 0x13, 0x1f, 0x43, 0x15, 0x0,
      0x5,  0x14, 0xff, 0xdf, 0x69, 0x94, 0x18, 0x0,  0x0,  0x4d, 0x91, 0x3,  0x0,  0x8,  0x1d, 0xb,  0x2a, 0x2c, 0xb8,
      0x50, 0xf2, 0x2d, 0x26, 0x0,  0x2,  0x8b, 0x5b, 0x0,  0x0,  0x2,  0x0,  0x0,  0x10, 0xf4, 0x0,  0x17, 0xc5, 0xf4,
      0xd0, 0xac, 0x65, 0x49, 0x9e, 0xd0, 0x34, 0x7,  0xeb, 0x14, 0xb6, 0x64, 0x84, 0x1d, 0xbd, 0x82, 0x4f, 0x80, 0xe4,
      0xc0, 0x20, 0x0,  0x10, 0xa2, 0x54, 0xa8, 0x25, 0x54, 0xa1, 0x5b, 0x8a, 0x5c, 0x9c, 0x7e, 0x74, 0xbf, 0x9a, 0xce,
      0x3};

  uint8_t buf[467] = {0};

  uint8_t bytesprops0[] = {0x1c, 0xcb, 0x9c, 0x19, 0x9d, 0x6e, 0x62, 0xd7, 0x17, 0xdc, 0xb2, 0xda,
                           0xa7, 0x12, 0xed, 0x12, 0xb7, 0x5c, 0x62, 0x18, 0x52, 0x2b, 0x67, 0x20};
  uint8_t bytesprops1[] = {0xab, 0x9b, 0xea, 0xdb, 0x3f, 0x54, 0x0, 0x95, 0x6f, 0xc0, 0xea};
  uint8_t bytesprops2[] = {0x69, 0xd2, 0x36, 0xe9, 0xd8, 0xe4, 0x15, 0x66, 0x7c, 0xc5, 0xf5};
  uint8_t bytesprops3[] = {0x27, 0xb9, 0xed, 0x43, 0xe8, 0x67, 0xa3, 0xb7, 0x7d,
                           0x9b, 0x27, 0xc6, 0x2a, 0x25, 0xcc, 0x72, 0x83};
  uint8_t bytesprops4[] = {0xe1, 0x56, 0x53, 0xb3, 0x7f, 0x22, 0x66, 0xb5, 0x4f, 0x95, 0xa4, 0x3d, 0x1, 0x91};
  uint8_t bytesprops5[] = {0x20, 0x88, 0xcd, 0x32, 0xf9, 0x93, 0xea, 0x1,
                           0x28, 0xb9, 0xb7, 0xe,  0xae, 0xd6, 0x56, 0x84};
  uint8_t bytesprops7[] = {0x11, 0x6a, 0xf5, 0x78, 0x15, 0xb0, 0xce, 0xbc, 0xc0,
                           0xfb, 0x95, 0x3b, 0xb4, 0x7d, 0x13, 0xc3, 0x15};
  uint8_t bytesprops6[] = {0xd9, 0xb6, 0x64, 0x6e, 0xd1, 0x6a, 0x7e, 0xd7, 0x1c, 0xd3, 0xcb, 0xcd, 0xc0};
  uint8_t bytesprops8[] = {0x2e, 0xfb, 0x4d, 0x2b, 0x30, 0xa2, 0xc,  0x54,
                           0xe3, 0x38, 0x22, 0x8d, 0x45, 0x26, 0xba, 0x9};
  uint8_t bytesprops9[] = {0x9e, 0x12, 0xa0, 0x24, 0x1a, 0xf4, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28388}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20392}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9798}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops6}, .v = {17, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14104}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3973}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14160}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31059}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29504}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27510}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x97, 0x5f, 0xe6, 0x68, 0x7,  0x71, 0x7d, 0x1f, 0x11, 0x96, 0xbe, 0x26, 0xe9, 0xa5,
                               0x79, 0x3c, 0xe9, 0xe3, 0x95, 0xeb, 0x5c, 0x21, 0x11, 0xba, 0xfe, 0xd0, 0x7e, 0xd2};
  uint8_t byteswillprops1[] = {0x80, 0x5c, 0x9e, 0x76, 0xd8, 0x7d, 0xb7, 0x29, 0x1e, 0x3f, 0xe3, 0xd8, 0xb2,
                               0x44, 0x17, 0x1f, 0xf6, 0x99, 0x7,  0x5e, 0x7a, 0x61, 0xca, 0x98, 0x40};
  uint8_t byteswillprops2[] = {0x5b, 0xbc, 0xea, 0x3f, 0x3, 0x5c};
  uint8_t byteswillprops3[] = {0xcf, 0x9d, 0xc6, 0x55, 0x12, 0x33, 0x1c, 0x89, 0x44, 0xa8, 0xc2, 0xb2,
                               0xc5, 0x2c, 0x56, 0x13, 0xde, 0x59, 0xdb, 0xfb, 0x85, 0x2e, 0x16};
  uint8_t byteswillprops4[] = {0xdf, 0x90, 0x8f, 0x3d};
  uint8_t byteswillprops5[] = {0x14, 0xff, 0xdf, 0x69, 0x94};
  uint8_t byteswillprops6[] = {0x1d, 0xb, 0x2a, 0x2c, 0xb8, 0x50, 0xf2, 0x2d};
  uint8_t byteswillprops8[] = {0};
  uint8_t byteswillprops7[] = {0x8b, 0x5b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14418}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29737}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 845}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23247}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6641}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8003}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19857}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops7}, .v = {0, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4340}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc5, 0xf4, 0xd0, 0xac, 0x65, 0x49, 0x9e, 0xd0, 0x34, 0x7,  0xeb, 0x14,
                                0xb6, 0x64, 0x84, 0x1d, 0xbd, 0x82, 0x4f, 0x80, 0xe4, 0xc0, 0x20};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa2, 0x54, 0xa8, 0x25, 0x54, 0xa1, 0x5b, 0x8a,
                                  0x5c, 0x9c, 0x7e, 0x74, 0xbf, 0x9a, 0xce, 0x3};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 5339;
  uint8_t client_id_bytes[] = {0xc2, 0xa3, 0x9a, 0xcb, 0x4, 0x4c, 0x4d, 0x47, 0x60, 0x23, 0xa1, 0x6c};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\185\GSc\246\205\210\\\233\183w\EOT\252|-\224", _password = Nothing, _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\154\135@Q", _willMsg =
// "=\135\DEL\152\&4.\238\216\245h\157\130\aq\223\150:WI\169k\RS\149", _willProps = [PropTopicAlias
// 766,PropMaximumPacketSize 7651,PropSubscriptionIdentifierAvailable 2,PropReasonString
// "{\149\\\157P\181\&1<\n\145\166\249\142 \191\209\241\182Y\138r\204L5"]}), _cleanSession = False, _keepAlive = 23142,
// _connID = "J\242", _properties = [PropServerReference
// "\184\193\167\129\163u\196>\231\155Pzu8\SI\189\\JU\198\239,=\239P\222\DLE",PropAuthenticationMethod
// "",PropRequestResponseInformation 98,PropContentType
// "9d?:bS\182\t\n\220\152\254\RS\189v\252\189\199\210\196C\183\138\STX",PropRequestResponseInformation
// 232,PropSubscriptionIdentifier 12,PropMaximumPacketSize 23762,PropCorrelationData
// "\161\166!\166",PropSubscriptionIdentifier 30,PropRequestProblemInformation 91,PropRetainAvailable
// 79,PropAuthenticationData "_\ESC\156\&4\146/:",PropWildcardSubscriptionAvailable 233,PropTopicAliasMaximum
// 17503,PropSubscriptionIdentifierAvailable 181,PropMessageExpiryInterval 1386,PropPayloadFormatIndicator
// 179,PropServerKeepAlive 31777,PropRequestResponseInformation 171,PropWildcardSubscriptionAvailable
// 29,PropReasonString "\250m\RS\183;\183o\202g(\246\194\\#1\166\186\157\209\147\215\204\USZ\227S\156"]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0xf7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x5a, 0x66, 0x91, 0x1,  0x1c, 0x0,
                   0x1b, 0xb8, 0xc1, 0xa7, 0x81, 0xa3, 0x75, 0xc4, 0x3e, 0xe7, 0x9b, 0x50, 0x7a, 0x75, 0x38, 0xf,  0xbd,
                   0x5c, 0x4a, 0x55, 0xc6, 0xef, 0x2c, 0x3d, 0xef, 0x50, 0xde, 0x10, 0x15, 0x0,  0x0,  0x19, 0x62, 0x3,
                   0x0,  0x18, 0x39, 0x64, 0x3f, 0x3a, 0x62, 0x53, 0xb6, 0x9,  0xa,  0xdc, 0x98, 0xfe, 0x1e, 0xbd, 0x76,
                   0xfc, 0xbd, 0xc7, 0xd2, 0xc4, 0x43, 0xb7, 0x8a, 0x2,  0x19, 0xe8, 0xb,  0xc,  0x27, 0x0,  0x0,  0x5c,
                   0xd2, 0x9,  0x0,  0x4,  0xa1, 0xa6, 0x21, 0xa6, 0xb,  0x1e, 0x17, 0x5b, 0x25, 0x4f, 0x16, 0x0,  0x7,
                   0x5f, 0x1b, 0x9c, 0x34, 0x92, 0x2f, 0x3a, 0x28, 0xe9, 0x22, 0x44, 0x5f, 0x29, 0xb5, 0x2,  0x0,  0x0,
                   0x5,  0x6a, 0x1,  0xb3, 0x13, 0x7c, 0x21, 0x19, 0xab, 0x28, 0x1d, 0x1f, 0x0,  0x1b, 0xfa, 0x6d, 0x1e,
                   0xb7, 0x3b, 0xb7, 0x6f, 0xca, 0x67, 0x28, 0xf6, 0xc2, 0x5c, 0x23, 0x31, 0xa6, 0xba, 0x9d, 0xd1, 0x93,
                   0xd7, 0xcc, 0x1f, 0x5a, 0xe3, 0x53, 0x9c, 0x0,  0x2,  0x4a, 0xf2, 0x25, 0x23, 0x2,  0xfe, 0x27, 0x0,
                   0x0,  0x1d, 0xe3, 0x29, 0x2,  0x1f, 0x0,  0x18, 0x7b, 0x95, 0x5c, 0x9d, 0x50, 0xb5, 0x31, 0x3c, 0xa,
                   0x91, 0xa6, 0xf9, 0x8e, 0x20, 0xbf, 0xd1, 0xf1, 0xb6, 0x59, 0x8a, 0x72, 0xcc, 0x4c, 0x35, 0x0,  0x4,
                   0x9a, 0x87, 0x40, 0x51, 0x0,  0x17, 0x3d, 0x87, 0x7f, 0x98, 0x34, 0x2e, 0xee, 0xd8, 0xf5, 0x68, 0x9d,
                   0x82, 0x7,  0x71, 0xdf, 0x96, 0x3a, 0x57, 0x49, 0xa9, 0x6b, 0x1e, 0x95, 0x0,  0xf,  0xb9, 0x1d, 0x63,
                   0xf6, 0xcd, 0xd2, 0x5c, 0xe9, 0xb7, 0x77, 0x4,  0xfc, 0x7c, 0x2d, 0xe0};

  uint8_t buf[260] = {0};

  uint8_t bytesprops0[] = {0xb8, 0xc1, 0xa7, 0x81, 0xa3, 0x75, 0xc4, 0x3e, 0xe7, 0x9b, 0x50, 0x7a, 0x75, 0x38,
                           0xf,  0xbd, 0x5c, 0x4a, 0x55, 0xc6, 0xef, 0x2c, 0x3d, 0xef, 0x50, 0xde, 0x10};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x39, 0x64, 0x3f, 0x3a, 0x62, 0x53, 0xb6, 0x9,  0xa,  0xdc, 0x98, 0xfe,
                           0x1e, 0xbd, 0x76, 0xfc, 0xbd, 0xc7, 0xd2, 0xc4, 0x43, 0xb7, 0x8a, 0x2};
  uint8_t bytesprops3[] = {0xa1, 0xa6, 0x21, 0xa6};
  uint8_t bytesprops4[] = {0x5f, 0x1b, 0x9c, 0x34, 0x92, 0x2f, 0x3a};
  uint8_t bytesprops5[] = {0xfa, 0x6d, 0x1e, 0xb7, 0x3b, 0xb7, 0x6f, 0xca, 0x67, 0x28, 0xf6, 0xc2, 0x5c, 0x23,
                           0x31, 0xa6, 0xba, 0x9d, 0xd1, 0x93, 0xd7, 0xcc, 0x1f, 0x5a, 0xe3, 0x53, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23762}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17503}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1386}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31777}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7b, 0x95, 0x5c, 0x9d, 0x50, 0xb5, 0x31, 0x3c, 0xa,  0x91, 0xa6, 0xf9,
                               0x8e, 0x20, 0xbf, 0xd1, 0xf1, 0xb6, 0x59, 0x8a, 0x72, 0xcc, 0x4c, 0x35};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 766}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7651}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9a, 0x87, 0x40, 0x51};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3d, 0x87, 0x7f, 0x98, 0x34, 0x2e, 0xee, 0xd8, 0xf5, 0x68, 0x9d, 0x82,
                                  0x7,  0x71, 0xdf, 0x96, 0x3a, 0x57, 0x49, 0xa9, 0x6b, 0x1e, 0x95};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23142;
  uint8_t client_id_bytes[] = {0x4a, 0xf2};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0x1d, 0x63, 0xf6, 0xcd, 0xd2, 0x5c, 0xe9, 0xb7, 0x77, 0x4, 0xfc, 0x7c, 0x2d, 0xe0};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\240\223\219|\165/\216\169G\212Ta\158=\151\215\242\164\220\199\164\236\142\249\194\194\EMU\245\214", _password =
// Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 11621, _connID = "Y", _properties =
// [PropRequestProblemInformation 243,PropSharedSubscriptionAvailable 87,PropTopicAliasMaximum 3301,PropResponseTopic
// "\209\151\221A\147\217+j\220\EM"]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x2d, 0x65, 0x14, 0x17,
                   0xf3, 0x2a, 0x57, 0x22, 0xc,  0xe5, 0x8,  0x0,  0xa,  0xd1, 0x97, 0xdd, 0x41, 0x93,
                   0xd9, 0x2b, 0x6a, 0xdc, 0x19, 0x0,  0x1,  0x59, 0x0,  0x1e, 0xf0, 0xdf, 0xdb, 0x7c,
                   0xa5, 0x2f, 0xd8, 0xa9, 0x47, 0xd4, 0x54, 0x61, 0x9e, 0x3d, 0x97, 0xd7, 0xf2, 0xa4,
                   0xdc, 0xc7, 0xa4, 0xec, 0x8e, 0xf9, 0xc2, 0xc2, 0x19, 0x55, 0xf5, 0xd6};

  uint8_t buf[78] = {0};

  uint8_t bytesprops0[] = {0xd1, 0x97, 0xdd, 0x41, 0x93, 0xd9, 0x2b, 0x6a, 0xdc, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3301}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11621;
  uint8_t client_id_bytes[] = {0x59};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf0, 0xdf, 0xdb, 0x7c, 0xa5, 0x2f, 0xd8, 0xa9, 0x47, 0xd4, 0x54, 0x61, 0x9e, 0x3d, 0x97,
                              0xd7, 0xf2, 0xa4, 0xdc, 0xc7, 0xa4, 0xec, 0x8e, 0xf9, 0xc2, 0xc2, 0x19, 0x55, 0xf5, 0xd6};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "]\218\DC2\160G\231\&5\185\137ZQ", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 32745, _connID = "\248\163cDx\241\168\&8\140/\228\161\192\&3o\168\223",
// _properties = [PropRetainAvailable 32,PropMessageExpiryInterval 31926,PropReceiveMaximum 835,PropResponseTopic
// "F\175=`\156q.\NAK)\232\201\167@\DEL\234",PropAssignedClientIdentifier
// "\133P\247\137J9.6\205\237\134\136\158\182\201\199\220\129\a\SO/\152!\GS",PropUserProperty
// "\214!]X\162\196I\230oq:\201" "\255tEC\CAN\234`\218",PropReceiveMaximum 18678,PropMaximumQoS
// 69,PropPayloadFormatIndicator 124,PropReasonString "\NAK\196-\173\244\231VI\164\f\215\202\147\166`_5fJ
// \230Fr\DC4\220\SUB\159",PropSubscriptionIdentifierAvailable 239,PropReasonString
// "\253\148\186\179\148",PropPayloadFormatIndicator 188,PropUserProperty "W\165jy" "{",PropCorrelationData
// "\128\&3\135\137\254\188\196\203",PropUserProperty "\ESC\b.Z\203\247#-\184/G"
// "\220]\241@z%\230!qy\FS\204J\153\218",PropMessageExpiryInterval 5765,PropReasonString
// "\ENQ7\184\f\153\254d\212",PropReceiveMaximum 10985]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0xe7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x7f, 0xe9, 0xc8, 0x1,  0x25, 0x20,
                   0x2,  0x0,  0x0,  0x7c, 0xb6, 0x21, 0x3,  0x43, 0x8,  0x0,  0xf,  0x46, 0xaf, 0x3d, 0x60, 0x9c, 0x71,
                   0x2e, 0x15, 0x29, 0xe8, 0xc9, 0xa7, 0x40, 0x7f, 0xea, 0x12, 0x0,  0x18, 0x85, 0x50, 0xf7, 0x89, 0x4a,
                   0x39, 0x2e, 0x36, 0xcd, 0xed, 0x86, 0x88, 0x9e, 0xb6, 0xc9, 0xc7, 0xdc, 0x81, 0x7,  0xe,  0x2f, 0x98,
                   0x21, 0x1d, 0x26, 0x0,  0xc,  0xd6, 0x21, 0x5d, 0x58, 0xa2, 0xc4, 0x49, 0xe6, 0x6f, 0x71, 0x3a, 0xc9,
                   0x0,  0x8,  0xff, 0x74, 0x45, 0x43, 0x18, 0xea, 0x60, 0xda, 0x21, 0x48, 0xf6, 0x24, 0x45, 0x1,  0x7c,
                   0x1f, 0x0,  0x1b, 0x15, 0xc4, 0x2d, 0xad, 0xf4, 0xe7, 0x56, 0x49, 0xa4, 0xc,  0xd7, 0xca, 0x93, 0xa6,
                   0x60, 0x5f, 0x35, 0x66, 0x4a, 0x20, 0xe6, 0x46, 0x72, 0x14, 0xdc, 0x1a, 0x9f, 0x29, 0xef, 0x1f, 0x0,
                   0x5,  0xfd, 0x94, 0xba, 0xb3, 0x94, 0x1,  0xbc, 0x26, 0x0,  0x4,  0x57, 0xa5, 0x6a, 0x79, 0x0,  0x1,
                   0x7b, 0x9,  0x0,  0x8,  0x80, 0x33, 0x87, 0x89, 0xfe, 0xbc, 0xc4, 0xcb, 0x26, 0x0,  0xb,  0x1b, 0x8,
                   0x2e, 0x5a, 0xcb, 0xf7, 0x23, 0x2d, 0xb8, 0x2f, 0x47, 0x0,  0xf,  0xdc, 0x5d, 0xf1, 0x40, 0x7a, 0x25,
                   0xe6, 0x21, 0x71, 0x79, 0x1c, 0xcc, 0x4a, 0x99, 0xda, 0x2,  0x0,  0x0,  0x16, 0x85, 0x1f, 0x0,  0x8,
                   0x5,  0x37, 0xb8, 0xc,  0x99, 0xfe, 0x64, 0xd4, 0x21, 0x2a, 0xe9, 0x0,  0x11, 0xf8, 0xa3, 0x63, 0x44,
                   0x78, 0xf1, 0xa8, 0x38, 0x8c, 0x2f, 0xe4, 0xa1, 0xc0, 0x33, 0x6f, 0xa8, 0xdf};

  uint8_t buf[244] = {0};

  uint8_t bytesprops0[] = {0x46, 0xaf, 0x3d, 0x60, 0x9c, 0x71, 0x2e, 0x15, 0x29, 0xe8, 0xc9, 0xa7, 0x40, 0x7f, 0xea};
  uint8_t bytesprops1[] = {0x85, 0x50, 0xf7, 0x89, 0x4a, 0x39, 0x2e, 0x36, 0xcd, 0xed, 0x86, 0x88,
                           0x9e, 0xb6, 0xc9, 0xc7, 0xdc, 0x81, 0x7,  0xe,  0x2f, 0x98, 0x21, 0x1d};
  uint8_t bytesprops3[] = {0xff, 0x74, 0x45, 0x43, 0x18, 0xea, 0x60, 0xda};
  uint8_t bytesprops2[] = {0xd6, 0x21, 0x5d, 0x58, 0xa2, 0xc4, 0x49, 0xe6, 0x6f, 0x71, 0x3a, 0xc9};
  uint8_t bytesprops4[] = {0x15, 0xc4, 0x2d, 0xad, 0xf4, 0xe7, 0x56, 0x49, 0xa4, 0xc,  0xd7, 0xca, 0x93, 0xa6,
                           0x60, 0x5f, 0x35, 0x66, 0x4a, 0x20, 0xe6, 0x46, 0x72, 0x14, 0xdc, 0x1a, 0x9f};
  uint8_t bytesprops5[] = {0xfd, 0x94, 0xba, 0xb3, 0x94};
  uint8_t bytesprops7[] = {0x7b};
  uint8_t bytesprops6[] = {0x57, 0xa5, 0x6a, 0x79};
  uint8_t bytesprops8[] = {0x80, 0x33, 0x87, 0x89, 0xfe, 0xbc, 0xc4, 0xcb};
  uint8_t bytesprops10[] = {0xdc, 0x5d, 0xf1, 0x40, 0x7a, 0x25, 0xe6, 0x21, 0x71, 0x79, 0x1c, 0xcc, 0x4a, 0x99, 0xda};
  uint8_t bytesprops9[] = {0x1b, 0x8, 0x2e, 0x5a, 0xcb, 0xf7, 0x23, 0x2d, 0xb8, 0x2f, 0x47};
  uint8_t bytesprops11[] = {0x5, 0x37, 0xb8, 0xc, 0x99, 0xfe, 0x64, 0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31926}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 835}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops2}, .v = {8, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18678}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops6}, .v = {1, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops9}, .v = {15, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5765}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10985}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32745;
  uint8_t client_id_bytes[] = {0xf8, 0xa3, 0x63, 0x44, 0x78, 0xf1, 0xa8, 0x38, 0x8c,
                               0x2f, 0xe4, 0xa1, 0xc0, 0x33, 0x6f, 0xa8, 0xdf};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5d, 0xda, 0x12, 0xa0, 0x47, 0xe7, 0x35, 0xb9, 0x89, 0x5a, 0x51};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\NUL\136\181", _password = Just
// "d%\139\252\SUB\v\232)\218\ESC\DC3\212F\DC1\238\243j\SO\251\168", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 14321, _connID = "\SOHH\187\196\DEL\173\132\&0wH\SI\210C\131\DC4", _properties = [PropMaximumPacketSize
// 18542,PropSubscriptionIdentifier 6,PropSessionExpiryInterval 28295,PropReasonString
// "\254\161\194\f\176\DLE\252\GS",PropMessageExpiryInterval 16473,PropSubscriptionIdentifierAvailable
// 217,PropServerKeepAlive 3242,PropMessageExpiryInterval 15053,PropTopicAlias 18566,PropReceiveMaximum
// 5338,PropMaximumPacketSize 7337,PropPayloadFormatIndicator 60,PropSharedSubscriptionAvailable
// 252,PropAuthenticationData
// "\193\229\138L`\212\245\245\207Y\151s\130\184\EOTm\178D\254\EOT\150k\219J\164;\153w\156",PropSharedSubscriptionAvailable
// 36,PropWillDelayInterval 23076,PropMessageExpiryInterval 5605,PropMaximumPacketSize 11005]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x9d, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x37, 0xf1, 0x66, 0x27, 0x0,
                   0x0,  0x48, 0x6e, 0xb,  0x6,  0x11, 0x0,  0x0,  0x6e, 0x87, 0x1f, 0x0,  0x8,  0xfe, 0xa1, 0xc2,
                   0xc,  0xb0, 0x10, 0xfc, 0x1d, 0x2,  0x0,  0x0,  0x40, 0x59, 0x29, 0xd9, 0x13, 0xc,  0xaa, 0x2,
                   0x0,  0x0,  0x3a, 0xcd, 0x23, 0x48, 0x86, 0x21, 0x14, 0xda, 0x27, 0x0,  0x0,  0x1c, 0xa9, 0x1,
                   0x3c, 0x2a, 0xfc, 0x16, 0x0,  0x1d, 0xc1, 0xe5, 0x8a, 0x4c, 0x60, 0xd4, 0xf5, 0xf5, 0xcf, 0x59,
                   0x97, 0x73, 0x82, 0xb8, 0x4,  0x6d, 0xb2, 0x44, 0xfe, 0x4,  0x96, 0x6b, 0xdb, 0x4a, 0xa4, 0x3b,
                   0x99, 0x77, 0x9c, 0x2a, 0x24, 0x18, 0x0,  0x0,  0x5a, 0x24, 0x2,  0x0,  0x0,  0x15, 0xe5, 0x27,
                   0x0,  0x0,  0x2a, 0xfd, 0x0,  0xf,  0x1,  0x48, 0xbb, 0xc4, 0x7f, 0xad, 0x84, 0x30, 0x77, 0x48,
                   0xf,  0xd2, 0x43, 0x83, 0x14, 0x0,  0x3,  0x0,  0x88, 0xb5, 0x0,  0x14, 0x64, 0x25, 0x8b, 0xfc,
                   0x1a, 0xb,  0xe8, 0x29, 0xda, 0x1b, 0x13, 0xd4, 0x46, 0x11, 0xee, 0xf3, 0x6a, 0xe,  0xfb, 0xa8};

  uint8_t buf[170] = {0};

  uint8_t bytesprops0[] = {0xfe, 0xa1, 0xc2, 0xc, 0xb0, 0x10, 0xfc, 0x1d};
  uint8_t bytesprops1[] = {0xc1, 0xe5, 0x8a, 0x4c, 0x60, 0xd4, 0xf5, 0xf5, 0xcf, 0x59, 0x97, 0x73, 0x82, 0xb8, 0x4,
                           0x6d, 0xb2, 0x44, 0xfe, 0x4,  0x96, 0x6b, 0xdb, 0x4a, 0xa4, 0x3b, 0x99, 0x77, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18542}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28295}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16473}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3242}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15053}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18566}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5338}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7337}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23076}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5605}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11005}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14321;
  uint8_t client_id_bytes[] = {0x1, 0x48, 0xbb, 0xc4, 0x7f, 0xad, 0x84, 0x30, 0x77, 0x48, 0xf, 0xd2, 0x43, 0x83, 0x14};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x0, 0x88, 0xb5};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0x25, 0x8b, 0xfc, 0x1a, 0xb,  0xe8, 0x29, 0xda, 0x1b,
                              0x13, 0xd4, 0x46, 0x11, 0xee, 0xf3, 0x6a, 0xe,  0xfb, 0xa8};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\142\224!;+'mV", _password = Just
// "{h\173\&5]\vz\\P\196\181X.\"B~\207\241\156]f\195X\DC1\203u\149\151\249", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "S]\n\ETB[\ACK)\233\177\225N\218\162\EM\240p\239O", _willMsg = "\183",
// _willProps = [PropUserProperty "\214\RS\197\&8\179\187^NZ\DC4\196`\202s"
// "\a\172\216\SUB\230\244\162\"\220\186\184mt",PropMessageExpiryInterval 13266]}), _cleanSession = False, _keepAlive =
// 24734, _connID = "gYE\207\225\215\192", _properties = [PropSessionExpiryInterval
// 27757,PropSharedSubscriptionAvailable 215,PropSubscriptionIdentifierAvailable 2,PropWildcardSubscriptionAvailable
// 117,PropAssignedClientIdentifier
// "r\183\186\190\&2`\DC1\236\240\235:\DC2~|a^\162\b\165\224\168'\133G\136C\"",PropServerReference
// "P\148I\166\&6%\170\216n\212 \DLE\DEL>\204B\247\133\211ef/\232\140)",PropResponseTopic
// "\233",PropWildcardSubscriptionAvailable 19,PropWillDelayInterval 3899,PropAuthenticationMethod
// "\"\166\238\NAK\193\SO\213\160\&5~\244g\b]\233.X\230\228P",PropContentType
// "RS\255\241s3",PropWildcardSubscriptionAvailable 86,PropTopicAlias 8716,PropAuthenticationMethod
// "\189u\STXY\136\242\DC4\228\228'\167\199\DC3\218gc\253",PropSessionExpiryInterval 13590,PropRequestProblemInformation
// 199,PropTopicAliasMaximum 19507,PropServerKeepAlive 11841,PropRequestResponseInformation
// 173,PropRequestProblemInformation 35,PropRetainAvailable 16,PropMaximumQoS 13,PropResponseInformation
// "8!\227\DC2=+\169dj\138\150)]\137",PropWildcardSubscriptionAvailable 16,PropMessageExpiryInterval
// 16226,PropRequestResponseInformation 221,PropResponseTopic
// "\b\172\fp\133\221\200\138\242\239\128\"i?q\170\DC4\216\226\189\234\CANYi?\199",PropResponseInformation
// "",PropWildcardSubscriptionAvailable 12]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xd5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x60, 0x9e, 0xda, 0x1,  0x11, 0x0,  0x0,  0x6c,
      0x6d, 0x2a, 0xd7, 0x29, 0x2,  0x28, 0x75, 0x12, 0x0,  0x1b, 0x72, 0xb7, 0xba, 0xbe, 0x32, 0x60, 0x11, 0xec, 0xf0,
      0xeb, 0x3a, 0x12, 0x7e, 0x7c, 0x61, 0x5e, 0xa2, 0x8,  0xa5, 0xe0, 0xa8, 0x27, 0x85, 0x47, 0x88, 0x43, 0x22, 0x1c,
      0x0,  0x19, 0x50, 0x94, 0x49, 0xa6, 0x36, 0x25, 0xaa, 0xd8, 0x6e, 0xd4, 0x20, 0x10, 0x7f, 0x3e, 0xcc, 0x42, 0xf7,
      0x85, 0xd3, 0x65, 0x66, 0x2f, 0xe8, 0x8c, 0x29, 0x8,  0x0,  0x1,  0xe9, 0x28, 0x13, 0x18, 0x0,  0x0,  0xf,  0x3b,
      0x15, 0x0,  0x14, 0x22, 0xa6, 0xee, 0x15, 0xc1, 0xe,  0xd5, 0xa0, 0x35, 0x7e, 0xf4, 0x67, 0x8,  0x5d, 0xe9, 0x2e,
      0x58, 0xe6, 0xe4, 0x50, 0x3,  0x0,  0x6,  0x52, 0x53, 0xff, 0xf1, 0x73, 0x33, 0x28, 0x56, 0x23, 0x22, 0xc,  0x15,
      0x0,  0x11, 0xbd, 0x75, 0x2,  0x59, 0x88, 0xf2, 0x14, 0xe4, 0xe4, 0x27, 0xa7, 0xc7, 0x13, 0xda, 0x67, 0x63, 0xfd,
      0x11, 0x0,  0x0,  0x35, 0x16, 0x17, 0xc7, 0x22, 0x4c, 0x33, 0x13, 0x2e, 0x41, 0x19, 0xad, 0x17, 0x23, 0x25, 0x10,
      0x24, 0xd,  0x1a, 0x0,  0xe,  0x38, 0x21, 0xe3, 0x12, 0x3d, 0x2b, 0xa9, 0x64, 0x6a, 0x8a, 0x96, 0x29, 0x5d, 0x89,
      0x28, 0x10, 0x2,  0x0,  0x0,  0x3f, 0x62, 0x19, 0xdd, 0x8,  0x0,  0x1a, 0x8,  0xac, 0xc,  0x70, 0x85, 0xdd, 0xc8,
      0x8a, 0xf2, 0xef, 0x80, 0x22, 0x69, 0x3f, 0x71, 0xaa, 0x14, 0xd8, 0xe2, 0xbd, 0xea, 0x18, 0x59, 0x69, 0x3f, 0xc7,
      0x1a, 0x0,  0x0,  0x28, 0xc,  0x0,  0x7,  0x67, 0x59, 0x45, 0xcf, 0xe1, 0xd7, 0xc0, 0x25, 0x26, 0x0,  0xe,  0xd6,
      0x1e, 0xc5, 0x38, 0xb3, 0xbb, 0x5e, 0x4e, 0x5a, 0x14, 0xc4, 0x60, 0xca, 0x73, 0x0,  0xd,  0x7,  0xac, 0xd8, 0x1a,
      0xe6, 0xf4, 0xa2, 0x22, 0xdc, 0xba, 0xb8, 0x6d, 0x74, 0x2,  0x0,  0x0,  0x33, 0xd2, 0x0,  0x12, 0x53, 0x5d, 0xa,
      0x17, 0x5b, 0x6,  0x29, 0xe9, 0xb1, 0xe1, 0x4e, 0xda, 0xa2, 0x19, 0xf0, 0x70, 0xef, 0x4f, 0x0,  0x1,  0xb7, 0x0,
      0x8,  0x8e, 0xe0, 0x21, 0x3b, 0x2b, 0x27, 0x6d, 0x56, 0x0,  0x1d, 0x7b, 0x68, 0xad, 0x35, 0x5d, 0xb,  0x7a, 0x5c,
      0x50, 0xc4, 0xb5, 0x58, 0x2e, 0x22, 0x42, 0x7e, 0xcf, 0xf1, 0x9c, 0x5d, 0x66, 0xc3, 0x58, 0x11, 0xcb, 0x75, 0x95,
      0x97, 0xf9};

  uint8_t buf[354] = {0};

  uint8_t bytesprops0[] = {0x72, 0xb7, 0xba, 0xbe, 0x32, 0x60, 0x11, 0xec, 0xf0, 0xeb, 0x3a, 0x12, 0x7e, 0x7c,
                           0x61, 0x5e, 0xa2, 0x8,  0xa5, 0xe0, 0xa8, 0x27, 0x85, 0x47, 0x88, 0x43, 0x22};
  uint8_t bytesprops1[] = {0x50, 0x94, 0x49, 0xa6, 0x36, 0x25, 0xaa, 0xd8, 0x6e, 0xd4, 0x20, 0x10, 0x7f,
                           0x3e, 0xcc, 0x42, 0xf7, 0x85, 0xd3, 0x65, 0x66, 0x2f, 0xe8, 0x8c, 0x29};
  uint8_t bytesprops2[] = {0xe9};
  uint8_t bytesprops3[] = {0x22, 0xa6, 0xee, 0x15, 0xc1, 0xe,  0xd5, 0xa0, 0x35, 0x7e,
                           0xf4, 0x67, 0x8,  0x5d, 0xe9, 0x2e, 0x58, 0xe6, 0xe4, 0x50};
  uint8_t bytesprops4[] = {0x52, 0x53, 0xff, 0xf1, 0x73, 0x33};
  uint8_t bytesprops5[] = {0xbd, 0x75, 0x2,  0x59, 0x88, 0xf2, 0x14, 0xe4, 0xe4,
                           0x27, 0xa7, 0xc7, 0x13, 0xda, 0x67, 0x63, 0xfd};
  uint8_t bytesprops6[] = {0x38, 0x21, 0xe3, 0x12, 0x3d, 0x2b, 0xa9, 0x64, 0x6a, 0x8a, 0x96, 0x29, 0x5d, 0x89};
  uint8_t bytesprops7[] = {0x8,  0xac, 0xc,  0x70, 0x85, 0xdd, 0xc8, 0x8a, 0xf2, 0xef, 0x80, 0x22, 0x69,
                           0x3f, 0x71, 0xaa, 0x14, 0xd8, 0xe2, 0xbd, 0xea, 0x18, 0x59, 0x69, 0x3f, 0xc7};
  uint8_t bytesprops8[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27757}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3899}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8716}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13590}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19507}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11841}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16226}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 12}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x7, 0xac, 0xd8, 0x1a, 0xe6, 0xf4, 0xa2, 0x22, 0xdc, 0xba, 0xb8, 0x6d, 0x74};
  uint8_t byteswillprops0[] = {0xd6, 0x1e, 0xc5, 0x38, 0xb3, 0xbb, 0x5e, 0x4e, 0x5a, 0x14, 0xc4, 0x60, 0xca, 0x73};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops0}, .v = {13, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13266}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x53, 0x5d, 0xa,  0x17, 0x5b, 0x6,  0x29, 0xe9, 0xb1,
                                0xe1, 0x4e, 0xda, 0xa2, 0x19, 0xf0, 0x70, 0xef, 0x4f};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24734;
  uint8_t client_id_bytes[] = {0x67, 0x59, 0x45, 0xcf, 0xe1, 0xd7, 0xc0};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8e, 0xe0, 0x21, 0x3b, 0x2b, 0x27, 0x6d, 0x56};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x7b, 0x68, 0xad, 0x35, 0x5d, 0xb,  0x7a, 0x5c, 0x50, 0xc4, 0xb5, 0x58, 0x2e, 0x22, 0x42,
                              0x7e, 0xcf, 0xf1, 0x9c, 0x5d, 0x66, 0xc3, 0x58, 0x11, 0xcb, 0x75, 0x95, 0x97, 0xf9};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\r7\"\154\EOT", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\\\131\211\214\209\183\242\162", _willMsg = ")&", _willProps =
// [PropAuthenticationMethod "$\252\SUB,\144>",PropSessionExpiryInterval 30269,PropAssignedClientIdentifier
// "S\129\b\221\156\a\132\&2\234\244\246",PropSubscriptionIdentifierAvailable 97,PropServerKeepAlive 5359]}),
// _cleanSession = False, _keepAlive = 17778, _connID = "\160\202\220\&9^\188\ENQ\223w\149\158\233", _properties =
// [PropContentType
// "\157~\235\155\148a\137\217\224\a\133XA\162>\149\131\b\240\249[z\234Qr\184",PropWildcardSubscriptionAvailable
// 175,PropRetainAvailable 178,PropSubscriptionIdentifierAvailable 1,PropAuthenticationMethod
// "\167\222\132q]P\252\198\FS\185\EOT\240\ESC\129\227?\208\191K\217",PropSubscriptionIdentifierAvailable
// 161,PropReceiveMaximum 28268,PropMaximumPacketSize 10703,PropSessionExpiryInterval 6418,PropMessageExpiryInterval
// 30728,PropRequestProblemInformation 91,PropTopicAliasMaximum 27090,PropSubscriptionIdentifier
// 30,PropSubscriptionIdentifier 27,PropSessionExpiryInterval 20709,PropContentType
// "$\251|\ENQ.IC\148\139\228]8[\190E\183zm|\155Cz",PropRetainAvailable 235,PropResponseTopic
// "@\181\230\n\167P\194\163S\DEL\244\181'\227",PropReceiveMaximum 6854,PropMaximumPacketSize 2644,PropCorrelationData
// "\191\188L\252\216q\190\182\182\132j\194\USx\f\143\FS\241\161\SI\STX\GS[",PropMaximumPacketSize
// 20784,PropMessageExpiryInterval 30567,PropReasonString
// "\RSJ\181\235\172\ESC\208\157\f\252\147\&5\181\168p\183\222.\156\164\180\139B~\FS\a\DC4Q",PropServerKeepAlive
// 31825,PropMaximumPacketSize 21098]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xac, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8c, 0x45, 0x72, 0xdb, 0x1,  0x3,  0x0,  0x1a, 0x9d,
      0x7e, 0xeb, 0x9b, 0x94, 0x61, 0x89, 0xd9, 0xe0, 0x7,  0x85, 0x58, 0x41, 0xa2, 0x3e, 0x95, 0x83, 0x8,  0xf0, 0xf9,
      0x5b, 0x7a, 0xea, 0x51, 0x72, 0xb8, 0x28, 0xaf, 0x25, 0xb2, 0x29, 0x1,  0x15, 0x0,  0x14, 0xa7, 0xde, 0x84, 0x71,
      0x5d, 0x50, 0xfc, 0xc6, 0x1c, 0xb9, 0x4,  0xf0, 0x1b, 0x81, 0xe3, 0x3f, 0xd0, 0xbf, 0x4b, 0xd9, 0x29, 0xa1, 0x21,
      0x6e, 0x6c, 0x27, 0x0,  0x0,  0x29, 0xcf, 0x11, 0x0,  0x0,  0x19, 0x12, 0x2,  0x0,  0x0,  0x78, 0x8,  0x17, 0x5b,
      0x22, 0x69, 0xd2, 0xb,  0x1e, 0xb,  0x1b, 0x11, 0x0,  0x0,  0x50, 0xe5, 0x3,  0x0,  0x16, 0x24, 0xfb, 0x7c, 0x5,
      0x2e, 0x49, 0x43, 0x94, 0x8b, 0xe4, 0x5d, 0x38, 0x5b, 0xbe, 0x45, 0xb7, 0x7a, 0x6d, 0x7c, 0x9b, 0x43, 0x7a, 0x25,
      0xeb, 0x8,  0x0,  0xe,  0x40, 0xb5, 0xe6, 0xa,  0xa7, 0x50, 0xc2, 0xa3, 0x53, 0x7f, 0xf4, 0xb5, 0x27, 0xe3, 0x21,
      0x1a, 0xc6, 0x27, 0x0,  0x0,  0xa,  0x54, 0x9,  0x0,  0x17, 0xbf, 0xbc, 0x4c, 0xfc, 0xd8, 0x71, 0xbe, 0xb6, 0xb6,
      0x84, 0x6a, 0xc2, 0x1f, 0x78, 0xc,  0x8f, 0x1c, 0xf1, 0xa1, 0xf,  0x2,  0x1d, 0x5b, 0x27, 0x0,  0x0,  0x51, 0x30,
      0x2,  0x0,  0x0,  0x77, 0x67, 0x1f, 0x0,  0x1c, 0x1e, 0x4a, 0xb5, 0xeb, 0xac, 0x1b, 0xd0, 0x9d, 0xc,  0xfc, 0x93,
      0x35, 0xb5, 0xa8, 0x70, 0xb7, 0xde, 0x2e, 0x9c, 0xa4, 0xb4, 0x8b, 0x42, 0x7e, 0x1c, 0x7,  0x14, 0x51, 0x13, 0x7c,
      0x51, 0x27, 0x0,  0x0,  0x52, 0x6a, 0x0,  0xc,  0xa0, 0xca, 0xdc, 0x39, 0x5e, 0xbc, 0x5,  0xdf, 0x77, 0x95, 0x9e,
      0xe9, 0x21, 0x15, 0x0,  0x6,  0x24, 0xfc, 0x1a, 0x2c, 0x90, 0x3e, 0x11, 0x0,  0x0,  0x76, 0x3d, 0x12, 0x0,  0xb,
      0x53, 0x81, 0x8,  0xdd, 0x9c, 0x7,  0x84, 0x32, 0xea, 0xf4, 0xf6, 0x29, 0x61, 0x13, 0x14, 0xef, 0x0,  0x8,  0x5c,
      0x83, 0xd3, 0xd6, 0xd1, 0xb7, 0xf2, 0xa2, 0x0,  0x2,  0x29, 0x26, 0x0,  0x5,  0xd,  0x37, 0x22, 0x9a, 0x4};

  uint8_t buf[313] = {0};

  uint8_t bytesprops0[] = {0x9d, 0x7e, 0xeb, 0x9b, 0x94, 0x61, 0x89, 0xd9, 0xe0, 0x7,  0x85, 0x58, 0x41,
                           0xa2, 0x3e, 0x95, 0x83, 0x8,  0xf0, 0xf9, 0x5b, 0x7a, 0xea, 0x51, 0x72, 0xb8};
  uint8_t bytesprops1[] = {0xa7, 0xde, 0x84, 0x71, 0x5d, 0x50, 0xfc, 0xc6, 0x1c, 0xb9,
                           0x4,  0xf0, 0x1b, 0x81, 0xe3, 0x3f, 0xd0, 0xbf, 0x4b, 0xd9};
  uint8_t bytesprops2[] = {0x24, 0xfb, 0x7c, 0x5,  0x2e, 0x49, 0x43, 0x94, 0x8b, 0xe4, 0x5d,
                           0x38, 0x5b, 0xbe, 0x45, 0xb7, 0x7a, 0x6d, 0x7c, 0x9b, 0x43, 0x7a};
  uint8_t bytesprops3[] = {0x40, 0xb5, 0xe6, 0xa, 0xa7, 0x50, 0xc2, 0xa3, 0x53, 0x7f, 0xf4, 0xb5, 0x27, 0xe3};
  uint8_t bytesprops4[] = {0xbf, 0xbc, 0x4c, 0xfc, 0xd8, 0x71, 0xbe, 0xb6, 0xb6, 0x84, 0x6a, 0xc2,
                           0x1f, 0x78, 0xc,  0x8f, 0x1c, 0xf1, 0xa1, 0xf,  0x2,  0x1d, 0x5b};
  uint8_t bytesprops5[] = {0x1e, 0x4a, 0xb5, 0xeb, 0xac, 0x1b, 0xd0, 0x9d, 0xc,  0xfc, 0x93, 0x35, 0xb5, 0xa8,
                           0x70, 0xb7, 0xde, 0x2e, 0x9c, 0xa4, 0xb4, 0x8b, 0x42, 0x7e, 0x1c, 0x7,  0x14, 0x51};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28268}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10703}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6418}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30728}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27090}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20709}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6854}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2644}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20784}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30567}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31825}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21098}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x24, 0xfc, 0x1a, 0x2c, 0x90, 0x3e};
  uint8_t byteswillprops1[] = {0x53, 0x81, 0x8, 0xdd, 0x9c, 0x7, 0x84, 0x32, 0xea, 0xf4, 0xf6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30269}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5359}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0x83, 0xd3, 0xd6, 0xd1, 0xb7, 0xf2, 0xa2};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x29, 0x26};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17778;
  uint8_t client_id_bytes[] = {0xa0, 0xca, 0xdc, 0x39, 0x5e, 0xbc, 0x5, 0xdf, 0x77, 0x95, 0x9e, 0xe9};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd, 0x37, 0x22, 0x9a, 0x4};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\181\bX\195\NULZ\169\250\173\230E\239g\209\226\145:pJ ^\SO\192\SYN,V\138\226",
// _password = Just "b\129\SOH\222>\130\229h\251\208QM\146\255\&3 \190\166T<A1\147!\174@\205e\165\140", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\217\DLE\EM\DEL\205\167\138", _willMsg =
// "V\249Z)\b\177\215\ESCv\149\f8\250I.\156~R\166P\227\146\t\n\"\217\201\DC2", _willProps = [PropAuthenticationMethod
// "\131\&4u(\223\223\131\189\153Pcg&\230\177\DEL\228+",PropMessageExpiryInterval 3265,PropResponseTopic
// "\192\173\130\142\231",PropAssignedClientIdentifier "z\241n",PropCorrelationData "x",PropSharedSubscriptionAvailable
// 15,PropRetainAvailable 12,PropMessageExpiryInterval 9912,PropTopicAliasMaximum 27153,PropPayloadFormatIndicator
// 26,PropMessageExpiryInterval 27414,PropTopicAliasMaximum 14235,PropRetainAvailable 192,PropRequestResponseInformation
// 232,PropAuthenticationMethod "$&E6C\188(\229*\145r\198m",PropUserProperty "\216+\131T\222\222%\205\176F"
// "\180\209\243\171\217\199",PropWildcardSubscriptionAvailable 1,PropRequestResponseInformation
// 95,PropAuthenticationMethod "z\193\158 *\162OR$9\229f\SI\ETXW\ESC",PropReceiveMaximum
// 29953,PropSharedSubscriptionAvailable 4,PropMessageExpiryInterval 24989]}), _cleanSession = True, _keepAlive = 28502,
// _connID = "WL\207o\234\255\227", _properties = [PropRequestResponseInformation 104,PropUserProperty
// "\179U\233\229y\162~\DC3C\DC4k0\NULP\175\207\129\232l\251\FS\STX\234\NUL\166}\244\&8\196"
// "\172\158\211\227\180\228\183\NULY\200\132\145\219\175\147!\230b\233\&4\218\157",PropSessionExpiryInterval
// 26318,PropSessionExpiryInterval 9785,PropAssignedClientIdentifier "\168\141\220\199\240V",PropReasonString
// "X#$\170A\SOH\159\238\ESC?\194!\171\DC3\186C\174\146\183\t",PropSubscriptionIdentifierAvailable
// 160,PropMessageExpiryInterval 741,PropPayloadFormatIndicator 100,PropWillDelayInterval
// 27296,PropMessageExpiryInterval 30800,PropMaximumQoS 155,PropWillDelayInterval 6761,PropMessageExpiryInterval
// 6945,PropReceiveMaximum 16770,PropMaximumPacketSize 9580,PropAuthenticationData
// "uA\253\\\227\214\146",PropAuthenticationMethod "\179\US\137\236U\236<Tz\143J#\SI\231",PropUserProperty
// "$\155\197n\149\EOTv\132\129\SO\226\207\&9T[\vg\153,[\RS\f\132" "`\170\EM*K\156
// \157V",PropSubscriptionIdentifierAvailable 9,PropRequestResponseInformation 171]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xd7, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x6f, 0x56, 0xcf, 0x1,  0x19, 0x68, 0x26, 0x0,
      0x1d, 0xb3, 0x55, 0xe9, 0xe5, 0x79, 0xa2, 0x7e, 0x13, 0x43, 0x14, 0x6b, 0x30, 0x0,  0x50, 0xaf, 0xcf, 0x81, 0xe8,
      0x6c, 0xfb, 0x1c, 0x2,  0xea, 0x0,  0xa6, 0x7d, 0xf4, 0x38, 0xc4, 0x0,  0x16, 0xac, 0x9e, 0xd3, 0xe3, 0xb4, 0xe4,
      0xb7, 0x0,  0x59, 0xc8, 0x84, 0x91, 0xdb, 0xaf, 0x93, 0x21, 0xe6, 0x62, 0xe9, 0x34, 0xda, 0x9d, 0x11, 0x0,  0x0,
      0x66, 0xce, 0x11, 0x0,  0x0,  0x26, 0x39, 0x12, 0x0,  0x6,  0xa8, 0x8d, 0xdc, 0xc7, 0xf0, 0x56, 0x1f, 0x0,  0x14,
      0x58, 0x23, 0x24, 0xaa, 0x41, 0x1,  0x9f, 0xee, 0x1b, 0x3f, 0xc2, 0x21, 0xab, 0x13, 0xba, 0x43, 0xae, 0x92, 0xb7,
      0x9,  0x29, 0xa0, 0x2,  0x0,  0x0,  0x2,  0xe5, 0x1,  0x64, 0x18, 0x0,  0x0,  0x6a, 0xa0, 0x2,  0x0,  0x0,  0x78,
      0x50, 0x24, 0x9b, 0x18, 0x0,  0x0,  0x1a, 0x69, 0x2,  0x0,  0x0,  0x1b, 0x21, 0x21, 0x41, 0x82, 0x27, 0x0,  0x0,
      0x25, 0x6c, 0x16, 0x0,  0x7,  0x75, 0x41, 0xfd, 0x5c, 0xe3, 0xd6, 0x92, 0x15, 0x0,  0xe,  0xb3, 0x1f, 0x89, 0xec,
      0x55, 0xec, 0x3c, 0x54, 0x7a, 0x8f, 0x4a, 0x23, 0xf,  0xe7, 0x26, 0x0,  0x17, 0x24, 0x9b, 0xc5, 0x6e, 0x95, 0x4,
      0x76, 0x84, 0x81, 0xe,  0xe2, 0xcf, 0x39, 0x54, 0x5b, 0xb,  0x67, 0x99, 0x2c, 0x5b, 0x1e, 0xc,  0x84, 0x0,  0x9,
      0x60, 0xaa, 0x19, 0x2a, 0x4b, 0x9c, 0x20, 0x9d, 0x56, 0x29, 0x9,  0x19, 0xab, 0x0,  0x7,  0x57, 0x4c, 0xcf, 0x6f,
      0xea, 0xff, 0xe3, 0x8c, 0x1,  0x15, 0x0,  0x12, 0x83, 0x34, 0x75, 0x28, 0xdf, 0xdf, 0x83, 0xbd, 0x99, 0x50, 0x63,
      0x67, 0x26, 0xe6, 0xb1, 0x7f, 0xe4, 0x2b, 0x2,  0x0,  0x0,  0xc,  0xc1, 0x8,  0x0,  0x5,  0xc0, 0xad, 0x82, 0x8e,
      0xe7, 0x12, 0x0,  0x3,  0x7a, 0xf1, 0x6e, 0x9,  0x0,  0x1,  0x78, 0x2a, 0xf,  0x25, 0xc,  0x2,  0x0,  0x0,  0x26,
      0xb8, 0x22, 0x6a, 0x11, 0x1,  0x1a, 0x2,  0x0,  0x0,  0x6b, 0x16, 0x22, 0x37, 0x9b, 0x25, 0xc0, 0x19, 0xe8, 0x15,
      0x0,  0xd,  0x24, 0x26, 0x45, 0x36, 0x43, 0xbc, 0x28, 0xe5, 0x2a, 0x91, 0x72, 0xc6, 0x6d, 0x26, 0x0,  0xa,  0xd8,
      0x2b, 0x83, 0x54, 0xde, 0xde, 0x25, 0xcd, 0xb0, 0x46, 0x0,  0x6,  0xb4, 0xd1, 0xf3, 0xab, 0xd9, 0xc7, 0x28, 0x1,
      0x19, 0x5f, 0x15, 0x0,  0x10, 0x7a, 0xc1, 0x9e, 0x20, 0x2a, 0xa2, 0x4f, 0x52, 0x24, 0x39, 0xe5, 0x66, 0xf,  0x3,
      0x57, 0x1b, 0x21, 0x75, 0x1,  0x2a, 0x4,  0x2,  0x0,  0x0,  0x61, 0x9d, 0x0,  0x7,  0xd9, 0x10, 0x19, 0x7f, 0xcd,
      0xa7, 0x8a, 0x0,  0x1c, 0x56, 0xf9, 0x5a, 0x29, 0x8,  0xb1, 0xd7, 0x1b, 0x76, 0x95, 0xc,  0x38, 0xfa, 0x49, 0x2e,
      0x9c, 0x7e, 0x52, 0xa6, 0x50, 0xe3, 0x92, 0x9,  0xa,  0x22, 0xd9, 0xc9, 0x12, 0x0,  0x1c, 0xb5, 0x8,  0x58, 0xc3,
      0x0,  0x5a, 0xa9, 0xfa, 0xad, 0xe6, 0x45, 0xef, 0x67, 0xd1, 0xe2, 0x91, 0x3a, 0x70, 0x4a, 0x20, 0x5e, 0xe,  0xc0,
      0x16, 0x2c, 0x56, 0x8a, 0xe2, 0x0,  0x1e, 0x62, 0x81, 0x1,  0xde, 0x3e, 0x82, 0xe5, 0x68, 0xfb, 0xd0, 0x51, 0x4d,
      0x92, 0xff, 0x33, 0x20, 0xbe, 0xa6, 0x54, 0x3c, 0x41, 0x31, 0x93, 0x21, 0xae, 0x40, 0xcd, 0x65, 0xa5, 0x8c};

  uint8_t buf[484] = {0};

  uint8_t bytesprops1[] = {0xac, 0x9e, 0xd3, 0xe3, 0xb4, 0xe4, 0xb7, 0x0,  0x59, 0xc8, 0x84,
                           0x91, 0xdb, 0xaf, 0x93, 0x21, 0xe6, 0x62, 0xe9, 0x34, 0xda, 0x9d};
  uint8_t bytesprops0[] = {0xb3, 0x55, 0xe9, 0xe5, 0x79, 0xa2, 0x7e, 0x13, 0x43, 0x14, 0x6b, 0x30, 0x0,  0x50, 0xaf,
                           0xcf, 0x81, 0xe8, 0x6c, 0xfb, 0x1c, 0x2,  0xea, 0x0,  0xa6, 0x7d, 0xf4, 0x38, 0xc4};
  uint8_t bytesprops2[] = {0xa8, 0x8d, 0xdc, 0xc7, 0xf0, 0x56};
  uint8_t bytesprops3[] = {0x58, 0x23, 0x24, 0xaa, 0x41, 0x1,  0x9f, 0xee, 0x1b, 0x3f,
                           0xc2, 0x21, 0xab, 0x13, 0xba, 0x43, 0xae, 0x92, 0xb7, 0x9};
  uint8_t bytesprops4[] = {0x75, 0x41, 0xfd, 0x5c, 0xe3, 0xd6, 0x92};
  uint8_t bytesprops5[] = {0xb3, 0x1f, 0x89, 0xec, 0x55, 0xec, 0x3c, 0x54, 0x7a, 0x8f, 0x4a, 0x23, 0xf, 0xe7};
  uint8_t bytesprops7[] = {0x60, 0xaa, 0x19, 0x2a, 0x4b, 0x9c, 0x20, 0x9d, 0x56};
  uint8_t bytesprops6[] = {0x24, 0x9b, 0xc5, 0x6e, 0x95, 0x4,  0x76, 0x84, 0x81, 0xe, 0xe2, 0xcf,
                           0x39, 0x54, 0x5b, 0xb,  0x67, 0x99, 0x2c, 0x5b, 0x1e, 0xc, 0x84};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26318}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9785}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 741}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27296}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30800}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6761}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6945}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16770}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9580}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops6}, .v = {9, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x83, 0x34, 0x75, 0x28, 0xdf, 0xdf, 0x83, 0xbd, 0x99,
                               0x50, 0x63, 0x67, 0x26, 0xe6, 0xb1, 0x7f, 0xe4, 0x2b};
  uint8_t byteswillprops1[] = {0xc0, 0xad, 0x82, 0x8e, 0xe7};
  uint8_t byteswillprops2[] = {0x7a, 0xf1, 0x6e};
  uint8_t byteswillprops3[] = {0x78};
  uint8_t byteswillprops4[] = {0x24, 0x26, 0x45, 0x36, 0x43, 0xbc, 0x28, 0xe5, 0x2a, 0x91, 0x72, 0xc6, 0x6d};
  uint8_t byteswillprops6[] = {0xb4, 0xd1, 0xf3, 0xab, 0xd9, 0xc7};
  uint8_t byteswillprops5[] = {0xd8, 0x2b, 0x83, 0x54, 0xde, 0xde, 0x25, 0xcd, 0xb0, 0x46};
  uint8_t byteswillprops7[] = {0x7a, 0xc1, 0x9e, 0x20, 0x2a, 0xa2, 0x4f, 0x52,
                               0x24, 0x39, 0xe5, 0x66, 0xf,  0x3,  0x57, 0x1b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3265}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9912}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27153}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27414}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14235}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&byteswillprops5}, .v = {6, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29953}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24989}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x10, 0x19, 0x7f, 0xcd, 0xa7, 0x8a};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x56, 0xf9, 0x5a, 0x29, 0x8,  0xb1, 0xd7, 0x1b, 0x76, 0x95, 0xc,  0x38, 0xfa, 0x49,
                                  0x2e, 0x9c, 0x7e, 0x52, 0xa6, 0x50, 0xe3, 0x92, 0x9,  0xa,  0x22, 0xd9, 0xc9, 0x12};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28502;
  uint8_t client_id_bytes[] = {0x57, 0x4c, 0xcf, 0x6f, 0xea, 0xff, 0xe3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb5, 0x8,  0x58, 0xc3, 0x0,  0x5a, 0xa9, 0xfa, 0xad, 0xe6, 0x45, 0xef, 0x67, 0xd1,
                              0xe2, 0x91, 0x3a, 0x70, 0x4a, 0x20, 0x5e, 0xe,  0xc0, 0x16, 0x2c, 0x56, 0x8a, 0xe2};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x62, 0x81, 0x1,  0xde, 0x3e, 0x82, 0xe5, 0x68, 0xfb, 0xd0, 0x51, 0x4d, 0x92, 0xff, 0x33,
                              0x20, 0xbe, 0xa6, 0x54, 0x3c, 0x41, 0x31, 0x93, 0x21, 0xae, 0x40, 0xcd, 0x65, 0xa5, 0x8c};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\CAN)\136\200B\171\FS\156\&3q\206\134pb\SI\201\229", _password = Just
// "q\245t\178\174\247\185\150\156\217\237\FS\250\249\129\SO\177", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 25650, _connID = "\a\218\185}5\175\246g\140@\DC4", _properties = [PropTopicAliasMaximum
// 22858,PropResponseInformation
// "\204\221\r\152\SUB\195\SOY\196\152\130\\\rT\131\160r\ENQ\131\167*\214",PropWillDelayInterval
// 22875,PropSessionExpiryInterval 16297,PropResponseInformation
// "<\222eO\171p^1:\244\188\161\SOHN\129\144\ETX:\135\&4\b\179{\240\216Y}\148",PropWildcardSubscriptionAvailable
// 147,PropAuthenticationMethod "9",PropPayloadFormatIndicator 99,PropRequestProblemInformation
// 242,PropResponseInformation "\150\233\228\170\ETX\179\150k\216\FS3\rX\159\192\226\186d\v",PropTopicAliasMaximum
// 15668,PropRequestResponseInformation 120,PropRequestResponseInformation 115,PropResponseTopic
// ")t9\235%\249\189\&6",PropContentType
// "p\vt\172\135\211\193\152\192\EOT\FS\223\US\247\&2\173g",PropSharedSubscriptionAvailable 108,PropTopicAliasMaximum
// 26190,PropWillDelayInterval 20487,PropWillDelayInterval 26535,PropResponseTopic
// "q\142I4q\NAKq\174kCc\195",PropSubscriptionIdentifierAvailable 45,PropRetainAvailable 128,PropUserProperty ""
// "\162\234\219\135\&8\191`\193b\251\205 \219R\254\231\199#{\167\179\154w\202\&6eAD\201\181",PropTopicAlias
// 27126,PropCorrelationData "\199}\171\177",PropSessionExpiryInterval 20440,PropReceiveMaximum
// 24232,PropSubscriptionIdentifier 29,PropPayloadFormatIndicator 232]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xa5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x64, 0x32, 0xe6, 0x1,  0x22, 0x59, 0x4a, 0x1a,
      0x0,  0x16, 0xcc, 0xdd, 0xd,  0x98, 0x1a, 0xc3, 0xe,  0x59, 0xc4, 0x98, 0x82, 0x5c, 0xd,  0x54, 0x83, 0xa0, 0x72,
      0x5,  0x83, 0xa7, 0x2a, 0xd6, 0x18, 0x0,  0x0,  0x59, 0x5b, 0x11, 0x0,  0x0,  0x3f, 0xa9, 0x1a, 0x0,  0x1c, 0x3c,
      0xde, 0x65, 0x4f, 0xab, 0x70, 0x5e, 0x31, 0x3a, 0xf4, 0xbc, 0xa1, 0x1,  0x4e, 0x81, 0x90, 0x3,  0x3a, 0x87, 0x34,
      0x8,  0xb3, 0x7b, 0xf0, 0xd8, 0x59, 0x7d, 0x94, 0x28, 0x93, 0x15, 0x0,  0x1,  0x39, 0x1,  0x63, 0x17, 0xf2, 0x1a,
      0x0,  0x13, 0x96, 0xe9, 0xe4, 0xaa, 0x3,  0xb3, 0x96, 0x6b, 0xd8, 0x1c, 0x33, 0xd,  0x58, 0x9f, 0xc0, 0xe2, 0xba,
      0x64, 0xb,  0x22, 0x3d, 0x34, 0x19, 0x78, 0x19, 0x73, 0x8,  0x0,  0x8,  0x29, 0x74, 0x39, 0xeb, 0x25, 0xf9, 0xbd,
      0x36, 0x3,  0x0,  0x11, 0x70, 0xb,  0x74, 0xac, 0x87, 0xd3, 0xc1, 0x98, 0xc0, 0x4,  0x1c, 0xdf, 0x1f, 0xf7, 0x32,
      0xad, 0x67, 0x2a, 0x6c, 0x22, 0x66, 0x4e, 0x18, 0x0,  0x0,  0x50, 0x7,  0x18, 0x0,  0x0,  0x67, 0xa7, 0x8,  0x0,
      0xc,  0x71, 0x8e, 0x49, 0x34, 0x71, 0x15, 0x71, 0xae, 0x6b, 0x43, 0x63, 0xc3, 0x29, 0x2d, 0x25, 0x80, 0x26, 0x0,
      0x0,  0x0,  0x1e, 0xa2, 0xea, 0xdb, 0x87, 0x38, 0xbf, 0x60, 0xc1, 0x62, 0xfb, 0xcd, 0x20, 0xdb, 0x52, 0xfe, 0xe7,
      0xc7, 0x23, 0x7b, 0xa7, 0xb3, 0x9a, 0x77, 0xca, 0x36, 0x65, 0x41, 0x44, 0xc9, 0xb5, 0x23, 0x69, 0xf6, 0x9,  0x0,
      0x4,  0xc7, 0x7d, 0xab, 0xb1, 0x11, 0x0,  0x0,  0x4f, 0xd8, 0x21, 0x5e, 0xa8, 0xb,  0x1d, 0x1,  0xe8, 0x0,  0xb,
      0x7,  0xda, 0xb9, 0x7d, 0x35, 0xaf, 0xf6, 0x67, 0x8c, 0x40, 0x14, 0x0,  0x11, 0x18, 0x29, 0x88, 0xc8, 0x42, 0xab,
      0x1c, 0x9c, 0x33, 0x71, 0xce, 0x86, 0x70, 0x62, 0xf,  0xc9, 0xe5, 0x0,  0x11, 0x71, 0xf5, 0x74, 0xb2, 0xae, 0xf7,
      0xb9, 0x96, 0x9c, 0xd9, 0xed, 0x1c, 0xfa, 0xf9, 0x81, 0xe,  0xb1};

  uint8_t buf[306] = {0};

  uint8_t bytesprops0[] = {0xcc, 0xdd, 0xd,  0x98, 0x1a, 0xc3, 0xe, 0x59, 0xc4, 0x98, 0x82,
                           0x5c, 0xd,  0x54, 0x83, 0xa0, 0x72, 0x5, 0x83, 0xa7, 0x2a, 0xd6};
  uint8_t bytesprops1[] = {0x3c, 0xde, 0x65, 0x4f, 0xab, 0x70, 0x5e, 0x31, 0x3a, 0xf4, 0xbc, 0xa1, 0x1,  0x4e,
                           0x81, 0x90, 0x3,  0x3a, 0x87, 0x34, 0x8,  0xb3, 0x7b, 0xf0, 0xd8, 0x59, 0x7d, 0x94};
  uint8_t bytesprops2[] = {0x39};
  uint8_t bytesprops3[] = {0x96, 0xe9, 0xe4, 0xaa, 0x3,  0xb3, 0x96, 0x6b, 0xd8, 0x1c,
                           0x33, 0xd,  0x58, 0x9f, 0xc0, 0xe2, 0xba, 0x64, 0xb};
  uint8_t bytesprops4[] = {0x29, 0x74, 0x39, 0xeb, 0x25, 0xf9, 0xbd, 0x36};
  uint8_t bytesprops5[] = {0x70, 0xb,  0x74, 0xac, 0x87, 0xd3, 0xc1, 0x98, 0xc0,
                           0x4,  0x1c, 0xdf, 0x1f, 0xf7, 0x32, 0xad, 0x67};
  uint8_t bytesprops6[] = {0x71, 0x8e, 0x49, 0x34, 0x71, 0x15, 0x71, 0xae, 0x6b, 0x43, 0x63, 0xc3};
  uint8_t bytesprops8[] = {0xa2, 0xea, 0xdb, 0x87, 0x38, 0xbf, 0x60, 0xc1, 0x62, 0xfb, 0xcd, 0x20, 0xdb, 0x52, 0xfe,
                           0xe7, 0xc7, 0x23, 0x7b, 0xa7, 0xb3, 0x9a, 0x77, 0xca, 0x36, 0x65, 0x41, 0x44, 0xc9, 0xb5};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops9[] = {0xc7, 0x7d, 0xab, 0xb1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22858}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22875}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16297}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15668}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26190}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20487}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26535}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops7}, .v = {30, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27126}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20440}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24232}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 232}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25650;
  uint8_t client_id_bytes[] = {0x7, 0xda, 0xb9, 0x7d, 0x35, 0xaf, 0xf6, 0x67, 0x8c, 0x40, 0x14};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x18, 0x29, 0x88, 0xc8, 0x42, 0xab, 0x1c, 0x9c, 0x33,
                              0x71, 0xce, 0x86, 0x70, 0x62, 0xf,  0xc9, 0xe5};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x71, 0xf5, 0x74, 0xb2, 0xae, 0xf7, 0xb9, 0x96, 0x9c,
                              0xd9, 0xed, 0x1c, 0xfa, 0xf9, 0x81, 0xe,  0xb1};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\177\ETXK\189\246\n\194\160\SYN%\217\238", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\197\NAK\205\181i\DEL", _willMsg = "1", _willProps =
// []}), _cleanSession = False, _keepAlive = 14932, _connID =
// "y\NUL\146M\ENQ\251\223\140\223q7\254\134\155\148NC\229\180\141\171b\RS\194\ESC\136\244", _properties =
// [PropWillDelayInterval 7604]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa4, 0x3a, 0x54, 0x5,  0x18, 0x0,
                   0x0,  0x1d, 0xb4, 0x0,  0x1b, 0x79, 0x0,  0x92, 0x4d, 0x5,  0xfb, 0xdf, 0x8c, 0xdf, 0x71,
                   0x37, 0xfe, 0x86, 0x9b, 0x94, 0x4e, 0x43, 0xe5, 0xb4, 0x8d, 0xab, 0x62, 0x1e, 0xc2, 0x1b,
                   0x88, 0xf4, 0x0,  0x0,  0x6,  0xc5, 0x15, 0xcd, 0xb5, 0x69, 0x7f, 0x0,  0x1,  0x31, 0x0,
                   0xc,  0xb1, 0x3,  0x4b, 0xbd, 0xf6, 0xa,  0xc2, 0xa0, 0x16, 0x25, 0xd9, 0xee};

  uint8_t buf[83] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7604}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc5, 0x15, 0xcd, 0xb5, 0x69, 0x7f};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14932;
  uint8_t client_id_bytes[] = {0x79, 0x0,  0x92, 0x4d, 0x5,  0xfb, 0xdf, 0x8c, 0xdf, 0x71, 0x37, 0xfe, 0x86, 0x9b,
                               0x94, 0x4e, 0x43, 0xe5, 0xb4, 0x8d, 0xab, 0x62, 0x1e, 0xc2, 0x1b, 0x88, 0xf4};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb1, 0x3, 0x4b, 0xbd, 0xf6, 0xa, 0xc2, 0xa0, 0x16, 0x25, 0xd9, 0xee};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\217\134\182", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "*\211,\239(\140\217<Q\205\219\128h\201\228\230\161\233", _willMsg =
// "\233\a^_\166\157v%+", _willProps = [PropTopicAliasMaximum 13764,PropResponseTopic
// "1\EM\219\DC4\252\NUL\144$\231(\191H\b.\162\153\237\DC3\251#N\227]\255\a(",PropRetainAvailable
// 170,PropResponseInformation "\141\NUL&",PropWildcardSubscriptionAvailable 228,PropResponseInformation
// "\253\"N",PropAuthenticationData
// "\133`\214\131\192C\ESCm\253\DC1\235\&7K\245S\153\&2\178\185(-\221\145\154\b\131",PropSessionExpiryInterval
// 9290,PropSubscriptionIdentifierAvailable 17,PropAuthenticationMethod "\t\187\v\154UC;\234D",PropContentType
// "\139%*5_D>y\CAN\211\154\208\148hWO\146P\DC2\208r\209\180\253\215F\211\223,\ESC",PropSharedSubscriptionAvailable
// 34,PropMaximumPacketSize 24332,PropAuthenticationMethod
// "\rt\ETX8\130\135Y\209L\236J!\253\&4\213\250\243\184\134\190T\aC\236",PropMaximumQoS 126,PropAuthenticationMethod
// "\212h\236h",PropPayloadFormatIndicator 139,PropWildcardSubscriptionAvailable 99,PropTopicAliasMaximum
// 31936,PropTopicAliasMaximum 21507,PropContentType "\FS\252\206\173j\a$\200\133H\rM\n\241\215\SI?]"]}), _cleanSession
// = False, _keepAlive = 3108, _connID = "\211\250\245_\185\238\&6\147\133\144c\168\US\246\SUB\175\170|HZ\184\nE",
// _properties = [PropWildcardSubscriptionAvailable 245,PropResponseTopic "\157\196\226\SYNr",PropServerReference
// "#:\150",PropMaximumPacketSize 24216,PropSessionExpiryInterval 26003,PropReceiveMaximum 6740,PropTopicAliasMaximum
// 16967]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xb5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0xc,  0x24, 0x20, 0x28, 0xf5, 0x8,  0x0,  0x5,
      0x9d, 0xc4, 0xe2, 0x16, 0x72, 0x1c, 0x0,  0x3,  0x23, 0x3a, 0x96, 0x27, 0x0,  0x0,  0x5e, 0x98, 0x11, 0x0,  0x0,
      0x65, 0x93, 0x21, 0x1a, 0x54, 0x22, 0x42, 0x47, 0x0,  0x17, 0xd3, 0xfa, 0xf5, 0x5f, 0xb9, 0xee, 0x36, 0x93, 0x85,
      0x90, 0x63, 0xa8, 0x1f, 0xf6, 0x1a, 0xaf, 0xaa, 0x7c, 0x48, 0x5a, 0xb8, 0xa,  0x45, 0xcb, 0x1,  0x22, 0x35, 0xc4,
      0x8,  0x0,  0x1a, 0x31, 0x19, 0xdb, 0x14, 0xfc, 0x0,  0x90, 0x24, 0xe7, 0x28, 0xbf, 0x48, 0x8,  0x2e, 0xa2, 0x99,
      0xed, 0x13, 0xfb, 0x23, 0x4e, 0xe3, 0x5d, 0xff, 0x7,  0x28, 0x25, 0xaa, 0x1a, 0x0,  0x3,  0x8d, 0x0,  0x26, 0x28,
      0xe4, 0x1a, 0x0,  0x3,  0xfd, 0x22, 0x4e, 0x16, 0x0,  0x1a, 0x85, 0x60, 0xd6, 0x83, 0xc0, 0x43, 0x1b, 0x6d, 0xfd,
      0x11, 0xeb, 0x37, 0x4b, 0xf5, 0x53, 0x99, 0x32, 0xb2, 0xb9, 0x28, 0x2d, 0xdd, 0x91, 0x9a, 0x8,  0x83, 0x11, 0x0,
      0x0,  0x24, 0x4a, 0x29, 0x11, 0x15, 0x0,  0x9,  0x9,  0xbb, 0xb,  0x9a, 0x55, 0x43, 0x3b, 0xea, 0x44, 0x3,  0x0,
      0x1e, 0x8b, 0x25, 0x2a, 0x35, 0x5f, 0x44, 0x3e, 0x79, 0x18, 0xd3, 0x9a, 0xd0, 0x94, 0x68, 0x57, 0x4f, 0x92, 0x50,
      0x12, 0xd0, 0x72, 0xd1, 0xb4, 0xfd, 0xd7, 0x46, 0xd3, 0xdf, 0x2c, 0x1b, 0x2a, 0x22, 0x27, 0x0,  0x0,  0x5f, 0xc,
      0x15, 0x0,  0x18, 0xd,  0x74, 0x3,  0x38, 0x82, 0x87, 0x59, 0xd1, 0x4c, 0xec, 0x4a, 0x21, 0xfd, 0x34, 0xd5, 0xfa,
      0xf3, 0xb8, 0x86, 0xbe, 0x54, 0x7,  0x43, 0xec, 0x24, 0x7e, 0x15, 0x0,  0x4,  0xd4, 0x68, 0xec, 0x68, 0x1,  0x8b,
      0x28, 0x63, 0x22, 0x7c, 0xc0, 0x22, 0x54, 0x3,  0x3,  0x0,  0x12, 0x1c, 0xfc, 0xce, 0xad, 0x6a, 0x7,  0x24, 0xc8,
      0x85, 0x48, 0xd,  0x4d, 0xa,  0xf1, 0xd7, 0xf,  0x3f, 0x5d, 0x0,  0x12, 0x2a, 0xd3, 0x2c, 0xef, 0x28, 0x8c, 0xd9,
      0x3c, 0x51, 0xcd, 0xdb, 0x80, 0x68, 0xc9, 0xe4, 0xe6, 0xa1, 0xe9, 0x0,  0x9,  0xe9, 0x7,  0x5e, 0x5f, 0xa6, 0x9d,
      0x76, 0x25, 0x2b, 0x0,  0x3,  0xd9, 0x86, 0xb6};

  uint8_t buf[322] = {0};

  uint8_t bytesprops0[] = {0x9d, 0xc4, 0xe2, 0x16, 0x72};
  uint8_t bytesprops1[] = {0x23, 0x3a, 0x96};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24216}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26003}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6740}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16967}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x31, 0x19, 0xdb, 0x14, 0xfc, 0x0,  0x90, 0x24, 0xe7, 0x28, 0xbf, 0x48, 0x8,
                               0x2e, 0xa2, 0x99, 0xed, 0x13, 0xfb, 0x23, 0x4e, 0xe3, 0x5d, 0xff, 0x7,  0x28};
  uint8_t byteswillprops1[] = {0x8d, 0x0, 0x26};
  uint8_t byteswillprops2[] = {0xfd, 0x22, 0x4e};
  uint8_t byteswillprops3[] = {0x85, 0x60, 0xd6, 0x83, 0xc0, 0x43, 0x1b, 0x6d, 0xfd, 0x11, 0xeb, 0x37, 0x4b,
                               0xf5, 0x53, 0x99, 0x32, 0xb2, 0xb9, 0x28, 0x2d, 0xdd, 0x91, 0x9a, 0x8,  0x83};
  uint8_t byteswillprops4[] = {0x9, 0xbb, 0xb, 0x9a, 0x55, 0x43, 0x3b, 0xea, 0x44};
  uint8_t byteswillprops5[] = {0x8b, 0x25, 0x2a, 0x35, 0x5f, 0x44, 0x3e, 0x79, 0x18, 0xd3,
                               0x9a, 0xd0, 0x94, 0x68, 0x57, 0x4f, 0x92, 0x50, 0x12, 0xd0,
                               0x72, 0xd1, 0xb4, 0xfd, 0xd7, 0x46, 0xd3, 0xdf, 0x2c, 0x1b};
  uint8_t byteswillprops6[] = {0xd,  0x74, 0x3,  0x38, 0x82, 0x87, 0x59, 0xd1, 0x4c, 0xec, 0x4a, 0x21,
                               0xfd, 0x34, 0xd5, 0xfa, 0xf3, 0xb8, 0x86, 0xbe, 0x54, 0x7,  0x43, 0xec};
  uint8_t byteswillprops7[] = {0xd4, 0x68, 0xec, 0x68};
  uint8_t byteswillprops8[] = {0x1c, 0xfc, 0xce, 0xad, 0x6a, 0x7,  0x24, 0xc8, 0x85,
                               0x48, 0xd,  0x4d, 0xa,  0xf1, 0xd7, 0xf,  0x3f, 0x5d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13764}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9290}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24332}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31936}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21507}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&byteswillprops8}}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2a, 0xd3, 0x2c, 0xef, 0x28, 0x8c, 0xd9, 0x3c, 0x51,
                                0xcd, 0xdb, 0x80, 0x68, 0xc9, 0xe4, 0xe6, 0xa1, 0xe9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe9, 0x7, 0x5e, 0x5f, 0xa6, 0x9d, 0x76, 0x25, 0x2b};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3108;
  uint8_t client_id_bytes[] = {0xd3, 0xfa, 0xf5, 0x5f, 0xb9, 0xee, 0x36, 0x93, 0x85, 0x90, 0x63, 0xa8,
                               0x1f, 0xf6, 0x1a, 0xaf, 0xaa, 0x7c, 0x48, 0x5a, 0xb8, 0xa,  0x45};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd9, 0x86, 0xb6};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "]*\250E|\140H\246\144\236\ACK\196\152\216@\SO\EOTK\248
// \199\&6\n\STX=\149s\235\206R", _password = Just "o\197\204\215\153\171tJ\230U\196K\209xYvu\252\206a\129\\", _lastWill
// = Nothing, _cleanSession = False, _keepAlive = 2582, _connID =
// "Zj\DC2\237\243_-\201=\176\154\233\163\196\234\210\176!", _properties = [PropReceiveMaximum 18664,PropServerKeepAlive
// 6658,PropServerKeepAlive 18381,PropMessageExpiryInterval 15208,PropWillDelayInterval 29547,PropUserProperty
// "\150Z\132\248Y\f\170\138.Dl" "&\203u",PropPayloadFormatIndicator 224,PropTopicAlias 26630,PropUserProperty
// "\232M\139\142\SOH5\130\220v\153\146\163\149\238\185\140\242H\226\ETX\RS\DEL"
// "\158\189\210`Pr\255i\198Z9\175\156\220E\STX\131\167(W\170\f\161\192\239\DEL\179",PropServerReference
// "\144\USc\179\&9\222\FS\vJ/\168\236\180u\240\167.=,\SOHNJ@)\ETX",PropRequestProblemInformation 212]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0xd6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0xa,  0x16, 0x7f, 0x21, 0x48, 0xe8,
                   0x13, 0x1a, 0x2,  0x13, 0x47, 0xcd, 0x2,  0x0,  0x0,  0x3b, 0x68, 0x18, 0x0,  0x0,  0x73, 0x6b, 0x26,
                   0x0,  0xb,  0x96, 0x5a, 0x84, 0xf8, 0x59, 0xc,  0xaa, 0x8a, 0x2e, 0x44, 0x6c, 0x0,  0x3,  0x26, 0xcb,
                   0x75, 0x1,  0xe0, 0x23, 0x68, 0x6,  0x26, 0x0,  0x16, 0xe8, 0x4d, 0x8b, 0x8e, 0x1,  0x35, 0x82, 0xdc,
                   0x76, 0x99, 0x92, 0xa3, 0x95, 0xee, 0xb9, 0x8c, 0xf2, 0x48, 0xe2, 0x3,  0x1e, 0x7f, 0x0,  0x1b, 0x9e,
                   0xbd, 0xd2, 0x60, 0x50, 0x72, 0xff, 0x69, 0xc6, 0x5a, 0x39, 0xaf, 0x9c, 0xdc, 0x45, 0x2,  0x83, 0xa7,
                   0x28, 0x57, 0xaa, 0xc,  0xa1, 0xc0, 0xef, 0x7f, 0xb3, 0x1c, 0x0,  0x19, 0x90, 0x1f, 0x63, 0xb3, 0x39,
                   0xde, 0x1c, 0xb,  0x4a, 0x2f, 0xa8, 0xec, 0xb4, 0x75, 0xf0, 0xa7, 0x2e, 0x3d, 0x2c, 0x1,  0x4e, 0x4a,
                   0x40, 0x29, 0x3,  0x17, 0xd4, 0x0,  0x12, 0x5a, 0x6a, 0x12, 0xed, 0xf3, 0x5f, 0x2d, 0xc9, 0x3d, 0xb0,
                   0x9a, 0xe9, 0xa3, 0xc4, 0xea, 0xd2, 0xb0, 0x21, 0x0,  0x1e, 0x5d, 0x2a, 0xfa, 0x45, 0x7c, 0x8c, 0x48,
                   0xf6, 0x90, 0xec, 0x6,  0xc4, 0x98, 0xd8, 0x40, 0xe,  0x4,  0x4b, 0xf8, 0x20, 0xc7, 0x36, 0xa,  0x2,
                   0x3d, 0x95, 0x73, 0xeb, 0xce, 0x52, 0x0,  0x16, 0x6f, 0xc5, 0xcc, 0xd7, 0x99, 0xab, 0x74, 0x4a, 0xe6,
                   0x55, 0xc4, 0x4b, 0xd1, 0x78, 0x59, 0x76, 0x75, 0xfc, 0xce, 0x61, 0x81, 0x5c};

  uint8_t buf[227] = {0};

  uint8_t bytesprops1[] = {0x26, 0xcb, 0x75};
  uint8_t bytesprops0[] = {0x96, 0x5a, 0x84, 0xf8, 0x59, 0xc, 0xaa, 0x8a, 0x2e, 0x44, 0x6c};
  uint8_t bytesprops3[] = {0x9e, 0xbd, 0xd2, 0x60, 0x50, 0x72, 0xff, 0x69, 0xc6, 0x5a, 0x39, 0xaf, 0x9c, 0xdc,
                           0x45, 0x2,  0x83, 0xa7, 0x28, 0x57, 0xaa, 0xc,  0xa1, 0xc0, 0xef, 0x7f, 0xb3};
  uint8_t bytesprops2[] = {0xe8, 0x4d, 0x8b, 0x8e, 0x1,  0x35, 0x82, 0xdc, 0x76, 0x99, 0x92,
                           0xa3, 0x95, 0xee, 0xb9, 0x8c, 0xf2, 0x48, 0xe2, 0x3,  0x1e, 0x7f};
  uint8_t bytesprops4[] = {0x90, 0x1f, 0x63, 0xb3, 0x39, 0xde, 0x1c, 0xb,  0x4a, 0x2f, 0xa8, 0xec, 0xb4,
                           0x75, 0xf0, 0xa7, 0x2e, 0x3d, 0x2c, 0x1,  0x4e, 0x4a, 0x40, 0x29, 0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18664}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6658}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18381}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15208}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29547}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {3, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26630}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops2}, .v = {27, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 212}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2582;
  uint8_t client_id_bytes[] = {0x5a, 0x6a, 0x12, 0xed, 0xf3, 0x5f, 0x2d, 0xc9, 0x3d,
                               0xb0, 0x9a, 0xe9, 0xa3, 0xc4, 0xea, 0xd2, 0xb0, 0x21};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0x2a, 0xfa, 0x45, 0x7c, 0x8c, 0x48, 0xf6, 0x90, 0xec, 0x6,  0xc4, 0x98, 0xd8, 0x40,
                              0xe,  0x4,  0x4b, 0xf8, 0x20, 0xc7, 0x36, 0xa,  0x2,  0x3d, 0x95, 0x73, 0xeb, 0xce, 0x52};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xc5, 0xcc, 0xd7, 0x99, 0xab, 0x74, 0x4a, 0xe6, 0x55, 0xc4,
                              0x4b, 0xd1, 0x78, 0x59, 0x76, 0x75, 0xfc, 0xce, 0x61, 0x81, 0x5c};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\EOTG\170Y\132\235\193\STX\132\236", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 14063, _connID = "\253gc\224:\148 v\185T^gmf\158Z\DC1#\211\SYN#[~", _properties =
// [PropWildcardSubscriptionAvailable 153,PropAuthenticationMethod
// "%*V\246\139\252A\250\140\210\SI\218\213\190\164kEI\252",PropTopicAliasMaximum 20364,PropSharedSubscriptionAvailable
// 45,PropSessionExpiryInterval 19290,PropPayloadFormatIndicator 17,PropResponseInformation
// "d\SOQ\254X\189\247V\190\140\144\173\&5\214\241\160\164-\231",PropContentType "f\v\240",PropAuthenticationData
// "\141u\201X\250\ESC7`\"`\DC45\234\144m\211\135\209\199N\158\199\214\244\165\162\131",PropSharedSubscriptionAvailable
// 226,PropSubscriptionIdentifierAvailable 5,PropMessageExpiryInterval 251,PropMessageExpiryInterval
// 20049,PropResponseInformation
// "A\145\SOH\194\135\168HK\GS\NAK\f\161\US\192\231\NUL\199\"q\211M\204v\ETX\187\n",PropRequestProblemInformation
// 143,PropSharedSubscriptionAvailable 100,PropWildcardSubscriptionAvailable 44,PropRequestResponseInformation
// 218,PropTopicAliasMaximum 23440,PropPayloadFormatIndicator 71,PropAssignedClientIdentifier ":0",PropReceiveMaximum
// 12681]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0xc3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x36, 0xef, 0x9e, 0x1,  0x28, 0x99,
                   0x15, 0x0,  0x13, 0x25, 0x2a, 0x56, 0xf6, 0x8b, 0xfc, 0x41, 0xfa, 0x8c, 0xd2, 0xf,  0xda, 0xd5, 0xbe,
                   0xa4, 0x6b, 0x45, 0x49, 0xfc, 0x22, 0x4f, 0x8c, 0x2a, 0x2d, 0x11, 0x0,  0x0,  0x4b, 0x5a, 0x1,  0x11,
                   0x1a, 0x0,  0x13, 0x64, 0xe,  0x51, 0xfe, 0x58, 0xbd, 0xf7, 0x56, 0xbe, 0x8c, 0x90, 0xad, 0x35, 0xd6,
                   0xf1, 0xa0, 0xa4, 0x2d, 0xe7, 0x3,  0x0,  0x3,  0x66, 0xb,  0xf0, 0x16, 0x0,  0x1b, 0x8d, 0x75, 0xc9,
                   0x58, 0xfa, 0x1b, 0x37, 0x60, 0x22, 0x60, 0x14, 0x35, 0xea, 0x90, 0x6d, 0xd3, 0x87, 0xd1, 0xc7, 0x4e,
                   0x9e, 0xc7, 0xd6, 0xf4, 0xa5, 0xa2, 0x83, 0x2a, 0xe2, 0x29, 0x5,  0x2,  0x0,  0x0,  0x0,  0xfb, 0x2,
                   0x0,  0x0,  0x4e, 0x51, 0x1a, 0x0,  0x1a, 0x41, 0x91, 0x1,  0xc2, 0x87, 0xa8, 0x48, 0x4b, 0x1d, 0x15,
                   0xc,  0xa1, 0x1f, 0xc0, 0xe7, 0x0,  0xc7, 0x22, 0x71, 0xd3, 0x4d, 0xcc, 0x76, 0x3,  0xbb, 0xa,  0x17,
                   0x8f, 0x2a, 0x64, 0x28, 0x2c, 0x19, 0xda, 0x22, 0x5b, 0x90, 0x1,  0x47, 0x12, 0x0,  0x2,  0x3a, 0x30,
                   0x21, 0x31, 0x89, 0x0,  0x17, 0xfd, 0x67, 0x63, 0xe0, 0x3a, 0x94, 0x20, 0x76, 0xb9, 0x54, 0x5e, 0x67,
                   0x6d, 0x66, 0x9e, 0x5a, 0x11, 0x23, 0xd3, 0x16, 0x23, 0x5b, 0x7e};

  uint8_t buf[208] = {0};

  uint8_t bytesprops0[] = {0x25, 0x2a, 0x56, 0xf6, 0x8b, 0xfc, 0x41, 0xfa, 0x8c, 0xd2,
                           0xf,  0xda, 0xd5, 0xbe, 0xa4, 0x6b, 0x45, 0x49, 0xfc};
  uint8_t bytesprops1[] = {0x64, 0xe,  0x51, 0xfe, 0x58, 0xbd, 0xf7, 0x56, 0xbe, 0x8c,
                           0x90, 0xad, 0x35, 0xd6, 0xf1, 0xa0, 0xa4, 0x2d, 0xe7};
  uint8_t bytesprops2[] = {0x66, 0xb, 0xf0};
  uint8_t bytesprops3[] = {0x8d, 0x75, 0xc9, 0x58, 0xfa, 0x1b, 0x37, 0x60, 0x22, 0x60, 0x14, 0x35, 0xea, 0x90,
                           0x6d, 0xd3, 0x87, 0xd1, 0xc7, 0x4e, 0x9e, 0xc7, 0xd6, 0xf4, 0xa5, 0xa2, 0x83};
  uint8_t bytesprops4[] = {0x41, 0x91, 0x1, 0xc2, 0x87, 0xa8, 0x48, 0x4b, 0x1d, 0x15, 0xc, 0xa1, 0x1f,
                           0xc0, 0xe7, 0x0, 0xc7, 0x22, 0x71, 0xd3, 0x4d, 0xcc, 0x76, 0x3, 0xbb, 0xa};
  uint8_t bytesprops5[] = {0x3a, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20364}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19290}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 251}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20049}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23440}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12681}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14063;
  uint8_t client_id_bytes[] = {0xfd, 0x67, 0x63, 0xe0, 0x3a, 0x94, 0x20, 0x76, 0xb9, 0x54, 0x5e, 0x67,
                               0x6d, 0x66, 0x9e, 0x5a, 0x11, 0x23, 0xd3, 0x16, 0x23, 0x5b, 0x7e};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4, 0x47, 0xaa, 0x59, 0x84, 0xeb, 0xc1, 0x2, 0x84, 0xec};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\t\222\159S\165\157.L\191\219\SUB\249\GSF@\235\241t\\\r\130\&4\255\216K\204\246Z\255", _willMsg =
// "\153*>%QC\v\RS\n\183 &\205&Em", _willProps = [PropSessionExpiryInterval 29828,PropUserProperty "c0g\225\157+P"
// "\187\138\&1y\183o\128\&5\133\196t\198\177*_W\203\205\&6\223 b&",PropTopicAliasMaximum 5227,PropMaximumPacketSize
// 7849,PropSubscriptionIdentifierAvailable 157,PropTopicAliasMaximum 27560,PropTopicAliasMaximum
// 2575,PropSubscriptionIdentifier 20,PropMessageExpiryInterval 11317,PropMaximumPacketSize 28505,PropCorrelationData
// "\161\194\180Ejo\168#\153\ESC\184\145\178\GS\254\240S\t\229d\DLEI\243\198",PropRequestProblemInformation
// 194,PropAssignedClientIdentifier "\"\"{28\241r+\182\198\146",PropAuthenticationMethod "\142&\147\255\153c\237'"]}),
// _cleanSession = True, _keepAlive = 8661, _connID = "\213\183*l\161!\168\252p\153\208\254\DC1<\235", _properties =
// [PropResponseInformation "",PropRequestProblemInformation 241,PropMessageExpiryInterval 13783,PropReceiveMaximum
// 29834,PropAuthenticationData
// "\200C\132\EMx*f\241\218lN\ACK\215\183\236\248\222\&5\151\n\141\146\172o\154",PropMessageExpiryInterval
// 23078,PropAuthenticationData
// "\DC3!\149(eo\146,\ETBHn3c\136\209\213\SI\226PZ\166&'\213\198\DC2\229+",PropSharedSubscriptionAvailable
// 231,PropRequestResponseInformation 108,PropSubscriptionIdentifier 25,PropWildcardSubscriptionAvailable
// 232,PropWildcardSubscriptionAvailable 89,PropPayloadFormatIndicator 156,PropWillDelayInterval 30760,PropUserProperty
// "2y\231\136\182E\176\DC1h\148Q\132\b\CAN"
// "\176-yt\234\219\176@\SYNx\b\191S\150\f\ENQk[\v|\199\SUB\"y\ENQX\EOTrH",PropWillDelayInterval 25980]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xdc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x21, 0xd5, 0x93, 0x1,  0x1a, 0x0,  0x0,  0x17,
      0xf1, 0x2,  0x0,  0x0,  0x35, 0xd7, 0x21, 0x74, 0x8a, 0x16, 0x0,  0x19, 0xc8, 0x43, 0x84, 0x19, 0x78, 0x2a, 0x66,
      0xf1, 0xda, 0x6c, 0x4e, 0x6,  0xd7, 0xb7, 0xec, 0xf8, 0xde, 0x35, 0x97, 0xa,  0x8d, 0x92, 0xac, 0x6f, 0x9a, 0x2,
      0x0,  0x0,  0x5a, 0x26, 0x16, 0x0,  0x1c, 0x13, 0x21, 0x95, 0x28, 0x65, 0x6f, 0x92, 0x2c, 0x17, 0x48, 0x6e, 0x33,
      0x63, 0x88, 0xd1, 0xd5, 0xf,  0xe2, 0x50, 0x5a, 0xa6, 0x26, 0x27, 0xd5, 0xc6, 0x12, 0xe5, 0x2b, 0x2a, 0xe7, 0x19,
      0x6c, 0xb,  0x19, 0x28, 0xe8, 0x28, 0x59, 0x1,  0x9c, 0x18, 0x0,  0x0,  0x78, 0x28, 0x26, 0x0,  0xe,  0x32, 0x79,
      0xe7, 0x88, 0xb6, 0x45, 0xb0, 0x11, 0x68, 0x94, 0x51, 0x84, 0x8,  0x18, 0x0,  0x1d, 0xb0, 0x2d, 0x79, 0x74, 0xea,
      0xdb, 0xb0, 0x40, 0x16, 0x78, 0x8,  0xbf, 0x53, 0x96, 0xc,  0x5,  0x6b, 0x5b, 0xb,  0x7c, 0xc7, 0x1a, 0x22, 0x79,
      0x5,  0x58, 0x4,  0x72, 0x48, 0x18, 0x0,  0x0,  0x65, 0x7c, 0x0,  0xf,  0xd5, 0xb7, 0x2a, 0x6c, 0xa1, 0x21, 0xa8,
      0xfc, 0x70, 0x99, 0xd0, 0xfe, 0x11, 0x3c, 0xeb, 0x7a, 0x11, 0x0,  0x0,  0x74, 0x84, 0x26, 0x0,  0x7,  0x63, 0x30,
      0x67, 0xe1, 0x9d, 0x2b, 0x50, 0x0,  0x17, 0xbb, 0x8a, 0x31, 0x79, 0xb7, 0x6f, 0x80, 0x35, 0x85, 0xc4, 0x74, 0xc6,
      0xb1, 0x2a, 0x5f, 0x57, 0xcb, 0xcd, 0x36, 0xdf, 0x20, 0x62, 0x26, 0x22, 0x14, 0x6b, 0x27, 0x0,  0x0,  0x1e, 0xa9,
      0x29, 0x9d, 0x22, 0x6b, 0xa8, 0x22, 0xa,  0xf,  0xb,  0x14, 0x2,  0x0,  0x0,  0x2c, 0x35, 0x27, 0x0,  0x0,  0x6f,
      0x59, 0x9,  0x0,  0x18, 0xa1, 0xc2, 0xb4, 0x45, 0x6a, 0x6f, 0xa8, 0x23, 0x99, 0x1b, 0xb8, 0x91, 0xb2, 0x1d, 0xfe,
      0xf0, 0x53, 0x9,  0xe5, 0x64, 0x10, 0x49, 0xf3, 0xc6, 0x17, 0xc2, 0x12, 0x0,  0xb,  0x22, 0x22, 0x7b, 0x32, 0x38,
      0xf1, 0x72, 0x2b, 0xb6, 0xc6, 0x92, 0x15, 0x0,  0x8,  0x8e, 0x26, 0x93, 0xff, 0x99, 0x63, 0xed, 0x27, 0x0,  0x1d,
      0x9,  0xde, 0x9f, 0x53, 0xa5, 0x9d, 0x2e, 0x4c, 0xbf, 0xdb, 0x1a, 0xf9, 0x1d, 0x46, 0x40, 0xeb, 0xf1, 0x74, 0x5c,
      0xd,  0x82, 0x34, 0xff, 0xd8, 0x4b, 0xcc, 0xf6, 0x5a, 0xff, 0x0,  0x10, 0x99, 0x2a, 0x3e, 0x25, 0x51, 0x43, 0xb,
      0x1e, 0xa,  0xb7, 0x20, 0x26, 0xcd, 0x26, 0x45, 0x6d};

  uint8_t buf[361] = {0};

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xc8, 0x43, 0x84, 0x19, 0x78, 0x2a, 0x66, 0xf1, 0xda, 0x6c, 0x4e, 0x6, 0xd7,
                           0xb7, 0xec, 0xf8, 0xde, 0x35, 0x97, 0xa,  0x8d, 0x92, 0xac, 0x6f, 0x9a};
  uint8_t bytesprops2[] = {0x13, 0x21, 0x95, 0x28, 0x65, 0x6f, 0x92, 0x2c, 0x17, 0x48, 0x6e, 0x33, 0x63, 0x88,
                           0xd1, 0xd5, 0xf,  0xe2, 0x50, 0x5a, 0xa6, 0x26, 0x27, 0xd5, 0xc6, 0x12, 0xe5, 0x2b};
  uint8_t bytesprops4[] = {0xb0, 0x2d, 0x79, 0x74, 0xea, 0xdb, 0xb0, 0x40, 0x16, 0x78, 0x8,  0xbf, 0x53, 0x96, 0xc,
                           0x5,  0x6b, 0x5b, 0xb,  0x7c, 0xc7, 0x1a, 0x22, 0x79, 0x5,  0x58, 0x4,  0x72, 0x48};
  uint8_t bytesprops3[] = {0x32, 0x79, 0xe7, 0x88, 0xb6, 0x45, 0xb0, 0x11, 0x68, 0x94, 0x51, 0x84, 0x8, 0x18};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13783}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29834}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23078}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30760}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops3}, .v = {29, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25980}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xbb, 0x8a, 0x31, 0x79, 0xb7, 0x6f, 0x80, 0x35, 0x85, 0xc4, 0x74, 0xc6,
                               0xb1, 0x2a, 0x5f, 0x57, 0xcb, 0xcd, 0x36, 0xdf, 0x20, 0x62, 0x26};
  uint8_t byteswillprops0[] = {0x63, 0x30, 0x67, 0xe1, 0x9d, 0x2b, 0x50};
  uint8_t byteswillprops2[] = {0xa1, 0xc2, 0xb4, 0x45, 0x6a, 0x6f, 0xa8, 0x23, 0x99, 0x1b, 0xb8, 0x91,
                               0xb2, 0x1d, 0xfe, 0xf0, 0x53, 0x9,  0xe5, 0x64, 0x10, 0x49, 0xf3, 0xc6};
  uint8_t byteswillprops3[] = {0x22, 0x22, 0x7b, 0x32, 0x38, 0xf1, 0x72, 0x2b, 0xb6, 0xc6, 0x92};
  uint8_t byteswillprops4[] = {0x8e, 0x26, 0x93, 0xff, 0x99, 0x63, 0xed, 0x27};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29828}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops0}, .v = {23, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5227}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7849}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27560}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2575}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11317}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28505}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9,  0xde, 0x9f, 0x53, 0xa5, 0x9d, 0x2e, 0x4c, 0xbf, 0xdb,
                                0x1a, 0xf9, 0x1d, 0x46, 0x40, 0xeb, 0xf1, 0x74, 0x5c, 0xd,
                                0x82, 0x34, 0xff, 0xd8, 0x4b, 0xcc, 0xf6, 0x5a, 0xff};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x99, 0x2a, 0x3e, 0x25, 0x51, 0x43, 0xb,  0x1e,
                                  0xa,  0xb7, 0x20, 0x26, 0xcd, 0x26, 0x45, 0x6d};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8661;
  uint8_t client_id_bytes[] = {0xd5, 0xb7, 0x2a, 0x6c, 0xa1, 0x21, 0xa8, 0xfc,
                               0x70, 0x99, 0xd0, 0xfe, 0x11, 0x3c, 0xeb};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic =
// "\\\255\246\RS<\212+\220\248\199\236\132\185\US]D\137\186\&5\193\r\n\237\181\231\246\&6\238\211\221", _willMsg =
// "#%`lDh\222\147\201\155e\153\136\131 [9l\GS\225\NUL^", _willProps = [PropSubscriptionIdentifierAvailable 171]}),
// _cleanSession = True, _keepAlive = 1275, _connID = "^\232\215\163\208\190\139\233T\239\SI\139\vz6}", _properties =
// [PropServerKeepAlive 25090,PropRequestResponseInformation 194,PropAuthenticationMethod
// "\153\225h\DC3dj\SOH\211\159\136e\151X",PropAssignedClientIdentifier
// "\145M\ESC\149d53dKi}",PropSubscriptionIdentifier 9,PropSharedSubscriptionAvailable 42,PropPayloadFormatIndicator
// 229,PropResponseInformation "u\219C\233\206\200\SOH\129r\172\NAK\DC3\214W",PropWillDelayInterval
// 9633,PropResponseTopic "\ENQ\199\203o\171\ESC9\156\250\253\252v\243\253\172\222\171",PropResponseInformation
// "\250",PropSharedSubscriptionAvailable 116,PropRequestResponseInformation 100,PropRequestResponseInformation
// 88,PropResponseTopic "\130\185\189\255\216\159\223\245\210h\159\225\DC4`am\193\FS\201\&7
// iq\148\DLE\220\205\NAK",PropAuthenticationData
// "WX\180\215\FS\DC2/\252\238\172\243\159\245\&1\241",PropAuthenticationMethod "\167\200Tv\140\211\a&/",PropMaximumQoS
// 72,PropServerKeepAlive 17275,PropMessageExpiryInterval 21530,PropRequestResponseInformation 16,PropTopicAliasMaximum
// 28029,PropServerKeepAlive 12384,PropWillDelayInterval 11964,PropMessageExpiryInterval
// 28696,PropSubscriptionIdentifier 15,PropTopicAlias 13015]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0x94, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2e, 0x4,  0xfb, 0xbb, 0x1,  0x13, 0x62, 0x2,  0x19,
      0xc2, 0x15, 0x0,  0xd,  0x99, 0xe1, 0x68, 0x13, 0x64, 0x6a, 0x1,  0xd3, 0x9f, 0x88, 0x65, 0x97, 0x58, 0x12, 0x0,
      0xb,  0x91, 0x4d, 0x1b, 0x95, 0x64, 0x35, 0x33, 0x64, 0x4b, 0x69, 0x7d, 0xb,  0x9,  0x2a, 0x2a, 0x1,  0xe5, 0x1a,
      0x0,  0xe,  0x75, 0xdb, 0x43, 0xe9, 0xce, 0xc8, 0x1,  0x81, 0x72, 0xac, 0x15, 0x13, 0xd6, 0x57, 0x18, 0x0,  0x0,
      0x25, 0xa1, 0x8,  0x0,  0x11, 0x5,  0xc7, 0xcb, 0x6f, 0xab, 0x1b, 0x39, 0x9c, 0xfa, 0xfd, 0xfc, 0x76, 0xf3, 0xfd,
      0xac, 0xde, 0xab, 0x1a, 0x0,  0x1,  0xfa, 0x2a, 0x74, 0x19, 0x64, 0x19, 0x58, 0x8,  0x0,  0x1c, 0x82, 0xb9, 0xbd,
      0xff, 0xd8, 0x9f, 0xdf, 0xf5, 0xd2, 0x68, 0x9f, 0xe1, 0x14, 0x60, 0x61, 0x6d, 0xc1, 0x1c, 0xc9, 0x37, 0x20, 0x69,
      0x71, 0x94, 0x10, 0xdc, 0xcd, 0x15, 0x16, 0x0,  0xf,  0x57, 0x58, 0xb4, 0xd7, 0x1c, 0x12, 0x2f, 0xfc, 0xee, 0xac,
      0xf3, 0x9f, 0xf5, 0x31, 0xf1, 0x15, 0x0,  0x9,  0xa7, 0xc8, 0x54, 0x76, 0x8c, 0xd3, 0x7,  0x26, 0x2f, 0x24, 0x48,
      0x13, 0x43, 0x7b, 0x2,  0x0,  0x0,  0x54, 0x1a, 0x19, 0x10, 0x22, 0x6d, 0x7d, 0x13, 0x30, 0x60, 0x18, 0x0,  0x0,
      0x2e, 0xbc, 0x2,  0x0,  0x0,  0x70, 0x18, 0xb,  0xf,  0x23, 0x32, 0xd7, 0x0,  0x10, 0x5e, 0xe8, 0xd7, 0xa3, 0xd0,
      0xbe, 0x8b, 0xe9, 0x54, 0xef, 0xf,  0x8b, 0xb,  0x7a, 0x36, 0x7d, 0x2,  0x29, 0xab, 0x0,  0x1e, 0x5c, 0xff, 0xf6,
      0x1e, 0x3c, 0xd4, 0x2b, 0xdc, 0xf8, 0xc7, 0xec, 0x84, 0xb9, 0x1f, 0x5d, 0x44, 0x89, 0xba, 0x35, 0xc1, 0xd,  0xa,
      0xed, 0xb5, 0xe7, 0xf6, 0x36, 0xee, 0xd3, 0xdd, 0x0,  0x16, 0x23, 0x25, 0x60, 0x6c, 0x44, 0x68, 0xde, 0x93, 0xc9,
      0x9b, 0x65, 0x99, 0x88, 0x83, 0x20, 0x5b, 0x39, 0x6c, 0x1d, 0xe1, 0x0,  0x5e};

  uint8_t buf[289] = {0};

  uint8_t bytesprops0[] = {0x99, 0xe1, 0x68, 0x13, 0x64, 0x6a, 0x1, 0xd3, 0x9f, 0x88, 0x65, 0x97, 0x58};
  uint8_t bytesprops1[] = {0x91, 0x4d, 0x1b, 0x95, 0x64, 0x35, 0x33, 0x64, 0x4b, 0x69, 0x7d};
  uint8_t bytesprops2[] = {0x75, 0xdb, 0x43, 0xe9, 0xce, 0xc8, 0x1, 0x81, 0x72, 0xac, 0x15, 0x13, 0xd6, 0x57};
  uint8_t bytesprops3[] = {0x5,  0xc7, 0xcb, 0x6f, 0xab, 0x1b, 0x39, 0x9c, 0xfa,
                           0xfd, 0xfc, 0x76, 0xf3, 0xfd, 0xac, 0xde, 0xab};
  uint8_t bytesprops4[] = {0xfa};
  uint8_t bytesprops5[] = {0x82, 0xb9, 0xbd, 0xff, 0xd8, 0x9f, 0xdf, 0xf5, 0xd2, 0x68, 0x9f, 0xe1, 0x14, 0x60,
                           0x61, 0x6d, 0xc1, 0x1c, 0xc9, 0x37, 0x20, 0x69, 0x71, 0x94, 0x10, 0xdc, 0xcd, 0x15};
  uint8_t bytesprops6[] = {0x57, 0x58, 0xb4, 0xd7, 0x1c, 0x12, 0x2f, 0xfc, 0xee, 0xac, 0xf3, 0x9f, 0xf5, 0x31, 0xf1};
  uint8_t bytesprops7[] = {0xa7, 0xc8, 0x54, 0x76, 0x8c, 0xd3, 0x7, 0x26, 0x2f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25090}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9633}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17275}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21530}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28029}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12384}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11964}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28696}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13015}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 171}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0xff, 0xf6, 0x1e, 0x3c, 0xd4, 0x2b, 0xdc, 0xf8, 0xc7,
                                0xec, 0x84, 0xb9, 0x1f, 0x5d, 0x44, 0x89, 0xba, 0x35, 0xc1,
                                0xd,  0xa,  0xed, 0xb5, 0xe7, 0xf6, 0x36, 0xee, 0xd3, 0xdd};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x23, 0x25, 0x60, 0x6c, 0x44, 0x68, 0xde, 0x93, 0xc9, 0x9b, 0x65,
                                  0x99, 0x88, 0x83, 0x20, 0x5b, 0x39, 0x6c, 0x1d, 0xe1, 0x0,  0x5e};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1275;
  uint8_t client_id_bytes[] = {0x5e, 0xe8, 0xd7, 0xa3, 0xd0, 0xbe, 0x8b, 0xe9,
                               0x54, 0xef, 0xf,  0x8b, 0xb,  0x7a, 0x36, 0x7d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\212\226\154\ACK\136\237\149\159E\153\b\253\235\250\216\160\201\EM3P\152^\232", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "\128\194\131j\171v\201pWuH\170{=\145O\211\DC3'", _willMsg =
// "\190\132\174 \"\169\179\253\204\&5T\243\160\140^\179\204\131\218H\"6\191lW\184\171d\161K", _willProps =
// [PropResponseInformation
// "\213\250\210\174\160\213\174\236\&4XZ\192\GS\212\\\202\186zvdg\195~\202\240\ESC",PropSubscriptionIdentifierAvailable
// 165,PropTopicAliasMaximum 5284,PropAuthenticationData "|$\183\205\224\&9",PropResponseInformation
// "2T*T\212\251\231\188\240\131\203|\180\168",PropMaximumPacketSize 16,PropTopicAlias 3988,PropMaximumQoS
// 190,PropMessageExpiryInterval 32549,PropPayloadFormatIndicator 165]}), _cleanSession = True, _keepAlive = 30712,
// _connID = "6", _properties = [PropAuthenticationData "\159\212\&4\r\184\DLE",PropResponseTopic
// "\SO\183\148",PropTopicAliasMaximum 25003,PropRequestResponseInformation 220,PropAssignedClientIdentifier
// "\US\185\191\147S\242)\DC3\169@YO\146^\219?\EM",PropUserProperty "\141r\141-\164)n\205U\237d\158\162w^7"
// "\200\167m+\194v\244\142\176\135F \206\154\&2m\EOTsZ&TD+z\185\161",PropAuthenticationData
// "9Vn\235|\n\193\149\206\241r-u",PropAssignedClientIdentifier
// "\RS\145\188\r\241\EOTA\237\v(",PropMessageExpiryInterval 27528,PropWildcardSubscriptionAvailable
// 106,PropMessageExpiryInterval 26165,PropMessageExpiryInterval 16789,PropSubscriptionIdentifierAvailable
// 89,PropRetainAvailable 196,PropSessionExpiryInterval 520,PropAuthenticationMethod
// ",\171\239\149\170",PropResponseInformation "\a3\ACKq\234",PropRequestProblemInformation
// 197,PropSharedSubscriptionAvailable 146,PropResponseInformation
// "t]k\155\178}jP\179",PropWildcardSubscriptionAvailable 93,PropUserProperty "Jh\DC2\RS\202\217\254\163\230\\"
// "Cq\212Y3s\186::B\145\171\146\131\f"]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x77, 0xf8, 0xce, 0x1,  0x16, 0x0,  0x6,  0x9f,
      0xd4, 0x34, 0xd,  0xb8, 0x10, 0x8,  0x0,  0x3,  0xe,  0xb7, 0x94, 0x22, 0x61, 0xab, 0x19, 0xdc, 0x12, 0x0,  0x11,
      0x1f, 0xb9, 0xbf, 0x93, 0x53, 0xf2, 0x29, 0x13, 0xa9, 0x40, 0x59, 0x4f, 0x92, 0x5e, 0xdb, 0x3f, 0x19, 0x26, 0x0,
      0x10, 0x8d, 0x72, 0x8d, 0x2d, 0xa4, 0x29, 0x6e, 0xcd, 0x55, 0xed, 0x64, 0x9e, 0xa2, 0x77, 0x5e, 0x37, 0x0,  0x1a,
      0xc8, 0xa7, 0x6d, 0x2b, 0xc2, 0x76, 0xf4, 0x8e, 0xb0, 0x87, 0x46, 0x20, 0xce, 0x9a, 0x32, 0x6d, 0x4,  0x73, 0x5a,
      0x26, 0x54, 0x44, 0x2b, 0x7a, 0xb9, 0xa1, 0x16, 0x0,  0xd,  0x39, 0x56, 0x6e, 0xeb, 0x7c, 0xa,  0xc1, 0x95, 0xce,
      0xf1, 0x72, 0x2d, 0x75, 0x12, 0x0,  0xa,  0x1e, 0x91, 0xbc, 0xd,  0xf1, 0x4,  0x41, 0xed, 0xb,  0x28, 0x2,  0x0,
      0x0,  0x6b, 0x88, 0x28, 0x6a, 0x2,  0x0,  0x0,  0x66, 0x35, 0x2,  0x0,  0x0,  0x41, 0x95, 0x29, 0x59, 0x25, 0xc4,
      0x11, 0x0,  0x0,  0x2,  0x8,  0x15, 0x0,  0x5,  0x2c, 0xab, 0xef, 0x95, 0xaa, 0x1a, 0x0,  0x5,  0x7,  0x33, 0x6,
      0x71, 0xea, 0x17, 0xc5, 0x2a, 0x92, 0x1a, 0x0,  0x9,  0x74, 0x5d, 0x6b, 0x9b, 0xb2, 0x7d, 0x6a, 0x50, 0xb3, 0x28,
      0x5d, 0x26, 0x0,  0xa,  0x4a, 0x68, 0x12, 0x1e, 0xca, 0xd9, 0xfe, 0xa3, 0xe6, 0x5c, 0x0,  0xf,  0x43, 0x71, 0xd4,
      0x59, 0x33, 0x73, 0xba, 0x3a, 0x3a, 0x42, 0x91, 0xab, 0x92, 0x83, 0xc,  0x0,  0x1,  0x36, 0x4d, 0x1a, 0x0,  0x1a,
      0xd5, 0xfa, 0xd2, 0xae, 0xa0, 0xd5, 0xae, 0xec, 0x34, 0x58, 0x5a, 0xc0, 0x1d, 0xd4, 0x5c, 0xca, 0xba, 0x7a, 0x76,
      0x64, 0x67, 0xc3, 0x7e, 0xca, 0xf0, 0x1b, 0x29, 0xa5, 0x22, 0x14, 0xa4, 0x16, 0x0,  0x6,  0x7c, 0x24, 0xb7, 0xcd,
      0xe0, 0x39, 0x1a, 0x0,  0xe,  0x32, 0x54, 0x2a, 0x54, 0xd4, 0xfb, 0xe7, 0xbc, 0xf0, 0x83, 0xcb, 0x7c, 0xb4, 0xa8,
      0x27, 0x0,  0x0,  0x0,  0x10, 0x23, 0xf,  0x94, 0x24, 0xbe, 0x2,  0x0,  0x0,  0x7f, 0x25, 0x1,  0xa5, 0x0,  0x13,
      0x80, 0xc2, 0x83, 0x6a, 0xab, 0x76, 0xc9, 0x70, 0x57, 0x75, 0x48, 0xaa, 0x7b, 0x3d, 0x91, 0x4f, 0xd3, 0x13, 0x27,
      0x0,  0x1e, 0xbe, 0x84, 0xae, 0x20, 0x22, 0xa9, 0xb3, 0xfd, 0xcc, 0x35, 0x54, 0xf3, 0xa0, 0x8c, 0x5e, 0xb3, 0xcc,
      0x83, 0xda, 0x48, 0x22, 0x36, 0xbf, 0x6c, 0x57, 0xb8, 0xab, 0x64, 0xa1, 0x4b};

  uint8_t buf[365] = {0};

  uint8_t bytesprops0[] = {0x9f, 0xd4, 0x34, 0xd, 0xb8, 0x10};
  uint8_t bytesprops1[] = {0xe, 0xb7, 0x94};
  uint8_t bytesprops2[] = {0x1f, 0xb9, 0xbf, 0x93, 0x53, 0xf2, 0x29, 0x13, 0xa9,
                           0x40, 0x59, 0x4f, 0x92, 0x5e, 0xdb, 0x3f, 0x19};
  uint8_t bytesprops4[] = {0xc8, 0xa7, 0x6d, 0x2b, 0xc2, 0x76, 0xf4, 0x8e, 0xb0, 0x87, 0x46, 0x20, 0xce,
                           0x9a, 0x32, 0x6d, 0x4,  0x73, 0x5a, 0x26, 0x54, 0x44, 0x2b, 0x7a, 0xb9, 0xa1};
  uint8_t bytesprops3[] = {0x8d, 0x72, 0x8d, 0x2d, 0xa4, 0x29, 0x6e, 0xcd,
                           0x55, 0xed, 0x64, 0x9e, 0xa2, 0x77, 0x5e, 0x37};
  uint8_t bytesprops5[] = {0x39, 0x56, 0x6e, 0xeb, 0x7c, 0xa, 0xc1, 0x95, 0xce, 0xf1, 0x72, 0x2d, 0x75};
  uint8_t bytesprops6[] = {0x1e, 0x91, 0xbc, 0xd, 0xf1, 0x4, 0x41, 0xed, 0xb, 0x28};
  uint8_t bytesprops7[] = {0x2c, 0xab, 0xef, 0x95, 0xaa};
  uint8_t bytesprops8[] = {0x7, 0x33, 0x6, 0x71, 0xea};
  uint8_t bytesprops9[] = {0x74, 0x5d, 0x6b, 0x9b, 0xb2, 0x7d, 0x6a, 0x50, 0xb3};
  uint8_t bytesprops11[] = {0x43, 0x71, 0xd4, 0x59, 0x33, 0x73, 0xba, 0x3a, 0x3a, 0x42, 0x91, 0xab, 0x92, 0x83, 0xc};
  uint8_t bytesprops10[] = {0x4a, 0x68, 0x12, 0x1e, 0xca, 0xd9, 0xfe, 0xa3, 0xe6, 0x5c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25003}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops3}, .v = {26, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27528}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26165}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16789}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 520}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&bytesprops10}, .v = {15, (char*)&bytesprops11}}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd5, 0xfa, 0xd2, 0xae, 0xa0, 0xd5, 0xae, 0xec, 0x34, 0x58, 0x5a, 0xc0, 0x1d,
                               0xd4, 0x5c, 0xca, 0xba, 0x7a, 0x76, 0x64, 0x67, 0xc3, 0x7e, 0xca, 0xf0, 0x1b};
  uint8_t byteswillprops1[] = {0x7c, 0x24, 0xb7, 0xcd, 0xe0, 0x39};
  uint8_t byteswillprops2[] = {0x32, 0x54, 0x2a, 0x54, 0xd4, 0xfb, 0xe7, 0xbc, 0xf0, 0x83, 0xcb, 0x7c, 0xb4, 0xa8};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5284}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3988}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32549}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 165}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0xc2, 0x83, 0x6a, 0xab, 0x76, 0xc9, 0x70, 0x57, 0x75,
                                0x48, 0xaa, 0x7b, 0x3d, 0x91, 0x4f, 0xd3, 0x13, 0x27};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbe, 0x84, 0xae, 0x20, 0x22, 0xa9, 0xb3, 0xfd, 0xcc, 0x35,
                                  0x54, 0xf3, 0xa0, 0x8c, 0x5e, 0xb3, 0xcc, 0x83, 0xda, 0x48,
                                  0x22, 0x36, 0xbf, 0x6c, 0x57, 0xb8, 0xab, 0x64, 0xa1, 0x4b};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30712;
  uint8_t client_id_bytes[] = {0x36};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd4, 0xe2, 0x9a, 0x6,  0x88, 0xed, 0x95, 0x9f, 0x45, 0x99, 0x8, 0xfd,
                              0xeb, 0xfa, 0xd8, 0xa0, 0xc9, 0x19, 0x33, 0x50, 0x98, 0x5e, 0xe8};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\RSd\"\EOT.m'\DLE%\174\130S\229\172\198\176\&1\140&\228\RS\149\248\232\234",
// _password = Just "\216\183u\FS\184\187\239\148\140X\251\143\153s\176\218\&3s\168", _lastWill = Nothing, _cleanSession
// = True, _keepAlive = 24465, _connID = "\145\244\189\239z\131f", _properties = [PropMessageExpiryInterval
// 25911,PropMessageExpiryInterval 26152,PropRetainAvailable 109,PropWillDelayInterval 1298,PropMaximumPacketSize
// 1990,PropAssignedClientIdentifier "\227\191\148\NUL\ETB\SYNnU",PropWildcardSubscriptionAvailable 81,PropUserProperty
// "\183Z\214\198\215v\254ar\128\v\178\DC2\203mj" "",PropSessionExpiryInterval 6212,PropReceiveMaximum
// 1155,PropTopicAlias 10564,PropResponseTopic
// "\171#\144\222\DC2\195y\220#\183V?y\144\145\187#\219\159",PropAssignedClientIdentifier
// "\230l\250\137/\224\215\n\248n\252\t\194\&9",PropSharedSubscriptionAvailable 20,PropCorrelationData
// "",PropResponseTopic "Lq\184\226\204\158Y\207g\250\136\NAK\128",PropSubscriptionIdentifierAvailable
// 197,PropRetainAvailable 146]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0xc9, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x5f, 0x91, 0x83, 0x1,  0x2,  0x0,  0x0,  0x65,
      0x37, 0x2,  0x0,  0x0,  0x66, 0x28, 0x25, 0x6d, 0x18, 0x0,  0x0,  0x5,  0x12, 0x27, 0x0,  0x0,  0x7,  0xc6, 0x12,
      0x0,  0x8,  0xe3, 0xbf, 0x94, 0x0,  0x17, 0x16, 0x6e, 0x55, 0x28, 0x51, 0x26, 0x0,  0x10, 0xb7, 0x5a, 0xd6, 0xc6,
      0xd7, 0x76, 0xfe, 0x61, 0x72, 0x80, 0xb,  0xb2, 0x12, 0xcb, 0x6d, 0x6a, 0x0,  0x0,  0x11, 0x0,  0x0,  0x18, 0x44,
      0x21, 0x4,  0x83, 0x23, 0x29, 0x44, 0x8,  0x0,  0x13, 0xab, 0x23, 0x90, 0xde, 0x12, 0xc3, 0x79, 0xdc, 0x23, 0xb7,
      0x56, 0x3f, 0x79, 0x90, 0x91, 0xbb, 0x23, 0xdb, 0x9f, 0x12, 0x0,  0xe,  0xe6, 0x6c, 0xfa, 0x89, 0x2f, 0xe0, 0xd7,
      0xa,  0xf8, 0x6e, 0xfc, 0x9,  0xc2, 0x39, 0x2a, 0x14, 0x9,  0x0,  0x0,  0x8,  0x0,  0xd,  0x4c, 0x71, 0xb8, 0xe2,
      0xcc, 0x9e, 0x59, 0xcf, 0x67, 0xfa, 0x88, 0x15, 0x80, 0x29, 0xc5, 0x25, 0x92, 0x0,  0x7,  0x91, 0xf4, 0xbd, 0xef,
      0x7a, 0x83, 0x66, 0x0,  0x1a, 0x4a, 0x1e, 0x64, 0x22, 0x4,  0x2e, 0x6d, 0x27, 0x10, 0x25, 0xae, 0x82, 0x53, 0xe5,
      0xac, 0xc6, 0xb0, 0x31, 0x8c, 0x26, 0xe4, 0x1e, 0x95, 0xf8, 0xe8, 0xea, 0x0,  0x13, 0xd8, 0xb7, 0x75, 0x1c, 0xb8,
      0xbb, 0xef, 0x94, 0x8c, 0x58, 0xfb, 0x8f, 0x99, 0x73, 0xb0, 0xda, 0x33, 0x73, 0xa8};

  uint8_t buf[214] = {0};

  uint8_t bytesprops0[] = {0xe3, 0xbf, 0x94, 0x0, 0x17, 0x16, 0x6e, 0x55};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops1[] = {0xb7, 0x5a, 0xd6, 0xc6, 0xd7, 0x76, 0xfe, 0x61,
                           0x72, 0x80, 0xb,  0xb2, 0x12, 0xcb, 0x6d, 0x6a};
  uint8_t bytesprops3[] = {0xab, 0x23, 0x90, 0xde, 0x12, 0xc3, 0x79, 0xdc, 0x23, 0xb7,
                           0x56, 0x3f, 0x79, 0x90, 0x91, 0xbb, 0x23, 0xdb, 0x9f};
  uint8_t bytesprops4[] = {0xe6, 0x6c, 0xfa, 0x89, 0x2f, 0xe0, 0xd7, 0xa, 0xf8, 0x6e, 0xfc, 0x9, 0xc2, 0x39};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x4c, 0x71, 0xb8, 0xe2, 0xcc, 0x9e, 0x59, 0xcf, 0x67, 0xfa, 0x88, 0x15, 0x80};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25911}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26152}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1298}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1990}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {0, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6212}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1155}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10564}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 146}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24465;
  uint8_t client_id_bytes[] = {0x91, 0xf4, 0xbd, 0xef, 0x7a, 0x83, 0x66};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x1e, 0x64, 0x22, 0x4,  0x2e, 0x6d, 0x27, 0x10, 0x25, 0xae, 0x82, 0x53,
                              0xe5, 0xac, 0xc6, 0xb0, 0x31, 0x8c, 0x26, 0xe4, 0x1e, 0x95, 0xf8, 0xe8, 0xea};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd8, 0xb7, 0x75, 0x1c, 0xb8, 0xbb, 0xef, 0x94, 0x8c, 0x58,
                              0xfb, 0x8f, 0x99, 0x73, 0xb0, 0xda, 0x33, 0x73, 0xa8};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\168\152\190:\152\"\217OGs\207_\233\129\248**\131N\190\167q;\253\ETB", _password =
// Just "hq\130\190\144\NUL\227\253\208\215\224\167\FS\203\EOT(\169\158\166\134)g\184\233\145\138*u", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 147, _connID = "\198@\194\222\146s", _properties =
// [PropPayloadFormatIndicator 143,PropCorrelationData
// "\157Ea4\197\&8\202\EOTAd\US\151\142\&9sC\163O\232\150\239\&0-\176\201\143?\217(",PropMaximumQoS
// 147,PropWildcardSubscriptionAvailable 91,PropAuthenticationData
// "\148\ENQ\ETX\197UL\188Q\232\221S\245\172",PropWillDelayInterval 29870,PropSubscriptionIdentifier
// 11,PropPayloadFormatIndicator 220,PropResponseInformation
// "\DC4\DEL\STX\158\SUB\DLE\ACK\DLE\154\204\223\161\DC4\249\212:\245D\174:\147sA\247\147H\240",PropReasonString
// "\DC1\146\254\142\222\171xo\159%\SO/",PropAssignedClientIdentifier "l",PropPayloadFormatIndicator
// 86,PropRequestResponseInformation 19,PropReasonString
// "\174\167r\166\217>\NUL}Z\154eu\252\234\136#Q\199\221\253\185\227\245\253",PropRequestResponseInformation
// 241,PropContentType "\191\251O\179\DC2\163\&9$\162\190&\144;~)\191Q\251",PropSubscriptionIdentifier
// 10,PropUserProperty "\144\193k\172\172\"\STX\162" "U\215\EOT\204\214\255\DC2dk\198\250\160",PropContentType
// "\190\156:6\145\195\186\167\144X\221Zq\224\228n\131P\240\171\172:\GSc",PropContentType
// "J\FS\180\187\130\&9\249\188&\215\a\244\SUBw\ao\215\203\171\199uCb",PropSharedSubscriptionAvailable
// 255,PropAssignedClientIdentifier "\138\133\203?"]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0xcc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x0,  0x93, 0xff, 0x1,  0x1,  0x8f, 0x9,  0x0,
      0x1d, 0x9d, 0x45, 0x61, 0x34, 0xc5, 0x38, 0xca, 0x4,  0x41, 0x64, 0x1f, 0x97, 0x8e, 0x39, 0x73, 0x43, 0xa3, 0x4f,
      0xe8, 0x96, 0xef, 0x30, 0x2d, 0xb0, 0xc9, 0x8f, 0x3f, 0xd9, 0x28, 0x24, 0x93, 0x28, 0x5b, 0x16, 0x0,  0xd,  0x94,
      0x5,  0x3,  0xc5, 0x55, 0x4c, 0xbc, 0x51, 0xe8, 0xdd, 0x53, 0xf5, 0xac, 0x18, 0x0,  0x0,  0x74, 0xae, 0xb,  0xb,
      0x1,  0xdc, 0x1a, 0x0,  0x1b, 0x14, 0x7f, 0x2,  0x9e, 0x1a, 0x10, 0x6,  0x10, 0x9a, 0xcc, 0xdf, 0xa1, 0x14, 0xf9,
      0xd4, 0x3a, 0xf5, 0x44, 0xae, 0x3a, 0x93, 0x73, 0x41, 0xf7, 0x93, 0x48, 0xf0, 0x1f, 0x0,  0xc,  0x11, 0x92, 0xfe,
      0x8e, 0xde, 0xab, 0x78, 0x6f, 0x9f, 0x25, 0xe,  0x2f, 0x12, 0x0,  0x1,  0x6c, 0x1,  0x56, 0x19, 0x13, 0x1f, 0x0,
      0x18, 0xae, 0xa7, 0x72, 0xa6, 0xd9, 0x3e, 0x0,  0x7d, 0x5a, 0x9a, 0x65, 0x75, 0xfc, 0xea, 0x88, 0x23, 0x51, 0xc7,
      0xdd, 0xfd, 0xb9, 0xe3, 0xf5, 0xfd, 0x19, 0xf1, 0x3,  0x0,  0x12, 0xbf, 0xfb, 0x4f, 0xb3, 0x12, 0xa3, 0x39, 0x24,
      0xa2, 0xbe, 0x26, 0x90, 0x3b, 0x7e, 0x29, 0xbf, 0x51, 0xfb, 0xb,  0xa,  0x26, 0x0,  0x8,  0x90, 0xc1, 0x6b, 0xac,
      0xac, 0x22, 0x2,  0xa2, 0x0,  0xc,  0x55, 0xd7, 0x4,  0xcc, 0xd6, 0xff, 0x12, 0x64, 0x6b, 0xc6, 0xfa, 0xa0, 0x3,
      0x0,  0x18, 0xbe, 0x9c, 0x3a, 0x36, 0x91, 0xc3, 0xba, 0xa7, 0x90, 0x58, 0xdd, 0x5a, 0x71, 0xe0, 0xe4, 0x6e, 0x83,
      0x50, 0xf0, 0xab, 0xac, 0x3a, 0x1d, 0x63, 0x3,  0x0,  0x17, 0x4a, 0x1c, 0xb4, 0xbb, 0x82, 0x39, 0xf9, 0xbc, 0x26,
      0xd7, 0x7,  0xf4, 0x1a, 0x77, 0x7,  0x6f, 0xd7, 0xcb, 0xab, 0xc7, 0x75, 0x43, 0x62, 0x2a, 0xff, 0x12, 0x0,  0x4,
      0x8a, 0x85, 0xcb, 0x3f, 0x0,  0x6,  0xc6, 0x40, 0xc2, 0xde, 0x92, 0x73, 0x0,  0x19, 0xa8, 0x98, 0xbe, 0x3a, 0x98,
      0x22, 0xd9, 0x4f, 0x47, 0x73, 0xcf, 0x5f, 0xe9, 0x81, 0xf8, 0x2a, 0x2a, 0x83, 0x4e, 0xbe, 0xa7, 0x71, 0x3b, 0xfd,
      0x17, 0x0,  0x1c, 0x68, 0x71, 0x82, 0xbe, 0x90, 0x0,  0xe3, 0xfd, 0xd0, 0xd7, 0xe0, 0xa7, 0x1c, 0xcb, 0x4,  0x28,
      0xa9, 0x9e, 0xa6, 0x86, 0x29, 0x67, 0xb8, 0xe9, 0x91, 0x8a, 0x2a, 0x75};

  uint8_t buf[345] = {0};

  uint8_t bytesprops0[] = {0x9d, 0x45, 0x61, 0x34, 0xc5, 0x38, 0xca, 0x4,  0x41, 0x64, 0x1f, 0x97, 0x8e, 0x39, 0x73,
                           0x43, 0xa3, 0x4f, 0xe8, 0x96, 0xef, 0x30, 0x2d, 0xb0, 0xc9, 0x8f, 0x3f, 0xd9, 0x28};
  uint8_t bytesprops1[] = {0x94, 0x5, 0x3, 0xc5, 0x55, 0x4c, 0xbc, 0x51, 0xe8, 0xdd, 0x53, 0xf5, 0xac};
  uint8_t bytesprops2[] = {0x14, 0x7f, 0x2,  0x9e, 0x1a, 0x10, 0x6,  0x10, 0x9a, 0xcc, 0xdf, 0xa1, 0x14, 0xf9,
                           0xd4, 0x3a, 0xf5, 0x44, 0xae, 0x3a, 0x93, 0x73, 0x41, 0xf7, 0x93, 0x48, 0xf0};
  uint8_t bytesprops3[] = {0x11, 0x92, 0xfe, 0x8e, 0xde, 0xab, 0x78, 0x6f, 0x9f, 0x25, 0xe, 0x2f};
  uint8_t bytesprops4[] = {0x6c};
  uint8_t bytesprops5[] = {0xae, 0xa7, 0x72, 0xa6, 0xd9, 0x3e, 0x0,  0x7d, 0x5a, 0x9a, 0x65, 0x75,
                           0xfc, 0xea, 0x88, 0x23, 0x51, 0xc7, 0xdd, 0xfd, 0xb9, 0xe3, 0xf5, 0xfd};
  uint8_t bytesprops6[] = {0xbf, 0xfb, 0x4f, 0xb3, 0x12, 0xa3, 0x39, 0x24, 0xa2,
                           0xbe, 0x26, 0x90, 0x3b, 0x7e, 0x29, 0xbf, 0x51, 0xfb};
  uint8_t bytesprops8[] = {0x55, 0xd7, 0x4, 0xcc, 0xd6, 0xff, 0x12, 0x64, 0x6b, 0xc6, 0xfa, 0xa0};
  uint8_t bytesprops7[] = {0x90, 0xc1, 0x6b, 0xac, 0xac, 0x22, 0x2, 0xa2};
  uint8_t bytesprops9[] = {0xbe, 0x9c, 0x3a, 0x36, 0x91, 0xc3, 0xba, 0xa7, 0x90, 0x58, 0xdd, 0x5a,
                           0x71, 0xe0, 0xe4, 0x6e, 0x83, 0x50, 0xf0, 0xab, 0xac, 0x3a, 0x1d, 0x63};
  uint8_t bytesprops10[] = {0x4a, 0x1c, 0xb4, 0xbb, 0x82, 0x39, 0xf9, 0xbc, 0x26, 0xd7, 0x7, 0xf4,
                            0x1a, 0x77, 0x7,  0x6f, 0xd7, 0xcb, 0xab, 0xc7, 0x75, 0x43, 0x62};
  uint8_t bytesprops11[] = {0x8a, 0x85, 0xcb, 0x3f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29870}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops7}, .v = {12, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 147;
  uint8_t client_id_bytes[] = {0xc6, 0x40, 0xc2, 0xde, 0x92, 0x73};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa8, 0x98, 0xbe, 0x3a, 0x98, 0x22, 0xd9, 0x4f, 0x47, 0x73, 0xcf, 0x5f, 0xe9,
                              0x81, 0xf8, 0x2a, 0x2a, 0x83, 0x4e, 0xbe, 0xa7, 0x71, 0x3b, 0xfd, 0x17};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x68, 0x71, 0x82, 0xbe, 0x90, 0x0,  0xe3, 0xfd, 0xd0, 0xd7, 0xe0, 0xa7, 0x1c, 0xcb,
                              0x4,  0x28, 0xa9, 0x9e, 0xa6, 0x86, 0x29, 0x67, 0xb8, 0xe9, 0x91, 0x8a, 0x2a, 0x75};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "9?\213\ESC\211\DLE", _lastWill = Nothing, _cleanSession =
// False, _keepAlive = 13768, _connID =
// "x\172\tI\199\244\238\243\130\&9.\206\172\ETB\SYN\164\GS\EM\128\142S\217\184\NAK]Q\209;\SUBN", _properties =
// [PropWillDelayInterval 17575,PropUserProperty "\216u|\131\168\247\t\188\DEL\140M\183\253\195\192"
// "5\t",PropMessageExpiryInterval 10754,PropSubscriptionIdentifierAvailable 60,PropWildcardSubscriptionAvailable
// 90,PropTopicAliasMaximum 8351,PropContentType "\128}|D\139\190\235G\129\173R\DC299",PropRetainAvailable
// 39,PropWillDelayInterval 5356,PropMessageExpiryInterval 12914,PropMessageExpiryInterval 5103,PropResponseInformation
// "+\195l\250&\EOTQ\235\200\245g\189\180\246jF:\175",PropResponseInformation
// "\130\205;q\203gs\ESC\\slL\EM)4}\177\163\f~\251D2E;9\SI[\176",PropSubscriptionIdentifierAvailable
// 84,PropRetainAvailable 95,PropSubscriptionIdentifier 15,PropCorrelationData
// "\232\190\241\128\239\254\240\238\189oI\204@qq\133\128\211\133\&1\153D\221",PropReceiveMaximum 19357]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x10, 0xcd, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x35, 0xc8, 0xa1, 0x1,  0x18, 0x0,  0x0,  0x44,
      0xa7, 0x26, 0x0,  0xf,  0xd8, 0x75, 0x7c, 0x83, 0xa8, 0xf7, 0x9,  0xbc, 0x7f, 0x8c, 0x4d, 0xb7, 0xfd, 0xc3, 0xc0,
      0x0,  0x2,  0x35, 0x9,  0x2,  0x0,  0x0,  0x2a, 0x2,  0x29, 0x3c, 0x28, 0x5a, 0x22, 0x20, 0x9f, 0x3,  0x0,  0xe,
      0x80, 0x7d, 0x7c, 0x44, 0x8b, 0xbe, 0xeb, 0x47, 0x81, 0xad, 0x52, 0x12, 0x39, 0x39, 0x25, 0x27, 0x18, 0x0,  0x0,
      0x14, 0xec, 0x2,  0x0,  0x0,  0x32, 0x72, 0x2,  0x0,  0x0,  0x13, 0xef, 0x1a, 0x0,  0x12, 0x2b, 0xc3, 0x6c, 0xfa,
      0x26, 0x4,  0x51, 0xeb, 0xc8, 0xf5, 0x67, 0xbd, 0xb4, 0xf6, 0x6a, 0x46, 0x3a, 0xaf, 0x1a, 0x0,  0x1d, 0x82, 0xcd,
      0x3b, 0x71, 0xcb, 0x67, 0x73, 0x1b, 0x5c, 0x73, 0x6c, 0x4c, 0x19, 0x29, 0x34, 0x7d, 0xb1, 0xa3, 0xc,  0x7e, 0xfb,
      0x44, 0x32, 0x45, 0x3b, 0x39, 0xf,  0x5b, 0xb0, 0x29, 0x54, 0x25, 0x5f, 0xb,  0xf,  0x9,  0x0,  0x17, 0xe8, 0xbe,
      0xf1, 0x80, 0xef, 0xfe, 0xf0, 0xee, 0xbd, 0x6f, 0x49, 0xcc, 0x40, 0x71, 0x71, 0x85, 0x80, 0xd3, 0x85, 0x31, 0x99,
      0x44, 0xdd, 0x21, 0x4b, 0x9d, 0x0,  0x1e, 0x78, 0xac, 0x9,  0x49, 0xc7, 0xf4, 0xee, 0xf3, 0x82, 0x39, 0x2e, 0xce,
      0xac, 0x17, 0x16, 0xa4, 0x1d, 0x19, 0x80, 0x8e, 0x53, 0xd9, 0xb8, 0x15, 0x5d, 0x51, 0xd1, 0x3b, 0x1a, 0x4e};

  uint8_t buf[218] = {0};

  uint8_t bytesprops1[] = {0x35, 0x9};
  uint8_t bytesprops0[] = {0xd8, 0x75, 0x7c, 0x83, 0xa8, 0xf7, 0x9, 0xbc, 0x7f, 0x8c, 0x4d, 0xb7, 0xfd, 0xc3, 0xc0};
  uint8_t bytesprops2[] = {0x80, 0x7d, 0x7c, 0x44, 0x8b, 0xbe, 0xeb, 0x47, 0x81, 0xad, 0x52, 0x12, 0x39, 0x39};
  uint8_t bytesprops3[] = {0x2b, 0xc3, 0x6c, 0xfa, 0x26, 0x4,  0x51, 0xeb, 0xc8,
                           0xf5, 0x67, 0xbd, 0xb4, 0xf6, 0x6a, 0x46, 0x3a, 0xaf};
  uint8_t bytesprops4[] = {0x82, 0xcd, 0x3b, 0x71, 0xcb, 0x67, 0x73, 0x1b, 0x5c, 0x73, 0x6c, 0x4c, 0x19, 0x29, 0x34,
                           0x7d, 0xb1, 0xa3, 0xc,  0x7e, 0xfb, 0x44, 0x32, 0x45, 0x3b, 0x39, 0xf,  0x5b, 0xb0};
  uint8_t bytesprops5[] = {0xe8, 0xbe, 0xf1, 0x80, 0xef, 0xfe, 0xf0, 0xee, 0xbd, 0x6f, 0x49, 0xcc,
                           0x40, 0x71, 0x71, 0x85, 0x80, 0xd3, 0x85, 0x31, 0x99, 0x44, 0xdd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17575}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {2, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10754}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8351}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5356}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12914}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5103}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19357}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13768;
  uint8_t client_id_bytes[] = {0x78, 0xac, 0x9,  0x49, 0xc7, 0xf4, 0xee, 0xf3, 0x82, 0x39,
                               0x2e, 0xce, 0xac, 0x17, 0x16, 0xa4, 0x1d, 0x19, 0x80, 0x8e,
                               0x53, 0xd9, 0xb8, 0x15, 0x5d, 0x51, 0xd1, 0x3b, 0x1a, 0x4e};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x39, 0x3f, 0xd5, 0x1b, 0xd3, 0x10};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// ";\152\206s\182\199\197\227\135\ACK\251\"Z\DLE\203\162ab\203\169\203\208\172\230\&6\EOT8eS`", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "", _willMsg = "\157\160\156\193A", _willProps =
// [PropRetainAvailable 238,PropMessageExpiryInterval 5930,PropAuthenticationMethod
// "\177\238/\141%\149i\155\170\a\204",PropRequestResponseInformation 202,PropPayloadFormatIndicator
// 52,PropRequestResponseInformation 250,PropAuthenticationMethod "?\133\191\230\140x*Q\172",PropSubscriptionIdentifier
// 14,PropReceiveMaximum 30728,PropAssignedClientIdentifier "_\EM\196\215",PropAssignedClientIdentifier
// "\192>E\160Z\211'\218\196\ENQ",PropCorrelationData "%\247(6\170",PropSubscriptionIdentifierAvailable 149]}),
// _cleanSession = False, _keepAlive = 23561, _connID = "\228\240", _properties = [PropMessageExpiryInterval
// 22985,PropAssignedClientIdentifier "\142P\178\230\194\176[\ETB\182\&5\163\230c\SYNB",PropWillDelayInterval
// 27154,PropWillDelayInterval 26341]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x84, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2c, 0x5c, 0x9,  0x21, 0x2,  0x0,  0x0,
                   0x59, 0xc9, 0x12, 0x0,  0xf,  0x8e, 0x50, 0xb2, 0xe6, 0xc2, 0xb0, 0x5b, 0x17, 0xb6, 0x35, 0xa3, 0xe6,
                   0x63, 0x16, 0x42, 0x18, 0x0,  0x0,  0x6a, 0x12, 0x18, 0x0,  0x0,  0x66, 0xe5, 0x0,  0x2,  0xe4, 0xf0,
                   0x4a, 0x25, 0xee, 0x2,  0x0,  0x0,  0x17, 0x2a, 0x15, 0x0,  0xb,  0xb1, 0xee, 0x2f, 0x8d, 0x25, 0x95,
                   0x69, 0x9b, 0xaa, 0x7,  0xcc, 0x19, 0xca, 0x1,  0x34, 0x19, 0xfa, 0x15, 0x0,  0x9,  0x3f, 0x85, 0xbf,
                   0xe6, 0x8c, 0x78, 0x2a, 0x51, 0xac, 0xb,  0xe,  0x21, 0x78, 0x8,  0x12, 0x0,  0x4,  0x5f, 0x19, 0xc4,
                   0xd7, 0x12, 0x0,  0xa,  0xc0, 0x3e, 0x45, 0xa0, 0x5a, 0xd3, 0x27, 0xda, 0xc4, 0x5,  0x9,  0x0,  0x5,
                   0x25, 0xf7, 0x28, 0x36, 0xaa, 0x29, 0x95, 0x0,  0x0,  0x0,  0x5,  0x9d, 0xa0, 0x9c, 0xc1, 0x41};

  uint8_t buf[145] = {0};

  uint8_t bytesprops0[] = {0x8e, 0x50, 0xb2, 0xe6, 0xc2, 0xb0, 0x5b, 0x17, 0xb6, 0x35, 0xa3, 0xe6, 0x63, 0x16, 0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22985}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27154}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26341}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb1, 0xee, 0x2f, 0x8d, 0x25, 0x95, 0x69, 0x9b, 0xaa, 0x7, 0xcc};
  uint8_t byteswillprops1[] = {0x3f, 0x85, 0xbf, 0xe6, 0x8c, 0x78, 0x2a, 0x51, 0xac};
  uint8_t byteswillprops2[] = {0x5f, 0x19, 0xc4, 0xd7};
  uint8_t byteswillprops3[] = {0xc0, 0x3e, 0x45, 0xa0, 0x5a, 0xd3, 0x27, 0xda, 0xc4, 0x5};
  uint8_t byteswillprops4[] = {0x25, 0xf7, 0x28, 0x36, 0xaa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5930}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30728}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 149}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9d, 0xa0, 0x9c, 0xc1, 0x41};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23561;
  uint8_t client_id_bytes[] = {0xe4, 0xf0};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x3b, 0x98, 0xce, 0x73, 0xb6, 0xc7, 0xc5, 0xe3, 0x87, 0x6,  0xfb, 0x22, 0x5a, 0x10, 0xcb,
                              0xa2, 0x61, 0x62, 0xcb, 0xa9, 0xcb, 0xd0, 0xac, 0xe6, 0x36, 0x4,  0x38, 0x65, 0x53, 0x60};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\254\245:\136]\202n\222\DC3n\218\215\210", _password = Just
// "6\234}\152\181\DC2\ACKM\245:\DC2\ENQ\249\205q+", _lastWill = Nothing, _cleanSession = True, _keepAlive = 2628,
// _connID = "\131/w\176\163", _properties = [PropResponseTopic "f\173jnbG<z\233t\132",PropRequestResponseInformation
// 149,PropPayloadFormatIndicator 28,PropAuthenticationData ".\255\193\SOH}\141",PropSessionExpiryInterval
// 5859,PropSharedSubscriptionAvailable 245,PropWillDelayInterval 4142,PropUserProperty
// "\162BrQ\181\173X\248|\SUB;\ETX'\253L\175\DC2\193\151\253\142" "\186c",PropServerReference
// ">\135\200\&5)\226B<\137&Z",PropSubscriptionIdentifier 9,PropSharedSubscriptionAvailable
// 223,PropPayloadFormatIndicator 104,PropResponseInformation
// "\DLE\242\&5\231K\158\147o-\230\140\230u\246\206\211\250\225.G1H",PropSubscriptionIdentifierAvailable
// 29,PropAuthenticationData "!f\179a\254&k\SOH\222\149\&6\168\196v\158qD\ETB\159\RS\f\232\172s"]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0xc1, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0xa,  0x44, 0x8d, 0x1,  0x8,  0x0,
                   0xb,  0x66, 0xad, 0x6a, 0x6e, 0x62, 0x47, 0x3c, 0x7a, 0xe9, 0x74, 0x84, 0x19, 0x95, 0x1,  0x1c, 0x16,
                   0x0,  0x6,  0x2e, 0xff, 0xc1, 0x1,  0x7d, 0x8d, 0x11, 0x0,  0x0,  0x16, 0xe3, 0x2a, 0xf5, 0x18, 0x0,
                   0x0,  0x10, 0x2e, 0x26, 0x0,  0x15, 0xa2, 0x42, 0x72, 0x51, 0xb5, 0xad, 0x58, 0xf8, 0x7c, 0x1a, 0x3b,
                   0x3,  0x27, 0xfd, 0x4c, 0xaf, 0x12, 0xc1, 0x97, 0xfd, 0x8e, 0x0,  0x2,  0xba, 0x63, 0x1c, 0x0,  0xb,
                   0x3e, 0x87, 0xc8, 0x35, 0x29, 0xe2, 0x42, 0x3c, 0x89, 0x26, 0x5a, 0xb,  0x9,  0x2a, 0xdf, 0x1,  0x68,
                   0x1a, 0x0,  0x16, 0x10, 0xf2, 0x35, 0xe7, 0x4b, 0x9e, 0x93, 0x6f, 0x2d, 0xe6, 0x8c, 0xe6, 0x75, 0xf6,
                   0xce, 0xd3, 0xfa, 0xe1, 0x2e, 0x47, 0x31, 0x48, 0x29, 0x1d, 0x16, 0x0,  0x18, 0x21, 0x66, 0xb3, 0x61,
                   0xfe, 0x26, 0x6b, 0x1,  0xde, 0x95, 0x36, 0xa8, 0xc4, 0x76, 0x9e, 0x71, 0x44, 0x17, 0x9f, 0x1e, 0xc,
                   0xe8, 0xac, 0x73, 0x0,  0x5,  0x83, 0x2f, 0x77, 0xb0, 0xa3, 0x0,  0xd,  0xfe, 0xf5, 0x3a, 0x88, 0x5d,
                   0xca, 0x6e, 0xde, 0x13, 0x6e, 0xda, 0xd7, 0xd2, 0x0,  0x10, 0x36, 0xea, 0x7d, 0x98, 0xb5, 0x12, 0x6,
                   0x4d, 0xf5, 0x3a, 0x12, 0x5,  0xf9, 0xcd, 0x71, 0x2b};

  uint8_t buf[206] = {0};

  uint8_t bytesprops0[] = {0x66, 0xad, 0x6a, 0x6e, 0x62, 0x47, 0x3c, 0x7a, 0xe9, 0x74, 0x84};
  uint8_t bytesprops1[] = {0x2e, 0xff, 0xc1, 0x1, 0x7d, 0x8d};
  uint8_t bytesprops3[] = {0xba, 0x63};
  uint8_t bytesprops2[] = {0xa2, 0x42, 0x72, 0x51, 0xb5, 0xad, 0x58, 0xf8, 0x7c, 0x1a, 0x3b,
                           0x3,  0x27, 0xfd, 0x4c, 0xaf, 0x12, 0xc1, 0x97, 0xfd, 0x8e};
  uint8_t bytesprops4[] = {0x3e, 0x87, 0xc8, 0x35, 0x29, 0xe2, 0x42, 0x3c, 0x89, 0x26, 0x5a};
  uint8_t bytesprops5[] = {0x10, 0xf2, 0x35, 0xe7, 0x4b, 0x9e, 0x93, 0x6f, 0x2d, 0xe6, 0x8c,
                           0xe6, 0x75, 0xf6, 0xce, 0xd3, 0xfa, 0xe1, 0x2e, 0x47, 0x31, 0x48};
  uint8_t bytesprops6[] = {0x21, 0x66, 0xb3, 0x61, 0xfe, 0x26, 0x6b, 0x1,  0xde, 0x95, 0x36, 0xa8,
                           0xc4, 0x76, 0x9e, 0x71, 0x44, 0x17, 0x9f, 0x1e, 0xc,  0xe8, 0xac, 0x73};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5859}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4142}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops2}, .v = {2, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2628;
  uint8_t client_id_bytes[] = {0x83, 0x2f, 0x77, 0xb0, 0xa3};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfe, 0xf5, 0x3a, 0x88, 0x5d, 0xca, 0x6e, 0xde, 0x13, 0x6e, 0xda, 0xd7, 0xd2};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x36, 0xea, 0x7d, 0x98, 0xb5, 0x12, 0x6,  0x4d,
                              0xf5, 0x3a, 0x12, 0x5,  0xf9, 0xcd, 0x71, 0x2b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\155\217\NUL\219N>c\218$.jM\158\CAN\213\ENQA;\185\148\147T\180\244", _password =
// Just "\167\228\243\219\223\142\140\SUB-\206\&0\STXF\ACK\146\186V\DC1\167&Nk\SOH8\132", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 23808, _connID =
// "\240\217\175\155|O\226\&49\201\243L\176\239f\233\177`\130\154\221", _properties = [PropReasonString
// "\134\NAKW\244",PropAssignedClientIdentifier
// "\RS\227\154\160~\164\235\211H\170\160C\203\155\191\v",PropRequestProblemInformation 24,PropAuthenticationData
// "fe&\fTpK\CAN\197ZQ}\240(\r\141\251\255\SOHJ\ENQG\173",PropResponseTopic
// "\187\DLEh\154\191\152\180",PropServerKeepAlive 19082,PropSubscriptionIdentifier 4,PropMaximumQoS
// 151,PropUserProperty "t\167\209S\253;3[\179Er\nHE\142\f\v" "\146\129\186p\143Hk",PropMaximumPacketSize 2628]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0xc0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x5d, 0x0,  0x69, 0x1f, 0x0,  0x4,
                   0x86, 0x15, 0x57, 0xf4, 0x12, 0x0,  0x10, 0x1e, 0xe3, 0x9a, 0xa0, 0x7e, 0xa4, 0xeb, 0xd3, 0x48, 0xaa,
                   0xa0, 0x43, 0xcb, 0x9b, 0xbf, 0xb,  0x17, 0x18, 0x16, 0x0,  0x17, 0x66, 0x65, 0x26, 0xc,  0x54, 0x70,
                   0x4b, 0x18, 0xc5, 0x5a, 0x51, 0x7d, 0xf0, 0x28, 0xd,  0x8d, 0xfb, 0xff, 0x1,  0x4a, 0x5,  0x47, 0xad,
                   0x8,  0x0,  0x7,  0xbb, 0x10, 0x68, 0x9a, 0xbf, 0x98, 0xb4, 0x13, 0x4a, 0x8a, 0xb,  0x4,  0x24, 0x97,
                   0x26, 0x0,  0x11, 0x74, 0xa7, 0xd1, 0x53, 0xfd, 0x3b, 0x33, 0x5b, 0xb3, 0x45, 0x72, 0xa,  0x48, 0x45,
                   0x8e, 0xc,  0xb,  0x0,  0x7,  0x92, 0x81, 0xba, 0x70, 0x8f, 0x48, 0x6b, 0x27, 0x0,  0x0,  0xa,  0x44,
                   0x0,  0x15, 0xf0, 0xd9, 0xaf, 0x9b, 0x7c, 0x4f, 0xe2, 0x34, 0x39, 0xc9, 0xf3, 0x4c, 0xb0, 0xef, 0x66,
                   0xe9, 0xb1, 0x60, 0x82, 0x9a, 0xdd, 0x0,  0x18, 0x9b, 0xd9, 0x0,  0xdb, 0x4e, 0x3e, 0x63, 0xda, 0x24,
                   0x2e, 0x6a, 0x4d, 0x9e, 0x18, 0xd5, 0x5,  0x41, 0x3b, 0xb9, 0x94, 0x93, 0x54, 0xb4, 0xf4, 0x0,  0x19,
                   0xa7, 0xe4, 0xf3, 0xdb, 0xdf, 0x8e, 0x8c, 0x1a, 0x2d, 0xce, 0x30, 0x2,  0x46, 0x6,  0x92, 0xba, 0x56,
                   0x11, 0xa7, 0x26, 0x4e, 0x6b, 0x1,  0x38, 0x84};

  uint8_t buf[205] = {0};

  uint8_t bytesprops0[] = {0x86, 0x15, 0x57, 0xf4};
  uint8_t bytesprops1[] = {0x1e, 0xe3, 0x9a, 0xa0, 0x7e, 0xa4, 0xeb, 0xd3,
                           0x48, 0xaa, 0xa0, 0x43, 0xcb, 0x9b, 0xbf, 0xb};
  uint8_t bytesprops2[] = {0x66, 0x65, 0x26, 0xc,  0x54, 0x70, 0x4b, 0x18, 0xc5, 0x5a, 0x51, 0x7d,
                           0xf0, 0x28, 0xd,  0x8d, 0xfb, 0xff, 0x1,  0x4a, 0x5,  0x47, 0xad};
  uint8_t bytesprops3[] = {0xbb, 0x10, 0x68, 0x9a, 0xbf, 0x98, 0xb4};
  uint8_t bytesprops5[] = {0x92, 0x81, 0xba, 0x70, 0x8f, 0x48, 0x6b};
  uint8_t bytesprops4[] = {0x74, 0xa7, 0xd1, 0x53, 0xfd, 0x3b, 0x33, 0x5b, 0xb3,
                           0x45, 0x72, 0xa,  0x48, 0x45, 0x8e, 0xc,  0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19082}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops4}, .v = {7, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2628}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23808;
  uint8_t client_id_bytes[] = {0xf0, 0xd9, 0xaf, 0x9b, 0x7c, 0x4f, 0xe2, 0x34, 0x39, 0xc9, 0xf3,
                               0x4c, 0xb0, 0xef, 0x66, 0xe9, 0xb1, 0x60, 0x82, 0x9a, 0xdd};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9b, 0xd9, 0x0,  0xdb, 0x4e, 0x3e, 0x63, 0xda, 0x24, 0x2e, 0x6a, 0x4d,
                              0x9e, 0x18, 0xd5, 0x5,  0x41, 0x3b, 0xb9, 0x94, 0x93, 0x54, 0xb4, 0xf4};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa7, 0xe4, 0xf3, 0xdb, 0xdf, 0x8e, 0x8c, 0x1a, 0x2d, 0xce, 0x30, 0x2, 0x46,
                              0x6,  0x92, 0xba, 0x56, 0x11, 0xa7, 0x26, 0x4e, 0x6b, 0x1,  0x38, 0x84};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\147\ENQI\173\FS\139y\171U\167\&2\200\241\231_S\207A\193.'\DC3-\t", _password =
// Just "\224M\229\196\155\f", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "4g\167(\247", _willMsg = "e\SYNy\187{\214", _willProps = [PropResponseInformation
// "\232\174\152\213f\144\240r",PropSubscriptionIdentifier 17,PropContentType
// "\190Y\ESCU\254\253\248>V\128\v=\166\166\192\188\DC2\200\227\192\187\231\157\RS\252Rv\196\155",PropMessageExpiryInterval
// 12137,PropMaximumQoS 175,PropCorrelationData "`\185\255\158\151\205\221\141=-\236P\140\130\135Iu",PropResponseTopic
// "\215\203\r\176\215\133\DC1\189\131$\238e1O/\203\223\207\149H?R\132YZ\195Q",PropAuthenticationData
// "IJ\CAN\166\GS+\137\EM8",PropReasonString
// "\FS\ENQ\221an\136\130\169\EM\245~\228Oy\195\SOH;9\160[\170\&6*c\166\188\206\228",PropReceiveMaximum
// 4886,PropRequestProblemInformation 47,PropAuthenticationMethod
// "\242\&7/\159S\215}y\135$+\136\ETB\221y6\192g|\SUBn\141#MH\187\166\244",PropReasonString
// "\254\154\181\216m\175\193ic\255\210T\139\172\133",PropSessionExpiryInterval 28988,PropCorrelationData
// "aw,\209\179\n0\243Z\153\DC4\181B\190\SO\235\209\178$\246\\",PropServerReference
// "\154<\EOT\199+\252\147\189EV]h\RS\v",PropReceiveMaximum 31344,PropMessageExpiryInterval
// 1883,PropAuthenticationMethod "\208\232\151U\195\178\174X\144\213]\168\EOT\176",PropRequestResponseInformation
// 134,PropSessionExpiryInterval 14426,PropServerReference
// "\GS\152\253\STX\221\FSt\195\134\197\254\204)E+\128,",PropAuthenticationMethod
// "\206%\164\DLE`\196Vn\ETX\136E\DC2s\156\228]]\205B\223\248\a<<\228\ETX",PropReasonString
// "\234l\DC2\155C\162\158\ACK\EM\252\174R",PropContentType "\245\182.t",PropReasonString
// "@\204:N\f\129\243\170\128\157\192\212\130\248z\US\178\ENQ",PropWillDelayInterval 4586,PropTopicAlias 4212]}),
// _cleanSession = False, _keepAlive = 32591, _connID =
// "5\226G\145\159\238\225\NAK\DC2\SUB\RSc\ENQ\ACKr\238+\128\191\218\DC2\230\143X", _properties =
// [PropAssignedClientIdentifier
// "\146\146\202\208n\208X\160\ETXc\bu'\243h\146\152F\SUBw\145\205/\188RT\148S]",PropWildcardSubscriptionAvailable
// 201,PropRequestProblemInformation 25,PropRequestResponseInformation 117,PropServerKeepAlive
// 27326,PropMaximumPacketSize 13373,PropReasonString
// "\ETB\NUL}\250\131\161\bX>\GS?\212\150\&5?,\226",PropSubscriptionIdentifier 9,PropCorrelationData
// "\181x{",PropServerKeepAlive 10603,PropRetainAvailable 59,PropSessionExpiryInterval 16761,PropWillDelayInterval
// 31394,PropUserProperty "\ACKP\220c*\253`I\aP\174\173\SYNG\202\SUB\142\&5~\\\EM\145"
// "\222\208\ACKwE\241r\f\148\162\130\SI\186\249\224!\198`\215;\183\160\ETB*o\200\130\156",PropResponseTopic
// "\STX\204\207\142]\226\163\254\CAN\169\139\222\219\"\167)&k42\207\201\146\&9%\a\174",PropResponseInformation
// "P",PropSharedSubscriptionAvailable 186,PropResponseInformation
// "F\GS\tvkF,\221\247'M<\SO.P%-\129%\133f?\NAK\153\212\213",PropTopicAliasMaximum 17345,PropSharedSubscriptionAvailable
// 242,PropResponseInformation "e\EM\ENQ\147j",PropContentType
// "\171$\GS\151\&1\169&\176\255\201~c\130",PropRequestResponseInformation 23,PropAssignedClientIdentifier
// "\178\189\219\145a\142\159\136\136\246\171\164\v\CANn",PropContentType "\200\142\228\241\129oX\228l"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x7f, 0x4f, 0x8e, 0x2,  0x12, 0x0,  0x1d, 0x92,
      0x92, 0xca, 0xd0, 0x6e, 0xd0, 0x58, 0xa0, 0x3,  0x63, 0x8,  0x75, 0x27, 0xf3, 0x68, 0x92, 0x98, 0x46, 0x1a, 0x77,
      0x91, 0xcd, 0x2f, 0xbc, 0x52, 0x54, 0x94, 0x53, 0x5d, 0x28, 0xc9, 0x17, 0x19, 0x19, 0x75, 0x13, 0x6a, 0xbe, 0x27,
      0x0,  0x0,  0x34, 0x3d, 0x1f, 0x0,  0x11, 0x17, 0x0,  0x7d, 0xfa, 0x83, 0xa1, 0x8,  0x58, 0x3e, 0x1d, 0x3f, 0xd4,
      0x96, 0x35, 0x3f, 0x2c, 0xe2, 0xb,  0x9,  0x9,  0x0,  0x3,  0xb5, 0x78, 0x7b, 0x13, 0x29, 0x6b, 0x25, 0x3b, 0x11,
      0x0,  0x0,  0x41, 0x79, 0x18, 0x0,  0x0,  0x7a, 0xa2, 0x26, 0x0,  0x16, 0x6,  0x50, 0xdc, 0x63, 0x2a, 0xfd, 0x60,
      0x49, 0x7,  0x50, 0xae, 0xad, 0x16, 0x47, 0xca, 0x1a, 0x8e, 0x35, 0x7e, 0x5c, 0x19, 0x91, 0x0,  0x1c, 0xde, 0xd0,
      0x6,  0x77, 0x45, 0xf1, 0x72, 0xc,  0x94, 0xa2, 0x82, 0xf,  0xba, 0xf9, 0xe0, 0x21, 0xc6, 0x60, 0xd7, 0x3b, 0xb7,
      0xa0, 0x17, 0x2a, 0x6f, 0xc8, 0x82, 0x9c, 0x8,  0x0,  0x1b, 0x2,  0xcc, 0xcf, 0x8e, 0x5d, 0xe2, 0xa3, 0xfe, 0x18,
      0xa9, 0x8b, 0xde, 0xdb, 0x22, 0xa7, 0x29, 0x26, 0x6b, 0x34, 0x32, 0xcf, 0xc9, 0x92, 0x39, 0x25, 0x7,  0xae, 0x1a,
      0x0,  0x1,  0x50, 0x2a, 0xba, 0x1a, 0x0,  0x1a, 0x46, 0x1d, 0x9,  0x76, 0x6b, 0x46, 0x2c, 0xdd, 0xf7, 0x27, 0x4d,
      0x3c, 0xe,  0x2e, 0x50, 0x25, 0x2d, 0x81, 0x25, 0x85, 0x66, 0x3f, 0x15, 0x99, 0xd4, 0xd5, 0x22, 0x43, 0xc1, 0x2a,
      0xf2, 0x1a, 0x0,  0x5,  0x65, 0x19, 0x5,  0x93, 0x6a, 0x3,  0x0,  0xd,  0xab, 0x24, 0x1d, 0x97, 0x31, 0xa9, 0x26,
      0xb0, 0xff, 0xc9, 0x7e, 0x63, 0x82, 0x19, 0x17, 0x12, 0x0,  0xf,  0xb2, 0xbd, 0xdb, 0x91, 0x61, 0x8e, 0x9f, 0x88,
      0x88, 0xf6, 0xab, 0xa4, 0xb,  0x18, 0x6e, 0x3,  0x0,  0x9,  0xc8, 0x8e, 0xe4, 0xf1, 0x81, 0x6f, 0x58, 0xe4, 0x6c,
      0x0,  0x18, 0x35, 0xe2, 0x47, 0x91, 0x9f, 0xee, 0xe1, 0x15, 0x12, 0x1a, 0x1e, 0x63, 0x5,  0x6,  0x72, 0xee, 0x2b,
      0x80, 0xbf, 0xda, 0x12, 0xe6, 0x8f, 0x58, 0xf9, 0x2,  0x1a, 0x0,  0x8,  0xe8, 0xae, 0x98, 0xd5, 0x66, 0x90, 0xf0,
      0x72, 0xb,  0x11, 0x3,  0x0,  0x1d, 0xbe, 0x59, 0x1b, 0x55, 0xfe, 0xfd, 0xf8, 0x3e, 0x56, 0x80, 0xb,  0x3d, 0xa6,
      0xa6, 0xc0, 0xbc, 0x12, 0xc8, 0xe3, 0xc0, 0xbb, 0xe7, 0x9d, 0x1e, 0xfc, 0x52, 0x76, 0xc4, 0x9b, 0x2,  0x0,  0x0,
      0x2f, 0x69, 0x24, 0xaf, 0x9,  0x0,  0x11, 0x60, 0xb9, 0xff, 0x9e, 0x97, 0xcd, 0xdd, 0x8d, 0x3d, 0x2d, 0xec, 0x50,
      0x8c, 0x82, 0x87, 0x49, 0x75, 0x8,  0x0,  0x1b, 0xd7, 0xcb, 0xd,  0xb0, 0xd7, 0x85, 0x11, 0xbd, 0x83, 0x24, 0xee,
      0x65, 0x31, 0x4f, 0x2f, 0xcb, 0xdf, 0xcf, 0x95, 0x48, 0x3f, 0x52, 0x84, 0x59, 0x5a, 0xc3, 0x51, 0x16, 0x0,  0x9,
      0x49, 0x4a, 0x18, 0xa6, 0x1d, 0x2b, 0x89, 0x19, 0x38, 0x1f, 0x0,  0x1c, 0x1c, 0x5,  0xdd, 0x61, 0x6e, 0x88, 0x82,
      0xa9, 0x19, 0xf5, 0x7e, 0xe4, 0x4f, 0x79, 0xc3, 0x1,  0x3b, 0x39, 0xa0, 0x5b, 0xaa, 0x36, 0x2a, 0x63, 0xa6, 0xbc,
      0xce, 0xe4, 0x21, 0x13, 0x16, 0x17, 0x2f, 0x15, 0x0,  0x1c, 0xf2, 0x37, 0x2f, 0x9f, 0x53, 0xd7, 0x7d, 0x79, 0x87,
      0x24, 0x2b, 0x88, 0x17, 0xdd, 0x79, 0x36, 0xc0, 0x67, 0x7c, 0x1a, 0x6e, 0x8d, 0x23, 0x4d, 0x48, 0xbb, 0xa6, 0xf4,
      0x1f, 0x0,  0xf,  0xfe, 0x9a, 0xb5, 0xd8, 0x6d, 0xaf, 0xc1, 0x69, 0x63, 0xff, 0xd2, 0x54, 0x8b, 0xac, 0x85, 0x11,
      0x0,  0x0,  0x71, 0x3c, 0x9,  0x0,  0x15, 0x61, 0x77, 0x2c, 0xd1, 0xb3, 0xa,  0x30, 0xf3, 0x5a, 0x99, 0x14, 0xb5,
      0x42, 0xbe, 0xe,  0xeb, 0xd1, 0xb2, 0x24, 0xf6, 0x5c, 0x1c, 0x0,  0xe,  0x9a, 0x3c, 0x4,  0xc7, 0x2b, 0xfc, 0x93,
      0xbd, 0x45, 0x56, 0x5d, 0x68, 0x1e, 0xb,  0x21, 0x7a, 0x70, 0x2,  0x0,  0x0,  0x7,  0x5b, 0x15, 0x0,  0xe,  0xd0,
      0xe8, 0x97, 0x55, 0xc3, 0xb2, 0xae, 0x58, 0x90, 0xd5, 0x5d, 0xa8, 0x4,  0xb0, 0x19, 0x86, 0x11, 0x0,  0x0,  0x38,
      0x5a, 0x1c, 0x0,  0x11, 0x1d, 0x98, 0xfd, 0x2,  0xdd, 0x1c, 0x74, 0xc3, 0x86, 0xc5, 0xfe, 0xcc, 0x29, 0x45, 0x2b,
      0x80, 0x2c, 0x15, 0x0,  0x1a, 0xce, 0x25, 0xa4, 0x10, 0x60, 0xc4, 0x56, 0x6e, 0x3,  0x88, 0x45, 0x12, 0x73, 0x9c,
      0xe4, 0x5d, 0x5d, 0xcd, 0x42, 0xdf, 0xf8, 0x7,  0x3c, 0x3c, 0xe4, 0x3,  0x1f, 0x0,  0xc,  0xea, 0x6c, 0x12, 0x9b,
      0x43, 0xa2, 0x9e, 0x6,  0x19, 0xfc, 0xae, 0x52, 0x3,  0x0,  0x4,  0xf5, 0xb6, 0x2e, 0x74, 0x1f, 0x0,  0x12, 0x40,
      0xcc, 0x3a, 0x4e, 0xc,  0x81, 0xf3, 0xaa, 0x80, 0x9d, 0xc0, 0xd4, 0x82, 0xf8, 0x7a, 0x1f, 0xb2, 0x5,  0x18, 0x0,
      0x0,  0x11, 0xea, 0x23, 0x10, 0x74, 0x0,  0x5,  0x34, 0x67, 0xa7, 0x28, 0xf7, 0x0,  0x6,  0x65, 0x16, 0x79, 0xbb,
      0x7b, 0xd6, 0x0,  0x18, 0x93, 0x5,  0x49, 0xad, 0x1c, 0x8b, 0x79, 0xab, 0x55, 0xa7, 0x32, 0xc8, 0xf1, 0xe7, 0x5f,
      0x53, 0xcf, 0x41, 0xc1, 0x2e, 0x27, 0x13, 0x2d, 0x9,  0x0,  0x6,  0xe0, 0x4d, 0xe5, 0xc4, 0x9b, 0xc};

  uint8_t buf[749] = {0};

  uint8_t bytesprops0[] = {0x92, 0x92, 0xca, 0xd0, 0x6e, 0xd0, 0x58, 0xa0, 0x3,  0x63, 0x8,  0x75, 0x27, 0xf3, 0x68,
                           0x92, 0x98, 0x46, 0x1a, 0x77, 0x91, 0xcd, 0x2f, 0xbc, 0x52, 0x54, 0x94, 0x53, 0x5d};
  uint8_t bytesprops1[] = {0x17, 0x0,  0x7d, 0xfa, 0x83, 0xa1, 0x8,  0x58, 0x3e,
                           0x1d, 0x3f, 0xd4, 0x96, 0x35, 0x3f, 0x2c, 0xe2};
  uint8_t bytesprops2[] = {0xb5, 0x78, 0x7b};
  uint8_t bytesprops4[] = {0xde, 0xd0, 0x6,  0x77, 0x45, 0xf1, 0x72, 0xc,  0x94, 0xa2, 0x82, 0xf,  0xba, 0xf9,
                           0xe0, 0x21, 0xc6, 0x60, 0xd7, 0x3b, 0xb7, 0xa0, 0x17, 0x2a, 0x6f, 0xc8, 0x82, 0x9c};
  uint8_t bytesprops3[] = {0x6,  0x50, 0xdc, 0x63, 0x2a, 0xfd, 0x60, 0x49, 0x7,  0x50, 0xae,
                           0xad, 0x16, 0x47, 0xca, 0x1a, 0x8e, 0x35, 0x7e, 0x5c, 0x19, 0x91};
  uint8_t bytesprops5[] = {0x2,  0xcc, 0xcf, 0x8e, 0x5d, 0xe2, 0xa3, 0xfe, 0x18, 0xa9, 0x8b, 0xde, 0xdb, 0x22,
                           0xa7, 0x29, 0x26, 0x6b, 0x34, 0x32, 0xcf, 0xc9, 0x92, 0x39, 0x25, 0x7,  0xae};
  uint8_t bytesprops6[] = {0x50};
  uint8_t bytesprops7[] = {0x46, 0x1d, 0x9,  0x76, 0x6b, 0x46, 0x2c, 0xdd, 0xf7, 0x27, 0x4d, 0x3c, 0xe,
                           0x2e, 0x50, 0x25, 0x2d, 0x81, 0x25, 0x85, 0x66, 0x3f, 0x15, 0x99, 0xd4, 0xd5};
  uint8_t bytesprops8[] = {0x65, 0x19, 0x5, 0x93, 0x6a};
  uint8_t bytesprops9[] = {0xab, 0x24, 0x1d, 0x97, 0x31, 0xa9, 0x26, 0xb0, 0xff, 0xc9, 0x7e, 0x63, 0x82};
  uint8_t bytesprops10[] = {0xb2, 0xbd, 0xdb, 0x91, 0x61, 0x8e, 0x9f, 0x88, 0x88, 0xf6, 0xab, 0xa4, 0xb, 0x18, 0x6e};
  uint8_t bytesprops11[] = {0xc8, 0x8e, 0xe4, 0xf1, 0x81, 0x6f, 0x58, 0xe4, 0x6c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27326}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13373}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10603}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16761}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31394}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops3}, .v = {28, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17345}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe8, 0xae, 0x98, 0xd5, 0x66, 0x90, 0xf0, 0x72};
  uint8_t byteswillprops1[] = {0xbe, 0x59, 0x1b, 0x55, 0xfe, 0xfd, 0xf8, 0x3e, 0x56, 0x80, 0xb,  0x3d, 0xa6, 0xa6, 0xc0,
                               0xbc, 0x12, 0xc8, 0xe3, 0xc0, 0xbb, 0xe7, 0x9d, 0x1e, 0xfc, 0x52, 0x76, 0xc4, 0x9b};
  uint8_t byteswillprops2[] = {0x60, 0xb9, 0xff, 0x9e, 0x97, 0xcd, 0xdd, 0x8d, 0x3d,
                               0x2d, 0xec, 0x50, 0x8c, 0x82, 0x87, 0x49, 0x75};
  uint8_t byteswillprops3[] = {0xd7, 0xcb, 0xd,  0xb0, 0xd7, 0x85, 0x11, 0xbd, 0x83, 0x24, 0xee, 0x65, 0x31, 0x4f,
                               0x2f, 0xcb, 0xdf, 0xcf, 0x95, 0x48, 0x3f, 0x52, 0x84, 0x59, 0x5a, 0xc3, 0x51};
  uint8_t byteswillprops4[] = {0x49, 0x4a, 0x18, 0xa6, 0x1d, 0x2b, 0x89, 0x19, 0x38};
  uint8_t byteswillprops5[] = {0x1c, 0x5, 0xdd, 0x61, 0x6e, 0x88, 0x82, 0xa9, 0x19, 0xf5, 0x7e, 0xe4, 0x4f, 0x79,
                               0xc3, 0x1, 0x3b, 0x39, 0xa0, 0x5b, 0xaa, 0x36, 0x2a, 0x63, 0xa6, 0xbc, 0xce, 0xe4};
  uint8_t byteswillprops6[] = {0xf2, 0x37, 0x2f, 0x9f, 0x53, 0xd7, 0x7d, 0x79, 0x87, 0x24, 0x2b, 0x88, 0x17, 0xdd,
                               0x79, 0x36, 0xc0, 0x67, 0x7c, 0x1a, 0x6e, 0x8d, 0x23, 0x4d, 0x48, 0xbb, 0xa6, 0xf4};
  uint8_t byteswillprops7[] = {0xfe, 0x9a, 0xb5, 0xd8, 0x6d, 0xaf, 0xc1, 0x69,
                               0x63, 0xff, 0xd2, 0x54, 0x8b, 0xac, 0x85};
  uint8_t byteswillprops8[] = {0x61, 0x77, 0x2c, 0xd1, 0xb3, 0xa,  0x30, 0xf3, 0x5a, 0x99, 0x14,
                               0xb5, 0x42, 0xbe, 0xe,  0xeb, 0xd1, 0xb2, 0x24, 0xf6, 0x5c};
  uint8_t byteswillprops9[] = {0x9a, 0x3c, 0x4, 0xc7, 0x2b, 0xfc, 0x93, 0xbd, 0x45, 0x56, 0x5d, 0x68, 0x1e, 0xb};
  uint8_t byteswillprops10[] = {0xd0, 0xe8, 0x97, 0x55, 0xc3, 0xb2, 0xae, 0x58, 0x90, 0xd5, 0x5d, 0xa8, 0x4, 0xb0};
  uint8_t byteswillprops11[] = {0x1d, 0x98, 0xfd, 0x2,  0xdd, 0x1c, 0x74, 0xc3, 0x86,
                                0xc5, 0xfe, 0xcc, 0x29, 0x45, 0x2b, 0x80, 0x2c};
  uint8_t byteswillprops12[] = {0xce, 0x25, 0xa4, 0x10, 0x60, 0xc4, 0x56, 0x6e, 0x3, 0x88, 0x45, 0x12, 0x73,
                                0x9c, 0xe4, 0x5d, 0x5d, 0xcd, 0x42, 0xdf, 0xf8, 0x7, 0x3c, 0x3c, 0xe4, 0x3};
  uint8_t byteswillprops13[] = {0xea, 0x6c, 0x12, 0x9b, 0x43, 0xa2, 0x9e, 0x6, 0x19, 0xfc, 0xae, 0x52};
  uint8_t byteswillprops14[] = {0xf5, 0xb6, 0x2e, 0x74};
  uint8_t byteswillprops15[] = {0x40, 0xcc, 0x3a, 0x4e, 0xc,  0x81, 0xf3, 0xaa, 0x80,
                                0x9d, 0xc0, 0xd4, 0x82, 0xf8, 0x7a, 0x1f, 0xb2, 0x5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12137}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4886}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28988}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31344}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1883}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14426}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&byteswillprops15}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4586}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4212}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x34, 0x67, 0xa7, 0x28, 0xf7};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x65, 0x16, 0x79, 0xbb, 0x7b, 0xd6};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32591;
  uint8_t client_id_bytes[] = {0x35, 0xe2, 0x47, 0x91, 0x9f, 0xee, 0xe1, 0x15, 0x12, 0x1a, 0x1e, 0x63,
                               0x5,  0x6,  0x72, 0xee, 0x2b, 0x80, 0xbf, 0xda, 0x12, 0xe6, 0x8f, 0x58};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x93, 0x5,  0x49, 0xad, 0x1c, 0x8b, 0x79, 0xab, 0x55, 0xa7, 0x32, 0xc8,
                              0xf1, 0xe7, 0x5f, 0x53, 0xcf, 0x41, 0xc1, 0x2e, 0x27, 0x13, 0x2d, 0x9};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0x4d, 0xe5, 0xc4, 0x9b, 0xc};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\135n\ACK\DEL\252\NAKj", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "\227\242\SOH2\209\GS\241P\197$1", _willMsg =
// "\203\232{\205\152\239\158\DEL\251r\EOTy\\e\148\159p\ETX8Kg", _willProps = [PropResponseTopic
// "\212\ETB\EOT\132M\"^\\(\254\171\ACK\188\&5\174\NAK?I\181\221\221B\246\226\233\210?\232",PropMaximumQoS
// 142,PropCorrelationData "<'\194\DC45\216\200p\216)\175G\NUL",PropServerReference
// "f\150\160\131/\ETX\216_\157\202\142\t\136\&8;\178\143\177,3+\148",PropWildcardSubscriptionAvailable
// 231,PropWildcardSubscriptionAvailable 103,PropWildcardSubscriptionAvailable 67,PropRequestResponseInformation
// 151,PropSharedSubscriptionAvailable 197,PropWildcardSubscriptionAvailable 192,PropRetainAvailable
// 167,PropSubscriptionIdentifier 8,PropServerReference "\182\213\155\213\v\r\DC2\181",PropAuthenticationData
// "\199xmb\245",PropWildcardSubscriptionAvailable 177,PropResponseInformation
// "k5\245)\203y+\223*\202\252,\251u\240\176\195Y",PropSharedSubscriptionAvailable 66,PropRetainAvailable
// 186,PropAuthenticationMethod "\152>\128\158\235\150\182N8F\223\200\SYN\154.\161",PropTopicAlias
// 25938,PropMessageExpiryInterval 9743,PropResponseTopic
// "\150\145\&9\168\134\228\&9\SO\210\200O\230r\SYN\209\RS\SO\214"]}), _cleanSession = True, _keepAlive = 27175, _connID
// = "\CAN\SYN\222\163\&6J<\227\240.\181\138\158\223b_\ETB\234\SYN\232\223", _properties = [PropMessageExpiryInterval
// 2882,PropCorrelationData "7\176\229\218\&9\SYN\227#]#\200a\DC1\205}\223\ETBs<\205r$[",PropTopicAliasMaximum
// 19033,PropSharedSubscriptionAvailable 238,PropServerReference "\199y\243\b",PropSharedSubscriptionAvailable
// 200,PropMessageExpiryInterval 25291,PropUserProperty ""
// "\228\197\r\232\193\nW4kl\SOH\t\\\DC4",PropSubscriptionIdentifierAvailable 101,PropUserProperty
// "!\n0`*\161b\147\188u"
// "#\146\139\&4sy\207Q\255En\n'<\248\&6\232\253-\196\ETXKz\137\ETX\164^\230",PropMessageExpiryInterval
// 11776,PropSubscriptionIdentifierAvailable 107,PropPayloadFormatIndicator 174]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0x84, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x6a, 0x27, 0x7b, 0x2,  0x0,  0x0,  0xb,  0x42,
      0x9,  0x0,  0x17, 0x37, 0xb0, 0xe5, 0xda, 0x39, 0x16, 0xe3, 0x23, 0x5d, 0x23, 0xc8, 0x61, 0x11, 0xcd, 0x7d, 0xdf,
      0x17, 0x73, 0x3c, 0xcd, 0x72, 0x24, 0x5b, 0x22, 0x4a, 0x59, 0x2a, 0xee, 0x1c, 0x0,  0x4,  0xc7, 0x79, 0xf3, 0x8,
      0x2a, 0xc8, 0x2,  0x0,  0x0,  0x62, 0xcb, 0x26, 0x0,  0x0,  0x0,  0xe,  0xe4, 0xc5, 0xd,  0xe8, 0xc1, 0xa,  0x57,
      0x34, 0x6b, 0x6c, 0x1,  0x9,  0x5c, 0x14, 0x29, 0x65, 0x26, 0x0,  0xa,  0x21, 0xa,  0x30, 0x60, 0x2a, 0xa1, 0x62,
      0x93, 0xbc, 0x75, 0x0,  0x1c, 0x23, 0x92, 0x8b, 0x34, 0x73, 0x79, 0xcf, 0x51, 0xff, 0x45, 0x6e, 0xa,  0x27, 0x3c,
      0xf8, 0x36, 0xe8, 0xfd, 0x2d, 0xc4, 0x3,  0x4b, 0x7a, 0x89, 0x3,  0xa4, 0x5e, 0xe6, 0x2,  0x0,  0x0,  0x2e, 0x0,
      0x29, 0x6b, 0x1,  0xae, 0x0,  0x15, 0x18, 0x16, 0xde, 0xa3, 0x36, 0x4a, 0x3c, 0xe3, 0xf0, 0x2e, 0xb5, 0x8a, 0x9e,
      0xdf, 0x62, 0x5f, 0x17, 0xea, 0x16, 0xe8, 0xdf, 0xb8, 0x1,  0x8,  0x0,  0x1c, 0xd4, 0x17, 0x4,  0x84, 0x4d, 0x22,
      0x5e, 0x5c, 0x28, 0xfe, 0xab, 0x6,  0xbc, 0x35, 0xae, 0x15, 0x3f, 0x49, 0xb5, 0xdd, 0xdd, 0x42, 0xf6, 0xe2, 0xe9,
      0xd2, 0x3f, 0xe8, 0x24, 0x8e, 0x9,  0x0,  0xd,  0x3c, 0x27, 0xc2, 0x14, 0x35, 0xd8, 0xc8, 0x70, 0xd8, 0x29, 0xaf,
      0x47, 0x0,  0x1c, 0x0,  0x16, 0x66, 0x96, 0xa0, 0x83, 0x2f, 0x3,  0xd8, 0x5f, 0x9d, 0xca, 0x8e, 0x9,  0x88, 0x38,
      0x3b, 0xb2, 0x8f, 0xb1, 0x2c, 0x33, 0x2b, 0x94, 0x28, 0xe7, 0x28, 0x67, 0x28, 0x43, 0x19, 0x97, 0x2a, 0xc5, 0x28,
      0xc0, 0x25, 0xa7, 0xb,  0x8,  0x1c, 0x0,  0x8,  0xb6, 0xd5, 0x9b, 0xd5, 0xb,  0xd,  0x12, 0xb5, 0x16, 0x0,  0x5,
      0xc7, 0x78, 0x6d, 0x62, 0xf5, 0x28, 0xb1, 0x1a, 0x0,  0x12, 0x6b, 0x35, 0xf5, 0x29, 0xcb, 0x79, 0x2b, 0xdf, 0x2a,
      0xca, 0xfc, 0x2c, 0xfb, 0x75, 0xf0, 0xb0, 0xc3, 0x59, 0x2a, 0x42, 0x25, 0xba, 0x15, 0x0,  0x10, 0x98, 0x3e, 0x80,
      0x9e, 0xeb, 0x96, 0xb6, 0x4e, 0x38, 0x46, 0xdf, 0xc8, 0x16, 0x9a, 0x2e, 0xa1, 0x23, 0x65, 0x52, 0x2,  0x0,  0x0,
      0x26, 0xf,  0x8,  0x0,  0x12, 0x96, 0x91, 0x39, 0xa8, 0x86, 0xe4, 0x39, 0xe,  0xd2, 0xc8, 0x4f, 0xe6, 0x72, 0x16,
      0xd1, 0x1e, 0xe,  0xd6, 0x0,  0xb,  0xe3, 0xf2, 0x1,  0x32, 0xd1, 0x1d, 0xf1, 0x50, 0xc5, 0x24, 0x31, 0x0,  0x15,
      0xcb, 0xe8, 0x7b, 0xcd, 0x98, 0xef, 0x9e, 0x7f, 0xfb, 0x72, 0x4,  0x79, 0x5c, 0x65, 0x94, 0x9f, 0x70, 0x3,  0x38,
      0x4b, 0x67, 0x0,  0x7,  0x87, 0x6e, 0x6,  0x7f, 0xfc, 0x15, 0x6a};

  uint8_t buf[401] = {0};

  uint8_t bytesprops0[] = {0x37, 0xb0, 0xe5, 0xda, 0x39, 0x16, 0xe3, 0x23, 0x5d, 0x23, 0xc8, 0x61,
                           0x11, 0xcd, 0x7d, 0xdf, 0x17, 0x73, 0x3c, 0xcd, 0x72, 0x24, 0x5b};
  uint8_t bytesprops1[] = {0xc7, 0x79, 0xf3, 0x8};
  uint8_t bytesprops3[] = {0xe4, 0xc5, 0xd, 0xe8, 0xc1, 0xa, 0x57, 0x34, 0x6b, 0x6c, 0x1, 0x9, 0x5c, 0x14};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops5[] = {0x23, 0x92, 0x8b, 0x34, 0x73, 0x79, 0xcf, 0x51, 0xff, 0x45, 0x6e, 0xa,  0x27, 0x3c,
                           0xf8, 0x36, 0xe8, 0xfd, 0x2d, 0xc4, 0x3,  0x4b, 0x7a, 0x89, 0x3,  0xa4, 0x5e, 0xe6};
  uint8_t bytesprops4[] = {0x21, 0xa, 0x30, 0x60, 0x2a, 0xa1, 0x62, 0x93, 0xbc, 0x75};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2882}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19033}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25291}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops2}, .v = {14, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops4}, .v = {28, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11776}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 174}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd4, 0x17, 0x4,  0x84, 0x4d, 0x22, 0x5e, 0x5c, 0x28, 0xfe, 0xab, 0x6,  0xbc, 0x35,
                               0xae, 0x15, 0x3f, 0x49, 0xb5, 0xdd, 0xdd, 0x42, 0xf6, 0xe2, 0xe9, 0xd2, 0x3f, 0xe8};
  uint8_t byteswillprops1[] = {0x3c, 0x27, 0xc2, 0x14, 0x35, 0xd8, 0xc8, 0x70, 0xd8, 0x29, 0xaf, 0x47, 0x0};
  uint8_t byteswillprops2[] = {0x66, 0x96, 0xa0, 0x83, 0x2f, 0x3,  0xd8, 0x5f, 0x9d, 0xca, 0x8e,
                               0x9,  0x88, 0x38, 0x3b, 0xb2, 0x8f, 0xb1, 0x2c, 0x33, 0x2b, 0x94};
  uint8_t byteswillprops3[] = {0xb6, 0xd5, 0x9b, 0xd5, 0xb, 0xd, 0x12, 0xb5};
  uint8_t byteswillprops4[] = {0xc7, 0x78, 0x6d, 0x62, 0xf5};
  uint8_t byteswillprops5[] = {0x6b, 0x35, 0xf5, 0x29, 0xcb, 0x79, 0x2b, 0xdf, 0x2a,
                               0xca, 0xfc, 0x2c, 0xfb, 0x75, 0xf0, 0xb0, 0xc3, 0x59};
  uint8_t byteswillprops6[] = {0x98, 0x3e, 0x80, 0x9e, 0xeb, 0x96, 0xb6, 0x4e,
                               0x38, 0x46, 0xdf, 0xc8, 0x16, 0x9a, 0x2e, 0xa1};
  uint8_t byteswillprops7[] = {0x96, 0x91, 0x39, 0xa8, 0x86, 0xe4, 0x39, 0xe, 0xd2,
                               0xc8, 0x4f, 0xe6, 0x72, 0x16, 0xd1, 0x1e, 0xe, 0xd6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25938}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9743}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xf2, 0x1, 0x32, 0xd1, 0x1d, 0xf1, 0x50, 0xc5, 0x24, 0x31};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xcb, 0xe8, 0x7b, 0xcd, 0x98, 0xef, 0x9e, 0x7f, 0xfb, 0x72, 0x4,
                                  0x79, 0x5c, 0x65, 0x94, 0x9f, 0x70, 0x3,  0x38, 0x4b, 0x67};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27175;
  uint8_t client_id_bytes[] = {0x18, 0x16, 0xde, 0xa3, 0x36, 0x4a, 0x3c, 0xe3, 0xf0, 0x2e, 0xb5,
                               0x8a, 0x9e, 0xdf, 0x62, 0x5f, 0x17, 0xea, 0x16, 0xe8, 0xdf};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x87, 0x6e, 0x6, 0x7f, 0xfc, 0x15, 0x6a};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\206\232\167N\216a\154\199\224\218QM\240^\233", _password = Just
// "\192/:\231\250i\229m\149\209\226\189\247\RS", _lastWill = Nothing, _cleanSession = True, _keepAlive = 19539, _connID
// = "\243\a_w\224\230\220\172\186\STX\157\251\SUB\221\132\ACK1\230\148", _properties = [PropContentType
// "QH\133\ETX\204\nCa\145\182\179",PropPayloadFormatIndicator 127,PropAuthenticationData
// "u\230\227\235K\130\148\217M\150\172p\251\145\DC2\v\ETB\DC2O\181g?\198\253",PropResponseInformation
// "l\219\199)\200Q\215\128\219\GS\161o)\254\US\RS\212\186aR$S\ENQ_C\SOHvQEv",PropAssignedClientIdentifier
// "\186.\\\159\184\222\213\237\199\179\208e\221rn\224H\191\143\CAN\134\194\183*",PropRequestResponseInformation
// 219,PropPayloadFormatIndicator 221,PropReceiveMaximum 19233,PropResponseTopic "H\196\238",PropRetainAvailable
// 172,PropMaximumQoS 154,PropMessageExpiryInterval 9718]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0xbe, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x4c, 0x53, 0x7d, 0x3,  0x0,  0xb,
                   0x51, 0x48, 0x85, 0x3,  0xcc, 0xa,  0x43, 0x61, 0x91, 0xb6, 0xb3, 0x1,  0x7f, 0x16, 0x0,  0x18, 0x75,
                   0xe6, 0xe3, 0xeb, 0x4b, 0x82, 0x94, 0xd9, 0x4d, 0x96, 0xac, 0x70, 0xfb, 0x91, 0x12, 0xb,  0x17, 0x12,
                   0x4f, 0xb5, 0x67, 0x3f, 0xc6, 0xfd, 0x1a, 0x0,  0x1e, 0x6c, 0xdb, 0xc7, 0x29, 0xc8, 0x51, 0xd7, 0x80,
                   0xdb, 0x1d, 0xa1, 0x6f, 0x29, 0xfe, 0x1f, 0x1e, 0xd4, 0xba, 0x61, 0x52, 0x24, 0x53, 0x5,  0x5f, 0x43,
                   0x1,  0x76, 0x51, 0x45, 0x76, 0x12, 0x0,  0x18, 0xba, 0x2e, 0x5c, 0x9f, 0xb8, 0xde, 0xd5, 0xed, 0xc7,
                   0xb3, 0xd0, 0x65, 0xdd, 0x72, 0x6e, 0xe0, 0x48, 0xbf, 0x8f, 0x18, 0x86, 0xc2, 0xb7, 0x2a, 0x19, 0xdb,
                   0x1,  0xdd, 0x21, 0x4b, 0x21, 0x8,  0x0,  0x3,  0x48, 0xc4, 0xee, 0x25, 0xac, 0x24, 0x9a, 0x2,  0x0,
                   0x0,  0x25, 0xf6, 0x0,  0x13, 0xf3, 0x7,  0x5f, 0x77, 0xe0, 0xe6, 0xdc, 0xac, 0xba, 0x2,  0x9d, 0xfb,
                   0x1a, 0xdd, 0x84, 0x6,  0x31, 0xe6, 0x94, 0x0,  0xf,  0xce, 0xe8, 0xa7, 0x4e, 0xd8, 0x61, 0x9a, 0xc7,
                   0xe0, 0xda, 0x51, 0x4d, 0xf0, 0x5e, 0xe9, 0x0,  0xe,  0xc0, 0x2f, 0x3a, 0xe7, 0xfa, 0x69, 0xe5, 0x6d,
                   0x95, 0xd1, 0xe2, 0xbd, 0xf7, 0x1e};

  uint8_t buf[203] = {0};

  uint8_t bytesprops0[] = {0x51, 0x48, 0x85, 0x3, 0xcc, 0xa, 0x43, 0x61, 0x91, 0xb6, 0xb3};
  uint8_t bytesprops1[] = {0x75, 0xe6, 0xe3, 0xeb, 0x4b, 0x82, 0x94, 0xd9, 0x4d, 0x96, 0xac, 0x70,
                           0xfb, 0x91, 0x12, 0xb,  0x17, 0x12, 0x4f, 0xb5, 0x67, 0x3f, 0xc6, 0xfd};
  uint8_t bytesprops2[] = {0x6c, 0xdb, 0xc7, 0x29, 0xc8, 0x51, 0xd7, 0x80, 0xdb, 0x1d, 0xa1, 0x6f, 0x29, 0xfe, 0x1f,
                           0x1e, 0xd4, 0xba, 0x61, 0x52, 0x24, 0x53, 0x5,  0x5f, 0x43, 0x1,  0x76, 0x51, 0x45, 0x76};
  uint8_t bytesprops3[] = {0xba, 0x2e, 0x5c, 0x9f, 0xb8, 0xde, 0xd5, 0xed, 0xc7, 0xb3, 0xd0, 0x65,
                           0xdd, 0x72, 0x6e, 0xe0, 0x48, 0xbf, 0x8f, 0x18, 0x86, 0xc2, 0xb7, 0x2a};
  uint8_t bytesprops4[] = {0x48, 0xc4, 0xee};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19233}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9718}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19539;
  uint8_t client_id_bytes[] = {0xf3, 0x7,  0x5f, 0x77, 0xe0, 0xe6, 0xdc, 0xac, 0xba, 0x2,
                               0x9d, 0xfb, 0x1a, 0xdd, 0x84, 0x6,  0x31, 0xe6, 0x94};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xce, 0xe8, 0xa7, 0x4e, 0xd8, 0x61, 0x9a, 0xc7, 0xe0, 0xda, 0x51, 0x4d, 0xf0, 0x5e, 0xe9};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc0, 0x2f, 0x3a, 0xe7, 0xfa, 0x69, 0xe5, 0x6d, 0x95, 0xd1, 0xe2, 0xbd, 0xf7, 0x1e};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "m\215\134\182\200\&4", _password = Just
// ">\213T\DC4\232\214\180e\168@Q\130\234\201\227#\248\153`\161\244\138\218\201/xr\DEL", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "k\208\247&\US\224\153\252\216", _willMsg = "\v\157\214H\186",
// _willProps = [PropPayloadFormatIndicator 187,PropTopicAliasMaximum 32718,PropServerReference
// "\vh\247\147\223\169\132\211K\249\160E\141W\140\167\GS\166\220\201",PropServerKeepAlive
// 17111,PropAssignedClientIdentifier "f\176G\ENQ#'\177\239G\164\176\247\236\240\202",PropSessionExpiryInterval
// 14845,PropReceiveMaximum 32716,PropWillDelayInterval 5765,PropPayloadFormatIndicator 200,PropResponseInformation
// "pf\STX6",PropSharedSubscriptionAvailable 198,PropTopicAlias 20010,PropWillDelayInterval 26929,PropCorrelationData
// "6k;\183\248\ENQ\148\245\199w=",PropRetainAvailable 174,PropAuthenticationMethod
// "\206\NAK\182\182}\216\249\159\140:\238\202\139\248",PropAuthenticationMethod "\205\135\ETX",PropTopicAliasMaximum
// 14663,PropWildcardSubscriptionAvailable 87,PropCorrelationData
// "\248U\149\192\173\230\SO\143\215KL*j\154\239t\140\249j\150",PropRequestResponseInformation 164,PropReceiveMaximum
// 22648,PropMessageExpiryInterval 22675,PropWillDelayInterval 29136]}), _cleanSession = False, _keepAlive = 24596,
// _connID = "\198\140\ETX", _properties = [PropSessionExpiryInterval 14824,PropMessageExpiryInterval
// 21140,PropTopicAlias 28394,PropCorrelationData
// "\135\237\f\236\165d\248\137\DEL\218c\230\168\192\235u|'\237}|\"\187\DEL\DEL",PropRetainAvailable
// 236,PropMessageExpiryInterval 3189,PropSubscriptionIdentifierAvailable 13,PropWillDelayInterval
// 17060,PropReceiveMaximum 25160,PropCorrelationData "\233",PropRequestResponseInformation 160,PropMaximumQoS
// 131,PropMaximumPacketSize 16528,PropSharedSubscriptionAvailable 89,PropAssignedClientIdentifier
// "\ACK*4\n\241\234^&n\232\213ED\ACK\229\252\232\&6",PropMessageExpiryInterval 11067,PropWildcardSubscriptionAvailable
// 39,PropResponseInformation "0\148\NAK\212h\200\132\219\&9",PropServerReference
// "|\DC2\n\DC2\159\144%\221\248\137\160\230^\SI\a\154\147u",PropServerReference
// "\238\137\251\a\229{\202\153\210\ENQ\194\240\GS<\223\183\208\241\179{\NAKS\236\140\234f",PropAuthenticationData
// "\130\200\243",PropRetainAvailable 200,PropSubscriptionIdentifier 13,PropMessageExpiryInterval
// 6275,PropRequestProblemInformation 236,PropMessageExpiryInterval 10831,PropCorrelationData
// "y\214",PropWillDelayInterval 13007,PropWildcardSubscriptionAvailable 14]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0xb3, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x60, 0x14, 0xc5, 0x1,  0x11, 0x0,  0x0,  0x39,
      0xe8, 0x2,  0x0,  0x0,  0x52, 0x94, 0x23, 0x6e, 0xea, 0x9,  0x0,  0x19, 0x87, 0xed, 0xc,  0xec, 0xa5, 0x64, 0xf8,
      0x89, 0x7f, 0xda, 0x63, 0xe6, 0xa8, 0xc0, 0xeb, 0x75, 0x7c, 0x27, 0xed, 0x7d, 0x7c, 0x22, 0xbb, 0x7f, 0x7f, 0x25,
      0xec, 0x2,  0x0,  0x0,  0xc,  0x75, 0x29, 0xd,  0x18, 0x0,  0x0,  0x42, 0xa4, 0x21, 0x62, 0x48, 0x9,  0x0,  0x1,
      0xe9, 0x19, 0xa0, 0x24, 0x83, 0x27, 0x0,  0x0,  0x40, 0x90, 0x2a, 0x59, 0x12, 0x0,  0x12, 0x6,  0x2a, 0x34, 0xa,
      0xf1, 0xea, 0x5e, 0x26, 0x6e, 0xe8, 0xd5, 0x45, 0x44, 0x6,  0xe5, 0xfc, 0xe8, 0x36, 0x2,  0x0,  0x0,  0x2b, 0x3b,
      0x28, 0x27, 0x1a, 0x0,  0x9,  0x30, 0x94, 0x15, 0xd4, 0x68, 0xc8, 0x84, 0xdb, 0x39, 0x1c, 0x0,  0x12, 0x7c, 0x12,
      0xa,  0x12, 0x9f, 0x90, 0x25, 0xdd, 0xf8, 0x89, 0xa0, 0xe6, 0x5e, 0xf,  0x7,  0x9a, 0x93, 0x75, 0x1c, 0x0,  0x1a,
      0xee, 0x89, 0xfb, 0x7,  0xe5, 0x7b, 0xca, 0x99, 0xd2, 0x5,  0xc2, 0xf0, 0x1d, 0x3c, 0xdf, 0xb7, 0xd0, 0xf1, 0xb3,
      0x7b, 0x15, 0x53, 0xec, 0x8c, 0xea, 0x66, 0x16, 0x0,  0x3,  0x82, 0xc8, 0xf3, 0x25, 0xc8, 0xb,  0xd,  0x2,  0x0,
      0x0,  0x18, 0x83, 0x17, 0xec, 0x2,  0x0,  0x0,  0x2a, 0x4f, 0x9,  0x0,  0x2,  0x79, 0xd6, 0x18, 0x0,  0x0,  0x32,
      0xcf, 0x28, 0xe,  0x0,  0x3,  0xc6, 0x8c, 0x3,  0xa3, 0x1,  0x1,  0xbb, 0x22, 0x7f, 0xce, 0x1c, 0x0,  0x14, 0xb,
      0x68, 0xf7, 0x93, 0xdf, 0xa9, 0x84, 0xd3, 0x4b, 0xf9, 0xa0, 0x45, 0x8d, 0x57, 0x8c, 0xa7, 0x1d, 0xa6, 0xdc, 0xc9,
      0x13, 0x42, 0xd7, 0x12, 0x0,  0xf,  0x66, 0xb0, 0x47, 0x5,  0x23, 0x27, 0xb1, 0xef, 0x47, 0xa4, 0xb0, 0xf7, 0xec,
      0xf0, 0xca, 0x11, 0x0,  0x0,  0x39, 0xfd, 0x21, 0x7f, 0xcc, 0x18, 0x0,  0x0,  0x16, 0x85, 0x1,  0xc8, 0x1a, 0x0,
      0x4,  0x70, 0x66, 0x2,  0x36, 0x2a, 0xc6, 0x23, 0x4e, 0x2a, 0x18, 0x0,  0x0,  0x69, 0x31, 0x9,  0x0,  0xb,  0x36,
      0x6b, 0x3b, 0xb7, 0xf8, 0x5,  0x94, 0xf5, 0xc7, 0x77, 0x3d, 0x25, 0xae, 0x15, 0x0,  0xe,  0xce, 0x15, 0xb6, 0xb6,
      0x7d, 0xd8, 0xf9, 0x9f, 0x8c, 0x3a, 0xee, 0xca, 0x8b, 0xf8, 0x15, 0x0,  0x3,  0xcd, 0x87, 0x3,  0x22, 0x39, 0x47,
      0x28, 0x57, 0x9,  0x0,  0x14, 0xf8, 0x55, 0x95, 0xc0, 0xad, 0xe6, 0xe,  0x8f, 0xd7, 0x4b, 0x4c, 0x2a, 0x6a, 0x9a,
      0xef, 0x74, 0x8c, 0xf9, 0x6a, 0x96, 0x19, 0xa4, 0x21, 0x58, 0x78, 0x2,  0x0,  0x0,  0x58, 0x93, 0x18, 0x0,  0x0,
      0x71, 0xd0, 0x0,  0x9,  0x6b, 0xd0, 0xf7, 0x26, 0x1f, 0xe0, 0x99, 0xfc, 0xd8, 0x0,  0x5,  0xb,  0x9d, 0xd6, 0x48,
      0xba, 0x0,  0x6,  0x6d, 0xd7, 0x86, 0xb6, 0xc8, 0x34, 0x0,  0x1c, 0x3e, 0xd5, 0x54, 0x14, 0xe8, 0xd6, 0xb4, 0x65,
      0xa8, 0x40, 0x51, 0x82, 0xea, 0xc9, 0xe3, 0x23, 0xf8, 0x99, 0x60, 0xa1, 0xf4, 0x8a, 0xda, 0xc9, 0x2f, 0x78, 0x72,
      0x7f};

  uint8_t buf[448] = {0};

  uint8_t bytesprops0[] = {0x87, 0xed, 0xc,  0xec, 0xa5, 0x64, 0xf8, 0x89, 0x7f, 0xda, 0x63, 0xe6, 0xa8,
                           0xc0, 0xeb, 0x75, 0x7c, 0x27, 0xed, 0x7d, 0x7c, 0x22, 0xbb, 0x7f, 0x7f};
  uint8_t bytesprops1[] = {0xe9};
  uint8_t bytesprops2[] = {0x6,  0x2a, 0x34, 0xa,  0xf1, 0xea, 0x5e, 0x26, 0x6e,
                           0xe8, 0xd5, 0x45, 0x44, 0x6,  0xe5, 0xfc, 0xe8, 0x36};
  uint8_t bytesprops3[] = {0x30, 0x94, 0x15, 0xd4, 0x68, 0xc8, 0x84, 0xdb, 0x39};
  uint8_t bytesprops4[] = {0x7c, 0x12, 0xa,  0x12, 0x9f, 0x90, 0x25, 0xdd, 0xf8,
                           0x89, 0xa0, 0xe6, 0x5e, 0xf,  0x7,  0x9a, 0x93, 0x75};
  uint8_t bytesprops5[] = {0xee, 0x89, 0xfb, 0x7,  0xe5, 0x7b, 0xca, 0x99, 0xd2, 0x5,  0xc2, 0xf0, 0x1d,
                           0x3c, 0xdf, 0xb7, 0xd0, 0xf1, 0xb3, 0x7b, 0x15, 0x53, 0xec, 0x8c, 0xea, 0x66};
  uint8_t bytesprops6[] = {0x82, 0xc8, 0xf3};
  uint8_t bytesprops7[] = {0x79, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14824}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21140}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28394}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3189}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17060}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25160}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16528}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11067}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6275}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10831}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13007}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 14}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb,  0x68, 0xf7, 0x93, 0xdf, 0xa9, 0x84, 0xd3, 0x4b, 0xf9,
                               0xa0, 0x45, 0x8d, 0x57, 0x8c, 0xa7, 0x1d, 0xa6, 0xdc, 0xc9};
  uint8_t byteswillprops1[] = {0x66, 0xb0, 0x47, 0x5, 0x23, 0x27, 0xb1, 0xef, 0x47, 0xa4, 0xb0, 0xf7, 0xec, 0xf0, 0xca};
  uint8_t byteswillprops2[] = {0x70, 0x66, 0x2, 0x36};
  uint8_t byteswillprops3[] = {0x36, 0x6b, 0x3b, 0xb7, 0xf8, 0x5, 0x94, 0xf5, 0xc7, 0x77, 0x3d};
  uint8_t byteswillprops4[] = {0xce, 0x15, 0xb6, 0xb6, 0x7d, 0xd8, 0xf9, 0x9f, 0x8c, 0x3a, 0xee, 0xca, 0x8b, 0xf8};
  uint8_t byteswillprops5[] = {0xcd, 0x87, 0x3};
  uint8_t byteswillprops6[] = {0xf8, 0x55, 0x95, 0xc0, 0xad, 0xe6, 0xe,  0x8f, 0xd7, 0x4b,
                               0x4c, 0x2a, 0x6a, 0x9a, 0xef, 0x74, 0x8c, 0xf9, 0x6a, 0x96};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32718}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17111}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14845}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32716}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5765}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20010}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26929}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14663}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22648}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22675}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29136}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6b, 0xd0, 0xf7, 0x26, 0x1f, 0xe0, 0x99, 0xfc, 0xd8};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb, 0x9d, 0xd6, 0x48, 0xba};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24596;
  uint8_t client_id_bytes[] = {0xc6, 0x8c, 0x3};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6d, 0xd7, 0x86, 0xb6, 0xc8, 0x34};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3e, 0xd5, 0x54, 0x14, 0xe8, 0xd6, 0xb4, 0x65, 0xa8, 0x40, 0x51, 0x82, 0xea, 0xc9,
                              0xe3, 0x23, 0xf8, 0x99, 0x60, 0xa1, 0xf4, 0x8a, 0xda, 0xc9, 0x2f, 0x78, 0x72, 0x7f};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "e\ESCs", _password = Just "\183mF\183H", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 16377, _connID = "Ky\SOj\t\188i\157\233_I\201\187\143\DELY\175_\140}\230\&5\206\SUBqb+P0", _properties =
// [PropMessageExpiryInterval 12557,PropResponseInformation
// "\\\146\EM\EOT\170]y\131\188\DLE\201~\128\v\207\199\166\131\253\224*\133\EOT[A\214\197\"",PropAuthenticationMethod
// "\189\140T\249\247u\STX\138\151\197G",PropMaximumQoS 2,PropContentType
// "\STX\197\139@O\230\165\DEL\tcVj)eh\241-\STX\245\171\DLE\SOH\198\237\ETBc\239\DC3\ACK",PropAssignedClientIdentifier
// "Q\136\161\f\132x\203C\234\232\248\208x\246S\180\136I6\200\216b\239q",PropSubscriptionIdentifier
// 0,PropMaximumPacketSize 28632,PropSharedSubscriptionAvailable 164,PropTopicAliasMaximum
// 26012,PropSessionExpiryInterval 1199,PropTopicAliasMaximum 10320,PropUserProperty
// "\SOV\245\128\205z>\131\146v[\239\t4)O\141\198\226\r\t\SYN\189g&\171\202\166O" "\150l-h",PropUserProperty "\ETXO"
// "\ETB\148\188",PropPayloadFormatIndicator 169,PropAssignedClientIdentifier
// "\156\132aO\182\147iE\198y\rY\SI0",PropTopicAliasMaximum 28032,PropUserProperty
// "\187_VoL\CANwj\137(l\129\236<\209z\220FGI\237c\171\187\150'\215h"
// "2\128f\220\132\v\215\245cO\US\207\136",PropTopicAliasMaximum 29924,PropReceiveMaximum 32359,PropCorrelationData
// "\138\143\159:",PropAuthenticationData "\168\156\219\195\143\129",PropAssignedClientIdentifier "\142",PropTopicAlias
// 8611]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x3f, 0xf9, 0x94, 0x2,  0x2,  0x0,  0x0,  0x31,
      0xd,  0x1a, 0x0,  0x1c, 0x5c, 0x92, 0x19, 0x4,  0xaa, 0x5d, 0x79, 0x83, 0xbc, 0x10, 0xc9, 0x7e, 0x80, 0xb,  0xcf,
      0xc7, 0xa6, 0x83, 0xfd, 0xe0, 0x2a, 0x85, 0x4,  0x5b, 0x41, 0xd6, 0xc5, 0x22, 0x15, 0x0,  0xb,  0xbd, 0x8c, 0x54,
      0xf9, 0xf7, 0x75, 0x2,  0x8a, 0x97, 0xc5, 0x47, 0x24, 0x2,  0x3,  0x0,  0x1d, 0x2,  0xc5, 0x8b, 0x40, 0x4f, 0xe6,
      0xa5, 0x7f, 0x9,  0x63, 0x56, 0x6a, 0x29, 0x65, 0x68, 0xf1, 0x2d, 0x2,  0xf5, 0xab, 0x10, 0x1,  0xc6, 0xed, 0x17,
      0x63, 0xef, 0x13, 0x6,  0x12, 0x0,  0x18, 0x51, 0x88, 0xa1, 0xc,  0x84, 0x78, 0xcb, 0x43, 0xea, 0xe8, 0xf8, 0xd0,
      0x78, 0xf6, 0x53, 0xb4, 0x88, 0x49, 0x36, 0xc8, 0xd8, 0x62, 0xef, 0x71, 0xb,  0x0,  0x27, 0x0,  0x0,  0x6f, 0xd8,
      0x2a, 0xa4, 0x22, 0x65, 0x9c, 0x11, 0x0,  0x0,  0x4,  0xaf, 0x22, 0x28, 0x50, 0x26, 0x0,  0x1d, 0xe,  0x56, 0xf5,
      0x80, 0xcd, 0x7a, 0x3e, 0x83, 0x92, 0x76, 0x5b, 0xef, 0x9,  0x34, 0x29, 0x4f, 0x8d, 0xc6, 0xe2, 0xd,  0x9,  0x16,
      0xbd, 0x67, 0x26, 0xab, 0xca, 0xa6, 0x4f, 0x0,  0x4,  0x96, 0x6c, 0x2d, 0x68, 0x26, 0x0,  0x2,  0x3,  0x4f, 0x0,
      0x3,  0x17, 0x94, 0xbc, 0x1,  0xa9, 0x12, 0x0,  0xe,  0x9c, 0x84, 0x61, 0x4f, 0xb6, 0x93, 0x69, 0x45, 0xc6, 0x79,
      0xd,  0x59, 0xf,  0x30, 0x22, 0x6d, 0x80, 0x26, 0x0,  0x1c, 0xbb, 0x5f, 0x56, 0x6f, 0x4c, 0x18, 0x77, 0x6a, 0x89,
      0x28, 0x6c, 0x81, 0xec, 0x3c, 0xd1, 0x7a, 0xdc, 0x46, 0x47, 0x49, 0xed, 0x63, 0xab, 0xbb, 0x96, 0x27, 0xd7, 0x68,
      0x0,  0xd,  0x32, 0x80, 0x66, 0xdc, 0x84, 0xb,  0xd7, 0xf5, 0x63, 0x4f, 0x1f, 0xcf, 0x88, 0x22, 0x74, 0xe4, 0x21,
      0x7e, 0x67, 0x9,  0x0,  0x4,  0x8a, 0x8f, 0x9f, 0x3a, 0x16, 0x0,  0x6,  0xa8, 0x9c, 0xdb, 0xc3, 0x8f, 0x81, 0x12,
      0x0,  0x1,  0x8e, 0x23, 0x21, 0xa3, 0x0,  0x1d, 0x4b, 0x79, 0xe,  0x6a, 0x9,  0xbc, 0x69, 0x9d, 0xe9, 0x5f, 0x49,
      0xc9, 0xbb, 0x8f, 0x7f, 0x59, 0xaf, 0x5f, 0x8c, 0x7d, 0xe6, 0x35, 0xce, 0x1a, 0x71, 0x62, 0x2b, 0x50, 0x30, 0x0,
      0x3,  0x65, 0x1b, 0x73, 0x0,  0x5,  0xb7, 0x6d, 0x46, 0xb7, 0x48};

  uint8_t buf[344] = {0};

  uint8_t bytesprops0[] = {0x5c, 0x92, 0x19, 0x4,  0xaa, 0x5d, 0x79, 0x83, 0xbc, 0x10, 0xc9, 0x7e, 0x80, 0xb,
                           0xcf, 0xc7, 0xa6, 0x83, 0xfd, 0xe0, 0x2a, 0x85, 0x4,  0x5b, 0x41, 0xd6, 0xc5, 0x22};
  uint8_t bytesprops1[] = {0xbd, 0x8c, 0x54, 0xf9, 0xf7, 0x75, 0x2, 0x8a, 0x97, 0xc5, 0x47};
  uint8_t bytesprops2[] = {0x2,  0xc5, 0x8b, 0x40, 0x4f, 0xe6, 0xa5, 0x7f, 0x9,  0x63, 0x56, 0x6a, 0x29, 0x65, 0x68,
                           0xf1, 0x2d, 0x2,  0xf5, 0xab, 0x10, 0x1,  0xc6, 0xed, 0x17, 0x63, 0xef, 0x13, 0x6};
  uint8_t bytesprops3[] = {0x51, 0x88, 0xa1, 0xc,  0x84, 0x78, 0xcb, 0x43, 0xea, 0xe8, 0xf8, 0xd0,
                           0x78, 0xf6, 0x53, 0xb4, 0x88, 0x49, 0x36, 0xc8, 0xd8, 0x62, 0xef, 0x71};
  uint8_t bytesprops5[] = {0x96, 0x6c, 0x2d, 0x68};
  uint8_t bytesprops4[] = {0xe,  0x56, 0xf5, 0x80, 0xcd, 0x7a, 0x3e, 0x83, 0x92, 0x76, 0x5b, 0xef, 0x9,  0x34, 0x29,
                           0x4f, 0x8d, 0xc6, 0xe2, 0xd,  0x9,  0x16, 0xbd, 0x67, 0x26, 0xab, 0xca, 0xa6, 0x4f};
  uint8_t bytesprops7[] = {0x17, 0x94, 0xbc};
  uint8_t bytesprops6[] = {0x3, 0x4f};
  uint8_t bytesprops8[] = {0x9c, 0x84, 0x61, 0x4f, 0xb6, 0x93, 0x69, 0x45, 0xc6, 0x79, 0xd, 0x59, 0xf, 0x30};
  uint8_t bytesprops10[] = {0x32, 0x80, 0x66, 0xdc, 0x84, 0xb, 0xd7, 0xf5, 0x63, 0x4f, 0x1f, 0xcf, 0x88};
  uint8_t bytesprops9[] = {0xbb, 0x5f, 0x56, 0x6f, 0x4c, 0x18, 0x77, 0x6a, 0x89, 0x28, 0x6c, 0x81, 0xec, 0x3c,
                           0xd1, 0x7a, 0xdc, 0x46, 0x47, 0x49, 0xed, 0x63, 0xab, 0xbb, 0x96, 0x27, 0xd7, 0x68};
  uint8_t bytesprops11[] = {0x8a, 0x8f, 0x9f, 0x3a};
  uint8_t bytesprops12[] = {0xa8, 0x9c, 0xdb, 0xc3, 0x8f, 0x81};
  uint8_t bytesprops13[] = {0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12557}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28632}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26012}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1199}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10320}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {4, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops6}, .v = {3, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28032}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops9}, .v = {13, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29924}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32359}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8611}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16377;
  uint8_t client_id_bytes[] = {0x4b, 0x79, 0xe,  0x6a, 0x9,  0xbc, 0x69, 0x9d, 0xe9, 0x5f, 0x49, 0xc9, 0xbb, 0x8f, 0x7f,
                               0x59, 0xaf, 0x5f, 0x8c, 0x7d, 0xe6, 0x35, 0xce, 0x1a, 0x71, 0x62, 0x2b, 0x50, 0x30};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x65, 0x1b, 0x73};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb7, 0x6d, 0x46, 0xb7, 0x48};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\238zO", _password = Just
// "\183xW\149\225\255\ACK\160\227\147\208\185\174P\148l\216\&6B\183J\152", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\192G3\202\231\255\195\177\168\239\233\234\161\DC3\186Q\230\"\t\146\ACK",
// _willMsg = "\GS\230a\199\205<}", _willProps = [PropResponseTopic
// "o%\204\217\EOT\DC2\197\131\CAN\r\241\134\247\215Ag0\135",PropAssignedClientIdentifier "\162w\t[",PropCorrelationData
// "\144",PropReceiveMaximum 976,PropRequestProblemInformation 134,PropContentType "\204\245",PropTopicAlias
// 32453,PropMaximumPacketSize 30765,PropWillDelayInterval 25398,PropPayloadFormatIndicator
// 110,PropRequestProblemInformation 6,PropReasonString "\223\236s\137\161",PropRequestResponseInformation
// 221,PropSharedSubscriptionAvailable 75,PropMaximumQoS 153,PropSharedSubscriptionAvailable 16,PropTopicAlias
// 14248,PropServerKeepAlive 32227,PropRequestProblemInformation 248]}), _cleanSession = True, _keepAlive = 18523,
// _connID = "\232\204\f\212 \185\241-\229\183\230\160\202i\225\DC1_2\224\152\198v[\219md\170", _properties =
// [PropServerKeepAlive 12674,PropServerKeepAlive 10216,PropReasonString
// "\136\181\GS\135\130^\"\216\136\&5",PropTopicAlias 20600,PropSubscriptionIdentifier 3,PropResponseTopic
// "\b\163W\\\226\ACKd\131\213\163",PropServerKeepAlive 21705,PropResponseTopic
// "\252\185R\160\"2\DLE$\f|\FS\178\205\197\188\254D7\185z\189%M",PropTopicAlias 22536,PropPayloadFormatIndicator
// 71,PropTopicAliasMaximum 12012,PropSessionExpiryInterval 14012,PropUserProperty
// "\175\254Q\166P<\228\a\141-|@\181\241\&2e\142\231\212\173\255\&7\131\194\195\154/7"
// "`\252\221Z'-\130\238\ETX\216&B\246\&8F9\ACK\ENQ\201\DC4\154S@)\198\183\132",PropRequestProblemInformation
// 71,PropWildcardSubscriptionAvailable 107,PropMessageExpiryInterval 7104,PropServerReference
// "\224\FS\STX",PropReceiveMaximum 12644,PropRetainAvailable 27,PropWildcardSubscriptionAvailable
// 226,PropSharedSubscriptionAvailable 163,PropSubscriptionIdentifier 13,PropPayloadFormatIndicator 171,PropTopicAlias
// 25711,PropTopicAliasMaximum 16376,PropUserProperty "r\NAK\206(7\198\CAN\DC4[!O\141\176\EMu\SO\199Mz$\151\156;"
// "sc\255-y"]}
TEST(Connect5QCTest, Encode31) {
  uint8_t pkt[] = {
      0x10, 0x88, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x48, 0x5b, 0xce, 0x1,  0x13, 0x31, 0x82, 0x13,
      0x27, 0xe8, 0x1f, 0x0,  0xa,  0x88, 0xb5, 0x1d, 0x87, 0x82, 0x5e, 0x22, 0xd8, 0x88, 0x35, 0x23, 0x50, 0x78, 0xb,
      0x3,  0x8,  0x0,  0xa,  0x8,  0xa3, 0x57, 0x5c, 0xe2, 0x6,  0x64, 0x83, 0xd5, 0xa3, 0x13, 0x54, 0xc9, 0x8,  0x0,
      0x17, 0xfc, 0xb9, 0x52, 0xa0, 0x22, 0x32, 0x10, 0x24, 0xc,  0x7c, 0x1c, 0xb2, 0xcd, 0xc5, 0xbc, 0xfe, 0x44, 0x37,
      0xb9, 0x7a, 0xbd, 0x25, 0x4d, 0x23, 0x58, 0x8,  0x1,  0x47, 0x22, 0x2e, 0xec, 0x11, 0x0,  0x0,  0x36, 0xbc, 0x26,
      0x0,  0x1c, 0xaf, 0xfe, 0x51, 0xa6, 0x50, 0x3c, 0xe4, 0x7,  0x8d, 0x2d, 0x7c, 0x40, 0xb5, 0xf1, 0x32, 0x65, 0x8e,
      0xe7, 0xd4, 0xad, 0xff, 0x37, 0x83, 0xc2, 0xc3, 0x9a, 0x2f, 0x37, 0x0,  0x1b, 0x60, 0xfc, 0xdd, 0x5a, 0x27, 0x2d,
      0x82, 0xee, 0x3,  0xd8, 0x26, 0x42, 0xf6, 0x38, 0x46, 0x39, 0x6,  0x5,  0xc9, 0x14, 0x9a, 0x53, 0x40, 0x29, 0xc6,
      0xb7, 0x84, 0x17, 0x47, 0x28, 0x6b, 0x2,  0x0,  0x0,  0x1b, 0xc0, 0x1c, 0x0,  0x3,  0xe0, 0x1c, 0x2,  0x21, 0x31,
      0x64, 0x25, 0x1b, 0x28, 0xe2, 0x2a, 0xa3, 0xb,  0xd,  0x1,  0xab, 0x23, 0x64, 0x6f, 0x22, 0x3f, 0xf8, 0x26, 0x0,
      0x17, 0x72, 0x15, 0xce, 0x28, 0x37, 0xc6, 0x18, 0x14, 0x5b, 0x21, 0x4f, 0x8d, 0xb0, 0x19, 0x75, 0xe,  0xc7, 0x4d,
      0x7a, 0x24, 0x97, 0x9c, 0x3b, 0x0,  0x5,  0x73, 0x63, 0xff, 0x2d, 0x79, 0x0,  0x1b, 0xe8, 0xcc, 0xc,  0xd4, 0x20,
      0xb9, 0xf1, 0x2d, 0xe5, 0xb7, 0xe6, 0xa0, 0xca, 0x69, 0xe1, 0x11, 0x5f, 0x32, 0xe0, 0x98, 0xc6, 0x76, 0x5b, 0xdb,
      0x6d, 0x64, 0xaa, 0x53, 0x8,  0x0,  0x12, 0x6f, 0x25, 0xcc, 0xd9, 0x4,  0x12, 0xc5, 0x83, 0x18, 0xd,  0xf1, 0x86,
      0xf7, 0xd7, 0x41, 0x67, 0x30, 0x87, 0x12, 0x0,  0x4,  0xa2, 0x77, 0x9,  0x5b, 0x9,  0x0,  0x1,  0x90, 0x21, 0x3,
      0xd0, 0x17, 0x86, 0x3,  0x0,  0x2,  0xcc, 0xf5, 0x23, 0x7e, 0xc5, 0x27, 0x0,  0x0,  0x78, 0x2d, 0x18, 0x0,  0x0,
      0x63, 0x36, 0x1,  0x6e, 0x17, 0x6,  0x1f, 0x0,  0x5,  0xdf, 0xec, 0x73, 0x89, 0xa1, 0x19, 0xdd, 0x2a, 0x4b, 0x24,
      0x99, 0x2a, 0x10, 0x23, 0x37, 0xa8, 0x13, 0x7d, 0xe3, 0x17, 0xf8, 0x0,  0x15, 0xc0, 0x47, 0x33, 0xca, 0xe7, 0xff,
      0xc3, 0xb1, 0xa8, 0xef, 0xe9, 0xea, 0xa1, 0x13, 0xba, 0x51, 0xe6, 0x22, 0x9,  0x92, 0x6,  0x0,  0x7,  0x1d, 0xe6,
      0x61, 0xc7, 0xcd, 0x3c, 0x7d, 0x0,  0x3,  0xee, 0x7a, 0x4f, 0x0,  0x16, 0xb7, 0x78, 0x57, 0x95, 0xe1, 0xff, 0x6,
      0xa0, 0xe3, 0x93, 0xd0, 0xb9, 0xae, 0x50, 0x94, 0x6c, 0xd8, 0x36, 0x42, 0xb7, 0x4a, 0x98};

  uint8_t buf[405] = {0};

  uint8_t bytesprops0[] = {0x88, 0xb5, 0x1d, 0x87, 0x82, 0x5e, 0x22, 0xd8, 0x88, 0x35};
  uint8_t bytesprops1[] = {0x8, 0xa3, 0x57, 0x5c, 0xe2, 0x6, 0x64, 0x83, 0xd5, 0xa3};
  uint8_t bytesprops2[] = {0xfc, 0xb9, 0x52, 0xa0, 0x22, 0x32, 0x10, 0x24, 0xc,  0x7c, 0x1c, 0xb2,
                           0xcd, 0xc5, 0xbc, 0xfe, 0x44, 0x37, 0xb9, 0x7a, 0xbd, 0x25, 0x4d};
  uint8_t bytesprops4[] = {0x60, 0xfc, 0xdd, 0x5a, 0x27, 0x2d, 0x82, 0xee, 0x3,  0xd8, 0x26, 0x42, 0xf6, 0x38,
                           0x46, 0x39, 0x6,  0x5,  0xc9, 0x14, 0x9a, 0x53, 0x40, 0x29, 0xc6, 0xb7, 0x84};
  uint8_t bytesprops3[] = {0xaf, 0xfe, 0x51, 0xa6, 0x50, 0x3c, 0xe4, 0x7,  0x8d, 0x2d, 0x7c, 0x40, 0xb5, 0xf1,
                           0x32, 0x65, 0x8e, 0xe7, 0xd4, 0xad, 0xff, 0x37, 0x83, 0xc2, 0xc3, 0x9a, 0x2f, 0x37};
  uint8_t bytesprops5[] = {0xe0, 0x1c, 0x2};
  uint8_t bytesprops7[] = {0x73, 0x63, 0xff, 0x2d, 0x79};
  uint8_t bytesprops6[] = {0x72, 0x15, 0xce, 0x28, 0x37, 0xc6, 0x18, 0x14, 0x5b, 0x21, 0x4f, 0x8d,
                           0xb0, 0x19, 0x75, 0xe,  0xc7, 0x4d, 0x7a, 0x24, 0x97, 0x9c, 0x3b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12674}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10216}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20600}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21705}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22536}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12012}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14012}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops3}, .v = {27, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7104}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12644}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25711}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16376}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops6}, .v = {5, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x6f, 0x25, 0xcc, 0xd9, 0x4,  0x12, 0xc5, 0x83, 0x18,
                               0xd,  0xf1, 0x86, 0xf7, 0xd7, 0x41, 0x67, 0x30, 0x87};
  uint8_t byteswillprops1[] = {0xa2, 0x77, 0x9, 0x5b};
  uint8_t byteswillprops2[] = {0x90};
  uint8_t byteswillprops3[] = {0xcc, 0xf5};
  uint8_t byteswillprops4[] = {0xdf, 0xec, 0x73, 0x89, 0xa1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 976}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32453}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30765}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25398}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14248}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32227}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 248}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc0, 0x47, 0x33, 0xca, 0xe7, 0xff, 0xc3, 0xb1, 0xa8, 0xef, 0xe9,
                                0xea, 0xa1, 0x13, 0xba, 0x51, 0xe6, 0x22, 0x9,  0x92, 0x6};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0xe6, 0x61, 0xc7, 0xcd, 0x3c, 0x7d};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18523;
  uint8_t client_id_bytes[] = {0xe8, 0xcc, 0xc,  0xd4, 0x20, 0xb9, 0xf1, 0x2d, 0xe5, 0xb7, 0xe6, 0xa0, 0xca, 0x69,
                               0xe1, 0x11, 0x5f, 0x32, 0xe0, 0x98, 0xc6, 0x76, 0x5b, 0xdb, 0x6d, 0x64, 0xaa};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xee, 0x7a, 0x4f};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb7, 0x78, 0x57, 0x95, 0xe1, 0xff, 0x6,  0xa0, 0xe3, 0x93, 0xd0,
                              0xb9, 0xae, 0x50, 0x94, 0x6c, 0xd8, 0x36, 0x42, 0xb7, 0x4a, 0x98};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ae\200\161\175\235\ETX\154", _password = Just
// "\ESCm\NULa\222\180jD\243e\212[\t7\DC1\143\247~\DC4=\196NJ\FS<\201\150\171\151", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\FS;\251\141\v\199\239\NUL\196T{\DC3x?\154\217\156_", _willMsg =
// "_'9\US\219\b\147\&0\133+-\148\&7G\249\172\205[\147\208\DC3\ESCC", _willProps = [PropMaximumPacketSize
// 17904,PropMessageExpiryInterval 1141,PropReasonString
// ";\"B\177\185\\n\DC3uxPC\v{\185?S\223j\146\190\vWg\158cE\"\151A",PropMessageExpiryInterval
// 29326,PropMaximumPacketSize 25000,PropWildcardSubscriptionAvailable 77,PropSubscriptionIdentifierAvailable
// 224,PropServerKeepAlive 7466,PropCorrelationData
// "\228\209\212?\135S`&\NAK\204\ENQ\200\215\161~V\220\224O\243-\213\131R9_\198\207\174",PropResponseInformation
// "c\197f\227_\NUL\246\228",PropCorrelationData "\140\153@\RS<Q\206I~\180\146\231\252\151",PropResponseTopic
// "{t\173\DC4\204\ENQ\195\148g\EOT\188\ESCB\254",PropSubscriptionIdentifier 3,PropResponseInformation
// "\229.\188eW.\206\b",PropSubscriptionIdentifier 29,PropMessageExpiryInterval 4866,PropMessageExpiryInterval
// 27714,PropTopicAlias 19961,PropResponseTopic "P\136\175\&4[)6\129a<\161\225\221\227\153_",PropUserProperty
// "\142Z-\138$\184=[-9\a\198\239\218\208B\186\DC22"
// "ndo\f\189D6|>\176\212\128\237K(\ACK\218\223\&1\168\185p\DC1\171\146\198:\171\218",PropRequestProblemInformation
// 168,PropMaximumQoS 86,PropSharedSubscriptionAvailable 69,PropSharedSubscriptionAvailable 78,PropContentType
// "\196/?\150\169&\134\128 H\176r\DLE!\152\&8\168\174\252\133\218\DC2\203\181s.",PropReceiveMaximum
// 11980,PropSubscriptionIdentifier 7,PropWillDelayInterval 21313,PropContentType
// "\226\136\254\152\227\198;",PropWillDelayInterval 21790]}), _cleanSession = False, _keepAlive = 11629, _connID =
// "\\X\222", _properties = [PropSubscriptionIdentifier 13,PropUserProperty "\251\234vxH\143\177\&2\183M\180w\180\NULV"
// "\NAK\132\212&",PropSessionExpiryInterval 6175,PropAuthenticationData "\226\205",PropCorrelationData
// "",PropRequestProblemInformation 154,PropServerReference
// "\v\163\&7\160\145\221V\228\227\186\215*9\220\244\\\195\142\199M\229\207\246\&0",PropReasonString "\203"]}
TEST(Connect5QCTest, Encode32) {
  uint8_t pkt[] = {
      0x10, 0xdb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x2d, 0x6d, 0x48, 0xb,  0xd,  0x26, 0x0,  0xf,
      0xfb, 0xea, 0x76, 0x78, 0x48, 0x8f, 0xb1, 0x32, 0xb7, 0x4d, 0xb4, 0x77, 0xb4, 0x0,  0x56, 0x0,  0x4,  0x15, 0x84,
      0xd4, 0x26, 0x11, 0x0,  0x0,  0x18, 0x1f, 0x16, 0x0,  0x2,  0xe2, 0xcd, 0x9,  0x0,  0x0,  0x17, 0x9a, 0x1c, 0x0,
      0x18, 0xb,  0xa3, 0x37, 0xa0, 0x91, 0xdd, 0x56, 0xe4, 0xe3, 0xba, 0xd7, 0x2a, 0x39, 0xdc, 0xf4, 0x5c, 0xc3, 0x8e,
      0xc7, 0x4d, 0xe5, 0xcf, 0xf6, 0x30, 0x1f, 0x0,  0x1,  0xcb, 0x0,  0x3,  0x5c, 0x58, 0xde, 0xab, 0x2,  0x27, 0x0,
      0x0,  0x45, 0xf0, 0x2,  0x0,  0x0,  0x4,  0x75, 0x1f, 0x0,  0x1e, 0x3b, 0x22, 0x42, 0xb1, 0xb9, 0x5c, 0x6e, 0x13,
      0x75, 0x78, 0x50, 0x43, 0xb,  0x7b, 0xb9, 0x3f, 0x53, 0xdf, 0x6a, 0x92, 0xbe, 0xb,  0x57, 0x67, 0x9e, 0x63, 0x45,
      0x22, 0x97, 0x41, 0x2,  0x0,  0x0,  0x72, 0x8e, 0x27, 0x0,  0x0,  0x61, 0xa8, 0x28, 0x4d, 0x29, 0xe0, 0x13, 0x1d,
      0x2a, 0x9,  0x0,  0x1d, 0xe4, 0xd1, 0xd4, 0x3f, 0x87, 0x53, 0x60, 0x26, 0x15, 0xcc, 0x5,  0xc8, 0xd7, 0xa1, 0x7e,
      0x56, 0xdc, 0xe0, 0x4f, 0xf3, 0x2d, 0xd5, 0x83, 0x52, 0x39, 0x5f, 0xc6, 0xcf, 0xae, 0x1a, 0x0,  0x8,  0x63, 0xc5,
      0x66, 0xe3, 0x5f, 0x0,  0xf6, 0xe4, 0x9,  0x0,  0xe,  0x8c, 0x99, 0x40, 0x1e, 0x3c, 0x51, 0xce, 0x49, 0x7e, 0xb4,
      0x92, 0xe7, 0xfc, 0x97, 0x8,  0x0,  0xe,  0x7b, 0x74, 0xad, 0x14, 0xcc, 0x5,  0xc3, 0x94, 0x67, 0x4,  0xbc, 0x1b,
      0x42, 0xfe, 0xb,  0x3,  0x1a, 0x0,  0x8,  0xe5, 0x2e, 0xbc, 0x65, 0x57, 0x2e, 0xce, 0x8,  0xb,  0x1d, 0x2,  0x0,
      0x0,  0x13, 0x2,  0x2,  0x0,  0x0,  0x6c, 0x42, 0x23, 0x4d, 0xf9, 0x8,  0x0,  0x10, 0x50, 0x88, 0xaf, 0x34, 0x5b,
      0x29, 0x36, 0x81, 0x61, 0x3c, 0xa1, 0xe1, 0xdd, 0xe3, 0x99, 0x5f, 0x26, 0x0,  0x13, 0x8e, 0x5a, 0x2d, 0x8a, 0x24,
      0xb8, 0x3d, 0x5b, 0x2d, 0x39, 0x7,  0xc6, 0xef, 0xda, 0xd0, 0x42, 0xba, 0x12, 0x32, 0x0,  0x1d, 0x6e, 0x64, 0x6f,
      0xc,  0xbd, 0x44, 0x36, 0x7c, 0x3e, 0xb0, 0xd4, 0x80, 0xed, 0x4b, 0x28, 0x6,  0xda, 0xdf, 0x31, 0xa8, 0xb9, 0x70,
      0x11, 0xab, 0x92, 0xc6, 0x3a, 0xab, 0xda, 0x17, 0xa8, 0x24, 0x56, 0x2a, 0x45, 0x2a, 0x4e, 0x3,  0x0,  0x1a, 0xc4,
      0x2f, 0x3f, 0x96, 0xa9, 0x26, 0x86, 0x80, 0x20, 0x48, 0xb0, 0x72, 0x10, 0x21, 0x98, 0x38, 0xa8, 0xae, 0xfc, 0x85,
      0xda, 0x12, 0xcb, 0xb5, 0x73, 0x2e, 0x21, 0x2e, 0xcc, 0xb,  0x7,  0x18, 0x0,  0x0,  0x53, 0x41, 0x3,  0x0,  0x7,
      0xe2, 0x88, 0xfe, 0x98, 0xe3, 0xc6, 0x3b, 0x18, 0x0,  0x0,  0x55, 0x1e, 0x0,  0x12, 0x1c, 0x3b, 0xfb, 0x8d, 0xb,
      0xc7, 0xef, 0x0,  0xc4, 0x54, 0x7b, 0x13, 0x78, 0x3f, 0x9a, 0xd9, 0x9c, 0x5f, 0x0,  0x17, 0x5f, 0x27, 0x39, 0x1f,
      0xdb, 0x8,  0x93, 0x30, 0x85, 0x2b, 0x2d, 0x94, 0x37, 0x47, 0xf9, 0xac, 0xcd, 0x5b, 0x93, 0xd0, 0x13, 0x1b, 0x43,
      0x0,  0x8,  0x41, 0x65, 0xc8, 0xa1, 0xaf, 0xeb, 0x3,  0x9a, 0x0,  0x1d, 0x1b, 0x6d, 0x0,  0x61, 0xde, 0xb4, 0x6a,
      0x44, 0xf3, 0x65, 0xd4, 0x5b, 0x9,  0x37, 0x11, 0x8f, 0xf7, 0x7e, 0x14, 0x3d, 0xc4, 0x4e, 0x4a, 0x1c, 0x3c, 0xc9,
      0x96, 0xab, 0x97};

  uint8_t buf[488] = {0};

  uint8_t bytesprops1[] = {0x15, 0x84, 0xd4, 0x26};
  uint8_t bytesprops0[] = {0xfb, 0xea, 0x76, 0x78, 0x48, 0x8f, 0xb1, 0x32, 0xb7, 0x4d, 0xb4, 0x77, 0xb4, 0x0, 0x56};
  uint8_t bytesprops2[] = {0xe2, 0xcd};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xb,  0xa3, 0x37, 0xa0, 0x91, 0xdd, 0x56, 0xe4, 0xe3, 0xba, 0xd7, 0x2a,
                           0x39, 0xdc, 0xf4, 0x5c, 0xc3, 0x8e, 0xc7, 0x4d, 0xe5, 0xcf, 0xf6, 0x30};
  uint8_t bytesprops5[] = {0xcb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {4, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6175}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3b, 0x22, 0x42, 0xb1, 0xb9, 0x5c, 0x6e, 0x13, 0x75, 0x78,
                               0x50, 0x43, 0xb,  0x7b, 0xb9, 0x3f, 0x53, 0xdf, 0x6a, 0x92,
                               0xbe, 0xb,  0x57, 0x67, 0x9e, 0x63, 0x45, 0x22, 0x97, 0x41};
  uint8_t byteswillprops1[] = {0xe4, 0xd1, 0xd4, 0x3f, 0x87, 0x53, 0x60, 0x26, 0x15, 0xcc, 0x5,  0xc8, 0xd7, 0xa1, 0x7e,
                               0x56, 0xdc, 0xe0, 0x4f, 0xf3, 0x2d, 0xd5, 0x83, 0x52, 0x39, 0x5f, 0xc6, 0xcf, 0xae};
  uint8_t byteswillprops2[] = {0x63, 0xc5, 0x66, 0xe3, 0x5f, 0x0, 0xf6, 0xe4};
  uint8_t byteswillprops3[] = {0x8c, 0x99, 0x40, 0x1e, 0x3c, 0x51, 0xce, 0x49, 0x7e, 0xb4, 0x92, 0xe7, 0xfc, 0x97};
  uint8_t byteswillprops4[] = {0x7b, 0x74, 0xad, 0x14, 0xcc, 0x5, 0xc3, 0x94, 0x67, 0x4, 0xbc, 0x1b, 0x42, 0xfe};
  uint8_t byteswillprops5[] = {0xe5, 0x2e, 0xbc, 0x65, 0x57, 0x2e, 0xce, 0x8};
  uint8_t byteswillprops6[] = {0x50, 0x88, 0xaf, 0x34, 0x5b, 0x29, 0x36, 0x81,
                               0x61, 0x3c, 0xa1, 0xe1, 0xdd, 0xe3, 0x99, 0x5f};
  uint8_t byteswillprops8[] = {0x6e, 0x64, 0x6f, 0xc,  0xbd, 0x44, 0x36, 0x7c, 0x3e, 0xb0, 0xd4, 0x80, 0xed, 0x4b, 0x28,
                               0x6,  0xda, 0xdf, 0x31, 0xa8, 0xb9, 0x70, 0x11, 0xab, 0x92, 0xc6, 0x3a, 0xab, 0xda};
  uint8_t byteswillprops7[] = {0x8e, 0x5a, 0x2d, 0x8a, 0x24, 0xb8, 0x3d, 0x5b, 0x2d, 0x39,
                               0x7,  0xc6, 0xef, 0xda, 0xd0, 0x42, 0xba, 0x12, 0x32};
  uint8_t byteswillprops9[] = {0xc4, 0x2f, 0x3f, 0x96, 0xa9, 0x26, 0x86, 0x80, 0x20, 0x48, 0xb0, 0x72, 0x10,
                               0x21, 0x98, 0x38, 0xa8, 0xae, 0xfc, 0x85, 0xda, 0x12, 0xcb, 0xb5, 0x73, 0x2e};
  uint8_t byteswillprops10[] = {0xe2, 0x88, 0xfe, 0x98, 0xe3, 0xc6, 0x3b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17904}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1141}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29326}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25000}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7466}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4866}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27714}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19961}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&byteswillprops7}, .v = {29, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11980}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21313}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21790}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1c, 0x3b, 0xfb, 0x8d, 0xb,  0xc7, 0xef, 0x0,  0xc4,
                                0x54, 0x7b, 0x13, 0x78, 0x3f, 0x9a, 0xd9, 0x9c, 0x5f};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5f, 0x27, 0x39, 0x1f, 0xdb, 0x8,  0x93, 0x30, 0x85, 0x2b, 0x2d, 0x94,
                                  0x37, 0x47, 0xf9, 0xac, 0xcd, 0x5b, 0x93, 0xd0, 0x13, 0x1b, 0x43};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11629;
  uint8_t client_id_bytes[] = {0x5c, 0x58, 0xde};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0x65, 0xc8, 0xa1, 0xaf, 0xeb, 0x3, 0x9a};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1b, 0x6d, 0x0,  0x61, 0xde, 0xb4, 0x6a, 0x44, 0xf3, 0x65, 0xd4, 0x5b, 0x9,  0x37, 0x11,
                              0x8f, 0xf7, 0x7e, 0x14, 0x3d, 0xc4, 0x4e, 0x4a, 0x1c, 0x3c, 0xc9, 0x96, 0xab, 0x97};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\150\147\177\160\218r%'C\139\159\&6\178", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\158/9\141", _willMsg =
// "\189\DC4a\NUL\243\231@W\178\194\&7\212\\\150W\244\244\226Y=\164\138\228\154qi\129(\SOH}", _willProps =
// [PropSharedSubscriptionAvailable 219,PropTopicAlias 23920,PropResponseTopic
// "2\181Q\254\DC1\192\172N\186",PropWildcardSubscriptionAvailable 247,PropRetainAvailable 33,PropUserProperty
// "\ESC6\160\DEL\193\145\ENQ\r\208\&7\201\253t" "\189O\235\NAK'm\186\SO\\i",PropSharedSubscriptionAvailable
// 244,PropAssignedClientIdentifier
// "\195\&5\163\191#\236;\252\SYN;\178\165~\194\203\229z\GS\250\DELW\v\230\155\DC1'm",PropRequestResponseInformation
// 26,PropPayloadFormatIndicator 192,PropWillDelayInterval 16423,PropAssignedClientIdentifier
// "Q\195\v\253",PropReasonString "\ENQ\161\133\237_\215\184\184&CW",PropCorrelationData
// "~\167\239\141\208\215g",PropServerKeepAlive 10841,PropAssignedClientIdentifier
// "~\186\176\176h\NAKv",PropWildcardSubscriptionAvailable 29,PropMessageExpiryInterval
// 26220,PropRequestResponseInformation 54,PropWillDelayInterval 16152,PropSubscriptionIdentifier
// 14,PropWildcardSubscriptionAvailable 90,PropReasonString "\211\172\247",PropContentType "\246",PropAuthenticationData
// "\DC3U\193ldY\254\253)\192`\216>\199\"\219\207\217",PropAuthenticationData
// "\131\v\174\206\161\CAN\ETB\n\132\&4s@\a",PropResponseTopic ""]}), _cleanSession = True, _keepAlive = 6008, _connID =
// "3\252\rE\195\SYNO^\160\182\243\US\166\254\183 \NAK\SUB\159\173\196\\\150\179D\245", _properties =
// [PropMaximumPacketSize 5391,PropAssignedClientIdentifier
// "kU[\143\214o\252\200\233\166bT\SI\218\247\147\152\226\n",PropAssignedClientIdentifier
// "\207\157[\245RG8\193",PropPayloadFormatIndicator 2,PropMaximumPacketSize 32093,PropSessionExpiryInterval
// 16956,PropPayloadFormatIndicator 157,PropReceiveMaximum 28710,PropReceiveMaximum 15106,PropResponseTopic
// "",PropAssignedClientIdentifier "\CAN\140%\214",PropTopicAlias 2832,PropMessageExpiryInterval 27101,PropTopicAlias
// 4406,PropSubscriptionIdentifierAvailable 181,PropRequestProblemInformation 154,PropAuthenticationData
// "i~\230\224bT\129\209\137\182",PropSessionExpiryInterval 21237,PropTopicAlias 25576]}
TEST(Connect5QCTest, Encode33) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x17, 0x78, 0x68, 0x27, 0x0,  0x0,  0x15, 0xf,
      0x12, 0x0,  0x13, 0x6b, 0x55, 0x5b, 0x8f, 0xd6, 0x6f, 0xfc, 0xc8, 0xe9, 0xa6, 0x62, 0x54, 0xf,  0xda, 0xf7, 0x93,
      0x98, 0xe2, 0xa,  0x12, 0x0,  0x8,  0xcf, 0x9d, 0x5b, 0xf5, 0x52, 0x47, 0x38, 0xc1, 0x1,  0x2,  0x27, 0x0,  0x0,
      0x7d, 0x5d, 0x11, 0x0,  0x0,  0x42, 0x3c, 0x1,  0x9d, 0x21, 0x70, 0x26, 0x21, 0x3b, 0x2,  0x8,  0x0,  0x0,  0x12,
      0x0,  0x4,  0x18, 0x8c, 0x25, 0xd6, 0x23, 0xb,  0x10, 0x2,  0x0,  0x0,  0x69, 0xdd, 0x23, 0x11, 0x36, 0x29, 0xb5,
      0x17, 0x9a, 0x16, 0x0,  0xa,  0x69, 0x7e, 0xe6, 0xe0, 0x62, 0x54, 0x81, 0xd1, 0x89, 0xb6, 0x11, 0x0,  0x0,  0x52,
      0xf5, 0x23, 0x63, 0xe8, 0x0,  0x1a, 0x33, 0xfc, 0xd,  0x45, 0xc3, 0x16, 0x4f, 0x5e, 0xa0, 0xb6, 0xf3, 0x1f, 0xa6,
      0xfe, 0xb7, 0x20, 0x15, 0x1a, 0x9f, 0xad, 0xc4, 0x5c, 0x96, 0xb3, 0x44, 0xf5, 0xca, 0x1,  0x2a, 0xdb, 0x23, 0x5d,
      0x70, 0x8,  0x0,  0x9,  0x32, 0xb5, 0x51, 0xfe, 0x11, 0xc0, 0xac, 0x4e, 0xba, 0x28, 0xf7, 0x25, 0x21, 0x26, 0x0,
      0xd,  0x1b, 0x36, 0xa0, 0x7f, 0xc1, 0x91, 0x5,  0xd,  0xd0, 0x37, 0xc9, 0xfd, 0x74, 0x0,  0xa,  0xbd, 0x4f, 0xeb,
      0x15, 0x27, 0x6d, 0xba, 0xe,  0x5c, 0x69, 0x2a, 0xf4, 0x12, 0x0,  0x1b, 0xc3, 0x35, 0xa3, 0xbf, 0x23, 0xec, 0x3b,
      0xfc, 0x16, 0x3b, 0xb2, 0xa5, 0x7e, 0xc2, 0xcb, 0xe5, 0x7a, 0x1d, 0xfa, 0x7f, 0x57, 0xb,  0xe6, 0x9b, 0x11, 0x27,
      0x6d, 0x19, 0x1a, 0x1,  0xc0, 0x18, 0x0,  0x0,  0x40, 0x27, 0x12, 0x0,  0x4,  0x51, 0xc3, 0xb,  0xfd, 0x1f, 0x0,
      0xb,  0x5,  0xa1, 0x85, 0xed, 0x5f, 0xd7, 0xb8, 0xb8, 0x26, 0x43, 0x57, 0x9,  0x0,  0x7,  0x7e, 0xa7, 0xef, 0x8d,
      0xd0, 0xd7, 0x67, 0x13, 0x2a, 0x59, 0x12, 0x0,  0x7,  0x7e, 0xba, 0xb0, 0xb0, 0x68, 0x15, 0x76, 0x28, 0x1d, 0x2,
      0x0,  0x0,  0x66, 0x6c, 0x19, 0x36, 0x18, 0x0,  0x0,  0x3f, 0x18, 0xb,  0xe,  0x28, 0x5a, 0x1f, 0x0,  0x3,  0xd3,
      0xac, 0xf7, 0x3,  0x0,  0x1,  0xf6, 0x16, 0x0,  0x12, 0x13, 0x55, 0xc1, 0x6c, 0x64, 0x59, 0xfe, 0xfd, 0x29, 0xc0,
      0x60, 0xd8, 0x3e, 0xc7, 0x22, 0xdb, 0xcf, 0xd9, 0x16, 0x0,  0xd,  0x83, 0xb,  0xae, 0xce, 0xa1, 0x18, 0x17, 0xa,
      0x84, 0x34, 0x73, 0x40, 0x7,  0x8,  0x0,  0x0,  0x0,  0x4,  0x9e, 0x2f, 0x39, 0x8d, 0x0,  0x1e, 0xbd, 0x14, 0x61,
      0x0,  0xf3, 0xe7, 0x40, 0x57, 0xb2, 0xc2, 0x37, 0xd4, 0x5c, 0x96, 0x57, 0xf4, 0xf4, 0xe2, 0x59, 0x3d, 0xa4, 0x8a,
      0xe4, 0x9a, 0x71, 0x69, 0x81, 0x28, 0x1,  0x7d};

  uint8_t buf[398] = {0};

  uint8_t bytesprops0[] = {0x6b, 0x55, 0x5b, 0x8f, 0xd6, 0x6f, 0xfc, 0xc8, 0xe9, 0xa6,
                           0x62, 0x54, 0xf,  0xda, 0xf7, 0x93, 0x98, 0xe2, 0xa};
  uint8_t bytesprops1[] = {0xcf, 0x9d, 0x5b, 0xf5, 0x52, 0x47, 0x38, 0xc1};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x18, 0x8c, 0x25, 0xd6};
  uint8_t bytesprops4[] = {0x69, 0x7e, 0xe6, 0xe0, 0x62, 0x54, 0x81, 0xd1, 0x89, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5391}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32093}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16956}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28710}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15106}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2832}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27101}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4406}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21237}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25576}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x32, 0xb5, 0x51, 0xfe, 0x11, 0xc0, 0xac, 0x4e, 0xba};
  uint8_t byteswillprops2[] = {0xbd, 0x4f, 0xeb, 0x15, 0x27, 0x6d, 0xba, 0xe, 0x5c, 0x69};
  uint8_t byteswillprops1[] = {0x1b, 0x36, 0xa0, 0x7f, 0xc1, 0x91, 0x5, 0xd, 0xd0, 0x37, 0xc9, 0xfd, 0x74};
  uint8_t byteswillprops3[] = {0xc3, 0x35, 0xa3, 0xbf, 0x23, 0xec, 0x3b, 0xfc, 0x16, 0x3b, 0xb2, 0xa5, 0x7e, 0xc2,
                               0xcb, 0xe5, 0x7a, 0x1d, 0xfa, 0x7f, 0x57, 0xb,  0xe6, 0x9b, 0x11, 0x27, 0x6d};
  uint8_t byteswillprops4[] = {0x51, 0xc3, 0xb, 0xfd};
  uint8_t byteswillprops5[] = {0x5, 0xa1, 0x85, 0xed, 0x5f, 0xd7, 0xb8, 0xb8, 0x26, 0x43, 0x57};
  uint8_t byteswillprops6[] = {0x7e, 0xa7, 0xef, 0x8d, 0xd0, 0xd7, 0x67};
  uint8_t byteswillprops7[] = {0x7e, 0xba, 0xb0, 0xb0, 0x68, 0x15, 0x76};
  uint8_t byteswillprops8[] = {0xd3, 0xac, 0xf7};
  uint8_t byteswillprops9[] = {0xf6};
  uint8_t byteswillprops10[] = {0x13, 0x55, 0xc1, 0x6c, 0x64, 0x59, 0xfe, 0xfd, 0x29,
                                0xc0, 0x60, 0xd8, 0x3e, 0xc7, 0x22, 0xdb, 0xcf, 0xd9};
  uint8_t byteswillprops11[] = {0x83, 0xb, 0xae, 0xce, 0xa1, 0x18, 0x17, 0xa, 0x84, 0x34, 0x73, 0x40, 0x7};
  uint8_t byteswillprops12[] = {0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23920}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops1}, .v = {10, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16423}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10841}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26220}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16152}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9e, 0x2f, 0x39, 0x8d};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0x14, 0x61, 0x0,  0xf3, 0xe7, 0x40, 0x57, 0xb2, 0xc2,
                                  0x37, 0xd4, 0x5c, 0x96, 0x57, 0xf4, 0xf4, 0xe2, 0x59, 0x3d,
                                  0xa4, 0x8a, 0xe4, 0x9a, 0x71, 0x69, 0x81, 0x28, 0x1,  0x7d};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6008;
  uint8_t client_id_bytes[] = {0x33, 0xfc, 0xd,  0x45, 0xc3, 0x16, 0x4f, 0x5e, 0xa0, 0xb6, 0xf3, 0x1f, 0xa6,
                               0xfe, 0xb7, 0x20, 0x15, 0x1a, 0x9f, 0xad, 0xc4, 0x5c, 0x96, 0xb3, 0x44, 0xf5};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x96, 0x93, 0xb1, 0xa0, 0xda, 0x72, 0x25, 0x27, 0x43, 0x8b, 0x9f, 0x36, 0xb2};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Y\v>5Bm\227", _password = Just "\138\203", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic = "\206v\171\156\146%.\249$W", _willMsg = "\bH\DC4H", _willProps =
// [PropRetainAvailable 199,PropMessageExpiryInterval 29826,PropRequestResponseInformation
// 144,PropRequestProblemInformation 175,PropSubscriptionIdentifier 23,PropSharedSubscriptionAvailable
// 242,PropCorrelationData
// "_\181\173j\250\161\156\248\135\161D\ETB\199\142\228\159\251\148/\SOH\202\225",PropCorrelationData
// "\r*\r\212yag\218[_\151k\225\191\136\186\216\232\230\182\223\160\GS",PropServerKeepAlive 11815]}), _cleanSession =
// True, _keepAlive = 23415, _connID = "\204wCr\148\250tb\RS\139\204\142\r\206\180\231\DC26Cv\254+\STX\ETX\250\t",
// _properties = [PropCorrelationData
// "S\SUB,\146\197/J\FS\145.\a\147L\155\167\230+U&\151S\DLE\254\167t\167Ve\200\180",PropRetainAvailable
// 197,PropPayloadFormatIndicator 175,PropTopicAliasMaximum 2854,PropReasonString
// "\179\NAK\154\a;Na%\128\234Q\141x\248<\178\254r\232o\147/\252r\179\229\230",PropMessageExpiryInterval
// 12863,PropTopicAlias 5178,PropRetainAvailable 17,PropMessageExpiryInterval 31630,PropUserProperty
// "V\136v\182\196(4\146\145P" "W\206\210\196\185Z)o\240\130C\248X\219R\202\153\b\221",PropMessageExpiryInterval
// 11401,PropUserProperty "\ETBf" "}\v}\248\167\EM\217\154\139K\231h\253\173fa\209\240",PropAuthenticationData
// "\EMSz\229\231W\246f\US\238\228%\192}\210\173\185t\205",PropMessageExpiryInterval
// 3915,PropSubscriptionIdentifierAvailable 223,PropWillDelayInterval 7999,PropMessageExpiryInterval
// 21248,PropRetainAvailable 63,PropTopicAliasMaximum 30995,PropServerKeepAlive 5186,PropReasonString "
// .\246$\145\200?|\236m\175D",PropTopicAliasMaximum 31289,PropRetainAvailable 46]}
TEST(Connect5QCTest, Encode34) {
  uint8_t pkt[] = {
      0x10, 0xe5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x5b, 0x77, 0xd8, 0x1,  0x9,  0x0,  0x1e, 0x53,
      0x1a, 0x2c, 0x92, 0xc5, 0x2f, 0x4a, 0x1c, 0x91, 0x2e, 0x7,  0x93, 0x4c, 0x9b, 0xa7, 0xe6, 0x2b, 0x55, 0x26, 0x97,
      0x53, 0x10, 0xfe, 0xa7, 0x74, 0xa7, 0x56, 0x65, 0xc8, 0xb4, 0x25, 0xc5, 0x1,  0xaf, 0x22, 0xb,  0x26, 0x1f, 0x0,
      0x1b, 0xb3, 0x15, 0x9a, 0x7,  0x3b, 0x4e, 0x61, 0x25, 0x80, 0xea, 0x51, 0x8d, 0x78, 0xf8, 0x3c, 0xb2, 0xfe, 0x72,
      0xe8, 0x6f, 0x93, 0x2f, 0xfc, 0x72, 0xb3, 0xe5, 0xe6, 0x2,  0x0,  0x0,  0x32, 0x3f, 0x23, 0x14, 0x3a, 0x25, 0x11,
      0x2,  0x0,  0x0,  0x7b, 0x8e, 0x26, 0x0,  0xa,  0x56, 0x88, 0x76, 0xb6, 0xc4, 0x28, 0x34, 0x92, 0x91, 0x50, 0x0,
      0x13, 0x57, 0xce, 0xd2, 0xc4, 0xb9, 0x5a, 0x29, 0x6f, 0xf0, 0x82, 0x43, 0xf8, 0x58, 0xdb, 0x52, 0xca, 0x99, 0x8,
      0xdd, 0x2,  0x0,  0x0,  0x2c, 0x89, 0x26, 0x0,  0x2,  0x17, 0x66, 0x0,  0x12, 0x7d, 0xb,  0x7d, 0xf8, 0xa7, 0x19,
      0xd9, 0x9a, 0x8b, 0x4b, 0xe7, 0x68, 0xfd, 0xad, 0x66, 0x61, 0xd1, 0xf0, 0x16, 0x0,  0x13, 0x19, 0x53, 0x7a, 0xe5,
      0xe7, 0x57, 0xf6, 0x66, 0x1f, 0xee, 0xe4, 0x25, 0xc0, 0x7d, 0xd2, 0xad, 0xb9, 0x74, 0xcd, 0x2,  0x0,  0x0,  0xf,
      0x4b, 0x29, 0xdf, 0x18, 0x0,  0x0,  0x1f, 0x3f, 0x2,  0x0,  0x0,  0x53, 0x0,  0x25, 0x3f, 0x22, 0x79, 0x13, 0x13,
      0x14, 0x42, 0x1f, 0x0,  0xc,  0x20, 0x2e, 0xf6, 0x24, 0x91, 0xc8, 0x3f, 0x7c, 0xec, 0x6d, 0xaf, 0x44, 0x22, 0x7a,
      0x39, 0x25, 0x2e, 0x0,  0x1a, 0xcc, 0x77, 0x43, 0x72, 0x94, 0xfa, 0x74, 0x62, 0x1e, 0x8b, 0xcc, 0x8e, 0xd,  0xce,
      0xb4, 0xe7, 0x12, 0x36, 0x43, 0x76, 0xfe, 0x2b, 0x2,  0x3,  0xfa, 0x9,  0x45, 0x25, 0xc7, 0x2,  0x0,  0x0,  0x74,
      0x82, 0x19, 0x90, 0x17, 0xaf, 0xb,  0x17, 0x2a, 0xf2, 0x9,  0x0,  0x16, 0x5f, 0xb5, 0xad, 0x6a, 0xfa, 0xa1, 0x9c,
      0xf8, 0x87, 0xa1, 0x44, 0x17, 0xc7, 0x8e, 0xe4, 0x9f, 0xfb, 0x94, 0x2f, 0x1,  0xca, 0xe1, 0x9,  0x0,  0x17, 0xd,
      0x2a, 0xd,  0xd4, 0x79, 0x61, 0x67, 0xda, 0x5b, 0x5f, 0x97, 0x6b, 0xe1, 0xbf, 0x88, 0xba, 0xd8, 0xe8, 0xe6, 0xb6,
      0xdf, 0xa0, 0x1d, 0x13, 0x2e, 0x27, 0x0,  0xa,  0xce, 0x76, 0xab, 0x9c, 0x92, 0x25, 0x2e, 0xf9, 0x24, 0x57, 0x0,
      0x4,  0x8,  0x48, 0x14, 0x48, 0x0,  0x7,  0x59, 0xb,  0x3e, 0x35, 0x42, 0x6d, 0xe3, 0x0,  0x2,  0x8a, 0xcb};

  uint8_t buf[370] = {0};

  uint8_t bytesprops0[] = {0x53, 0x1a, 0x2c, 0x92, 0xc5, 0x2f, 0x4a, 0x1c, 0x91, 0x2e, 0x7,  0x93, 0x4c, 0x9b, 0xa7,
                           0xe6, 0x2b, 0x55, 0x26, 0x97, 0x53, 0x10, 0xfe, 0xa7, 0x74, 0xa7, 0x56, 0x65, 0xc8, 0xb4};
  uint8_t bytesprops1[] = {0xb3, 0x15, 0x9a, 0x7,  0x3b, 0x4e, 0x61, 0x25, 0x80, 0xea, 0x51, 0x8d, 0x78, 0xf8,
                           0x3c, 0xb2, 0xfe, 0x72, 0xe8, 0x6f, 0x93, 0x2f, 0xfc, 0x72, 0xb3, 0xe5, 0xe6};
  uint8_t bytesprops3[] = {0x57, 0xce, 0xd2, 0xc4, 0xb9, 0x5a, 0x29, 0x6f, 0xf0, 0x82,
                           0x43, 0xf8, 0x58, 0xdb, 0x52, 0xca, 0x99, 0x8,  0xdd};
  uint8_t bytesprops2[] = {0x56, 0x88, 0x76, 0xb6, 0xc4, 0x28, 0x34, 0x92, 0x91, 0x50};
  uint8_t bytesprops5[] = {0x7d, 0xb,  0x7d, 0xf8, 0xa7, 0x19, 0xd9, 0x9a, 0x8b,
                           0x4b, 0xe7, 0x68, 0xfd, 0xad, 0x66, 0x61, 0xd1, 0xf0};
  uint8_t bytesprops4[] = {0x17, 0x66};
  uint8_t bytesprops6[] = {0x19, 0x53, 0x7a, 0xe5, 0xe7, 0x57, 0xf6, 0x66, 0x1f, 0xee,
                           0xe4, 0x25, 0xc0, 0x7d, 0xd2, 0xad, 0xb9, 0x74, 0xcd};
  uint8_t bytesprops7[] = {0x20, 0x2e, 0xf6, 0x24, 0x91, 0xc8, 0x3f, 0x7c, 0xec, 0x6d, 0xaf, 0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2854}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12863}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5178}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31630}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {19, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11401}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops4}, .v = {18, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3915}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7999}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21248}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30995}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5186}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31289}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 46}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x5f, 0xb5, 0xad, 0x6a, 0xfa, 0xa1, 0x9c, 0xf8, 0x87, 0xa1, 0x44,
                               0x17, 0xc7, 0x8e, 0xe4, 0x9f, 0xfb, 0x94, 0x2f, 0x1,  0xca, 0xe1};
  uint8_t byteswillprops1[] = {0xd,  0x2a, 0xd,  0xd4, 0x79, 0x61, 0x67, 0xda, 0x5b, 0x5f, 0x97, 0x6b,
                               0xe1, 0xbf, 0x88, 0xba, 0xd8, 0xe8, 0xe6, 0xb6, 0xdf, 0xa0, 0x1d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29826}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11815}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xce, 0x76, 0xab, 0x9c, 0x92, 0x25, 0x2e, 0xf9, 0x24, 0x57};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8, 0x48, 0x14, 0x48};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23415;
  uint8_t client_id_bytes[] = {0xcc, 0x77, 0x43, 0x72, 0x94, 0xfa, 0x74, 0x62, 0x1e, 0x8b, 0xcc, 0x8e, 0xd,
                               0xce, 0xb4, 0xe7, 0x12, 0x36, 0x43, 0x76, 0xfe, 0x2b, 0x2,  0x3,  0xfa, 0x9};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x59, 0xb, 0x3e, 0x35, 0x42, 0x6d, 0xe3};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x8a, 0xcb};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "]\153\135\145US\141\240H\229\241g\ETX", _willMsg = "S\147\227\222\204\171\172K", _willProps =
// [PropServerKeepAlive 1944,PropReasonString
// "0\239\168\&5<\ETX\140\235I\244\173\138z\ESC{\129\197\207\143\220M\195\150\a\155oC",PropPayloadFormatIndicator
// 130,PropMessageExpiryInterval 8409,PropWildcardSubscriptionAvailable 23,PropWillDelayInterval
// 14617,PropCorrelationData
// "\167t\142\149G\RS#\158\136\243\220Ok\210\DC4\205\155(\137\n\239\141&\215<\174\169",PropRetainAvailable
// 166,PropContentType
// "5\FS\177TN@\249.\151b\245\216&\147\128\212I$\236\v\238\221<b\255NQ\a\RS",PropMessageExpiryInterval
// 23741,PropAuthenticationMethod "\EM\195\244\196\DC1\136n\236\237",PropAssignedClientIdentifier
// "\a",PropRequestProblemInformation 37,PropRequestProblemInformation 55,PropAuthenticationMethod
// "\GSX*r\130h\a",PropAuthenticationMethod
// "\DC1\158\220\156\178\230\249m\218p\236\CAN\RSprme\232\167A\155\216\ETXf",PropMessageExpiryInterval
// 20023,PropMaximumQoS 3,PropServerReference "\130\RS\205\167#&%\255\181\129\185\217q\136\222\232\198",PropTopicAlias
// 3673,PropSubscriptionIdentifierAvailable 212,PropAssignedClientIdentifier
// "s\t\243\192+i\253\186\237g\185#%V-\174",PropAuthenticationMethod
// "W\ACK\ETB@\130\185\226\150ZP\DC2\150\DEL}R",PropSessionExpiryInterval 22088,PropWildcardSubscriptionAvailable
// 64,PropWildcardSubscriptionAvailable 124,PropReasonString
// "\ETX\185\193\SOH\132iX)v\SI\208[G\188\FS\"\182pA\223\152$\223\nR9\179(r\147",PropUserProperty
// "\211v\DC3\192\DEL\237\183\SI&1\EM\148\DLE" "\216",PropRequestResponseInformation 64]}), _cleanSession = True,
// _keepAlive = 12605, _connID = "\213?\SO\227\212\225\234\193\164'\SYN0,6\152", _properties = [PropUserProperty
// "%\FS\179\171\143\146V\175\174\v\202\200\220\253" "\143\214u\141\216\168f5m
// Q\213L\202\136[Q\218i\STX",PropSubscriptionIdentifier 25,PropRetainAvailable 148,PropMaximumQoS
// 199,PropServerReference "r},\235X\218\158k\205\209",PropSubscriptionIdentifierAvailable 73,PropMessageExpiryInterval
// 32278,PropMaximumQoS 232,PropSubscriptionIdentifierAvailable 214,PropAuthenticationMethod
// "\199\198\244\229\236)\146\167\171\&9S\199\139\175\210\DEL",PropServerKeepAlive 21985,PropTopicAlias
// 27825,PropMaximumQoS 137,PropAuthenticationMethod "\196\228\FS9\182\SUB\189\v\209\204",PropReceiveMaximum
// 11102,PropRetainAvailable 203,PropRequestProblemInformation 76,PropSharedSubscriptionAvailable 19]}
TEST(Connect5QCTest, Encode35) {
  uint8_t pkt[] = {
      0x10, 0xde, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x31, 0x3d, 0x76, 0x26, 0x0,  0xe,  0x25, 0x1c,
      0xb3, 0xab, 0x8f, 0x92, 0x56, 0xaf, 0xae, 0xb,  0xca, 0xc8, 0xdc, 0xfd, 0x0,  0x14, 0x8f, 0xd6, 0x75, 0x8d, 0xd8,
      0xa8, 0x66, 0x35, 0x6d, 0x20, 0x51, 0xd5, 0x4c, 0xca, 0x88, 0x5b, 0x51, 0xda, 0x69, 0x2,  0xb,  0x19, 0x25, 0x94,
      0x24, 0xc7, 0x1c, 0x0,  0xa,  0x72, 0x7d, 0x2c, 0xeb, 0x58, 0xda, 0x9e, 0x6b, 0xcd, 0xd1, 0x29, 0x49, 0x2,  0x0,
      0x0,  0x7e, 0x16, 0x24, 0xe8, 0x29, 0xd6, 0x15, 0x0,  0x10, 0xc7, 0xc6, 0xf4, 0xe5, 0xec, 0x29, 0x92, 0xa7, 0xab,
      0x39, 0x53, 0xc7, 0x8b, 0xaf, 0xd2, 0x7f, 0x13, 0x55, 0xe1, 0x23, 0x6c, 0xb1, 0x24, 0x89, 0x15, 0x0,  0xa,  0xc4,
      0xe4, 0x1c, 0x39, 0xb6, 0x1a, 0xbd, 0xb,  0xd1, 0xcc, 0x21, 0x2b, 0x5e, 0x25, 0xcb, 0x17, 0x4c, 0x2a, 0x13, 0x0,
      0xf,  0xd5, 0x3f, 0xe,  0xe3, 0xd4, 0xe1, 0xea, 0xc1, 0xa4, 0x27, 0x16, 0x30, 0x2c, 0x36, 0x98, 0xb1, 0x2,  0x13,
      0x7,  0x98, 0x1f, 0x0,  0x1b, 0x30, 0xef, 0xa8, 0x35, 0x3c, 0x3,  0x8c, 0xeb, 0x49, 0xf4, 0xad, 0x8a, 0x7a, 0x1b,
      0x7b, 0x81, 0xc5, 0xcf, 0x8f, 0xdc, 0x4d, 0xc3, 0x96, 0x7,  0x9b, 0x6f, 0x43, 0x1,  0x82, 0x2,  0x0,  0x0,  0x20,
      0xd9, 0x28, 0x17, 0x18, 0x0,  0x0,  0x39, 0x19, 0x9,  0x0,  0x1b, 0xa7, 0x74, 0x8e, 0x95, 0x47, 0x1e, 0x23, 0x9e,
      0x88, 0xf3, 0xdc, 0x4f, 0x6b, 0xd2, 0x14, 0xcd, 0x9b, 0x28, 0x89, 0xa,  0xef, 0x8d, 0x26, 0xd7, 0x3c, 0xae, 0xa9,
      0x25, 0xa6, 0x3,  0x0,  0x1d, 0x35, 0x1c, 0xb1, 0x54, 0x4e, 0x40, 0xf9, 0x2e, 0x97, 0x62, 0xf5, 0xd8, 0x26, 0x93,
      0x80, 0xd4, 0x49, 0x24, 0xec, 0xb,  0xee, 0xdd, 0x3c, 0x62, 0xff, 0x4e, 0x51, 0x7,  0x1e, 0x2,  0x0,  0x0,  0x5c,
      0xbd, 0x15, 0x0,  0x9,  0x19, 0xc3, 0xf4, 0xc4, 0x11, 0x88, 0x6e, 0xec, 0xed, 0x12, 0x0,  0x1,  0x7,  0x17, 0x25,
      0x17, 0x37, 0x15, 0x0,  0x7,  0x1d, 0x58, 0x2a, 0x72, 0x82, 0x68, 0x7,  0x15, 0x0,  0x18, 0x11, 0x9e, 0xdc, 0x9c,
      0xb2, 0xe6, 0xf9, 0x6d, 0xda, 0x70, 0xec, 0x18, 0x1e, 0x70, 0x72, 0x6d, 0x65, 0xe8, 0xa7, 0x41, 0x9b, 0xd8, 0x3,
      0x66, 0x2,  0x0,  0x0,  0x4e, 0x37, 0x24, 0x3,  0x1c, 0x0,  0x11, 0x82, 0x1e, 0xcd, 0xa7, 0x23, 0x26, 0x25, 0xff,
      0xb5, 0x81, 0xb9, 0xd9, 0x71, 0x88, 0xde, 0xe8, 0xc6, 0x23, 0xe,  0x59, 0x29, 0xd4, 0x12, 0x0,  0x10, 0x73, 0x9,
      0xf3, 0xc0, 0x2b, 0x69, 0xfd, 0xba, 0xed, 0x67, 0xb9, 0x23, 0x25, 0x56, 0x2d, 0xae, 0x15, 0x0,  0xf,  0x57, 0x6,
      0x17, 0x40, 0x82, 0xb9, 0xe2, 0x96, 0x5a, 0x50, 0x12, 0x96, 0x7f, 0x7d, 0x52, 0x11, 0x0,  0x0,  0x56, 0x48, 0x28,
      0x40, 0x28, 0x7c, 0x1f, 0x0,  0x1e, 0x3,  0xb9, 0xc1, 0x1,  0x84, 0x69, 0x58, 0x29, 0x76, 0xf,  0xd0, 0x5b, 0x47,
      0xbc, 0x1c, 0x22, 0xb6, 0x70, 0x41, 0xdf, 0x98, 0x24, 0xdf, 0xa,  0x52, 0x39, 0xb3, 0x28, 0x72, 0x93, 0x26, 0x0,
      0xd,  0xd3, 0x76, 0x13, 0xc0, 0x7f, 0xed, 0xb7, 0xf,  0x26, 0x31, 0x19, 0x94, 0x10, 0x0,  0x1,  0xd8, 0x19, 0x40,
      0x0,  0xd,  0x5d, 0x99, 0x87, 0x91, 0x55, 0x53, 0x8d, 0xf0, 0x48, 0xe5, 0xf1, 0x67, 0x3,  0x0,  0x8,  0x53, 0x93,
      0xe3, 0xde, 0xcc, 0xab, 0xac, 0x4b};

  uint8_t buf[491] = {0};

  uint8_t bytesprops1[] = {0x8f, 0xd6, 0x75, 0x8d, 0xd8, 0xa8, 0x66, 0x35, 0x6d, 0x20,
                           0x51, 0xd5, 0x4c, 0xca, 0x88, 0x5b, 0x51, 0xda, 0x69, 0x2};
  uint8_t bytesprops0[] = {0x25, 0x1c, 0xb3, 0xab, 0x8f, 0x92, 0x56, 0xaf, 0xae, 0xb, 0xca, 0xc8, 0xdc, 0xfd};
  uint8_t bytesprops2[] = {0x72, 0x7d, 0x2c, 0xeb, 0x58, 0xda, 0x9e, 0x6b, 0xcd, 0xd1};
  uint8_t bytesprops3[] = {0xc7, 0xc6, 0xf4, 0xe5, 0xec, 0x29, 0x92, 0xa7,
                           0xab, 0x39, 0x53, 0xc7, 0x8b, 0xaf, 0xd2, 0x7f};
  uint8_t bytesprops4[] = {0xc4, 0xe4, 0x1c, 0x39, 0xb6, 0x1a, 0xbd, 0xb, 0xd1, 0xcc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32278}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21985}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27825}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11102}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 19}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x30, 0xef, 0xa8, 0x35, 0x3c, 0x3,  0x8c, 0xeb, 0x49, 0xf4, 0xad, 0x8a, 0x7a, 0x1b,
                               0x7b, 0x81, 0xc5, 0xcf, 0x8f, 0xdc, 0x4d, 0xc3, 0x96, 0x7,  0x9b, 0x6f, 0x43};
  uint8_t byteswillprops1[] = {0xa7, 0x74, 0x8e, 0x95, 0x47, 0x1e, 0x23, 0x9e, 0x88, 0xf3, 0xdc, 0x4f, 0x6b, 0xd2,
                               0x14, 0xcd, 0x9b, 0x28, 0x89, 0xa,  0xef, 0x8d, 0x26, 0xd7, 0x3c, 0xae, 0xa9};
  uint8_t byteswillprops2[] = {0x35, 0x1c, 0xb1, 0x54, 0x4e, 0x40, 0xf9, 0x2e, 0x97, 0x62, 0xf5, 0xd8, 0x26, 0x93, 0x80,
                               0xd4, 0x49, 0x24, 0xec, 0xb,  0xee, 0xdd, 0x3c, 0x62, 0xff, 0x4e, 0x51, 0x7,  0x1e};
  uint8_t byteswillprops3[] = {0x19, 0xc3, 0xf4, 0xc4, 0x11, 0x88, 0x6e, 0xec, 0xed};
  uint8_t byteswillprops4[] = {0x7};
  uint8_t byteswillprops5[] = {0x1d, 0x58, 0x2a, 0x72, 0x82, 0x68, 0x7};
  uint8_t byteswillprops6[] = {0x11, 0x9e, 0xdc, 0x9c, 0xb2, 0xe6, 0xf9, 0x6d, 0xda, 0x70, 0xec, 0x18,
                               0x1e, 0x70, 0x72, 0x6d, 0x65, 0xe8, 0xa7, 0x41, 0x9b, 0xd8, 0x3,  0x66};
  uint8_t byteswillprops7[] = {0x82, 0x1e, 0xcd, 0xa7, 0x23, 0x26, 0x25, 0xff, 0xb5,
                               0x81, 0xb9, 0xd9, 0x71, 0x88, 0xde, 0xe8, 0xc6};
  uint8_t byteswillprops8[] = {0x73, 0x9,  0xf3, 0xc0, 0x2b, 0x69, 0xfd, 0xba,
                               0xed, 0x67, 0xb9, 0x23, 0x25, 0x56, 0x2d, 0xae};
  uint8_t byteswillprops9[] = {0x57, 0x6, 0x17, 0x40, 0x82, 0xb9, 0xe2, 0x96, 0x5a, 0x50, 0x12, 0x96, 0x7f, 0x7d, 0x52};
  uint8_t byteswillprops10[] = {0x3,  0xb9, 0xc1, 0x1,  0x84, 0x69, 0x58, 0x29, 0x76, 0xf,
                                0xd0, 0x5b, 0x47, 0xbc, 0x1c, 0x22, 0xb6, 0x70, 0x41, 0xdf,
                                0x98, 0x24, 0xdf, 0xa,  0x52, 0x39, 0xb3, 0x28, 0x72, 0x93};
  uint8_t byteswillprops12[] = {0xd8};
  uint8_t byteswillprops11[] = {0xd3, 0x76, 0x13, 0xc0, 0x7f, 0xed, 0xb7, 0xf, 0x26, 0x31, 0x19, 0x94, 0x10};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1944}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8409}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14617}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23741}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20023}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3673}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22088}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops11}, .v = {1, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 64}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5d, 0x99, 0x87, 0x91, 0x55, 0x53, 0x8d, 0xf0, 0x48, 0xe5, 0xf1, 0x67, 0x3};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x53, 0x93, 0xe3, 0xde, 0xcc, 0xab, 0xac, 0x4b};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12605;
  uint8_t client_id_bytes[] = {0xd5, 0x3f, 0xe, 0xe3, 0xd4, 0xe1, 0xea, 0xc1, 0xa4, 0x27, 0x16, 0x30, 0x2c, 0x36, 0x98};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "&\ETX\DC1tJ\204\211Q`", _password = Just "\128c\191.\162\253\GS\162q\130\138\188Y",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\245\221o", _willMsg =
// "\235\SOH,nQ&\DC1bJ\DC4\177\178\194\181\239\243I\167\232\150\179|^\185\241\164Wv\211", _willProps =
// [PropResponseTopic "g\EOT\228\218Q\a\163+",PropSessionExpiryInterval 14739,PropServerReference
// "T\249X\213\244\177\250\201\CAN$\DC2\SYNu#\199P\235",PropMaximumQoS 187,PropServerReference
// "\233\DC2",PropRetainAvailable 180,PropMaximumQoS 151,PropServerKeepAlive 21162,PropReasonString
// "\147\236\217\215/\DC4\188K\169a\161\144\133\170\ESC\227eC",PropTopicAliasMaximum 21398,PropRequestProblemInformation
// 40,PropRetainAvailable 219,PropMaximumPacketSize 26279,PropReceiveMaximum 17525,PropReceiveMaximum
// 32443,PropSharedSubscriptionAvailable 84,PropRetainAvailable 125,PropMessageExpiryInterval 11694,PropContentType
// "\193\ESC\156O\NAK\NAK\215;\129\183\&1\ACK\SI\191Qt3?\193\150E\153\r:\132*\ESC$",PropSharedSubscriptionAvailable
// 15,PropSubscriptionIdentifier 2,PropMessageExpiryInterval 7282,PropTopicAlias 306,PropAuthenticationMethod
// "\250W9\GS\ESC\252\251\134>\237\200\204\212\149\NUL\ETB\154\155\209\134\224f\224M\176\ETX\254\FS\252\150",PropMessageExpiryInterval
// 11960,PropRequestResponseInformation 48,PropMaximumQoS 34,PropRetainAvailable 88,PropWildcardSubscriptionAvailable
// 149]}), _cleanSession = True, _keepAlive = 6922, _connID = "\132\211\DC4\175\183\DC4\ETB\170Y", _properties = []}
TEST(Connect5QCTest, Encode36) {
  uint8_t pkt[] = {
      0x10, 0x91, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x1b, 0xa,  0x0,  0x0,  0x9,  0x84, 0xd3, 0x14,
      0xaf, 0xb7, 0x14, 0x17, 0xaa, 0x59, 0xbb, 0x1,  0x8,  0x0,  0x8,  0x67, 0x4,  0xe4, 0xda, 0x51, 0x7,  0xa3, 0x2b,
      0x11, 0x0,  0x0,  0x39, 0x93, 0x1c, 0x0,  0x11, 0x54, 0xf9, 0x58, 0xd5, 0xf4, 0xb1, 0xfa, 0xc9, 0x18, 0x24, 0x12,
      0x16, 0x75, 0x23, 0xc7, 0x50, 0xeb, 0x24, 0xbb, 0x1c, 0x0,  0x2,  0xe9, 0x12, 0x25, 0xb4, 0x24, 0x97, 0x13, 0x52,
      0xaa, 0x1f, 0x0,  0x12, 0x93, 0xec, 0xd9, 0xd7, 0x2f, 0x14, 0xbc, 0x4b, 0xa9, 0x61, 0xa1, 0x90, 0x85, 0xaa, 0x1b,
      0xe3, 0x65, 0x43, 0x22, 0x53, 0x96, 0x17, 0x28, 0x25, 0xdb, 0x27, 0x0,  0x0,  0x66, 0xa7, 0x21, 0x44, 0x75, 0x21,
      0x7e, 0xbb, 0x2a, 0x54, 0x25, 0x7d, 0x2,  0x0,  0x0,  0x2d, 0xae, 0x3,  0x0,  0x1c, 0xc1, 0x1b, 0x9c, 0x4f, 0x15,
      0x15, 0xd7, 0x3b, 0x81, 0xb7, 0x31, 0x6,  0xf,  0xbf, 0x51, 0x74, 0x33, 0x3f, 0xc1, 0x96, 0x45, 0x99, 0xd,  0x3a,
      0x84, 0x2a, 0x1b, 0x24, 0x2a, 0xf,  0xb,  0x2,  0x2,  0x0,  0x0,  0x1c, 0x72, 0x23, 0x1,  0x32, 0x15, 0x0,  0x1e,
      0xfa, 0x57, 0x39, 0x1d, 0x1b, 0xfc, 0xfb, 0x86, 0x3e, 0xed, 0xc8, 0xcc, 0xd4, 0x95, 0x0,  0x17, 0x9a, 0x9b, 0xd1,
      0x86, 0xe0, 0x66, 0xe0, 0x4d, 0xb0, 0x3,  0xfe, 0x1c, 0xfc, 0x96, 0x2,  0x0,  0x0,  0x2e, 0xb8, 0x19, 0x30, 0x24,
      0x22, 0x25, 0x58, 0x28, 0x95, 0x0,  0x3,  0xf5, 0xdd, 0x6f, 0x0,  0x1d, 0xeb, 0x1,  0x2c, 0x6e, 0x51, 0x26, 0x11,
      0x62, 0x4a, 0x14, 0xb1, 0xb2, 0xc2, 0xb5, 0xef, 0xf3, 0x49, 0xa7, 0xe8, 0x96, 0xb3, 0x7c, 0x5e, 0xb9, 0xf1, 0xa4,
      0x57, 0x76, 0xd3, 0x0,  0x9,  0x26, 0x3,  0x11, 0x74, 0x4a, 0xcc, 0xd3, 0x51, 0x60, 0x0,  0xd,  0x80, 0x63, 0xbf,
      0x2e, 0xa2, 0xfd, 0x1d, 0xa2, 0x71, 0x82, 0x8a, 0xbc, 0x59};

  uint8_t buf[286] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x67, 0x4, 0xe4, 0xda, 0x51, 0x7, 0xa3, 0x2b};
  uint8_t byteswillprops1[] = {0x54, 0xf9, 0x58, 0xd5, 0xf4, 0xb1, 0xfa, 0xc9, 0x18,
                               0x24, 0x12, 0x16, 0x75, 0x23, 0xc7, 0x50, 0xeb};
  uint8_t byteswillprops2[] = {0xe9, 0x12};
  uint8_t byteswillprops3[] = {0x93, 0xec, 0xd9, 0xd7, 0x2f, 0x14, 0xbc, 0x4b, 0xa9,
                               0x61, 0xa1, 0x90, 0x85, 0xaa, 0x1b, 0xe3, 0x65, 0x43};
  uint8_t byteswillprops4[] = {0xc1, 0x1b, 0x9c, 0x4f, 0x15, 0x15, 0xd7, 0x3b, 0x81, 0xb7, 0x31, 0x6,  0xf,  0xbf,
                               0x51, 0x74, 0x33, 0x3f, 0xc1, 0x96, 0x45, 0x99, 0xd,  0x3a, 0x84, 0x2a, 0x1b, 0x24};
  uint8_t byteswillprops5[] = {0xfa, 0x57, 0x39, 0x1d, 0x1b, 0xfc, 0xfb, 0x86, 0x3e, 0xed,
                               0xc8, 0xcc, 0xd4, 0x95, 0x0,  0x17, 0x9a, 0x9b, 0xd1, 0x86,
                               0xe0, 0x66, 0xe0, 0x4d, 0xb0, 0x3,  0xfe, 0x1c, 0xfc, 0x96};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14739}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21162}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21398}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26279}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17525}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32443}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11694}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7282}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 306}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11960}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf5, 0xdd, 0x6f};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xeb, 0x1,  0x2c, 0x6e, 0x51, 0x26, 0x11, 0x62, 0x4a, 0x14,
                                  0xb1, 0xb2, 0xc2, 0xb5, 0xef, 0xf3, 0x49, 0xa7, 0xe8, 0x96,
                                  0xb3, 0x7c, 0x5e, 0xb9, 0xf1, 0xa4, 0x57, 0x76, 0xd3};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6922;
  uint8_t client_id_bytes[] = {0x84, 0xd3, 0x14, 0xaf, 0xb7, 0x14, 0x17, 0xaa, 0x59};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x26, 0x3, 0x11, 0x74, 0x4a, 0xcc, 0xd3, 0x51, 0x60};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x80, 0x63, 0xbf, 0x2e, 0xa2, 0xfd, 0x1d, 0xa2, 0x71, 0x82, 0x8a, 0xbc, 0x59};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\"\142.S\145\159\133VvX<\209\161", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\136Rv", _willMsg =
// "v\SUB58p+]s\v\SYN\DC3!\220\199\192'K\140d\n@\133\188\CAN\174\209\SYNK", _willProps = [PropAuthenticationMethod
// "\136\131\t\134\DEL\b\146\224)H\168\SOH^\ACK\138\191\f",PropResponseInformation
// "\n\"4Y\CAN\144r\DC3\249;\194\155\183\211\188\139\189\195\212\198\218.",PropResponseInformation
// "\239\242p\150\NUL\ve\FS\129\248&K<\DEL\155&6\218\155u\200\233v\195\157S",PropResponseInformation
// "GsM\185DI&\220,\199\225}\232\210\230",PropServerKeepAlive 5331,PropMessageExpiryInterval
// 8248,PropSubscriptionIdentifierAvailable 138,PropTopicAlias 10808,PropWillDelayInterval 18139,PropServerReference
// "\245\191P\171\128W\137\254\153\201\a\144@;`\STXD\192}\240\174A\a\140\ETXK\195\196",PropContentType
// "2\227\200\218\239@\146\CANu\165C\218C\160\213*\248A\184:2\137 \EM\201\177]\241\133)",PropMessageExpiryInterval
// 20966,PropTopicAlias 3704,PropAuthenticationMethod
// "\FS\SYN;-\219^\ACK\tN\200\227\r\198Z\139\178*.\166\238",PropReasonString "s\204",PropUserProperty "\SI\225\229\135"
// "\169\r9\219!\164W\149w]w\160\151^",PropRequestResponseInformation 226,PropUserProperty
// "\199$\141b\191m\222\150\234\&9p\FS2A\EM\207\\\187\STX\244Y!?L\v" "\255\153\214"]}), _cleanSession = False,
// _keepAlive = 25116, _connID = "\SOR\"\166}\168\197\211\153\NAK\249\165\138\211", _properties =
// [PropMessageExpiryInterval 15040]}
TEST(Connect5QCTest, Encode37) {
  uint8_t pkt[] = {
      0x10, 0xe1, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x62, 0x1c, 0x5,  0x2,  0x0,  0x0,  0x3a, 0xc0,
      0x0,  0xe,  0xe,  0x52, 0x22, 0xa6, 0x7d, 0xa8, 0xc5, 0xd3, 0x99, 0x15, 0xf9, 0xa5, 0x8a, 0xd3, 0x8c, 0x2,  0x15,
      0x0,  0x11, 0x88, 0x83, 0x9,  0x86, 0x7f, 0x8,  0x92, 0xe0, 0x29, 0x48, 0xa8, 0x1,  0x5e, 0x6,  0x8a, 0xbf, 0xc,
      0x1a, 0x0,  0x16, 0xa,  0x22, 0x34, 0x59, 0x18, 0x90, 0x72, 0x13, 0xf9, 0x3b, 0xc2, 0x9b, 0xb7, 0xd3, 0xbc, 0x8b,
      0xbd, 0xc3, 0xd4, 0xc6, 0xda, 0x2e, 0x1a, 0x0,  0x1a, 0xef, 0xf2, 0x70, 0x96, 0x0,  0xb,  0x65, 0x1c, 0x81, 0xf8,
      0x26, 0x4b, 0x3c, 0x7f, 0x9b, 0x26, 0x36, 0xda, 0x9b, 0x75, 0xc8, 0xe9, 0x76, 0xc3, 0x9d, 0x53, 0x1a, 0x0,  0xf,
      0x47, 0x73, 0x4d, 0xb9, 0x44, 0x49, 0x26, 0xdc, 0x2c, 0xc7, 0xe1, 0x7d, 0xe8, 0xd2, 0xe6, 0x13, 0x14, 0xd3, 0x2,
      0x0,  0x0,  0x20, 0x38, 0x29, 0x8a, 0x23, 0x2a, 0x38, 0x18, 0x0,  0x0,  0x46, 0xdb, 0x1c, 0x0,  0x1c, 0xf5, 0xbf,
      0x50, 0xab, 0x80, 0x57, 0x89, 0xfe, 0x99, 0xc9, 0x7,  0x90, 0x40, 0x3b, 0x60, 0x2,  0x44, 0xc0, 0x7d, 0xf0, 0xae,
      0x41, 0x7,  0x8c, 0x3,  0x4b, 0xc3, 0xc4, 0x3,  0x0,  0x1e, 0x32, 0xe3, 0xc8, 0xda, 0xef, 0x40, 0x92, 0x18, 0x75,
      0xa5, 0x43, 0xda, 0x43, 0xa0, 0xd5, 0x2a, 0xf8, 0x41, 0xb8, 0x3a, 0x32, 0x89, 0x20, 0x19, 0xc9, 0xb1, 0x5d, 0xf1,
      0x85, 0x29, 0x2,  0x0,  0x0,  0x51, 0xe6, 0x23, 0xe,  0x78, 0x15, 0x0,  0x14, 0x1c, 0x16, 0x3b, 0x2d, 0xdb, 0x5e,
      0x6,  0x9,  0x4e, 0xc8, 0xe3, 0xd,  0xc6, 0x5a, 0x8b, 0xb2, 0x2a, 0x2e, 0xa6, 0xee, 0x1f, 0x0,  0x2,  0x73, 0xcc,
      0x26, 0x0,  0x4,  0xf,  0xe1, 0xe5, 0x87, 0x0,  0xe,  0xa9, 0xd,  0x39, 0xdb, 0x21, 0xa4, 0x57, 0x95, 0x77, 0x5d,
      0x77, 0xa0, 0x97, 0x5e, 0x19, 0xe2, 0x26, 0x0,  0x19, 0xc7, 0x24, 0x8d, 0x62, 0xbf, 0x6d, 0xde, 0x96, 0xea, 0x39,
      0x70, 0x1c, 0x32, 0x41, 0x19, 0xcf, 0x5c, 0xbb, 0x2,  0xf4, 0x59, 0x21, 0x3f, 0x4c, 0xb,  0x0,  0x3,  0xff, 0x99,
      0xd6, 0x0,  0x3,  0x88, 0x52, 0x76, 0x0,  0x1c, 0x76, 0x1a, 0x35, 0x38, 0x70, 0x2b, 0x5d, 0x73, 0xb,  0x16, 0x13,
      0x21, 0xdc, 0xc7, 0xc0, 0x27, 0x4b, 0x8c, 0x64, 0xa,  0x40, 0x85, 0xbc, 0x18, 0xae, 0xd1, 0x16, 0x4b, 0x0,  0xe,
      0xa9, 0x22, 0x8e, 0x2e, 0x53, 0x91, 0x9f, 0x85, 0x56, 0x76, 0x58, 0x3c, 0xd1, 0xa1};

  uint8_t buf[366] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15040}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x88, 0x83, 0x9, 0x86, 0x7f, 0x8,  0x92, 0xe0, 0x29,
                               0x48, 0xa8, 0x1, 0x5e, 0x6,  0x8a, 0xbf, 0xc};
  uint8_t byteswillprops1[] = {0xa,  0x22, 0x34, 0x59, 0x18, 0x90, 0x72, 0x13, 0xf9, 0x3b, 0xc2,
                               0x9b, 0xb7, 0xd3, 0xbc, 0x8b, 0xbd, 0xc3, 0xd4, 0xc6, 0xda, 0x2e};
  uint8_t byteswillprops2[] = {0xef, 0xf2, 0x70, 0x96, 0x0,  0xb,  0x65, 0x1c, 0x81, 0xf8, 0x26, 0x4b, 0x3c,
                               0x7f, 0x9b, 0x26, 0x36, 0xda, 0x9b, 0x75, 0xc8, 0xe9, 0x76, 0xc3, 0x9d, 0x53};
  uint8_t byteswillprops3[] = {0x47, 0x73, 0x4d, 0xb9, 0x44, 0x49, 0x26, 0xdc,
                               0x2c, 0xc7, 0xe1, 0x7d, 0xe8, 0xd2, 0xe6};
  uint8_t byteswillprops4[] = {0xf5, 0xbf, 0x50, 0xab, 0x80, 0x57, 0x89, 0xfe, 0x99, 0xc9, 0x7, 0x90, 0x40, 0x3b,
                               0x60, 0x2,  0x44, 0xc0, 0x7d, 0xf0, 0xae, 0x41, 0x7,  0x8c, 0x3, 0x4b, 0xc3, 0xc4};
  uint8_t byteswillprops5[] = {0x32, 0xe3, 0xc8, 0xda, 0xef, 0x40, 0x92, 0x18, 0x75, 0xa5,
                               0x43, 0xda, 0x43, 0xa0, 0xd5, 0x2a, 0xf8, 0x41, 0xb8, 0x3a,
                               0x32, 0x89, 0x20, 0x19, 0xc9, 0xb1, 0x5d, 0xf1, 0x85, 0x29};
  uint8_t byteswillprops6[] = {0x1c, 0x16, 0x3b, 0x2d, 0xdb, 0x5e, 0x6,  0x9,  0x4e, 0xc8,
                               0xe3, 0xd,  0xc6, 0x5a, 0x8b, 0xb2, 0x2a, 0x2e, 0xa6, 0xee};
  uint8_t byteswillprops7[] = {0x73, 0xcc};
  uint8_t byteswillprops9[] = {0xa9, 0xd, 0x39, 0xdb, 0x21, 0xa4, 0x57, 0x95, 0x77, 0x5d, 0x77, 0xa0, 0x97, 0x5e};
  uint8_t byteswillprops8[] = {0xf, 0xe1, 0xe5, 0x87};
  uint8_t byteswillprops11[] = {0xff, 0x99, 0xd6};
  uint8_t byteswillprops10[] = {0xc7, 0x24, 0x8d, 0x62, 0xbf, 0x6d, 0xde, 0x96, 0xea, 0x39, 0x70, 0x1c, 0x32,
                                0x41, 0x19, 0xcf, 0x5c, 0xbb, 0x2,  0xf4, 0x59, 0x21, 0x3f, 0x4c, 0xb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5331}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8248}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10808}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18139}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20966}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3704}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops8}, .v = {14, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops10}, .v = {3, (char*)&byteswillprops11}}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x88, 0x52, 0x76};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x76, 0x1a, 0x35, 0x38, 0x70, 0x2b, 0x5d, 0x73, 0xb,  0x16, 0x13, 0x21, 0xdc, 0xc7,
                                  0xc0, 0x27, 0x4b, 0x8c, 0x64, 0xa,  0x40, 0x85, 0xbc, 0x18, 0xae, 0xd1, 0x16, 0x4b};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25116;
  uint8_t client_id_bytes[] = {0xe, 0x52, 0x22, 0xa6, 0x7d, 0xa8, 0xc5, 0xd3, 0x99, 0x15, 0xf9, 0xa5, 0x8a, 0xd3};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0x22, 0x8e, 0x2e, 0x53, 0x91, 0x9f, 0x85, 0x56, 0x76, 0x58, 0x3c, 0xd1, 0xa1};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "j3`=\194\212\200O\134\155v\212", _password = Just "\SI\FS=Y\232J\158\196\230\170",
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 1881, _connID = "c\207n(N\155H\154,\158u\205*\f\182\SO",
// _properties = [PropSharedSubscriptionAvailable 242,PropMaximumPacketSize 12669,PropCorrelationData
// "\171&qocN\205\158\212\&9\DC1\187\DLE\193\132D\241\&6\140",PropResponseTopic
// "\164p\153\DEL\159\222]~\r\239\227\248~#\212\195",PropReasonString
// "\236\166\EOT\r\251\153,\128\229\206k8>\227\CAN\201Rv\181\174\225\138EL\128;wLi",PropCorrelationData
// "6\234\236G\GS-w\210\ENQLG\STX\243\197",PropTopicAliasMaximum 9001,PropAuthenticationMethod
// "/\174!\180\165x\158S\247\165@3\253\249\\}\SYN\208\\\"\139\167\192\204\225)\163v",PropAuthenticationData
// "E\174\255`s\170\198\249A#\ACK\206J\ACK\STX\CANC6U\229\152\SI\CANfoe\\\139\254k",PropRequestResponseInformation
// 139,PropRequestResponseInformation 12,PropMessageExpiryInterval 29570,PropAuthenticationMethod
// "\193\ACK\198\207v\195\144w\162\191\DC4\176\142PZ\203\192o\EOTL\ETX\128N\155\175\174o(\197",PropUserProperty
// "\254\141k,`q\209e\DC4\"K\253\224Z\SOH'\246"
// "\164\204\139\NUL>Vr\166&\SYN\192\150r\191\141",PropSessionExpiryInterval 28694,PropAuthenticationMethod
// "\174%\178\170H\191\151b3X\219\219\194\140\ESC\197I\136\229.FO\198J",PropSharedSubscriptionAvailable
// 198,PropAuthenticationMethod "\144\145GA;\DC4{\198\221\129\253e \172\206\v\"\146v23\178\203qp"]}
TEST(Connect5QCTest, Encode38) {
  uint8_t pkt[] = {
      0x10, 0xe8, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x7,  0x59, 0xb0, 0x2,  0x2a, 0xf2, 0x27, 0x0,
      0x0,  0x31, 0x7d, 0x9,  0x0,  0x13, 0xab, 0x26, 0x71, 0x6f, 0x63, 0x4e, 0xcd, 0x9e, 0xd4, 0x39, 0x11, 0xbb, 0x10,
      0xc1, 0x84, 0x44, 0xf1, 0x36, 0x8c, 0x8,  0x0,  0x10, 0xa4, 0x70, 0x99, 0x7f, 0x9f, 0xde, 0x5d, 0x7e, 0xd,  0xef,
      0xe3, 0xf8, 0x7e, 0x23, 0xd4, 0xc3, 0x1f, 0x0,  0x1d, 0xec, 0xa6, 0x4,  0xd,  0xfb, 0x99, 0x2c, 0x80, 0xe5, 0xce,
      0x6b, 0x38, 0x3e, 0xe3, 0x18, 0xc9, 0x52, 0x76, 0xb5, 0xae, 0xe1, 0x8a, 0x45, 0x4c, 0x80, 0x3b, 0x77, 0x4c, 0x69,
      0x9,  0x0,  0xe,  0x36, 0xea, 0xec, 0x47, 0x1d, 0x2d, 0x77, 0xd2, 0x5,  0x4c, 0x47, 0x2,  0xf3, 0xc5, 0x22, 0x23,
      0x29, 0x15, 0x0,  0x1c, 0x2f, 0xae, 0x21, 0xb4, 0xa5, 0x78, 0x9e, 0x53, 0xf7, 0xa5, 0x40, 0x33, 0xfd, 0xf9, 0x5c,
      0x7d, 0x16, 0xd0, 0x5c, 0x22, 0x8b, 0xa7, 0xc0, 0xcc, 0xe1, 0x29, 0xa3, 0x76, 0x16, 0x0,  0x1e, 0x45, 0xae, 0xff,
      0x60, 0x73, 0xaa, 0xc6, 0xf9, 0x41, 0x23, 0x6,  0xce, 0x4a, 0x6,  0x2,  0x18, 0x43, 0x36, 0x55, 0xe5, 0x98, 0xf,
      0x18, 0x66, 0x6f, 0x65, 0x5c, 0x8b, 0xfe, 0x6b, 0x19, 0x8b, 0x19, 0xc,  0x2,  0x0,  0x0,  0x73, 0x82, 0x15, 0x0,
      0x1d, 0xc1, 0x6,  0xc6, 0xcf, 0x76, 0xc3, 0x90, 0x77, 0xa2, 0xbf, 0x14, 0xb0, 0x8e, 0x50, 0x5a, 0xcb, 0xc0, 0x6f,
      0x4,  0x4c, 0x3,  0x80, 0x4e, 0x9b, 0xaf, 0xae, 0x6f, 0x28, 0xc5, 0x26, 0x0,  0x11, 0xfe, 0x8d, 0x6b, 0x2c, 0x60,
      0x71, 0xd1, 0x65, 0x14, 0x22, 0x4b, 0xfd, 0xe0, 0x5a, 0x1,  0x27, 0xf6, 0x0,  0xf,  0xa4, 0xcc, 0x8b, 0x0,  0x3e,
      0x56, 0x72, 0xa6, 0x26, 0x16, 0xc0, 0x96, 0x72, 0xbf, 0x8d, 0x11, 0x0,  0x0,  0x70, 0x16, 0x15, 0x0,  0x18, 0xae,
      0x25, 0xb2, 0xaa, 0x48, 0xbf, 0x97, 0x62, 0x33, 0x58, 0xdb, 0xdb, 0xc2, 0x8c, 0x1b, 0xc5, 0x49, 0x88, 0xe5, 0x2e,
      0x46, 0x4f, 0xc6, 0x4a, 0x2a, 0xc6, 0x15, 0x0,  0x19, 0x90, 0x91, 0x47, 0x41, 0x3b, 0x14, 0x7b, 0xc6, 0xdd, 0x81,
      0xfd, 0x65, 0x20, 0xac, 0xce, 0xb,  0x22, 0x92, 0x76, 0x32, 0x33, 0xb2, 0xcb, 0x71, 0x70, 0x0,  0x10, 0x63, 0xcf,
      0x6e, 0x28, 0x4e, 0x9b, 0x48, 0x9a, 0x2c, 0x9e, 0x75, 0xcd, 0x2a, 0xc,  0xb6, 0xe,  0x0,  0xc,  0x6a, 0x33, 0x60,
      0x3d, 0xc2, 0xd4, 0xc8, 0x4f, 0x86, 0x9b, 0x76, 0xd4, 0x0,  0xa,  0xf,  0x1c, 0x3d, 0x59, 0xe8, 0x4a, 0x9e, 0xc4,
      0xe6, 0xaa};

  uint8_t buf[373] = {0};

  uint8_t bytesprops0[] = {0xab, 0x26, 0x71, 0x6f, 0x63, 0x4e, 0xcd, 0x9e, 0xd4, 0x39,
                           0x11, 0xbb, 0x10, 0xc1, 0x84, 0x44, 0xf1, 0x36, 0x8c};
  uint8_t bytesprops1[] = {0xa4, 0x70, 0x99, 0x7f, 0x9f, 0xde, 0x5d, 0x7e,
                           0xd,  0xef, 0xe3, 0xf8, 0x7e, 0x23, 0xd4, 0xc3};
  uint8_t bytesprops2[] = {0xec, 0xa6, 0x4,  0xd,  0xfb, 0x99, 0x2c, 0x80, 0xe5, 0xce, 0x6b, 0x38, 0x3e, 0xe3, 0x18,
                           0xc9, 0x52, 0x76, 0xb5, 0xae, 0xe1, 0x8a, 0x45, 0x4c, 0x80, 0x3b, 0x77, 0x4c, 0x69};
  uint8_t bytesprops3[] = {0x36, 0xea, 0xec, 0x47, 0x1d, 0x2d, 0x77, 0xd2, 0x5, 0x4c, 0x47, 0x2, 0xf3, 0xc5};
  uint8_t bytesprops4[] = {0x2f, 0xae, 0x21, 0xb4, 0xa5, 0x78, 0x9e, 0x53, 0xf7, 0xa5, 0x40, 0x33, 0xfd, 0xf9,
                           0x5c, 0x7d, 0x16, 0xd0, 0x5c, 0x22, 0x8b, 0xa7, 0xc0, 0xcc, 0xe1, 0x29, 0xa3, 0x76};
  uint8_t bytesprops5[] = {0x45, 0xae, 0xff, 0x60, 0x73, 0xaa, 0xc6, 0xf9, 0x41, 0x23, 0x6,  0xce, 0x4a, 0x6,  0x2,
                           0x18, 0x43, 0x36, 0x55, 0xe5, 0x98, 0xf,  0x18, 0x66, 0x6f, 0x65, 0x5c, 0x8b, 0xfe, 0x6b};
  uint8_t bytesprops6[] = {0xc1, 0x6,  0xc6, 0xcf, 0x76, 0xc3, 0x90, 0x77, 0xa2, 0xbf, 0x14, 0xb0, 0x8e, 0x50, 0x5a,
                           0xcb, 0xc0, 0x6f, 0x4,  0x4c, 0x3,  0x80, 0x4e, 0x9b, 0xaf, 0xae, 0x6f, 0x28, 0xc5};
  uint8_t bytesprops8[] = {0xa4, 0xcc, 0x8b, 0x0, 0x3e, 0x56, 0x72, 0xa6, 0x26, 0x16, 0xc0, 0x96, 0x72, 0xbf, 0x8d};
  uint8_t bytesprops7[] = {0xfe, 0x8d, 0x6b, 0x2c, 0x60, 0x71, 0xd1, 0x65, 0x14,
                           0x22, 0x4b, 0xfd, 0xe0, 0x5a, 0x1,  0x27, 0xf6};
  uint8_t bytesprops9[] = {0xae, 0x25, 0xb2, 0xaa, 0x48, 0xbf, 0x97, 0x62, 0x33, 0x58, 0xdb, 0xdb,
                           0xc2, 0x8c, 0x1b, 0xc5, 0x49, 0x88, 0xe5, 0x2e, 0x46, 0x4f, 0xc6, 0x4a};
  uint8_t bytesprops10[] = {0x90, 0x91, 0x47, 0x41, 0x3b, 0x14, 0x7b, 0xc6, 0xdd, 0x81, 0xfd, 0x65, 0x20,
                            0xac, 0xce, 0xb,  0x22, 0x92, 0x76, 0x32, 0x33, 0xb2, 0xcb, 0x71, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12669}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9001}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29570}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops7}, .v = {15, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28694}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1881;
  uint8_t client_id_bytes[] = {0x63, 0xcf, 0x6e, 0x28, 0x4e, 0x9b, 0x48, 0x9a,
                               0x2c, 0x9e, 0x75, 0xcd, 0x2a, 0xc,  0xb6, 0xe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6a, 0x33, 0x60, 0x3d, 0xc2, 0xd4, 0xc8, 0x4f, 0x86, 0x9b, 0x76, 0xd4};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf, 0x1c, 0x3d, 0x59, 0xe8, 0x4a, 0x9e, 0xc4, 0xe6, 0xaa};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETXp\147\149\&7", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "\218G\228", _willMsg =
// "\133\141;\199\135\145\&1\NAK\215\162H\224\199q\ft\156F\STX\178\162\152\147f\SI\229\248", _willProps =
// [PropAuthenticationMethod "\"G\166\181(C\175\&1\210\"\158Y\SYN\ETB\ESCa\156\190\US\245-o\227",PropServerReference
// ">\159\208\132\v\243N\233\179o,*B\148\210~(\192\DC4\255\SOH\244\149\133\ETB:\187m>",PropServerKeepAlive
// 2146,PropMessageExpiryInterval 25696,PropSessionExpiryInterval 27600,PropAuthenticationData
// "\130\CAN\165P/\148\165\149\&3\192\143\148n>$\141\242\224\231\&0\145{\230f\RS\178\189",PropMessageExpiryInterval
// 31786,PropRetainAvailable 93,PropCorrelationData "\198",PropSubscriptionIdentifierAvailable
// 106,PropPayloadFormatIndicator 124,PropRetainAvailable 138,PropWillDelayInterval 27628,PropRequestProblemInformation
// 210]}), _cleanSession = False, _keepAlive = 3338, _connID =
// "\244\164\&6\SYN\146\249\SOHR|b\175e~\146x\233H\240C\208\249M\233v\234\194\203\189\230\222", _properties = []}
TEST(Connect5QCTest, Encode39) {
  uint8_t pkt[] = {0x10, 0xd2, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0xd,  0xa,  0x0,  0x0,  0x1e, 0xf4,
                   0xa4, 0x36, 0x16, 0x92, 0xf9, 0x1,  0x52, 0x7c, 0x62, 0xaf, 0x65, 0x7e, 0x92, 0x78, 0xe9, 0x48, 0xf0,
                   0x43, 0xd0, 0xf9, 0x4d, 0xe9, 0x76, 0xea, 0xc2, 0xcb, 0xbd, 0xe6, 0xde, 0x7d, 0x15, 0x0,  0x17, 0x22,
                   0x47, 0xa6, 0xb5, 0x28, 0x43, 0xaf, 0x31, 0xd2, 0x22, 0x9e, 0x59, 0x16, 0x17, 0x1b, 0x61, 0x9c, 0xbe,
                   0x1f, 0xf5, 0x2d, 0x6f, 0xe3, 0x1c, 0x0,  0x1d, 0x3e, 0x9f, 0xd0, 0x84, 0xb,  0xf3, 0x4e, 0xe9, 0xb3,
                   0x6f, 0x2c, 0x2a, 0x42, 0x94, 0xd2, 0x7e, 0x28, 0xc0, 0x14, 0xff, 0x1,  0xf4, 0x95, 0x85, 0x17, 0x3a,
                   0xbb, 0x6d, 0x3e, 0x13, 0x8,  0x62, 0x2,  0x0,  0x0,  0x64, 0x60, 0x11, 0x0,  0x0,  0x6b, 0xd0, 0x16,
                   0x0,  0x1b, 0x82, 0x18, 0xa5, 0x50, 0x2f, 0x94, 0xa5, 0x95, 0x33, 0xc0, 0x8f, 0x94, 0x6e, 0x3e, 0x24,
                   0x8d, 0xf2, 0xe0, 0xe7, 0x30, 0x91, 0x7b, 0xe6, 0x66, 0x1e, 0xb2, 0xbd, 0x2,  0x0,  0x0,  0x7c, 0x2a,
                   0x25, 0x5d, 0x9,  0x0,  0x1,  0xc6, 0x29, 0x6a, 0x1,  0x7c, 0x25, 0x8a, 0x18, 0x0,  0x0,  0x6b, 0xec,
                   0x17, 0xd2, 0x0,  0x3,  0xda, 0x47, 0xe4, 0x0,  0x1b, 0x85, 0x8d, 0x3b, 0xc7, 0x87, 0x91, 0x31, 0x15,
                   0xd7, 0xa2, 0x48, 0xe0, 0xc7, 0x71, 0xc,  0x74, 0x9c, 0x46, 0x2,  0xb2, 0xa2, 0x98, 0x93, 0x66, 0xf,
                   0xe5, 0xf8, 0x0,  0x5,  0x3,  0x70, 0x93, 0x95, 0x37};

  uint8_t buf[223] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x22, 0x47, 0xa6, 0xb5, 0x28, 0x43, 0xaf, 0x31, 0xd2, 0x22, 0x9e, 0x59,
                               0x16, 0x17, 0x1b, 0x61, 0x9c, 0xbe, 0x1f, 0xf5, 0x2d, 0x6f, 0xe3};
  uint8_t byteswillprops1[] = {0x3e, 0x9f, 0xd0, 0x84, 0xb,  0xf3, 0x4e, 0xe9, 0xb3, 0x6f, 0x2c, 0x2a, 0x42, 0x94, 0xd2,
                               0x7e, 0x28, 0xc0, 0x14, 0xff, 0x1,  0xf4, 0x95, 0x85, 0x17, 0x3a, 0xbb, 0x6d, 0x3e};
  uint8_t byteswillprops2[] = {0x82, 0x18, 0xa5, 0x50, 0x2f, 0x94, 0xa5, 0x95, 0x33, 0xc0, 0x8f, 0x94, 0x6e, 0x3e,
                               0x24, 0x8d, 0xf2, 0xe0, 0xe7, 0x30, 0x91, 0x7b, 0xe6, 0x66, 0x1e, 0xb2, 0xbd};
  uint8_t byteswillprops3[] = {0xc6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2146}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25696}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27600}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31786}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27628}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0x47, 0xe4};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x85, 0x8d, 0x3b, 0xc7, 0x87, 0x91, 0x31, 0x15, 0xd7, 0xa2, 0x48, 0xe0, 0xc7, 0x71,
                                  0xc,  0x74, 0x9c, 0x46, 0x2,  0xb2, 0xa2, 0x98, 0x93, 0x66, 0xf,  0xe5, 0xf8};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3338;
  uint8_t client_id_bytes[] = {0xf4, 0xa4, 0x36, 0x16, 0x92, 0xf9, 0x1,  0x52, 0x7c, 0x62,
                               0xaf, 0x65, 0x7e, 0x92, 0x78, 0xe9, 0x48, 0xf0, 0x43, 0xd0,
                               0xf9, 0x4d, 0xe9, 0x76, 0xea, 0xc2, 0xcb, 0xbd, 0xe6, 0xde};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3, 0x70, 0x93, 0x95, 0x37};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%s%1", _password = Just "JZ\188v\194\151\206\232\FS8\227", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "<3\134\&3\210\ai\247\172", _willMsg =
// "\195Z\ACK\163\170\202", _willProps = [PropCorrelationData "\a\217q",PropAuthenticationData
// "/\157\198\206R\DC4\242S\164@\164\228A",PropMaximumQoS 158,PropRequestResponseInformation
// 204,PropWildcardSubscriptionAvailable 143,PropSharedSubscriptionAvailable 230,PropAssignedClientIdentifier
// "\207\249\164\SYN3\EM'\185\247\252\153\ESC\153\229\218\157\aiSb",PropAuthenticationMethod
// "\239\ETB",PropSubscriptionIdentifier 19,PropResponseTopic
// "q\197\&33\137\f\201\253T~\229i.\147\SUB\221\170",PropReceiveMaximum 4184,PropReceiveMaximum
// 15100,PropRequestProblemInformation 182,PropPayloadFormatIndicator 133,PropAssignedClientIdentifier
// "\DC1\152C\221\192\182\USj\134>4\191\160\210}\171",PropSubscriptionIdentifier 4,PropSharedSubscriptionAvailable
// 15,PropContentType "a\160\237w\210k"]}), _cleanSession = False, _keepAlive = 21786, _connID =
// "$\218\249\238\250,\NUL\129\DC2\162H\219_\168K\DC1\212\231\195p\167\157\177D\149", _properties = []}
TEST(Connect5QCTest, Encode40) {
  uint8_t pkt[] = {0x10, 0xc7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x55, 0x1a, 0x0,  0x0,  0x19, 0x24,
                   0xda, 0xf9, 0xee, 0xfa, 0x2c, 0x0,  0x81, 0x12, 0xa2, 0x48, 0xdb, 0x5f, 0xa8, 0x4b, 0x11, 0xd4, 0xe7,
                   0xc3, 0x70, 0xa7, 0x9d, 0xb1, 0x44, 0x95, 0x7a, 0x9,  0x0,  0x3,  0x7,  0xd9, 0x71, 0x16, 0x0,  0xd,
                   0x2f, 0x9d, 0xc6, 0xce, 0x52, 0x14, 0xf2, 0x53, 0xa4, 0x40, 0xa4, 0xe4, 0x41, 0x24, 0x9e, 0x19, 0xcc,
                   0x28, 0x8f, 0x2a, 0xe6, 0x12, 0x0,  0x14, 0xcf, 0xf9, 0xa4, 0x16, 0x33, 0x19, 0x27, 0xb9, 0xf7, 0xfc,
                   0x99, 0x1b, 0x99, 0xe5, 0xda, 0x9d, 0x7,  0x69, 0x53, 0x62, 0x15, 0x0,  0x2,  0xef, 0x17, 0xb,  0x13,
                   0x8,  0x0,  0x11, 0x71, 0xc5, 0x33, 0x33, 0x89, 0xc,  0xc9, 0xfd, 0x54, 0x7e, 0xe5, 0x69, 0x2e, 0x93,
                   0x1a, 0xdd, 0xaa, 0x21, 0x10, 0x58, 0x21, 0x3a, 0xfc, 0x17, 0xb6, 0x1,  0x85, 0x12, 0x0,  0x10, 0x11,
                   0x98, 0x43, 0xdd, 0xc0, 0xb6, 0x1f, 0x6a, 0x86, 0x3e, 0x34, 0xbf, 0xa0, 0xd2, 0x7d, 0xab, 0xb,  0x4,
                   0x2a, 0xf,  0x3,  0x0,  0x6,  0x61, 0xa0, 0xed, 0x77, 0xd2, 0x6b, 0x0,  0x9,  0x3c, 0x33, 0x86, 0x33,
                   0xd2, 0x7,  0x69, 0xf7, 0xac, 0x0,  0x6,  0xc3, 0x5a, 0x6,  0xa3, 0xaa, 0xca, 0x0,  0x4,  0x25, 0x73,
                   0x25, 0x31, 0x0,  0xb,  0x4a, 0x5a, 0xbc, 0x76, 0xc2, 0x97, 0xce, 0xe8, 0x1c, 0x38, 0xe3};

  uint8_t buf[212] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7, 0xd9, 0x71};
  uint8_t byteswillprops1[] = {0x2f, 0x9d, 0xc6, 0xce, 0x52, 0x14, 0xf2, 0x53, 0xa4, 0x40, 0xa4, 0xe4, 0x41};
  uint8_t byteswillprops2[] = {0xcf, 0xf9, 0xa4, 0x16, 0x33, 0x19, 0x27, 0xb9, 0xf7, 0xfc,
                               0x99, 0x1b, 0x99, 0xe5, 0xda, 0x9d, 0x7,  0x69, 0x53, 0x62};
  uint8_t byteswillprops3[] = {0xef, 0x17};
  uint8_t byteswillprops4[] = {0x71, 0xc5, 0x33, 0x33, 0x89, 0xc,  0xc9, 0xfd, 0x54,
                               0x7e, 0xe5, 0x69, 0x2e, 0x93, 0x1a, 0xdd, 0xaa};
  uint8_t byteswillprops5[] = {0x11, 0x98, 0x43, 0xdd, 0xc0, 0xb6, 0x1f, 0x6a,
                               0x86, 0x3e, 0x34, 0xbf, 0xa0, 0xd2, 0x7d, 0xab};
  uint8_t byteswillprops6[] = {0x61, 0xa0, 0xed, 0x77, 0xd2, 0x6b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4184}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15100}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3c, 0x33, 0x86, 0x33, 0xd2, 0x7, 0x69, 0xf7, 0xac};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc3, 0x5a, 0x6, 0xa3, 0xaa, 0xca};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21786;
  uint8_t client_id_bytes[] = {0x24, 0xda, 0xf9, 0xee, 0xfa, 0x2c, 0x0,  0x81, 0x12, 0xa2, 0x48, 0xdb, 0x5f,
                               0xa8, 0x4b, 0x11, 0xd4, 0xe7, 0xc3, 0x70, 0xa7, 0x9d, 0xb1, 0x44, 0x95};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x73, 0x25, 0x31};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4a, 0x5a, 0xbc, 0x76, 0xc2, 0x97, 0xce, 0xe8, 0x1c, 0x38, 0xe3};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\"\192-\143\173\214\ETXL\182X\SOHQ", _password = Just
// "\210\SI4\163\NUL>\DC1}2x\SOHq\134\ETX\245\&0\169\180", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\227\NAK\133\240\173\&0\r", _willMsg = "\197 \US<Q\vIe_\159d6'\157\b\FS}\207\152b\153L\201\203",
// _willProps = [PropRequestProblemInformation 184,PropSessionExpiryInterval 5129,PropResponseTopic
// "\144\151\188\CANGg\211{\DEL\208\230\FS\181\ACK\ESC\210\&6\SI\DC2",PropCorrelationData
// "1\187\NAKz@\253\141K\213\168\196\230D(\\o\170\&8\165[\128\134`:\205\132",PropTopicAlias 15021,PropMaximumQoS
// 62,PropReasonString "",PropReceiveMaximum 29446]}), _cleanSession = True, _keepAlive = 22592, _connID =
// "XA\237\251\186s\FS(W\ESC\157\194", _properties = [PropPayloadFormatIndicator 204,PropServerReference
// "t\195\t@\v\241\v\143=\217\v\131\ACK\ETB\222\153\157\&6&\219",PropRequestResponseInformation
// 169,PropRequestResponseInformation 198,PropTopicAlias 950,PropMaximumQoS 128,PropReceiveMaximum
// 29194,PropTopicAliasMaximum 23867,PropTopicAliasMaximum 12590,PropUserProperty "\172|f\173\161\239\144\161\194\n\201"
// "\188\239\177\182\156^\SUB\182RH\140e\209\172\191\172?\172\225\164\254",PropRequestProblemInformation
// 56,PropServerKeepAlive 28154,PropCorrelationData "D\v\DC1:N]",PropResponseTopic
// "}\132\194\192&VL\158\235W\235\162\DC4]",PropRetainAvailable 166,PropPayloadFormatIndicator
// 35,PropWildcardSubscriptionAvailable 253,PropRequestResponseInformation 171,PropAuthenticationData
// "OR\DC1\184\168\NAK",PropAssignedClientIdentifier
// "\239\150\161\222\204\CAN\143\238).a`\222\251G\163fh\185\223",PropSubscriptionIdentifierAvailable
// 202,PropRetainAvailable 184,PropRequestResponseInformation 212,PropSubscriptionIdentifier 27,PropCorrelationData
// "\220&/",PropReceiveMaximum 32222,PropRequestProblemInformation 21,PropWillDelayInterval 16791,PropUserProperty ""
// "\b\157Sx\244(I\DC1X\ETB"]}
TEST(Connect5QCTest, Encode41) {
  uint8_t pkt[] = {
      0x10, 0xe3, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x58, 0x40, 0xbe, 0x1,  0x1,  0xcc, 0x1c, 0x0,
      0x14, 0x74, 0xc3, 0x9,  0x40, 0xb,  0xf1, 0xb,  0x8f, 0x3d, 0xd9, 0xb,  0x83, 0x6,  0x17, 0xde, 0x99, 0x9d, 0x36,
      0x26, 0xdb, 0x19, 0xa9, 0x19, 0xc6, 0x23, 0x3,  0xb6, 0x24, 0x80, 0x21, 0x72, 0xa,  0x22, 0x5d, 0x3b, 0x22, 0x31,
      0x2e, 0x26, 0x0,  0xb,  0xac, 0x7c, 0x66, 0xad, 0xa1, 0xef, 0x90, 0xa1, 0xc2, 0xa,  0xc9, 0x0,  0x15, 0xbc, 0xef,
      0xb1, 0xb6, 0x9c, 0x5e, 0x1a, 0xb6, 0x52, 0x48, 0x8c, 0x65, 0xd1, 0xac, 0xbf, 0xac, 0x3f, 0xac, 0xe1, 0xa4, 0xfe,
      0x17, 0x38, 0x13, 0x6d, 0xfa, 0x9,  0x0,  0x6,  0x44, 0xb,  0x11, 0x3a, 0x4e, 0x5d, 0x8,  0x0,  0xe,  0x7d, 0x84,
      0xc2, 0xc0, 0x26, 0x56, 0x4c, 0x9e, 0xeb, 0x57, 0xeb, 0xa2, 0x14, 0x5d, 0x25, 0xa6, 0x1,  0x23, 0x28, 0xfd, 0x19,
      0xab, 0x16, 0x0,  0x6,  0x4f, 0x52, 0x11, 0xb8, 0xa8, 0x15, 0x12, 0x0,  0x14, 0xef, 0x96, 0xa1, 0xde, 0xcc, 0x18,
      0x8f, 0xee, 0x29, 0x2e, 0x61, 0x60, 0xde, 0xfb, 0x47, 0xa3, 0x66, 0x68, 0xb9, 0xdf, 0x29, 0xca, 0x25, 0xb8, 0x19,
      0xd4, 0xb,  0x1b, 0x9,  0x0,  0x3,  0xdc, 0x26, 0x2f, 0x21, 0x7d, 0xde, 0x17, 0x15, 0x18, 0x0,  0x0,  0x41, 0x97,
      0x26, 0x0,  0x0,  0x0,  0xa,  0x8,  0x9d, 0x53, 0x78, 0xf4, 0x28, 0x49, 0x11, 0x58, 0x17, 0x0,  0xc,  0x58, 0x41,
      0xed, 0xfb, 0xba, 0x73, 0x1c, 0x28, 0x57, 0x1b, 0x9d, 0xc2, 0x45, 0x17, 0xb8, 0x11, 0x0,  0x0,  0x14, 0x9,  0x8,
      0x0,  0x13, 0x90, 0x97, 0xbc, 0x18, 0x47, 0x67, 0xd3, 0x7b, 0x7f, 0xd0, 0xe6, 0x1c, 0xb5, 0x6,  0x1b, 0xd2, 0x36,
      0xf,  0x12, 0x9,  0x0,  0x1a, 0x31, 0xbb, 0x15, 0x7a, 0x40, 0xfd, 0x8d, 0x4b, 0xd5, 0xa8, 0xc4, 0xe6, 0x44, 0x28,
      0x5c, 0x6f, 0xaa, 0x38, 0xa5, 0x5b, 0x80, 0x86, 0x60, 0x3a, 0xcd, 0x84, 0x23, 0x3a, 0xad, 0x24, 0x3e, 0x1f, 0x0,
      0x0,  0x21, 0x73, 0x6,  0x0,  0x7,  0xe3, 0x15, 0x85, 0xf0, 0xad, 0x30, 0xd,  0x0,  0x18, 0xc5, 0x20, 0x1f, 0x3c,
      0x51, 0xb,  0x49, 0x65, 0x5f, 0x9f, 0x64, 0x36, 0x27, 0x9d, 0x8,  0x1c, 0x7d, 0xcf, 0x98, 0x62, 0x99, 0x4c, 0xc9,
      0xcb, 0x0,  0xc,  0x22, 0xc0, 0x2d, 0x8f, 0xad, 0xd6, 0x3,  0x4c, 0xb6, 0x58, 0x1,  0x51, 0x0,  0x12, 0xd2, 0xf,
      0x34, 0xa3, 0x0,  0x3e, 0x11, 0x7d, 0x32, 0x78, 0x1,  0x71, 0x86, 0x3,  0xf5, 0x30, 0xa9, 0xb4};

  uint8_t buf[368] = {0};

  uint8_t bytesprops0[] = {0x74, 0xc3, 0x9, 0x40, 0xb,  0xf1, 0xb,  0x8f, 0x3d, 0xd9,
                           0xb,  0x83, 0x6, 0x17, 0xde, 0x99, 0x9d, 0x36, 0x26, 0xdb};
  uint8_t bytesprops2[] = {0xbc, 0xef, 0xb1, 0xb6, 0x9c, 0x5e, 0x1a, 0xb6, 0x52, 0x48, 0x8c,
                           0x65, 0xd1, 0xac, 0xbf, 0xac, 0x3f, 0xac, 0xe1, 0xa4, 0xfe};
  uint8_t bytesprops1[] = {0xac, 0x7c, 0x66, 0xad, 0xa1, 0xef, 0x90, 0xa1, 0xc2, 0xa, 0xc9};
  uint8_t bytesprops3[] = {0x44, 0xb, 0x11, 0x3a, 0x4e, 0x5d};
  uint8_t bytesprops4[] = {0x7d, 0x84, 0xc2, 0xc0, 0x26, 0x56, 0x4c, 0x9e, 0xeb, 0x57, 0xeb, 0xa2, 0x14, 0x5d};
  uint8_t bytesprops5[] = {0x4f, 0x52, 0x11, 0xb8, 0xa8, 0x15};
  uint8_t bytesprops6[] = {0xef, 0x96, 0xa1, 0xde, 0xcc, 0x18, 0x8f, 0xee, 0x29, 0x2e,
                           0x61, 0x60, 0xde, 0xfb, 0x47, 0xa3, 0x66, 0x68, 0xb9, 0xdf};
  uint8_t bytesprops7[] = {0xdc, 0x26, 0x2f};
  uint8_t bytesprops9[] = {0x8, 0x9d, 0x53, 0x78, 0xf4, 0x28, 0x49, 0x11, 0x58, 0x17};
  uint8_t bytesprops8[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 950}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29194}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23867}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12590}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {21, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28154}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32222}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16791}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops8}, .v = {10, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x90, 0x97, 0xbc, 0x18, 0x47, 0x67, 0xd3, 0x7b, 0x7f, 0xd0,
                               0xe6, 0x1c, 0xb5, 0x6,  0x1b, 0xd2, 0x36, 0xf,  0x12};
  uint8_t byteswillprops1[] = {0x31, 0xbb, 0x15, 0x7a, 0x40, 0xfd, 0x8d, 0x4b, 0xd5, 0xa8, 0xc4, 0xe6, 0x44,
                               0x28, 0x5c, 0x6f, 0xaa, 0x38, 0xa5, 0x5b, 0x80, 0x86, 0x60, 0x3a, 0xcd, 0x84};
  uint8_t byteswillprops2[] = {0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5129}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15021}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29446}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0x15, 0x85, 0xf0, 0xad, 0x30, 0xd};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc5, 0x20, 0x1f, 0x3c, 0x51, 0xb,  0x49, 0x65, 0x5f, 0x9f, 0x64, 0x36,
                                  0x27, 0x9d, 0x8,  0x1c, 0x7d, 0xcf, 0x98, 0x62, 0x99, 0x4c, 0xc9, 0xcb};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22592;
  uint8_t client_id_bytes[] = {0x58, 0x41, 0xed, 0xfb, 0xba, 0x73, 0x1c, 0x28, 0x57, 0x1b, 0x9d, 0xc2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x22, 0xc0, 0x2d, 0x8f, 0xad, 0xd6, 0x3, 0x4c, 0xb6, 0x58, 0x1, 0x51};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd2, 0xf, 0x34, 0xa3, 0x0, 0x3e, 0x11, 0x7d, 0x32,
                              0x78, 0x1, 0x71, 0x86, 0x3, 0xf5, 0x30, 0xa9, 0xb4};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "~\DC3\ESCh\220\132\&9~\FS\213\139\205\242\158t\242\208o4\175\134\143(\192\207nL\188)\202", _password = Nothing,
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 18216, _connID = "&6r\145{\232\157\f\225\197\135!\STX",
// _properties = [PropSessionExpiryInterval 22751,PropTopicAlias 104,PropRetainAvailable 3,PropResponseInformation
// "\215\ETXq\US\250\156\&4\209cs\n*",PropAssignedClientIdentifier
// "\157z\167\168\255Dl\153\252*\191p\143\172?\ETXoj\241\130\146\227\225\&0",PropMaximumPacketSize
// 5109,PropMaximumPacketSize 3601,PropTopicAliasMaximum 9834,PropRequestResponseInformation
// 186,PropSubscriptionIdentifier 29,PropServerReference
// "\203\SO3\ENQ\217\193O\141\182\176",PropSharedSubscriptionAvailable 238,PropWillDelayInterval 8366,PropResponseTopic
// "\ENQ\163a",PropAssignedClientIdentifier
// "]c\201\135\154K\197\210\193\215\128\&7\153\\\DC1\SYN^Z\254\&7\170\150\174\166\173Z\199\149\215",PropContentType
// "\249\f\221\141\224b\149\156a\205\EOT-\DEL\155\141\&2\169\166l\151\206.{\\\FSm\SOH\245\229",PropContentType
// "L\213\237Z\157q",PropSubscriptionIdentifier 3,PropAuthenticationData "W\139\192~X\180f\156|\160-<"]}
TEST(Connect5QCTest, Encode42) {
  uint8_t pkt[] = {
      0x10, 0xf4, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x47, 0x28, 0xb9, 0x1,  0x11, 0x0,  0x0,  0x58,
      0xdf, 0x23, 0x0,  0x68, 0x25, 0x3,  0x1a, 0x0,  0xc,  0xd7, 0x3,  0x71, 0x1f, 0xfa, 0x9c, 0x34, 0xd1, 0x63, 0x73,
      0xa,  0x2a, 0x12, 0x0,  0x18, 0x9d, 0x7a, 0xa7, 0xa8, 0xff, 0x44, 0x6c, 0x99, 0xfc, 0x2a, 0xbf, 0x70, 0x8f, 0xac,
      0x3f, 0x3,  0x6f, 0x6a, 0xf1, 0x82, 0x92, 0xe3, 0xe1, 0x30, 0x27, 0x0,  0x0,  0x13, 0xf5, 0x27, 0x0,  0x0,  0xe,
      0x11, 0x22, 0x26, 0x6a, 0x19, 0xba, 0xb,  0x1d, 0x1c, 0x0,  0xa,  0xcb, 0xe,  0x33, 0x5,  0xd9, 0xc1, 0x4f, 0x8d,
      0xb6, 0xb0, 0x2a, 0xee, 0x18, 0x0,  0x0,  0x20, 0xae, 0x8,  0x0,  0x3,  0x5,  0xa3, 0x61, 0x12, 0x0,  0x1d, 0x5d,
      0x63, 0xc9, 0x87, 0x9a, 0x4b, 0xc5, 0xd2, 0xc1, 0xd7, 0x80, 0x37, 0x99, 0x5c, 0x11, 0x16, 0x5e, 0x5a, 0xfe, 0x37,
      0xaa, 0x96, 0xae, 0xa6, 0xad, 0x5a, 0xc7, 0x95, 0xd7, 0x3,  0x0,  0x1d, 0xf9, 0xc,  0xdd, 0x8d, 0xe0, 0x62, 0x95,
      0x9c, 0x61, 0xcd, 0x4,  0x2d, 0x7f, 0x9b, 0x8d, 0x32, 0xa9, 0xa6, 0x6c, 0x97, 0xce, 0x2e, 0x7b, 0x5c, 0x1c, 0x6d,
      0x1,  0xf5, 0xe5, 0x3,  0x0,  0x6,  0x4c, 0xd5, 0xed, 0x5a, 0x9d, 0x71, 0xb,  0x3,  0x16, 0x0,  0xc,  0x57, 0x8b,
      0xc0, 0x7e, 0x58, 0xb4, 0x66, 0x9c, 0x7c, 0xa0, 0x2d, 0x3c, 0x0,  0xd,  0x26, 0x36, 0x72, 0x91, 0x7b, 0xe8, 0x9d,
      0xc,  0xe1, 0xc5, 0x87, 0x21, 0x2,  0x0,  0x1e, 0x7e, 0x13, 0x1b, 0x68, 0xdc, 0x84, 0x39, 0x7e, 0x1c, 0xd5, 0x8b,
      0xcd, 0xf2, 0x9e, 0x74, 0xf2, 0xd0, 0x6f, 0x34, 0xaf, 0x86, 0x8f, 0x28, 0xc0, 0xcf, 0x6e, 0x4c, 0xbc, 0x29, 0xca};

  uint8_t buf[257] = {0};

  uint8_t bytesprops0[] = {0xd7, 0x3, 0x71, 0x1f, 0xfa, 0x9c, 0x34, 0xd1, 0x63, 0x73, 0xa, 0x2a};
  uint8_t bytesprops1[] = {0x9d, 0x7a, 0xa7, 0xa8, 0xff, 0x44, 0x6c, 0x99, 0xfc, 0x2a, 0xbf, 0x70,
                           0x8f, 0xac, 0x3f, 0x3,  0x6f, 0x6a, 0xf1, 0x82, 0x92, 0xe3, 0xe1, 0x30};
  uint8_t bytesprops2[] = {0xcb, 0xe, 0x33, 0x5, 0xd9, 0xc1, 0x4f, 0x8d, 0xb6, 0xb0};
  uint8_t bytesprops3[] = {0x5, 0xa3, 0x61};
  uint8_t bytesprops4[] = {0x5d, 0x63, 0xc9, 0x87, 0x9a, 0x4b, 0xc5, 0xd2, 0xc1, 0xd7, 0x80, 0x37, 0x99, 0x5c, 0x11,
                           0x16, 0x5e, 0x5a, 0xfe, 0x37, 0xaa, 0x96, 0xae, 0xa6, 0xad, 0x5a, 0xc7, 0x95, 0xd7};
  uint8_t bytesprops5[] = {0xf9, 0xc,  0xdd, 0x8d, 0xe0, 0x62, 0x95, 0x9c, 0x61, 0xcd, 0x4,  0x2d, 0x7f, 0x9b, 0x8d,
                           0x32, 0xa9, 0xa6, 0x6c, 0x97, 0xce, 0x2e, 0x7b, 0x5c, 0x1c, 0x6d, 0x1,  0xf5, 0xe5};
  uint8_t bytesprops6[] = {0x4c, 0xd5, 0xed, 0x5a, 0x9d, 0x71};
  uint8_t bytesprops7[] = {0x57, 0x8b, 0xc0, 0x7e, 0x58, 0xb4, 0x66, 0x9c, 0x7c, 0xa0, 0x2d, 0x3c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22751}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 104}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5109}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3601}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9834}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8366}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18216;
  uint8_t client_id_bytes[] = {0x26, 0x36, 0x72, 0x91, 0x7b, 0xe8, 0x9d, 0xc, 0xe1, 0xc5, 0x87, 0x21, 0x2};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7e, 0x13, 0x1b, 0x68, 0xdc, 0x84, 0x39, 0x7e, 0x1c, 0xd5, 0x8b, 0xcd, 0xf2, 0x9e, 0x74,
                              0xf2, 0xd0, 0x6f, 0x34, 0xaf, 0x86, 0x8f, 0x28, 0xc0, 0xcf, 0x6e, 0x4c, 0xbc, 0x29, 0xca};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "p\148\STX\193*\195\130\ENQ\162\247\v\\b\139\240\152", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\186C\NAK\197\179", _willMsg =
// "Y7%\242\197D\157\238\130\226\186.\212Q\183\ETX\181S\159!-HG", _willProps = [PropWillDelayInterval
// 3188,PropMaximumQoS 149,PropTopicAlias 25593,PropTopicAliasMaximum 12640,PropAuthenticationMethod
// "d\162\SIEtBY\147L\240V\177\203|S\ENQ",PropTopicAlias 27623,PropContentType
// "K\167\137\192\138\128\148\168\223\128.\226\162%\149\236\200\220]\251",PropRequestProblemInformation
// 247,PropServerKeepAlive 11955,PropMessageExpiryInterval 24382,PropAuthenticationData
// "\195\238\156}\EMKp\190?",PropSessionExpiryInterval 13553,PropAuthenticationMethod
// "",PropWildcardSubscriptionAvailable 172,PropContentType
// "B\SYN\196.5\209\149\185\182\NUL\223\249\179\225\ETX\241\188\177\132\151\193?\216\138",PropResponseTopic
// "hFw\146\142\227s\167\130m'\204\136`\170{~",PropPayloadFormatIndicator 255,PropRetainAvailable
// 69,PropMessageExpiryInterval 1516,PropRequestResponseInformation 43,PropAuthenticationMethod
// "U\245\185vO\148\145]}\ENQSh\135\237\t\"\155~g\253\DC3\217M\136\188\EOT=\176\&8Q",PropWillDelayInterval
// 29807,PropCorrelationData "\176\228)\234\191\169\133\161\165pp2<\SYN/vU",PropAuthenticationData
// "\245#\197n\240\208\f\249\ESCj\227\aC\157\198\141\213\191<\158\250\196\134",PropRetainAvailable
// 200,PropRetainAvailable 244]}), _cleanSession = False, _keepAlive = 11046, _connID =
// ":\131J\139+\"\230V\245\180D\161E\203\254\141[\169e", _properties = [PropAuthenticationData
// "\196s\171%@R\b\172(\ETX\171\193\154\135T8\GSD\EOT\143\239`\247",PropUserProperty
// "\156\244\DC4Fy2\163b\r\204\247\f\NAK\SO\170#k\147E\147|+\132\196\EOT\141\192:\139Q"
// "+Ij\170<\139\162",PropAssignedClientIdentifier
// "\144m\162\181m*\247\NAKB\195j\139\DEL\a\248tbY\209\192S\n\tY\DEL",PropAssignedClientIdentifier
// "\238\229\b\EOTsjZl\DC2\CANI~m\207w.\DC1",PropReasonString
// "\166\142\f\178+\214\234\DC3\158d=\255#\r\170i",PropRequestProblemInformation 49]}
TEST(Connect5QCTest, Encode43) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x2b, 0x26, 0x89, 0x1,  0x16, 0x0,  0x17, 0xc4,
      0x73, 0xab, 0x25, 0x40, 0x52, 0x8,  0xac, 0x28, 0x3,  0xab, 0xc1, 0x9a, 0x87, 0x54, 0x38, 0x1d, 0x44, 0x4,  0x8f,
      0xef, 0x60, 0xf7, 0x26, 0x0,  0x1e, 0x9c, 0xf4, 0x14, 0x46, 0x79, 0x32, 0xa3, 0x62, 0xd,  0xcc, 0xf7, 0xc,  0x15,
      0xe,  0xaa, 0x23, 0x6b, 0x93, 0x45, 0x93, 0x7c, 0x2b, 0x84, 0xc4, 0x4,  0x8d, 0xc0, 0x3a, 0x8b, 0x51, 0x0,  0x7,
      0x2b, 0x49, 0x6a, 0xaa, 0x3c, 0x8b, 0xa2, 0x12, 0x0,  0x19, 0x90, 0x6d, 0xa2, 0xb5, 0x6d, 0x2a, 0xf7, 0x15, 0x42,
      0xc3, 0x6a, 0x8b, 0x7f, 0x7,  0xf8, 0x74, 0x62, 0x59, 0xd1, 0xc0, 0x53, 0xa,  0x9,  0x59, 0x7f, 0x12, 0x0,  0x11,
      0xee, 0xe5, 0x8,  0x4,  0x73, 0x6a, 0x5a, 0x6c, 0x12, 0x18, 0x49, 0x7e, 0x6d, 0xcf, 0x77, 0x2e, 0x11, 0x1f, 0x0,
      0x10, 0xa6, 0x8e, 0xc,  0xb2, 0x2b, 0xd6, 0xea, 0x13, 0x9e, 0x64, 0x3d, 0xff, 0x23, 0xd,  0xaa, 0x69, 0x17, 0x31,
      0x0,  0x13, 0x3a, 0x83, 0x4a, 0x8b, 0x2b, 0x22, 0xe6, 0x56, 0xf5, 0xb4, 0x44, 0xa1, 0x45, 0xcb, 0xfe, 0x8d, 0x5b,
      0xa9, 0x65, 0xec, 0x1,  0x18, 0x0,  0x0,  0xc,  0x74, 0x24, 0x95, 0x23, 0x63, 0xf9, 0x22, 0x31, 0x60, 0x15, 0x0,
      0x10, 0x64, 0xa2, 0xf,  0x45, 0x74, 0x42, 0x59, 0x93, 0x4c, 0xf0, 0x56, 0xb1, 0xcb, 0x7c, 0x53, 0x5,  0x23, 0x6b,
      0xe7, 0x3,  0x0,  0x14, 0x4b, 0xa7, 0x89, 0xc0, 0x8a, 0x80, 0x94, 0xa8, 0xdf, 0x80, 0x2e, 0xe2, 0xa2, 0x25, 0x95,
      0xec, 0xc8, 0xdc, 0x5d, 0xfb, 0x17, 0xf7, 0x13, 0x2e, 0xb3, 0x2,  0x0,  0x0,  0x5f, 0x3e, 0x16, 0x0,  0x9,  0xc3,
      0xee, 0x9c, 0x7d, 0x19, 0x4b, 0x70, 0xbe, 0x3f, 0x11, 0x0,  0x0,  0x34, 0xf1, 0x15, 0x0,  0x0,  0x28, 0xac, 0x3,
      0x0,  0x18, 0x42, 0x16, 0xc4, 0x2e, 0x35, 0xd1, 0x95, 0xb9, 0xb6, 0x0,  0xdf, 0xf9, 0xb3, 0xe1, 0x3,  0xf1, 0xbc,
      0xb1, 0x84, 0x97, 0xc1, 0x3f, 0xd8, 0x8a, 0x8,  0x0,  0x11, 0x68, 0x46, 0x77, 0x92, 0x8e, 0xe3, 0x73, 0xa7, 0x82,
      0x6d, 0x27, 0xcc, 0x88, 0x60, 0xaa, 0x7b, 0x7e, 0x1,  0xff, 0x25, 0x45, 0x2,  0x0,  0x0,  0x5,  0xec, 0x19, 0x2b,
      0x15, 0x0,  0x1e, 0x55, 0xf5, 0xb9, 0x76, 0x4f, 0x94, 0x91, 0x5d, 0x7d, 0x5,  0x53, 0x68, 0x87, 0xed, 0x9,  0x22,
      0x9b, 0x7e, 0x67, 0xfd, 0x13, 0xd9, 0x4d, 0x88, 0xbc, 0x4,  0x3d, 0xb0, 0x38, 0x51, 0x18, 0x0,  0x0,  0x74, 0x6f,
      0x9,  0x0,  0x11, 0xb0, 0xe4, 0x29, 0xea, 0xbf, 0xa9, 0x85, 0xa1, 0xa5, 0x70, 0x70, 0x32, 0x3c, 0x16, 0x2f, 0x76,
      0x55, 0x16, 0x0,  0x17, 0xf5, 0x23, 0xc5, 0x6e, 0xf0, 0xd0, 0xc,  0xf9, 0x1b, 0x6a, 0xe3, 0x7,  0x43, 0x9d, 0xc6,
      0x8d, 0xd5, 0xbf, 0x3c, 0x9e, 0xfa, 0xc4, 0x86, 0x25, 0xc8, 0x25, 0xf4, 0x0,  0x5,  0xba, 0x43, 0x15, 0xc5, 0xb3,
      0x0,  0x17, 0x59, 0x37, 0x25, 0xf2, 0xc5, 0x44, 0x9d, 0xee, 0x82, 0xe2, 0xba, 0x2e, 0xd4, 0x51, 0xb7, 0x3,  0xb5,
      0x53, 0x9f, 0x21, 0x2d, 0x48, 0x47, 0x0,  0x10, 0x70, 0x94, 0x2,  0xc1, 0x2a, 0xc3, 0x82, 0x5,  0xa2, 0xf7, 0xb,
      0x5c, 0x62, 0x8b, 0xf0, 0x98};

  uint8_t buf[471] = {0};

  uint8_t bytesprops0[] = {0xc4, 0x73, 0xab, 0x25, 0x40, 0x52, 0x8, 0xac, 0x28, 0x3,  0xab, 0xc1,
                           0x9a, 0x87, 0x54, 0x38, 0x1d, 0x44, 0x4, 0x8f, 0xef, 0x60, 0xf7};
  uint8_t bytesprops2[] = {0x2b, 0x49, 0x6a, 0xaa, 0x3c, 0x8b, 0xa2};
  uint8_t bytesprops1[] = {0x9c, 0xf4, 0x14, 0x46, 0x79, 0x32, 0xa3, 0x62, 0xd,  0xcc, 0xf7, 0xc,  0x15, 0xe,  0xaa,
                           0x23, 0x6b, 0x93, 0x45, 0x93, 0x7c, 0x2b, 0x84, 0xc4, 0x4,  0x8d, 0xc0, 0x3a, 0x8b, 0x51};
  uint8_t bytesprops3[] = {0x90, 0x6d, 0xa2, 0xb5, 0x6d, 0x2a, 0xf7, 0x15, 0x42, 0xc3, 0x6a, 0x8b, 0x7f,
                           0x7,  0xf8, 0x74, 0x62, 0x59, 0xd1, 0xc0, 0x53, 0xa,  0x9,  0x59, 0x7f};
  uint8_t bytesprops4[] = {0xee, 0xe5, 0x8,  0x4,  0x73, 0x6a, 0x5a, 0x6c, 0x12,
                           0x18, 0x49, 0x7e, 0x6d, 0xcf, 0x77, 0x2e, 0x11};
  uint8_t bytesprops5[] = {0xa6, 0x8e, 0xc,  0xb2, 0x2b, 0xd6, 0xea, 0x13,
                           0x9e, 0x64, 0x3d, 0xff, 0x23, 0xd,  0xaa, 0x69};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops1}, .v = {7, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x64, 0xa2, 0xf,  0x45, 0x74, 0x42, 0x59, 0x93,
                               0x4c, 0xf0, 0x56, 0xb1, 0xcb, 0x7c, 0x53, 0x5};
  uint8_t byteswillprops1[] = {0x4b, 0xa7, 0x89, 0xc0, 0x8a, 0x80, 0x94, 0xa8, 0xdf, 0x80,
                               0x2e, 0xe2, 0xa2, 0x25, 0x95, 0xec, 0xc8, 0xdc, 0x5d, 0xfb};
  uint8_t byteswillprops2[] = {0xc3, 0xee, 0x9c, 0x7d, 0x19, 0x4b, 0x70, 0xbe, 0x3f};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops4[] = {0x42, 0x16, 0xc4, 0x2e, 0x35, 0xd1, 0x95, 0xb9, 0xb6, 0x0,  0xdf, 0xf9,
                               0xb3, 0xe1, 0x3,  0xf1, 0xbc, 0xb1, 0x84, 0x97, 0xc1, 0x3f, 0xd8, 0x8a};
  uint8_t byteswillprops5[] = {0x68, 0x46, 0x77, 0x92, 0x8e, 0xe3, 0x73, 0xa7, 0x82,
                               0x6d, 0x27, 0xcc, 0x88, 0x60, 0xaa, 0x7b, 0x7e};
  uint8_t byteswillprops6[] = {0x55, 0xf5, 0xb9, 0x76, 0x4f, 0x94, 0x91, 0x5d, 0x7d, 0x5,
                               0x53, 0x68, 0x87, 0xed, 0x9,  0x22, 0x9b, 0x7e, 0x67, 0xfd,
                               0x13, 0xd9, 0x4d, 0x88, 0xbc, 0x4,  0x3d, 0xb0, 0x38, 0x51};
  uint8_t byteswillprops7[] = {0xb0, 0xe4, 0x29, 0xea, 0xbf, 0xa9, 0x85, 0xa1, 0xa5,
                               0x70, 0x70, 0x32, 0x3c, 0x16, 0x2f, 0x76, 0x55};
  uint8_t byteswillprops8[] = {0xf5, 0x23, 0xc5, 0x6e, 0xf0, 0xd0, 0xc,  0xf9, 0x1b, 0x6a, 0xe3, 0x7,
                               0x43, 0x9d, 0xc6, 0x8d, 0xd5, 0xbf, 0x3c, 0x9e, 0xfa, 0xc4, 0x86};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3188}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25593}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12640}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27623}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11955}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24382}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13553}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1516}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29807}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xba, 0x43, 0x15, 0xc5, 0xb3};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x59, 0x37, 0x25, 0xf2, 0xc5, 0x44, 0x9d, 0xee, 0x82, 0xe2, 0xba, 0x2e,
                                  0xd4, 0x51, 0xb7, 0x3,  0xb5, 0x53, 0x9f, 0x21, 0x2d, 0x48, 0x47};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11046;
  uint8_t client_id_bytes[] = {0x3a, 0x83, 0x4a, 0x8b, 0x2b, 0x22, 0xe6, 0x56, 0xf5, 0xb4,
                               0x44, 0xa1, 0x45, 0xcb, 0xfe, 0x8d, 0x5b, 0xa9, 0x65};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x70, 0x94, 0x2, 0xc1, 0x2a, 0xc3, 0x82, 0x5,
                              0xa2, 0xf7, 0xb, 0x5c, 0x62, 0x8b, 0xf0, 0x98};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "y\222\SYN\215\SUB\192\219^\vN+w\212\186\&5\ETB\141)\207)1W$\150\SI", _password =
// Just "H\153[\FSZ}Q\\K\255\ENQ\212\182Kf\159K\NAK", _lastWill = Nothing, _cleanSession = False, _keepAlive = 19248,
// _connID = "\212\139\234\143\196\158v#\137\a\221GH", _properties = [PropWillDelayInterval 30167,PropRetainAvailable
// 169,PropResponseTopic "<\177X[\172\251N\217\181L",PropResponseInformation "",PropMaximumPacketSize
// 12968,PropServerKeepAlive 29378,PropPayloadFormatIndicator 187,PropContentType ")\154\182\235_",PropMaximumPacketSize
// 30929,PropMaximumPacketSize 14906,PropResponseInformation
// "\DLE\181\231\154\n\251c\191\131\202R\230\249",PropRequestProblemInformation 72,PropContentType
// "n\224\220\143\185`5J",PropReceiveMaximum 5269,PropReceiveMaximum 2749,PropRequestResponseInformation
// 77,PropPayloadFormatIndicator 61,PropSubscriptionIdentifier 12]}
TEST(Connect5QCTest, Encode44) {
  uint8_t pkt[] = {0x10, 0xa5, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x4b, 0x30, 0x5c, 0x18, 0x0,  0x0,
                   0x75, 0xd7, 0x25, 0xa9, 0x8,  0x0,  0xa,  0x3c, 0xb1, 0x58, 0x5b, 0xac, 0xfb, 0x4e, 0xd9, 0xb5, 0x4c,
                   0x1a, 0x0,  0x0,  0x27, 0x0,  0x0,  0x32, 0xa8, 0x13, 0x72, 0xc2, 0x1,  0xbb, 0x3,  0x0,  0x5,  0x29,
                   0x9a, 0xb6, 0xeb, 0x5f, 0x27, 0x0,  0x0,  0x78, 0xd1, 0x27, 0x0,  0x0,  0x3a, 0x3a, 0x1a, 0x0,  0xd,
                   0x10, 0xb5, 0xe7, 0x9a, 0xa,  0xfb, 0x63, 0xbf, 0x83, 0xca, 0x52, 0xe6, 0xf9, 0x17, 0x48, 0x3,  0x0,
                   0x8,  0x6e, 0xe0, 0xdc, 0x8f, 0xb9, 0x60, 0x35, 0x4a, 0x21, 0x14, 0x95, 0x21, 0xa,  0xbd, 0x19, 0x4d,
                   0x1,  0x3d, 0xb,  0xc,  0x0,  0xd,  0xd4, 0x8b, 0xea, 0x8f, 0xc4, 0x9e, 0x76, 0x23, 0x89, 0x7,  0xdd,
                   0x47, 0x48, 0x0,  0x19, 0x79, 0xde, 0x16, 0xd7, 0x1a, 0xc0, 0xdb, 0x5e, 0xb,  0x4e, 0x2b, 0x77, 0xd4,
                   0xba, 0x35, 0x17, 0x8d, 0x29, 0xcf, 0x29, 0x31, 0x57, 0x24, 0x96, 0xf,  0x0,  0x12, 0x48, 0x99, 0x5b,
                   0x1c, 0x5a, 0x7d, 0x51, 0x5c, 0x4b, 0xff, 0x5,  0xd4, 0xb6, 0x4b, 0x66, 0x9f, 0x4b, 0x15};

  uint8_t buf[178] = {0};

  uint8_t bytesprops0[] = {0x3c, 0xb1, 0x58, 0x5b, 0xac, 0xfb, 0x4e, 0xd9, 0xb5, 0x4c};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x29, 0x9a, 0xb6, 0xeb, 0x5f};
  uint8_t bytesprops3[] = {0x10, 0xb5, 0xe7, 0x9a, 0xa, 0xfb, 0x63, 0xbf, 0x83, 0xca, 0x52, 0xe6, 0xf9};
  uint8_t bytesprops4[] = {0x6e, 0xe0, 0xdc, 0x8f, 0xb9, 0x60, 0x35, 0x4a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30167}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12968}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29378}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30929}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14906}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5269}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2749}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19248;
  uint8_t client_id_bytes[] = {0xd4, 0x8b, 0xea, 0x8f, 0xc4, 0x9e, 0x76, 0x23, 0x89, 0x7, 0xdd, 0x47, 0x48};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x79, 0xde, 0x16, 0xd7, 0x1a, 0xc0, 0xdb, 0x5e, 0xb,  0x4e, 0x2b, 0x77, 0xd4,
                              0xba, 0x35, 0x17, 0x8d, 0x29, 0xcf, 0x29, 0x31, 0x57, 0x24, 0x96, 0xf};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x48, 0x99, 0x5b, 0x1c, 0x5a, 0x7d, 0x51, 0x5c, 0x4b,
                              0xff, 0x5,  0xd4, 0xb6, 0x4b, 0x66, 0x9f, 0x4b, 0x15};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "%\204\185\&3\ETB&\174\163\f\195%\205\&3[>\DEL\147\243\248\SI9\198\187\\\219\146\152\229\214\233", _lastWill =
// Nothing, _cleanSession = False, _keepAlive = 30703, _connID = "3\193)\173", _properties = [PropMaximumQoS
// 61,PropWildcardSubscriptionAvailable 121,PropResponseInformation "x\147;\224\240\232&\186",PropMessageExpiryInterval
// 8287,PropSharedSubscriptionAvailable 248,PropRequestResponseInformation 39,PropMessageExpiryInterval
// 18350,PropAssignedClientIdentifier "\192[\a",PropServerKeepAlive 6307,PropServerKeepAlive 24378,PropTopicAlias
// 5418,PropCorrelationData "\205\252\196\192\199P\163\199{xH\165e\229\152\141\143\DLE\148",PropAuthenticationMethod
// "\ETXeI\135\250\180",PropReasonString "N)\DC1|\218X>\247p $k\174a\STX\130\227{\178\RSJ\128",PropUserProperty
// "\216\157\182\181\250\DC1/\201L\169l\148\SOu\141\&1\FS)\229\253\150%\141"
// "I\228\DC4j\246]&\233\194\164",PropWillDelayInterval 15403,PropWildcardSubscriptionAvailable
// 171,PropResponseInformation "n\DC3\SOr\179",PropWillDelayInterval 4719,PropPayloadFormatIndicator
// 90,PropAssignedClientIdentifier "\133P"]}
TEST(Connect5QCTest, Encode45) {
  uint8_t pkt[] = {0x10, 0xb7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x77, 0xef, 0xa5, 0x1,  0x24, 0x3d,
                   0x28, 0x79, 0x1a, 0x0,  0x8,  0x78, 0x93, 0x3b, 0xe0, 0xf0, 0xe8, 0x26, 0xba, 0x2,  0x0,  0x0,  0x20,
                   0x5f, 0x2a, 0xf8, 0x19, 0x27, 0x2,  0x0,  0x0,  0x47, 0xae, 0x12, 0x0,  0x3,  0xc0, 0x5b, 0x7,  0x13,
                   0x18, 0xa3, 0x13, 0x5f, 0x3a, 0x23, 0x15, 0x2a, 0x9,  0x0,  0x13, 0xcd, 0xfc, 0xc4, 0xc0, 0xc7, 0x50,
                   0xa3, 0xc7, 0x7b, 0x78, 0x48, 0xa5, 0x65, 0xe5, 0x98, 0x8d, 0x8f, 0x10, 0x94, 0x15, 0x0,  0x6,  0x3,
                   0x65, 0x49, 0x87, 0xfa, 0xb4, 0x1f, 0x0,  0x16, 0x4e, 0x29, 0x11, 0x7c, 0xda, 0x58, 0x3e, 0xf7, 0x70,
                   0x20, 0x24, 0x6b, 0xae, 0x61, 0x2,  0x82, 0xe3, 0x7b, 0xb2, 0x1e, 0x4a, 0x80, 0x26, 0x0,  0x17, 0xd8,
                   0x9d, 0xb6, 0xb5, 0xfa, 0x11, 0x2f, 0xc9, 0x4c, 0xa9, 0x6c, 0x94, 0xe,  0x75, 0x8d, 0x31, 0x1c, 0x29,
                   0xe5, 0xfd, 0x96, 0x25, 0x8d, 0x0,  0xa,  0x49, 0xe4, 0x14, 0x6a, 0xf6, 0x5d, 0x26, 0xe9, 0xc2, 0xa4,
                   0x18, 0x0,  0x0,  0x3c, 0x2b, 0x28, 0xab, 0x1a, 0x0,  0x5,  0x6e, 0x13, 0xe,  0x72, 0xb3, 0x18, 0x0,
                   0x0,  0x12, 0x6f, 0x1,  0x5a, 0x12, 0x0,  0x2,  0x85, 0x50, 0x0,  0x4,  0x33, 0xc1, 0x29, 0xad};

  uint8_t buf[196] = {0};

  uint8_t bytesprops0[] = {0x78, 0x93, 0x3b, 0xe0, 0xf0, 0xe8, 0x26, 0xba};
  uint8_t bytesprops1[] = {0xc0, 0x5b, 0x7};
  uint8_t bytesprops2[] = {0xcd, 0xfc, 0xc4, 0xc0, 0xc7, 0x50, 0xa3, 0xc7, 0x7b, 0x78,
                           0x48, 0xa5, 0x65, 0xe5, 0x98, 0x8d, 0x8f, 0x10, 0x94};
  uint8_t bytesprops3[] = {0x3, 0x65, 0x49, 0x87, 0xfa, 0xb4};
  uint8_t bytesprops4[] = {0x4e, 0x29, 0x11, 0x7c, 0xda, 0x58, 0x3e, 0xf7, 0x70, 0x20, 0x24,
                           0x6b, 0xae, 0x61, 0x2,  0x82, 0xe3, 0x7b, 0xb2, 0x1e, 0x4a, 0x80};
  uint8_t bytesprops6[] = {0x49, 0xe4, 0x14, 0x6a, 0xf6, 0x5d, 0x26, 0xe9, 0xc2, 0xa4};
  uint8_t bytesprops5[] = {0xd8, 0x9d, 0xb6, 0xb5, 0xfa, 0x11, 0x2f, 0xc9, 0x4c, 0xa9, 0x6c, 0x94,
                           0xe,  0x75, 0x8d, 0x31, 0x1c, 0x29, 0xe5, 0xfd, 0x96, 0x25, 0x8d};
  uint8_t bytesprops7[] = {0x6e, 0x13, 0xe, 0x72, 0xb3};
  uint8_t bytesprops8[] = {0x85, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8287}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18350}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6307}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24378}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5418}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops5}, .v = {10, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15403}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4719}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30703;
  uint8_t client_id_bytes[] = {0x33, 0xc1, 0x29, 0xad};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x25, 0xcc, 0xb9, 0x33, 0x17, 0x26, 0xae, 0xa3, 0xc,  0xc3, 0x25, 0xcd, 0x33, 0x5b, 0x3e,
                              0x7f, 0x93, 0xf3, 0xf8, 0xf,  0x39, 0xc6, 0xbb, 0x5c, 0xdb, 0x92, 0x98, 0xe5, 0xd6, 0xe9};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "]\193c\STX\r\223\249r\ETXZ\v\aN1\DEL\172q\RS\210\169\176i\147\FS\191\181\200Vk%",
// _password = Just "\150\212\ESC\162~(\188%\191\133\243l", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 9661, _connID = "l\v\146\230\194\DC4X\149\219\171 \169y\188\176\&4\144O", _properties = [PropPayloadFormatIndicator
// 189,PropReasonString "M\159k\191]\152\DC3\243f\228_\149",PropRequestResponseInformation 79,PropServerReference
// "B\153\206\149l\229\147\&5\129}\188}=\238\161-\215\129\145\209G\254\234\190\205A\206\&9h",PropTopicAlias
// 21199,PropMaximumPacketSize 7621,PropMessageExpiryInterval 13332,PropSubscriptionIdentifierAvailable
// 210,PropServerKeepAlive 11594,PropTopicAlias 3010,PropAuthenticationData
// "\183J\162f.\243/\ETB?\156E\195",PropTopicAlias 14998,PropMaximumQoS 58,PropMessageExpiryInterval
// 12903,PropSubscriptionIdentifier 6,PropReceiveMaximum 9744,PropUserProperty "pW\173~e"
// "\239\200U]\144\250n\239",PropServerKeepAlive 17303,PropWildcardSubscriptionAvailable 253,PropMaximumPacketSize
// 17305,PropWildcardSubscriptionAvailable 226,PropAssignedClientIdentifier
// "p\235\135\211\138\NUL\179L\187Z\240\152\227\190\222\f\237\SOH\CAN\135\n\213q\251/\223\219"]}
TEST(Connect5QCTest, Encode46) {
  uint8_t pkt[] = {
      0x10, 0xf0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x25, 0xbd, 0xa2, 0x1,  0x1,  0xbd, 0x1f, 0x0,
      0xc,  0x4d, 0x9f, 0x6b, 0xbf, 0x5d, 0x98, 0x13, 0xf3, 0x66, 0xe4, 0x5f, 0x95, 0x19, 0x4f, 0x1c, 0x0,  0x1d, 0x42,
      0x99, 0xce, 0x95, 0x6c, 0xe5, 0x93, 0x35, 0x81, 0x7d, 0xbc, 0x7d, 0x3d, 0xee, 0xa1, 0x2d, 0xd7, 0x81, 0x91, 0xd1,
      0x47, 0xfe, 0xea, 0xbe, 0xcd, 0x41, 0xce, 0x39, 0x68, 0x23, 0x52, 0xcf, 0x27, 0x0,  0x0,  0x1d, 0xc5, 0x2,  0x0,
      0x0,  0x34, 0x14, 0x29, 0xd2, 0x13, 0x2d, 0x4a, 0x23, 0xb,  0xc2, 0x16, 0x0,  0xc,  0xb7, 0x4a, 0xa2, 0x66, 0x2e,
      0xf3, 0x2f, 0x17, 0x3f, 0x9c, 0x45, 0xc3, 0x23, 0x3a, 0x96, 0x24, 0x3a, 0x2,  0x0,  0x0,  0x32, 0x67, 0xb,  0x6,
      0x21, 0x26, 0x10, 0x26, 0x0,  0x5,  0x70, 0x57, 0xad, 0x7e, 0x65, 0x0,  0x8,  0xef, 0xc8, 0x55, 0x5d, 0x90, 0xfa,
      0x6e, 0xef, 0x13, 0x43, 0x97, 0x28, 0xfd, 0x27, 0x0,  0x0,  0x43, 0x99, 0x28, 0xe2, 0x12, 0x0,  0x1b, 0x70, 0xeb,
      0x87, 0xd3, 0x8a, 0x0,  0xb3, 0x4c, 0xbb, 0x5a, 0xf0, 0x98, 0xe3, 0xbe, 0xde, 0xc,  0xed, 0x1,  0x18, 0x87, 0xa,
      0xd5, 0x71, 0xfb, 0x2f, 0xdf, 0xdb, 0x0,  0x12, 0x6c, 0xb,  0x92, 0xe6, 0xc2, 0x14, 0x58, 0x95, 0xdb, 0xab, 0x20,
      0xa9, 0x79, 0xbc, 0xb0, 0x34, 0x90, 0x4f, 0x0,  0x1e, 0x5d, 0xc1, 0x63, 0x2,  0xd,  0xdf, 0xf9, 0x72, 0x3,  0x5a,
      0xb,  0x7,  0x4e, 0x31, 0x7f, 0xac, 0x71, 0x1e, 0xd2, 0xa9, 0xb0, 0x69, 0x93, 0x1c, 0xbf, 0xb5, 0xc8, 0x56, 0x6b,
      0x25, 0x0,  0xc,  0x96, 0xd4, 0x1b, 0xa2, 0x7e, 0x28, 0xbc, 0x25, 0xbf, 0x85, 0xf3, 0x6c};

  uint8_t buf[253] = {0};

  uint8_t bytesprops0[] = {0x4d, 0x9f, 0x6b, 0xbf, 0x5d, 0x98, 0x13, 0xf3, 0x66, 0xe4, 0x5f, 0x95};
  uint8_t bytesprops1[] = {0x42, 0x99, 0xce, 0x95, 0x6c, 0xe5, 0x93, 0x35, 0x81, 0x7d, 0xbc, 0x7d, 0x3d, 0xee, 0xa1,
                           0x2d, 0xd7, 0x81, 0x91, 0xd1, 0x47, 0xfe, 0xea, 0xbe, 0xcd, 0x41, 0xce, 0x39, 0x68};
  uint8_t bytesprops2[] = {0xb7, 0x4a, 0xa2, 0x66, 0x2e, 0xf3, 0x2f, 0x17, 0x3f, 0x9c, 0x45, 0xc3};
  uint8_t bytesprops4[] = {0xef, 0xc8, 0x55, 0x5d, 0x90, 0xfa, 0x6e, 0xef};
  uint8_t bytesprops3[] = {0x70, 0x57, 0xad, 0x7e, 0x65};
  uint8_t bytesprops5[] = {0x70, 0xeb, 0x87, 0xd3, 0x8a, 0x0,  0xb3, 0x4c, 0xbb, 0x5a, 0xf0, 0x98, 0xe3, 0xbe,
                           0xde, 0xc,  0xed, 0x1,  0x18, 0x87, 0xa,  0xd5, 0x71, 0xfb, 0x2f, 0xdf, 0xdb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21199}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7621}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13332}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11594}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3010}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14998}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12903}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9744}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops3}, .v = {8, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17303}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17305}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9661;
  uint8_t client_id_bytes[] = {0x6c, 0xb,  0x92, 0xe6, 0xc2, 0x14, 0x58, 0x95, 0xdb,
                               0xab, 0x20, 0xa9, 0x79, 0xbc, 0xb0, 0x34, 0x90, 0x4f};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0xc1, 0x63, 0x2,  0xd,  0xdf, 0xf9, 0x72, 0x3,  0x5a, 0xb,  0x7,  0x4e, 0x31, 0x7f,
                              0xac, 0x71, 0x1e, 0xd2, 0xa9, 0xb0, 0x69, 0x93, 0x1c, 0xbf, 0xb5, 0xc8, 0x56, 0x6b, 0x25};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0xd4, 0x1b, 0xa2, 0x7e, 0x28, 0xbc, 0x25, 0xbf, 0x85, 0xf3, 0x6c};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "HK\160A\236!\215\217", _password = Just "\172", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "_#", _willMsg = "}\199!\254\224\b\154\&2\232\184\163\213?\186",
// _willProps = [PropMaximumPacketSize 11544,PropReasonString
// "\231e\251\t\139\&1\227z\t5}\242Y\188\ENQ\255\189\200\241\216e\227\223",PropWillDelayInterval
// 27907,PropAuthenticationMethod "\253Uz>\225\f",PropContentType
// "\148\161\201\DEL$\165\167<:\208AZx%\246\255\133\231\173\193\ENQ\181\169\208\US\182\136\215\196",PropSubscriptionIdentifier
// 30,PropReasonString "u\241\SOO\DC1\153\199Z",PropRequestProblemInformation 103,PropPayloadFormatIndicator
// 43,PropRequestResponseInformation 227,PropPayloadFormatIndicator 40,PropResponseTopic
// "e{M\164\STX\240\225$\188\202\145\149\133p<\203\241\168o\133s\130\CAN\154\r\220\178\227\194",PropTopicAlias
// 7,PropTopicAlias 23134,PropRetainAvailable 141,PropTopicAlias 30201,PropTopicAliasMaximum 1945,PropTopicAlias
// 7974,PropUserProperty "\DLE\219\236\SI\253\233\rA"
// "\143&{H\171\&0q\SUBc\139\t6\US\231Hp\186\228\182",PropAuthenticationData
// "\196g\208\248\n",PropRequestResponseInformation 36,PropServerKeepAlive 10008,PropTopicAlias 13108]}), _cleanSession
// = True, _keepAlive = 8375, _connID = "{iE\207H\USn\DLE\193\b\245\216JK", _properties = [PropSessionExpiryInterval
// 19323,PropMessageExpiryInterval 30707,PropTopicAliasMaximum 25463,PropAuthenticationMethod
// "\157\190\201\186\DLE/\142\ESC\\\197\235\173\244\130\176\152"]}
TEST(Connect5QCTest, Encode47) {
  uint8_t pkt[] = {
      0x10, 0xa1, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x20, 0xb7, 0x20, 0x11, 0x0,  0x0,  0x4b, 0x7b,
      0x2,  0x0,  0x0,  0x77, 0xf3, 0x22, 0x63, 0x77, 0x15, 0x0,  0x10, 0x9d, 0xbe, 0xc9, 0xba, 0x10, 0x2f, 0x8e, 0x1b,
      0x5c, 0xc5, 0xeb, 0xad, 0xf4, 0x82, 0xb0, 0x98, 0x0,  0xe,  0x7b, 0x69, 0x45, 0xcf, 0x48, 0x1f, 0x6e, 0x10, 0xc1,
      0x8,  0xf5, 0xd8, 0x4a, 0x4b, 0xc3, 0x1,  0x27, 0x0,  0x0,  0x2d, 0x18, 0x1f, 0x0,  0x17, 0xe7, 0x65, 0xfb, 0x9,
      0x8b, 0x31, 0xe3, 0x7a, 0x9,  0x35, 0x7d, 0xf2, 0x59, 0xbc, 0x5,  0xff, 0xbd, 0xc8, 0xf1, 0xd8, 0x65, 0xe3, 0xdf,
      0x18, 0x0,  0x0,  0x6d, 0x3,  0x15, 0x0,  0x6,  0xfd, 0x55, 0x7a, 0x3e, 0xe1, 0xc,  0x3,  0x0,  0x1d, 0x94, 0xa1,
      0xc9, 0x7f, 0x24, 0xa5, 0xa7, 0x3c, 0x3a, 0xd0, 0x41, 0x5a, 0x78, 0x25, 0xf6, 0xff, 0x85, 0xe7, 0xad, 0xc1, 0x5,
      0xb5, 0xa9, 0xd0, 0x1f, 0xb6, 0x88, 0xd7, 0xc4, 0xb,  0x1e, 0x1f, 0x0,  0x8,  0x75, 0xf1, 0xe,  0x4f, 0x11, 0x99,
      0xc7, 0x5a, 0x17, 0x67, 0x1,  0x2b, 0x19, 0xe3, 0x1,  0x28, 0x8,  0x0,  0x1d, 0x65, 0x7b, 0x4d, 0xa4, 0x2,  0xf0,
      0xe1, 0x24, 0xbc, 0xca, 0x91, 0x95, 0x85, 0x70, 0x3c, 0xcb, 0xf1, 0xa8, 0x6f, 0x85, 0x73, 0x82, 0x18, 0x9a, 0xd,
      0xdc, 0xb2, 0xe3, 0xc2, 0x23, 0x0,  0x7,  0x23, 0x5a, 0x5e, 0x25, 0x8d, 0x23, 0x75, 0xf9, 0x22, 0x7,  0x99, 0x23,
      0x1f, 0x26, 0x26, 0x0,  0x8,  0x10, 0xdb, 0xec, 0xf,  0xfd, 0xe9, 0xd,  0x41, 0x0,  0x13, 0x8f, 0x26, 0x7b, 0x48,
      0xab, 0x30, 0x71, 0x1a, 0x63, 0x8b, 0x9,  0x36, 0x1f, 0xe7, 0x48, 0x70, 0xba, 0xe4, 0xb6, 0x16, 0x0,  0x5,  0xc4,
      0x67, 0xd0, 0xf8, 0xa,  0x19, 0x24, 0x13, 0x27, 0x18, 0x23, 0x33, 0x34, 0x0,  0x2,  0x5f, 0x23, 0x0,  0xe,  0x7d,
      0xc7, 0x21, 0xfe, 0xe0, 0x8,  0x9a, 0x32, 0xe8, 0xb8, 0xa3, 0xd5, 0x3f, 0xba, 0x0,  0x8,  0x48, 0x4b, 0xa0, 0x41,
      0xec, 0x21, 0xd7, 0xd9, 0x0,  0x1,  0xac};

  uint8_t buf[302] = {0};

  uint8_t bytesprops0[] = {0x9d, 0xbe, 0xc9, 0xba, 0x10, 0x2f, 0x8e, 0x1b,
                           0x5c, 0xc5, 0xeb, 0xad, 0xf4, 0x82, 0xb0, 0x98};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19323}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30707}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25463}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe7, 0x65, 0xfb, 0x9,  0x8b, 0x31, 0xe3, 0x7a, 0x9,  0x35, 0x7d, 0xf2,
                               0x59, 0xbc, 0x5,  0xff, 0xbd, 0xc8, 0xf1, 0xd8, 0x65, 0xe3, 0xdf};
  uint8_t byteswillprops1[] = {0xfd, 0x55, 0x7a, 0x3e, 0xe1, 0xc};
  uint8_t byteswillprops2[] = {0x94, 0xa1, 0xc9, 0x7f, 0x24, 0xa5, 0xa7, 0x3c, 0x3a, 0xd0, 0x41, 0x5a, 0x78, 0x25, 0xf6,
                               0xff, 0x85, 0xe7, 0xad, 0xc1, 0x5,  0xb5, 0xa9, 0xd0, 0x1f, 0xb6, 0x88, 0xd7, 0xc4};
  uint8_t byteswillprops3[] = {0x75, 0xf1, 0xe, 0x4f, 0x11, 0x99, 0xc7, 0x5a};
  uint8_t byteswillprops4[] = {0x65, 0x7b, 0x4d, 0xa4, 0x2,  0xf0, 0xe1, 0x24, 0xbc, 0xca, 0x91, 0x95, 0x85, 0x70, 0x3c,
                               0xcb, 0xf1, 0xa8, 0x6f, 0x85, 0x73, 0x82, 0x18, 0x9a, 0xd,  0xdc, 0xb2, 0xe3, 0xc2};
  uint8_t byteswillprops6[] = {0x8f, 0x26, 0x7b, 0x48, 0xab, 0x30, 0x71, 0x1a, 0x63, 0x8b,
                               0x9,  0x36, 0x1f, 0xe7, 0x48, 0x70, 0xba, 0xe4, 0xb6};
  uint8_t byteswillprops5[] = {0x10, 0xdb, 0xec, 0xf, 0xfd, 0xe9, 0xd, 0x41};
  uint8_t byteswillprops7[] = {0xc4, 0x67, 0xd0, 0xf8, 0xa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11544}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27907}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23134}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30201}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1945}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7974}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops5}, .v = {19, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10008}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13108}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0x23};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7d, 0xc7, 0x21, 0xfe, 0xe0, 0x8, 0x9a, 0x32, 0xe8, 0xb8, 0xa3, 0xd5, 0x3f, 0xba};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8375;
  uint8_t client_id_bytes[] = {0x7b, 0x69, 0x45, 0xcf, 0x48, 0x1f, 0x6e, 0x10, 0xc1, 0x8, 0xf5, 0xd8, 0x4a, 0x4b};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x48, 0x4b, 0xa0, 0x41, 0xec, 0x21, 0xd7, 0xd9};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xac};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "s\249\NAK\192\197\&1\198#\180\SOH2\136\150\183B\199\209W@\DC3a\DLE\246\148\187\246\"", _password = Just
// "\224\236\147\252C\148\166\DEL\185\157\241m\242\132\SO\\q", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "\tqP", _willMsg = "o\SO.\159", _willProps = [PropMessageExpiryInterval
// 21061,PropAuthenticationData "\178\US",PropSessionExpiryInterval 26010,PropResponseInformation
// "\DC3\243?$s\DC1\135`\155.k\DC48\210\194F\244",PropSubscriptionIdentifierAvailable
// 219,PropSharedSubscriptionAvailable 247,PropTopicAlias 13806,PropWildcardSubscriptionAvailable 35,PropUserProperty
// "\157\239@x2\153?"
// "Q\167\227\&6\140Vgv\217\143\141\192D\225\201d\SI,o-\ESC\129[\182J\NAK;\146\222l",PropAuthenticationData
// "m7\245\161\140\163\139mF\188B\206\FS]\229\236u<\175 ",PropRetainAvailable 189,PropCorrelationData
// "\254y5AEL\136+\160\141\158\US\\\154\EOT}4;\207\156 \182\161M\216\172\160u\f\206",PropRequestResponseInformation
// 247,PropResponseTopic "\166\228s+W\165\ACK\243W\217s\a\189",PropWildcardSubscriptionAvailable 143,PropReceiveMaximum
// 11329,PropTopicAlias 5333,PropPayloadFormatIndicator 101,PropAssignedClientIdentifier
// "6\NAK\233\154",PropSessionExpiryInterval 5547,PropRetainAvailable 76,PropResponseTopic
// "\240\200uo\250\ESC\209\n\198\r\230\ETB\DC13\137\209\EMj?\227\179",PropResponseTopic
// "\215\153\GS\224\140\ACKr3Y\204.kT9\255\&0\150\134uQY\NUL\211\198\r\v\tzt\164",PropRetainAvailable
// 69,PropAuthenticationMethod "0\254\&7",PropAuthenticationData
// "]\202&\165\174\&4\184\&0\STX\DC4\151\GS\135\170\154\213\151&",PropContentType
// "\242\DC2\DLE\219\211\187\195\175\254n{K\ENQ\238\168\186\DEL\212IL\163Y\138"]}), _cleanSession = False, _keepAlive =
// 1422, _connID = "\184\233(\195\247\\\DC28i\FSj\135", _properties = [PropSessionExpiryInterval
// 19012,PropCorrelationData "}${\157\222to\135\t\DLE=]\213\219 \n\244LBsV",PropPayloadFormatIndicator
// 171,PropSubscriptionIdentifierAvailable 85,PropSharedSubscriptionAvailable 79,PropCorrelationData
// "sO{\173\150\226~\250\213\168\\;\216ST",PropAuthenticationMethod "K",PropWillDelayInterval
// 18157,PropAuthenticationData "\SYN\EM\141\150<\ETX\250\231\DEL",PropRequestResponseInformation
// 56,PropMaximumPacketSize 28986,PropSharedSubscriptionAvailable 227,PropMaximumPacketSize 9042,PropResponseInformation
// "\212\FS\STXB\210 (\182\251\a*\238*V~\199`\214\248\GS\198\170\FS\246\234)\253"]}
TEST(Connect5QCTest, Encode48) {
  uint8_t pkt[] = {
      0x10, 0xf6, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x5,  0x8e, 0x76, 0x11, 0x0,  0x0,  0x4a, 0x44,
      0x9,  0x0,  0x15, 0x7d, 0x24, 0x7b, 0x9d, 0xde, 0x74, 0x6f, 0x87, 0x9,  0x10, 0x3d, 0x5d, 0xd5, 0xdb, 0x20, 0xa,
      0xf4, 0x4c, 0x42, 0x73, 0x56, 0x1,  0xab, 0x29, 0x55, 0x2a, 0x4f, 0x9,  0x0,  0xf,  0x73, 0x4f, 0x7b, 0xad, 0x96,
      0xe2, 0x7e, 0xfa, 0xd5, 0xa8, 0x5c, 0x3b, 0xd8, 0x53, 0x54, 0x15, 0x0,  0x1,  0x4b, 0x18, 0x0,  0x0,  0x46, 0xed,
      0x16, 0x0,  0x9,  0x16, 0x19, 0x8d, 0x96, 0x3c, 0x3,  0xfa, 0xe7, 0x7f, 0x19, 0x38, 0x27, 0x0,  0x0,  0x71, 0x3a,
      0x2a, 0xe3, 0x27, 0x0,  0x0,  0x23, 0x52, 0x1a, 0x0,  0x1b, 0xd4, 0x1c, 0x2,  0x42, 0xd2, 0x20, 0x28, 0xb6, 0xfb,
      0x7,  0x2a, 0xee, 0x2a, 0x56, 0x7e, 0xc7, 0x60, 0xd6, 0xf8, 0x1d, 0xc6, 0xaa, 0x1c, 0xf6, 0xea, 0x29, 0xfd, 0x0,
      0xc,  0xb8, 0xe9, 0x28, 0xc3, 0xf7, 0x5c, 0x12, 0x38, 0x69, 0x1c, 0x6a, 0x87, 0xaa, 0x2,  0x2,  0x0,  0x0,  0x52,
      0x45, 0x16, 0x0,  0x2,  0xb2, 0x1f, 0x11, 0x0,  0x0,  0x65, 0x9a, 0x1a, 0x0,  0x11, 0x13, 0xf3, 0x3f, 0x24, 0x73,
      0x11, 0x87, 0x60, 0x9b, 0x2e, 0x6b, 0x14, 0x38, 0xd2, 0xc2, 0x46, 0xf4, 0x29, 0xdb, 0x2a, 0xf7, 0x23, 0x35, 0xee,
      0x28, 0x23, 0x26, 0x0,  0x7,  0x9d, 0xef, 0x40, 0x78, 0x32, 0x99, 0x3f, 0x0,  0x1e, 0x51, 0xa7, 0xe3, 0x36, 0x8c,
      0x56, 0x67, 0x76, 0xd9, 0x8f, 0x8d, 0xc0, 0x44, 0xe1, 0xc9, 0x64, 0xf,  0x2c, 0x6f, 0x2d, 0x1b, 0x81, 0x5b, 0xb6,
      0x4a, 0x15, 0x3b, 0x92, 0xde, 0x6c, 0x16, 0x0,  0x14, 0x6d, 0x37, 0xf5, 0xa1, 0x8c, 0xa3, 0x8b, 0x6d, 0x46, 0xbc,
      0x42, 0xce, 0x1c, 0x5d, 0xe5, 0xec, 0x75, 0x3c, 0xaf, 0x20, 0x25, 0xbd, 0x9,  0x0,  0x1e, 0xfe, 0x79, 0x35, 0x41,
      0x45, 0x4c, 0x88, 0x2b, 0xa0, 0x8d, 0x9e, 0x1f, 0x5c, 0x9a, 0x4,  0x7d, 0x34, 0x3b, 0xcf, 0x9c, 0x20, 0xb6, 0xa1,
      0x4d, 0xd8, 0xac, 0xa0, 0x75, 0xc,  0xce, 0x19, 0xf7, 0x8,  0x0,  0xd,  0xa6, 0xe4, 0x73, 0x2b, 0x57, 0xa5, 0x6,
      0xf3, 0x57, 0xd9, 0x73, 0x7,  0xbd, 0x28, 0x8f, 0x21, 0x2c, 0x41, 0x23, 0x14, 0xd5, 0x1,  0x65, 0x12, 0x0,  0x4,
      0x36, 0x15, 0xe9, 0x9a, 0x11, 0x0,  0x0,  0x15, 0xab, 0x25, 0x4c, 0x8,  0x0,  0x15, 0xf0, 0xc8, 0x75, 0x6f, 0xfa,
      0x1b, 0xd1, 0xa,  0xc6, 0xd,  0xe6, 0x17, 0x11, 0x33, 0x89, 0xd1, 0x19, 0x6a, 0x3f, 0xe3, 0xb3, 0x8,  0x0,  0x1e,
      0xd7, 0x99, 0x1d, 0xe0, 0x8c, 0x6,  0x72, 0x33, 0x59, 0xcc, 0x2e, 0x6b, 0x54, 0x39, 0xff, 0x30, 0x96, 0x86, 0x75,
      0x51, 0x59, 0x0,  0xd3, 0xc6, 0xd,  0xb,  0x9,  0x7a, 0x74, 0xa4, 0x25, 0x45, 0x15, 0x0,  0x3,  0x30, 0xfe, 0x37,
      0x16, 0x0,  0x12, 0x5d, 0xca, 0x26, 0xa5, 0xae, 0x34, 0xb8, 0x30, 0x2,  0x14, 0x97, 0x1d, 0x87, 0xaa, 0x9a, 0xd5,
      0x97, 0x26, 0x3,  0x0,  0x17, 0xf2, 0x12, 0x10, 0xdb, 0xd3, 0xbb, 0xc3, 0xaf, 0xfe, 0x6e, 0x7b, 0x4b, 0x5,  0xee,
      0xa8, 0xba, 0x7f, 0xd4, 0x49, 0x4c, 0xa3, 0x59, 0x8a, 0x0,  0x3,  0x9,  0x71, 0x50, 0x0,  0x4,  0x6f, 0xe,  0x2e,
      0x9f, 0x0,  0x1b, 0x73, 0xf9, 0x15, 0xc0, 0xc5, 0x31, 0xc6, 0x23, 0xb4, 0x1,  0x32, 0x88, 0x96, 0xb7, 0x42, 0xc7,
      0xd1, 0x57, 0x40, 0x13, 0x61, 0x10, 0xf6, 0x94, 0xbb, 0xf6, 0x22, 0x0,  0x11, 0xe0, 0xec, 0x93, 0xfc, 0x43, 0x94,
      0xa6, 0x7f, 0xb9, 0x9d, 0xf1, 0x6d, 0xf2, 0x84, 0xe,  0x5c, 0x71};

  uint8_t buf[515] = {0};

  uint8_t bytesprops0[] = {0x7d, 0x24, 0x7b, 0x9d, 0xde, 0x74, 0x6f, 0x87, 0x9,  0x10, 0x3d,
                           0x5d, 0xd5, 0xdb, 0x20, 0xa,  0xf4, 0x4c, 0x42, 0x73, 0x56};
  uint8_t bytesprops1[] = {0x73, 0x4f, 0x7b, 0xad, 0x96, 0xe2, 0x7e, 0xfa, 0xd5, 0xa8, 0x5c, 0x3b, 0xd8, 0x53, 0x54};
  uint8_t bytesprops2[] = {0x4b};
  uint8_t bytesprops3[] = {0x16, 0x19, 0x8d, 0x96, 0x3c, 0x3, 0xfa, 0xe7, 0x7f};
  uint8_t bytesprops4[] = {0xd4, 0x1c, 0x2,  0x42, 0xd2, 0x20, 0x28, 0xb6, 0xfb, 0x7,  0x2a, 0xee, 0x2a, 0x56,
                           0x7e, 0xc7, 0x60, 0xd6, 0xf8, 0x1d, 0xc6, 0xaa, 0x1c, 0xf6, 0xea, 0x29, 0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19012}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18157}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28986}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9042}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb2, 0x1f};
  uint8_t byteswillprops1[] = {0x13, 0xf3, 0x3f, 0x24, 0x73, 0x11, 0x87, 0x60, 0x9b,
                               0x2e, 0x6b, 0x14, 0x38, 0xd2, 0xc2, 0x46, 0xf4};
  uint8_t byteswillprops3[] = {0x51, 0xa7, 0xe3, 0x36, 0x8c, 0x56, 0x67, 0x76, 0xd9, 0x8f,
                               0x8d, 0xc0, 0x44, 0xe1, 0xc9, 0x64, 0xf,  0x2c, 0x6f, 0x2d,
                               0x1b, 0x81, 0x5b, 0xb6, 0x4a, 0x15, 0x3b, 0x92, 0xde, 0x6c};
  uint8_t byteswillprops2[] = {0x9d, 0xef, 0x40, 0x78, 0x32, 0x99, 0x3f};
  uint8_t byteswillprops4[] = {0x6d, 0x37, 0xf5, 0xa1, 0x8c, 0xa3, 0x8b, 0x6d, 0x46, 0xbc,
                               0x42, 0xce, 0x1c, 0x5d, 0xe5, 0xec, 0x75, 0x3c, 0xaf, 0x20};
  uint8_t byteswillprops5[] = {0xfe, 0x79, 0x35, 0x41, 0x45, 0x4c, 0x88, 0x2b, 0xa0, 0x8d,
                               0x9e, 0x1f, 0x5c, 0x9a, 0x4,  0x7d, 0x34, 0x3b, 0xcf, 0x9c,
                               0x20, 0xb6, 0xa1, 0x4d, 0xd8, 0xac, 0xa0, 0x75, 0xc,  0xce};
  uint8_t byteswillprops6[] = {0xa6, 0xe4, 0x73, 0x2b, 0x57, 0xa5, 0x6, 0xf3, 0x57, 0xd9, 0x73, 0x7, 0xbd};
  uint8_t byteswillprops7[] = {0x36, 0x15, 0xe9, 0x9a};
  uint8_t byteswillprops8[] = {0xf0, 0xc8, 0x75, 0x6f, 0xfa, 0x1b, 0xd1, 0xa,  0xc6, 0xd, 0xe6,
                               0x17, 0x11, 0x33, 0x89, 0xd1, 0x19, 0x6a, 0x3f, 0xe3, 0xb3};
  uint8_t byteswillprops9[] = {0xd7, 0x99, 0x1d, 0xe0, 0x8c, 0x6,  0x72, 0x33, 0x59, 0xcc,
                               0x2e, 0x6b, 0x54, 0x39, 0xff, 0x30, 0x96, 0x86, 0x75, 0x51,
                               0x59, 0x0,  0xd3, 0xc6, 0xd,  0xb,  0x9,  0x7a, 0x74, 0xa4};
  uint8_t byteswillprops10[] = {0x30, 0xfe, 0x37};
  uint8_t byteswillprops11[] = {0x5d, 0xca, 0x26, 0xa5, 0xae, 0x34, 0xb8, 0x30, 0x2,
                                0x14, 0x97, 0x1d, 0x87, 0xaa, 0x9a, 0xd5, 0x97, 0x26};
  uint8_t byteswillprops12[] = {0xf2, 0x12, 0x10, 0xdb, 0xd3, 0xbb, 0xc3, 0xaf, 0xfe, 0x6e, 0x7b, 0x4b,
                                0x5,  0xee, 0xa8, 0xba, 0x7f, 0xd4, 0x49, 0x4c, 0xa3, 0x59, 0x8a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21061}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26010}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13806}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops2}, .v = {30, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11329}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5333}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5547}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9, 0x71, 0x50};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6f, 0xe, 0x2e, 0x9f};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1422;
  uint8_t client_id_bytes[] = {0xb8, 0xe9, 0x28, 0xc3, 0xf7, 0x5c, 0x12, 0x38, 0x69, 0x1c, 0x6a, 0x87};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x73, 0xf9, 0x15, 0xc0, 0xc5, 0x31, 0xc6, 0x23, 0xb4, 0x1,  0x32, 0x88, 0x96, 0xb7,
                              0x42, 0xc7, 0xd1, 0x57, 0x40, 0x13, 0x61, 0x10, 0xf6, 0x94, 0xbb, 0xf6, 0x22};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xec, 0x93, 0xfc, 0x43, 0x94, 0xa6, 0x7f, 0xb9,
                              0x9d, 0xf1, 0x6d, 0xf2, 0x84, 0xe,  0x5c, 0x71};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\ESC-v\215\228\195+\251.F6\r\221\213nfx\221", _password = Just "\193\152",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 20170, _connID =
// "9\b4\231\247\150H\ETB\GS\236t\185o\189\144\173\203P\207z\173", _properties = [PropCorrelationData
// "F\236\180\232z\241\217\234\140\167;!48\149a\223",PropAuthenticationMethod
// "\t\181U",PropSubscriptionIdentifierAvailable 40,PropRequestProblemInformation 170,PropAuthenticationData
// "\142\ACK\147",PropRetainAvailable 16,PropMaximumPacketSize 20456,PropResponseTopic "\183",PropReceiveMaximum
// 30861,PropUserProperty "U!\207\165\163?\140e\168=\245\200cQ\234\229\197\194\160\CAN\169"
// "\159_)h;\197\250G\189\223OS\EOT\153\160\209\200\153",PropMaximumPacketSize 27921,PropWillDelayInterval
// 24764,PropTopicAlias 621,PropMaximumPacketSize 8044,PropResponseTopic "",PropMaximumQoS 234,PropUserProperty
// "\231d\ESCy\SYN\254<@&\209\\\188j\236I\179\182m\154"
// "@\RS9cX\252\v\243\167?U9V\235o\248\224]\SO\194\237\228N\218\&6\ACK\DC2\US\224\207",PropUserProperty
// "R\163U\EOT\159\EM\b?\207?\ESC\222\DELl\249\DC1\172j"
// "\213\f\186V\199\t\240g\133\170\249\153\181\t`x<\254\153\198~<ky\250\218=\132~\167",PropMaximumQoS
// 160,PropAuthenticationMethod "O\143;\193\v\141\182\244\SUB\DC4\157\255\139",PropServerKeepAlive
// 18779,PropSubscriptionIdentifierAvailable 27,PropSubscriptionIdentifierAvailable 200]}
TEST(Connect5QCTest, Encode49) {
  uint8_t pkt[] = {
      0x10, 0xb5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x4e, 0xca, 0xf9, 0x1,  0x9,  0x0,  0x11, 0x46,
      0xec, 0xb4, 0xe8, 0x7a, 0xf1, 0xd9, 0xea, 0x8c, 0xa7, 0x3b, 0x21, 0x34, 0x38, 0x95, 0x61, 0xdf, 0x15, 0x0,  0x3,
      0x9,  0xb5, 0x55, 0x29, 0x28, 0x17, 0xaa, 0x16, 0x0,  0x3,  0x8e, 0x6,  0x93, 0x25, 0x10, 0x27, 0x0,  0x0,  0x4f,
      0xe8, 0x8,  0x0,  0x1,  0xb7, 0x21, 0x78, 0x8d, 0x26, 0x0,  0x15, 0x55, 0x21, 0xcf, 0xa5, 0xa3, 0x3f, 0x8c, 0x65,
      0xa8, 0x3d, 0xf5, 0xc8, 0x63, 0x51, 0xea, 0xe5, 0xc5, 0xc2, 0xa0, 0x18, 0xa9, 0x0,  0x12, 0x9f, 0x5f, 0x29, 0x68,
      0x3b, 0xc5, 0xfa, 0x47, 0xbd, 0xdf, 0x4f, 0x53, 0x4,  0x99, 0xa0, 0xd1, 0xc8, 0x99, 0x27, 0x0,  0x0,  0x6d, 0x11,
      0x18, 0x0,  0x0,  0x60, 0xbc, 0x23, 0x2,  0x6d, 0x27, 0x0,  0x0,  0x1f, 0x6c, 0x8,  0x0,  0x0,  0x24, 0xea, 0x26,
      0x0,  0x13, 0xe7, 0x64, 0x1b, 0x79, 0x16, 0xfe, 0x3c, 0x40, 0x26, 0xd1, 0x5c, 0xbc, 0x6a, 0xec, 0x49, 0xb3, 0xb6,
      0x6d, 0x9a, 0x0,  0x1e, 0x40, 0x1e, 0x39, 0x63, 0x58, 0xfc, 0xb,  0xf3, 0xa7, 0x3f, 0x55, 0x39, 0x56, 0xeb, 0x6f,
      0xf8, 0xe0, 0x5d, 0xe,  0xc2, 0xed, 0xe4, 0x4e, 0xda, 0x36, 0x6,  0x12, 0x1f, 0xe0, 0xcf, 0x26, 0x0,  0x12, 0x52,
      0xa3, 0x55, 0x4,  0x9f, 0x19, 0x8,  0x3f, 0xcf, 0x3f, 0x1b, 0xde, 0x7f, 0x6c, 0xf9, 0x11, 0xac, 0x6a, 0x0,  0x1e,
      0xd5, 0xc,  0xba, 0x56, 0xc7, 0x9,  0xf0, 0x67, 0x85, 0xaa, 0xf9, 0x99, 0xb5, 0x9,  0x60, 0x78, 0x3c, 0xfe, 0x99,
      0xc6, 0x7e, 0x3c, 0x6b, 0x79, 0xfa, 0xda, 0x3d, 0x84, 0x7e, 0xa7, 0x24, 0xa0, 0x15, 0x0,  0xd,  0x4f, 0x8f, 0x3b,
      0xc1, 0xb,  0x8d, 0xb6, 0xf4, 0x1a, 0x14, 0x9d, 0xff, 0x8b, 0x13, 0x49, 0x5b, 0x29, 0x1b, 0x29, 0xc8, 0x0,  0x15,
      0x39, 0x8,  0x34, 0xe7, 0xf7, 0x96, 0x48, 0x17, 0x1d, 0xec, 0x74, 0xb9, 0x6f, 0xbd, 0x90, 0xad, 0xcb, 0x50, 0xcf,
      0x7a, 0xad, 0x0,  0x13, 0xcc, 0x1b, 0x2d, 0x76, 0xd7, 0xe4, 0xc3, 0x2b, 0xfb, 0x2e, 0x46, 0x36, 0xd,  0xdd, 0xd5,
      0x6e, 0x66, 0x78, 0xdd, 0x0,  0x2,  0xc1, 0x98};

  uint8_t buf[322] = {0};

  uint8_t bytesprops0[] = {0x46, 0xec, 0xb4, 0xe8, 0x7a, 0xf1, 0xd9, 0xea, 0x8c,
                           0xa7, 0x3b, 0x21, 0x34, 0x38, 0x95, 0x61, 0xdf};
  uint8_t bytesprops1[] = {0x9, 0xb5, 0x55};
  uint8_t bytesprops2[] = {0x8e, 0x6, 0x93};
  uint8_t bytesprops3[] = {0xb7};
  uint8_t bytesprops5[] = {0x9f, 0x5f, 0x29, 0x68, 0x3b, 0xc5, 0xfa, 0x47, 0xbd,
                           0xdf, 0x4f, 0x53, 0x4,  0x99, 0xa0, 0xd1, 0xc8, 0x99};
  uint8_t bytesprops4[] = {0x55, 0x21, 0xcf, 0xa5, 0xa3, 0x3f, 0x8c, 0x65, 0xa8, 0x3d, 0xf5,
                           0xc8, 0x63, 0x51, 0xea, 0xe5, 0xc5, 0xc2, 0xa0, 0x18, 0xa9};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops8[] = {0x40, 0x1e, 0x39, 0x63, 0x58, 0xfc, 0xb,  0xf3, 0xa7, 0x3f, 0x55, 0x39, 0x56, 0xeb, 0x6f,
                           0xf8, 0xe0, 0x5d, 0xe,  0xc2, 0xed, 0xe4, 0x4e, 0xda, 0x36, 0x6,  0x12, 0x1f, 0xe0, 0xcf};
  uint8_t bytesprops7[] = {0xe7, 0x64, 0x1b, 0x79, 0x16, 0xfe, 0x3c, 0x40, 0x26, 0xd1,
                           0x5c, 0xbc, 0x6a, 0xec, 0x49, 0xb3, 0xb6, 0x6d, 0x9a};
  uint8_t bytesprops10[] = {0xd5, 0xc,  0xba, 0x56, 0xc7, 0x9,  0xf0, 0x67, 0x85, 0xaa, 0xf9, 0x99, 0xb5, 0x9,  0x60,
                            0x78, 0x3c, 0xfe, 0x99, 0xc6, 0x7e, 0x3c, 0x6b, 0x79, 0xfa, 0xda, 0x3d, 0x84, 0x7e, 0xa7};
  uint8_t bytesprops9[] = {0x52, 0xa3, 0x55, 0x4,  0x9f, 0x19, 0x8,  0x3f, 0xcf,
                           0x3f, 0x1b, 0xde, 0x7f, 0x6c, 0xf9, 0x11, 0xac, 0x6a};
  uint8_t bytesprops11[] = {0x4f, 0x8f, 0x3b, 0xc1, 0xb, 0x8d, 0xb6, 0xf4, 0x1a, 0x14, 0x9d, 0xff, 0x8b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20456}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30861}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops4}, .v = {18, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27921}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24764}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 621}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8044}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops7}, .v = {30, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops9}, .v = {30, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18779}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 200}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20170;
  uint8_t client_id_bytes[] = {0x39, 0x8,  0x34, 0xe7, 0xf7, 0x96, 0x48, 0x17, 0x1d, 0xec, 0x74,
                               0xb9, 0x6f, 0xbd, 0x90, 0xad, 0xcb, 0x50, 0xcf, 0x7a, 0xad};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x1b, 0x2d, 0x76, 0xd7, 0xe4, 0xc3, 0x2b, 0xfb, 0x2e,
                              0x46, 0x36, 0xd,  0xdd, 0xd5, 0x6e, 0x66, 0x78, 0xdd};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc1, 0x98};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "t\239", _password = Just "\r%\148", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\r\226_c,\248", _willMsg = "\151\168\141\183G\198", _willProps = [PropTopicAlias
// 23303,PropMessageExpiryInterval 13748,PropAssignedClientIdentifier
// "\161\161)\196!\138\248\188)1T<_\200\EOTp\210(\184\207{\169\224\166\237<",PropServerKeepAlive
// 21210,PropAuthenticationData "oH\255hG\130\192\252\v\150\DLE&\202P\203\152\142\158rkI\199;",PropTopicAlias
// 31986,PropServerKeepAlive 25715,PropMaximumPacketSize 23018,PropSubscriptionIdentifier 30]}), _cleanSession = False,
// _keepAlive = 29236, _connID = "\202\219", _properties = [PropContentType "\214\152\169G\220\244",PropReasonString
// "F\242G\195z]\203\234k\157-.\144`y\RS\203\FS#\213Vs\153k>\184\FS\200",PropAuthenticationMethod
// "",PropSubscriptionIdentifier 26,PropAuthenticationMethod "\191\226",PropWildcardSubscriptionAvailable
// 154,PropServerReference "",PropResponseTopic "(\139B\250\208T<\179\DC11*@\130\253\207",PropServerReference
// "+P\254\NUL6\161nD\240l*\144\208\237|\NAK.r\167\&1A\187\FS\210\240\DC4",PropWildcardSubscriptionAvailable
// 163,PropResponseInformation
// "\SUB^?\210\183\138\ESC\ACK\196:\175\181'\215(2\DC1\147\134~@\195\252\DC3xA.",PropServerReference ";\242\218"]}
TEST(Connect5QCTest, Encode50) {
  uint8_t pkt[] = {
      0x10, 0x85, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x72, 0x34, 0x8c, 0x1,  0x3,  0x0,  0x6,  0xd6,
      0x98, 0xa9, 0x47, 0xdc, 0xf4, 0x1f, 0x0,  0x1c, 0x46, 0xf2, 0x47, 0xc3, 0x7a, 0x5d, 0xcb, 0xea, 0x6b, 0x9d, 0x2d,
      0x2e, 0x90, 0x60, 0x79, 0x1e, 0xcb, 0x1c, 0x23, 0xd5, 0x56, 0x73, 0x99, 0x6b, 0x3e, 0xb8, 0x1c, 0xc8, 0x15, 0x0,
      0x0,  0xb,  0x1a, 0x15, 0x0,  0x2,  0xbf, 0xe2, 0x28, 0x9a, 0x1c, 0x0,  0x0,  0x8,  0x0,  0xf,  0x28, 0x8b, 0x42,
      0xfa, 0xd0, 0x54, 0x3c, 0xb3, 0x11, 0x31, 0x2a, 0x40, 0x82, 0xfd, 0xcf, 0x1c, 0x0,  0x1a, 0x2b, 0x50, 0xfe, 0x0,
      0x36, 0xa1, 0x6e, 0x44, 0xf0, 0x6c, 0x2a, 0x90, 0xd0, 0xed, 0x7c, 0x15, 0x2e, 0x72, 0xa7, 0x31, 0x41, 0xbb, 0x1c,
      0xd2, 0xf0, 0x14, 0x28, 0xa3, 0x1a, 0x0,  0x1b, 0x1a, 0x5e, 0x3f, 0xd2, 0xb7, 0x8a, 0x1b, 0x6,  0xc4, 0x3a, 0xaf,
      0xb5, 0x27, 0xd7, 0x28, 0x32, 0x11, 0x93, 0x86, 0x7e, 0x40, 0xc3, 0xfc, 0x13, 0x78, 0x41, 0x2e, 0x1c, 0x0,  0x3,
      0x3b, 0xf2, 0xda, 0x0,  0x2,  0xca, 0xdb, 0x4f, 0x23, 0x5b, 0x7,  0x2,  0x0,  0x0,  0x35, 0xb4, 0x12, 0x0,  0x1a,
      0xa1, 0xa1, 0x29, 0xc4, 0x21, 0x8a, 0xf8, 0xbc, 0x29, 0x31, 0x54, 0x3c, 0x5f, 0xc8, 0x4,  0x70, 0xd2, 0x28, 0xb8,
      0xcf, 0x7b, 0xa9, 0xe0, 0xa6, 0xed, 0x3c, 0x13, 0x52, 0xda, 0x16, 0x0,  0x17, 0x6f, 0x48, 0xff, 0x68, 0x47, 0x82,
      0xc0, 0xfc, 0xb,  0x96, 0x10, 0x26, 0xca, 0x50, 0xcb, 0x98, 0x8e, 0x9e, 0x72, 0x6b, 0x49, 0xc7, 0x3b, 0x23, 0x7c,
      0xf2, 0x13, 0x64, 0x73, 0x27, 0x0,  0x0,  0x59, 0xea, 0xb,  0x1e, 0x0,  0x6,  0xd,  0xe2, 0x5f, 0x63, 0x2c, 0xf8,
      0x0,  0x6,  0x97, 0xa8, 0x8d, 0xb7, 0x47, 0xc6, 0x0,  0x2,  0x74, 0xef, 0x0,  0x3,  0xd,  0x25, 0x94};

  uint8_t buf[274] = {0};

  uint8_t bytesprops0[] = {0xd6, 0x98, 0xa9, 0x47, 0xdc, 0xf4};
  uint8_t bytesprops1[] = {0x46, 0xf2, 0x47, 0xc3, 0x7a, 0x5d, 0xcb, 0xea, 0x6b, 0x9d, 0x2d, 0x2e, 0x90, 0x60,
                           0x79, 0x1e, 0xcb, 0x1c, 0x23, 0xd5, 0x56, 0x73, 0x99, 0x6b, 0x3e, 0xb8, 0x1c, 0xc8};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0xbf, 0xe2};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0x28, 0x8b, 0x42, 0xfa, 0xd0, 0x54, 0x3c, 0xb3, 0x11, 0x31, 0x2a, 0x40, 0x82, 0xfd, 0xcf};
  uint8_t bytesprops6[] = {0x2b, 0x50, 0xfe, 0x0,  0x36, 0xa1, 0x6e, 0x44, 0xf0, 0x6c, 0x2a, 0x90, 0xd0,
                           0xed, 0x7c, 0x15, 0x2e, 0x72, 0xa7, 0x31, 0x41, 0xbb, 0x1c, 0xd2, 0xf0, 0x14};
  uint8_t bytesprops7[] = {0x1a, 0x5e, 0x3f, 0xd2, 0xb7, 0x8a, 0x1b, 0x6,  0xc4, 0x3a, 0xaf, 0xb5, 0x27, 0xd7,
                           0x28, 0x32, 0x11, 0x93, 0x86, 0x7e, 0x40, 0xc3, 0xfc, 0x13, 0x78, 0x41, 0x2e};
  uint8_t bytesprops8[] = {0x3b, 0xf2, 0xda};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa1, 0xa1, 0x29, 0xc4, 0x21, 0x8a, 0xf8, 0xbc, 0x29, 0x31, 0x54, 0x3c, 0x5f,
                               0xc8, 0x4,  0x70, 0xd2, 0x28, 0xb8, 0xcf, 0x7b, 0xa9, 0xe0, 0xa6, 0xed, 0x3c};
  uint8_t byteswillprops1[] = {0x6f, 0x48, 0xff, 0x68, 0x47, 0x82, 0xc0, 0xfc, 0xb,  0x96, 0x10, 0x26,
                               0xca, 0x50, 0xcb, 0x98, 0x8e, 0x9e, 0x72, 0x6b, 0x49, 0xc7, 0x3b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23303}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13748}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21210}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31986}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25715}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23018}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd, 0xe2, 0x5f, 0x63, 0x2c, 0xf8};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0xa8, 0x8d, 0xb7, 0x47, 0xc6};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29236;
  uint8_t client_id_bytes[] = {0xca, 0xdb};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x74, 0xef};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd, 0x25, 0x94};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\144:3}\185E\246k\210Hp\221\197\245\&6\148\135m\216\143p\136\185\STX\ENQ\186\149?",
// _password = Just "\DC3\NAK\168)\SUB\234>\CAN\168\155\253RB\142?\137D\181y\170\&3O!+", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\227\205\234\251\"J\133\178\154\154[\STX\135\DC4[\a@\245[e\SUBR1\234\201\192'\vam", _willMsg = "\CAN\230\GS",
// _willProps = [PropSubscriptionIdentifierAvailable 23,PropSharedSubscriptionAvailable
// 192,PropSharedSubscriptionAvailable 231,PropSubscriptionIdentifier 17,PropTopicAliasMaximum
// 30146,PropMessageExpiryInterval 32008,PropRetainAvailable 255,PropServerKeepAlive 14818]}), _cleanSession = False,
// _keepAlive = 542, _connID = ")\ESC\193I>\"[\SO\187G\\\182\199yj\DC4o\204\229yV\"n+\138u\223", _properties =
// [PropWildcardSubscriptionAvailable 38,PropReasonString
// "\183\205\145\166@S!\178\&9\236\f",PropSharedSubscriptionAvailable 86]}
TEST(Connect5QCTest, Encode51) {
  uint8_t pkt[] = {0x10, 0xad, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x2,  0x1e, 0x12, 0x28, 0x26,
                   0x1f, 0x0,  0xb,  0xb7, 0xcd, 0x91, 0xa6, 0x40, 0x53, 0x21, 0xb2, 0x39, 0xec, 0xc,  0x2a, 0x56,
                   0x0,  0x1b, 0x29, 0x1b, 0xc1, 0x49, 0x3e, 0x22, 0x5b, 0xe,  0xbb, 0x47, 0x5c, 0xb6, 0xc7, 0x79,
                   0x6a, 0x14, 0x6f, 0xcc, 0xe5, 0x79, 0x56, 0x22, 0x6e, 0x2b, 0x8a, 0x75, 0xdf, 0x15, 0x29, 0x17,
                   0x2a, 0xc0, 0x2a, 0xe7, 0xb,  0x11, 0x22, 0x75, 0xc2, 0x2,  0x0,  0x0,  0x7d, 0x8,  0x25, 0xff,
                   0x13, 0x39, 0xe2, 0x0,  0x1e, 0xe3, 0xcd, 0xea, 0xfb, 0x22, 0x4a, 0x85, 0xb2, 0x9a, 0x9a, 0x5b,
                   0x2,  0x87, 0x14, 0x5b, 0x7,  0x40, 0xf5, 0x5b, 0x65, 0x1a, 0x52, 0x31, 0xea, 0xc9, 0xc0, 0x27,
                   0xb,  0x61, 0x6d, 0x0,  0x3,  0x18, 0xe6, 0x1d, 0x0,  0x1c, 0x90, 0x3a, 0x33, 0x7d, 0xb9, 0x45,
                   0xf6, 0x6b, 0xd2, 0x48, 0x70, 0xdd, 0xc5, 0xf5, 0x36, 0x94, 0x87, 0x6d, 0xd8, 0x8f, 0x70, 0x88,
                   0xb9, 0x2,  0x5,  0xba, 0x95, 0x3f, 0x0,  0x18, 0x13, 0x15, 0xa8, 0x29, 0x1a, 0xea, 0x3e, 0x18,
                   0xa8, 0x9b, 0xfd, 0x52, 0x42, 0x8e, 0x3f, 0x89, 0x44, 0xb5, 0x79, 0xaa, 0x33, 0x4f, 0x21, 0x2b};

  uint8_t buf[186] = {0};

  uint8_t bytesprops0[] = {0xb7, 0xcd, 0x91, 0xa6, 0x40, 0x53, 0x21, 0xb2, 0x39, 0xec, 0xc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 86}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 23}},     {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 231}},    {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30146}}, {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32008}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 255}},    {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14818}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xcd, 0xea, 0xfb, 0x22, 0x4a, 0x85, 0xb2, 0x9a, 0x9a,
                                0x5b, 0x2,  0x87, 0x14, 0x5b, 0x7,  0x40, 0xf5, 0x5b, 0x65,
                                0x1a, 0x52, 0x31, 0xea, 0xc9, 0xc0, 0x27, 0xb,  0x61, 0x6d};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x18, 0xe6, 0x1d};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 542;
  uint8_t client_id_bytes[] = {0x29, 0x1b, 0xc1, 0x49, 0x3e, 0x22, 0x5b, 0xe,  0xbb, 0x47, 0x5c, 0xb6, 0xc7, 0x79,
                               0x6a, 0x14, 0x6f, 0xcc, 0xe5, 0x79, 0x56, 0x22, 0x6e, 0x2b, 0x8a, 0x75, 0xdf};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x90, 0x3a, 0x33, 0x7d, 0xb9, 0x45, 0xf6, 0x6b, 0xd2, 0x48, 0x70, 0xdd, 0xc5, 0xf5,
                              0x36, 0x94, 0x87, 0x6d, 0xd8, 0x8f, 0x70, 0x88, 0xb9, 0x2,  0x5,  0xba, 0x95, 0x3f};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x13, 0x15, 0xa8, 0x29, 0x1a, 0xea, 0x3e, 0x18, 0xa8, 0x9b, 0xfd, 0x52,
                              0x42, 0x8e, 0x3f, 0x89, 0x44, 0xb5, 0x79, 0xaa, 0x33, 0x4f, 0x21, 0x2b};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "LW\149,C?\222\163x\147\176\166e\163!\187}@2\213\n", _password = Just
// "\166\&1Vn<\147O\v\178i\245g:\SUB", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\243\244O\221\ETX\229\192\137;\183\197D/\221!m\211\162", _willMsg =
// "\239M(\237\209\235\215\"\SI\220v\217\205\n\228\156\205s\250\244\167K\185\SI-\ETB\SOq\r", _willProps =
// [PropPayloadFormatIndicator 179,PropUserProperty
// "R\245\138t\142U\US\129U\179R\254\254\191\139E\171\189\157\219\144\185]Po]" "z",PropAssignedClientIdentifier
// "\182u\130\176\&6",PropAuthenticationMethod "&\154\EMEW\186",PropResponseInformation
// "\132\189q0\142\247\196G\196\198\&70\NUL\ETX$f\139\DLE\CANw\144\r$\155",PropPayloadFormatIndicator
// 19,PropRequestProblemInformation 215,PropMaximumQoS 170,PropRequestProblemInformation 100,PropAuthenticationData
// "\160",PropAssignedClientIdentifier "R\137\217\168",PropRequestResponseInformation 99,PropServerReference
// "h\147\144\EMT\f\190\170\224\157\167\205\223\174S\215\DC3\222\b\ENQ\DLE\208\202\248\141i\SOH",PropAssignedClientIdentifier
// "\140",PropResponseTopic "\168\251\179\150\162\aO)?\160U\135\202$\147\188\182",PropResponseTopic
// "\SOH\232T\188\r]jZ^\235e\224\SUB\135GdI=\166",PropSubscriptionIdentifier 17,PropRetainAvailable
// 103,PropAuthenticationMethod "\143\211\213\153\230\242",PropRequestProblemInformation
// 23,PropWildcardSubscriptionAvailable 104]}), _cleanSession = False, _keepAlive = 32428, _connID =
// "\SYN\217\207Z5\137\241\224\174\144\248\192*\233\218Z\230\DEL\198I9", _properties = [PropSubscriptionIdentifier
// 13,PropMaximumQoS 96,PropTopicAlias 32544,PropAuthenticationMethod ")6U",PropTopicAliasMaximum
// 26085,PropServerKeepAlive 12645,PropResponseInformation "\165\229\230B\r.ib\141\&6E\240n\EM\157
// \208\160\201\221\131\231'\244\SINb\159+Q",PropPayloadFormatIndicator 147,PropRetainAvailable 90,PropRetainAvailable
// 197,PropTopicAliasMaximum 5288,PropMaximumQoS 8,PropResponseTopic
// "\204\228\FS\199\&4\160v\173\186\131\147\DC2`^\217\162\&4\244U\243<\SUB\208",PropReasonString "'\143\157YG"]}
TEST(Connect5QCTest, Encode52) {
  uint8_t pkt[] = {
      0x10, 0x9f, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x7e, 0xac, 0x61, 0xb,  0xd,  0x24, 0x60, 0x23,
      0x7f, 0x20, 0x15, 0x0,  0x3,  0x29, 0x36, 0x55, 0x22, 0x65, 0xe5, 0x13, 0x31, 0x65, 0x1a, 0x0,  0x1e, 0xa5, 0xe5,
      0xe6, 0x42, 0xd,  0x2e, 0x69, 0x62, 0x8d, 0x36, 0x45, 0xf0, 0x6e, 0x19, 0x9d, 0x20, 0xd0, 0xa0, 0xc9, 0xdd, 0x83,
      0xe7, 0x27, 0xf4, 0xf,  0x4e, 0x62, 0x9f, 0x2b, 0x51, 0x1,  0x93, 0x25, 0x5a, 0x25, 0xc5, 0x22, 0x14, 0xa8, 0x24,
      0x8,  0x8,  0x0,  0x17, 0xcc, 0xe4, 0x1c, 0xc7, 0x34, 0xa0, 0x76, 0xad, 0xba, 0x83, 0x93, 0x12, 0x60, 0x5e, 0xd9,
      0xa2, 0x34, 0xf4, 0x55, 0xf3, 0x3c, 0x1a, 0xd0, 0x1f, 0x0,  0x5,  0x27, 0x8f, 0x9d, 0x59, 0x47, 0x0,  0x15, 0x16,
      0xd9, 0xcf, 0x5a, 0x35, 0x89, 0xf1, 0xe0, 0xae, 0x90, 0xf8, 0xc0, 0x2a, 0xe9, 0xda, 0x5a, 0xe6, 0x7f, 0xc6, 0x49,
      0x39, 0xc0, 0x1,  0x1,  0xb3, 0x26, 0x0,  0x1a, 0x52, 0xf5, 0x8a, 0x74, 0x8e, 0x55, 0x1f, 0x81, 0x55, 0xb3, 0x52,
      0xfe, 0xfe, 0xbf, 0x8b, 0x45, 0xab, 0xbd, 0x9d, 0xdb, 0x90, 0xb9, 0x5d, 0x50, 0x6f, 0x5d, 0x0,  0x1,  0x7a, 0x12,
      0x0,  0x5,  0xb6, 0x75, 0x82, 0xb0, 0x36, 0x15, 0x0,  0x6,  0x26, 0x9a, 0x19, 0x45, 0x57, 0xba, 0x1a, 0x0,  0x18,
      0x84, 0xbd, 0x71, 0x30, 0x8e, 0xf7, 0xc4, 0x47, 0xc4, 0xc6, 0x37, 0x30, 0x0,  0x3,  0x24, 0x66, 0x8b, 0x10, 0x18,
      0x77, 0x90, 0xd,  0x24, 0x9b, 0x1,  0x13, 0x17, 0xd7, 0x24, 0xaa, 0x17, 0x64, 0x16, 0x0,  0x1,  0xa0, 0x12, 0x0,
      0x4,  0x52, 0x89, 0xd9, 0xa8, 0x19, 0x63, 0x1c, 0x0,  0x1b, 0x68, 0x93, 0x90, 0x19, 0x54, 0xc,  0xbe, 0xaa, 0xe0,
      0x9d, 0xa7, 0xcd, 0xdf, 0xae, 0x53, 0xd7, 0x13, 0xde, 0x8,  0x5,  0x10, 0xd0, 0xca, 0xf8, 0x8d, 0x69, 0x1,  0x12,
      0x0,  0x1,  0x8c, 0x8,  0x0,  0x11, 0xa8, 0xfb, 0xb3, 0x96, 0xa2, 0x7,  0x4f, 0x29, 0x3f, 0xa0, 0x55, 0x87, 0xca,
      0x24, 0x93, 0xbc, 0xb6, 0x8,  0x0,  0x13, 0x1,  0xe8, 0x54, 0xbc, 0xd,  0x5d, 0x6a, 0x5a, 0x5e, 0xeb, 0x65, 0xe0,
      0x1a, 0x87, 0x47, 0x64, 0x49, 0x3d, 0xa6, 0xb,  0x11, 0x25, 0x67, 0x15, 0x0,  0x6,  0x8f, 0xd3, 0xd5, 0x99, 0xe6,
      0xf2, 0x17, 0x17, 0x28, 0x68, 0x0,  0x12, 0xf3, 0xf4, 0x4f, 0xdd, 0x3,  0xe5, 0xc0, 0x89, 0x3b, 0xb7, 0xc5, 0x44,
      0x2f, 0xdd, 0x21, 0x6d, 0xd3, 0xa2, 0x0,  0x1d, 0xef, 0x4d, 0x28, 0xed, 0xd1, 0xeb, 0xd7, 0x22, 0xf,  0xdc, 0x76,
      0xd9, 0xcd, 0xa,  0xe4, 0x9c, 0xcd, 0x73, 0xfa, 0xf4, 0xa7, 0x4b, 0xb9, 0xf,  0x2d, 0x17, 0xe,  0x71, 0xd,  0x0,
      0x15, 0x4c, 0x57, 0x95, 0x2c, 0x43, 0x3f, 0xde, 0xa3, 0x78, 0x93, 0xb0, 0xa6, 0x65, 0xa3, 0x21, 0xbb, 0x7d, 0x40,
      0x32, 0xd5, 0xa,  0x0,  0xe,  0xa6, 0x31, 0x56, 0x6e, 0x3c, 0x93, 0x4f, 0xb,  0xb2, 0x69, 0xf5, 0x67, 0x3a, 0x1a};

  uint8_t buf[428] = {0};

  uint8_t bytesprops0[] = {0x29, 0x36, 0x55};
  uint8_t bytesprops1[] = {0xa5, 0xe5, 0xe6, 0x42, 0xd,  0x2e, 0x69, 0x62, 0x8d, 0x36, 0x45, 0xf0, 0x6e, 0x19, 0x9d,
                           0x20, 0xd0, 0xa0, 0xc9, 0xdd, 0x83, 0xe7, 0x27, 0xf4, 0xf,  0x4e, 0x62, 0x9f, 0x2b, 0x51};
  uint8_t bytesprops2[] = {0xcc, 0xe4, 0x1c, 0xc7, 0x34, 0xa0, 0x76, 0xad, 0xba, 0x83, 0x93, 0x12,
                           0x60, 0x5e, 0xd9, 0xa2, 0x34, 0xf4, 0x55, 0xf3, 0x3c, 0x1a, 0xd0};
  uint8_t bytesprops3[] = {0x27, 0x8f, 0x9d, 0x59, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32544}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26085}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12645}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5288}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x7a};
  uint8_t byteswillprops0[] = {0x52, 0xf5, 0x8a, 0x74, 0x8e, 0x55, 0x1f, 0x81, 0x55, 0xb3, 0x52, 0xfe, 0xfe,
                               0xbf, 0x8b, 0x45, 0xab, 0xbd, 0x9d, 0xdb, 0x90, 0xb9, 0x5d, 0x50, 0x6f, 0x5d};
  uint8_t byteswillprops2[] = {0xb6, 0x75, 0x82, 0xb0, 0x36};
  uint8_t byteswillprops3[] = {0x26, 0x9a, 0x19, 0x45, 0x57, 0xba};
  uint8_t byteswillprops4[] = {0x84, 0xbd, 0x71, 0x30, 0x8e, 0xf7, 0xc4, 0x47, 0xc4, 0xc6, 0x37, 0x30,
                               0x0,  0x3,  0x24, 0x66, 0x8b, 0x10, 0x18, 0x77, 0x90, 0xd,  0x24, 0x9b};
  uint8_t byteswillprops5[] = {0xa0};
  uint8_t byteswillprops6[] = {0x52, 0x89, 0xd9, 0xa8};
  uint8_t byteswillprops7[] = {0x68, 0x93, 0x90, 0x19, 0x54, 0xc, 0xbe, 0xaa, 0xe0, 0x9d, 0xa7, 0xcd, 0xdf, 0xae,
                               0x53, 0xd7, 0x13, 0xde, 0x8,  0x5, 0x10, 0xd0, 0xca, 0xf8, 0x8d, 0x69, 0x1};
  uint8_t byteswillprops8[] = {0x8c};
  uint8_t byteswillprops9[] = {0xa8, 0xfb, 0xb3, 0x96, 0xa2, 0x7,  0x4f, 0x29, 0x3f,
                               0xa0, 0x55, 0x87, 0xca, 0x24, 0x93, 0xbc, 0xb6};
  uint8_t byteswillprops10[] = {0x1,  0xe8, 0x54, 0xbc, 0xd,  0x5d, 0x6a, 0x5a, 0x5e, 0xeb,
                                0x65, 0xe0, 0x1a, 0x87, 0x47, 0x64, 0x49, 0x3d, 0xa6};
  uint8_t byteswillprops11[] = {0x8f, 0xd3, 0xd5, 0x99, 0xe6, 0xf2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&byteswillprops0}, .v = {1, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 104}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf3, 0xf4, 0x4f, 0xdd, 0x3,  0xe5, 0xc0, 0x89, 0x3b,
                                0xb7, 0xc5, 0x44, 0x2f, 0xdd, 0x21, 0x6d, 0xd3, 0xa2};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xef, 0x4d, 0x28, 0xed, 0xd1, 0xeb, 0xd7, 0x22, 0xf,  0xdc,
                                  0x76, 0xd9, 0xcd, 0xa,  0xe4, 0x9c, 0xcd, 0x73, 0xfa, 0xf4,
                                  0xa7, 0x4b, 0xb9, 0xf,  0x2d, 0x17, 0xe,  0x71, 0xd};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32428;
  uint8_t client_id_bytes[] = {0x16, 0xd9, 0xcf, 0x5a, 0x35, 0x89, 0xf1, 0xe0, 0xae, 0x90, 0xf8,
                               0xc0, 0x2a, 0xe9, 0xda, 0x5a, 0xe6, 0x7f, 0xc6, 0x49, 0x39};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4c, 0x57, 0x95, 0x2c, 0x43, 0x3f, 0xde, 0xa3, 0x78, 0x93, 0xb0,
                              0xa6, 0x65, 0xa3, 0x21, 0xbb, 0x7d, 0x40, 0x32, 0xd5, 0xa};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa6, 0x31, 0x56, 0x6e, 0x3c, 0x93, 0x4f, 0xb, 0xb2, 0x69, 0xf5, 0x67, 0x3a, 0x1a};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\230\206\252H\237\141\SIb\136w \172Y\159\155sC\141\159\"s\246{\DEL\254\208~\130",
// _password = Just "o\191Q<34\244\255\186\STXo\235,\210\v\SYN_\234\"x\219X\242\159.D\231", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\204\DC4\226:25\172", _willMsg = "\NAK\232\175\221\193,",
// _willProps = [PropWildcardSubscriptionAvailable 151,PropRetainAvailable 219,PropReasonString
// ":\226\&5#\STX\167\SO%\181\176\210sv\135\SO\129Kq5\224\131\205\ACK8L*\129\205\224P",PropTopicAlias
// 23946,PropServerReference "\166\135\216=",PropRequestProblemInformation 50,PropRequestProblemInformation
// 106,PropMessageExpiryInterval 29679,PropSubscriptionIdentifierAvailable 10,PropContentType
// "\182\218\232\231m\SOH\240\198\227\252\f\231\132ED",PropAssignedClientIdentifier "\DC3~\157\240\238"]}),
// _cleanSession = False, _keepAlive = 4766, _connID = "p\205\137>X(\171\175\246\NAKr\254\223H\232\252\254\236\198<",
// _properties = [PropMaximumPacketSize 32218,PropMaximumQoS 136,PropAssignedClientIdentifier
// "\250\131@\212H6\158\179\249\165",PropResponseInformation
// "\201\180t\DC1gN\208\176\200x\252\173\201\234\US\154\t\202\188u\SI",PropReasonString
// "w\168\188\221\159\EOT[\SYN\219\222\239\229({@3\171\200\CAN\147\197\"{\195C\148B\211'",PropWillDelayInterval
// 23335,PropPayloadFormatIndicator 34,PropWildcardSubscriptionAvailable 162,PropRetainAvailable 117,PropResponseTopic
// "\248s\223\159\170\220G<s\205.\177\156V",PropResponseTopic "\142\131Rc^3",PropServerKeepAlive
// 17197,PropCorrelationData "\NUL\160\228\217\206",PropReasonString
// "\204l\STX\222\144I1\154\147\242\EOT+\182\164\NUL\251\aC\203\162\ACK\149\145",PropMessageExpiryInterval
// 2179,PropUserProperty "\247\185~\140\222\&6" "\162T\135\218l\SUB",PropAssignedClientIdentifier
// "9\235\145M\163\209\171\198\150\214\209\140!\216\188\183\225lk+\a\163\DC4\180",PropResponseInformation
// "Qe\216R\149A\213\177\175\195yIw\218wE\v\180\146",PropServerKeepAlive 1105,PropReasonString
// "\133\148V\163\238\204^\171",PropAssignedClientIdentifier
// "H\167h\168\254\184\190\232\247\US\128\138Z\174K:\252\ENQ\USW\158\209"]}
TEST(Connect5QCTest, Encode53) {
  uint8_t pkt[] = {
      0x10, 0xc7, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x12, 0x9e, 0x84, 0x2,  0x27, 0x0,  0x0,  0x7d,
      0xda, 0x24, 0x88, 0x12, 0x0,  0xa,  0xfa, 0x83, 0x40, 0xd4, 0x48, 0x36, 0x9e, 0xb3, 0xf9, 0xa5, 0x1a, 0x0,  0x15,
      0xc9, 0xb4, 0x74, 0x11, 0x67, 0x4e, 0xd0, 0xb0, 0xc8, 0x78, 0xfc, 0xad, 0xc9, 0xea, 0x1f, 0x9a, 0x9,  0xca, 0xbc,
      0x75, 0xf,  0x1f, 0x0,  0x1d, 0x77, 0xa8, 0xbc, 0xdd, 0x9f, 0x4,  0x5b, 0x16, 0xdb, 0xde, 0xef, 0xe5, 0x28, 0x7b,
      0x40, 0x33, 0xab, 0xc8, 0x18, 0x93, 0xc5, 0x22, 0x7b, 0xc3, 0x43, 0x94, 0x42, 0xd3, 0x27, 0x18, 0x0,  0x0,  0x5b,
      0x27, 0x1,  0x22, 0x28, 0xa2, 0x25, 0x75, 0x8,  0x0,  0xe,  0xf8, 0x73, 0xdf, 0x9f, 0xaa, 0xdc, 0x47, 0x3c, 0x73,
      0xcd, 0x2e, 0xb1, 0x9c, 0x56, 0x8,  0x0,  0x6,  0x8e, 0x83, 0x52, 0x63, 0x5e, 0x33, 0x13, 0x43, 0x2d, 0x9,  0x0,
      0x5,  0x0,  0xa0, 0xe4, 0xd9, 0xce, 0x1f, 0x0,  0x17, 0xcc, 0x6c, 0x2,  0xde, 0x90, 0x49, 0x31, 0x9a, 0x93, 0xf2,
      0x4,  0x2b, 0xb6, 0xa4, 0x0,  0xfb, 0x7,  0x43, 0xcb, 0xa2, 0x6,  0x95, 0x91, 0x2,  0x0,  0x0,  0x8,  0x83, 0x26,
      0x0,  0x6,  0xf7, 0xb9, 0x7e, 0x8c, 0xde, 0x36, 0x0,  0x6,  0xa2, 0x54, 0x87, 0xda, 0x6c, 0x1a, 0x12, 0x0,  0x18,
      0x39, 0xeb, 0x91, 0x4d, 0xa3, 0xd1, 0xab, 0xc6, 0x96, 0xd6, 0xd1, 0x8c, 0x21, 0xd8, 0xbc, 0xb7, 0xe1, 0x6c, 0x6b,
      0x2b, 0x7,  0xa3, 0x14, 0xb4, 0x1a, 0x0,  0x13, 0x51, 0x65, 0xd8, 0x52, 0x95, 0x41, 0xd5, 0xb1, 0xaf, 0xc3, 0x79,
      0x49, 0x77, 0xda, 0x77, 0x45, 0xb,  0xb4, 0x92, 0x13, 0x4,  0x51, 0x1f, 0x0,  0x8,  0x85, 0x94, 0x56, 0xa3, 0xee,
      0xcc, 0x5e, 0xab, 0x12, 0x0,  0x16, 0x48, 0xa7, 0x68, 0xa8, 0xfe, 0xb8, 0xbe, 0xe8, 0xf7, 0x1f, 0x80, 0x8a, 0x5a,
      0xae, 0x4b, 0x3a, 0xfc, 0x5,  0x1f, 0x57, 0x9e, 0xd1, 0x0,  0x14, 0x70, 0xcd, 0x89, 0x3e, 0x58, 0x28, 0xab, 0xaf,
      0xf6, 0x15, 0x72, 0xfe, 0xdf, 0x48, 0xe8, 0xfc, 0xfe, 0xec, 0xc6, 0x3c, 0x54, 0x28, 0x97, 0x25, 0xdb, 0x1f, 0x0,
      0x1e, 0x3a, 0xe2, 0x35, 0x23, 0x2,  0xa7, 0xe,  0x25, 0xb5, 0xb0, 0xd2, 0x73, 0x76, 0x87, 0xe,  0x81, 0x4b, 0x71,
      0x35, 0xe0, 0x83, 0xcd, 0x6,  0x38, 0x4c, 0x2a, 0x81, 0xcd, 0xe0, 0x50, 0x23, 0x5d, 0x8a, 0x1c, 0x0,  0x4,  0xa6,
      0x87, 0xd8, 0x3d, 0x17, 0x32, 0x17, 0x6a, 0x2,  0x0,  0x0,  0x73, 0xef, 0x29, 0xa,  0x3,  0x0,  0xf,  0xb6, 0xda,
      0xe8, 0xe7, 0x6d, 0x1,  0xf0, 0xc6, 0xe3, 0xfc, 0xc,  0xe7, 0x84, 0x45, 0x44, 0x12, 0x0,  0x5,  0x13, 0x7e, 0x9d,
      0xf0, 0xee, 0x0,  0x7,  0xcc, 0x14, 0xe2, 0x3a, 0x32, 0x35, 0xac, 0x0,  0x6,  0x15, 0xe8, 0xaf, 0xdd, 0xc1, 0x2c,
      0x0,  0x1c, 0xe6, 0xce, 0xfc, 0x48, 0xed, 0x8d, 0xf,  0x62, 0x88, 0x77, 0x20, 0xac, 0x59, 0x9f, 0x9b, 0x73, 0x43,
      0x8d, 0x9f, 0x22, 0x73, 0xf6, 0x7b, 0x7f, 0xfe, 0xd0, 0x7e, 0x82, 0x0,  0x1b, 0x6f, 0xbf, 0x51, 0x3c, 0x33, 0x34,
      0xf4, 0xff, 0xba, 0x2,  0x6f, 0xeb, 0x2c, 0xd2, 0xb,  0x16, 0x5f, 0xea, 0x22, 0x78, 0xdb, 0x58, 0xf2, 0x9f, 0x2e,
      0x44, 0xe7};

  uint8_t buf[468] = {0};

  uint8_t bytesprops0[] = {0xfa, 0x83, 0x40, 0xd4, 0x48, 0x36, 0x9e, 0xb3, 0xf9, 0xa5};
  uint8_t bytesprops1[] = {0xc9, 0xb4, 0x74, 0x11, 0x67, 0x4e, 0xd0, 0xb0, 0xc8, 0x78, 0xfc,
                           0xad, 0xc9, 0xea, 0x1f, 0x9a, 0x9,  0xca, 0xbc, 0x75, 0xf};
  uint8_t bytesprops2[] = {0x77, 0xa8, 0xbc, 0xdd, 0x9f, 0x4,  0x5b, 0x16, 0xdb, 0xde, 0xef, 0xe5, 0x28, 0x7b, 0x40,
                           0x33, 0xab, 0xc8, 0x18, 0x93, 0xc5, 0x22, 0x7b, 0xc3, 0x43, 0x94, 0x42, 0xd3, 0x27};
  uint8_t bytesprops3[] = {0xf8, 0x73, 0xdf, 0x9f, 0xaa, 0xdc, 0x47, 0x3c, 0x73, 0xcd, 0x2e, 0xb1, 0x9c, 0x56};
  uint8_t bytesprops4[] = {0x8e, 0x83, 0x52, 0x63, 0x5e, 0x33};
  uint8_t bytesprops5[] = {0x0, 0xa0, 0xe4, 0xd9, 0xce};
  uint8_t bytesprops6[] = {0xcc, 0x6c, 0x2, 0xde, 0x90, 0x49, 0x31, 0x9a, 0x93, 0xf2, 0x4, 0x2b,
                           0xb6, 0xa4, 0x0, 0xfb, 0x7,  0x43, 0xcb, 0xa2, 0x6,  0x95, 0x91};
  uint8_t bytesprops8[] = {0xa2, 0x54, 0x87, 0xda, 0x6c, 0x1a};
  uint8_t bytesprops7[] = {0xf7, 0xb9, 0x7e, 0x8c, 0xde, 0x36};
  uint8_t bytesprops9[] = {0x39, 0xeb, 0x91, 0x4d, 0xa3, 0xd1, 0xab, 0xc6, 0x96, 0xd6, 0xd1, 0x8c,
                           0x21, 0xd8, 0xbc, 0xb7, 0xe1, 0x6c, 0x6b, 0x2b, 0x7,  0xa3, 0x14, 0xb4};
  uint8_t bytesprops10[] = {0x51, 0x65, 0xd8, 0x52, 0x95, 0x41, 0xd5, 0xb1, 0xaf, 0xc3,
                            0x79, 0x49, 0x77, 0xda, 0x77, 0x45, 0xb,  0xb4, 0x92};
  uint8_t bytesprops11[] = {0x85, 0x94, 0x56, 0xa3, 0xee, 0xcc, 0x5e, 0xab};
  uint8_t bytesprops12[] = {0x48, 0xa7, 0x68, 0xa8, 0xfe, 0xb8, 0xbe, 0xe8, 0xf7, 0x1f, 0x80,
                            0x8a, 0x5a, 0xae, 0x4b, 0x3a, 0xfc, 0x5,  0x1f, 0x57, 0x9e, 0xd1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32218}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23335}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17197}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2179}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops7}, .v = {6, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1105}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3a, 0xe2, 0x35, 0x23, 0x2,  0xa7, 0xe,  0x25, 0xb5, 0xb0,
                               0xd2, 0x73, 0x76, 0x87, 0xe,  0x81, 0x4b, 0x71, 0x35, 0xe0,
                               0x83, 0xcd, 0x6,  0x38, 0x4c, 0x2a, 0x81, 0xcd, 0xe0, 0x50};
  uint8_t byteswillprops1[] = {0xa6, 0x87, 0xd8, 0x3d};
  uint8_t byteswillprops2[] = {0xb6, 0xda, 0xe8, 0xe7, 0x6d, 0x1, 0xf0, 0xc6, 0xe3, 0xfc, 0xc, 0xe7, 0x84, 0x45, 0x44};
  uint8_t byteswillprops3[] = {0x13, 0x7e, 0x9d, 0xf0, 0xee};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23946}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29679}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&byteswillprops3}}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcc, 0x14, 0xe2, 0x3a, 0x32, 0x35, 0xac};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x15, 0xe8, 0xaf, 0xdd, 0xc1, 0x2c};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4766;
  uint8_t client_id_bytes[] = {0x70, 0xcd, 0x89, 0x3e, 0x58, 0x28, 0xab, 0xaf, 0xf6, 0x15,
                               0x72, 0xfe, 0xdf, 0x48, 0xe8, 0xfc, 0xfe, 0xec, 0xc6, 0x3c};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe6, 0xce, 0xfc, 0x48, 0xed, 0x8d, 0xf,  0x62, 0x88, 0x77, 0x20, 0xac, 0x59, 0x9f,
                              0x9b, 0x73, 0x43, 0x8d, 0x9f, 0x22, 0x73, 0xf6, 0x7b, 0x7f, 0xfe, 0xd0, 0x7e, 0x82};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xbf, 0x51, 0x3c, 0x33, 0x34, 0xf4, 0xff, 0xba, 0x2,  0x6f, 0xeb, 0x2c, 0xd2,
                              0xb,  0x16, 0x5f, 0xea, 0x22, 0x78, 0xdb, 0x58, 0xf2, 0x9f, 0x2e, 0x44, 0xe7};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "<\n\149R0\\\216K\NAK\157\239\187b\243\172\NAKU", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\n", _willMsg =
// "w9\217yM\186\161\166g\136\140\154\178\SYN5\150\228\212\FSHP\235\202\224\242D;", _willProps =
// [PropSubscriptionIdentifierAvailable 114,PropAssignedClientIdentifier "e\176F\179's5",PropMaximumPacketSize
// 12776,PropServerReference "\179\165d\217\157:\206,\230\n\212W\178\174d\159\&8I\224\151f\193\147\220",PropContentType
// "u\240?>\247\166",PropMessageExpiryInterval 19508,PropReceiveMaximum 26213,PropResponseTopic
// "\177H\134\133",PropSharedSubscriptionAvailable 185,PropResponseInformation
// "\DC3\245\235s\US\246\226\205G\159nd\220\248g-\195c\222\185\163\178g",PropTopicAlias
// 12131,PropWildcardSubscriptionAvailable 179,PropAuthenticationData
// "8\230\178jp\243\153\227\235\154\&4-2\214#\145X\153\185\175\199\"\166s\DC2\207@",PropCorrelationData
// "\SUBg>\\\vz\206\247\fL\189\176\202\129\EOT\211\&7\134\r",PropResponseTopic
// "8\169\DEL\205\233\153\131\192\191\132\230\165\252l\DC1\157",PropAssignedClientIdentifier
// "\201YwF$%\137\NUL\230\ENQUM\219\220s",PropSubscriptionIdentifier 27,PropSharedSubscriptionAvailable
// 87,PropUserProperty
// "\169\149\215\197\129~\186\194\237&\DC3\180\130\179\248\233\215`\194\173\167\164\157\148\209\f\155s\ETB"
// "\202\"\255\210\225",PropAuthenticationMethod "\205\191i:\180",PropUserProperty
// "\136\129\247>\NULS\230\&8^\171r\237\213mk" "\226\178",PropSubscriptionIdentifier 3,PropTopicAliasMaximum
// 2449,PropRequestResponseInformation 14]}), _cleanSession = False, _keepAlive = 6302, _connID =
// "5\175\175\181'H\173\161[\157\&8\175BY\182|\179", _properties = [PropServerReference
// "YP\224~\225A!",PropServerKeepAlive 2913,PropWillDelayInterval 20651]}
TEST(Connect5QCTest, Encode54) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x34, 0x18, 0x9e, 0x12, 0x1c, 0x0,  0x7,  0x59, 0x50,
      0xe0, 0x7e, 0xe1, 0x41, 0x21, 0x13, 0xb,  0x61, 0x18, 0x0,  0x0,  0x50, 0xab, 0x0,  0x11, 0x35, 0xaf, 0xaf, 0xb5,
      0x27, 0x48, 0xad, 0xa1, 0x5b, 0x9d, 0x38, 0xaf, 0x42, 0x59, 0xb6, 0x7c, 0xb3, 0x8e, 0x2,  0x29, 0x72, 0x12, 0x0,
      0x7,  0x65, 0xb0, 0x46, 0xb3, 0x27, 0x73, 0x35, 0x27, 0x0,  0x0,  0x31, 0xe8, 0x1c, 0x0,  0x18, 0xb3, 0xa5, 0x64,
      0xd9, 0x9d, 0x3a, 0xce, 0x2c, 0xe6, 0xa,  0xd4, 0x57, 0xb2, 0xae, 0x64, 0x9f, 0x38, 0x49, 0xe0, 0x97, 0x66, 0xc1,
      0x93, 0xdc, 0x3,  0x0,  0x6,  0x75, 0xf0, 0x3f, 0x3e, 0xf7, 0xa6, 0x2,  0x0,  0x0,  0x4c, 0x34, 0x21, 0x66, 0x65,
      0x8,  0x0,  0x4,  0xb1, 0x48, 0x86, 0x85, 0x2a, 0xb9, 0x1a, 0x0,  0x17, 0x13, 0xf5, 0xeb, 0x73, 0x1f, 0xf6, 0xe2,
      0xcd, 0x47, 0x9f, 0x6e, 0x64, 0xdc, 0xf8, 0x67, 0x2d, 0xc3, 0x63, 0xde, 0xb9, 0xa3, 0xb2, 0x67, 0x23, 0x2f, 0x63,
      0x28, 0xb3, 0x16, 0x0,  0x1b, 0x38, 0xe6, 0xb2, 0x6a, 0x70, 0xf3, 0x99, 0xe3, 0xeb, 0x9a, 0x34, 0x2d, 0x32, 0xd6,
      0x23, 0x91, 0x58, 0x99, 0xb9, 0xaf, 0xc7, 0x22, 0xa6, 0x73, 0x12, 0xcf, 0x40, 0x9,  0x0,  0x13, 0x1a, 0x67, 0x3e,
      0x5c, 0xb,  0x7a, 0xce, 0xf7, 0xc,  0x4c, 0xbd, 0xb0, 0xca, 0x81, 0x4,  0xd3, 0x37, 0x86, 0xd,  0x8,  0x0,  0x10,
      0x38, 0xa9, 0x7f, 0xcd, 0xe9, 0x99, 0x83, 0xc0, 0xbf, 0x84, 0xe6, 0xa5, 0xfc, 0x6c, 0x11, 0x9d, 0x12, 0x0,  0xf,
      0xc9, 0x59, 0x77, 0x46, 0x24, 0x25, 0x89, 0x0,  0xe6, 0x5,  0x55, 0x4d, 0xdb, 0xdc, 0x73, 0xb,  0x1b, 0x2a, 0x57,
      0x26, 0x0,  0x1d, 0xa9, 0x95, 0xd7, 0xc5, 0x81, 0x7e, 0xba, 0xc2, 0xed, 0x26, 0x13, 0xb4, 0x82, 0xb3, 0xf8, 0xe9,
      0xd7, 0x60, 0xc2, 0xad, 0xa7, 0xa4, 0x9d, 0x94, 0xd1, 0xc,  0x9b, 0x73, 0x17, 0x0,  0x5,  0xca, 0x22, 0xff, 0xd2,
      0xe1, 0x15, 0x0,  0x5,  0xcd, 0xbf, 0x69, 0x3a, 0xb4, 0x26, 0x0,  0xf,  0x88, 0x81, 0xf7, 0x3e, 0x0,  0x53, 0xe6,
      0x38, 0x5e, 0xab, 0x72, 0xed, 0xd5, 0x6d, 0x6b, 0x0,  0x2,  0xe2, 0xb2, 0xb,  0x3,  0x22, 0x9,  0x91, 0x19, 0xe,
      0x0,  0x1,  0xa,  0x0,  0x1b, 0x77, 0x39, 0xd9, 0x79, 0x4d, 0xba, 0xa1, 0xa6, 0x67, 0x88, 0x8c, 0x9a, 0xb2, 0x16,
      0x35, 0x96, 0xe4, 0xd4, 0x1c, 0x48, 0x50, 0xeb, 0xca, 0xe0, 0xf2, 0x44, 0x3b};

  uint8_t buf[365] = {0};

  uint8_t bytesprops0[] = {0x59, 0x50, 0xe0, 0x7e, 0xe1, 0x41, 0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2913}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20651}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x65, 0xb0, 0x46, 0xb3, 0x27, 0x73, 0x35};
  uint8_t byteswillprops1[] = {0xb3, 0xa5, 0x64, 0xd9, 0x9d, 0x3a, 0xce, 0x2c, 0xe6, 0xa,  0xd4, 0x57,
                               0xb2, 0xae, 0x64, 0x9f, 0x38, 0x49, 0xe0, 0x97, 0x66, 0xc1, 0x93, 0xdc};
  uint8_t byteswillprops2[] = {0x75, 0xf0, 0x3f, 0x3e, 0xf7, 0xa6};
  uint8_t byteswillprops3[] = {0xb1, 0x48, 0x86, 0x85};
  uint8_t byteswillprops4[] = {0x13, 0xf5, 0xeb, 0x73, 0x1f, 0xf6, 0xe2, 0xcd, 0x47, 0x9f, 0x6e, 0x64,
                               0xdc, 0xf8, 0x67, 0x2d, 0xc3, 0x63, 0xde, 0xb9, 0xa3, 0xb2, 0x67};
  uint8_t byteswillprops5[] = {0x38, 0xe6, 0xb2, 0x6a, 0x70, 0xf3, 0x99, 0xe3, 0xeb, 0x9a, 0x34, 0x2d, 0x32, 0xd6,
                               0x23, 0x91, 0x58, 0x99, 0xb9, 0xaf, 0xc7, 0x22, 0xa6, 0x73, 0x12, 0xcf, 0x40};
  uint8_t byteswillprops6[] = {0x1a, 0x67, 0x3e, 0x5c, 0xb, 0x7a, 0xce, 0xf7, 0xc, 0x4c,
                               0xbd, 0xb0, 0xca, 0x81, 0x4, 0xd3, 0x37, 0x86, 0xd};
  uint8_t byteswillprops7[] = {0x38, 0xa9, 0x7f, 0xcd, 0xe9, 0x99, 0x83, 0xc0,
                               0xbf, 0x84, 0xe6, 0xa5, 0xfc, 0x6c, 0x11, 0x9d};
  uint8_t byteswillprops8[] = {0xc9, 0x59, 0x77, 0x46, 0x24, 0x25, 0x89, 0x0, 0xe6, 0x5, 0x55, 0x4d, 0xdb, 0xdc, 0x73};
  uint8_t byteswillprops10[] = {0xca, 0x22, 0xff, 0xd2, 0xe1};
  uint8_t byteswillprops9[] = {0xa9, 0x95, 0xd7, 0xc5, 0x81, 0x7e, 0xba, 0xc2, 0xed, 0x26, 0x13, 0xb4, 0x82, 0xb3, 0xf8,
                               0xe9, 0xd7, 0x60, 0xc2, 0xad, 0xa7, 0xa4, 0x9d, 0x94, 0xd1, 0xc,  0x9b, 0x73, 0x17};
  uint8_t byteswillprops11[] = {0xcd, 0xbf, 0x69, 0x3a, 0xb4};
  uint8_t byteswillprops13[] = {0xe2, 0xb2};
  uint8_t byteswillprops12[] = {0x88, 0x81, 0xf7, 0x3e, 0x0,  0x53, 0xe6, 0x38,
                                0x5e, 0xab, 0x72, 0xed, 0xd5, 0x6d, 0x6b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12776}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19508}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26213}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12131}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {29, (char*)&byteswillprops9}, .v = {5, (char*)&byteswillprops10}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {15, (char*)&byteswillprops12}, .v = {2, (char*)&byteswillprops13}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2449}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 14}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x77, 0x39, 0xd9, 0x79, 0x4d, 0xba, 0xa1, 0xa6, 0x67, 0x88, 0x8c, 0x9a, 0xb2, 0x16,
                                  0x35, 0x96, 0xe4, 0xd4, 0x1c, 0x48, 0x50, 0xeb, 0xca, 0xe0, 0xf2, 0x44, 0x3b};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6302;
  uint8_t client_id_bytes[] = {0x35, 0xaf, 0xaf, 0xb5, 0x27, 0x48, 0xad, 0xa1, 0x5b,
                               0x9d, 0x38, 0xaf, 0x42, 0x59, 0xb6, 0x7c, 0xb3};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x3c, 0xa,  0x95, 0x52, 0x30, 0x5c, 0xd8, 0x4b, 0x15,
                              0x9d, 0xef, 0xbb, 0x62, 0xf3, 0xac, 0x15, 0x55};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7x\204\136o\US\ESC\232\vI\211", _password = Just "m", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 16891, _connID = "\152\237\162\129\182]", _properties = [PropSessionExpiryInterval
// 9597,PropTopicAliasMaximum 2865,PropWildcardSubscriptionAvailable 99,PropRequestProblemInformation
// 104,PropAuthenticationMethod
// "\STX\212\ESCFo\170a\162\220\143\177\131\218\144\ENQ\239R\RS\215\138\DLEJ\200B\237\166\168",PropAuthenticationMethod
// "\160\209\173T\ETX\140\184\247\137\213\DLEp9'y2\147",PropWildcardSubscriptionAvailable 84,PropSubscriptionIdentifier
// 28,PropRequestProblemInformation 6,PropTopicAliasMaximum 3045,PropResponseTopic "",PropCorrelationData
// "\250<H\133N{\135\STXV\217\198XG\205\192\244\v"]}
TEST(Connect5QCTest, Encode55) {
  uint8_t pkt[] = {0x10, 0x81, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x41, 0xfb, 0x5e, 0x11, 0x0,  0x0,
                   0x25, 0x7d, 0x22, 0xb,  0x31, 0x28, 0x63, 0x17, 0x68, 0x15, 0x0,  0x1b, 0x2,  0xd4, 0x1b, 0x46, 0x6f,
                   0xaa, 0x61, 0xa2, 0xdc, 0x8f, 0xb1, 0x83, 0xda, 0x90, 0x5,  0xef, 0x52, 0x1e, 0xd7, 0x8a, 0x10, 0x4a,
                   0xc8, 0x42, 0xed, 0xa6, 0xa8, 0x15, 0x0,  0x11, 0xa0, 0xd1, 0xad, 0x54, 0x3,  0x8c, 0xb8, 0xf7, 0x89,
                   0xd5, 0x10, 0x70, 0x39, 0x27, 0x79, 0x32, 0x93, 0x28, 0x54, 0xb,  0x1c, 0x17, 0x6,  0x22, 0xb,  0xe5,
                   0x8,  0x0,  0x0,  0x9,  0x0,  0x11, 0xfa, 0x3c, 0x48, 0x85, 0x4e, 0x7b, 0x87, 0x2,  0x56, 0xd9, 0xc6,
                   0x58, 0x47, 0xcd, 0xc0, 0xf4, 0xb,  0x0,  0x6,  0x98, 0xed, 0xa2, 0x81, 0xb6, 0x5d, 0x0,  0xb,  0x37,
                   0x78, 0xcc, 0x88, 0x6f, 0x1f, 0x1b, 0xe8, 0xb,  0x49, 0xd3, 0x0,  0x1,  0x6d};

  uint8_t buf[142] = {0};

  uint8_t bytesprops0[] = {0x2, 0xd4, 0x1b, 0x46, 0x6f, 0xaa, 0x61, 0xa2, 0xdc, 0x8f, 0xb1, 0x83, 0xda, 0x90,
                           0x5, 0xef, 0x52, 0x1e, 0xd7, 0x8a, 0x10, 0x4a, 0xc8, 0x42, 0xed, 0xa6, 0xa8};
  uint8_t bytesprops1[] = {0xa0, 0xd1, 0xad, 0x54, 0x3,  0x8c, 0xb8, 0xf7, 0x89,
                           0xd5, 0x10, 0x70, 0x39, 0x27, 0x79, 0x32, 0x93};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0xfa, 0x3c, 0x48, 0x85, 0x4e, 0x7b, 0x87, 0x2, 0x56,
                           0xd9, 0xc6, 0x58, 0x47, 0xcd, 0xc0, 0xf4, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9597}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2865}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3045}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16891;
  uint8_t client_id_bytes[] = {0x98, 0xed, 0xa2, 0x81, 0xb6, 0x5d};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x78, 0xcc, 0x88, 0x6f, 0x1f, 0x1b, 0xe8, 0xb, 0x49, 0xd3};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\189J\246\DC4Ep\136e]\182\253\DEL\n\DC2\"\\\134&\162\252D\144", _password =
// Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 32242, _connID =
// "\218P?\172\167\243\&3_s\246\DC4\EOT\EM\139\169\186?", _properties = [PropServerReference
// "\188F\185\163&7\138\154\202\181<\202\238\&3]\233\217\141\184<\166\160&\208\151W",PropMessageExpiryInterval
// 10796,PropReasonString "M\SIee\213\ENQ\217\187\174\DEL",PropContentType
// "\193\231K\165\130\206;(\190\245\228\159Rt",PropUserProperty
// "W\254\226\246\SYN\252d\248\199qnG\240\200|\233\250)\159\177_J\"" "\184\220",PropAuthenticationData
// "J\133\229\&6\253\&5\247rR\219.\163\254g\134\161\220\214x\135\237@\NAK",PropAuthenticationData
// "\184\246\189\SIKs\216\128\186\SUBR\139Airi\152\156\n\206\197\f\185",PropSharedSubscriptionAvailable 71]}
TEST(Connect5QCTest, Encode56) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x7d, 0xf2, 0x94, 0x1,  0x1c, 0x0,  0x1a, 0xbc,
      0x46, 0xb9, 0xa3, 0x26, 0x37, 0x8a, 0x9a, 0xca, 0xb5, 0x3c, 0xca, 0xee, 0x33, 0x5d, 0xe9, 0xd9, 0x8d, 0xb8, 0x3c,
      0xa6, 0xa0, 0x26, 0xd0, 0x97, 0x57, 0x2,  0x0,  0x0,  0x2a, 0x2c, 0x1f, 0x0,  0xa,  0x4d, 0xf,  0x65, 0x65, 0xd5,
      0x5,  0xd9, 0xbb, 0xae, 0x7f, 0x3,  0x0,  0xe,  0xc1, 0xe7, 0x4b, 0xa5, 0x82, 0xce, 0x3b, 0x28, 0xbe, 0xf5, 0xe4,
      0x9f, 0x52, 0x74, 0x26, 0x0,  0x17, 0x57, 0xfe, 0xe2, 0xf6, 0x16, 0xfc, 0x64, 0xf8, 0xc7, 0x71, 0x6e, 0x47, 0xf0,
      0xc8, 0x7c, 0xe9, 0xfa, 0x29, 0x9f, 0xb1, 0x5f, 0x4a, 0x22, 0x0,  0x2,  0xb8, 0xdc, 0x16, 0x0,  0x17, 0x4a, 0x85,
      0xe5, 0x36, 0xfd, 0x35, 0xf7, 0x72, 0x52, 0xdb, 0x2e, 0xa3, 0xfe, 0x67, 0x86, 0xa1, 0xdc, 0xd6, 0x78, 0x87, 0xed,
      0x40, 0x15, 0x16, 0x0,  0x17, 0xb8, 0xf6, 0xbd, 0xf,  0x4b, 0x73, 0xd8, 0x80, 0xba, 0x1a, 0x52, 0x8b, 0x41, 0x69,
      0x72, 0x69, 0x98, 0x9c, 0xa,  0xce, 0xc5, 0xc,  0xb9, 0x2a, 0x47, 0x0,  0x11, 0xda, 0x50, 0x3f, 0xac, 0xa7, 0xf3,
      0x33, 0x5f, 0x73, 0xf6, 0x14, 0x4,  0x19, 0x8b, 0xa9, 0xba, 0x3f, 0x0,  0x16, 0xbd, 0x4a, 0xf6, 0x14, 0x45, 0x70,
      0x88, 0x65, 0x5d, 0xb6, 0xfd, 0x7f, 0xa,  0x12, 0x22, 0x5c, 0x86, 0x26, 0xa2, 0xfc, 0x44, 0x90};

  uint8_t buf[216] = {0};

  uint8_t bytesprops0[] = {0xbc, 0x46, 0xb9, 0xa3, 0x26, 0x37, 0x8a, 0x9a, 0xca, 0xb5, 0x3c, 0xca, 0xee,
                           0x33, 0x5d, 0xe9, 0xd9, 0x8d, 0xb8, 0x3c, 0xa6, 0xa0, 0x26, 0xd0, 0x97, 0x57};
  uint8_t bytesprops1[] = {0x4d, 0xf, 0x65, 0x65, 0xd5, 0x5, 0xd9, 0xbb, 0xae, 0x7f};
  uint8_t bytesprops2[] = {0xc1, 0xe7, 0x4b, 0xa5, 0x82, 0xce, 0x3b, 0x28, 0xbe, 0xf5, 0xe4, 0x9f, 0x52, 0x74};
  uint8_t bytesprops4[] = {0xb8, 0xdc};
  uint8_t bytesprops3[] = {0x57, 0xfe, 0xe2, 0xf6, 0x16, 0xfc, 0x64, 0xf8, 0xc7, 0x71, 0x6e, 0x47,
                           0xf0, 0xc8, 0x7c, 0xe9, 0xfa, 0x29, 0x9f, 0xb1, 0x5f, 0x4a, 0x22};
  uint8_t bytesprops5[] = {0x4a, 0x85, 0xe5, 0x36, 0xfd, 0x35, 0xf7, 0x72, 0x52, 0xdb, 0x2e, 0xa3,
                           0xfe, 0x67, 0x86, 0xa1, 0xdc, 0xd6, 0x78, 0x87, 0xed, 0x40, 0x15};
  uint8_t bytesprops6[] = {0xb8, 0xf6, 0xbd, 0xf,  0x4b, 0x73, 0xd8, 0x80, 0xba, 0x1a, 0x52, 0x8b,
                           0x41, 0x69, 0x72, 0x69, 0x98, 0x9c, 0xa,  0xce, 0xc5, 0xc,  0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10796}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops3}, .v = {2, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 71}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32242;
  uint8_t client_id_bytes[] = {0xda, 0x50, 0x3f, 0xac, 0xa7, 0xf3, 0x33, 0x5f, 0x73,
                               0xf6, 0x14, 0x4,  0x19, 0x8b, 0xa9, 0xba, 0x3f};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbd, 0x4a, 0xf6, 0x14, 0x45, 0x70, 0x88, 0x65, 0x5d, 0xb6, 0xfd,
                              0x7f, 0xa,  0x12, 0x22, 0x5c, 0x86, 0x26, 0xa2, 0xfc, 0x44, 0x90};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Au`\168A\188\232\r\137)\223\STX\199%\136", _password = Just
// "d\160\254\DEL\EOT\147\231-\152", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\199M\"\227Xv\NUL", _willMsg = "\201Z\208~\134\159\213", _willProps = [PropWildcardSubscriptionAvailable
// 1,PropSharedSubscriptionAvailable 234,PropWildcardSubscriptionAvailable 83,PropReasonString
// "6T:e\228\200\150\255\SOH\185\146\173\r\DC1%a"]}), _cleanSession = True, _keepAlive = 16538, _connID =
// "\ENQ\184\173\135\NAK", _properties = [PropPayloadFormatIndicator 164,PropMaximumPacketSize
// 20180,PropResponseInformation
// "\152Q-\252\168x\GS\217\&1\246\219\167R\219\235\&7~\DC1\179\235S\187`\240\142\GS",PropTopicAlias 5781,PropTopicAlias
// 2246,PropServerKeepAlive 16492,PropSubscriptionIdentifierAvailable 48,PropAssignedClientIdentifier
// "\158\187T",PropRetainAvailable 44,PropAuthenticationData
// "J\169\SUB\DC3\185\134\240]\250",PropSubscriptionIdentifierAvailable 114,PropWildcardSubscriptionAvailable
// 156,PropUserProperty "\202\134\134\168\193" "\181o\215r\EOT\192",PropWillDelayInterval 18762,PropAuthenticationMethod
// "\b\EOT\217\195\145\131\212y\209\215\214\NUL\144\209\SI5$J\190",PropRequestProblemInformation
// 52,PropAssignedClientIdentifier "{\132\RS\154@\151\&9\137\210\162\252\180\240eDT\238\193\173\200",PropCorrelationData
// "\CAN*\238\SUB\189\146\154\228\"",PropMessageExpiryInterval 25115,PropSharedSubscriptionAvailable 24,PropMaximumQoS
// 215,PropCorrelationData "\251\f\238\250\222\&3\ETBM\DC4\225?\EOTI@\184\211",PropMaximumPacketSize
// 4863,PropServerReference "\SUBB\212U\209\157Bi\227xh\163\250\228\&8\228\202\163k\DC4",PropTopicAlias
// 30253,PropContentType "\221\f\207\&6O_\GSY'\DC1\218\136\159\228\170{I\247\DC1\nA\148p5\234",PropTopicAlias
// 7267,PropServerKeepAlive 18307]}
TEST(Connect5QCTest, Encode57) {
  uint8_t pkt[] = {
      0x10, 0xcf, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x40, 0x9a, 0xf4, 0x1,  0x1,  0xa4, 0x27, 0x0,
      0x0,  0x4e, 0xd4, 0x1a, 0x0,  0x1a, 0x98, 0x51, 0x2d, 0xfc, 0xa8, 0x78, 0x1d, 0xd9, 0x31, 0xf6, 0xdb, 0xa7, 0x52,
      0xdb, 0xeb, 0x37, 0x7e, 0x11, 0xb3, 0xeb, 0x53, 0xbb, 0x60, 0xf0, 0x8e, 0x1d, 0x23, 0x16, 0x95, 0x23, 0x8,  0xc6,
      0x13, 0x40, 0x6c, 0x29, 0x30, 0x12, 0x0,  0x3,  0x9e, 0xbb, 0x54, 0x25, 0x2c, 0x16, 0x0,  0x9,  0x4a, 0xa9, 0x1a,
      0x13, 0xb9, 0x86, 0xf0, 0x5d, 0xfa, 0x29, 0x72, 0x28, 0x9c, 0x26, 0x0,  0x5,  0xca, 0x86, 0x86, 0xa8, 0xc1, 0x0,
      0x6,  0xb5, 0x6f, 0xd7, 0x72, 0x4,  0xc0, 0x18, 0x0,  0x0,  0x49, 0x4a, 0x15, 0x0,  0x13, 0x8,  0x4,  0xd9, 0xc3,
      0x91, 0x83, 0xd4, 0x79, 0xd1, 0xd7, 0xd6, 0x0,  0x90, 0xd1, 0xf,  0x35, 0x24, 0x4a, 0xbe, 0x17, 0x34, 0x12, 0x0,
      0x14, 0x7b, 0x84, 0x1e, 0x9a, 0x40, 0x97, 0x39, 0x89, 0xd2, 0xa2, 0xfc, 0xb4, 0xf0, 0x65, 0x44, 0x54, 0xee, 0xc1,
      0xad, 0xc8, 0x9,  0x0,  0x9,  0x18, 0x2a, 0xee, 0x1a, 0xbd, 0x92, 0x9a, 0xe4, 0x22, 0x2,  0x0,  0x0,  0x62, 0x1b,
      0x2a, 0x18, 0x24, 0xd7, 0x9,  0x0,  0x10, 0xfb, 0xc,  0xee, 0xfa, 0xde, 0x33, 0x17, 0x4d, 0x14, 0xe1, 0x3f, 0x4,
      0x49, 0x40, 0xb8, 0xd3, 0x27, 0x0,  0x0,  0x12, 0xff, 0x1c, 0x0,  0x14, 0x1a, 0x42, 0xd4, 0x55, 0xd1, 0x9d, 0x42,
      0x69, 0xe3, 0x78, 0x68, 0xa3, 0xfa, 0xe4, 0x38, 0xe4, 0xca, 0xa3, 0x6b, 0x14, 0x23, 0x76, 0x2d, 0x3,  0x0,  0x19,
      0xdd, 0xc,  0xcf, 0x36, 0x4f, 0x5f, 0x1d, 0x59, 0x27, 0x11, 0xda, 0x88, 0x9f, 0xe4, 0xaa, 0x7b, 0x49, 0xf7, 0x11,
      0xa,  0x41, 0x94, 0x70, 0x35, 0xea, 0x23, 0x1c, 0x63, 0x13, 0x47, 0x83, 0x0,  0x5,  0x5,  0xb8, 0xad, 0x87, 0x15,
      0x19, 0x28, 0x1,  0x2a, 0xea, 0x28, 0x53, 0x1f, 0x0,  0x10, 0x36, 0x54, 0x3a, 0x65, 0xe4, 0xc8, 0x96, 0xff, 0x1,
      0xb9, 0x92, 0xad, 0xd,  0x11, 0x25, 0x61, 0x0,  0x7,  0xc7, 0x4d, 0x22, 0xe3, 0x58, 0x76, 0x0,  0x0,  0x7,  0xc9,
      0x5a, 0xd0, 0x7e, 0x86, 0x9f, 0xd5, 0x0,  0xf,  0x41, 0x75, 0x60, 0xa8, 0x41, 0xbc, 0xe8, 0xd,  0x89, 0x29, 0xdf,
      0x2,  0xc7, 0x25, 0x88, 0x0,  0x9,  0x64, 0xa0, 0xfe, 0x7f, 0x4,  0x93, 0xe7, 0x2d, 0x98};

  uint8_t buf[348] = {0};

  uint8_t bytesprops0[] = {0x98, 0x51, 0x2d, 0xfc, 0xa8, 0x78, 0x1d, 0xd9, 0x31, 0xf6, 0xdb, 0xa7, 0x52,
                           0xdb, 0xeb, 0x37, 0x7e, 0x11, 0xb3, 0xeb, 0x53, 0xbb, 0x60, 0xf0, 0x8e, 0x1d};
  uint8_t bytesprops1[] = {0x9e, 0xbb, 0x54};
  uint8_t bytesprops2[] = {0x4a, 0xa9, 0x1a, 0x13, 0xb9, 0x86, 0xf0, 0x5d, 0xfa};
  uint8_t bytesprops4[] = {0xb5, 0x6f, 0xd7, 0x72, 0x4, 0xc0};
  uint8_t bytesprops3[] = {0xca, 0x86, 0x86, 0xa8, 0xc1};
  uint8_t bytesprops5[] = {0x8,  0x4, 0xd9, 0xc3, 0x91, 0x83, 0xd4, 0x79, 0xd1, 0xd7,
                           0xd6, 0x0, 0x90, 0xd1, 0xf,  0x35, 0x24, 0x4a, 0xbe};
  uint8_t bytesprops6[] = {0x7b, 0x84, 0x1e, 0x9a, 0x40, 0x97, 0x39, 0x89, 0xd2, 0xa2,
                           0xfc, 0xb4, 0xf0, 0x65, 0x44, 0x54, 0xee, 0xc1, 0xad, 0xc8};
  uint8_t bytesprops7[] = {0x18, 0x2a, 0xee, 0x1a, 0xbd, 0x92, 0x9a, 0xe4, 0x22};
  uint8_t bytesprops8[] = {0xfb, 0xc,  0xee, 0xfa, 0xde, 0x33, 0x17, 0x4d,
                           0x14, 0xe1, 0x3f, 0x4,  0x49, 0x40, 0xb8, 0xd3};
  uint8_t bytesprops9[] = {0x1a, 0x42, 0xd4, 0x55, 0xd1, 0x9d, 0x42, 0x69, 0xe3, 0x78,
                           0x68, 0xa3, 0xfa, 0xe4, 0x38, 0xe4, 0xca, 0xa3, 0x6b, 0x14};
  uint8_t bytesprops10[] = {0xdd, 0xc,  0xcf, 0x36, 0x4f, 0x5f, 0x1d, 0x59, 0x27, 0x11, 0xda, 0x88, 0x9f,
                            0xe4, 0xaa, 0x7b, 0x49, 0xf7, 0x11, 0xa,  0x41, 0x94, 0x70, 0x35, 0xea};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20180}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5781}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2246}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16492}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops3}, .v = {6, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18762}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25115}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4863}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30253}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7267}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18307}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x36, 0x54, 0x3a, 0x65, 0xe4, 0xc8, 0x96, 0xff,
                               0x1,  0xb9, 0x92, 0xad, 0xd,  0x11, 0x25, 0x61};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x4d, 0x22, 0xe3, 0x58, 0x76, 0x0};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc9, 0x5a, 0xd0, 0x7e, 0x86, 0x9f, 0xd5};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16538;
  uint8_t client_id_bytes[] = {0x5, 0xb8, 0xad, 0x87, 0x15};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0x75, 0x60, 0xa8, 0x41, 0xbc, 0xe8, 0xd, 0x89, 0x29, 0xdf, 0x2, 0xc7, 0x25, 0x88};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0xa0, 0xfe, 0x7f, 0x4, 0x93, 0xe7, 0x2d, 0x98};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "I", _password = Just
// "\187\133u\SYN\172\178^\135<\224\244\171\211k\255\158\148\EOT\255\STX1\SI\184", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic =
// "s\241\244i\ETX6\STXo?H<\137\172\RS\203\US\236\ESC\214\218\&9\SIg.", _willMsg =
// "\242en\210E\149\254\131\167\&8\178\242\SOH@#)\215\245\175\160\206e\EMy", _willProps = [PropTopicAlias
// 11876,PropRequestProblemInformation 18,PropAuthenticationMethod
// "/P'\160z\141\v^)\217\204\181\SOH",PropMessageExpiryInterval 5500]}), _cleanSession = True, _keepAlive = 29587,
// _connID = "\192\178\157\213%\235i\USou\STX\245\201\145\\>J", _properties = [PropAuthenticationData
// "b\174\SI\228\253Y\228a\STX\228\251\238\226\EOT\193C\vw\156F\218\181",PropSubscriptionIdentifierAvailable
// 128,PropPayloadFormatIndicator 81,PropWillDelayInterval 13410,PropSubscriptionIdentifierAvailable
// 66,PropResponseTopic "\166e\GSS\213\173\184i]\192C\172\164\223\155",PropRetainAvailable 12,PropAuthenticationMethod
// "G0\186[ \164\219me\160\174\135U\247A`\RSy]n\134\247Mxy^",PropCorrelationData "",PropMessageExpiryInterval
// 11632,PropTopicAlias 4247,PropTopicAliasMaximum 25784,PropSessionExpiryInterval
// 22216,PropSubscriptionIdentifierAvailable 186,PropResponseTopic
// "\US]}C#+\252\158\202\140l\n\247v\DLEv",PropTopicAliasMaximum 24907,PropServerReference
// "846G\214\157\139qa\130q\160-)\178:%HNiX",PropTopicAlias 24440,PropRetainAvailable 167,PropServerKeepAlive
// 492,PropAuthenticationData "\185m\143\196)\176\157",PropReasonString
// "\255\193,\204\SI\232\249J\vT\178\n\141{\220",PropCorrelationData
// "M\185\190\220\134\201s\215g\230\DC2\165\172\220\136\208$\158GP\237X",PropRequestResponseInformation
// 211,PropAuthenticationMethod "nnWU\147i\DC3\133\218{/ Qx`",PropSubscriptionIdentifier 20,PropServerKeepAlive
// 23203,PropResponseInformation "\SOT\DEL\161\248\NUL\188\254",PropResponseTopic
// "\163\176\168\224b\251\178\140-\179\202\&2\138\b\194[\NULS4\167\&5\146\248\171\222",PropSubscriptionIdentifier 11]}
TEST(Connect5QCTest, Encode58) {
  uint8_t pkt[] = {
      0x10, 0xa1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x73, 0x93, 0x97, 0x2,  0x16, 0x0,  0x16, 0x62,
      0xae, 0xf,  0xe4, 0xfd, 0x59, 0xe4, 0x61, 0x2,  0xe4, 0xfb, 0xee, 0xe2, 0x4,  0xc1, 0x43, 0xb,  0x77, 0x9c, 0x46,
      0xda, 0xb5, 0x29, 0x80, 0x1,  0x51, 0x18, 0x0,  0x0,  0x34, 0x62, 0x29, 0x42, 0x8,  0x0,  0xf,  0xa6, 0x65, 0x1d,
      0x53, 0xd5, 0xad, 0xb8, 0x69, 0x5d, 0xc0, 0x43, 0xac, 0xa4, 0xdf, 0x9b, 0x25, 0xc,  0x15, 0x0,  0x1a, 0x47, 0x30,
      0xba, 0x5b, 0x20, 0xa4, 0xdb, 0x6d, 0x65, 0xa0, 0xae, 0x87, 0x55, 0xf7, 0x41, 0x60, 0x1e, 0x79, 0x5d, 0x6e, 0x86,
      0xf7, 0x4d, 0x78, 0x79, 0x5e, 0x9,  0x0,  0x0,  0x2,  0x0,  0x0,  0x2d, 0x70, 0x23, 0x10, 0x97, 0x22, 0x64, 0xb8,
      0x11, 0x0,  0x0,  0x56, 0xc8, 0x29, 0xba, 0x8,  0x0,  0x10, 0x1f, 0x5d, 0x7d, 0x43, 0x23, 0x2b, 0xfc, 0x9e, 0xca,
      0x8c, 0x6c, 0xa,  0xf7, 0x76, 0x10, 0x76, 0x22, 0x61, 0x4b, 0x1c, 0x0,  0x15, 0x38, 0x34, 0x36, 0x47, 0xd6, 0x9d,
      0x8b, 0x71, 0x61, 0x82, 0x71, 0xa0, 0x2d, 0x29, 0xb2, 0x3a, 0x25, 0x48, 0x4e, 0x69, 0x58, 0x23, 0x5f, 0x78, 0x25,
      0xa7, 0x13, 0x1,  0xec, 0x16, 0x0,  0x7,  0xb9, 0x6d, 0x8f, 0xc4, 0x29, 0xb0, 0x9d, 0x1f, 0x0,  0xf,  0xff, 0xc1,
      0x2c, 0xcc, 0xf,  0xe8, 0xf9, 0x4a, 0xb,  0x54, 0xb2, 0xa,  0x8d, 0x7b, 0xdc, 0x9,  0x0,  0x16, 0x4d, 0xb9, 0xbe,
      0xdc, 0x86, 0xc9, 0x73, 0xd7, 0x67, 0xe6, 0x12, 0xa5, 0xac, 0xdc, 0x88, 0xd0, 0x24, 0x9e, 0x47, 0x50, 0xed, 0x58,
      0x19, 0xd3, 0x15, 0x0,  0xf,  0x6e, 0x6e, 0x57, 0x55, 0x93, 0x69, 0x13, 0x85, 0xda, 0x7b, 0x2f, 0x20, 0x51, 0x78,
      0x60, 0xb,  0x14, 0x13, 0x5a, 0xa3, 0x1a, 0x0,  0x8,  0xe,  0x54, 0x7f, 0xa1, 0xf8, 0x0,  0xbc, 0xfe, 0x8,  0x0,
      0x19, 0xa3, 0xb0, 0xa8, 0xe0, 0x62, 0xfb, 0xb2, 0x8c, 0x2d, 0xb3, 0xca, 0x32, 0x8a, 0x8,  0xc2, 0x5b, 0x0,  0x53,
      0x34, 0xa7, 0x35, 0x92, 0xf8, 0xab, 0xde, 0xb,  0xb,  0x0,  0x11, 0xc0, 0xb2, 0x9d, 0xd5, 0x25, 0xeb, 0x69, 0x1f,
      0x6f, 0x75, 0x2,  0xf5, 0xc9, 0x91, 0x5c, 0x3e, 0x4a, 0x1a, 0x23, 0x2e, 0x64, 0x17, 0x12, 0x15, 0x0,  0xd,  0x2f,
      0x50, 0x27, 0xa0, 0x7a, 0x8d, 0xb,  0x5e, 0x29, 0xd9, 0xcc, 0xb5, 0x1,  0x2,  0x0,  0x0,  0x15, 0x7c, 0x0,  0x18,
      0x73, 0xf1, 0xf4, 0x69, 0x3,  0x36, 0x2,  0x6f, 0x3f, 0x48, 0x3c, 0x89, 0xac, 0x1e, 0xcb, 0x1f, 0xec, 0x1b, 0xd6,
      0xda, 0x39, 0xf,  0x67, 0x2e, 0x0,  0x18, 0xf2, 0x65, 0x6e, 0xd2, 0x45, 0x95, 0xfe, 0x83, 0xa7, 0x38, 0xb2, 0xf2,
      0x1,  0x40, 0x23, 0x29, 0xd7, 0xf5, 0xaf, 0xa0, 0xce, 0x65, 0x19, 0x79, 0x0,  0x1,  0x49, 0x0,  0x17, 0xbb, 0x85,
      0x75, 0x16, 0xac, 0xb2, 0x5e, 0x87, 0x3c, 0xe0, 0xf4, 0xab, 0xd3, 0x6b, 0xff, 0x9e, 0x94, 0x4,  0xff, 0x2,  0x31,
      0xf,  0xb8};

  uint8_t buf[430] = {0};

  uint8_t bytesprops0[] = {0x62, 0xae, 0xf, 0xe4, 0xfd, 0x59, 0xe4, 0x61, 0x2,  0xe4, 0xfb,
                           0xee, 0xe2, 0x4, 0xc1, 0x43, 0xb,  0x77, 0x9c, 0x46, 0xda, 0xb5};
  uint8_t bytesprops1[] = {0xa6, 0x65, 0x1d, 0x53, 0xd5, 0xad, 0xb8, 0x69, 0x5d, 0xc0, 0x43, 0xac, 0xa4, 0xdf, 0x9b};
  uint8_t bytesprops2[] = {0x47, 0x30, 0xba, 0x5b, 0x20, 0xa4, 0xdb, 0x6d, 0x65, 0xa0, 0xae, 0x87, 0x55,
                           0xf7, 0x41, 0x60, 0x1e, 0x79, 0x5d, 0x6e, 0x86, 0xf7, 0x4d, 0x78, 0x79, 0x5e};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x1f, 0x5d, 0x7d, 0x43, 0x23, 0x2b, 0xfc, 0x9e,
                           0xca, 0x8c, 0x6c, 0xa,  0xf7, 0x76, 0x10, 0x76};
  uint8_t bytesprops5[] = {0x38, 0x34, 0x36, 0x47, 0xd6, 0x9d, 0x8b, 0x71, 0x61, 0x82, 0x71,
                           0xa0, 0x2d, 0x29, 0xb2, 0x3a, 0x25, 0x48, 0x4e, 0x69, 0x58};
  uint8_t bytesprops6[] = {0xb9, 0x6d, 0x8f, 0xc4, 0x29, 0xb0, 0x9d};
  uint8_t bytesprops7[] = {0xff, 0xc1, 0x2c, 0xcc, 0xf, 0xe8, 0xf9, 0x4a, 0xb, 0x54, 0xb2, 0xa, 0x8d, 0x7b, 0xdc};
  uint8_t bytesprops8[] = {0x4d, 0xb9, 0xbe, 0xdc, 0x86, 0xc9, 0x73, 0xd7, 0x67, 0xe6, 0x12,
                           0xa5, 0xac, 0xdc, 0x88, 0xd0, 0x24, 0x9e, 0x47, 0x50, 0xed, 0x58};
  uint8_t bytesprops9[] = {0x6e, 0x6e, 0x57, 0x55, 0x93, 0x69, 0x13, 0x85, 0xda, 0x7b, 0x2f, 0x20, 0x51, 0x78, 0x60};
  uint8_t bytesprops10[] = {0xe, 0x54, 0x7f, 0xa1, 0xf8, 0x0, 0xbc, 0xfe};
  uint8_t bytesprops11[] = {0xa3, 0xb0, 0xa8, 0xe0, 0x62, 0xfb, 0xb2, 0x8c, 0x2d, 0xb3, 0xca, 0x32, 0x8a,
                            0x8,  0xc2, 0x5b, 0x0,  0x53, 0x34, 0xa7, 0x35, 0x92, 0xf8, 0xab, 0xde};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13410}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11632}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4247}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25784}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22216}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24907}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24440}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 492}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23203}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x2f, 0x50, 0x27, 0xa0, 0x7a, 0x8d, 0xb, 0x5e, 0x29, 0xd9, 0xcc, 0xb5, 0x1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11876}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5500}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x73, 0xf1, 0xf4, 0x69, 0x3,  0x36, 0x2,  0x6f, 0x3f, 0x48, 0x3c, 0x89,
                                0xac, 0x1e, 0xcb, 0x1f, 0xec, 0x1b, 0xd6, 0xda, 0x39, 0xf,  0x67, 0x2e};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0x65, 0x6e, 0xd2, 0x45, 0x95, 0xfe, 0x83, 0xa7, 0x38, 0xb2, 0xf2,
                                  0x1,  0x40, 0x23, 0x29, 0xd7, 0xf5, 0xaf, 0xa0, 0xce, 0x65, 0x19, 0x79};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29587;
  uint8_t client_id_bytes[] = {0xc0, 0xb2, 0x9d, 0xd5, 0x25, 0xeb, 0x69, 0x1f, 0x6f,
                               0x75, 0x2,  0xf5, 0xc9, 0x91, 0x5c, 0x3e, 0x4a};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbb, 0x85, 0x75, 0x16, 0xac, 0xb2, 0x5e, 0x87, 0x3c, 0xe0, 0xf4, 0xab,
                              0xd3, 0x6b, 0xff, 0x9e, 0x94, 0x4,  0xff, 0x2,  0x31, 0xf,  0xb8};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 12978, _connID = "\160X\221W2^\230o\163\&7\179s\156", _properties = [PropRequestProblemInformation 57,PropContentType
// "\173\183\&2/\191\190\231H\246&\187\STX\SOHr\172\215\252\EOT\211F\252\186\166",PropSubscriptionIdentifier
// 27,PropServerKeepAlive 12736,PropAuthenticationMethod "\SOH
// \178\245:\244\180\&0\146\145",PropAssignedClientIdentifier "\163\209\168X",PropCorrelationData
// ".\243\149\144\131R\EM)\fn\SOm\202",PropContentType "\138\243\184\SYNH\140\155\224\183",PropRetainAvailable
// 195,PropRetainAvailable 250,PropUserProperty "\167\&8\194j\CAN \"\153\166:\215\146 M4\203"
// "\135\216\142\217{\245\228Q",PropResponseInformation "Q\DC3\GS\173\134+mH\CAN3\SOGi\146\DC2_0\148\145\179"]}
TEST(Connect5QCTest, Encode59) {
  uint8_t pkt[] = {0x10, 0xa4, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x32, 0xb2, 0x89, 0x1,  0x17, 0x39,
                   0x3,  0x0,  0x17, 0xad, 0xb7, 0x32, 0x2f, 0xbf, 0xbe, 0xe7, 0x48, 0xf6, 0x26, 0xbb, 0x2,  0x1,  0x72,
                   0xac, 0xd7, 0xfc, 0x4,  0xd3, 0x46, 0xfc, 0xba, 0xa6, 0xb,  0x1b, 0x13, 0x31, 0xc0, 0x15, 0x0,  0xa,
                   0x1,  0x20, 0xb2, 0xf5, 0x3a, 0xf4, 0xb4, 0x30, 0x92, 0x91, 0x12, 0x0,  0x4,  0xa3, 0xd1, 0xa8, 0x58,
                   0x9,  0x0,  0xd,  0x2e, 0xf3, 0x95, 0x90, 0x83, 0x52, 0x19, 0x29, 0xc,  0x6e, 0xe,  0x6d, 0xca, 0x3,
                   0x0,  0x9,  0x8a, 0xf3, 0xb8, 0x16, 0x48, 0x8c, 0x9b, 0xe0, 0xb7, 0x25, 0xc3, 0x25, 0xfa, 0x26, 0x0,
                   0x10, 0xa7, 0x38, 0xc2, 0x6a, 0x18, 0x20, 0x22, 0x99, 0xa6, 0x3a, 0xd7, 0x92, 0x20, 0x4d, 0x34, 0xcb,
                   0x0,  0x8,  0x87, 0xd8, 0x8e, 0xd9, 0x7b, 0xf5, 0xe4, 0x51, 0x1a, 0x0,  0x14, 0x51, 0x13, 0x1d, 0xad,
                   0x86, 0x2b, 0x6d, 0x48, 0x18, 0x33, 0xe,  0x47, 0x69, 0x92, 0x12, 0x5f, 0x30, 0x94, 0x91, 0xb3, 0x0,
                   0xd,  0xa0, 0x58, 0xdd, 0x57, 0x32, 0x5e, 0xe6, 0x6f, 0xa3, 0x37, 0xb3, 0x73, 0x9c};

  uint8_t buf[177] = {0};

  uint8_t bytesprops0[] = {0xad, 0xb7, 0x32, 0x2f, 0xbf, 0xbe, 0xe7, 0x48, 0xf6, 0x26, 0xbb, 0x2,
                           0x1,  0x72, 0xac, 0xd7, 0xfc, 0x4,  0xd3, 0x46, 0xfc, 0xba, 0xa6};
  uint8_t bytesprops1[] = {0x1, 0x20, 0xb2, 0xf5, 0x3a, 0xf4, 0xb4, 0x30, 0x92, 0x91};
  uint8_t bytesprops2[] = {0xa3, 0xd1, 0xa8, 0x58};
  uint8_t bytesprops3[] = {0x2e, 0xf3, 0x95, 0x90, 0x83, 0x52, 0x19, 0x29, 0xc, 0x6e, 0xe, 0x6d, 0xca};
  uint8_t bytesprops4[] = {0x8a, 0xf3, 0xb8, 0x16, 0x48, 0x8c, 0x9b, 0xe0, 0xb7};
  uint8_t bytesprops6[] = {0x87, 0xd8, 0x8e, 0xd9, 0x7b, 0xf5, 0xe4, 0x51};
  uint8_t bytesprops5[] = {0xa7, 0x38, 0xc2, 0x6a, 0x18, 0x20, 0x22, 0x99,
                           0xa6, 0x3a, 0xd7, 0x92, 0x20, 0x4d, 0x34, 0xcb};
  uint8_t bytesprops7[] = {0x51, 0x13, 0x1d, 0xad, 0x86, 0x2b, 0x6d, 0x48, 0x18, 0x33,
                           0xe,  0x47, 0x69, 0x92, 0x12, 0x5f, 0x30, 0x94, 0x91, 0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12736}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops5}, .v = {8, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12978;
  uint8_t client_id_bytes[] = {0xa0, 0x58, 0xdd, 0x57, 0x32, 0x5e, 0xe6, 0x6f, 0xa3, 0x37, 0xb3, 0x73, 0x9c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "^\134", _lastWill = Nothing, _cleanSession = False, _keepAlive
// = 22655, _connID = "\134^\vF\DC1{\207R", _properties = [PropSharedSubscriptionAvailable 190,PropResponseTopic
// "\174\RS\163@\227\154Z\255\218\224(5\181aF\DLE\DEL\237`sa15\229\170U",PropMessageExpiryInterval
// 17762,PropRequestResponseInformation 134,PropReceiveMaximum 27048,PropMessageExpiryInterval
// 7176,PropSubscriptionIdentifier 9,PropSubscriptionIdentifierAvailable 215,PropMessageExpiryInterval
// 17794,PropPayloadFormatIndicator 187,PropMaximumPacketSize 18691,PropWillDelayInterval 31213,PropMaximumQoS
// 50,PropTopicAliasMaximum 26719,PropWildcardSubscriptionAvailable 213,PropMaximumPacketSize 32579,PropServerKeepAlive
// 6794,PropReasonString "t\190",PropRequestProblemInformation 193,PropWillDelayInterval 12315,PropWillDelayInterval
// 5199]}
TEST(Connect5QCTest, Encode60) {
  uint8_t pkt[] = {0x10, 0x78, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x58, 0x7f, 0x63, 0x2a, 0xbe, 0x8,
                   0x0,  0x1a, 0xae, 0x1e, 0xa3, 0x40, 0xe3, 0x9a, 0x5a, 0xff, 0xda, 0xe0, 0x28, 0x35, 0xb5, 0x61,
                   0x46, 0x10, 0x7f, 0xed, 0x60, 0x73, 0x61, 0x31, 0x35, 0xe5, 0xaa, 0x55, 0x2,  0x0,  0x0,  0x45,
                   0x62, 0x19, 0x86, 0x21, 0x69, 0xa8, 0x2,  0x0,  0x0,  0x1c, 0x8,  0xb,  0x9,  0x29, 0xd7, 0x2,
                   0x0,  0x0,  0x45, 0x82, 0x1,  0xbb, 0x27, 0x0,  0x0,  0x49, 0x3,  0x18, 0x0,  0x0,  0x79, 0xed,
                   0x24, 0x32, 0x22, 0x68, 0x5f, 0x28, 0xd5, 0x27, 0x0,  0x0,  0x7f, 0x43, 0x13, 0x1a, 0x8a, 0x1f,
                   0x0,  0x2,  0x74, 0xbe, 0x17, 0xc1, 0x18, 0x0,  0x0,  0x30, 0x1b, 0x18, 0x0,  0x0,  0x14, 0x4f,
                   0x0,  0x8,  0x86, 0x5e, 0xb,  0x46, 0x11, 0x7b, 0xcf, 0x52};

  uint8_t buf[132] = {0};

  uint8_t bytesprops0[] = {0xae, 0x1e, 0xa3, 0x40, 0xe3, 0x9a, 0x5a, 0xff, 0xda, 0xe0, 0x28, 0x35, 0xb5,
                           0x61, 0x46, 0x10, 0x7f, 0xed, 0x60, 0x73, 0x61, 0x31, 0x35, 0xe5, 0xaa, 0x55};
  uint8_t bytesprops1[] = {0x74, 0xbe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17762}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27048}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7176}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17794}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18691}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31213}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26719}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32579}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6794}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12315}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5199}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 22655;
  uint8_t client_id_bytes[] = {0x86, 0x5e, 0xb, 0x46, 0x11, 0x7b, 0xcf, 0x52};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5e, 0x86};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 30398, _connID = "\GSv\DC4zn\ETX\185\219i\199/\131\157\245", _properties = [PropRequestProblemInformation
// 120,PropContentType ")g\151v\155\237B\f\163\143s\DEL-\185\139\247\DC4Qk\162G",PropRequestResponseInformation
// 198,PropRequestProblemInformation 192,PropServerKeepAlive 31742,PropPayloadFormatIndicator 33]}
TEST(Connect5QCTest, Encode61) {
  uint8_t pkt[] = {0x10, 0x3e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x76, 0xbe, 0x23, 0x17, 0x78, 0x3,
                   0x0,  0x15, 0x29, 0x67, 0x97, 0x76, 0x9b, 0xed, 0x42, 0xc,  0xa3, 0x8f, 0x73, 0x7f, 0x2d, 0xb9,
                   0x8b, 0xf7, 0x14, 0x51, 0x6b, 0xa2, 0x47, 0x19, 0xc6, 0x17, 0xc0, 0x13, 0x7b, 0xfe, 0x1,  0x21,
                   0x0,  0xe,  0x1d, 0x76, 0x14, 0x7a, 0x6e, 0x3,  0xb9, 0xdb, 0x69, 0xc7, 0x2f, 0x83, 0x9d, 0xf5};

  uint8_t buf[74] = {0};

  uint8_t bytesprops0[] = {0x29, 0x67, 0x97, 0x76, 0x9b, 0xed, 0x42, 0xc,  0xa3, 0x8f, 0x73,
                           0x7f, 0x2d, 0xb9, 0x8b, 0xf7, 0x14, 0x51, 0x6b, 0xa2, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31742}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 33}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30398;
  uint8_t client_id_bytes[] = {0x1d, 0x76, 0x14, 0x7a, 0x6e, 0x3, 0xb9, 0xdb, 0x69, 0xc7, 0x2f, 0x83, 0x9d, 0xf5};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\142\168\DC2Z\a\229\255\250\192\177\&6\172\240D2", _password = Just
// "\r\137\ETBtR\130C*\DC1\223\202\169\147\197\232", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1,
// _willTopic = "\209\194%\251R\ETX%3\CAN\136\174\167\169\139\167\186C)\184*n\154\ETBmG\209T\186\DC1", _willMsg =
// "#yp(#!>\196O\247\DC1\176\253\150\238\214\216\212f\161Xl\t", _willProps = [PropSubscriptionIdentifier 20]}),
// _cleanSession = True, _keepAlive = 1871, _connID = "s\ETXN", _properties = [PropResponseInformation
// "\252\192\196\"\230/",PropWillDelayInterval 16667,PropReceiveMaximum 30002,PropSubscriptionIdentifier
// 18,PropMessageExpiryInterval 21381,PropWillDelayInterval 24570,PropAuthenticationData
// "\189\175R\137\130\r\203\SUB\r\EOT",PropTopicAliasMaximum 26398,PropMaximumPacketSize 25296,PropTopicAliasMaximum
// 22383,PropAssignedClientIdentifier "\236\161TO>\"\144\233|",PropResponseInformation
// "\194\199-i\151\v\220\GS\234l\189\176\155\148\240*\"\237j\165+\212\rU",PropRequestResponseInformation
// 128,PropCorrelationData "\227k>\160\SOy\157\251\243;0\199\242\237]\155\ETX2\"x\140\173\149\152",PropWillDelayInterval
// 11756,PropMaximumPacketSize 6416,PropUserProperty "" "8\t\180",PropResponseTopic "\135",PropTopicAlias
// 8174,PropPayloadFormatIndicator 236,PropWildcardSubscriptionAvailable 243,PropTopicAlias 26948,PropTopicAliasMaximum
// 23415,PropSubscriptionIdentifier 6,PropSubscriptionIdentifierAvailable 137,PropServerReference
// "\209\DC1\233\230O",PropTopicAlias 13735]}
TEST(Connect5QCTest, Encode62) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x7,  0x4f, 0xab, 0x1,  0x1a, 0x0,  0x6,  0xfc,
      0xc0, 0xc4, 0x22, 0xe6, 0x2f, 0x18, 0x0,  0x0,  0x41, 0x1b, 0x21, 0x75, 0x32, 0xb,  0x12, 0x2,  0x0,  0x0,  0x53,
      0x85, 0x18, 0x0,  0x0,  0x5f, 0xfa, 0x16, 0x0,  0xa,  0xbd, 0xaf, 0x52, 0x89, 0x82, 0xd,  0xcb, 0x1a, 0xd,  0x4,
      0x22, 0x67, 0x1e, 0x27, 0x0,  0x0,  0x62, 0xd0, 0x22, 0x57, 0x6f, 0x12, 0x0,  0x9,  0xec, 0xa1, 0x54, 0x4f, 0x3e,
      0x22, 0x90, 0xe9, 0x7c, 0x1a, 0x0,  0x18, 0xc2, 0xc7, 0x2d, 0x69, 0x97, 0xb,  0xdc, 0x1d, 0xea, 0x6c, 0xbd, 0xb0,
      0x9b, 0x94, 0xf0, 0x2a, 0x22, 0xed, 0x6a, 0xa5, 0x2b, 0xd4, 0xd,  0x55, 0x19, 0x80, 0x9,  0x0,  0x18, 0xe3, 0x6b,
      0x3e, 0xa0, 0xe,  0x79, 0x9d, 0xfb, 0xf3, 0x3b, 0x30, 0xc7, 0xf2, 0xed, 0x5d, 0x9b, 0x3,  0x32, 0x22, 0x78, 0x8c,
      0xad, 0x95, 0x98, 0x18, 0x0,  0x0,  0x2d, 0xec, 0x27, 0x0,  0x0,  0x19, 0x10, 0x26, 0x0,  0x0,  0x0,  0x3,  0x38,
      0x9,  0xb4, 0x8,  0x0,  0x1,  0x87, 0x23, 0x1f, 0xee, 0x1,  0xec, 0x28, 0xf3, 0x23, 0x69, 0x44, 0x22, 0x5b, 0x77,
      0xb,  0x6,  0x29, 0x89, 0x1c, 0x0,  0x5,  0xd1, 0x11, 0xe9, 0xe6, 0x4f, 0x23, 0x35, 0xa7, 0x0,  0x3,  0x73, 0x3,
      0x4e, 0x2,  0xb,  0x14, 0x0,  0x1d, 0xd1, 0xc2, 0x25, 0xfb, 0x52, 0x3,  0x25, 0x33, 0x18, 0x88, 0xae, 0xa7, 0xa9,
      0x8b, 0xa7, 0xba, 0x43, 0x29, 0xb8, 0x2a, 0x6e, 0x9a, 0x17, 0x6d, 0x47, 0xd1, 0x54, 0xba, 0x11, 0x0,  0x17, 0x23,
      0x79, 0x70, 0x28, 0x23, 0x21, 0x3e, 0xc4, 0x4f, 0xf7, 0x11, 0xb0, 0xfd, 0x96, 0xee, 0xd6, 0xd8, 0xd4, 0x66, 0xa1,
      0x58, 0x6c, 0x9,  0x0,  0xf,  0x8e, 0xa8, 0x12, 0x5a, 0x7,  0xe5, 0xff, 0xfa, 0xc0, 0xb1, 0x36, 0xac, 0xf0, 0x44,
      0x32, 0x0,  0xf,  0xd,  0x89, 0x17, 0x74, 0x52, 0x82, 0x43, 0x2a, 0x11, 0xdf, 0xca, 0xa9, 0x93, 0xc5, 0xe8};

  uint8_t buf[294] = {0};

  uint8_t bytesprops0[] = {0xfc, 0xc0, 0xc4, 0x22, 0xe6, 0x2f};
  uint8_t bytesprops1[] = {0xbd, 0xaf, 0x52, 0x89, 0x82, 0xd, 0xcb, 0x1a, 0xd, 0x4};
  uint8_t bytesprops2[] = {0xec, 0xa1, 0x54, 0x4f, 0x3e, 0x22, 0x90, 0xe9, 0x7c};
  uint8_t bytesprops3[] = {0xc2, 0xc7, 0x2d, 0x69, 0x97, 0xb,  0xdc, 0x1d, 0xea, 0x6c, 0xbd, 0xb0,
                           0x9b, 0x94, 0xf0, 0x2a, 0x22, 0xed, 0x6a, 0xa5, 0x2b, 0xd4, 0xd,  0x55};
  uint8_t bytesprops4[] = {0xe3, 0x6b, 0x3e, 0xa0, 0xe, 0x79, 0x9d, 0xfb, 0xf3, 0x3b, 0x30, 0xc7,
                           0xf2, 0xed, 0x5d, 0x9b, 0x3, 0x32, 0x22, 0x78, 0x8c, 0xad, 0x95, 0x98};
  uint8_t bytesprops6[] = {0x38, 0x9, 0xb4};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops7[] = {0x87};
  uint8_t bytesprops8[] = {0xd1, 0x11, 0xe9, 0xe6, 0x4f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16667}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30002}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21381}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24570}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26398}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25296}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22383}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11756}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6416}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops5}, .v = {3, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8174}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26948}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23415}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13735}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0xc2, 0x25, 0xfb, 0x52, 0x3,  0x25, 0x33, 0x18, 0x88,
                                0xae, 0xa7, 0xa9, 0x8b, 0xa7, 0xba, 0x43, 0x29, 0xb8, 0x2a,
                                0x6e, 0x9a, 0x17, 0x6d, 0x47, 0xd1, 0x54, 0xba, 0x11};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x23, 0x79, 0x70, 0x28, 0x23, 0x21, 0x3e, 0xc4, 0x4f, 0xf7, 0x11, 0xb0,
                                  0xfd, 0x96, 0xee, 0xd6, 0xd8, 0xd4, 0x66, 0xa1, 0x58, 0x6c, 0x9};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1871;
  uint8_t client_id_bytes[] = {0x73, 0x3, 0x4e};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8e, 0xa8, 0x12, 0x5a, 0x7, 0xe5, 0xff, 0xfa, 0xc0, 0xb1, 0x36, 0xac, 0xf0, 0x44, 0x32};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd, 0x89, 0x17, 0x74, 0x52, 0x82, 0x43, 0x2a, 0x11, 0xdf, 0xca, 0xa9, 0x93, 0xc5, 0xe8};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "^t\USER\139\244\152'\220\244", _willMsg =
// "\199\STX\191\&2ISE$\SOH}\221O\DC3,P\242\185\245\181\192\\\237\251p\237\247\198\203", _willProps = [PropUserProperty
// "qR" "\217)\202\185n\ESC\224\146p\176\128C\202E\EOT\135",PropAuthenticationData
// "\200\250\191\184\228\224\234\149\NULCz,\175\251\SOH}G\187",PropMaximumPacketSize 30947]}), _cleanSession = False,
// _keepAlive = 13191, _connID = "\152G\DC3\220\161\183\214\153L\231", _properties = [PropWildcardSubscriptionAvailable
// 209,PropMaximumPacketSize 10805,PropMaximumQoS 99,PropAssignedClientIdentifier
// "\EOT\221\142]!)\188\DEL\191\178\218",PropResponseInformation
// "\134j.\213,\200\203\248\133q\249E{\191\240,\146N\166",PropAuthenticationMethod
// "\156\ETX",PropAssignedClientIdentifier "\175\214",PropTopicAliasMaximum 1901,PropCorrelationData
// "\150D\SI\160\&8\ENQ"]}
TEST(Connect5QCTest, Encode63) {
  uint8_t pkt[] = {0x10, 0xb7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc,  0x33, 0x87, 0x43, 0x28, 0xd1, 0x27,
                   0x0,  0x0,  0x2a, 0x35, 0x24, 0x63, 0x12, 0x0,  0xb,  0x4,  0xdd, 0x8e, 0x5d, 0x21, 0x29, 0xbc, 0x7f,
                   0xbf, 0xb2, 0xda, 0x1a, 0x0,  0x13, 0x86, 0x6a, 0x2e, 0xd5, 0x2c, 0xc8, 0xcb, 0xf8, 0x85, 0x71, 0xf9,
                   0x45, 0x7b, 0xbf, 0xf0, 0x2c, 0x92, 0x4e, 0xa6, 0x15, 0x0,  0x2,  0x9c, 0x3,  0x12, 0x0,  0x2,  0xaf,
                   0xd6, 0x22, 0x7,  0x6d, 0x9,  0x0,  0x6,  0x96, 0x44, 0xf,  0xa0, 0x38, 0x5,  0x0,  0xa,  0x98, 0x47,
                   0x13, 0xdc, 0xa1, 0xb7, 0xd6, 0x99, 0x4c, 0xe7, 0x31, 0x26, 0x0,  0x2,  0x71, 0x52, 0x0,  0x10, 0xd9,
                   0x29, 0xca, 0xb9, 0x6e, 0x1b, 0xe0, 0x92, 0x70, 0xb0, 0x80, 0x43, 0xca, 0x45, 0x4,  0x87, 0x16, 0x0,
                   0x12, 0xc8, 0xfa, 0xbf, 0xb8, 0xe4, 0xe0, 0xea, 0x95, 0x0,  0x43, 0x7a, 0x2c, 0xaf, 0xfb, 0x1,  0x7d,
                   0x47, 0xbb, 0x27, 0x0,  0x0,  0x78, 0xe3, 0x0,  0xb,  0x5e, 0x74, 0x1f, 0x45, 0x52, 0x8b, 0xf4, 0x98,
                   0x27, 0xdc, 0xf4, 0x0,  0x1c, 0xc7, 0x2,  0xbf, 0x32, 0x49, 0x53, 0x45, 0x24, 0x1,  0x7d, 0xdd, 0x4f,
                   0x13, 0x2c, 0x50, 0xf2, 0xb9, 0xf5, 0xb5, 0xc0, 0x5c, 0xed, 0xfb, 0x70, 0xed, 0xf7, 0xc6, 0xcb};

  uint8_t buf[196] = {0};

  uint8_t bytesprops0[] = {0x4, 0xdd, 0x8e, 0x5d, 0x21, 0x29, 0xbc, 0x7f, 0xbf, 0xb2, 0xda};
  uint8_t bytesprops1[] = {0x86, 0x6a, 0x2e, 0xd5, 0x2c, 0xc8, 0xcb, 0xf8, 0x85, 0x71,
                           0xf9, 0x45, 0x7b, 0xbf, 0xf0, 0x2c, 0x92, 0x4e, 0xa6};
  uint8_t bytesprops2[] = {0x9c, 0x3};
  uint8_t bytesprops3[] = {0xaf, 0xd6};
  uint8_t bytesprops4[] = {0x96, 0x44, 0xf, 0xa0, 0x38, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10805}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1901}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xd9, 0x29, 0xca, 0xb9, 0x6e, 0x1b, 0xe0, 0x92,
                               0x70, 0xb0, 0x80, 0x43, 0xca, 0x45, 0x4,  0x87};
  uint8_t byteswillprops0[] = {0x71, 0x52};
  uint8_t byteswillprops2[] = {0xc8, 0xfa, 0xbf, 0xb8, 0xe4, 0xe0, 0xea, 0x95, 0x0,
                               0x43, 0x7a, 0x2c, 0xaf, 0xfb, 0x1,  0x7d, 0x47, 0xbb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops0}, .v = {16, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30947}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5e, 0x74, 0x1f, 0x45, 0x52, 0x8b, 0xf4, 0x98, 0x27, 0xdc, 0xf4};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc7, 0x2,  0xbf, 0x32, 0x49, 0x53, 0x45, 0x24, 0x1,  0x7d, 0xdd, 0x4f, 0x13, 0x2c,
                                  0x50, 0xf2, 0xb9, 0xf5, 0xb5, 0xc0, 0x5c, 0xed, 0xfb, 0x70, 0xed, 0xf7, 0xc6, 0xcb};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13191;
  uint8_t client_id_bytes[] = {0x98, 0x47, 0x13, 0xdc, 0xa1, 0xb7, 0xd6, 0x99, 0x4c, 0xe7};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "4\159\162&\FS(\185Vz\159#", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\178\222\199o\DLE`0%\253\145qK;\128\218", _willMsg =
// "\130\&9Pt\tC\201\176\147", _willProps = [PropRetainAvailable 148,PropServerKeepAlive
// 2497,PropWildcardSubscriptionAvailable 254,PropRetainAvailable 116,PropMaximumQoS 37,PropAuthenticationMethod
// "\137{\FS\CAN",PropTopicAlias 3471,PropTopicAliasMaximum 29487,PropCorrelationData
// "\ESC\130/\145\130\&0\206\198N",PropTopicAliasMaximum 2890,PropServerReference
// "J\NUL`\250\238\230\160\210B",PropSessionExpiryInterval 17715,PropCorrelationData
// "\\\192\197\&6\245\181h\147+\205\228s\248\229\EOTI\243P\175\185",PropAuthenticationData
// ";{F\167\DC4%F\222\DC4\170\204\217\SYNj\206h\ACK\141\235\198$\193\DEL\209)~-",PropAssignedClientIdentifier
// "\151\136\RS",PropTopicAlias 9534,PropMaximumQoS 98,PropResponseTopic
// "\ACKvI\186\202\141\176#\199\218\DC3\223R\189\220\208\&6\180QR\231\148\189\182",PropSharedSubscriptionAvailable
// 238,PropContentType "\RS.\n\EM;\187:\223Y\210D5[\171\171",PropResponseTopic
// "_x\a:\235?\174\248\146\154\CAN\131\255\&4"]}), _cleanSession = False, _keepAlive = 3727, _connID = "\DEL\250\165",
// _properties = [PropReceiveMaximum 2641,PropRetainAvailable 87,PropRetainAvailable 235,PropMessageExpiryInterval
// 9273,PropSubscriptionIdentifierAvailable 25,PropSubscriptionIdentifierAvailable 10,PropSharedSubscriptionAvailable
// 20,PropMessageExpiryInterval 6127,PropSubscriptionIdentifierAvailable 248,PropServerReference "\184\231\164\139"]}
TEST(Connect5QCTest, Encode64) {
  uint8_t pkt[] = {
      0x10, 0x86, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x34, 0xe,  0x8f, 0x20, 0x21, 0xa,  0x51, 0x25, 0x57,
      0x25, 0xeb, 0x2,  0x0,  0x0,  0x24, 0x39, 0x29, 0x19, 0x29, 0xa,  0x2a, 0x14, 0x2,  0x0,  0x0,  0x17, 0xef, 0x29,
      0xf8, 0x1c, 0x0,  0x4,  0xb8, 0xe7, 0xa4, 0x8b, 0x0,  0x3,  0x7f, 0xfa, 0xa5, 0xb8, 0x1,  0x25, 0x94, 0x13, 0x9,
      0xc1, 0x28, 0xfe, 0x25, 0x74, 0x24, 0x25, 0x15, 0x0,  0x4,  0x89, 0x7b, 0x1c, 0x18, 0x23, 0xd,  0x8f, 0x22, 0x73,
      0x2f, 0x9,  0x0,  0x9,  0x1b, 0x82, 0x2f, 0x91, 0x82, 0x30, 0xce, 0xc6, 0x4e, 0x22, 0xb,  0x4a, 0x1c, 0x0,  0x9,
      0x4a, 0x0,  0x60, 0xfa, 0xee, 0xe6, 0xa0, 0xd2, 0x42, 0x11, 0x0,  0x0,  0x45, 0x33, 0x9,  0x0,  0x14, 0x5c, 0xc0,
      0xc5, 0x36, 0xf5, 0xb5, 0x68, 0x93, 0x2b, 0xcd, 0xe4, 0x73, 0xf8, 0xe5, 0x4,  0x49, 0xf3, 0x50, 0xaf, 0xb9, 0x16,
      0x0,  0x1b, 0x3b, 0x7b, 0x46, 0xa7, 0x14, 0x25, 0x46, 0xde, 0x14, 0xaa, 0xcc, 0xd9, 0x16, 0x6a, 0xce, 0x68, 0x6,
      0x8d, 0xeb, 0xc6, 0x24, 0xc1, 0x7f, 0xd1, 0x29, 0x7e, 0x2d, 0x12, 0x0,  0x3,  0x97, 0x88, 0x1e, 0x23, 0x25, 0x3e,
      0x24, 0x62, 0x8,  0x0,  0x18, 0x6,  0x76, 0x49, 0xba, 0xca, 0x8d, 0xb0, 0x23, 0xc7, 0xda, 0x13, 0xdf, 0x52, 0xbd,
      0xdc, 0xd0, 0x36, 0xb4, 0x51, 0x52, 0xe7, 0x94, 0xbd, 0xb6, 0x2a, 0xee, 0x3,  0x0,  0xf,  0x1e, 0x2e, 0xa,  0x19,
      0x3b, 0xbb, 0x3a, 0xdf, 0x59, 0xd2, 0x44, 0x35, 0x5b, 0xab, 0xab, 0x8,  0x0,  0xe,  0x5f, 0x78, 0x7,  0x3a, 0xeb,
      0x3f, 0xae, 0xf8, 0x92, 0x9a, 0x18, 0x83, 0xff, 0x34, 0x0,  0xf,  0xb2, 0xde, 0xc7, 0x6f, 0x10, 0x60, 0x30, 0x25,
      0xfd, 0x91, 0x71, 0x4b, 0x3b, 0x80, 0xda, 0x0,  0x9,  0x82, 0x39, 0x50, 0x74, 0x9,  0x43, 0xc9, 0xb0, 0x93};

  uint8_t buf[275] = {0};

  uint8_t bytesprops0[] = {0xb8, 0xe7, 0xa4, 0x8b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2641}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9273}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6127}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x89, 0x7b, 0x1c, 0x18};
  uint8_t byteswillprops1[] = {0x1b, 0x82, 0x2f, 0x91, 0x82, 0x30, 0xce, 0xc6, 0x4e};
  uint8_t byteswillprops2[] = {0x4a, 0x0, 0x60, 0xfa, 0xee, 0xe6, 0xa0, 0xd2, 0x42};
  uint8_t byteswillprops3[] = {0x5c, 0xc0, 0xc5, 0x36, 0xf5, 0xb5, 0x68, 0x93, 0x2b, 0xcd,
                               0xe4, 0x73, 0xf8, 0xe5, 0x4,  0x49, 0xf3, 0x50, 0xaf, 0xb9};
  uint8_t byteswillprops4[] = {0x3b, 0x7b, 0x46, 0xa7, 0x14, 0x25, 0x46, 0xde, 0x14, 0xaa, 0xcc, 0xd9, 0x16, 0x6a,
                               0xce, 0x68, 0x6,  0x8d, 0xeb, 0xc6, 0x24, 0xc1, 0x7f, 0xd1, 0x29, 0x7e, 0x2d};
  uint8_t byteswillprops5[] = {0x97, 0x88, 0x1e};
  uint8_t byteswillprops6[] = {0x6,  0x76, 0x49, 0xba, 0xca, 0x8d, 0xb0, 0x23, 0xc7, 0xda, 0x13, 0xdf,
                               0x52, 0xbd, 0xdc, 0xd0, 0x36, 0xb4, 0x51, 0x52, 0xe7, 0x94, 0xbd, 0xb6};
  uint8_t byteswillprops7[] = {0x1e, 0x2e, 0xa, 0x19, 0x3b, 0xbb, 0x3a, 0xdf, 0x59, 0xd2, 0x44, 0x35, 0x5b, 0xab, 0xab};
  uint8_t byteswillprops8[] = {0x5f, 0x78, 0x7, 0x3a, 0xeb, 0x3f, 0xae, 0xf8, 0x92, 0x9a, 0x18, 0x83, 0xff, 0x34};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2497}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3471}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29487}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2890}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17715}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9534}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&byteswillprops8}}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xde, 0xc7, 0x6f, 0x10, 0x60, 0x30, 0x25,
                                0xfd, 0x91, 0x71, 0x4b, 0x3b, 0x80, 0xda};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x39, 0x50, 0x74, 0x9, 0x43, 0xc9, 0xb0, 0x93};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3727;
  uint8_t client_id_bytes[] = {0x7f, 0xfa, 0xa5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x34, 0x9f, 0xa2, 0x26, 0x1c, 0x28, 0xb9, 0x56, 0x7a, 0x9f, 0x23};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\RSt\221\140\178\180\155#r\255\&3\212\203w\206\137L\202\190\SUB G\227\FS",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "~^x\SYN6\181\252#\192\a\231\220>\DC2e\NAK", _willMsg =
// "\202S\US{\160\165\GS\f\165\SUB\183D\191\212\150\157\f\SUBwj\204\SYN\167\237\251\161\189", _willProps =
// [PropMaximumPacketSize 31654,PropMaximumPacketSize 2463,PropUserProperty
// "W\171\240\137+\250\199\243\137\ACKQ\177\143\216=\"\DEL\138T5\204E"
// "7\162\169\173\246QV\ENQ\245\239gw\207z\201\180\142RW+\219|i\180\194\b\194",PropTopicAlias
// 20921,PropWillDelayInterval 24817,PropReasonString
// "R\219s\190JX\ESC\164w\148~\CAN\226Bi<\228\EM\232P\135o'\171\178\143\DEL\\",PropReceiveMaximum
// 26593,PropCorrelationData ":A\187\149\178\&7\145\220\DC2\166)U}7\252F\130\151\208T\183s",PropMessageExpiryInterval
// 29335,PropPayloadFormatIndicator 77,PropSharedSubscriptionAvailable 25,PropWildcardSubscriptionAvailable
// 26,PropServerReference
// "\FS\190\152\209\&0\SO\SOH\176\241\fj\244\DEL\155\172\STX\n\t\149\180G\SOH:xj\254\&5\237k",PropCorrelationData
// "\194\238\209\SI\190\238R\138\236\240\175z",PropServerReference "v\146v",PropMessageExpiryInterval
// 22045,PropRequestResponseInformation 214,PropTopicAliasMaximum 29161,PropRequestResponseInformation
// 180,PropWildcardSubscriptionAvailable 170,PropSessionExpiryInterval 27399]}), _cleanSession = False, _keepAlive =
// 3670, _connID = "H\SI\178\231o\172\&9\153", _properties = [PropResponseInformation
// "H\179p8\ETX\137zM\223\202\250\177\v\ETB=\197\201-\r\225\185",PropMaximumPacketSize 15938,PropServerReference
// "\DC2\227\184\137\232-\210\151\&5\163\171\201\v\207|:\DLE\223\183\243%",PropTopicAliasMaximum
// 14229,PropWillDelayInterval 13002,PropMaximumPacketSize 6555,PropRequestProblemInformation 143,PropAuthenticationData
// "",PropRetainAvailable 54]}
TEST(Connect5QCTest, Encode65) {
  uint8_t pkt[] = {
      0x10, 0xff, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0xe,  0x56, 0x49, 0x1a, 0x0,  0x15, 0x48, 0xb3,
      0x70, 0x38, 0x3,  0x89, 0x7a, 0x4d, 0xdf, 0xca, 0xfa, 0xb1, 0xb,  0x17, 0x3d, 0xc5, 0xc9, 0x2d, 0xd,  0xe1, 0xb9,
      0x27, 0x0,  0x0,  0x3e, 0x42, 0x1c, 0x0,  0x15, 0x12, 0xe3, 0xb8, 0x89, 0xe8, 0x2d, 0xd2, 0x97, 0x35, 0xa3, 0xab,
      0xc9, 0xb,  0xcf, 0x7c, 0x3a, 0x10, 0xdf, 0xb7, 0xf3, 0x25, 0x22, 0x37, 0x95, 0x18, 0x0,  0x0,  0x32, 0xca, 0x27,
      0x0,  0x0,  0x19, 0x9b, 0x17, 0x8f, 0x16, 0x0,  0x0,  0x25, 0x36, 0x0,  0x8,  0x48, 0xf,  0xb2, 0xe7, 0x6f, 0xac,
      0x39, 0x99, 0xd6, 0x1,  0x27, 0x0,  0x0,  0x7b, 0xa6, 0x27, 0x0,  0x0,  0x9,  0x9f, 0x26, 0x0,  0x16, 0x57, 0xab,
      0xf0, 0x89, 0x2b, 0xfa, 0xc7, 0xf3, 0x89, 0x6,  0x51, 0xb1, 0x8f, 0xd8, 0x3d, 0x22, 0x7f, 0x8a, 0x54, 0x35, 0xcc,
      0x45, 0x0,  0x1b, 0x37, 0xa2, 0xa9, 0xad, 0xf6, 0x51, 0x56, 0x5,  0xf5, 0xef, 0x67, 0x77, 0xcf, 0x7a, 0xc9, 0xb4,
      0x8e, 0x52, 0x57, 0x2b, 0xdb, 0x7c, 0x69, 0xb4, 0xc2, 0x8,  0xc2, 0x23, 0x51, 0xb9, 0x18, 0x0,  0x0,  0x60, 0xf1,
      0x1f, 0x0,  0x1c, 0x52, 0xdb, 0x73, 0xbe, 0x4a, 0x58, 0x1b, 0xa4, 0x77, 0x94, 0x7e, 0x18, 0xe2, 0x42, 0x69, 0x3c,
      0xe4, 0x19, 0xe8, 0x50, 0x87, 0x6f, 0x27, 0xab, 0xb2, 0x8f, 0x7f, 0x5c, 0x21, 0x67, 0xe1, 0x9,  0x0,  0x16, 0x3a,
      0x41, 0xbb, 0x95, 0xb2, 0x37, 0x91, 0xdc, 0x12, 0xa6, 0x29, 0x55, 0x7d, 0x37, 0xfc, 0x46, 0x82, 0x97, 0xd0, 0x54,
      0xb7, 0x73, 0x2,  0x0,  0x0,  0x72, 0x97, 0x1,  0x4d, 0x2a, 0x19, 0x28, 0x1a, 0x1c, 0x0,  0x1d, 0x1c, 0xbe, 0x98,
      0xd1, 0x30, 0xe,  0x1,  0xb0, 0xf1, 0xc,  0x6a, 0xf4, 0x7f, 0x9b, 0xac, 0x2,  0xa,  0x9,  0x95, 0xb4, 0x47, 0x1,
      0x3a, 0x78, 0x6a, 0xfe, 0x35, 0xed, 0x6b, 0x9,  0x0,  0xc,  0xc2, 0xee, 0xd1, 0xf,  0xbe, 0xee, 0x52, 0x8a, 0xec,
      0xf0, 0xaf, 0x7a, 0x1c, 0x0,  0x3,  0x76, 0x92, 0x76, 0x2,  0x0,  0x0,  0x56, 0x1d, 0x19, 0xd6, 0x22, 0x71, 0xe9,
      0x19, 0xb4, 0x28, 0xaa, 0x11, 0x0,  0x0,  0x6b, 0x7,  0x0,  0x10, 0x7e, 0x5e, 0x78, 0x16, 0x36, 0xb5, 0xfc, 0x23,
      0xc0, 0x7,  0xe7, 0xdc, 0x3e, 0x12, 0x65, 0x15, 0x0,  0x1b, 0xca, 0x53, 0x1f, 0x7b, 0xa0, 0xa5, 0x1d, 0xc,  0xa5,
      0x1a, 0xb7, 0x44, 0xbf, 0xd4, 0x96, 0x9d, 0xc,  0x1a, 0x77, 0x6a, 0xcc, 0x16, 0xa7, 0xed, 0xfb, 0xa1, 0xbd, 0x0,
      0x18, 0x1e, 0x74, 0xdd, 0x8c, 0xb2, 0xb4, 0x9b, 0x23, 0x72, 0xff, 0x33, 0xd4, 0xcb, 0x77, 0xce, 0x89, 0x4c, 0xca,
      0xbe, 0x1a, 0x20, 0x47, 0xe3, 0x1c};

  uint8_t buf[396] = {0};

  uint8_t bytesprops0[] = {0x48, 0xb3, 0x70, 0x38, 0x3,  0x89, 0x7a, 0x4d, 0xdf, 0xca, 0xfa,
                           0xb1, 0xb,  0x17, 0x3d, 0xc5, 0xc9, 0x2d, 0xd,  0xe1, 0xb9};
  uint8_t bytesprops1[] = {0x12, 0xe3, 0xb8, 0x89, 0xe8, 0x2d, 0xd2, 0x97, 0x35, 0xa3, 0xab,
                           0xc9, 0xb,  0xcf, 0x7c, 0x3a, 0x10, 0xdf, 0xb7, 0xf3, 0x25};
  uint8_t bytesprops2[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15938}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14229}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13002}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6555}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 54}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x37, 0xa2, 0xa9, 0xad, 0xf6, 0x51, 0x56, 0x5,  0xf5, 0xef, 0x67, 0x77, 0xcf, 0x7a,
                               0xc9, 0xb4, 0x8e, 0x52, 0x57, 0x2b, 0xdb, 0x7c, 0x69, 0xb4, 0xc2, 0x8,  0xc2};
  uint8_t byteswillprops0[] = {0x57, 0xab, 0xf0, 0x89, 0x2b, 0xfa, 0xc7, 0xf3, 0x89, 0x6,  0x51,
                               0xb1, 0x8f, 0xd8, 0x3d, 0x22, 0x7f, 0x8a, 0x54, 0x35, 0xcc, 0x45};
  uint8_t byteswillprops2[] = {0x52, 0xdb, 0x73, 0xbe, 0x4a, 0x58, 0x1b, 0xa4, 0x77, 0x94, 0x7e, 0x18, 0xe2, 0x42,
                               0x69, 0x3c, 0xe4, 0x19, 0xe8, 0x50, 0x87, 0x6f, 0x27, 0xab, 0xb2, 0x8f, 0x7f, 0x5c};
  uint8_t byteswillprops3[] = {0x3a, 0x41, 0xbb, 0x95, 0xb2, 0x37, 0x91, 0xdc, 0x12, 0xa6, 0x29,
                               0x55, 0x7d, 0x37, 0xfc, 0x46, 0x82, 0x97, 0xd0, 0x54, 0xb7, 0x73};
  uint8_t byteswillprops4[] = {0x1c, 0xbe, 0x98, 0xd1, 0x30, 0xe,  0x1, 0xb0, 0xf1, 0xc,  0x6a, 0xf4, 0x7f, 0x9b, 0xac,
                               0x2,  0xa,  0x9,  0x95, 0xb4, 0x47, 0x1, 0x3a, 0x78, 0x6a, 0xfe, 0x35, 0xed, 0x6b};
  uint8_t byteswillprops5[] = {0xc2, 0xee, 0xd1, 0xf, 0xbe, 0xee, 0x52, 0x8a, 0xec, 0xf0, 0xaf, 0x7a};
  uint8_t byteswillprops6[] = {0x76, 0x92, 0x76};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31654}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2463}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {22, (char*)&byteswillprops0}, .v = {27, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20921}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24817}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26593}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29335}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22045}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29161}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27399}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7e, 0x5e, 0x78, 0x16, 0x36, 0xb5, 0xfc, 0x23,
                                0xc0, 0x7,  0xe7, 0xdc, 0x3e, 0x12, 0x65, 0x15};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x53, 0x1f, 0x7b, 0xa0, 0xa5, 0x1d, 0xc,  0xa5, 0x1a, 0xb7, 0x44, 0xbf, 0xd4,
                                  0x96, 0x9d, 0xc,  0x1a, 0x77, 0x6a, 0xcc, 0x16, 0xa7, 0xed, 0xfb, 0xa1, 0xbd};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3670;
  uint8_t client_id_bytes[] = {0x48, 0xf, 0xb2, 0xe7, 0x6f, 0xac, 0x39, 0x99};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1e, 0x74, 0xdd, 0x8c, 0xb2, 0xb4, 0x9b, 0x23, 0x72, 0xff, 0x33, 0xd4,
                              0xcb, 0x77, 0xce, 0x89, 0x4c, 0xca, 0xbe, 0x1a, 0x20, 0x47, 0xe3, 0x1c};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DC1M\180\r\a\252wp^bZ\135\DEL2@Z\253\165\DC2y\209\226r]\164",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "a\214\153~t\218\159\237r\222\195'\246(\175", _willMsg = "\224\207\248\\\EM\EM/u\n7rM\210", _willProps =
// [PropAuthenticationData "\182",PropMessageExpiryInterval 20665,PropAuthenticationData
// "\162DZ&_\160\142eRK(\236L\156\147\183\&7\224\rhZg",PropRequestResponseInformation 71,PropMessageExpiryInterval
// 20758,PropRequestResponseInformation 117,PropMessageExpiryInterval 10617,PropSharedSubscriptionAvailable
// 90,PropAuthenticationData "o.\150\152\253T\249\&0\201
// H\210\211\198\185l\CAN\174Jpw\173\171\DC1r",PropAuthenticationData
// "CY\207w\154\136\231/",PropAssignedClientIdentifier
// "\211ImG\228\194\183\212D\143\180V\180`b\203\229",PropMessageExpiryInterval 26735]}), _cleanSession = True,
// _keepAlive = 15606, _connID = "\DC2O:m\245\197\216\200\\\t\162\221\172w\235d1\138\240\144\RSX%\208C\SOPC\199",
// _properties = [PropServerKeepAlive 13066,PropRetainAvailable 173,PropUserProperty
// "\203\219\190\n\207\189\160\151Gg>\225\159|\DC1\ETX\204\151\140\233\244"
// "\\\226\242\209\RS\255\191\182\218\241\SI<\168\216",PropTopicAliasMaximum 18576,PropContentType
// "z\r\252\147\233",PropContentType "|\241\151\190\134H\192T|;\v",PropMessageExpiryInterval 15714,PropReasonString
// "9\177\218w\243\US\202z\207\&3\135\&9\216\255\200l\ESCsT\246\133zf",PropTopicAlias 31604,PropRetainAvailable
// 206,PropWillDelayInterval 22587,PropReceiveMaximum 697,PropSubscriptionIdentifierAvailable 85,PropWillDelayInterval
// 15540]}
TEST(Connect5QCTest, Encode66) {
  uint8_t pkt[] = {
      0x10, 0xb6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x3c, 0xf6, 0x79, 0x13, 0x33, 0xa,  0x25, 0xad,
      0x26, 0x0,  0x15, 0xcb, 0xdb, 0xbe, 0xa,  0xcf, 0xbd, 0xa0, 0x97, 0x47, 0x67, 0x3e, 0xe1, 0x9f, 0x7c, 0x11, 0x3,
      0xcc, 0x97, 0x8c, 0xe9, 0xf4, 0x0,  0xe,  0x5c, 0xe2, 0xf2, 0xd1, 0x1e, 0xff, 0xbf, 0xb6, 0xda, 0xf1, 0xf,  0x3c,
      0xa8, 0xd8, 0x22, 0x48, 0x90, 0x3,  0x0,  0x5,  0x7a, 0xd,  0xfc, 0x93, 0xe9, 0x3,  0x0,  0xb,  0x7c, 0xf1, 0x97,
      0xbe, 0x86, 0x48, 0xc0, 0x54, 0x7c, 0x3b, 0xb,  0x2,  0x0,  0x0,  0x3d, 0x62, 0x1f, 0x0,  0x17, 0x39, 0xb1, 0xda,
      0x77, 0xf3, 0x1f, 0xca, 0x7a, 0xcf, 0x33, 0x87, 0x39, 0xd8, 0xff, 0xc8, 0x6c, 0x1b, 0x73, 0x54, 0xf6, 0x85, 0x7a,
      0x66, 0x23, 0x7b, 0x74, 0x25, 0xce, 0x18, 0x0,  0x0,  0x58, 0x3b, 0x21, 0x2,  0xb9, 0x29, 0x55, 0x18, 0x0,  0x0,
      0x3c, 0xb4, 0x0,  0x1d, 0x12, 0x4f, 0x3a, 0x6d, 0xf5, 0xc5, 0xd8, 0xc8, 0x5c, 0x9,  0xa2, 0xdd, 0xac, 0x77, 0xeb,
      0x64, 0x31, 0x8a, 0xf0, 0x90, 0x1e, 0x58, 0x25, 0xd0, 0x43, 0xe,  0x50, 0x43, 0xc7, 0x72, 0x16, 0x0,  0x1,  0xb6,
      0x2,  0x0,  0x0,  0x50, 0xb9, 0x16, 0x0,  0x16, 0xa2, 0x44, 0x5a, 0x26, 0x5f, 0xa0, 0x8e, 0x65, 0x52, 0x4b, 0x28,
      0xec, 0x4c, 0x9c, 0x93, 0xb7, 0x37, 0xe0, 0xd,  0x68, 0x5a, 0x67, 0x19, 0x47, 0x2,  0x0,  0x0,  0x51, 0x16, 0x19,
      0x75, 0x2,  0x0,  0x0,  0x29, 0x79, 0x2a, 0x5a, 0x16, 0x0,  0x19, 0x6f, 0x2e, 0x96, 0x98, 0xfd, 0x54, 0xf9, 0x30,
      0xc9, 0x20, 0x48, 0xd2, 0xd3, 0xc6, 0xb9, 0x6c, 0x18, 0xae, 0x4a, 0x70, 0x77, 0xad, 0xab, 0x11, 0x72, 0x16, 0x0,
      0x8,  0x43, 0x59, 0xcf, 0x77, 0x9a, 0x88, 0xe7, 0x2f, 0x12, 0x0,  0x11, 0xd3, 0x49, 0x6d, 0x47, 0xe4, 0xc2, 0xb7,
      0xd4, 0x44, 0x8f, 0xb4, 0x56, 0xb4, 0x60, 0x62, 0xcb, 0xe5, 0x2,  0x0,  0x0,  0x68, 0x6f, 0x0,  0xf,  0x61, 0xd6,
      0x99, 0x7e, 0x74, 0xda, 0x9f, 0xed, 0x72, 0xde, 0xc3, 0x27, 0xf6, 0x28, 0xaf, 0x0,  0xd,  0xe0, 0xcf, 0xf8, 0x5c,
      0x19, 0x19, 0x2f, 0x75, 0xa,  0x37, 0x72, 0x4d, 0xd2};

  uint8_t buf[323] = {0};

  uint8_t bytesprops1[] = {0x5c, 0xe2, 0xf2, 0xd1, 0x1e, 0xff, 0xbf, 0xb6, 0xda, 0xf1, 0xf, 0x3c, 0xa8, 0xd8};
  uint8_t bytesprops0[] = {0xcb, 0xdb, 0xbe, 0xa,  0xcf, 0xbd, 0xa0, 0x97, 0x47, 0x67, 0x3e,
                           0xe1, 0x9f, 0x7c, 0x11, 0x3,  0xcc, 0x97, 0x8c, 0xe9, 0xf4};
  uint8_t bytesprops2[] = {0x7a, 0xd, 0xfc, 0x93, 0xe9};
  uint8_t bytesprops3[] = {0x7c, 0xf1, 0x97, 0xbe, 0x86, 0x48, 0xc0, 0x54, 0x7c, 0x3b, 0xb};
  uint8_t bytesprops4[] = {0x39, 0xb1, 0xda, 0x77, 0xf3, 0x1f, 0xca, 0x7a, 0xcf, 0x33, 0x87, 0x39,
                           0xd8, 0xff, 0xc8, 0x6c, 0x1b, 0x73, 0x54, 0xf6, 0x85, 0x7a, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13066}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops0}, .v = {14, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18576}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15714}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31604}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22587}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 697}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15540}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb6};
  uint8_t byteswillprops1[] = {0xa2, 0x44, 0x5a, 0x26, 0x5f, 0xa0, 0x8e, 0x65, 0x52, 0x4b, 0x28,
                               0xec, 0x4c, 0x9c, 0x93, 0xb7, 0x37, 0xe0, 0xd,  0x68, 0x5a, 0x67};
  uint8_t byteswillprops2[] = {0x6f, 0x2e, 0x96, 0x98, 0xfd, 0x54, 0xf9, 0x30, 0xc9, 0x20, 0x48, 0xd2, 0xd3,
                               0xc6, 0xb9, 0x6c, 0x18, 0xae, 0x4a, 0x70, 0x77, 0xad, 0xab, 0x11, 0x72};
  uint8_t byteswillprops3[] = {0x43, 0x59, 0xcf, 0x77, 0x9a, 0x88, 0xe7, 0x2f};
  uint8_t byteswillprops4[] = {0xd3, 0x49, 0x6d, 0x47, 0xe4, 0xc2, 0xb7, 0xd4, 0x44,
                               0x8f, 0xb4, 0x56, 0xb4, 0x60, 0x62, 0xcb, 0xe5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20665}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20758}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10617}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26735}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x61, 0xd6, 0x99, 0x7e, 0x74, 0xda, 0x9f, 0xed,
                                0x72, 0xde, 0xc3, 0x27, 0xf6, 0x28, 0xaf};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe0, 0xcf, 0xf8, 0x5c, 0x19, 0x19, 0x2f, 0x75, 0xa, 0x37, 0x72, 0x4d, 0xd2};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15606;
  uint8_t client_id_bytes[] = {0x12, 0x4f, 0x3a, 0x6d, 0xf5, 0xc5, 0xd8, 0xc8, 0x5c, 0x9,  0xa2, 0xdd, 0xac, 0x77, 0xeb,
                               0x64, 0x31, 0x8a, 0xf0, 0x90, 0x1e, 0x58, 0x25, 0xd0, 0x43, 0xe,  0x50, 0x43, 0xc7};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x11, 0x4d, 0xb4, 0xd,  0x7,  0xfc, 0x77, 0x70, 0x5e, 0x62, 0x5a, 0x87, 0x7f,
                              0x32, 0x40, 0x5a, 0xfd, 0xa5, 0x12, 0x79, 0xd1, 0xe2, 0x72, 0x5d, 0xa4};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7y&\a\226\163R-*\143C\172?T4\174\227\&4$\202\150\&2\DLE\231\243", _password =
// Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive = 6271, _connID =
// "\193=\232\&0\251\248\&3\179\238?E\142", _properties = [PropTopicAlias 12909,PropAssignedClientIdentifier
// "\DC2\244KT\188\SYN\203\b\224\233\EMB\158e\174",PropTopicAliasMaximum 26424,PropSubscriptionIdentifier
// 24,PropAuthenticationData "\177#C\232E\164\208\147\247Y\186\172*m",PropCorrelationData "\192\219@\GS\208?\213
// Td7a",PropRetainAvailable 9,PropSessionExpiryInterval 13511,PropSessionExpiryInterval 7047,PropPayloadFormatIndicator
// 58,PropMaximumQoS 42,PropMessageExpiryInterval 20638,PropSharedSubscriptionAvailable 173,PropResponseInformation
// "\130\249\156\145\DC1FY\137\192\f\134\231\179\ACK\216\EM\237\217#\DC2L\251\DLE\161WA",PropWildcardSubscriptionAvailable
// 121,PropWillDelayInterval 7128,PropServerReference
// "\136\203\131\142xEw\179J\202Yg\218\231HT\249\180\GS\140\229C\DC3\233",PropCorrelationData
// "\143m\143\"\220\142",PropRequestResponseInformation 127,PropAuthenticationMethod "",PropResponseInformation
// "",PropRequestProblemInformation 149,PropServerKeepAlive 1854,PropServerReference
// "\159\152)\128\STXxK\140\153uC\225Y^o\254",PropAssignedClientIdentifier
// "\bLg\183\252w\212o\212\164V\203\EOT*y\145D$\211\DC3\183\238\185[h\167M\SYN",PropSharedSubscriptionAvailable
// 99,PropCorrelationData "\146\&1\"\157\143#|\135\237\179(
// E\DEL\203\199\163ae\172\162\130l\209\218c|\226\a",PropMaximumPacketSize 13527,PropTopicAlias
// 20115,PropSubscriptionIdentifierAvailable 130]}
TEST(Connect5QCTest, Encode67) {
  uint8_t pkt[] = {
      0x10, 0xb9, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x18, 0x7f, 0x84, 0x2,  0x23, 0x32, 0x6d, 0x12,
      0x0,  0xf,  0x12, 0xf4, 0x4b, 0x54, 0xbc, 0x16, 0xcb, 0x8,  0xe0, 0xe9, 0x19, 0x42, 0x9e, 0x65, 0xae, 0x22, 0x67,
      0x38, 0xb,  0x18, 0x16, 0x0,  0xe,  0xb1, 0x23, 0x43, 0xe8, 0x45, 0xa4, 0xd0, 0x93, 0xf7, 0x59, 0xba, 0xac, 0x2a,
      0x6d, 0x9,  0x0,  0xc,  0xc0, 0xdb, 0x40, 0x1d, 0xd0, 0x3f, 0xd5, 0x20, 0x54, 0x64, 0x37, 0x61, 0x25, 0x9,  0x11,
      0x0,  0x0,  0x34, 0xc7, 0x11, 0x0,  0x0,  0x1b, 0x87, 0x1,  0x3a, 0x24, 0x2a, 0x2,  0x0,  0x0,  0x50, 0x9e, 0x2a,
      0xad, 0x1a, 0x0,  0x1a, 0x82, 0xf9, 0x9c, 0x91, 0x11, 0x46, 0x59, 0x89, 0xc0, 0xc,  0x86, 0xe7, 0xb3, 0x6,  0xd8,
      0x19, 0xed, 0xd9, 0x23, 0x12, 0x4c, 0xfb, 0x10, 0xa1, 0x57, 0x41, 0x28, 0x79, 0x18, 0x0,  0x0,  0x1b, 0xd8, 0x1c,
      0x0,  0x18, 0x88, 0xcb, 0x83, 0x8e, 0x78, 0x45, 0x77, 0xb3, 0x4a, 0xca, 0x59, 0x67, 0xda, 0xe7, 0x48, 0x54, 0xf9,
      0xb4, 0x1d, 0x8c, 0xe5, 0x43, 0x13, 0xe9, 0x9,  0x0,  0x6,  0x8f, 0x6d, 0x8f, 0x22, 0xdc, 0x8e, 0x19, 0x7f, 0x15,
      0x0,  0x0,  0x1a, 0x0,  0x0,  0x17, 0x95, 0x13, 0x7,  0x3e, 0x1c, 0x0,  0x10, 0x9f, 0x98, 0x29, 0x80, 0x2,  0x78,
      0x4b, 0x8c, 0x99, 0x75, 0x43, 0xe1, 0x59, 0x5e, 0x6f, 0xfe, 0x12, 0x0,  0x1c, 0x8,  0x4c, 0x67, 0xb7, 0xfc, 0x77,
      0xd4, 0x6f, 0xd4, 0xa4, 0x56, 0xcb, 0x4,  0x2a, 0x79, 0x91, 0x44, 0x24, 0xd3, 0x13, 0xb7, 0xee, 0xb9, 0x5b, 0x68,
      0xa7, 0x4d, 0x16, 0x2a, 0x63, 0x9,  0x0,  0x1d, 0x92, 0x31, 0x22, 0x9d, 0x8f, 0x23, 0x7c, 0x87, 0xed, 0xb3, 0x28,
      0x20, 0x45, 0x7f, 0xcb, 0xc7, 0xa3, 0x61, 0x65, 0xac, 0xa2, 0x82, 0x6c, 0xd1, 0xda, 0x63, 0x7c, 0xe2, 0x7,  0x27,
      0x0,  0x0,  0x34, 0xd7, 0x23, 0x4e, 0x93, 0x29, 0x82, 0x0,  0xc,  0xc1, 0x3d, 0xe8, 0x30, 0xfb, 0xf8, 0x33, 0xb3,
      0xee, 0x3f, 0x45, 0x8e, 0x0,  0x19, 0x37, 0x79, 0x26, 0x7,  0xe2, 0xa3, 0x52, 0x2d, 0x2a, 0x8f, 0x43, 0xac, 0x3f,
      0x54, 0x34, 0xae, 0xe3, 0x34, 0x24, 0xca, 0x96, 0x32, 0x10, 0xe7, 0xf3};

  uint8_t buf[326] = {0};

  uint8_t bytesprops0[] = {0x12, 0xf4, 0x4b, 0x54, 0xbc, 0x16, 0xcb, 0x8, 0xe0, 0xe9, 0x19, 0x42, 0x9e, 0x65, 0xae};
  uint8_t bytesprops1[] = {0xb1, 0x23, 0x43, 0xe8, 0x45, 0xa4, 0xd0, 0x93, 0xf7, 0x59, 0xba, 0xac, 0x2a, 0x6d};
  uint8_t bytesprops2[] = {0xc0, 0xdb, 0x40, 0x1d, 0xd0, 0x3f, 0xd5, 0x20, 0x54, 0x64, 0x37, 0x61};
  uint8_t bytesprops3[] = {0x82, 0xf9, 0x9c, 0x91, 0x11, 0x46, 0x59, 0x89, 0xc0, 0xc,  0x86, 0xe7, 0xb3,
                           0x6,  0xd8, 0x19, 0xed, 0xd9, 0x23, 0x12, 0x4c, 0xfb, 0x10, 0xa1, 0x57, 0x41};
  uint8_t bytesprops4[] = {0x88, 0xcb, 0x83, 0x8e, 0x78, 0x45, 0x77, 0xb3, 0x4a, 0xca, 0x59, 0x67,
                           0xda, 0xe7, 0x48, 0x54, 0xf9, 0xb4, 0x1d, 0x8c, 0xe5, 0x43, 0x13, 0xe9};
  uint8_t bytesprops5[] = {0x8f, 0x6d, 0x8f, 0x22, 0xdc, 0x8e};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x9f, 0x98, 0x29, 0x80, 0x2,  0x78, 0x4b, 0x8c,
                           0x99, 0x75, 0x43, 0xe1, 0x59, 0x5e, 0x6f, 0xfe};
  uint8_t bytesprops9[] = {0x8,  0x4c, 0x67, 0xb7, 0xfc, 0x77, 0xd4, 0x6f, 0xd4, 0xa4, 0x56, 0xcb, 0x4,  0x2a,
                           0x79, 0x91, 0x44, 0x24, 0xd3, 0x13, 0xb7, 0xee, 0xb9, 0x5b, 0x68, 0xa7, 0x4d, 0x16};
  uint8_t bytesprops10[] = {0x92, 0x31, 0x22, 0x9d, 0x8f, 0x23, 0x7c, 0x87, 0xed, 0xb3, 0x28, 0x20, 0x45, 0x7f, 0xcb,
                            0xc7, 0xa3, 0x61, 0x65, 0xac, 0xa2, 0x82, 0x6c, 0xd1, 0xda, 0x63, 0x7c, 0xe2, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12909}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26424}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13511}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7047}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20638}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7128}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1854}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13527}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20115}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 130}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6271;
  uint8_t client_id_bytes[] = {0xc1, 0x3d, 0xe8, 0x30, 0xfb, 0xf8, 0x33, 0xb3, 0xee, 0x3f, 0x45, 0x8e};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x79, 0x26, 0x7,  0xe2, 0xa3, 0x52, 0x2d, 0x2a, 0x8f, 0x43, 0xac, 0x3f,
                              0x54, 0x34, 0xae, 0xe3, 0x34, 0x24, 0xca, 0x96, 0x32, 0x10, 0xe7, 0xf3};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\NAK=\230S\192\217KW\211\176\174\190\213\179a\138\ENQR\222",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\218\251\CAN\137\184\196\247\&0u\SYNZ", _willMsg = "\140\162\226\246\\\158,\b\141\157Z$+", _willProps =
// [PropAuthenticationMethod "!Y\246\135\136\194 \233\208om\171[$\131TI\CANr\227",PropSessionExpiryInterval
// 15018,PropRetainAvailable 75,PropPayloadFormatIndicator 193,PropReceiveMaximum 24624,PropTopicAlias
// 1393,PropCorrelationData "\153 <\241\DC1\244\177=]\157\218\NUL(\EOTC",PropCorrelationData
// "sn\RS'\227\b/\141\210DO?\230\171\NAK%\162\195\220B\253",PropAuthenticationData
// "1\ETX2\154\237\146\183\217\158\163",PropAssignedClientIdentifier
// "\196\ENQ\128\254\153\169",PropRequestResponseInformation 65,PropReasonString "\203\183",PropAssignedClientIdentifier
// "",PropServerKeepAlive 7567,PropMessageExpiryInterval 10027,PropWillDelayInterval 4878,PropContentType
// "@/\NUL\169",PropRequestResponseInformation 210,PropResponseTopic
// "\218\ETB\204\254\207u\132\229\144\133\213\134}DDsl",PropCorrelationData
// "\196\240U\248",PropWildcardSubscriptionAvailable 42,PropTopicAlias 28909,PropSubscriptionIdentifierAvailable
// 10,PropCorrelationData "\184\&8Z\163\\\t\154\160D\ACK\190\133\154\151",PropAuthenticationMethod
// "S\175V\175\191\181\226\206\186\DC4\254\155\134W\178\255",PropResponseInformation
// "\238+&\227\235eg\189\133Q7D\CAN\DC1\147\188\158\170\251\159x\236\234\&8N\146n"]}), _cleanSession = False, _keepAlive
// = 18470, _connID = "\145\177\179\193o\203\219\238Y:\131\b\140\246\195\211\214\210p\177", _properties =
// [PropAssignedClientIdentifier ""]}
TEST(Connect5QCTest, Encode68) {
  uint8_t pkt[] = {
      0x10, 0xac, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x24, 0x48, 0x26, 0x3,  0x12, 0x0,  0x0,  0x0,  0x14,
      0x91, 0xb1, 0xb3, 0xc1, 0x6f, 0xcb, 0xdb, 0xee, 0x59, 0x3a, 0x83, 0x8,  0x8c, 0xf6, 0xc3, 0xd3, 0xd6, 0xd2, 0x70,
      0xb1, 0xea, 0x1,  0x15, 0x0,  0x14, 0x21, 0x59, 0xf6, 0x87, 0x88, 0xc2, 0x20, 0xe9, 0xd0, 0x6f, 0x6d, 0xab, 0x5b,
      0x24, 0x83, 0x54, 0x49, 0x18, 0x72, 0xe3, 0x11, 0x0,  0x0,  0x3a, 0xaa, 0x25, 0x4b, 0x1,  0xc1, 0x21, 0x60, 0x30,
      0x23, 0x5,  0x71, 0x9,  0x0,  0xf,  0x99, 0x20, 0x3c, 0xf1, 0x11, 0xf4, 0xb1, 0x3d, 0x5d, 0x9d, 0xda, 0x0,  0x28,
      0x4,  0x43, 0x9,  0x0,  0x15, 0x73, 0x6e, 0x1e, 0x27, 0xe3, 0x8,  0x2f, 0x8d, 0xd2, 0x44, 0x4f, 0x3f, 0xe6, 0xab,
      0x15, 0x25, 0xa2, 0xc3, 0xdc, 0x42, 0xfd, 0x16, 0x0,  0xa,  0x31, 0x3,  0x32, 0x9a, 0xed, 0x92, 0xb7, 0xd9, 0x9e,
      0xa3, 0x12, 0x0,  0x6,  0xc4, 0x5,  0x80, 0xfe, 0x99, 0xa9, 0x19, 0x41, 0x1f, 0x0,  0x2,  0xcb, 0xb7, 0x12, 0x0,
      0x0,  0x13, 0x1d, 0x8f, 0x2,  0x0,  0x0,  0x27, 0x2b, 0x18, 0x0,  0x0,  0x13, 0xe,  0x3,  0x0,  0x4,  0x40, 0x2f,
      0x0,  0xa9, 0x19, 0xd2, 0x8,  0x0,  0x11, 0xda, 0x17, 0xcc, 0xfe, 0xcf, 0x75, 0x84, 0xe5, 0x90, 0x85, 0xd5, 0x86,
      0x7d, 0x44, 0x44, 0x73, 0x6c, 0x9,  0x0,  0x4,  0xc4, 0xf0, 0x55, 0xf8, 0x28, 0x2a, 0x23, 0x70, 0xed, 0x29, 0xa,
      0x9,  0x0,  0xe,  0xb8, 0x38, 0x5a, 0xa3, 0x5c, 0x9,  0x9a, 0xa0, 0x44, 0x6,  0xbe, 0x85, 0x9a, 0x97, 0x15, 0x0,
      0x10, 0x53, 0xaf, 0x56, 0xaf, 0xbf, 0xb5, 0xe2, 0xce, 0xba, 0x14, 0xfe, 0x9b, 0x86, 0x57, 0xb2, 0xff, 0x1a, 0x0,
      0x1b, 0xee, 0x2b, 0x26, 0xe3, 0xeb, 0x65, 0x67, 0xbd, 0x85, 0x51, 0x37, 0x44, 0x18, 0x11, 0x93, 0xbc, 0x9e, 0xaa,
      0xfb, 0x9f, 0x78, 0xec, 0xea, 0x38, 0x4e, 0x92, 0x6e, 0x0,  0xb,  0xda, 0xfb, 0x18, 0x89, 0xb8, 0xc4, 0xf7, 0x30,
      0x75, 0x16, 0x5a, 0x0,  0xd,  0x8c, 0xa2, 0xe2, 0xf6, 0x5c, 0x9e, 0x2c, 0x8,  0x8d, 0x9d, 0x5a, 0x24, 0x2b};

  uint8_t buf[313] = {0};

  uint8_t bytesprops0[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x21, 0x59, 0xf6, 0x87, 0x88, 0xc2, 0x20, 0xe9, 0xd0, 0x6f,
                               0x6d, 0xab, 0x5b, 0x24, 0x83, 0x54, 0x49, 0x18, 0x72, 0xe3};
  uint8_t byteswillprops1[] = {0x99, 0x20, 0x3c, 0xf1, 0x11, 0xf4, 0xb1, 0x3d, 0x5d, 0x9d, 0xda, 0x0, 0x28, 0x4, 0x43};
  uint8_t byteswillprops2[] = {0x73, 0x6e, 0x1e, 0x27, 0xe3, 0x8,  0x2f, 0x8d, 0xd2, 0x44, 0x4f,
                               0x3f, 0xe6, 0xab, 0x15, 0x25, 0xa2, 0xc3, 0xdc, 0x42, 0xfd};
  uint8_t byteswillprops3[] = {0x31, 0x3, 0x32, 0x9a, 0xed, 0x92, 0xb7, 0xd9, 0x9e, 0xa3};
  uint8_t byteswillprops4[] = {0xc4, 0x5, 0x80, 0xfe, 0x99, 0xa9};
  uint8_t byteswillprops5[] = {0xcb, 0xb7};
  uint8_t byteswillprops6[] = {0};
  uint8_t byteswillprops7[] = {0x40, 0x2f, 0x0, 0xa9};
  uint8_t byteswillprops8[] = {0xda, 0x17, 0xcc, 0xfe, 0xcf, 0x75, 0x84, 0xe5, 0x90,
                               0x85, 0xd5, 0x86, 0x7d, 0x44, 0x44, 0x73, 0x6c};
  uint8_t byteswillprops9[] = {0xc4, 0xf0, 0x55, 0xf8};
  uint8_t byteswillprops10[] = {0xb8, 0x38, 0x5a, 0xa3, 0x5c, 0x9, 0x9a, 0xa0, 0x44, 0x6, 0xbe, 0x85, 0x9a, 0x97};
  uint8_t byteswillprops11[] = {0x53, 0xaf, 0x56, 0xaf, 0xbf, 0xb5, 0xe2, 0xce,
                                0xba, 0x14, 0xfe, 0x9b, 0x86, 0x57, 0xb2, 0xff};
  uint8_t byteswillprops12[] = {0xee, 0x2b, 0x26, 0xe3, 0xeb, 0x65, 0x67, 0xbd, 0x85, 0x51, 0x37, 0x44, 0x18, 0x11,
                                0x93, 0xbc, 0x9e, 0xaa, 0xfb, 0x9f, 0x78, 0xec, 0xea, 0x38, 0x4e, 0x92, 0x6e};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15018}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24624}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1393}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7567}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10027}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4878}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28909}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0xfb, 0x18, 0x89, 0xb8, 0xc4, 0xf7, 0x30, 0x75, 0x16, 0x5a};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8c, 0xa2, 0xe2, 0xf6, 0x5c, 0x9e, 0x2c, 0x8, 0x8d, 0x9d, 0x5a, 0x24, 0x2b};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18470;
  uint8_t client_id_bytes[] = {0x91, 0xb1, 0xb3, 0xc1, 0x6f, 0xcb, 0xdb, 0xee, 0x59, 0x3a,
                               0x83, 0x8,  0x8c, 0xf6, 0xc3, 0xd3, 0xd6, 0xd2, 0x70, 0xb1};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x15, 0x3d, 0xe6, 0x53, 0xc0, 0xd9, 0x4b, 0x57, 0xd3, 0xb0,
                              0xae, 0xbe, 0xd5, 0xb3, 0x61, 0x8a, 0x5,  0x52, 0xde};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\SOH\253\128h\214\136>\244<\255\153", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "n\221.g\231\209[a*n'\214al\147\241$\175'-J\140\217\175\152\130\155\232", _willMsg =
// "\US\161\236\DC2\138\211_\ESC\244", _willProps = [PropTopicAlias 27954,PropSubscriptionIdentifier
// 12,PropAuthenticationData "\186(J",PropUserProperty "" ";\235\\\DC1\146\255\185\ACK",PropTopicAliasMaximum
// 18528,PropReasonString
// "\167G\198\a\249\150\184\195\210\130\249\SUB\206\DEL\249m\185:\182\224\177\254",PropUserProperty "i4\n\232iz\191\GS"
// ">\232)\SOv\v\rF\199G\DC1l9\224.\251",PropRequestResponseInformation 102,PropCorrelationData
// "\210\223\183\209\SYNz(i\164\159 ym\206\170\224\175\233:/\165\172Y\183X\r&}0",PropTopicAlias
// 4523,PropMessageExpiryInterval 15484,PropResponseTopic
// "B\SUB\181\202\154-\165\157\239`\150(\166\201\146",PropCorrelationData "\207\220\167\172\FS",PropUserProperty
// "\235\209\255\154C\DC1\155K/\DLE\183d7Ib\167J\128\&9" "\192\190\DC3\237\199",PropServerReference
// "\n$\GS\184g#",PropPayloadFormatIndicator 230,PropServerKeepAlive 2306,PropSharedSubscriptionAvailable 103]}),
// _cleanSession = True, _keepAlive = 9181, _connID = "M\156\DC4\133Z\205\NAK&", _properties = [PropResponseInformation
// "qg\170\DEL\192\194V\130<\226U\139\166\&5\"Qp",PropSubscriptionIdentifierAvailable 60,PropServerKeepAlive
// 2214,PropMaximumQoS 109,PropSubscriptionIdentifierAvailable 83,PropReceiveMaximum 5805,PropServerKeepAlive
// 15509,PropWildcardSubscriptionAvailable 66,PropTopicAliasMaximum 29709,PropResponseTopic
// "\STXE1\231\136\190e\190\192\232\225",PropWildcardSubscriptionAvailable 0,PropTopicAlias
// 10103,PropSubscriptionIdentifierAvailable 198,PropRequestProblemInformation 61,PropServerKeepAlive
// 11863,PropSubscriptionIdentifierAvailable 153,PropSubscriptionIdentifierAvailable 33,PropWillDelayInterval
// 13860,PropAuthenticationData "\233\\\148",PropContentType
// ">\CAN\EM\173\EM\200\138\155\153\SUB\134=\DC114\229\172\162w\DC2\141q\186\188\171",PropAssignedClientIdentifier
// "&\240/\167E\150\238A\190o\252\131\139\&3",PropAssignedClientIdentifier
// "\128\144\253\244e\238\158U~\139\EOTU\"n\164\v\229\&0",PropRetainAvailable 146,PropWildcardSubscriptionAvailable
// 188,PropSharedSubscriptionAvailable 162,PropRequestProblemInformation 102,PropWildcardSubscriptionAvailable 223]}
TEST(Connect5QCTest, Encode69) {
  uint8_t pkt[] = {
      0x10, 0xa0, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6,  0x23, 0xdd, 0x9d, 0x1,  0x1a, 0x0,  0x11, 0x71,
      0x67, 0xaa, 0x7f, 0xc0, 0xc2, 0x56, 0x82, 0x3c, 0xe2, 0x55, 0x8b, 0xa6, 0x35, 0x22, 0x51, 0x70, 0x29, 0x3c, 0x13,
      0x8,  0xa6, 0x24, 0x6d, 0x29, 0x53, 0x21, 0x16, 0xad, 0x13, 0x3c, 0x95, 0x28, 0x42, 0x22, 0x74, 0xd,  0x8,  0x0,
      0xb,  0x2,  0x45, 0x31, 0xe7, 0x88, 0xbe, 0x65, 0xbe, 0xc0, 0xe8, 0xe1, 0x28, 0x0,  0x23, 0x27, 0x77, 0x29, 0xc6,
      0x17, 0x3d, 0x13, 0x2e, 0x57, 0x29, 0x99, 0x29, 0x21, 0x18, 0x0,  0x0,  0x36, 0x24, 0x16, 0x0,  0x3,  0xe9, 0x5c,
      0x94, 0x3,  0x0,  0x19, 0x3e, 0x18, 0x19, 0xad, 0x19, 0xc8, 0x8a, 0x9b, 0x99, 0x1a, 0x86, 0x3d, 0x11, 0x31, 0x34,
      0xe5, 0xac, 0xa2, 0x77, 0x12, 0x8d, 0x71, 0xba, 0xbc, 0xab, 0x12, 0x0,  0xe,  0x26, 0xf0, 0x2f, 0xa7, 0x45, 0x96,
      0xee, 0x41, 0xbe, 0x6f, 0xfc, 0x83, 0x8b, 0x33, 0x12, 0x0,  0x12, 0x80, 0x90, 0xfd, 0xf4, 0x65, 0xee, 0x9e, 0x55,
      0x7e, 0x8b, 0x4,  0x55, 0x22, 0x6e, 0xa4, 0xb,  0xe5, 0x30, 0x25, 0x92, 0x28, 0xbc, 0x2a, 0xa2, 0x17, 0x66, 0x28,
      0xdf, 0x0,  0x8,  0x4d, 0x9c, 0x14, 0x85, 0x5a, 0xcd, 0x15, 0x26, 0xc2, 0x1,  0x23, 0x6d, 0x32, 0xb,  0xc,  0x16,
      0x0,  0x3,  0xba, 0x28, 0x4a, 0x26, 0x0,  0x0,  0x0,  0x8,  0x3b, 0xeb, 0x5c, 0x11, 0x92, 0xff, 0xb9, 0x6,  0x22,
      0x48, 0x60, 0x1f, 0x0,  0x16, 0xa7, 0x47, 0xc6, 0x7,  0xf9, 0x96, 0xb8, 0xc3, 0xd2, 0x82, 0xf9, 0x1a, 0xce, 0x7f,
      0xf9, 0x6d, 0xb9, 0x3a, 0xb6, 0xe0, 0xb1, 0xfe, 0x26, 0x0,  0x8,  0x69, 0x34, 0xa,  0xe8, 0x69, 0x7a, 0xbf, 0x1d,
      0x0,  0x10, 0x3e, 0xe8, 0x29, 0xe,  0x76, 0xb,  0xd,  0x46, 0xc7, 0x47, 0x11, 0x6c, 0x39, 0xe0, 0x2e, 0xfb, 0x19,
      0x66, 0x9,  0x0,  0x1d, 0xd2, 0xdf, 0xb7, 0xd1, 0x16, 0x7a, 0x28, 0x69, 0xa4, 0x9f, 0x20, 0x79, 0x6d, 0xce, 0xaa,
      0xe0, 0xaf, 0xe9, 0x3a, 0x2f, 0xa5, 0xac, 0x59, 0xb7, 0x58, 0xd,  0x26, 0x7d, 0x30, 0x23, 0x11, 0xab, 0x2,  0x0,
      0x0,  0x3c, 0x7c, 0x8,  0x0,  0xf,  0x42, 0x1a, 0xb5, 0xca, 0x9a, 0x2d, 0xa5, 0x9d, 0xef, 0x60, 0x96, 0x28, 0xa6,
      0xc9, 0x92, 0x9,  0x0,  0x5,  0xcf, 0xdc, 0xa7, 0xac, 0x1c, 0x26, 0x0,  0x13, 0xeb, 0xd1, 0xff, 0x9a, 0x43, 0x11,
      0x9b, 0x4b, 0x2f, 0x10, 0xb7, 0x64, 0x37, 0x49, 0x62, 0xa7, 0x4a, 0x80, 0x39, 0x0,  0x5,  0xc0, 0xbe, 0x13, 0xed,
      0xc7, 0x1c, 0x0,  0x6,  0xa,  0x24, 0x1d, 0xb8, 0x67, 0x23, 0x1,  0xe6, 0x13, 0x9,  0x2,  0x2a, 0x67, 0x0,  0x1c,
      0x6e, 0xdd, 0x2e, 0x67, 0xe7, 0xd1, 0x5b, 0x61, 0x2a, 0x6e, 0x27, 0xd6, 0x61, 0x6c, 0x93, 0xf1, 0x24, 0xaf, 0x27,
      0x2d, 0x4a, 0x8c, 0xd9, 0xaf, 0x98, 0x82, 0x9b, 0xe8, 0x0,  0x9,  0x1f, 0xa1, 0xec, 0x12, 0x8a, 0xd3, 0x5f, 0x1b,
      0xf4};

  uint8_t buf[429] = {0};

  uint8_t bytesprops0[] = {0x71, 0x67, 0xaa, 0x7f, 0xc0, 0xc2, 0x56, 0x82, 0x3c,
                           0xe2, 0x55, 0x8b, 0xa6, 0x35, 0x22, 0x51, 0x70};
  uint8_t bytesprops1[] = {0x2, 0x45, 0x31, 0xe7, 0x88, 0xbe, 0x65, 0xbe, 0xc0, 0xe8, 0xe1};
  uint8_t bytesprops2[] = {0xe9, 0x5c, 0x94};
  uint8_t bytesprops3[] = {0x3e, 0x18, 0x19, 0xad, 0x19, 0xc8, 0x8a, 0x9b, 0x99, 0x1a, 0x86, 0x3d, 0x11,
                           0x31, 0x34, 0xe5, 0xac, 0xa2, 0x77, 0x12, 0x8d, 0x71, 0xba, 0xbc, 0xab};
  uint8_t bytesprops4[] = {0x26, 0xf0, 0x2f, 0xa7, 0x45, 0x96, 0xee, 0x41, 0xbe, 0x6f, 0xfc, 0x83, 0x8b, 0x33};
  uint8_t bytesprops5[] = {0x80, 0x90, 0xfd, 0xf4, 0x65, 0xee, 0x9e, 0x55, 0x7e,
                           0x8b, 0x4,  0x55, 0x22, 0x6e, 0xa4, 0xb,  0xe5, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2214}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5805}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15509}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29709}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10103}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11863}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13860}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 223}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xba, 0x28, 0x4a};
  uint8_t byteswillprops2[] = {0x3b, 0xeb, 0x5c, 0x11, 0x92, 0xff, 0xb9, 0x6};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops3[] = {0xa7, 0x47, 0xc6, 0x7,  0xf9, 0x96, 0xb8, 0xc3, 0xd2, 0x82, 0xf9,
                               0x1a, 0xce, 0x7f, 0xf9, 0x6d, 0xb9, 0x3a, 0xb6, 0xe0, 0xb1, 0xfe};
  uint8_t byteswillprops5[] = {0x3e, 0xe8, 0x29, 0xe,  0x76, 0xb,  0xd,  0x46,
                               0xc7, 0x47, 0x11, 0x6c, 0x39, 0xe0, 0x2e, 0xfb};
  uint8_t byteswillprops4[] = {0x69, 0x34, 0xa, 0xe8, 0x69, 0x7a, 0xbf, 0x1d};
  uint8_t byteswillprops6[] = {0xd2, 0xdf, 0xb7, 0xd1, 0x16, 0x7a, 0x28, 0x69, 0xa4, 0x9f, 0x20, 0x79, 0x6d, 0xce, 0xaa,
                               0xe0, 0xaf, 0xe9, 0x3a, 0x2f, 0xa5, 0xac, 0x59, 0xb7, 0x58, 0xd,  0x26, 0x7d, 0x30};
  uint8_t byteswillprops7[] = {0x42, 0x1a, 0xb5, 0xca, 0x9a, 0x2d, 0xa5, 0x9d,
                               0xef, 0x60, 0x96, 0x28, 0xa6, 0xc9, 0x92};
  uint8_t byteswillprops8[] = {0xcf, 0xdc, 0xa7, 0xac, 0x1c};
  uint8_t byteswillprops10[] = {0xc0, 0xbe, 0x13, 0xed, 0xc7};
  uint8_t byteswillprops9[] = {0xeb, 0xd1, 0xff, 0x9a, 0x43, 0x11, 0x9b, 0x4b, 0x2f, 0x10,
                               0xb7, 0x64, 0x37, 0x49, 0x62, 0xa7, 0x4a, 0x80, 0x39};
  uint8_t byteswillprops11[] = {0xa, 0x24, 0x1d, 0xb8, 0x67, 0x23};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27954}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops1}, .v = {8, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18528}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops4}, .v = {16, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4523}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15484}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&byteswillprops9}, .v = {5, (char*)&byteswillprops10}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2306}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6e, 0xdd, 0x2e, 0x67, 0xe7, 0xd1, 0x5b, 0x61, 0x2a, 0x6e, 0x27, 0xd6, 0x61, 0x6c,
                                0x93, 0xf1, 0x24, 0xaf, 0x27, 0x2d, 0x4a, 0x8c, 0xd9, 0xaf, 0x98, 0x82, 0x9b, 0xe8};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1f, 0xa1, 0xec, 0x12, 0x8a, 0xd3, 0x5f, 0x1b, 0xf4};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9181;
  uint8_t client_id_bytes[] = {0x4d, 0x9c, 0x14, 0x85, 0x5a, 0xcd, 0x15, 0x26};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1, 0xfd, 0x80, 0x68, 0xd6, 0x88, 0x3e, 0xf4, 0x3c, 0xff, 0x99};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\227\ESCQ", _password = Just "\231\239\188\247\236\FSU\172\t\232D", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "(7<,XJ9\ETB\231t\245\245\214\208\FSj\131",
// _willMsg = "", _willProps = [PropMaximumPacketSize 13992,PropUserProperty "\165\145\192A\164~wb\153\252\SYN"
// "e\167\ETX\STX|j\a\160\185\229o\155\176\168\167\b",PropSharedSubscriptionAvailable 66,PropContentType
// "'\SOH\196\&9,5\209",PropWillDelayInterval 17285,PropSessionExpiryInterval 8449,PropSessionExpiryInterval
// 18445,PropReceiveMaximum 5075,PropSubscriptionIdentifierAvailable 202,PropResponseInformation "",PropResponseTopic
// "\214<G\136\168\&3\230\DC4\\7\EOTY\134+wZ\178Rn\v\141u\ENQ\ETX\173\211+w\238k",PropRequestProblemInformation
// 66,PropWildcardSubscriptionAvailable 3,PropContentType
// "fJM\"\152\234]\145\177!\129gEXO\170\155\145\232.",PropReasonString
// "xk\188q\SI(0\213E\212,\193\243\170$\203!\164\188\200w\187\161\245p\DELS\215\186e",PropAuthenticationMethod
// "\t\ESCH\212\236\SI\SYNo\243",PropWillDelayInterval 3968,PropSubscriptionIdentifierAvailable
// 171,PropMaximumPacketSize 12200,PropWildcardSubscriptionAvailable 156,PropAuthenticationData
// "v\a\174\187\172Ouq\144\t\220k\177\178\247\204\244?\247\172~\252q\192;6/",PropMessageExpiryInterval
// 2591,PropServerReference "M38!\158\157%n6\159O",PropMessageExpiryInterval 3778,PropTopicAlias
// 31360,PropCorrelationData "\152\231\154S#\220\158&l\159\EOTa\DC1u\148]\148\182\192\241"]}), _cleanSession = False,
// _keepAlive = 70, _connID =
// "\226\&9\142F\US\236\161\186\252\236\147\229\210E\130\EMh\128\129\DC3axe\165\179\238Vi\169\245", _properties =
// [PropWillDelayInterval 23594,PropWildcardSubscriptionAvailable 82,PropAuthenticationMethod
// "{\240\164\140\154",PropRequestResponseInformation 132,PropRequestResponseInformation 88,PropMaximumPacketSize
// 19608,PropResponseTopic "",PropReasonString "W\211\234k\157\CAN\199\216\159O\vj\EOT\239\189q\194",PropReasonString
// "\234V\149*\ETX\139\154\SI\151\251\139\159\SYND\220\223\186\253\255",PropAuthenticationMethod
// "\160\GS\199",PropSubscriptionIdentifier 18,PropWildcardSubscriptionAvailable 94,PropUserProperty
// "\193R\216\205\&5n\232,\174T\165\196"
// "\USJ\251[#\DELF\221d\142\168\245\CAN\189J\223\154\&1n\222\129+\219V\227Y\224\230\NUL",PropAuthenticationData
// "\196{f\SO\205\DC2\232\236\STX\151\218r\251\205\FSR\210\US\136\202\198E\201\139I\172\198",PropAssignedClientIdentifier
// "\NAK",PropAuthenticationMethod
// "\228\SYN\222`\210n\168m\132\156\&0)\166\CAN\146\SIY\219\208{\SUB\139\151\240\t'\SO",PropSharedSubscriptionAvailable
// 87,PropAuthenticationData "\SI\EMP\216\151:\236t\SYNv\175\181i\159",PropMessageExpiryInterval 19065,PropResponseTopic
// "IT",PropSubscriptionIdentifier 13,PropSubscriptionIdentifierAvailable 85,PropRetainAvailable 232,PropResponseTopic
// "uf\DLE\183\191\141t\200\DEL6\136\234\207\131\137\141\209W`\EOT\176qfvjS\240\229",PropSessionExpiryInterval
// 19436,PropServerKeepAlive 21005,PropResponseInformation "T",PropContentType
// "H\214}\a\226\233\&4gK\224\GSM\189DG?\205\196"]}
TEST(Connect5QCTest, Encode70) {
  uint8_t pkt[] = {
      0x10, 0x84, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x0,  0x46, 0xa0, 0x2,  0x18, 0x0,  0x0,  0x5c,
      0x2a, 0x28, 0x52, 0x15, 0x0,  0x5,  0x7b, 0xf0, 0xa4, 0x8c, 0x9a, 0x19, 0x84, 0x19, 0x58, 0x27, 0x0,  0x0,  0x4c,
      0x98, 0x8,  0x0,  0x0,  0x1f, 0x0,  0x11, 0x57, 0xd3, 0xea, 0x6b, 0x9d, 0x18, 0xc7, 0xd8, 0x9f, 0x4f, 0xb,  0x6a,
      0x4,  0xef, 0xbd, 0x71, 0xc2, 0x1f, 0x0,  0x13, 0xea, 0x56, 0x95, 0x2a, 0x3,  0x8b, 0x9a, 0xf,  0x97, 0xfb, 0x8b,
      0x9f, 0x16, 0x44, 0xdc, 0xdf, 0xba, 0xfd, 0xff, 0x15, 0x0,  0x3,  0xa0, 0x1d, 0xc7, 0xb,  0x12, 0x28, 0x5e, 0x26,
      0x0,  0xc,  0xc1, 0x52, 0xd8, 0xcd, 0x35, 0x6e, 0xe8, 0x2c, 0xae, 0x54, 0xa5, 0xc4, 0x0,  0x1d, 0x1f, 0x4a, 0xfb,
      0x5b, 0x23, 0x7f, 0x46, 0xdd, 0x64, 0x8e, 0xa8, 0xf5, 0x18, 0xbd, 0x4a, 0xdf, 0x9a, 0x31, 0x6e, 0xde, 0x81, 0x2b,
      0xdb, 0x56, 0xe3, 0x59, 0xe0, 0xe6, 0x0,  0x16, 0x0,  0x1b, 0xc4, 0x7b, 0x66, 0xe,  0xcd, 0x12, 0xe8, 0xec, 0x2,
      0x97, 0xda, 0x72, 0xfb, 0xcd, 0x1c, 0x52, 0xd2, 0x1f, 0x88, 0xca, 0xc6, 0x45, 0xc9, 0x8b, 0x49, 0xac, 0xc6, 0x12,
      0x0,  0x1,  0x15, 0x15, 0x0,  0x1b, 0xe4, 0x16, 0xde, 0x60, 0xd2, 0x6e, 0xa8, 0x6d, 0x84, 0x9c, 0x30, 0x29, 0xa6,
      0x18, 0x92, 0xf,  0x59, 0xdb, 0xd0, 0x7b, 0x1a, 0x8b, 0x97, 0xf0, 0x9,  0x27, 0xe,  0x2a, 0x57, 0x16, 0x0,  0xe,
      0xf,  0x19, 0x50, 0xd8, 0x97, 0x3a, 0xec, 0x74, 0x16, 0x76, 0xaf, 0xb5, 0x69, 0x9f, 0x2,  0x0,  0x0,  0x4a, 0x79,
      0x8,  0x0,  0x2,  0x49, 0x54, 0xb,  0xd,  0x29, 0x55, 0x25, 0xe8, 0x8,  0x0,  0x1c, 0x75, 0x66, 0x10, 0xb7, 0xbf,
      0x8d, 0x74, 0xc8, 0x7f, 0x36, 0x88, 0xea, 0xcf, 0x83, 0x89, 0x8d, 0xd1, 0x57, 0x60, 0x4,  0xb0, 0x71, 0x66, 0x76,
      0x6a, 0x53, 0xf0, 0xe5, 0x11, 0x0,  0x0,  0x4b, 0xec, 0x13, 0x52, 0xd,  0x1a, 0x0,  0x1,  0x54, 0x3,  0x0,  0x12,
      0x48, 0xd6, 0x7d, 0x7,  0xe2, 0xe9, 0x34, 0x67, 0x4b, 0xe0, 0x1d, 0x4d, 0xbd, 0x44, 0x47, 0x3f, 0xcd, 0xc4, 0x0,
      0x1e, 0xe2, 0x39, 0x8e, 0x46, 0x1f, 0xec, 0xa1, 0xba, 0xfc, 0xec, 0x93, 0xe5, 0xd2, 0x45, 0x82, 0x19, 0x68, 0x80,
      0x81, 0x13, 0x61, 0x78, 0x65, 0xa5, 0xb3, 0xee, 0x56, 0x69, 0xa9, 0xf5, 0x8f, 0x2,  0x27, 0x0,  0x0,  0x36, 0xa8,
      0x26, 0x0,  0xb,  0xa5, 0x91, 0xc0, 0x41, 0xa4, 0x7e, 0x77, 0x62, 0x99, 0xfc, 0x16, 0x0,  0x10, 0x65, 0xa7, 0x3,
      0x2,  0x7c, 0x6a, 0x7,  0xa0, 0xb9, 0xe5, 0x6f, 0x9b, 0xb0, 0xa8, 0xa7, 0x8,  0x2a, 0x42, 0x3,  0x0,  0x7,  0x27,
      0x1,  0xc4, 0x39, 0x2c, 0x35, 0xd1, 0x18, 0x0,  0x0,  0x43, 0x85, 0x11, 0x0,  0x0,  0x21, 0x1,  0x11, 0x0,  0x0,
      0x48, 0xd,  0x21, 0x13, 0xd3, 0x29, 0xca, 0x1a, 0x0,  0x0,  0x8,  0x0,  0x1e, 0xd6, 0x3c, 0x47, 0x88, 0xa8, 0x33,
      0xe6, 0x14, 0x5c, 0x37, 0x4,  0x59, 0x86, 0x2b, 0x77, 0x5a, 0xb2, 0x52, 0x6e, 0xb,  0x8d, 0x75, 0x5,  0x3,  0xad,
      0xd3, 0x2b, 0x77, 0xee, 0x6b, 0x17, 0x42, 0x28, 0x3,  0x3,  0x0,  0x14, 0x66, 0x4a, 0x4d, 0x22, 0x98, 0xea, 0x5d,
      0x91, 0xb1, 0x21, 0x81, 0x67, 0x45, 0x58, 0x4f, 0xaa, 0x9b, 0x91, 0xe8, 0x2e, 0x1f, 0x0,  0x1e, 0x78, 0x6b, 0xbc,
      0x71, 0xf,  0x28, 0x30, 0xd5, 0x45, 0xd4, 0x2c, 0xc1, 0xf3, 0xaa, 0x24, 0xcb, 0x21, 0xa4, 0xbc, 0xc8, 0x77, 0xbb,
      0xa1, 0xf5, 0x70, 0x7f, 0x53, 0xd7, 0xba, 0x65, 0x15, 0x0,  0x9,  0x9,  0x1b, 0x48, 0xd4, 0xec, 0xf,  0x16, 0x6f,
      0xf3, 0x18, 0x0,  0x0,  0xf,  0x80, 0x29, 0xab, 0x27, 0x0,  0x0,  0x2f, 0xa8, 0x28, 0x9c, 0x16, 0x0,  0x1b, 0x76,
      0x7,  0xae, 0xbb, 0xac, 0x4f, 0x75, 0x71, 0x90, 0x9,  0xdc, 0x6b, 0xb1, 0xb2, 0xf7, 0xcc, 0xf4, 0x3f, 0xf7, 0xac,
      0x7e, 0xfc, 0x71, 0xc0, 0x3b, 0x36, 0x2f, 0x2,  0x0,  0x0,  0xa,  0x1f, 0x1c, 0x0,  0xb,  0x4d, 0x33, 0x38, 0x21,
      0x9e, 0x9d, 0x25, 0x6e, 0x36, 0x9f, 0x4f, 0x2,  0x0,  0x0,  0xe,  0xc2, 0x23, 0x7a, 0x80, 0x9,  0x0,  0x14, 0x98,
      0xe7, 0x9a, 0x53, 0x23, 0xdc, 0x9e, 0x26, 0x6c, 0x9f, 0x4,  0x61, 0x11, 0x75, 0x94, 0x5d, 0x94, 0xb6, 0xc0, 0xf1,
      0x0,  0x11, 0x28, 0x37, 0x3c, 0x2c, 0x58, 0x4a, 0x39, 0x17, 0xe7, 0x74, 0xf5, 0xf5, 0xd6, 0xd0, 0x1c, 0x6a, 0x83,
      0x0,  0x0,  0x0,  0x3,  0xe3, 0x1b, 0x51, 0x0,  0xb,  0xe7, 0xef, 0xbc, 0xf7, 0xec, 0x1c, 0x55, 0xac, 0x9,  0xe8,
      0x44};

  uint8_t buf[657] = {0};

  uint8_t bytesprops0[] = {0x7b, 0xf0, 0xa4, 0x8c, 0x9a};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x57, 0xd3, 0xea, 0x6b, 0x9d, 0x18, 0xc7, 0xd8, 0x9f,
                           0x4f, 0xb,  0x6a, 0x4,  0xef, 0xbd, 0x71, 0xc2};
  uint8_t bytesprops3[] = {0xea, 0x56, 0x95, 0x2a, 0x3,  0x8b, 0x9a, 0xf,  0x97, 0xfb,
                           0x8b, 0x9f, 0x16, 0x44, 0xdc, 0xdf, 0xba, 0xfd, 0xff};
  uint8_t bytesprops4[] = {0xa0, 0x1d, 0xc7};
  uint8_t bytesprops6[] = {0x1f, 0x4a, 0xfb, 0x5b, 0x23, 0x7f, 0x46, 0xdd, 0x64, 0x8e, 0xa8, 0xf5, 0x18, 0xbd, 0x4a,
                           0xdf, 0x9a, 0x31, 0x6e, 0xde, 0x81, 0x2b, 0xdb, 0x56, 0xe3, 0x59, 0xe0, 0xe6, 0x0};
  uint8_t bytesprops5[] = {0xc1, 0x52, 0xd8, 0xcd, 0x35, 0x6e, 0xe8, 0x2c, 0xae, 0x54, 0xa5, 0xc4};
  uint8_t bytesprops7[] = {0xc4, 0x7b, 0x66, 0xe,  0xcd, 0x12, 0xe8, 0xec, 0x2,  0x97, 0xda, 0x72, 0xfb, 0xcd,
                           0x1c, 0x52, 0xd2, 0x1f, 0x88, 0xca, 0xc6, 0x45, 0xc9, 0x8b, 0x49, 0xac, 0xc6};
  uint8_t bytesprops8[] = {0x15};
  uint8_t bytesprops9[] = {0xe4, 0x16, 0xde, 0x60, 0xd2, 0x6e, 0xa8, 0x6d, 0x84, 0x9c, 0x30, 0x29, 0xa6, 0x18,
                           0x92, 0xf,  0x59, 0xdb, 0xd0, 0x7b, 0x1a, 0x8b, 0x97, 0xf0, 0x9,  0x27, 0xe};
  uint8_t bytesprops10[] = {0xf, 0x19, 0x50, 0xd8, 0x97, 0x3a, 0xec, 0x74, 0x16, 0x76, 0xaf, 0xb5, 0x69, 0x9f};
  uint8_t bytesprops11[] = {0x49, 0x54};
  uint8_t bytesprops12[] = {0x75, 0x66, 0x10, 0xb7, 0xbf, 0x8d, 0x74, 0xc8, 0x7f, 0x36, 0x88, 0xea, 0xcf, 0x83,
                            0x89, 0x8d, 0xd1, 0x57, 0x60, 0x4,  0xb0, 0x71, 0x66, 0x76, 0x6a, 0x53, 0xf0, 0xe5};
  uint8_t bytesprops13[] = {0x54};
  uint8_t bytesprops14[] = {0x48, 0xd6, 0x7d, 0x7,  0xe2, 0xe9, 0x34, 0x67, 0x4b,
                            0xe0, 0x1d, 0x4d, 0xbd, 0x44, 0x47, 0x3f, 0xcd, 0xc4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23594}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19608}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops5}, .v = {29, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19065}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19436}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21005}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops14}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x65, 0xa7, 0x3,  0x2,  0x7c, 0x6a, 0x7,  0xa0,
                               0xb9, 0xe5, 0x6f, 0x9b, 0xb0, 0xa8, 0xa7, 0x8};
  uint8_t byteswillprops0[] = {0xa5, 0x91, 0xc0, 0x41, 0xa4, 0x7e, 0x77, 0x62, 0x99, 0xfc, 0x16};
  uint8_t byteswillprops2[] = {0x27, 0x1, 0xc4, 0x39, 0x2c, 0x35, 0xd1};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops4[] = {0xd6, 0x3c, 0x47, 0x88, 0xa8, 0x33, 0xe6, 0x14, 0x5c, 0x37,
                               0x4,  0x59, 0x86, 0x2b, 0x77, 0x5a, 0xb2, 0x52, 0x6e, 0xb,
                               0x8d, 0x75, 0x5,  0x3,  0xad, 0xd3, 0x2b, 0x77, 0xee, 0x6b};
  uint8_t byteswillprops5[] = {0x66, 0x4a, 0x4d, 0x22, 0x98, 0xea, 0x5d, 0x91, 0xb1, 0x21,
                               0x81, 0x67, 0x45, 0x58, 0x4f, 0xaa, 0x9b, 0x91, 0xe8, 0x2e};
  uint8_t byteswillprops6[] = {0x78, 0x6b, 0xbc, 0x71, 0xf,  0x28, 0x30, 0xd5, 0x45, 0xd4,
                               0x2c, 0xc1, 0xf3, 0xaa, 0x24, 0xcb, 0x21, 0xa4, 0xbc, 0xc8,
                               0x77, 0xbb, 0xa1, 0xf5, 0x70, 0x7f, 0x53, 0xd7, 0xba, 0x65};
  uint8_t byteswillprops7[] = {0x9, 0x1b, 0x48, 0xd4, 0xec, 0xf, 0x16, 0x6f, 0xf3};
  uint8_t byteswillprops8[] = {0x76, 0x7,  0xae, 0xbb, 0xac, 0x4f, 0x75, 0x71, 0x90, 0x9,  0xdc, 0x6b, 0xb1, 0xb2,
                               0xf7, 0xcc, 0xf4, 0x3f, 0xf7, 0xac, 0x7e, 0xfc, 0x71, 0xc0, 0x3b, 0x36, 0x2f};
  uint8_t byteswillprops9[] = {0x4d, 0x33, 0x38, 0x21, 0x9e, 0x9d, 0x25, 0x6e, 0x36, 0x9f, 0x4f};
  uint8_t byteswillprops10[] = {0x98, 0xe7, 0x9a, 0x53, 0x23, 0xdc, 0x9e, 0x26, 0x6c, 0x9f,
                                0x4,  0x61, 0x11, 0x75, 0x94, 0x5d, 0x94, 0xb6, 0xc0, 0xf1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13992}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&byteswillprops0}, .v = {16, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17285}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8449}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18445}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5075}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3968}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12200}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2591}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3778}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31360}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&byteswillprops10}}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x28, 0x37, 0x3c, 0x2c, 0x58, 0x4a, 0x39, 0x17, 0xe7,
                                0x74, 0xf5, 0xf5, 0xd6, 0xd0, 0x1c, 0x6a, 0x83};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 70;
  uint8_t client_id_bytes[] = {0xe2, 0x39, 0x8e, 0x46, 0x1f, 0xec, 0xa1, 0xba, 0xfc, 0xec,
                               0x93, 0xe5, 0xd2, 0x45, 0x82, 0x19, 0x68, 0x80, 0x81, 0x13,
                               0x61, 0x78, 0x65, 0xa5, 0xb3, 0xee, 0x56, 0x69, 0xa9, 0xf5};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe3, 0x1b, 0x51};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe7, 0xef, 0xbc, 0xf7, 0xec, 0x1c, 0x55, 0xac, 0x9, 0xe8, 0x44};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\a.\173\189\187\192\&5\DC1\242@\ETXGI\174r\189\191\213\CAN4\233\SOH\196", _password
// = Just "i\DC1lU\210\253\204\211\224\DC4\228", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "\CAN\228\137ea\b\DC1\230\188B\b\185\161\213\250:\214\RSLYL\193\157K\189R~", _willMsg =
// "^\188x\173\231\249S\128\&9\STX%\133l\173s\135{F\221\169T\254", _willProps = [PropSubscriptionIdentifier
// 25,PropContentType "7\152\NAK\246l2\143\183\171A",PropRetainAvailable 104,PropAuthenticationData
// "\181A",PropSubscriptionIdentifierAvailable 68,PropSharedSubscriptionAvailable 13,PropResponseInformation
// "k\152\DC4\CAN\ETXL\187p\213_\DC2>^\190c\RS\171nC)O",PropTopicAliasMaximum 21628,PropAuthenticationMethod
// "\176mT\ETX\141\236\172$[>)\207\&5\144",PropServerReference
// "\188\153\146\SI\218\197c\ACK0l\f\160\245y1<\235\146\130\135v\bfs\250",PropSubscriptionIdentifier
// 29,PropMaximumPacketSize 31692]}), _cleanSession = False, _keepAlive = 3405, _connID = "\229sD\131\227v\232^4n0",
// _properties = [PropTopicAlias 29021,PropSharedSubscriptionAvailable 181,PropServerReference
// "\224?\161\230\151;\255\216\204^\158\151\SYNL\175\128",PropWildcardSubscriptionAvailable
// 226,PropAssignedClientIdentifier
// "\176^iwh\SO\EOTV\250\249\220\247@\228i}c\DLE\207\246\131\218\135\215*",PropAuthenticationMethod
// "g\152\CAN{N\183d#\152\192\151",PropPayloadFormatIndicator 186,PropSubscriptionIdentifierAvailable
// 90,PropRetainAvailable 227,PropReasonString "",PropRequestResponseInformation 124,PropReasonString
// "\NAK\142\"\242#\198\214\220+k\144\147\GS\210\152",PropReceiveMaximum 12762,PropServerKeepAlive
// 16767,PropAssignedClientIdentifier "\245\230; R\FSU\247\236\149x\ENQsxqD\158\144;",PropMessageExpiryInterval
// 21735,PropAuthenticationMethod "q\139\236*O\a\179",PropSubscriptionIdentifier 2,PropReasonString
// "",PropSubscriptionIdentifierAvailable 103,PropAuthenticationData
// "\194\&76\250\253\ETX0\179q\218\162\138",PropReceiveMaximum 30578,PropMaximumPacketSize
// 21991,PropAssignedClientIdentifier "z\135,\185\191?\201\160:",PropResponseInformation
// "\DELP0`\209\168\tT\\L\DC2\a\134\254[\ACK$d#\DC4|c\226\167Md\t\177\217U",PropReasonString
// "\252\135\192\DC2\192\172,\RS\228\252\r&\139\191\235 A\DC1"]}
TEST(Connect5QCTest, Encode71) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0xd,  0x4d, 0xec, 0x1,  0x23, 0x71, 0x5d, 0x2a,
      0xb5, 0x1c, 0x0,  0x10, 0xe0, 0x3f, 0xa1, 0xe6, 0x97, 0x3b, 0xff, 0xd8, 0xcc, 0x5e, 0x9e, 0x97, 0x16, 0x4c, 0xaf,
      0x80, 0x28, 0xe2, 0x12, 0x0,  0x19, 0xb0, 0x5e, 0x69, 0x77, 0x68, 0xe,  0x4,  0x56, 0xfa, 0xf9, 0xdc, 0xf7, 0x40,
      0xe4, 0x69, 0x7d, 0x63, 0x10, 0xcf, 0xf6, 0x83, 0xda, 0x87, 0xd7, 0x2a, 0x15, 0x0,  0xb,  0x67, 0x98, 0x18, 0x7b,
      0x4e, 0xb7, 0x64, 0x23, 0x98, 0xc0, 0x97, 0x1,  0xba, 0x29, 0x5a, 0x25, 0xe3, 0x1f, 0x0,  0x0,  0x19, 0x7c, 0x1f,
      0x0,  0xf,  0x15, 0x8e, 0x22, 0xf2, 0x23, 0xc6, 0xd6, 0xdc, 0x2b, 0x6b, 0x90, 0x93, 0x1d, 0xd2, 0x98, 0x21, 0x31,
      0xda, 0x13, 0x41, 0x7f, 0x12, 0x0,  0x13, 0xf5, 0xe6, 0x3b, 0x20, 0x52, 0x1c, 0x55, 0xf7, 0xec, 0x95, 0x78, 0x5,
      0x73, 0x78, 0x71, 0x44, 0x9e, 0x90, 0x3b, 0x2,  0x0,  0x0,  0x54, 0xe7, 0x15, 0x0,  0x7,  0x71, 0x8b, 0xec, 0x2a,
      0x4f, 0x7,  0xb3, 0xb,  0x2,  0x1f, 0x0,  0x0,  0x29, 0x67, 0x16, 0x0,  0xc,  0xc2, 0x37, 0x36, 0xfa, 0xfd, 0x3,
      0x30, 0xb3, 0x71, 0xda, 0xa2, 0x8a, 0x21, 0x77, 0x72, 0x27, 0x0,  0x0,  0x55, 0xe7, 0x12, 0x0,  0x9,  0x7a, 0x87,
      0x2c, 0xb9, 0xbf, 0x3f, 0xc9, 0xa0, 0x3a, 0x1a, 0x0,  0x1e, 0x7f, 0x50, 0x30, 0x60, 0xd1, 0xa8, 0x9,  0x54, 0x5c,
      0x4c, 0x12, 0x7,  0x86, 0xfe, 0x5b, 0x6,  0x24, 0x64, 0x23, 0x14, 0x7c, 0x63, 0xe2, 0xa7, 0x4d, 0x64, 0x9,  0xb1,
      0xd9, 0x55, 0x1f, 0x0,  0x12, 0xfc, 0x87, 0xc0, 0x12, 0xc0, 0xac, 0x2c, 0x1e, 0xe4, 0xfc, 0xd,  0x26, 0x8b, 0xbf,
      0xeb, 0x20, 0x41, 0x11, 0x0,  0xb,  0xe5, 0x73, 0x44, 0x83, 0xe3, 0x76, 0xe8, 0x5e, 0x34, 0x6e, 0x30, 0x69, 0xb,
      0x19, 0x3,  0x0,  0xa,  0x37, 0x98, 0x15, 0xf6, 0x6c, 0x32, 0x8f, 0xb7, 0xab, 0x41, 0x25, 0x68, 0x16, 0x0,  0x2,
      0xb5, 0x41, 0x29, 0x44, 0x2a, 0xd,  0x1a, 0x0,  0x15, 0x6b, 0x98, 0x14, 0x18, 0x3,  0x4c, 0xbb, 0x70, 0xd5, 0x5f,
      0x12, 0x3e, 0x5e, 0xbe, 0x63, 0x1e, 0xab, 0x6e, 0x43, 0x29, 0x4f, 0x22, 0x54, 0x7c, 0x15, 0x0,  0xe,  0xb0, 0x6d,
      0x54, 0x3,  0x8d, 0xec, 0xac, 0x24, 0x5b, 0x3e, 0x29, 0xcf, 0x35, 0x90, 0x1c, 0x0,  0x19, 0xbc, 0x99, 0x92, 0xf,
      0xda, 0xc5, 0x63, 0x6,  0x30, 0x6c, 0xc,  0xa0, 0xf5, 0x79, 0x31, 0x3c, 0xeb, 0x92, 0x82, 0x87, 0x76, 0x8,  0x66,
      0x73, 0xfa, 0xb,  0x1d, 0x27, 0x0,  0x0,  0x7b, 0xcc, 0x0,  0x1b, 0x18, 0xe4, 0x89, 0x65, 0x61, 0x8,  0x11, 0xe6,
      0xbc, 0x42, 0x8,  0xb9, 0xa1, 0xd5, 0xfa, 0x3a, 0xd6, 0x1e, 0x4c, 0x59, 0x4c, 0xc1, 0x9d, 0x4b, 0xbd, 0x52, 0x7e,
      0x0,  0x16, 0x5e, 0xbc, 0x78, 0xad, 0xe7, 0xf9, 0x53, 0x80, 0x39, 0x2,  0x25, 0x85, 0x6c, 0xad, 0x73, 0x87, 0x7b,
      0x46, 0xdd, 0xa9, 0x54, 0xfe, 0x0,  0x17, 0x7,  0x2e, 0xad, 0xbd, 0xbb, 0xc0, 0x35, 0x11, 0xf2, 0x40, 0x3,  0x47,
      0x49, 0xae, 0x72, 0xbd, 0xbf, 0xd5, 0x18, 0x34, 0xe9, 0x1,  0xc4, 0x0,  0xb,  0x69, 0x11, 0x6c, 0x55, 0xd2, 0xfd,
      0xcc, 0xd3, 0xe0, 0x14, 0xe4};

  uint8_t buf[471] = {0};

  uint8_t bytesprops0[] = {0xe0, 0x3f, 0xa1, 0xe6, 0x97, 0x3b, 0xff, 0xd8,
                           0xcc, 0x5e, 0x9e, 0x97, 0x16, 0x4c, 0xaf, 0x80};
  uint8_t bytesprops1[] = {0xb0, 0x5e, 0x69, 0x77, 0x68, 0xe,  0x4,  0x56, 0xfa, 0xf9, 0xdc, 0xf7, 0x40,
                           0xe4, 0x69, 0x7d, 0x63, 0x10, 0xcf, 0xf6, 0x83, 0xda, 0x87, 0xd7, 0x2a};
  uint8_t bytesprops2[] = {0x67, 0x98, 0x18, 0x7b, 0x4e, 0xb7, 0x64, 0x23, 0x98, 0xc0, 0x97};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x15, 0x8e, 0x22, 0xf2, 0x23, 0xc6, 0xd6, 0xdc, 0x2b, 0x6b, 0x90, 0x93, 0x1d, 0xd2, 0x98};
  uint8_t bytesprops5[] = {0xf5, 0xe6, 0x3b, 0x20, 0x52, 0x1c, 0x55, 0xf7, 0xec, 0x95,
                           0x78, 0x5,  0x73, 0x78, 0x71, 0x44, 0x9e, 0x90, 0x3b};
  uint8_t bytesprops6[] = {0x71, 0x8b, 0xec, 0x2a, 0x4f, 0x7, 0xb3};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0xc2, 0x37, 0x36, 0xfa, 0xfd, 0x3, 0x30, 0xb3, 0x71, 0xda, 0xa2, 0x8a};
  uint8_t bytesprops9[] = {0x7a, 0x87, 0x2c, 0xb9, 0xbf, 0x3f, 0xc9, 0xa0, 0x3a};
  uint8_t bytesprops10[] = {0x7f, 0x50, 0x30, 0x60, 0xd1, 0xa8, 0x9,  0x54, 0x5c, 0x4c, 0x12, 0x7, 0x86, 0xfe, 0x5b,
                            0x6,  0x24, 0x64, 0x23, 0x14, 0x7c, 0x63, 0xe2, 0xa7, 0x4d, 0x64, 0x9, 0xb1, 0xd9, 0x55};
  uint8_t bytesprops11[] = {0xfc, 0x87, 0xc0, 0x12, 0xc0, 0xac, 0x2c, 0x1e, 0xe4,
                            0xfc, 0xd,  0x26, 0x8b, 0xbf, 0xeb, 0x20, 0x41, 0x11};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29021}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12762}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16767}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21735}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30578}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21991}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x37, 0x98, 0x15, 0xf6, 0x6c, 0x32, 0x8f, 0xb7, 0xab, 0x41};
  uint8_t byteswillprops1[] = {0xb5, 0x41};
  uint8_t byteswillprops2[] = {0x6b, 0x98, 0x14, 0x18, 0x3,  0x4c, 0xbb, 0x70, 0xd5, 0x5f, 0x12,
                               0x3e, 0x5e, 0xbe, 0x63, 0x1e, 0xab, 0x6e, 0x43, 0x29, 0x4f};
  uint8_t byteswillprops3[] = {0xb0, 0x6d, 0x54, 0x3, 0x8d, 0xec, 0xac, 0x24, 0x5b, 0x3e, 0x29, 0xcf, 0x35, 0x90};
  uint8_t byteswillprops4[] = {0xbc, 0x99, 0x92, 0xf,  0xda, 0xc5, 0x63, 0x6,  0x30, 0x6c, 0xc,  0xa0, 0xf5,
                               0x79, 0x31, 0x3c, 0xeb, 0x92, 0x82, 0x87, 0x76, 0x8,  0x66, 0x73, 0xfa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21628}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31692}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0xe4, 0x89, 0x65, 0x61, 0x8,  0x11, 0xe6, 0xbc, 0x42, 0x8,  0xb9, 0xa1, 0xd5,
                                0xfa, 0x3a, 0xd6, 0x1e, 0x4c, 0x59, 0x4c, 0xc1, 0x9d, 0x4b, 0xbd, 0x52, 0x7e};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5e, 0xbc, 0x78, 0xad, 0xe7, 0xf9, 0x53, 0x80, 0x39, 0x2,  0x25,
                                  0x85, 0x6c, 0xad, 0x73, 0x87, 0x7b, 0x46, 0xdd, 0xa9, 0x54, 0xfe};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3405;
  uint8_t client_id_bytes[] = {0xe5, 0x73, 0x44, 0x83, 0xe3, 0x76, 0xe8, 0x5e, 0x34, 0x6e, 0x30};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7,  0x2e, 0xad, 0xbd, 0xbb, 0xc0, 0x35, 0x11, 0xf2, 0x40, 0x3, 0x47,
                              0x49, 0xae, 0x72, 0xbd, 0xbf, 0xd5, 0x18, 0x34, 0xe9, 0x1,  0xc4};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x69, 0x11, 0x6c, 0x55, 0xd2, 0xfd, 0xcc, 0xd3, 0xe0, 0x14, 0xe4};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "a", _password = Just "@\CAN\194hS*r\ESC'\162\SUB\222P\218g\250\&5\aN\nf\ETX\246",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\135!\172j\177\193\187\202+&FH\SO",
// _willMsg = "g\144@\161F\215\147>\217\b\228\146\186\ETB\234\252\208\201", _willProps =
// [PropSharedSubscriptionAvailable 52,PropUserProperty
// "\206\154\130\229\136\166~:\EOTZ\136\253\164\184\134RS8~\212a\161\&6h\185\202\tG\229"
// "\198Z\148b4\167\246\209\193V\ACK",PropAuthenticationData
// "\224\132\219*[8\SUB\209\&8\232c\DC1\152L\ETX\174\191y\NUL\210KOz\137\197\243Q",PropContentType
// "?os\201e$\226F\169u\242\242d\137/\233\254",PropSessionExpiryInterval 22845,PropMaximumQoS 56,PropRetainAvailable
// 185,PropAssignedClientIdentifier "P\162\CAN\136\137NK]~\179\205F\176",PropContentType
// "H\218\179\&2\193]$\191\SUB\220\236x\211k\254\231\142\DLE\222\243\DC4F\DEL:\ENQ",PropRequestResponseInformation
// 55,PropMessageExpiryInterval 15612,PropCorrelationData
// "\SOH!.\194G~\DC4g\136z\131\229\255O\245\211\226\171(\243u\174j#",PropRequestResponseInformation
// 140,PropAuthenticationMethod "\197",PropAuthenticationMethod "\225\195~m\249\DC1\a\f
// \214\203\234C",PropWildcardSubscriptionAvailable 45,PropMessageExpiryInterval 13177,PropUserProperty
// "t.Pc\ENQ\250\200\CAN\198}Fp4g\205D\185\249" "\ACK\CANtZ\DC4\133\182c5h\161;J
// \215\154D0r",PropSharedSubscriptionAvailable 171,PropRetainAvailable 36,PropSessionExpiryInterval
// 32065,PropReceiveMaximum 16540,PropCorrelationData
// "\230C\153\&3\179\255\\\166\209$\158\223@\160",PropResponseInformation "\176s\227jL'U\133a\233\144\228\215\254"]}),
// _cleanSession = True, _keepAlive = 19693, _connID = "\140\204\191\171.BtU+cj", _properties = [PropRetainAvailable
// 22,PropSessionExpiryInterval 8887,PropSharedSubscriptionAvailable 25,PropWildcardSubscriptionAvailable
// 185,PropServerReference
// "\142\223\SUB\ETX\242\ETX\172\232\248\232\\\189\171\212\141\DC4x\216\162\229\140\GS\158\151\235",PropRetainAvailable
// 182,PropResponseInformation "=\226\238\222\247\204\141\218Z2\STX\131\147\&3FE\200C\217\198",PropRetainAvailable
// 193,PropWildcardSubscriptionAvailable 79,PropServerReference
// "\190\DC32\237\&6\133\211\236\215\218\134\f\164%-\193\214\161Vs"]}
TEST(Connect5QCTest, Encode72) {
  uint8_t pkt[] = {
      0x10, 0xe1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x4c, 0xed, 0x5b, 0x25, 0x16, 0x11, 0x0,  0x0,
      0x22, 0xb7, 0x2a, 0x19, 0x28, 0xb9, 0x1c, 0x0,  0x19, 0x8e, 0xdf, 0x1a, 0x3,  0xf2, 0x3,  0xac, 0xe8, 0xf8, 0xe8,
      0x5c, 0xbd, 0xab, 0xd4, 0x8d, 0x14, 0x78, 0xd8, 0xa2, 0xe5, 0x8c, 0x1d, 0x9e, 0x97, 0xeb, 0x25, 0xb6, 0x1a, 0x0,
      0x14, 0x3d, 0xe2, 0xee, 0xde, 0xf7, 0xcc, 0x8d, 0xda, 0x5a, 0x32, 0x2,  0x83, 0x93, 0x33, 0x46, 0x45, 0xc8, 0x43,
      0xd9, 0xc6, 0x25, 0xc1, 0x28, 0x4f, 0x1c, 0x0,  0x14, 0xbe, 0x13, 0x32, 0xed, 0x36, 0x85, 0xd3, 0xec, 0xd7, 0xda,
      0x86, 0xc,  0xa4, 0x25, 0x2d, 0xc1, 0xd6, 0xa1, 0x56, 0x73, 0x0,  0xb,  0x8c, 0xcc, 0xbf, 0xab, 0x2e, 0x42, 0x74,
      0x55, 0x2b, 0x63, 0x6a, 0xad, 0x2,  0x2a, 0x34, 0x26, 0x0,  0x1d, 0xce, 0x9a, 0x82, 0xe5, 0x88, 0xa6, 0x7e, 0x3a,
      0x4,  0x5a, 0x88, 0xfd, 0xa4, 0xb8, 0x86, 0x52, 0x53, 0x38, 0x7e, 0xd4, 0x61, 0xa1, 0x36, 0x68, 0xb9, 0xca, 0x9,
      0x47, 0xe5, 0x0,  0xb,  0xc6, 0x5a, 0x94, 0x62, 0x34, 0xa7, 0xf6, 0xd1, 0xc1, 0x56, 0x6,  0x16, 0x0,  0x1b, 0xe0,
      0x84, 0xdb, 0x2a, 0x5b, 0x38, 0x1a, 0xd1, 0x38, 0xe8, 0x63, 0x11, 0x98, 0x4c, 0x3,  0xae, 0xbf, 0x79, 0x0,  0xd2,
      0x4b, 0x4f, 0x7a, 0x89, 0xc5, 0xf3, 0x51, 0x3,  0x0,  0x11, 0x3f, 0x6f, 0x73, 0xc9, 0x65, 0x24, 0xe2, 0x46, 0xa9,
      0x75, 0xf2, 0xf2, 0x64, 0x89, 0x2f, 0xe9, 0xfe, 0x11, 0x0,  0x0,  0x59, 0x3d, 0x24, 0x38, 0x25, 0xb9, 0x12, 0x0,
      0xd,  0x50, 0xa2, 0x18, 0x88, 0x89, 0x4e, 0x4b, 0x5d, 0x7e, 0xb3, 0xcd, 0x46, 0xb0, 0x3,  0x0,  0x19, 0x48, 0xda,
      0xb3, 0x32, 0xc1, 0x5d, 0x24, 0xbf, 0x1a, 0xdc, 0xec, 0x78, 0xd3, 0x6b, 0xfe, 0xe7, 0x8e, 0x10, 0xde, 0xf3, 0x14,
      0x46, 0x7f, 0x3a, 0x5,  0x19, 0x37, 0x2,  0x0,  0x0,  0x3c, 0xfc, 0x9,  0x0,  0x18, 0x1,  0x21, 0x2e, 0xc2, 0x47,
      0x7e, 0x14, 0x67, 0x88, 0x7a, 0x83, 0xe5, 0xff, 0x4f, 0xf5, 0xd3, 0xe2, 0xab, 0x28, 0xf3, 0x75, 0xae, 0x6a, 0x23,
      0x19, 0x8c, 0x15, 0x0,  0x1,  0xc5, 0x15, 0x0,  0xd,  0xe1, 0xc3, 0x7e, 0x6d, 0xf9, 0x11, 0x7,  0xc,  0x20, 0xd6,
      0xcb, 0xea, 0x43, 0x28, 0x2d, 0x2,  0x0,  0x0,  0x33, 0x79, 0x26, 0x0,  0x12, 0x74, 0x2e, 0x50, 0x63, 0x5,  0xfa,
      0xc8, 0x18, 0xc6, 0x7d, 0x46, 0x70, 0x34, 0x67, 0xcd, 0x44, 0xb9, 0xf9, 0x0,  0x13, 0x6,  0x18, 0x74, 0x5a, 0x14,
      0x85, 0xb6, 0x63, 0x35, 0x68, 0xa1, 0x3b, 0x4a, 0x20, 0xd7, 0x9a, 0x44, 0x30, 0x72, 0x2a, 0xab, 0x25, 0x24, 0x11,
      0x0,  0x0,  0x7d, 0x41, 0x21, 0x40, 0x9c, 0x9,  0x0,  0xe,  0xe6, 0x43, 0x99, 0x33, 0xb3, 0xff, 0x5c, 0xa6, 0xd1,
      0x24, 0x9e, 0xdf, 0x40, 0xa0, 0x1a, 0x0,  0xe,  0xb0, 0x73, 0xe3, 0x6a, 0x4c, 0x27, 0x55, 0x85, 0x61, 0xe9, 0x90,
      0xe4, 0xd7, 0xfe, 0x0,  0xd,  0x87, 0x21, 0xac, 0x6a, 0xb1, 0xc1, 0xbb, 0xca, 0x2b, 0x26, 0x46, 0x48, 0xe,  0x0,
      0x12, 0x67, 0x90, 0x40, 0xa1, 0x46, 0xd7, 0x93, 0x3e, 0xd9, 0x8,  0xe4, 0x92, 0xba, 0x17, 0xea, 0xfc, 0xd0, 0xc9,
      0x0,  0x1,  0x61, 0x0,  0x17, 0x40, 0x18, 0xc2, 0x68, 0x53, 0x2a, 0x72, 0x1b, 0x27, 0xa2, 0x1a, 0xde, 0x50, 0xda,
      0x67, 0xfa, 0x35, 0x7,  0x4e, 0xa,  0x66, 0x3,  0xf6};

  uint8_t buf[494] = {0};

  uint8_t bytesprops0[] = {0x8e, 0xdf, 0x1a, 0x3,  0xf2, 0x3,  0xac, 0xe8, 0xf8, 0xe8, 0x5c, 0xbd, 0xab,
                           0xd4, 0x8d, 0x14, 0x78, 0xd8, 0xa2, 0xe5, 0x8c, 0x1d, 0x9e, 0x97, 0xeb};
  uint8_t bytesprops1[] = {0x3d, 0xe2, 0xee, 0xde, 0xf7, 0xcc, 0x8d, 0xda, 0x5a, 0x32,
                           0x2,  0x83, 0x93, 0x33, 0x46, 0x45, 0xc8, 0x43, 0xd9, 0xc6};
  uint8_t bytesprops2[] = {0xbe, 0x13, 0x32, 0xed, 0x36, 0x85, 0xd3, 0xec, 0xd7, 0xda,
                           0x86, 0xc,  0xa4, 0x25, 0x2d, 0xc1, 0xd6, 0xa1, 0x56, 0x73};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8887}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xc6, 0x5a, 0x94, 0x62, 0x34, 0xa7, 0xf6, 0xd1, 0xc1, 0x56, 0x6};
  uint8_t byteswillprops0[] = {0xce, 0x9a, 0x82, 0xe5, 0x88, 0xa6, 0x7e, 0x3a, 0x4,  0x5a, 0x88, 0xfd, 0xa4, 0xb8, 0x86,
                               0x52, 0x53, 0x38, 0x7e, 0xd4, 0x61, 0xa1, 0x36, 0x68, 0xb9, 0xca, 0x9,  0x47, 0xe5};
  uint8_t byteswillprops2[] = {0xe0, 0x84, 0xdb, 0x2a, 0x5b, 0x38, 0x1a, 0xd1, 0x38, 0xe8, 0x63, 0x11, 0x98, 0x4c,
                               0x3,  0xae, 0xbf, 0x79, 0x0,  0xd2, 0x4b, 0x4f, 0x7a, 0x89, 0xc5, 0xf3, 0x51};
  uint8_t byteswillprops3[] = {0x3f, 0x6f, 0x73, 0xc9, 0x65, 0x24, 0xe2, 0x46, 0xa9,
                               0x75, 0xf2, 0xf2, 0x64, 0x89, 0x2f, 0xe9, 0xfe};
  uint8_t byteswillprops4[] = {0x50, 0xa2, 0x18, 0x88, 0x89, 0x4e, 0x4b, 0x5d, 0x7e, 0xb3, 0xcd, 0x46, 0xb0};
  uint8_t byteswillprops5[] = {0x48, 0xda, 0xb3, 0x32, 0xc1, 0x5d, 0x24, 0xbf, 0x1a, 0xdc, 0xec, 0x78, 0xd3,
                               0x6b, 0xfe, 0xe7, 0x8e, 0x10, 0xde, 0xf3, 0x14, 0x46, 0x7f, 0x3a, 0x5};
  uint8_t byteswillprops6[] = {0x1,  0x21, 0x2e, 0xc2, 0x47, 0x7e, 0x14, 0x67, 0x88, 0x7a, 0x83, 0xe5,
                               0xff, 0x4f, 0xf5, 0xd3, 0xe2, 0xab, 0x28, 0xf3, 0x75, 0xae, 0x6a, 0x23};
  uint8_t byteswillprops7[] = {0xc5};
  uint8_t byteswillprops8[] = {0xe1, 0xc3, 0x7e, 0x6d, 0xf9, 0x11, 0x7, 0xc, 0x20, 0xd6, 0xcb, 0xea, 0x43};
  uint8_t byteswillprops10[] = {0x6,  0x18, 0x74, 0x5a, 0x14, 0x85, 0xb6, 0x63, 0x35, 0x68,
                                0xa1, 0x3b, 0x4a, 0x20, 0xd7, 0x9a, 0x44, 0x30, 0x72};
  uint8_t byteswillprops9[] = {0x74, 0x2e, 0x50, 0x63, 0x5,  0xfa, 0xc8, 0x18, 0xc6,
                               0x7d, 0x46, 0x70, 0x34, 0x67, 0xcd, 0x44, 0xb9, 0xf9};
  uint8_t byteswillprops11[] = {0xe6, 0x43, 0x99, 0x33, 0xb3, 0xff, 0x5c, 0xa6, 0xd1, 0x24, 0x9e, 0xdf, 0x40, 0xa0};
  uint8_t byteswillprops12[] = {0xb0, 0x73, 0xe3, 0x6a, 0x4c, 0x27, 0x55, 0x85, 0x61, 0xe9, 0x90, 0xe4, 0xd7, 0xfe};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {29, (char*)&byteswillprops0}, .v = {11, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22845}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15612}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13177}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops9}, .v = {19, (char*)&byteswillprops10}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32065}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16540}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x21, 0xac, 0x6a, 0xb1, 0xc1, 0xbb, 0xca, 0x2b, 0x26, 0x46, 0x48, 0xe};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x67, 0x90, 0x40, 0xa1, 0x46, 0xd7, 0x93, 0x3e, 0xd9,
                                  0x8,  0xe4, 0x92, 0xba, 0x17, 0xea, 0xfc, 0xd0, 0xc9};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19693;
  uint8_t client_id_bytes[] = {0x8c, 0xcc, 0xbf, 0xab, 0x2e, 0x42, 0x74, 0x55, 0x2b, 0x63, 0x6a};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x61};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x40, 0x18, 0xc2, 0x68, 0x53, 0x2a, 0x72, 0x1b, 0x27, 0xa2, 0x1a, 0xde,
                              0x50, 0xda, 0x67, 0xfa, 0x35, 0x7,  0x4e, 0xa,  0x66, 0x3,  0xf6};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\172\219m,\215\&1j\218
// $\179\198q\177c\172\251|\145\151)\ACKk\199\226\192\131\161\SO", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\253X\142\n\160\NUL\146\171ng\\\NAK\186Q\142\165\NUL\ETX6\212\255d\134|\252\181!av)",
// _willMsg = "}1\182T-u\251\128", _willProps = [PropPayloadFormatIndicator 6,PropResponseInformation
// "\179Q$t\211=\DC4\219.\223A\STX\CAN\EM\f\150"]}), _cleanSession = False, _keepAlive = 12479, _connID =
// "\160\198\DC2f\138Q\188Q\138!y\131\141\&4\255\149\228$=Tx\SOHa\231", _properties = [PropMessageExpiryInterval
// 31115,PropResponseTopic "\206v\205\SI*.o\153\156S\221*\SUBd\131B\229\EM\DLEb!\205",PropAuthenticationMethod
// "\197'\183\128\201\\\179\204\202\222",PropPayloadFormatIndicator 249,PropUserProperty
// "\171X\SO|:\t\164\164e\220\SOHna\243\194\195\168\191\209?j\149 \v"
// "u\188\217\EM\217\175{L|\188\v\STXx+\253\STX\ESC\207",PropRequestProblemInformation 50,PropResponseTopic
// "lg\ACKZ'\182\206\137\&2(*\247^\214\145\146\184\US\202m]\SYN\221f\243",PropRequestProblemInformation
// 107,PropTopicAliasMaximum 25143,PropRetainAvailable 27,PropPayloadFormatIndicator 20,PropServerReference "\r\200m
// \247\155\198\ETX\240\223\137X\220\242\230\SOH\193a\SOHQC\232\247d",PropPayloadFormatIndicator
// 235,PropResponseInformation
// "\NUL\186\170\145\&2\DC3\243\ENQ_\FS\188\133}a\148\132\bu\241\136\213{\227\&1",PropAuthenticationMethod
// "\194\148'\236\DC4\196\EOT\249\128\144\&0\b\239\235W0\172\&1\207\170Pv\243.\RS\241%\226P\208",PropSessionExpiryInterval
// 27855]}
TEST(Connect5QCTest, Encode73) {
  uint8_t pkt[] = {
      0x10, 0xc7, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc,  0x30, 0xbf, 0xe1, 0x1,  0x2,  0x0,  0x0,  0x79,
      0x8b, 0x8,  0x0,  0x16, 0xce, 0x76, 0xcd, 0xf,  0x2a, 0x2e, 0x6f, 0x99, 0x9c, 0x53, 0xdd, 0x2a, 0x1a, 0x64, 0x83,
      0x42, 0xe5, 0x19, 0x10, 0x62, 0x21, 0xcd, 0x15, 0x0,  0xa,  0xc5, 0x27, 0xb7, 0x80, 0xc9, 0x5c, 0xb3, 0xcc, 0xca,
      0xde, 0x1,  0xf9, 0x26, 0x0,  0x18, 0xab, 0x58, 0xe,  0x7c, 0x3a, 0x9,  0xa4, 0xa4, 0x65, 0xdc, 0x1,  0x6e, 0x61,
      0xf3, 0xc2, 0xc3, 0xa8, 0xbf, 0xd1, 0x3f, 0x6a, 0x95, 0x20, 0xb,  0x0,  0x12, 0x75, 0xbc, 0xd9, 0x19, 0xd9, 0xaf,
      0x7b, 0x4c, 0x7c, 0xbc, 0xb,  0x2,  0x78, 0x2b, 0xfd, 0x2,  0x1b, 0xcf, 0x17, 0x32, 0x8,  0x0,  0x19, 0x6c, 0x67,
      0x6,  0x5a, 0x27, 0xb6, 0xce, 0x89, 0x32, 0x28, 0x2a, 0xf7, 0x5e, 0xd6, 0x91, 0x92, 0xb8, 0x1f, 0xca, 0x6d, 0x5d,
      0x16, 0xdd, 0x66, 0xf3, 0x17, 0x6b, 0x22, 0x62, 0x37, 0x25, 0x1b, 0x1,  0x14, 0x1c, 0x0,  0x18, 0xd,  0xc8, 0x6d,
      0x20, 0xf7, 0x9b, 0xc6, 0x3,  0xf0, 0xdf, 0x89, 0x58, 0xdc, 0xf2, 0xe6, 0x1,  0xc1, 0x61, 0x1,  0x51, 0x43, 0xe8,
      0xf7, 0x64, 0x1,  0xeb, 0x1a, 0x0,  0x18, 0x0,  0xba, 0xaa, 0x91, 0x32, 0x13, 0xf3, 0x5,  0x5f, 0x1c, 0xbc, 0x85,
      0x7d, 0x61, 0x94, 0x84, 0x8,  0x75, 0xf1, 0x88, 0xd5, 0x7b, 0xe3, 0x31, 0x15, 0x0,  0x1e, 0xc2, 0x94, 0x27, 0xec,
      0x14, 0xc4, 0x4,  0xf9, 0x80, 0x90, 0x30, 0x8,  0xef, 0xeb, 0x57, 0x30, 0xac, 0x31, 0xcf, 0xaa, 0x50, 0x76, 0xf3,
      0x2e, 0x1e, 0xf1, 0x25, 0xe2, 0x50, 0xd0, 0x11, 0x0,  0x0,  0x6c, 0xcf, 0x0,  0x18, 0xa0, 0xc6, 0x12, 0x66, 0x8a,
      0x51, 0xbc, 0x51, 0x8a, 0x21, 0x79, 0x83, 0x8d, 0x34, 0xff, 0x95, 0xe4, 0x24, 0x3d, 0x54, 0x78, 0x1,  0x61, 0xe7,
      0x15, 0x1,  0x6,  0x1a, 0x0,  0x10, 0xb3, 0x51, 0x24, 0x74, 0xd3, 0x3d, 0x14, 0xdb, 0x2e, 0xdf, 0x41, 0x2,  0x18,
      0x19, 0xc,  0x96, 0x0,  0x1e, 0xfd, 0x58, 0x8e, 0xa,  0xa0, 0x0,  0x92, 0xab, 0x6e, 0x67, 0x5c, 0x15, 0xba, 0x51,
      0x8e, 0xa5, 0x0,  0x3,  0x36, 0xd4, 0xff, 0x64, 0x86, 0x7c, 0xfc, 0xb5, 0x21, 0x61, 0x76, 0x29, 0x0,  0x8,  0x7d,
      0x31, 0xb6, 0x54, 0x2d, 0x75, 0xfb, 0x80};

  uint8_t buf[340] = {0};

  uint8_t bytesprops0[] = {0xce, 0x76, 0xcd, 0xf,  0x2a, 0x2e, 0x6f, 0x99, 0x9c, 0x53, 0xdd,
                           0x2a, 0x1a, 0x64, 0x83, 0x42, 0xe5, 0x19, 0x10, 0x62, 0x21, 0xcd};
  uint8_t bytesprops1[] = {0xc5, 0x27, 0xb7, 0x80, 0xc9, 0x5c, 0xb3, 0xcc, 0xca, 0xde};
  uint8_t bytesprops3[] = {0x75, 0xbc, 0xd9, 0x19, 0xd9, 0xaf, 0x7b, 0x4c, 0x7c,
                           0xbc, 0xb,  0x2,  0x78, 0x2b, 0xfd, 0x2,  0x1b, 0xcf};
  uint8_t bytesprops2[] = {0xab, 0x58, 0xe,  0x7c, 0x3a, 0x9,  0xa4, 0xa4, 0x65, 0xdc, 0x1,  0x6e,
                           0x61, 0xf3, 0xc2, 0xc3, 0xa8, 0xbf, 0xd1, 0x3f, 0x6a, 0x95, 0x20, 0xb};
  uint8_t bytesprops4[] = {0x6c, 0x67, 0x6,  0x5a, 0x27, 0xb6, 0xce, 0x89, 0x32, 0x28, 0x2a, 0xf7, 0x5e,
                           0xd6, 0x91, 0x92, 0xb8, 0x1f, 0xca, 0x6d, 0x5d, 0x16, 0xdd, 0x66, 0xf3};
  uint8_t bytesprops5[] = {0xd,  0xc8, 0x6d, 0x20, 0xf7, 0x9b, 0xc6, 0x3,  0xf0, 0xdf, 0x89, 0x58,
                           0xdc, 0xf2, 0xe6, 0x1,  0xc1, 0x61, 0x1,  0x51, 0x43, 0xe8, 0xf7, 0x64};
  uint8_t bytesprops6[] = {0x0,  0xba, 0xaa, 0x91, 0x32, 0x13, 0xf3, 0x5,  0x5f, 0x1c, 0xbc, 0x85,
                           0x7d, 0x61, 0x94, 0x84, 0x8,  0x75, 0xf1, 0x88, 0xd5, 0x7b, 0xe3, 0x31};
  uint8_t bytesprops7[] = {0xc2, 0x94, 0x27, 0xec, 0x14, 0xc4, 0x4,  0xf9, 0x80, 0x90, 0x30, 0x8,  0xef, 0xeb, 0x57,
                           0x30, 0xac, 0x31, 0xcf, 0xaa, 0x50, 0x76, 0xf3, 0x2e, 0x1e, 0xf1, 0x25, 0xe2, 0x50, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31115}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops2}, .v = {18, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25143}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27855}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb3, 0x51, 0x24, 0x74, 0xd3, 0x3d, 0x14, 0xdb,
                               0x2e, 0xdf, 0x41, 0x2,  0x18, 0x19, 0xc,  0x96};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfd, 0x58, 0x8e, 0xa,  0xa0, 0x0,  0x92, 0xab, 0x6e, 0x67,
                                0x5c, 0x15, 0xba, 0x51, 0x8e, 0xa5, 0x0,  0x3,  0x36, 0xd4,
                                0xff, 0x64, 0x86, 0x7c, 0xfc, 0xb5, 0x21, 0x61, 0x76, 0x29};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7d, 0x31, 0xb6, 0x54, 0x2d, 0x75, 0xfb, 0x80};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12479;
  uint8_t client_id_bytes[] = {0xa0, 0xc6, 0x12, 0x66, 0x8a, 0x51, 0xbc, 0x51, 0x8a, 0x21, 0x79, 0x83,
                               0x8d, 0x34, 0xff, 0x95, 0xe4, 0x24, 0x3d, 0x54, 0x78, 0x1,  0x61, 0xe7};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xac, 0xdb, 0x6d, 0x2c, 0xd7, 0x31, 0x6a, 0xda, 0x20, 0x24, 0xb3, 0xc6, 0x71, 0xb1, 0x63,
                              0xac, 0xfb, 0x7c, 0x91, 0x97, 0x29, 0x6,  0x6b, 0xc7, 0xe2, 0xc0, 0x83, 0xa1, 0xe};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\186>\208\176\160\b\130H\DC3\FS\nw@\180M\223\f}~\163s\234_", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "h ", _willMsg =
// "\136Jb\133\241\194\237\174\234.J\DEL\213\CAN\189A\167\182", _willProps = [PropResponseInformation
// "\242r\139q\200\EM\r5",PropServerReference "\144H\212\165\186+\t\159\228U\SOH[D\141",PropSessionExpiryInterval
// 29968,PropTopicAliasMaximum 19634,PropMessageExpiryInterval 32147,PropReasonString
// "(\250\142\167A?\214\252c\245\153",PropAuthenticationData
// "\188\179\192\210\RS\178\133\197\\\212\RS\245\213{j\154\b\DEL\130\247\166",PropRetainAvailable
// 227,PropTopicAliasMaximum 627,PropAuthenticationMethod "",PropAuthenticationData "",PropMessageExpiryInterval
// 26962,PropReasonString "\b\251-|\132EL\aX",PropResponseInformation "\134\SYN8",PropAuthenticationData
// "\194\241{\172Br\STX\156\153\195Y\200\167\144AJV\229P\135\155"]}), _cleanSession = False, _keepAlive = 15269, _connID
// = "\151O\SUBd\191\216\184\130k$\237[9\159\\\STX\130\196~\DLE\222\ESC\198}\157\129w\n", _properties =
// [PropAssignedClientIdentifier "\NUL\230W\EOTdV\160\232",PropMessageExpiryInterval 22106,PropTopicAliasMaximum
// 25843,PropTopicAliasMaximum 12574,PropReasonString "\241K\130\208",PropResponseInformation
// "M>\216\ETB\205\223\186",PropMessageExpiryInterval 5857,PropAuthenticationData "\NULZ\231\157",PropReceiveMaximum
// 13735,PropTopicAlias 8358,PropTopicAliasMaximum 21535,PropServerReference "\227\238^E\154\141\FS\153\ACK9}\134\238
// \240hT",PropAuthenticationMethod
// "\196L\182\ETBgp\253D\129\131\223\210m\140B\210\182)\181`y\251\147\192\197Z\246P\217",PropTopicAlias
// 3384,PropRequestProblemInformation 175,PropSessionExpiryInterval 23888,PropServerReference
// "\152\135\180\234\193\200f\209\183U\173;\r\246\203D\194\174_\SO\170ox\160\190+\135\195",PropSubscriptionIdentifier
// 27,PropResponseInformation
// "\164\212\147\148$s*C\195\202\n\148\DLE0\221\SYN\156\146=\DEL\EOT\192\CAN\203X",PropAuthenticationData
// "Xv\139S\153\219\160\ESC}J",PropWillDelayInterval 12717,PropMaximumQoS 193,PropSessionExpiryInterval
// 1719,PropWildcardSubscriptionAvailable 149,PropMaximumQoS 132,PropMaximumPacketSize
// 19992,PropSubscriptionIdentifierAvailable 154]}
TEST(Connect5QCTest, Encode74) {
  uint8_t pkt[] = {
      0x10, 0xc1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x3b, 0xa5, 0xdb, 0x1,  0x12, 0x0,  0x8,  0x0,
      0xe6, 0x57, 0x4,  0x64, 0x56, 0xa0, 0xe8, 0x2,  0x0,  0x0,  0x56, 0x5a, 0x22, 0x64, 0xf3, 0x22, 0x31, 0x1e, 0x1f,
      0x0,  0x4,  0xf1, 0x4b, 0x82, 0xd0, 0x1a, 0x0,  0x7,  0x4d, 0x3e, 0xd8, 0x17, 0xcd, 0xdf, 0xba, 0x2,  0x0,  0x0,
      0x16, 0xe1, 0x16, 0x0,  0x4,  0x0,  0x5a, 0xe7, 0x9d, 0x21, 0x35, 0xa7, 0x23, 0x20, 0xa6, 0x22, 0x54, 0x1f, 0x1c,
      0x0,  0x11, 0xe3, 0xee, 0x5e, 0x45, 0x9a, 0x8d, 0x1c, 0x99, 0x6,  0x39, 0x7d, 0x86, 0xee, 0x20, 0xf0, 0x68, 0x54,
      0x15, 0x0,  0x1d, 0xc4, 0x4c, 0xb6, 0x17, 0x67, 0x70, 0xfd, 0x44, 0x81, 0x83, 0xdf, 0xd2, 0x6d, 0x8c, 0x42, 0xd2,
      0xb6, 0x29, 0xb5, 0x60, 0x79, 0xfb, 0x93, 0xc0, 0xc5, 0x5a, 0xf6, 0x50, 0xd9, 0x23, 0xd,  0x38, 0x17, 0xaf, 0x11,
      0x0,  0x0,  0x5d, 0x50, 0x1c, 0x0,  0x1c, 0x98, 0x87, 0xb4, 0xea, 0xc1, 0xc8, 0x66, 0xd1, 0xb7, 0x55, 0xad, 0x3b,
      0xd,  0xf6, 0xcb, 0x44, 0xc2, 0xae, 0x5f, 0xe,  0xaa, 0x6f, 0x78, 0xa0, 0xbe, 0x2b, 0x87, 0xc3, 0xb,  0x1b, 0x1a,
      0x0,  0x19, 0xa4, 0xd4, 0x93, 0x94, 0x24, 0x73, 0x2a, 0x43, 0xc3, 0xca, 0xa,  0x94, 0x10, 0x30, 0xdd, 0x16, 0x9c,
      0x92, 0x3d, 0x7f, 0x4,  0xc0, 0x18, 0xcb, 0x58, 0x16, 0x0,  0xa,  0x58, 0x76, 0x8b, 0x53, 0x99, 0xdb, 0xa0, 0x1b,
      0x7d, 0x4a, 0x18, 0x0,  0x0,  0x31, 0xad, 0x24, 0xc1, 0x11, 0x0,  0x0,  0x6,  0xb7, 0x28, 0x95, 0x24, 0x84, 0x27,
      0x0,  0x0,  0x4e, 0x18, 0x29, 0x9a, 0x0,  0x1c, 0x97, 0x4f, 0x1a, 0x64, 0xbf, 0xd8, 0xb8, 0x82, 0x6b, 0x24, 0xed,
      0x5b, 0x39, 0x9f, 0x5c, 0x2,  0x82, 0xc4, 0x7e, 0x10, 0xde, 0x1b, 0xc6, 0x7d, 0x9d, 0x81, 0x77, 0xa,  0x89, 0x1,
      0x1a, 0x0,  0x8,  0xf2, 0x72, 0x8b, 0x71, 0xc8, 0x19, 0xd,  0x35, 0x1c, 0x0,  0xe,  0x90, 0x48, 0xd4, 0xa5, 0xba,
      0x2b, 0x9,  0x9f, 0xe4, 0x55, 0x1,  0x5b, 0x44, 0x8d, 0x11, 0x0,  0x0,  0x75, 0x10, 0x22, 0x4c, 0xb2, 0x2,  0x0,
      0x0,  0x7d, 0x93, 0x1f, 0x0,  0xb,  0x28, 0xfa, 0x8e, 0xa7, 0x41, 0x3f, 0xd6, 0xfc, 0x63, 0xf5, 0x99, 0x16, 0x0,
      0x15, 0xbc, 0xb3, 0xc0, 0xd2, 0x1e, 0xb2, 0x85, 0xc5, 0x5c, 0xd4, 0x1e, 0xf5, 0xd5, 0x7b, 0x6a, 0x9a, 0x8,  0x7f,
      0x82, 0xf7, 0xa6, 0x25, 0xe3, 0x22, 0x2,  0x73, 0x15, 0x0,  0x0,  0x16, 0x0,  0x0,  0x2,  0x0,  0x0,  0x69, 0x52,
      0x1f, 0x0,  0x9,  0x8,  0xfb, 0x2d, 0x7c, 0x84, 0x45, 0x4c, 0x7,  0x58, 0x1a, 0x0,  0x3,  0x86, 0x16, 0x38, 0x16,
      0x0,  0x15, 0xc2, 0xf1, 0x7b, 0xac, 0x42, 0x72, 0x2,  0x9c, 0x99, 0xc3, 0x59, 0xc8, 0xa7, 0x90, 0x41, 0x4a, 0x56,
      0xe5, 0x50, 0x87, 0x9b, 0x0,  0x2,  0x68, 0x20, 0x0,  0x12, 0x88, 0x4a, 0x62, 0x85, 0xf1, 0xc2, 0xed, 0xae, 0xea,
      0x2e, 0x4a, 0x7f, 0xd5, 0x18, 0xbd, 0x41, 0xa7, 0xb6, 0x0,  0x17, 0xba, 0x3e, 0xd0, 0xb0, 0xa0, 0x8,  0x82, 0x48,
      0x13, 0x1c, 0xa,  0x77, 0x40, 0xb4, 0x4d, 0xdf, 0xc,  0x7d, 0x7e, 0xa3, 0x73, 0xea, 0x5f};

  uint8_t buf[462] = {0};

  uint8_t bytesprops0[] = {0x0, 0xe6, 0x57, 0x4, 0x64, 0x56, 0xa0, 0xe8};
  uint8_t bytesprops1[] = {0xf1, 0x4b, 0x82, 0xd0};
  uint8_t bytesprops2[] = {0x4d, 0x3e, 0xd8, 0x17, 0xcd, 0xdf, 0xba};
  uint8_t bytesprops3[] = {0x0, 0x5a, 0xe7, 0x9d};
  uint8_t bytesprops4[] = {0xe3, 0xee, 0x5e, 0x45, 0x9a, 0x8d, 0x1c, 0x99, 0x6,
                           0x39, 0x7d, 0x86, 0xee, 0x20, 0xf0, 0x68, 0x54};
  uint8_t bytesprops5[] = {0xc4, 0x4c, 0xb6, 0x17, 0x67, 0x70, 0xfd, 0x44, 0x81, 0x83, 0xdf, 0xd2, 0x6d, 0x8c, 0x42,
                           0xd2, 0xb6, 0x29, 0xb5, 0x60, 0x79, 0xfb, 0x93, 0xc0, 0xc5, 0x5a, 0xf6, 0x50, 0xd9};
  uint8_t bytesprops6[] = {0x98, 0x87, 0xb4, 0xea, 0xc1, 0xc8, 0x66, 0xd1, 0xb7, 0x55, 0xad, 0x3b, 0xd,  0xf6,
                           0xcb, 0x44, 0xc2, 0xae, 0x5f, 0xe,  0xaa, 0x6f, 0x78, 0xa0, 0xbe, 0x2b, 0x87, 0xc3};
  uint8_t bytesprops7[] = {0xa4, 0xd4, 0x93, 0x94, 0x24, 0x73, 0x2a, 0x43, 0xc3, 0xca, 0xa,  0x94, 0x10,
                           0x30, 0xdd, 0x16, 0x9c, 0x92, 0x3d, 0x7f, 0x4,  0xc0, 0x18, 0xcb, 0x58};
  uint8_t bytesprops8[] = {0x58, 0x76, 0x8b, 0x53, 0x99, 0xdb, 0xa0, 0x1b, 0x7d, 0x4a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22106}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25843}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12574}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5857}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13735}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8358}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21535}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3384}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23888}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12717}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1719}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19992}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 154}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf2, 0x72, 0x8b, 0x71, 0xc8, 0x19, 0xd, 0x35};
  uint8_t byteswillprops1[] = {0x90, 0x48, 0xd4, 0xa5, 0xba, 0x2b, 0x9, 0x9f, 0xe4, 0x55, 0x1, 0x5b, 0x44, 0x8d};
  uint8_t byteswillprops2[] = {0x28, 0xfa, 0x8e, 0xa7, 0x41, 0x3f, 0xd6, 0xfc, 0x63, 0xf5, 0x99};
  uint8_t byteswillprops3[] = {0xbc, 0xb3, 0xc0, 0xd2, 0x1e, 0xb2, 0x85, 0xc5, 0x5c, 0xd4, 0x1e,
                               0xf5, 0xd5, 0x7b, 0x6a, 0x9a, 0x8,  0x7f, 0x82, 0xf7, 0xa6};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0x8, 0xfb, 0x2d, 0x7c, 0x84, 0x45, 0x4c, 0x7, 0x58};
  uint8_t byteswillprops7[] = {0x86, 0x16, 0x38};
  uint8_t byteswillprops8[] = {0xc2, 0xf1, 0x7b, 0xac, 0x42, 0x72, 0x2,  0x9c, 0x99, 0xc3, 0x59,
                               0xc8, 0xa7, 0x90, 0x41, 0x4a, 0x56, 0xe5, 0x50, 0x87, 0x9b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29968}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19634}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32147}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 627}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26962}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops8}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x68, 0x20};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x88, 0x4a, 0x62, 0x85, 0xf1, 0xc2, 0xed, 0xae, 0xea,
                                  0x2e, 0x4a, 0x7f, 0xd5, 0x18, 0xbd, 0x41, 0xa7, 0xb6};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15269;
  uint8_t client_id_bytes[] = {0x97, 0x4f, 0x1a, 0x64, 0xbf, 0xd8, 0xb8, 0x82, 0x6b, 0x24, 0xed, 0x5b, 0x39, 0x9f,
                               0x5c, 0x2,  0x82, 0xc4, 0x7e, 0x10, 0xde, 0x1b, 0xc6, 0x7d, 0x9d, 0x81, 0x77, 0xa};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xba, 0x3e, 0xd0, 0xb0, 0xa0, 0x8,  0x82, 0x48, 0x13, 0x1c, 0xa, 0x77,
                              0x40, 0xb4, 0x4d, 0xdf, 0xc,  0x7d, 0x7e, 0xa3, 0x73, 0xea, 0x5f};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%_f0P\185\133\159\152\SOH\185\161\133\186\242\&0'", _password = Just
// "\166\165\148d\NAKy%\142\222\189,", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\222\254\185A\161\232i\ACK\180Z\146\192\254\182-\206\&8H\211\132", _willMsg =
// "\218\212\ACK\ESC\DC2_y\169\196A\228\195N\209;\219\138G\r\GS", _willProps = [PropRequestProblemInformation
// 77,PropSharedSubscriptionAvailable 90,PropSubscriptionIdentifierAvailable 75,PropServerReference
// "+\STX8v^n00@\142\165\ENQ\176\209\134%\180\139k_ #\220R"]}), _cleanSession = True, _keepAlive = 20166, _connID =
// "\ETBG\233\139e\tY\235MPwMH\208", _properties = [PropUserProperty "\234\253bJ+" "$",PropAssignedClientIdentifier
// ",\241\206f\241\RSJ2\DC3\NAK\136i\SOHDK!\237\136",PropSubscriptionIdentifierAvailable 138,PropReceiveMaximum
// 13275,PropSubscriptionIdentifierAvailable 32,PropRequestProblemInformation 72,PropTopicAliasMaximum
// 19915,PropWillDelayInterval 22210,PropAssignedClientIdentifier
// "8Vs*\191\200\128\ACKt\237\142\217\218",PropMaximumPacketSize 14118,PropRetainAvailable 34,PropResponseTopic
// "\205h\227\148",PropAssignedClientIdentifier "\176[\ESC\183\196\228\129+\202\174\vO",PropMaximumQoS
// 254,PropResponseInformation "T\180\202\170t\n\"\250\CAN",PropCorrelationData "9\161\239"]}
TEST(Connect5QCTest, Encode75) {
  uint8_t pkt[] = {0x10, 0xfb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x4e, 0xc6, 0x72, 0x26, 0x0,  0x5,
                   0xea, 0xfd, 0x62, 0x4a, 0x2b, 0x0,  0x1,  0x24, 0x12, 0x0,  0x12, 0x2c, 0xf1, 0xce, 0x66, 0xf1, 0x1e,
                   0x4a, 0x32, 0x13, 0x15, 0x88, 0x69, 0x1,  0x44, 0x4b, 0x21, 0xed, 0x88, 0x29, 0x8a, 0x21, 0x33, 0xdb,
                   0x29, 0x20, 0x17, 0x48, 0x22, 0x4d, 0xcb, 0x18, 0x0,  0x0,  0x56, 0xc2, 0x12, 0x0,  0xd,  0x38, 0x56,
                   0x73, 0x2a, 0xbf, 0xc8, 0x80, 0x6,  0x74, 0xed, 0x8e, 0xd9, 0xda, 0x27, 0x0,  0x0,  0x37, 0x26, 0x25,
                   0x22, 0x8,  0x0,  0x4,  0xcd, 0x68, 0xe3, 0x94, 0x12, 0x0,  0xc,  0xb0, 0x5b, 0x1b, 0xb7, 0xc4, 0xe4,
                   0x81, 0x2b, 0xca, 0xae, 0xb,  0x4f, 0x24, 0xfe, 0x1a, 0x0,  0x9,  0x54, 0xb4, 0xca, 0xaa, 0x74, 0xa,
                   0x22, 0xfa, 0x18, 0x9,  0x0,  0x3,  0x39, 0xa1, 0xef, 0x0,  0xe,  0x17, 0x47, 0xe9, 0x8b, 0x65, 0x9,
                   0x59, 0xeb, 0x4d, 0x50, 0x77, 0x4d, 0x48, 0xd0, 0x21, 0x17, 0x4d, 0x2a, 0x5a, 0x29, 0x4b, 0x1c, 0x0,
                   0x18, 0x2b, 0x2,  0x38, 0x76, 0x5e, 0x6e, 0x30, 0x30, 0x40, 0x8e, 0xa5, 0x5,  0xb0, 0xd1, 0x86, 0x25,
                   0xb4, 0x8b, 0x6b, 0x5f, 0x20, 0x23, 0xdc, 0x52, 0x0,  0x14, 0xde, 0xfe, 0xb9, 0x41, 0xa1, 0xe8, 0x69,
                   0x6,  0xb4, 0x5a, 0x92, 0xc0, 0xfe, 0xb6, 0x2d, 0xce, 0x38, 0x48, 0xd3, 0x84, 0x0,  0x14, 0xda, 0xd4,
                   0x6,  0x1b, 0x12, 0x5f, 0x79, 0xa9, 0xc4, 0x41, 0xe4, 0xc3, 0x4e, 0xd1, 0x3b, 0xdb, 0x8a, 0x47, 0xd,
                   0x1d, 0x0,  0x11, 0x25, 0x5f, 0x66, 0x30, 0x50, 0xb9, 0x85, 0x9f, 0x98, 0x1,  0xb9, 0xa1, 0x85, 0xba,
                   0xf2, 0x30, 0x27, 0x0,  0xb,  0xa6, 0xa5, 0x94, 0x64, 0x15, 0x79, 0x25, 0x8e, 0xde, 0xbd, 0x2c};

  uint8_t buf[264] = {0};

  uint8_t bytesprops1[] = {0x24};
  uint8_t bytesprops0[] = {0xea, 0xfd, 0x62, 0x4a, 0x2b};
  uint8_t bytesprops2[] = {0x2c, 0xf1, 0xce, 0x66, 0xf1, 0x1e, 0x4a, 0x32, 0x13,
                           0x15, 0x88, 0x69, 0x1,  0x44, 0x4b, 0x21, 0xed, 0x88};
  uint8_t bytesprops3[] = {0x38, 0x56, 0x73, 0x2a, 0xbf, 0xc8, 0x80, 0x6, 0x74, 0xed, 0x8e, 0xd9, 0xda};
  uint8_t bytesprops4[] = {0xcd, 0x68, 0xe3, 0x94};
  uint8_t bytesprops5[] = {0xb0, 0x5b, 0x1b, 0xb7, 0xc4, 0xe4, 0x81, 0x2b, 0xca, 0xae, 0xb, 0x4f};
  uint8_t bytesprops6[] = {0x54, 0xb4, 0xca, 0xaa, 0x74, 0xa, 0x22, 0xfa, 0x18};
  uint8_t bytesprops7[] = {0x39, 0xa1, 0xef};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops0}, .v = {1, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13275}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19915}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22210}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14118}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x2b, 0x2,  0x38, 0x76, 0x5e, 0x6e, 0x30, 0x30, 0x40, 0x8e, 0xa5, 0x5,
                               0xb0, 0xd1, 0x86, 0x25, 0xb4, 0x8b, 0x6b, 0x5f, 0x20, 0x23, 0xdc, 0x52};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xde, 0xfe, 0xb9, 0x41, 0xa1, 0xe8, 0x69, 0x6,  0xb4, 0x5a,
                                0x92, 0xc0, 0xfe, 0xb6, 0x2d, 0xce, 0x38, 0x48, 0xd3, 0x84};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xd4, 0x6,  0x1b, 0x12, 0x5f, 0x79, 0xa9, 0xc4, 0x41,
                                  0xe4, 0xc3, 0x4e, 0xd1, 0x3b, 0xdb, 0x8a, 0x47, 0xd,  0x1d};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20166;
  uint8_t client_id_bytes[] = {0x17, 0x47, 0xe9, 0x8b, 0x65, 0x9, 0x59, 0xeb, 0x4d, 0x50, 0x77, 0x4d, 0x48, 0xd0};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x5f, 0x66, 0x30, 0x50, 0xb9, 0x85, 0x9f, 0x98,
                              0x1,  0xb9, 0xa1, 0x85, 0xba, 0xf2, 0x30, 0x27};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa6, 0xa5, 0x94, 0x64, 0x15, 0x79, 0x25, 0x8e, 0xde, 0xbd, 0x2c};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\172\206\237\DLE\254_Q2\226B'S\147k\177*D!\230\185<\130", _password = Just
// ".\STX\240p\196\191\165l\140\230\214\188\253\220\166\224I\197\241\153&3;\249", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "\DC1o\221b\189\141f\242\228\CAN\219\141,e\230\221\166\&7Ar\GS",
// _willMsg = "", _willProps = []}), _cleanSession = False, _keepAlive = 20633, _connID =
// "x]*\241\253\180\253\181\DC4%\n\245\187\"\138\DLE\212b\182\171\131J\193\&0\176C", _properties =
// [PropRequestResponseInformation 254,PropAuthenticationMethod
// "\178\217\228\159;\DC4\209\143\165J\180\232\132\FSW",PropAuthenticationMethod
// "\170(\184H\158\183\236\197\134\157\DC1\RS\246\177\215mC",PropRequestProblemInformation 95,PropReasonString
// "\255Z\n>",PropSubscriptionIdentifierAvailable 56,PropUserProperty
// "\209\221\ACK+\SO\142\168\219\202\141\194C\169\167\SYN\253D\180\161\224\191\147-\226v,\DC27\140"
// "|\150p",PropWildcardSubscriptionAvailable 116,PropContentType
// "`0Y0\204\145\131\229\160\220mI\RS\170t\180*iw\188Hz\163\&8*\ESC,,\178",PropSharedSubscriptionAvailable
// 123,PropServerReference "\162V
// ,\235\164\DC4\207\152Uut\228\187\248\215s\214(\196u\243\b\bS\223t\151",PropResponseInformation
// "",PropPayloadFormatIndicator 83,PropSessionExpiryInterval 24887,PropCorrelationData "",PropRetainAvailable
// 95,PropMessageExpiryInterval 9307,PropSessionExpiryInterval 3503,PropResponseInformation
// "tR\NUL\248!\173\197p<\183\SYN\f\177=x\210\164a7=\SI\230d\\\149\157\232",PropUserProperty
// "\139\252S\156\149\134k\213\195\137^" "a\238\&5\222\160\192OaG{\251\231\SO\184\SI",PropTopicAliasMaximum
// 31387,PropUserProperty "''%\241k\158l\148\EM" "o\206\156(\ACK\142\204\&5\176\207Dx",PropMessageExpiryInterval
// 6104,PropSubscriptionIdentifier 15,PropContentType "\144\168\174\250\ETB\155\156",PropMessageExpiryInterval 18880]}
TEST(Connect5QCTest, Encode76) {
  uint8_t pkt[] = {
      0x10, 0x98, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x50, 0x99, 0xa4, 0x2,  0x19, 0xfe, 0x15, 0x0,
      0xf,  0xb2, 0xd9, 0xe4, 0x9f, 0x3b, 0x14, 0xd1, 0x8f, 0xa5, 0x4a, 0xb4, 0xe8, 0x84, 0x1c, 0x57, 0x15, 0x0,  0x11,
      0xaa, 0x28, 0xb8, 0x48, 0x9e, 0xb7, 0xec, 0xc5, 0x86, 0x9d, 0x11, 0x1e, 0xf6, 0xb1, 0xd7, 0x6d, 0x43, 0x17, 0x5f,
      0x1f, 0x0,  0x4,  0xff, 0x5a, 0xa,  0x3e, 0x29, 0x38, 0x26, 0x0,  0x1d, 0xd1, 0xdd, 0x6,  0x2b, 0xe,  0x8e, 0xa8,
      0xdb, 0xca, 0x8d, 0xc2, 0x43, 0xa9, 0xa7, 0x16, 0xfd, 0x44, 0xb4, 0xa1, 0xe0, 0xbf, 0x93, 0x2d, 0xe2, 0x76, 0x2c,
      0x12, 0x37, 0x8c, 0x0,  0x3,  0x7c, 0x96, 0x70, 0x28, 0x74, 0x3,  0x0,  0x1d, 0x60, 0x30, 0x59, 0x30, 0xcc, 0x91,
      0x83, 0xe5, 0xa0, 0xdc, 0x6d, 0x49, 0x1e, 0xaa, 0x74, 0xb4, 0x2a, 0x69, 0x77, 0xbc, 0x48, 0x7a, 0xa3, 0x38, 0x2a,
      0x1b, 0x2c, 0x2c, 0xb2, 0x2a, 0x7b, 0x1c, 0x0,  0x1c, 0xa2, 0x56, 0x20, 0x2c, 0xeb, 0xa4, 0x14, 0xcf, 0x98, 0x55,
      0x75, 0x74, 0xe4, 0xbb, 0xf8, 0xd7, 0x73, 0xd6, 0x28, 0xc4, 0x75, 0xf3, 0x8,  0x8,  0x53, 0xdf, 0x74, 0x97, 0x1a,
      0x0,  0x0,  0x1,  0x53, 0x11, 0x0,  0x0,  0x61, 0x37, 0x9,  0x0,  0x0,  0x25, 0x5f, 0x2,  0x0,  0x0,  0x24, 0x5b,
      0x11, 0x0,  0x0,  0xd,  0xaf, 0x1a, 0x0,  0x1b, 0x74, 0x52, 0x0,  0xf8, 0x21, 0xad, 0xc5, 0x70, 0x3c, 0xb7, 0x16,
      0xc,  0xb1, 0x3d, 0x78, 0xd2, 0xa4, 0x61, 0x37, 0x3d, 0xf,  0xe6, 0x64, 0x5c, 0x95, 0x9d, 0xe8, 0x26, 0x0,  0xb,
      0x8b, 0xfc, 0x53, 0x9c, 0x95, 0x86, 0x6b, 0xd5, 0xc3, 0x89, 0x5e, 0x0,  0xf,  0x61, 0xee, 0x35, 0xde, 0xa0, 0xc0,
      0x4f, 0x61, 0x47, 0x7b, 0xfb, 0xe7, 0xe,  0xb8, 0xf,  0x22, 0x7a, 0x9b, 0x26, 0x0,  0x9,  0x27, 0x27, 0x25, 0xf1,
      0x6b, 0x9e, 0x6c, 0x94, 0x19, 0x0,  0xc,  0x6f, 0xce, 0x9c, 0x28, 0x6,  0x8e, 0xcc, 0x35, 0xb0, 0xcf, 0x44, 0x78,
      0x2,  0x0,  0x0,  0x17, 0xd8, 0xb,  0xf,  0x3,  0x0,  0x7,  0x90, 0xa8, 0xae, 0xfa, 0x17, 0x9b, 0x9c, 0x2,  0x0,
      0x0,  0x49, 0xc0, 0x0,  0x1a, 0x78, 0x5d, 0x2a, 0xf1, 0xfd, 0xb4, 0xfd, 0xb5, 0x14, 0x25, 0xa,  0xf5, 0xbb, 0x22,
      0x8a, 0x10, 0xd4, 0x62, 0xb6, 0xab, 0x83, 0x4a, 0xc1, 0x30, 0xb0, 0x43, 0x0,  0x0,  0x15, 0x11, 0x6f, 0xdd, 0x62,
      0xbd, 0x8d, 0x66, 0xf2, 0xe4, 0x18, 0xdb, 0x8d, 0x2c, 0x65, 0xe6, 0xdd, 0xa6, 0x37, 0x41, 0x72, 0x1d, 0x0,  0x0,
      0x0,  0x16, 0xac, 0xce, 0xed, 0x10, 0xfe, 0x5f, 0x51, 0x32, 0xe2, 0x42, 0x27, 0x53, 0x93, 0x6b, 0xb1, 0x2a, 0x44,
      0x21, 0xe6, 0xb9, 0x3c, 0x82, 0x0,  0x18, 0x2e, 0x2,  0xf0, 0x70, 0xc4, 0xbf, 0xa5, 0x6c, 0x8c, 0xe6, 0xd6, 0xbc,
      0xfd, 0xdc, 0xa6, 0xe0, 0x49, 0xc5, 0xf1, 0x99, 0x26, 0x33, 0x3b, 0xf9};

  uint8_t buf[421] = {0};

  uint8_t bytesprops0[] = {0xb2, 0xd9, 0xe4, 0x9f, 0x3b, 0x14, 0xd1, 0x8f, 0xa5, 0x4a, 0xb4, 0xe8, 0x84, 0x1c, 0x57};
  uint8_t bytesprops1[] = {0xaa, 0x28, 0xb8, 0x48, 0x9e, 0xb7, 0xec, 0xc5, 0x86,
                           0x9d, 0x11, 0x1e, 0xf6, 0xb1, 0xd7, 0x6d, 0x43};
  uint8_t bytesprops2[] = {0xff, 0x5a, 0xa, 0x3e};
  uint8_t bytesprops4[] = {0x7c, 0x96, 0x70};
  uint8_t bytesprops3[] = {0xd1, 0xdd, 0x6,  0x2b, 0xe,  0x8e, 0xa8, 0xdb, 0xca, 0x8d, 0xc2, 0x43, 0xa9, 0xa7, 0x16,
                           0xfd, 0x44, 0xb4, 0xa1, 0xe0, 0xbf, 0x93, 0x2d, 0xe2, 0x76, 0x2c, 0x12, 0x37, 0x8c};
  uint8_t bytesprops5[] = {0x60, 0x30, 0x59, 0x30, 0xcc, 0x91, 0x83, 0xe5, 0xa0, 0xdc, 0x6d, 0x49, 0x1e, 0xaa, 0x74,
                           0xb4, 0x2a, 0x69, 0x77, 0xbc, 0x48, 0x7a, 0xa3, 0x38, 0x2a, 0x1b, 0x2c, 0x2c, 0xb2};
  uint8_t bytesprops6[] = {0xa2, 0x56, 0x20, 0x2c, 0xeb, 0xa4, 0x14, 0xcf, 0x98, 0x55, 0x75, 0x74, 0xe4, 0xbb,
                           0xf8, 0xd7, 0x73, 0xd6, 0x28, 0xc4, 0x75, 0xf3, 0x8,  0x8,  0x53, 0xdf, 0x74, 0x97};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x74, 0x52, 0x0,  0xf8, 0x21, 0xad, 0xc5, 0x70, 0x3c, 0xb7, 0x16, 0xc,  0xb1, 0x3d,
                           0x78, 0xd2, 0xa4, 0x61, 0x37, 0x3d, 0xf,  0xe6, 0x64, 0x5c, 0x95, 0x9d, 0xe8};
  uint8_t bytesprops11[] = {0x61, 0xee, 0x35, 0xde, 0xa0, 0xc0, 0x4f, 0x61, 0x47, 0x7b, 0xfb, 0xe7, 0xe, 0xb8, 0xf};
  uint8_t bytesprops10[] = {0x8b, 0xfc, 0x53, 0x9c, 0x95, 0x86, 0x6b, 0xd5, 0xc3, 0x89, 0x5e};
  uint8_t bytesprops13[] = {0x6f, 0xce, 0x9c, 0x28, 0x6, 0x8e, 0xcc, 0x35, 0xb0, 0xcf, 0x44, 0x78};
  uint8_t bytesprops12[] = {0x27, 0x27, 0x25, 0xf1, 0x6b, 0x9e, 0x6c, 0x94, 0x19};
  uint8_t bytesprops14[] = {0x90, 0xa8, 0xae, 0xfa, 0x17, 0x9b, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops3}, .v = {3, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24887}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9307}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3503}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&bytesprops10}, .v = {15, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31387}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops12}, .v = {12, (char*)&bytesprops13}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6104}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18880}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0x6f, 0xdd, 0x62, 0xbd, 0x8d, 0x66, 0xf2, 0xe4, 0x18, 0xdb,
                                0x8d, 0x2c, 0x65, 0xe6, 0xdd, 0xa6, 0x37, 0x41, 0x72, 0x1d};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20633;
  uint8_t client_id_bytes[] = {0x78, 0x5d, 0x2a, 0xf1, 0xfd, 0xb4, 0xfd, 0xb5, 0x14, 0x25, 0xa,  0xf5, 0xbb,
                               0x22, 0x8a, 0x10, 0xd4, 0x62, 0xb6, 0xab, 0x83, 0x4a, 0xc1, 0x30, 0xb0, 0x43};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xac, 0xce, 0xed, 0x10, 0xfe, 0x5f, 0x51, 0x32, 0xe2, 0x42, 0x27,
                              0x53, 0x93, 0x6b, 0xb1, 0x2a, 0x44, 0x21, 0xe6, 0xb9, 0x3c, 0x82};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2e, 0x2,  0xf0, 0x70, 0xc4, 0xbf, 0xa5, 0x6c, 0x8c, 0xe6, 0xd6, 0xbc,
                              0xfd, 0xdc, 0xa6, 0xe0, 0x49, 0xc5, 0xf1, 0x99, 0x26, 0x33, 0x3b, 0xf9};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "z@\a", _password = Just "\253\197(\t}\238J\253\251\192\135j", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\129B\175B", _willMsg = "S\233k'\183[ryq\189X\218",
// _willProps = [PropSubscriptionIdentifierAvailable 59,PropRequestProblemInformation 184,PropTopicAlias
// 11545,PropResponseTopic "\\0\128\214\&2`\162x\179\176))\207D\255S\134\224X\DC2\b\159",PropSessionExpiryInterval
// 32591,PropSessionExpiryInterval 6459,PropRequestProblemInformation 129,PropSharedSubscriptionAvailable
// 184,PropAssignedClientIdentifier
// "\145\248\128|\178\150\242\235d\NAK\190R\137t\169\217n\174E\156Y\SUB6\SYN\151XH",PropRetainAvailable 204]}),
// _cleanSession = False, _keepAlive = 32764, _connID = "d\173\189", _properties = [PropMessageExpiryInterval
// 19357,PropContentType "{fW\192\248\DC4\206\191\235",PropAuthenticationMethod "\DC2l1",PropAuthenticationData
// "\198\159$\188\RS\196\222O\217\225R\191\212d>\241W\131\191BF)O\180\227v\145i",PropSessionExpiryInterval
// 20981,PropSessionExpiryInterval 18282,PropAssignedClientIdentifier
// "\185\249\196\187\a\247\161\214_|\166\229\&2k\179\151ak\151\151%=O\132\246\144*6>",PropAssignedClientIdentifier
// "\223m\v\197\233X/\NUL\NAK\166C\132\f\135c&\231$j\206",PropPayloadFormatIndicator 5,PropWildcardSubscriptionAvailable
// 184,PropAuthenticationMethod "\210n|<\132\243?\193\251\DC3a\EOT\169\171\"n^\161\RS",PropUserProperty
// "\165K\198\SOBe\170'3m\220\211\185\SId\168\154\SYN~\247v\208\197\231\153"
// "\140\210\128\139\DLE\238W\240\138G\164AE\155\173\255$\138\r\201\235\&3w\134\&0`6\245s"]}
TEST(Connect5QCTest, Encode77) {
  uint8_t pkt[] = {
      0x10, 0xd3, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x7f, 0xfc, 0xcc, 0x1,  0x2,  0x0,  0x0,  0x4b,
      0x9d, 0x3,  0x0,  0x9,  0x7b, 0x66, 0x57, 0xc0, 0xf8, 0x14, 0xce, 0xbf, 0xeb, 0x15, 0x0,  0x3,  0x12, 0x6c, 0x31,
      0x16, 0x0,  0x1c, 0xc6, 0x9f, 0x24, 0xbc, 0x1e, 0xc4, 0xde, 0x4f, 0xd9, 0xe1, 0x52, 0xbf, 0xd4, 0x64, 0x3e, 0xf1,
      0x57, 0x83, 0xbf, 0x42, 0x46, 0x29, 0x4f, 0xb4, 0xe3, 0x76, 0x91, 0x69, 0x11, 0x0,  0x0,  0x51, 0xf5, 0x11, 0x0,
      0x0,  0x47, 0x6a, 0x12, 0x0,  0x1d, 0xb9, 0xf9, 0xc4, 0xbb, 0x7,  0xf7, 0xa1, 0xd6, 0x5f, 0x7c, 0xa6, 0xe5, 0x32,
      0x6b, 0xb3, 0x97, 0x61, 0x6b, 0x97, 0x97, 0x25, 0x3d, 0x4f, 0x84, 0xf6, 0x90, 0x2a, 0x36, 0x3e, 0x12, 0x0,  0x14,
      0xdf, 0x6d, 0xb,  0xc5, 0xe9, 0x58, 0x2f, 0x0,  0x15, 0xa6, 0x43, 0x84, 0xc,  0x87, 0x63, 0x26, 0xe7, 0x24, 0x6a,
      0xce, 0x1,  0x5,  0x28, 0xb8, 0x15, 0x0,  0x13, 0xd2, 0x6e, 0x7c, 0x3c, 0x84, 0xf3, 0x3f, 0xc1, 0xfb, 0x13, 0x61,
      0x4,  0xa9, 0xab, 0x22, 0x6e, 0x5e, 0xa1, 0x1e, 0x26, 0x0,  0x19, 0xa5, 0x4b, 0xc6, 0xe,  0x42, 0x65, 0xaa, 0x27,
      0x33, 0x6d, 0xdc, 0xd3, 0xb9, 0xf,  0x64, 0xa8, 0x9a, 0x16, 0x7e, 0xf7, 0x76, 0xd0, 0xc5, 0xe7, 0x99, 0x0,  0x1d,
      0x8c, 0xd2, 0x80, 0x8b, 0x10, 0xee, 0x57, 0xf0, 0x8a, 0x47, 0xa4, 0x41, 0x45, 0x9b, 0xad, 0xff, 0x24, 0x8a, 0xd,
      0xc9, 0xeb, 0x33, 0x77, 0x86, 0x30, 0x60, 0x36, 0xf5, 0x73, 0x0,  0x3,  0x64, 0xad, 0xbd, 0x4e, 0x29, 0x3b, 0x17,
      0xb8, 0x23, 0x2d, 0x19, 0x8,  0x0,  0x16, 0x5c, 0x30, 0x80, 0xd6, 0x32, 0x60, 0xa2, 0x78, 0xb3, 0xb0, 0x29, 0x29,
      0xcf, 0x44, 0xff, 0x53, 0x86, 0xe0, 0x58, 0x12, 0x8,  0x9f, 0x11, 0x0,  0x0,  0x7f, 0x4f, 0x11, 0x0,  0x0,  0x19,
      0x3b, 0x17, 0x81, 0x2a, 0xb8, 0x12, 0x0,  0x1b, 0x91, 0xf8, 0x80, 0x7c, 0xb2, 0x96, 0xf2, 0xeb, 0x64, 0x15, 0xbe,
      0x52, 0x89, 0x74, 0xa9, 0xd9, 0x6e, 0xae, 0x45, 0x9c, 0x59, 0x1a, 0x36, 0x16, 0x97, 0x58, 0x48, 0x25, 0xcc, 0x0,
      0x4,  0x81, 0x42, 0xaf, 0x42, 0x0,  0xc,  0x53, 0xe9, 0x6b, 0x27, 0xb7, 0x5b, 0x72, 0x79, 0x71, 0xbd, 0x58, 0xda,
      0x0,  0x3,  0x7a, 0x40, 0x7,  0x0,  0xc,  0xfd, 0xc5, 0x28, 0x9,  0x7d, 0xee, 0x4a, 0xfd, 0xfb, 0xc0, 0x87, 0x6a};

  uint8_t buf[352] = {0};

  uint8_t bytesprops0[] = {0x7b, 0x66, 0x57, 0xc0, 0xf8, 0x14, 0xce, 0xbf, 0xeb};
  uint8_t bytesprops1[] = {0x12, 0x6c, 0x31};
  uint8_t bytesprops2[] = {0xc6, 0x9f, 0x24, 0xbc, 0x1e, 0xc4, 0xde, 0x4f, 0xd9, 0xe1, 0x52, 0xbf, 0xd4, 0x64,
                           0x3e, 0xf1, 0x57, 0x83, 0xbf, 0x42, 0x46, 0x29, 0x4f, 0xb4, 0xe3, 0x76, 0x91, 0x69};
  uint8_t bytesprops3[] = {0xb9, 0xf9, 0xc4, 0xbb, 0x7,  0xf7, 0xa1, 0xd6, 0x5f, 0x7c, 0xa6, 0xe5, 0x32, 0x6b, 0xb3,
                           0x97, 0x61, 0x6b, 0x97, 0x97, 0x25, 0x3d, 0x4f, 0x84, 0xf6, 0x90, 0x2a, 0x36, 0x3e};
  uint8_t bytesprops4[] = {0xdf, 0x6d, 0xb, 0xc5, 0xe9, 0x58, 0x2f, 0x0,  0x15, 0xa6,
                           0x43, 0x84, 0xc, 0x87, 0x63, 0x26, 0xe7, 0x24, 0x6a, 0xce};
  uint8_t bytesprops5[] = {0xd2, 0x6e, 0x7c, 0x3c, 0x84, 0xf3, 0x3f, 0xc1, 0xfb, 0x13,
                           0x61, 0x4,  0xa9, 0xab, 0x22, 0x6e, 0x5e, 0xa1, 0x1e};
  uint8_t bytesprops7[] = {0x8c, 0xd2, 0x80, 0x8b, 0x10, 0xee, 0x57, 0xf0, 0x8a, 0x47, 0xa4, 0x41, 0x45, 0x9b, 0xad,
                           0xff, 0x24, 0x8a, 0xd,  0xc9, 0xeb, 0x33, 0x77, 0x86, 0x30, 0x60, 0x36, 0xf5, 0x73};
  uint8_t bytesprops6[] = {0xa5, 0x4b, 0xc6, 0xe,  0x42, 0x65, 0xaa, 0x27, 0x33, 0x6d, 0xdc, 0xd3, 0xb9,
                           0xf,  0x64, 0xa8, 0x9a, 0x16, 0x7e, 0xf7, 0x76, 0xd0, 0xc5, 0xe7, 0x99};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19357}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20981}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18282}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops6}, .v = {29, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x5c, 0x30, 0x80, 0xd6, 0x32, 0x60, 0xa2, 0x78, 0xb3, 0xb0, 0x29,
                               0x29, 0xcf, 0x44, 0xff, 0x53, 0x86, 0xe0, 0x58, 0x12, 0x8,  0x9f};
  uint8_t byteswillprops1[] = {0x91, 0xf8, 0x80, 0x7c, 0xb2, 0x96, 0xf2, 0xeb, 0x64, 0x15, 0xbe, 0x52, 0x89, 0x74,
                               0xa9, 0xd9, 0x6e, 0xae, 0x45, 0x9c, 0x59, 0x1a, 0x36, 0x16, 0x97, 0x58, 0x48};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11545}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32591}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6459}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0x42, 0xaf, 0x42};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x53, 0xe9, 0x6b, 0x27, 0xb7, 0x5b, 0x72, 0x79, 0x71, 0xbd, 0x58, 0xda};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32764;
  uint8_t client_id_bytes[] = {0x64, 0xad, 0xbd};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7a, 0x40, 0x7};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xfd, 0xc5, 0x28, 0x9, 0x7d, 0xee, 0x4a, 0xfd, 0xfb, 0xc0, 0x87, 0x6a};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "vo\255\134\EM\214ra~\221QTH]\236\&1\203\133f\193%", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\143\219\228T\SIP\210\NULp\216b\230\191\b\DC1\190\218\139\178\174\179\138\176z", _willMsg =
// "\\\196Q\224Q\138\232\DC4\230u\194\&6\147\197\138o\202\247&\180\179\RSB,\244\153h\STX", _willProps =
// [PropRequestResponseInformation 5]}), _cleanSession = False, _keepAlive = 18519, _connID =
// "cX\140\&9\221\ETXY\131\GS", _properties = [PropCorrelationData
// "cD\152\188\136\&0\ETB\178Ya6",PropSharedSubscriptionAvailable 108,PropMessageExpiryInterval 17865]}
TEST(Connect5QCTest, Encode78) {
  uint8_t pkt[] = {0x10, 0x7d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0x48, 0x57, 0x15, 0x9,  0x0,  0xb,
                   0x63, 0x44, 0x98, 0xbc, 0x88, 0x30, 0x17, 0xb2, 0x59, 0x61, 0x36, 0x2a, 0x6c, 0x2,  0x0,  0x0,
                   0x45, 0xc9, 0x0,  0x9,  0x63, 0x58, 0x8c, 0x39, 0xdd, 0x3,  0x59, 0x83, 0x1d, 0x2,  0x19, 0x5,
                   0x0,  0x18, 0x8f, 0xdb, 0xe4, 0x54, 0xf,  0x50, 0xd2, 0x0,  0x70, 0xd8, 0x62, 0xe6, 0xbf, 0x8,
                   0x11, 0xbe, 0xda, 0x8b, 0xb2, 0xae, 0xb3, 0x8a, 0xb0, 0x7a, 0x0,  0x1c, 0x5c, 0xc4, 0x51, 0xe0,
                   0x51, 0x8a, 0xe8, 0x14, 0xe6, 0x75, 0xc2, 0x36, 0x93, 0xc5, 0x8a, 0x6f, 0xca, 0xf7, 0x26, 0xb4,
                   0xb3, 0x1e, 0x42, 0x2c, 0xf4, 0x99, 0x68, 0x2,  0x0,  0x15, 0x76, 0x6f, 0xff, 0x86, 0x19, 0xd6,
                   0x72, 0x61, 0x7e, 0xdd, 0x51, 0x54, 0x48, 0x5d, 0xec, 0x31, 0xcb, 0x85, 0x66, 0xc1, 0x25};

  uint8_t buf[137] = {0};

  uint8_t bytesprops0[] = {0x63, 0x44, 0x98, 0xbc, 0x88, 0x30, 0x17, 0xb2, 0x59, 0x61, 0x36};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17865}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 5}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0xdb, 0xe4, 0x54, 0xf,  0x50, 0xd2, 0x0,  0x70, 0xd8, 0x62, 0xe6,
                                0xbf, 0x8,  0x11, 0xbe, 0xda, 0x8b, 0xb2, 0xae, 0xb3, 0x8a, 0xb0, 0x7a};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5c, 0xc4, 0x51, 0xe0, 0x51, 0x8a, 0xe8, 0x14, 0xe6, 0x75, 0xc2, 0x36, 0x93, 0xc5,
                                  0x8a, 0x6f, 0xca, 0xf7, 0x26, 0xb4, 0xb3, 0x1e, 0x42, 0x2c, 0xf4, 0x99, 0x68, 0x2};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18519;
  uint8_t client_id_bytes[] = {0x63, 0x58, 0x8c, 0x39, 0xdd, 0x3, 0x59, 0x83, 0x1d};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x76, 0x6f, 0xff, 0x86, 0x19, 0xd6, 0x72, 0x61, 0x7e, 0xdd, 0x51,
                              0x54, 0x48, 0x5d, 0xec, 0x31, 0xcb, 0x85, 0x66, 0xc1, 0x25};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\157\ETB\161\194\193\144\143\222H\bK\137S\211\183P\248e#\158\140\132\232~", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic = "\234\218\131\206!/\185r4\200\241\199\174\200\229", _willMsg =
// "?\198\253\173(", _willProps = [PropServerKeepAlive 29962,PropReceiveMaximum 19631,PropMaximumPacketSize
// 17084,PropTopicAlias 21494,PropMaximumPacketSize 20387,PropSessionExpiryInterval 10289,PropServerKeepAlive 23645]}),
// _cleanSession = True, _keepAlive = 5462, _connID = "~Zt\220\FS\b\166{\135\185\244Q\248@\a^", _properties =
// [PropWillDelayInterval 7867,PropServerReference "cS\248\169\DLE\189Q\207\170gE\239\146\231szjp\137",PropReasonString
// "F7\v\177l\189\191\DEL\198\162[\162\146\SUB\180\t\228\156y\171F\218-\246\156\169\229'",PropServerKeepAlive
// 30499,PropWillDelayInterval 18658,PropAssignedClientIdentifier "\174\209g",PropMaximumPacketSize 22566,PropMaximumQoS
// 204,PropAuthenticationData "L\133}qW\235\165r\183\195'\ny\148;7Ja",PropServerKeepAlive 21943,PropReasonString
// "\255\189\230TO\231\f\235\148\SOH\192\205\f\234\250\176\202r\197\214\t\199\252\230\167:\228\175\147",PropAssignedClientIdentifier
// "-$\ETX\200\r\255Id\GS\\C\238&\SI=\b<\194\167\&9O\197\164\245\236+\250\159\209\167",PropAssignedClientIdentifier
// "\252\f",PropWillDelayInterval 31642,PropSessionExpiryInterval 30092,PropAssignedClientIdentifier
// "\149\213\139\STX\SOHD\209!\184\251)\235fj\146\184\216\206\140$",PropAssignedClientIdentifier
// "\251\DC2\255j\235\236\&2\169\226\151l\136\CAN\155\205\220:\171\147W5`\224",PropRetainAvailable 210]}
TEST(Connect5QCTest, Encode79) {
  uint8_t pkt[] = {
      0x10, 0xbc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x15, 0x56, 0xea, 0x1,  0x18, 0x0,  0x0,  0x1e,
      0xbb, 0x1c, 0x0,  0x13, 0x63, 0x53, 0xf8, 0xa9, 0x10, 0xbd, 0x51, 0xcf, 0xaa, 0x67, 0x45, 0xef, 0x92, 0xe7, 0x73,
      0x7a, 0x6a, 0x70, 0x89, 0x1f, 0x0,  0x1c, 0x46, 0x37, 0xb,  0xb1, 0x6c, 0xbd, 0xbf, 0x7f, 0xc6, 0xa2, 0x5b, 0xa2,
      0x92, 0x1a, 0xb4, 0x9,  0xe4, 0x9c, 0x79, 0xab, 0x46, 0xda, 0x2d, 0xf6, 0x9c, 0xa9, 0xe5, 0x27, 0x13, 0x77, 0x23,
      0x18, 0x0,  0x0,  0x48, 0xe2, 0x12, 0x0,  0x3,  0xae, 0xd1, 0x67, 0x27, 0x0,  0x0,  0x58, 0x26, 0x24, 0xcc, 0x16,
      0x0,  0x12, 0x4c, 0x85, 0x7d, 0x71, 0x57, 0xeb, 0xa5, 0x72, 0xb7, 0xc3, 0x27, 0xa,  0x79, 0x94, 0x3b, 0x37, 0x4a,
      0x61, 0x13, 0x55, 0xb7, 0x1f, 0x0,  0x1d, 0xff, 0xbd, 0xe6, 0x54, 0x4f, 0xe7, 0xc,  0xeb, 0x94, 0x1,  0xc0, 0xcd,
      0xc,  0xea, 0xfa, 0xb0, 0xca, 0x72, 0xc5, 0xd6, 0x9,  0xc7, 0xfc, 0xe6, 0xa7, 0x3a, 0xe4, 0xaf, 0x93, 0x12, 0x0,
      0x1e, 0x2d, 0x24, 0x3,  0xc8, 0xd,  0xff, 0x49, 0x64, 0x1d, 0x5c, 0x43, 0xee, 0x26, 0xf,  0x3d, 0x8,  0x3c, 0xc2,
      0xa7, 0x39, 0x4f, 0xc5, 0xa4, 0xf5, 0xec, 0x2b, 0xfa, 0x9f, 0xd1, 0xa7, 0x12, 0x0,  0x2,  0xfc, 0xc,  0x18, 0x0,
      0x0,  0x7b, 0x9a, 0x11, 0x0,  0x0,  0x75, 0x8c, 0x12, 0x0,  0x14, 0x95, 0xd5, 0x8b, 0x2,  0x1,  0x44, 0xd1, 0x21,
      0xb8, 0xfb, 0x29, 0xeb, 0x66, 0x6a, 0x92, 0xb8, 0xd8, 0xce, 0x8c, 0x24, 0x12, 0x0,  0x17, 0xfb, 0x12, 0xff, 0x6a,
      0xeb, 0xec, 0x32, 0xa9, 0xe2, 0x97, 0x6c, 0x88, 0x18, 0x9b, 0xcd, 0xdc, 0x3a, 0xab, 0x93, 0x57, 0x35, 0x60, 0xe0,
      0x25, 0xd2, 0x0,  0x10, 0x7e, 0x5a, 0x74, 0xdc, 0x1c, 0x8,  0xa6, 0x7b, 0x87, 0xb9, 0xf4, 0x51, 0xf8, 0x40, 0x7,
      0x5e, 0x1b, 0x13, 0x75, 0xa,  0x21, 0x4c, 0xaf, 0x27, 0x0,  0x0,  0x42, 0xbc, 0x23, 0x53, 0xf6, 0x27, 0x0,  0x0,
      0x4f, 0xa3, 0x11, 0x0,  0x0,  0x28, 0x31, 0x13, 0x5c, 0x5d, 0x0,  0xf,  0xea, 0xda, 0x83, 0xce, 0x21, 0x2f, 0xb9,
      0x72, 0x34, 0xc8, 0xf1, 0xc7, 0xae, 0xc8, 0xe5, 0x0,  0x5,  0x3f, 0xc6, 0xfd, 0xad, 0x28};

  uint8_t buf[329] = {0};

  uint8_t bytesprops0[] = {0x63, 0x53, 0xf8, 0xa9, 0x10, 0xbd, 0x51, 0xcf, 0xaa, 0x67,
                           0x45, 0xef, 0x92, 0xe7, 0x73, 0x7a, 0x6a, 0x70, 0x89};
  uint8_t bytesprops1[] = {0x46, 0x37, 0xb,  0xb1, 0x6c, 0xbd, 0xbf, 0x7f, 0xc6, 0xa2, 0x5b, 0xa2, 0x92, 0x1a,
                           0xb4, 0x9,  0xe4, 0x9c, 0x79, 0xab, 0x46, 0xda, 0x2d, 0xf6, 0x9c, 0xa9, 0xe5, 0x27};
  uint8_t bytesprops2[] = {0xae, 0xd1, 0x67};
  uint8_t bytesprops3[] = {0x4c, 0x85, 0x7d, 0x71, 0x57, 0xeb, 0xa5, 0x72, 0xb7,
                           0xc3, 0x27, 0xa,  0x79, 0x94, 0x3b, 0x37, 0x4a, 0x61};
  uint8_t bytesprops4[] = {0xff, 0xbd, 0xe6, 0x54, 0x4f, 0xe7, 0xc,  0xeb, 0x94, 0x1,  0xc0, 0xcd, 0xc,  0xea, 0xfa,
                           0xb0, 0xca, 0x72, 0xc5, 0xd6, 0x9,  0xc7, 0xfc, 0xe6, 0xa7, 0x3a, 0xe4, 0xaf, 0x93};
  uint8_t bytesprops5[] = {0x2d, 0x24, 0x3,  0xc8, 0xd,  0xff, 0x49, 0x64, 0x1d, 0x5c, 0x43, 0xee, 0x26, 0xf,  0x3d,
                           0x8,  0x3c, 0xc2, 0xa7, 0x39, 0x4f, 0xc5, 0xa4, 0xf5, 0xec, 0x2b, 0xfa, 0x9f, 0xd1, 0xa7};
  uint8_t bytesprops6[] = {0xfc, 0xc};
  uint8_t bytesprops7[] = {0x95, 0xd5, 0x8b, 0x2,  0x1,  0x44, 0xd1, 0x21, 0xb8, 0xfb,
                           0x29, 0xeb, 0x66, 0x6a, 0x92, 0xb8, 0xd8, 0xce, 0x8c, 0x24};
  uint8_t bytesprops8[] = {0xfb, 0x12, 0xff, 0x6a, 0xeb, 0xec, 0x32, 0xa9, 0xe2, 0x97, 0x6c, 0x88,
                           0x18, 0x9b, 0xcd, 0xdc, 0x3a, 0xab, 0x93, 0x57, 0x35, 0x60, 0xe0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7867}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30499}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18658}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22566}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21943}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31642}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30092}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29962}}, {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19631}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17084}}, {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21494}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20387}}, {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10289}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23645}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xea, 0xda, 0x83, 0xce, 0x21, 0x2f, 0xb9, 0x72,
                                0x34, 0xc8, 0xf1, 0xc7, 0xae, 0xc8, 0xe5};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3f, 0xc6, 0xfd, 0xad, 0x28};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5462;
  uint8_t client_id_bytes[] = {0x7e, 0x5a, 0x74, 0xdc, 0x1c, 0x8,  0xa6, 0x7b,
                               0x87, 0xb9, 0xf4, 0x51, 0xf8, 0x40, 0x7,  0x5e};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9d, 0x17, 0xa1, 0xc2, 0xc1, 0x90, 0x8f, 0xde, 0x48, 0x8,  0x4b, 0x89,
                              0x53, 0xd3, 0xb7, 0x50, 0xf8, 0x65, 0x23, 0x9e, 0x8c, 0x84, 0xe8, 0x7e};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\147{'Z\192?r8#\DLEU\192\236\160\237v\192p\NUL\171;\EOT", _password = Just
// "\160J\202\185\172\&2\153\200\SYN\a\130n\179\133f\207\&5\n8\245\n\144\220", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\145K\248\242\218\139\203", _willMsg =
// "\166\252\SI\215\181\NUL\150dX7\178\210", _willProps = [PropSubscriptionIdentifierAvailable 128,PropTopicAliasMaximum
// 24138,PropReceiveMaximum 13075,PropResponseTopic
// "\178\236j\DEL\154Z\251\STXs\196\164M\171\140\&9G\210\212\187",PropMaximumQoS 54,PropReasonString
// "\SI\ACKc;n\160k\a\SUB\218r\171*\236\168",PropAssignedClientIdentifier "p$\150Q\174\199",PropAssignedClientIdentifier
// "\ACK\DLE\EOTC\146\161\130\145<\139hM\ETX\147\180\166\165\r\147\a\165t\254\156\178\188",PropMaximumPacketSize
// 29686,PropRetainAvailable 253,PropResponseTopic "*\135Z\155\139*H\NUL\152n\GS\EM\ETX\196\217"]}), _cleanSession =
// True, _keepAlive = 25664, _connID = "\GS\225\&4\DC4\182", _properties = [PropResponseInformation
// "\178\132\159",PropRequestResponseInformation 123,PropResponseTopic
// "\129\182\170\SOH\225l\227\163\169&\211\b\131|\216\182\234\168\&6\186\DC2\146",PropPayloadFormatIndicator
// 135,PropTopicAliasMaximum 18172,PropMaximumPacketSize 4275,PropReasonString
// "\179\187\181$DQ\SI5\246\185\130L",PropAuthenticationMethod ",\235\RS=f8\239\160",PropCorrelationData
// "\156\213L:8\192\216\174\228V\217\229\255i",PropSubscriptionIdentifier 25,PropUserProperty "\CAN\n\147\196\221"
// ">\193\151Y\177\f\248\DC1\191O",PropWildcardSubscriptionAvailable 198,PropTopicAliasMaximum
// 1330,PropSharedSubscriptionAvailable 56,PropTopicAliasMaximum 3080,PropSubscriptionIdentifier 29,PropReasonString
// "k\v\180x\237\SYN=\246w\248!D%",PropResponseTopic
// "\DC2\219\NUL\154\179O\174\136\r\175+\ENQ\196\244yf\\\180\183[",PropServerReference
// "\197<Z\225\253\168\f_\165",PropSubscriptionIdentifier 28,PropAssignedClientIdentifier
// "\211!x\223\212\161\ENQ\172\236[\241\233\183\"",PropSharedSubscriptionAvailable 171,PropWildcardSubscriptionAvailable
// 230,PropAuthenticationMethod "",PropAuthenticationMethod "\200\145vP!M",PropResponseInformation
// "d;",PropAssignedClientIdentifier "<\253\180\132\175\CAN\NAK\EMc\249\f}c\217p"]}
TEST(Connect5QCTest, Encode80) {
  uint8_t pkt[] = {
      0x10, 0xb2, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x64, 0x40, 0xe5, 0x1,  0x1a, 0x0,  0x3,  0xb2,
      0x84, 0x9f, 0x19, 0x7b, 0x8,  0x0,  0x16, 0x81, 0xb6, 0xaa, 0x1,  0xe1, 0x6c, 0xe3, 0xa3, 0xa9, 0x26, 0xd3, 0x8,
      0x83, 0x7c, 0xd8, 0xb6, 0xea, 0xa8, 0x36, 0xba, 0x12, 0x92, 0x1,  0x87, 0x22, 0x46, 0xfc, 0x27, 0x0,  0x0,  0x10,
      0xb3, 0x1f, 0x0,  0xc,  0xb3, 0xbb, 0xb5, 0x24, 0x44, 0x51, 0xf,  0x35, 0xf6, 0xb9, 0x82, 0x4c, 0x15, 0x0,  0x8,
      0x2c, 0xeb, 0x1e, 0x3d, 0x66, 0x38, 0xef, 0xa0, 0x9,  0x0,  0xe,  0x9c, 0xd5, 0x4c, 0x3a, 0x38, 0xc0, 0xd8, 0xae,
      0xe4, 0x56, 0xd9, 0xe5, 0xff, 0x69, 0xb,  0x19, 0x26, 0x0,  0x5,  0x18, 0xa,  0x93, 0xc4, 0xdd, 0x0,  0xa,  0x3e,
      0xc1, 0x97, 0x59, 0xb1, 0xc,  0xf8, 0x11, 0xbf, 0x4f, 0x28, 0xc6, 0x22, 0x5,  0x32, 0x2a, 0x38, 0x22, 0xc,  0x8,
      0xb,  0x1d, 0x1f, 0x0,  0xd,  0x6b, 0xb,  0xb4, 0x78, 0xed, 0x16, 0x3d, 0xf6, 0x77, 0xf8, 0x21, 0x44, 0x25, 0x8,
      0x0,  0x14, 0x12, 0xdb, 0x0,  0x9a, 0xb3, 0x4f, 0xae, 0x88, 0xd,  0xaf, 0x2b, 0x5,  0xc4, 0xf4, 0x79, 0x66, 0x5c,
      0xb4, 0xb7, 0x5b, 0x1c, 0x0,  0x9,  0xc5, 0x3c, 0x5a, 0xe1, 0xfd, 0xa8, 0xc,  0x5f, 0xa5, 0xb,  0x1c, 0x12, 0x0,
      0xe,  0xd3, 0x21, 0x78, 0xdf, 0xd4, 0xa1, 0x5,  0xac, 0xec, 0x5b, 0xf1, 0xe9, 0xb7, 0x22, 0x2a, 0xab, 0x28, 0xe6,
      0x15, 0x0,  0x0,  0x15, 0x0,  0x6,  0xc8, 0x91, 0x76, 0x50, 0x21, 0x4d, 0x1a, 0x0,  0x2,  0x64, 0x3b, 0x12, 0x0,
      0xf,  0x3c, 0xfd, 0xb4, 0x84, 0xaf, 0x18, 0x15, 0x19, 0x63, 0xf9, 0xc,  0x7d, 0x63, 0xd9, 0x70, 0x0,  0x5,  0x1d,
      0xe1, 0x34, 0x14, 0xb6, 0x71, 0x29, 0x80, 0x22, 0x5e, 0x4a, 0x21, 0x33, 0x13, 0x8,  0x0,  0x13, 0xb2, 0xec, 0x6a,
      0x7f, 0x9a, 0x5a, 0xfb, 0x2,  0x73, 0xc4, 0xa4, 0x4d, 0xab, 0x8c, 0x39, 0x47, 0xd2, 0xd4, 0xbb, 0x24, 0x36, 0x1f,
      0x0,  0xf,  0xf,  0x6,  0x63, 0x3b, 0x6e, 0xa0, 0x6b, 0x7,  0x1a, 0xda, 0x72, 0xab, 0x2a, 0xec, 0xa8, 0x12, 0x0,
      0x6,  0x70, 0x24, 0x96, 0x51, 0xae, 0xc7, 0x12, 0x0,  0x1a, 0x6,  0x10, 0x4,  0x43, 0x92, 0xa1, 0x82, 0x91, 0x3c,
      0x8b, 0x68, 0x4d, 0x3,  0x93, 0xb4, 0xa6, 0xa5, 0xd,  0x93, 0x7,  0xa5, 0x74, 0xfe, 0x9c, 0xb2, 0xbc, 0x27, 0x0,
      0x0,  0x73, 0xf6, 0x25, 0xfd, 0x8,  0x0,  0xf,  0x2a, 0x87, 0x5a, 0x9b, 0x8b, 0x2a, 0x48, 0x0,  0x98, 0x6e, 0x1d,
      0x19, 0x3,  0xc4, 0xd9, 0x0,  0x7,  0x91, 0x4b, 0xf8, 0xf2, 0xda, 0x8b, 0xcb, 0x0,  0xc,  0xa6, 0xfc, 0xf,  0xd7,
      0xb5, 0x0,  0x96, 0x64, 0x58, 0x37, 0xb2, 0xd2, 0x0,  0x16, 0x93, 0x7b, 0x27, 0x5a, 0xc0, 0x3f, 0x72, 0x38, 0x23,
      0x10, 0x55, 0xc0, 0xec, 0xa0, 0xed, 0x76, 0xc0, 0x70, 0x0,  0xab, 0x3b, 0x4,  0x0,  0x17, 0xa0, 0x4a, 0xca, 0xb9,
      0xac, 0x32, 0x99, 0xc8, 0x16, 0x7,  0x82, 0x6e, 0xb3, 0x85, 0x66, 0xcf, 0x35, 0xa,  0x38, 0xf5, 0xa,  0x90, 0xdc};

  uint8_t buf[447] = {0};

  uint8_t bytesprops0[] = {0xb2, 0x84, 0x9f};
  uint8_t bytesprops1[] = {0x81, 0xb6, 0xaa, 0x1,  0xe1, 0x6c, 0xe3, 0xa3, 0xa9, 0x26, 0xd3,
                           0x8,  0x83, 0x7c, 0xd8, 0xb6, 0xea, 0xa8, 0x36, 0xba, 0x12, 0x92};
  uint8_t bytesprops2[] = {0xb3, 0xbb, 0xb5, 0x24, 0x44, 0x51, 0xf, 0x35, 0xf6, 0xb9, 0x82, 0x4c};
  uint8_t bytesprops3[] = {0x2c, 0xeb, 0x1e, 0x3d, 0x66, 0x38, 0xef, 0xa0};
  uint8_t bytesprops4[] = {0x9c, 0xd5, 0x4c, 0x3a, 0x38, 0xc0, 0xd8, 0xae, 0xe4, 0x56, 0xd9, 0xe5, 0xff, 0x69};
  uint8_t bytesprops6[] = {0x3e, 0xc1, 0x97, 0x59, 0xb1, 0xc, 0xf8, 0x11, 0xbf, 0x4f};
  uint8_t bytesprops5[] = {0x18, 0xa, 0x93, 0xc4, 0xdd};
  uint8_t bytesprops7[] = {0x6b, 0xb, 0xb4, 0x78, 0xed, 0x16, 0x3d, 0xf6, 0x77, 0xf8, 0x21, 0x44, 0x25};
  uint8_t bytesprops8[] = {0x12, 0xdb, 0x0,  0x9a, 0xb3, 0x4f, 0xae, 0x88, 0xd,  0xaf,
                           0x2b, 0x5,  0xc4, 0xf4, 0x79, 0x66, 0x5c, 0xb4, 0xb7, 0x5b};
  uint8_t bytesprops9[] = {0xc5, 0x3c, 0x5a, 0xe1, 0xfd, 0xa8, 0xc, 0x5f, 0xa5};
  uint8_t bytesprops10[] = {0xd3, 0x21, 0x78, 0xdf, 0xd4, 0xa1, 0x5, 0xac, 0xec, 0x5b, 0xf1, 0xe9, 0xb7, 0x22};
  uint8_t bytesprops11[] = {0};
  uint8_t bytesprops12[] = {0xc8, 0x91, 0x76, 0x50, 0x21, 0x4d};
  uint8_t bytesprops13[] = {0x64, 0x3b};
  uint8_t bytesprops14[] = {0x3c, 0xfd, 0xb4, 0x84, 0xaf, 0x18, 0x15, 0x19, 0x63, 0xf9, 0xc, 0x7d, 0x63, 0xd9, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18172}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4275}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops5}, .v = {10, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1330}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3080}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops14}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb2, 0xec, 0x6a, 0x7f, 0x9a, 0x5a, 0xfb, 0x2,  0x73, 0xc4,
                               0xa4, 0x4d, 0xab, 0x8c, 0x39, 0x47, 0xd2, 0xd4, 0xbb};
  uint8_t byteswillprops1[] = {0xf, 0x6, 0x63, 0x3b, 0x6e, 0xa0, 0x6b, 0x7, 0x1a, 0xda, 0x72, 0xab, 0x2a, 0xec, 0xa8};
  uint8_t byteswillprops2[] = {0x70, 0x24, 0x96, 0x51, 0xae, 0xc7};
  uint8_t byteswillprops3[] = {0x6,  0x10, 0x4,  0x43, 0x92, 0xa1, 0x82, 0x91, 0x3c, 0x8b, 0x68, 0x4d, 0x3,
                               0x93, 0xb4, 0xa6, 0xa5, 0xd,  0x93, 0x7,  0xa5, 0x74, 0xfe, 0x9c, 0xb2, 0xbc};
  uint8_t byteswillprops4[] = {0x2a, 0x87, 0x5a, 0x9b, 0x8b, 0x2a, 0x48, 0x0, 0x98, 0x6e, 0x1d, 0x19, 0x3, 0xc4, 0xd9};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24138}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13075}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29686}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x91, 0x4b, 0xf8, 0xf2, 0xda, 0x8b, 0xcb};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa6, 0xfc, 0xf, 0xd7, 0xb5, 0x0, 0x96, 0x64, 0x58, 0x37, 0xb2, 0xd2};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25664;
  uint8_t client_id_bytes[] = {0x1d, 0xe1, 0x34, 0x14, 0xb6};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x93, 0x7b, 0x27, 0x5a, 0xc0, 0x3f, 0x72, 0x38, 0x23, 0x10, 0x55,
                              0xc0, 0xec, 0xa0, 0xed, 0x76, 0xc0, 0x70, 0x0,  0xab, 0x3b, 0x4};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa0, 0x4a, 0xca, 0xb9, 0xac, 0x32, 0x99, 0xc8, 0x16, 0x7,  0x82, 0x6e,
                              0xb3, 0x85, 0x66, 0xcf, 0x35, 0xa,  0x38, 0xf5, 0xa,  0x90, 0xdc};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\178\243\183\172\137\232\212\r~N\252\145\212h\230\DC1\144z}\209\&6\247\DLE\192iq",
// _password = Just "mU", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "A\148M\202\195\195\r\GS\240\235\193_b)\178\176\218-Z\176`\186\164\FSk\134\175", _willMsg =
// "4|gQ1\225\226&\214N\213\135\232\220Gm\242\172", _willProps = [PropResponseInformation
// "\t\141\142\ETX\169h%\157vj\150p\200\130\176ni\204E\222\193\160\247<",PropContentType
// "\223\189\184\153\ENQ\229\223\171Q",PropResponseTopic "O\215\219wp*\147J\f\157",PropSharedSubscriptionAvailable
// 148,PropResponseTopic
// "7\157s!\221&\a\150\n\141\204F\216q)H\137\243\208\161\213\ETXFA\198\217\143",PropAssignedClientIdentifier
// "\STX\188k\200\132\EM\DC3\201 CM\175[\149\SI\132\213\130",PropSubscriptionIdentifierAvailable
// 173,PropMaximumPacketSize 15844,PropContentType
// "WWB\231.\213\148\186\&6ET\255J\163\147\198\166J\161\US\176\211\225",PropMaximumQoS 196,PropMaximumPacketSize
// 16158,PropWillDelayInterval 21310,PropWillDelayInterval 18603,PropSubscriptionIdentifier 2,PropServerReference
// "(B\201",PropAssignedClientIdentifier "\NAK\209\154\201\145\r}*\191\136J\234L\199\230\142\247",PropCorrelationData "
// \193q\151~q-=4\STX",PropSharedSubscriptionAvailable 215,PropAssignedClientIdentifier "\200\192t\253\205\164i"]}),
// _cleanSession = True, _keepAlive = 1343, _connID = "\162\&4og*T\SYN\194c\EOT\129~z\215\170\t\a\172\172xu",
// _properties = [PropUserProperty "L\222j\239\"\153\DC2\187w\234 L\DEL\SOH\156\206\144\146r{|1\EM\179l;"
// "",PropPayloadFormatIndicator 6,PropPayloadFormatIndicator 128,PropMessageExpiryInterval
// 1766,PropAssignedClientIdentifier "\161\129\225\224",PropRequestProblemInformation 59,PropServerReference
// "\166\167\208>",PropContentType "^P\DLE',\232\240\&6\185\&9H\167\185\140\204_Oa5\174I\164\239\FS",PropUserProperty
// "\232\159\167FWQ\135\EM\148\193\143\a\187{\243\SYN\DC4\DEL\182\248" "\178/\227\250\209\206T",PropWillDelayInterval
// 17881,PropAuthenticationData "&\219\245^\244R\236d-?0\169\156\EOTp\US\190\227w",PropAssignedClientIdentifier
// "h",PropContentType "\200",PropReasonString
// "*\US\143\194$P\\\208\186^\193\v\f{\ENQ\ETB%\194",PropAssignedClientIdentifier "NLF\218\&7",PropServerKeepAlive
// 21484,PropMaximumPacketSize 12647,PropMaximumPacketSize 5652]}
TEST(Connect5QCTest, Encode81) {
  uint8_t pkt[] = {
      0x10, 0x87, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x5,  0x3f, 0xc0, 0x1,  0x26, 0x0,  0x1a, 0x4c,
      0xde, 0x6a, 0xef, 0x22, 0x99, 0x12, 0xbb, 0x77, 0xea, 0x20, 0x4c, 0x7f, 0x1,  0x9c, 0xce, 0x90, 0x92, 0x72, 0x7b,
      0x7c, 0x31, 0x19, 0xb3, 0x6c, 0x3b, 0x0,  0x0,  0x1,  0x6,  0x1,  0x80, 0x2,  0x0,  0x0,  0x6,  0xe6, 0x12, 0x0,
      0x4,  0xa1, 0x81, 0xe1, 0xe0, 0x17, 0x3b, 0x1c, 0x0,  0x4,  0xa6, 0xa7, 0xd0, 0x3e, 0x3,  0x0,  0x18, 0x5e, 0x50,
      0x10, 0x27, 0x2c, 0xe8, 0xf0, 0x36, 0xb9, 0x39, 0x48, 0xa7, 0xb9, 0x8c, 0xcc, 0x5f, 0x4f, 0x61, 0x35, 0xae, 0x49,
      0xa4, 0xef, 0x1c, 0x26, 0x0,  0x14, 0xe8, 0x9f, 0xa7, 0x46, 0x57, 0x51, 0x87, 0x19, 0x94, 0xc1, 0x8f, 0x7,  0xbb,
      0x7b, 0xf3, 0x16, 0x14, 0x7f, 0xb6, 0xf8, 0x0,  0x7,  0xb2, 0x2f, 0xe3, 0xfa, 0xd1, 0xce, 0x54, 0x18, 0x0,  0x0,
      0x45, 0xd9, 0x16, 0x0,  0x13, 0x26, 0xdb, 0xf5, 0x5e, 0xf4, 0x52, 0xec, 0x64, 0x2d, 0x3f, 0x30, 0xa9, 0x9c, 0x4,
      0x70, 0x1f, 0xbe, 0xe3, 0x77, 0x12, 0x0,  0x1,  0x68, 0x3,  0x0,  0x1,  0xc8, 0x1f, 0x0,  0x12, 0x2a, 0x1f, 0x8f,
      0xc2, 0x24, 0x50, 0x5c, 0xd0, 0xba, 0x5e, 0xc1, 0xb,  0xc,  0x7b, 0x5,  0x17, 0x25, 0xc2, 0x12, 0x0,  0x5,  0x4e,
      0x4c, 0x46, 0xda, 0x37, 0x13, 0x53, 0xec, 0x27, 0x0,  0x0,  0x31, 0x67, 0x27, 0x0,  0x0,  0x16, 0x14, 0x0,  0x15,
      0xa2, 0x34, 0x6f, 0x67, 0x2a, 0x54, 0x16, 0xc2, 0x63, 0x4,  0x81, 0x7e, 0x7a, 0xd7, 0xaa, 0x9,  0x7,  0xac, 0xac,
      0x78, 0x75, 0xd0, 0x1,  0x1a, 0x0,  0x18, 0x9,  0x8d, 0x8e, 0x3,  0xa9, 0x68, 0x25, 0x9d, 0x76, 0x6a, 0x96, 0x70,
      0xc8, 0x82, 0xb0, 0x6e, 0x69, 0xcc, 0x45, 0xde, 0xc1, 0xa0, 0xf7, 0x3c, 0x3,  0x0,  0x9,  0xdf, 0xbd, 0xb8, 0x99,
      0x5,  0xe5, 0xdf, 0xab, 0x51, 0x8,  0x0,  0xa,  0x4f, 0xd7, 0xdb, 0x77, 0x70, 0x2a, 0x93, 0x4a, 0xc,  0x9d, 0x2a,
      0x94, 0x8,  0x0,  0x1b, 0x37, 0x9d, 0x73, 0x21, 0xdd, 0x26, 0x7,  0x96, 0xa,  0x8d, 0xcc, 0x46, 0xd8, 0x71, 0x29,
      0x48, 0x89, 0xf3, 0xd0, 0xa1, 0xd5, 0x3,  0x46, 0x41, 0xc6, 0xd9, 0x8f, 0x12, 0x0,  0x12, 0x2,  0xbc, 0x6b, 0xc8,
      0x84, 0x19, 0x13, 0xc9, 0x20, 0x43, 0x4d, 0xaf, 0x5b, 0x95, 0xf,  0x84, 0xd5, 0x82, 0x29, 0xad, 0x27, 0x0,  0x0,
      0x3d, 0xe4, 0x3,  0x0,  0x17, 0x57, 0x57, 0x42, 0xe7, 0x2e, 0xd5, 0x94, 0xba, 0x36, 0x45, 0x54, 0xff, 0x4a, 0xa3,
      0x93, 0xc6, 0xa6, 0x4a, 0xa1, 0x1f, 0xb0, 0xd3, 0xe1, 0x24, 0xc4, 0x27, 0x0,  0x0,  0x3f, 0x1e, 0x18, 0x0,  0x0,
      0x53, 0x3e, 0x18, 0x0,  0x0,  0x48, 0xab, 0xb,  0x2,  0x1c, 0x0,  0x3,  0x28, 0x42, 0xc9, 0x12, 0x0,  0x11, 0x15,
      0xd1, 0x9a, 0xc9, 0x91, 0xd,  0x7d, 0x2a, 0xbf, 0x88, 0x4a, 0xea, 0x4c, 0xc7, 0xe6, 0x8e, 0xf7, 0x9,  0x0,  0xa,
      0x20, 0xc1, 0x71, 0x97, 0x7e, 0x71, 0x2d, 0x3d, 0x34, 0x2,  0x2a, 0xd7, 0x12, 0x0,  0x7,  0xc8, 0xc0, 0x74, 0xfd,
      0xcd, 0xa4, 0x69, 0x0,  0x1b, 0x41, 0x94, 0x4d, 0xca, 0xc3, 0xc3, 0xd,  0x1d, 0xf0, 0xeb, 0xc1, 0x5f, 0x62, 0x29,
      0xb2, 0xb0, 0xda, 0x2d, 0x5a, 0xb0, 0x60, 0xba, 0xa4, 0x1c, 0x6b, 0x86, 0xaf, 0x0,  0x12, 0x34, 0x7c, 0x67, 0x51,
      0x31, 0xe1, 0xe2, 0x26, 0xd6, 0x4e, 0xd5, 0x87, 0xe8, 0xdc, 0x47, 0x6d, 0xf2, 0xac, 0x0,  0x1b, 0x50, 0xb2, 0xf3,
      0xb7, 0xac, 0x89, 0xe8, 0xd4, 0xd,  0x7e, 0x4e, 0xfc, 0x91, 0xd4, 0x68, 0xe6, 0x11, 0x90, 0x7a, 0x7d, 0xd1, 0x36,
      0xf7, 0x10, 0xc0, 0x69, 0x71, 0x0,  0x2,  0x6d, 0x55};

  uint8_t buf[532] = {0};

  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0x4c, 0xde, 0x6a, 0xef, 0x22, 0x99, 0x12, 0xbb, 0x77, 0xea, 0x20, 0x4c, 0x7f,
                           0x1,  0x9c, 0xce, 0x90, 0x92, 0x72, 0x7b, 0x7c, 0x31, 0x19, 0xb3, 0x6c, 0x3b};
  uint8_t bytesprops2[] = {0xa1, 0x81, 0xe1, 0xe0};
  uint8_t bytesprops3[] = {0xa6, 0xa7, 0xd0, 0x3e};
  uint8_t bytesprops4[] = {0x5e, 0x50, 0x10, 0x27, 0x2c, 0xe8, 0xf0, 0x36, 0xb9, 0x39, 0x48, 0xa7,
                           0xb9, 0x8c, 0xcc, 0x5f, 0x4f, 0x61, 0x35, 0xae, 0x49, 0xa4, 0xef, 0x1c};
  uint8_t bytesprops6[] = {0xb2, 0x2f, 0xe3, 0xfa, 0xd1, 0xce, 0x54};
  uint8_t bytesprops5[] = {0xe8, 0x9f, 0xa7, 0x46, 0x57, 0x51, 0x87, 0x19, 0x94, 0xc1,
                           0x8f, 0x7,  0xbb, 0x7b, 0xf3, 0x16, 0x14, 0x7f, 0xb6, 0xf8};
  uint8_t bytesprops7[] = {0x26, 0xdb, 0xf5, 0x5e, 0xf4, 0x52, 0xec, 0x64, 0x2d, 0x3f,
                           0x30, 0xa9, 0x9c, 0x4,  0x70, 0x1f, 0xbe, 0xe3, 0x77};
  uint8_t bytesprops8[] = {0x68};
  uint8_t bytesprops9[] = {0xc8};
  uint8_t bytesprops10[] = {0x2a, 0x1f, 0x8f, 0xc2, 0x24, 0x50, 0x5c, 0xd0, 0xba,
                            0x5e, 0xc1, 0xb,  0xc,  0x7b, 0x5,  0x17, 0x25, 0xc2};
  uint8_t bytesprops11[] = {0x4e, 0x4c, 0x46, 0xda, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1766}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops5}, .v = {7, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17881}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21484}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12647}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5652}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9,  0x8d, 0x8e, 0x3,  0xa9, 0x68, 0x25, 0x9d, 0x76, 0x6a, 0x96, 0x70,
                               0xc8, 0x82, 0xb0, 0x6e, 0x69, 0xcc, 0x45, 0xde, 0xc1, 0xa0, 0xf7, 0x3c};
  uint8_t byteswillprops1[] = {0xdf, 0xbd, 0xb8, 0x99, 0x5, 0xe5, 0xdf, 0xab, 0x51};
  uint8_t byteswillprops2[] = {0x4f, 0xd7, 0xdb, 0x77, 0x70, 0x2a, 0x93, 0x4a, 0xc, 0x9d};
  uint8_t byteswillprops3[] = {0x37, 0x9d, 0x73, 0x21, 0xdd, 0x26, 0x7,  0x96, 0xa,  0x8d, 0xcc, 0x46, 0xd8, 0x71,
                               0x29, 0x48, 0x89, 0xf3, 0xd0, 0xa1, 0xd5, 0x3,  0x46, 0x41, 0xc6, 0xd9, 0x8f};
  uint8_t byteswillprops4[] = {0x2,  0xbc, 0x6b, 0xc8, 0x84, 0x19, 0x13, 0xc9, 0x20,
                               0x43, 0x4d, 0xaf, 0x5b, 0x95, 0xf,  0x84, 0xd5, 0x82};
  uint8_t byteswillprops5[] = {0x57, 0x57, 0x42, 0xe7, 0x2e, 0xd5, 0x94, 0xba, 0x36, 0x45, 0x54, 0xff,
                               0x4a, 0xa3, 0x93, 0xc6, 0xa6, 0x4a, 0xa1, 0x1f, 0xb0, 0xd3, 0xe1};
  uint8_t byteswillprops6[] = {0x28, 0x42, 0xc9};
  uint8_t byteswillprops7[] = {0x15, 0xd1, 0x9a, 0xc9, 0x91, 0xd,  0x7d, 0x2a, 0xbf,
                               0x88, 0x4a, 0xea, 0x4c, 0xc7, 0xe6, 0x8e, 0xf7};
  uint8_t byteswillprops8[] = {0x20, 0xc1, 0x71, 0x97, 0x7e, 0x71, 0x2d, 0x3d, 0x34, 0x2};
  uint8_t byteswillprops9[] = {0xc8, 0xc0, 0x74, 0xfd, 0xcd, 0xa4, 0x69};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15844}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16158}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21310}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18603}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x94, 0x4d, 0xca, 0xc3, 0xc3, 0xd,  0x1d, 0xf0, 0xeb, 0xc1, 0x5f, 0x62, 0x29,
                                0xb2, 0xb0, 0xda, 0x2d, 0x5a, 0xb0, 0x60, 0xba, 0xa4, 0x1c, 0x6b, 0x86, 0xaf};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x34, 0x7c, 0x67, 0x51, 0x31, 0xe1, 0xe2, 0x26, 0xd6,
                                  0x4e, 0xd5, 0x87, 0xe8, 0xdc, 0x47, 0x6d, 0xf2, 0xac};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1343;
  uint8_t client_id_bytes[] = {0xa2, 0x34, 0x6f, 0x67, 0x2a, 0x54, 0x16, 0xc2, 0x63, 0x4, 0x81,
                               0x7e, 0x7a, 0xd7, 0xaa, 0x9,  0x7,  0xac, 0xac, 0x78, 0x75};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xb2, 0xf3, 0xb7, 0xac, 0x89, 0xe8, 0xd4, 0xd,  0x7e, 0x4e, 0xfc, 0x91, 0xd4,
                              0x68, 0xe6, 0x11, 0x90, 0x7a, 0x7d, 0xd1, 0x36, 0xf7, 0x10, 0xc0, 0x69, 0x71};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d, 0x55};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\r)\190_\138\DC4\SO\163\226j\189
// ~*BN\SI\EOT-\217\128\232\223\239\129m\a\DLEG\254", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "+\177\246\187~\133", _willMsg = "\151\189\&3\RS\175\198\166j", _willProps = [PropMaximumQoS
// 180,PropTopicAliasMaximum 20703,PropWildcardSubscriptionAvailable 142,PropSessionExpiryInterval
// 30839,PropWillDelayInterval 31512,PropRetainAvailable 43,PropRetainAvailable 77,PropUserProperty
// "e4\213\v\167\ENQ\152\201\168c\173\vu>Zz\181\157\198d|\DC4"
// "\241\252\163\163\EOTrjN\250\160\168\161A\SYN\RS4#\240\156\185\164a\US\186",PropAssignedClientIdentifier
// "\160m\187",PropServerReference
// "\SI\199\200\139H\210)\223\223\146G\\\139\220\130\a~\192\EOT\ESC!\ENQ\172\234fW\249\129\GS",PropResponseTopic
// "\DC1M9\139\229\177\178\212\&83.LM{L\221\216\&5a\142\245\140",PropSharedSubscriptionAvailable 249,PropContentType
// "\201\190\ACK\ENQ\212\209T\247\178\&9p"]}), _cleanSession = False, _keepAlive = 4479, _connID =
// "\148\233\210e\EM\168\130\133\253\SOH\232\207f\173\220\238\167\166vG\v\141\190\";", _properties =
// [PropMessageExpiryInterval 8357,PropResponseInformation "\n>\141\228\180\153",PropMaximumQoS
// 233,PropSubscriptionIdentifierAvailable 51]}
TEST(Connect5QCTest, Encode82) {
  uint8_t pkt[] = {0x10, 0xe3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc,  0x11, 0x7f, 0x12, 0x2,  0x0,  0x0,
                   0x20, 0xa5, 0x1a, 0x0,  0x6,  0xa,  0x3e, 0x8d, 0xe4, 0xb4, 0x99, 0x24, 0xe9, 0x29, 0x33, 0x0,  0x19,
                   0x94, 0xe9, 0xd2, 0x65, 0x19, 0xa8, 0x82, 0x85, 0xfd, 0x1,  0xe8, 0xcf, 0x66, 0xad, 0xdc, 0xee, 0xa7,
                   0xa6, 0x76, 0x47, 0xb,  0x8d, 0xbe, 0x22, 0x3b, 0x97, 0x1,  0x24, 0xb4, 0x22, 0x50, 0xdf, 0x28, 0x8e,
                   0x11, 0x0,  0x0,  0x78, 0x77, 0x18, 0x0,  0x0,  0x7b, 0x18, 0x25, 0x2b, 0x25, 0x4d, 0x26, 0x0,  0x16,
                   0x65, 0x34, 0xd5, 0xb,  0xa7, 0x5,  0x98, 0xc9, 0xa8, 0x63, 0xad, 0xb,  0x75, 0x3e, 0x5a, 0x7a, 0xb5,
                   0x9d, 0xc6, 0x64, 0x7c, 0x14, 0x0,  0x18, 0xf1, 0xfc, 0xa3, 0xa3, 0x4,  0x72, 0x6a, 0x4e, 0xfa, 0xa0,
                   0xa8, 0xa1, 0x41, 0x16, 0x1e, 0x34, 0x23, 0xf0, 0x9c, 0xb9, 0xa4, 0x61, 0x1f, 0xba, 0x12, 0x0,  0x3,
                   0xa0, 0x6d, 0xbb, 0x1c, 0x0,  0x1d, 0xf,  0xc7, 0xc8, 0x8b, 0x48, 0xd2, 0x29, 0xdf, 0xdf, 0x92, 0x47,
                   0x5c, 0x8b, 0xdc, 0x82, 0x7,  0x7e, 0xc0, 0x4,  0x1b, 0x21, 0x5,  0xac, 0xea, 0x66, 0x57, 0xf9, 0x81,
                   0x1d, 0x8,  0x0,  0x16, 0x11, 0x4d, 0x39, 0x8b, 0xe5, 0xb1, 0xb2, 0xd4, 0x38, 0x33, 0x2e, 0x4c, 0x4d,
                   0x7b, 0x4c, 0xdd, 0xd8, 0x35, 0x61, 0x8e, 0xf5, 0x8c, 0x2a, 0xf9, 0x3,  0x0,  0xb,  0xc9, 0xbe, 0x6,
                   0x5,  0xd4, 0xd1, 0x54, 0xf7, 0xb2, 0x39, 0x70, 0x0,  0x6,  0x2b, 0xb1, 0xf6, 0xbb, 0x7e, 0x85, 0x0,
                   0x8,  0x97, 0xbd, 0x33, 0x1e, 0xaf, 0xc6, 0xa6, 0x6a};

  uint8_t buf[240] = {0};

  uint8_t bytesprops0[] = {0xa, 0x3e, 0x8d, 0xe4, 0xb4, 0x99};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8357}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 51}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xf1, 0xfc, 0xa3, 0xa3, 0x4,  0x72, 0x6a, 0x4e, 0xfa, 0xa0, 0xa8, 0xa1,
                               0x41, 0x16, 0x1e, 0x34, 0x23, 0xf0, 0x9c, 0xb9, 0xa4, 0x61, 0x1f, 0xba};
  uint8_t byteswillprops0[] = {0x65, 0x34, 0xd5, 0xb,  0xa7, 0x5,  0x98, 0xc9, 0xa8, 0x63, 0xad,
                               0xb,  0x75, 0x3e, 0x5a, 0x7a, 0xb5, 0x9d, 0xc6, 0x64, 0x7c, 0x14};
  uint8_t byteswillprops2[] = {0xa0, 0x6d, 0xbb};
  uint8_t byteswillprops3[] = {0xf, 0xc7, 0xc8, 0x8b, 0x48, 0xd2, 0x29, 0xdf, 0xdf, 0x92, 0x47, 0x5c, 0x8b, 0xdc, 0x82,
                               0x7, 0x7e, 0xc0, 0x4,  0x1b, 0x21, 0x5,  0xac, 0xea, 0x66, 0x57, 0xf9, 0x81, 0x1d};
  uint8_t byteswillprops4[] = {0x11, 0x4d, 0x39, 0x8b, 0xe5, 0xb1, 0xb2, 0xd4, 0x38, 0x33, 0x2e,
                               0x4c, 0x4d, 0x7b, 0x4c, 0xdd, 0xd8, 0x35, 0x61, 0x8e, 0xf5, 0x8c};
  uint8_t byteswillprops5[] = {0xc9, 0xbe, 0x6, 0x5, 0xd4, 0xd1, 0x54, 0xf7, 0xb2, 0x39, 0x70};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20703}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30839}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31512}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {22, (char*)&byteswillprops0}, .v = {24, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2b, 0xb1, 0xf6, 0xbb, 0x7e, 0x85};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0xbd, 0x33, 0x1e, 0xaf, 0xc6, 0xa6, 0x6a};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4479;
  uint8_t client_id_bytes[] = {0x94, 0xe9, 0xd2, 0x65, 0x19, 0xa8, 0x82, 0x85, 0xfd, 0x1,  0xe8, 0xcf, 0x66,
                               0xad, 0xdc, 0xee, 0xa7, 0xa6, 0x76, 0x47, 0xb,  0x8d, 0xbe, 0x22, 0x3b};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd,  0x29, 0xbe, 0x5f, 0x8a, 0x14, 0xe,  0xa3, 0xe2, 0x6a, 0xbd, 0x20, 0x7e, 0x2a, 0x42,
                              0x4e, 0xf,  0x4,  0x2d, 0xd9, 0x80, 0xe8, 0xdf, 0xef, 0x81, 0x6d, 0x7,  0x10, 0x47, 0xfe};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\193=\216", _password = Nothing, _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 20616, _connID = "H\197jy\150\206eUf&\224\&9\ACK", _properties = [PropMessageExpiryInterval
// 29488,PropSessionExpiryInterval 29737,PropResponseTopic
// "Ls5x<+3\252\&4\144\174\CAN6'\ENQ\239Ahs?\DLE[",PropSessionExpiryInterval 5430,PropSubscriptionIdentifierAvailable
// 227,PropReasonString "yKY\251\167me\234W\197M\201
// c\166\159\DC4\218\206/\132\151\203\DC1\238l\tF\192",PropSharedSubscriptionAvailable 99,PropResponseInformation
// "",PropSessionExpiryInterval 17158,PropContentType "N\220",PropTopicAlias 12265,PropSharedSubscriptionAvailable
// 66,PropRequestResponseInformation 71,PropContentType
// "\153\250\142\165\205PH\235\SOH\152\128o",PropResponseInformation
// "|\222\"SX\r\FS\153$\213\&5\ESCt=\235\143\SOcj\192\162\187j",PropMaximumQoS 134,PropMessageExpiryInterval
// 30799,PropServerKeepAlive 31360,PropAuthenticationMethod "\140\150\CAN\178\188\220\&5\r-\175",PropCorrelationData
// "\DC3\226",PropReceiveMaximum 31509]}
TEST(Connect5QCTest, Encode83) {
  uint8_t pkt[] = {0x10, 0xc8, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x50, 0x88, 0xa8, 0x1,  0x2,  0x0,
                   0x0,  0x73, 0x30, 0x11, 0x0,  0x0,  0x74, 0x29, 0x8,  0x0,  0x16, 0x4c, 0x73, 0x35, 0x78, 0x3c, 0x2b,
                   0x33, 0xfc, 0x34, 0x90, 0xae, 0x18, 0x36, 0x27, 0x5,  0xef, 0x41, 0x68, 0x73, 0x3f, 0x10, 0x5b, 0x11,
                   0x0,  0x0,  0x15, 0x36, 0x29, 0xe3, 0x1f, 0x0,  0x1d, 0x79, 0x4b, 0x59, 0xfb, 0xa7, 0x6d, 0x65, 0xea,
                   0x57, 0xc5, 0x4d, 0xc9, 0x20, 0x63, 0xa6, 0x9f, 0x14, 0xda, 0xce, 0x2f, 0x84, 0x97, 0xcb, 0x11, 0xee,
                   0x6c, 0x9,  0x46, 0xc0, 0x2a, 0x63, 0x1a, 0x0,  0x0,  0x11, 0x0,  0x0,  0x43, 0x6,  0x3,  0x0,  0x2,
                   0x4e, 0xdc, 0x23, 0x2f, 0xe9, 0x2a, 0x42, 0x19, 0x47, 0x3,  0x0,  0xc,  0x99, 0xfa, 0x8e, 0xa5, 0xcd,
                   0x50, 0x48, 0xeb, 0x1,  0x98, 0x80, 0x6f, 0x1a, 0x0,  0x17, 0x7c, 0xde, 0x22, 0x53, 0x58, 0xd,  0x1c,
                   0x99, 0x24, 0xd5, 0x35, 0x1b, 0x74, 0x3d, 0xeb, 0x8f, 0xe,  0x63, 0x6a, 0xc0, 0xa2, 0xbb, 0x6a, 0x24,
                   0x86, 0x2,  0x0,  0x0,  0x78, 0x4f, 0x13, 0x7a, 0x80, 0x15, 0x0,  0xa,  0x8c, 0x96, 0x18, 0xb2, 0xbc,
                   0xdc, 0x35, 0xd,  0x2d, 0xaf, 0x9,  0x0,  0x2,  0x13, 0xe2, 0x21, 0x7b, 0x15, 0x0,  0xd,  0x48, 0xc5,
                   0x6a, 0x79, 0x96, 0xce, 0x65, 0x55, 0x66, 0x26, 0xe0, 0x39, 0x6,  0x0,  0x3,  0xc1, 0x3d, 0xd8};

  uint8_t buf[213] = {0};

  uint8_t bytesprops0[] = {0x4c, 0x73, 0x35, 0x78, 0x3c, 0x2b, 0x33, 0xfc, 0x34, 0x90, 0xae,
                           0x18, 0x36, 0x27, 0x5,  0xef, 0x41, 0x68, 0x73, 0x3f, 0x10, 0x5b};
  uint8_t bytesprops1[] = {0x79, 0x4b, 0x59, 0xfb, 0xa7, 0x6d, 0x65, 0xea, 0x57, 0xc5, 0x4d, 0xc9, 0x20, 0x63, 0xa6,
                           0x9f, 0x14, 0xda, 0xce, 0x2f, 0x84, 0x97, 0xcb, 0x11, 0xee, 0x6c, 0x9,  0x46, 0xc0};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x4e, 0xdc};
  uint8_t bytesprops4[] = {0x99, 0xfa, 0x8e, 0xa5, 0xcd, 0x50, 0x48, 0xeb, 0x1, 0x98, 0x80, 0x6f};
  uint8_t bytesprops5[] = {0x7c, 0xde, 0x22, 0x53, 0x58, 0xd,  0x1c, 0x99, 0x24, 0xd5, 0x35, 0x1b,
                           0x74, 0x3d, 0xeb, 0x8f, 0xe,  0x63, 0x6a, 0xc0, 0xa2, 0xbb, 0x6a};
  uint8_t bytesprops6[] = {0x8c, 0x96, 0x18, 0xb2, 0xbc, 0xdc, 0x35, 0xd, 0x2d, 0xaf};
  uint8_t bytesprops7[] = {0x13, 0xe2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29488}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29737}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5430}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17158}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12265}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30799}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31360}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31509}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20616;
  uint8_t client_id_bytes[] = {0x48, 0xc5, 0x6a, 0x79, 0x96, 0xce, 0x65, 0x55, 0x66, 0x26, 0xe0, 0x39, 0x6};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc1, 0x3d, 0xd8};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\DLE\162\233\185\169\148\163\FS\DLE\DLE\EM\128\172$0\v\163\NAK\171\178o\152\247\162", _password = Just
// "\SYN)'\EMZ{&\170*\141\175\195\166\136\153%P\165\171Q\221Ps\200", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic =
// "\179j\234\186\173`\r5\139\224\166\231v\170\206~\241\ENQ7\249\230\240\135\&2\249\173ou\130", _willMsg =
// "\184\198C\184", _willProps = [PropSharedSubscriptionAvailable 97,PropReasonString
// "Qx\242(`\168?L\196\NUL\GS\199\&80\131\207*\205\155\&9%5",PropAuthenticationData "",PropTopicAlias
// 8045,PropServerKeepAlive 6785,PropResponseTopic
// "\165\244\r\164\209\238&\148\238\ETX\222}z\174\144\154@\203[\157\222",PropMaximumPacketSize
// 9028,PropPayloadFormatIndicator 201,PropTopicAliasMaximum 26182,PropSessionExpiryInterval
// 10590,PropSessionExpiryInterval 14802,PropAuthenticationData
// "HE\197Ob\t\129\189>\237\230.\185m\SUB3-\211G",PropRequestProblemInformation 135,PropReasonString
// "\219\255\142",PropReasonString "\t%UZ",PropUserProperty "\226" "",PropSessionExpiryInterval
// 18513,PropWildcardSubscriptionAvailable 239,PropMaximumPacketSize 21805]}), _cleanSession = True, _keepAlive = 23215,
// _connID = "'\ESC", _properties = [PropAuthenticationMethod
// "\198^NL]\DLEA(\NAKG+\195-\NAK\219h",PropRequestResponseInformation 124,PropWillDelayInterval
// 1971,PropWildcardSubscriptionAvailable 130,PropMaximumPacketSize 1315,PropSubscriptionIdentifier
// 22,PropAuthenticationData "\163\244\181\255\217\157\198`\DC4\144",PropMaximumQoS 80,PropTopicAliasMaximum
// 9708,PropSessionExpiryInterval 9993,PropReasonString "\DC1",PropMaximumPacketSize 26296,PropSessionExpiryInterval
// 6407,PropSharedSubscriptionAvailable 177,PropCorrelationData
// "\151\193\187\168\"W\163\128\169\SUBx\FS\148k{\176",PropReceiveMaximum 30173,PropReasonString
// "\199\186",PropResponseInformation "]-\182\240\167\SUB\153\174<\CAN\FS\NAK\136+H\204\128#",PropServerReference
// "\187>\224\253\SOH\SOH\140\218\f\ACK",PropTopicAliasMaximum 32410,PropResponseInformation
// ":G\150\STX",PropSharedSubscriptionAvailable 32,PropMaximumPacketSize 3674,PropMessageExpiryInterval 7003]}
TEST(Connect5QCTest, Encode84) {
  uint8_t pkt[] = {
      0x10, 0x8f, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x5a, 0xaf, 0x9d, 0x1,  0x15, 0x0,  0x10, 0xc6,
      0x5e, 0x4e, 0x4c, 0x5d, 0x10, 0x41, 0x28, 0x15, 0x47, 0x2b, 0xc3, 0x2d, 0x15, 0xdb, 0x68, 0x19, 0x7c, 0x18, 0x0,
      0x0,  0x7,  0xb3, 0x28, 0x82, 0x27, 0x0,  0x0,  0x5,  0x23, 0xb,  0x16, 0x16, 0x0,  0xa,  0xa3, 0xf4, 0xb5, 0xff,
      0xd9, 0x9d, 0xc6, 0x60, 0x14, 0x90, 0x24, 0x50, 0x22, 0x25, 0xec, 0x11, 0x0,  0x0,  0x27, 0x9,  0x1f, 0x0,  0x1,
      0x11, 0x27, 0x0,  0x0,  0x66, 0xb8, 0x11, 0x0,  0x0,  0x19, 0x7,  0x2a, 0xb1, 0x9,  0x0,  0x10, 0x97, 0xc1, 0xbb,
      0xa8, 0x22, 0x57, 0xa3, 0x80, 0xa9, 0x1a, 0x78, 0x1c, 0x94, 0x6b, 0x7b, 0xb0, 0x21, 0x75, 0xdd, 0x1f, 0x0,  0x2,
      0xc7, 0xba, 0x1a, 0x0,  0x12, 0x5d, 0x2d, 0xb6, 0xf0, 0xa7, 0x1a, 0x99, 0xae, 0x3c, 0x18, 0x1c, 0x15, 0x88, 0x2b,
      0x48, 0xcc, 0x80, 0x23, 0x1c, 0x0,  0xa,  0xbb, 0x3e, 0xe0, 0xfd, 0x1,  0x1,  0x8c, 0xda, 0xc,  0x6,  0x22, 0x7e,
      0x9a, 0x1a, 0x0,  0x4,  0x3a, 0x47, 0x96, 0x2,  0x2a, 0x20, 0x27, 0x0,  0x0,  0xe,  0x5a, 0x2,  0x0,  0x0,  0x1b,
      0x5b, 0x0,  0x2,  0x27, 0x1b, 0x87, 0x1,  0x2a, 0x61, 0x1f, 0x0,  0x16, 0x51, 0x78, 0xf2, 0x28, 0x60, 0xa8, 0x3f,
      0x4c, 0xc4, 0x0,  0x1d, 0xc7, 0x38, 0x30, 0x83, 0xcf, 0x2a, 0xcd, 0x9b, 0x39, 0x25, 0x35, 0x16, 0x0,  0x0,  0x23,
      0x1f, 0x6d, 0x13, 0x1a, 0x81, 0x8,  0x0,  0x15, 0xa5, 0xf4, 0xd,  0xa4, 0xd1, 0xee, 0x26, 0x94, 0xee, 0x3,  0xde,
      0x7d, 0x7a, 0xae, 0x90, 0x9a, 0x40, 0xcb, 0x5b, 0x9d, 0xde, 0x27, 0x0,  0x0,  0x23, 0x44, 0x1,  0xc9, 0x22, 0x66,
      0x46, 0x11, 0x0,  0x0,  0x29, 0x5e, 0x11, 0x0,  0x0,  0x39, 0xd2, 0x16, 0x0,  0x13, 0x48, 0x45, 0xc5, 0x4f, 0x62,
      0x9,  0x81, 0xbd, 0x3e, 0xed, 0xe6, 0x2e, 0xb9, 0x6d, 0x1a, 0x33, 0x2d, 0xd3, 0x47, 0x17, 0x87, 0x1f, 0x0,  0x3,
      0xdb, 0xff, 0x8e, 0x1f, 0x0,  0x4,  0x9,  0x25, 0x55, 0x5a, 0x26, 0x0,  0x1,  0xe2, 0x0,  0x0,  0x11, 0x0,  0x0,
      0x48, 0x51, 0x28, 0xef, 0x27, 0x0,  0x0,  0x55, 0x2d, 0x0,  0x1d, 0xb3, 0x6a, 0xea, 0xba, 0xad, 0x60, 0xd,  0x35,
      0x8b, 0xe0, 0xa6, 0xe7, 0x76, 0xaa, 0xce, 0x7e, 0xf1, 0x5,  0x37, 0xf9, 0xe6, 0xf0, 0x87, 0x32, 0xf9, 0xad, 0x6f,
      0x75, 0x82, 0x0,  0x4,  0xb8, 0xc6, 0x43, 0xb8, 0x0,  0x18, 0x10, 0xa2, 0xe9, 0xb9, 0xa9, 0x94, 0xa3, 0x1c, 0x10,
      0x10, 0x19, 0x80, 0xac, 0x24, 0x30, 0xb,  0xa3, 0x15, 0xab, 0xb2, 0x6f, 0x98, 0xf7, 0xa2, 0x0,  0x18, 0x16, 0x29,
      0x27, 0x19, 0x5a, 0x7b, 0x26, 0xaa, 0x2a, 0x8d, 0xaf, 0xc3, 0xa6, 0x88, 0x99, 0x25, 0x50, 0xa5, 0xab, 0x51, 0xdd,
      0x50, 0x73, 0xc8};

  uint8_t buf[412] = {0};

  uint8_t bytesprops0[] = {0xc6, 0x5e, 0x4e, 0x4c, 0x5d, 0x10, 0x41, 0x28,
                           0x15, 0x47, 0x2b, 0xc3, 0x2d, 0x15, 0xdb, 0x68};
  uint8_t bytesprops1[] = {0xa3, 0xf4, 0xb5, 0xff, 0xd9, 0x9d, 0xc6, 0x60, 0x14, 0x90};
  uint8_t bytesprops2[] = {0x11};
  uint8_t bytesprops3[] = {0x97, 0xc1, 0xbb, 0xa8, 0x22, 0x57, 0xa3, 0x80,
                           0xa9, 0x1a, 0x78, 0x1c, 0x94, 0x6b, 0x7b, 0xb0};
  uint8_t bytesprops4[] = {0xc7, 0xba};
  uint8_t bytesprops5[] = {0x5d, 0x2d, 0xb6, 0xf0, 0xa7, 0x1a, 0x99, 0xae, 0x3c,
                           0x18, 0x1c, 0x15, 0x88, 0x2b, 0x48, 0xcc, 0x80, 0x23};
  uint8_t bytesprops6[] = {0xbb, 0x3e, 0xe0, 0xfd, 0x1, 0x1, 0x8c, 0xda, 0xc, 0x6};
  uint8_t bytesprops7[] = {0x3a, 0x47, 0x96, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1971}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1315}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9708}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9993}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26296}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6407}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30173}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32410}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3674}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7003}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x51, 0x78, 0xf2, 0x28, 0x60, 0xa8, 0x3f, 0x4c, 0xc4, 0x0,  0x1d,
                               0xc7, 0x38, 0x30, 0x83, 0xcf, 0x2a, 0xcd, 0x9b, 0x39, 0x25, 0x35};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0xa5, 0xf4, 0xd,  0xa4, 0xd1, 0xee, 0x26, 0x94, 0xee, 0x3, 0xde,
                               0x7d, 0x7a, 0xae, 0x90, 0x9a, 0x40, 0xcb, 0x5b, 0x9d, 0xde};
  uint8_t byteswillprops3[] = {0x48, 0x45, 0xc5, 0x4f, 0x62, 0x9,  0x81, 0xbd, 0x3e, 0xed,
                               0xe6, 0x2e, 0xb9, 0x6d, 0x1a, 0x33, 0x2d, 0xd3, 0x47};
  uint8_t byteswillprops4[] = {0xdb, 0xff, 0x8e};
  uint8_t byteswillprops5[] = {0x9, 0x25, 0x55, 0x5a};
  uint8_t byteswillprops7[] = {0};
  uint8_t byteswillprops6[] = {0xe2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8045}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6785}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9028}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26182}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10590}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14802}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {1, (char*)&byteswillprops6}, .v = {0, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18513}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21805}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb3, 0x6a, 0xea, 0xba, 0xad, 0x60, 0xd,  0x35, 0x8b, 0xe0,
                                0xa6, 0xe7, 0x76, 0xaa, 0xce, 0x7e, 0xf1, 0x5,  0x37, 0xf9,
                                0xe6, 0xf0, 0x87, 0x32, 0xf9, 0xad, 0x6f, 0x75, 0x82};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb8, 0xc6, 0x43, 0xb8};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23215;
  uint8_t client_id_bytes[] = {0x27, 0x1b};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x10, 0xa2, 0xe9, 0xb9, 0xa9, 0x94, 0xa3, 0x1c, 0x10, 0x10, 0x19, 0x80,
                              0xac, 0x24, 0x30, 0xb,  0xa3, 0x15, 0xab, 0xb2, 0x6f, 0x98, 0xf7, 0xa2};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x16, 0x29, 0x27, 0x19, 0x5a, 0x7b, 0x26, 0xaa, 0x2a, 0x8d, 0xaf, 0xc3,
                              0xa6, 0x88, 0x99, 0x25, 0x50, 0xa5, 0xab, 0x51, 0xdd, 0x50, 0x73, 0xc8};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\214", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\162\190\DC4\DC4\rt\172-\134\146\171Y\SUB\181GJ\232\223", _willMsg = "", _willProps =
// [PropMessageExpiryInterval 2668,PropContentType
// "a\250\155\193\222\253\221\130d\151\&2\195;-\128G\DC4\231\ACK^-\232w\194\236\DEL\212",PropRequestResponseInformation
// 218,PropMessageExpiryInterval 20814,PropMaximumPacketSize 24455,PropWildcardSubscriptionAvailable
// 17,PropMessageExpiryInterval 27712]}), _cleanSession = False, _keepAlive = 3268, _connID =
// "X\ENQ\249\146\ti\193j\128\159\242\ACK\200\143\vTWH]\156\DEL", _properties = [PropServerKeepAlive
// 13392,PropResponseInformation
// "\185C\227'\DEL\ACK\b$\244\219\252\254\STX\191\209Hs\EOT\STX^5\132",PropSessionExpiryInterval 7071,PropMaximumQoS
// 91,PropRequestProblemInformation 198,PropContentType
// "\133^6\183^\198\143l\rrA\DC4\SOC\130t+\SYN9",PropTopicAliasMaximum 24597,PropSessionExpiryInterval
// 25612,PropTopicAliasMaximum 13004,PropWildcardSubscriptionAvailable 179,PropCorrelationData
// "\144\244l\RSl]\206\134\RS\156}6Aq\197\197\SIp\188\249\173B\223w\141\142\DC4\219\199\178",PropReceiveMaximum
// 31787,PropMessageExpiryInterval 6868,PropWildcardSubscriptionAvailable 8,PropAuthenticationData
// "@\236\171\225\232L\159e\157\a\250[\192\230\167\r\140\128\137sY\138\t9a3\EM",PropSessionExpiryInterval
// 23555,PropMessageExpiryInterval 25043,PropResponseTopic "\251T4=\145",PropAssignedClientIdentifier
// "\133\141\166\f\137\"\214\212\156\GS#cD\235j\229$\251\228\FS",PropRetainAvailable
// 151,PropSubscriptionIdentifierAvailable 152,PropServerReference
// "7t\213$V\174\208\143\143.\197\156@\SUB\247\233,3[L\NUL\236\152",PropCorrelationData "",PropMessageExpiryInterval
// 12365,PropRequestProblemInformation 44]}
TEST(Connect5QCTest, Encode85) {
  uint8_t pkt[] = {
      0x10, 0xd2, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x24, 0xc,  0xc4, 0xe2, 0x1,  0x13, 0x34, 0x50, 0x1a,
      0x0,  0x16, 0xb9, 0x43, 0xe3, 0x27, 0x7f, 0x6,  0x8,  0x24, 0xf4, 0xdb, 0xfc, 0xfe, 0x2,  0xbf, 0xd1, 0x48, 0x73,
      0x4,  0x2,  0x5e, 0x35, 0x84, 0x11, 0x0,  0x0,  0x1b, 0x9f, 0x24, 0x5b, 0x17, 0xc6, 0x3,  0x0,  0x13, 0x85, 0x5e,
      0x36, 0xb7, 0x5e, 0xc6, 0x8f, 0x6c, 0xd,  0x72, 0x41, 0x14, 0xe,  0x43, 0x82, 0x74, 0x2b, 0x16, 0x39, 0x22, 0x60,
      0x15, 0x11, 0x0,  0x0,  0x64, 0xc,  0x22, 0x32, 0xcc, 0x28, 0xb3, 0x9,  0x0,  0x1e, 0x90, 0xf4, 0x6c, 0x1e, 0x6c,
      0x5d, 0xce, 0x86, 0x1e, 0x9c, 0x7d, 0x36, 0x41, 0x71, 0xc5, 0xc5, 0xf,  0x70, 0xbc, 0xf9, 0xad, 0x42, 0xdf, 0x77,
      0x8d, 0x8e, 0x14, 0xdb, 0xc7, 0xb2, 0x21, 0x7c, 0x2b, 0x2,  0x0,  0x0,  0x1a, 0xd4, 0x28, 0x8,  0x16, 0x0,  0x1b,
      0x40, 0xec, 0xab, 0xe1, 0xe8, 0x4c, 0x9f, 0x65, 0x9d, 0x7,  0xfa, 0x5b, 0xc0, 0xe6, 0xa7, 0xd,  0x8c, 0x80, 0x89,
      0x73, 0x59, 0x8a, 0x9,  0x39, 0x61, 0x33, 0x19, 0x11, 0x0,  0x0,  0x5c, 0x3,  0x2,  0x0,  0x0,  0x61, 0xd3, 0x8,
      0x0,  0x5,  0xfb, 0x54, 0x34, 0x3d, 0x91, 0x12, 0x0,  0x14, 0x85, 0x8d, 0xa6, 0xc,  0x89, 0x22, 0xd6, 0xd4, 0x9c,
      0x1d, 0x23, 0x63, 0x44, 0xeb, 0x6a, 0xe5, 0x24, 0xfb, 0xe4, 0x1c, 0x25, 0x97, 0x29, 0x98, 0x1c, 0x0,  0x17, 0x37,
      0x74, 0xd5, 0x24, 0x56, 0xae, 0xd0, 0x8f, 0x8f, 0x2e, 0xc5, 0x9c, 0x40, 0x1a, 0xf7, 0xe9, 0x2c, 0x33, 0x5b, 0x4c,
      0x0,  0xec, 0x98, 0x9,  0x0,  0x0,  0x2,  0x0,  0x0,  0x30, 0x4d, 0x17, 0x2c, 0x0,  0x15, 0x58, 0x5,  0xf9, 0x92,
      0x9,  0x69, 0xc1, 0x6a, 0x80, 0x9f, 0xf2, 0x6,  0xc8, 0x8f, 0xb,  0x54, 0x57, 0x48, 0x5d, 0x9c, 0x7f, 0x36, 0x2,
      0x0,  0x0,  0xa,  0x6c, 0x3,  0x0,  0x1b, 0x61, 0xfa, 0x9b, 0xc1, 0xde, 0xfd, 0xdd, 0x82, 0x64, 0x97, 0x32, 0xc3,
      0x3b, 0x2d, 0x80, 0x47, 0x14, 0xe7, 0x6,  0x5e, 0x2d, 0xe8, 0x77, 0xc2, 0xec, 0x7f, 0xd4, 0x19, 0xda, 0x2,  0x0,
      0x0,  0x51, 0x4e, 0x27, 0x0,  0x0,  0x5f, 0x87, 0x28, 0x11, 0x2,  0x0,  0x0,  0x6c, 0x40, 0x0,  0x12, 0xa2, 0xbe,
      0x14, 0x14, 0xd,  0x74, 0xac, 0x2d, 0x86, 0x92, 0xab, 0x59, 0x1a, 0xb5, 0x47, 0x4a, 0xe8, 0xdf, 0x0,  0x0};

  uint8_t buf[351] = {0};

  uint8_t bytesprops0[] = {0xb9, 0x43, 0xe3, 0x27, 0x7f, 0x6,  0x8, 0x24, 0xf4, 0xdb, 0xfc,
                           0xfe, 0x2,  0xbf, 0xd1, 0x48, 0x73, 0x4, 0x2,  0x5e, 0x35, 0x84};
  uint8_t bytesprops1[] = {0x85, 0x5e, 0x36, 0xb7, 0x5e, 0xc6, 0x8f, 0x6c, 0xd, 0x72,
                           0x41, 0x14, 0xe,  0x43, 0x82, 0x74, 0x2b, 0x16, 0x39};
  uint8_t bytesprops2[] = {0x90, 0xf4, 0x6c, 0x1e, 0x6c, 0x5d, 0xce, 0x86, 0x1e, 0x9c, 0x7d, 0x36, 0x41, 0x71, 0xc5,
                           0xc5, 0xf,  0x70, 0xbc, 0xf9, 0xad, 0x42, 0xdf, 0x77, 0x8d, 0x8e, 0x14, 0xdb, 0xc7, 0xb2};
  uint8_t bytesprops3[] = {0x40, 0xec, 0xab, 0xe1, 0xe8, 0x4c, 0x9f, 0x65, 0x9d, 0x7,  0xfa, 0x5b, 0xc0, 0xe6,
                           0xa7, 0xd,  0x8c, 0x80, 0x89, 0x73, 0x59, 0x8a, 0x9,  0x39, 0x61, 0x33, 0x19};
  uint8_t bytesprops4[] = {0xfb, 0x54, 0x34, 0x3d, 0x91};
  uint8_t bytesprops5[] = {0x85, 0x8d, 0xa6, 0xc,  0x89, 0x22, 0xd6, 0xd4, 0x9c, 0x1d,
                           0x23, 0x63, 0x44, 0xeb, 0x6a, 0xe5, 0x24, 0xfb, 0xe4, 0x1c};
  uint8_t bytesprops6[] = {0x37, 0x74, 0xd5, 0x24, 0x56, 0xae, 0xd0, 0x8f, 0x8f, 0x2e, 0xc5, 0x9c,
                           0x40, 0x1a, 0xf7, 0xe9, 0x2c, 0x33, 0x5b, 0x4c, 0x0,  0xec, 0x98};
  uint8_t bytesprops7[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13392}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7071}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24597}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25612}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13004}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31787}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6868}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23555}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25043}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12365}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 44}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x61, 0xfa, 0x9b, 0xc1, 0xde, 0xfd, 0xdd, 0x82, 0x64, 0x97, 0x32, 0xc3, 0x3b, 0x2d,
                               0x80, 0x47, 0x14, 0xe7, 0x6,  0x5e, 0x2d, 0xe8, 0x77, 0xc2, 0xec, 0x7f, 0xd4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2668}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20814}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24455}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27712}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa2, 0xbe, 0x14, 0x14, 0xd,  0x74, 0xac, 0x2d, 0x86,
                                0x92, 0xab, 0x59, 0x1a, 0xb5, 0x47, 0x4a, 0xe8, 0xdf};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3268;
  uint8_t client_id_bytes[] = {0x58, 0x5,  0xf9, 0x92, 0x9,  0x69, 0xc1, 0x6a, 0x80, 0x9f, 0xf2,
                               0x6,  0xc8, 0x8f, 0xb,  0x54, 0x57, 0x48, 0x5d, 0x9c, 0x7f};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xd6};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// ")\156AQ\231\191\SYN\185h\225\178\137\238\&3\EOT\138\248\&7R\EM,*\SYN=\n\224\DC2", _lastWill = Nothing, _cleanSession
// = True, _keepAlive = 28678, _connID =
// "\189\132\188/]\224s+\NULTF\196\233U\GS\250L\167\176\EM\133\NUL\254\161Ol\136\162\209", _properties =
// [PropReceiveMaximum 15858,PropServerReference "",PropAuthenticationData
// "\207\177<\220\196Y\170\EM\208\204o",PropCorrelationData
// "J\DEL\175\233\219\227\204\&3\175\CANF\246\182\146\163Y\214\133\\\SI\190\226\234\f\135`Ey",PropResponseInformation
// "k\SYN\188t\231\r;\221\142.\137\DLE\NAK \197E\181\248\178",PropPayloadFormatIndicator 44,PropUserProperty
// "\t\182\149\164B\132;\187\215\201\SO\ACK\194j" "0b",PropTopicAliasMaximum 19404,PropMessageExpiryInterval
// 32432,PropTopicAliasMaximum 21496,PropSharedSubscriptionAvailable 216,PropWillDelayInterval
// 24641,PropAuthenticationMethod "\145\217\155\157",PropResponseTopic
// "\SYN/\143\DC1(l#\187\242\242\DC4P0",PropAuthenticationData "\190\235-",PropMaximumPacketSize
// 19451,PropServerReference "\175\207\a.\NAK\246",PropResponseTopic
// "\SUB\NAK\211\161f\DC2\179\238H6\157\145\247\130OgP*\NULw\212.\199&\224\145\242\231\145\205"]}
TEST(Connect5QCTest, Encode86) {
  uint8_t pkt[] = {0x10, 0xe9, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x70, 0x6,  0xbe, 0x1,  0x21, 0x3d,
                   0xf2, 0x1c, 0x0,  0x0,  0x16, 0x0,  0xb,  0xcf, 0xb1, 0x3c, 0xdc, 0xc4, 0x59, 0xaa, 0x19, 0xd0, 0xcc,
                   0x6f, 0x9,  0x0,  0x1c, 0x4a, 0x7f, 0xaf, 0xe9, 0xdb, 0xe3, 0xcc, 0x33, 0xaf, 0x18, 0x46, 0xf6, 0xb6,
                   0x92, 0xa3, 0x59, 0xd6, 0x85, 0x5c, 0xf,  0xbe, 0xe2, 0xea, 0xc,  0x87, 0x60, 0x45, 0x79, 0x1a, 0x0,
                   0x13, 0x6b, 0x16, 0xbc, 0x74, 0xe7, 0xd,  0x3b, 0xdd, 0x8e, 0x2e, 0x89, 0x10, 0x15, 0x20, 0xc5, 0x45,
                   0xb5, 0xf8, 0xb2, 0x1,  0x2c, 0x26, 0x0,  0xe,  0x9,  0xb6, 0x95, 0xa4, 0x42, 0x84, 0x3b, 0xbb, 0xd7,
                   0xc9, 0xe,  0x6,  0xc2, 0x6a, 0x0,  0x2,  0x30, 0x62, 0x22, 0x4b, 0xcc, 0x2,  0x0,  0x0,  0x7e, 0xb0,
                   0x22, 0x53, 0xf8, 0x2a, 0xd8, 0x18, 0x0,  0x0,  0x60, 0x41, 0x15, 0x0,  0x4,  0x91, 0xd9, 0x9b, 0x9d,
                   0x8,  0x0,  0xd,  0x16, 0x2f, 0x8f, 0x11, 0x28, 0x6c, 0x23, 0xbb, 0xf2, 0xf2, 0x14, 0x50, 0x30, 0x16,
                   0x0,  0x3,  0xbe, 0xeb, 0x2d, 0x27, 0x0,  0x0,  0x4b, 0xfb, 0x1c, 0x0,  0x6,  0xaf, 0xcf, 0x7,  0x2e,
                   0x15, 0xf6, 0x8,  0x0,  0x1e, 0x1a, 0x15, 0xd3, 0xa1, 0x66, 0x12, 0xb3, 0xee, 0x48, 0x36, 0x9d, 0x91,
                   0xf7, 0x82, 0x4f, 0x67, 0x50, 0x2a, 0x0,  0x77, 0xd4, 0x2e, 0xc7, 0x26, 0xe0, 0x91, 0xf2, 0xe7, 0x91,
                   0xcd, 0x0,  0x1d, 0xbd, 0x84, 0xbc, 0x2f, 0x5d, 0xe0, 0x73, 0x2b, 0x0,  0x54, 0x46, 0xc4, 0xe9, 0x55,
                   0x1d, 0xfa, 0x4c, 0xa7, 0xb0, 0x19, 0x85, 0x0,  0xfe, 0xa1, 0x4f, 0x6c, 0x88, 0xa2, 0xd1};

  uint8_t buf[246] = {0};

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xcf, 0xb1, 0x3c, 0xdc, 0xc4, 0x59, 0xaa, 0x19, 0xd0, 0xcc, 0x6f};
  uint8_t bytesprops2[] = {0x4a, 0x7f, 0xaf, 0xe9, 0xdb, 0xe3, 0xcc, 0x33, 0xaf, 0x18, 0x46, 0xf6, 0xb6, 0x92,
                           0xa3, 0x59, 0xd6, 0x85, 0x5c, 0xf,  0xbe, 0xe2, 0xea, 0xc,  0x87, 0x60, 0x45, 0x79};
  uint8_t bytesprops3[] = {0x6b, 0x16, 0xbc, 0x74, 0xe7, 0xd,  0x3b, 0xdd, 0x8e, 0x2e,
                           0x89, 0x10, 0x15, 0x20, 0xc5, 0x45, 0xb5, 0xf8, 0xb2};
  uint8_t bytesprops5[] = {0x30, 0x62};
  uint8_t bytesprops4[] = {0x9, 0xb6, 0x95, 0xa4, 0x42, 0x84, 0x3b, 0xbb, 0xd7, 0xc9, 0xe, 0x6, 0xc2, 0x6a};
  uint8_t bytesprops6[] = {0x91, 0xd9, 0x9b, 0x9d};
  uint8_t bytesprops7[] = {0x16, 0x2f, 0x8f, 0x11, 0x28, 0x6c, 0x23, 0xbb, 0xf2, 0xf2, 0x14, 0x50, 0x30};
  uint8_t bytesprops8[] = {0xbe, 0xeb, 0x2d};
  uint8_t bytesprops9[] = {0xaf, 0xcf, 0x7, 0x2e, 0x15, 0xf6};
  uint8_t bytesprops10[] = {0x1a, 0x15, 0xd3, 0xa1, 0x66, 0x12, 0xb3, 0xee, 0x48, 0x36, 0x9d, 0x91, 0xf7, 0x82, 0x4f,
                            0x67, 0x50, 0x2a, 0x0,  0x77, 0xd4, 0x2e, 0xc7, 0x26, 0xe0, 0x91, 0xf2, 0xe7, 0x91, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15858}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19404}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32432}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21496}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24641}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19451}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28678;
  uint8_t client_id_bytes[] = {0xbd, 0x84, 0xbc, 0x2f, 0x5d, 0xe0, 0x73, 0x2b, 0x0,  0x54, 0x46, 0xc4, 0xe9, 0x55, 0x1d,
                               0xfa, 0x4c, 0xa7, 0xb0, 0x19, 0x85, 0x0,  0xfe, 0xa1, 0x4f, 0x6c, 0x88, 0xa2, 0xd1};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x29, 0x9c, 0x41, 0x51, 0xe7, 0xbf, 0x16, 0xb9, 0x68, 0xe1, 0xb2, 0x89, 0xee, 0x33,
                              0x4,  0x8a, 0xf8, 0x37, 0x52, 0x19, 0x2c, 0x2a, 0x16, 0x3d, 0xa,  0xe0, 0x12};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\231\136\157", _password = Nothing, _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 27015, _connID = "c\202.c\142W#U\130p\148q(O\219m", _properties = [PropTopicAliasMaximum
// 1328,PropSharedSubscriptionAvailable 102,PropTopicAliasMaximum 18059,PropTopicAlias 15044,PropContentType
// "\t\138k\190\169",PropMaximumPacketSize 20110,PropAuthenticationData
// "2q\166o\171\206aJ$t\141\139Q{\DEL",PropMessageExpiryInterval 11401,PropReasonString
// "\160aNz\178e<\175lb\208\231\255\192\&0\199k\254\NAK\ry\"8gA\238",PropCorrelationData
// "\190XDv\SOH\195\197\228k~\210\SId\167\211\129[\198\247\197Q",PropAuthenticationMethod
// "\173\156\134\169\DC3IN\231H\225`\DLE\238\135\133\241\253G\170\145]\189\139\201\223",PropAssignedClientIdentifier
// "\128\133l\161\206?\144\215\145m\160\221",PropResponseInformation
// "Y\147\224X\192\238=\b\EOT\147UT9\148\239\252\NUL",PropMessageExpiryInterval 15590,PropRequestProblemInformation
// 15,PropSharedSubscriptionAvailable 43,PropSubscriptionIdentifier 3,PropReceiveMaximum 3169,PropMaximumQoS
// 110,PropMessageExpiryInterval 27843,PropSessionExpiryInterval 17032,PropUserProperty
// "\213R,\DLE\160j\238\b\238\173\243`t,\STX\SO\FS\135\150\180\DC2vct\137p\135w" ">\253\202\194\245\219j",PropTopicAlias
// 27026]}
TEST(Connect5QCTest, Encode87) {
  uint8_t pkt[] = {0x10, 0x8b, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x69, 0x87, 0xe8, 0x1,  0x22, 0x5,
                   0x30, 0x2a, 0x66, 0x22, 0x46, 0x8b, 0x23, 0x3a, 0xc4, 0x3,  0x0,  0x5,  0x9,  0x8a, 0x6b, 0xbe, 0xa9,
                   0x27, 0x0,  0x0,  0x4e, 0x8e, 0x16, 0x0,  0xf,  0x32, 0x71, 0xa6, 0x6f, 0xab, 0xce, 0x61, 0x4a, 0x24,
                   0x74, 0x8d, 0x8b, 0x51, 0x7b, 0x7f, 0x2,  0x0,  0x0,  0x2c, 0x89, 0x1f, 0x0,  0x1a, 0xa0, 0x61, 0x4e,
                   0x7a, 0xb2, 0x65, 0x3c, 0xaf, 0x6c, 0x62, 0xd0, 0xe7, 0xff, 0xc0, 0x30, 0xc7, 0x6b, 0xfe, 0x15, 0xd,
                   0x79, 0x22, 0x38, 0x67, 0x41, 0xee, 0x9,  0x0,  0x15, 0xbe, 0x58, 0x44, 0x76, 0x1,  0xc3, 0xc5, 0xe4,
                   0x6b, 0x7e, 0xd2, 0xf,  0x64, 0xa7, 0xd3, 0x81, 0x5b, 0xc6, 0xf7, 0xc5, 0x51, 0x15, 0x0,  0x19, 0xad,
                   0x9c, 0x86, 0xa9, 0x13, 0x49, 0x4e, 0xe7, 0x48, 0xe1, 0x60, 0x10, 0xee, 0x87, 0x85, 0xf1, 0xfd, 0x47,
                   0xaa, 0x91, 0x5d, 0xbd, 0x8b, 0xc9, 0xdf, 0x12, 0x0,  0xc,  0x80, 0x85, 0x6c, 0xa1, 0xce, 0x3f, 0x90,
                   0xd7, 0x91, 0x6d, 0xa0, 0xdd, 0x1a, 0x0,  0x11, 0x59, 0x93, 0xe0, 0x58, 0xc0, 0xee, 0x3d, 0x8,  0x4,
                   0x93, 0x55, 0x54, 0x39, 0x94, 0xef, 0xfc, 0x0,  0x2,  0x0,  0x0,  0x3c, 0xe6, 0x17, 0xf,  0x2a, 0x2b,
                   0xb,  0x3,  0x21, 0xc,  0x61, 0x24, 0x6e, 0x2,  0x0,  0x0,  0x6c, 0xc3, 0x11, 0x0,  0x0,  0x42, 0x88,
                   0x26, 0x0,  0x1c, 0xd5, 0x52, 0x2c, 0x10, 0xa0, 0x6a, 0xee, 0x8,  0xee, 0xad, 0xf3, 0x60, 0x74, 0x2c,
                   0x2,  0xe,  0x1c, 0x87, 0x96, 0xb4, 0x12, 0x76, 0x63, 0x74, 0x89, 0x70, 0x87, 0x77, 0x0,  0x7,  0x3e,
                   0xfd, 0xca, 0xc2, 0xf5, 0xdb, 0x6a, 0x23, 0x69, 0x92, 0x0,  0x10, 0x63, 0xca, 0x2e, 0x63, 0x8e, 0x57,
                   0x23, 0x55, 0x82, 0x70, 0x94, 0x71, 0x28, 0x4f, 0xdb, 0x6d, 0x0,  0x3,  0xe7, 0x88, 0x9d};

  uint8_t buf[280] = {0};

  uint8_t bytesprops0[] = {0x9, 0x8a, 0x6b, 0xbe, 0xa9};
  uint8_t bytesprops1[] = {0x32, 0x71, 0xa6, 0x6f, 0xab, 0xce, 0x61, 0x4a, 0x24, 0x74, 0x8d, 0x8b, 0x51, 0x7b, 0x7f};
  uint8_t bytesprops2[] = {0xa0, 0x61, 0x4e, 0x7a, 0xb2, 0x65, 0x3c, 0xaf, 0x6c, 0x62, 0xd0, 0xe7, 0xff,
                           0xc0, 0x30, 0xc7, 0x6b, 0xfe, 0x15, 0xd,  0x79, 0x22, 0x38, 0x67, 0x41, 0xee};
  uint8_t bytesprops3[] = {0xbe, 0x58, 0x44, 0x76, 0x1,  0xc3, 0xc5, 0xe4, 0x6b, 0x7e, 0xd2,
                           0xf,  0x64, 0xa7, 0xd3, 0x81, 0x5b, 0xc6, 0xf7, 0xc5, 0x51};
  uint8_t bytesprops4[] = {0xad, 0x9c, 0x86, 0xa9, 0x13, 0x49, 0x4e, 0xe7, 0x48, 0xe1, 0x60, 0x10, 0xee,
                           0x87, 0x85, 0xf1, 0xfd, 0x47, 0xaa, 0x91, 0x5d, 0xbd, 0x8b, 0xc9, 0xdf};
  uint8_t bytesprops5[] = {0x80, 0x85, 0x6c, 0xa1, 0xce, 0x3f, 0x90, 0xd7, 0x91, 0x6d, 0xa0, 0xdd};
  uint8_t bytesprops6[] = {0x59, 0x93, 0xe0, 0x58, 0xc0, 0xee, 0x3d, 0x8, 0x4,
                           0x93, 0x55, 0x54, 0x39, 0x94, 0xef, 0xfc, 0x0};
  uint8_t bytesprops8[] = {0x3e, 0xfd, 0xca, 0xc2, 0xf5, 0xdb, 0x6a};
  uint8_t bytesprops7[] = {0xd5, 0x52, 0x2c, 0x10, 0xa0, 0x6a, 0xee, 0x8,  0xee, 0xad, 0xf3, 0x60, 0x74, 0x2c,
                           0x2,  0xe,  0x1c, 0x87, 0x96, 0xb4, 0x12, 0x76, 0x63, 0x74, 0x89, 0x70, 0x87, 0x77};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1328}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18059}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15044}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20110}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11401}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15590}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3169}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27843}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17032}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops7}, .v = {7, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27026}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27015;
  uint8_t client_id_bytes[] = {0x63, 0xca, 0x2e, 0x63, 0x8e, 0x57, 0x23, 0x55,
                               0x82, 0x70, 0x94, 0x71, 0x28, 0x4f, 0xdb, 0x6d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe7, 0x88, 0x9d};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "U\185M\196", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 28907, _connID = ";&\203q}", _properties = [PropSubscriptionIdentifierAvailable 203,PropUserProperty
// "\227as\202\169c~\DC2\202h\254X\SYNUz" "\181FH",PropSubscriptionIdentifier 28,PropReceiveMaximum
// 26196,PropReceiveMaximum 25509,PropCorrelationData "|\181\ACK\178\NUL\229\190\140",PropCorrelationData
// "@U\165\f\205\147\&8M\241\r\226\159\214P\186\tz\248\201\a\146\215\255<\DEL",PropMaximumQoS 197,PropReceiveMaximum
// 912,PropWildcardSubscriptionAvailable 16,PropResponseTopic "\154",PropResponseInformation
// "\231o\246\171",PropPayloadFormatIndicator 166,PropRetainAvailable 111,PropTopicAliasMaximum
// 4682,PropMaximumPacketSize 13367,PropReasonString
// "\f\n9\151I(\222\136\&1$\144\135PA\210\132\183\148\&0d'",PropResponseTopic
// "\235Z\208h\168F\147G\183\213\FS@~\223\240g\aY\134\203\143p\181\&8\143",PropRequestResponseInformation
// 190,PropMessageExpiryInterval 12716,PropSharedSubscriptionAvailable 133,PropSessionExpiryInterval
// 24785,PropServerKeepAlive 16193,PropSharedSubscriptionAvailable 100,PropTopicAlias 9013,PropSessionExpiryInterval
// 32590,PropCorrelationData "\153\222\159%\157x3\216\US\250\248\231l\DC1\212\162",PropWillDelayInterval
// 11170,PropMessageExpiryInterval 23686]}
TEST(Connect5QCTest, Encode88) {
  uint8_t pkt[] = {0x10, 0xe5, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x70, 0xeb, 0xd2, 0x1,  0x29, 0xcb,
                   0x26, 0x0,  0xf,  0xe3, 0x61, 0x73, 0xca, 0xa9, 0x63, 0x7e, 0x12, 0xca, 0x68, 0xfe, 0x58, 0x16, 0x55,
                   0x7a, 0x0,  0x3,  0xb5, 0x46, 0x48, 0xb,  0x1c, 0x21, 0x66, 0x54, 0x21, 0x63, 0xa5, 0x9,  0x0,  0x8,
                   0x7c, 0xb5, 0x6,  0xb2, 0x0,  0xe5, 0xbe, 0x8c, 0x9,  0x0,  0x19, 0x40, 0x55, 0xa5, 0xc,  0xcd, 0x93,
                   0x38, 0x4d, 0xf1, 0xd,  0xe2, 0x9f, 0xd6, 0x50, 0xba, 0x9,  0x7a, 0xf8, 0xc9, 0x7,  0x92, 0xd7, 0xff,
                   0x3c, 0x7f, 0x24, 0xc5, 0x21, 0x3,  0x90, 0x28, 0x10, 0x8,  0x0,  0x1,  0x9a, 0x1a, 0x0,  0x4,  0xe7,
                   0x6f, 0xf6, 0xab, 0x1,  0xa6, 0x25, 0x6f, 0x22, 0x12, 0x4a, 0x27, 0x0,  0x0,  0x34, 0x37, 0x1f, 0x0,
                   0x15, 0xc,  0xa,  0x39, 0x97, 0x49, 0x28, 0xde, 0x88, 0x31, 0x24, 0x90, 0x87, 0x50, 0x41, 0xd2, 0x84,
                   0xb7, 0x94, 0x30, 0x64, 0x27, 0x8,  0x0,  0x19, 0xeb, 0x5a, 0xd0, 0x68, 0xa8, 0x46, 0x93, 0x47, 0xb7,
                   0xd5, 0x1c, 0x40, 0x7e, 0xdf, 0xf0, 0x67, 0x7,  0x59, 0x86, 0xcb, 0x8f, 0x70, 0xb5, 0x38, 0x8f, 0x19,
                   0xbe, 0x2,  0x0,  0x0,  0x31, 0xac, 0x2a, 0x85, 0x11, 0x0,  0x0,  0x60, 0xd1, 0x13, 0x3f, 0x41, 0x2a,
                   0x64, 0x23, 0x23, 0x35, 0x11, 0x0,  0x0,  0x7f, 0x4e, 0x9,  0x0,  0x10, 0x99, 0xde, 0x9f, 0x25, 0x9d,
                   0x78, 0x33, 0xd8, 0x1f, 0xfa, 0xf8, 0xe7, 0x6c, 0x11, 0xd4, 0xa2, 0x18, 0x0,  0x0,  0x2b, 0xa2, 0x2,
                   0x0,  0x0,  0x5c, 0x86, 0x0,  0x5,  0x3b, 0x26, 0xcb, 0x71, 0x7d};

  uint8_t buf[242] = {0};

  uint8_t bytesprops1[] = {0xb5, 0x46, 0x48};
  uint8_t bytesprops0[] = {0xe3, 0x61, 0x73, 0xca, 0xa9, 0x63, 0x7e, 0x12, 0xca, 0x68, 0xfe, 0x58, 0x16, 0x55, 0x7a};
  uint8_t bytesprops2[] = {0x7c, 0xb5, 0x6, 0xb2, 0x0, 0xe5, 0xbe, 0x8c};
  uint8_t bytesprops3[] = {0x40, 0x55, 0xa5, 0xc,  0xcd, 0x93, 0x38, 0x4d, 0xf1, 0xd,  0xe2, 0x9f, 0xd6,
                           0x50, 0xba, 0x9,  0x7a, 0xf8, 0xc9, 0x7,  0x92, 0xd7, 0xff, 0x3c, 0x7f};
  uint8_t bytesprops4[] = {0x9a};
  uint8_t bytesprops5[] = {0xe7, 0x6f, 0xf6, 0xab};
  uint8_t bytesprops6[] = {0xc,  0xa,  0x39, 0x97, 0x49, 0x28, 0xde, 0x88, 0x31, 0x24, 0x90,
                           0x87, 0x50, 0x41, 0xd2, 0x84, 0xb7, 0x94, 0x30, 0x64, 0x27};
  uint8_t bytesprops7[] = {0xeb, 0x5a, 0xd0, 0x68, 0xa8, 0x46, 0x93, 0x47, 0xb7, 0xd5, 0x1c, 0x40, 0x7e,
                           0xdf, 0xf0, 0x67, 0x7,  0x59, 0x86, 0xcb, 0x8f, 0x70, 0xb5, 0x38, 0x8f};
  uint8_t bytesprops8[] = {0x99, 0xde, 0x9f, 0x25, 0x9d, 0x78, 0x33, 0xd8,
                           0x1f, 0xfa, 0xf8, 0xe7, 0x6c, 0x11, 0xd4, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {3, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26196}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25509}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 912}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4682}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13367}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12716}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24785}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16193}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9013}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32590}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11170}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23686}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28907;
  uint8_t client_id_bytes[] = {0x3b, 0x26, 0xcb, 0x71, 0x7d};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x55, 0xb9, 0x4d, 0xc4};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "t\171o\168\ETB\EOT\EOT\226\b\SI\205\166J\SOj\164\ETB\SUB\166\245\US\SUB", _password
// = Just "\NAK\169_\251\NAK\186\DLE\215\169kW3J\b\199", _lastWill = Nothing, _cleanSession = False, _keepAlive = 28413,
// _connID = "\215\188:\SYN]?\n\214\176\&2i", _properties = [PropUserProperty "Dsn\191;\139\245)]\214 \STX\189\206Q\176"
// "\231\242\&5{\SUB\179\227\180\221\209:\135\128\188\ACK\177e\NUL",PropResponseInformation
// "a\132\238\194Ge\198\204@xC@%in\RS\138!\SIl@\241"]}
TEST(Connect5QCTest, Encode89) {
  uint8_t pkt[] = {0x10, 0x81, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x6e, 0xfd, 0x40, 0x26, 0x0,  0x10,
                   0x44, 0x73, 0x6e, 0xbf, 0x3b, 0x8b, 0xf5, 0x29, 0x5d, 0xd6, 0x20, 0x2,  0xbd, 0xce, 0x51, 0xb0, 0x0,
                   0x12, 0xe7, 0xf2, 0x35, 0x7b, 0x1a, 0xb3, 0xe3, 0xb4, 0xdd, 0xd1, 0x3a, 0x87, 0x80, 0xbc, 0x6,  0xb1,
                   0x65, 0x0,  0x1a, 0x0,  0x16, 0x61, 0x84, 0xee, 0xc2, 0x47, 0x65, 0xc6, 0xcc, 0x40, 0x78, 0x43, 0x40,
                   0x25, 0x69, 0x6e, 0x1e, 0x8a, 0x21, 0xf,  0x6c, 0x40, 0xf1, 0x0,  0xb,  0xd7, 0xbc, 0x3a, 0x16, 0x5d,
                   0x3f, 0xa,  0xd6, 0xb0, 0x32, 0x69, 0x0,  0x16, 0x74, 0xab, 0x6f, 0xa8, 0x17, 0x4,  0x4,  0xe2, 0x8,
                   0xf,  0xcd, 0xa6, 0x4a, 0xe,  0x6a, 0xa4, 0x17, 0x1a, 0xa6, 0xf5, 0x1f, 0x1a, 0x0,  0xf,  0x15, 0xa9,
                   0x5f, 0xfb, 0x15, 0xba, 0x10, 0xd7, 0xa9, 0x6b, 0x57, 0x33, 0x4a, 0x8,  0xc7};

  uint8_t buf[142] = {0};

  uint8_t bytesprops1[] = {0xe7, 0xf2, 0x35, 0x7b, 0x1a, 0xb3, 0xe3, 0xb4, 0xdd,
                           0xd1, 0x3a, 0x87, 0x80, 0xbc, 0x6,  0xb1, 0x65, 0x0};
  uint8_t bytesprops0[] = {0x44, 0x73, 0x6e, 0xbf, 0x3b, 0x8b, 0xf5, 0x29,
                           0x5d, 0xd6, 0x20, 0x2,  0xbd, 0xce, 0x51, 0xb0};
  uint8_t bytesprops2[] = {0x61, 0x84, 0xee, 0xc2, 0x47, 0x65, 0xc6, 0xcc, 0x40, 0x78, 0x43,
                           0x40, 0x25, 0x69, 0x6e, 0x1e, 0x8a, 0x21, 0xf,  0x6c, 0x40, 0xf1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops0}, .v = {18, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28413;
  uint8_t client_id_bytes[] = {0xd7, 0xbc, 0x3a, 0x16, 0x5d, 0x3f, 0xa, 0xd6, 0xb0, 0x32, 0x69};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x74, 0xab, 0x6f, 0xa8, 0x17, 0x4,  0x4,  0xe2, 0x8,  0xf,  0xcd,
                              0xa6, 0x4a, 0xe,  0x6a, 0xa4, 0x17, 0x1a, 0xa6, 0xf5, 0x1f, 0x1a};
  lwmqtt_string_t username = {22, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x15, 0xa9, 0x5f, 0xfb, 0x15, 0xba, 0x10, 0xd7, 0xa9, 0x6b, 0x57, 0x33, 0x4a, 0x8, 0xc7};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "M", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\163\147\EOT\177\219J\221\FSm_\STX\RS\rK\130D\159\n}", _willProps =
// [PropRequestResponseInformation 142,PropCorrelationData "}d\US\205\128\232tmf",PropContentType
// "\NULS\DC4\225_2M\USZA\218`,b\216\f\250\SI\157",PropResponseInformation
// "\171L8M\DC21\CAN\147\DLE\ETXR\229\151\159\EOT ",PropMaximumQoS 249,PropResponseTopic
// "\EOTu\DC2\225\176\241\146\161",PropAuthenticationMethod
// "!\143\DC2vB\188G\RS\213FH\140\129\137J\223\227\NAK",PropRequestProblemInformation 18,PropMessageExpiryInterval
// 31057,PropUserProperty "\f\231\205b\SO?\v'q_\205<\168i\210\130\238\146" "\t%\202Zl\253\153
// \143a\EOT\237w",PropRetainAvailable 151]}), _cleanSession = True, _keepAlive = 6707, _connID =
// "\248\222\190\&6\US\171Z\135\192\253\DEL\205\US\238\ETXR\201|\SUB", _properties = [PropResponseTopic
// "\138\ESC\135\164\v\250\216z\\\154\161\203",PropMaximumPacketSize 17854,PropServerReference
// "\142\246\245\211K\171^\SI\238\171\140C\241\248C\FS\218]",PropSubscriptionIdentifierAvailable
// 167,PropMessageExpiryInterval 18201,PropMessageExpiryInterval 31288,PropCorrelationData
// "8\US,\247\193\189\207\226\251\233\DEL4\255&A\229\182l\DC4\209@\150?g",PropRequestProblemInformation
// 245,PropUserProperty "\193\168" "\207\180\179\155",PropSessionExpiryInterval 7300,PropMaximumQoS 101,PropMaximumQoS
// 160,PropCorrelationData "\200\207\189\253u~~b",PropRequestResponseInformation 107,PropSubscriptionIdentifier 18]}
TEST(Connect5QCTest, Encode90) {
  uint8_t pkt[] = {
      0x10, 0xb4, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2e, 0x1a, 0x33, 0x75, 0x8,  0x0,  0xc,  0x8a, 0x1b,
      0x87, 0xa4, 0xb,  0xfa, 0xd8, 0x7a, 0x5c, 0x9a, 0xa1, 0xcb, 0x27, 0x0,  0x0,  0x45, 0xbe, 0x1c, 0x0,  0x12, 0x8e,
      0xf6, 0xf5, 0xd3, 0x4b, 0xab, 0x5e, 0xf,  0xee, 0xab, 0x8c, 0x43, 0xf1, 0xf8, 0x43, 0x1c, 0xda, 0x5d, 0x29, 0xa7,
      0x2,  0x0,  0x0,  0x47, 0x19, 0x2,  0x0,  0x0,  0x7a, 0x38, 0x9,  0x0,  0x18, 0x38, 0x1f, 0x2c, 0xf7, 0xc1, 0xbd,
      0xcf, 0xe2, 0xfb, 0xe9, 0x7f, 0x34, 0xff, 0x26, 0x41, 0xe5, 0xb6, 0x6c, 0x14, 0xd1, 0x40, 0x96, 0x3f, 0x67, 0x17,
      0xf5, 0x26, 0x0,  0x2,  0xc1, 0xa8, 0x0,  0x4,  0xcf, 0xb4, 0xb3, 0x9b, 0x11, 0x0,  0x0,  0x1c, 0x84, 0x24, 0x65,
      0x24, 0xa0, 0x9,  0x0,  0x8,  0xc8, 0xcf, 0xbd, 0xfd, 0x75, 0x7e, 0x7e, 0x62, 0x19, 0x6b, 0xb,  0x12, 0x0,  0x13,
      0xf8, 0xde, 0xbe, 0x36, 0x1f, 0xab, 0x5a, 0x87, 0xc0, 0xfd, 0x7f, 0xcd, 0x1f, 0xee, 0x3,  0x52, 0xc9, 0x7c, 0x1a,
      0x86, 0x1,  0x19, 0x8e, 0x9,  0x0,  0x9,  0x7d, 0x64, 0x1f, 0xcd, 0x80, 0xe8, 0x74, 0x6d, 0x66, 0x3,  0x0,  0x13,
      0x0,  0x53, 0x14, 0xe1, 0x5f, 0x32, 0x4d, 0x1f, 0x5a, 0x41, 0xda, 0x60, 0x2c, 0x62, 0xd8, 0xc,  0xfa, 0xf,  0x9d,
      0x1a, 0x0,  0x10, 0xab, 0x4c, 0x38, 0x4d, 0x12, 0x31, 0x18, 0x93, 0x10, 0x3,  0x52, 0xe5, 0x97, 0x9f, 0x4,  0x20,
      0x24, 0xf9, 0x8,  0x0,  0x8,  0x4,  0x75, 0x12, 0xe1, 0xb0, 0xf1, 0x92, 0xa1, 0x15, 0x0,  0x12, 0x21, 0x8f, 0x12,
      0x76, 0x42, 0xbc, 0x47, 0x1e, 0xd5, 0x46, 0x48, 0x8c, 0x81, 0x89, 0x4a, 0xdf, 0xe3, 0x15, 0x17, 0x12, 0x2,  0x0,
      0x0,  0x79, 0x51, 0x26, 0x0,  0x12, 0xc,  0xe7, 0xcd, 0x62, 0xe,  0x3f, 0xb,  0x27, 0x71, 0x5f, 0xcd, 0x3c, 0xa8,
      0x69, 0xd2, 0x82, 0xee, 0x92, 0x0,  0xd,  0x9,  0x25, 0xca, 0x5a, 0x6c, 0xfd, 0x99, 0x20, 0x8f, 0x61, 0x4,  0xed,
      0x77, 0x25, 0x97, 0x0,  0x0,  0x0,  0x13, 0xa3, 0x93, 0x4,  0xb1, 0xdb, 0x4a, 0xdd, 0x1c, 0x6d, 0x5f, 0x2,  0x1e,
      0xd,  0x4b, 0x82, 0x44, 0x9f, 0xa,  0x7d};

  uint8_t buf[321] = {0};

  uint8_t bytesprops0[] = {0x8a, 0x1b, 0x87, 0xa4, 0xb, 0xfa, 0xd8, 0x7a, 0x5c, 0x9a, 0xa1, 0xcb};
  uint8_t bytesprops1[] = {0x8e, 0xf6, 0xf5, 0xd3, 0x4b, 0xab, 0x5e, 0xf,  0xee,
                           0xab, 0x8c, 0x43, 0xf1, 0xf8, 0x43, 0x1c, 0xda, 0x5d};
  uint8_t bytesprops2[] = {0x38, 0x1f, 0x2c, 0xf7, 0xc1, 0xbd, 0xcf, 0xe2, 0xfb, 0xe9, 0x7f, 0x34,
                           0xff, 0x26, 0x41, 0xe5, 0xb6, 0x6c, 0x14, 0xd1, 0x40, 0x96, 0x3f, 0x67};
  uint8_t bytesprops4[] = {0xcf, 0xb4, 0xb3, 0x9b};
  uint8_t bytesprops3[] = {0xc1, 0xa8};
  uint8_t bytesprops5[] = {0xc8, 0xcf, 0xbd, 0xfd, 0x75, 0x7e, 0x7e, 0x62};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17854}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18201}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31288}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops3}, .v = {4, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7300}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7d, 0x64, 0x1f, 0xcd, 0x80, 0xe8, 0x74, 0x6d, 0x66};
  uint8_t byteswillprops1[] = {0x0,  0x53, 0x14, 0xe1, 0x5f, 0x32, 0x4d, 0x1f, 0x5a, 0x41,
                               0xda, 0x60, 0x2c, 0x62, 0xd8, 0xc,  0xfa, 0xf,  0x9d};
  uint8_t byteswillprops2[] = {0xab, 0x4c, 0x38, 0x4d, 0x12, 0x31, 0x18, 0x93,
                               0x10, 0x3,  0x52, 0xe5, 0x97, 0x9f, 0x4,  0x20};
  uint8_t byteswillprops3[] = {0x4, 0x75, 0x12, 0xe1, 0xb0, 0xf1, 0x92, 0xa1};
  uint8_t byteswillprops4[] = {0x21, 0x8f, 0x12, 0x76, 0x42, 0xbc, 0x47, 0x1e, 0xd5,
                               0x46, 0x48, 0x8c, 0x81, 0x89, 0x4a, 0xdf, 0xe3, 0x15};
  uint8_t byteswillprops6[] = {0x9, 0x25, 0xca, 0x5a, 0x6c, 0xfd, 0x99, 0x20, 0x8f, 0x61, 0x4, 0xed, 0x77};
  uint8_t byteswillprops5[] = {0xc,  0xe7, 0xcd, 0x62, 0xe,  0x3f, 0xb,  0x27, 0x71,
                               0x5f, 0xcd, 0x3c, 0xa8, 0x69, 0xd2, 0x82, 0xee, 0x92};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31057}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops5}, .v = {13, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa3, 0x93, 0x4, 0xb1, 0xdb, 0x4a, 0xdd, 0x1c, 0x6d, 0x5f,
                                  0x2,  0x1e, 0xd, 0x4b, 0x82, 0x44, 0x9f, 0xa,  0x7d};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6707;
  uint8_t client_id_bytes[] = {0xf8, 0xde, 0xbe, 0x36, 0x1f, 0xab, 0x5a, 0x87, 0xc0, 0xfd,
                               0x7f, 0xcd, 0x1f, 0xee, 0x3,  0x52, 0xc9, 0x7c, 0x1a};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\135\167", _password = Just "do\ETX\170V\239N\235\129|\168G\SO\218O\245SW\228",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\198\149\RSL\143\254\166!", _willMsg =
// ":\215\\\152\141^\ETXb\198", _willProps = [PropServerReference "\138",PropSubscriptionIdentifier
// 30,PropRetainAvailable 153,PropReceiveMaximum 18956,PropMessageExpiryInterval
// 23816,PropSubscriptionIdentifierAvailable 147,PropResponseInformation
// "\250Z\151[\183\193d\144E](P\181\239g\172\251\240q\180\189k\165,\b",PropSubscriptionIdentifierAvailable
// 34,PropCorrelationData "\133\220\130\235\214\244\246W\202\ACK
// @\218$\199\211\235uzSf\215fF!\160\255V\151",PropMessageExpiryInterval 19228,PropReceiveMaximum
// 15862,PropCorrelationData "89\160U\196\207,\164\221;\US7\f\220\128\145\&6c&\158R",PropServerReference
// "%\n\NAK@tW?\141\228\214\254\&8\GS\DC4J\SUB\197;?",PropTopicAlias 12803,PropRequestResponseInformation
// 24,PropWillDelayInterval 23550,PropSubscriptionIdentifierAvailable 114,PropResponseInformation
// "\155N!U\136\DC3\155y\245\139f(]0\211\SUBV\229",PropAssignedClientIdentifier
// "W]\166\225_&\137\&5\208\192",PropSessionExpiryInterval 5122,PropMessageExpiryInterval 8890,PropContentType
// "\229Q"]}), _cleanSession = True, _keepAlive = 1501, _connID =
// "\234YO\DC3;\148\207\&0\153n\199\142\146\206\254\155:", _properties = [PropResponseInformation
// "\204\143",PropRequestResponseInformation 158,PropSubscriptionIdentifierAvailable 8,PropPayloadFormatIndicator
// 12,PropCorrelationData "\211\132\206M\223\171\159\226pm",PropWildcardSubscriptionAvailable 46,PropReceiveMaximum
// 12964,PropSharedSubscriptionAvailable 216,PropAuthenticationMethod
// "\SI\vG\189?\EOT\222\162\137\190\181D?d",PropTopicAlias 20345,PropTopicAlias 8272,PropUserProperty
// "\234e\223\137\155\SYN\t\221i\219>" "\241",PropPayloadFormatIndicator 200,PropReasonString
// "C\141\208\229\CAN[\166\140\149",PropSessionExpiryInterval 26063,PropAuthenticationMethod
// "\255U\155a\213\202/\170\235\144\RS:\156\138\ETB|(\169n\192\250m"]}
TEST(Connect5QCTest, Encode91) {
  uint8_t pkt[] = {
      0x10, 0x84, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x5,  0xdd, 0x73, 0x1a, 0x0,  0x2,  0xcc, 0x8f,
      0x19, 0x9e, 0x29, 0x8,  0x1,  0xc,  0x9,  0x0,  0xa,  0xd3, 0x84, 0xce, 0x4d, 0xdf, 0xab, 0x9f, 0xe2, 0x70, 0x6d,
      0x28, 0x2e, 0x21, 0x32, 0xa4, 0x2a, 0xd8, 0x15, 0x0,  0xe,  0xf,  0xb,  0x47, 0xbd, 0x3f, 0x4,  0xde, 0xa2, 0x89,
      0xbe, 0xb5, 0x44, 0x3f, 0x64, 0x23, 0x4f, 0x79, 0x23, 0x20, 0x50, 0x26, 0x0,  0xb,  0xea, 0x65, 0xdf, 0x89, 0x9b,
      0x16, 0x9,  0xdd, 0x69, 0xdb, 0x3e, 0x0,  0x1,  0xf1, 0x1,  0xc8, 0x1f, 0x0,  0x9,  0x43, 0x8d, 0xd0, 0xe5, 0x18,
      0x5b, 0xa6, 0x8c, 0x95, 0x11, 0x0,  0x0,  0x65, 0xcf, 0x15, 0x0,  0x16, 0xff, 0x55, 0x9b, 0x61, 0xd5, 0xca, 0x2f,
      0xaa, 0xeb, 0x90, 0x1e, 0x3a, 0x9c, 0x8a, 0x17, 0x7c, 0x28, 0xa9, 0x6e, 0xc0, 0xfa, 0x6d, 0x0,  0x11, 0xea, 0x59,
      0x4f, 0x13, 0x3b, 0x94, 0xcf, 0x30, 0x99, 0x6e, 0xc7, 0x8e, 0x92, 0xce, 0xfe, 0x9b, 0x3a, 0xc3, 0x1,  0x1c, 0x0,
      0x1,  0x8a, 0xb,  0x1e, 0x25, 0x99, 0x21, 0x4a, 0xc,  0x2,  0x0,  0x0,  0x5d, 0x8,  0x29, 0x93, 0x1a, 0x0,  0x19,
      0xfa, 0x5a, 0x97, 0x5b, 0xb7, 0xc1, 0x64, 0x90, 0x45, 0x5d, 0x28, 0x50, 0xb5, 0xef, 0x67, 0xac, 0xfb, 0xf0, 0x71,
      0xb4, 0xbd, 0x6b, 0xa5, 0x2c, 0x8,  0x29, 0x22, 0x9,  0x0,  0x1d, 0x85, 0xdc, 0x82, 0xeb, 0xd6, 0xf4, 0xf6, 0x57,
      0xca, 0x6,  0x20, 0x40, 0xda, 0x24, 0xc7, 0xd3, 0xeb, 0x75, 0x7a, 0x53, 0x66, 0xd7, 0x66, 0x46, 0x21, 0xa0, 0xff,
      0x56, 0x97, 0x2,  0x0,  0x0,  0x4b, 0x1c, 0x21, 0x3d, 0xf6, 0x9,  0x0,  0x15, 0x38, 0x39, 0xa0, 0x55, 0xc4, 0xcf,
      0x2c, 0xa4, 0xdd, 0x3b, 0x1f, 0x37, 0xc,  0xdc, 0x80, 0x91, 0x36, 0x63, 0x26, 0x9e, 0x52, 0x1c, 0x0,  0x13, 0x25,
      0xa,  0x15, 0x40, 0x74, 0x57, 0x3f, 0x8d, 0xe4, 0xd6, 0xfe, 0x38, 0x1d, 0x14, 0x4a, 0x1a, 0xc5, 0x3b, 0x3f, 0x23,
      0x32, 0x3,  0x19, 0x18, 0x18, 0x0,  0x0,  0x5b, 0xfe, 0x29, 0x72, 0x1a, 0x0,  0x12, 0x9b, 0x4e, 0x21, 0x55, 0x88,
      0x13, 0x9b, 0x79, 0xf5, 0x8b, 0x66, 0x28, 0x5d, 0x30, 0xd3, 0x1a, 0x56, 0xe5, 0x12, 0x0,  0xa,  0x57, 0x5d, 0xa6,
      0xe1, 0x5f, 0x26, 0x89, 0x35, 0xd0, 0xc0, 0x11, 0x0,  0x0,  0x14, 0x2,  0x2,  0x0,  0x0,  0x22, 0xba, 0x3,  0x0,
      0x2,  0xe5, 0x51, 0x0,  0x8,  0xc6, 0x95, 0x1e, 0x4c, 0x8f, 0xfe, 0xa6, 0x21, 0x0,  0x9,  0x3a, 0xd7, 0x5c, 0x98,
      0x8d, 0x5e, 0x3,  0x62, 0xc6, 0x0,  0x2,  0x87, 0xa7, 0x0,  0x13, 0x64, 0x6f, 0x3,  0xaa, 0x56, 0xef, 0x4e, 0xeb,
      0x81, 0x7c, 0xa8, 0x47, 0xe,  0xda, 0x4f, 0xf5, 0x53, 0x57, 0xe4};

  uint8_t buf[401] = {0};

  uint8_t bytesprops0[] = {0xcc, 0x8f};
  uint8_t bytesprops1[] = {0xd3, 0x84, 0xce, 0x4d, 0xdf, 0xab, 0x9f, 0xe2, 0x70, 0x6d};
  uint8_t bytesprops2[] = {0xf, 0xb, 0x47, 0xbd, 0x3f, 0x4, 0xde, 0xa2, 0x89, 0xbe, 0xb5, 0x44, 0x3f, 0x64};
  uint8_t bytesprops4[] = {0xf1};
  uint8_t bytesprops3[] = {0xea, 0x65, 0xdf, 0x89, 0x9b, 0x16, 0x9, 0xdd, 0x69, 0xdb, 0x3e};
  uint8_t bytesprops5[] = {0x43, 0x8d, 0xd0, 0xe5, 0x18, 0x5b, 0xa6, 0x8c, 0x95};
  uint8_t bytesprops6[] = {0xff, 0x55, 0x9b, 0x61, 0xd5, 0xca, 0x2f, 0xaa, 0xeb, 0x90, 0x1e,
                           0x3a, 0x9c, 0x8a, 0x17, 0x7c, 0x28, 0xa9, 0x6e, 0xc0, 0xfa, 0x6d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12964}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20345}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8272}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops3}, .v = {1, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26063}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8a};
  uint8_t byteswillprops1[] = {0xfa, 0x5a, 0x97, 0x5b, 0xb7, 0xc1, 0x64, 0x90, 0x45, 0x5d, 0x28, 0x50, 0xb5,
                               0xef, 0x67, 0xac, 0xfb, 0xf0, 0x71, 0xb4, 0xbd, 0x6b, 0xa5, 0x2c, 0x8};
  uint8_t byteswillprops2[] = {0x85, 0xdc, 0x82, 0xeb, 0xd6, 0xf4, 0xf6, 0x57, 0xca, 0x6,  0x20, 0x40, 0xda, 0x24, 0xc7,
                               0xd3, 0xeb, 0x75, 0x7a, 0x53, 0x66, 0xd7, 0x66, 0x46, 0x21, 0xa0, 0xff, 0x56, 0x97};
  uint8_t byteswillprops3[] = {0x38, 0x39, 0xa0, 0x55, 0xc4, 0xcf, 0x2c, 0xa4, 0xdd, 0x3b, 0x1f,
                               0x37, 0xc,  0xdc, 0x80, 0x91, 0x36, 0x63, 0x26, 0x9e, 0x52};
  uint8_t byteswillprops4[] = {0x25, 0xa,  0x15, 0x40, 0x74, 0x57, 0x3f, 0x8d, 0xe4, 0xd6,
                               0xfe, 0x38, 0x1d, 0x14, 0x4a, 0x1a, 0xc5, 0x3b, 0x3f};
  uint8_t byteswillprops5[] = {0x9b, 0x4e, 0x21, 0x55, 0x88, 0x13, 0x9b, 0x79, 0xf5,
                               0x8b, 0x66, 0x28, 0x5d, 0x30, 0xd3, 0x1a, 0x56, 0xe5};
  uint8_t byteswillprops6[] = {0x57, 0x5d, 0xa6, 0xe1, 0x5f, 0x26, 0x89, 0x35, 0xd0, 0xc0};
  uint8_t byteswillprops7[] = {0xe5, 0x51};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18956}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23816}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19228}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15862}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12803}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23550}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5122}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8890}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc6, 0x95, 0x1e, 0x4c, 0x8f, 0xfe, 0xa6, 0x21};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0xd7, 0x5c, 0x98, 0x8d, 0x5e, 0x3, 0x62, 0xc6};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1501;
  uint8_t client_id_bytes[] = {0xea, 0x59, 0x4f, 0x13, 0x3b, 0x94, 0xcf, 0x30, 0x99,
                               0x6e, 0xc7, 0x8e, 0x92, 0xce, 0xfe, 0x9b, 0x3a};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x87, 0xa7};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x64, 0x6f, 0x3, 0xaa, 0x56, 0xef, 0x4e, 0xeb, 0x81, 0x7c,
                              0xa8, 0x47, 0xe, 0xda, 0x4f, 0xf5, 0x53, 0x57, 0xe4};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J3\245R\234g\199\SUBe\f]Y\184\155\252O\131", _password = Just
// "N\130Z\162\174\221xV\181", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "L\149\222\209\ETB6\200tmGe\184\245\DLEg\135|\138v", _willMsg =
// "\240S\t;\152\130\197\DEL\227\191\221\138y|D\US\188\DC2\\\198@\207\&5\174\DC4w\GS1", _willProps =
// [PropSubscriptionIdentifier 3,PropRequestProblemInformation 225,PropRequestProblemInformation 27,PropUserProperty ""
// "9\239\SO:\222\213\150Y+X",PropMaximumPacketSize 14754,PropReasonString
// "b\DEL\t\176\128\r\242\201;\219n\242\144}\ETX\214\ETB\142\246\157n\162C1\201",PropMessageExpiryInterval
// 22587,PropAssignedClientIdentifier "\169]\148\nA\v\243\199\&1\NUL\SIU\228",PropServerReference
// "*\181R+jA\ETB\184\&7\243,3\215\152\145\182l",PropWildcardSubscriptionAvailable 163,PropUserProperty ">s"
// "\a\202\CAN\177@\197\210BLSH\202\228\220!Q\GS\211\160\158",PropReceiveMaximum 26684,PropAssignedClientIdentifier
// "\FS7\EOT\220J\220\196f\251k\179\174\SUBu\203\207\189\145\130\204@\146\DC4",PropSubscriptionIdentifier
// 0,PropUserProperty "\NAK\240Tn\ESC\210\EM\178\183\SI\195\251gt\190\248\158\211Q\SO_m*\186._j\137\198\DC3"
// "\164mE\b\156`",PropSessionExpiryInterval 12603,PropResponseInformation
// "\128\194\170\151\&1",PropWildcardSubscriptionAvailable 88,PropContentType
// "q\DLE\149\136\v\ESCS\234\132\ENQ",PropWildcardSubscriptionAvailable 84,PropSessionExpiryInterval
// 17195,PropSubscriptionIdentifierAvailable 83]}), _cleanSession = True, _keepAlive = 7620, _connID =
// "\180X\169B\252{L\217vd\b\249L\137\219\253\249W\166\245\152\SOnJJE\131\213", _properties =
// [PropPayloadFormatIndicator 252,PropRequestProblemInformation 223,PropSubscriptionIdentifierAvailable
// 195,PropSharedSubscriptionAvailable 91,PropSubscriptionIdentifier 5,PropRetainAvailable 80,PropSubscriptionIdentifier
// 0,PropContentType "\163O\195\187\207\n2\178\239TS"]}
TEST(Connect5QCTest, Encode92) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x1d, 0xc4, 0x1c, 0x1,  0xfc, 0x17, 0xdf, 0x29,
      0xc3, 0x2a, 0x5b, 0xb,  0x5,  0x25, 0x50, 0xb,  0x0,  0x3,  0x0,  0xb,  0xa3, 0x4f, 0xc3, 0xbb, 0xcf, 0xa,  0x32,
      0xb2, 0xef, 0x54, 0x53, 0x0,  0x1c, 0xb4, 0x58, 0xa9, 0x42, 0xfc, 0x7b, 0x4c, 0xd9, 0x76, 0x64, 0x8,  0xf9, 0x4c,
      0x89, 0xdb, 0xfd, 0xf9, 0x57, 0xa6, 0xf5, 0x98, 0xe,  0x6e, 0x4a, 0x4a, 0x45, 0x83, 0xd5, 0xe9, 0x1,  0xb,  0x3,
      0x17, 0xe1, 0x17, 0x1b, 0x26, 0x0,  0x0,  0x0,  0xa,  0x39, 0xef, 0xe,  0x3a, 0xde, 0xd5, 0x96, 0x59, 0x2b, 0x58,
      0x27, 0x0,  0x0,  0x39, 0xa2, 0x1f, 0x0,  0x19, 0x62, 0x7f, 0x9,  0xb0, 0x80, 0xd,  0xf2, 0xc9, 0x3b, 0xdb, 0x6e,
      0xf2, 0x90, 0x7d, 0x3,  0xd6, 0x17, 0x8e, 0xf6, 0x9d, 0x6e, 0xa2, 0x43, 0x31, 0xc9, 0x2,  0x0,  0x0,  0x58, 0x3b,
      0x12, 0x0,  0xd,  0xa9, 0x5d, 0x94, 0xa,  0x41, 0xb,  0xf3, 0xc7, 0x31, 0x0,  0xf,  0x55, 0xe4, 0x1c, 0x0,  0x11,
      0x2a, 0xb5, 0x52, 0x2b, 0x6a, 0x41, 0x17, 0xb8, 0x37, 0xf3, 0x2c, 0x33, 0xd7, 0x98, 0x91, 0xb6, 0x6c, 0x28, 0xa3,
      0x26, 0x0,  0x2,  0x3e, 0x73, 0x0,  0x14, 0x7,  0xca, 0x18, 0xb1, 0x40, 0xc5, 0xd2, 0x42, 0x4c, 0x53, 0x48, 0xca,
      0xe4, 0xdc, 0x21, 0x51, 0x1d, 0xd3, 0xa0, 0x9e, 0x21, 0x68, 0x3c, 0x12, 0x0,  0x17, 0x1c, 0x37, 0x4,  0xdc, 0x4a,
      0xdc, 0xc4, 0x66, 0xfb, 0x6b, 0xb3, 0xae, 0x1a, 0x75, 0xcb, 0xcf, 0xbd, 0x91, 0x82, 0xcc, 0x40, 0x92, 0x14, 0xb,
      0x0,  0x26, 0x0,  0x1e, 0x15, 0xf0, 0x54, 0x6e, 0x1b, 0xd2, 0x19, 0xb2, 0xb7, 0xf,  0xc3, 0xfb, 0x67, 0x74, 0xbe,
      0xf8, 0x9e, 0xd3, 0x51, 0xe,  0x5f, 0x6d, 0x2a, 0xba, 0x2e, 0x5f, 0x6a, 0x89, 0xc6, 0x13, 0x0,  0x6,  0xa4, 0x6d,
      0x45, 0x8,  0x9c, 0x60, 0x11, 0x0,  0x0,  0x31, 0x3b, 0x1a, 0x0,  0x5,  0x80, 0xc2, 0xaa, 0x97, 0x31, 0x28, 0x58,
      0x3,  0x0,  0xa,  0x71, 0x10, 0x95, 0x88, 0xb,  0x1b, 0x53, 0xea, 0x84, 0x5,  0x28, 0x54, 0x11, 0x0,  0x0,  0x43,
      0x2b, 0x29, 0x53, 0x0,  0x13, 0x4c, 0x95, 0xde, 0xd1, 0x17, 0x36, 0xc8, 0x74, 0x6d, 0x47, 0x65, 0xb8, 0xf5, 0x10,
      0x67, 0x87, 0x7c, 0x8a, 0x76, 0x0,  0x1c, 0xf0, 0x53, 0x9,  0x3b, 0x98, 0x82, 0xc5, 0x7f, 0xe3, 0xbf, 0xdd, 0x8a,
      0x79, 0x7c, 0x44, 0x1f, 0xbc, 0x12, 0x5c, 0xc6, 0x40, 0xcf, 0x35, 0xae, 0x14, 0x77, 0x1d, 0x31, 0x0,  0x11, 0x4a,
      0x33, 0xf5, 0x52, 0xea, 0x67, 0xc7, 0x1a, 0x65, 0xc,  0x5d, 0x59, 0xb8, 0x9b, 0xfc, 0x4f, 0x83, 0x0,  0x9,  0x4e,
      0x82, 0x5a, 0xa2, 0xae, 0xdd, 0x78, 0x56, 0xb5};

  uint8_t buf[398] = {0};

  uint8_t bytesprops0[] = {0xa3, 0x4f, 0xc3, 0xbb, 0xcf, 0xa, 0x32, 0xb2, 0xef, 0x54, 0x53};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x39, 0xef, 0xe, 0x3a, 0xde, 0xd5, 0x96, 0x59, 0x2b, 0x58};
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops2[] = {0x62, 0x7f, 0x9,  0xb0, 0x80, 0xd,  0xf2, 0xc9, 0x3b, 0xdb, 0x6e, 0xf2, 0x90,
                               0x7d, 0x3,  0xd6, 0x17, 0x8e, 0xf6, 0x9d, 0x6e, 0xa2, 0x43, 0x31, 0xc9};
  uint8_t byteswillprops3[] = {0xa9, 0x5d, 0x94, 0xa, 0x41, 0xb, 0xf3, 0xc7, 0x31, 0x0, 0xf, 0x55, 0xe4};
  uint8_t byteswillprops4[] = {0x2a, 0xb5, 0x52, 0x2b, 0x6a, 0x41, 0x17, 0xb8, 0x37,
                               0xf3, 0x2c, 0x33, 0xd7, 0x98, 0x91, 0xb6, 0x6c};
  uint8_t byteswillprops6[] = {0x7,  0xca, 0x18, 0xb1, 0x40, 0xc5, 0xd2, 0x42, 0x4c, 0x53,
                               0x48, 0xca, 0xe4, 0xdc, 0x21, 0x51, 0x1d, 0xd3, 0xa0, 0x9e};
  uint8_t byteswillprops5[] = {0x3e, 0x73};
  uint8_t byteswillprops7[] = {0x1c, 0x37, 0x4,  0xdc, 0x4a, 0xdc, 0xc4, 0x66, 0xfb, 0x6b, 0xb3, 0xae,
                               0x1a, 0x75, 0xcb, 0xcf, 0xbd, 0x91, 0x82, 0xcc, 0x40, 0x92, 0x14};
  uint8_t byteswillprops9[] = {0xa4, 0x6d, 0x45, 0x8, 0x9c, 0x60};
  uint8_t byteswillprops8[] = {0x15, 0xf0, 0x54, 0x6e, 0x1b, 0xd2, 0x19, 0xb2, 0xb7, 0xf,
                               0xc3, 0xfb, 0x67, 0x74, 0xbe, 0xf8, 0x9e, 0xd3, 0x51, 0xe,
                               0x5f, 0x6d, 0x2a, 0xba, 0x2e, 0x5f, 0x6a, 0x89, 0xc6, 0x13};
  uint8_t byteswillprops10[] = {0x80, 0xc2, 0xaa, 0x97, 0x31};
  uint8_t byteswillprops11[] = {0x71, 0x10, 0x95, 0x88, 0xb, 0x1b, 0x53, 0xea, 0x84, 0x5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops0}, .v = {10, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14754}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22587}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops5}, .v = {20, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26684}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops8}, .v = {6, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12603}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17195}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 83}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4c, 0x95, 0xde, 0xd1, 0x17, 0x36, 0xc8, 0x74, 0x6d, 0x47,
                                0x65, 0xb8, 0xf5, 0x10, 0x67, 0x87, 0x7c, 0x8a, 0x76};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0x53, 0x9,  0x3b, 0x98, 0x82, 0xc5, 0x7f, 0xe3, 0xbf, 0xdd, 0x8a, 0x79, 0x7c,
                                  0x44, 0x1f, 0xbc, 0x12, 0x5c, 0xc6, 0x40, 0xcf, 0x35, 0xae, 0x14, 0x77, 0x1d, 0x31};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7620;
  uint8_t client_id_bytes[] = {0xb4, 0x58, 0xa9, 0x42, 0xfc, 0x7b, 0x4c, 0xd9, 0x76, 0x64, 0x8,  0xf9, 0x4c, 0x89,
                               0xdb, 0xfd, 0xf9, 0x57, 0xa6, 0xf5, 0x98, 0xe,  0x6e, 0x4a, 0x4a, 0x45, 0x83, 0xd5};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x33, 0xf5, 0x52, 0xea, 0x67, 0xc7, 0x1a, 0x65,
                              0xc,  0x5d, 0x59, 0xb8, 0x9b, 0xfc, 0x4f, 0x83};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4e, 0x82, 0x5a, 0xa2, 0xae, 0xdd, 0x78, 0x56, 0xb5};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DC2\145\228\152*\178X", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\143\&2Gc]\253N\249\243\153\145\225\185\215sp\SOHs\192\221\&7{",
// _willMsg = "\NUL\211NA\197", _willProps = [PropSubscriptionIdentifierAvailable 9,PropRequestResponseInformation
// 70,PropServerReference "\194x\EOT\249\241\183\&4\210t\184IU\240\224\174\213\223M",PropPayloadFormatIndicator
// 234,PropAuthenticationData
// "J\DC4M\227\211\160\165\201\ESC\159\169]|\244x.\214\DELc\199\147\154\ESC",PropSubscriptionIdentifier
// 7,PropSubscriptionIdentifier 31,PropReceiveMaximum 9626,PropAuthenticationMethod
// "o\155,\201\SI\192\179\ACK\219\131\214\148\246\CANv;R\239",PropRequestProblemInformation
// 195,PropWildcardSubscriptionAvailable 144,PropMaximumQoS 238,PropCorrelationData
// "<\ENQ\253\SYN\133*6\219\237a\SI\244\RS\\\188",PropServerKeepAlive 26333,PropServerKeepAlive 28853]}), _cleanSession
// = True, _keepAlive = 29972, _connID = "\ETB8\187\183q0\214H5\201\SI\199\183B\212u[\143\253\152\199W\EOT\206\149",
// _properties = [PropSubscriptionIdentifierAvailable 197,PropSessionExpiryInterval 6618,PropPayloadFormatIndicator
// 17,PropUserProperty "Xh\249\187$?^z\168p" "&\133\152G\NAK\206\181}'(n\NAK\136\173\238g,\NAK",PropResponseTopic
// "\155\&6\DEL/\176\244C\176k0\233",PropMessageExpiryInterval 7269,PropWillDelayInterval 21711,PropMaximumQoS
// 137,PropSharedSubscriptionAvailable 86,PropMaximumPacketSize 4793,PropSessionExpiryInterval
// 26648,PropSharedSubscriptionAvailable 205,PropRetainAvailable 231,PropCorrelationData
// "\224\177",PropSharedSubscriptionAvailable 66]}
TEST(Connect5QCTest, Encode93) {
  uint8_t pkt[] = {
      0x10, 0x90, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x36, 0x75, 0x14, 0x5b, 0x29, 0xc5, 0x11, 0x0,  0x0,
      0x19, 0xda, 0x1,  0x11, 0x26, 0x0,  0xa,  0x58, 0x68, 0xf9, 0xbb, 0x24, 0x3f, 0x5e, 0x7a, 0xa8, 0x70, 0x0,  0x12,
      0x26, 0x85, 0x98, 0x47, 0x15, 0xce, 0xb5, 0x7d, 0x27, 0x28, 0x6e, 0x15, 0x88, 0xad, 0xee, 0x67, 0x2c, 0x15, 0x8,
      0x0,  0xb,  0x9b, 0x36, 0x7f, 0x2f, 0xb0, 0xf4, 0x43, 0xb0, 0x6b, 0x30, 0xe9, 0x2,  0x0,  0x0,  0x1c, 0x65, 0x18,
      0x0,  0x0,  0x54, 0xcf, 0x24, 0x89, 0x2a, 0x56, 0x27, 0x0,  0x0,  0x12, 0xb9, 0x11, 0x0,  0x0,  0x68, 0x18, 0x2a,
      0xcd, 0x25, 0xe7, 0x9,  0x0,  0x2,  0xe0, 0xb1, 0x2a, 0x42, 0x0,  0x19, 0x17, 0x38, 0xbb, 0xb7, 0x71, 0x30, 0xd6,
      0x48, 0x35, 0xc9, 0xf,  0xc7, 0xb7, 0x42, 0xd4, 0x75, 0x5b, 0x8f, 0xfd, 0x98, 0xc7, 0x57, 0x4,  0xce, 0x95, 0x6f,
      0x29, 0x9,  0x19, 0x46, 0x1c, 0x0,  0x12, 0xc2, 0x78, 0x4,  0xf9, 0xf1, 0xb7, 0x34, 0xd2, 0x74, 0xb8, 0x49, 0x55,
      0xf0, 0xe0, 0xae, 0xd5, 0xdf, 0x4d, 0x1,  0xea, 0x16, 0x0,  0x17, 0x4a, 0x14, 0x4d, 0xe3, 0xd3, 0xa0, 0xa5, 0xc9,
      0x1b, 0x9f, 0xa9, 0x5d, 0x7c, 0xf4, 0x78, 0x2e, 0xd6, 0x7f, 0x63, 0xc7, 0x93, 0x9a, 0x1b, 0xb,  0x7,  0xb,  0x1f,
      0x21, 0x25, 0x9a, 0x15, 0x0,  0x12, 0x6f, 0x9b, 0x2c, 0xc9, 0xf,  0xc0, 0xb3, 0x6,  0xdb, 0x83, 0xd6, 0x94, 0xf6,
      0x18, 0x76, 0x3b, 0x52, 0xef, 0x17, 0xc3, 0x28, 0x90, 0x24, 0xee, 0x9,  0x0,  0xf,  0x3c, 0x5,  0xfd, 0x16, 0x85,
      0x2a, 0x36, 0xdb, 0xed, 0x61, 0xf,  0xf4, 0x1e, 0x5c, 0xbc, 0x13, 0x66, 0xdd, 0x13, 0x70, 0xb5, 0x0,  0x16, 0x8f,
      0x32, 0x47, 0x63, 0x5d, 0xfd, 0x4e, 0xf9, 0xf3, 0x99, 0x91, 0xe1, 0xb9, 0xd7, 0x73, 0x70, 0x1,  0x73, 0xc0, 0xdd,
      0x37, 0x7b, 0x0,  0x5,  0x0,  0xd3, 0x4e, 0x41, 0xc5};

  uint8_t buf[285] = {0};

  uint8_t bytesprops1[] = {0x26, 0x85, 0x98, 0x47, 0x15, 0xce, 0xb5, 0x7d, 0x27,
                           0x28, 0x6e, 0x15, 0x88, 0xad, 0xee, 0x67, 0x2c, 0x15};
  uint8_t bytesprops0[] = {0x58, 0x68, 0xf9, 0xbb, 0x24, 0x3f, 0x5e, 0x7a, 0xa8, 0x70};
  uint8_t bytesprops2[] = {0x9b, 0x36, 0x7f, 0x2f, 0xb0, 0xf4, 0x43, 0xb0, 0x6b, 0x30, 0xe9};
  uint8_t bytesprops3[] = {0xe0, 0xb1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6618}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {18, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7269}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21711}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4793}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26648}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc2, 0x78, 0x4,  0xf9, 0xf1, 0xb7, 0x34, 0xd2, 0x74,
                               0xb8, 0x49, 0x55, 0xf0, 0xe0, 0xae, 0xd5, 0xdf, 0x4d};
  uint8_t byteswillprops1[] = {0x4a, 0x14, 0x4d, 0xe3, 0xd3, 0xa0, 0xa5, 0xc9, 0x1b, 0x9f, 0xa9, 0x5d,
                               0x7c, 0xf4, 0x78, 0x2e, 0xd6, 0x7f, 0x63, 0xc7, 0x93, 0x9a, 0x1b};
  uint8_t byteswillprops2[] = {0x6f, 0x9b, 0x2c, 0xc9, 0xf,  0xc0, 0xb3, 0x6,  0xdb,
                               0x83, 0xd6, 0x94, 0xf6, 0x18, 0x76, 0x3b, 0x52, 0xef};
  uint8_t byteswillprops3[] = {0x3c, 0x5, 0xfd, 0x16, 0x85, 0x2a, 0x36, 0xdb, 0xed, 0x61, 0xf, 0xf4, 0x1e, 0x5c, 0xbc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9626}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26333}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28853}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0x32, 0x47, 0x63, 0x5d, 0xfd, 0x4e, 0xf9, 0xf3, 0x99, 0x91,
                                0xe1, 0xb9, 0xd7, 0x73, 0x70, 0x1,  0x73, 0xc0, 0xdd, 0x37, 0x7b};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x0, 0xd3, 0x4e, 0x41, 0xc5};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29972;
  uint8_t client_id_bytes[] = {0x17, 0x38, 0xbb, 0xb7, 0x71, 0x30, 0xd6, 0x48, 0x35, 0xc9, 0xf,  0xc7, 0xb7,
                               0x42, 0xd4, 0x75, 0x5b, 0x8f, 0xfd, 0x98, 0xc7, 0x57, 0x4,  0xce, 0x95};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x12, 0x91, 0xe4, 0x98, 0x2a, 0xb2, 0x58};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ",dA\164\202\NUL\161\212\169\183\&0", _password = Just "\CAN\SUB\238\&0", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\GS\187\&5\157[*n\166\233S\168\&8\155\DC4\177$\168q\204\218\r\rJ", _willMsg =
// "\236[s\ESCz\217dW\STX\222\151\&0\SYNB\149\b\189fKjA", _willProps = [PropSubscriptionIdentifier 18,PropReasonString
// "\208##+\v\198l\138\152l\STX\229\221\249r\240\174g\152^\FSW:)\219\&9\155\181",PropResponseInformation
// "\161d4\184\130\ETB\SUB\238\253\FS\141m\204a\bh\171I\EM\241\&8",PropWildcardSubscriptionAvailable
// 113,PropServerReference "A$\254|R\222\136\251\&6\247\223\132\158\248\213\161",PropMaximumPacketSize
// 18104,PropResponseInformation "\247\167-\SYN\170\136T1\FS\183x",PropSubscriptionIdentifierAvailable
// 245,PropSessionExpiryInterval 11538,PropMaximumPacketSize 16358,PropWildcardSubscriptionAvailable
// 192,PropReceiveMaximum 19034,PropResponseInformation "\164\r
// \201h\t\211\&0_\226'\DC2;;1\211\SOH\NUL",PropAuthenticationData "8RJ#\\Ko*J&\NUL\NUL nKj\188",PropReceiveMaximum
// 12561,PropContentType "\248\230\230=\129v \163z\247\167\222\253\245\187\255j\ETX\183",PropContentType
// "\192j%\162\231\223\136\189\CAN!N\171\"\128#\139\153\b\227\&9f\157\FS\244\242e\134\DLE",PropRequestProblemInformation
// 94,PropUserProperty "\EOTN\199>J\223G\201"
// "\191+P\245\199\181P\215\236\238\&2X\197\ACK\166)\173D,J\235",PropWildcardSubscriptionAvailable 98,PropTopicAlias
// 23734,PropMaximumPacketSize 10399,PropResponseInformation
// "m\DC2o{\ENQ\176D\241\173F\230\DEL\203\235\139\128\rc\SI\161PWV\195\t\150\236",PropUserProperty
// "\141g1\198\ESC\174D\155\153\254\128\SYN\GS" "\DC3\239%\204\134\236c\180\247V\206\SO\200\208\SO",PropServerReference
// "\230yf\EMo\140\234\"\139"]}), _cleanSession = True, _keepAlive = 488, _connID = "/\152\131mx1\208\&5", _properties =
// [PropTopicAliasMaximum 16695,PropTopicAlias 17555,PropServerReference "",PropWillDelayInterval
// 2609,PropMessageExpiryInterval 14470]}
TEST(Connect5QCTest, Encode94) {
  uint8_t pkt[] = {
      0x10, 0xb9, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x1,  0xe8, 0x13, 0x22, 0x41, 0x37, 0x23, 0x44,
      0x93, 0x1c, 0x0,  0x0,  0x18, 0x0,  0x0,  0xa,  0x31, 0x2,  0x0,  0x0,  0x38, 0x86, 0x0,  0x8,  0x2f, 0x98, 0x83,
      0x6d, 0x78, 0x31, 0xd0, 0x35, 0xcc, 0x2,  0xb,  0x12, 0x1f, 0x0,  0x1c, 0xd0, 0x23, 0x23, 0x2b, 0xb,  0xc6, 0x6c,
      0x8a, 0x98, 0x6c, 0x2,  0xe5, 0xdd, 0xf9, 0x72, 0xf0, 0xae, 0x67, 0x98, 0x5e, 0x1c, 0x57, 0x3a, 0x29, 0xdb, 0x39,
      0x9b, 0xb5, 0x1a, 0x0,  0x15, 0xa1, 0x64, 0x34, 0xb8, 0x82, 0x17, 0x1a, 0xee, 0xfd, 0x1c, 0x8d, 0x6d, 0xcc, 0x61,
      0x8,  0x68, 0xab, 0x49, 0x19, 0xf1, 0x38, 0x28, 0x71, 0x1c, 0x0,  0x10, 0x41, 0x24, 0xfe, 0x7c, 0x52, 0xde, 0x88,
      0xfb, 0x36, 0xf7, 0xdf, 0x84, 0x9e, 0xf8, 0xd5, 0xa1, 0x27, 0x0,  0x0,  0x46, 0xb8, 0x1a, 0x0,  0xb,  0xf7, 0xa7,
      0x2d, 0x16, 0xaa, 0x88, 0x54, 0x31, 0x1c, 0xb7, 0x78, 0x29, 0xf5, 0x11, 0x0,  0x0,  0x2d, 0x12, 0x27, 0x0,  0x0,
      0x3f, 0xe6, 0x28, 0xc0, 0x21, 0x4a, 0x5a, 0x1a, 0x0,  0x12, 0xa4, 0xd,  0x20, 0xc9, 0x68, 0x9,  0xd3, 0x30, 0x5f,
      0xe2, 0x27, 0x12, 0x3b, 0x3b, 0x31, 0xd3, 0x1,  0x0,  0x16, 0x0,  0x11, 0x38, 0x52, 0x4a, 0x23, 0x5c, 0x4b, 0x6f,
      0x2a, 0x4a, 0x26, 0x0,  0x0,  0x20, 0x6e, 0x4b, 0x6a, 0xbc, 0x21, 0x31, 0x11, 0x3,  0x0,  0x13, 0xf8, 0xe6, 0xe6,
      0x3d, 0x81, 0x76, 0x20, 0xa3, 0x7a, 0xf7, 0xa7, 0xde, 0xfd, 0xf5, 0xbb, 0xff, 0x6a, 0x3,  0xb7, 0x3,  0x0,  0x1c,
      0xc0, 0x6a, 0x25, 0xa2, 0xe7, 0xdf, 0x88, 0xbd, 0x18, 0x21, 0x4e, 0xab, 0x22, 0x80, 0x23, 0x8b, 0x99, 0x8,  0xe3,
      0x39, 0x66, 0x9d, 0x1c, 0xf4, 0xf2, 0x65, 0x86, 0x10, 0x17, 0x5e, 0x26, 0x0,  0x8,  0x4,  0x4e, 0xc7, 0x3e, 0x4a,
      0xdf, 0x47, 0xc9, 0x0,  0x15, 0xbf, 0x2b, 0x50, 0xf5, 0xc7, 0xb5, 0x50, 0xd7, 0xec, 0xee, 0x32, 0x58, 0xc5, 0x6,
      0xa6, 0x29, 0xad, 0x44, 0x2c, 0x4a, 0xeb, 0x28, 0x62, 0x23, 0x5c, 0xb6, 0x27, 0x0,  0x0,  0x28, 0x9f, 0x1a, 0x0,
      0x1b, 0x6d, 0x12, 0x6f, 0x7b, 0x5,  0xb0, 0x44, 0xf1, 0xad, 0x46, 0xe6, 0x7f, 0xcb, 0xeb, 0x8b, 0x80, 0xd,  0x63,
      0xf,  0xa1, 0x50, 0x57, 0x56, 0xc3, 0x9,  0x96, 0xec, 0x26, 0x0,  0xd,  0x8d, 0x67, 0x31, 0xc6, 0x1b, 0xae, 0x44,
      0x9b, 0x99, 0xfe, 0x80, 0x16, 0x1d, 0x0,  0xf,  0x13, 0xef, 0x25, 0xcc, 0x86, 0xec, 0x63, 0xb4, 0xf7, 0x56, 0xce,
      0xe,  0xc8, 0xd0, 0xe,  0x1c, 0x0,  0x9,  0xe6, 0x79, 0x66, 0x19, 0x6f, 0x8c, 0xea, 0x22, 0x8b, 0x0,  0x17, 0x1d,
      0xbb, 0x35, 0x9d, 0x5b, 0x2a, 0x6e, 0xa6, 0xe9, 0x53, 0xa8, 0x38, 0x9b, 0x14, 0xb1, 0x24, 0xa8, 0x71, 0xcc, 0xda,
      0xd,  0xd,  0x4a, 0x0,  0x15, 0xec, 0x5b, 0x73, 0x1b, 0x7a, 0xd9, 0x64, 0x57, 0x2,  0xde, 0x97, 0x30, 0x16, 0x42,
      0x95, 0x8,  0xbd, 0x66, 0x4b, 0x6a, 0x41, 0x0,  0xb,  0x2c, 0x64, 0x41, 0xa4, 0xca, 0x0,  0xa1, 0xd4, 0xa9, 0xb7,
      0x30, 0x0,  0x4,  0x18, 0x1a, 0xee, 0x30};

  uint8_t buf[454] = {0};

  uint8_t bytesprops0[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16695}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17555}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2609}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14470}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd0, 0x23, 0x23, 0x2b, 0xb,  0xc6, 0x6c, 0x8a, 0x98, 0x6c, 0x2,  0xe5, 0xdd, 0xf9,
                               0x72, 0xf0, 0xae, 0x67, 0x98, 0x5e, 0x1c, 0x57, 0x3a, 0x29, 0xdb, 0x39, 0x9b, 0xb5};
  uint8_t byteswillprops1[] = {0xa1, 0x64, 0x34, 0xb8, 0x82, 0x17, 0x1a, 0xee, 0xfd, 0x1c, 0x8d,
                               0x6d, 0xcc, 0x61, 0x8,  0x68, 0xab, 0x49, 0x19, 0xf1, 0x38};
  uint8_t byteswillprops2[] = {0x41, 0x24, 0xfe, 0x7c, 0x52, 0xde, 0x88, 0xfb,
                               0x36, 0xf7, 0xdf, 0x84, 0x9e, 0xf8, 0xd5, 0xa1};
  uint8_t byteswillprops3[] = {0xf7, 0xa7, 0x2d, 0x16, 0xaa, 0x88, 0x54, 0x31, 0x1c, 0xb7, 0x78};
  uint8_t byteswillprops4[] = {0xa4, 0xd,  0x20, 0xc9, 0x68, 0x9,  0xd3, 0x30, 0x5f,
                               0xe2, 0x27, 0x12, 0x3b, 0x3b, 0x31, 0xd3, 0x1,  0x0};
  uint8_t byteswillprops5[] = {0x38, 0x52, 0x4a, 0x23, 0x5c, 0x4b, 0x6f, 0x2a, 0x4a,
                               0x26, 0x0,  0x0,  0x20, 0x6e, 0x4b, 0x6a, 0xbc};
  uint8_t byteswillprops6[] = {0xf8, 0xe6, 0xe6, 0x3d, 0x81, 0x76, 0x20, 0xa3, 0x7a, 0xf7,
                               0xa7, 0xde, 0xfd, 0xf5, 0xbb, 0xff, 0x6a, 0x3,  0xb7};
  uint8_t byteswillprops7[] = {0xc0, 0x6a, 0x25, 0xa2, 0xe7, 0xdf, 0x88, 0xbd, 0x18, 0x21, 0x4e, 0xab, 0x22, 0x80,
                               0x23, 0x8b, 0x99, 0x8,  0xe3, 0x39, 0x66, 0x9d, 0x1c, 0xf4, 0xf2, 0x65, 0x86, 0x10};
  uint8_t byteswillprops9[] = {0xbf, 0x2b, 0x50, 0xf5, 0xc7, 0xb5, 0x50, 0xd7, 0xec, 0xee, 0x32,
                               0x58, 0xc5, 0x6,  0xa6, 0x29, 0xad, 0x44, 0x2c, 0x4a, 0xeb};
  uint8_t byteswillprops8[] = {0x4, 0x4e, 0xc7, 0x3e, 0x4a, 0xdf, 0x47, 0xc9};
  uint8_t byteswillprops10[] = {0x6d, 0x12, 0x6f, 0x7b, 0x5, 0xb0, 0x44, 0xf1, 0xad, 0x46, 0xe6, 0x7f, 0xcb, 0xeb,
                                0x8b, 0x80, 0xd,  0x63, 0xf, 0xa1, 0x50, 0x57, 0x56, 0xc3, 0x9,  0x96, 0xec};
  uint8_t byteswillprops12[] = {0x13, 0xef, 0x25, 0xcc, 0x86, 0xec, 0x63, 0xb4, 0xf7, 0x56, 0xce, 0xe, 0xc8, 0xd0, 0xe};
  uint8_t byteswillprops11[] = {0x8d, 0x67, 0x31, 0xc6, 0x1b, 0xae, 0x44, 0x9b, 0x99, 0xfe, 0x80, 0x16, 0x1d};
  uint8_t byteswillprops13[] = {0xe6, 0x79, 0x66, 0x19, 0x6f, 0x8c, 0xea, 0x22, 0x8b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18104}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11538}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16358}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19034}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12561}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops8}, .v = {21, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23734}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10399}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops11}, .v = {15, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops13}}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1d, 0xbb, 0x35, 0x9d, 0x5b, 0x2a, 0x6e, 0xa6, 0xe9, 0x53, 0xa8, 0x38,
                                0x9b, 0x14, 0xb1, 0x24, 0xa8, 0x71, 0xcc, 0xda, 0xd,  0xd,  0x4a};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xec, 0x5b, 0x73, 0x1b, 0x7a, 0xd9, 0x64, 0x57, 0x2,  0xde, 0x97,
                                  0x30, 0x16, 0x42, 0x95, 0x8,  0xbd, 0x66, 0x4b, 0x6a, 0x41};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 488;
  uint8_t client_id_bytes[] = {0x2f, 0x98, 0x83, 0x6d, 0x78, 0x31, 0xd0, 0x35};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2c, 0x64, 0x41, 0xa4, 0xca, 0x0, 0xa1, 0xd4, 0xa9, 0xb7, 0x30};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x1a, 0xee, 0x30};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "ox\192\209\133\220~\DC29B\182\239=\196Sa[R\ETB\NUL\US\248E",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\214ht\202Q:u\DC3\190\SYN\SYN\246\225\130\232X\196k%\RSV*\144\154\215\184\227", _willMsg = "t
// \164\CAN)\191\132\223\226\201\230\149\253N\189\218\215\&4\182Gy\247y\201", _willProps = [PropTopicAlias
// 18598,PropUserProperty "5" "i\194)\SI\220OI\r\208\155Z\192]ExD\230\240\167\&4",PropServerReference
// "\135\a\r\161\&18\230(u4cB5?.0\144\198\130g\184",PropReasonString "\129\206\194F\CANuN
// \216u\223/I\173\209\244\247\&1T\DEL\135<\187\FS\FSI\157\223\129\184",PropServerKeepAlive 30447]}), _cleanSession =
// True, _keepAlive = 24570, _connID = "K\"%j\DLE\STXu~\ESC\236\178\204S\151(?\245\214w;\r\255\&5!", _properties =
// [PropResponseTopic "\DC3P\229\204EU\190O\n\164\131\&7\188%",PropReceiveMaximum 26323,PropAuthenticationData
// "\199\251\129\STX\236\199\193\159\184yd\DC2\233\237\204\241\221\208l]\135\"\237\229uk\236\183\137\213"]}
TEST(Connect5QCTest, Encode95) {
  uint8_t pkt[] = {
      0x10, 0xeb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x5f, 0xfa, 0x35, 0x8,  0x0,  0xe,  0x13, 0x50,
      0xe5, 0xcc, 0x45, 0x55, 0xbe, 0x4f, 0xa,  0xa4, 0x83, 0x37, 0xbc, 0x25, 0x21, 0x66, 0xd3, 0x16, 0x0,  0x1e, 0xc7,
      0xfb, 0x81, 0x2,  0xec, 0xc7, 0xc1, 0x9f, 0xb8, 0x79, 0x64, 0x12, 0xe9, 0xed, 0xcc, 0xf1, 0xdd, 0xd0, 0x6c, 0x5d,
      0x87, 0x22, 0xed, 0xe5, 0x75, 0x6b, 0xec, 0xb7, 0x89, 0xd5, 0x0,  0x18, 0x4b, 0x22, 0x25, 0x6a, 0x10, 0x2,  0x75,
      0x7e, 0x1b, 0xec, 0xb2, 0xcc, 0x53, 0x97, 0x28, 0x3f, 0xf5, 0xd6, 0x77, 0x3b, 0xd,  0xff, 0x35, 0x21, 0x59, 0x23,
      0x48, 0xa6, 0x26, 0x0,  0x1,  0x35, 0x0,  0x14, 0x69, 0xc2, 0x29, 0xf,  0xdc, 0x4f, 0x49, 0xd,  0xd0, 0x9b, 0x5a,
      0xc0, 0x5d, 0x45, 0x78, 0x44, 0xe6, 0xf0, 0xa7, 0x34, 0x1c, 0x0,  0x15, 0x87, 0x7,  0xd,  0xa1, 0x31, 0x38, 0xe6,
      0x28, 0x75, 0x34, 0x63, 0x42, 0x35, 0x3f, 0x2e, 0x30, 0x90, 0xc6, 0x82, 0x67, 0xb8, 0x1f, 0x0,  0x1e, 0x81, 0xce,
      0xc2, 0x46, 0x18, 0x75, 0x4e, 0x20, 0xd8, 0x75, 0xdf, 0x2f, 0x49, 0xad, 0xd1, 0xf4, 0xf7, 0x31, 0x54, 0x7f, 0x87,
      0x3c, 0xbb, 0x1c, 0x1c, 0x49, 0x9d, 0xdf, 0x81, 0xb8, 0x13, 0x76, 0xef, 0x0,  0x1b, 0xd6, 0x68, 0x74, 0xca, 0x51,
      0x3a, 0x75, 0x13, 0xbe, 0x16, 0x16, 0xf6, 0xe1, 0x82, 0xe8, 0x58, 0xc4, 0x6b, 0x25, 0x1e, 0x56, 0x2a, 0x90, 0x9a,
      0xd7, 0xb8, 0xe3, 0x0,  0x18, 0x74, 0x20, 0xa4, 0x18, 0x29, 0xbf, 0x84, 0xdf, 0xe2, 0xc9, 0xe6, 0x95, 0xfd, 0x4e,
      0xbd, 0xda, 0xd7, 0x34, 0xb6, 0x47, 0x79, 0xf7, 0x79, 0xc9};

  uint8_t buf[248] = {0};

  uint8_t bytesprops0[] = {0x13, 0x50, 0xe5, 0xcc, 0x45, 0x55, 0xbe, 0x4f, 0xa, 0xa4, 0x83, 0x37, 0xbc, 0x25};
  uint8_t bytesprops1[] = {0xc7, 0xfb, 0x81, 0x2,  0xec, 0xc7, 0xc1, 0x9f, 0xb8, 0x79, 0x64, 0x12, 0xe9, 0xed, 0xcc,
                           0xf1, 0xdd, 0xd0, 0x6c, 0x5d, 0x87, 0x22, 0xed, 0xe5, 0x75, 0x6b, 0xec, 0xb7, 0x89, 0xd5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26323}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x69, 0xc2, 0x29, 0xf,  0xdc, 0x4f, 0x49, 0xd,  0xd0, 0x9b,
                               0x5a, 0xc0, 0x5d, 0x45, 0x78, 0x44, 0xe6, 0xf0, 0xa7, 0x34};
  uint8_t byteswillprops0[] = {0x35};
  uint8_t byteswillprops2[] = {0x87, 0x7,  0xd,  0xa1, 0x31, 0x38, 0xe6, 0x28, 0x75, 0x34, 0x63,
                               0x42, 0x35, 0x3f, 0x2e, 0x30, 0x90, 0xc6, 0x82, 0x67, 0xb8};
  uint8_t byteswillprops3[] = {0x81, 0xce, 0xc2, 0x46, 0x18, 0x75, 0x4e, 0x20, 0xd8, 0x75,
                               0xdf, 0x2f, 0x49, 0xad, 0xd1, 0xf4, 0xf7, 0x31, 0x54, 0x7f,
                               0x87, 0x3c, 0xbb, 0x1c, 0x1c, 0x49, 0x9d, 0xdf, 0x81, 0xb8};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18598}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {1, (char*)&byteswillprops0}, .v = {20, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30447}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd6, 0x68, 0x74, 0xca, 0x51, 0x3a, 0x75, 0x13, 0xbe, 0x16, 0x16, 0xf6, 0xe1, 0x82,
                                0xe8, 0x58, 0xc4, 0x6b, 0x25, 0x1e, 0x56, 0x2a, 0x90, 0x9a, 0xd7, 0xb8, 0xe3};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x74, 0x20, 0xa4, 0x18, 0x29, 0xbf, 0x84, 0xdf, 0xe2, 0xc9, 0xe6, 0x95,
                                  0xfd, 0x4e, 0xbd, 0xda, 0xd7, 0x34, 0xb6, 0x47, 0x79, 0xf7, 0x79, 0xc9};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24570;
  uint8_t client_id_bytes[] = {0x4b, 0x22, 0x25, 0x6a, 0x10, 0x2,  0x75, 0x7e, 0x1b, 0xec, 0xb2, 0xcc,
                               0x53, 0x97, 0x28, 0x3f, 0xf5, 0xd6, 0x77, 0x3b, 0xd,  0xff, 0x35, 0x21};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x6f, 0x78, 0xc0, 0xd1, 0x85, 0xdc, 0x7e, 0x12, 0x39, 0x42, 0xb6, 0xef,
                              0x3d, 0xc4, 0x53, 0x61, 0x5b, 0x52, 0x17, 0x0,  0x1f, 0xf8, 0x45};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\157LD\210\143*\189\134\&0\231\250\253\DC3\210\ETXh\178",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "|\157\175oRO\236\200|s\252\165x\155\f\205{\227\229\134\251u\146\144\248.", _willMsg =
// "R\242;\DC1D\209@\146\213\194Qz\230\DC3\213\RSk`\189a5\DLE\245", _willProps = [PropSubscriptionIdentifierAvailable
// 218,PropMaximumPacketSize 24888,PropAssignedClientIdentifier "\132\148\178\238\227
// \SYN\186x`\172\158h",PropSubscriptionIdentifierAvailable 246,PropSharedSubscriptionAvailable
// 110,PropPayloadFormatIndicator 59,PropAuthenticationData
// "\133\164!\202V\175\202\208\f/n\NUL\206W\242Y\237\160\238\236Y",PropSessionExpiryInterval
// 1237,PropSubscriptionIdentifierAvailable 196,PropSharedSubscriptionAvailable 232,PropMaximumQoS
// 79,PropMessageExpiryInterval 5045,PropUserProperty "\129K\209~I\DC1\rl\144\176F~4\131Wn3c\220\170\135]o\207(\164k"
// "\EOT\160",PropContentType
// "\159\SYNC\t\245\152\217|\167\242{l\186o\251\203\170\&5\GS\STX\169",PropSubscriptionIdentifierAvailable
// 5,PropReasonString "\155\133\&6\153\132o4\143O\RS\220q\DC3\RS\143",PropReceiveMaximum 26389,PropResponseTopic
// "Jq\184\229\146\180^L~\147}\241GW#\v\149\138\194\230\202",PropMessageExpiryInterval 22509,PropMaximumQoS
// 6,PropMaximumPacketSize 29831,PropMessageExpiryInterval 4338,PropMessageExpiryInterval 3098,PropAuthenticationMethod
// "\172\171;4\204XG\215\239\185\131={"]}), _cleanSession = False, _keepAlive = 10064, _connID =
// "\192u\185\&3\177\222-3\142\DLE\172\172\163\242\228P\178\180\ETB\198]c\131", _properties = [PropRetainAvailable
// 158,PropRetainAvailable 154,PropTopicAliasMaximum 25958,PropRetainAvailable 43,PropAuthenticationData
// "e\135\139z\130\a\172\207\197\175\SOH\200'\SOH\165\181",PropUserProperty "f)\"\242X\153"
// "\STX\219",PropMessageExpiryInterval 24476,PropReasonString
// "\242\159\212\245\211\SYNY\171;\134\174",PropWillDelayInterval 942,PropWildcardSubscriptionAvailable
// 122,PropResponseTopic "m%\226\241\247\193\211\ESC\150\226H0_\226iJa\208\155\226~\DC3\202\192",PropTopicAlias
// 21751,PropAuthenticationMethod "\209^\194",PropServerReference "\ETX\223\235\193+\138Mr\239\142",PropUserProperty
// "q;\184\240\150\ACKD\219M\193,5\170\155N\172\137\DC3\234N\154\176{\174\199\202v\134"
// "\179anxx\178\204\205\187\184\131H4\US7\163%f\250O\241/\222$\141\174",PropWillDelayInterval
// 288,PropAssignedClientIdentifier "\159\EOT3'\rw\231\213?",PropContentType
// "\GS[aW\t2\192\USBN\128\186\198+>\243\155\186O?\143",PropReceiveMaximum 24840,PropReceiveMaximum
// 22186,PropMessageExpiryInterval 27150,PropServerReference ".mL\SO\146K\188\159\157.\248c.\178",PropTopicAlias
// 14699,PropContentType "?\ESC\157\170\195T~\153\155\181\239\a\207_\156e\SYNw\130\219",PropTopicAliasMaximum
// 32514,PropRequestProblemInformation 70,PropResponseTopic "\212\181\RS\157a\224\247",PropServerReference
// "\187\208\173{u.=\200\DC4wgJ~\253\152S\DC1s\ACK\209",PropSubscriptionIdentifier 22]}
TEST(Connect5QCTest, Encode96) {
  uint8_t pkt[] = {
      0x10, 0xe6, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x34, 0x27, 0x50, 0xb6, 0x2,  0x25, 0x9e, 0x25, 0x9a,
      0x22, 0x65, 0x66, 0x25, 0x2b, 0x16, 0x0,  0x10, 0x65, 0x87, 0x8b, 0x7a, 0x82, 0x7,  0xac, 0xcf, 0xc5, 0xaf, 0x1,
      0xc8, 0x27, 0x1,  0xa5, 0xb5, 0x26, 0x0,  0x6,  0x66, 0x29, 0x22, 0xf2, 0x58, 0x99, 0x0,  0x2,  0x2,  0xdb, 0x2,
      0x0,  0x0,  0x5f, 0x9c, 0x1f, 0x0,  0xb,  0xf2, 0x9f, 0xd4, 0xf5, 0xd3, 0x16, 0x59, 0xab, 0x3b, 0x86, 0xae, 0x18,
      0x0,  0x0,  0x3,  0xae, 0x28, 0x7a, 0x8,  0x0,  0x18, 0x6d, 0x25, 0xe2, 0xf1, 0xf7, 0xc1, 0xd3, 0x1b, 0x96, 0xe2,
      0x48, 0x30, 0x5f, 0xe2, 0x69, 0x4a, 0x61, 0xd0, 0x9b, 0xe2, 0x7e, 0x13, 0xca, 0xc0, 0x23, 0x54, 0xf7, 0x15, 0x0,
      0x3,  0xd1, 0x5e, 0xc2, 0x1c, 0x0,  0xa,  0x3,  0xdf, 0xeb, 0xc1, 0x2b, 0x8a, 0x4d, 0x72, 0xef, 0x8e, 0x26, 0x0,
      0x1c, 0x71, 0x3b, 0xb8, 0xf0, 0x96, 0x6,  0x44, 0xdb, 0x4d, 0xc1, 0x2c, 0x35, 0xaa, 0x9b, 0x4e, 0xac, 0x89, 0x13,
      0xea, 0x4e, 0x9a, 0xb0, 0x7b, 0xae, 0xc7, 0xca, 0x76, 0x86, 0x0,  0x1a, 0xb3, 0x61, 0x6e, 0x78, 0x78, 0xb2, 0xcc,
      0xcd, 0xbb, 0xb8, 0x83, 0x48, 0x34, 0x1f, 0x37, 0xa3, 0x25, 0x66, 0xfa, 0x4f, 0xf1, 0x2f, 0xde, 0x24, 0x8d, 0xae,
      0x18, 0x0,  0x0,  0x1,  0x20, 0x12, 0x0,  0x9,  0x9f, 0x4,  0x33, 0x27, 0xd,  0x77, 0xe7, 0xd5, 0x3f, 0x3,  0x0,
      0x15, 0x1d, 0x5b, 0x61, 0x57, 0x9,  0x32, 0xc0, 0x1f, 0x42, 0x4e, 0x80, 0xba, 0xc6, 0x2b, 0x3e, 0xf3, 0x9b, 0xba,
      0x4f, 0x3f, 0x8f, 0x21, 0x61, 0x8,  0x21, 0x56, 0xaa, 0x2,  0x0,  0x0,  0x6a, 0xe,  0x1c, 0x0,  0xe,  0x2e, 0x6d,
      0x4c, 0xe,  0x92, 0x4b, 0xbc, 0x9f, 0x9d, 0x2e, 0xf8, 0x63, 0x2e, 0xb2, 0x23, 0x39, 0x6b, 0x3,  0x0,  0x14, 0x3f,
      0x1b, 0x9d, 0xaa, 0xc3, 0x54, 0x7e, 0x99, 0x9b, 0xb5, 0xef, 0x7,  0xcf, 0x5f, 0x9c, 0x65, 0x16, 0x77, 0x82, 0xdb,
      0x22, 0x7f, 0x2,  0x17, 0x46, 0x8,  0x0,  0x7,  0xd4, 0xb5, 0x1e, 0x9d, 0x61, 0xe0, 0xf7, 0x1c, 0x0,  0x14, 0xbb,
      0xd0, 0xad, 0x7b, 0x75, 0x2e, 0x3d, 0xc8, 0x14, 0x77, 0x67, 0x4a, 0x7e, 0xfd, 0x98, 0x53, 0x11, 0x73, 0x6,  0xd1,
      0xb,  0x16, 0x0,  0x17, 0xc0, 0x75, 0xb9, 0x33, 0xb1, 0xde, 0x2d, 0x33, 0x8e, 0x10, 0xac, 0xac, 0xa3, 0xf2, 0xe4,
      0x50, 0xb2, 0xb4, 0x17, 0xc6, 0x5d, 0x63, 0x83, 0xd4, 0x1,  0x29, 0xda, 0x27, 0x0,  0x0,  0x61, 0x38, 0x12, 0x0,
      0xd,  0x84, 0x94, 0xb2, 0xee, 0xe3, 0x20, 0x16, 0xba, 0x78, 0x60, 0xac, 0x9e, 0x68, 0x29, 0xf6, 0x2a, 0x6e, 0x1,
      0x3b, 0x16, 0x0,  0x15, 0x85, 0xa4, 0x21, 0xca, 0x56, 0xaf, 0xca, 0xd0, 0xc,  0x2f, 0x6e, 0x0,  0xce, 0x57, 0xf2,
      0x59, 0xed, 0xa0, 0xee, 0xec, 0x59, 0x11, 0x0,  0x0,  0x4,  0xd5, 0x29, 0xc4, 0x2a, 0xe8, 0x24, 0x4f, 0x2,  0x0,
      0x0,  0x13, 0xb5, 0x26, 0x0,  0x1b, 0x81, 0x4b, 0xd1, 0x7e, 0x49, 0x11, 0xd,  0x6c, 0x90, 0xb0, 0x46, 0x7e, 0x34,
      0x83, 0x57, 0x6e, 0x33, 0x63, 0xdc, 0xaa, 0x87, 0x5d, 0x6f, 0xcf, 0x28, 0xa4, 0x6b, 0x0,  0x2,  0x4,  0xa0, 0x3,
      0x0,  0x15, 0x9f, 0x16, 0x43, 0x9,  0xf5, 0x98, 0xd9, 0x7c, 0xa7, 0xf2, 0x7b, 0x6c, 0xba, 0x6f, 0xfb, 0xcb, 0xaa,
      0x35, 0x1d, 0x2,  0xa9, 0x29, 0x5,  0x1f, 0x0,  0xf,  0x9b, 0x85, 0x36, 0x99, 0x84, 0x6f, 0x34, 0x8f, 0x4f, 0x1e,
      0xdc, 0x71, 0x13, 0x1e, 0x8f, 0x21, 0x67, 0x15, 0x8,  0x0,  0x15, 0x4a, 0x71, 0xb8, 0xe5, 0x92, 0xb4, 0x5e, 0x4c,
      0x7e, 0x93, 0x7d, 0xf1, 0x47, 0x57, 0x23, 0xb,  0x95, 0x8a, 0xc2, 0xe6, 0xca, 0x2,  0x0,  0x0,  0x57, 0xed, 0x24,
      0x6,  0x27, 0x0,  0x0,  0x74, 0x87, 0x2,  0x0,  0x0,  0x10, 0xf2, 0x2,  0x0,  0x0,  0xc,  0x1a, 0x15, 0x0,  0xd,
      0xac, 0xab, 0x3b, 0x34, 0xcc, 0x58, 0x47, 0xd7, 0xef, 0xb9, 0x83, 0x3d, 0x7b, 0x0,  0x1a, 0x7c, 0x9d, 0xaf, 0x6f,
      0x52, 0x4f, 0xec, 0xc8, 0x7c, 0x73, 0xfc, 0xa5, 0x78, 0x9b, 0xc,  0xcd, 0x7b, 0xe3, 0xe5, 0x86, 0xfb, 0x75, 0x92,
      0x90, 0xf8, 0x2e, 0x0,  0x17, 0x52, 0xf2, 0x3b, 0x11, 0x44, 0xd1, 0x40, 0x92, 0xd5, 0xc2, 0x51, 0x7a, 0xe6, 0x13,
      0xd5, 0x1e, 0x6b, 0x60, 0xbd, 0x61, 0x35, 0x10, 0xf5};

  uint8_t buf[627] = {0};

  uint8_t bytesprops0[] = {0x65, 0x87, 0x8b, 0x7a, 0x82, 0x7, 0xac, 0xcf, 0xc5, 0xaf, 0x1, 0xc8, 0x27, 0x1, 0xa5, 0xb5};
  uint8_t bytesprops2[] = {0x2, 0xdb};
  uint8_t bytesprops1[] = {0x66, 0x29, 0x22, 0xf2, 0x58, 0x99};
  uint8_t bytesprops3[] = {0xf2, 0x9f, 0xd4, 0xf5, 0xd3, 0x16, 0x59, 0xab, 0x3b, 0x86, 0xae};
  uint8_t bytesprops4[] = {0x6d, 0x25, 0xe2, 0xf1, 0xf7, 0xc1, 0xd3, 0x1b, 0x96, 0xe2, 0x48, 0x30,
                           0x5f, 0xe2, 0x69, 0x4a, 0x61, 0xd0, 0x9b, 0xe2, 0x7e, 0x13, 0xca, 0xc0};
  uint8_t bytesprops5[] = {0xd1, 0x5e, 0xc2};
  uint8_t bytesprops6[] = {0x3, 0xdf, 0xeb, 0xc1, 0x2b, 0x8a, 0x4d, 0x72, 0xef, 0x8e};
  uint8_t bytesprops8[] = {0xb3, 0x61, 0x6e, 0x78, 0x78, 0xb2, 0xcc, 0xcd, 0xbb, 0xb8, 0x83, 0x48, 0x34,
                           0x1f, 0x37, 0xa3, 0x25, 0x66, 0xfa, 0x4f, 0xf1, 0x2f, 0xde, 0x24, 0x8d, 0xae};
  uint8_t bytesprops7[] = {0x71, 0x3b, 0xb8, 0xf0, 0x96, 0x6,  0x44, 0xdb, 0x4d, 0xc1, 0x2c, 0x35, 0xaa, 0x9b,
                           0x4e, 0xac, 0x89, 0x13, 0xea, 0x4e, 0x9a, 0xb0, 0x7b, 0xae, 0xc7, 0xca, 0x76, 0x86};
  uint8_t bytesprops9[] = {0x9f, 0x4, 0x33, 0x27, 0xd, 0x77, 0xe7, 0xd5, 0x3f};
  uint8_t bytesprops10[] = {0x1d, 0x5b, 0x61, 0x57, 0x9,  0x32, 0xc0, 0x1f, 0x42, 0x4e, 0x80,
                            0xba, 0xc6, 0x2b, 0x3e, 0xf3, 0x9b, 0xba, 0x4f, 0x3f, 0x8f};
  uint8_t bytesprops11[] = {0x2e, 0x6d, 0x4c, 0xe, 0x92, 0x4b, 0xbc, 0x9f, 0x9d, 0x2e, 0xf8, 0x63, 0x2e, 0xb2};
  uint8_t bytesprops12[] = {0x3f, 0x1b, 0x9d, 0xaa, 0xc3, 0x54, 0x7e, 0x99, 0x9b, 0xb5,
                            0xef, 0x7,  0xcf, 0x5f, 0x9c, 0x65, 0x16, 0x77, 0x82, 0xdb};
  uint8_t bytesprops13[] = {0xd4, 0xb5, 0x1e, 0x9d, 0x61, 0xe0, 0xf7};
  uint8_t bytesprops14[] = {0xbb, 0xd0, 0xad, 0x7b, 0x75, 0x2e, 0x3d, 0xc8, 0x14, 0x77,
                            0x67, 0x4a, 0x7e, 0xfd, 0x98, 0x53, 0x11, 0x73, 0x6,  0xd1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25958}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {2, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24476}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 942}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21751}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops7}, .v = {26, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 288}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24840}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22186}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27150}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14699}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32514}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x84, 0x94, 0xb2, 0xee, 0xe3, 0x20, 0x16, 0xba, 0x78, 0x60, 0xac, 0x9e, 0x68};
  uint8_t byteswillprops1[] = {0x85, 0xa4, 0x21, 0xca, 0x56, 0xaf, 0xca, 0xd0, 0xc,  0x2f, 0x6e,
                               0x0,  0xce, 0x57, 0xf2, 0x59, 0xed, 0xa0, 0xee, 0xec, 0x59};
  uint8_t byteswillprops3[] = {0x4, 0xa0};
  uint8_t byteswillprops2[] = {0x81, 0x4b, 0xd1, 0x7e, 0x49, 0x11, 0xd,  0x6c, 0x90, 0xb0, 0x46, 0x7e, 0x34, 0x83,
                               0x57, 0x6e, 0x33, 0x63, 0xdc, 0xaa, 0x87, 0x5d, 0x6f, 0xcf, 0x28, 0xa4, 0x6b};
  uint8_t byteswillprops4[] = {0x9f, 0x16, 0x43, 0x9,  0xf5, 0x98, 0xd9, 0x7c, 0xa7, 0xf2, 0x7b,
                               0x6c, 0xba, 0x6f, 0xfb, 0xcb, 0xaa, 0x35, 0x1d, 0x2,  0xa9};
  uint8_t byteswillprops5[] = {0x9b, 0x85, 0x36, 0x99, 0x84, 0x6f, 0x34, 0x8f,
                               0x4f, 0x1e, 0xdc, 0x71, 0x13, 0x1e, 0x8f};
  uint8_t byteswillprops6[] = {0x4a, 0x71, 0xb8, 0xe5, 0x92, 0xb4, 0x5e, 0x4c, 0x7e, 0x93, 0x7d,
                               0xf1, 0x47, 0x57, 0x23, 0xb,  0x95, 0x8a, 0xc2, 0xe6, 0xca};
  uint8_t byteswillprops7[] = {0xac, 0xab, 0x3b, 0x34, 0xcc, 0x58, 0x47, 0xd7, 0xef, 0xb9, 0x83, 0x3d, 0x7b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24888}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1237}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5045}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {27, (char*)&byteswillprops2}, .v = {2, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26389}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22509}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29831}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4338}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3098}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x9d, 0xaf, 0x6f, 0x52, 0x4f, 0xec, 0xc8, 0x7c, 0x73, 0xfc, 0xa5, 0x78,
                                0x9b, 0xc,  0xcd, 0x7b, 0xe3, 0xe5, 0x86, 0xfb, 0x75, 0x92, 0x90, 0xf8, 0x2e};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x52, 0xf2, 0x3b, 0x11, 0x44, 0xd1, 0x40, 0x92, 0xd5, 0xc2, 0x51, 0x7a,
                                  0xe6, 0x13, 0xd5, 0x1e, 0x6b, 0x60, 0xbd, 0x61, 0x35, 0x10, 0xf5};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10064;
  uint8_t client_id_bytes[] = {0xc0, 0x75, 0xb9, 0x33, 0xb1, 0xde, 0x2d, 0x33, 0x8e, 0x10, 0xac, 0xac,
                               0xa3, 0xf2, 0xe4, 0x50, 0xb2, 0xb4, 0x17, 0xc6, 0x5d, 0x63, 0x83};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9d, 0x4c, 0x44, 0xd2, 0x8f, 0x2a, 0xbd, 0x86, 0x30,
                              0xe7, 0xfa, 0xfd, 0x13, 0xd2, 0x3,  0x68, 0xb2};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\136a6\248", _password = Just "aW\205\150\ACK*\208", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 27816, _connID = "\200\194\195y\163\178", _properties = [PropWillDelayInterval
// 4578,PropRequestProblemInformation 132,PropSharedSubscriptionAvailable 114,PropWildcardSubscriptionAvailable
// 89,PropAssignedClientIdentifier "\DELK9 \219\148ag\184\229d\164~\232\133\156\237\243\218\NAK9\221\nFy"]}
TEST(Connect5QCTest, Encode97) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x6c, 0xa8, 0x27, 0x18, 0x0,
                   0x0,  0x11, 0xe2, 0x17, 0x84, 0x2a, 0x72, 0x28, 0x59, 0x12, 0x0,  0x19, 0x7f, 0x4b, 0x39,
                   0x20, 0xdb, 0x94, 0x61, 0x67, 0xb8, 0xe5, 0x64, 0xa4, 0x7e, 0xe8, 0x85, 0x9c, 0xed, 0xf3,
                   0xda, 0x15, 0x39, 0xdd, 0xa,  0x46, 0x79, 0x0,  0x6,  0xc8, 0xc2, 0xc3, 0x79, 0xa3, 0xb2,
                   0x0,  0x4,  0x88, 0x61, 0x36, 0xf8, 0x0,  0x7,  0x61, 0x57, 0xcd, 0x96, 0x6,  0x2a, 0xd0};

  uint8_t buf[85] = {0};

  uint8_t bytesprops0[] = {0x7f, 0x4b, 0x39, 0x20, 0xdb, 0x94, 0x61, 0x67, 0xb8, 0xe5, 0x64, 0xa4, 0x7e,
                           0xe8, 0x85, 0x9c, 0xed, 0xf3, 0xda, 0x15, 0x39, 0xdd, 0xa,  0x46, 0x79};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4578}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27816;
  uint8_t client_id_bytes[] = {0xc8, 0xc2, 0xc3, 0x79, 0xa3, 0xb2};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x88, 0x61, 0x36, 0xf8};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x61, 0x57, 0xcd, 0x96, 0x6, 0x2a, 0xd0};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Y2\vz\196.", _password = Just
// "Z+\195-\233*,\232\192\178w\"\201\188X\DELI\165\144\170\n\161bdTr", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = ":\152<\197\228\170\235[\NUL\207I\169=\149\NAK\225$\r\224\220\173\133EX", _willMsg =
// "E\225^YZ\STX\161\CANS\130>\215e\rU", _willProps = [PropServerKeepAlive 5351,PropSharedSubscriptionAvailable
// 40,PropWillDelayInterval 16062,PropPayloadFormatIndicator 215,PropAssignedClientIdentifier
// "\204m",PropServerReference "\RS\142U\199\244z\133x^y",PropContentType "\ETB\219\GS",PropContentType "
// \235\223\ETX:u\211\230\166 \r[\166\253~}\138\201G1\147",PropServerKeepAlive 32098,PropMaximumPacketSize
// 8075,PropRequestProblemInformation 143,PropWildcardSubscriptionAvailable 233,PropMaximumPacketSize
// 21067,PropServerKeepAlive 12021,PropMessageExpiryInterval 3499,PropContentType
// "V\157\r\167\136A\228\204\176\173V4\239E\138\129\184\189\249\208\203[\132\248/",PropMaximumPacketSize
// 13183,PropWillDelayInterval 18332,PropResponseTopic "\193\213\187J",PropPayloadFormatIndicator
// 137,PropPayloadFormatIndicator 88,PropRequestProblemInformation 95,PropRetainAvailable
// 117,PropRequestProblemInformation 107]}), _cleanSession = False, _keepAlive = 12906, _connID =
// "e\161\220F\196\187*\\H\151\188i\177\188\172\240", _properties = []}
TEST(Connect5QCTest, Encode98) {
  uint8_t pkt[] = {0x10, 0xfa, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x32, 0x6a, 0x0,  0x0,  0x10, 0x65,
                   0xa1, 0xdc, 0x46, 0xc4, 0xbb, 0x2a, 0x5c, 0x48, 0x97, 0xbc, 0x69, 0xb1, 0xbc, 0xac, 0xf0, 0x8c, 0x1,
                   0x13, 0x14, 0xe7, 0x2a, 0x28, 0x18, 0x0,  0x0,  0x3e, 0xbe, 0x1,  0xd7, 0x12, 0x0,  0x2,  0xcc, 0x6d,
                   0x1c, 0x0,  0xa,  0x1e, 0x8e, 0x55, 0xc7, 0xf4, 0x7a, 0x85, 0x78, 0x5e, 0x79, 0x3,  0x0,  0x3,  0x17,
                   0xdb, 0x1d, 0x3,  0x0,  0x15, 0x20, 0xeb, 0xdf, 0x3,  0x3a, 0x75, 0xd3, 0xe6, 0xa6, 0x20, 0xd,  0x5b,
                   0xa6, 0xfd, 0x7e, 0x7d, 0x8a, 0xc9, 0x47, 0x31, 0x93, 0x13, 0x7d, 0x62, 0x27, 0x0,  0x0,  0x1f, 0x8b,
                   0x17, 0x8f, 0x28, 0xe9, 0x27, 0x0,  0x0,  0x52, 0x4b, 0x13, 0x2e, 0xf5, 0x2,  0x0,  0x0,  0xd,  0xab,
                   0x3,  0x0,  0x19, 0x56, 0x9d, 0xd,  0xa7, 0x88, 0x41, 0xe4, 0xcc, 0xb0, 0xad, 0x56, 0x34, 0xef, 0x45,
                   0x8a, 0x81, 0xb8, 0xbd, 0xf9, 0xd0, 0xcb, 0x5b, 0x84, 0xf8, 0x2f, 0x27, 0x0,  0x0,  0x33, 0x7f, 0x18,
                   0x0,  0x0,  0x47, 0x9c, 0x8,  0x0,  0x4,  0xc1, 0xd5, 0xbb, 0x4a, 0x1,  0x89, 0x1,  0x58, 0x17, 0x5f,
                   0x25, 0x75, 0x17, 0x6b, 0x0,  0x18, 0x3a, 0x98, 0x3c, 0xc5, 0xe4, 0xaa, 0xeb, 0x5b, 0x0,  0xcf, 0x49,
                   0xa9, 0x3d, 0x95, 0x15, 0xe1, 0x24, 0xd,  0xe0, 0xdc, 0xad, 0x85, 0x45, 0x58, 0x0,  0xf,  0x45, 0xe1,
                   0x5e, 0x59, 0x5a, 0x2,  0xa1, 0x18, 0x53, 0x82, 0x3e, 0xd7, 0x65, 0xd,  0x55, 0x0,  0x6,  0x59, 0x32,
                   0xb,  0x7a, 0xc4, 0x2e, 0x0,  0x1a, 0x5a, 0x2b, 0xc3, 0x2d, 0xe9, 0x2a, 0x2c, 0xe8, 0xc0, 0xb2, 0x77,
                   0x22, 0xc9, 0xbc, 0x58, 0x7f, 0x49, 0xa5, 0x90, 0xaa, 0xa,  0xa1, 0x62, 0x64, 0x54, 0x72};

  uint8_t buf[263] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xcc, 0x6d};
  uint8_t byteswillprops1[] = {0x1e, 0x8e, 0x55, 0xc7, 0xf4, 0x7a, 0x85, 0x78, 0x5e, 0x79};
  uint8_t byteswillprops2[] = {0x17, 0xdb, 0x1d};
  uint8_t byteswillprops3[] = {0x20, 0xeb, 0xdf, 0x3,  0x3a, 0x75, 0xd3, 0xe6, 0xa6, 0x20, 0xd,
                               0x5b, 0xa6, 0xfd, 0x7e, 0x7d, 0x8a, 0xc9, 0x47, 0x31, 0x93};
  uint8_t byteswillprops4[] = {0x56, 0x9d, 0xd,  0xa7, 0x88, 0x41, 0xe4, 0xcc, 0xb0, 0xad, 0x56, 0x34, 0xef,
                               0x45, 0x8a, 0x81, 0xb8, 0xbd, 0xf9, 0xd0, 0xcb, 0x5b, 0x84, 0xf8, 0x2f};
  uint8_t byteswillprops5[] = {0xc1, 0xd5, 0xbb, 0x4a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5351}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16062}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32098}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8075}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21067}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12021}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3499}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13183}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18332}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3a, 0x98, 0x3c, 0xc5, 0xe4, 0xaa, 0xeb, 0x5b, 0x0,  0xcf, 0x49, 0xa9,
                                0x3d, 0x95, 0x15, 0xe1, 0x24, 0xd,  0xe0, 0xdc, 0xad, 0x85, 0x45, 0x58};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x45, 0xe1, 0x5e, 0x59, 0x5a, 0x2, 0xa1, 0x18,
                                  0x53, 0x82, 0x3e, 0xd7, 0x65, 0xd, 0x55};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12906;
  uint8_t client_id_bytes[] = {0x65, 0xa1, 0xdc, 0x46, 0xc4, 0xbb, 0x2a, 0x5c,
                               0x48, 0x97, 0xbc, 0x69, 0xb1, 0xbc, 0xac, 0xf0};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x59, 0x32, 0xb, 0x7a, 0xc4, 0x2e};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5a, 0x2b, 0xc3, 0x2d, 0xe9, 0x2a, 0x2c, 0xe8, 0xc0, 0xb2, 0x77, 0x22, 0xc9,
                              0xbc, 0x58, 0x7f, 0x49, 0xa5, 0x90, 0xaa, 0xa,  0xa1, 0x62, 0x64, 0x54, 0x72};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 19412, _connID = "\188=\183\NAK\DLE~\SYN\241", _properties = [PropMessageExpiryInterval 21066,PropAuthenticationData
// "C\203*\185*\211\218,\157F;\222",PropAuthenticationData "\RSB\229B\239u\205g\211\204",PropContentType
// "",PropMaximumQoS 61,PropSubscriptionIdentifier 12,PropMessageExpiryInterval 7641,PropResponseInformation
// "\157,\237\241\NUL\SYN\248=o\186_\140\209\134c\t",PropServerKeepAlive 7496,PropResponseInformation
// "K\GS\133\238+\182\ETX\150|l-6(\168\&1\187s~Ly~\GS\v\143",PropSharedSubscriptionAvailable
// 218,PropWildcardSubscriptionAvailable 151,PropAuthenticationData
// "\SUB[\ACK\GS\216\v\244\218\&9q\ETX!\252/\202\186\167E}!Ih\137\196\238L\152V(\156",PropAuthenticationData
// "\202q\166\144\190H\234(",PropResponseTopic "\134\142\212\228",PropTopicAlias 17133,PropAuthenticationData
// "f\DC3\NUL\187l",PropReceiveMaximum 28577,PropAuthenticationData "\f\210\227\234&",PropRequestResponseInformation
// 13,PropWildcardSubscriptionAvailable 114,PropSubscriptionIdentifier 31,PropRequestProblemInformation
// 252,PropResponseTopic "\215\178M\205\b\144\&4$\164Q\170)\246\210\RS",PropSessionExpiryInterval
// 12656,PropPayloadFormatIndicator 71,PropMessageExpiryInterval 22660,PropServerKeepAlive 29280,PropMaximumPacketSize
// 13910,PropAuthenticationData "\170L$\217\168\225\216N\250\130@\179\STX\NULo\223"]}
TEST(Connect5QCTest, Encode99) {
  uint8_t pkt[] = {
      0x10, 0x82, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x4b, 0xd4, 0xec, 0x1,  0x2,  0x0,  0x0,  0x52,
      0x4a, 0x16, 0x0,  0xc,  0x43, 0xcb, 0x2a, 0xb9, 0x2a, 0xd3, 0xda, 0x2c, 0x9d, 0x46, 0x3b, 0xde, 0x16, 0x0,  0xa,
      0x1e, 0x42, 0xe5, 0x42, 0xef, 0x75, 0xcd, 0x67, 0xd3, 0xcc, 0x3,  0x0,  0x0,  0x24, 0x3d, 0xb,  0xc,  0x2,  0x0,
      0x0,  0x1d, 0xd9, 0x1a, 0x0,  0x10, 0x9d, 0x2c, 0xed, 0xf1, 0x0,  0x16, 0xf8, 0x3d, 0x6f, 0xba, 0x5f, 0x8c, 0xd1,
      0x86, 0x63, 0x9,  0x13, 0x1d, 0x48, 0x1a, 0x0,  0x18, 0x4b, 0x1d, 0x85, 0xee, 0x2b, 0xb6, 0x3,  0x96, 0x7c, 0x6c,
      0x2d, 0x36, 0x28, 0xa8, 0x31, 0xbb, 0x73, 0x7e, 0x4c, 0x79, 0x7e, 0x1d, 0xb,  0x8f, 0x2a, 0xda, 0x28, 0x97, 0x16,
      0x0,  0x1e, 0x1a, 0x5b, 0x6,  0x1d, 0xd8, 0xb,  0xf4, 0xda, 0x39, 0x71, 0x3,  0x21, 0xfc, 0x2f, 0xca, 0xba, 0xa7,
      0x45, 0x7d, 0x21, 0x49, 0x68, 0x89, 0xc4, 0xee, 0x4c, 0x98, 0x56, 0x28, 0x9c, 0x16, 0x0,  0x8,  0xca, 0x71, 0xa6,
      0x90, 0xbe, 0x48, 0xea, 0x28, 0x8,  0x0,  0x4,  0x86, 0x8e, 0xd4, 0xe4, 0x23, 0x42, 0xed, 0x16, 0x0,  0x5,  0x66,
      0x13, 0x0,  0xbb, 0x6c, 0x21, 0x6f, 0xa1, 0x16, 0x0,  0x5,  0xc,  0xd2, 0xe3, 0xea, 0x26, 0x19, 0xd,  0x28, 0x72,
      0xb,  0x1f, 0x17, 0xfc, 0x8,  0x0,  0xf,  0xd7, 0xb2, 0x4d, 0xcd, 0x8,  0x90, 0x34, 0x24, 0xa4, 0x51, 0xaa, 0x29,
      0xf6, 0xd2, 0x1e, 0x11, 0x0,  0x0,  0x31, 0x70, 0x1,  0x47, 0x2,  0x0,  0x0,  0x58, 0x84, 0x13, 0x72, 0x60, 0x27,
      0x0,  0x0,  0x36, 0x56, 0x16, 0x0,  0x10, 0xaa, 0x4c, 0x24, 0xd9, 0xa8, 0xe1, 0xd8, 0x4e, 0xfa, 0x82, 0x40, 0xb3,
      0x2,  0x0,  0x6f, 0xdf, 0x0,  0x8,  0xbc, 0x3d, 0xb7, 0x15, 0x10, 0x7e, 0x16, 0xf1};

  uint8_t buf[271] = {0};

  uint8_t bytesprops0[] = {0x43, 0xcb, 0x2a, 0xb9, 0x2a, 0xd3, 0xda, 0x2c, 0x9d, 0x46, 0x3b, 0xde};
  uint8_t bytesprops1[] = {0x1e, 0x42, 0xe5, 0x42, 0xef, 0x75, 0xcd, 0x67, 0xd3, 0xcc};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x9d, 0x2c, 0xed, 0xf1, 0x0,  0x16, 0xf8, 0x3d,
                           0x6f, 0xba, 0x5f, 0x8c, 0xd1, 0x86, 0x63, 0x9};
  uint8_t bytesprops4[] = {0x4b, 0x1d, 0x85, 0xee, 0x2b, 0xb6, 0x3,  0x96, 0x7c, 0x6c, 0x2d, 0x36,
                           0x28, 0xa8, 0x31, 0xbb, 0x73, 0x7e, 0x4c, 0x79, 0x7e, 0x1d, 0xb,  0x8f};
  uint8_t bytesprops5[] = {0x1a, 0x5b, 0x6,  0x1d, 0xd8, 0xb,  0xf4, 0xda, 0x39, 0x71, 0x3,  0x21, 0xfc, 0x2f, 0xca,
                           0xba, 0xa7, 0x45, 0x7d, 0x21, 0x49, 0x68, 0x89, 0xc4, 0xee, 0x4c, 0x98, 0x56, 0x28, 0x9c};
  uint8_t bytesprops6[] = {0xca, 0x71, 0xa6, 0x90, 0xbe, 0x48, 0xea, 0x28};
  uint8_t bytesprops7[] = {0x86, 0x8e, 0xd4, 0xe4};
  uint8_t bytesprops8[] = {0x66, 0x13, 0x0, 0xbb, 0x6c};
  uint8_t bytesprops9[] = {0xc, 0xd2, 0xe3, 0xea, 0x26};
  uint8_t bytesprops10[] = {0xd7, 0xb2, 0x4d, 0xcd, 0x8, 0x90, 0x34, 0x24, 0xa4, 0x51, 0xaa, 0x29, 0xf6, 0xd2, 0x1e};
  uint8_t bytesprops11[] = {0xaa, 0x4c, 0x24, 0xd9, 0xa8, 0xe1, 0xd8, 0x4e,
                            0xfa, 0x82, 0x40, 0xb3, 0x2,  0x0,  0x6f, 0xdf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21066}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7641}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7496}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17133}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28577}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12656}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22660}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29280}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13910}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19412;
  uint8_t client_id_bytes[] = {0xbc, 0x3d, 0xb7, 0x15, 0x10, 0x7e, 0x16, 0xf1};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\213Z6\DC4\128\136\188%", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "|\RS\164\178\193a", _willMsg =
// "O\197\240\214\DC1$j5y^\EM\222\253+\DC1\147}", _willProps = [PropWillDelayInterval 26708,PropAuthenticationData
// "\164\209\149\&8Y\185',W\171#\230\224\131\re\178\249r",PropReasonString "\217|\nd\175&\237\183",PropContentType
// "3)\ESCM\v\US\201|3\154\135%\GS\144i\194\"\229\255\203l:\230\t\ETB\131\198\233\162",PropMessageExpiryInterval
// 19690,PropAuthenticationMethod "\183\212\249\182\191\138V\253H\t\188X\\",PropReceiveMaximum 27145,PropServerKeepAlive
// 9680,PropReceiveMaximum 22519,PropWillDelayInterval 32057,PropMessageExpiryInterval 18312,PropAuthenticationData
// ",N*\192\229RA\\\129\&7",PropReceiveMaximum 3747,PropRequestResponseInformation 58,PropPayloadFormatIndicator
// 70,PropServerKeepAlive 6129,PropMaximumQoS 105,PropRequestResponseInformation 93,PropReasonString
// "A\147s~\181s\231\213@\169\186\203~\243\188\149T\174q",PropTopicAlias 32116,PropServerKeepAlive
// 25356,PropMaximumPacketSize 1804,PropReasonString "\170Xs"]}), _cleanSession = True, _keepAlive = 19592, _connID =
// "\132\175\ETX\n\219\137\SI\183V\196\219\251\145t\244\200AZ[\156\a\212\252\177\154\245%@\249", _properties =
// [PropAuthenticationData "\149\182P\130\208\190\201\136x",PropMaximumQoS 132,PropAuthenticationData
// "\156I\184p\248\220al8{\255\216c\230L?\215\212\DC3\183<\191\141\128",PropSubscriptionIdentifierAvailable
// 87,PropRetainAvailable 169,PropMaximumPacketSize 25664,PropMessageExpiryInterval 20874,PropRequestResponseInformation
// 27,PropWildcardSubscriptionAvailable 209,PropSubscriptionIdentifierAvailable 223,PropReasonString
// "G\215\RS@\134e\DC3\230\234\225\229\&7",PropMessageExpiryInterval 10633,PropAssignedClientIdentifier
// "k\144~\242\234l2\254\207\148\230>\SYN",PropContentType "\185\233\214\129K\170\211\SO\STX\135\&0u\244
// ",PropRequestResponseInformation 171,PropMaximumQoS 31]}
TEST(Connect5QCTest, Encode100) {
  uint8_t pkt[] = {
      0x10, 0xf7, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xae, 0x4c, 0x88, 0x76, 0x16, 0x0,  0x9,  0x95, 0xb6,
      0x50, 0x82, 0xd0, 0xbe, 0xc9, 0x88, 0x78, 0x24, 0x84, 0x16, 0x0,  0x18, 0x9c, 0x49, 0xb8, 0x70, 0xf8, 0xdc, 0x61,
      0x6c, 0x38, 0x7b, 0xff, 0xd8, 0x63, 0xe6, 0x4c, 0x3f, 0xd7, 0xd4, 0x13, 0xb7, 0x3c, 0xbf, 0x8d, 0x80, 0x29, 0x57,
      0x25, 0xa9, 0x27, 0x0,  0x0,  0x64, 0x40, 0x2,  0x0,  0x0,  0x51, 0x8a, 0x19, 0x1b, 0x28, 0xd1, 0x29, 0xdf, 0x1f,
      0x0,  0xc,  0x47, 0xd7, 0x1e, 0x40, 0x86, 0x65, 0x13, 0xe6, 0xea, 0xe1, 0xe5, 0x37, 0x2,  0x0,  0x0,  0x29, 0x89,
      0x12, 0x0,  0xd,  0x6b, 0x90, 0x7e, 0xf2, 0xea, 0x6c, 0x32, 0xfe, 0xcf, 0x94, 0xe6, 0x3e, 0x16, 0x3,  0x0,  0xe,
      0xb9, 0xe9, 0xd6, 0x81, 0x4b, 0xaa, 0xd3, 0xe,  0x2,  0x87, 0x30, 0x75, 0xf4, 0x20, 0x19, 0xab, 0x24, 0x1f, 0x0,
      0x1d, 0x84, 0xaf, 0x3,  0xa,  0xdb, 0x89, 0xf,  0xb7, 0x56, 0xc4, 0xdb, 0xfb, 0x91, 0x74, 0xf4, 0xc8, 0x41, 0x5a,
      0x5b, 0x9c, 0x7,  0xd4, 0xfc, 0xb1, 0x9a, 0xf5, 0x25, 0x40, 0xf9, 0xb0, 0x1,  0x18, 0x0,  0x0,  0x68, 0x54, 0x16,
      0x0,  0x13, 0xa4, 0xd1, 0x95, 0x38, 0x59, 0xb9, 0x27, 0x2c, 0x57, 0xab, 0x23, 0xe6, 0xe0, 0x83, 0xd,  0x65, 0xb2,
      0xf9, 0x72, 0x1f, 0x0,  0x8,  0xd9, 0x7c, 0xa,  0x64, 0xaf, 0x26, 0xed, 0xb7, 0x3,  0x0,  0x1d, 0x33, 0x29, 0x1b,
      0x4d, 0xb,  0x1f, 0xc9, 0x7c, 0x33, 0x9a, 0x87, 0x25, 0x1d, 0x90, 0x69, 0xc2, 0x22, 0xe5, 0xff, 0xcb, 0x6c, 0x3a,
      0xe6, 0x9,  0x17, 0x83, 0xc6, 0xe9, 0xa2, 0x2,  0x0,  0x0,  0x4c, 0xea, 0x15, 0x0,  0xd,  0xb7, 0xd4, 0xf9, 0xb6,
      0xbf, 0x8a, 0x56, 0xfd, 0x48, 0x9,  0xbc, 0x58, 0x5c, 0x21, 0x6a, 0x9,  0x13, 0x25, 0xd0, 0x21, 0x57, 0xf7, 0x18,
      0x0,  0x0,  0x7d, 0x39, 0x2,  0x0,  0x0,  0x47, 0x88, 0x16, 0x0,  0xa,  0x2c, 0x4e, 0x2a, 0xc0, 0xe5, 0x52, 0x41,
      0x5c, 0x81, 0x37, 0x21, 0xe,  0xa3, 0x19, 0x3a, 0x1,  0x46, 0x13, 0x17, 0xf1, 0x24, 0x69, 0x19, 0x5d, 0x1f, 0x0,
      0x13, 0x41, 0x93, 0x73, 0x7e, 0xb5, 0x73, 0xe7, 0xd5, 0x40, 0xa9, 0xba, 0xcb, 0x7e, 0xf3, 0xbc, 0x95, 0x54, 0xae,
      0x71, 0x23, 0x7d, 0x74, 0x13, 0x63, 0xc,  0x27, 0x0,  0x0,  0x7,  0xc,  0x1f, 0x0,  0x3,  0xaa, 0x58, 0x73, 0x0,
      0x6,  0x7c, 0x1e, 0xa4, 0xb2, 0xc1, 0x61, 0x0,  0x11, 0x4f, 0xc5, 0xf0, 0xd6, 0x11, 0x24, 0x6a, 0x35, 0x79, 0x5e,
      0x19, 0xde, 0xfd, 0x2b, 0x11, 0x93, 0x7d, 0x0,  0x8,  0xd5, 0x5a, 0x36, 0x14, 0x80, 0x88, 0xbc, 0x25};

  uint8_t buf[388] = {0};

  uint8_t bytesprops0[] = {0x95, 0xb6, 0x50, 0x82, 0xd0, 0xbe, 0xc9, 0x88, 0x78};
  uint8_t bytesprops1[] = {0x9c, 0x49, 0xb8, 0x70, 0xf8, 0xdc, 0x61, 0x6c, 0x38, 0x7b, 0xff, 0xd8,
                           0x63, 0xe6, 0x4c, 0x3f, 0xd7, 0xd4, 0x13, 0xb7, 0x3c, 0xbf, 0x8d, 0x80};
  uint8_t bytesprops2[] = {0x47, 0xd7, 0x1e, 0x40, 0x86, 0x65, 0x13, 0xe6, 0xea, 0xe1, 0xe5, 0x37};
  uint8_t bytesprops3[] = {0x6b, 0x90, 0x7e, 0xf2, 0xea, 0x6c, 0x32, 0xfe, 0xcf, 0x94, 0xe6, 0x3e, 0x16};
  uint8_t bytesprops4[] = {0xb9, 0xe9, 0xd6, 0x81, 0x4b, 0xaa, 0xd3, 0xe, 0x2, 0x87, 0x30, 0x75, 0xf4, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25664}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20874}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10633}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 31}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa4, 0xd1, 0x95, 0x38, 0x59, 0xb9, 0x27, 0x2c, 0x57, 0xab,
                               0x23, 0xe6, 0xe0, 0x83, 0xd,  0x65, 0xb2, 0xf9, 0x72};
  uint8_t byteswillprops1[] = {0xd9, 0x7c, 0xa, 0x64, 0xaf, 0x26, 0xed, 0xb7};
  uint8_t byteswillprops2[] = {0x33, 0x29, 0x1b, 0x4d, 0xb,  0x1f, 0xc9, 0x7c, 0x33, 0x9a, 0x87, 0x25, 0x1d, 0x90, 0x69,
                               0xc2, 0x22, 0xe5, 0xff, 0xcb, 0x6c, 0x3a, 0xe6, 0x9,  0x17, 0x83, 0xc6, 0xe9, 0xa2};
  uint8_t byteswillprops3[] = {0xb7, 0xd4, 0xf9, 0xb6, 0xbf, 0x8a, 0x56, 0xfd, 0x48, 0x9, 0xbc, 0x58, 0x5c};
  uint8_t byteswillprops4[] = {0x2c, 0x4e, 0x2a, 0xc0, 0xe5, 0x52, 0x41, 0x5c, 0x81, 0x37};
  uint8_t byteswillprops5[] = {0x41, 0x93, 0x73, 0x7e, 0xb5, 0x73, 0xe7, 0xd5, 0x40, 0xa9,
                               0xba, 0xcb, 0x7e, 0xf3, 0xbc, 0x95, 0x54, 0xae, 0x71};
  uint8_t byteswillprops6[] = {0xaa, 0x58, 0x73};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26708}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19690}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27145}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9680}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22519}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32057}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18312}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3747}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6129}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32116}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25356}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1804}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x1e, 0xa4, 0xb2, 0xc1, 0x61};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0xc5, 0xf0, 0xd6, 0x11, 0x24, 0x6a, 0x35, 0x79,
                                  0x5e, 0x19, 0xde, 0xfd, 0x2b, 0x11, 0x93, 0x7d};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19592;
  uint8_t client_id_bytes[] = {0x84, 0xaf, 0x3,  0xa,  0xdb, 0x89, 0xf,  0xb7, 0x56, 0xc4, 0xdb, 0xfb, 0x91, 0x74, 0xf4,
                               0xc8, 0x41, 0x5a, 0x5b, 0x9c, 0x7,  0xd4, 0xfc, 0xb1, 0x9a, 0xf5, 0x25, 0x40, 0xf9};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd5, 0x5a, 0x36, 0x14, 0x80, 0x88, 0xbc, 0x25};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
