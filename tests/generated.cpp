#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\240\228VZ\144!o", _pubPktID =
// 2440, _pubBody = "H\151\243\172\184\224\192", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3a, 0x13, 0x0,  0x8,  0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21,
                   0x6f, 0x9,  0x88, 0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  uint8_t topic_bytes[] = {0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 2440, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\240\228VZ\144!o", _pubPktID =
// 2440, _pubBody = "H\151\243\172\184\224\192", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3a, 0x13, 0x0,  0x8,  0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21,
                   0x6f, 0x9,  0x88, 0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2440);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}o\146\180\a\160\t\DC4T\196Oz)\145Z(2\146\157\n", _pubPktID = 8900, _pubBody = "GA\176\&8", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3d, 0x1c, 0x0,  0x14, 0x7d, 0x6f, 0x92, 0xb4, 0x7, 0xa0, 0x9,  0x14, 0x54, 0xc4, 0x4f,
                   0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa, 0x22, 0xc4, 0x47, 0x41, 0xb0, 0x38};
  uint8_t topic_bytes[] = {0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4,
                           0x4f, 0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x47, 0x41, 0xb0, 0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 8900, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}o\146\180\a\160\t\DC4T\196Oz)\145Z(2\146\157\n", _pubPktID = 8900, _pubBody = "GA\176\&8", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x3d, 0x1c, 0x0,  0x14, 0x7d, 0x6f, 0x92, 0xb4, 0x7, 0xa0, 0x9,  0x14, 0x54, 0xc4, 0x4f,
                   0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa, 0x22, 0xc4, 0x47, 0x41, 0xb0, 0x38};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4,
                               0x4f, 0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0x41, 0xb0, 0x38};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8900);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\151\STXH3\208\EM\137z\b\129j\156\252", _pubPktID = 0, _pubBody = "\202\152NR\SI_", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x38, 0x15, 0x0,  0xd,  0x97, 0x2,  0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a,
                   0x8,  0x81, 0x6a, 0x9c, 0xfc, 0xca, 0x98, 0x4e, 0x52, 0xf,  0x5f};
  uint8_t topic_bytes[] = {0x97, 0x2, 0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8, 0x81, 0x6a, 0x9c, 0xfc};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xca, 0x98, 0x4e, 0x52, 0xf, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\151\STXH3\208\EM\137z\b\129j\156\252", _pubPktID = 0, _pubBody = "\202\152NR\SI_", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x38, 0x15, 0x0,  0xd,  0x97, 0x2,  0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a,
                   0x8,  0x81, 0x6a, 0x9c, 0xfc, 0xca, 0x98, 0x4e, 0x52, 0xf,  0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x97, 0x2, 0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8, 0x81, 0x6a, 0x9c, 0xfc};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xca, 0x98, 0x4e, 0x52, 0xf, 0x5f};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<\v\SYN\154J\242", _pubPktID =
// 10596, _pubBody = "\187\150\168\193Z\202\188\STX?", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3c, 0x13, 0x0,  0x6,  0x3c, 0xb,  0x16, 0x9a, 0x4a, 0xf2, 0x29,
                   0x64, 0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2,  0x3f};
  uint8_t topic_bytes[] = {0x3c, 0xb, 0x16, 0x9a, 0x4a, 0xf2};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10596, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<\v\SYN\154J\242", _pubPktID =
// 10596, _pubBody = "\187\150\168\193Z\202\188\STX?", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x3c, 0x13, 0x0,  0x6,  0x3c, 0xb,  0x16, 0x9a, 0x4a, 0xf2, 0x29,
                   0x64, 0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2,  0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3c, 0xb, 0x16, 0x9a, 0x4a, 0xf2};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2, 0x3f};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10596);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\165,\215\220S\205E\205\200\222\229\249\ESC\148", _pubPktID = 15507, _pubBody = "pR:\130:", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x3c, 0x17, 0x0,  0xe,  0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8,
                   0xde, 0xe5, 0xf9, 0x1b, 0x94, 0x3c, 0x93, 0x70, 0x52, 0x3a, 0x82, 0x3a};
  uint8_t topic_bytes[] = {0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5, 0xf9, 0x1b, 0x94};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x70, 0x52, 0x3a, 0x82, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15507, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\165,\215\220S\205E\205\200\222\229\249\ESC\148", _pubPktID = 15507, _pubBody = "pR:\130:", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x3c, 0x17, 0x0,  0xe,  0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8,
                   0xde, 0xe5, 0xf9, 0x1b, 0x94, 0x3c, 0x93, 0x70, 0x52, 0x3a, 0x82, 0x3a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5, 0xf9, 0x1b, 0x94};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x70, 0x52, 0x3a, 0x82, 0x3a};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 15507);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\v\255\253\245\160v\SO\231\130e\134B1\174\n", _pubPktID = 29653, _pubBody =
// "\169\178\185\220\v\ACKV\254\137C8\154\ETB\\\213\142=", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0xf,  0xb,  0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe,  0xe7, 0x82,
                   0x65, 0x86, 0x42, 0x31, 0xae, 0xa,  0x73, 0xd5, 0xa9, 0xb2, 0xb9, 0xdc, 0xb,
                   0x6,  0x56, 0xfe, 0x89, 0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  uint8_t topic_bytes[] = {0xb, 0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe, 0xe7, 0x82, 0x65, 0x86, 0x42, 0x31, 0xae, 0xa};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xb2, 0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89,
                         0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29653, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\v\255\253\245\160v\SO\231\130e\134B1\174\n", _pubPktID = 29653, _pubBody =
// "\169\178\185\220\v\ACKV\254\137C8\154\ETB\\\213\142=", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0xf,  0xb,  0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe,  0xe7, 0x82,
                   0x65, 0x86, 0x42, 0x31, 0xae, 0xa,  0x73, 0xd5, 0xa9, 0xb2, 0xb9, 0xdc, 0xb,
                   0x6,  0x56, 0xfe, 0x89, 0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb, 0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe, 0xe7, 0x82, 0x65, 0x86, 0x42, 0x31, 0xae, 0xa};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa9, 0xb2, 0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89,
                              0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29653);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\207)#\195\178f\ESC\134K\157xAj\210\148\138\207\185", _pubPktID = 17568, _pubBody = "\171Y", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x33, 0x18, 0x0,  0x12, 0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                   0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9, 0x44, 0xa0, 0xab, 0x59};
  uint8_t topic_bytes[] = {0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                           0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xab, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17568, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\207)#\195\178f\ESC\134K\157xAj\210\148\138\207\185", _pubPktID = 17568, _pubBody = "\171Y", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x33, 0x18, 0x0,  0x12, 0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                   0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9, 0x44, 0xa0, 0xab, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                               0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xab, 0x59};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17568);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(9fA\NAK\140\194;\215\236\145\SO\240#\ESC", _pubPktID = 5686, _pubBody =
// "\197\149\245\GS\f\206T\209\&7\232c\143\164A\177\DC3\r<.\ACK", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x32, 0x27, 0x0,  0xf,  0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec,
                   0x91, 0xe,  0xf0, 0x23, 0x1b, 0x16, 0x36, 0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54,
                   0xd1, 0x37, 0xe8, 0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  uint8_t topic_bytes[] = {0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe, 0xf0, 0x23, 0x1b};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8,
                         0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 5686, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(9fA\NAK\140\194;\215\236\145\SO\240#\ESC", _pubPktID = 5686, _pubBody =
// "\197\149\245\GS\f\206T\209\&7\232c\143\164A\177\DC3\r<.\ACK", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x32, 0x27, 0x0,  0xf,  0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec,
                   0x91, 0xe,  0xf0, 0x23, 0x1b, 0x16, 0x36, 0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54,
                   0xd1, 0x37, 0xe8, 0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe, 0xf0, 0x23, 0x1b};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8,
                              0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5686);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\234\227\201xQ\221\GS\f\US\208(\t\212", _pubPktID = 0, _pubBody =
// "\140\174]d\t\144\158\DC2\237\196\202\147\133\154\231\176|1", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0xd,  0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc,
                   0x1f, 0xd0, 0x28, 0x9,  0xd4, 0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e,
                   0x12, 0xed, 0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  uint8_t topic_bytes[] = {0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc, 0x1f, 0xd0, 0x28, 0x9, 0xd4};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed,
                         0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\234\227\201xQ\221\GS\f\US\208(\t\212", _pubPktID = 0, _pubBody =
// "\140\174]d\t\144\158\DC2\237\196\202\147\133\154\231\176|1", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0xd,  0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc,
                   0x1f, 0xd0, 0x28, 0x9,  0xd4, 0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e,
                   0x12, 0xed, 0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc, 0x1f, 0xd0, 0x28, 0x9, 0xd4};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed,
                              0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SYNr\142QB1\171\213)1\210q\199\"\203\225\251\233[&p\202\238", _pubPktID = 17787, _pubBody =
// "\172\FS\186\216A\244\EOT^<\NAK\136\187\235\ESC\245\209\128", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x32, 0x2c, 0x0,  0x17, 0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                   0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee, 0x45, 0x7b, 0xac, 0x1c, 0xba,
                   0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c, 0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  uint8_t topic_bytes[] = {0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                           0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                         0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17787, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SYNr\142QB1\171\213)1\210q\199\"\203\225\251\233[&p\202\238", _pubPktID = 17787, _pubBody =
// "\172\FS\186\216A\244\EOT^<\NAK\136\187\235\ESC\245\209\128", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x32, 0x2c, 0x0,  0x17, 0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                   0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee, 0x45, 0x7b, 0xac, 0x1c, 0xba,
                   0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c, 0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                               0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                              0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 17787);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "e", _pubPktID = 29287, _pubBody =
// "o\220=\DLE\237\181\219\FS\ESC%~\198\SYN/{P", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x33, 0x15, 0x0,  0x1,  0x65, 0x72, 0x67, 0x6f, 0xdc, 0x3d, 0x10, 0xed,
                   0xb5, 0xdb, 0x1c, 0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  uint8_t topic_bytes[] = {0x65};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6f, 0xdc, 0x3d, 0x10, 0xed, 0xb5, 0xdb, 0x1c,
                         0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29287, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "e", _pubPktID = 29287, _pubBody =
// "o\220=\DLE\237\181\219\FS\ESC%~\198\SYN/{P", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x33, 0x15, 0x0,  0x1,  0x65, 0x72, 0x67, 0x6f, 0xdc, 0x3d, 0x10, 0xed,
                   0xb5, 0xdb, 0x1c, 0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6f, 0xdc, 0x3d, 0x10, 0xed, 0xb5, 0xdb, 0x1c,
                              0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29287);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\139\194\ETB\145\245\&3\175\131\230\149\231\192\SO", _pubPktID = 2558, _pubBody =
// "3u\151\168\SYN\191\144\230d\rn\148=", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x32, 0x1e, 0x0,  0xd,  0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0,
                   0xe,  0x9,  0xfe, 0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd,  0x6e, 0x94, 0x3d};
  uint8_t topic_bytes[] = {0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd, 0x6e, 0x94, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 2558, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\139\194\ETB\145\245\&3\175\131\230\149\231\192\SO", _pubPktID = 2558, _pubBody =
// "3u\151\168\SYN\191\144\230d\rn\148=", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x32, 0x1e, 0x0,  0xd,  0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0,
                   0xe,  0x9,  0xfe, 0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd,  0x6e, 0x94, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd, 0x6e, 0x94, 0x3d};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2558);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "$\212", _pubPktID = 1716, _pubBody
// = "\190\141B\DELW\166\237\195J\183\212y\176h", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x34, 0x14, 0x0,  0x2,  0x24, 0xd4, 0x6,  0xb4, 0xbe, 0x8d, 0x42,
                   0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  uint8_t topic_bytes[] = {0x24, 0xd4};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 1716, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "$\212", _pubPktID = 1716, _pubBody
// = "\190\141B\DELW\166\237\195J\183\212y\176h", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x34, 0x14, 0x0,  0x2,  0x24, 0xd4, 0x6,  0xb4, 0xbe, 0x8d, 0x42,
                   0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x24, 0xd4};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 1716);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\180\150\252c\201h%\ACKX[",
// _pubPktID = 23232, _pubBody = "\245\158IP\ETX\CAN\DLE|\148\175\r", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x3c, 0x19, 0x0,  0xa,  0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6,  0x58, 0x5b,
                   0x5a, 0xc0, 0xf5, 0x9e, 0x49, 0x50, 0x3,  0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  uint8_t topic_bytes[] = {0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6, 0x58, 0x5b};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x9e, 0x49, 0x50, 0x3, 0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 23232, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\180\150\252c\201h%\ACKX[",
// _pubPktID = 23232, _pubBody = "\245\158IP\ETX\CAN\DLE|\148\175\r", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x3c, 0x19, 0x0,  0xa,  0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6,  0x58, 0x5b,
                   0x5a, 0xc0, 0xf5, 0x9e, 0x49, 0x50, 0x3,  0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6, 0x58, 0x5b};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x9e, 0x49, 0x50, 0x3, 0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 23232);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\200a\188\164\254\SO\133s@",
// _pubPktID = 0, _pubBody = "i<UJ\217J(v\163\\\208Z\209\&0\236~1d\211X\DC2", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x31, 0x20, 0x0,  0x9,  0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe,  0x85, 0x73,
                   0x40, 0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                   0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  uint8_t topic_bytes[] = {0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe, 0x85, 0x73, 0x40};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                         0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\200a\188\164\254\SO\133s@",
// _pubPktID = 0, _pubBody = "i<UJ\217J(v\163\\\208Z\209\&0\236~1d\211X\DC2", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x31, 0x20, 0x0,  0x9,  0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe,  0x85, 0x73,
                   0x40, 0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                   0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe, 0x85, 0x73, 0x40};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                              0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ">\248\138\204\&7]\233\FS\228\b|\187\148\202aA\US\153\STX\GS\135\211p", _pubPktID = 4359, _pubBody =
// "\242\145\166\143\135]\136Z\130\202\216\&2*\239?C\217\144\162", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x17, 0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                   0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70, 0x11, 0x7,  0xf2, 0x91, 0xa6,
                   0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca, 0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  uint8_t topic_bytes[] = {0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                           0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca,
                         0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 4359, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ">\248\138\204\&7]\233\FS\228\b|\187\148\202aA\US\153\STX\GS\135\211p", _pubPktID = 4359, _pubBody =
// "\242\145\166\143\135]\136Z\130\202\216\&2*\239?C\217\144\162", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x17, 0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                   0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70, 0x11, 0x7,  0xf2, 0x91, 0xa6,
                   0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca, 0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                               0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca,
                              0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 4359);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\245*\174k\165!xK\226\163\190\195\171\228\STXdu\RS", _pubPktID = 10342, _pubBody =
// "\178\172\US)\254\SYN\146\229\NULP\NAK\n\186\220\f\"\SYN\230\190", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x32, 0x29, 0x0,  0x12, 0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2, 0xa3, 0xbe,
                   0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e, 0x28, 0x66, 0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16,
                   0x92, 0xe5, 0x0,  0x50, 0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  uint8_t topic_bytes[] = {0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2,
                           0xa3, 0xbe, 0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0, 0x50,
                         0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10342, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\245*\174k\165!xK\226\163\190\195\171\228\STXdu\RS", _pubPktID = 10342, _pubBody =
// "\178\172\US)\254\SYN\146\229\NULP\NAK\n\186\220\f\"\SYN\230\190", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x32, 0x29, 0x0,  0x12, 0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2, 0xa3, 0xbe,
                   0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e, 0x28, 0x66, 0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16,
                   0x92, 0xe5, 0x0,  0x50, 0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2,
                               0xa3, 0xbe, 0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0, 0x50,
                              0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10342);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W\DC4\201\190\193\SUB\164\DC3i\182]\GS", _pubPktID = 18773, _pubBody =
// "*F\223\201\140z\253\&8Q\176\t\175!\148(4\SOH\248\EM\192\217B\193\220\225", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x3a, 0x29, 0x0,  0xc,  0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d,
                   0x1d, 0x49, 0x55, 0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf,
                   0x21, 0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  uint8_t topic_bytes[] = {0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf, 0x21,
                         0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 18773, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W\DC4\201\190\193\SUB\164\DC3i\182]\GS", _pubPktID = 18773, _pubBody =
// "*F\223\201\140z\253\&8Q\176\t\175!\148(4\SOH\248\EM\192\217B\193\220\225", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x3a, 0x29, 0x0,  0xc,  0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d,
                   0x1d, 0x49, 0x55, 0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf,
                   0x21, 0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf, 0x21,
                              0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 18773);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\194", _pubPktID = 0, _pubBody =
// "\251\145\"\229\t+\230\175\144\209p\ETX^\217KR\195", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x31, 0x15, 0x0,  0x2,  0xdd, 0xc2, 0xfb, 0x91, 0x22, 0xe5, 0x9, 0x2b,
                   0xe6, 0xaf, 0x90, 0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  uint8_t topic_bytes[] = {0xdd, 0xc2};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x91, 0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90,
                         0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\194", _pubPktID = 0, _pubBody =
// "\251\145\"\229\t+\230\175\144\209p\ETX^\217KR\195", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x31, 0x15, 0x0,  0x2,  0xdd, 0xc2, 0xfb, 0x91, 0x22, 0xe5, 0x9, 0x2b,
                   0xe6, 0xaf, 0x90, 0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdd, 0xc2};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfb, 0x91, 0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90,
                              0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\253\&0\CANabo\DC3\254\241\240\244{\194\r)2\133Gj\233%", _pubPktID = 23762, _pubBody = "\224", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x35, 0x1a, 0x0,  0x15, 0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0,
                   0xf4, 0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25, 0x5c, 0xd2, 0xe0};
  uint8_t topic_bytes[] = {0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4,
                           0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 23762, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\253\&0\CANabo\DC3\254\241\240\244{\194\r)2\133Gj\233%", _pubPktID = 23762, _pubBody = "\224", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x35, 0x1a, 0x0,  0x15, 0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0,
                   0xf4, 0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25, 0x5c, 0xd2, 0xe0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4,
                               0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe0};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23762);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC1\DC4:", _pubPktID = 0, _pubBody =
// "V\144J\230\153\132\164\SO", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x39, 0xd, 0x0, 0x3, 0x11, 0x14, 0x3a, 0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  uint8_t topic_bytes[] = {0x11, 0x14, 0x3a};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC1\DC4:", _pubPktID = 0, _pubBody =
// "V\144J\230\153\132\164\SO", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x39, 0xd, 0x0, 0x3, 0x11, 0x14, 0x3a, 0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x14, 0x3a};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "6\USp^\205\245IA
// \ETB+\158\220\216ea[,\180\190\&1\DLE\183\198\217", _pubPktID = 25164, _pubBody =
// "\155\145\198\173f\139:a\195\141sE}\221\223\243\145\224*\180\vSEy{\166\178\148`", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x33, 0x3a, 0x0,  0x19, 0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b,
                   0x9e, 0xdc, 0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9, 0x62,
                   0x4c, 0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd,
                   0xdf, 0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  uint8_t topic_bytes[] = {0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b, 0x9e, 0xdc,
                           0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd, 0xdf,
                         0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25164, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "6\USp^\205\245IA
// \ETB+\158\220\216ea[,\180\190\&1\DLE\183\198\217", _pubPktID = 25164, _pubBody =
// "\155\145\198\173f\139:a\195\141sE}\221\223\243\145\224*\180\vSEy{\166\178\148`", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x33, 0x3a, 0x0,  0x19, 0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b,
                   0x9e, 0xdc, 0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9, 0x62,
                   0x4c, 0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd,
                   0xdf, 0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b, 0x9e, 0xdc,
                               0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd, 0xdf,
                              0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25164);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\&7A\251\143\146\159\171\130\211\146\190g", _pubPktID = 0, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0xf, 0x0, 0xd, 0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  uint8_t topic_bytes[] = {0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\&7A\251\143\146\159\171\130\211\146\190g", _pubPktID = 0, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0xf, 0x0, 0xd, 0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\198\161\148\238\191@\246\217\217\241\DC1\227\239", _pubPktID = 10944, _pubBody = "R3\160", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x3c, 0x14, 0x0,  0xd,  0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6,
                   0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef, 0x2a, 0xc0, 0x52, 0x33, 0xa0};
  uint8_t topic_bytes[] = {0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x52, 0x33, 0xa0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10944, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\198\161\148\238\191@\246\217\217\241\DC1\227\239", _pubPktID = 10944, _pubBody = "R3\160", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x3c, 0x14, 0x0,  0xd,  0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6,
                   0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef, 0x2a, 0xc0, 0x52, 0x33, 0xa0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x52, 0x33, 0xa0};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10944);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\195\159\242\185\ENQ\214\147\DLE\144\144,r\245\SO\237n\143\204\SUB\229\230", _pubPktID = 0, _pubBody =
// "\171\131\154", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x39, 0x1b, 0x0,  0x16, 0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                   0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6, 0xab, 0x83, 0x9a};
  uint8_t topic_bytes[] = {0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                           0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xab, 0x83, 0x9a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\195\159\242\185\ENQ\214\147\DLE\144\144,r\245\SO\237n\143\204\SUB\229\230", _pubPktID = 0, _pubBody =
// "\171\131\154", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x39, 0x1b, 0x0,  0x16, 0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                   0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6, 0xab, 0x83, 0x9a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                               0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xab, 0x83, 0x9a};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ",\129\b\199\224\197\191\196~\130\211\129B\164\238\NAK\138I\201f\163", _pubPktID = 2253, _pubBody =
// "|\153\171Y,OB.\132d\186cm;\DC4+\153\209y\t\128", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x15, 0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3, 0x81,
                   0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3, 0x8,  0xcd, 0x7c, 0x99, 0xab, 0x59, 0x2c,
                   0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba, 0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  uint8_t topic_bytes[] = {0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3,
                           0x81, 0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba,
                         0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 2253, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ",\129\b\199\224\197\191\196~\130\211\129B\164\238\NAK\138I\201f\163", _pubPktID = 2253, _pubBody =
// "|\153\171Y,OB.\132d\186cm;\DC4+\153\209y\t\128", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x15, 0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3, 0x81,
                   0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3, 0x8,  0xcd, 0x7c, 0x99, 0xab, 0x59, 0x2c,
                   0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba, 0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3,
                               0x81, 0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba,
                              0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2253);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\255\138\160\SO}\145\231=\154\241iR\219\FS\151\240}B\141(\214", _pubPktID = 10836, _pubBody = "\249\144\&7
// ,\DC2\216\146r\155\161\224l\238\165\FS\245", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x3a, 0x2a, 0x0,  0x15, 0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                   0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6, 0x2a, 0x54, 0xf9, 0x90, 0x37,
                   0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72, 0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  uint8_t topic_bytes[] = {0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                           0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72,
                         0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10836, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\255\138\160\SO}\145\231=\154\241iR\219\FS\151\240}B\141(\214", _pubPktID = 10836, _pubBody = "\249\144\&7
// ,\DC2\216\146r\155\161\224l\238\165\FS\245", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x3a, 0x2a, 0x0,  0x15, 0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                   0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6, 0x2a, 0x54, 0xf9, 0x90, 0x37,
                   0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72, 0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                               0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72,
                              0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10836);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\203\137\174H\204\220\160\&8\f+bXR\239\199\DC1\186\254\249\218\179y\210~\185\250\166\248", _pubPktID = 0, _pubBody =
// "\136\142{\DC4\\\154]/:\184\246N\DC28\204\&2C\f@\172\199\237\162)]W\186\180", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x38, 0x3a, 0x0,  0x1c, 0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62,
                   0x58, 0x52, 0xef, 0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa,
                   0xa6, 0xf8, 0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12,
                   0x38, 0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  uint8_t topic_bytes[] = {0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52, 0xef,
                           0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38,
                         0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\203\137\174H\204\220\160\&8\f+bXR\239\199\DC1\186\254\249\218\179y\210~\185\250\166\248", _pubPktID = 0, _pubBody =
// "\136\142{\DC4\\\154]/:\184\246N\DC28\204\&2C\f@\172\199\237\162)]W\186\180", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x38, 0x3a, 0x0,  0x1c, 0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62,
                   0x58, 0x52, 0xef, 0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa,
                   0xa6, 0xf8, 0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12,
                   0x38, 0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52, 0xef,
                               0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38,
                              0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "dU\158\136\251\148W][8D\138i\232?$",
// _pubPktID = 0, _pubBody = "'\136\162\SO\255\RS\205q\229\ACK\148\ETX\129rJ\DC2Y3\165a11\180\247", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x39, 0x2a, 0x0,  0x10, 0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d, 0x5b, 0x38, 0x44,
                   0x8a, 0x69, 0xe8, 0x3f, 0x24, 0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,
                   0x94, 0x3,  0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  uint8_t topic_bytes[] = {0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d,
                           0x5b, 0x38, 0x44, 0x8a, 0x69, 0xe8, 0x3f, 0x24};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,  0x94, 0x3,
                         0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "dU\158\136\251\148W][8D\138i\232?$",
// _pubPktID = 0, _pubBody = "'\136\162\SO\255\RS\205q\229\ACK\148\ETX\129rJ\DC2Y3\165a11\180\247", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x39, 0x2a, 0x0,  0x10, 0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d, 0x5b, 0x38, 0x44,
                   0x8a, 0x69, 0xe8, 0x3f, 0x24, 0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,
                   0x94, 0x3,  0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d,
                               0x5b, 0x38, 0x44, 0x8a, 0x69, 0xe8, 0x3f, 0x24};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,  0x94, 0x3,
                              0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\207\249\USrJ\214L\ENQAT\140JUG\ESC\FS\165\202\218\206\DEL\142\250'\167s\139", _pubPktID = 24516, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x3d, 0x20, 0x0,  0x1c, 0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c,
                   0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55, 0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda,
                   0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b, 0x5f, 0xc4};
  uint8_t topic_bytes[] = {0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55,
                           0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 24516, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\207\249\USrJ\214L\ENQAT\140JUG\ESC\FS\165\202\218\206\DEL\142\250'\167s\139", _pubPktID = 24516, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x3d, 0x20, 0x0,  0x1c, 0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c,
                   0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55, 0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda,
                   0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b, 0x5f, 0xc4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55,
                               0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 24516);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\240\228VZ\144!o", _pubPktID =
// 2440, _pubBody = "H\151\243\172\184\224\192", _pubProps = [PropPayloadFormatIndicator
// 31,PropRequestProblemInformation 225,PropServerReference
// "\ETB\ESC\156\241}\170\249\160\205\175",PropMessageExpiryInterval 13969,PropSubscriptionIdentifier
// 5,PropRequestResponseInformation 97,PropWillDelayInterval 13658,PropContentType
// "_\133{qb.!\b\"\160\SYNd",PropUserProperty "\251\&6\235#" "x\138\155\155\211
// \166\135\156\239\255v\SOHz\a,'\154ve\219\DC384\b\239\149\161\DC2",PropSubscriptionIdentifierAvailable
// 165,PropSubscriptionIdentifierAvailable 68,PropMaximumPacketSize 21324,PropRequestProblemInformation
// 81,PropWillDelayInterval 21670,PropResponseInformation
// "\144QB\229f\151.d\232\a\164\bn\240\157O\177\227\211\199\DC1\SYN\165\186\&7\135BM\163\247",PropSharedSubscriptionAvailable
// 243,PropServerKeepAlive 21923,PropSharedSubscriptionAvailable 48,PropSubscriptionIdentifier 0,PropTopicAliasMaximum
// 3371,PropAssignedClientIdentifier
// "\157\152\235\v\182\205h\SI\164\&8\193\207\215W\152\183\&7\152\EM8\131[.adoaa\208\185",PropServerKeepAlive 22147]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x3a, 0xca, 0x1,  0x0,  0x8,  0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f, 0x9,  0x88, 0xb5, 0x1,  0x1,  0x1f,
      0x17, 0xe1, 0x1c, 0x0,  0xa,  0x17, 0x1b, 0x9c, 0xf1, 0x7d, 0xaa, 0xf9, 0xa0, 0xcd, 0xaf, 0x2,  0x0,  0x0,  0x36,
      0x91, 0xb,  0x5,  0x19, 0x61, 0x18, 0x0,  0x0,  0x35, 0x5a, 0x3,  0x0,  0xc,  0x5f, 0x85, 0x7b, 0x71, 0x62, 0x2e,
      0x21, 0x8,  0x22, 0xa0, 0x16, 0x64, 0x26, 0x0,  0x4,  0xfb, 0x36, 0xeb, 0x23, 0x0,  0x1d, 0x78, 0x8a, 0x9b, 0x9b,
      0xd3, 0x20, 0xa6, 0x87, 0x9c, 0xef, 0xff, 0x76, 0x1,  0x7a, 0x7,  0x2c, 0x27, 0x9a, 0x76, 0x65, 0xdb, 0x13, 0x38,
      0x34, 0x8,  0xef, 0x95, 0xa1, 0x12, 0x29, 0xa5, 0x29, 0x44, 0x27, 0x0,  0x0,  0x53, 0x4c, 0x17, 0x51, 0x18, 0x0,
      0x0,  0x54, 0xa6, 0x1a, 0x0,  0x1e, 0x90, 0x51, 0x42, 0xe5, 0x66, 0x97, 0x2e, 0x64, 0xe8, 0x7,  0xa4, 0x8,  0x6e,
      0xf0, 0x9d, 0x4f, 0xb1, 0xe3, 0xd3, 0xc7, 0x11, 0x16, 0xa5, 0xba, 0x37, 0x87, 0x42, 0x4d, 0xa3, 0xf7, 0x2a, 0xf3,
      0x13, 0x55, 0xa3, 0x2a, 0x30, 0xb,  0x0,  0x22, 0xd,  0x2b, 0x12, 0x0,  0x1e, 0x9d, 0x98, 0xeb, 0xb,  0xb6, 0xcd,
      0x68, 0xf,  0xa4, 0x38, 0xc1, 0xcf, 0xd7, 0x57, 0x98, 0xb7, 0x37, 0x98, 0x19, 0x38, 0x83, 0x5b, 0x2e, 0x61, 0x64,
      0x6f, 0x61, 0x61, 0xd0, 0xb9, 0x13, 0x56, 0x83, 0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  uint8_t topic_bytes[] = {0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x17, 0x1b, 0x9c, 0xf1, 0x7d, 0xaa, 0xf9, 0xa0, 0xcd, 0xaf};
  uint8_t bytesprops1[] = {0x5f, 0x85, 0x7b, 0x71, 0x62, 0x2e, 0x21, 0x8, 0x22, 0xa0, 0x16, 0x64};
  uint8_t bytesprops3[] = {0x78, 0x8a, 0x9b, 0x9b, 0xd3, 0x20, 0xa6, 0x87, 0x9c, 0xef, 0xff, 0x76, 0x1,  0x7a, 0x7,
                           0x2c, 0x27, 0x9a, 0x76, 0x65, 0xdb, 0x13, 0x38, 0x34, 0x8,  0xef, 0x95, 0xa1, 0x12};
  uint8_t bytesprops2[] = {0xfb, 0x36, 0xeb, 0x23};
  uint8_t bytesprops4[] = {0x90, 0x51, 0x42, 0xe5, 0x66, 0x97, 0x2e, 0x64, 0xe8, 0x7,  0xa4, 0x8,  0x6e, 0xf0, 0x9d,
                           0x4f, 0xb1, 0xe3, 0xd3, 0xc7, 0x11, 0x16, 0xa5, 0xba, 0x37, 0x87, 0x42, 0x4d, 0xa3, 0xf7};
  uint8_t bytesprops5[] = {0x9d, 0x98, 0xeb, 0xb,  0xb6, 0xcd, 0x68, 0xf,  0xa4, 0x38, 0xc1, 0xcf, 0xd7, 0x57, 0x98,
                           0xb7, 0x37, 0x98, 0x19, 0x38, 0x83, 0x5b, 0x2e, 0x61, 0x64, 0x6f, 0x61, 0x61, 0xd0, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13969}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13658}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops2}, .v = {29, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21324}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21670}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21923}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3371}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22147}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 2440, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\240\228VZ\144!o", _pubPktID =
// 2440, _pubBody = "H\151\243\172\184\224\192", _pubProps = [PropPayloadFormatIndicator
// 31,PropRequestProblemInformation 225,PropServerReference
// "\ETB\ESC\156\241}\170\249\160\205\175",PropMessageExpiryInterval 13969,PropSubscriptionIdentifier
// 5,PropRequestResponseInformation 97,PropWillDelayInterval 13658,PropContentType
// "_\133{qb.!\b\"\160\SYNd",PropUserProperty "\251\&6\235#" "x\138\155\155\211
// \166\135\156\239\255v\SOHz\a,'\154ve\219\DC384\b\239\149\161\DC2",PropSubscriptionIdentifierAvailable
// 165,PropSubscriptionIdentifierAvailable 68,PropMaximumPacketSize 21324,PropRequestProblemInformation
// 81,PropWillDelayInterval 21670,PropResponseInformation
// "\144QB\229f\151.d\232\a\164\bn\240\157O\177\227\211\199\DC1\SYN\165\186\&7\135BM\163\247",PropSharedSubscriptionAvailable
// 243,PropServerKeepAlive 21923,PropSharedSubscriptionAvailable 48,PropSubscriptionIdentifier 0,PropTopicAliasMaximum
// 3371,PropAssignedClientIdentifier
// "\157\152\235\v\182\205h\SI\164\&8\193\207\215W\152\183\&7\152\EM8\131[.adoaa\208\185",PropServerKeepAlive 22147]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x3a, 0xca, 0x1,  0x0,  0x8,  0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f, 0x9,  0x88, 0xb5, 0x1,  0x1,  0x1f,
      0x17, 0xe1, 0x1c, 0x0,  0xa,  0x17, 0x1b, 0x9c, 0xf1, 0x7d, 0xaa, 0xf9, 0xa0, 0xcd, 0xaf, 0x2,  0x0,  0x0,  0x36,
      0x91, 0xb,  0x5,  0x19, 0x61, 0x18, 0x0,  0x0,  0x35, 0x5a, 0x3,  0x0,  0xc,  0x5f, 0x85, 0x7b, 0x71, 0x62, 0x2e,
      0x21, 0x8,  0x22, 0xa0, 0x16, 0x64, 0x26, 0x0,  0x4,  0xfb, 0x36, 0xeb, 0x23, 0x0,  0x1d, 0x78, 0x8a, 0x9b, 0x9b,
      0xd3, 0x20, 0xa6, 0x87, 0x9c, 0xef, 0xff, 0x76, 0x1,  0x7a, 0x7,  0x2c, 0x27, 0x9a, 0x76, 0x65, 0xdb, 0x13, 0x38,
      0x34, 0x8,  0xef, 0x95, 0xa1, 0x12, 0x29, 0xa5, 0x29, 0x44, 0x27, 0x0,  0x0,  0x53, 0x4c, 0x17, 0x51, 0x18, 0x0,
      0x0,  0x54, 0xa6, 0x1a, 0x0,  0x1e, 0x90, 0x51, 0x42, 0xe5, 0x66, 0x97, 0x2e, 0x64, 0xe8, 0x7,  0xa4, 0x8,  0x6e,
      0xf0, 0x9d, 0x4f, 0xb1, 0xe3, 0xd3, 0xc7, 0x11, 0x16, 0xa5, 0xba, 0x37, 0x87, 0x42, 0x4d, 0xa3, 0xf7, 0x2a, 0xf3,
      0x13, 0x55, 0xa3, 0x2a, 0x30, 0xb,  0x0,  0x22, 0xd,  0x2b, 0x12, 0x0,  0x1e, 0x9d, 0x98, 0xeb, 0xb,  0xb6, 0xcd,
      0x68, 0xf,  0xa4, 0x38, 0xc1, 0xcf, 0xd7, 0x57, 0x98, 0xb7, 0x37, 0x98, 0x19, 0x38, 0x83, 0x5b, 0x2e, 0x61, 0x64,
      0x6f, 0x61, 0x61, 0xd0, 0xb9, 0x13, 0x56, 0x83, 0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x15, 0xf0, 0xe4, 0x56, 0x5a, 0x90, 0x21, 0x6f};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x48, 0x97, 0xf3, 0xac, 0xb8, 0xe0, 0xc0};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2440);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}o\146\180\a\160\t\DC4T\196Oz)\145Z(2\146\157\n", _pubPktID = 8900, _pubBody = "GA\176\&8", _pubProps =
// [PropSessionExpiryInterval 1395,PropWillDelayInterval 2583,PropTopicAlias 12261,PropMessageExpiryInterval
// 2628,PropWildcardSubscriptionAvailable 174,PropRetainAvailable 239,PropMessageExpiryInterval
// 30086,PropMessageExpiryInterval 4735,PropRequestProblemInformation 181,PropSharedSubscriptionAvailable
// 244,PropUserProperty "\143\228Ymo\ENQ\210\NUL\251\150g\249W\205\239\175\236g"
// "\243\ENQz/\158\220\236\128\172\162\148(\226\245\223~\234\247\150\169\252\SI \CANhR\211"]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x3d, 0x73, 0x0,  0x14, 0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4, 0x4f, 0x7a, 0x29,
                   0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa,  0x22, 0xc4, 0x56, 0x11, 0x0,  0x0,  0x5,  0x73, 0x18, 0x0,
                   0x0,  0xa,  0x17, 0x23, 0x2f, 0xe5, 0x2,  0x0,  0x0,  0xa,  0x44, 0x28, 0xae, 0x25, 0xef, 0x2,  0x0,
                   0x0,  0x75, 0x86, 0x2,  0x0,  0x0,  0x12, 0x7f, 0x17, 0xb5, 0x2a, 0xf4, 0x26, 0x0,  0x12, 0x8f, 0xe4,
                   0x59, 0x6d, 0x6f, 0x5,  0xd2, 0x0,  0xfb, 0x96, 0x67, 0xf9, 0x57, 0xcd, 0xef, 0xaf, 0xec, 0x67, 0x0,
                   0x1b, 0xf3, 0x5,  0x7a, 0x2f, 0x9e, 0xdc, 0xec, 0x80, 0xac, 0xa2, 0x94, 0x28, 0xe2, 0xf5, 0xdf, 0x7e,
                   0xea, 0xf7, 0x96, 0xa9, 0xfc, 0xf,  0x20, 0x18, 0x68, 0x52, 0xd3, 0x47, 0x41, 0xb0, 0x38};
  uint8_t topic_bytes[] = {0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4,
                           0x4f, 0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x47, 0x41, 0xb0, 0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops1[] = {0xf3, 0x5,  0x7a, 0x2f, 0x9e, 0xdc, 0xec, 0x80, 0xac, 0xa2, 0x94, 0x28, 0xe2, 0xf5,
                           0xdf, 0x7e, 0xea, 0xf7, 0x96, 0xa9, 0xfc, 0xf,  0x20, 0x18, 0x68, 0x52, 0xd3};
  uint8_t bytesprops0[] = {0x8f, 0xe4, 0x59, 0x6d, 0x6f, 0x5,  0xd2, 0x0,  0xfb,
                           0x96, 0x67, 0xf9, 0x57, 0xcd, 0xef, 0xaf, 0xec, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1395}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2583}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12261}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2628}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30086}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4735}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops0}, .v = {27, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 8900, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}o\146\180\a\160\t\DC4T\196Oz)\145Z(2\146\157\n", _pubPktID = 8900, _pubBody = "GA\176\&8", _pubProps =
// [PropSessionExpiryInterval 1395,PropWillDelayInterval 2583,PropTopicAlias 12261,PropMessageExpiryInterval
// 2628,PropWildcardSubscriptionAvailable 174,PropRetainAvailable 239,PropMessageExpiryInterval
// 30086,PropMessageExpiryInterval 4735,PropRequestProblemInformation 181,PropSharedSubscriptionAvailable
// 244,PropUserProperty "\143\228Ymo\ENQ\210\NUL\251\150g\249W\205\239\175\236g"
// "\243\ENQz/\158\220\236\128\172\162\148(\226\245\223~\234\247\150\169\252\SI \CANhR\211"]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x3d, 0x73, 0x0,  0x14, 0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4, 0x4f, 0x7a, 0x29,
                   0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa,  0x22, 0xc4, 0x56, 0x11, 0x0,  0x0,  0x5,  0x73, 0x18, 0x0,
                   0x0,  0xa,  0x17, 0x23, 0x2f, 0xe5, 0x2,  0x0,  0x0,  0xa,  0x44, 0x28, 0xae, 0x25, 0xef, 0x2,  0x0,
                   0x0,  0x75, 0x86, 0x2,  0x0,  0x0,  0x12, 0x7f, 0x17, 0xb5, 0x2a, 0xf4, 0x26, 0x0,  0x12, 0x8f, 0xe4,
                   0x59, 0x6d, 0x6f, 0x5,  0xd2, 0x0,  0xfb, 0x96, 0x67, 0xf9, 0x57, 0xcd, 0xef, 0xaf, 0xec, 0x67, 0x0,
                   0x1b, 0xf3, 0x5,  0x7a, 0x2f, 0x9e, 0xdc, 0xec, 0x80, 0xac, 0xa2, 0x94, 0x28, 0xe2, 0xf5, 0xdf, 0x7e,
                   0xea, 0xf7, 0x96, 0xa9, 0xfc, 0xf,  0x20, 0x18, 0x68, 0x52, 0xd3, 0x47, 0x41, 0xb0, 0x38};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0x6f, 0x92, 0xb4, 0x7,  0xa0, 0x9,  0x14, 0x54, 0xc4,
                               0x4f, 0x7a, 0x29, 0x91, 0x5a, 0x28, 0x32, 0x92, 0x9d, 0xa};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0x41, 0xb0, 0x38};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8900);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\151\STXH3\208\EM\137z\b\129j\156\252", _pubPktID = 0, _pubBody = "\202\152NR\SI_", _pubProps =
// [PropMessageExpiryInterval 10144,PropSharedSubscriptionAvailable 254,PropReasonString
// "\SOH?\193\190X\175\185\"+\242\&7\147V\172C\214\183\SOH\DC4\255\b\227\148o\135(",PropSubscriptionIdentifier
// 3,PropAssignedClientIdentifier "\162\193\236{\188\238\SYNjk)\156\205\CAN\SUB\215",PropRetainAvailable
// 85,PropServerReference "\253\161&*'\DC1\167\188T6\DC3\249",PropSubscriptionIdentifierAvailable 139,PropTopicAlias
// 22556,PropAuthenticationData "\196\190\222.S\RS\129y9\209\CAN\168\&5"]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x38, 0x74, 0x0,  0xd,  0x97, 0x2,  0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8,  0x81, 0x6a, 0x9c, 0xfc,
                   0x5e, 0x2,  0x0,  0x0,  0x27, 0xa0, 0x2a, 0xfe, 0x1f, 0x0,  0x1a, 0x1,  0x3f, 0xc1, 0xbe, 0x58, 0xaf,
                   0xb9, 0x22, 0x2b, 0xf2, 0x37, 0x93, 0x56, 0xac, 0x43, 0xd6, 0xb7, 0x1,  0x14, 0xff, 0x8,  0xe3, 0x94,
                   0x6f, 0x87, 0x28, 0xb,  0x3,  0x12, 0x0,  0xf,  0xa2, 0xc1, 0xec, 0x7b, 0xbc, 0xee, 0x16, 0x6a, 0x6b,
                   0x29, 0x9c, 0xcd, 0x18, 0x1a, 0xd7, 0x25, 0x55, 0x1c, 0x0,  0xc,  0xfd, 0xa1, 0x26, 0x2a, 0x27, 0x11,
                   0xa7, 0xbc, 0x54, 0x36, 0x13, 0xf9, 0x29, 0x8b, 0x23, 0x58, 0x1c, 0x16, 0x0,  0xd,  0xc4, 0xbe, 0xde,
                   0x2e, 0x53, 0x1e, 0x81, 0x79, 0x39, 0xd1, 0x18, 0xa8, 0x35, 0xca, 0x98, 0x4e, 0x52, 0xf,  0x5f};
  uint8_t topic_bytes[] = {0x97, 0x2, 0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8, 0x81, 0x6a, 0x9c, 0xfc};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xca, 0x98, 0x4e, 0x52, 0xf, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0x1,  0x3f, 0xc1, 0xbe, 0x58, 0xaf, 0xb9, 0x22, 0x2b, 0xf2, 0x37, 0x93, 0x56,
                           0xac, 0x43, 0xd6, 0xb7, 0x1,  0x14, 0xff, 0x8,  0xe3, 0x94, 0x6f, 0x87, 0x28};
  uint8_t bytesprops1[] = {0xa2, 0xc1, 0xec, 0x7b, 0xbc, 0xee, 0x16, 0x6a, 0x6b, 0x29, 0x9c, 0xcd, 0x18, 0x1a, 0xd7};
  uint8_t bytesprops2[] = {0xfd, 0xa1, 0x26, 0x2a, 0x27, 0x11, 0xa7, 0xbc, 0x54, 0x36, 0x13, 0xf9};
  uint8_t bytesprops3[] = {0xc4, 0xbe, 0xde, 0x2e, 0x53, 0x1e, 0x81, 0x79, 0x39, 0xd1, 0x18, 0xa8, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10144}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22556}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\151\STXH3\208\EM\137z\b\129j\156\252", _pubPktID = 0, _pubBody = "\202\152NR\SI_", _pubProps =
// [PropMessageExpiryInterval 10144,PropSharedSubscriptionAvailable 254,PropReasonString
// "\SOH?\193\190X\175\185\"+\242\&7\147V\172C\214\183\SOH\DC4\255\b\227\148o\135(",PropSubscriptionIdentifier
// 3,PropAssignedClientIdentifier "\162\193\236{\188\238\SYNjk)\156\205\CAN\SUB\215",PropRetainAvailable
// 85,PropServerReference "\253\161&*'\DC1\167\188T6\DC3\249",PropSubscriptionIdentifierAvailable 139,PropTopicAlias
// 22556,PropAuthenticationData "\196\190\222.S\RS\129y9\209\CAN\168\&5"]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x38, 0x74, 0x0,  0xd,  0x97, 0x2,  0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8,  0x81, 0x6a, 0x9c, 0xfc,
                   0x5e, 0x2,  0x0,  0x0,  0x27, 0xa0, 0x2a, 0xfe, 0x1f, 0x0,  0x1a, 0x1,  0x3f, 0xc1, 0xbe, 0x58, 0xaf,
                   0xb9, 0x22, 0x2b, 0xf2, 0x37, 0x93, 0x56, 0xac, 0x43, 0xd6, 0xb7, 0x1,  0x14, 0xff, 0x8,  0xe3, 0x94,
                   0x6f, 0x87, 0x28, 0xb,  0x3,  0x12, 0x0,  0xf,  0xa2, 0xc1, 0xec, 0x7b, 0xbc, 0xee, 0x16, 0x6a, 0x6b,
                   0x29, 0x9c, 0xcd, 0x18, 0x1a, 0xd7, 0x25, 0x55, 0x1c, 0x0,  0xc,  0xfd, 0xa1, 0x26, 0x2a, 0x27, 0x11,
                   0xa7, 0xbc, 0x54, 0x36, 0x13, 0xf9, 0x29, 0x8b, 0x23, 0x58, 0x1c, 0x16, 0x0,  0xd,  0xc4, 0xbe, 0xde,
                   0x2e, 0x53, 0x1e, 0x81, 0x79, 0x39, 0xd1, 0x18, 0xa8, 0x35, 0xca, 0x98, 0x4e, 0x52, 0xf,  0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x97, 0x2, 0x48, 0x33, 0xd0, 0x19, 0x89, 0x7a, 0x8, 0x81, 0x6a, 0x9c, 0xfc};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xca, 0x98, 0x4e, 0x52, 0xf, 0x5f};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<\v\SYN\154J\242", _pubPktID =
// 10596, _pubBody = "\187\150\168\193Z\202\188\STX?", _pubProps = [PropAssignedClientIdentifier
// "\223\a\220\EOTC\"",PropRequestResponseInformation 239,PropAuthenticationData
// "X.\130%\GS\217\159\&3\177\227e\236",PropRequestProblemInformation 141,PropRequestResponseInformation
// 39,PropTopicAliasMaximum 17854,PropRequestResponseInformation 80,PropTopicAliasMaximum
// 26066,PropRequestResponseInformation 37,PropSharedSubscriptionAvailable 197,PropAssignedClientIdentifier
// "a\EM\STX\v",PropRequestResponseInformation 119,PropResponseTopic
// "H\222\167\142\164+h\153\180\242>\ESC$\175\ay\164",PropUserProperty "\153\151\136dT"
// "\244\237\151\169\184\229\236\bL\152J\239\141q\224El"]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x3c, 0x76, 0x0,  0x6,  0x3c, 0xb,  0x16, 0x9a, 0x4a, 0xf2, 0x29, 0x64, 0x62, 0x12, 0x0,
                   0x6,  0xdf, 0x7,  0xdc, 0x4,  0x43, 0x22, 0x19, 0xef, 0x16, 0x0,  0xc,  0x58, 0x2e, 0x82,
                   0x25, 0x1d, 0xd9, 0x9f, 0x33, 0xb1, 0xe3, 0x65, 0xec, 0x17, 0x8d, 0x19, 0x27, 0x22, 0x45,
                   0xbe, 0x19, 0x50, 0x22, 0x65, 0xd2, 0x19, 0x25, 0x2a, 0xc5, 0x12, 0x0,  0x4,  0x61, 0x19,
                   0x2,  0xb,  0x19, 0x77, 0x8,  0x0,  0x11, 0x48, 0xde, 0xa7, 0x8e, 0xa4, 0x2b, 0x68, 0x99,
                   0xb4, 0xf2, 0x3e, 0x1b, 0x24, 0xaf, 0x7,  0x79, 0xa4, 0x26, 0x0,  0x5,  0x99, 0x97, 0x88,
                   0x64, 0x54, 0x0,  0x11, 0xf4, 0xed, 0x97, 0xa9, 0xb8, 0xe5, 0xec, 0x8,  0x4c, 0x98, 0x4a,
                   0xef, 0x8d, 0x71, 0xe0, 0x45, 0x6c, 0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2,  0x3f};
  uint8_t topic_bytes[] = {0x3c, 0xb, 0x16, 0x9a, 0x4a, 0xf2};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0xdf, 0x7, 0xdc, 0x4, 0x43, 0x22};
  uint8_t bytesprops1[] = {0x58, 0x2e, 0x82, 0x25, 0x1d, 0xd9, 0x9f, 0x33, 0xb1, 0xe3, 0x65, 0xec};
  uint8_t bytesprops2[] = {0x61, 0x19, 0x2, 0xb};
  uint8_t bytesprops3[] = {0x48, 0xde, 0xa7, 0x8e, 0xa4, 0x2b, 0x68, 0x99, 0xb4,
                           0xf2, 0x3e, 0x1b, 0x24, 0xaf, 0x7,  0x79, 0xa4};
  uint8_t bytesprops5[] = {0xf4, 0xed, 0x97, 0xa9, 0xb8, 0xe5, 0xec, 0x8, 0x4c,
                           0x98, 0x4a, 0xef, 0x8d, 0x71, 0xe0, 0x45, 0x6c};
  uint8_t bytesprops4[] = {0x99, 0x97, 0x88, 0x64, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17854}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26066}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops4}, .v = {17, (char*)&bytesprops5}}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10596, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<\v\SYN\154J\242", _pubPktID =
// 10596, _pubBody = "\187\150\168\193Z\202\188\STX?", _pubProps = [PropAssignedClientIdentifier
// "\223\a\220\EOTC\"",PropRequestResponseInformation 239,PropAuthenticationData
// "X.\130%\GS\217\159\&3\177\227e\236",PropRequestProblemInformation 141,PropRequestResponseInformation
// 39,PropTopicAliasMaximum 17854,PropRequestResponseInformation 80,PropTopicAliasMaximum
// 26066,PropRequestResponseInformation 37,PropSharedSubscriptionAvailable 197,PropAssignedClientIdentifier
// "a\EM\STX\v",PropRequestResponseInformation 119,PropResponseTopic
// "H\222\167\142\164+h\153\180\242>\ESC$\175\ay\164",PropUserProperty "\153\151\136dT"
// "\244\237\151\169\184\229\236\bL\152J\239\141q\224El"]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x3c, 0x76, 0x0,  0x6,  0x3c, 0xb,  0x16, 0x9a, 0x4a, 0xf2, 0x29, 0x64, 0x62, 0x12, 0x0,
                   0x6,  0xdf, 0x7,  0xdc, 0x4,  0x43, 0x22, 0x19, 0xef, 0x16, 0x0,  0xc,  0x58, 0x2e, 0x82,
                   0x25, 0x1d, 0xd9, 0x9f, 0x33, 0xb1, 0xe3, 0x65, 0xec, 0x17, 0x8d, 0x19, 0x27, 0x22, 0x45,
                   0xbe, 0x19, 0x50, 0x22, 0x65, 0xd2, 0x19, 0x25, 0x2a, 0xc5, 0x12, 0x0,  0x4,  0x61, 0x19,
                   0x2,  0xb,  0x19, 0x77, 0x8,  0x0,  0x11, 0x48, 0xde, 0xa7, 0x8e, 0xa4, 0x2b, 0x68, 0x99,
                   0xb4, 0xf2, 0x3e, 0x1b, 0x24, 0xaf, 0x7,  0x79, 0xa4, 0x26, 0x0,  0x5,  0x99, 0x97, 0x88,
                   0x64, 0x54, 0x0,  0x11, 0xf4, 0xed, 0x97, 0xa9, 0xb8, 0xe5, 0xec, 0x8,  0x4c, 0x98, 0x4a,
                   0xef, 0x8d, 0x71, 0xe0, 0x45, 0x6c, 0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2,  0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3c, 0xb, 0x16, 0x9a, 0x4a, 0xf2};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbb, 0x96, 0xa8, 0xc1, 0x5a, 0xca, 0xbc, 0x2, 0x3f};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10596);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\165,\215\220S\205E\205\200\222\229\249\ESC\148", _pubPktID = 15507, _pubBody = "pR:\130:", _pubProps =
// [PropRequestProblemInformation 19,PropMessageExpiryInterval 20770,PropAuthenticationData
// "\174\254\r\157h\203\190\209",PropCorrelationData
// "l\128}bI\137\160\185\v\169\253\161l;\215\232\241\134I\204)\158\241\166\207\190\216"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x3c, 0x48, 0x0,  0xe,  0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5,
                   0xf9, 0x1b, 0x94, 0x3c, 0x93, 0x30, 0x17, 0x13, 0x2,  0x0,  0x0,  0x51, 0x22, 0x16, 0x0,
                   0x8,  0xae, 0xfe, 0xd,  0x9d, 0x68, 0xcb, 0xbe, 0xd1, 0x9,  0x0,  0x1b, 0x6c, 0x80, 0x7d,
                   0x62, 0x49, 0x89, 0xa0, 0xb9, 0xb,  0xa9, 0xfd, 0xa1, 0x6c, 0x3b, 0xd7, 0xe8, 0xf1, 0x86,
                   0x49, 0xcc, 0x29, 0x9e, 0xf1, 0xa6, 0xcf, 0xbe, 0xd8, 0x70, 0x52, 0x3a, 0x82, 0x3a};
  uint8_t topic_bytes[] = {0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5, 0xf9, 0x1b, 0x94};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x70, 0x52, 0x3a, 0x82, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0xae, 0xfe, 0xd, 0x9d, 0x68, 0xcb, 0xbe, 0xd1};
  uint8_t bytesprops1[] = {0x6c, 0x80, 0x7d, 0x62, 0x49, 0x89, 0xa0, 0xb9, 0xb,  0xa9, 0xfd, 0xa1, 0x6c, 0x3b,
                           0xd7, 0xe8, 0xf1, 0x86, 0x49, 0xcc, 0x29, 0x9e, 0xf1, 0xa6, 0xcf, 0xbe, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20770}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15507, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\165,\215\220S\205E\205\200\222\229\249\ESC\148", _pubPktID = 15507, _pubBody = "pR:\130:", _pubProps =
// [PropRequestProblemInformation 19,PropMessageExpiryInterval 20770,PropAuthenticationData
// "\174\254\r\157h\203\190\209",PropCorrelationData
// "l\128}bI\137\160\185\v\169\253\161l;\215\232\241\134I\204)\158\241\166\207\190\216"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x3c, 0x48, 0x0,  0xe,  0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5,
                   0xf9, 0x1b, 0x94, 0x3c, 0x93, 0x30, 0x17, 0x13, 0x2,  0x0,  0x0,  0x51, 0x22, 0x16, 0x0,
                   0x8,  0xae, 0xfe, 0xd,  0x9d, 0x68, 0xcb, 0xbe, 0xd1, 0x9,  0x0,  0x1b, 0x6c, 0x80, 0x7d,
                   0x62, 0x49, 0x89, 0xa0, 0xb9, 0xb,  0xa9, 0xfd, 0xa1, 0x6c, 0x3b, 0xd7, 0xe8, 0xf1, 0x86,
                   0x49, 0xcc, 0x29, 0x9e, 0xf1, 0xa6, 0xcf, 0xbe, 0xd8, 0x70, 0x52, 0x3a, 0x82, 0x3a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa5, 0x2c, 0xd7, 0xdc, 0x53, 0xcd, 0x45, 0xcd, 0xc8, 0xde, 0xe5, 0xf9, 0x1b, 0x94};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x70, 0x52, 0x3a, 0x82, 0x3a};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 15507);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\v\255\253\245\160v\SO\231\130e\134B1\174\n", _pubPktID = 29653, _pubBody =
// "\169\178\185\220\v\ACKV\254\137C8\154\ETB\\\213\142=", _pubProps = [PropSubscriptionIdentifierAvailable
// 163,PropContentType
// "\238\RS\137\144\182\SIS\133\135g\181,T\222\185\&2\191\215\185\150\144e\236\184\152\141\DEL",PropUserProperty
// "A\182\202y\177m\190\207\186\208\183H\174\187\220\240\182\SI" "\236\243QZ\197\132\DLE\246d",PropTopicAliasMaximum
// 15667,PropTopicAlias 24501,PropAuthenticationMethod "\173\CANuc\184^\152Tq\ESC",PropRequestProblemInformation
// 26,PropMaximumPacketSize 17078,PropReasonString
// "\134p\188D\191\207\131\211:\225<}B\182f\251;OI^\181\249\202\133\255K*\NAK\248\GS",PropReasonString
// "\DLEn5\171T\251\232\156"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x35, 0xac, 0x1,  0x0,  0xf,  0xb,  0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe,  0xe7, 0x82, 0x65, 0x86,
                   0x42, 0x31, 0xae, 0xa,  0x73, 0xd5, 0x86, 0x1,  0x29, 0xa3, 0x3,  0x0,  0x1b, 0xee, 0x1e, 0x89,
                   0x90, 0xb6, 0xf,  0x53, 0x85, 0x87, 0x67, 0xb5, 0x2c, 0x54, 0xde, 0xb9, 0x32, 0xbf, 0xd7, 0xb9,
                   0x96, 0x90, 0x65, 0xec, 0xb8, 0x98, 0x8d, 0x7f, 0x26, 0x0,  0x12, 0x41, 0xb6, 0xca, 0x79, 0xb1,
                   0x6d, 0xbe, 0xcf, 0xba, 0xd0, 0xb7, 0x48, 0xae, 0xbb, 0xdc, 0xf0, 0xb6, 0xf,  0x0,  0x9,  0xec,
                   0xf3, 0x51, 0x5a, 0xc5, 0x84, 0x10, 0xf6, 0x64, 0x22, 0x3d, 0x33, 0x23, 0x5f, 0xb5, 0x15, 0x0,
                   0xa,  0xad, 0x18, 0x75, 0x63, 0xb8, 0x5e, 0x98, 0x54, 0x71, 0x1b, 0x17, 0x1a, 0x27, 0x0,  0x0,
                   0x42, 0xb6, 0x1f, 0x0,  0x1e, 0x86, 0x70, 0xbc, 0x44, 0xbf, 0xcf, 0x83, 0xd3, 0x3a, 0xe1, 0x3c,
                   0x7d, 0x42, 0xb6, 0x66, 0xfb, 0x3b, 0x4f, 0x49, 0x5e, 0xb5, 0xf9, 0xca, 0x85, 0xff, 0x4b, 0x2a,
                   0x15, 0xf8, 0x1d, 0x1f, 0x0,  0x8,  0x10, 0x6e, 0x35, 0xab, 0x54, 0xfb, 0xe8, 0x9c, 0xa9, 0xb2,
                   0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89, 0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  uint8_t topic_bytes[] = {0xb, 0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe, 0xe7, 0x82, 0x65, 0x86, 0x42, 0x31, 0xae, 0xa};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xb2, 0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89,
                         0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xee, 0x1e, 0x89, 0x90, 0xb6, 0xf,  0x53, 0x85, 0x87, 0x67, 0xb5, 0x2c, 0x54, 0xde,
                           0xb9, 0x32, 0xbf, 0xd7, 0xb9, 0x96, 0x90, 0x65, 0xec, 0xb8, 0x98, 0x8d, 0x7f};
  uint8_t bytesprops2[] = {0xec, 0xf3, 0x51, 0x5a, 0xc5, 0x84, 0x10, 0xf6, 0x64};
  uint8_t bytesprops1[] = {0x41, 0xb6, 0xca, 0x79, 0xb1, 0x6d, 0xbe, 0xcf, 0xba,
                           0xd0, 0xb7, 0x48, 0xae, 0xbb, 0xdc, 0xf0, 0xb6, 0xf};
  uint8_t bytesprops3[] = {0xad, 0x18, 0x75, 0x63, 0xb8, 0x5e, 0x98, 0x54, 0x71, 0x1b};
  uint8_t bytesprops4[] = {0x86, 0x70, 0xbc, 0x44, 0xbf, 0xcf, 0x83, 0xd3, 0x3a, 0xe1, 0x3c, 0x7d, 0x42, 0xb6, 0x66,
                           0xfb, 0x3b, 0x4f, 0x49, 0x5e, 0xb5, 0xf9, 0xca, 0x85, 0xff, 0x4b, 0x2a, 0x15, 0xf8, 0x1d};
  uint8_t bytesprops5[] = {0x10, 0x6e, 0x35, 0xab, 0x54, 0xfb, 0xe8, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {9, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15667}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24501}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17078}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29653, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\v\255\253\245\160v\SO\231\130e\134B1\174\n", _pubPktID = 29653, _pubBody =
// "\169\178\185\220\v\ACKV\254\137C8\154\ETB\\\213\142=", _pubProps = [PropSubscriptionIdentifierAvailable
// 163,PropContentType
// "\238\RS\137\144\182\SIS\133\135g\181,T\222\185\&2\191\215\185\150\144e\236\184\152\141\DEL",PropUserProperty
// "A\182\202y\177m\190\207\186\208\183H\174\187\220\240\182\SI" "\236\243QZ\197\132\DLE\246d",PropTopicAliasMaximum
// 15667,PropTopicAlias 24501,PropAuthenticationMethod "\173\CANuc\184^\152Tq\ESC",PropRequestProblemInformation
// 26,PropMaximumPacketSize 17078,PropReasonString
// "\134p\188D\191\207\131\211:\225<}B\182f\251;OI^\181\249\202\133\255K*\NAK\248\GS",PropReasonString
// "\DLEn5\171T\251\232\156"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x35, 0xac, 0x1,  0x0,  0xf,  0xb,  0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe,  0xe7, 0x82, 0x65, 0x86,
                   0x42, 0x31, 0xae, 0xa,  0x73, 0xd5, 0x86, 0x1,  0x29, 0xa3, 0x3,  0x0,  0x1b, 0xee, 0x1e, 0x89,
                   0x90, 0xb6, 0xf,  0x53, 0x85, 0x87, 0x67, 0xb5, 0x2c, 0x54, 0xde, 0xb9, 0x32, 0xbf, 0xd7, 0xb9,
                   0x96, 0x90, 0x65, 0xec, 0xb8, 0x98, 0x8d, 0x7f, 0x26, 0x0,  0x12, 0x41, 0xb6, 0xca, 0x79, 0xb1,
                   0x6d, 0xbe, 0xcf, 0xba, 0xd0, 0xb7, 0x48, 0xae, 0xbb, 0xdc, 0xf0, 0xb6, 0xf,  0x0,  0x9,  0xec,
                   0xf3, 0x51, 0x5a, 0xc5, 0x84, 0x10, 0xf6, 0x64, 0x22, 0x3d, 0x33, 0x23, 0x5f, 0xb5, 0x15, 0x0,
                   0xa,  0xad, 0x18, 0x75, 0x63, 0xb8, 0x5e, 0x98, 0x54, 0x71, 0x1b, 0x17, 0x1a, 0x27, 0x0,  0x0,
                   0x42, 0xb6, 0x1f, 0x0,  0x1e, 0x86, 0x70, 0xbc, 0x44, 0xbf, 0xcf, 0x83, 0xd3, 0x3a, 0xe1, 0x3c,
                   0x7d, 0x42, 0xb6, 0x66, 0xfb, 0x3b, 0x4f, 0x49, 0x5e, 0xb5, 0xf9, 0xca, 0x85, 0xff, 0x4b, 0x2a,
                   0x15, 0xf8, 0x1d, 0x1f, 0x0,  0x8,  0x10, 0x6e, 0x35, 0xab, 0x54, 0xfb, 0xe8, 0x9c, 0xa9, 0xb2,
                   0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89, 0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb, 0xff, 0xfd, 0xf5, 0xa0, 0x76, 0xe, 0xe7, 0x82, 0x65, 0x86, 0x42, 0x31, 0xae, 0xa};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa9, 0xb2, 0xb9, 0xdc, 0xb,  0x6,  0x56, 0xfe, 0x89,
                              0x43, 0x38, 0x9a, 0x17, 0x5c, 0xd5, 0x8e, 0x3d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29653);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\207)#\195\178f\ESC\134K\157xAj\210\148\138\207\185", _pubPktID = 17568, _pubBody = "\171Y", _pubProps =
// [PropContentType "\134v\226Zj2\ACK.=\141{\196[\239hp\169*\142 |\USd\171\171}=\239",PropSubscriptionIdentifier
// 3,PropAuthenticationMethod
// "\252\190ys\195\US\192Z\175\170\191\192'\232C\202j\DELn\211\134\US\251*",PropMessageExpiryInterval
// 16252,PropSubscriptionIdentifier 5,PropTopicAlias 6022,PropReceiveMaximum 5386,PropTopicAliasMaximum
// 19404,PropPayloadFormatIndicator 143,PropWillDelayInterval 21874,PropContentType
// "\nrf\140\224\128\207\223\US\161\NULF",PropMaximumPacketSize 31744,PropMessageExpiryInterval
// 24715,PropMessageExpiryInterval 16233,PropReceiveMaximum 11567,PropRetainAvailable
// 143,PropWildcardSubscriptionAvailable 146]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x33, 0x91, 0x1,  0x0,  0x12, 0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b, 0x9d, 0x78, 0x41,
                   0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9, 0x44, 0xa0, 0x78, 0x3,  0x0,  0x1c, 0x86, 0x76, 0xe2, 0x5a, 0x6a,
                   0x32, 0x6,  0x2e, 0x3d, 0x8d, 0x7b, 0xc4, 0x5b, 0xef, 0x68, 0x70, 0xa9, 0x2a, 0x8e, 0x20, 0x7c, 0x1f,
                   0x64, 0xab, 0xab, 0x7d, 0x3d, 0xef, 0xb,  0x3,  0x15, 0x0,  0x18, 0xfc, 0xbe, 0x79, 0x73, 0xc3, 0x1f,
                   0xc0, 0x5a, 0xaf, 0xaa, 0xbf, 0xc0, 0x27, 0xe8, 0x43, 0xca, 0x6a, 0x7f, 0x6e, 0xd3, 0x86, 0x1f, 0xfb,
                   0x2a, 0x2,  0x0,  0x0,  0x3f, 0x7c, 0xb,  0x5,  0x23, 0x17, 0x86, 0x21, 0x15, 0xa,  0x22, 0x4b, 0xcc,
                   0x1,  0x8f, 0x18, 0x0,  0x0,  0x55, 0x72, 0x3,  0x0,  0xc,  0xa,  0x72, 0x66, 0x8c, 0xe0, 0x80, 0xcf,
                   0xdf, 0x1f, 0xa1, 0x0,  0x46, 0x27, 0x0,  0x0,  0x7c, 0x0,  0x2,  0x0,  0x0,  0x60, 0x8b, 0x2,  0x0,
                   0x0,  0x3f, 0x69, 0x21, 0x2d, 0x2f, 0x25, 0x8f, 0x28, 0x92, 0xab, 0x59};
  uint8_t topic_bytes[] = {0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                           0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xab, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0x86, 0x76, 0xe2, 0x5a, 0x6a, 0x32, 0x6,  0x2e, 0x3d, 0x8d, 0x7b, 0xc4, 0x5b, 0xef,
                           0x68, 0x70, 0xa9, 0x2a, 0x8e, 0x20, 0x7c, 0x1f, 0x64, 0xab, 0xab, 0x7d, 0x3d, 0xef};
  uint8_t bytesprops1[] = {0xfc, 0xbe, 0x79, 0x73, 0xc3, 0x1f, 0xc0, 0x5a, 0xaf, 0xaa, 0xbf, 0xc0,
                           0x27, 0xe8, 0x43, 0xca, 0x6a, 0x7f, 0x6e, 0xd3, 0x86, 0x1f, 0xfb, 0x2a};
  uint8_t bytesprops2[] = {0xa, 0x72, 0x66, 0x8c, 0xe0, 0x80, 0xcf, 0xdf, 0x1f, 0xa1, 0x0, 0x46};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16252}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6022}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5386}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19404}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21874}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31744}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24715}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16233}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11567}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 146}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17568, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\207)#\195\178f\ESC\134K\157xAj\210\148\138\207\185", _pubPktID = 17568, _pubBody = "\171Y", _pubProps =
// [PropContentType "\134v\226Zj2\ACK.=\141{\196[\239hp\169*\142 |\USd\171\171}=\239",PropSubscriptionIdentifier
// 3,PropAuthenticationMethod
// "\252\190ys\195\US\192Z\175\170\191\192'\232C\202j\DELn\211\134\US\251*",PropMessageExpiryInterval
// 16252,PropSubscriptionIdentifier 5,PropTopicAlias 6022,PropReceiveMaximum 5386,PropTopicAliasMaximum
// 19404,PropPayloadFormatIndicator 143,PropWillDelayInterval 21874,PropContentType
// "\nrf\140\224\128\207\223\US\161\NULF",PropMaximumPacketSize 31744,PropMessageExpiryInterval
// 24715,PropMessageExpiryInterval 16233,PropReceiveMaximum 11567,PropRetainAvailable
// 143,PropWildcardSubscriptionAvailable 146]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x33, 0x91, 0x1,  0x0,  0x12, 0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b, 0x9d, 0x78, 0x41,
                   0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9, 0x44, 0xa0, 0x78, 0x3,  0x0,  0x1c, 0x86, 0x76, 0xe2, 0x5a, 0x6a,
                   0x32, 0x6,  0x2e, 0x3d, 0x8d, 0x7b, 0xc4, 0x5b, 0xef, 0x68, 0x70, 0xa9, 0x2a, 0x8e, 0x20, 0x7c, 0x1f,
                   0x64, 0xab, 0xab, 0x7d, 0x3d, 0xef, 0xb,  0x3,  0x15, 0x0,  0x18, 0xfc, 0xbe, 0x79, 0x73, 0xc3, 0x1f,
                   0xc0, 0x5a, 0xaf, 0xaa, 0xbf, 0xc0, 0x27, 0xe8, 0x43, 0xca, 0x6a, 0x7f, 0x6e, 0xd3, 0x86, 0x1f, 0xfb,
                   0x2a, 0x2,  0x0,  0x0,  0x3f, 0x7c, 0xb,  0x5,  0x23, 0x17, 0x86, 0x21, 0x15, 0xa,  0x22, 0x4b, 0xcc,
                   0x1,  0x8f, 0x18, 0x0,  0x0,  0x55, 0x72, 0x3,  0x0,  0xc,  0xa,  0x72, 0x66, 0x8c, 0xe0, 0x80, 0xcf,
                   0xdf, 0x1f, 0xa1, 0x0,  0x46, 0x27, 0x0,  0x0,  0x7c, 0x0,  0x2,  0x0,  0x0,  0x60, 0x8b, 0x2,  0x0,
                   0x0,  0x3f, 0x69, 0x21, 0x2d, 0x2f, 0x25, 0x8f, 0x28, 0x92, 0xab, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0x29, 0x23, 0xc3, 0xb2, 0x66, 0x1b, 0x86, 0x4b,
                               0x9d, 0x78, 0x41, 0x6a, 0xd2, 0x94, 0x8a, 0xcf, 0xb9};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xab, 0x59};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17568);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(9fA\NAK\140\194;\215\236\145\SO\240#\ESC", _pubPktID = 5686, _pubBody =
// "\197\149\245\GS\f\206T\209\&7\232c\143\164A\177\DC3\r<.\ACK", _pubProps = [PropSessionExpiryInterval
// 21595,PropSharedSubscriptionAvailable 6,PropServerReference
// "\154\134\&1\208y,\EOT\249\185\232\141\SYN^\132\158\254",PropReasonString
// "\218+\v\ETX~\212\acFLU\138\235",PropSubscriptionIdentifierAvailable 103,PropResponseInformation
// "B\247\fNU\170\&6U\141\DLEm\154\237y
// \201;\a\223i\163\169\176\FS\v\232\128\227\128\245",PropRequestResponseInformation 199,PropRequestResponseInformation
// 107,PropReceiveMaximum 19809,PropSubscriptionIdentifier 1,PropTopicAliasMaximum 552,PropReasonString
// "\212\137\tdr!\CAN\242=\136n\133\133\187\194\t\v\FSZ\203\130ll\188ue~\a\190",PropServerKeepAlive
// 9635,PropSharedSubscriptionAvailable 177,PropResponseInformation "",PropServerReference
// "\170\142\ETXA\234\237^\EOT\231V^\146\177W",PropResponseInformation "\SI",PropAuthenticationMethod
// "\140[\SYN\167\198\134y\167\156@4\193\&5",PropCorrelationData
// "\172\188\161\192=\EM\138\EMk\ETXy+\187\133\252?V\226\195T\231U\188\158n",PropSubscriptionIdentifier
// 0,PropSubscriptionIdentifierAvailable 143,PropTopicAlias 27154,PropResponseInformation
// "]?\146.\133d0\ETB~T\173\208\&6-\GS\139\204\222\152\139\SI",PropTopicAlias 11738,PropPayloadFormatIndicator
// 141,PropMessageExpiryInterval 387,PropMaximumQoS 113,PropServerReference
// "\196\229i\152\\u\\\184",PropResponseInformation "z~\184\148\230H^\186A\229\\\SUB\DEL\168\216\150"]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x32, 0xb4, 0x2,  0x0,  0xf,  0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe,  0xf0, 0x23,
      0x1b, 0x16, 0x36, 0x8b, 0x2,  0x11, 0x0,  0x0,  0x54, 0x5b, 0x2a, 0x6,  0x1c, 0x0,  0x10, 0x9a, 0x86, 0x31, 0xd0,
      0x79, 0x2c, 0x4,  0xf9, 0xb9, 0xe8, 0x8d, 0x16, 0x5e, 0x84, 0x9e, 0xfe, 0x1f, 0x0,  0xd,  0xda, 0x2b, 0xb,  0x3,
      0x7e, 0xd4, 0x7,  0x63, 0x46, 0x4c, 0x55, 0x8a, 0xeb, 0x29, 0x67, 0x1a, 0x0,  0x1e, 0x42, 0xf7, 0xc,  0x4e, 0x55,
      0xaa, 0x36, 0x55, 0x8d, 0x10, 0x6d, 0x9a, 0xed, 0x79, 0x20, 0xc9, 0x3b, 0x7,  0xdf, 0x69, 0xa3, 0xa9, 0xb0, 0x1c,
      0xb,  0xe8, 0x80, 0xe3, 0x80, 0xf5, 0x19, 0xc7, 0x19, 0x6b, 0x21, 0x4d, 0x61, 0xb,  0x1,  0x22, 0x2,  0x28, 0x1f,
      0x0,  0x1d, 0xd4, 0x89, 0x9,  0x64, 0x72, 0x21, 0x18, 0xf2, 0x3d, 0x88, 0x6e, 0x85, 0x85, 0xbb, 0xc2, 0x9,  0xb,
      0x1c, 0x5a, 0xcb, 0x82, 0x6c, 0x6c, 0xbc, 0x75, 0x65, 0x7e, 0x7,  0xbe, 0x13, 0x25, 0xa3, 0x2a, 0xb1, 0x1a, 0x0,
      0x0,  0x1c, 0x0,  0xe,  0xaa, 0x8e, 0x3,  0x41, 0xea, 0xed, 0x5e, 0x4,  0xe7, 0x56, 0x5e, 0x92, 0xb1, 0x57, 0x1a,
      0x0,  0x1,  0xf,  0x15, 0x0,  0xd,  0x8c, 0x5b, 0x16, 0xa7, 0xc6, 0x86, 0x79, 0xa7, 0x9c, 0x40, 0x34, 0xc1, 0x35,
      0x9,  0x0,  0x19, 0xac, 0xbc, 0xa1, 0xc0, 0x3d, 0x19, 0x8a, 0x19, 0x6b, 0x3,  0x79, 0x2b, 0xbb, 0x85, 0xfc, 0x3f,
      0x56, 0xe2, 0xc3, 0x54, 0xe7, 0x55, 0xbc, 0x9e, 0x6e, 0xb,  0x0,  0x29, 0x8f, 0x23, 0x6a, 0x12, 0x1a, 0x0,  0x15,
      0x5d, 0x3f, 0x92, 0x2e, 0x85, 0x64, 0x30, 0x17, 0x7e, 0x54, 0xad, 0xd0, 0x36, 0x2d, 0x1d, 0x8b, 0xcc, 0xde, 0x98,
      0x8b, 0xf,  0x23, 0x2d, 0xda, 0x1,  0x8d, 0x2,  0x0,  0x0,  0x1,  0x83, 0x24, 0x71, 0x1c, 0x0,  0x8,  0xc4, 0xe5,
      0x69, 0x98, 0x5c, 0x75, 0x5c, 0xb8, 0x1a, 0x0,  0x10, 0x7a, 0x7e, 0xb8, 0x94, 0xe6, 0x48, 0x5e, 0xba, 0x41, 0xe5,
      0x5c, 0x1a, 0x7f, 0xa8, 0xd8, 0x96, 0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8, 0x63, 0x8f, 0xa4,
      0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  uint8_t topic_bytes[] = {0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe, 0xf0, 0x23, 0x1b};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8,
                         0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x9a, 0x86, 0x31, 0xd0, 0x79, 0x2c, 0x4,  0xf9,
                           0xb9, 0xe8, 0x8d, 0x16, 0x5e, 0x84, 0x9e, 0xfe};
  uint8_t bytesprops1[] = {0xda, 0x2b, 0xb, 0x3, 0x7e, 0xd4, 0x7, 0x63, 0x46, 0x4c, 0x55, 0x8a, 0xeb};
  uint8_t bytesprops2[] = {0x42, 0xf7, 0xc, 0x4e, 0x55, 0xaa, 0x36, 0x55, 0x8d, 0x10, 0x6d, 0x9a, 0xed, 0x79, 0x20,
                           0xc9, 0x3b, 0x7, 0xdf, 0x69, 0xa3, 0xa9, 0xb0, 0x1c, 0xb,  0xe8, 0x80, 0xe3, 0x80, 0xf5};
  uint8_t bytesprops3[] = {0xd4, 0x89, 0x9,  0x64, 0x72, 0x21, 0x18, 0xf2, 0x3d, 0x88, 0x6e, 0x85, 0x85, 0xbb, 0xc2,
                           0x9,  0xb,  0x1c, 0x5a, 0xcb, 0x82, 0x6c, 0x6c, 0xbc, 0x75, 0x65, 0x7e, 0x7,  0xbe};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0xaa, 0x8e, 0x3, 0x41, 0xea, 0xed, 0x5e, 0x4, 0xe7, 0x56, 0x5e, 0x92, 0xb1, 0x57};
  uint8_t bytesprops6[] = {0xf};
  uint8_t bytesprops7[] = {0x8c, 0x5b, 0x16, 0xa7, 0xc6, 0x86, 0x79, 0xa7, 0x9c, 0x40, 0x34, 0xc1, 0x35};
  uint8_t bytesprops8[] = {0xac, 0xbc, 0xa1, 0xc0, 0x3d, 0x19, 0x8a, 0x19, 0x6b, 0x3,  0x79, 0x2b, 0xbb,
                           0x85, 0xfc, 0x3f, 0x56, 0xe2, 0xc3, 0x54, 0xe7, 0x55, 0xbc, 0x9e, 0x6e};
  uint8_t bytesprops9[] = {0x5d, 0x3f, 0x92, 0x2e, 0x85, 0x64, 0x30, 0x17, 0x7e, 0x54, 0xad,
                           0xd0, 0x36, 0x2d, 0x1d, 0x8b, 0xcc, 0xde, 0x98, 0x8b, 0xf};
  uint8_t bytesprops10[] = {0xc4, 0xe5, 0x69, 0x98, 0x5c, 0x75, 0x5c, 0xb8};
  uint8_t bytesprops11[] = {0x7a, 0x7e, 0xb8, 0x94, 0xe6, 0x48, 0x5e, 0xba,
                            0x41, 0xe5, 0x5c, 0x1a, 0x7f, 0xa8, 0xd8, 0x96};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21595}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19809}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 552}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9635}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27154}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11738}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 387}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 5686, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "(9fA\NAK\140\194;\215\236\145\SO\240#\ESC", _pubPktID = 5686, _pubBody =
// "\197\149\245\GS\f\206T\209\&7\232c\143\164A\177\DC3\r<.\ACK", _pubProps = [PropSessionExpiryInterval
// 21595,PropSharedSubscriptionAvailable 6,PropServerReference
// "\154\134\&1\208y,\EOT\249\185\232\141\SYN^\132\158\254",PropReasonString
// "\218+\v\ETX~\212\acFLU\138\235",PropSubscriptionIdentifierAvailable 103,PropResponseInformation
// "B\247\fNU\170\&6U\141\DLEm\154\237y
// \201;\a\223i\163\169\176\FS\v\232\128\227\128\245",PropRequestResponseInformation 199,PropRequestResponseInformation
// 107,PropReceiveMaximum 19809,PropSubscriptionIdentifier 1,PropTopicAliasMaximum 552,PropReasonString
// "\212\137\tdr!\CAN\242=\136n\133\133\187\194\t\v\FSZ\203\130ll\188ue~\a\190",PropServerKeepAlive
// 9635,PropSharedSubscriptionAvailable 177,PropResponseInformation "",PropServerReference
// "\170\142\ETXA\234\237^\EOT\231V^\146\177W",PropResponseInformation "\SI",PropAuthenticationMethod
// "\140[\SYN\167\198\134y\167\156@4\193\&5",PropCorrelationData
// "\172\188\161\192=\EM\138\EMk\ETXy+\187\133\252?V\226\195T\231U\188\158n",PropSubscriptionIdentifier
// 0,PropSubscriptionIdentifierAvailable 143,PropTopicAlias 27154,PropResponseInformation
// "]?\146.\133d0\ETB~T\173\208\&6-\GS\139\204\222\152\139\SI",PropTopicAlias 11738,PropPayloadFormatIndicator
// 141,PropMessageExpiryInterval 387,PropMaximumQoS 113,PropServerReference
// "\196\229i\152\\u\\\184",PropResponseInformation "z~\184\148\230H^\186A\229\\\SUB\DEL\168\216\150"]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x32, 0xb4, 0x2,  0x0,  0xf,  0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe,  0xf0, 0x23,
      0x1b, 0x16, 0x36, 0x8b, 0x2,  0x11, 0x0,  0x0,  0x54, 0x5b, 0x2a, 0x6,  0x1c, 0x0,  0x10, 0x9a, 0x86, 0x31, 0xd0,
      0x79, 0x2c, 0x4,  0xf9, 0xb9, 0xe8, 0x8d, 0x16, 0x5e, 0x84, 0x9e, 0xfe, 0x1f, 0x0,  0xd,  0xda, 0x2b, 0xb,  0x3,
      0x7e, 0xd4, 0x7,  0x63, 0x46, 0x4c, 0x55, 0x8a, 0xeb, 0x29, 0x67, 0x1a, 0x0,  0x1e, 0x42, 0xf7, 0xc,  0x4e, 0x55,
      0xaa, 0x36, 0x55, 0x8d, 0x10, 0x6d, 0x9a, 0xed, 0x79, 0x20, 0xc9, 0x3b, 0x7,  0xdf, 0x69, 0xa3, 0xa9, 0xb0, 0x1c,
      0xb,  0xe8, 0x80, 0xe3, 0x80, 0xf5, 0x19, 0xc7, 0x19, 0x6b, 0x21, 0x4d, 0x61, 0xb,  0x1,  0x22, 0x2,  0x28, 0x1f,
      0x0,  0x1d, 0xd4, 0x89, 0x9,  0x64, 0x72, 0x21, 0x18, 0xf2, 0x3d, 0x88, 0x6e, 0x85, 0x85, 0xbb, 0xc2, 0x9,  0xb,
      0x1c, 0x5a, 0xcb, 0x82, 0x6c, 0x6c, 0xbc, 0x75, 0x65, 0x7e, 0x7,  0xbe, 0x13, 0x25, 0xa3, 0x2a, 0xb1, 0x1a, 0x0,
      0x0,  0x1c, 0x0,  0xe,  0xaa, 0x8e, 0x3,  0x41, 0xea, 0xed, 0x5e, 0x4,  0xe7, 0x56, 0x5e, 0x92, 0xb1, 0x57, 0x1a,
      0x0,  0x1,  0xf,  0x15, 0x0,  0xd,  0x8c, 0x5b, 0x16, 0xa7, 0xc6, 0x86, 0x79, 0xa7, 0x9c, 0x40, 0x34, 0xc1, 0x35,
      0x9,  0x0,  0x19, 0xac, 0xbc, 0xa1, 0xc0, 0x3d, 0x19, 0x8a, 0x19, 0x6b, 0x3,  0x79, 0x2b, 0xbb, 0x85, 0xfc, 0x3f,
      0x56, 0xe2, 0xc3, 0x54, 0xe7, 0x55, 0xbc, 0x9e, 0x6e, 0xb,  0x0,  0x29, 0x8f, 0x23, 0x6a, 0x12, 0x1a, 0x0,  0x15,
      0x5d, 0x3f, 0x92, 0x2e, 0x85, 0x64, 0x30, 0x17, 0x7e, 0x54, 0xad, 0xd0, 0x36, 0x2d, 0x1d, 0x8b, 0xcc, 0xde, 0x98,
      0x8b, 0xf,  0x23, 0x2d, 0xda, 0x1,  0x8d, 0x2,  0x0,  0x0,  0x1,  0x83, 0x24, 0x71, 0x1c, 0x0,  0x8,  0xc4, 0xe5,
      0x69, 0x98, 0x5c, 0x75, 0x5c, 0xb8, 0x1a, 0x0,  0x10, 0x7a, 0x7e, 0xb8, 0x94, 0xe6, 0x48, 0x5e, 0xba, 0x41, 0xe5,
      0x5c, 0x1a, 0x7f, 0xa8, 0xd8, 0x96, 0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8, 0x63, 0x8f, 0xa4,
      0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x28, 0x39, 0x66, 0x41, 0x15, 0x8c, 0xc2, 0x3b, 0xd7, 0xec, 0x91, 0xe, 0xf0, 0x23, 0x1b};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc5, 0x95, 0xf5, 0x1d, 0xc,  0xce, 0x54, 0xd1, 0x37, 0xe8,
                              0x63, 0x8f, 0xa4, 0x41, 0xb1, 0x13, 0xd,  0x3c, 0x2e, 0x6};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5686);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\234\227\201xQ\221\GS\f\US\208(\t\212", _pubPktID = 0, _pubBody =
// "\140\174]d\t\144\158\DC2\237\196\202\147\133\154\231\176|1", _pubProps = [PropMessageExpiryInterval
// 14546,PropMessageExpiryInterval 14300,PropReasonString "\183j\173Z\222K",PropTopicAlias 24083,PropResponseInformation
// "\SO\161\227\DLE\141\173\DC4\149)\247\154\US\225L\231Y\195",PropTopicAlias 22040,PropRetainAvailable
// 145,PropUserProperty "8\169\225\228\231lk&\152\211" "\246)J\EOT\192F\210\254\223\253\210\141{R",PropCorrelationData "
// y\228\130\229i\164(p\134\186Uf\ENQ\144\191\171e",PropWillDelayInterval 26330,PropRequestResponseInformation
// 227,PropContentType ".0\SOH\SUB\249\250E\165\181\168\196\146Z\197\210H^N\218\&8\255\167",PropResponseTopic
// "\nG\189\167h[\246\161\194\227x\138\136L\156",PropSessionExpiryInterval 25383,PropAssignedClientIdentifier
// "@\168\149\DC1\ACK\v\220\169\221\168\241\209#*Yf\161\173\153\198\173\189\198\179",PropServerKeepAlive
// 7700,PropTopicAliasMaximum 24476,PropTopicAliasMaximum 11573,PropResponseInformation
// ":\ETX\US\246g\DLE\130\NUL#\171\138\210\ENQ\177\a\224m\130",PropUserProperty "\216A\239s\t\172\&7\156?"
// "\167\160\165\CAN\ENQ\212\&5(\138\245\DC2V'\184\203\RS\244\164\162\221\GSM\128k",PropResponseTopic
// "\150&\189F\170",PropServerKeepAlive 31478,PropAuthenticationData
// "\244:HY\215;\144\133\187\168\178&}%",PropAssignedClientIdentifier
// "\"\242N\178\b6\216NL\143\154",PropRequestResponseInformation 88]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x38, 0xc6, 0x2,  0x0,  0xd,  0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc,  0x1f, 0xd0, 0x28, 0x9,  0xd4, 0xa3,
      0x2,  0x2,  0x0,  0x0,  0x38, 0xd2, 0x2,  0x0,  0x0,  0x37, 0xdc, 0x1f, 0x0,  0x6,  0xb7, 0x6a, 0xad, 0x5a, 0xde,
      0x4b, 0x23, 0x5e, 0x13, 0x1a, 0x0,  0x11, 0xe,  0xa1, 0xe3, 0x10, 0x8d, 0xad, 0x14, 0x95, 0x29, 0xf7, 0x9a, 0x1f,
      0xe1, 0x4c, 0xe7, 0x59, 0xc3, 0x23, 0x56, 0x18, 0x25, 0x91, 0x26, 0x0,  0xa,  0x38, 0xa9, 0xe1, 0xe4, 0xe7, 0x6c,
      0x6b, 0x26, 0x98, 0xd3, 0x0,  0xe,  0xf6, 0x29, 0x4a, 0x4,  0xc0, 0x46, 0xd2, 0xfe, 0xdf, 0xfd, 0xd2, 0x8d, 0x7b,
      0x52, 0x9,  0x0,  0x12, 0x20, 0x79, 0xe4, 0x82, 0xe5, 0x69, 0xa4, 0x28, 0x70, 0x86, 0xba, 0x55, 0x66, 0x5,  0x90,
      0xbf, 0xab, 0x65, 0x18, 0x0,  0x0,  0x66, 0xda, 0x19, 0xe3, 0x3,  0x0,  0x16, 0x2e, 0x30, 0x1,  0x1a, 0xf9, 0xfa,
      0x45, 0xa5, 0xb5, 0xa8, 0xc4, 0x92, 0x5a, 0xc5, 0xd2, 0x48, 0x5e, 0x4e, 0xda, 0x38, 0xff, 0xa7, 0x8,  0x0,  0xf,
      0xa,  0x47, 0xbd, 0xa7, 0x68, 0x5b, 0xf6, 0xa1, 0xc2, 0xe3, 0x78, 0x8a, 0x88, 0x4c, 0x9c, 0x11, 0x0,  0x0,  0x63,
      0x27, 0x12, 0x0,  0x18, 0x40, 0xa8, 0x95, 0x11, 0x6,  0xb,  0xdc, 0xa9, 0xdd, 0xa8, 0xf1, 0xd1, 0x23, 0x2a, 0x59,
      0x66, 0xa1, 0xad, 0x99, 0xc6, 0xad, 0xbd, 0xc6, 0xb3, 0x13, 0x1e, 0x14, 0x22, 0x5f, 0x9c, 0x22, 0x2d, 0x35, 0x1a,
      0x0,  0x12, 0x3a, 0x3,  0x1f, 0xf6, 0x67, 0x10, 0x82, 0x0,  0x23, 0xab, 0x8a, 0xd2, 0x5,  0xb1, 0x7,  0xe0, 0x6d,
      0x82, 0x26, 0x0,  0x9,  0xd8, 0x41, 0xef, 0x73, 0x9,  0xac, 0x37, 0x9c, 0x3f, 0x0,  0x18, 0xa7, 0xa0, 0xa5, 0x18,
      0x5,  0xd4, 0x35, 0x28, 0x8a, 0xf5, 0x12, 0x56, 0x27, 0xb8, 0xcb, 0x1e, 0xf4, 0xa4, 0xa2, 0xdd, 0x1d, 0x4d, 0x80,
      0x6b, 0x8,  0x0,  0x5,  0x96, 0x26, 0xbd, 0x46, 0xaa, 0x13, 0x7a, 0xf6, 0x16, 0x0,  0xe,  0xf4, 0x3a, 0x48, 0x59,
      0xd7, 0x3b, 0x90, 0x85, 0xbb, 0xa8, 0xb2, 0x26, 0x7d, 0x25, 0x12, 0x0,  0xb,  0x22, 0xf2, 0x4e, 0xb2, 0x8,  0x36,
      0xd8, 0x4e, 0x4c, 0x8f, 0x9a, 0x19, 0x58, 0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed, 0xc4, 0xca, 0x93,
      0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  uint8_t topic_bytes[] = {0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc, 0x1f, 0xd0, 0x28, 0x9, 0xd4};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed,
                         0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0xb7, 0x6a, 0xad, 0x5a, 0xde, 0x4b};
  uint8_t bytesprops1[] = {0xe,  0xa1, 0xe3, 0x10, 0x8d, 0xad, 0x14, 0x95, 0x29,
                           0xf7, 0x9a, 0x1f, 0xe1, 0x4c, 0xe7, 0x59, 0xc3};
  uint8_t bytesprops3[] = {0xf6, 0x29, 0x4a, 0x4, 0xc0, 0x46, 0xd2, 0xfe, 0xdf, 0xfd, 0xd2, 0x8d, 0x7b, 0x52};
  uint8_t bytesprops2[] = {0x38, 0xa9, 0xe1, 0xe4, 0xe7, 0x6c, 0x6b, 0x26, 0x98, 0xd3};
  uint8_t bytesprops4[] = {0x20, 0x79, 0xe4, 0x82, 0xe5, 0x69, 0xa4, 0x28, 0x70,
                           0x86, 0xba, 0x55, 0x66, 0x5,  0x90, 0xbf, 0xab, 0x65};
  uint8_t bytesprops5[] = {0x2e, 0x30, 0x1,  0x1a, 0xf9, 0xfa, 0x45, 0xa5, 0xb5, 0xa8, 0xc4,
                           0x92, 0x5a, 0xc5, 0xd2, 0x48, 0x5e, 0x4e, 0xda, 0x38, 0xff, 0xa7};
  uint8_t bytesprops6[] = {0xa, 0x47, 0xbd, 0xa7, 0x68, 0x5b, 0xf6, 0xa1, 0xc2, 0xe3, 0x78, 0x8a, 0x88, 0x4c, 0x9c};
  uint8_t bytesprops7[] = {0x40, 0xa8, 0x95, 0x11, 0x6,  0xb,  0xdc, 0xa9, 0xdd, 0xa8, 0xf1, 0xd1,
                           0x23, 0x2a, 0x59, 0x66, 0xa1, 0xad, 0x99, 0xc6, 0xad, 0xbd, 0xc6, 0xb3};
  uint8_t bytesprops8[] = {0x3a, 0x3,  0x1f, 0xf6, 0x67, 0x10, 0x82, 0x0,  0x23,
                           0xab, 0x8a, 0xd2, 0x5,  0xb1, 0x7,  0xe0, 0x6d, 0x82};
  uint8_t bytesprops10[] = {0xa7, 0xa0, 0xa5, 0x18, 0x5,  0xd4, 0x35, 0x28, 0x8a, 0xf5, 0x12, 0x56,
                            0x27, 0xb8, 0xcb, 0x1e, 0xf4, 0xa4, 0xa2, 0xdd, 0x1d, 0x4d, 0x80, 0x6b};
  uint8_t bytesprops9[] = {0xd8, 0x41, 0xef, 0x73, 0x9, 0xac, 0x37, 0x9c, 0x3f};
  uint8_t bytesprops11[] = {0x96, 0x26, 0xbd, 0x46, 0xaa};
  uint8_t bytesprops12[] = {0xf4, 0x3a, 0x48, 0x59, 0xd7, 0x3b, 0x90, 0x85, 0xbb, 0xa8, 0xb2, 0x26, 0x7d, 0x25};
  uint8_t bytesprops13[] = {0x22, 0xf2, 0x4e, 0xb2, 0x8, 0x36, 0xd8, 0x4e, 0x4c, 0x8f, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14546}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14300}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24083}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22040}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {14, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26330}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25383}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7700}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24476}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11573}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops9}, .v = {24, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31478}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 88}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\234\227\201xQ\221\GS\f\US\208(\t\212", _pubPktID = 0, _pubBody =
// "\140\174]d\t\144\158\DC2\237\196\202\147\133\154\231\176|1", _pubProps = [PropMessageExpiryInterval
// 14546,PropMessageExpiryInterval 14300,PropReasonString "\183j\173Z\222K",PropTopicAlias 24083,PropResponseInformation
// "\SO\161\227\DLE\141\173\DC4\149)\247\154\US\225L\231Y\195",PropTopicAlias 22040,PropRetainAvailable
// 145,PropUserProperty "8\169\225\228\231lk&\152\211" "\246)J\EOT\192F\210\254\223\253\210\141{R",PropCorrelationData "
// y\228\130\229i\164(p\134\186Uf\ENQ\144\191\171e",PropWillDelayInterval 26330,PropRequestResponseInformation
// 227,PropContentType ".0\SOH\SUB\249\250E\165\181\168\196\146Z\197\210H^N\218\&8\255\167",PropResponseTopic
// "\nG\189\167h[\246\161\194\227x\138\136L\156",PropSessionExpiryInterval 25383,PropAssignedClientIdentifier
// "@\168\149\DC1\ACK\v\220\169\221\168\241\209#*Yf\161\173\153\198\173\189\198\179",PropServerKeepAlive
// 7700,PropTopicAliasMaximum 24476,PropTopicAliasMaximum 11573,PropResponseInformation
// ":\ETX\US\246g\DLE\130\NUL#\171\138\210\ENQ\177\a\224m\130",PropUserProperty "\216A\239s\t\172\&7\156?"
// "\167\160\165\CAN\ENQ\212\&5(\138\245\DC2V'\184\203\RS\244\164\162\221\GSM\128k",PropResponseTopic
// "\150&\189F\170",PropServerKeepAlive 31478,PropAuthenticationData
// "\244:HY\215;\144\133\187\168\178&}%",PropAssignedClientIdentifier
// "\"\242N\178\b6\216NL\143\154",PropRequestResponseInformation 88]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {
      0x38, 0xc6, 0x2,  0x0,  0xd,  0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc,  0x1f, 0xd0, 0x28, 0x9,  0xd4, 0xa3,
      0x2,  0x2,  0x0,  0x0,  0x38, 0xd2, 0x2,  0x0,  0x0,  0x37, 0xdc, 0x1f, 0x0,  0x6,  0xb7, 0x6a, 0xad, 0x5a, 0xde,
      0x4b, 0x23, 0x5e, 0x13, 0x1a, 0x0,  0x11, 0xe,  0xa1, 0xe3, 0x10, 0x8d, 0xad, 0x14, 0x95, 0x29, 0xf7, 0x9a, 0x1f,
      0xe1, 0x4c, 0xe7, 0x59, 0xc3, 0x23, 0x56, 0x18, 0x25, 0x91, 0x26, 0x0,  0xa,  0x38, 0xa9, 0xe1, 0xe4, 0xe7, 0x6c,
      0x6b, 0x26, 0x98, 0xd3, 0x0,  0xe,  0xf6, 0x29, 0x4a, 0x4,  0xc0, 0x46, 0xd2, 0xfe, 0xdf, 0xfd, 0xd2, 0x8d, 0x7b,
      0x52, 0x9,  0x0,  0x12, 0x20, 0x79, 0xe4, 0x82, 0xe5, 0x69, 0xa4, 0x28, 0x70, 0x86, 0xba, 0x55, 0x66, 0x5,  0x90,
      0xbf, 0xab, 0x65, 0x18, 0x0,  0x0,  0x66, 0xda, 0x19, 0xe3, 0x3,  0x0,  0x16, 0x2e, 0x30, 0x1,  0x1a, 0xf9, 0xfa,
      0x45, 0xa5, 0xb5, 0xa8, 0xc4, 0x92, 0x5a, 0xc5, 0xd2, 0x48, 0x5e, 0x4e, 0xda, 0x38, 0xff, 0xa7, 0x8,  0x0,  0xf,
      0xa,  0x47, 0xbd, 0xa7, 0x68, 0x5b, 0xf6, 0xa1, 0xc2, 0xe3, 0x78, 0x8a, 0x88, 0x4c, 0x9c, 0x11, 0x0,  0x0,  0x63,
      0x27, 0x12, 0x0,  0x18, 0x40, 0xa8, 0x95, 0x11, 0x6,  0xb,  0xdc, 0xa9, 0xdd, 0xa8, 0xf1, 0xd1, 0x23, 0x2a, 0x59,
      0x66, 0xa1, 0xad, 0x99, 0xc6, 0xad, 0xbd, 0xc6, 0xb3, 0x13, 0x1e, 0x14, 0x22, 0x5f, 0x9c, 0x22, 0x2d, 0x35, 0x1a,
      0x0,  0x12, 0x3a, 0x3,  0x1f, 0xf6, 0x67, 0x10, 0x82, 0x0,  0x23, 0xab, 0x8a, 0xd2, 0x5,  0xb1, 0x7,  0xe0, 0x6d,
      0x82, 0x26, 0x0,  0x9,  0xd8, 0x41, 0xef, 0x73, 0x9,  0xac, 0x37, 0x9c, 0x3f, 0x0,  0x18, 0xa7, 0xa0, 0xa5, 0x18,
      0x5,  0xd4, 0x35, 0x28, 0x8a, 0xf5, 0x12, 0x56, 0x27, 0xb8, 0xcb, 0x1e, 0xf4, 0xa4, 0xa2, 0xdd, 0x1d, 0x4d, 0x80,
      0x6b, 0x8,  0x0,  0x5,  0x96, 0x26, 0xbd, 0x46, 0xaa, 0x13, 0x7a, 0xf6, 0x16, 0x0,  0xe,  0xf4, 0x3a, 0x48, 0x59,
      0xd7, 0x3b, 0x90, 0x85, 0xbb, 0xa8, 0xb2, 0x26, 0x7d, 0x25, 0x12, 0x0,  0xb,  0x22, 0xf2, 0x4e, 0xb2, 0x8,  0x36,
      0xd8, 0x4e, 0x4c, 0x8f, 0x9a, 0x19, 0x58, 0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed, 0xc4, 0xca, 0x93,
      0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xea, 0xe3, 0xc9, 0x78, 0x51, 0xdd, 0x1d, 0xc, 0x1f, 0xd0, 0x28, 0x9, 0xd4};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8c, 0xae, 0x5d, 0x64, 0x9,  0x90, 0x9e, 0x12, 0xed,
                              0xc4, 0xca, 0x93, 0x85, 0x9a, 0xe7, 0xb0, 0x7c, 0x31};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SYNr\142QB1\171\213)1\210q\199\"\203\225\251\233[&p\202\238", _pubPktID = 17787, _pubBody =
// "\172\FS\186\216A\244\EOT^<\NAK\136\187\235\ESC\245\209\128", _pubProps = [PropResponseTopic
// "\130\&8\141\184\169\181_\254\142]",PropRetainAvailable 44,PropReasonString
// "q1\241U\133\181\218\238h\GS\156\202\198\194\201\&8\165oH\150t~\201\171\CAN",PropPayloadFormatIndicator
// 21,PropMessageExpiryInterval 32507,PropRetainAvailable 215,PropReceiveMaximum 5188,PropRequestProblemInformation
// 160,PropResponseTopic "\150u1+\204\230m\145\172\230\243\246\EOTuB\US",PropWildcardSubscriptionAvailable
// 2,PropServerReference "\145\\\206+\172\143;\192",PropContentType "\ETB\225\142{\aEn\ACK",PropMessageExpiryInterval
// 19133,PropRequestResponseInformation 0,PropRequestProblemInformation 49,PropAssignedClientIdentifier
// "b\206\190\f\EM\SO\232\FS[\173\189_\201m\220",PropRequestResponseInformation 131]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x32, 0xaf, 0x1,  0x0,  0x17, 0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                   0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee, 0x45, 0x7b, 0x81, 0x1,  0x8,  0x0,
                   0xa,  0x82, 0x38, 0x8d, 0xb8, 0xa9, 0xb5, 0x5f, 0xfe, 0x8e, 0x5d, 0x25, 0x2c, 0x1f, 0x0,  0x19, 0x71,
                   0x31, 0xf1, 0x55, 0x85, 0xb5, 0xda, 0xee, 0x68, 0x1d, 0x9c, 0xca, 0xc6, 0xc2, 0xc9, 0x38, 0xa5, 0x6f,
                   0x48, 0x96, 0x74, 0x7e, 0xc9, 0xab, 0x18, 0x1,  0x15, 0x2,  0x0,  0x0,  0x7e, 0xfb, 0x25, 0xd7, 0x21,
                   0x14, 0x44, 0x17, 0xa0, 0x8,  0x0,  0x10, 0x96, 0x75, 0x31, 0x2b, 0xcc, 0xe6, 0x6d, 0x91, 0xac, 0xe6,
                   0xf3, 0xf6, 0x4,  0x75, 0x42, 0x1f, 0x28, 0x2,  0x1c, 0x0,  0x8,  0x91, 0x5c, 0xce, 0x2b, 0xac, 0x8f,
                   0x3b, 0xc0, 0x3,  0x0,  0x8,  0x17, 0xe1, 0x8e, 0x7b, 0x7,  0x45, 0x6e, 0x6,  0x2,  0x0,  0x0,  0x4a,
                   0xbd, 0x19, 0x0,  0x17, 0x31, 0x12, 0x0,  0xf,  0x62, 0xce, 0xbe, 0xc,  0x19, 0xe,  0xe8, 0x1c, 0x5b,
                   0xad, 0xbd, 0x5f, 0xc9, 0x6d, 0xdc, 0x19, 0x83, 0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                   0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  uint8_t topic_bytes[] = {0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                           0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                         0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0x82, 0x38, 0x8d, 0xb8, 0xa9, 0xb5, 0x5f, 0xfe, 0x8e, 0x5d};
  uint8_t bytesprops1[] = {0x71, 0x31, 0xf1, 0x55, 0x85, 0xb5, 0xda, 0xee, 0x68, 0x1d, 0x9c, 0xca, 0xc6,
                           0xc2, 0xc9, 0x38, 0xa5, 0x6f, 0x48, 0x96, 0x74, 0x7e, 0xc9, 0xab, 0x18};
  uint8_t bytesprops2[] = {0x96, 0x75, 0x31, 0x2b, 0xcc, 0xe6, 0x6d, 0x91,
                           0xac, 0xe6, 0xf3, 0xf6, 0x4,  0x75, 0x42, 0x1f};
  uint8_t bytesprops3[] = {0x91, 0x5c, 0xce, 0x2b, 0xac, 0x8f, 0x3b, 0xc0};
  uint8_t bytesprops4[] = {0x17, 0xe1, 0x8e, 0x7b, 0x7, 0x45, 0x6e, 0x6};
  uint8_t bytesprops5[] = {0x62, 0xce, 0xbe, 0xc, 0x19, 0xe, 0xe8, 0x1c, 0x5b, 0xad, 0xbd, 0x5f, 0xc9, 0x6d, 0xdc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32507}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5188}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19133}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 131}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17787, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\SYNr\142QB1\171\213)1\210q\199\"\203\225\251\233[&p\202\238", _pubPktID = 17787, _pubBody =
// "\172\FS\186\216A\244\EOT^<\NAK\136\187\235\ESC\245\209\128", _pubProps = [PropResponseTopic
// "\130\&8\141\184\169\181_\254\142]",PropRetainAvailable 44,PropReasonString
// "q1\241U\133\181\218\238h\GS\156\202\198\194\201\&8\165oH\150t~\201\171\CAN",PropPayloadFormatIndicator
// 21,PropMessageExpiryInterval 32507,PropRetainAvailable 215,PropReceiveMaximum 5188,PropRequestProblemInformation
// 160,PropResponseTopic "\150u1+\204\230m\145\172\230\243\246\EOTuB\US",PropWildcardSubscriptionAvailable
// 2,PropServerReference "\145\\\206+\172\143;\192",PropContentType "\ETB\225\142{\aEn\ACK",PropMessageExpiryInterval
// 19133,PropRequestResponseInformation 0,PropRequestProblemInformation 49,PropAssignedClientIdentifier
// "b\206\190\f\EM\SO\232\FS[\173\189_\201m\220",PropRequestResponseInformation 131]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x32, 0xaf, 0x1,  0x0,  0x17, 0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                   0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee, 0x45, 0x7b, 0x81, 0x1,  0x8,  0x0,
                   0xa,  0x82, 0x38, 0x8d, 0xb8, 0xa9, 0xb5, 0x5f, 0xfe, 0x8e, 0x5d, 0x25, 0x2c, 0x1f, 0x0,  0x19, 0x71,
                   0x31, 0xf1, 0x55, 0x85, 0xb5, 0xda, 0xee, 0x68, 0x1d, 0x9c, 0xca, 0xc6, 0xc2, 0xc9, 0x38, 0xa5, 0x6f,
                   0x48, 0x96, 0x74, 0x7e, 0xc9, 0xab, 0x18, 0x1,  0x15, 0x2,  0x0,  0x0,  0x7e, 0xfb, 0x25, 0xd7, 0x21,
                   0x14, 0x44, 0x17, 0xa0, 0x8,  0x0,  0x10, 0x96, 0x75, 0x31, 0x2b, 0xcc, 0xe6, 0x6d, 0x91, 0xac, 0xe6,
                   0xf3, 0xf6, 0x4,  0x75, 0x42, 0x1f, 0x28, 0x2,  0x1c, 0x0,  0x8,  0x91, 0x5c, 0xce, 0x2b, 0xac, 0x8f,
                   0x3b, 0xc0, 0x3,  0x0,  0x8,  0x17, 0xe1, 0x8e, 0x7b, 0x7,  0x45, 0x6e, 0x6,  0x2,  0x0,  0x0,  0x4a,
                   0xbd, 0x19, 0x0,  0x17, 0x31, 0x12, 0x0,  0xf,  0x62, 0xce, 0xbe, 0xc,  0x19, 0xe,  0xe8, 0x1c, 0x5b,
                   0xad, 0xbd, 0x5f, 0xc9, 0x6d, 0xdc, 0x19, 0x83, 0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                   0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x16, 0x72, 0x8e, 0x51, 0x42, 0x31, 0xab, 0xd5, 0x29, 0x31, 0xd2, 0x71,
                               0xc7, 0x22, 0xcb, 0xe1, 0xfb, 0xe9, 0x5b, 0x26, 0x70, 0xca, 0xee};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xac, 0x1c, 0xba, 0xd8, 0x41, 0xf4, 0x4,  0x5e, 0x3c,
                              0x15, 0x88, 0xbb, 0xeb, 0x1b, 0xf5, 0xd1, 0x80};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 17787);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "e", _pubPktID = 29287, _pubBody =
// "o\220=\DLE\237\181\219\FS\ESC%~\198\SYN/{P", _pubProps = [PropContentType "",PropWildcardSubscriptionAvailable
// 8,PropTopicAlias 2941,PropServerReference ">\164*\219\172\189C~\219\a\236X\ESCS\140K\SYN2.",PropAuthenticationData
// "\143\202bO\250Z \196A\"L\218\ESC\235{B"]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x33, 0x47, 0x0,  0x1,  0x65, 0x72, 0x67, 0x31, 0x3,  0x0,  0x0,  0x28, 0x8,  0x23, 0xb,
                   0x7d, 0x1c, 0x0,  0x13, 0x3e, 0xa4, 0x2a, 0xdb, 0xac, 0xbd, 0x43, 0x7e, 0xdb, 0x7,  0xec,
                   0x58, 0x1b, 0x53, 0x8c, 0x4b, 0x16, 0x32, 0x2e, 0x16, 0x0,  0x10, 0x8f, 0xca, 0x62, 0x4f,
                   0xfa, 0x5a, 0x20, 0xc4, 0x41, 0x22, 0x4c, 0xda, 0x1b, 0xeb, 0x7b, 0x42, 0x6f, 0xdc, 0x3d,
                   0x10, 0xed, 0xb5, 0xdb, 0x1c, 0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  uint8_t topic_bytes[] = {0x65};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6f, 0xdc, 0x3d, 0x10, 0xed, 0xb5, 0xdb, 0x1c,
                         0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x3e, 0xa4, 0x2a, 0xdb, 0xac, 0xbd, 0x43, 0x7e, 0xdb, 0x7,
                           0xec, 0x58, 0x1b, 0x53, 0x8c, 0x4b, 0x16, 0x32, 0x2e};
  uint8_t bytesprops2[] = {0x8f, 0xca, 0x62, 0x4f, 0xfa, 0x5a, 0x20, 0xc4,
                           0x41, 0x22, 0x4c, 0xda, 0x1b, 0xeb, 0x7b, 0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2941}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29287, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "e", _pubPktID = 29287, _pubBody =
// "o\220=\DLE\237\181\219\FS\ESC%~\198\SYN/{P", _pubProps = [PropContentType "",PropWildcardSubscriptionAvailable
// 8,PropTopicAlias 2941,PropServerReference ">\164*\219\172\189C~\219\a\236X\ESCS\140K\SYN2.",PropAuthenticationData
// "\143\202bO\250Z \196A\"L\218\ESC\235{B"]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x33, 0x47, 0x0,  0x1,  0x65, 0x72, 0x67, 0x31, 0x3,  0x0,  0x0,  0x28, 0x8,  0x23, 0xb,
                   0x7d, 0x1c, 0x0,  0x13, 0x3e, 0xa4, 0x2a, 0xdb, 0xac, 0xbd, 0x43, 0x7e, 0xdb, 0x7,  0xec,
                   0x58, 0x1b, 0x53, 0x8c, 0x4b, 0x16, 0x32, 0x2e, 0x16, 0x0,  0x10, 0x8f, 0xca, 0x62, 0x4f,
                   0xfa, 0x5a, 0x20, 0xc4, 0x41, 0x22, 0x4c, 0xda, 0x1b, 0xeb, 0x7b, 0x42, 0x6f, 0xdc, 0x3d,
                   0x10, 0xed, 0xb5, 0xdb, 0x1c, 0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6f, 0xdc, 0x3d, 0x10, 0xed, 0xb5, 0xdb, 0x1c,
                              0x1b, 0x25, 0x7e, 0xc6, 0x16, 0x2f, 0x7b, 0x50};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29287);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\139\194\ETB\145\245\&3\175\131\230\149\231\192\SO", _pubPktID = 2558, _pubBody =
// "3u\151\168\SYN\191\144\230d\rn\148=", _pubProps = [PropReasonString "\254*Y
// \EMKY\147\155\&5\163\211\134\247\160\168%\145",PropRequestResponseInformation 218,PropUserProperty
// "(\197\144\176\252N-g\148\135\185\162g\CAN\136S" "\174\DEL/\130\159\244\217\201\SOHok",PropTopicAlias
// 11573,PropRetainAvailable 179,PropMaximumPacketSize 27929,PropRetainAvailable 251,PropRequestProblemInformation
// 190,PropRetainAvailable 60,PropUserProperty
// "\fH\165\224|\nG\159\223@\195j\220SD\US\128\247\207\164\149\DLE\156\151\185%\168x*\246"
// "\196-\193*\253D\207\136`\221\130\153\184\&9;\198\159g\136\139@\241|\206\158\ETXc",PropCorrelationData
// "V}pM\165\179\228\no\206\US?7\197>8I",PropRequestResponseInformation 251,PropResponseInformation
// "7\233F\220",PropTopicAliasMaximum 26753,PropAuthenticationData
// "\185\215\f@#\SYN\185\ENQx-c\230)\136\SI\134",PropSubscriptionIdentifierAvailable 173,PropPayloadFormatIndicator
// 61,PropSessionExpiryInterval 23833,PropResponseTopic "\ETX?\248'G\FS\ESC\SI\182\185\210n"]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x32, 0xf0, 0x1,  0x0,  0xd,  0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe,  0x9,
      0xfe, 0xd0, 0x1,  0x1f, 0x0,  0x12, 0xfe, 0x2a, 0x59, 0x20, 0x19, 0x4b, 0x59, 0x93, 0x9b, 0x35, 0xa3, 0xd3, 0x86,
      0xf7, 0xa0, 0xa8, 0x25, 0x91, 0x19, 0xda, 0x26, 0x0,  0x10, 0x28, 0xc5, 0x90, 0xb0, 0xfc, 0x4e, 0x2d, 0x67, 0x94,
      0x87, 0xb9, 0xa2, 0x67, 0x18, 0x88, 0x53, 0x0,  0xb,  0xae, 0x7f, 0x2f, 0x82, 0x9f, 0xf4, 0xd9, 0xc9, 0x1,  0x6f,
      0x6b, 0x23, 0x2d, 0x35, 0x25, 0xb3, 0x27, 0x0,  0x0,  0x6d, 0x19, 0x25, 0xfb, 0x17, 0xbe, 0x25, 0x3c, 0x26, 0x0,
      0x1e, 0xc,  0x48, 0xa5, 0xe0, 0x7c, 0xa,  0x47, 0x9f, 0xdf, 0x40, 0xc3, 0x6a, 0xdc, 0x53, 0x44, 0x1f, 0x80, 0xf7,
      0xcf, 0xa4, 0x95, 0x10, 0x9c, 0x97, 0xb9, 0x25, 0xa8, 0x78, 0x2a, 0xf6, 0x0,  0x1b, 0xc4, 0x2d, 0xc1, 0x2a, 0xfd,
      0x44, 0xcf, 0x88, 0x60, 0xdd, 0x82, 0x99, 0xb8, 0x39, 0x3b, 0xc6, 0x9f, 0x67, 0x88, 0x8b, 0x40, 0xf1, 0x7c, 0xce,
      0x9e, 0x3,  0x63, 0x9,  0x0,  0x11, 0x56, 0x7d, 0x70, 0x4d, 0xa5, 0xb3, 0xe4, 0xa,  0x6f, 0xce, 0x1f, 0x3f, 0x37,
      0xc5, 0x3e, 0x38, 0x49, 0x19, 0xfb, 0x1a, 0x0,  0x4,  0x37, 0xe9, 0x46, 0xdc, 0x22, 0x68, 0x81, 0x16, 0x0,  0x10,
      0xb9, 0xd7, 0xc,  0x40, 0x23, 0x16, 0xb9, 0x5,  0x78, 0x2d, 0x63, 0xe6, 0x29, 0x88, 0xf,  0x86, 0x29, 0xad, 0x1,
      0x3d, 0x11, 0x0,  0x0,  0x5d, 0x19, 0x8,  0x0,  0xc,  0x3,  0x3f, 0xf8, 0x27, 0x47, 0x1c, 0x1b, 0xf,  0xb6, 0xb9,
      0xd2, 0x6e, 0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd,  0x6e, 0x94, 0x3d};
  uint8_t topic_bytes[] = {0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd, 0x6e, 0x94, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0xfe, 0x2a, 0x59, 0x20, 0x19, 0x4b, 0x59, 0x93, 0x9b,
                           0x35, 0xa3, 0xd3, 0x86, 0xf7, 0xa0, 0xa8, 0x25, 0x91};
  uint8_t bytesprops2[] = {0xae, 0x7f, 0x2f, 0x82, 0x9f, 0xf4, 0xd9, 0xc9, 0x1, 0x6f, 0x6b};
  uint8_t bytesprops1[] = {0x28, 0xc5, 0x90, 0xb0, 0xfc, 0x4e, 0x2d, 0x67,
                           0x94, 0x87, 0xb9, 0xa2, 0x67, 0x18, 0x88, 0x53};
  uint8_t bytesprops4[] = {0xc4, 0x2d, 0xc1, 0x2a, 0xfd, 0x44, 0xcf, 0x88, 0x60, 0xdd, 0x82, 0x99, 0xb8, 0x39,
                           0x3b, 0xc6, 0x9f, 0x67, 0x88, 0x8b, 0x40, 0xf1, 0x7c, 0xce, 0x9e, 0x3,  0x63};
  uint8_t bytesprops3[] = {0xc,  0x48, 0xa5, 0xe0, 0x7c, 0xa,  0x47, 0x9f, 0xdf, 0x40, 0xc3, 0x6a, 0xdc, 0x53, 0x44,
                           0x1f, 0x80, 0xf7, 0xcf, 0xa4, 0x95, 0x10, 0x9c, 0x97, 0xb9, 0x25, 0xa8, 0x78, 0x2a, 0xf6};
  uint8_t bytesprops5[] = {0x56, 0x7d, 0x70, 0x4d, 0xa5, 0xb3, 0xe4, 0xa, 0x6f,
                           0xce, 0x1f, 0x3f, 0x37, 0xc5, 0x3e, 0x38, 0x49};
  uint8_t bytesprops6[] = {0x37, 0xe9, 0x46, 0xdc};
  uint8_t bytesprops7[] = {0xb9, 0xd7, 0xc, 0x40, 0x23, 0x16, 0xb9, 0x5, 0x78, 0x2d, 0x63, 0xe6, 0x29, 0x88, 0xf, 0x86};
  uint8_t bytesprops8[] = {0x3, 0x3f, 0xf8, 0x27, 0x47, 0x1c, 0x1b, 0xf, 0xb6, 0xb9, 0xd2, 0x6e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11573}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27929}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops3}, .v = {27, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26753}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23833}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 2558, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\139\194\ETB\145\245\&3\175\131\230\149\231\192\SO", _pubPktID = 2558, _pubBody =
// "3u\151\168\SYN\191\144\230d\rn\148=", _pubProps = [PropReasonString "\254*Y
// \EMKY\147\155\&5\163\211\134\247\160\168%\145",PropRequestResponseInformation 218,PropUserProperty
// "(\197\144\176\252N-g\148\135\185\162g\CAN\136S" "\174\DEL/\130\159\244\217\201\SOHok",PropTopicAlias
// 11573,PropRetainAvailable 179,PropMaximumPacketSize 27929,PropRetainAvailable 251,PropRequestProblemInformation
// 190,PropRetainAvailable 60,PropUserProperty
// "\fH\165\224|\nG\159\223@\195j\220SD\US\128\247\207\164\149\DLE\156\151\185%\168x*\246"
// "\196-\193*\253D\207\136`\221\130\153\184\&9;\198\159g\136\139@\241|\206\158\ETXc",PropCorrelationData
// "V}pM\165\179\228\no\206\US?7\197>8I",PropRequestResponseInformation 251,PropResponseInformation
// "7\233F\220",PropTopicAliasMaximum 26753,PropAuthenticationData
// "\185\215\f@#\SYN\185\ENQx-c\230)\136\SI\134",PropSubscriptionIdentifierAvailable 173,PropPayloadFormatIndicator
// 61,PropSessionExpiryInterval 23833,PropResponseTopic "\ETX?\248'G\FS\ESC\SI\182\185\210n"]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {
      0x32, 0xf0, 0x1,  0x0,  0xd,  0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe,  0x9,
      0xfe, 0xd0, 0x1,  0x1f, 0x0,  0x12, 0xfe, 0x2a, 0x59, 0x20, 0x19, 0x4b, 0x59, 0x93, 0x9b, 0x35, 0xa3, 0xd3, 0x86,
      0xf7, 0xa0, 0xa8, 0x25, 0x91, 0x19, 0xda, 0x26, 0x0,  0x10, 0x28, 0xc5, 0x90, 0xb0, 0xfc, 0x4e, 0x2d, 0x67, 0x94,
      0x87, 0xb9, 0xa2, 0x67, 0x18, 0x88, 0x53, 0x0,  0xb,  0xae, 0x7f, 0x2f, 0x82, 0x9f, 0xf4, 0xd9, 0xc9, 0x1,  0x6f,
      0x6b, 0x23, 0x2d, 0x35, 0x25, 0xb3, 0x27, 0x0,  0x0,  0x6d, 0x19, 0x25, 0xfb, 0x17, 0xbe, 0x25, 0x3c, 0x26, 0x0,
      0x1e, 0xc,  0x48, 0xa5, 0xe0, 0x7c, 0xa,  0x47, 0x9f, 0xdf, 0x40, 0xc3, 0x6a, 0xdc, 0x53, 0x44, 0x1f, 0x80, 0xf7,
      0xcf, 0xa4, 0x95, 0x10, 0x9c, 0x97, 0xb9, 0x25, 0xa8, 0x78, 0x2a, 0xf6, 0x0,  0x1b, 0xc4, 0x2d, 0xc1, 0x2a, 0xfd,
      0x44, 0xcf, 0x88, 0x60, 0xdd, 0x82, 0x99, 0xb8, 0x39, 0x3b, 0xc6, 0x9f, 0x67, 0x88, 0x8b, 0x40, 0xf1, 0x7c, 0xce,
      0x9e, 0x3,  0x63, 0x9,  0x0,  0x11, 0x56, 0x7d, 0x70, 0x4d, 0xa5, 0xb3, 0xe4, 0xa,  0x6f, 0xce, 0x1f, 0x3f, 0x37,
      0xc5, 0x3e, 0x38, 0x49, 0x19, 0xfb, 0x1a, 0x0,  0x4,  0x37, 0xe9, 0x46, 0xdc, 0x22, 0x68, 0x81, 0x16, 0x0,  0x10,
      0xb9, 0xd7, 0xc,  0x40, 0x23, 0x16, 0xb9, 0x5,  0x78, 0x2d, 0x63, 0xe6, 0x29, 0x88, 0xf,  0x86, 0x29, 0xad, 0x1,
      0x3d, 0x11, 0x0,  0x0,  0x5d, 0x19, 0x8,  0x0,  0xc,  0x3,  0x3f, 0xf8, 0x27, 0x47, 0x1c, 0x1b, 0xf,  0xb6, 0xb9,
      0xd2, 0x6e, 0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd,  0x6e, 0x94, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8b, 0xc2, 0x17, 0x91, 0xf5, 0x33, 0xaf, 0x83, 0xe6, 0x95, 0xe7, 0xc0, 0xe};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x33, 0x75, 0x97, 0xa8, 0x16, 0xbf, 0x90, 0xe6, 0x64, 0xd, 0x6e, 0x94, 0x3d};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2558);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "$\212", _pubPktID = 1716, _pubBody
// = "\190\141B\DELW\166\237\195J\183\212y\176h", _pubProps = [PropAssignedClientIdentifier
// "\149\128\198\171\US\253\GS\SUB?\180&B59Z'\166,\183/q\138\189\180\237>\206\170",PropReasonString
// "\\\139\DC2vGA-]R1\226\167%u&\250\bSO\207",PropPayloadFormatIndicator 220,PropAuthenticationMethod
// "d\207\238\as\253?>\142\255\204I\241\ETB",PropResponseInformation
// "p\f\222\&3\210\NAKi\139UX\190\192\SUB\245\&4\r;h",PropRequestResponseInformation 157,PropMaximumQoS
// 72,PropWillDelayInterval 24790,PropMessageExpiryInterval 3742,PropReceiveMaximum 23049,PropAuthenticationMethod
// "\189p%\221_\DLE\217u\177\183@\ACK\245\135\DC4\239\202\173\179\182\208V\163\168",PropRequestResponseInformation
// 85,PropSubscriptionIdentifier 0,PropRetainAvailable 38,PropTopicAliasMaximum 8926,PropSharedSubscriptionAvailable
// 17,PropContentType "\USb\156\FS\168\164.\NAK\140\DC2G\DC1N\185\&0\234Z",PropContentType
// "\237\135\132\186m\168\205\"!\215\208\163",PropRequestProblemInformation 174]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x34, 0xd0, 0x1,  0x0,  0x2,  0x24, 0xd4, 0x6,  0xb4, 0xba, 0x1,  0x12, 0x0,  0x1c, 0x95, 0x80, 0xc6,
                   0xab, 0x1f, 0xfd, 0x1d, 0x1a, 0x3f, 0xb4, 0x26, 0x42, 0x35, 0x39, 0x5a, 0x27, 0xa6, 0x2c, 0xb7, 0x2f,
                   0x71, 0x8a, 0xbd, 0xb4, 0xed, 0x3e, 0xce, 0xaa, 0x1f, 0x0,  0x14, 0x5c, 0x8b, 0x12, 0x76, 0x47, 0x41,
                   0x2d, 0x5d, 0x52, 0x31, 0xe2, 0xa7, 0x25, 0x75, 0x26, 0xfa, 0x8,  0x53, 0x4f, 0xcf, 0x1,  0xdc, 0x15,
                   0x0,  0xe,  0x64, 0xcf, 0xee, 0x7,  0x73, 0xfd, 0x3f, 0x3e, 0x8e, 0xff, 0xcc, 0x49, 0xf1, 0x17, 0x1a,
                   0x0,  0x12, 0x70, 0xc,  0xde, 0x33, 0xd2, 0x15, 0x69, 0x8b, 0x55, 0x58, 0xbe, 0xc0, 0x1a, 0xf5, 0x34,
                   0xd,  0x3b, 0x68, 0x19, 0x9d, 0x24, 0x48, 0x18, 0x0,  0x0,  0x60, 0xd6, 0x2,  0x0,  0x0,  0xe,  0x9e,
                   0x21, 0x5a, 0x9,  0x15, 0x0,  0x18, 0xbd, 0x70, 0x25, 0xdd, 0x5f, 0x10, 0xd9, 0x75, 0xb1, 0xb7, 0x40,
                   0x6,  0xf5, 0x87, 0x14, 0xef, 0xca, 0xad, 0xb3, 0xb6, 0xd0, 0x56, 0xa3, 0xa8, 0x19, 0x55, 0xb,  0x0,
                   0x25, 0x26, 0x22, 0x22, 0xde, 0x2a, 0x11, 0x3,  0x0,  0x11, 0x1f, 0x62, 0x9c, 0x1c, 0xa8, 0xa4, 0x2e,
                   0x15, 0x8c, 0x12, 0x47, 0x11, 0x4e, 0xb9, 0x30, 0xea, 0x5a, 0x3,  0x0,  0xc,  0xed, 0x87, 0x84, 0xba,
                   0x6d, 0xa8, 0xcd, 0x22, 0x21, 0xd7, 0xd0, 0xa3, 0x17, 0xae, 0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed,
                   0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  uint8_t topic_bytes[] = {0x24, 0xd4};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x95, 0x80, 0xc6, 0xab, 0x1f, 0xfd, 0x1d, 0x1a, 0x3f, 0xb4, 0x26, 0x42, 0x35, 0x39,
                           0x5a, 0x27, 0xa6, 0x2c, 0xb7, 0x2f, 0x71, 0x8a, 0xbd, 0xb4, 0xed, 0x3e, 0xce, 0xaa};
  uint8_t bytesprops1[] = {0x5c, 0x8b, 0x12, 0x76, 0x47, 0x41, 0x2d, 0x5d, 0x52, 0x31,
                           0xe2, 0xa7, 0x25, 0x75, 0x26, 0xfa, 0x8,  0x53, 0x4f, 0xcf};
  uint8_t bytesprops2[] = {0x64, 0xcf, 0xee, 0x7, 0x73, 0xfd, 0x3f, 0x3e, 0x8e, 0xff, 0xcc, 0x49, 0xf1, 0x17};
  uint8_t bytesprops3[] = {0x70, 0xc,  0xde, 0x33, 0xd2, 0x15, 0x69, 0x8b, 0x55,
                           0x58, 0xbe, 0xc0, 0x1a, 0xf5, 0x34, 0xd,  0x3b, 0x68};
  uint8_t bytesprops4[] = {0xbd, 0x70, 0x25, 0xdd, 0x5f, 0x10, 0xd9, 0x75, 0xb1, 0xb7, 0x40, 0x6,
                           0xf5, 0x87, 0x14, 0xef, 0xca, 0xad, 0xb3, 0xb6, 0xd0, 0x56, 0xa3, 0xa8};
  uint8_t bytesprops5[] = {0x1f, 0x62, 0x9c, 0x1c, 0xa8, 0xa4, 0x2e, 0x15, 0x8c,
                           0x12, 0x47, 0x11, 0x4e, 0xb9, 0x30, 0xea, 0x5a};
  uint8_t bytesprops6[] = {0xed, 0x87, 0x84, 0xba, 0x6d, 0xa8, 0xcd, 0x22, 0x21, 0xd7, 0xd0, 0xa3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24790}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3742}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23049}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8926}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 174}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 1716, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "$\212", _pubPktID = 1716, _pubBody
// = "\190\141B\DELW\166\237\195J\183\212y\176h", _pubProps = [PropAssignedClientIdentifier
// "\149\128\198\171\US\253\GS\SUB?\180&B59Z'\166,\183/q\138\189\180\237>\206\170",PropReasonString
// "\\\139\DC2vGA-]R1\226\167%u&\250\bSO\207",PropPayloadFormatIndicator 220,PropAuthenticationMethod
// "d\207\238\as\253?>\142\255\204I\241\ETB",PropResponseInformation
// "p\f\222\&3\210\NAKi\139UX\190\192\SUB\245\&4\r;h",PropRequestResponseInformation 157,PropMaximumQoS
// 72,PropWillDelayInterval 24790,PropMessageExpiryInterval 3742,PropReceiveMaximum 23049,PropAuthenticationMethod
// "\189p%\221_\DLE\217u\177\183@\ACK\245\135\DC4\239\202\173\179\182\208V\163\168",PropRequestResponseInformation
// 85,PropSubscriptionIdentifier 0,PropRetainAvailable 38,PropTopicAliasMaximum 8926,PropSharedSubscriptionAvailable
// 17,PropContentType "\USb\156\FS\168\164.\NAK\140\DC2G\DC1N\185\&0\234Z",PropContentType
// "\237\135\132\186m\168\205\"!\215\208\163",PropRequestProblemInformation 174]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x34, 0xd0, 0x1,  0x0,  0x2,  0x24, 0xd4, 0x6,  0xb4, 0xba, 0x1,  0x12, 0x0,  0x1c, 0x95, 0x80, 0xc6,
                   0xab, 0x1f, 0xfd, 0x1d, 0x1a, 0x3f, 0xb4, 0x26, 0x42, 0x35, 0x39, 0x5a, 0x27, 0xa6, 0x2c, 0xb7, 0x2f,
                   0x71, 0x8a, 0xbd, 0xb4, 0xed, 0x3e, 0xce, 0xaa, 0x1f, 0x0,  0x14, 0x5c, 0x8b, 0x12, 0x76, 0x47, 0x41,
                   0x2d, 0x5d, 0x52, 0x31, 0xe2, 0xa7, 0x25, 0x75, 0x26, 0xfa, 0x8,  0x53, 0x4f, 0xcf, 0x1,  0xdc, 0x15,
                   0x0,  0xe,  0x64, 0xcf, 0xee, 0x7,  0x73, 0xfd, 0x3f, 0x3e, 0x8e, 0xff, 0xcc, 0x49, 0xf1, 0x17, 0x1a,
                   0x0,  0x12, 0x70, 0xc,  0xde, 0x33, 0xd2, 0x15, 0x69, 0x8b, 0x55, 0x58, 0xbe, 0xc0, 0x1a, 0xf5, 0x34,
                   0xd,  0x3b, 0x68, 0x19, 0x9d, 0x24, 0x48, 0x18, 0x0,  0x0,  0x60, 0xd6, 0x2,  0x0,  0x0,  0xe,  0x9e,
                   0x21, 0x5a, 0x9,  0x15, 0x0,  0x18, 0xbd, 0x70, 0x25, 0xdd, 0x5f, 0x10, 0xd9, 0x75, 0xb1, 0xb7, 0x40,
                   0x6,  0xf5, 0x87, 0x14, 0xef, 0xca, 0xad, 0xb3, 0xb6, 0xd0, 0x56, 0xa3, 0xa8, 0x19, 0x55, 0xb,  0x0,
                   0x25, 0x26, 0x22, 0x22, 0xde, 0x2a, 0x11, 0x3,  0x0,  0x11, 0x1f, 0x62, 0x9c, 0x1c, 0xa8, 0xa4, 0x2e,
                   0x15, 0x8c, 0x12, 0x47, 0x11, 0x4e, 0xb9, 0x30, 0xea, 0x5a, 0x3,  0x0,  0xc,  0xed, 0x87, 0x84, 0xba,
                   0x6d, 0xa8, 0xcd, 0x22, 0x21, 0xd7, 0xd0, 0xa3, 0x17, 0xae, 0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed,
                   0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x24, 0xd4};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbe, 0x8d, 0x42, 0x7f, 0x57, 0xa6, 0xed, 0xc3, 0x4a, 0xb7, 0xd4, 0x79, 0xb0, 0x68};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 1716);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\180\150\252c\201h%\ACKX[",
// _pubPktID = 23232, _pubBody = "\245\158IP\ETX\CAN\DLE|\148\175\r", _pubProps = [PropResponseInformation
// "\ETB\240\GSR\130D",PropAuthenticationMethod
// "k\224\193vn3L\249<\161\207\US\215\203\&5\228\SYN\134\167\222",PropTopicAlias 16911,PropResponseTopic
// ".s\246\161\ESC",PropWillDelayInterval 18379,PropMessageExpiryInterval 29762,PropReasonString
// "\178\224\&8\ESC\174",PropSubscriptionIdentifierAvailable 214,PropPayloadFormatIndicator
// 240,PropRequestProblemInformation 247,PropSharedSubscriptionAvailable 9,PropResponseInformation
// "\148F?\220\204\149",PropContentType "\138\251\159E`\NUL"]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {0x3c, 0x71, 0x0,  0xa,  0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6,  0x58, 0x5b, 0x5a, 0xc0, 0x57,
                   0x1a, 0x0,  0x6,  0x17, 0xf0, 0x1d, 0x52, 0x82, 0x44, 0x15, 0x0,  0x14, 0x6b, 0xe0, 0xc1, 0x76, 0x6e,
                   0x33, 0x4c, 0xf9, 0x3c, 0xa1, 0xcf, 0x1f, 0xd7, 0xcb, 0x35, 0xe4, 0x16, 0x86, 0xa7, 0xde, 0x23, 0x42,
                   0xf,  0x8,  0x0,  0x5,  0x2e, 0x73, 0xf6, 0xa1, 0x1b, 0x18, 0x0,  0x0,  0x47, 0xcb, 0x2,  0x0,  0x0,
                   0x74, 0x42, 0x1f, 0x0,  0x5,  0xb2, 0xe0, 0x38, 0x1b, 0xae, 0x29, 0xd6, 0x1,  0xf0, 0x17, 0xf7, 0x2a,
                   0x9,  0x1a, 0x0,  0x6,  0x94, 0x46, 0x3f, 0xdc, 0xcc, 0x95, 0x3,  0x0,  0x6,  0x8a, 0xfb, 0x9f, 0x45,
                   0x60, 0x0,  0xf5, 0x9e, 0x49, 0x50, 0x3,  0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  uint8_t topic_bytes[] = {0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6, 0x58, 0x5b};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x9e, 0x49, 0x50, 0x3, 0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x17, 0xf0, 0x1d, 0x52, 0x82, 0x44};
  uint8_t bytesprops1[] = {0x6b, 0xe0, 0xc1, 0x76, 0x6e, 0x33, 0x4c, 0xf9, 0x3c, 0xa1,
                           0xcf, 0x1f, 0xd7, 0xcb, 0x35, 0xe4, 0x16, 0x86, 0xa7, 0xde};
  uint8_t bytesprops2[] = {0x2e, 0x73, 0xf6, 0xa1, 0x1b};
  uint8_t bytesprops3[] = {0xb2, 0xe0, 0x38, 0x1b, 0xae};
  uint8_t bytesprops4[] = {0x94, 0x46, 0x3f, 0xdc, 0xcc, 0x95};
  uint8_t bytesprops5[] = {0x8a, 0xfb, 0x9f, 0x45, 0x60, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16911}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18379}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29762}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 23232, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\180\150\252c\201h%\ACKX[",
// _pubPktID = 23232, _pubBody = "\245\158IP\ETX\CAN\DLE|\148\175\r", _pubProps = [PropResponseInformation
// "\ETB\240\GSR\130D",PropAuthenticationMethod
// "k\224\193vn3L\249<\161\207\US\215\203\&5\228\SYN\134\167\222",PropTopicAlias 16911,PropResponseTopic
// ".s\246\161\ESC",PropWillDelayInterval 18379,PropMessageExpiryInterval 29762,PropReasonString
// "\178\224\&8\ESC\174",PropSubscriptionIdentifierAvailable 214,PropPayloadFormatIndicator
// 240,PropRequestProblemInformation 247,PropSharedSubscriptionAvailable 9,PropResponseInformation
// "\148F?\220\204\149",PropContentType "\138\251\159E`\NUL"]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {0x3c, 0x71, 0x0,  0xa,  0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6,  0x58, 0x5b, 0x5a, 0xc0, 0x57,
                   0x1a, 0x0,  0x6,  0x17, 0xf0, 0x1d, 0x52, 0x82, 0x44, 0x15, 0x0,  0x14, 0x6b, 0xe0, 0xc1, 0x76, 0x6e,
                   0x33, 0x4c, 0xf9, 0x3c, 0xa1, 0xcf, 0x1f, 0xd7, 0xcb, 0x35, 0xe4, 0x16, 0x86, 0xa7, 0xde, 0x23, 0x42,
                   0xf,  0x8,  0x0,  0x5,  0x2e, 0x73, 0xf6, 0xa1, 0x1b, 0x18, 0x0,  0x0,  0x47, 0xcb, 0x2,  0x0,  0x0,
                   0x74, 0x42, 0x1f, 0x0,  0x5,  0xb2, 0xe0, 0x38, 0x1b, 0xae, 0x29, 0xd6, 0x1,  0xf0, 0x17, 0xf7, 0x2a,
                   0x9,  0x1a, 0x0,  0x6,  0x94, 0x46, 0x3f, 0xdc, 0xcc, 0x95, 0x3,  0x0,  0x6,  0x8a, 0xfb, 0x9f, 0x45,
                   0x60, 0x0,  0xf5, 0x9e, 0x49, 0x50, 0x3,  0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb4, 0x96, 0xfc, 0x63, 0xc9, 0x68, 0x25, 0x6, 0x58, 0x5b};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x9e, 0x49, 0x50, 0x3, 0x18, 0x10, 0x7c, 0x94, 0xaf, 0xd};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 23232);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\200a\188\164\254\SO\133s@",
// _pubPktID = 0, _pubBody = "i<UJ\217J(v\163\\\208Z\209\&0\236~1d\211X\DC2", _pubProps = [PropContentType
// ">\EM\SOH\179\179;\199eG\211b\163Ye\"\211",PropReceiveMaximum 10464,PropResponseInformation
// "n\204",PropServerKeepAlive 19107,PropMessageExpiryInterval 27838,PropWildcardSubscriptionAvailable
// 102,PropMessageExpiryInterval 15603,PropSubscriptionIdentifierAvailable 131,PropCorrelationData
// "l\140",PropSessionExpiryInterval 5845,PropRequestProblemInformation 83,PropRequestProblemInformation
// 46,PropMessageExpiryInterval 25078,PropUserProperty "\150)g\181\184]V]\157\&7S&\132\206\n4\204r\215h{\188vO&\b\159"
// "\207\141\142\222;MI\152\225\220\v\164\149j\254\245>\170\129\128X\161W\"\174",PropMessageExpiryInterval
// 3649,PropAuthenticationData
// "\ACK\t\220\229\130\146\EOT.o\203BV\173U\247\222\218\228\222\149\&7",PropRequestProblemInformation
// 2,PropRetainAvailable 126,PropSessionExpiryInterval 32225,PropPayloadFormatIndicator 175,PropReceiveMaximum
// 24587,PropResponseTopic ";\160\163\250\174&#R\164\182\152\143\145@mF)\204\182S4\190\199O\254$\236",PropMaximumQoS
// 219,PropPayloadFormatIndicator 233,PropTopicAlias 32208,PropContentType ":\176Q",PropResponseTopic
// "7\NUL\174V\168\226\193svo\225`\ESC\147\250a:1.W\rK\249"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x31, 0x8a, 0x2,  0x0,  0x9,  0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe,  0x85, 0x73, 0x40, 0xe8, 0x1,  0x3,
                   0x0,  0x10, 0x3e, 0x19, 0x1,  0xb3, 0xb3, 0x3b, 0xc7, 0x65, 0x47, 0xd3, 0x62, 0xa3, 0x59, 0x65, 0x22,
                   0xd3, 0x21, 0x28, 0xe0, 0x1a, 0x0,  0x2,  0x6e, 0xcc, 0x13, 0x4a, 0xa3, 0x2,  0x0,  0x0,  0x6c, 0xbe,
                   0x28, 0x66, 0x2,  0x0,  0x0,  0x3c, 0xf3, 0x29, 0x83, 0x9,  0x0,  0x2,  0x6c, 0x8c, 0x11, 0x0,  0x0,
                   0x16, 0xd5, 0x17, 0x53, 0x17, 0x2e, 0x2,  0x0,  0x0,  0x61, 0xf6, 0x26, 0x0,  0x1b, 0x96, 0x29, 0x67,
                   0xb5, 0xb8, 0x5d, 0x56, 0x5d, 0x9d, 0x37, 0x53, 0x26, 0x84, 0xce, 0xa,  0x34, 0xcc, 0x72, 0xd7, 0x68,
                   0x7b, 0xbc, 0x76, 0x4f, 0x26, 0x8,  0x9f, 0x0,  0x19, 0xcf, 0x8d, 0x8e, 0xde, 0x3b, 0x4d, 0x49, 0x98,
                   0xe1, 0xdc, 0xb,  0xa4, 0x95, 0x6a, 0xfe, 0xf5, 0x3e, 0xaa, 0x81, 0x80, 0x58, 0xa1, 0x57, 0x22, 0xae,
                   0x2,  0x0,  0x0,  0xe,  0x41, 0x16, 0x0,  0x15, 0x6,  0x9,  0xdc, 0xe5, 0x82, 0x92, 0x4,  0x2e, 0x6f,
                   0xcb, 0x42, 0x56, 0xad, 0x55, 0xf7, 0xde, 0xda, 0xe4, 0xde, 0x95, 0x37, 0x17, 0x2,  0x25, 0x7e, 0x11,
                   0x0,  0x0,  0x7d, 0xe1, 0x1,  0xaf, 0x21, 0x60, 0xb,  0x8,  0x0,  0x1b, 0x3b, 0xa0, 0xa3, 0xfa, 0xae,
                   0x26, 0x23, 0x52, 0xa4, 0xb6, 0x98, 0x8f, 0x91, 0x40, 0x6d, 0x46, 0x29, 0xcc, 0xb6, 0x53, 0x34, 0xbe,
                   0xc7, 0x4f, 0xfe, 0x24, 0xec, 0x24, 0xdb, 0x1,  0xe9, 0x23, 0x7d, 0xd0, 0x3,  0x0,  0x3,  0x3a, 0xb0,
                   0x51, 0x8,  0x0,  0x17, 0x37, 0x0,  0xae, 0x56, 0xa8, 0xe2, 0xc1, 0x73, 0x76, 0x6f, 0xe1, 0x60, 0x1b,
                   0x93, 0xfa, 0x61, 0x3a, 0x31, 0x2e, 0x57, 0xd,  0x4b, 0xf9, 0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28,
                   0x76, 0xa3, 0x5c, 0xd0, 0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  uint8_t topic_bytes[] = {0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe, 0x85, 0x73, 0x40};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                         0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x3e, 0x19, 0x1,  0xb3, 0xb3, 0x3b, 0xc7, 0x65,
                           0x47, 0xd3, 0x62, 0xa3, 0x59, 0x65, 0x22, 0xd3};
  uint8_t bytesprops1[] = {0x6e, 0xcc};
  uint8_t bytesprops2[] = {0x6c, 0x8c};
  uint8_t bytesprops4[] = {0xcf, 0x8d, 0x8e, 0xde, 0x3b, 0x4d, 0x49, 0x98, 0xe1, 0xdc, 0xb,  0xa4, 0x95,
                           0x6a, 0xfe, 0xf5, 0x3e, 0xaa, 0x81, 0x80, 0x58, 0xa1, 0x57, 0x22, 0xae};
  uint8_t bytesprops3[] = {0x96, 0x29, 0x67, 0xb5, 0xb8, 0x5d, 0x56, 0x5d, 0x9d, 0x37, 0x53, 0x26, 0x84, 0xce,
                           0xa,  0x34, 0xcc, 0x72, 0xd7, 0x68, 0x7b, 0xbc, 0x76, 0x4f, 0x26, 0x8,  0x9f};
  uint8_t bytesprops5[] = {0x6,  0x9,  0xdc, 0xe5, 0x82, 0x92, 0x4,  0x2e, 0x6f, 0xcb, 0x42,
                           0x56, 0xad, 0x55, 0xf7, 0xde, 0xda, 0xe4, 0xde, 0x95, 0x37};
  uint8_t bytesprops6[] = {0x3b, 0xa0, 0xa3, 0xfa, 0xae, 0x26, 0x23, 0x52, 0xa4, 0xb6, 0x98, 0x8f, 0x91, 0x40,
                           0x6d, 0x46, 0x29, 0xcc, 0xb6, 0x53, 0x34, 0xbe, 0xc7, 0x4f, 0xfe, 0x24, 0xec};
  uint8_t bytesprops7[] = {0x3a, 0xb0, 0x51};
  uint8_t bytesprops8[] = {0x37, 0x0,  0xae, 0x56, 0xa8, 0xe2, 0xc1, 0x73, 0x76, 0x6f, 0xe1, 0x60,
                           0x1b, 0x93, 0xfa, 0x61, 0x3a, 0x31, 0x2e, 0x57, 0xd,  0x4b, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10464}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19107}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27838}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15603}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5845}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25078}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops3}, .v = {25, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3649}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32225}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24587}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32208}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\200a\188\164\254\SO\133s@",
// _pubPktID = 0, _pubBody = "i<UJ\217J(v\163\\\208Z\209\&0\236~1d\211X\DC2", _pubProps = [PropContentType
// ">\EM\SOH\179\179;\199eG\211b\163Ye\"\211",PropReceiveMaximum 10464,PropResponseInformation
// "n\204",PropServerKeepAlive 19107,PropMessageExpiryInterval 27838,PropWildcardSubscriptionAvailable
// 102,PropMessageExpiryInterval 15603,PropSubscriptionIdentifierAvailable 131,PropCorrelationData
// "l\140",PropSessionExpiryInterval 5845,PropRequestProblemInformation 83,PropRequestProblemInformation
// 46,PropMessageExpiryInterval 25078,PropUserProperty "\150)g\181\184]V]\157\&7S&\132\206\n4\204r\215h{\188vO&\b\159"
// "\207\141\142\222;MI\152\225\220\v\164\149j\254\245>\170\129\128X\161W\"\174",PropMessageExpiryInterval
// 3649,PropAuthenticationData
// "\ACK\t\220\229\130\146\EOT.o\203BV\173U\247\222\218\228\222\149\&7",PropRequestProblemInformation
// 2,PropRetainAvailable 126,PropSessionExpiryInterval 32225,PropPayloadFormatIndicator 175,PropReceiveMaximum
// 24587,PropResponseTopic ";\160\163\250\174&#R\164\182\152\143\145@mF)\204\182S4\190\199O\254$\236",PropMaximumQoS
// 219,PropPayloadFormatIndicator 233,PropTopicAlias 32208,PropContentType ":\176Q",PropResponseTopic
// "7\NUL\174V\168\226\193svo\225`\ESC\147\250a:1.W\rK\249"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x31, 0x8a, 0x2,  0x0,  0x9,  0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe,  0x85, 0x73, 0x40, 0xe8, 0x1,  0x3,
                   0x0,  0x10, 0x3e, 0x19, 0x1,  0xb3, 0xb3, 0x3b, 0xc7, 0x65, 0x47, 0xd3, 0x62, 0xa3, 0x59, 0x65, 0x22,
                   0xd3, 0x21, 0x28, 0xe0, 0x1a, 0x0,  0x2,  0x6e, 0xcc, 0x13, 0x4a, 0xa3, 0x2,  0x0,  0x0,  0x6c, 0xbe,
                   0x28, 0x66, 0x2,  0x0,  0x0,  0x3c, 0xf3, 0x29, 0x83, 0x9,  0x0,  0x2,  0x6c, 0x8c, 0x11, 0x0,  0x0,
                   0x16, 0xd5, 0x17, 0x53, 0x17, 0x2e, 0x2,  0x0,  0x0,  0x61, 0xf6, 0x26, 0x0,  0x1b, 0x96, 0x29, 0x67,
                   0xb5, 0xb8, 0x5d, 0x56, 0x5d, 0x9d, 0x37, 0x53, 0x26, 0x84, 0xce, 0xa,  0x34, 0xcc, 0x72, 0xd7, 0x68,
                   0x7b, 0xbc, 0x76, 0x4f, 0x26, 0x8,  0x9f, 0x0,  0x19, 0xcf, 0x8d, 0x8e, 0xde, 0x3b, 0x4d, 0x49, 0x98,
                   0xe1, 0xdc, 0xb,  0xa4, 0x95, 0x6a, 0xfe, 0xf5, 0x3e, 0xaa, 0x81, 0x80, 0x58, 0xa1, 0x57, 0x22, 0xae,
                   0x2,  0x0,  0x0,  0xe,  0x41, 0x16, 0x0,  0x15, 0x6,  0x9,  0xdc, 0xe5, 0x82, 0x92, 0x4,  0x2e, 0x6f,
                   0xcb, 0x42, 0x56, 0xad, 0x55, 0xf7, 0xde, 0xda, 0xe4, 0xde, 0x95, 0x37, 0x17, 0x2,  0x25, 0x7e, 0x11,
                   0x0,  0x0,  0x7d, 0xe1, 0x1,  0xaf, 0x21, 0x60, 0xb,  0x8,  0x0,  0x1b, 0x3b, 0xa0, 0xa3, 0xfa, 0xae,
                   0x26, 0x23, 0x52, 0xa4, 0xb6, 0x98, 0x8f, 0x91, 0x40, 0x6d, 0x46, 0x29, 0xcc, 0xb6, 0x53, 0x34, 0xbe,
                   0xc7, 0x4f, 0xfe, 0x24, 0xec, 0x24, 0xdb, 0x1,  0xe9, 0x23, 0x7d, 0xd0, 0x3,  0x0,  0x3,  0x3a, 0xb0,
                   0x51, 0x8,  0x0,  0x17, 0x37, 0x0,  0xae, 0x56, 0xa8, 0xe2, 0xc1, 0x73, 0x76, 0x6f, 0xe1, 0x60, 0x1b,
                   0x93, 0xfa, 0x61, 0x3a, 0x31, 0x2e, 0x57, 0xd,  0x4b, 0xf9, 0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28,
                   0x76, 0xa3, 0x5c, 0xd0, 0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc8, 0x61, 0xbc, 0xa4, 0xfe, 0xe, 0x85, 0x73, 0x40};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x69, 0x3c, 0x55, 0x4a, 0xd9, 0x4a, 0x28, 0x76, 0xa3, 0x5c, 0xd0,
                              0x5a, 0xd1, 0x30, 0xec, 0x7e, 0x31, 0x64, 0xd3, 0x58, 0x12};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ">\248\138\204\&7]\233\FS\228\b|\187\148\202aA\US\153\STX\GS\135\211p", _pubPktID = 4359, _pubBody =
// "\242\145\166\143\135]\136Z\130\202\216\&2*\239?C\217\144\162", _pubProps = [PropSharedSubscriptionAvailable
// 179,PropAuthenticationData "4C\158\223\174\165\223\218k\FSy\238\249\197\134\t>",PropRequestProblemInformation
// 118,PropResponseTopic ":\162\STX \239",PropMessageExpiryInterval 16702,PropMaximumQoS 226,PropServerReference
// "\216\176\ACKP\234\&8z\131\&0\221\248kFLX\225\193\STX\223\201L;\217\242\253\t\168\245TP",PropMaximumPacketSize
// 7247,PropSessionExpiryInterval 6004]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x34, 0x81, 0x1,  0x0,  0x17, 0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                   0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70, 0x11, 0x7,  0x52, 0x2a, 0xb3, 0x16,
                   0x0,  0x11, 0x34, 0x43, 0x9e, 0xdf, 0xae, 0xa5, 0xdf, 0xda, 0x6b, 0x1c, 0x79, 0xee, 0xf9, 0xc5, 0x86,
                   0x9,  0x3e, 0x17, 0x76, 0x8,  0x0,  0x5,  0x3a, 0xa2, 0x2,  0x20, 0xef, 0x2,  0x0,  0x0,  0x41, 0x3e,
                   0x24, 0xe2, 0x1c, 0x0,  0x1e, 0xd8, 0xb0, 0x6,  0x50, 0xea, 0x38, 0x7a, 0x83, 0x30, 0xdd, 0xf8, 0x6b,
                   0x46, 0x4c, 0x58, 0xe1, 0xc1, 0x2,  0xdf, 0xc9, 0x4c, 0x3b, 0xd9, 0xf2, 0xfd, 0x9,  0xa8, 0xf5, 0x54,
                   0x50, 0x27, 0x0,  0x0,  0x1c, 0x4f, 0x11, 0x0,  0x0,  0x17, 0x74, 0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d,
                   0x88, 0x5a, 0x82, 0xca, 0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  uint8_t topic_bytes[] = {0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                           0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca,
                         0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x34, 0x43, 0x9e, 0xdf, 0xae, 0xa5, 0xdf, 0xda, 0x6b,
                           0x1c, 0x79, 0xee, 0xf9, 0xc5, 0x86, 0x9,  0x3e};
  uint8_t bytesprops1[] = {0x3a, 0xa2, 0x2, 0x20, 0xef};
  uint8_t bytesprops2[] = {0xd8, 0xb0, 0x6, 0x50, 0xea, 0x38, 0x7a, 0x83, 0x30, 0xdd, 0xf8, 0x6b, 0x46, 0x4c, 0x58,
                           0xe1, 0xc1, 0x2, 0xdf, 0xc9, 0x4c, 0x3b, 0xd9, 0xf2, 0xfd, 0x9,  0xa8, 0xf5, 0x54, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16702}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7247}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6004}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 4359, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ">\248\138\204\&7]\233\FS\228\b|\187\148\202aA\US\153\STX\GS\135\211p", _pubPktID = 4359, _pubBody =
// "\242\145\166\143\135]\136Z\130\202\216\&2*\239?C\217\144\162", _pubProps = [PropSharedSubscriptionAvailable
// 179,PropAuthenticationData "4C\158\223\174\165\223\218k\FSy\238\249\197\134\t>",PropRequestProblemInformation
// 118,PropResponseTopic ":\162\STX \239",PropMessageExpiryInterval 16702,PropMaximumQoS 226,PropServerReference
// "\216\176\ACKP\234\&8z\131\&0\221\248kFLX\225\193\STX\223\201L;\217\242\253\t\168\245TP",PropMaximumPacketSize
// 7247,PropSessionExpiryInterval 6004]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x34, 0x81, 0x1,  0x0,  0x17, 0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                   0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70, 0x11, 0x7,  0x52, 0x2a, 0xb3, 0x16,
                   0x0,  0x11, 0x34, 0x43, 0x9e, 0xdf, 0xae, 0xa5, 0xdf, 0xda, 0x6b, 0x1c, 0x79, 0xee, 0xf9, 0xc5, 0x86,
                   0x9,  0x3e, 0x17, 0x76, 0x8,  0x0,  0x5,  0x3a, 0xa2, 0x2,  0x20, 0xef, 0x2,  0x0,  0x0,  0x41, 0x3e,
                   0x24, 0xe2, 0x1c, 0x0,  0x1e, 0xd8, 0xb0, 0x6,  0x50, 0xea, 0x38, 0x7a, 0x83, 0x30, 0xdd, 0xf8, 0x6b,
                   0x46, 0x4c, 0x58, 0xe1, 0xc1, 0x2,  0xdf, 0xc9, 0x4c, 0x3b, 0xd9, 0xf2, 0xfd, 0x9,  0xa8, 0xf5, 0x54,
                   0x50, 0x27, 0x0,  0x0,  0x1c, 0x4f, 0x11, 0x0,  0x0,  0x17, 0x74, 0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d,
                   0x88, 0x5a, 0x82, 0xca, 0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3e, 0xf8, 0x8a, 0xcc, 0x37, 0x5d, 0xe9, 0x1c, 0xe4, 0x8,  0x7c, 0xbb,
                               0x94, 0xca, 0x61, 0x41, 0x1f, 0x99, 0x2,  0x1d, 0x87, 0xd3, 0x70};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf2, 0x91, 0xa6, 0x8f, 0x87, 0x5d, 0x88, 0x5a, 0x82, 0xca,
                              0xd8, 0x32, 0x2a, 0xef, 0x3f, 0x43, 0xd9, 0x90, 0xa2};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 4359);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\245*\174k\165!xK\226\163\190\195\171\228\STXdu\RS", _pubPktID = 10342, _pubBody =
// "\178\172\US)\254\SYN\146\229\NULP\NAK\n\186\220\f\"\SYN\230\190", _pubProps = [PropRequestResponseInformation
// 69,PropTopicAliasMaximum 26959,PropServerKeepAlive 3865,PropTopicAliasMaximum
// 19761,PropSubscriptionIdentifierAvailable 115,PropAuthenticationData "\NUL\214\GScu?p\248\202",PropReceiveMaximum
// 15909,PropUserProperty "\191" "\235\242\RS\167\187Jk\237\&7%\157\192\213>LS\ACKi\"!\175\255",PropTopicAlias
// 31038,PropAuthenticationMethod "v;\218\149\251?tvDk",PropAssignedClientIdentifier
// "\129\EMo\251\138\210\178\248z`\EM\238Z\231\DC1\"!\bI\f\219\176\245\140\149\137\182\202",PropMessageExpiryInterval
// 14407]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {0x32, 0x96, 0x1,  0x0,  0x12, 0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2, 0xa3, 0xbe,
                   0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e, 0x28, 0x66, 0x6c, 0x19, 0x45, 0x22, 0x69, 0x4f, 0x13,
                   0xf,  0x19, 0x22, 0x4d, 0x31, 0x29, 0x73, 0x16, 0x0,  0x9,  0x0,  0xd6, 0x1d, 0x63, 0x75, 0x3f,
                   0x70, 0xf8, 0xca, 0x21, 0x3e, 0x25, 0x26, 0x0,  0x1,  0xbf, 0x0,  0x16, 0xeb, 0xf2, 0x1e, 0xa7,
                   0xbb, 0x4a, 0x6b, 0xed, 0x37, 0x25, 0x9d, 0xc0, 0xd5, 0x3e, 0x4c, 0x53, 0x6,  0x69, 0x22, 0x21,
                   0xaf, 0xff, 0x23, 0x79, 0x3e, 0x15, 0x0,  0xa,  0x76, 0x3b, 0xda, 0x95, 0xfb, 0x3f, 0x74, 0x76,
                   0x44, 0x6b, 0x12, 0x0,  0x1c, 0x81, 0x19, 0x6f, 0xfb, 0x8a, 0xd2, 0xb2, 0xf8, 0x7a, 0x60, 0x19,
                   0xee, 0x5a, 0xe7, 0x11, 0x22, 0x21, 0x8,  0x49, 0xc,  0xdb, 0xb0, 0xf5, 0x8c, 0x95, 0x89, 0xb6,
                   0xca, 0x2,  0x0,  0x0,  0x38, 0x47, 0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0,  0x50,
                   0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  uint8_t topic_bytes[] = {0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2,
                           0xa3, 0xbe, 0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0, 0x50,
                         0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x0, 0xd6, 0x1d, 0x63, 0x75, 0x3f, 0x70, 0xf8, 0xca};
  uint8_t bytesprops2[] = {0xeb, 0xf2, 0x1e, 0xa7, 0xbb, 0x4a, 0x6b, 0xed, 0x37, 0x25, 0x9d,
                           0xc0, 0xd5, 0x3e, 0x4c, 0x53, 0x6,  0x69, 0x22, 0x21, 0xaf, 0xff};
  uint8_t bytesprops1[] = {0xbf};
  uint8_t bytesprops3[] = {0x76, 0x3b, 0xda, 0x95, 0xfb, 0x3f, 0x74, 0x76, 0x44, 0x6b};
  uint8_t bytesprops4[] = {0x81, 0x19, 0x6f, 0xfb, 0x8a, 0xd2, 0xb2, 0xf8, 0x7a, 0x60, 0x19, 0xee, 0x5a, 0xe7,
                           0x11, 0x22, 0x21, 0x8,  0x49, 0xc,  0xdb, 0xb0, 0xf5, 0x8c, 0x95, 0x89, 0xb6, 0xca};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26959}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3865}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19761}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15909}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops1}, .v = {22, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31038}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14407}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10342, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\245*\174k\165!xK\226\163\190\195\171\228\STXdu\RS", _pubPktID = 10342, _pubBody =
// "\178\172\US)\254\SYN\146\229\NULP\NAK\n\186\220\f\"\SYN\230\190", _pubProps = [PropRequestResponseInformation
// 69,PropTopicAliasMaximum 26959,PropServerKeepAlive 3865,PropTopicAliasMaximum
// 19761,PropSubscriptionIdentifierAvailable 115,PropAuthenticationData "\NUL\214\GScu?p\248\202",PropReceiveMaximum
// 15909,PropUserProperty "\191" "\235\242\RS\167\187Jk\237\&7%\157\192\213>LS\ACKi\"!\175\255",PropTopicAlias
// 31038,PropAuthenticationMethod "v;\218\149\251?tvDk",PropAssignedClientIdentifier
// "\129\EMo\251\138\210\178\248z`\EM\238Z\231\DC1\"!\bI\f\219\176\245\140\149\137\182\202",PropMessageExpiryInterval
// 14407]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {0x32, 0x96, 0x1,  0x0,  0x12, 0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2, 0xa3, 0xbe,
                   0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e, 0x28, 0x66, 0x6c, 0x19, 0x45, 0x22, 0x69, 0x4f, 0x13,
                   0xf,  0x19, 0x22, 0x4d, 0x31, 0x29, 0x73, 0x16, 0x0,  0x9,  0x0,  0xd6, 0x1d, 0x63, 0x75, 0x3f,
                   0x70, 0xf8, 0xca, 0x21, 0x3e, 0x25, 0x26, 0x0,  0x1,  0xbf, 0x0,  0x16, 0xeb, 0xf2, 0x1e, 0xa7,
                   0xbb, 0x4a, 0x6b, 0xed, 0x37, 0x25, 0x9d, 0xc0, 0xd5, 0x3e, 0x4c, 0x53, 0x6,  0x69, 0x22, 0x21,
                   0xaf, 0xff, 0x23, 0x79, 0x3e, 0x15, 0x0,  0xa,  0x76, 0x3b, 0xda, 0x95, 0xfb, 0x3f, 0x74, 0x76,
                   0x44, 0x6b, 0x12, 0x0,  0x1c, 0x81, 0x19, 0x6f, 0xfb, 0x8a, 0xd2, 0xb2, 0xf8, 0x7a, 0x60, 0x19,
                   0xee, 0x5a, 0xe7, 0x11, 0x22, 0x21, 0x8,  0x49, 0xc,  0xdb, 0xb0, 0xf5, 0x8c, 0x95, 0x89, 0xb6,
                   0xca, 0x2,  0x0,  0x0,  0x38, 0x47, 0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0,  0x50,
                   0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf5, 0x2a, 0xae, 0x6b, 0xa5, 0x21, 0x78, 0x4b, 0xe2,
                               0xa3, 0xbe, 0xc3, 0xab, 0xe4, 0x2,  0x64, 0x75, 0x1e};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2, 0xac, 0x1f, 0x29, 0xfe, 0x16, 0x92, 0xe5, 0x0, 0x50,
                              0x15, 0xa,  0xba, 0xdc, 0xc,  0x22, 0x16, 0xe6, 0xbe};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10342);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W\DC4\201\190\193\SUB\164\DC3i\182]\GS", _pubPktID = 18773, _pubBody =
// "*F\223\201\140z\253\&8Q\176\t\175!\148(4\SOH\248\EM\192\217B\193\220\225", _pubProps = [PropReceiveMaximum
// 5186,PropReasonString "i\"P3\156",PropServerKeepAlive 29277,PropWillDelayInterval 7450,PropUserProperty
// "zzg\ACK)j\NAK\206\SUB,\GS\182\217\137\181\197\219\172,p\229,\133\168\DLE\132\223\SIn"
// "\248\138\STX\154Y\NAK\164\202o7\161\254\b-\128\225\&4\166=V<\164\fL*pK\180\&6\254",PropTopicAliasMaximum
// 6168,PropAssignedClientIdentifier "\a",PropServerKeepAlive 30055,PropAuthenticationData
// "\183*q\146N\229=0\210b\\\160\156",PropSessionExpiryInterval 29274,PropRetainAvailable 211,PropMessageExpiryInterval
// 26698,PropServerReference "i\242\222\201\157\r\235.\150\\\168L",PropMessageExpiryInterval
// 532,PropSubscriptionIdentifier 18,PropUserProperty "k\241\&4\215\234\&1\157" "%\180
// \145\144!\200\190<7jc\SI[Ph\b\ETX"]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x3a, 0xd8, 0x1,  0x0,  0xc,  0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d,
                   0x49, 0x55, 0xad, 0x1,  0x21, 0x14, 0x42, 0x1f, 0x0,  0x5,  0x69, 0x22, 0x50, 0x33, 0x9c, 0x13, 0x72,
                   0x5d, 0x18, 0x0,  0x0,  0x1d, 0x1a, 0x26, 0x0,  0x1d, 0x7a, 0x7a, 0x67, 0x6,  0x29, 0x6a, 0x15, 0xce,
                   0x1a, 0x2c, 0x1d, 0xb6, 0xd9, 0x89, 0xb5, 0xc5, 0xdb, 0xac, 0x2c, 0x70, 0xe5, 0x2c, 0x85, 0xa8, 0x10,
                   0x84, 0xdf, 0xf,  0x6e, 0x0,  0x1e, 0xf8, 0x8a, 0x2,  0x9a, 0x59, 0x15, 0xa4, 0xca, 0x6f, 0x37, 0xa1,
                   0xfe, 0x8,  0x2d, 0x80, 0xe1, 0x34, 0xa6, 0x3d, 0x56, 0x3c, 0xa4, 0xc,  0x4c, 0x2a, 0x70, 0x4b, 0xb4,
                   0x36, 0xfe, 0x22, 0x18, 0x18, 0x12, 0x0,  0x1,  0x7,  0x13, 0x75, 0x67, 0x16, 0x0,  0xd,  0xb7, 0x2a,
                   0x71, 0x92, 0x4e, 0xe5, 0x3d, 0x30, 0xd2, 0x62, 0x5c, 0xa0, 0x9c, 0x11, 0x0,  0x0,  0x72, 0x5a, 0x25,
                   0xd3, 0x2,  0x0,  0x0,  0x68, 0x4a, 0x1c, 0x0,  0xc,  0x69, 0xf2, 0xde, 0xc9, 0x9d, 0xd,  0xeb, 0x2e,
                   0x96, 0x5c, 0xa8, 0x4c, 0x2,  0x0,  0x0,  0x2,  0x14, 0xb,  0x12, 0x26, 0x0,  0x7,  0x6b, 0xf1, 0x34,
                   0xd7, 0xea, 0x31, 0x9d, 0x0,  0x12, 0x25, 0xb4, 0x20, 0x91, 0x90, 0x21, 0xc8, 0xbe, 0x3c, 0x37, 0x6a,
                   0x63, 0xf,  0x5b, 0x50, 0x68, 0x8,  0x3,  0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0,
                   0x9,  0xaf, 0x21, 0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  uint8_t topic_bytes[] = {0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf, 0x21,
                         0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops0[] = {0x69, 0x22, 0x50, 0x33, 0x9c};
  uint8_t bytesprops2[] = {0xf8, 0x8a, 0x2,  0x9a, 0x59, 0x15, 0xa4, 0xca, 0x6f, 0x37, 0xa1, 0xfe, 0x8,  0x2d, 0x80,
                           0xe1, 0x34, 0xa6, 0x3d, 0x56, 0x3c, 0xa4, 0xc,  0x4c, 0x2a, 0x70, 0x4b, 0xb4, 0x36, 0xfe};
  uint8_t bytesprops1[] = {0x7a, 0x7a, 0x67, 0x6,  0x29, 0x6a, 0x15, 0xce, 0x1a, 0x2c, 0x1d, 0xb6, 0xd9, 0x89, 0xb5,
                           0xc5, 0xdb, 0xac, 0x2c, 0x70, 0xe5, 0x2c, 0x85, 0xa8, 0x10, 0x84, 0xdf, 0xf,  0x6e};
  uint8_t bytesprops3[] = {0x7};
  uint8_t bytesprops4[] = {0xb7, 0x2a, 0x71, 0x92, 0x4e, 0xe5, 0x3d, 0x30, 0xd2, 0x62, 0x5c, 0xa0, 0x9c};
  uint8_t bytesprops5[] = {0x69, 0xf2, 0xde, 0xc9, 0x9d, 0xd, 0xeb, 0x2e, 0x96, 0x5c, 0xa8, 0x4c};
  uint8_t bytesprops7[] = {0x25, 0xb4, 0x20, 0x91, 0x90, 0x21, 0xc8, 0xbe, 0x3c,
                           0x37, 0x6a, 0x63, 0xf,  0x5b, 0x50, 0x68, 0x8,  0x3};
  uint8_t bytesprops6[] = {0x6b, 0xf1, 0x34, 0xd7, 0xea, 0x31, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5186}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29277}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7450}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6168}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30055}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29274}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26698}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 532}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops6}, .v = {18, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 18773, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W\DC4\201\190\193\SUB\164\DC3i\182]\GS", _pubPktID = 18773, _pubBody =
// "*F\223\201\140z\253\&8Q\176\t\175!\148(4\SOH\248\EM\192\217B\193\220\225", _pubProps = [PropReceiveMaximum
// 5186,PropReasonString "i\"P3\156",PropServerKeepAlive 29277,PropWillDelayInterval 7450,PropUserProperty
// "zzg\ACK)j\NAK\206\SUB,\GS\182\217\137\181\197\219\172,p\229,\133\168\DLE\132\223\SIn"
// "\248\138\STX\154Y\NAK\164\202o7\161\254\b-\128\225\&4\166=V<\164\fL*pK\180\&6\254",PropTopicAliasMaximum
// 6168,PropAssignedClientIdentifier "\a",PropServerKeepAlive 30055,PropAuthenticationData
// "\183*q\146N\229=0\210b\\\160\156",PropSessionExpiryInterval 29274,PropRetainAvailable 211,PropMessageExpiryInterval
// 26698,PropServerReference "i\242\222\201\157\r\235.\150\\\168L",PropMessageExpiryInterval
// 532,PropSubscriptionIdentifier 18,PropUserProperty "k\241\&4\215\234\&1\157" "%\180
// \145\144!\200\190<7jc\SI[Ph\b\ETX"]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x3a, 0xd8, 0x1,  0x0,  0xc,  0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d,
                   0x49, 0x55, 0xad, 0x1,  0x21, 0x14, 0x42, 0x1f, 0x0,  0x5,  0x69, 0x22, 0x50, 0x33, 0x9c, 0x13, 0x72,
                   0x5d, 0x18, 0x0,  0x0,  0x1d, 0x1a, 0x26, 0x0,  0x1d, 0x7a, 0x7a, 0x67, 0x6,  0x29, 0x6a, 0x15, 0xce,
                   0x1a, 0x2c, 0x1d, 0xb6, 0xd9, 0x89, 0xb5, 0xc5, 0xdb, 0xac, 0x2c, 0x70, 0xe5, 0x2c, 0x85, 0xa8, 0x10,
                   0x84, 0xdf, 0xf,  0x6e, 0x0,  0x1e, 0xf8, 0x8a, 0x2,  0x9a, 0x59, 0x15, 0xa4, 0xca, 0x6f, 0x37, 0xa1,
                   0xfe, 0x8,  0x2d, 0x80, 0xe1, 0x34, 0xa6, 0x3d, 0x56, 0x3c, 0xa4, 0xc,  0x4c, 0x2a, 0x70, 0x4b, 0xb4,
                   0x36, 0xfe, 0x22, 0x18, 0x18, 0x12, 0x0,  0x1,  0x7,  0x13, 0x75, 0x67, 0x16, 0x0,  0xd,  0xb7, 0x2a,
                   0x71, 0x92, 0x4e, 0xe5, 0x3d, 0x30, 0xd2, 0x62, 0x5c, 0xa0, 0x9c, 0x11, 0x0,  0x0,  0x72, 0x5a, 0x25,
                   0xd3, 0x2,  0x0,  0x0,  0x68, 0x4a, 0x1c, 0x0,  0xc,  0x69, 0xf2, 0xde, 0xc9, 0x9d, 0xd,  0xeb, 0x2e,
                   0x96, 0x5c, 0xa8, 0x4c, 0x2,  0x0,  0x0,  0x2,  0x14, 0xb,  0x12, 0x26, 0x0,  0x7,  0x6b, 0xf1, 0x34,
                   0xd7, 0xea, 0x31, 0x9d, 0x0,  0x12, 0x25, 0xb4, 0x20, 0x91, 0x90, 0x21, 0xc8, 0xbe, 0x3c, 0x37, 0x6a,
                   0x63, 0xf,  0x5b, 0x50, 0x68, 0x8,  0x3,  0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0,
                   0x9,  0xaf, 0x21, 0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0x14, 0xc9, 0xbe, 0xc1, 0x1a, 0xa4, 0x13, 0x69, 0xb6, 0x5d, 0x1d};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2a, 0x46, 0xdf, 0xc9, 0x8c, 0x7a, 0xfd, 0x38, 0x51, 0xb0, 0x9,  0xaf, 0x21,
                              0x94, 0x28, 0x34, 0x1,  0xf8, 0x19, 0xc0, 0xd9, 0x42, 0xc1, 0xdc, 0xe1};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 18773);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\194", _pubPktID = 0, _pubBody =
// "\251\145\"\229\t+\230\175\144\209p\ETX^\217KR\195", _pubProps = [PropResponseTopic
// "\195\GS\250\"\175\133\fN\SO#=\199fBU4",PropResponseInformation "\236\207?\DC1\194+\239\&4",PropTopicAlias
// 23167,PropSubscriptionIdentifierAvailable 113,PropUserProperty "\200\181\130\173K]\179\DEL>\SYN\EOTM\FS\186V"
// "p@N\FS\250\ETB,\214\185:\\\171",PropResponseInformation
// "\228\&3B\157\225\189\212\STXz~\229x\255\129^\237\156m\vj\181\213\STX\128\144\SUBB\205",PropRequestProblemInformation
// 131,PropReasonString ",\167\249h\215*\174\138\216\129\161\233\SUB",PropSharedSubscriptionAvailable
// 145,PropCorrelationData
// "I\b\179zw\197\246j\209\171\255\SUBm\138\174\f\129\145y\239\155",PropRequestProblemInformation 70,PropReasonString
// "l",PropMessageExpiryInterval 25951,PropResponseInformation
// "\142\149\130_W\180g\148\"\SYN>\221\194i\DC2w\148\162/\210\169}\251t\SOH#\NUL\195v3",PropSharedSubscriptionAvailable
// 144,PropWildcardSubscriptionAvailable 11,PropReceiveMaximum 16763]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {0x31, 0xd8, 0x1,  0x0,  0x2,  0xdd, 0xc2, 0xc1, 0x1,  0x8,  0x0,  0x10, 0xc3, 0x1d, 0xfa, 0x22, 0xaf,
                   0x85, 0xc,  0x4e, 0xe,  0x23, 0x3d, 0xc7, 0x66, 0x42, 0x55, 0x34, 0x1a, 0x0,  0x8,  0xec, 0xcf, 0x3f,
                   0x11, 0xc2, 0x2b, 0xef, 0x34, 0x23, 0x5a, 0x7f, 0x29, 0x71, 0x26, 0x0,  0xf,  0xc8, 0xb5, 0x82, 0xad,
                   0x4b, 0x5d, 0xb3, 0x7f, 0x3e, 0x16, 0x4,  0x4d, 0x1c, 0xba, 0x56, 0x0,  0xc,  0x70, 0x40, 0x4e, 0x1c,
                   0xfa, 0x17, 0x2c, 0xd6, 0xb9, 0x3a, 0x5c, 0xab, 0x1a, 0x0,  0x1c, 0xe4, 0x33, 0x42, 0x9d, 0xe1, 0xbd,
                   0xd4, 0x2,  0x7a, 0x7e, 0xe5, 0x78, 0xff, 0x81, 0x5e, 0xed, 0x9c, 0x6d, 0xb,  0x6a, 0xb5, 0xd5, 0x2,
                   0x80, 0x90, 0x1a, 0x42, 0xcd, 0x17, 0x83, 0x1f, 0x0,  0xd,  0x2c, 0xa7, 0xf9, 0x68, 0xd7, 0x2a, 0xae,
                   0x8a, 0xd8, 0x81, 0xa1, 0xe9, 0x1a, 0x2a, 0x91, 0x9,  0x0,  0x15, 0x49, 0x8,  0xb3, 0x7a, 0x77, 0xc5,
                   0xf6, 0x6a, 0xd1, 0xab, 0xff, 0x1a, 0x6d, 0x8a, 0xae, 0xc,  0x81, 0x91, 0x79, 0xef, 0x9b, 0x17, 0x46,
                   0x1f, 0x0,  0x1,  0x6c, 0x2,  0x0,  0x0,  0x65, 0x5f, 0x1a, 0x0,  0x1e, 0x8e, 0x95, 0x82, 0x5f, 0x57,
                   0xb4, 0x67, 0x94, 0x22, 0x16, 0x3e, 0xdd, 0xc2, 0x69, 0x12, 0x77, 0x94, 0xa2, 0x2f, 0xd2, 0xa9, 0x7d,
                   0xfb, 0x74, 0x1,  0x23, 0x0,  0xc3, 0x76, 0x33, 0x2a, 0x90, 0x28, 0xb,  0x21, 0x41, 0x7b, 0xfb, 0x91,
                   0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90, 0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  uint8_t topic_bytes[] = {0xdd, 0xc2};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x91, 0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90,
                         0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xc3, 0x1d, 0xfa, 0x22, 0xaf, 0x85, 0xc,  0x4e,
                           0xe,  0x23, 0x3d, 0xc7, 0x66, 0x42, 0x55, 0x34};
  uint8_t bytesprops1[] = {0xec, 0xcf, 0x3f, 0x11, 0xc2, 0x2b, 0xef, 0x34};
  uint8_t bytesprops3[] = {0x70, 0x40, 0x4e, 0x1c, 0xfa, 0x17, 0x2c, 0xd6, 0xb9, 0x3a, 0x5c, 0xab};
  uint8_t bytesprops2[] = {0xc8, 0xb5, 0x82, 0xad, 0x4b, 0x5d, 0xb3, 0x7f, 0x3e, 0x16, 0x4, 0x4d, 0x1c, 0xba, 0x56};
  uint8_t bytesprops4[] = {0xe4, 0x33, 0x42, 0x9d, 0xe1, 0xbd, 0xd4, 0x2,  0x7a, 0x7e, 0xe5, 0x78, 0xff, 0x81,
                           0x5e, 0xed, 0x9c, 0x6d, 0xb,  0x6a, 0xb5, 0xd5, 0x2,  0x80, 0x90, 0x1a, 0x42, 0xcd};
  uint8_t bytesprops5[] = {0x2c, 0xa7, 0xf9, 0x68, 0xd7, 0x2a, 0xae, 0x8a, 0xd8, 0x81, 0xa1, 0xe9, 0x1a};
  uint8_t bytesprops6[] = {0x49, 0x8,  0xb3, 0x7a, 0x77, 0xc5, 0xf6, 0x6a, 0xd1, 0xab, 0xff,
                           0x1a, 0x6d, 0x8a, 0xae, 0xc,  0x81, 0x91, 0x79, 0xef, 0x9b};
  uint8_t bytesprops7[] = {0x6c};
  uint8_t bytesprops8[] = {0x8e, 0x95, 0x82, 0x5f, 0x57, 0xb4, 0x67, 0x94, 0x22, 0x16, 0x3e, 0xdd, 0xc2, 0x69, 0x12,
                           0x77, 0x94, 0xa2, 0x2f, 0xd2, 0xa9, 0x7d, 0xfb, 0x74, 0x1,  0x23, 0x0,  0xc3, 0x76, 0x33};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23167}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops2}, .v = {12, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25951}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16763}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\194", _pubPktID = 0, _pubBody =
// "\251\145\"\229\t+\230\175\144\209p\ETX^\217KR\195", _pubProps = [PropResponseTopic
// "\195\GS\250\"\175\133\fN\SO#=\199fBU4",PropResponseInformation "\236\207?\DC1\194+\239\&4",PropTopicAlias
// 23167,PropSubscriptionIdentifierAvailable 113,PropUserProperty "\200\181\130\173K]\179\DEL>\SYN\EOTM\FS\186V"
// "p@N\FS\250\ETB,\214\185:\\\171",PropResponseInformation
// "\228\&3B\157\225\189\212\STXz~\229x\255\129^\237\156m\vj\181\213\STX\128\144\SUBB\205",PropRequestProblemInformation
// 131,PropReasonString ",\167\249h\215*\174\138\216\129\161\233\SUB",PropSharedSubscriptionAvailable
// 145,PropCorrelationData
// "I\b\179zw\197\246j\209\171\255\SUBm\138\174\f\129\145y\239\155",PropRequestProblemInformation 70,PropReasonString
// "l",PropMessageExpiryInterval 25951,PropResponseInformation
// "\142\149\130_W\180g\148\"\SYN>\221\194i\DC2w\148\162/\210\169}\251t\SOH#\NUL\195v3",PropSharedSubscriptionAvailable
// 144,PropWildcardSubscriptionAvailable 11,PropReceiveMaximum 16763]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {0x31, 0xd8, 0x1,  0x0,  0x2,  0xdd, 0xc2, 0xc1, 0x1,  0x8,  0x0,  0x10, 0xc3, 0x1d, 0xfa, 0x22, 0xaf,
                   0x85, 0xc,  0x4e, 0xe,  0x23, 0x3d, 0xc7, 0x66, 0x42, 0x55, 0x34, 0x1a, 0x0,  0x8,  0xec, 0xcf, 0x3f,
                   0x11, 0xc2, 0x2b, 0xef, 0x34, 0x23, 0x5a, 0x7f, 0x29, 0x71, 0x26, 0x0,  0xf,  0xc8, 0xb5, 0x82, 0xad,
                   0x4b, 0x5d, 0xb3, 0x7f, 0x3e, 0x16, 0x4,  0x4d, 0x1c, 0xba, 0x56, 0x0,  0xc,  0x70, 0x40, 0x4e, 0x1c,
                   0xfa, 0x17, 0x2c, 0xd6, 0xb9, 0x3a, 0x5c, 0xab, 0x1a, 0x0,  0x1c, 0xe4, 0x33, 0x42, 0x9d, 0xe1, 0xbd,
                   0xd4, 0x2,  0x7a, 0x7e, 0xe5, 0x78, 0xff, 0x81, 0x5e, 0xed, 0x9c, 0x6d, 0xb,  0x6a, 0xb5, 0xd5, 0x2,
                   0x80, 0x90, 0x1a, 0x42, 0xcd, 0x17, 0x83, 0x1f, 0x0,  0xd,  0x2c, 0xa7, 0xf9, 0x68, 0xd7, 0x2a, 0xae,
                   0x8a, 0xd8, 0x81, 0xa1, 0xe9, 0x1a, 0x2a, 0x91, 0x9,  0x0,  0x15, 0x49, 0x8,  0xb3, 0x7a, 0x77, 0xc5,
                   0xf6, 0x6a, 0xd1, 0xab, 0xff, 0x1a, 0x6d, 0x8a, 0xae, 0xc,  0x81, 0x91, 0x79, 0xef, 0x9b, 0x17, 0x46,
                   0x1f, 0x0,  0x1,  0x6c, 0x2,  0x0,  0x0,  0x65, 0x5f, 0x1a, 0x0,  0x1e, 0x8e, 0x95, 0x82, 0x5f, 0x57,
                   0xb4, 0x67, 0x94, 0x22, 0x16, 0x3e, 0xdd, 0xc2, 0x69, 0x12, 0x77, 0x94, 0xa2, 0x2f, 0xd2, 0xa9, 0x7d,
                   0xfb, 0x74, 0x1,  0x23, 0x0,  0xc3, 0x76, 0x33, 0x2a, 0x90, 0x28, 0xb,  0x21, 0x41, 0x7b, 0xfb, 0x91,
                   0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90, 0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdd, 0xc2};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfb, 0x91, 0x22, 0xe5, 0x9,  0x2b, 0xe6, 0xaf, 0x90,
                              0xd1, 0x70, 0x3,  0x5e, 0xd9, 0x4b, 0x52, 0xc3};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\253\&0\CANabo\DC3\254\241\240\244{\194\r)2\133Gj\233%", _pubPktID = 23762, _pubBody = "\224", _pubProps =
// [PropWildcardSubscriptionAvailable 107,PropResponseTopic "\164&\169\232l\231$P)O.Fu\224\US\214\145H\253
// \195\131oL\160A%",PropTopicAlias 20811,PropRequestResponseInformation 179,PropRequestProblemInformation
// 128,PropSubscriptionIdentifier 11,PropTopicAliasMaximum 12610,PropSessionExpiryInterval 20293,PropAuthenticationData
// "\"\131p@f\ETBb>\214\189\222\DC3M",PropSessionExpiryInterval 6338,PropSharedSubscriptionAvailable
// 90,PropRequestResponseInformation 113,PropPayloadFormatIndicator 89,PropAssignedClientIdentifier
// "\188j^\248",PropMessageExpiryInterval 24560,PropPayloadFormatIndicator 139,PropUserProperty
// "}\136\171\228\224\190\177\STX7\253V\193\160\222\t\194\DC2%\193\188e1y\129\r\240"
// "6Yo\160R",PropSubscriptionIdentifier 30,PropReasonString
// "Y,\151\173!\131\143\211\208\248\220\140\149",PropPayloadFormatIndicator 218,PropUserProperty "\DC4\249\196\128\255"
// "mf\141\&9i|\RS\211\&1\136I\129\253\STX\134e:\192\185\EM\ETX\240\205p\133\255\153\&94",PropSubscriptionIdentifierAvailable
// 34,PropResponseTopic
// "4C\v\251\180\171x\185\189;X\163\148\NUL\170\STX\172\205K)\173=J\143\t\141\189",PropReceiveMaximum 2967]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {0x35, 0xf8, 0x1,  0x0,  0x15, 0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4, 0x7b,
                   0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25, 0x5c, 0xd2, 0xdc, 0x1,  0x28, 0x6b, 0x8,  0x0,
                   0x1b, 0xa4, 0x26, 0xa9, 0xe8, 0x6c, 0xe7, 0x24, 0x50, 0x29, 0x4f, 0x2e, 0x46, 0x75, 0xe0, 0x1f, 0xd6,
                   0x91, 0x48, 0xfd, 0x20, 0xc3, 0x83, 0x6f, 0x4c, 0xa0, 0x41, 0x25, 0x23, 0x51, 0x4b, 0x19, 0xb3, 0x17,
                   0x80, 0xb,  0xb,  0x22, 0x31, 0x42, 0x11, 0x0,  0x0,  0x4f, 0x45, 0x16, 0x0,  0xd,  0x22, 0x83, 0x70,
                   0x40, 0x66, 0x17, 0x62, 0x3e, 0xd6, 0xbd, 0xde, 0x13, 0x4d, 0x11, 0x0,  0x0,  0x18, 0xc2, 0x2a, 0x5a,
                   0x19, 0x71, 0x1,  0x59, 0x12, 0x0,  0x4,  0xbc, 0x6a, 0x5e, 0xf8, 0x2,  0x0,  0x0,  0x5f, 0xf0, 0x1,
                   0x8b, 0x26, 0x0,  0x1a, 0x7d, 0x88, 0xab, 0xe4, 0xe0, 0xbe, 0xb1, 0x2,  0x37, 0xfd, 0x56, 0xc1, 0xa0,
                   0xde, 0x9,  0xc2, 0x12, 0x25, 0xc1, 0xbc, 0x65, 0x31, 0x79, 0x81, 0xd,  0xf0, 0x0,  0x5,  0x36, 0x59,
                   0x6f, 0xa0, 0x52, 0xb,  0x1e, 0x1f, 0x0,  0xd,  0x59, 0x2c, 0x97, 0xad, 0x21, 0x83, 0x8f, 0xd3, 0xd0,
                   0xf8, 0xdc, 0x8c, 0x95, 0x1,  0xda, 0x26, 0x0,  0x5,  0x14, 0xf9, 0xc4, 0x80, 0xff, 0x0,  0x1d, 0x6d,
                   0x66, 0x8d, 0x39, 0x69, 0x7c, 0x1e, 0xd3, 0x31, 0x88, 0x49, 0x81, 0xfd, 0x2,  0x86, 0x65, 0x3a, 0xc0,
                   0xb9, 0x19, 0x3,  0xf0, 0xcd, 0x70, 0x85, 0xff, 0x99, 0x39, 0x34, 0x29, 0x22, 0x8,  0x0,  0x1b, 0x34,
                   0x43, 0xb,  0xfb, 0xb4, 0xab, 0x78, 0xb9, 0xbd, 0x3b, 0x58, 0xa3, 0x94, 0x0,  0xaa, 0x2,  0xac, 0xcd,
                   0x4b, 0x29, 0xad, 0x3d, 0x4a, 0x8f, 0x9,  0x8d, 0xbd, 0x21, 0xb,  0x97, 0xe0};
  uint8_t topic_bytes[] = {0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4,
                           0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xa4, 0x26, 0xa9, 0xe8, 0x6c, 0xe7, 0x24, 0x50, 0x29, 0x4f, 0x2e, 0x46, 0x75, 0xe0,
                           0x1f, 0xd6, 0x91, 0x48, 0xfd, 0x20, 0xc3, 0x83, 0x6f, 0x4c, 0xa0, 0x41, 0x25};
  uint8_t bytesprops1[] = {0x22, 0x83, 0x70, 0x40, 0x66, 0x17, 0x62, 0x3e, 0xd6, 0xbd, 0xde, 0x13, 0x4d};
  uint8_t bytesprops2[] = {0xbc, 0x6a, 0x5e, 0xf8};
  uint8_t bytesprops4[] = {0x36, 0x59, 0x6f, 0xa0, 0x52};
  uint8_t bytesprops3[] = {0x7d, 0x88, 0xab, 0xe4, 0xe0, 0xbe, 0xb1, 0x2,  0x37, 0xfd, 0x56, 0xc1, 0xa0,
                           0xde, 0x9,  0xc2, 0x12, 0x25, 0xc1, 0xbc, 0x65, 0x31, 0x79, 0x81, 0xd,  0xf0};
  uint8_t bytesprops5[] = {0x59, 0x2c, 0x97, 0xad, 0x21, 0x83, 0x8f, 0xd3, 0xd0, 0xf8, 0xdc, 0x8c, 0x95};
  uint8_t bytesprops7[] = {0x6d, 0x66, 0x8d, 0x39, 0x69, 0x7c, 0x1e, 0xd3, 0x31, 0x88, 0x49, 0x81, 0xfd, 0x2, 0x86,
                           0x65, 0x3a, 0xc0, 0xb9, 0x19, 0x3,  0xf0, 0xcd, 0x70, 0x85, 0xff, 0x99, 0x39, 0x34};
  uint8_t bytesprops6[] = {0x14, 0xf9, 0xc4, 0x80, 0xff};
  uint8_t bytesprops8[] = {0x34, 0x43, 0xb,  0xfb, 0xb4, 0xab, 0x78, 0xb9, 0xbd, 0x3b, 0x58, 0xa3, 0x94, 0x0,
                           0xaa, 0x2,  0xac, 0xcd, 0x4b, 0x29, 0xad, 0x3d, 0x4a, 0x8f, 0x9,  0x8d, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20811}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12610}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20293}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6338}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24560}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops3}, .v = {5, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops6}, .v = {29, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2967}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 23762, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\253\&0\CANabo\DC3\254\241\240\244{\194\r)2\133Gj\233%", _pubPktID = 23762, _pubBody = "\224", _pubProps =
// [PropWildcardSubscriptionAvailable 107,PropResponseTopic "\164&\169\232l\231$P)O.Fu\224\US\214\145H\253
// \195\131oL\160A%",PropTopicAlias 20811,PropRequestResponseInformation 179,PropRequestProblemInformation
// 128,PropSubscriptionIdentifier 11,PropTopicAliasMaximum 12610,PropSessionExpiryInterval 20293,PropAuthenticationData
// "\"\131p@f\ETBb>\214\189\222\DC3M",PropSessionExpiryInterval 6338,PropSharedSubscriptionAvailable
// 90,PropRequestResponseInformation 113,PropPayloadFormatIndicator 89,PropAssignedClientIdentifier
// "\188j^\248",PropMessageExpiryInterval 24560,PropPayloadFormatIndicator 139,PropUserProperty
// "}\136\171\228\224\190\177\STX7\253V\193\160\222\t\194\DC2%\193\188e1y\129\r\240"
// "6Yo\160R",PropSubscriptionIdentifier 30,PropReasonString
// "Y,\151\173!\131\143\211\208\248\220\140\149",PropPayloadFormatIndicator 218,PropUserProperty "\DC4\249\196\128\255"
// "mf\141\&9i|\RS\211\&1\136I\129\253\STX\134e:\192\185\EM\ETX\240\205p\133\255\153\&94",PropSubscriptionIdentifierAvailable
// 34,PropResponseTopic
// "4C\v\251\180\171x\185\189;X\163\148\NUL\170\STX\172\205K)\173=J\143\t\141\189",PropReceiveMaximum 2967]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {0x35, 0xf8, 0x1,  0x0,  0x15, 0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4, 0x7b,
                   0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25, 0x5c, 0xd2, 0xdc, 0x1,  0x28, 0x6b, 0x8,  0x0,
                   0x1b, 0xa4, 0x26, 0xa9, 0xe8, 0x6c, 0xe7, 0x24, 0x50, 0x29, 0x4f, 0x2e, 0x46, 0x75, 0xe0, 0x1f, 0xd6,
                   0x91, 0x48, 0xfd, 0x20, 0xc3, 0x83, 0x6f, 0x4c, 0xa0, 0x41, 0x25, 0x23, 0x51, 0x4b, 0x19, 0xb3, 0x17,
                   0x80, 0xb,  0xb,  0x22, 0x31, 0x42, 0x11, 0x0,  0x0,  0x4f, 0x45, 0x16, 0x0,  0xd,  0x22, 0x83, 0x70,
                   0x40, 0x66, 0x17, 0x62, 0x3e, 0xd6, 0xbd, 0xde, 0x13, 0x4d, 0x11, 0x0,  0x0,  0x18, 0xc2, 0x2a, 0x5a,
                   0x19, 0x71, 0x1,  0x59, 0x12, 0x0,  0x4,  0xbc, 0x6a, 0x5e, 0xf8, 0x2,  0x0,  0x0,  0x5f, 0xf0, 0x1,
                   0x8b, 0x26, 0x0,  0x1a, 0x7d, 0x88, 0xab, 0xe4, 0xe0, 0xbe, 0xb1, 0x2,  0x37, 0xfd, 0x56, 0xc1, 0xa0,
                   0xde, 0x9,  0xc2, 0x12, 0x25, 0xc1, 0xbc, 0x65, 0x31, 0x79, 0x81, 0xd,  0xf0, 0x0,  0x5,  0x36, 0x59,
                   0x6f, 0xa0, 0x52, 0xb,  0x1e, 0x1f, 0x0,  0xd,  0x59, 0x2c, 0x97, 0xad, 0x21, 0x83, 0x8f, 0xd3, 0xd0,
                   0xf8, 0xdc, 0x8c, 0x95, 0x1,  0xda, 0x26, 0x0,  0x5,  0x14, 0xf9, 0xc4, 0x80, 0xff, 0x0,  0x1d, 0x6d,
                   0x66, 0x8d, 0x39, 0x69, 0x7c, 0x1e, 0xd3, 0x31, 0x88, 0x49, 0x81, 0xfd, 0x2,  0x86, 0x65, 0x3a, 0xc0,
                   0xb9, 0x19, 0x3,  0xf0, 0xcd, 0x70, 0x85, 0xff, 0x99, 0x39, 0x34, 0x29, 0x22, 0x8,  0x0,  0x1b, 0x34,
                   0x43, 0xb,  0xfb, 0xb4, 0xab, 0x78, 0xb9, 0xbd, 0x3b, 0x58, 0xa3, 0x94, 0x0,  0xaa, 0x2,  0xac, 0xcd,
                   0x4b, 0x29, 0xad, 0x3d, 0x4a, 0x8f, 0x9,  0x8d, 0xbd, 0x21, 0xb,  0x97, 0xe0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfd, 0x30, 0x18, 0x61, 0x62, 0x6f, 0x13, 0xfe, 0xf1, 0xf0, 0xf4,
                               0x7b, 0xc2, 0xd,  0x29, 0x32, 0x85, 0x47, 0x6a, 0xe9, 0x25};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe0};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23762);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC1\DC4:", _pubPktID = 0, _pubBody =
// "V\144J\230\153\132\164\SO", _pubProps = [PropMaximumQoS 226,PropMaximumPacketSize 24860,PropAssignedClientIdentifier
// "\159<zv",PropResponseTopic "\249\204\165\208\b\157\EOT\135X\200",PropSessionExpiryInterval 14894,PropTopicAlias
// 11687,PropPayloadFormatIndicator 73,PropUserProperty ""
// "Y@\"\131\239\159\172\188\211(\144\145Y",PropRequestResponseInformation 231,PropUserProperty "\221"
// "D\ETX\236\a\CAN/\248\239\178\SI\170,@J\194W\172\201\202Z<",PropWillDelayInterval
// 22371,PropSubscriptionIdentifierAvailable 86,PropServerReference
// "\212\GSj\NAK\240\188\ENQe`$\SO\194Pk\222P\245\157_\156;\207\163\&1\n\231z\239\251"]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x39, 0x89, 0x1,  0x0,  0x3,  0x11, 0x14, 0x3a, 0x7b, 0x24, 0xe2, 0x27, 0x0,  0x0,  0x61, 0x1c,
                   0x12, 0x0,  0x4,  0x9f, 0x3c, 0x7a, 0x76, 0x8,  0x0,  0xa,  0xf9, 0xcc, 0xa5, 0xd0, 0x8,  0x9d,
                   0x4,  0x87, 0x58, 0xc8, 0x11, 0x0,  0x0,  0x3a, 0x2e, 0x23, 0x2d, 0xa7, 0x1,  0x49, 0x26, 0x0,
                   0x0,  0x0,  0xd,  0x59, 0x40, 0x22, 0x83, 0xef, 0x9f, 0xac, 0xbc, 0xd3, 0x28, 0x90, 0x91, 0x59,
                   0x19, 0xe7, 0x26, 0x0,  0x1,  0xdd, 0x0,  0x15, 0x44, 0x3,  0xec, 0x7,  0x18, 0x2f, 0xf8, 0xef,
                   0xb2, 0xf,  0xaa, 0x2c, 0x40, 0x4a, 0xc2, 0x57, 0xac, 0xc9, 0xca, 0x5a, 0x3c, 0x18, 0x0,  0x0,
                   0x57, 0x63, 0x29, 0x56, 0x1c, 0x0,  0x1d, 0xd4, 0x1d, 0x6a, 0x15, 0xf0, 0xbc, 0x5,  0x65, 0x60,
                   0x24, 0xe,  0xc2, 0x50, 0x6b, 0xde, 0x50, 0xf5, 0x9d, 0x5f, 0x9c, 0x3b, 0xcf, 0xa3, 0x31, 0xa,
                   0xe7, 0x7a, 0xef, 0xfb, 0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  uint8_t topic_bytes[] = {0x11, 0x14, 0x3a};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops0[] = {0x9f, 0x3c, 0x7a, 0x76};
  uint8_t bytesprops1[] = {0xf9, 0xcc, 0xa5, 0xd0, 0x8, 0x9d, 0x4, 0x87, 0x58, 0xc8};
  uint8_t bytesprops3[] = {0x59, 0x40, 0x22, 0x83, 0xef, 0x9f, 0xac, 0xbc, 0xd3, 0x28, 0x90, 0x91, 0x59};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops5[] = {0x44, 0x3,  0xec, 0x7,  0x18, 0x2f, 0xf8, 0xef, 0xb2, 0xf, 0xaa,
                           0x2c, 0x40, 0x4a, 0xc2, 0x57, 0xac, 0xc9, 0xca, 0x5a, 0x3c};
  uint8_t bytesprops4[] = {0xdd};
  uint8_t bytesprops6[] = {0xd4, 0x1d, 0x6a, 0x15, 0xf0, 0xbc, 0x5,  0x65, 0x60, 0x24, 0xe,  0xc2, 0x50, 0x6b, 0xde,
                           0x50, 0xf5, 0x9d, 0x5f, 0x9c, 0x3b, 0xcf, 0xa3, 0x31, 0xa,  0xe7, 0x7a, 0xef, 0xfb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24860}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14894}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11687}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops2}, .v = {13, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops4}, .v = {21, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22371}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC1\DC4:", _pubPktID = 0, _pubBody =
// "V\144J\230\153\132\164\SO", _pubProps = [PropMaximumQoS 226,PropMaximumPacketSize 24860,PropAssignedClientIdentifier
// "\159<zv",PropResponseTopic "\249\204\165\208\b\157\EOT\135X\200",PropSessionExpiryInterval 14894,PropTopicAlias
// 11687,PropPayloadFormatIndicator 73,PropUserProperty ""
// "Y@\"\131\239\159\172\188\211(\144\145Y",PropRequestResponseInformation 231,PropUserProperty "\221"
// "D\ETX\236\a\CAN/\248\239\178\SI\170,@J\194W\172\201\202Z<",PropWillDelayInterval
// 22371,PropSubscriptionIdentifierAvailable 86,PropServerReference
// "\212\GSj\NAK\240\188\ENQe`$\SO\194Pk\222P\245\157_\156;\207\163\&1\n\231z\239\251"]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {0x39, 0x89, 0x1,  0x0,  0x3,  0x11, 0x14, 0x3a, 0x7b, 0x24, 0xe2, 0x27, 0x0,  0x0,  0x61, 0x1c,
                   0x12, 0x0,  0x4,  0x9f, 0x3c, 0x7a, 0x76, 0x8,  0x0,  0xa,  0xf9, 0xcc, 0xa5, 0xd0, 0x8,  0x9d,
                   0x4,  0x87, 0x58, 0xc8, 0x11, 0x0,  0x0,  0x3a, 0x2e, 0x23, 0x2d, 0xa7, 0x1,  0x49, 0x26, 0x0,
                   0x0,  0x0,  0xd,  0x59, 0x40, 0x22, 0x83, 0xef, 0x9f, 0xac, 0xbc, 0xd3, 0x28, 0x90, 0x91, 0x59,
                   0x19, 0xe7, 0x26, 0x0,  0x1,  0xdd, 0x0,  0x15, 0x44, 0x3,  0xec, 0x7,  0x18, 0x2f, 0xf8, 0xef,
                   0xb2, 0xf,  0xaa, 0x2c, 0x40, 0x4a, 0xc2, 0x57, 0xac, 0xc9, 0xca, 0x5a, 0x3c, 0x18, 0x0,  0x0,
                   0x57, 0x63, 0x29, 0x56, 0x1c, 0x0,  0x1d, 0xd4, 0x1d, 0x6a, 0x15, 0xf0, 0xbc, 0x5,  0x65, 0x60,
                   0x24, 0xe,  0xc2, 0x50, 0x6b, 0xde, 0x50, 0xf5, 0x9d, 0x5f, 0x9c, 0x3b, 0xcf, 0xa3, 0x31, 0xa,
                   0xe7, 0x7a, 0xef, 0xfb, 0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x14, 0x3a};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x56, 0x90, 0x4a, 0xe6, 0x99, 0x84, 0xa4, 0xe};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "6\USp^\205\245IA
// \ETB+\158\220\216ea[,\180\190\&1\DLE\183\198\217", _pubPktID = 25164, _pubBody =
// "\155\145\198\173f\139:a\195\141sE}\221\223\243\145\224*\180\vSEy{\166\178\148`", _pubProps = [PropCorrelationData
// "\230\194/G;\134Y\155\163Z\NUL"]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x33, 0x49, 0x0,  0x19, 0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b,
                   0x9e, 0xdc, 0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9, 0x62,
                   0x4c, 0xe,  0x9,  0x0,  0xb,  0xe6, 0xc2, 0x2f, 0x47, 0x3b, 0x86, 0x59, 0x9b, 0xa3, 0x5a,
                   0x0,  0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd,
                   0xdf, 0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  uint8_t topic_bytes[] = {0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b, 0x9e, 0xdc,
                           0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd, 0xdf,
                         0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0xe6, 0xc2, 0x2f, 0x47, 0x3b, 0x86, 0x59, 0x9b, 0xa3, 0x5a, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25164, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "6\USp^\205\245IA
// \ETB+\158\220\216ea[,\180\190\&1\DLE\183\198\217", _pubPktID = 25164, _pubBody =
// "\155\145\198\173f\139:a\195\141sE}\221\223\243\145\224*\180\vSEy{\166\178\148`", _pubProps = [PropCorrelationData
// "\230\194/G;\134Y\155\163Z\NUL"]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x33, 0x49, 0x0,  0x19, 0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b,
                   0x9e, 0xdc, 0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9, 0x62,
                   0x4c, 0xe,  0x9,  0x0,  0xb,  0xe6, 0xc2, 0x2f, 0x47, 0x3b, 0x86, 0x59, 0x9b, 0xa3, 0x5a,
                   0x0,  0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd,
                   0xdf, 0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36, 0x1f, 0x70, 0x5e, 0xcd, 0xf5, 0x49, 0x41, 0x20, 0x17, 0x2b, 0x9e, 0xdc,
                               0xd8, 0x65, 0x61, 0x5b, 0x2c, 0xb4, 0xbe, 0x31, 0x10, 0xb7, 0xc6, 0xd9};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x91, 0xc6, 0xad, 0x66, 0x8b, 0x3a, 0x61, 0xc3, 0x8d, 0x73, 0x45, 0x7d, 0xdd, 0xdf,
                              0xf3, 0x91, 0xe0, 0x2a, 0xb4, 0xb,  0x53, 0x45, 0x79, 0x7b, 0xa6, 0xb2, 0x94, 0x60};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25164);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\&7A\251\143\146\159\171\130\211\146\190g", _pubPktID = 0, _pubBody = "", _pubProps = [PropMessageExpiryInterval
// 18622,PropAssignedClientIdentifier "e\164\154\171\184\215\140w\181Dr"]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0xd,  0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82,
                   0xd3, 0x92, 0xbe, 0x67, 0x13, 0x2,  0x0,  0x0,  0x48, 0xbe, 0x12, 0x0,  0xb,
                   0x65, 0xa4, 0x9a, 0xab, 0xb8, 0xd7, 0x8c, 0x77, 0xb5, 0x44, 0x72};
  uint8_t topic_bytes[] = {0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x65, 0xa4, 0x9a, 0xab, 0xb8, 0xd7, 0x8c, 0x77, 0xb5, 0x44, 0x72};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18622}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\&7A\251\143\146\159\171\130\211\146\190g", _pubPktID = 0, _pubBody = "", _pubProps = [PropMessageExpiryInterval
// 18622,PropAssignedClientIdentifier "e\164\154\171\184\215\140w\181Dr"]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0xd,  0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82,
                   0xd3, 0x92, 0xbe, 0x67, 0x13, 0x2,  0x0,  0x0,  0x48, 0xbe, 0x12, 0x0,  0xb,
                   0x65, 0xa4, 0x9a, 0xab, 0xb8, 0xd7, 0x8c, 0x77, 0xb5, 0x44, 0x72};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0x37, 0x41, 0xfb, 0x8f, 0x92, 0x9f, 0xab, 0x82, 0xd3, 0x92, 0xbe, 0x67};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\198\161\148\238\191@\246\217\217\241\DC1\227\239", _pubPktID = 10944, _pubBody = "R3\160", _pubProps =
// [PropWildcardSubscriptionAvailable 84,PropTopicAliasMaximum 14373,PropResponseTopic
// "\163\NUL\243\131\211\147\148\158&.\r",PropServerKeepAlive 25898,PropMaximumPacketSize 7145,PropReceiveMaximum
// 29689,PropRequestProblemInformation 197,PropSubscriptionIdentifier 28,PropResponseTopic
// "\t\198\FS\130\144!\130F5\191\"u\211\161\147",PropTopicAlias 9274,PropRetainAvailable 33,PropReasonString
// "\189\DC2>FV=C\STX\ACKu\142\133\215\249\224\195\225*",PropSubscriptionIdentifierAvailable 131,PropServerReference
// "\244FB\203>p>",PropReceiveMaximum 8728,PropSubscriptionIdentifierAvailable 125,PropCorrelationData
// "\141\180\130g\166\221>\167\STX\140]\153\136k\135\135\STX\243\215\223"]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x3c, 0x8b, 0x1,  0x0,  0xd,  0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11,
                   0xe3, 0xef, 0x2a, 0xc0, 0x76, 0x28, 0x54, 0x22, 0x38, 0x25, 0x8,  0x0,  0xb,  0xa3, 0x0,  0xf3,
                   0x83, 0xd3, 0x93, 0x94, 0x9e, 0x26, 0x2e, 0xd,  0x13, 0x65, 0x2a, 0x27, 0x0,  0x0,  0x1b, 0xe9,
                   0x21, 0x73, 0xf9, 0x17, 0xc5, 0xb,  0x1c, 0x8,  0x0,  0xf,  0x9,  0xc6, 0x1c, 0x82, 0x90, 0x21,
                   0x82, 0x46, 0x35, 0xbf, 0x22, 0x75, 0xd3, 0xa1, 0x93, 0x23, 0x24, 0x3a, 0x25, 0x21, 0x1f, 0x0,
                   0x12, 0xbd, 0x12, 0x3e, 0x46, 0x56, 0x3d, 0x43, 0x2,  0x6,  0x75, 0x8e, 0x85, 0xd7, 0xf9, 0xe0,
                   0xc3, 0xe1, 0x2a, 0x29, 0x83, 0x1c, 0x0,  0x7,  0xf4, 0x46, 0x42, 0xcb, 0x3e, 0x70, 0x3e, 0x21,
                   0x22, 0x18, 0x29, 0x7d, 0x9,  0x0,  0x14, 0x8d, 0xb4, 0x82, 0x67, 0xa6, 0xdd, 0x3e, 0xa7, 0x2,
                   0x8c, 0x5d, 0x99, 0x88, 0x6b, 0x87, 0x87, 0x2,  0xf3, 0xd7, 0xdf, 0x52, 0x33, 0xa0};
  uint8_t topic_bytes[] = {0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x52, 0x33, 0xa0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xa3, 0x0, 0xf3, 0x83, 0xd3, 0x93, 0x94, 0x9e, 0x26, 0x2e, 0xd};
  uint8_t bytesprops1[] = {0x9, 0xc6, 0x1c, 0x82, 0x90, 0x21, 0x82, 0x46, 0x35, 0xbf, 0x22, 0x75, 0xd3, 0xa1, 0x93};
  uint8_t bytesprops2[] = {0xbd, 0x12, 0x3e, 0x46, 0x56, 0x3d, 0x43, 0x2,  0x6,
                           0x75, 0x8e, 0x85, 0xd7, 0xf9, 0xe0, 0xc3, 0xe1, 0x2a};
  uint8_t bytesprops3[] = {0xf4, 0x46, 0x42, 0xcb, 0x3e, 0x70, 0x3e};
  uint8_t bytesprops4[] = {0x8d, 0xb4, 0x82, 0x67, 0xa6, 0xdd, 0x3e, 0xa7, 0x2,  0x8c,
                           0x5d, 0x99, 0x88, 0x6b, 0x87, 0x87, 0x2,  0xf3, 0xd7, 0xdf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14373}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25898}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7145}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29689}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9274}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8728}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10944, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\198\161\148\238\191@\246\217\217\241\DC1\227\239", _pubPktID = 10944, _pubBody = "R3\160", _pubProps =
// [PropWildcardSubscriptionAvailable 84,PropTopicAliasMaximum 14373,PropResponseTopic
// "\163\NUL\243\131\211\147\148\158&.\r",PropServerKeepAlive 25898,PropMaximumPacketSize 7145,PropReceiveMaximum
// 29689,PropRequestProblemInformation 197,PropSubscriptionIdentifier 28,PropResponseTopic
// "\t\198\FS\130\144!\130F5\191\"u\211\161\147",PropTopicAlias 9274,PropRetainAvailable 33,PropReasonString
// "\189\DC2>FV=C\STX\ACKu\142\133\215\249\224\195\225*",PropSubscriptionIdentifierAvailable 131,PropServerReference
// "\244FB\203>p>",PropReceiveMaximum 8728,PropSubscriptionIdentifierAvailable 125,PropCorrelationData
// "\141\180\130g\166\221>\167\STX\140]\153\136k\135\135\STX\243\215\223"]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x3c, 0x8b, 0x1,  0x0,  0xd,  0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11,
                   0xe3, 0xef, 0x2a, 0xc0, 0x76, 0x28, 0x54, 0x22, 0x38, 0x25, 0x8,  0x0,  0xb,  0xa3, 0x0,  0xf3,
                   0x83, 0xd3, 0x93, 0x94, 0x9e, 0x26, 0x2e, 0xd,  0x13, 0x65, 0x2a, 0x27, 0x0,  0x0,  0x1b, 0xe9,
                   0x21, 0x73, 0xf9, 0x17, 0xc5, 0xb,  0x1c, 0x8,  0x0,  0xf,  0x9,  0xc6, 0x1c, 0x82, 0x90, 0x21,
                   0x82, 0x46, 0x35, 0xbf, 0x22, 0x75, 0xd3, 0xa1, 0x93, 0x23, 0x24, 0x3a, 0x25, 0x21, 0x1f, 0x0,
                   0x12, 0xbd, 0x12, 0x3e, 0x46, 0x56, 0x3d, 0x43, 0x2,  0x6,  0x75, 0x8e, 0x85, 0xd7, 0xf9, 0xe0,
                   0xc3, 0xe1, 0x2a, 0x29, 0x83, 0x1c, 0x0,  0x7,  0xf4, 0x46, 0x42, 0xcb, 0x3e, 0x70, 0x3e, 0x21,
                   0x22, 0x18, 0x29, 0x7d, 0x9,  0x0,  0x14, 0x8d, 0xb4, 0x82, 0x67, 0xa6, 0xdd, 0x3e, 0xa7, 0x2,
                   0x8c, 0x5d, 0x99, 0x88, 0x6b, 0x87, 0x87, 0x2,  0xf3, 0xd7, 0xdf, 0x52, 0x33, 0xa0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc6, 0xa1, 0x94, 0xee, 0xbf, 0x40, 0xf6, 0xd9, 0xd9, 0xf1, 0x11, 0xe3, 0xef};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x52, 0x33, 0xa0};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10944);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\195\159\242\185\ENQ\214\147\DLE\144\144,r\245\SO\237n\143\204\SUB\229\230", _pubPktID = 0, _pubBody =
// "\171\131\154", _pubProps = [PropContentType "\165jh\204\246\SOH\131KlPMz\142\143K=",PropCorrelationData
// "\231\223\SYN\157\255\226^\178\255\227",PropSubscriptionIdentifierAvailable 29,PropTopicAlias
// 24599,PropSessionExpiryInterval 17667,PropRetainAvailable 228,PropAuthenticationMethod
// "\142\EOT\159\223l2\177v\233\185\241\136;\186p",PropMaximumQoS 61,PropMaximumQoS 206,PropSharedSubscriptionAvailable
// 90,PropRequestProblemInformation 242,PropAuthenticationData "\186\159e\225\238\237",PropTopicAliasMaximum
// 17236,PropAuthenticationData "\168b\211",PropAuthenticationMethod
// "\180#G\231\a\ETXX}\233\232\FS\192\SUB@\250O\NAKn\176\227\DC4\156^V\215\134\169\190\194",PropMaximumQoS
// 192,PropSharedSubscriptionAvailable 39,PropServerKeepAlive 30465,PropUserProperty
// "\203\179l\247-\146\ESC)6\179\225\CAN\202,3\207\131\214\160\241$5" "9$\SOH\237M",PropTopicAliasMaximum
// 5969,PropSubscriptionIdentifierAvailable 27]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x39, 0xc1, 0x1,  0x0,  0x16, 0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90, 0x2c,
                   0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6, 0xa4, 0x1,  0x3,  0x0,  0x10, 0xa5, 0x6a,
                   0x68, 0xcc, 0xf6, 0x1,  0x83, 0x4b, 0x6c, 0x50, 0x4d, 0x7a, 0x8e, 0x8f, 0x4b, 0x3d, 0x9,  0x0,  0xa,
                   0xe7, 0xdf, 0x16, 0x9d, 0xff, 0xe2, 0x5e, 0xb2, 0xff, 0xe3, 0x29, 0x1d, 0x23, 0x60, 0x17, 0x11, 0x0,
                   0x0,  0x45, 0x3,  0x25, 0xe4, 0x15, 0x0,  0xf,  0x8e, 0x4,  0x9f, 0xdf, 0x6c, 0x32, 0xb1, 0x76, 0xe9,
                   0xb9, 0xf1, 0x88, 0x3b, 0xba, 0x70, 0x24, 0x3d, 0x24, 0xce, 0x2a, 0x5a, 0x17, 0xf2, 0x16, 0x0,  0x6,
                   0xba, 0x9f, 0x65, 0xe1, 0xee, 0xed, 0x22, 0x43, 0x54, 0x16, 0x0,  0x3,  0xa8, 0x62, 0xd3, 0x15, 0x0,
                   0x1d, 0xb4, 0x23, 0x47, 0xe7, 0x7,  0x3,  0x58, 0x7d, 0xe9, 0xe8, 0x1c, 0xc0, 0x1a, 0x40, 0xfa, 0x4f,
                   0x15, 0x6e, 0xb0, 0xe3, 0x14, 0x9c, 0x5e, 0x56, 0xd7, 0x86, 0xa9, 0xbe, 0xc2, 0x24, 0xc0, 0x2a, 0x27,
                   0x13, 0x77, 0x1,  0x26, 0x0,  0x16, 0xcb, 0xb3, 0x6c, 0xf7, 0x2d, 0x92, 0x1b, 0x29, 0x36, 0xb3, 0xe1,
                   0x18, 0xca, 0x2c, 0x33, 0xcf, 0x83, 0xd6, 0xa0, 0xf1, 0x24, 0x35, 0x0,  0x5,  0x39, 0x24, 0x1,  0xed,
                   0x4d, 0x22, 0x17, 0x51, 0x29, 0x1b, 0xab, 0x83, 0x9a};
  uint8_t topic_bytes[] = {0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                           0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xab, 0x83, 0x9a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xa5, 0x6a, 0x68, 0xcc, 0xf6, 0x1,  0x83, 0x4b,
                           0x6c, 0x50, 0x4d, 0x7a, 0x8e, 0x8f, 0x4b, 0x3d};
  uint8_t bytesprops1[] = {0xe7, 0xdf, 0x16, 0x9d, 0xff, 0xe2, 0x5e, 0xb2, 0xff, 0xe3};
  uint8_t bytesprops2[] = {0x8e, 0x4, 0x9f, 0xdf, 0x6c, 0x32, 0xb1, 0x76, 0xe9, 0xb9, 0xf1, 0x88, 0x3b, 0xba, 0x70};
  uint8_t bytesprops3[] = {0xba, 0x9f, 0x65, 0xe1, 0xee, 0xed};
  uint8_t bytesprops4[] = {0xa8, 0x62, 0xd3};
  uint8_t bytesprops5[] = {0xb4, 0x23, 0x47, 0xe7, 0x7,  0x3,  0x58, 0x7d, 0xe9, 0xe8, 0x1c, 0xc0, 0x1a, 0x40, 0xfa,
                           0x4f, 0x15, 0x6e, 0xb0, 0xe3, 0x14, 0x9c, 0x5e, 0x56, 0xd7, 0x86, 0xa9, 0xbe, 0xc2};
  uint8_t bytesprops7[] = {0x39, 0x24, 0x1, 0xed, 0x4d};
  uint8_t bytesprops6[] = {0xcb, 0xb3, 0x6c, 0xf7, 0x2d, 0x92, 0x1b, 0x29, 0x36, 0xb3, 0xe1,
                           0x18, 0xca, 0x2c, 0x33, 0xcf, 0x83, 0xd6, 0xa0, 0xf1, 0x24, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24599}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17667}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17236}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30465}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops6}, .v = {5, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5969}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\195\159\242\185\ENQ\214\147\DLE\144\144,r\245\SO\237n\143\204\SUB\229\230", _pubPktID = 0, _pubBody =
// "\171\131\154", _pubProps = [PropContentType "\165jh\204\246\SOH\131KlPMz\142\143K=",PropCorrelationData
// "\231\223\SYN\157\255\226^\178\255\227",PropSubscriptionIdentifierAvailable 29,PropTopicAlias
// 24599,PropSessionExpiryInterval 17667,PropRetainAvailable 228,PropAuthenticationMethod
// "\142\EOT\159\223l2\177v\233\185\241\136;\186p",PropMaximumQoS 61,PropMaximumQoS 206,PropSharedSubscriptionAvailable
// 90,PropRequestProblemInformation 242,PropAuthenticationData "\186\159e\225\238\237",PropTopicAliasMaximum
// 17236,PropAuthenticationData "\168b\211",PropAuthenticationMethod
// "\180#G\231\a\ETXX}\233\232\FS\192\SUB@\250O\NAKn\176\227\DC4\156^V\215\134\169\190\194",PropMaximumQoS
// 192,PropSharedSubscriptionAvailable 39,PropServerKeepAlive 30465,PropUserProperty
// "\203\179l\247-\146\ESC)6\179\225\CAN\202,3\207\131\214\160\241$5" "9$\SOH\237M",PropTopicAliasMaximum
// 5969,PropSubscriptionIdentifierAvailable 27]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x39, 0xc1, 0x1,  0x0,  0x16, 0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90, 0x2c,
                   0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6, 0xa4, 0x1,  0x3,  0x0,  0x10, 0xa5, 0x6a,
                   0x68, 0xcc, 0xf6, 0x1,  0x83, 0x4b, 0x6c, 0x50, 0x4d, 0x7a, 0x8e, 0x8f, 0x4b, 0x3d, 0x9,  0x0,  0xa,
                   0xe7, 0xdf, 0x16, 0x9d, 0xff, 0xe2, 0x5e, 0xb2, 0xff, 0xe3, 0x29, 0x1d, 0x23, 0x60, 0x17, 0x11, 0x0,
                   0x0,  0x45, 0x3,  0x25, 0xe4, 0x15, 0x0,  0xf,  0x8e, 0x4,  0x9f, 0xdf, 0x6c, 0x32, 0xb1, 0x76, 0xe9,
                   0xb9, 0xf1, 0x88, 0x3b, 0xba, 0x70, 0x24, 0x3d, 0x24, 0xce, 0x2a, 0x5a, 0x17, 0xf2, 0x16, 0x0,  0x6,
                   0xba, 0x9f, 0x65, 0xe1, 0xee, 0xed, 0x22, 0x43, 0x54, 0x16, 0x0,  0x3,  0xa8, 0x62, 0xd3, 0x15, 0x0,
                   0x1d, 0xb4, 0x23, 0x47, 0xe7, 0x7,  0x3,  0x58, 0x7d, 0xe9, 0xe8, 0x1c, 0xc0, 0x1a, 0x40, 0xfa, 0x4f,
                   0x15, 0x6e, 0xb0, 0xe3, 0x14, 0x9c, 0x5e, 0x56, 0xd7, 0x86, 0xa9, 0xbe, 0xc2, 0x24, 0xc0, 0x2a, 0x27,
                   0x13, 0x77, 0x1,  0x26, 0x0,  0x16, 0xcb, 0xb3, 0x6c, 0xf7, 0x2d, 0x92, 0x1b, 0x29, 0x36, 0xb3, 0xe1,
                   0x18, 0xca, 0x2c, 0x33, 0xcf, 0x83, 0xd6, 0xa0, 0xf1, 0x24, 0x35, 0x0,  0x5,  0x39, 0x24, 0x1,  0xed,
                   0x4d, 0x22, 0x17, 0x51, 0x29, 0x1b, 0xab, 0x83, 0x9a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0xc3, 0x9f, 0xf2, 0xb9, 0x5,  0xd6, 0x93, 0x10, 0x90, 0x90,
                               0x2c, 0x72, 0xf5, 0xe,  0xed, 0x6e, 0x8f, 0xcc, 0x1a, 0xe5, 0xe6};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xab, 0x83, 0x9a};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ",\129\b\199\224\197\191\196~\130\211\129B\164\238\NAK\138I\201f\163", _pubPktID = 2253, _pubBody =
// "|\153\171Y,OB.\132d\186cm;\DC4+\153\209y\t\128", _pubProps = [PropReasonString "\195U\132s:\212",PropReceiveMaximum
// 9748,PropMessageExpiryInterval 29630,PropResponseTopic "\153\&4\166~2\191\165\186\EOTM0\139
// p3\166\186",PropResponseInformation
// "\243\210\EM\240\"\n\DC1\192\181p,\226)\241\DC1b\230d\194\137\150\221\228\SI]t\246",PropRetainAvailable
// 18,PropTopicAliasMaximum 16390,PropAuthenticationData "\222\143\211\240",PropReceiveMaximum 2405]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x34, 0x81, 0x1,  0x0,  0x15, 0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3, 0x81,
                   0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3, 0x8,  0xcd, 0x52, 0x1f, 0x0,  0x6,  0xc3, 0x55,
                   0x84, 0x73, 0x3a, 0xd4, 0x21, 0x26, 0x14, 0x2,  0x0,  0x0,  0x73, 0xbe, 0x8,  0x0,  0x11, 0x99, 0x34,
                   0xa6, 0x7e, 0x32, 0xbf, 0xa5, 0xba, 0x4,  0x4d, 0x30, 0x8b, 0x20, 0x70, 0x33, 0xa6, 0xba, 0x1a, 0x0,
                   0x1b, 0xf3, 0xd2, 0x19, 0xf0, 0x22, 0xa,  0x11, 0xc0, 0xb5, 0x70, 0x2c, 0xe2, 0x29, 0xf1, 0x11, 0x62,
                   0xe6, 0x64, 0xc2, 0x89, 0x96, 0xdd, 0xe4, 0xf,  0x5d, 0x74, 0xf6, 0x25, 0x12, 0x22, 0x40, 0x6,  0x16,
                   0x0,  0x4,  0xde, 0x8f, 0xd3, 0xf0, 0x21, 0x9,  0x65, 0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e,
                   0x84, 0x64, 0xba, 0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  uint8_t topic_bytes[] = {0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3,
                           0x81, 0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba,
                         0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xc3, 0x55, 0x84, 0x73, 0x3a, 0xd4};
  uint8_t bytesprops1[] = {0x99, 0x34, 0xa6, 0x7e, 0x32, 0xbf, 0xa5, 0xba, 0x4,
                           0x4d, 0x30, 0x8b, 0x20, 0x70, 0x33, 0xa6, 0xba};
  uint8_t bytesprops2[] = {0xf3, 0xd2, 0x19, 0xf0, 0x22, 0xa,  0x11, 0xc0, 0xb5, 0x70, 0x2c, 0xe2, 0x29, 0xf1,
                           0x11, 0x62, 0xe6, 0x64, 0xc2, 0x89, 0x96, 0xdd, 0xe4, 0xf,  0x5d, 0x74, 0xf6};
  uint8_t bytesprops3[] = {0xde, 0x8f, 0xd3, 0xf0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9748}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29630}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16390}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2405}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 2253, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ",\129\b\199\224\197\191\196~\130\211\129B\164\238\NAK\138I\201f\163", _pubPktID = 2253, _pubBody =
// "|\153\171Y,OB.\132d\186cm;\DC4+\153\209y\t\128", _pubProps = [PropReasonString "\195U\132s:\212",PropReceiveMaximum
// 9748,PropMessageExpiryInterval 29630,PropResponseTopic "\153\&4\166~2\191\165\186\EOTM0\139
// p3\166\186",PropResponseInformation
// "\243\210\EM\240\"\n\DC1\192\181p,\226)\241\DC1b\230d\194\137\150\221\228\SI]t\246",PropRetainAvailable
// 18,PropTopicAliasMaximum 16390,PropAuthenticationData "\222\143\211\240",PropReceiveMaximum 2405]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x34, 0x81, 0x1,  0x0,  0x15, 0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3, 0x81,
                   0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3, 0x8,  0xcd, 0x52, 0x1f, 0x0,  0x6,  0xc3, 0x55,
                   0x84, 0x73, 0x3a, 0xd4, 0x21, 0x26, 0x14, 0x2,  0x0,  0x0,  0x73, 0xbe, 0x8,  0x0,  0x11, 0x99, 0x34,
                   0xa6, 0x7e, 0x32, 0xbf, 0xa5, 0xba, 0x4,  0x4d, 0x30, 0x8b, 0x20, 0x70, 0x33, 0xa6, 0xba, 0x1a, 0x0,
                   0x1b, 0xf3, 0xd2, 0x19, 0xf0, 0x22, 0xa,  0x11, 0xc0, 0xb5, 0x70, 0x2c, 0xe2, 0x29, 0xf1, 0x11, 0x62,
                   0xe6, 0x64, 0xc2, 0x89, 0x96, 0xdd, 0xe4, 0xf,  0x5d, 0x74, 0xf6, 0x25, 0x12, 0x22, 0x40, 0x6,  0x16,
                   0x0,  0x4,  0xde, 0x8f, 0xd3, 0xf0, 0x21, 0x9,  0x65, 0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e,
                   0x84, 0x64, 0xba, 0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2c, 0x81, 0x8,  0xc7, 0xe0, 0xc5, 0xbf, 0xc4, 0x7e, 0x82, 0xd3,
                               0x81, 0x42, 0xa4, 0xee, 0x15, 0x8a, 0x49, 0xc9, 0x66, 0xa3};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7c, 0x99, 0xab, 0x59, 0x2c, 0x4f, 0x42, 0x2e, 0x84, 0x64, 0xba,
                              0x63, 0x6d, 0x3b, 0x14, 0x2b, 0x99, 0xd1, 0x79, 0x9,  0x80};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2253);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\255\138\160\SO}\145\231=\154\241iR\219\FS\151\240}B\141(\214", _pubPktID = 10836, _pubBody = "\249\144\&7
// ,\DC2\216\146r\155\161\224l\238\165\FS\245", _pubProps = [PropRequestProblemInformation 141,PropMessageExpiryInterval
// 6268,PropSessionExpiryInterval 15867,PropReceiveMaximum 1447,PropTopicAliasMaximum 31003,PropCorrelationData
// "\228",PropMessageExpiryInterval 27091,PropWillDelayInterval 20427,PropSessionExpiryInterval 32582,PropResponseTopic
// "!e]\"\248\225\246\246\r\227V\146\252\237\180\215\185\201\SI\227\&8H\SYN\153\181x\134\174?",PropPayloadFormatIndicator
// 161,PropAssignedClientIdentifier "[\150\250d\191\163\220",PropCorrelationData "L\187E:J$o\234",PropMaximumQoS
// 180,PropCorrelationData "AS\141",PropRequestResponseInformation 131,PropUserProperty "\198\150"
// "\224c\250\195Upn\132\171\207S\205\165\209zN:h\137o\NAK\222\ACK",PropRetainAvailable 185,PropAssignedClientIdentifier
// "\r\GS\166\156<\DC4L\171",PropMessageExpiryInterval 17333,PropRetainAvailable 239,PropRequestResponseInformation
// 239,PropCorrelationData "\237{^\220\142\169$\190\172^\ETXZ\137\183\DC2\SUB\248\DC1\177*\154\\\243\167w\ACK"]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x3a, 0xe3, 0x1,  0x0,  0x15, 0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69, 0x52,
                   0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6, 0x2a, 0x54, 0xb7, 0x1,  0x17, 0x8d, 0x2,  0x0,
                   0x0,  0x18, 0x7c, 0x11, 0x0,  0x0,  0x3d, 0xfb, 0x21, 0x5,  0xa7, 0x22, 0x79, 0x1b, 0x9,  0x0,  0x1,
                   0xe4, 0x2,  0x0,  0x0,  0x69, 0xd3, 0x18, 0x0,  0x0,  0x4f, 0xcb, 0x11, 0x0,  0x0,  0x7f, 0x46, 0x8,
                   0x0,  0x1d, 0x21, 0x65, 0x5d, 0x22, 0xf8, 0xe1, 0xf6, 0xf6, 0xd,  0xe3, 0x56, 0x92, 0xfc, 0xed, 0xb4,
                   0xd7, 0xb9, 0xc9, 0xf,  0xe3, 0x38, 0x48, 0x16, 0x99, 0xb5, 0x78, 0x86, 0xae, 0x3f, 0x1,  0xa1, 0x12,
                   0x0,  0x7,  0x5b, 0x96, 0xfa, 0x64, 0xbf, 0xa3, 0xdc, 0x9,  0x0,  0x8,  0x4c, 0xbb, 0x45, 0x3a, 0x4a,
                   0x24, 0x6f, 0xea, 0x24, 0xb4, 0x9,  0x0,  0x3,  0x41, 0x53, 0x8d, 0x19, 0x83, 0x26, 0x0,  0x2,  0xc6,
                   0x96, 0x0,  0x17, 0xe0, 0x63, 0xfa, 0xc3, 0x55, 0x70, 0x6e, 0x84, 0xab, 0xcf, 0x53, 0xcd, 0xa5, 0xd1,
                   0x7a, 0x4e, 0x3a, 0x68, 0x89, 0x6f, 0x15, 0xde, 0x6,  0x25, 0xb9, 0x12, 0x0,  0x8,  0xd,  0x1d, 0xa6,
                   0x9c, 0x3c, 0x14, 0x4c, 0xab, 0x2,  0x0,  0x0,  0x43, 0xb5, 0x25, 0xef, 0x19, 0xef, 0x9,  0x0,  0x1a,
                   0xed, 0x7b, 0x5e, 0xdc, 0x8e, 0xa9, 0x24, 0xbe, 0xac, 0x5e, 0x3,  0x5a, 0x89, 0xb7, 0x12, 0x1a, 0xf8,
                   0x11, 0xb1, 0x2a, 0x9a, 0x5c, 0xf3, 0xa7, 0x77, 0x6,  0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92,
                   0x72, 0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  uint8_t topic_bytes[] = {0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                           0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72,
                         0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xe4};
  uint8_t bytesprops1[] = {0x21, 0x65, 0x5d, 0x22, 0xf8, 0xe1, 0xf6, 0xf6, 0xd,  0xe3, 0x56, 0x92, 0xfc, 0xed, 0xb4,
                           0xd7, 0xb9, 0xc9, 0xf,  0xe3, 0x38, 0x48, 0x16, 0x99, 0xb5, 0x78, 0x86, 0xae, 0x3f};
  uint8_t bytesprops2[] = {0x5b, 0x96, 0xfa, 0x64, 0xbf, 0xa3, 0xdc};
  uint8_t bytesprops3[] = {0x4c, 0xbb, 0x45, 0x3a, 0x4a, 0x24, 0x6f, 0xea};
  uint8_t bytesprops4[] = {0x41, 0x53, 0x8d};
  uint8_t bytesprops6[] = {0xe0, 0x63, 0xfa, 0xc3, 0x55, 0x70, 0x6e, 0x84, 0xab, 0xcf, 0x53, 0xcd,
                           0xa5, 0xd1, 0x7a, 0x4e, 0x3a, 0x68, 0x89, 0x6f, 0x15, 0xde, 0x6};
  uint8_t bytesprops5[] = {0xc6, 0x96};
  uint8_t bytesprops7[] = {0xd, 0x1d, 0xa6, 0x9c, 0x3c, 0x14, 0x4c, 0xab};
  uint8_t bytesprops8[] = {0xed, 0x7b, 0x5e, 0xdc, 0x8e, 0xa9, 0x24, 0xbe, 0xac, 0x5e, 0x3,  0x5a, 0x89,
                           0xb7, 0x12, 0x1a, 0xf8, 0x11, 0xb1, 0x2a, 0x9a, 0x5c, 0xf3, 0xa7, 0x77, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6268}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15867}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1447}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31003}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27091}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20427}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32582}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops5}, .v = {23, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17333}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10836, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\255\138\160\SO}\145\231=\154\241iR\219\FS\151\240}B\141(\214", _pubPktID = 10836, _pubBody = "\249\144\&7
// ,\DC2\216\146r\155\161\224l\238\165\FS\245", _pubProps = [PropRequestProblemInformation 141,PropMessageExpiryInterval
// 6268,PropSessionExpiryInterval 15867,PropReceiveMaximum 1447,PropTopicAliasMaximum 31003,PropCorrelationData
// "\228",PropMessageExpiryInterval 27091,PropWillDelayInterval 20427,PropSessionExpiryInterval 32582,PropResponseTopic
// "!e]\"\248\225\246\246\r\227V\146\252\237\180\215\185\201\SI\227\&8H\SYN\153\181x\134\174?",PropPayloadFormatIndicator
// 161,PropAssignedClientIdentifier "[\150\250d\191\163\220",PropCorrelationData "L\187E:J$o\234",PropMaximumQoS
// 180,PropCorrelationData "AS\141",PropRequestResponseInformation 131,PropUserProperty "\198\150"
// "\224c\250\195Upn\132\171\207S\205\165\209zN:h\137o\NAK\222\ACK",PropRetainAvailable 185,PropAssignedClientIdentifier
// "\r\GS\166\156<\DC4L\171",PropMessageExpiryInterval 17333,PropRetainAvailable 239,PropRequestResponseInformation
// 239,PropCorrelationData "\237{^\220\142\169$\190\172^\ETXZ\137\183\DC2\SUB\248\DC1\177*\154\\\243\167w\ACK"]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x3a, 0xe3, 0x1,  0x0,  0x15, 0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69, 0x52,
                   0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6, 0x2a, 0x54, 0xb7, 0x1,  0x17, 0x8d, 0x2,  0x0,
                   0x0,  0x18, 0x7c, 0x11, 0x0,  0x0,  0x3d, 0xfb, 0x21, 0x5,  0xa7, 0x22, 0x79, 0x1b, 0x9,  0x0,  0x1,
                   0xe4, 0x2,  0x0,  0x0,  0x69, 0xd3, 0x18, 0x0,  0x0,  0x4f, 0xcb, 0x11, 0x0,  0x0,  0x7f, 0x46, 0x8,
                   0x0,  0x1d, 0x21, 0x65, 0x5d, 0x22, 0xf8, 0xe1, 0xf6, 0xf6, 0xd,  0xe3, 0x56, 0x92, 0xfc, 0xed, 0xb4,
                   0xd7, 0xb9, 0xc9, 0xf,  0xe3, 0x38, 0x48, 0x16, 0x99, 0xb5, 0x78, 0x86, 0xae, 0x3f, 0x1,  0xa1, 0x12,
                   0x0,  0x7,  0x5b, 0x96, 0xfa, 0x64, 0xbf, 0xa3, 0xdc, 0x9,  0x0,  0x8,  0x4c, 0xbb, 0x45, 0x3a, 0x4a,
                   0x24, 0x6f, 0xea, 0x24, 0xb4, 0x9,  0x0,  0x3,  0x41, 0x53, 0x8d, 0x19, 0x83, 0x26, 0x0,  0x2,  0xc6,
                   0x96, 0x0,  0x17, 0xe0, 0x63, 0xfa, 0xc3, 0x55, 0x70, 0x6e, 0x84, 0xab, 0xcf, 0x53, 0xcd, 0xa5, 0xd1,
                   0x7a, 0x4e, 0x3a, 0x68, 0x89, 0x6f, 0x15, 0xde, 0x6,  0x25, 0xb9, 0x12, 0x0,  0x8,  0xd,  0x1d, 0xa6,
                   0x9c, 0x3c, 0x14, 0x4c, 0xab, 0x2,  0x0,  0x0,  0x43, 0xb5, 0x25, 0xef, 0x19, 0xef, 0x9,  0x0,  0x1a,
                   0xed, 0x7b, 0x5e, 0xdc, 0x8e, 0xa9, 0x24, 0xbe, 0xac, 0x5e, 0x3,  0x5a, 0x89, 0xb7, 0x12, 0x1a, 0xf8,
                   0x11, 0xb1, 0x2a, 0x9a, 0x5c, 0xf3, 0xa7, 0x77, 0x6,  0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92,
                   0x72, 0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0x8a, 0xa0, 0xe,  0x7d, 0x91, 0xe7, 0x3d, 0x9a, 0xf1, 0x69,
                               0x52, 0xdb, 0x1c, 0x97, 0xf0, 0x7d, 0x42, 0x8d, 0x28, 0xd6};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x90, 0x37, 0x20, 0x2c, 0x12, 0xd8, 0x92, 0x72,
                              0x9b, 0xa1, 0xe0, 0x6c, 0xee, 0xa5, 0x1c, 0xf5};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10836);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\203\137\174H\204\220\160\&8\f+bXR\239\199\DC1\186\254\249\218\179y\210~\185\250\166\248", _pubPktID = 0, _pubBody =
// "\136\142{\DC4\\\154]/:\184\246N\DC28\204\&2C\f@\172\199\237\162)]W\186\180", _pubProps = [PropSubscriptionIdentifier
// 28,PropReasonString "m\SYN\215N\147a\164B~\157\176\&0",PropSharedSubscriptionAvailable
// 155,PropSubscriptionIdentifierAvailable 52,PropAuthenticationData "r\222\DC3\173eK\183\198`",PropContentType
// "9\231\244\219k\246o",PropTopicAlias 25947,PropReasonString
// "\197\240\246\183\239\187\195\DC2\195\132xh^/\189\DC1\165\221\158"]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x38, 0x7f, 0x0,  0x1c, 0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52,
                   0xef, 0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8, 0x44, 0xb,
                   0x1c, 0x1f, 0x0,  0xc,  0x6d, 0x16, 0xd7, 0x4e, 0x93, 0x61, 0xa4, 0x42, 0x7e, 0x9d, 0xb0, 0x30, 0x2a,
                   0x9b, 0x29, 0x34, 0x16, 0x0,  0x9,  0x72, 0xde, 0x13, 0xad, 0x65, 0x4b, 0xb7, 0xc6, 0x60, 0x3,  0x0,
                   0x7,  0x39, 0xe7, 0xf4, 0xdb, 0x6b, 0xf6, 0x6f, 0x23, 0x65, 0x5b, 0x1f, 0x0,  0x13, 0xc5, 0xf0, 0xf6,
                   0xb7, 0xef, 0xbb, 0xc3, 0x12, 0xc3, 0x84, 0x78, 0x68, 0x5e, 0x2f, 0xbd, 0x11, 0xa5, 0xdd, 0x9e, 0x88,
                   0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38, 0xcc, 0x32, 0x43, 0xc,
                   0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  uint8_t topic_bytes[] = {0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52, 0xef,
                           0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38,
                         0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0x6d, 0x16, 0xd7, 0x4e, 0x93, 0x61, 0xa4, 0x42, 0x7e, 0x9d, 0xb0, 0x30};
  uint8_t bytesprops1[] = {0x72, 0xde, 0x13, 0xad, 0x65, 0x4b, 0xb7, 0xc6, 0x60};
  uint8_t bytesprops2[] = {0x39, 0xe7, 0xf4, 0xdb, 0x6b, 0xf6, 0x6f};
  uint8_t bytesprops3[] = {0xc5, 0xf0, 0xf6, 0xb7, 0xef, 0xbb, 0xc3, 0x12, 0xc3, 0x84,
                           0x78, 0x68, 0x5e, 0x2f, 0xbd, 0x11, 0xa5, 0xdd, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25947}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\203\137\174H\204\220\160\&8\f+bXR\239\199\DC1\186\254\249\218\179y\210~\185\250\166\248", _pubPktID = 0, _pubBody =
// "\136\142{\DC4\\\154]/:\184\246N\DC28\204\&2C\f@\172\199\237\162)]W\186\180", _pubProps = [PropSubscriptionIdentifier
// 28,PropReasonString "m\SYN\215N\147a\164B~\157\176\&0",PropSharedSubscriptionAvailable
// 155,PropSubscriptionIdentifierAvailable 52,PropAuthenticationData "r\222\DC3\173eK\183\198`",PropContentType
// "9\231\244\219k\246o",PropTopicAlias 25947,PropReasonString
// "\197\240\246\183\239\187\195\DC2\195\132xh^/\189\DC1\165\221\158"]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x38, 0x7f, 0x0,  0x1c, 0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52,
                   0xef, 0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8, 0x44, 0xb,
                   0x1c, 0x1f, 0x0,  0xc,  0x6d, 0x16, 0xd7, 0x4e, 0x93, 0x61, 0xa4, 0x42, 0x7e, 0x9d, 0xb0, 0x30, 0x2a,
                   0x9b, 0x29, 0x34, 0x16, 0x0,  0x9,  0x72, 0xde, 0x13, 0xad, 0x65, 0x4b, 0xb7, 0xc6, 0x60, 0x3,  0x0,
                   0x7,  0x39, 0xe7, 0xf4, 0xdb, 0x6b, 0xf6, 0x6f, 0x23, 0x65, 0x5b, 0x1f, 0x0,  0x13, 0xc5, 0xf0, 0xf6,
                   0xb7, 0xef, 0xbb, 0xc3, 0x12, 0xc3, 0x84, 0x78, 0x68, 0x5e, 0x2f, 0xbd, 0x11, 0xa5, 0xdd, 0x9e, 0x88,
                   0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38, 0xcc, 0x32, 0x43, 0xc,
                   0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcb, 0x89, 0xae, 0x48, 0xcc, 0xdc, 0xa0, 0x38, 0xc,  0x2b, 0x62, 0x58, 0x52, 0xef,
                               0xc7, 0x11, 0xba, 0xfe, 0xf9, 0xda, 0xb3, 0x79, 0xd2, 0x7e, 0xb9, 0xfa, 0xa6, 0xf8};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x88, 0x8e, 0x7b, 0x14, 0x5c, 0x9a, 0x5d, 0x2f, 0x3a, 0xb8, 0xf6, 0x4e, 0x12, 0x38,
                              0xcc, 0x32, 0x43, 0xc,  0x40, 0xac, 0xc7, 0xed, 0xa2, 0x29, 0x5d, 0x57, 0xba, 0xb4};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "dU\158\136\251\148W][8D\138i\232?$",
// _pubPktID = 0, _pubBody = "'\136\162\SO\255\RS\205q\229\ACK\148\ETX\129rJ\DC2Y3\165a11\180\247", _pubProps =
// [PropMaximumQoS 247,PropReasonString "\151\235j!\157\NAK",PropSessionExpiryInterval 15510,PropServerKeepAlive 23576]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x39, 0x3e, 0x0,  0x10, 0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d, 0x5b, 0x38, 0x44, 0x8a,
                   0x69, 0xe8, 0x3f, 0x24, 0x13, 0x24, 0xf7, 0x1f, 0x0,  0x6,  0x97, 0xeb, 0x6a, 0x21, 0x9d, 0x15,
                   0x11, 0x0,  0x0,  0x3c, 0x96, 0x13, 0x5c, 0x18, 0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71,
                   0xe5, 0x6,  0x94, 0x3,  0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  uint8_t topic_bytes[] = {0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d,
                           0x5b, 0x38, 0x44, 0x8a, 0x69, 0xe8, 0x3f, 0x24};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,  0x94, 0x3,
                         0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0x97, 0xeb, 0x6a, 0x21, 0x9d, 0x15};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15510}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23576}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "dU\158\136\251\148W][8D\138i\232?$",
// _pubPktID = 0, _pubBody = "'\136\162\SO\255\RS\205q\229\ACK\148\ETX\129rJ\DC2Y3\165a11\180\247", _pubProps =
// [PropMaximumQoS 247,PropReasonString "\151\235j!\157\NAK",PropSessionExpiryInterval 15510,PropServerKeepAlive 23576]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {0x39, 0x3e, 0x0,  0x10, 0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d, 0x5b, 0x38, 0x44, 0x8a,
                   0x69, 0xe8, 0x3f, 0x24, 0x13, 0x24, 0xf7, 0x1f, 0x0,  0x6,  0x97, 0xeb, 0x6a, 0x21, 0x9d, 0x15,
                   0x11, 0x0,  0x0,  0x3c, 0x96, 0x13, 0x5c, 0x18, 0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71,
                   0xe5, 0x6,  0x94, 0x3,  0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x64, 0x55, 0x9e, 0x88, 0xfb, 0x94, 0x57, 0x5d,
                               0x5b, 0x38, 0x44, 0x8a, 0x69, 0xe8, 0x3f, 0x24};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0x88, 0xa2, 0xe,  0xff, 0x1e, 0xcd, 0x71, 0xe5, 0x6,  0x94, 0x3,
                              0x81, 0x72, 0x4a, 0x12, 0x59, 0x33, 0xa5, 0x61, 0x31, 0x31, 0xb4, 0xf7};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\207\249\USrJ\214L\ENQAT\140JUG\ESC\FS\165\202\218\206\DEL\142\250'\167s\139", _pubPktID = 24516, _pubBody = "",
// _pubProps = [PropSubscriptionIdentifier 20,PropCorrelationData
// ";UtP!\fs\v\200\159\NAK\"\FS\184\201",PropRequestProblemInformation 5,PropMaximumQoS 209,PropResponseTopic
// "\224\&1/V?\246\&7c\137\&3G|\144\227\176\&8\250FzsMB",PropUserProperty "\SYN7\221\STXW\189"
// "Hi\178\129\\\162\&4U\CAN\167'\172\223l?\250",PropRequestProblemInformation 166,PropMessageExpiryInterval
// 30177,PropRetainAvailable 132]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x3d, 0x76, 0x0,  0x1c, 0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54,
                   0x8c, 0x4a, 0x55, 0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7,
                   0x73, 0x8b, 0x5f, 0xc4, 0x55, 0xb,  0x14, 0x9,  0x0,  0xf,  0x3b, 0x55, 0x74, 0x50, 0x21,
                   0xc,  0x73, 0xb,  0xc8, 0x9f, 0x15, 0x22, 0x1c, 0xb8, 0xc9, 0x17, 0x5,  0x24, 0xd1, 0x8,
                   0x0,  0x16, 0xe0, 0x31, 0x2f, 0x56, 0x3f, 0xf6, 0x37, 0x63, 0x89, 0x33, 0x47, 0x7c, 0x90,
                   0xe3, 0xb0, 0x38, 0xfa, 0x46, 0x7a, 0x73, 0x4d, 0x42, 0x26, 0x0,  0x6,  0x16, 0x37, 0xdd,
                   0x2,  0x57, 0xbd, 0x0,  0x10, 0x48, 0x69, 0xb2, 0x81, 0x5c, 0xa2, 0x34, 0x55, 0x18, 0xa7,
                   0x27, 0xac, 0xdf, 0x6c, 0x3f, 0xfa, 0x17, 0xa6, 0x2,  0x0,  0x0,  0x75, 0xe1, 0x25, 0x84};
  uint8_t topic_bytes[] = {0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55,
                           0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x3b, 0x55, 0x74, 0x50, 0x21, 0xc, 0x73, 0xb, 0xc8, 0x9f, 0x15, 0x22, 0x1c, 0xb8, 0xc9};
  uint8_t bytesprops1[] = {0xe0, 0x31, 0x2f, 0x56, 0x3f, 0xf6, 0x37, 0x63, 0x89, 0x33, 0x47,
                           0x7c, 0x90, 0xe3, 0xb0, 0x38, 0xfa, 0x46, 0x7a, 0x73, 0x4d, 0x42};
  uint8_t bytesprops3[] = {0x48, 0x69, 0xb2, 0x81, 0x5c, 0xa2, 0x34, 0x55,
                           0x18, 0xa7, 0x27, 0xac, 0xdf, 0x6c, 0x3f, 0xfa};
  uint8_t bytesprops2[] = {0x16, 0x37, 0xdd, 0x2, 0x57, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops2}, .v = {16, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30177}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 132}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 24516, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\207\249\USrJ\214L\ENQAT\140JUG\ESC\FS\165\202\218\206\DEL\142\250'\167s\139", _pubPktID = 24516, _pubBody = "",
// _pubProps = [PropSubscriptionIdentifier 20,PropCorrelationData
// ";UtP!\fs\v\200\159\NAK\"\FS\184\201",PropRequestProblemInformation 5,PropMaximumQoS 209,PropResponseTopic
// "\224\&1/V?\246\&7c\137\&3G|\144\227\176\&8\250FzsMB",PropUserProperty "\SYN7\221\STXW\189"
// "Hi\178\129\\\162\&4U\CAN\167'\172\223l?\250",PropRequestProblemInformation 166,PropMessageExpiryInterval
// 30177,PropRetainAvailable 132]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x3d, 0x76, 0x0,  0x1c, 0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54,
                   0x8c, 0x4a, 0x55, 0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7,
                   0x73, 0x8b, 0x5f, 0xc4, 0x55, 0xb,  0x14, 0x9,  0x0,  0xf,  0x3b, 0x55, 0x74, 0x50, 0x21,
                   0xc,  0x73, 0xb,  0xc8, 0x9f, 0x15, 0x22, 0x1c, 0xb8, 0xc9, 0x17, 0x5,  0x24, 0xd1, 0x8,
                   0x0,  0x16, 0xe0, 0x31, 0x2f, 0x56, 0x3f, 0xf6, 0x37, 0x63, 0x89, 0x33, 0x47, 0x7c, 0x90,
                   0xe3, 0xb0, 0x38, 0xfa, 0x46, 0x7a, 0x73, 0x4d, 0x42, 0x26, 0x0,  0x6,  0x16, 0x37, 0xdd,
                   0x2,  0x57, 0xbd, 0x0,  0x10, 0x48, 0x69, 0xb2, 0x81, 0x5c, 0xa2, 0x34, 0x55, 0x18, 0xa7,
                   0x27, 0xac, 0xdf, 0x6c, 0x3f, 0xfa, 0x17, 0xa6, 0x2,  0x0,  0x0,  0x75, 0xe1, 0x25, 0x84};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xad, 0xcf, 0xf9, 0x1f, 0x72, 0x4a, 0xd6, 0x4c, 0x5,  0x41, 0x54, 0x8c, 0x4a, 0x55,
                               0x47, 0x1b, 0x1c, 0xa5, 0xca, 0xda, 0xce, 0x7f, 0x8e, 0xfa, 0x27, 0xa7, 0x73, 0x8b};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 24516);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Nothing, _password = Just "\DLEVW\161\173W!+\154\235\a\169\136(K\152\224\190I4y",
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 3940, _connID = "\147b\SOH\234HL\237", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x13, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2, 0xf,
                   0x64, 0x0,  0x7, 0x93, 0x62, 0x1,  0xea, 0x48, 0x4c, 0xed};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3940;
  uint8_t client_id_bytes[] = {0x93, 0x62, 0x1, 0xea, 0x48, 0x4c, 0xed};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x10, 0x56, 0x57, 0xa1, 0xad, 0x57, 0x21, 0x2b, 0x9a, 0xeb, 0x7,
                              0xa9, 0x88, 0x28, 0x4b, 0x98, 0xe0, 0xbe, 0x49, 0x34, 0x79};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\232f;/", _password = Just
// "T'\248\144\179\155V\209\NAK$l\134\169\165\244_\ACK\aa\US", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "h\165{\211B\214\169W\237", _willMsg = "", _willProps = []}), _cleanSession = False, _keepAlive
// = 13091, _connID = "k!a\t\182\181\230\207<\SUB\251\243b\250\216\131H", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x33, 0x23, 0x0,  0x11, 0x6b,
                   0x21, 0x61, 0x9,  0xb6, 0xb5, 0xe6, 0xcf, 0x3c, 0x1a, 0xfb, 0xf3, 0x62, 0xfa, 0xd8, 0x83,
                   0x48, 0x0,  0x9,  0x68, 0xa5, 0x7b, 0xd3, 0x42, 0xd6, 0xa9, 0x57, 0xed, 0x0,  0x0,  0x0,
                   0x4,  0xe8, 0x66, 0x3b, 0x2f, 0x0,  0x14, 0x54, 0x27, 0xf8, 0x90, 0xb3, 0x9b, 0x56, 0xd1,
                   0x15, 0x24, 0x6c, 0x86, 0xa9, 0xa5, 0xf4, 0x5f, 0x6,  0x7,  0x61, 0x1f};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x68, 0xa5, 0x7b, 0xd3, 0x42, 0xd6, 0xa9, 0x57, 0xed};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13091;
  uint8_t client_id_bytes[] = {0x6b, 0x21, 0x61, 0x9,  0xb6, 0xb5, 0xe6, 0xcf, 0x3c,
                               0x1a, 0xfb, 0xf3, 0x62, 0xfa, 0xd8, 0x83, 0x48};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe8, 0x66, 0x3b, 0x2f};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x54, 0x27, 0xf8, 0x90, 0xb3, 0x9b, 0x56, 0xd1, 0x15, 0x24,
                              0x6c, 0x86, 0xa9, 0xa5, 0xf4, 0x5f, 0x6,  0x7,  0x61, 0x1f};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\211\228\SUB\176\198\221", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "xpj95\230\&1\225?", _willMsg = "\248", _willProps = []}),
// _cleanSession = True, _keepAlive = 2433, _connID =
// "\185\137\241\223?ec+\\U\r\DC1\GS<y\159\167\147\233a\142C4\216\a\"2b", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x3e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x9,  0x81, 0x0,  0x1c, 0xb9, 0x89,
                   0xf1, 0xdf, 0x3f, 0x65, 0x63, 0x2b, 0x5c, 0x55, 0xd,  0x11, 0x1d, 0x3c, 0x79, 0x9f, 0xa7, 0x93,
                   0xe9, 0x61, 0x8e, 0x43, 0x34, 0xd8, 0x7,  0x22, 0x32, 0x62, 0x0,  0x9,  0x78, 0x70, 0x6a, 0x39,
                   0x35, 0xe6, 0x31, 0xe1, 0x3f, 0x0,  0x1,  0xf8, 0x0,  0x6,  0xd3, 0xe4, 0x1a, 0xb0, 0xc6, 0xdd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x78, 0x70, 0x6a, 0x39, 0x35, 0xe6, 0x31, 0xe1, 0x3f};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf8};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2433;
  uint8_t client_id_bytes[] = {0xb9, 0x89, 0xf1, 0xdf, 0x3f, 0x65, 0x63, 0x2b, 0x5c, 0x55, 0xd, 0x11, 0x1d, 0x3c,
                               0x79, 0x9f, 0xa7, 0x93, 0xe9, 0x61, 0x8e, 0x43, 0x34, 0xd8, 0x7, 0x22, 0x32, 0x62};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd3, 0xe4, 0x1a, 0xb0, 0xc6, 0xdd};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "^Y5\248\233?\154\DC4-\171A\204}\158\211", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\FS\"\130\182\226\&1: \251\\\185\139\177O\141\251(a",
// _willMsg = "\208I+\222\&7\US\167\234\232\168\200\184\186\&7", _willProps = []}), _cleanSession = False, _keepAlive =
// 30451, _connID = "\247'\219\164\191", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x76, 0xf3, 0x0,  0x5,  0xf7,
                   0x27, 0xdb, 0xa4, 0xbf, 0x0,  0x12, 0x1c, 0x22, 0x82, 0xb6, 0xe2, 0x31, 0x3a, 0x20, 0xfb,
                   0x5c, 0xb9, 0x8b, 0xb1, 0x4f, 0x8d, 0xfb, 0x28, 0x61, 0x0,  0xe,  0xd0, 0x49, 0x2b, 0xde,
                   0x37, 0x1f, 0xa7, 0xea, 0xe8, 0xa8, 0xc8, 0xb8, 0xba, 0x37, 0x0,  0xf,  0x5e, 0x59, 0x35,
                   0xf8, 0xe9, 0x3f, 0x9a, 0x14, 0x2d, 0xab, 0x41, 0xcc, 0x7d, 0x9e, 0xd3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1c, 0x22, 0x82, 0xb6, 0xe2, 0x31, 0x3a, 0x20, 0xfb,
                                0x5c, 0xb9, 0x8b, 0xb1, 0x4f, 0x8d, 0xfb, 0x28, 0x61};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd0, 0x49, 0x2b, 0xde, 0x37, 0x1f, 0xa7, 0xea, 0xe8, 0xa8, 0xc8, 0xb8, 0xba, 0x37};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30451;
  uint8_t client_id_bytes[] = {0xf7, 0x27, 0xdb, 0xa4, 0xbf};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5e, 0x59, 0x35, 0xf8, 0xe9, 0x3f, 0x9a, 0x14, 0x2d, 0xab, 0x41, 0xcc, 0x7d, 0x9e, 0xd3};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\237Kwt\ESC3\220\DC4f\147=}\131D\196\234\128\187\233j{\t\138:(I\NUL\183\220", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\135T\135u\132\130K", _willMsg =
// "=\143\180Fs\174O9K\200\240\250/\141\198\ENQ%\SYN\201\231lg4n\204\RS\248\214", _willProps = []}), _cleanSession =
// False, _keepAlive = 29757, _connID = "\240h\246\160\191\129\157\155\219\211\215\246\162\241", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x14, 0x74, 0x3d, 0x0,  0xe,  0xf0, 0x68, 0xf6,
                   0xa0, 0xbf, 0x81, 0x9d, 0x9b, 0xdb, 0xd3, 0xd7, 0xf6, 0xa2, 0xf1, 0x0,  0x7,  0x87, 0x54, 0x87, 0x75,
                   0x84, 0x82, 0x4b, 0x0,  0x1c, 0x3d, 0x8f, 0xb4, 0x46, 0x73, 0xae, 0x4f, 0x39, 0x4b, 0xc8, 0xf0, 0xfa,
                   0x2f, 0x8d, 0xc6, 0x5,  0x25, 0x16, 0xc9, 0xe7, 0x6c, 0x67, 0x34, 0x6e, 0xcc, 0x1e, 0xf8, 0xd6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x54, 0x87, 0x75, 0x84, 0x82, 0x4b};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3d, 0x8f, 0xb4, 0x46, 0x73, 0xae, 0x4f, 0x39, 0x4b, 0xc8, 0xf0, 0xfa, 0x2f, 0x8d,
                                  0xc6, 0x5,  0x25, 0x16, 0xc9, 0xe7, 0x6c, 0x67, 0x34, 0x6e, 0xcc, 0x1e, 0xf8, 0xd6};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29757;
  uint8_t client_id_bytes[] = {0xf0, 0x68, 0xf6, 0xa0, 0xbf, 0x81, 0x9d, 0x9b, 0xdb, 0xd3, 0xd7, 0xf6, 0xa2, 0xf1};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xed, 0x4b, 0x77, 0x74, 0x1b, 0x33, 0xdc, 0x14, 0x66, 0x93, 0x3d, 0x7d, 0x83, 0x44, 0xc4,
                              0xea, 0x80, 0xbb, 0xe9, 0x6a, 0x7b, 0x9,  0x8a, 0x3a, 0x28, 0x49, 0x0,  0xb7, 0xdc};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\129R\188<a\142\240\&4\244f\NUL@3/\RS", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\128\241\168\n\242\187\240\177U", _willMsg =
// "Y\227\211\222H\229\181z\225XC\149D&@\208LD", _willProps = []}), _cleanSession = False, _keepAlive = 24021, _connID =
// "\226\DC1b\162U#[l\222e\215\133\236\USO\246T\196\148]\bq\191\235\137az", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x57, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8c, 0x5d, 0xd5, 0x0,  0x1b, 0xe2,
                   0x11, 0x62, 0xa2, 0x55, 0x23, 0x5b, 0x6c, 0xde, 0x65, 0xd7, 0x85, 0xec, 0x1f, 0x4f, 0xf6,
                   0x54, 0xc4, 0x94, 0x5d, 0x8,  0x71, 0xbf, 0xeb, 0x89, 0x61, 0x7a, 0x0,  0x9,  0x80, 0xf1,
                   0xa8, 0xa,  0xf2, 0xbb, 0xf0, 0xb1, 0x55, 0x0,  0x12, 0x59, 0xe3, 0xd3, 0xde, 0x48, 0xe5,
                   0xb5, 0x7a, 0xe1, 0x58, 0x43, 0x95, 0x44, 0x26, 0x40, 0xd0, 0x4c, 0x44, 0x0,  0xf,  0x81,
                   0x52, 0xbc, 0x3c, 0x61, 0x8e, 0xf0, 0x34, 0xf4, 0x66, 0x0,  0x40, 0x33, 0x2f, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0xf1, 0xa8, 0xa, 0xf2, 0xbb, 0xf0, 0xb1, 0x55};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x59, 0xe3, 0xd3, 0xde, 0x48, 0xe5, 0xb5, 0x7a, 0xe1,
                                  0x58, 0x43, 0x95, 0x44, 0x26, 0x40, 0xd0, 0x4c, 0x44};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24021;
  uint8_t client_id_bytes[] = {0xe2, 0x11, 0x62, 0xa2, 0x55, 0x23, 0x5b, 0x6c, 0xde, 0x65, 0xd7, 0x85, 0xec, 0x1f,
                               0x4f, 0xf6, 0x54, 0xc4, 0x94, 0x5d, 0x8,  0x71, 0xbf, 0xeb, 0x89, 0x61, 0x7a};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x81, 0x52, 0xbc, 0x3c, 0x61, 0x8e, 0xf0, 0x34, 0xf4, 0x66, 0x0, 0x40, 0x33, 0x2f, 0x1e};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "i\250\FS\227S", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 30539, _connID = "\226\ENQ\244\222I6\213j\202\&9\230\198\255\173\133\239\DC3\228\134\186]", _properties
// = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x21, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x77, 0x4b,
                   0x0,  0x15, 0xe2, 0x5,  0xf4, 0xde, 0x49, 0x36, 0xd5, 0x6a, 0xca, 0x39,
                   0xe6, 0xc6, 0xff, 0xad, 0x85, 0xef, 0x13, 0xe4, 0x86, 0xba, 0x5d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30539;
  uint8_t client_id_bytes[] = {0xe2, 0x5,  0xf4, 0xde, 0x49, 0x36, 0xd5, 0x6a, 0xca, 0x39, 0xe6,
                               0xc6, 0xff, 0xad, 0x85, 0xef, 0x13, 0xe4, 0x86, 0xba, 0x5d};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x69, 0xfa, 0x1c, 0xe3, 0x53};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\225\203mIB\148\147s", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS0, _willTopic = "`\SO\132\139\ESC\222W\198\STXb$", _willMsg =
// "j\225L%\SYN:R\144\143\244\201FZce\154\SO[\DC1\183\205\197\134J,\184", _willProps = []}), _cleanSession = False,
// _keepAlive = 14155, _connID = "\190I\DC1\187\DEL", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x44, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0x37, 0x4b, 0x0,  0x5,
                   0xbe, 0x49, 0x11, 0xbb, 0x7f, 0x0,  0xb,  0x60, 0xe,  0x84, 0x8b, 0x1b, 0xde, 0x57,
                   0xc6, 0x2,  0x62, 0x24, 0x0,  0x1a, 0x6a, 0xe1, 0x4c, 0x25, 0x16, 0x3a, 0x52, 0x90,
                   0x8f, 0xf4, 0xc9, 0x46, 0x5a, 0x63, 0x65, 0x9a, 0xe,  0x5b, 0x11, 0xb7, 0xcd, 0xc5,
                   0x86, 0x4a, 0x2c, 0xb8, 0x0,  0x8,  0xe1, 0xcb, 0x6d, 0x49, 0x42, 0x94, 0x93, 0x73};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x60, 0xe, 0x84, 0x8b, 0x1b, 0xde, 0x57, 0xc6, 0x2, 0x62, 0x24};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6a, 0xe1, 0x4c, 0x25, 0x16, 0x3a, 0x52, 0x90, 0x8f, 0xf4, 0xc9, 0x46, 0x5a,
                                  0x63, 0x65, 0x9a, 0xe,  0x5b, 0x11, 0xb7, 0xcd, 0xc5, 0x86, 0x4a, 0x2c, 0xb8};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14155;
  uint8_t client_id_bytes[] = {0xbe, 0x49, 0x11, 0xbb, 0x7f};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe1, 0xcb, 0x6d, 0x49, 0x42, 0x94, 0x93, 0x73};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\bA\DC1\DEL\213g\EMC\130^", _password = Just
// "\188\164\213\\P1\226\188\191\201\185\135\150z\216\157\DC4", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\171C0\171", _willMsg =
// "6\164j\195\226\206\EOT\186\FS?\207\245\154\164\223jR\224#2sJ\165N\145#H\196\159\146", _willProps = []}),
// _cleanSession = True, _keepAlive = 29647, _connID = "\176\248\150\&5VEy\GS\DC1kSt(`\136\SUB\233\233\156\174\213",
// _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x66, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x73, 0xcf, 0x0,  0x15, 0xb0,
                   0xf8, 0x96, 0x35, 0x56, 0x45, 0x79, 0x1d, 0x11, 0x6b, 0x53, 0x74, 0x28, 0x60, 0x88, 0x1a,
                   0xe9, 0xe9, 0x9c, 0xae, 0xd5, 0x0,  0x4,  0xab, 0x43, 0x30, 0xab, 0x0,  0x1e, 0x36, 0xa4,
                   0x6a, 0xc3, 0xe2, 0xce, 0x4,  0xba, 0x1c, 0x3f, 0xcf, 0xf5, 0x9a, 0xa4, 0xdf, 0x6a, 0x52,
                   0xe0, 0x23, 0x32, 0x73, 0x4a, 0xa5, 0x4e, 0x91, 0x23, 0x48, 0xc4, 0x9f, 0x92, 0x0,  0xa,
                   0x8,  0x41, 0x11, 0x7f, 0xd5, 0x67, 0x19, 0x43, 0x82, 0x5e, 0x0,  0x11, 0xbc, 0xa4, 0xd5,
                   0x5c, 0x50, 0x31, 0xe2, 0xbc, 0xbf, 0xc9, 0xb9, 0x87, 0x96, 0x7a, 0xd8, 0x9d, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xab, 0x43, 0x30, 0xab};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x36, 0xa4, 0x6a, 0xc3, 0xe2, 0xce, 0x4,  0xba, 0x1c, 0x3f,
                                  0xcf, 0xf5, 0x9a, 0xa4, 0xdf, 0x6a, 0x52, 0xe0, 0x23, 0x32,
                                  0x73, 0x4a, 0xa5, 0x4e, 0x91, 0x23, 0x48, 0xc4, 0x9f, 0x92};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29647;
  uint8_t client_id_bytes[] = {0xb0, 0xf8, 0x96, 0x35, 0x56, 0x45, 0x79, 0x1d, 0x11, 0x6b, 0x53,
                               0x74, 0x28, 0x60, 0x88, 0x1a, 0xe9, 0xe9, 0x9c, 0xae, 0xd5};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8, 0x41, 0x11, 0x7f, 0xd5, 0x67, 0x19, 0x43, 0x82, 0x5e};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbc, 0xa4, 0xd5, 0x5c, 0x50, 0x31, 0xe2, 0xbc, 0xbf,
                              0xc9, 0xb9, 0x87, 0x96, 0x7a, 0xd8, 0x9d, 0x14};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\240\ETX\187\240'\219\214:\CANw", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\137\169\150c", _willMsg = "\189", _willProps = []}),
// _cleanSession = False, _keepAlive = 19444, _connID = "\151\173\128\254\189>\225\168\184@\169\179", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x2d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8c, 0x4b, 0xf4, 0x0,  0xc,  0x97, 0xad,
                   0x80, 0xfe, 0xbd, 0x3e, 0xe1, 0xa8, 0xb8, 0x40, 0xa9, 0xb3, 0x0,  0x4,  0x89, 0xa9, 0x96, 0x63,
                   0x0,  0x1,  0xbd, 0x0,  0xa,  0xf0, 0x3,  0xbb, 0xf0, 0x27, 0xdb, 0xd6, 0x3a, 0x18, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x89, 0xa9, 0x96, 0x63};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19444;
  uint8_t client_id_bytes[] = {0x97, 0xad, 0x80, 0xfe, 0xbd, 0x3e, 0xe1, 0xa8, 0xb8, 0x40, 0xa9, 0xb3};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf0, 0x3, 0xbb, 0xf0, 0x27, 0xdb, 0xd6, 0x3a, 0x18, 0x77};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167 \167\208\233f\167\246'\240T\252\&3!", _password = Just
// "\204ptBG\160\v\SUB\223!\EM\SI\STX\b\DEL+1Z", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2,
// _willTopic = "\186To9\139\230@\227W\SUB\173\175\253\165\SI\195\133i\DC4\ESC\229\DC2=z\251\186\231", _willMsg =
// "rXO\rA\ESC\fQ\DC2\152\SO\ETB{\248\203\197%\175\203\235\227", _willProps = []}), _cleanSession = False, _keepAlive =
// 21475, _connID = "\130", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x65, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x53, 0xe3, 0x0,  0x1,  0x82,
                   0x0,  0x1b, 0xba, 0x54, 0x6f, 0x39, 0x8b, 0xe6, 0x40, 0xe3, 0x57, 0x1a, 0xad, 0xaf, 0xfd,
                   0xa5, 0xf,  0xc3, 0x85, 0x69, 0x14, 0x1b, 0xe5, 0x12, 0x3d, 0x7a, 0xfb, 0xba, 0xe7, 0x0,
                   0x15, 0x72, 0x58, 0x4f, 0xd,  0x41, 0x1b, 0xc,  0x51, 0x12, 0x98, 0xe,  0x17, 0x7b, 0xf8,
                   0xcb, 0xc5, 0x25, 0xaf, 0xcb, 0xeb, 0xe3, 0x0,  0xe,  0xa7, 0x20, 0xa7, 0xd0, 0xe9, 0x66,
                   0xa7, 0xf6, 0x27, 0xf0, 0x54, 0xfc, 0x33, 0x21, 0x0,  0x12, 0xcc, 0x70, 0x74, 0x42, 0x47,
                   0xa0, 0xb,  0x1a, 0xdf, 0x21, 0x19, 0xf,  0x2,  0x8,  0x7f, 0x2b, 0x31, 0x5a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xba, 0x54, 0x6f, 0x39, 0x8b, 0xe6, 0x40, 0xe3, 0x57, 0x1a, 0xad, 0xaf, 0xfd, 0xa5,
                                0xf,  0xc3, 0x85, 0x69, 0x14, 0x1b, 0xe5, 0x12, 0x3d, 0x7a, 0xfb, 0xba, 0xe7};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x72, 0x58, 0x4f, 0xd,  0x41, 0x1b, 0xc,  0x51, 0x12, 0x98, 0xe,
                                  0x17, 0x7b, 0xf8, 0xcb, 0xc5, 0x25, 0xaf, 0xcb, 0xeb, 0xe3};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21475;
  uint8_t client_id_bytes[] = {0x82};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0x20, 0xa7, 0xd0, 0xe9, 0x66, 0xa7, 0xf6, 0x27, 0xf0, 0x54, 0xfc, 0x33, 0x21};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcc, 0x70, 0x74, 0x42, 0x47, 0xa0, 0xb,  0x1a, 0xdf,
                              0x21, 0x19, 0xf,  0x2,  0x8,  0x7f, 0x2b, 0x31, 0x5a};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "4\244\&1\217\142\&8\NAK5", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "e;\194\&7\237P\201 w\216\149l\171W\RS\241>\135`\SYN\ENQ\197\t",
// _willMsg = "2\174", _willProps = []}), _cleanSession = True, _keepAlive = 29263, _connID =
// "\173Q\DC4\163\185\129\144\238\155\169Q\252K\131\227\&9\CAN\v\239", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x3c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x72, 0x4f, 0x0,  0x13, 0xad, 0x51,
                   0x14, 0xa3, 0xb9, 0x81, 0x90, 0xee, 0x9b, 0xa9, 0x51, 0xfc, 0x4b, 0x83, 0xe3, 0x39, 0x18, 0xb,
                   0xef, 0x0,  0x17, 0x65, 0x3b, 0xc2, 0x37, 0xed, 0x50, 0xc9, 0x20, 0x77, 0xd8, 0x95, 0x6c, 0xab,
                   0x57, 0x1e, 0xf1, 0x3e, 0x87, 0x60, 0x16, 0x5,  0xc5, 0x9,  0x0,  0x2,  0x32, 0xae};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x65, 0x3b, 0xc2, 0x37, 0xed, 0x50, 0xc9, 0x20, 0x77, 0xd8, 0x95, 0x6c,
                                0xab, 0x57, 0x1e, 0xf1, 0x3e, 0x87, 0x60, 0x16, 0x5,  0xc5, 0x9};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0xae};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29263;
  uint8_t client_id_bytes[] = {0xad, 0x51, 0x14, 0xa3, 0xb9, 0x81, 0x90, 0xee, 0x9b, 0xa9,
                               0x51, 0xfc, 0x4b, 0x83, 0xe3, 0x39, 0x18, 0xb,  0xef};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x34, 0xf4, 0x31, 0xd9, 0x8e, 0x38, 0x15, 0x35};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\199\154\ACK\130\147\145\141\149\SOH", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 26934, _connID = "\185\183=\217", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x10, 0x0,  0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,
                   0x2,  0x69, 0x36, 0x0, 0x4,  0xb9, 0xb7, 0x3d, 0xd9};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26934;
  uint8_t client_id_bytes[] = {0xb9, 0xb7, 0x3d, 0xd9};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc7, 0x9a, 0x6, 0x82, 0x93, 0x91, 0x8d, 0x95, 0x1};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "-\247+\DC1\233}bt\ENQ\200\241\ENQ\SI\v\163F\173\246\236h\217\149Ur\237\DC3\244\208\217\EOT", _password = Just
// "\181\199$\147\180\ETX6\202", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\227\174\130\185\246$4`\SI^`\215\195\238\204OL\188\134\144\164\DLE^-\187\STX\DC4\224\178", _willMsg =
// "\210\221\DC4\SYN\212^\167\212v\131\142\DELq\191\136\237\&6\203\227.\181\SYN\138", _willProps = []}), _cleanSession =
// False, _keepAlive = 20204, _connID = "\140\212\218\244p", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x73, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x4e, 0xec, 0x0,  0x5,  0x8c, 0xd4, 0xda,
                   0xf4, 0x70, 0x0,  0x1d, 0xe3, 0xae, 0x82, 0xb9, 0xf6, 0x24, 0x34, 0x60, 0xf,  0x5e, 0x60, 0xd7, 0xc3,
                   0xee, 0xcc, 0x4f, 0x4c, 0xbc, 0x86, 0x90, 0xa4, 0x10, 0x5e, 0x2d, 0xbb, 0x2,  0x14, 0xe0, 0xb2, 0x0,
                   0x17, 0xd2, 0xdd, 0x14, 0x16, 0xd4, 0x5e, 0xa7, 0xd4, 0x76, 0x83, 0x8e, 0x7f, 0x71, 0xbf, 0x88, 0xed,
                   0x36, 0xcb, 0xe3, 0x2e, 0xb5, 0x16, 0x8a, 0x0,  0x1e, 0x2d, 0xf7, 0x2b, 0x11, 0xe9, 0x7d, 0x62, 0x74,
                   0x5,  0xc8, 0xf1, 0x5,  0xf,  0xb,  0xa3, 0x46, 0xad, 0xf6, 0xec, 0x68, 0xd9, 0x95, 0x55, 0x72, 0xed,
                   0x13, 0xf4, 0xd0, 0xd9, 0x4,  0x0,  0x8,  0xb5, 0xc7, 0x24, 0x93, 0xb4, 0x3,  0x36, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xae, 0x82, 0xb9, 0xf6, 0x24, 0x34, 0x60, 0xf,  0x5e,
                                0x60, 0xd7, 0xc3, 0xee, 0xcc, 0x4f, 0x4c, 0xbc, 0x86, 0x90,
                                0xa4, 0x10, 0x5e, 0x2d, 0xbb, 0x2,  0x14, 0xe0, 0xb2};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd2, 0xdd, 0x14, 0x16, 0xd4, 0x5e, 0xa7, 0xd4, 0x76, 0x83, 0x8e, 0x7f,
                                  0x71, 0xbf, 0x88, 0xed, 0x36, 0xcb, 0xe3, 0x2e, 0xb5, 0x16, 0x8a};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20204;
  uint8_t client_id_bytes[] = {0x8c, 0xd4, 0xda, 0xf4, 0x70};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0xf7, 0x2b, 0x11, 0xe9, 0x7d, 0x62, 0x74, 0x5,  0xc8, 0xf1, 0x5,  0xf,  0xb,  0xa3,
                              0x46, 0xad, 0xf6, 0xec, 0x68, 0xd9, 0x95, 0x55, 0x72, 0xed, 0x13, 0xf4, 0xd0, 0xd9, 0x4};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb5, 0xc7, 0x24, 0x93, 0xb4, 0x3, 0x36, 0xca};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "r=\231\144i:\207\214h\149\199\202J", _password = Just "2\202\ACK*\135", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "rx&4\204G@rz\177>", _willMsg = "\237\222\176\197",
// _willProps = []}), _cleanSession = False, _keepAlive = 11274, _connID =
// "\223\t\143\166\173\230\156\142\250\&1\248\EOT\185\ACK\235\144\155+\249\150\182\136\232\133\206", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x2c, 0xa,  0x0,  0x19, 0xdf, 0x9,
                   0x8f, 0xa6, 0xad, 0xe6, 0x9c, 0x8e, 0xfa, 0x31, 0xf8, 0x4,  0xb9, 0x6,  0xeb, 0x90, 0x9b, 0x2b,
                   0xf9, 0x96, 0xb6, 0x88, 0xe8, 0x85, 0xce, 0x0,  0xb,  0x72, 0x78, 0x26, 0x34, 0xcc, 0x47, 0x40,
                   0x72, 0x7a, 0xb1, 0x3e, 0x0,  0x4,  0xed, 0xde, 0xb0, 0xc5, 0x0,  0xd,  0x72, 0x3d, 0xe7, 0x90,
                   0x69, 0x3a, 0xcf, 0xd6, 0x68, 0x95, 0xc7, 0xca, 0x4a, 0x0,  0x5,  0x32, 0xca, 0x6,  0x2a, 0x87};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x72, 0x78, 0x26, 0x34, 0xcc, 0x47, 0x40, 0x72, 0x7a, 0xb1, 0x3e};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xed, 0xde, 0xb0, 0xc5};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11274;
  uint8_t client_id_bytes[] = {0xdf, 0x9,  0x8f, 0xa6, 0xad, 0xe6, 0x9c, 0x8e, 0xfa, 0x31, 0xf8, 0x4, 0xb9,
                               0x6,  0xeb, 0x90, 0x9b, 0x2b, 0xf9, 0x96, 0xb6, 0x88, 0xe8, 0x85, 0xce};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x72, 0x3d, 0xe7, 0x90, 0x69, 0x3a, 0xcf, 0xd6, 0x68, 0x95, 0xc7, 0xca, 0x4a};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x32, 0xca, 0x6, 0x2a, 0x87};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "#Q\186\\\192N\NUL\ETB\159\205\a\194`T\211\EM\157\133\ACKf;Z\189\220\129\164", _willMsg =
// "\EOT\228!\252NLON\246\199\210g\235\225\255\130\139\v ", _willProps = []}), _cleanSession = True, _keepAlive = 13058,
// _connID = ".d\DC4\204\250e\224\180\140\158\RS3)G\143\172\SOST\ETBEX", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x33, 0x2,  0x0,  0x16, 0x2e,
                   0x64, 0x14, 0xcc, 0xfa, 0x65, 0xe0, 0xb4, 0x8c, 0x9e, 0x1e, 0x33, 0x29, 0x47, 0x8f, 0xac,
                   0xe,  0x53, 0x54, 0x17, 0x45, 0x58, 0x0,  0x1a, 0x23, 0x51, 0xba, 0x5c, 0xc0, 0x4e, 0x0,
                   0x17, 0x9f, 0xcd, 0x7,  0xc2, 0x60, 0x54, 0xd3, 0x19, 0x9d, 0x85, 0x6,  0x66, 0x3b, 0x5a,
                   0xbd, 0xdc, 0x81, 0xa4, 0x0,  0x13, 0x4,  0xe4, 0x21, 0xfc, 0x4e, 0x4c, 0x4f, 0x4e, 0xf6,
                   0xc7, 0xd2, 0x67, 0xeb, 0xe1, 0xff, 0x82, 0x8b, 0xb,  0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x23, 0x51, 0xba, 0x5c, 0xc0, 0x4e, 0x0,  0x17, 0x9f, 0xcd, 0x7,  0xc2, 0x60,
                                0x54, 0xd3, 0x19, 0x9d, 0x85, 0x6,  0x66, 0x3b, 0x5a, 0xbd, 0xdc, 0x81, 0xa4};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4,  0xe4, 0x21, 0xfc, 0x4e, 0x4c, 0x4f, 0x4e, 0xf6, 0xc7,
                                  0xd2, 0x67, 0xeb, 0xe1, 0xff, 0x82, 0x8b, 0xb,  0x20};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13058;
  uint8_t client_id_bytes[] = {0x2e, 0x64, 0x14, 0xcc, 0xfa, 0x65, 0xe0, 0xb4, 0x8c, 0x9e, 0x1e,
                               0x33, 0x29, 0x47, 0x8f, 0xac, 0xe,  0x53, 0x54, 0x17, 0x45, 0x58};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "-\157\STX\167\DC4\171\157t", _password = Just "/j-", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 2165, _connID = ";l\192\DC1N\156z\170\170\165[\f", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x27, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x8,  0x75, 0x0, 0xc,
                   0x3b, 0x6c, 0xc0, 0x11, 0x4e, 0x9c, 0x7a, 0xaa, 0xaa, 0xa5, 0x5b, 0xc,  0x0, 0x8,
                   0x2d, 0x9d, 0x2,  0xa7, 0x14, 0xab, 0x9d, 0x74, 0x0,  0x3,  0x2f, 0x6a, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2165;
  uint8_t client_id_bytes[] = {0x3b, 0x6c, 0xc0, 0x11, 0x4e, 0x9c, 0x7a, 0xaa, 0xaa, 0xa5, 0x5b, 0xc};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0x9d, 0x2, 0xa7, 0x14, 0xab, 0x9d, 0x74};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0x6a, 0x2d};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "^a,Y\US\230/\202\240\t\229\218\191\SUBdl", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\170", _willMsg =
// "@d\157b\SYN\150\&0\164\ENQ\236O\149e\129\218\210wSKU\DC4y\SOH\188\163m\EOT", _willProps = []}), _cleanSession =
// True, _keepAlive = 10569, _connID = "\185Xg$ZH\152\132 !", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x36, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x29, 0x49, 0x0,  0xa,
                   0xb9, 0x58, 0x67, 0x24, 0x5a, 0x48, 0x98, 0x84, 0x20, 0x21, 0x0,  0x1,  0xaa, 0x0,
                   0x1b, 0x40, 0x64, 0x9d, 0x62, 0x16, 0x96, 0x30, 0xa4, 0x5,  0xec, 0x4f, 0x95, 0x65,
                   0x81, 0xda, 0xd2, 0x77, 0x53, 0x4b, 0x55, 0x14, 0x79, 0x1,  0xbc, 0xa3, 0x6d, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xaa};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x64, 0x9d, 0x62, 0x16, 0x96, 0x30, 0xa4, 0x5, 0xec, 0x4f, 0x95, 0x65, 0x81,
                                  0xda, 0xd2, 0x77, 0x53, 0x4b, 0x55, 0x14, 0x79, 0x1, 0xbc, 0xa3, 0x6d, 0x4};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10569;
  uint8_t client_id_bytes[] = {0xb9, 0x58, 0x67, 0x24, 0x5a, 0x48, 0x98, 0x84, 0x20, 0x21};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5e, 0x61, 0x2c, 0x59, 0x1f, 0xe6, 0x2f, 0xca,
                              0xf0, 0x9,  0xe5, 0xda, 0xbf, 0x1a, 0x64, 0x6c};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\251\140\165-\247FkO\242Y\DC2\f\236\DC2\223pL\DC1+\246\255", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 692, _connID =
// "h\254\SUB\167\243\223\&6e\ACK\209\169\208{K\152\224:\222\217Se]1", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x2,  0xb4, 0x0,  0x17, 0x68,
                   0xfe, 0x1a, 0xa7, 0xf3, 0xdf, 0x36, 0x65, 0x6,  0xd1, 0xa9, 0xd0, 0x7b, 0x4b, 0x98, 0xe0,
                   0x3a, 0xde, 0xd9, 0x53, 0x65, 0x5d, 0x31, 0x0,  0x15, 0xfb, 0x8c, 0xa5, 0x2d, 0xf7, 0x46,
                   0x6b, 0x4f, 0xf2, 0x59, 0x12, 0xc,  0xec, 0x12, 0xdf, 0x70, 0x4c, 0x11, 0x2b, 0xf6, 0xff};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 692;
  uint8_t client_id_bytes[] = {0x68, 0xfe, 0x1a, 0xa7, 0xf3, 0xdf, 0x36, 0x65, 0x6,  0xd1, 0xa9, 0xd0,
                               0x7b, 0x4b, 0x98, 0xe0, 0x3a, 0xde, 0xd9, 0x53, 0x65, 0x5d, 0x31};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfb, 0x8c, 0xa5, 0x2d, 0xf7, 0x46, 0x6b, 0x4f, 0xf2, 0x59, 0x12,
                              0xc,  0xec, 0x12, 0xdf, 0x70, 0x4c, 0x11, 0x2b, 0xf6, 0xff};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "NZ\205t\136\"\192\172", _password = Just ";", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic =
// "I\178\221P\DC2\179\161\234\145\EOT-\160eY\DEL'\191\250\&5|\172\EOT\240", _willMsg =
// "D]Y\226\&7\ESC\249\US8w\142\212z\211\143@\168d\NUL\149\STX\220e2", _willProps = []}), _cleanSession = False,
// _keepAlive = 2830, _connID = "\244\148g", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0xb,  0xe,  0x0,  0x3,  0xf4, 0x94, 0x67,
                   0x0,  0x17, 0x49, 0xb2, 0xdd, 0x50, 0x12, 0xb3, 0xa1, 0xea, 0x91, 0x4,  0x2d, 0xa0, 0x65, 0x59, 0x7f,
                   0x27, 0xbf, 0xfa, 0x35, 0x7c, 0xac, 0x4,  0xf0, 0x0,  0x18, 0x44, 0x5d, 0x59, 0xe2, 0x37, 0x1b, 0xf9,
                   0x1f, 0x38, 0x77, 0x8e, 0xd4, 0x7a, 0xd3, 0x8f, 0x40, 0xa8, 0x64, 0x0,  0x95, 0x2,  0xdc, 0x65, 0x32,
                   0x0,  0x8,  0x4e, 0x5a, 0xcd, 0x74, 0x88, 0x22, 0xc0, 0xac, 0x0,  0x1,  0x3b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x49, 0xb2, 0xdd, 0x50, 0x12, 0xb3, 0xa1, 0xea, 0x91, 0x4, 0x2d, 0xa0,
                                0x65, 0x59, 0x7f, 0x27, 0xbf, 0xfa, 0x35, 0x7c, 0xac, 0x4, 0xf0};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0x5d, 0x59, 0xe2, 0x37, 0x1b, 0xf9, 0x1f, 0x38, 0x77, 0x8e, 0xd4,
                                  0x7a, 0xd3, 0x8f, 0x40, 0xa8, 0x64, 0x0,  0x95, 0x2,  0xdc, 0x65, 0x32};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2830;
  uint8_t client_id_bytes[] = {0xf4, 0x94, 0x67};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4e, 0x5a, 0xcd, 0x74, 0x88, 0x22, 0xc0, 0xac};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3b};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218\&6%\STX(5i0\189a\150\ENQ\229YH,0&^\167\f\254\209k", _password = Just
// "\202)\161\202\205\170z\SI\230\241\175\142\208\213\245\142]dM\EM\231\155\244", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\139\152\193\DC2\171\179\224m\168J\129\237\153t\SOH\ENQ\244G\203\EOT\US}\221\162", _willMsg =
// "\DLE\135\NAK^\193va\DC4\252\141-\RS", _willProps = []}), _cleanSession = True, _keepAlive = 11916, _connID =
// "z\209/\DEL\213B\229\RS\240B\238", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x72, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x2e, 0x8c, 0x0,  0xb,  0x7a, 0xd1, 0x2f,
                   0x7f, 0xd5, 0x42, 0xe5, 0x1e, 0xf0, 0x42, 0xee, 0x0,  0x18, 0x8b, 0x98, 0xc1, 0x12, 0xab, 0xb3, 0xe0,
                   0x6d, 0xa8, 0x4a, 0x81, 0xed, 0x99, 0x74, 0x1,  0x5,  0xf4, 0x47, 0xcb, 0x4,  0x1f, 0x7d, 0xdd, 0xa2,
                   0x0,  0xc,  0x10, 0x87, 0x15, 0x5e, 0xc1, 0x76, 0x61, 0x14, 0xfc, 0x8d, 0x2d, 0x1e, 0x0,  0x18, 0xda,
                   0x36, 0x25, 0x2,  0x28, 0x35, 0x69, 0x30, 0xbd, 0x61, 0x96, 0x5,  0xe5, 0x59, 0x48, 0x2c, 0x30, 0x26,
                   0x5e, 0xa7, 0xc,  0xfe, 0xd1, 0x6b, 0x0,  0x17, 0xca, 0x29, 0xa1, 0xca, 0xcd, 0xaa, 0x7a, 0xf,  0xe6,
                   0xf1, 0xaf, 0x8e, 0xd0, 0xd5, 0xf5, 0x8e, 0x5d, 0x64, 0x4d, 0x19, 0xe7, 0x9b, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8b, 0x98, 0xc1, 0x12, 0xab, 0xb3, 0xe0, 0x6d, 0xa8, 0x4a, 0x81, 0xed,
                                0x99, 0x74, 0x1,  0x5,  0xf4, 0x47, 0xcb, 0x4,  0x1f, 0x7d, 0xdd, 0xa2};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x10, 0x87, 0x15, 0x5e, 0xc1, 0x76, 0x61, 0x14, 0xfc, 0x8d, 0x2d, 0x1e};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11916;
  uint8_t client_id_bytes[] = {0x7a, 0xd1, 0x2f, 0x7f, 0xd5, 0x42, 0xe5, 0x1e, 0xf0, 0x42, 0xee};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda, 0x36, 0x25, 0x2,  0x28, 0x35, 0x69, 0x30, 0xbd, 0x61, 0x96, 0x5,
                              0xe5, 0x59, 0x48, 0x2c, 0x30, 0x26, 0x5e, 0xa7, 0xc,  0xfe, 0xd1, 0x6b};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xca, 0x29, 0xa1, 0xca, 0xcd, 0xaa, 0x7a, 0xf,  0xe6, 0xf1, 0xaf, 0x8e,
                              0xd0, 0xd5, 0xf5, 0x8e, 0x5d, 0x64, 0x4d, 0x19, 0xe7, 0x9b, 0xf4};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\143y\166C\221w?;4\243\179\248z\136\a\221\DC3\228\DC1\156,\131\183sM\171&y", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic = "\226", _willMsg = "\240\178+p\166\192", _willProps = []}), _cleanSession =
// False, _keepAlive = 29711, _connID = "x2\200o\132\250", _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x1d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4, 0x14, 0x74, 0xf,  0x0,  0x6,  0x78, 0x32,
                   0xc8, 0x6f, 0x84, 0xfa, 0x0,  0x1,  0xe2, 0x0,  0x6, 0xf0, 0xb2, 0x2b, 0x70, 0xa6, 0xc0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0xb2, 0x2b, 0x70, 0xa6, 0xc0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29711;
  uint8_t client_id_bytes[] = {0x78, 0x32, 0xc8, 0x6f, 0x84, 0xfa};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x8f, 0x79, 0xa6, 0x43, 0xdd, 0x77, 0x3f, 0x3b, 0x34, 0xf3, 0xb3, 0xf8, 0x7a, 0x88,
                              0x7,  0xdd, 0x13, 0xe4, 0x11, 0x9c, 0x2c, 0x83, 0xb7, 0x73, 0x4d, 0xab, 0x26, 0x79};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\157\244\252!\no\225e", _password = Just
// "\203+\193\206\143\177\CAN\NUL\b\229\143p\249\aoT\130\140\199\197\139\130", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\188$&\229\204\146\186\244p\ACK\165dC\198G", _willMsg =
// ",n\136+E\195\136_K\222\148\132s\141{\231", _willProps = []}), _cleanSession = True, _keepAlive = 25534, _connID =
// "t\177\139,\191\139t\244\NAK\f\140!G\131k\141", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x61, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x63, 0xbe, 0x0,  0x10, 0x74, 0xb1, 0x8b,
                   0x2c, 0xbf, 0x8b, 0x74, 0xf4, 0x15, 0xc,  0x8c, 0x21, 0x47, 0x83, 0x6b, 0x8d, 0x0,  0xf,  0xbc, 0x24,
                   0x26, 0xe5, 0xcc, 0x92, 0xba, 0xf4, 0x70, 0x6,  0xa5, 0x64, 0x43, 0xc6, 0x47, 0x0,  0x10, 0x2c, 0x6e,
                   0x88, 0x2b, 0x45, 0xc3, 0x88, 0x5f, 0x4b, 0xde, 0x94, 0x84, 0x73, 0x8d, 0x7b, 0xe7, 0x0,  0x8,  0x9d,
                   0xf4, 0xfc, 0x21, 0xa,  0x6f, 0xe1, 0x65, 0x0,  0x16, 0xcb, 0x2b, 0xc1, 0xce, 0x8f, 0xb1, 0x18, 0x0,
                   0x8,  0xe5, 0x8f, 0x70, 0xf9, 0x7,  0x6f, 0x54, 0x82, 0x8c, 0xc7, 0xc5, 0x8b, 0x82};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbc, 0x24, 0x26, 0xe5, 0xcc, 0x92, 0xba, 0xf4,
                                0x70, 0x6,  0xa5, 0x64, 0x43, 0xc6, 0x47};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2c, 0x6e, 0x88, 0x2b, 0x45, 0xc3, 0x88, 0x5f,
                                  0x4b, 0xde, 0x94, 0x84, 0x73, 0x8d, 0x7b, 0xe7};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25534;
  uint8_t client_id_bytes[] = {0x74, 0xb1, 0x8b, 0x2c, 0xbf, 0x8b, 0x74, 0xf4,
                               0x15, 0xc,  0x8c, 0x21, 0x47, 0x83, 0x6b, 0x8d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9d, 0xf4, 0xfc, 0x21, 0xa, 0x6f, 0xe1, 0x65};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0x2b, 0xc1, 0xce, 0x8f, 0xb1, 0x18, 0x0,  0x8,  0xe5, 0x8f,
                              0x70, 0xf9, 0x7,  0x6f, 0x54, 0x82, 0x8c, 0xc7, 0xc5, 0x8b, 0x82};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\DC2K\SOH\205\130\243\197\138\251g", _password = Just
// "\203\162\176\223n\163\159\204\NAK\t+\212", _lastWill = Nothing, _cleanSession = True, _keepAlive = 31053, _connID =
// "X\134\206\232\134\243\221\DC1\252", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x79, 0x4d, 0x0,  0x9,  0x58, 0x86, 0xce,
                   0xe8, 0x86, 0xf3, 0xdd, 0x11, 0xfc, 0x0,  0xa,  0x12, 0x4b, 0x1,  0xcd, 0x82, 0xf3, 0xc5, 0x8a, 0xfb,
                   0x67, 0x0,  0xc,  0xcb, 0xa2, 0xb0, 0xdf, 0x6e, 0xa3, 0x9f, 0xcc, 0x15, 0x9,  0x2b, 0xd4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31053;
  uint8_t client_id_bytes[] = {0x58, 0x86, 0xce, 0xe8, 0x86, 0xf3, 0xdd, 0x11, 0xfc};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x12, 0x4b, 0x1, 0xcd, 0x82, 0xf3, 0xc5, 0x8a, 0xfb, 0x67};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0xa2, 0xb0, 0xdf, 0x6e, 0xa3, 0x9f, 0xcc, 0x15, 0x9, 0x2b, 0xd4};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SI\249\217\245+\148\214W4\194\166\EM\248\229\173\221\207!\207", _password = Just
// "\162\230\187s\155\185\166\184\194\DLE6", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic
// = "\NAK6\214\US\166`\243!\147\STX\254$x\152\221|]V\DC2\132\180{E#\STX|.\209\244", _willMsg =
// "\200\238p[\209Nf\186\211\186\213\164\&0\t\223\176", _willProps = []}), _cleanSession = True, _keepAlive = 12605,
// _connID = "\132\135\132`\t\238\191\184 \SOH\162", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x6a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x31, 0x3d, 0x0,  0xb,  0x84, 0x87,
                   0x84, 0x60, 0x9,  0xee, 0xbf, 0xb8, 0x20, 0x1,  0xa2, 0x0,  0x1d, 0x15, 0x36, 0xd6, 0x1f, 0xa6,
                   0x60, 0xf3, 0x21, 0x93, 0x2,  0xfe, 0x24, 0x78, 0x98, 0xdd, 0x7c, 0x5d, 0x56, 0x12, 0x84, 0xb4,
                   0x7b, 0x45, 0x23, 0x2,  0x7c, 0x2e, 0xd1, 0xf4, 0x0,  0x10, 0xc8, 0xee, 0x70, 0x5b, 0xd1, 0x4e,
                   0x66, 0xba, 0xd3, 0xba, 0xd5, 0xa4, 0x30, 0x9,  0xdf, 0xb0, 0x0,  0x13, 0xf,  0xf9, 0xd9, 0xf5,
                   0x2b, 0x94, 0xd6, 0x57, 0x34, 0xc2, 0xa6, 0x19, 0xf8, 0xe5, 0xad, 0xdd, 0xcf, 0x21, 0xcf, 0x0,
                   0xb,  0xa2, 0xe6, 0xbb, 0x73, 0x9b, 0xb9, 0xa6, 0xb8, 0xc2, 0x10, 0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0x36, 0xd6, 0x1f, 0xa6, 0x60, 0xf3, 0x21, 0x93, 0x2, 0xfe, 0x24, 0x78, 0x98, 0xdd,
                                0x7c, 0x5d, 0x56, 0x12, 0x84, 0xb4, 0x7b, 0x45, 0x23, 0x2, 0x7c, 0x2e, 0xd1, 0xf4};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc8, 0xee, 0x70, 0x5b, 0xd1, 0x4e, 0x66, 0xba,
                                  0xd3, 0xba, 0xd5, 0xa4, 0x30, 0x9,  0xdf, 0xb0};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12605;
  uint8_t client_id_bytes[] = {0x84, 0x87, 0x84, 0x60, 0x9, 0xee, 0xbf, 0xb8, 0x20, 0x1, 0xa2};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf,  0xf9, 0xd9, 0xf5, 0x2b, 0x94, 0xd6, 0x57, 0x34, 0xc2,
                              0xa6, 0x19, 0xf8, 0xe5, 0xad, 0xdd, 0xcf, 0x21, 0xcf};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa2, 0xe6, 0xbb, 0x73, 0x9b, 0xb9, 0xa6, 0xb8, 0xc2, 0x10, 0x36};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\222\FS\NUL", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\236?v#\231\182\221\157[=\139|\191\209\208\147\164?\221=)\ETB?\217\223e", _willMsg =
// "n\212", _willProps = []}), _cleanSession = False, _keepAlive = 12313, _connID = "%W\235
// )\183\218\188oO\152j\237\b!", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x30, 0x19, 0x0,  0xf,  0x25, 0x57, 0xeb,
                   0x20, 0x29, 0xb7, 0xda, 0xbc, 0x6f, 0x4f, 0x98, 0x6a, 0xed, 0x8,  0x21, 0x0,  0x1a, 0xec, 0x3f, 0x76,
                   0x23, 0xe7, 0xb6, 0xdd, 0x9d, 0x5b, 0x3d, 0x8b, 0x7c, 0xbf, 0xd1, 0xd0, 0x93, 0xa4, 0x3f, 0xdd, 0x3d,
                   0x29, 0x17, 0x3f, 0xd9, 0xdf, 0x65, 0x0,  0x2,  0x6e, 0xd4, 0x0,  0x3,  0xde, 0x1c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xec, 0x3f, 0x76, 0x23, 0xe7, 0xb6, 0xdd, 0x9d, 0x5b, 0x3d, 0x8b, 0x7c, 0xbf,
                                0xd1, 0xd0, 0x93, 0xa4, 0x3f, 0xdd, 0x3d, 0x29, 0x17, 0x3f, 0xd9, 0xdf, 0x65};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6e, 0xd4};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12313;
  uint8_t client_id_bytes[] = {0x25, 0x57, 0xeb, 0x20, 0x29, 0xb7, 0xda, 0xbc, 0x6f, 0x4f, 0x98, 0x6a, 0xed, 0x8, 0x21};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xde, 0x1c, 0x0};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\ENQ\177\248\150\234\US\132\246q", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\183\FS\DC1\132\182jmFH\GS\201\141\226\&3\n", _willMsg =
// "\134\204\FS{\151\206b\190e\177\149\v\146\182\240\197\189NN\183\242\207\\BM\fs\198H", _willProps = []}),
// _cleanSession = True, _keepAlive = 13514, _connID = "\161 \149\244\226\242\217\139I
// p\234\"\249\DLE\216>p\SOV\CAN\207\131", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x34, 0xca, 0x0,  0x17, 0xa1,
                   0x20, 0x95, 0xf4, 0xe2, 0xf2, 0xd9, 0x8b, 0x49, 0x20, 0x70, 0xea, 0x22, 0xf9, 0x10, 0xd8,
                   0x3e, 0x70, 0xe,  0x56, 0x18, 0xcf, 0x83, 0x0,  0xf,  0xb7, 0x1c, 0x11, 0x84, 0xb6, 0x6a,
                   0x6d, 0x46, 0x48, 0x1d, 0xc9, 0x8d, 0xe2, 0x33, 0xa,  0x0,  0x1d, 0x86, 0xcc, 0x1c, 0x7b,
                   0x97, 0xce, 0x62, 0xbe, 0x65, 0xb1, 0x95, 0xb,  0x92, 0xb6, 0xf0, 0xc5, 0xbd, 0x4e, 0x4e,
                   0xb7, 0xf2, 0xcf, 0x5c, 0x42, 0x4d, 0xc,  0x73, 0xc6, 0x48};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb7, 0x1c, 0x11, 0x84, 0xb6, 0x6a, 0x6d, 0x46,
                                0x48, 0x1d, 0xc9, 0x8d, 0xe2, 0x33, 0xa};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x86, 0xcc, 0x1c, 0x7b, 0x97, 0xce, 0x62, 0xbe, 0x65, 0xb1,
                                  0x95, 0xb,  0x92, 0xb6, 0xf0, 0xc5, 0xbd, 0x4e, 0x4e, 0xb7,
                                  0xf2, 0xcf, 0x5c, 0x42, 0x4d, 0xc,  0x73, 0xc6, 0x48};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13514;
  uint8_t client_id_bytes[] = {0xa1, 0x20, 0x95, 0xf4, 0xe2, 0xf2, 0xd9, 0x8b, 0x49, 0x20, 0x70, 0xea,
                               0x22, 0xf9, 0x10, 0xd8, 0x3e, 0x70, 0xe,  0x56, 0x18, 0xcf, 0x83};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5, 0xb1, 0xf8, 0x96, 0xea, 0x1f, 0x84, 0xf6, 0x71};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218r\168\139R\217\209\a@\135\239\135\152\130\140\156\230\152>\156\160", _password
// = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\220\218\137\179z\158\vc\CAN\128\SUBU\DC3\175n\201P\218B", _willMsg =
// "\218\174\233=\151\&7\204\204\181\t\146\180O\189\173.`\244\151\180I@0\252", _willProps = []}), _cleanSession = True,
// _keepAlive = 5227, _connID = "_\201\&2\202<\161\171\209\244\241\165", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xae, 0x14, 0x6b, 0x0,  0xb,  0x5f, 0xc9,
                   0x32, 0xca, 0x3c, 0xa1, 0xab, 0xd1, 0xf4, 0xf1, 0xa5, 0x0,  0x13, 0xdc, 0xda, 0x89, 0xb3, 0x7a,
                   0x9e, 0xb,  0x63, 0x18, 0x80, 0x1a, 0x55, 0x13, 0xaf, 0x6e, 0xc9, 0x50, 0xda, 0x42, 0x0,  0x18,
                   0xda, 0xae, 0xe9, 0x3d, 0x97, 0x37, 0xcc, 0xcc, 0xb5, 0x9,  0x92, 0xb4, 0x4f, 0xbd, 0xad, 0x2e,
                   0x60, 0xf4, 0x97, 0xb4, 0x49, 0x40, 0x30, 0xfc, 0x0,  0x15, 0xda, 0x72, 0xa8, 0x8b, 0x52, 0xd9,
                   0xd1, 0x7,  0x40, 0x87, 0xef, 0x87, 0x98, 0x82, 0x8c, 0x9c, 0xe6, 0x98, 0x3e, 0x9c, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdc, 0xda, 0x89, 0xb3, 0x7a, 0x9e, 0xb,  0x63, 0x18, 0x80,
                                0x1a, 0x55, 0x13, 0xaf, 0x6e, 0xc9, 0x50, 0xda, 0x42};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xae, 0xe9, 0x3d, 0x97, 0x37, 0xcc, 0xcc, 0xb5, 0x9,  0x92, 0xb4,
                                  0x4f, 0xbd, 0xad, 0x2e, 0x60, 0xf4, 0x97, 0xb4, 0x49, 0x40, 0x30, 0xfc};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5227;
  uint8_t client_id_bytes[] = {0x5f, 0xc9, 0x32, 0xca, 0x3c, 0xa1, 0xab, 0xd1, 0xf4, 0xf1, 0xa5};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda, 0x72, 0xa8, 0x8b, 0x52, 0xd9, 0xd1, 0x7,  0x40, 0x87, 0xef,
                              0x87, 0x98, 0x82, 0x8c, 0x9c, 0xe6, 0x98, 0x3e, 0x9c, 0xa0};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SO\"\229\f\229\n\211x\145\nR\255A\196y\255<T[\149\ETX", _password = Just
// "\161'\241\171\&2\"q\170\165\139\233\248\156t\244\158\231\233\134qNC", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "GN\138U(\GS\230\SI+X!Tu\213\190", _willMsg = "-\254\177Q\138W", _willProps =
// []}), _cleanSession = True, _keepAlive = 2566, _connID = "E\SYN}\225:uRG\213%\205w\191zFd\151r\157\ACK\219",
// _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x69, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0xa,  0x6,  0x0,  0x15, 0x45, 0x16,
                   0x7d, 0xe1, 0x3a, 0x75, 0x52, 0x47, 0xd5, 0x25, 0xcd, 0x77, 0xbf, 0x7a, 0x46, 0x64, 0x97, 0x72,
                   0x9d, 0x6,  0xdb, 0x0,  0xf,  0x47, 0x4e, 0x8a, 0x55, 0x28, 0x1d, 0xe6, 0xf,  0x2b, 0x58, 0x21,
                   0x54, 0x75, 0xd5, 0xbe, 0x0,  0x6,  0x2d, 0xfe, 0xb1, 0x51, 0x8a, 0x57, 0x0,  0x15, 0xe,  0x22,
                   0xe5, 0xc,  0xe5, 0xa,  0xd3, 0x78, 0x91, 0xa,  0x52, 0xff, 0x41, 0xc4, 0x79, 0xff, 0x3c, 0x54,
                   0x5b, 0x95, 0x3,  0x0,  0x16, 0xa1, 0x27, 0xf1, 0xab, 0x32, 0x22, 0x71, 0xaa, 0xa5, 0x8b, 0xe9,
                   0xf8, 0x9c, 0x74, 0xf4, 0x9e, 0xe7, 0xe9, 0x86, 0x71, 0x4e, 0x43};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x4e, 0x8a, 0x55, 0x28, 0x1d, 0xe6, 0xf,
                                0x2b, 0x58, 0x21, 0x54, 0x75, 0xd5, 0xbe};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2d, 0xfe, 0xb1, 0x51, 0x8a, 0x57};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2566;
  uint8_t client_id_bytes[] = {0x45, 0x16, 0x7d, 0xe1, 0x3a, 0x75, 0x52, 0x47, 0xd5, 0x25, 0xcd,
                               0x77, 0xbf, 0x7a, 0x46, 0x64, 0x97, 0x72, 0x9d, 0x6,  0xdb};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe,  0x22, 0xe5, 0xc,  0xe5, 0xa,  0xd3, 0x78, 0x91, 0xa, 0x52,
                              0xff, 0x41, 0xc4, 0x79, 0xff, 0x3c, 0x54, 0x5b, 0x95, 0x3};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa1, 0x27, 0xf1, 0xab, 0x32, 0x22, 0x71, 0xaa, 0xa5, 0x8b, 0xe9,
                              0xf8, 0x9c, 0x74, 0xf4, 0x9e, 0xe7, 0xe9, 0x86, 0x71, 0x4e, 0x43};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152\221\234q\203G\217\fNt\228\210\150\136\182i)\202\138\152\231\173\145\214",
// _password = Just "'\180\139\198S@\216", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic
// = "8c-\209\158\&6\143C\DC4\218\154\186y\201\RS\157N\158z\179p!i\176B\133]\193\202\DC1", _willMsg =
// "\161kV;\231\200\136\195\SI", _willProps = []}), _cleanSession = True, _keepAlive = 23001, _connID = "O\245i\ESC",
// _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x5e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x59, 0xd9, 0x0,  0x4,  0x4f, 0xf5,
                   0x69, 0x1b, 0x0,  0x1e, 0x38, 0x63, 0x2d, 0xd1, 0x9e, 0x36, 0x8f, 0x43, 0x14, 0xda, 0x9a, 0xba,
                   0x79, 0xc9, 0x1e, 0x9d, 0x4e, 0x9e, 0x7a, 0xb3, 0x70, 0x21, 0x69, 0xb0, 0x42, 0x85, 0x5d, 0xc1,
                   0xca, 0x11, 0x0,  0x9,  0xa1, 0x6b, 0x56, 0x3b, 0xe7, 0xc8, 0x88, 0xc3, 0xf,  0x0,  0x18, 0x98,
                   0xdd, 0xea, 0x71, 0xcb, 0x47, 0xd9, 0xc,  0x4e, 0x74, 0xe4, 0xd2, 0x96, 0x88, 0xb6, 0x69, 0x29,
                   0xca, 0x8a, 0x98, 0xe7, 0xad, 0x91, 0xd6, 0x0,  0x7,  0x27, 0xb4, 0x8b, 0xc6, 0x53, 0x40, 0xd8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x63, 0x2d, 0xd1, 0x9e, 0x36, 0x8f, 0x43, 0x14, 0xda,
                                0x9a, 0xba, 0x79, 0xc9, 0x1e, 0x9d, 0x4e, 0x9e, 0x7a, 0xb3,
                                0x70, 0x21, 0x69, 0xb0, 0x42, 0x85, 0x5d, 0xc1, 0xca, 0x11};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa1, 0x6b, 0x56, 0x3b, 0xe7, 0xc8, 0x88, 0xc3, 0xf};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23001;
  uint8_t client_id_bytes[] = {0x4f, 0xf5, 0x69, 0x1b};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98, 0xdd, 0xea, 0x71, 0xcb, 0x47, 0xd9, 0xc,  0x4e, 0x74, 0xe4, 0xd2,
                              0x96, 0x88, 0xb6, 0x69, 0x29, 0xca, 0x8a, 0x98, 0xe7, 0xad, 0x91, 0xd6};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x27, 0xb4, 0x8b, 0xc6, 0x53, 0x40, 0xd8};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DLEVW\161\173W!+\154\235\a\169\136(K\152\224\190I4y",
// _lastWill = Nothing, _cleanSession = True, _keepAlive = 3940, _connID = "\147b\SOH\234HL\237", _properties =
// [PropUserProperty "\229\209\255\159(\208\134\128'\139\240\217J\223T" "K\192\133"]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x42, 0xf,  0x64, 0x17, 0x26,
                   0x0,  0xf,  0xe5, 0xd1, 0xff, 0x9f, 0x28, 0xd0, 0x86, 0x80, 0x27, 0x8b, 0xf0, 0xd9,
                   0x4a, 0xdf, 0x54, 0x0,  0x3,  0x4b, 0xc0, 0x85, 0x0,  0x7,  0x93, 0x62, 0x1,  0xea,
                   0x48, 0x4c, 0xed, 0x0,  0x15, 0x10, 0x56, 0x57, 0xa1, 0xad, 0x57, 0x21, 0x2b, 0x9a,
                   0xeb, 0x7,  0xa9, 0x88, 0x28, 0x4b, 0x98, 0xe0, 0xbe, 0x49, 0x34, 0x79};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x4b, 0xc0, 0x85};
  uint8_t bytesprops0[] = {0xe5, 0xd1, 0xff, 0x9f, 0x28, 0xd0, 0x86, 0x80, 0x27, 0x8b, 0xf0, 0xd9, 0x4a, 0xdf, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {3, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3940;
  uint8_t client_id_bytes[] = {0x93, 0x62, 0x1, 0xea, 0x48, 0x4c, 0xed};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x10, 0x56, 0x57, 0xa1, 0xad, 0x57, 0x21, 0x2b, 0x9a, 0xeb, 0x7,
                              0xa9, 0x88, 0x28, 0x4b, 0x98, 0xe0, 0xbe, 0x49, 0x34, 0x79};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\232f;/", _password = Just
// "T'\248\144\179\155V\209\NAK$l\134\169\165\244_\ACK\aa\US", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "h\165{\211B\214\169W\237", _willMsg = "", _willProps = [PropReasonString "\181I\231
// \176\202\SI\218\160\177",PropSubscriptionIdentifier 6,PropCorrelationData
// "\171\237\&89\223.",PropPayloadFormatIndicator 60,PropRequestProblemInformation 29,PropServerReference
// "\189\252[\183\226\&1>\218\ACK\138:\183m@\SI\153[\SOH\150F\206\225",PropResponseTopic
// "\EMv\205\SOH",PropRequestProblemInformation 111,PropPayloadFormatIndicator 254,PropReasonString
// "\223~\166\171\189\179py\195\203\171",PropContentType
// "r\203S:(\n\SYNy\SUB/\n\178>8o\183\218\254\237Ie\192\RS];\222",PropSharedSubscriptionAvailable
// 28,PropTopicAliasMaximum 23838,PropMessageExpiryInterval 23226,PropTopicAlias 25172,PropUserProperty
// ";\254\128\220\DEL\130hZ\134" "R'\STXM",PropAssignedClientIdentifier
// "\139\235\158\153\SYN\209D\183T\SO\235\192D\166;*\151\&3\170\221b\177\218",PropSharedSubscriptionAvailable
// 198,PropTopicAlias 2061,PropPayloadFormatIndicator 216,PropTopicAliasMaximum 20856,PropSubscriptionIdentifier
// 25,PropAuthenticationMethod ", \169\160\&6\157\155\228",PropSubscriptionIdentifier 32]}), _cleanSession = False,
// _keepAlive = 13091, _connID = "k!a\t\182\181\230\207<\SUB\251\243b\250\216\131H", _properties = [PropCorrelationData
// "\211\164\134\176\182\163\EOTk\ESC\207:\178H\227\129Y\176\244\216\229t\128",PropServerReference
// "\SIT\255\132\203G}\DLEz\ETBzv\197p\153\ACK\144",PropContentType
// "\249\193\171n\204\ETB\164\200\185>\152\254\NAK\221E\163\209",PropSubscriptionIdentifierAvailable
// 135,PropPayloadFormatIndicator 87,PropWildcardSubscriptionAvailable 155,PropRequestProblemInformation
// 52,PropAuthenticationData "\227\216"]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0xd4, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x33, 0x23, 0x4e, 0x9,  0x0,  0x16, 0xd3, 0xa4,
      0x86, 0xb0, 0xb6, 0xa3, 0x4,  0x6b, 0x1b, 0xcf, 0x3a, 0xb2, 0x48, 0xe3, 0x81, 0x59, 0xb0, 0xf4, 0xd8, 0xe5, 0x74,
      0x80, 0x1c, 0x0,  0x11, 0xf,  0x54, 0xff, 0x84, 0xcb, 0x47, 0x7d, 0x10, 0x7a, 0x17, 0x7a, 0x76, 0xc5, 0x70, 0x99,
      0x6,  0x90, 0x3,  0x0,  0x11, 0xf9, 0xc1, 0xab, 0x6e, 0xcc, 0x17, 0xa4, 0xc8, 0xb9, 0x3e, 0x98, 0xfe, 0x15, 0xdd,
      0x45, 0xa3, 0xd1, 0x29, 0x87, 0x1,  0x57, 0x28, 0x9b, 0x17, 0x34, 0x16, 0x0,  0x2,  0xe3, 0xd8, 0x0,  0x11, 0x6b,
      0x21, 0x61, 0x9,  0xb6, 0xb5, 0xe6, 0xcf, 0x3c, 0x1a, 0xfb, 0xf3, 0x62, 0xfa, 0xd8, 0x83, 0x48, 0xbd, 0x1,  0x1f,
      0x0,  0xa,  0xb5, 0x49, 0xe7, 0x20, 0xb0, 0xca, 0xf,  0xda, 0xa0, 0xb1, 0xb,  0x6,  0x9,  0x0,  0x6,  0xab, 0xed,
      0x38, 0x39, 0xdf, 0x2e, 0x1,  0x3c, 0x17, 0x1d, 0x1c, 0x0,  0x16, 0xbd, 0xfc, 0x5b, 0xb7, 0xe2, 0x31, 0x3e, 0xda,
      0x6,  0x8a, 0x3a, 0xb7, 0x6d, 0x40, 0xf,  0x99, 0x5b, 0x1,  0x96, 0x46, 0xce, 0xe1, 0x8,  0x0,  0x4,  0x19, 0x76,
      0xcd, 0x1,  0x17, 0x6f, 0x1,  0xfe, 0x1f, 0x0,  0xb,  0xdf, 0x7e, 0xa6, 0xab, 0xbd, 0xb3, 0x70, 0x79, 0xc3, 0xcb,
      0xab, 0x3,  0x0,  0x1a, 0x72, 0xcb, 0x53, 0x3a, 0x28, 0xa,  0x16, 0x79, 0x1a, 0x2f, 0xa,  0xb2, 0x3e, 0x38, 0x6f,
      0xb7, 0xda, 0xfe, 0xed, 0x49, 0x65, 0xc0, 0x1e, 0x5d, 0x3b, 0xde, 0x2a, 0x1c, 0x22, 0x5d, 0x1e, 0x2,  0x0,  0x0,
      0x5a, 0xba, 0x23, 0x62, 0x54, 0x26, 0x0,  0x9,  0x3b, 0xfe, 0x80, 0xdc, 0x7f, 0x82, 0x68, 0x5a, 0x86, 0x0,  0x4,
      0x52, 0x27, 0x2,  0x4d, 0x12, 0x0,  0x17, 0x8b, 0xeb, 0x9e, 0x99, 0x16, 0xd1, 0x44, 0xb7, 0x54, 0xe,  0xeb, 0xc0,
      0x44, 0xa6, 0x3b, 0x2a, 0x97, 0x33, 0xaa, 0xdd, 0x62, 0xb1, 0xda, 0x2a, 0xc6, 0x23, 0x8,  0xd,  0x1,  0xd8, 0x22,
      0x51, 0x78, 0xb,  0x19, 0x15, 0x0,  0x8,  0x2c, 0x20, 0xa9, 0xa0, 0x36, 0x9d, 0x9b, 0xe4, 0xb,  0x20, 0x0,  0x9,
      0x68, 0xa5, 0x7b, 0xd3, 0x42, 0xd6, 0xa9, 0x57, 0xed, 0x0,  0x0,  0x0,  0x4,  0xe8, 0x66, 0x3b, 0x2f, 0x0,  0x14,
      0x54, 0x27, 0xf8, 0x90, 0xb3, 0x9b, 0x56, 0xd1, 0x15, 0x24, 0x6c, 0x86, 0xa9, 0xa5, 0xf4, 0x5f, 0x6,  0x7,  0x61,
      0x1f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd3, 0xa4, 0x86, 0xb0, 0xb6, 0xa3, 0x4,  0x6b, 0x1b, 0xcf, 0x3a,
                           0xb2, 0x48, 0xe3, 0x81, 0x59, 0xb0, 0xf4, 0xd8, 0xe5, 0x74, 0x80};
  uint8_t bytesprops1[] = {0xf,  0x54, 0xff, 0x84, 0xcb, 0x47, 0x7d, 0x10, 0x7a,
                           0x17, 0x7a, 0x76, 0xc5, 0x70, 0x99, 0x6,  0x90};
  uint8_t bytesprops2[] = {0xf9, 0xc1, 0xab, 0x6e, 0xcc, 0x17, 0xa4, 0xc8, 0xb9,
                           0x3e, 0x98, 0xfe, 0x15, 0xdd, 0x45, 0xa3, 0xd1};
  uint8_t bytesprops3[] = {0xe3, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb5, 0x49, 0xe7, 0x20, 0xb0, 0xca, 0xf, 0xda, 0xa0, 0xb1};
  uint8_t byteswillprops1[] = {0xab, 0xed, 0x38, 0x39, 0xdf, 0x2e};
  uint8_t byteswillprops2[] = {0xbd, 0xfc, 0x5b, 0xb7, 0xe2, 0x31, 0x3e, 0xda, 0x6,  0x8a, 0x3a,
                               0xb7, 0x6d, 0x40, 0xf,  0x99, 0x5b, 0x1,  0x96, 0x46, 0xce, 0xe1};
  uint8_t byteswillprops3[] = {0x19, 0x76, 0xcd, 0x1};
  uint8_t byteswillprops4[] = {0xdf, 0x7e, 0xa6, 0xab, 0xbd, 0xb3, 0x70, 0x79, 0xc3, 0xcb, 0xab};
  uint8_t byteswillprops5[] = {0x72, 0xcb, 0x53, 0x3a, 0x28, 0xa,  0x16, 0x79, 0x1a, 0x2f, 0xa,  0xb2, 0x3e,
                               0x38, 0x6f, 0xb7, 0xda, 0xfe, 0xed, 0x49, 0x65, 0xc0, 0x1e, 0x5d, 0x3b, 0xde};
  uint8_t byteswillprops7[] = {0x52, 0x27, 0x2, 0x4d};
  uint8_t byteswillprops6[] = {0x3b, 0xfe, 0x80, 0xdc, 0x7f, 0x82, 0x68, 0x5a, 0x86};
  uint8_t byteswillprops8[] = {0x8b, 0xeb, 0x9e, 0x99, 0x16, 0xd1, 0x44, 0xb7, 0x54, 0xe,  0xeb, 0xc0,
                               0x44, 0xa6, 0x3b, 0x2a, 0x97, 0x33, 0xaa, 0xdd, 0x62, 0xb1, 0xda};
  uint8_t byteswillprops9[] = {0x2c, 0x20, 0xa9, 0xa0, 0x36, 0x9d, 0x9b, 0xe4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23838}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23226}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25172}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops6}, .v = {4, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2061}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20856}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 32}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x68, 0xa5, 0x7b, 0xd3, 0x42, 0xd6, 0xa9, 0x57, 0xed};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13091;
  uint8_t client_id_bytes[] = {0x6b, 0x21, 0x61, 0x9,  0xb6, 0xb5, 0xe6, 0xcf, 0x3c,
                               0x1a, 0xfb, 0xf3, 0x62, 0xfa, 0xd8, 0x83, 0x48};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe8, 0x66, 0x3b, 0x2f};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x54, 0x27, 0xf8, 0x90, 0xb3, 0x9b, 0x56, 0xd1, 0x15, 0x24,
                              0x6c, 0x86, 0xa9, 0xa5, 0xf4, 0x5f, 0x6,  0x7,  0x61, 0x1f};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\211\228\SUB\176\198\221", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "xpj95\230\&1\225?", _willMsg = "\248", _willProps =
// [PropCorrelationData "\197\&4\239I\150\236U\STX\234/",PropReceiveMaximum 17282,PropSubscriptionIdentifier
// 28,PropReasonString "\GSR\RS\SUB\152\158\135;\n\227",PropContentType "f\183\210n\156p\155\a\241<\248\255
// \219\178`,a\226l\USC*\225w\DELVy\247",PropMaximumQoS 75,PropAuthenticationData
// "\183\254\148\233!:5`\197",PropServerKeepAlive 17308,PropMaximumQoS 249,PropMessageExpiryInterval
// 30756,PropRetainAvailable 189,PropRequestProblemInformation 94,PropMaximumPacketSize 5418,PropWillDelayInterval
// 13911,PropCorrelationData "\ETB\147\170~\240:\FS\DC1Z\173Uq}h\254\EM\195\252\DC11\232\128\249",PropReceiveMaximum
// 14720,PropRequestResponseInformation 131,PropMaximumPacketSize 31902]}), _cleanSession = True, _keepAlive = 2433,
// _connID = "\185\137\241\223?ec+\\U\r\DC1\GS<y\159\167\147\233a\142C4\216\a\"2b", _properties =
// [PropAssignedClientIdentifier
// ",\203\247\166\148\230\195%\224\196\EMK\163S/wsxd\t\174\231\228\219\ETX",PropWillDelayInterval
// 15706,PropSubscriptionIdentifier 20,PropAssignedClientIdentifier "\234\155",PropMaximumQoS 97,PropRetainAvailable
// 113,PropMaximumQoS 109,PropServerReference "w\196",PropServerReference
// "i\200\163\147\177\152\175\&7\132\221\ETB\205\160i\221\248\247\177Xk\210\196\250b
// \246\130\r",PropSessionExpiryInterval 19254,PropTopicAliasMaximum 13080,PropServerKeepAlive
// 8172,PropTopicAliasMaximum 20198,PropRequestResponseInformation 167,PropWillDelayInterval
// 15282,PropSharedSubscriptionAvailable 121]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0xb3, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x9,  0x81, 0x69, 0x12, 0x0,  0x19, 0x2c, 0xcb,
      0xf7, 0xa6, 0x94, 0xe6, 0xc3, 0x25, 0xe0, 0xc4, 0x19, 0x4b, 0xa3, 0x53, 0x2f, 0x77, 0x73, 0x78, 0x64, 0x9,  0xae,
      0xe7, 0xe4, 0xdb, 0x3,  0x18, 0x0,  0x0,  0x3d, 0x5a, 0xb,  0x14, 0x12, 0x0,  0x2,  0xea, 0x9b, 0x24, 0x61, 0x25,
      0x71, 0x24, 0x6d, 0x1c, 0x0,  0x2,  0x77, 0xc4, 0x1c, 0x0,  0x1c, 0x69, 0xc8, 0xa3, 0x93, 0xb1, 0x98, 0xaf, 0x37,
      0x84, 0xdd, 0x17, 0xcd, 0xa0, 0x69, 0xdd, 0xf8, 0xf7, 0xb1, 0x58, 0x6b, 0xd2, 0xc4, 0xfa, 0x62, 0x20, 0xf6, 0x82,
      0xd,  0x11, 0x0,  0x0,  0x4b, 0x36, 0x22, 0x33, 0x18, 0x13, 0x1f, 0xec, 0x22, 0x4e, 0xe6, 0x19, 0xa7, 0x18, 0x0,
      0x0,  0x3b, 0xb2, 0x2a, 0x79, 0x0,  0x1c, 0xb9, 0x89, 0xf1, 0xdf, 0x3f, 0x65, 0x63, 0x2b, 0x5c, 0x55, 0xd,  0x11,
      0x1d, 0x3c, 0x79, 0x9f, 0xa7, 0x93, 0xe9, 0x61, 0x8e, 0x43, 0x34, 0xd8, 0x7,  0x22, 0x32, 0x62, 0x89, 0x1,  0x9,
      0x0,  0xa,  0xc5, 0x34, 0xef, 0x49, 0x96, 0xec, 0x55, 0x2,  0xea, 0x2f, 0x21, 0x43, 0x82, 0xb,  0x1c, 0x1f, 0x0,
      0xa,  0x1d, 0x52, 0x1e, 0x1a, 0x98, 0x9e, 0x87, 0x3b, 0xa,  0xe3, 0x3,  0x0,  0x1d, 0x66, 0xb7, 0xd2, 0x6e, 0x9c,
      0x70, 0x9b, 0x7,  0xf1, 0x3c, 0xf8, 0xff, 0x20, 0xdb, 0xb2, 0x60, 0x2c, 0x61, 0xe2, 0x6c, 0x1f, 0x43, 0x2a, 0xe1,
      0x77, 0x7f, 0x56, 0x79, 0xf7, 0x24, 0x4b, 0x16, 0x0,  0x9,  0xb7, 0xfe, 0x94, 0xe9, 0x21, 0x3a, 0x35, 0x60, 0xc5,
      0x13, 0x43, 0x9c, 0x24, 0xf9, 0x2,  0x0,  0x0,  0x78, 0x24, 0x25, 0xbd, 0x17, 0x5e, 0x27, 0x0,  0x0,  0x15, 0x2a,
      0x18, 0x0,  0x0,  0x36, 0x57, 0x9,  0x0,  0x17, 0x17, 0x93, 0xaa, 0x7e, 0xf0, 0x3a, 0x1c, 0x11, 0x5a, 0xad, 0x55,
      0x71, 0x7d, 0x68, 0xfe, 0x19, 0xc3, 0xfc, 0x11, 0x31, 0xe8, 0x80, 0xf9, 0x21, 0x39, 0x80, 0x19, 0x83, 0x27, 0x0,
      0x0,  0x7c, 0x9e, 0x0,  0x9,  0x78, 0x70, 0x6a, 0x39, 0x35, 0xe6, 0x31, 0xe1, 0x3f, 0x0,  0x1,  0xf8, 0x0,  0x6,
      0xd3, 0xe4, 0x1a, 0xb0, 0xc6, 0xdd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2c, 0xcb, 0xf7, 0xa6, 0x94, 0xe6, 0xc3, 0x25, 0xe0, 0xc4, 0x19, 0x4b, 0xa3,
                           0x53, 0x2f, 0x77, 0x73, 0x78, 0x64, 0x9,  0xae, 0xe7, 0xe4, 0xdb, 0x3};
  uint8_t bytesprops1[] = {0xea, 0x9b};
  uint8_t bytesprops2[] = {0x77, 0xc4};
  uint8_t bytesprops3[] = {0x69, 0xc8, 0xa3, 0x93, 0xb1, 0x98, 0xaf, 0x37, 0x84, 0xdd, 0x17, 0xcd, 0xa0, 0x69,
                           0xdd, 0xf8, 0xf7, 0xb1, 0x58, 0x6b, 0xd2, 0xc4, 0xfa, 0x62, 0x20, 0xf6, 0x82, 0xd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15706}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19254}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13080}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8172}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20198}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15282}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 121}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc5, 0x34, 0xef, 0x49, 0x96, 0xec, 0x55, 0x2, 0xea, 0x2f};
  uint8_t byteswillprops1[] = {0x1d, 0x52, 0x1e, 0x1a, 0x98, 0x9e, 0x87, 0x3b, 0xa, 0xe3};
  uint8_t byteswillprops2[] = {0x66, 0xb7, 0xd2, 0x6e, 0x9c, 0x70, 0x9b, 0x7,  0xf1, 0x3c, 0xf8, 0xff, 0x20, 0xdb, 0xb2,
                               0x60, 0x2c, 0x61, 0xe2, 0x6c, 0x1f, 0x43, 0x2a, 0xe1, 0x77, 0x7f, 0x56, 0x79, 0xf7};
  uint8_t byteswillprops3[] = {0xb7, 0xfe, 0x94, 0xe9, 0x21, 0x3a, 0x35, 0x60, 0xc5};
  uint8_t byteswillprops4[] = {0x17, 0x93, 0xaa, 0x7e, 0xf0, 0x3a, 0x1c, 0x11, 0x5a, 0xad, 0x55, 0x71,
                               0x7d, 0x68, 0xfe, 0x19, 0xc3, 0xfc, 0x11, 0x31, 0xe8, 0x80, 0xf9};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17282}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17308}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30756}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5418}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13911}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14720}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31902}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x78, 0x70, 0x6a, 0x39, 0x35, 0xe6, 0x31, 0xe1, 0x3f};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf8};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2433;
  uint8_t client_id_bytes[] = {0xb9, 0x89, 0xf1, 0xdf, 0x3f, 0x65, 0x63, 0x2b, 0x5c, 0x55, 0xd, 0x11, 0x1d, 0x3c,
                               0x79, 0x9f, 0xa7, 0x93, 0xe9, 0x61, 0x8e, 0x43, 0x34, 0xd8, 0x7, 0x22, 0x32, 0x62};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd3, 0xe4, 0x1a, 0xb0, 0xc6, 0xdd};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "^Y5\248\233?\154\DC4-\171A\204}\158\211", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\FS\"\130\182\226\&1: \251\\\185\139\177O\141\251(a",
// _willMsg = "\208I+\222\&7\US\167\234\232\168\200\184\186\&7", _willProps = [PropAuthenticationData
// "\251\254\FSdU\198&\243%Q\238\&5\205",PropAuthenticationData
// "<\247U\136S\190\226!1hM\n\196\US3'\159\154\199\209",PropRetainAvailable 248,PropMessageExpiryInterval
// 25531,PropWildcardSubscriptionAvailable 75,PropResponseInformation
// "\220\&4\242\ENQ\171\DEL\173\155\217^\227",PropSessionExpiryInterval 16631]}), _cleanSession = False, _keepAlive =
// 30451, _connID = "\247'\219\164\191", _properties = []}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x8b, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x76, 0xf3, 0x0,  0x0,  0x5,
                   0xf7, 0x27, 0xdb, 0xa4, 0xbf, 0x43, 0x16, 0x0,  0xd,  0xfb, 0xfe, 0x1c, 0x64, 0x55, 0xc6, 0x26,
                   0xf3, 0x25, 0x51, 0xee, 0x35, 0xcd, 0x16, 0x0,  0x14, 0x3c, 0xf7, 0x55, 0x88, 0x53, 0xbe, 0xe2,
                   0x21, 0x31, 0x68, 0x4d, 0xa,  0xc4, 0x1f, 0x33, 0x27, 0x9f, 0x9a, 0xc7, 0xd1, 0x25, 0xf8, 0x2,
                   0x0,  0x0,  0x63, 0xbb, 0x28, 0x4b, 0x1a, 0x0,  0xb,  0xdc, 0x34, 0xf2, 0x5,  0xab, 0x7f, 0xad,
                   0x9b, 0xd9, 0x5e, 0xe3, 0x11, 0x0,  0x0,  0x40, 0xf7, 0x0,  0x12, 0x1c, 0x22, 0x82, 0xb6, 0xe2,
                   0x31, 0x3a, 0x20, 0xfb, 0x5c, 0xb9, 0x8b, 0xb1, 0x4f, 0x8d, 0xfb, 0x28, 0x61, 0x0,  0xe,  0xd0,
                   0x49, 0x2b, 0xde, 0x37, 0x1f, 0xa7, 0xea, 0xe8, 0xa8, 0xc8, 0xb8, 0xba, 0x37, 0x0,  0xf,  0x5e,
                   0x59, 0x35, 0xf8, 0xe9, 0x3f, 0x9a, 0x14, 0x2d, 0xab, 0x41, 0xcc, 0x7d, 0x9e, 0xd3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xfb, 0xfe, 0x1c, 0x64, 0x55, 0xc6, 0x26, 0xf3, 0x25, 0x51, 0xee, 0x35, 0xcd};
  uint8_t byteswillprops1[] = {0x3c, 0xf7, 0x55, 0x88, 0x53, 0xbe, 0xe2, 0x21, 0x31, 0x68,
                               0x4d, 0xa,  0xc4, 0x1f, 0x33, 0x27, 0x9f, 0x9a, 0xc7, 0xd1};
  uint8_t byteswillprops2[] = {0xdc, 0x34, 0xf2, 0x5, 0xab, 0x7f, 0xad, 0x9b, 0xd9, 0x5e, 0xe3};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25531}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16631}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1c, 0x22, 0x82, 0xb6, 0xe2, 0x31, 0x3a, 0x20, 0xfb,
                                0x5c, 0xb9, 0x8b, 0xb1, 0x4f, 0x8d, 0xfb, 0x28, 0x61};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd0, 0x49, 0x2b, 0xde, 0x37, 0x1f, 0xa7, 0xea, 0xe8, 0xa8, 0xc8, 0xb8, 0xba, 0x37};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30451;
  uint8_t client_id_bytes[] = {0xf7, 0x27, 0xdb, 0xa4, 0xbf};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5e, 0x59, 0x35, 0xf8, 0xe9, 0x3f, 0x9a, 0x14, 0x2d, 0xab, 0x41, 0xcc, 0x7d, 0x9e, 0xd3};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\237Kwt\ESC3\220\DC4f\147=}\131D\196\234\128\187\233j{\t\138:(I\NUL\183\220", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\135T\135u\132\130K", _willMsg =
// "=\143\180Fs\174O9K\200\240\250/\141\198\ENQ%\SYN\201\231lg4n\204\RS\248\214", _willProps = [PropServerKeepAlive
// 25486,PropTopicAlias 379]}), _cleanSession = False, _keepAlive = 29757, _connID =
// "\240h\246\160\191\129\157\155\219\211\215\246\162\241", _properties = [PropTopicAliasMaximum
// 22578,PropTopicAliasMaximum 21175,PropPayloadFormatIndicator 111,PropSubscriptionIdentifier
// 15,PropResponseInformation "\NAK\232\157\175\130\129GC\GS\251Y\194\EMD \142y\179\250%`",PropAssignedClientIdentifier
// "V",PropResponseInformation "\EM~\203\212Z\131\130\212",PropContentType
// "\175\161}\254\SYN\161\246G\253\223v9\SIJ\251\&1\f\173\r6\141z\204\137\146",PropMessageExpiryInterval
// 5064,PropTopicAliasMaximum 22275,PropServerKeepAlive 22844,PropWildcardSubscriptionAvailable 15,PropServerKeepAlive
// 18627,PropResponseInformation "\201\226\&2\228\215\DC1\253\NAKT\146W\EM\135\130(",PropRequestResponseInformation
// 224,PropRequestResponseInformation 205,PropRetainAvailable 179,PropMaximumQoS 106,PropUserProperty
// "\ETBs\241\135\164\157\134s\DC1\210>\181\187\231\&9\243\232\195" "\207`\151\133O",PropReasonString
// "\209\174\214",PropMessageExpiryInterval 1097,PropMessageExpiryInterval 11875,PropRequestResponseInformation 8]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0x8e, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x74, 0x3d, 0xa5, 0x1,  0x22, 0x58, 0x32, 0x22,
      0x52, 0xb7, 0x1,  0x6f, 0xb,  0xf,  0x1a, 0x0,  0x15, 0x15, 0xe8, 0x9d, 0xaf, 0x82, 0x81, 0x47, 0x43, 0x1d, 0xfb,
      0x59, 0xc2, 0x19, 0x44, 0x20, 0x8e, 0x79, 0xb3, 0xfa, 0x25, 0x60, 0x12, 0x0,  0x1,  0x56, 0x1a, 0x0,  0x8,  0x19,
      0x7e, 0xcb, 0xd4, 0x5a, 0x83, 0x82, 0xd4, 0x3,  0x0,  0x19, 0xaf, 0xa1, 0x7d, 0xfe, 0x16, 0xa1, 0xf6, 0x47, 0xfd,
      0xdf, 0x76, 0x39, 0xf,  0x4a, 0xfb, 0x31, 0xc,  0xad, 0xd,  0x36, 0x8d, 0x7a, 0xcc, 0x89, 0x92, 0x2,  0x0,  0x0,
      0x13, 0xc8, 0x22, 0x57, 0x3,  0x13, 0x59, 0x3c, 0x28, 0xf,  0x13, 0x48, 0xc3, 0x1a, 0x0,  0xf,  0xc9, 0xe2, 0x32,
      0xe4, 0xd7, 0x11, 0xfd, 0x15, 0x54, 0x92, 0x57, 0x19, 0x87, 0x82, 0x28, 0x19, 0xe0, 0x19, 0xcd, 0x25, 0xb3, 0x24,
      0x6a, 0x26, 0x0,  0x12, 0x17, 0x73, 0xf1, 0x87, 0xa4, 0x9d, 0x86, 0x73, 0x11, 0xd2, 0x3e, 0xb5, 0xbb, 0xe7, 0x39,
      0xf3, 0xe8, 0xc3, 0x0,  0x5,  0xcf, 0x60, 0x97, 0x85, 0x4f, 0x1f, 0x0,  0x3,  0xd1, 0xae, 0xd6, 0x2,  0x0,  0x0,
      0x4,  0x49, 0x2,  0x0,  0x0,  0x2e, 0x63, 0x19, 0x8,  0x0,  0xe,  0xf0, 0x68, 0xf6, 0xa0, 0xbf, 0x81, 0x9d, 0x9b,
      0xdb, 0xd3, 0xd7, 0xf6, 0xa2, 0xf1, 0x6,  0x13, 0x63, 0x8e, 0x23, 0x1,  0x7b, 0x0,  0x7,  0x87, 0x54, 0x87, 0x75,
      0x84, 0x82, 0x4b, 0x0,  0x1c, 0x3d, 0x8f, 0xb4, 0x46, 0x73, 0xae, 0x4f, 0x39, 0x4b, 0xc8, 0xf0, 0xfa, 0x2f, 0x8d,
      0xc6, 0x5,  0x25, 0x16, 0xc9, 0xe7, 0x6c, 0x67, 0x34, 0x6e, 0xcc, 0x1e, 0xf8, 0xd6, 0x0,  0x1d, 0xed, 0x4b, 0x77,
      0x74, 0x1b, 0x33, 0xdc, 0x14, 0x66, 0x93, 0x3d, 0x7d, 0x83, 0x44, 0xc4, 0xea, 0x80, 0xbb, 0xe9, 0x6a, 0x7b, 0x9,
      0x8a, 0x3a, 0x28, 0x49, 0x0,  0xb7, 0xdc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x15, 0xe8, 0x9d, 0xaf, 0x82, 0x81, 0x47, 0x43, 0x1d, 0xfb, 0x59,
                           0xc2, 0x19, 0x44, 0x20, 0x8e, 0x79, 0xb3, 0xfa, 0x25, 0x60};
  uint8_t bytesprops1[] = {0x56};
  uint8_t bytesprops2[] = {0x19, 0x7e, 0xcb, 0xd4, 0x5a, 0x83, 0x82, 0xd4};
  uint8_t bytesprops3[] = {0xaf, 0xa1, 0x7d, 0xfe, 0x16, 0xa1, 0xf6, 0x47, 0xfd, 0xdf, 0x76, 0x39, 0xf,
                           0x4a, 0xfb, 0x31, 0xc,  0xad, 0xd,  0x36, 0x8d, 0x7a, 0xcc, 0x89, 0x92};
  uint8_t bytesprops4[] = {0xc9, 0xe2, 0x32, 0xe4, 0xd7, 0x11, 0xfd, 0x15, 0x54, 0x92, 0x57, 0x19, 0x87, 0x82, 0x28};
  uint8_t bytesprops6[] = {0xcf, 0x60, 0x97, 0x85, 0x4f};
  uint8_t bytesprops5[] = {0x17, 0x73, 0xf1, 0x87, 0xa4, 0x9d, 0x86, 0x73, 0x11,
                           0xd2, 0x3e, 0xb5, 0xbb, 0xe7, 0x39, 0xf3, 0xe8, 0xc3};
  uint8_t bytesprops7[] = {0xd1, 0xae, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22578}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21175}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5064}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22275}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22844}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18627}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops5}, .v = {5, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1097}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11875}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 8}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25486}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 379}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x54, 0x87, 0x75, 0x84, 0x82, 0x4b};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3d, 0x8f, 0xb4, 0x46, 0x73, 0xae, 0x4f, 0x39, 0x4b, 0xc8, 0xf0, 0xfa, 0x2f, 0x8d,
                                  0xc6, 0x5,  0x25, 0x16, 0xc9, 0xe7, 0x6c, 0x67, 0x34, 0x6e, 0xcc, 0x1e, 0xf8, 0xd6};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29757;
  uint8_t client_id_bytes[] = {0xf0, 0x68, 0xf6, 0xa0, 0xbf, 0x81, 0x9d, 0x9b, 0xdb, 0xd3, 0xd7, 0xf6, 0xa2, 0xf1};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xed, 0x4b, 0x77, 0x74, 0x1b, 0x33, 0xdc, 0x14, 0x66, 0x93, 0x3d, 0x7d, 0x83, 0x44, 0xc4,
                              0xea, 0x80, 0xbb, 0xe9, 0x6a, 0x7b, 0x9,  0x8a, 0x3a, 0x28, 0x49, 0x0,  0xb7, 0xdc};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\129R\188<a\142\240\&4\244f\NUL@3/\RS", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\128\241\168\n\242\187\240\177U", _willMsg =
// "Y\227\211\222H\229\181z\225XC\149D&@\208LD", _willProps = [PropServerKeepAlive 7921,PropServerKeepAlive
// 1864,PropRequestResponseInformation 4,PropSubscriptionIdentifierAvailable 69,PropServerReference
// "M\207v\237H7D\\\225GZ\219\140\SIoJ\216\141\197\196\f\254\238\216o\n",PropMessageExpiryInterval
// 28800,PropWillDelayInterval 18639,PropReasonString
// "\178\156R\\\155\219>\238\ETB\248F\174*\164\231\GS\"\142\251\243\nM\151\128\196i2",PropAuthenticationMethod
// "{g\224\175\b\232\163\225_\136\149\167\194\NUL\202F\148d\252\EM\145\NAK\221\137",PropPayloadFormatIndicator
// 250,PropMessageExpiryInterval 14991,PropAuthenticationData
// "\b\248+\189\226\NAK\155,\144\192K\157h\214\ENQb*3&\194u\142\183U\SUB^/8\173",PropAssignedClientIdentifier
// "\173\147\"!d\166\242!\216\205\DC3\144\242\254\147#",PropSessionExpiryInterval 3173,PropResponseInformation
// "\250+\238\254\185\208E\156=u\192nQ\132A~\235h\251iV\165>*D",PropResponseTopic
// "\162\180\193\154\170\195\239\255\ACK\134S\147(lc\242I\132\216\SYN\173O\nbi)",PropAuthenticationMethod
// "",PropWillDelayInterval 11821,PropSubscriptionIdentifierAvailable 210,PropSubscriptionIdentifier
// 27,PropMaximumPacketSize 20831,PropWildcardSubscriptionAvailable 199,PropAssignedClientIdentifier
// "\230\139{\ESC\234\207v\138\GS\220>\191ml",PropContentType
// ",-b$\DLE-\CAN\218\ETB\132\132=Pl\247\186GL\180\184\216\247",PropMessageExpiryInterval
// 12214,PropRequestResponseInformation 241,PropCorrelationData
// "\135\148\128\210j\208Mf\232\166\231?\172\CAN\174\&7\248\181\&9>dj\201\138\231\163=I",PropResponseInformation
// "\190\STX7\147\139Jv<\254\219H,\187\SI+",PropRequestProblemInformation 99,PropResponseInformation
// "\ESCJ\134\206\US"]}), _cleanSession = False, _keepAlive = 24021, _connID =
// "\226\DC1b\162U#[l\222e\215\133\236\USO\246T\196\148]\bq\191\235\137az", _properties = [PropAuthenticationData
// "\DC18\250\166<\252r\SI\DC16#\239\159}\DEL\244 \fB",PropWildcardSubscriptionAvailable 6,PropTopicAlias
// 12941,PropRetainAvailable 48,PropMaximumQoS 208,PropWildcardSubscriptionAvailable 97,PropTopicAliasMaximum
// 25976,PropTopicAlias 23357,PropWildcardSubscriptionAvailable 56,PropMessageExpiryInterval
// 1922,PropSessionExpiryInterval 2342,PropAssignedClientIdentifier
// "\178\130\211\140\SI\219\185\212\243H\145`.\207\143\DLET\t-(\128",PropMessageExpiryInterval 26447,PropContentType
// "|\199B",PropRequestResponseInformation 91,PropSharedSubscriptionAvailable 115,PropAssignedClientIdentifier
// "\192\237\US>`\170\238\250cc\130\&33!\166\234\165>\173",PropMaximumQoS 37,PropContentType
// "\185\EMg\150\155\227\RS\163\183S",PropTopicAliasMaximum 16720,PropReasonString
// "a`\v\191\SUBpv\254\231\232E\149\233\t\167\ETX\ESC\163[\138U",PropTopicAlias 26061]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xd9, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8c, 0x5d, 0xd5, 0x9d, 0x1,  0x16, 0x0,  0x13, 0x11,
      0x38, 0xfa, 0xa6, 0x3c, 0xfc, 0x72, 0xf,  0x11, 0x36, 0x23, 0xef, 0x9f, 0x7d, 0x7f, 0xf4, 0x20, 0xc,  0x42, 0x28,
      0x6,  0x23, 0x32, 0x8d, 0x25, 0x30, 0x24, 0xd0, 0x28, 0x61, 0x22, 0x65, 0x78, 0x23, 0x5b, 0x3d, 0x28, 0x38, 0x2,
      0x0,  0x0,  0x7,  0x82, 0x11, 0x0,  0x0,  0x9,  0x26, 0x12, 0x0,  0x15, 0xb2, 0x82, 0xd3, 0x8c, 0xf,  0xdb, 0xb9,
      0xd4, 0xf3, 0x48, 0x91, 0x60, 0x2e, 0xcf, 0x8f, 0x10, 0x54, 0x9,  0x2d, 0x28, 0x80, 0x2,  0x0,  0x0,  0x67, 0x4f,
      0x3,  0x0,  0x3,  0x7c, 0xc7, 0x42, 0x19, 0x5b, 0x2a, 0x73, 0x12, 0x0,  0x13, 0xc0, 0xed, 0x1f, 0x3e, 0x60, 0xaa,
      0xee, 0xfa, 0x63, 0x63, 0x82, 0x33, 0x33, 0x21, 0xa6, 0xea, 0xa5, 0x3e, 0xad, 0x24, 0x25, 0x3,  0x0,  0xa,  0xb9,
      0x19, 0x67, 0x96, 0x9b, 0xe3, 0x1e, 0xa3, 0xb7, 0x53, 0x22, 0x41, 0x50, 0x1f, 0x0,  0x15, 0x61, 0x60, 0xb,  0xbf,
      0x1a, 0x70, 0x76, 0xfe, 0xe7, 0xe8, 0x45, 0x95, 0xe9, 0x9,  0xa7, 0x3,  0x1b, 0xa3, 0x5b, 0x8a, 0x55, 0x23, 0x65,
      0xcd, 0x0,  0x1b, 0xe2, 0x11, 0x62, 0xa2, 0x55, 0x23, 0x5b, 0x6c, 0xde, 0x65, 0xd7, 0x85, 0xec, 0x1f, 0x4f, 0xf6,
      0x54, 0xc4, 0x94, 0x5d, 0x8,  0x71, 0xbf, 0xeb, 0x89, 0x61, 0x7a, 0xe1, 0x2,  0x13, 0x1e, 0xf1, 0x13, 0x7,  0x48,
      0x19, 0x4,  0x29, 0x45, 0x1c, 0x0,  0x1a, 0x4d, 0xcf, 0x76, 0xed, 0x48, 0x37, 0x44, 0x5c, 0xe1, 0x47, 0x5a, 0xdb,
      0x8c, 0xf,  0x6f, 0x4a, 0xd8, 0x8d, 0xc5, 0xc4, 0xc,  0xfe, 0xee, 0xd8, 0x6f, 0xa,  0x2,  0x0,  0x0,  0x70, 0x80,
      0x18, 0x0,  0x0,  0x48, 0xcf, 0x1f, 0x0,  0x1b, 0xb2, 0x9c, 0x52, 0x5c, 0x9b, 0xdb, 0x3e, 0xee, 0x17, 0xf8, 0x46,
      0xae, 0x2a, 0xa4, 0xe7, 0x1d, 0x22, 0x8e, 0xfb, 0xf3, 0xa,  0x4d, 0x97, 0x80, 0xc4, 0x69, 0x32, 0x15, 0x0,  0x18,
      0x7b, 0x67, 0xe0, 0xaf, 0x8,  0xe8, 0xa3, 0xe1, 0x5f, 0x88, 0x95, 0xa7, 0xc2, 0x0,  0xca, 0x46, 0x94, 0x64, 0xfc,
      0x19, 0x91, 0x15, 0xdd, 0x89, 0x1,  0xfa, 0x2,  0x0,  0x0,  0x3a, 0x8f, 0x16, 0x0,  0x1d, 0x8,  0xf8, 0x2b, 0xbd,
      0xe2, 0x15, 0x9b, 0x2c, 0x90, 0xc0, 0x4b, 0x9d, 0x68, 0xd6, 0x5,  0x62, 0x2a, 0x33, 0x26, 0xc2, 0x75, 0x8e, 0xb7,
      0x55, 0x1a, 0x5e, 0x2f, 0x38, 0xad, 0x12, 0x0,  0x10, 0xad, 0x93, 0x22, 0x21, 0x64, 0xa6, 0xf2, 0x21, 0xd8, 0xcd,
      0x13, 0x90, 0xf2, 0xfe, 0x93, 0x23, 0x11, 0x0,  0x0,  0xc,  0x65, 0x1a, 0x0,  0x19, 0xfa, 0x2b, 0xee, 0xfe, 0xb9,
      0xd0, 0x45, 0x9c, 0x3d, 0x75, 0xc0, 0x6e, 0x51, 0x84, 0x41, 0x7e, 0xeb, 0x68, 0xfb, 0x69, 0x56, 0xa5, 0x3e, 0x2a,
      0x44, 0x8,  0x0,  0x1a, 0xa2, 0xb4, 0xc1, 0x9a, 0xaa, 0xc3, 0xef, 0xff, 0x6,  0x86, 0x53, 0x93, 0x28, 0x6c, 0x63,
      0xf2, 0x49, 0x84, 0xd8, 0x16, 0xad, 0x4f, 0xa,  0x62, 0x69, 0x29, 0x15, 0x0,  0x0,  0x18, 0x0,  0x0,  0x2e, 0x2d,
      0x29, 0xd2, 0xb,  0x1b, 0x27, 0x0,  0x0,  0x51, 0x5f, 0x28, 0xc7, 0x12, 0x0,  0xe,  0xe6, 0x8b, 0x7b, 0x1b, 0xea,
      0xcf, 0x76, 0x8a, 0x1d, 0xdc, 0x3e, 0xbf, 0x6d, 0x6c, 0x3,  0x0,  0x16, 0x2c, 0x2d, 0x62, 0x24, 0x10, 0x2d, 0x18,
      0xda, 0x17, 0x84, 0x84, 0x3d, 0x50, 0x6c, 0xf7, 0xba, 0x47, 0x4c, 0xb4, 0xb8, 0xd8, 0xf7, 0x2,  0x0,  0x0,  0x2f,
      0xb6, 0x19, 0xf1, 0x9,  0x0,  0x1c, 0x87, 0x94, 0x80, 0xd2, 0x6a, 0xd0, 0x4d, 0x66, 0xe8, 0xa6, 0xe7, 0x3f, 0xac,
      0x18, 0xae, 0x37, 0xf8, 0xb5, 0x39, 0x3e, 0x64, 0x6a, 0xc9, 0x8a, 0xe7, 0xa3, 0x3d, 0x49, 0x1a, 0x0,  0xf,  0xbe,
      0x2,  0x37, 0x93, 0x8b, 0x4a, 0x76, 0x3c, 0xfe, 0xdb, 0x48, 0x2c, 0xbb, 0xf,  0x2b, 0x17, 0x63, 0x1a, 0x0,  0x5,
      0x1b, 0x4a, 0x86, 0xce, 0x1f, 0x0,  0x9,  0x80, 0xf1, 0xa8, 0xa,  0xf2, 0xbb, 0xf0, 0xb1, 0x55, 0x0,  0x12, 0x59,
      0xe3, 0xd3, 0xde, 0x48, 0xe5, 0xb5, 0x7a, 0xe1, 0x58, 0x43, 0x95, 0x44, 0x26, 0x40, 0xd0, 0x4c, 0x44, 0x0,  0xf,
      0x81, 0x52, 0xbc, 0x3c, 0x61, 0x8e, 0xf0, 0x34, 0xf4, 0x66, 0x0,  0x40, 0x33, 0x2f, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x11, 0x38, 0xfa, 0xa6, 0x3c, 0xfc, 0x72, 0xf, 0x11, 0x36,
                           0x23, 0xef, 0x9f, 0x7d, 0x7f, 0xf4, 0x20, 0xc, 0x42};
  uint8_t bytesprops1[] = {0xb2, 0x82, 0xd3, 0x8c, 0xf,  0xdb, 0xb9, 0xd4, 0xf3, 0x48, 0x91,
                           0x60, 0x2e, 0xcf, 0x8f, 0x10, 0x54, 0x9,  0x2d, 0x28, 0x80};
  uint8_t bytesprops2[] = {0x7c, 0xc7, 0x42};
  uint8_t bytesprops3[] = {0xc0, 0xed, 0x1f, 0x3e, 0x60, 0xaa, 0xee, 0xfa, 0x63, 0x63,
                           0x82, 0x33, 0x33, 0x21, 0xa6, 0xea, 0xa5, 0x3e, 0xad};
  uint8_t bytesprops4[] = {0xb9, 0x19, 0x67, 0x96, 0x9b, 0xe3, 0x1e, 0xa3, 0xb7, 0x53};
  uint8_t bytesprops5[] = {0x61, 0x60, 0xb, 0xbf, 0x1a, 0x70, 0x76, 0xfe, 0xe7, 0xe8, 0x45,
                           0x95, 0xe9, 0x9, 0xa7, 0x3,  0x1b, 0xa3, 0x5b, 0x8a, 0x55};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12941}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25976}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23357}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1922}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2342}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26447}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16720}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26061}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x4d, 0xcf, 0x76, 0xed, 0x48, 0x37, 0x44, 0x5c, 0xe1, 0x47, 0x5a, 0xdb, 0x8c,
                               0xf,  0x6f, 0x4a, 0xd8, 0x8d, 0xc5, 0xc4, 0xc,  0xfe, 0xee, 0xd8, 0x6f, 0xa};
  uint8_t byteswillprops1[] = {0xb2, 0x9c, 0x52, 0x5c, 0x9b, 0xdb, 0x3e, 0xee, 0x17, 0xf8, 0x46, 0xae, 0x2a, 0xa4,
                               0xe7, 0x1d, 0x22, 0x8e, 0xfb, 0xf3, 0xa,  0x4d, 0x97, 0x80, 0xc4, 0x69, 0x32};
  uint8_t byteswillprops2[] = {0x7b, 0x67, 0xe0, 0xaf, 0x8,  0xe8, 0xa3, 0xe1, 0x5f, 0x88, 0x95, 0xa7,
                               0xc2, 0x0,  0xca, 0x46, 0x94, 0x64, 0xfc, 0x19, 0x91, 0x15, 0xdd, 0x89};
  uint8_t byteswillprops3[] = {0x8,  0xf8, 0x2b, 0xbd, 0xe2, 0x15, 0x9b, 0x2c, 0x90, 0xc0, 0x4b, 0x9d, 0x68, 0xd6, 0x5,
                               0x62, 0x2a, 0x33, 0x26, 0xc2, 0x75, 0x8e, 0xb7, 0x55, 0x1a, 0x5e, 0x2f, 0x38, 0xad};
  uint8_t byteswillprops4[] = {0xad, 0x93, 0x22, 0x21, 0x64, 0xa6, 0xf2, 0x21,
                               0xd8, 0xcd, 0x13, 0x90, 0xf2, 0xfe, 0x93, 0x23};
  uint8_t byteswillprops5[] = {0xfa, 0x2b, 0xee, 0xfe, 0xb9, 0xd0, 0x45, 0x9c, 0x3d, 0x75, 0xc0, 0x6e, 0x51,
                               0x84, 0x41, 0x7e, 0xeb, 0x68, 0xfb, 0x69, 0x56, 0xa5, 0x3e, 0x2a, 0x44};
  uint8_t byteswillprops6[] = {0xa2, 0xb4, 0xc1, 0x9a, 0xaa, 0xc3, 0xef, 0xff, 0x6,  0x86, 0x53, 0x93, 0x28,
                               0x6c, 0x63, 0xf2, 0x49, 0x84, 0xd8, 0x16, 0xad, 0x4f, 0xa,  0x62, 0x69, 0x29};
  uint8_t byteswillprops7[] = {0};
  uint8_t byteswillprops8[] = {0xe6, 0x8b, 0x7b, 0x1b, 0xea, 0xcf, 0x76, 0x8a, 0x1d, 0xdc, 0x3e, 0xbf, 0x6d, 0x6c};
  uint8_t byteswillprops9[] = {0x2c, 0x2d, 0x62, 0x24, 0x10, 0x2d, 0x18, 0xda, 0x17, 0x84, 0x84,
                               0x3d, 0x50, 0x6c, 0xf7, 0xba, 0x47, 0x4c, 0xb4, 0xb8, 0xd8, 0xf7};
  uint8_t byteswillprops10[] = {0x87, 0x94, 0x80, 0xd2, 0x6a, 0xd0, 0x4d, 0x66, 0xe8, 0xa6, 0xe7, 0x3f, 0xac, 0x18,
                                0xae, 0x37, 0xf8, 0xb5, 0x39, 0x3e, 0x64, 0x6a, 0xc9, 0x8a, 0xe7, 0xa3, 0x3d, 0x49};
  uint8_t byteswillprops11[] = {0xbe, 0x2, 0x37, 0x93, 0x8b, 0x4a, 0x76, 0x3c, 0xfe, 0xdb, 0x48, 0x2c, 0xbb, 0xf, 0x2b};
  uint8_t byteswillprops12[] = {0x1b, 0x4a, 0x86, 0xce, 0x1f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7921}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1864}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28800}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18639}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14991}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3173}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11821}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20831}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12214}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0xf1, 0xa8, 0xa, 0xf2, 0xbb, 0xf0, 0xb1, 0x55};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x59, 0xe3, 0xd3, 0xde, 0x48, 0xe5, 0xb5, 0x7a, 0xe1,
                                  0x58, 0x43, 0x95, 0x44, 0x26, 0x40, 0xd0, 0x4c, 0x44};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24021;
  uint8_t client_id_bytes[] = {0xe2, 0x11, 0x62, 0xa2, 0x55, 0x23, 0x5b, 0x6c, 0xde, 0x65, 0xd7, 0x85, 0xec, 0x1f,
                               0x4f, 0xf6, 0x54, 0xc4, 0x94, 0x5d, 0x8,  0x71, 0xbf, 0xeb, 0x89, 0x61, 0x7a};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x81, 0x52, 0xbc, 0x3c, 0x61, 0x8e, 0xf0, 0x34, 0xf4, 0x66, 0x0, 0x40, 0x33, 0x2f, 0x1e};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "i\250\FS\227S", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 30539, _connID = "\226\ENQ\244\222I6\213j\202\&9\230\198\255\173\133\239\DC3\228\134\186]", _properties
// = [PropTopicAlias 30070,PropResponseTopic
// "\207\203\&4l6a\225}_\218\200_88\186w#W\181\203\ETX\188K\216\248\207vx,",PropContentType
// "\150\&2\210\244\168uq\219",PropReceiveMaximum 6983,PropReasonString
// "\184Y\216\158\237X\146\152\221\143\231\237\SO?\198r\130(\148\241",PropReceiveMaximum 9483,PropResponseTopic
// "\n\ACK\188\160\231\188i\185T\170E6\166\&3\242\ESC\150}",PropCorrelationData "[^Y\181\SUB\129",PropWillDelayInterval
// 12175,PropResponseTopic ";4\CAN\166oQ<M,",PropAuthenticationMethod "\EOTsi",PropReasonString
// "{R\214\178\238s\180\180\SOAb",PropAuthenticationData "",PropWillDelayInterval 9749,PropTopicAlias
// 26462,PropMessageExpiryInterval 21839,PropMaximumQoS 125,PropResponseTopic
// "\160v\167\158\SUB0@\ETX",PropSubscriptionIdentifier 0,PropRequestProblemInformation 151,PropRetainAvailable
// 159,PropResponseInformation "\129RJ\181&\205\194"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0xe5, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x40, 0x77, 0x4b, 0xbb, 0x1,  0x23, 0x75,
                   0x76, 0x8,  0x0,  0x1d, 0xcf, 0xcb, 0x34, 0x6c, 0x36, 0x61, 0xe1, 0x7d, 0x5f, 0xda, 0xc8, 0x5f, 0x38,
                   0x38, 0xba, 0x77, 0x23, 0x57, 0xb5, 0xcb, 0x3,  0xbc, 0x4b, 0xd8, 0xf8, 0xcf, 0x76, 0x78, 0x2c, 0x3,
                   0x0,  0x8,  0x96, 0x32, 0xd2, 0xf4, 0xa8, 0x75, 0x71, 0xdb, 0x21, 0x1b, 0x47, 0x1f, 0x0,  0x14, 0xb8,
                   0x59, 0xd8, 0x9e, 0xed, 0x58, 0x92, 0x98, 0xdd, 0x8f, 0xe7, 0xed, 0xe,  0x3f, 0xc6, 0x72, 0x82, 0x28,
                   0x94, 0xf1, 0x21, 0x25, 0xb,  0x8,  0x0,  0x12, 0xa,  0x6,  0xbc, 0xa0, 0xe7, 0xbc, 0x69, 0xb9, 0x54,
                   0xaa, 0x45, 0x36, 0xa6, 0x33, 0xf2, 0x1b, 0x96, 0x7d, 0x9,  0x0,  0x6,  0x5b, 0x5e, 0x59, 0xb5, 0x1a,
                   0x81, 0x18, 0x0,  0x0,  0x2f, 0x8f, 0x8,  0x0,  0x9,  0x3b, 0x34, 0x18, 0xa6, 0x6f, 0x51, 0x3c, 0x4d,
                   0x2c, 0x15, 0x0,  0x3,  0x4,  0x73, 0x69, 0x1f, 0x0,  0xb,  0x7b, 0x52, 0xd6, 0xb2, 0xee, 0x73, 0xb4,
                   0xb4, 0xe,  0x41, 0x62, 0x16, 0x0,  0x0,  0x18, 0x0,  0x0,  0x26, 0x15, 0x23, 0x67, 0x5e, 0x2,  0x0,
                   0x0,  0x55, 0x4f, 0x24, 0x7d, 0x8,  0x0,  0x8,  0xa0, 0x76, 0xa7, 0x9e, 0x1a, 0x30, 0x40, 0x3,  0xb,
                   0x0,  0x17, 0x97, 0x25, 0x9f, 0x1a, 0x0,  0x7,  0x81, 0x52, 0x4a, 0xb5, 0x26, 0xcd, 0xc2, 0x0,  0x15,
                   0xe2, 0x5,  0xf4, 0xde, 0x49, 0x36, 0xd5, 0x6a, 0xca, 0x39, 0xe6, 0xc6, 0xff, 0xad, 0x85, 0xef, 0x13,
                   0xe4, 0x86, 0xba, 0x5d, 0x0,  0x5,  0x69, 0xfa, 0x1c, 0xe3, 0x53};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xcf, 0xcb, 0x34, 0x6c, 0x36, 0x61, 0xe1, 0x7d, 0x5f, 0xda, 0xc8, 0x5f, 0x38, 0x38, 0xba,
                           0x77, 0x23, 0x57, 0xb5, 0xcb, 0x3,  0xbc, 0x4b, 0xd8, 0xf8, 0xcf, 0x76, 0x78, 0x2c};
  uint8_t bytesprops1[] = {0x96, 0x32, 0xd2, 0xf4, 0xa8, 0x75, 0x71, 0xdb};
  uint8_t bytesprops2[] = {0xb8, 0x59, 0xd8, 0x9e, 0xed, 0x58, 0x92, 0x98, 0xdd, 0x8f,
                           0xe7, 0xed, 0xe,  0x3f, 0xc6, 0x72, 0x82, 0x28, 0x94, 0xf1};
  uint8_t bytesprops3[] = {0xa,  0x6,  0xbc, 0xa0, 0xe7, 0xbc, 0x69, 0xb9, 0x54,
                           0xaa, 0x45, 0x36, 0xa6, 0x33, 0xf2, 0x1b, 0x96, 0x7d};
  uint8_t bytesprops4[] = {0x5b, 0x5e, 0x59, 0xb5, 0x1a, 0x81};
  uint8_t bytesprops5[] = {0x3b, 0x34, 0x18, 0xa6, 0x6f, 0x51, 0x3c, 0x4d, 0x2c};
  uint8_t bytesprops6[] = {0x4, 0x73, 0x69};
  uint8_t bytesprops7[] = {0x7b, 0x52, 0xd6, 0xb2, 0xee, 0x73, 0xb4, 0xb4, 0xe, 0x41, 0x62};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0xa0, 0x76, 0xa7, 0x9e, 0x1a, 0x30, 0x40, 0x3};
  uint8_t bytesprops10[] = {0x81, 0x52, 0x4a, 0xb5, 0x26, 0xcd, 0xc2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30070}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6983}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9483}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12175}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9749}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26462}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21839}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30539;
  uint8_t client_id_bytes[] = {0xe2, 0x5,  0xf4, 0xde, 0x49, 0x36, 0xd5, 0x6a, 0xca, 0x39, 0xe6,
                               0xc6, 0xff, 0xad, 0x85, 0xef, 0x13, 0xe4, 0x86, 0xba, 0x5d};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x69, 0xfa, 0x1c, 0xe3, 0x53};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\225\203mIB\148\147s", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS0, _willTopic = "`\SO\132\139\ESC\222W\198\STXb$", _willMsg =
// "j\225L%\SYN:R\144\143\244\201FZce\154\SO[\DC1\183\205\197\134J,\184", _willProps = [PropTopicAliasMaximum
// 16098,PropTopicAlias 13294,PropSubscriptionIdentifier 13,PropWillDelayInterval 3829,PropResponseInformation
// "",PropRequestResponseInformation 158,PropReasonString
// "\211\154\249\151\225\140v\SOH\143\234\204\NULcX`\185M\130\182",PropSubscriptionIdentifier 0,PropMaximumPacketSize
// 30261,PropServerReference "\151\170",PropTopicAlias 2905,PropRequestResponseInformation 163,PropRetainAvailable
// 244,PropWillDelayInterval 24559,PropServerKeepAlive 1251,PropReasonString
// "\238So\171\214\GS0\188\147\DEL\205[\211\&6\231\255\161\128\&3y:\USfN\240'\210\130E",PropCorrelationData
// "{\180\&9X\145\174\SI\r\197\172",PropMessageExpiryInterval 31230,PropUserProperty "q\175P\244\a\184\161\SYN"
// "\128b\212\147\139p",PropRequestResponseInformation 119]}), _cleanSession = False, _keepAlive = 14155, _connID =
// "\190I\DC1\187\DEL", _properties = [PropSubscriptionIdentifier 6,PropReceiveMaximum
// 27185,PropSharedSubscriptionAvailable 85,PropAssignedClientIdentifier
// "M~\220\251o\DC2\160L\144\134",PropRequestResponseInformation 39]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0xe7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0x37, 0x4b, 0x16, 0xb,  0x6,  0x21,
                   0x6a, 0x31, 0x2a, 0x55, 0x12, 0x0,  0xa,  0x4d, 0x7e, 0xdc, 0xfb, 0x6f, 0x12, 0xa0, 0x4c, 0x90, 0x86,
                   0x19, 0x27, 0x0,  0x5,  0xbe, 0x49, 0x11, 0xbb, 0x7f, 0x8a, 0x1,  0x22, 0x3e, 0xe2, 0x23, 0x33, 0xee,
                   0xb,  0xd,  0x18, 0x0,  0x0,  0xe,  0xf5, 0x1a, 0x0,  0x0,  0x19, 0x9e, 0x1f, 0x0,  0x13, 0xd3, 0x9a,
                   0xf9, 0x97, 0xe1, 0x8c, 0x76, 0x1,  0x8f, 0xea, 0xcc, 0x0,  0x63, 0x58, 0x60, 0xb9, 0x4d, 0x82, 0xb6,
                   0xb,  0x0,  0x27, 0x0,  0x0,  0x76, 0x35, 0x1c, 0x0,  0x2,  0x97, 0xaa, 0x23, 0xb,  0x59, 0x19, 0xa3,
                   0x25, 0xf4, 0x18, 0x0,  0x0,  0x5f, 0xef, 0x13, 0x4,  0xe3, 0x1f, 0x0,  0x1d, 0xee, 0x53, 0x6f, 0xab,
                   0xd6, 0x1d, 0x30, 0xbc, 0x93, 0x7f, 0xcd, 0x5b, 0xd3, 0x36, 0xe7, 0xff, 0xa1, 0x80, 0x33, 0x79, 0x3a,
                   0x1f, 0x66, 0x4e, 0xf0, 0x27, 0xd2, 0x82, 0x45, 0x9,  0x0,  0xa,  0x7b, 0xb4, 0x39, 0x58, 0x91, 0xae,
                   0xf,  0xd,  0xc5, 0xac, 0x2,  0x0,  0x0,  0x79, 0xfe, 0x26, 0x0,  0x8,  0x71, 0xaf, 0x50, 0xf4, 0x7,
                   0xb8, 0xa1, 0x16, 0x0,  0x6,  0x80, 0x62, 0xd4, 0x93, 0x8b, 0x70, 0x19, 0x77, 0x0,  0xb,  0x60, 0xe,
                   0x84, 0x8b, 0x1b, 0xde, 0x57, 0xc6, 0x2,  0x62, 0x24, 0x0,  0x1a, 0x6a, 0xe1, 0x4c, 0x25, 0x16, 0x3a,
                   0x52, 0x90, 0x8f, 0xf4, 0xc9, 0x46, 0x5a, 0x63, 0x65, 0x9a, 0xe,  0x5b, 0x11, 0xb7, 0xcd, 0xc5, 0x86,
                   0x4a, 0x2c, 0xb8, 0x0,  0x8,  0xe1, 0xcb, 0x6d, 0x49, 0x42, 0x94, 0x93, 0x73};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4d, 0x7e, 0xdc, 0xfb, 0x6f, 0x12, 0xa0, 0x4c, 0x90, 0x86};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27185}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0xd3, 0x9a, 0xf9, 0x97, 0xe1, 0x8c, 0x76, 0x1,  0x8f, 0xea,
                               0xcc, 0x0,  0x63, 0x58, 0x60, 0xb9, 0x4d, 0x82, 0xb6};
  uint8_t byteswillprops2[] = {0x97, 0xaa};
  uint8_t byteswillprops3[] = {0xee, 0x53, 0x6f, 0xab, 0xd6, 0x1d, 0x30, 0xbc, 0x93, 0x7f, 0xcd, 0x5b, 0xd3, 0x36, 0xe7,
                               0xff, 0xa1, 0x80, 0x33, 0x79, 0x3a, 0x1f, 0x66, 0x4e, 0xf0, 0x27, 0xd2, 0x82, 0x45};
  uint8_t byteswillprops4[] = {0x7b, 0xb4, 0x39, 0x58, 0x91, 0xae, 0xf, 0xd, 0xc5, 0xac};
  uint8_t byteswillprops6[] = {0x80, 0x62, 0xd4, 0x93, 0x8b, 0x70};
  uint8_t byteswillprops5[] = {0x71, 0xaf, 0x50, 0xf4, 0x7, 0xb8, 0xa1, 0x16};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16098}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13294}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3829}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30261}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2905}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24559}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1251}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31230}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops5}, .v = {6, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 119}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x60, 0xe, 0x84, 0x8b, 0x1b, 0xde, 0x57, 0xc6, 0x2, 0x62, 0x24};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6a, 0xe1, 0x4c, 0x25, 0x16, 0x3a, 0x52, 0x90, 0x8f, 0xf4, 0xc9, 0x46, 0x5a,
                                  0x63, 0x65, 0x9a, 0xe,  0x5b, 0x11, 0xb7, 0xcd, 0xc5, 0x86, 0x4a, 0x2c, 0xb8};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 14155;
  uint8_t client_id_bytes[] = {0xbe, 0x49, 0x11, 0xbb, 0x7f};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe1, 0xcb, 0x6d, 0x49, 0x42, 0x94, 0x93, 0x73};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\bA\DC1\DEL\213g\EMC\130^", _password = Just
// "\188\164\213\\P1\226\188\191\201\185\135\150z\216\157\DC4", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\171C0\171", _willMsg =
// "6\164j\195\226\206\EOT\186\FS?\207\245\154\164\223jR\224#2sJ\165N\145#H\196\159\146", _willProps = [PropMaximumQoS
// 144,PropAuthenticationMethod "\193<\182\202~\233P\204\174F\229MGp\DEL_@\138u\219\207\159d",PropResponseTopic
// "\164\151+\185\ENQ@\SYN\DLE\t\226\231\199k\155\ETX\204.\222%",PropSharedSubscriptionAvailable 34,PropReasonString
// "\166\135\167A\169\204\SYN\147\141\240\254\200ku\n~^B\212R\231\EM7\158",PropWillDelayInterval 10273,PropContentType
// "\190m\183\186\147b\198\236y\ENQ\239S\182\231\DC4\247\a\220\205\b\v}\192\n\151;\157\199\171\159",PropTopicAlias
// 16211,PropCorrelationData "\148\155t\SUB\205Evl\165\220\250"]}), _cleanSession = True, _keepAlive = 29647, _connID =
// "\176\248\150\&5VEy\GS\DC1kSt(`\136\SUB\233\233\156\174\213", _properties = [PropAuthenticationData
// "\241\\\187\251\178#S\140\135\&6\174\FS\230\&5r9\CAN!",PropContentType
// "\193\131QV\228\229K\STXr\205\215q\207}\229\r\236",PropMaximumPacketSize 11364,PropSessionExpiryInterval
// 7409,PropSharedSubscriptionAvailable 158,PropAuthenticationMethod "\225?m?\158\200aC",PropResponseTopic
// "",PropSharedSubscriptionAvailable 85,PropRetainAvailable 97,PropWildcardSubscriptionAvailable 211,PropResponseTopic
// "H!\241\128\ETX\\(\185\160\211\135\196\214\&4_\164",PropPayloadFormatIndicator 39,PropSessionExpiryInterval
// 3336,PropContentType "
// }\FS\US\t\172\167;l:\a\237\164\195\188\214\212#\212\177\157s\246x\231",PropSubscriptionIdentifierAvailable
// 74,PropAuthenticationMethod "f\172#\244\162\173F#\ETBc",PropMessageExpiryInterval 17913,PropContentType
// "\DC4\210:\237\RST_\158"]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0x8e, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x73, 0xcf, 0x9e, 0x1,  0x16, 0x0,  0x12, 0xf1,
      0x5c, 0xbb, 0xfb, 0xb2, 0x23, 0x53, 0x8c, 0x87, 0x36, 0xae, 0x1c, 0xe6, 0x35, 0x72, 0x39, 0x18, 0x21, 0x3,  0x0,
      0x11, 0xc1, 0x83, 0x51, 0x56, 0xe4, 0xe5, 0x4b, 0x2,  0x72, 0xcd, 0xd7, 0x71, 0xcf, 0x7d, 0xe5, 0xd,  0xec, 0x27,
      0x0,  0x0,  0x2c, 0x64, 0x11, 0x0,  0x0,  0x1c, 0xf1, 0x2a, 0x9e, 0x15, 0x0,  0x8,  0xe1, 0x3f, 0x6d, 0x3f, 0x9e,
      0xc8, 0x61, 0x43, 0x8,  0x0,  0x0,  0x2a, 0x55, 0x25, 0x61, 0x28, 0xd3, 0x8,  0x0,  0x10, 0x48, 0x21, 0xf1, 0x80,
      0x3,  0x5c, 0x28, 0xb9, 0xa0, 0xd3, 0x87, 0xc4, 0xd6, 0x34, 0x5f, 0xa4, 0x1,  0x27, 0x11, 0x0,  0x0,  0xd,  0x8,
      0x3,  0x0,  0x19, 0x20, 0x7d, 0x1c, 0x1f, 0x9,  0xac, 0xa7, 0x3b, 0x6c, 0x3a, 0x7,  0xed, 0xa4, 0xc3, 0xbc, 0xd6,
      0xd4, 0x23, 0xd4, 0xb1, 0x9d, 0x73, 0xf6, 0x78, 0xe7, 0x29, 0x4a, 0x15, 0x0,  0xa,  0x66, 0xac, 0x23, 0xf4, 0xa2,
      0xad, 0x46, 0x23, 0x17, 0x63, 0x2,  0x0,  0x0,  0x45, 0xf9, 0x3,  0x0,  0x8,  0x14, 0xd2, 0x3a, 0xed, 0x1e, 0x54,
      0x5f, 0x9e, 0x0,  0x15, 0xb0, 0xf8, 0x96, 0x35, 0x56, 0x45, 0x79, 0x1d, 0x11, 0x6b, 0x53, 0x74, 0x28, 0x60, 0x88,
      0x1a, 0xe9, 0xe9, 0x9c, 0xae, 0xd5, 0x86, 0x1,  0x24, 0x90, 0x15, 0x0,  0x17, 0xc1, 0x3c, 0xb6, 0xca, 0x7e, 0xe9,
      0x50, 0xcc, 0xae, 0x46, 0xe5, 0x4d, 0x47, 0x70, 0x7f, 0x5f, 0x40, 0x8a, 0x75, 0xdb, 0xcf, 0x9f, 0x64, 0x8,  0x0,
      0x13, 0xa4, 0x97, 0x2b, 0xb9, 0x5,  0x40, 0x16, 0x10, 0x9,  0xe2, 0xe7, 0xc7, 0x6b, 0x9b, 0x3,  0xcc, 0x2e, 0xde,
      0x25, 0x2a, 0x22, 0x1f, 0x0,  0x18, 0xa6, 0x87, 0xa7, 0x41, 0xa9, 0xcc, 0x16, 0x93, 0x8d, 0xf0, 0xfe, 0xc8, 0x6b,
      0x75, 0xa,  0x7e, 0x5e, 0x42, 0xd4, 0x52, 0xe7, 0x19, 0x37, 0x9e, 0x18, 0x0,  0x0,  0x28, 0x21, 0x3,  0x0,  0x1e,
      0xbe, 0x6d, 0xb7, 0xba, 0x93, 0x62, 0xc6, 0xec, 0x79, 0x5,  0xef, 0x53, 0xb6, 0xe7, 0x14, 0xf7, 0x7,  0xdc, 0xcd,
      0x8,  0xb,  0x7d, 0xc0, 0xa,  0x97, 0x3b, 0x9d, 0xc7, 0xab, 0x9f, 0x23, 0x3f, 0x53, 0x9,  0x0,  0xb,  0x94, 0x9b,
      0x74, 0x1a, 0xcd, 0x45, 0x76, 0x6c, 0xa5, 0xdc, 0xfa, 0x0,  0x4,  0xab, 0x43, 0x30, 0xab, 0x0,  0x1e, 0x36, 0xa4,
      0x6a, 0xc3, 0xe2, 0xce, 0x4,  0xba, 0x1c, 0x3f, 0xcf, 0xf5, 0x9a, 0xa4, 0xdf, 0x6a, 0x52, 0xe0, 0x23, 0x32, 0x73,
      0x4a, 0xa5, 0x4e, 0x91, 0x23, 0x48, 0xc4, 0x9f, 0x92, 0x0,  0xa,  0x8,  0x41, 0x11, 0x7f, 0xd5, 0x67, 0x19, 0x43,
      0x82, 0x5e, 0x0,  0x11, 0xbc, 0xa4, 0xd5, 0x5c, 0x50, 0x31, 0xe2, 0xbc, 0xbf, 0xc9, 0xb9, 0x87, 0x96, 0x7a, 0xd8,
      0x9d, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf1, 0x5c, 0xbb, 0xfb, 0xb2, 0x23, 0x53, 0x8c, 0x87,
                           0x36, 0xae, 0x1c, 0xe6, 0x35, 0x72, 0x39, 0x18, 0x21};
  uint8_t bytesprops1[] = {0xc1, 0x83, 0x51, 0x56, 0xe4, 0xe5, 0x4b, 0x2, 0x72,
                           0xcd, 0xd7, 0x71, 0xcf, 0x7d, 0xe5, 0xd,  0xec};
  uint8_t bytesprops2[] = {0xe1, 0x3f, 0x6d, 0x3f, 0x9e, 0xc8, 0x61, 0x43};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x48, 0x21, 0xf1, 0x80, 0x3,  0x5c, 0x28, 0xb9,
                           0xa0, 0xd3, 0x87, 0xc4, 0xd6, 0x34, 0x5f, 0xa4};
  uint8_t bytesprops5[] = {0x20, 0x7d, 0x1c, 0x1f, 0x9,  0xac, 0xa7, 0x3b, 0x6c, 0x3a, 0x7,  0xed, 0xa4,
                           0xc3, 0xbc, 0xd6, 0xd4, 0x23, 0xd4, 0xb1, 0x9d, 0x73, 0xf6, 0x78, 0xe7};
  uint8_t bytesprops6[] = {0x66, 0xac, 0x23, 0xf4, 0xa2, 0xad, 0x46, 0x23, 0x17, 0x63};
  uint8_t bytesprops7[] = {0x14, 0xd2, 0x3a, 0xed, 0x1e, 0x54, 0x5f, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11364}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7409}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3336}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17913}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc1, 0x3c, 0xb6, 0xca, 0x7e, 0xe9, 0x50, 0xcc, 0xae, 0x46, 0xe5, 0x4d,
                               0x47, 0x70, 0x7f, 0x5f, 0x40, 0x8a, 0x75, 0xdb, 0xcf, 0x9f, 0x64};
  uint8_t byteswillprops1[] = {0xa4, 0x97, 0x2b, 0xb9, 0x5, 0x40, 0x16, 0x10, 0x9, 0xe2,
                               0xe7, 0xc7, 0x6b, 0x9b, 0x3, 0xcc, 0x2e, 0xde, 0x25};
  uint8_t byteswillprops2[] = {0xa6, 0x87, 0xa7, 0x41, 0xa9, 0xcc, 0x16, 0x93, 0x8d, 0xf0, 0xfe, 0xc8,
                               0x6b, 0x75, 0xa,  0x7e, 0x5e, 0x42, 0xd4, 0x52, 0xe7, 0x19, 0x37, 0x9e};
  uint8_t byteswillprops3[] = {0xbe, 0x6d, 0xb7, 0xba, 0x93, 0x62, 0xc6, 0xec, 0x79, 0x5,
                               0xef, 0x53, 0xb6, 0xe7, 0x14, 0xf7, 0x7,  0xdc, 0xcd, 0x8,
                               0xb,  0x7d, 0xc0, 0xa,  0x97, 0x3b, 0x9d, 0xc7, 0xab, 0x9f};
  uint8_t byteswillprops4[] = {0x94, 0x9b, 0x74, 0x1a, 0xcd, 0x45, 0x76, 0x6c, 0xa5, 0xdc, 0xfa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10273}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16211}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xab, 0x43, 0x30, 0xab};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x36, 0xa4, 0x6a, 0xc3, 0xe2, 0xce, 0x4,  0xba, 0x1c, 0x3f,
                                  0xcf, 0xf5, 0x9a, 0xa4, 0xdf, 0x6a, 0x52, 0xe0, 0x23, 0x32,
                                  0x73, 0x4a, 0xa5, 0x4e, 0x91, 0x23, 0x48, 0xc4, 0x9f, 0x92};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29647;
  uint8_t client_id_bytes[] = {0xb0, 0xf8, 0x96, 0x35, 0x56, 0x45, 0x79, 0x1d, 0x11, 0x6b, 0x53,
                               0x74, 0x28, 0x60, 0x88, 0x1a, 0xe9, 0xe9, 0x9c, 0xae, 0xd5};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8, 0x41, 0x11, 0x7f, 0xd5, 0x67, 0x19, 0x43, 0x82, 0x5e};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbc, 0xa4, 0xd5, 0x5c, 0x50, 0x31, 0xe2, 0xbc, 0xbf,
                              0xc9, 0xb9, 0x87, 0x96, 0x7a, 0xd8, 0x9d, 0x14};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\240\ETX\187\240'\219\214:\CANw", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\137\169\150c", _willMsg = "\189", _willProps =
// [PropResponseTopic "k5\207N\181\192WU,\SIe4\172\254\210\EM\ae\176\DLE-",PropAssignedClientIdentifier
// "\nJ\166j\194\158\239?Y\148\224\159\141\173\241\ESC\191If\142\DC1\201\230\199\&0\253\243\&02",PropAuthenticationMethod
// "w\DC2\255\210\133\191\202\215\248T\185\164\135\ENQ_\185aJ",PropAuthenticationData
// "\v)O\232P$\206Kf\ETX;\182\&3C\198\188\243f\183",PropMessageExpiryInterval 28426,PropSharedSubscriptionAvailable
// 168,PropCorrelationData "?\138\202\t\190\143x\n\f@\196",PropResponseTopic
// "\247e\243Z\193\202\&4F\SUB\b0\172\&7\252\167\243r\DEL\190!aQ\143?U",PropResponseInformation
// "\188\219\163[f\EM\137I)\RS\DLE",PropTopicAlias 12835]}), _cleanSession = False, _keepAlive = 19444, _connID =
// "\151\173\128\254\189>\225\168\184@\169\179", _properties = [PropMessageExpiryInterval 2574,PropContentType
// "\ETX\180^0\174\203\175h2\t\204\145\238\183\SI\144JP\142",PropSubscriptionIdentifier
// 30,PropSharedSubscriptionAvailable 232,PropContentType
// "-\233XZ\212\234\161R\165!MD\158\231\\\199\&0\232\138",PropAssignedClientIdentifier "s",PropMaximumQoS
// 151,PropAssignedClientIdentifier "q\162j\243\168Rj\EM
// _\246\203\221;\149\192\232y\RS\DLE\214\246\129\143\EM|a",PropWildcardSubscriptionAvailable 108,PropWillDelayInterval
// 1033,PropMessageExpiryInterval 24445,PropTopicAlias 23778,PropSessionExpiryInterval 16092,PropMaximumPacketSize
// 1282,PropServerKeepAlive 12039]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8c, 0x4b, 0xf4, 0x75, 0x2,  0x0,  0x0,  0xa,  0xe,
      0x3,  0x0,  0x13, 0x3,  0xb4, 0x5e, 0x30, 0xae, 0xcb, 0xaf, 0x68, 0x32, 0x9,  0xcc, 0x91, 0xee, 0xb7, 0xf,  0x90,
      0x4a, 0x50, 0x8e, 0xb,  0x1e, 0x2a, 0xe8, 0x3,  0x0,  0x13, 0x2d, 0xe9, 0x58, 0x5a, 0xd4, 0xea, 0xa1, 0x52, 0xa5,
      0x21, 0x4d, 0x44, 0x9e, 0xe7, 0x5c, 0xc7, 0x30, 0xe8, 0x8a, 0x12, 0x0,  0x1,  0x73, 0x24, 0x97, 0x12, 0x0,  0x1b,
      0x71, 0xa2, 0x6a, 0xf3, 0xa8, 0x52, 0x6a, 0x19, 0x20, 0x5f, 0xf6, 0xcb, 0xdd, 0x3b, 0x95, 0xc0, 0xe8, 0x79, 0x1e,
      0x10, 0xd6, 0xf6, 0x81, 0x8f, 0x19, 0x7c, 0x61, 0x28, 0x6c, 0x18, 0x0,  0x0,  0x4,  0x9,  0x2,  0x0,  0x0,  0x5f,
      0x7d, 0x23, 0x5c, 0xe2, 0x11, 0x0,  0x0,  0x3e, 0xdc, 0x27, 0x0,  0x0,  0x5,  0x2,  0x13, 0x2f, 0x7,  0x0,  0xc,
      0x97, 0xad, 0x80, 0xfe, 0xbd, 0x3e, 0xe1, 0xa8, 0xb8, 0x40, 0xa9, 0xb3, 0xa5, 0x1,  0x8,  0x0,  0x15, 0x6b, 0x35,
      0xcf, 0x4e, 0xb5, 0xc0, 0x57, 0x55, 0x2c, 0xf,  0x65, 0x34, 0xac, 0xfe, 0xd2, 0x19, 0x7,  0x65, 0xb0, 0x10, 0x2d,
      0x12, 0x0,  0x1d, 0xa,  0x4a, 0xa6, 0x6a, 0xc2, 0x9e, 0xef, 0x3f, 0x59, 0x94, 0xe0, 0x9f, 0x8d, 0xad, 0xf1, 0x1b,
      0xbf, 0x49, 0x66, 0x8e, 0x11, 0xc9, 0xe6, 0xc7, 0x30, 0xfd, 0xf3, 0x30, 0x32, 0x15, 0x0,  0x12, 0x77, 0x12, 0xff,
      0xd2, 0x85, 0xbf, 0xca, 0xd7, 0xf8, 0x54, 0xb9, 0xa4, 0x87, 0x5,  0x5f, 0xb9, 0x61, 0x4a, 0x16, 0x0,  0x13, 0xb,
      0x29, 0x4f, 0xe8, 0x50, 0x24, 0xce, 0x4b, 0x66, 0x3,  0x3b, 0xb6, 0x33, 0x43, 0xc6, 0xbc, 0xf3, 0x66, 0xb7, 0x2,
      0x0,  0x0,  0x6f, 0xa,  0x2a, 0xa8, 0x9,  0x0,  0xb,  0x3f, 0x8a, 0xca, 0x9,  0xbe, 0x8f, 0x78, 0xa,  0xc,  0x40,
      0xc4, 0x8,  0x0,  0x19, 0xf7, 0x65, 0xf3, 0x5a, 0xc1, 0xca, 0x34, 0x46, 0x1a, 0x8,  0x30, 0xac, 0x37, 0xfc, 0xa7,
      0xf3, 0x72, 0x7f, 0xbe, 0x21, 0x61, 0x51, 0x8f, 0x3f, 0x55, 0x1a, 0x0,  0xb,  0xbc, 0xdb, 0xa3, 0x5b, 0x66, 0x19,
      0x89, 0x49, 0x29, 0x1e, 0x10, 0x23, 0x32, 0x23, 0x0,  0x4,  0x89, 0xa9, 0x96, 0x63, 0x0,  0x1,  0xbd, 0x0,  0xa,
      0xf0, 0x3,  0xbb, 0xf0, 0x27, 0xdb, 0xd6, 0x3a, 0x18, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3,  0xb4, 0x5e, 0x30, 0xae, 0xcb, 0xaf, 0x68, 0x32, 0x9,
                           0xcc, 0x91, 0xee, 0xb7, 0xf,  0x90, 0x4a, 0x50, 0x8e};
  uint8_t bytesprops1[] = {0x2d, 0xe9, 0x58, 0x5a, 0xd4, 0xea, 0xa1, 0x52, 0xa5, 0x21,
                           0x4d, 0x44, 0x9e, 0xe7, 0x5c, 0xc7, 0x30, 0xe8, 0x8a};
  uint8_t bytesprops2[] = {0x73};
  uint8_t bytesprops3[] = {0x71, 0xa2, 0x6a, 0xf3, 0xa8, 0x52, 0x6a, 0x19, 0x20, 0x5f, 0xf6, 0xcb, 0xdd, 0x3b,
                           0x95, 0xc0, 0xe8, 0x79, 0x1e, 0x10, 0xd6, 0xf6, 0x81, 0x8f, 0x19, 0x7c, 0x61};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2574}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1033}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24445}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23778}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16092}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1282}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12039}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x6b, 0x35, 0xcf, 0x4e, 0xb5, 0xc0, 0x57, 0x55, 0x2c, 0xf, 0x65,
                               0x34, 0xac, 0xfe, 0xd2, 0x19, 0x7,  0x65, 0xb0, 0x10, 0x2d};
  uint8_t byteswillprops1[] = {0xa,  0x4a, 0xa6, 0x6a, 0xc2, 0x9e, 0xef, 0x3f, 0x59, 0x94, 0xe0, 0x9f, 0x8d, 0xad, 0xf1,
                               0x1b, 0xbf, 0x49, 0x66, 0x8e, 0x11, 0xc9, 0xe6, 0xc7, 0x30, 0xfd, 0xf3, 0x30, 0x32};
  uint8_t byteswillprops2[] = {0x77, 0x12, 0xff, 0xd2, 0x85, 0xbf, 0xca, 0xd7, 0xf8,
                               0x54, 0xb9, 0xa4, 0x87, 0x5,  0x5f, 0xb9, 0x61, 0x4a};
  uint8_t byteswillprops3[] = {0xb,  0x29, 0x4f, 0xe8, 0x50, 0x24, 0xce, 0x4b, 0x66, 0x3,
                               0x3b, 0xb6, 0x33, 0x43, 0xc6, 0xbc, 0xf3, 0x66, 0xb7};
  uint8_t byteswillprops4[] = {0x3f, 0x8a, 0xca, 0x9, 0xbe, 0x8f, 0x78, 0xa, 0xc, 0x40, 0xc4};
  uint8_t byteswillprops5[] = {0xf7, 0x65, 0xf3, 0x5a, 0xc1, 0xca, 0x34, 0x46, 0x1a, 0x8,  0x30, 0xac, 0x37,
                               0xfc, 0xa7, 0xf3, 0x72, 0x7f, 0xbe, 0x21, 0x61, 0x51, 0x8f, 0x3f, 0x55};
  uint8_t byteswillprops6[] = {0xbc, 0xdb, 0xa3, 0x5b, 0x66, 0x19, 0x89, 0x49, 0x29, 0x1e, 0x10};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28426}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12835}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x89, 0xa9, 0x96, 0x63};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19444;
  uint8_t client_id_bytes[] = {0x97, 0xad, 0x80, 0xfe, 0xbd, 0x3e, 0xe1, 0xa8, 0xb8, 0x40, 0xa9, 0xb3};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf0, 0x3, 0xbb, 0xf0, 0x27, 0xdb, 0xd6, 0x3a, 0x18, 0x77};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167 \167\208\233f\167\246'\240T\252\&3!", _password = Just
// "\204ptBG\160\v\SUB\223!\EM\SI\STX\b\DEL+1Z", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2,
// _willTopic = "\186To9\139\230@\227W\SUB\173\175\253\165\SI\195\133i\DC4\ESC\229\DC2=z\251\186\231", _willMsg =
// "rXO\rA\ESC\fQ\DC2\152\SO\ETB{\248\203\197%\175\203\235\227", _willProps = [PropWillDelayInterval
// 4229,PropCorrelationData ":",PropMessageExpiryInterval 31827,PropMessageExpiryInterval 29078,PropServerKeepAlive
// 16436,PropSubscriptionIdentifier 11,PropSubscriptionIdentifier 16,PropAuthenticationData
// "\DC2\v|\254{\179\DC2k\151o)\RS\DC3\SO\129\201\v\131X\246\141\225>\149\&2-9\249\250\162",PropSessionExpiryInterval
// 14463,PropCorrelationData
// "WH\EOTJ\167\aX\t\179\&7;\180\154\&6\153\171FO\DC2\236\173\139S\232",PropResponseInformation
// "\DC3\143;\129\163\239:\240R\248\188\179\129\t\139\&9m'\134#\250\150\166",PropAssignedClientIdentifier
// "F\152u\153_\155",PropMaximumPacketSize 7776,PropSharedSubscriptionAvailable 253,PropReasonString
// "\232\253\177s\247m\178\237\231\222\221",PropResponseInformation
// "\210\175\215\nM\134\211\218Jp\226R\EOT\US\232j\b\212\239\NAKA\253J\DLE\t\187\253\229\236",PropReceiveMaximum
// 9466,PropSubscriptionIdentifierAvailable 89,PropSubscriptionIdentifier 15,PropAuthenticationMethod "\140Dp\rR\250
// \146\SO\158\149",PropAuthenticationData
// "p\163]\225!_\181WU!\231\238?\193r\169\138\165\155U\DC28\146\161\250\194\166",PropSessionExpiryInterval
// 5750,PropMessageExpiryInterval 28985,PropRetainAvailable 244]}), _cleanSession = False, _keepAlive = 21475, _connID =
// "\130", _properties = [PropReceiveMaximum 4893,PropAuthenticationMethod "",PropAuthenticationMethod
// "]\174\253\GS\146\NAK\236\245\227h\216\DC2g\241\174\212\253;",PropReceiveMaximum 1689,PropWillDelayInterval
// 27418,PropRequestProblemInformation 197,PropSubscriptionIdentifier 21,PropRequestProblemInformation 68,PropTopicAlias
// 16330,PropPayloadFormatIndicator 38,PropTopicAlias 22185,PropServerReference
// "p\255L\244A\193P\SYNh\143\200\168",PropSubscriptionIdentifierAvailable 184,PropMaximumPacketSize
// 25634,PropCorrelationData "\184U\173\203\ESCMtAA\229\184\223\203\222\190\137\195\&3\235",PropSessionExpiryInterval
// 338,PropSubscriptionIdentifierAvailable 21,PropAuthenticationMethod "\135$\145\153\SUB1\223\NUL\DC3\f\245"]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xcc, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x53, 0xe3, 0x72, 0x21, 0x13, 0x1d, 0x15, 0x0,
      0x0,  0x15, 0x0,  0x12, 0x5d, 0xae, 0xfd, 0x1d, 0x92, 0x15, 0xec, 0xf5, 0xe3, 0x68, 0xd8, 0x12, 0x67, 0xf1, 0xae,
      0xd4, 0xfd, 0x3b, 0x21, 0x6,  0x99, 0x18, 0x0,  0x0,  0x6b, 0x1a, 0x17, 0xc5, 0xb,  0x15, 0x17, 0x44, 0x23, 0x3f,
      0xca, 0x1,  0x26, 0x23, 0x56, 0xa9, 0x1c, 0x0,  0xc,  0x70, 0xff, 0x4c, 0xf4, 0x41, 0xc1, 0x50, 0x16, 0x68, 0x8f,
      0xc8, 0xa8, 0x29, 0xb8, 0x27, 0x0,  0x0,  0x64, 0x22, 0x9,  0x0,  0x13, 0xb8, 0x55, 0xad, 0xcb, 0x1b, 0x4d, 0x74,
      0x41, 0x41, 0xe5, 0xb8, 0xdf, 0xcb, 0xde, 0xbe, 0x89, 0xc3, 0x33, 0xeb, 0x11, 0x0,  0x0,  0x1,  0x52, 0x29, 0x15,
      0x15, 0x0,  0xb,  0x87, 0x24, 0x91, 0x99, 0x1a, 0x31, 0xdf, 0x0,  0x13, 0xc,  0xf5, 0x0,  0x1,  0x82, 0xf2, 0x1,
      0x18, 0x0,  0x0,  0x10, 0x85, 0x9,  0x0,  0x1,  0x3a, 0x2,  0x0,  0x0,  0x7c, 0x53, 0x2,  0x0,  0x0,  0x71, 0x96,
      0x13, 0x40, 0x34, 0xb,  0xb,  0xb,  0x10, 0x16, 0x0,  0x1e, 0x12, 0xb,  0x7c, 0xfe, 0x7b, 0xb3, 0x12, 0x6b, 0x97,
      0x6f, 0x29, 0x1e, 0x13, 0xe,  0x81, 0xc9, 0xb,  0x83, 0x58, 0xf6, 0x8d, 0xe1, 0x3e, 0x95, 0x32, 0x2d, 0x39, 0xf9,
      0xfa, 0xa2, 0x11, 0x0,  0x0,  0x38, 0x7f, 0x9,  0x0,  0x18, 0x57, 0x48, 0x4,  0x4a, 0xa7, 0x7,  0x58, 0x9,  0xb3,
      0x37, 0x3b, 0xb4, 0x9a, 0x36, 0x99, 0xab, 0x46, 0x4f, 0x12, 0xec, 0xad, 0x8b, 0x53, 0xe8, 0x1a, 0x0,  0x17, 0x13,
      0x8f, 0x3b, 0x81, 0xa3, 0xef, 0x3a, 0xf0, 0x52, 0xf8, 0xbc, 0xb3, 0x81, 0x9,  0x8b, 0x39, 0x6d, 0x27, 0x86, 0x23,
      0xfa, 0x96, 0xa6, 0x12, 0x0,  0x6,  0x46, 0x98, 0x75, 0x99, 0x5f, 0x9b, 0x27, 0x0,  0x0,  0x1e, 0x60, 0x2a, 0xfd,
      0x1f, 0x0,  0xb,  0xe8, 0xfd, 0xb1, 0x73, 0xf7, 0x6d, 0xb2, 0xed, 0xe7, 0xde, 0xdd, 0x1a, 0x0,  0x1d, 0xd2, 0xaf,
      0xd7, 0xa,  0x4d, 0x86, 0xd3, 0xda, 0x4a, 0x70, 0xe2, 0x52, 0x4,  0x1f, 0xe8, 0x6a, 0x8,  0xd4, 0xef, 0x15, 0x41,
      0xfd, 0x4a, 0x10, 0x9,  0xbb, 0xfd, 0xe5, 0xec, 0x21, 0x24, 0xfa, 0x29, 0x59, 0xb,  0xf,  0x15, 0x0,  0xb,  0x8c,
      0x44, 0x70, 0xd,  0x52, 0xfa, 0x20, 0x92, 0xe,  0x9e, 0x95, 0x16, 0x0,  0x1b, 0x70, 0xa3, 0x5d, 0xe1, 0x21, 0x5f,
      0xb5, 0x57, 0x55, 0x21, 0xe7, 0xee, 0x3f, 0xc1, 0x72, 0xa9, 0x8a, 0xa5, 0x9b, 0x55, 0x12, 0x38, 0x92, 0xa1, 0xfa,
      0xc2, 0xa6, 0x11, 0x0,  0x0,  0x16, 0x76, 0x2,  0x0,  0x0,  0x71, 0x39, 0x25, 0xf4, 0x0,  0x1b, 0xba, 0x54, 0x6f,
      0x39, 0x8b, 0xe6, 0x40, 0xe3, 0x57, 0x1a, 0xad, 0xaf, 0xfd, 0xa5, 0xf,  0xc3, 0x85, 0x69, 0x14, 0x1b, 0xe5, 0x12,
      0x3d, 0x7a, 0xfb, 0xba, 0xe7, 0x0,  0x15, 0x72, 0x58, 0x4f, 0xd,  0x41, 0x1b, 0xc,  0x51, 0x12, 0x98, 0xe,  0x17,
      0x7b, 0xf8, 0xcb, 0xc5, 0x25, 0xaf, 0xcb, 0xeb, 0xe3, 0x0,  0xe,  0xa7, 0x20, 0xa7, 0xd0, 0xe9, 0x66, 0xa7, 0xf6,
      0x27, 0xf0, 0x54, 0xfc, 0x33, 0x21, 0x0,  0x12, 0xcc, 0x70, 0x74, 0x42, 0x47, 0xa0, 0xb,  0x1a, 0xdf, 0x21, 0x19,
      0xf,  0x2,  0x8,  0x7f, 0x2b, 0x31, 0x5a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x5d, 0xae, 0xfd, 0x1d, 0x92, 0x15, 0xec, 0xf5, 0xe3,
                           0x68, 0xd8, 0x12, 0x67, 0xf1, 0xae, 0xd4, 0xfd, 0x3b};
  uint8_t bytesprops2[] = {0x70, 0xff, 0x4c, 0xf4, 0x41, 0xc1, 0x50, 0x16, 0x68, 0x8f, 0xc8, 0xa8};
  uint8_t bytesprops3[] = {0xb8, 0x55, 0xad, 0xcb, 0x1b, 0x4d, 0x74, 0x41, 0x41, 0xe5,
                           0xb8, 0xdf, 0xcb, 0xde, 0xbe, 0x89, 0xc3, 0x33, 0xeb};
  uint8_t bytesprops4[] = {0x87, 0x24, 0x91, 0x99, 0x1a, 0x31, 0xdf, 0x0, 0x13, 0xc, 0xf5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4893}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1689}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27418}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16330}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22185}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25634}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 338}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3a};
  uint8_t byteswillprops1[] = {0x12, 0xb, 0x7c, 0xfe, 0x7b, 0xb3, 0x12, 0x6b, 0x97, 0x6f, 0x29, 0x1e, 0x13, 0xe,  0x81,
                               0xc9, 0xb, 0x83, 0x58, 0xf6, 0x8d, 0xe1, 0x3e, 0x95, 0x32, 0x2d, 0x39, 0xf9, 0xfa, 0xa2};
  uint8_t byteswillprops2[] = {0x57, 0x48, 0x4,  0x4a, 0xa7, 0x7,  0x58, 0x9,  0xb3, 0x37, 0x3b, 0xb4,
                               0x9a, 0x36, 0x99, 0xab, 0x46, 0x4f, 0x12, 0xec, 0xad, 0x8b, 0x53, 0xe8};
  uint8_t byteswillprops3[] = {0x13, 0x8f, 0x3b, 0x81, 0xa3, 0xef, 0x3a, 0xf0, 0x52, 0xf8, 0xbc, 0xb3,
                               0x81, 0x9,  0x8b, 0x39, 0x6d, 0x27, 0x86, 0x23, 0xfa, 0x96, 0xa6};
  uint8_t byteswillprops4[] = {0x46, 0x98, 0x75, 0x99, 0x5f, 0x9b};
  uint8_t byteswillprops5[] = {0xe8, 0xfd, 0xb1, 0x73, 0xf7, 0x6d, 0xb2, 0xed, 0xe7, 0xde, 0xdd};
  uint8_t byteswillprops6[] = {0xd2, 0xaf, 0xd7, 0xa,  0x4d, 0x86, 0xd3, 0xda, 0x4a, 0x70, 0xe2, 0x52, 0x4,  0x1f, 0xe8,
                               0x6a, 0x8,  0xd4, 0xef, 0x15, 0x41, 0xfd, 0x4a, 0x10, 0x9,  0xbb, 0xfd, 0xe5, 0xec};
  uint8_t byteswillprops7[] = {0x8c, 0x44, 0x70, 0xd, 0x52, 0xfa, 0x20, 0x92, 0xe, 0x9e, 0x95};
  uint8_t byteswillprops8[] = {0x70, 0xa3, 0x5d, 0xe1, 0x21, 0x5f, 0xb5, 0x57, 0x55, 0x21, 0xe7, 0xee, 0x3f, 0xc1,
                               0x72, 0xa9, 0x8a, 0xa5, 0x9b, 0x55, 0x12, 0x38, 0x92, 0xa1, 0xfa, 0xc2, 0xa6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4229}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31827}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29078}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16436}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14463}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7776}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9466}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5750}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28985}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xba, 0x54, 0x6f, 0x39, 0x8b, 0xe6, 0x40, 0xe3, 0x57, 0x1a, 0xad, 0xaf, 0xfd, 0xa5,
                                0xf,  0xc3, 0x85, 0x69, 0x14, 0x1b, 0xe5, 0x12, 0x3d, 0x7a, 0xfb, 0xba, 0xe7};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x72, 0x58, 0x4f, 0xd,  0x41, 0x1b, 0xc,  0x51, 0x12, 0x98, 0xe,
                                  0x17, 0x7b, 0xf8, 0xcb, 0xc5, 0x25, 0xaf, 0xcb, 0xeb, 0xe3};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21475;
  uint8_t client_id_bytes[] = {0x82};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0x20, 0xa7, 0xd0, 0xe9, 0x66, 0xa7, 0xf6, 0x27, 0xf0, 0x54, 0xfc, 0x33, 0x21};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcc, 0x70, 0x74, 0x42, 0x47, 0xa0, 0xb,  0x1a, 0xdf,
                              0x21, 0x19, 0xf,  0x2,  0x8,  0x7f, 0x2b, 0x31, 0x5a};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "4\244\&1\217\142\&8\NAK5", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "e;\194\&7\237P\201 w\216\149l\171W\RS\241>\135`\SYN\ENQ\197\t",
// _willMsg = "2\174", _willProps = [PropResponseTopic
// "\142\216\206=\187\ETB?OH\195r\237\129\133f\190\219\150\200\142\rK\138",PropSubscriptionIdentifier
// 6,PropAssignedClientIdentifier "\161\USlM\STXUg",PropWillDelayInterval 6334,PropWildcardSubscriptionAvailable
// 70,PropWildcardSubscriptionAvailable 240,PropServerReference
// "\194wP\163\231\SO+\217\&92\136w&\214\STX*\NUL\ENQ3\GS\DC1",PropResponseInformation
// "\200V%\185",PropSubscriptionIdentifierAvailable 99,PropContentType
// "\n\175\138Sa\198o;r-",PropWildcardSubscriptionAvailable 150,PropReasonString "\220S\139Qd",PropTopicAlias
// 14266,PropAssignedClientIdentifier "D|%\142M?\148eEE\155\182",PropMessageExpiryInterval
// 2407,PropRequestProblemInformation 31,PropTopicAlias 15204,PropMessageExpiryInterval 7923,PropUserProperty
// "8h\199\190hz\234\230\235N\148\197a\246\225P\251\ETXd^iG\188\184\136\131"
// "\146\222\ENQ\v\SO\211i]2\FS\SYN\220\244\200\231\179\FS\\\150\196\188\149\155",PropMaximumQoS
// 134,PropPayloadFormatIndicator 8,PropReasonString "M(\249"]}), _cleanSession = True, _keepAlive = 29263, _connID =
// "\173Q\DC4\163\185\129\144\238\155\169Q\252K\131\227\&9\CAN\v\239", _properties = [PropTopicAlias
// 25630,PropSubscriptionIdentifier 6,PropSharedSubscriptionAvailable 158,PropResponseTopic
// "{G\NAK&0YDEtI",PropServerKeepAlive 11245,PropResponseInformation
// "\190d\136\&1\171D+.C\177\ACK\SI\167\145\135",PropSessionExpiryInterval 15509,PropRetainAvailable
// 18,PropServerKeepAlive 5583,PropContentType "+?\144\188^\165\&73\RSe\249\246\RSOa\177\128o",PropMaximumQoS
// 152,PropCorrelationData "@'\253[z\129K\139N\241\t\148\198TD\247\&0\193\DC1v\FSoud",PropPayloadFormatIndicator 23]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xf8, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x72, 0x4f, 0x67, 0x23, 0x64, 0x1e, 0xb,  0x6,
      0x2a, 0x9e, 0x8,  0x0,  0xa,  0x7b, 0x47, 0x15, 0x26, 0x30, 0x59, 0x44, 0x45, 0x74, 0x49, 0x13, 0x2b, 0xed, 0x1a,
      0x0,  0xf,  0xbe, 0x64, 0x88, 0x31, 0xab, 0x44, 0x2b, 0x2e, 0x43, 0xb1, 0x6,  0xf,  0xa7, 0x91, 0x87, 0x11, 0x0,
      0x0,  0x3c, 0x95, 0x25, 0x12, 0x13, 0x15, 0xcf, 0x3,  0x0,  0x12, 0x2b, 0x3f, 0x90, 0xbc, 0x5e, 0xa5, 0x37, 0x33,
      0x1e, 0x65, 0xf9, 0xf6, 0x1e, 0x4f, 0x61, 0xb1, 0x80, 0x6f, 0x24, 0x98, 0x9,  0x0,  0x18, 0x40, 0x27, 0xfd, 0x5b,
      0x7a, 0x81, 0x4b, 0x8b, 0x4e, 0xf1, 0x9,  0x94, 0xc6, 0x54, 0x44, 0xf7, 0x30, 0xc1, 0x11, 0x76, 0x1c, 0x6f, 0x75,
      0x64, 0x1,  0x17, 0x0,  0x13, 0xad, 0x51, 0x14, 0xa3, 0xb9, 0x81, 0x90, 0xee, 0x9b, 0xa9, 0x51, 0xfc, 0x4b, 0x83,
      0xe3, 0x39, 0x18, 0xb,  0xef, 0xc8, 0x1,  0x8,  0x0,  0x17, 0x8e, 0xd8, 0xce, 0x3d, 0xbb, 0x17, 0x3f, 0x4f, 0x48,
      0xc3, 0x72, 0xed, 0x81, 0x85, 0x66, 0xbe, 0xdb, 0x96, 0xc8, 0x8e, 0xd,  0x4b, 0x8a, 0xb,  0x6,  0x12, 0x0,  0x7,
      0xa1, 0x1f, 0x6c, 0x4d, 0x2,  0x55, 0x67, 0x18, 0x0,  0x0,  0x18, 0xbe, 0x28, 0x46, 0x28, 0xf0, 0x1c, 0x0,  0x15,
      0xc2, 0x77, 0x50, 0xa3, 0xe7, 0xe,  0x2b, 0xd9, 0x39, 0x32, 0x88, 0x77, 0x26, 0xd6, 0x2,  0x2a, 0x0,  0x5,  0x33,
      0x1d, 0x11, 0x1a, 0x0,  0x4,  0xc8, 0x56, 0x25, 0xb9, 0x29, 0x63, 0x3,  0x0,  0xa,  0xa,  0xaf, 0x8a, 0x53, 0x61,
      0xc6, 0x6f, 0x3b, 0x72, 0x2d, 0x28, 0x96, 0x1f, 0x0,  0x5,  0xdc, 0x53, 0x8b, 0x51, 0x64, 0x23, 0x37, 0xba, 0x12,
      0x0,  0xc,  0x44, 0x7c, 0x25, 0x8e, 0x4d, 0x3f, 0x94, 0x65, 0x45, 0x45, 0x9b, 0xb6, 0x2,  0x0,  0x0,  0x9,  0x67,
      0x17, 0x1f, 0x23, 0x3b, 0x64, 0x2,  0x0,  0x0,  0x1e, 0xf3, 0x26, 0x0,  0x1a, 0x38, 0x68, 0xc7, 0xbe, 0x68, 0x7a,
      0xea, 0xe6, 0xeb, 0x4e, 0x94, 0xc5, 0x61, 0xf6, 0xe1, 0x50, 0xfb, 0x3,  0x64, 0x5e, 0x69, 0x47, 0xbc, 0xb8, 0x88,
      0x83, 0x0,  0x17, 0x92, 0xde, 0x5,  0xb,  0xe,  0xd3, 0x69, 0x5d, 0x32, 0x1c, 0x16, 0xdc, 0xf4, 0xc8, 0xe7, 0xb3,
      0x1c, 0x5c, 0x96, 0xc4, 0xbc, 0x95, 0x9b, 0x24, 0x86, 0x1,  0x8,  0x1f, 0x0,  0x3,  0x4d, 0x28, 0xf9, 0x0,  0x17,
      0x65, 0x3b, 0xc2, 0x37, 0xed, 0x50, 0xc9, 0x20, 0x77, 0xd8, 0x95, 0x6c, 0xab, 0x57, 0x1e, 0xf1, 0x3e, 0x87, 0x60,
      0x16, 0x5,  0xc5, 0x9,  0x0,  0x2,  0x32, 0xae, 0x0,  0x8,  0x34, 0xf4, 0x31, 0xd9, 0x8e, 0x38, 0x15, 0x35};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7b, 0x47, 0x15, 0x26, 0x30, 0x59, 0x44, 0x45, 0x74, 0x49};
  uint8_t bytesprops1[] = {0xbe, 0x64, 0x88, 0x31, 0xab, 0x44, 0x2b, 0x2e, 0x43, 0xb1, 0x6, 0xf, 0xa7, 0x91, 0x87};
  uint8_t bytesprops2[] = {0x2b, 0x3f, 0x90, 0xbc, 0x5e, 0xa5, 0x37, 0x33, 0x1e,
                           0x65, 0xf9, 0xf6, 0x1e, 0x4f, 0x61, 0xb1, 0x80, 0x6f};
  uint8_t bytesprops3[] = {0x40, 0x27, 0xfd, 0x5b, 0x7a, 0x81, 0x4b, 0x8b, 0x4e, 0xf1, 0x9,  0x94,
                           0xc6, 0x54, 0x44, 0xf7, 0x30, 0xc1, 0x11, 0x76, 0x1c, 0x6f, 0x75, 0x64};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25630}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11245}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15509}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5583}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8e, 0xd8, 0xce, 0x3d, 0xbb, 0x17, 0x3f, 0x4f, 0x48, 0xc3, 0x72, 0xed,
                               0x81, 0x85, 0x66, 0xbe, 0xdb, 0x96, 0xc8, 0x8e, 0xd,  0x4b, 0x8a};
  uint8_t byteswillprops1[] = {0xa1, 0x1f, 0x6c, 0x4d, 0x2, 0x55, 0x67};
  uint8_t byteswillprops2[] = {0xc2, 0x77, 0x50, 0xa3, 0xe7, 0xe, 0x2b, 0xd9, 0x39, 0x32, 0x88,
                               0x77, 0x26, 0xd6, 0x2,  0x2a, 0x0, 0x5,  0x33, 0x1d, 0x11};
  uint8_t byteswillprops3[] = {0xc8, 0x56, 0x25, 0xb9};
  uint8_t byteswillprops4[] = {0xa, 0xaf, 0x8a, 0x53, 0x61, 0xc6, 0x6f, 0x3b, 0x72, 0x2d};
  uint8_t byteswillprops5[] = {0xdc, 0x53, 0x8b, 0x51, 0x64};
  uint8_t byteswillprops6[] = {0x44, 0x7c, 0x25, 0x8e, 0x4d, 0x3f, 0x94, 0x65, 0x45, 0x45, 0x9b, 0xb6};
  uint8_t byteswillprops8[] = {0x92, 0xde, 0x5,  0xb,  0xe,  0xd3, 0x69, 0x5d, 0x32, 0x1c, 0x16, 0xdc,
                               0xf4, 0xc8, 0xe7, 0xb3, 0x1c, 0x5c, 0x96, 0xc4, 0xbc, 0x95, 0x9b};
  uint8_t byteswillprops7[] = {0x38, 0x68, 0xc7, 0xbe, 0x68, 0x7a, 0xea, 0xe6, 0xeb, 0x4e, 0x94, 0xc5, 0x61,
                               0xf6, 0xe1, 0x50, 0xfb, 0x3,  0x64, 0x5e, 0x69, 0x47, 0xbc, 0xb8, 0x88, 0x83};
  uint8_t byteswillprops9[] = {0x4d, 0x28, 0xf9};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6334}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14266}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2407}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15204}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7923}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&byteswillprops7}, .v = {23, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x65, 0x3b, 0xc2, 0x37, 0xed, 0x50, 0xc9, 0x20, 0x77, 0xd8, 0x95, 0x6c,
                                0xab, 0x57, 0x1e, 0xf1, 0x3e, 0x87, 0x60, 0x16, 0x5,  0xc5, 0x9};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0xae};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29263;
  uint8_t client_id_bytes[] = {0xad, 0x51, 0x14, 0xa3, 0xb9, 0x81, 0x90, 0xee, 0x9b, 0xa9,
                               0x51, 0xfc, 0x4b, 0x83, 0xe3, 0x39, 0x18, 0xb,  0xef};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x34, 0xf4, 0x31, 0xd9, 0x8e, 0x38, 0x15, 0x35};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\199\154\ACK\130\147\145\141\149\SOH", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 26934, _connID = "\185\183=\217", _properties = [PropCorrelationData
// "\239\210u(+\143u\173",PropRetainAvailable 45,PropSessionExpiryInterval 25383,PropMessageExpiryInterval
// 21093,PropCorrelationData "",PropMaximumQoS 7,PropReceiveMaximum 14060,PropSharedSubscriptionAvailable
// 253,PropReasonString "@\200)\189\162a6\159\v{l\235s\ETB",PropRetainAvailable 171,PropReceiveMaximum
// 21217,PropServerKeepAlive 27975,PropSharedSubscriptionAvailable 209,PropSessionExpiryInterval
// 13956,PropMessageExpiryInterval 30032,PropAuthenticationData
// "+\221gp\SOH7\175\233J0\244@\242v\176H\237i\133:\139t\134N\226\160",PropSessionExpiryInterval
// 11445,PropReceiveMaximum 30403,PropAssignedClientIdentifier
// "\221\&0\135\ETB\216\RSV\222\201t)\SOHi\v\218\212\128\225\133",PropRequestResponseInformation
// 138,PropRequestProblemInformation 79,PropResponseInformation
// "F7]\188[\250&\195\146Qa\189\203_\181\237\SOH\GS\241\130q\194\236\209\STX\250\242",PropMessageExpiryInterval
// 10611,PropTopicAlias 15572,PropAuthenticationMethod "X\187\141\177\&8\220\244\210\&8\214\200\144",PropRetainAvailable
// 159,PropSubscriptionIdentifierAvailable 212]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0xdb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x42, 0x69, 0x36, 0xbe, 0x1,  0x9,  0x0,  0x8,  0xef,
      0xd2, 0x75, 0x28, 0x2b, 0x8f, 0x75, 0xad, 0x25, 0x2d, 0x11, 0x0,  0x0,  0x63, 0x27, 0x2,  0x0,  0x0,  0x52, 0x65,
      0x9,  0x0,  0x0,  0x24, 0x7,  0x21, 0x36, 0xec, 0x2a, 0xfd, 0x1f, 0x0,  0xe,  0x40, 0xc8, 0x29, 0xbd, 0xa2, 0x61,
      0x36, 0x9f, 0xb,  0x7b, 0x6c, 0xeb, 0x73, 0x17, 0x25, 0xab, 0x21, 0x52, 0xe1, 0x13, 0x6d, 0x47, 0x2a, 0xd1, 0x11,
      0x0,  0x0,  0x36, 0x84, 0x2,  0x0,  0x0,  0x75, 0x50, 0x16, 0x0,  0x1a, 0x2b, 0xdd, 0x67, 0x70, 0x1,  0x37, 0xaf,
      0xe9, 0x4a, 0x30, 0xf4, 0x40, 0xf2, 0x76, 0xb0, 0x48, 0xed, 0x69, 0x85, 0x3a, 0x8b, 0x74, 0x86, 0x4e, 0xe2, 0xa0,
      0x11, 0x0,  0x0,  0x2c, 0xb5, 0x21, 0x76, 0xc3, 0x12, 0x0,  0x13, 0xdd, 0x30, 0x87, 0x17, 0xd8, 0x1e, 0x56, 0xde,
      0xc9, 0x74, 0x29, 0x1,  0x69, 0xb,  0xda, 0xd4, 0x80, 0xe1, 0x85, 0x19, 0x8a, 0x17, 0x4f, 0x1a, 0x0,  0x1b, 0x46,
      0x37, 0x5d, 0xbc, 0x5b, 0xfa, 0x26, 0xc3, 0x92, 0x51, 0x61, 0xbd, 0xcb, 0x5f, 0xb5, 0xed, 0x1,  0x1d, 0xf1, 0x82,
      0x71, 0xc2, 0xec, 0xd1, 0x2,  0xfa, 0xf2, 0x2,  0x0,  0x0,  0x29, 0x73, 0x23, 0x3c, 0xd4, 0x15, 0x0,  0xc,  0x58,
      0xbb, 0x8d, 0xb1, 0x38, 0xdc, 0xf4, 0xd2, 0x38, 0xd6, 0xc8, 0x90, 0x25, 0x9f, 0x29, 0xd4, 0x0,  0x4,  0xb9, 0xb7,
      0x3d, 0xd9, 0x0,  0x9,  0xc7, 0x9a, 0x6,  0x82, 0x93, 0x91, 0x8d, 0x95, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xef, 0xd2, 0x75, 0x28, 0x2b, 0x8f, 0x75, 0xad};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x40, 0xc8, 0x29, 0xbd, 0xa2, 0x61, 0x36, 0x9f, 0xb, 0x7b, 0x6c, 0xeb, 0x73, 0x17};
  uint8_t bytesprops3[] = {0x2b, 0xdd, 0x67, 0x70, 0x1,  0x37, 0xaf, 0xe9, 0x4a, 0x30, 0xf4, 0x40, 0xf2,
                           0x76, 0xb0, 0x48, 0xed, 0x69, 0x85, 0x3a, 0x8b, 0x74, 0x86, 0x4e, 0xe2, 0xa0};
  uint8_t bytesprops4[] = {0xdd, 0x30, 0x87, 0x17, 0xd8, 0x1e, 0x56, 0xde, 0xc9, 0x74,
                           0x29, 0x1,  0x69, 0xb,  0xda, 0xd4, 0x80, 0xe1, 0x85};
  uint8_t bytesprops5[] = {0x46, 0x37, 0x5d, 0xbc, 0x5b, 0xfa, 0x26, 0xc3, 0x92, 0x51, 0x61, 0xbd, 0xcb, 0x5f,
                           0xb5, 0xed, 0x1,  0x1d, 0xf1, 0x82, 0x71, 0xc2, 0xec, 0xd1, 0x2,  0xfa, 0xf2};
  uint8_t bytesprops6[] = {0x58, 0xbb, 0x8d, 0xb1, 0x38, 0xdc, 0xf4, 0xd2, 0x38, 0xd6, 0xc8, 0x90};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25383}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21093}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14060}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21217}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27975}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13956}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30032}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11445}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30403}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10611}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15572}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 212}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26934;
  uint8_t client_id_bytes[] = {0xb9, 0xb7, 0x3d, 0xd9};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc7, 0x9a, 0x6, 0x82, 0x93, 0x91, 0x8d, 0x95, 0x1};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "-\247+\DC1\233}bt\ENQ\200\241\ENQ\SI\v\163F\173\246\236h\217\149Ur\237\DC3\244\208\217\EOT", _password = Just
// "\181\199$\147\180\ETX6\202", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\227\174\130\185\246$4`\SI^`\215\195\238\204OL\188\134\144\164\DLE^-\187\STX\DC4\224\178", _willMsg =
// "\210\221\DC4\SYN\212^\167\212v\131\142\DELq\191\136\237\&6\203\227.\181\SYN\138", _willProps =
// [PropWildcardSubscriptionAvailable 185,PropCorrelationData "\253l\182o\221\205\214\SYNp\231\191",PropRetainAvailable
// 187,PropMessageExpiryInterval 30413,PropMaximumQoS 59,PropResponseInformation
// "\216\249>\184\207%.\243\214\DC4\200`",PropReasonString
// "\190\CAN\v\247\172\195q\177C\171\&5{\248\&3[\223\135\134'",PropAuthenticationMethod
// "\248\229=L\165=\DC4\241\181<\174\188q.",PropAuthenticationData
// "\145\184I3\218\156\139\153\b\133,\182\np\DC3\132\ENQ\243\ETX\240\167\DC1\194B\ETXyl",PropResponseTopic
// "\200\SO\240\223\234\&0",PropRequestProblemInformation 177,PropResponseTopic
// "!\152`\198\148\140\DC1Q\CAN\v\242\192\182 \198",PropReasonString "C\253/\215",PropResponseTopic
// "\182-\146Y\196\b\202\214\DC2\145\148\ESC=\180\255Q+",PropSubscriptionIdentifier 11,PropServerReference
// "\203\233\242\153\166\246X\235\&5'\144!>\240\207\DLE9\217xr\158\255\241.j{",PropAuthenticationData
// "k\228\t_\252\165RF\179{Z\EOT\207\201\197SY'\234\135k\166\152;\DEL\172\242",PropTopicAlias 27251,PropContentType
// "\EOT\r\174\154f\165\"\195\158\201\SOH",PropSharedSubscriptionAvailable 57,PropUserProperty
// "b\144\251\240\US\245\NAK(\SIo%l\178\174V\191\226zD" "\159",PropResponseTopic
// "\rFi\SO`Aij5\231q\185\US6",PropSubscriptionIdentifier 18,PropMessageExpiryInterval
// 28407,PropRequestResponseInformation 129,PropReasonString "4p\203\141\133\153s4HZ",PropCorrelationData
// "x\193\204\&6\206\247",PropAssignedClientIdentifier "\246\&4\US+\aN\161\239a",PropAuthenticationMethod
// "\129\150\201}<\207"]}), _cleanSession = False, _keepAlive = 20204, _connID = "\140\212\218\244p", _properties =
// [PropAuthenticationMethod "\146P\t\153Y\136",PropSubscriptionIdentifier 17,PropReceiveMaximum
// 2002,PropCorrelationData "\231\223i~=e\160\196\175\232\198\138}\222\DC2j",PropAuthenticationMethod
// "\253\250AU5B\ETB\255[\210",PropUserProperty "\190\ETX\148*+\189" "D/e\215G?\202w\197\NAK\157\221\204\v\247\245
// &z\146\141\245\SYN\CAN\181",PropPayloadFormatIndicator 213,PropTopicAlias 7603]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xa0, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x4e, 0xec, 0x57, 0x15, 0x0,  0x6,  0x92, 0x50,
      0x9,  0x99, 0x59, 0x88, 0xb,  0x11, 0x21, 0x7,  0xd2, 0x9,  0x0,  0x10, 0xe7, 0xdf, 0x69, 0x7e, 0x3d, 0x65, 0xa0,
      0xc4, 0xaf, 0xe8, 0xc6, 0x8a, 0x7d, 0xde, 0x12, 0x6a, 0x15, 0x0,  0xa,  0xfd, 0xfa, 0x41, 0x55, 0x35, 0x42, 0x17,
      0xff, 0x5b, 0xd2, 0x26, 0x0,  0x6,  0xbe, 0x3,  0x94, 0x2a, 0x2b, 0xbd, 0x0,  0x19, 0x44, 0x2f, 0x65, 0xd7, 0x47,
      0x3f, 0xca, 0x77, 0xc5, 0x15, 0x9d, 0xdd, 0xcc, 0xb,  0xf7, 0xf5, 0x20, 0x26, 0x7a, 0x92, 0x8d, 0xf5, 0x16, 0x18,
      0xb5, 0x1,  0xd5, 0x23, 0x1d, 0xb3, 0x0,  0x5,  0x8c, 0xd4, 0xda, 0xf4, 0x70, 0xd3, 0x2,  0x28, 0xb9, 0x9,  0x0,
      0xb,  0xfd, 0x6c, 0xb6, 0x6f, 0xdd, 0xcd, 0xd6, 0x16, 0x70, 0xe7, 0xbf, 0x25, 0xbb, 0x2,  0x0,  0x0,  0x76, 0xcd,
      0x24, 0x3b, 0x1a, 0x0,  0xc,  0xd8, 0xf9, 0x3e, 0xb8, 0xcf, 0x25, 0x2e, 0xf3, 0xd6, 0x14, 0xc8, 0x60, 0x1f, 0x0,
      0x13, 0xbe, 0x18, 0xb,  0xf7, 0xac, 0xc3, 0x71, 0xb1, 0x43, 0xab, 0x35, 0x7b, 0xf8, 0x33, 0x5b, 0xdf, 0x87, 0x86,
      0x27, 0x15, 0x0,  0xe,  0xf8, 0xe5, 0x3d, 0x4c, 0xa5, 0x3d, 0x14, 0xf1, 0xb5, 0x3c, 0xae, 0xbc, 0x71, 0x2e, 0x16,
      0x0,  0x1b, 0x91, 0xb8, 0x49, 0x33, 0xda, 0x9c, 0x8b, 0x99, 0x8,  0x85, 0x2c, 0xb6, 0xa,  0x70, 0x13, 0x84, 0x5,
      0xf3, 0x3,  0xf0, 0xa7, 0x11, 0xc2, 0x42, 0x3,  0x79, 0x6c, 0x8,  0x0,  0x6,  0xc8, 0xe,  0xf0, 0xdf, 0xea, 0x30,
      0x17, 0xb1, 0x8,  0x0,  0xf,  0x21, 0x98, 0x60, 0xc6, 0x94, 0x8c, 0x11, 0x51, 0x18, 0xb,  0xf2, 0xc0, 0xb6, 0x20,
      0xc6, 0x1f, 0x0,  0x4,  0x43, 0xfd, 0x2f, 0xd7, 0x8,  0x0,  0x11, 0xb6, 0x2d, 0x92, 0x59, 0xc4, 0x8,  0xca, 0xd6,
      0x12, 0x91, 0x94, 0x1b, 0x3d, 0xb4, 0xff, 0x51, 0x2b, 0xb,  0xb,  0x1c, 0x0,  0x1a, 0xcb, 0xe9, 0xf2, 0x99, 0xa6,
      0xf6, 0x58, 0xeb, 0x35, 0x27, 0x90, 0x21, 0x3e, 0xf0, 0xcf, 0x10, 0x39, 0xd9, 0x78, 0x72, 0x9e, 0xff, 0xf1, 0x2e,
      0x6a, 0x7b, 0x16, 0x0,  0x1b, 0x6b, 0xe4, 0x9,  0x5f, 0xfc, 0xa5, 0x52, 0x46, 0xb3, 0x7b, 0x5a, 0x4,  0xcf, 0xc9,
      0xc5, 0x53, 0x59, 0x27, 0xea, 0x87, 0x6b, 0xa6, 0x98, 0x3b, 0x7f, 0xac, 0xf2, 0x23, 0x6a, 0x73, 0x3,  0x0,  0xb,
      0x4,  0xd,  0xae, 0x9a, 0x66, 0xa5, 0x22, 0xc3, 0x9e, 0xc9, 0x1,  0x2a, 0x39, 0x26, 0x0,  0x13, 0x62, 0x90, 0xfb,
      0xf0, 0x1f, 0xf5, 0x15, 0x28, 0xf,  0x6f, 0x25, 0x6c, 0xb2, 0xae, 0x56, 0xbf, 0xe2, 0x7a, 0x44, 0x0,  0x1,  0x9f,
      0x8,  0x0,  0xe,  0xd,  0x46, 0x69, 0xe,  0x60, 0x41, 0x69, 0x6a, 0x35, 0xe7, 0x71, 0xb9, 0x1f, 0x36, 0xb,  0x12,
      0x2,  0x0,  0x0,  0x6e, 0xf7, 0x19, 0x81, 0x1f, 0x0,  0xa,  0x34, 0x70, 0xcb, 0x8d, 0x85, 0x99, 0x73, 0x34, 0x48,
      0x5a, 0x9,  0x0,  0x6,  0x78, 0xc1, 0xcc, 0x36, 0xce, 0xf7, 0x12, 0x0,  0x9,  0xf6, 0x34, 0x1f, 0x2b, 0x7,  0x4e,
      0xa1, 0xef, 0x61, 0x15, 0x0,  0x6,  0x81, 0x96, 0xc9, 0x7d, 0x3c, 0xcf, 0x0,  0x1d, 0xe3, 0xae, 0x82, 0xb9, 0xf6,
      0x24, 0x34, 0x60, 0xf,  0x5e, 0x60, 0xd7, 0xc3, 0xee, 0xcc, 0x4f, 0x4c, 0xbc, 0x86, 0x90, 0xa4, 0x10, 0x5e, 0x2d,
      0xbb, 0x2,  0x14, 0xe0, 0xb2, 0x0,  0x17, 0xd2, 0xdd, 0x14, 0x16, 0xd4, 0x5e, 0xa7, 0xd4, 0x76, 0x83, 0x8e, 0x7f,
      0x71, 0xbf, 0x88, 0xed, 0x36, 0xcb, 0xe3, 0x2e, 0xb5, 0x16, 0x8a, 0x0,  0x1e, 0x2d, 0xf7, 0x2b, 0x11, 0xe9, 0x7d,
      0x62, 0x74, 0x5,  0xc8, 0xf1, 0x5,  0xf,  0xb,  0xa3, 0x46, 0xad, 0xf6, 0xec, 0x68, 0xd9, 0x95, 0x55, 0x72, 0xed,
      0x13, 0xf4, 0xd0, 0xd9, 0x4,  0x0,  0x8,  0xb5, 0xc7, 0x24, 0x93, 0xb4, 0x3,  0x36, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x92, 0x50, 0x9, 0x99, 0x59, 0x88};
  uint8_t bytesprops1[] = {0xe7, 0xdf, 0x69, 0x7e, 0x3d, 0x65, 0xa0, 0xc4,
                           0xaf, 0xe8, 0xc6, 0x8a, 0x7d, 0xde, 0x12, 0x6a};
  uint8_t bytesprops2[] = {0xfd, 0xfa, 0x41, 0x55, 0x35, 0x42, 0x17, 0xff, 0x5b, 0xd2};
  uint8_t bytesprops4[] = {0x44, 0x2f, 0x65, 0xd7, 0x47, 0x3f, 0xca, 0x77, 0xc5, 0x15, 0x9d, 0xdd, 0xcc,
                           0xb,  0xf7, 0xf5, 0x20, 0x26, 0x7a, 0x92, 0x8d, 0xf5, 0x16, 0x18, 0xb5};
  uint8_t bytesprops3[] = {0xbe, 0x3, 0x94, 0x2a, 0x2b, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2002}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops3}, .v = {25, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7603}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xfd, 0x6c, 0xb6, 0x6f, 0xdd, 0xcd, 0xd6, 0x16, 0x70, 0xe7, 0xbf};
  uint8_t byteswillprops1[] = {0xd8, 0xf9, 0x3e, 0xb8, 0xcf, 0x25, 0x2e, 0xf3, 0xd6, 0x14, 0xc8, 0x60};
  uint8_t byteswillprops2[] = {0xbe, 0x18, 0xb,  0xf7, 0xac, 0xc3, 0x71, 0xb1, 0x43, 0xab,
                               0x35, 0x7b, 0xf8, 0x33, 0x5b, 0xdf, 0x87, 0x86, 0x27};
  uint8_t byteswillprops3[] = {0xf8, 0xe5, 0x3d, 0x4c, 0xa5, 0x3d, 0x14, 0xf1, 0xb5, 0x3c, 0xae, 0xbc, 0x71, 0x2e};
  uint8_t byteswillprops4[] = {0x91, 0xb8, 0x49, 0x33, 0xda, 0x9c, 0x8b, 0x99, 0x8,  0x85, 0x2c, 0xb6, 0xa, 0x70,
                               0x13, 0x84, 0x5,  0xf3, 0x3,  0xf0, 0xa7, 0x11, 0xc2, 0x42, 0x3,  0x79, 0x6c};
  uint8_t byteswillprops5[] = {0xc8, 0xe, 0xf0, 0xdf, 0xea, 0x30};
  uint8_t byteswillprops6[] = {0x21, 0x98, 0x60, 0xc6, 0x94, 0x8c, 0x11, 0x51, 0x18, 0xb, 0xf2, 0xc0, 0xb6, 0x20, 0xc6};
  uint8_t byteswillprops7[] = {0x43, 0xfd, 0x2f, 0xd7};
  uint8_t byteswillprops8[] = {0xb6, 0x2d, 0x92, 0x59, 0xc4, 0x8,  0xca, 0xd6, 0x12,
                               0x91, 0x94, 0x1b, 0x3d, 0xb4, 0xff, 0x51, 0x2b};
  uint8_t byteswillprops9[] = {0xcb, 0xe9, 0xf2, 0x99, 0xa6, 0xf6, 0x58, 0xeb, 0x35, 0x27, 0x90, 0x21, 0x3e,
                               0xf0, 0xcf, 0x10, 0x39, 0xd9, 0x78, 0x72, 0x9e, 0xff, 0xf1, 0x2e, 0x6a, 0x7b};
  uint8_t byteswillprops10[] = {0x6b, 0xe4, 0x9,  0x5f, 0xfc, 0xa5, 0x52, 0x46, 0xb3, 0x7b, 0x5a, 0x4,  0xcf, 0xc9,
                                0xc5, 0x53, 0x59, 0x27, 0xea, 0x87, 0x6b, 0xa6, 0x98, 0x3b, 0x7f, 0xac, 0xf2};
  uint8_t byteswillprops11[] = {0x4, 0xd, 0xae, 0x9a, 0x66, 0xa5, 0x22, 0xc3, 0x9e, 0xc9, 0x1};
  uint8_t byteswillprops13[] = {0x9f};
  uint8_t byteswillprops12[] = {0x62, 0x90, 0xfb, 0xf0, 0x1f, 0xf5, 0x15, 0x28, 0xf, 0x6f,
                                0x25, 0x6c, 0xb2, 0xae, 0x56, 0xbf, 0xe2, 0x7a, 0x44};
  uint8_t byteswillprops14[] = {0xd, 0x46, 0x69, 0xe, 0x60, 0x41, 0x69, 0x6a, 0x35, 0xe7, 0x71, 0xb9, 0x1f, 0x36};
  uint8_t byteswillprops15[] = {0x34, 0x70, 0xcb, 0x8d, 0x85, 0x99, 0x73, 0x34, 0x48, 0x5a};
  uint8_t byteswillprops16[] = {0x78, 0xc1, 0xcc, 0x36, 0xce, 0xf7};
  uint8_t byteswillprops17[] = {0xf6, 0x34, 0x1f, 0x2b, 0x7, 0x4e, 0xa1, 0xef, 0x61};
  uint8_t byteswillprops18[] = {0x81, 0x96, 0xc9, 0x7d, 0x3c, 0xcf};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30413}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27251}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&byteswillprops12}, .v = {1, (char*)&byteswillprops13}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28407}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops15}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&byteswillprops16}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&byteswillprops17}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops18}}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe3, 0xae, 0x82, 0xb9, 0xf6, 0x24, 0x34, 0x60, 0xf,  0x5e,
                                0x60, 0xd7, 0xc3, 0xee, 0xcc, 0x4f, 0x4c, 0xbc, 0x86, 0x90,
                                0xa4, 0x10, 0x5e, 0x2d, 0xbb, 0x2,  0x14, 0xe0, 0xb2};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd2, 0xdd, 0x14, 0x16, 0xd4, 0x5e, 0xa7, 0xd4, 0x76, 0x83, 0x8e, 0x7f,
                                  0x71, 0xbf, 0x88, 0xed, 0x36, 0xcb, 0xe3, 0x2e, 0xb5, 0x16, 0x8a};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20204;
  uint8_t client_id_bytes[] = {0x8c, 0xd4, 0xda, 0xf4, 0x70};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0xf7, 0x2b, 0x11, 0xe9, 0x7d, 0x62, 0x74, 0x5,  0xc8, 0xf1, 0x5,  0xf,  0xb,  0xa3,
                              0x46, 0xad, 0xf6, 0xec, 0x68, 0xd9, 0x95, 0x55, 0x72, 0xed, 0x13, 0xf4, 0xd0, 0xd9, 0x4};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb5, 0xc7, 0x24, 0x93, 0xb4, 0x3, 0x36, 0xca};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "r=\231\144i:\207\214h\149\199\202J", _password = Just "2\202\ACK*\135", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "rx&4\204G@rz\177>", _willMsg = "\237\222\176\197",
// _willProps = [PropResponseInformation "\198\198\223u\a\169",PropRetainAvailable 233,PropServerReference
// "x\RS\SI\v\251\NAK\NAK\157\148\130%\152@b\232",PropAuthenticationData
// "L{\162\164EUW\167B|\224\138\133\186\146\&4\147\199\136U",PropPayloadFormatIndicator 12,PropMessageExpiryInterval
// 30724,PropMaximumQoS 44,PropSharedSubscriptionAvailable 110,PropWillDelayInterval 3149,PropAuthenticationMethod
// "W]\140\205m\173\199\SOHRz\176 \170\228w(\200\EMv",PropWildcardSubscriptionAvailable 88,PropTopicAliasMaximum
// 12841,PropAuthenticationData "\209,}0\154\144\219G\230\178\134\131S",PropMessageExpiryInterval
// 13071,PropReceiveMaximum 29819,PropSessionExpiryInterval 26236,PropSubscriptionIdentifierAvailable
// 62,PropSubscriptionIdentifierAvailable 223,PropPayloadFormatIndicator 153,PropTopicAlias 13671,PropTopicAliasMaximum
// 17153,PropWillDelayInterval 5290]}), _cleanSession = False, _keepAlive = 11274, _connID =
// "\223\t\143\166\173\230\156\142\250\&1\248\EOT\185\ACK\235\144\155+\249\150\182\136\232\133\206", _properties =
// [PropReceiveMaximum 8593,PropWildcardSubscriptionAvailable 11,PropRequestProblemInformation 0,PropAuthenticationData
// "\141\DLE/\fO\251}\246\ENQ\137\187\EMNq\DC4\227\253\151\237V",PropContentType
// "x\167\208\240\204\138\238\184J\181\SI\212\215\137",PropUserProperty
// "-\236\nC\144\225\&3j\FS\184U\RS\194l\182z\192|\202\195\158\191\149l.\177\204\240"
// "1\221\133\201\162\ETX\238\165\226\137\173\170",PropUserProperty "\250\191m\157\191N\186\&1\RS\231\ENQN"
// "\SUB\242^i=\134\142\DC3\242\226Q\SOH\141\138f\226\194\196\219\158\128Jt\131\ti",PropResponseInformation
// "\158\239\130\168\DC2u7\130%\144\\\GSa#\199'\227|y\192\182",PropSharedSubscriptionAvailable
// 40,PropRequestResponseInformation 156,PropContentType
// "\140\220d\189\208\DC1\159\169B\DC1\130\181\155\157h2\ETX\DEL\175}\231\132\a\196\222oY",PropCorrelationData "p5"]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0xa5, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x2c, 0xa,  0xc6, 0x1,  0x21, 0x21, 0x91, 0x28,
      0xb,  0x17, 0x0,  0x16, 0x0,  0x14, 0x8d, 0x10, 0x2f, 0xc,  0x4f, 0xfb, 0x7d, 0xf6, 0x5,  0x89, 0xbb, 0x19, 0x4e,
      0x71, 0x14, 0xe3, 0xfd, 0x97, 0xed, 0x56, 0x3,  0x0,  0xe,  0x78, 0xa7, 0xd0, 0xf0, 0xcc, 0x8a, 0xee, 0xb8, 0x4a,
      0xb5, 0xf,  0xd4, 0xd7, 0x89, 0x26, 0x0,  0x1c, 0x2d, 0xec, 0xa,  0x43, 0x90, 0xe1, 0x33, 0x6a, 0x1c, 0xb8, 0x55,
      0x1e, 0xc2, 0x6c, 0xb6, 0x7a, 0xc0, 0x7c, 0xca, 0xc3, 0x9e, 0xbf, 0x95, 0x6c, 0x2e, 0xb1, 0xcc, 0xf0, 0x0,  0xc,
      0x31, 0xdd, 0x85, 0xc9, 0xa2, 0x3,  0xee, 0xa5, 0xe2, 0x89, 0xad, 0xaa, 0x26, 0x0,  0xc,  0xfa, 0xbf, 0x6d, 0x9d,
      0xbf, 0x4e, 0xba, 0x31, 0x1e, 0xe7, 0x5,  0x4e, 0x0,  0x1a, 0x1a, 0xf2, 0x5e, 0x69, 0x3d, 0x86, 0x8e, 0x13, 0xf2,
      0xe2, 0x51, 0x1,  0x8d, 0x8a, 0x66, 0xe2, 0xc2, 0xc4, 0xdb, 0x9e, 0x80, 0x4a, 0x74, 0x83, 0x9,  0x69, 0x1a, 0x0,
      0x15, 0x9e, 0xef, 0x82, 0xa8, 0x12, 0x75, 0x37, 0x82, 0x25, 0x90, 0x5c, 0x1d, 0x61, 0x23, 0xc7, 0x27, 0xe3, 0x7c,
      0x79, 0xc0, 0xb6, 0x2a, 0x28, 0x19, 0x9c, 0x3,  0x0,  0x1b, 0x8c, 0xdc, 0x64, 0xbd, 0xd0, 0x11, 0x9f, 0xa9, 0x42,
      0x11, 0x82, 0xb5, 0x9b, 0x9d, 0x68, 0x32, 0x3,  0x7f, 0xaf, 0x7d, 0xe7, 0x84, 0x7,  0xc4, 0xde, 0x6f, 0x59, 0x9,
      0x0,  0x2,  0x70, 0x35, 0x0,  0x19, 0xdf, 0x9,  0x8f, 0xa6, 0xad, 0xe6, 0x9c, 0x8e, 0xfa, 0x31, 0xf8, 0x4,  0xb9,
      0x6,  0xeb, 0x90, 0x9b, 0x2b, 0xf9, 0x96, 0xb6, 0x88, 0xe8, 0x85, 0xce, 0x8d, 0x1,  0x1a, 0x0,  0x6,  0xc6, 0xc6,
      0xdf, 0x75, 0x7,  0xa9, 0x25, 0xe9, 0x1c, 0x0,  0xf,  0x78, 0x1e, 0xf,  0xb,  0xfb, 0x15, 0x15, 0x9d, 0x94, 0x82,
      0x25, 0x98, 0x40, 0x62, 0xe8, 0x16, 0x0,  0x14, 0x4c, 0x7b, 0xa2, 0xa4, 0x45, 0x55, 0x57, 0xa7, 0x42, 0x7c, 0xe0,
      0x8a, 0x85, 0xba, 0x92, 0x34, 0x93, 0xc7, 0x88, 0x55, 0x1,  0xc,  0x2,  0x0,  0x0,  0x78, 0x4,  0x24, 0x2c, 0x2a,
      0x6e, 0x18, 0x0,  0x0,  0xc,  0x4d, 0x15, 0x0,  0x13, 0x57, 0x5d, 0x8c, 0xcd, 0x6d, 0xad, 0xc7, 0x1,  0x52, 0x7a,
      0xb0, 0x20, 0xaa, 0xe4, 0x77, 0x28, 0xc8, 0x19, 0x76, 0x28, 0x58, 0x22, 0x32, 0x29, 0x16, 0x0,  0xd,  0xd1, 0x2c,
      0x7d, 0x30, 0x9a, 0x90, 0xdb, 0x47, 0xe6, 0xb2, 0x86, 0x83, 0x53, 0x2,  0x0,  0x0,  0x33, 0xf,  0x21, 0x74, 0x7b,
      0x11, 0x0,  0x0,  0x66, 0x7c, 0x29, 0x3e, 0x29, 0xdf, 0x1,  0x99, 0x23, 0x35, 0x67, 0x22, 0x43, 0x1,  0x18, 0x0,
      0x0,  0x14, 0xaa, 0x0,  0xb,  0x72, 0x78, 0x26, 0x34, 0xcc, 0x47, 0x40, 0x72, 0x7a, 0xb1, 0x3e, 0x0,  0x4,  0xed,
      0xde, 0xb0, 0xc5, 0x0,  0xd,  0x72, 0x3d, 0xe7, 0x90, 0x69, 0x3a, 0xcf, 0xd6, 0x68, 0x95, 0xc7, 0xca, 0x4a, 0x0,
      0x5,  0x32, 0xca, 0x6,  0x2a, 0x87};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8d, 0x10, 0x2f, 0xc,  0x4f, 0xfb, 0x7d, 0xf6, 0x5,  0x89,
                           0xbb, 0x19, 0x4e, 0x71, 0x14, 0xe3, 0xfd, 0x97, 0xed, 0x56};
  uint8_t bytesprops1[] = {0x78, 0xa7, 0xd0, 0xf0, 0xcc, 0x8a, 0xee, 0xb8, 0x4a, 0xb5, 0xf, 0xd4, 0xd7, 0x89};
  uint8_t bytesprops3[] = {0x31, 0xdd, 0x85, 0xc9, 0xa2, 0x3, 0xee, 0xa5, 0xe2, 0x89, 0xad, 0xaa};
  uint8_t bytesprops2[] = {0x2d, 0xec, 0xa,  0x43, 0x90, 0xe1, 0x33, 0x6a, 0x1c, 0xb8, 0x55, 0x1e, 0xc2, 0x6c,
                           0xb6, 0x7a, 0xc0, 0x7c, 0xca, 0xc3, 0x9e, 0xbf, 0x95, 0x6c, 0x2e, 0xb1, 0xcc, 0xf0};
  uint8_t bytesprops5[] = {0x1a, 0xf2, 0x5e, 0x69, 0x3d, 0x86, 0x8e, 0x13, 0xf2, 0xe2, 0x51, 0x1, 0x8d,
                           0x8a, 0x66, 0xe2, 0xc2, 0xc4, 0xdb, 0x9e, 0x80, 0x4a, 0x74, 0x83, 0x9, 0x69};
  uint8_t bytesprops4[] = {0xfa, 0xbf, 0x6d, 0x9d, 0xbf, 0x4e, 0xba, 0x31, 0x1e, 0xe7, 0x5, 0x4e};
  uint8_t bytesprops6[] = {0x9e, 0xef, 0x82, 0xa8, 0x12, 0x75, 0x37, 0x82, 0x25, 0x90, 0x5c,
                           0x1d, 0x61, 0x23, 0xc7, 0x27, 0xe3, 0x7c, 0x79, 0xc0, 0xb6};
  uint8_t bytesprops7[] = {0x8c, 0xdc, 0x64, 0xbd, 0xd0, 0x11, 0x9f, 0xa9, 0x42, 0x11, 0x82, 0xb5, 0x9b, 0x9d,
                           0x68, 0x32, 0x3,  0x7f, 0xaf, 0x7d, 0xe7, 0x84, 0x7,  0xc4, 0xde, 0x6f, 0x59};
  uint8_t bytesprops8[] = {0x70, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8593}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops2}, .v = {12, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops4}, .v = {26, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc6, 0xc6, 0xdf, 0x75, 0x7, 0xa9};
  uint8_t byteswillprops1[] = {0x78, 0x1e, 0xf, 0xb, 0xfb, 0x15, 0x15, 0x9d, 0x94, 0x82, 0x25, 0x98, 0x40, 0x62, 0xe8};
  uint8_t byteswillprops2[] = {0x4c, 0x7b, 0xa2, 0xa4, 0x45, 0x55, 0x57, 0xa7, 0x42, 0x7c,
                               0xe0, 0x8a, 0x85, 0xba, 0x92, 0x34, 0x93, 0xc7, 0x88, 0x55};
  uint8_t byteswillprops3[] = {0x57, 0x5d, 0x8c, 0xcd, 0x6d, 0xad, 0xc7, 0x1,  0x52, 0x7a,
                               0xb0, 0x20, 0xaa, 0xe4, 0x77, 0x28, 0xc8, 0x19, 0x76};
  uint8_t byteswillprops4[] = {0xd1, 0x2c, 0x7d, 0x30, 0x9a, 0x90, 0xdb, 0x47, 0xe6, 0xb2, 0x86, 0x83, 0x53};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30724}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3149}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12841}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13071}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29819}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26236}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13671}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17153}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5290}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x72, 0x78, 0x26, 0x34, 0xcc, 0x47, 0x40, 0x72, 0x7a, 0xb1, 0x3e};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xed, 0xde, 0xb0, 0xc5};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11274;
  uint8_t client_id_bytes[] = {0xdf, 0x9,  0x8f, 0xa6, 0xad, 0xe6, 0x9c, 0x8e, 0xfa, 0x31, 0xf8, 0x4, 0xb9,
                               0x6,  0xeb, 0x90, 0x9b, 0x2b, 0xf9, 0x96, 0xb6, 0x88, 0xe8, 0x85, 0xce};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x72, 0x3d, 0xe7, 0x90, 0x69, 0x3a, 0xcf, 0xd6, 0x68, 0x95, 0xc7, 0xca, 0x4a};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x32, 0xca, 0x6, 0x2a, 0x87};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "#Q\186\\\192N\NUL\ETB\159\205\a\194`T\211\EM\157\133\ACKf;Z\189\220\129\164", _willMsg =
// "\EOT\228!\252NLON\246\199\210g\235\225\255\130\139\v ", _willProps = [PropMaximumPacketSize 15164,PropResponseTopic
// "[X\186\ENQ\244",PropWildcardSubscriptionAvailable 129,PropContentType
// "\137\DLEHZIp'\222\212\195\246+{g_\155\199\244\162\GS\232\ACK\FS\227\241^",PropReceiveMaximum
// 14987,PropWildcardSubscriptionAvailable 119,PropResponseTopic
// "\243\133S;-\190\EOT\238\138\FSl\218\DC2\249\DC1*\fqJ\128\226R\181",PropMessageExpiryInterval
// 3660,PropCorrelationData "\252l\236\173\161\130\147\175ZO`\186\235?4\154[d l-\189\EOTd\139T",PropAuthenticationData
// "\b\164\ETX\171\133\221\191\DEL\245\159\137\186\129{\230\215_\136M\143\203\172D\137\129\EM",PropRetainAvailable
// 48,PropUserProperty "$\176w\130\170X\153NdQ\210+\134\215\ETX\227"
// "\206=\255&\220\130\131\b\ENQ\221f\146\162m\196y<r]\183/\179r\n\176\166d\228",PropUserProperty
// "\218$5\168\198\DC1\GS\a\209[\174Z4\b\DEL"
// "\192\146\222\FS\t9\170e\240$@\151xJ\FSkd\167\133",PropSessionExpiryInterval 20680,PropReceiveMaximum
// 6221,PropServerReference "SP\181\183\132\167j\175\146d\231\210\ETX\160\164",PropResponseTopic
// "U\204\145h\DC17,\181\&0d",PropSubscriptionIdentifierAvailable 218,PropAuthenticationMethod
// "\DC4v\245^\US\234\162\234h2\253\219\155_c\219\134",PropAuthenticationData "a<p\136&\141\206\&0\DC3\185d
// \253\239\154\201\DC1\231\208\177\248\255o\221",PropRequestProblemInformation 74]}), _cleanSession = True, _keepAlive
// = 13058, _connID = ".d\DC4\204\250e\224\180\140\158\RS3)G\143\172\SOST\ETBEX", _properties = [PropServerKeepAlive
// 6137,PropMessageExpiryInterval 5995,PropAuthenticationMethod
// "fd)\SOH\254\253\DC1\DLE!\DC1\168w6\230m\175\179H\147\235c\159\222\STX",PropUserProperty
// "%\NAK\161]P\196\136\251\132B+\243K\230s\DC4\195\SOHy#(\GS`"
// "\144\f\236\219(1@\SOH\227\&4<\239\195",PropServerKeepAlive 2713,PropRequestProblemInformation 221,PropResponseTopic
// "\232\250",PropCorrelationData
// "\167\160-\\\130\188-\244~\n&*\204Z\247\155\135\&7\146\152\191-\217\ENQj:\133",PropAuthenticationMethod
// "u\138\ENQ\204\173\ESCF\183`qi\220^\192\185A\150",PropMessageExpiryInterval 14510,PropWildcardSubscriptionAvailable
// 108,PropWildcardSubscriptionAvailable 202,PropSessionExpiryInterval 1590,PropWillDelayInterval
// 14239,PropMessageExpiryInterval 26634,PropAuthenticationMethod "_2f\186I\n$9PM:",PropMaximumQoS
// 19,PropAuthenticationData "\225W>{\237\202\232\220@v\181\146-",PropReceiveMaximum 30893,PropServerReference
// "D",PropWildcardSubscriptionAvailable 103,PropServerKeepAlive 9030,PropRetainAvailable 158,PropMaximumPacketSize
// 17128,PropServerKeepAlive 13020,PropServerKeepAlive 17468]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x10, 0xee, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x33, 0x2,  0xd9, 0x1,  0x13, 0x17, 0xf9, 0x2,
      0x0,  0x0,  0x17, 0x6b, 0x15, 0x0,  0x18, 0x66, 0x64, 0x29, 0x1,  0xfe, 0xfd, 0x11, 0x10, 0x21, 0x11, 0xa8, 0x77,
      0x36, 0xe6, 0x6d, 0xaf, 0xb3, 0x48, 0x93, 0xeb, 0x63, 0x9f, 0xde, 0x2,  0x26, 0x0,  0x17, 0x25, 0x15, 0xa1, 0x5d,
      0x50, 0xc4, 0x88, 0xfb, 0x84, 0x42, 0x2b, 0xf3, 0x4b, 0xe6, 0x73, 0x14, 0xc3, 0x1,  0x79, 0x23, 0x28, 0x1d, 0x60,
      0x0,  0xd,  0x90, 0xc,  0xec, 0xdb, 0x28, 0x31, 0x40, 0x1,  0xe3, 0x34, 0x3c, 0xef, 0xc3, 0x13, 0xa,  0x99, 0x17,
      0xdd, 0x8,  0x0,  0x2,  0xe8, 0xfa, 0x9,  0x0,  0x1b, 0xa7, 0xa0, 0x2d, 0x5c, 0x82, 0xbc, 0x2d, 0xf4, 0x7e, 0xa,
      0x26, 0x2a, 0xcc, 0x5a, 0xf7, 0x9b, 0x87, 0x37, 0x92, 0x98, 0xbf, 0x2d, 0xd9, 0x5,  0x6a, 0x3a, 0x85, 0x15, 0x0,
      0x11, 0x75, 0x8a, 0x5,  0xcc, 0xad, 0x1b, 0x46, 0xb7, 0x60, 0x71, 0x69, 0xdc, 0x5e, 0xc0, 0xb9, 0x41, 0x96, 0x2,
      0x0,  0x0,  0x38, 0xae, 0x28, 0x6c, 0x28, 0xca, 0x11, 0x0,  0x0,  0x6,  0x36, 0x18, 0x0,  0x0,  0x37, 0x9f, 0x2,
      0x0,  0x0,  0x68, 0xa,  0x15, 0x0,  0xb,  0x5f, 0x32, 0x66, 0xba, 0x49, 0xa,  0x24, 0x39, 0x50, 0x4d, 0x3a, 0x24,
      0x13, 0x16, 0x0,  0xd,  0xe1, 0x57, 0x3e, 0x7b, 0xed, 0xca, 0xe8, 0xdc, 0x40, 0x76, 0xb5, 0x92, 0x2d, 0x21, 0x78,
      0xad, 0x1c, 0x0,  0x1,  0x44, 0x28, 0x67, 0x13, 0x23, 0x46, 0x25, 0x9e, 0x27, 0x0,  0x0,  0x42, 0xe8, 0x13, 0x32,
      0xdc, 0x13, 0x44, 0x3c, 0x0,  0x16, 0x2e, 0x64, 0x14, 0xcc, 0xfa, 0x65, 0xe0, 0xb4, 0x8c, 0x9e, 0x1e, 0x33, 0x29,
      0x47, 0x8f, 0xac, 0xe,  0x53, 0x54, 0x17, 0x45, 0x58, 0xbe, 0x2,  0x27, 0x0,  0x0,  0x3b, 0x3c, 0x8,  0x0,  0x5,
      0x5b, 0x58, 0xba, 0x5,  0xf4, 0x28, 0x81, 0x3,  0x0,  0x1a, 0x89, 0x10, 0x48, 0x5a, 0x49, 0x70, 0x27, 0xde, 0xd4,
      0xc3, 0xf6, 0x2b, 0x7b, 0x67, 0x5f, 0x9b, 0xc7, 0xf4, 0xa2, 0x1d, 0xe8, 0x6,  0x1c, 0xe3, 0xf1, 0x5e, 0x21, 0x3a,
      0x8b, 0x28, 0x77, 0x8,  0x0,  0x17, 0xf3, 0x85, 0x53, 0x3b, 0x2d, 0xbe, 0x4,  0xee, 0x8a, 0x1c, 0x6c, 0xda, 0x12,
      0xf9, 0x11, 0x2a, 0xc,  0x71, 0x4a, 0x80, 0xe2, 0x52, 0xb5, 0x2,  0x0,  0x0,  0xe,  0x4c, 0x9,  0x0,  0x1a, 0xfc,
      0x6c, 0xec, 0xad, 0xa1, 0x82, 0x93, 0xaf, 0x5a, 0x4f, 0x60, 0xba, 0xeb, 0x3f, 0x34, 0x9a, 0x5b, 0x64, 0x20, 0x6c,
      0x2d, 0xbd, 0x4,  0x64, 0x8b, 0x54, 0x16, 0x0,  0x1a, 0x8,  0xa4, 0x3,  0xab, 0x85, 0xdd, 0xbf, 0x7f, 0xf5, 0x9f,
      0x89, 0xba, 0x81, 0x7b, 0xe6, 0xd7, 0x5f, 0x88, 0x4d, 0x8f, 0xcb, 0xac, 0x44, 0x89, 0x81, 0x19, 0x25, 0x30, 0x26,
      0x0,  0x10, 0x24, 0xb0, 0x77, 0x82, 0xaa, 0x58, 0x99, 0x4e, 0x64, 0x51, 0xd2, 0x2b, 0x86, 0xd7, 0x3,  0xe3, 0x0,
      0x1c, 0xce, 0x3d, 0xff, 0x26, 0xdc, 0x82, 0x83, 0x8,  0x5,  0xdd, 0x66, 0x92, 0xa2, 0x6d, 0xc4, 0x79, 0x3c, 0x72,
      0x5d, 0xb7, 0x2f, 0xb3, 0x72, 0xa,  0xb0, 0xa6, 0x64, 0xe4, 0x26, 0x0,  0xf,  0xda, 0x24, 0x35, 0xa8, 0xc6, 0x11,
      0x1d, 0x7,  0xd1, 0x5b, 0xae, 0x5a, 0x34, 0x8,  0x7f, 0x0,  0x13, 0xc0, 0x92, 0xde, 0x1c, 0x9,  0x39, 0xaa, 0x65,
      0xf0, 0x24, 0x40, 0x97, 0x78, 0x4a, 0x1c, 0x6b, 0x64, 0xa7, 0x85, 0x11, 0x0,  0x0,  0x50, 0xc8, 0x21, 0x18, 0x4d,
      0x1c, 0x0,  0xf,  0x53, 0x50, 0xb5, 0xb7, 0x84, 0xa7, 0x6a, 0xaf, 0x92, 0x64, 0xe7, 0xd2, 0x3,  0xa0, 0xa4, 0x8,
      0x0,  0xa,  0x55, 0xcc, 0x91, 0x68, 0x11, 0x37, 0x2c, 0xb5, 0x30, 0x64, 0x29, 0xda, 0x15, 0x0,  0x11, 0x14, 0x76,
      0xf5, 0x5e, 0x1f, 0xea, 0xa2, 0xea, 0x68, 0x32, 0xfd, 0xdb, 0x9b, 0x5f, 0x63, 0xdb, 0x86, 0x16, 0x0,  0x18, 0x61,
      0x3c, 0x70, 0x88, 0x26, 0x8d, 0xce, 0x30, 0x13, 0xb9, 0x64, 0x20, 0xfd, 0xef, 0x9a, 0xc9, 0x11, 0xe7, 0xd0, 0xb1,
      0xf8, 0xff, 0x6f, 0xdd, 0x17, 0x4a, 0x0,  0x1a, 0x23, 0x51, 0xba, 0x5c, 0xc0, 0x4e, 0x0,  0x17, 0x9f, 0xcd, 0x7,
      0xc2, 0x60, 0x54, 0xd3, 0x19, 0x9d, 0x85, 0x6,  0x66, 0x3b, 0x5a, 0xbd, 0xdc, 0x81, 0xa4, 0x0,  0x13, 0x4,  0xe4,
      0x21, 0xfc, 0x4e, 0x4c, 0x4f, 0x4e, 0xf6, 0xc7, 0xd2, 0x67, 0xeb, 0xe1, 0xff, 0x82, 0x8b, 0xb,  0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x66, 0x64, 0x29, 0x1,  0xfe, 0xfd, 0x11, 0x10, 0x21, 0x11, 0xa8, 0x77,
                           0x36, 0xe6, 0x6d, 0xaf, 0xb3, 0x48, 0x93, 0xeb, 0x63, 0x9f, 0xde, 0x2};
  uint8_t bytesprops2[] = {0x90, 0xc, 0xec, 0xdb, 0x28, 0x31, 0x40, 0x1, 0xe3, 0x34, 0x3c, 0xef, 0xc3};
  uint8_t bytesprops1[] = {0x25, 0x15, 0xa1, 0x5d, 0x50, 0xc4, 0x88, 0xfb, 0x84, 0x42, 0x2b, 0xf3,
                           0x4b, 0xe6, 0x73, 0x14, 0xc3, 0x1,  0x79, 0x23, 0x28, 0x1d, 0x60};
  uint8_t bytesprops3[] = {0xe8, 0xfa};
  uint8_t bytesprops4[] = {0xa7, 0xa0, 0x2d, 0x5c, 0x82, 0xbc, 0x2d, 0xf4, 0x7e, 0xa, 0x26, 0x2a, 0xcc, 0x5a,
                           0xf7, 0x9b, 0x87, 0x37, 0x92, 0x98, 0xbf, 0x2d, 0xd9, 0x5, 0x6a, 0x3a, 0x85};
  uint8_t bytesprops5[] = {0x75, 0x8a, 0x5,  0xcc, 0xad, 0x1b, 0x46, 0xb7, 0x60,
                           0x71, 0x69, 0xdc, 0x5e, 0xc0, 0xb9, 0x41, 0x96};
  uint8_t bytesprops6[] = {0x5f, 0x32, 0x66, 0xba, 0x49, 0xa, 0x24, 0x39, 0x50, 0x4d, 0x3a};
  uint8_t bytesprops7[] = {0xe1, 0x57, 0x3e, 0x7b, 0xed, 0xca, 0xe8, 0xdc, 0x40, 0x76, 0xb5, 0x92, 0x2d};
  uint8_t bytesprops8[] = {0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6137}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5995}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops1}, .v = {13, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2713}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14510}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1590}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14239}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26634}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30893}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9030}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17128}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13020}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17468}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x5b, 0x58, 0xba, 0x5, 0xf4};
  uint8_t byteswillprops1[] = {0x89, 0x10, 0x48, 0x5a, 0x49, 0x70, 0x27, 0xde, 0xd4, 0xc3, 0xf6, 0x2b, 0x7b,
                               0x67, 0x5f, 0x9b, 0xc7, 0xf4, 0xa2, 0x1d, 0xe8, 0x6,  0x1c, 0xe3, 0xf1, 0x5e};
  uint8_t byteswillprops2[] = {0xf3, 0x85, 0x53, 0x3b, 0x2d, 0xbe, 0x4,  0xee, 0x8a, 0x1c, 0x6c, 0xda,
                               0x12, 0xf9, 0x11, 0x2a, 0xc,  0x71, 0x4a, 0x80, 0xe2, 0x52, 0xb5};
  uint8_t byteswillprops3[] = {0xfc, 0x6c, 0xec, 0xad, 0xa1, 0x82, 0x93, 0xaf, 0x5a, 0x4f, 0x60, 0xba, 0xeb,
                               0x3f, 0x34, 0x9a, 0x5b, 0x64, 0x20, 0x6c, 0x2d, 0xbd, 0x4,  0x64, 0x8b, 0x54};
  uint8_t byteswillprops4[] = {0x8,  0xa4, 0x3,  0xab, 0x85, 0xdd, 0xbf, 0x7f, 0xf5, 0x9f, 0x89, 0xba, 0x81,
                               0x7b, 0xe6, 0xd7, 0x5f, 0x88, 0x4d, 0x8f, 0xcb, 0xac, 0x44, 0x89, 0x81, 0x19};
  uint8_t byteswillprops6[] = {0xce, 0x3d, 0xff, 0x26, 0xdc, 0x82, 0x83, 0x8,  0x5,  0xdd, 0x66, 0x92, 0xa2, 0x6d,
                               0xc4, 0x79, 0x3c, 0x72, 0x5d, 0xb7, 0x2f, 0xb3, 0x72, 0xa,  0xb0, 0xa6, 0x64, 0xe4};
  uint8_t byteswillprops5[] = {0x24, 0xb0, 0x77, 0x82, 0xaa, 0x58, 0x99, 0x4e,
                               0x64, 0x51, 0xd2, 0x2b, 0x86, 0xd7, 0x3,  0xe3};
  uint8_t byteswillprops8[] = {0xc0, 0x92, 0xde, 0x1c, 0x9,  0x39, 0xaa, 0x65, 0xf0, 0x24,
                               0x40, 0x97, 0x78, 0x4a, 0x1c, 0x6b, 0x64, 0xa7, 0x85};
  uint8_t byteswillprops7[] = {0xda, 0x24, 0x35, 0xa8, 0xc6, 0x11, 0x1d, 0x7, 0xd1, 0x5b, 0xae, 0x5a, 0x34, 0x8, 0x7f};
  uint8_t byteswillprops9[] = {0x53, 0x50, 0xb5, 0xb7, 0x84, 0xa7, 0x6a, 0xaf, 0x92, 0x64, 0xe7, 0xd2, 0x3, 0xa0, 0xa4};
  uint8_t byteswillprops10[] = {0x55, 0xcc, 0x91, 0x68, 0x11, 0x37, 0x2c, 0xb5, 0x30, 0x64};
  uint8_t byteswillprops11[] = {0x14, 0x76, 0xf5, 0x5e, 0x1f, 0xea, 0xa2, 0xea, 0x68,
                                0x32, 0xfd, 0xdb, 0x9b, 0x5f, 0x63, 0xdb, 0x86};
  uint8_t byteswillprops12[] = {0x61, 0x3c, 0x70, 0x88, 0x26, 0x8d, 0xce, 0x30, 0x13, 0xb9, 0x64, 0x20,
                                0xfd, 0xef, 0x9a, 0xc9, 0x11, 0xe7, 0xd0, 0xb1, 0xf8, 0xff, 0x6f, 0xdd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15164}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14987}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3660}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops5}, .v = {28, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {15, (char*)&byteswillprops7}, .v = {19, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20680}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6221}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 74}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x23, 0x51, 0xba, 0x5c, 0xc0, 0x4e, 0x0,  0x17, 0x9f, 0xcd, 0x7,  0xc2, 0x60,
                                0x54, 0xd3, 0x19, 0x9d, 0x85, 0x6,  0x66, 0x3b, 0x5a, 0xbd, 0xdc, 0x81, 0xa4};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4,  0xe4, 0x21, 0xfc, 0x4e, 0x4c, 0x4f, 0x4e, 0xf6, 0xc7,
                                  0xd2, 0x67, 0xeb, 0xe1, 0xff, 0x82, 0x8b, 0xb,  0x20};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13058;
  uint8_t client_id_bytes[] = {0x2e, 0x64, 0x14, 0xcc, 0xfa, 0x65, 0xe0, 0xb4, 0x8c, 0x9e, 0x1e,
                               0x33, 0x29, 0x47, 0x8f, 0xac, 0xe,  0x53, 0x54, 0x17, 0x45, 0x58};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "-\157\STX\167\DC4\171\157t", _password = Just "/j-", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 2165, _connID = ";l\192\DC1N\156z\170\170\165[\f", _properties =
// [PropSubscriptionIdentifierAvailable 80,PropPayloadFormatIndicator 153,PropPayloadFormatIndicator
// 45,PropTopicAliasMaximum 28038,PropRequestResponseInformation 248,PropSubscriptionIdentifierAvailable
// 35,PropSessionExpiryInterval 14184,PropSubscriptionIdentifier 17,PropSessionExpiryInterval
// 25123,PropRequestResponseInformation 80,PropRequestResponseInformation 214,PropSubscriptionIdentifier
// 11,PropReceiveMaximum 24025,PropUserProperty "Q\249\163\249-\197\197r\ENQ\239\USe\214\145"
// "\EMI\206G.\r\183v",PropTopicAliasMaximum 10284,PropServerKeepAlive 30193,PropWillDelayInterval
// 19307,PropUserProperty "v\174\133[\172\&6\ENQ\151\200\242\138\167\213'" "\249"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x84, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x8,  0x75, 0x5c, 0x29, 0x50, 0x1,
                   0x99, 0x1,  0x2d, 0x22, 0x6d, 0x86, 0x19, 0xf8, 0x29, 0x23, 0x11, 0x0,  0x0,  0x37, 0x68, 0xb,  0x11,
                   0x11, 0x0,  0x0,  0x62, 0x23, 0x19, 0x50, 0x19, 0xd6, 0xb,  0xb,  0x21, 0x5d, 0xd9, 0x26, 0x0,  0xe,
                   0x51, 0xf9, 0xa3, 0xf9, 0x2d, 0xc5, 0xc5, 0x72, 0x5,  0xef, 0x1f, 0x65, 0xd6, 0x91, 0x0,  0x8,  0x19,
                   0x49, 0xce, 0x47, 0x2e, 0xd,  0xb7, 0x76, 0x22, 0x28, 0x2c, 0x13, 0x75, 0xf1, 0x18, 0x0,  0x0,  0x4b,
                   0x6b, 0x26, 0x0,  0xe,  0x76, 0xae, 0x85, 0x5b, 0xac, 0x36, 0x5,  0x97, 0xc8, 0xf2, 0x8a, 0xa7, 0xd5,
                   0x27, 0x0,  0x1,  0xf9, 0x0,  0xc,  0x3b, 0x6c, 0xc0, 0x11, 0x4e, 0x9c, 0x7a, 0xaa, 0xaa, 0xa5, 0x5b,
                   0xc,  0x0,  0x8,  0x2d, 0x9d, 0x2,  0xa7, 0x14, 0xab, 0x9d, 0x74, 0x0,  0x3,  0x2f, 0x6a, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x19, 0x49, 0xce, 0x47, 0x2e, 0xd, 0xb7, 0x76};
  uint8_t bytesprops0[] = {0x51, 0xf9, 0xa3, 0xf9, 0x2d, 0xc5, 0xc5, 0x72, 0x5, 0xef, 0x1f, 0x65, 0xd6, 0x91};
  uint8_t bytesprops3[] = {0xf9};
  uint8_t bytesprops2[] = {0x76, 0xae, 0x85, 0x5b, 0xac, 0x36, 0x5, 0x97, 0xc8, 0xf2, 0x8a, 0xa7, 0xd5, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28038}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14184}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25123}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24025}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops0}, .v = {8, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10284}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30193}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19307}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops2}, .v = {1, (char*)&bytesprops3}}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2165;
  uint8_t client_id_bytes[] = {0x3b, 0x6c, 0xc0, 0x11, 0x4e, 0x9c, 0x7a, 0xaa, 0xaa, 0xa5, 0x5b, 0xc};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0x9d, 0x2, 0xa7, 0x14, 0xab, 0x9d, 0x74};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0x6a, 0x2d};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "^a,Y\US\230/\202\240\t\229\218\191\SUBdl", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\170", _willMsg =
// "@d\157b\SYN\150\&0\164\ENQ\236O\149e\129\218\210wSKU\DC4y\SOH\188\163m\EOT", _willProps = [PropReasonString
// "v\n\168/t\169",PropSubscriptionIdentifier 4,PropMessageExpiryInterval 21322,PropTopicAliasMaximum
// 9552,PropTopicAliasMaximum 24731,PropReceiveMaximum 29502,PropCorrelationData
// "n\196z\172-\214\141\173\168$Mx\DC4\184\&8",PropContentType
// "R\201aH\166*B\186\163/\145\235\174\US>S\DC4-\191\137\209\&7^\212y\DC1To\CAN",PropMessageExpiryInterval
// 3252,PropAuthenticationData "\EM\248",PropServerReference "",PropWillDelayInterval 21121,PropContentType
// "\193\193\234_\223G@\232^\136\218\233Y1'\DC4\204t\250",PropUserProperty "\168"
// "v\238\176\NAK\f\ETB7\ESCUU\222y?\163\159\175\189\159\v\186!-;f<a\153\191\205",PropResponseTopic
// "0Z\189cyc\132\247f8\169@\193\179E\198\SYN)0c\219\157\175p \176",PropReceiveMaximum
// 16985,PropWildcardSubscriptionAvailable 145,PropRequestResponseInformation 49,PropResponseTopic
// "\"",PropAuthenticationData
// "\SIG\180'\207\227\241\247}p\215q\148\165\129`\235\153u\185\238\254",PropMessageExpiryInterval 15346,PropUserProperty
// "\236\EM\166U\SI\204\226" "\225\130b\254\129Z\179\&87\157\&0\195\&5",PropServerReference
// "\174\129\169\132\ETX\221\&5"]}), _cleanSession = True, _keepAlive = 10569, _connID = "\185Xg$ZH\152\132 !",
// _properties = [PropSharedSubscriptionAvailable 95,PropMessageExpiryInterval 26124,PropWillDelayInterval 7452]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xd6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x46, 0x29, 0x49, 0xc,  0x2a, 0x5f, 0x2,  0x0,  0x0,
      0x66, 0xc,  0x18, 0x0,  0x0,  0x1d, 0x1c, 0x0,  0xa,  0xb9, 0x58, 0x67, 0x24, 0x5a, 0x48, 0x98, 0x84, 0x20, 0x21,
      0xff, 0x1,  0x1f, 0x0,  0x6,  0x76, 0xa,  0xa8, 0x2f, 0x74, 0xa9, 0xb,  0x4,  0x2,  0x0,  0x0,  0x53, 0x4a, 0x22,
      0x25, 0x50, 0x22, 0x60, 0x9b, 0x21, 0x73, 0x3e, 0x9,  0x0,  0xf,  0x6e, 0xc4, 0x7a, 0xac, 0x2d, 0xd6, 0x8d, 0xad,
      0xa8, 0x24, 0x4d, 0x78, 0x14, 0xb8, 0x38, 0x3,  0x0,  0x1d, 0x52, 0xc9, 0x61, 0x48, 0xa6, 0x2a, 0x42, 0xba, 0xa3,
      0x2f, 0x91, 0xeb, 0xae, 0x1f, 0x3e, 0x53, 0x14, 0x2d, 0xbf, 0x89, 0xd1, 0x37, 0x5e, 0xd4, 0x79, 0x11, 0x54, 0x6f,
      0x18, 0x2,  0x0,  0x0,  0xc,  0xb4, 0x16, 0x0,  0x2,  0x19, 0xf8, 0x1c, 0x0,  0x0,  0x18, 0x0,  0x0,  0x52, 0x81,
      0x3,  0x0,  0x13, 0xc1, 0xc1, 0xea, 0x5f, 0xdf, 0x47, 0x40, 0xe8, 0x5e, 0x88, 0xda, 0xe9, 0x59, 0x31, 0x27, 0x14,
      0xcc, 0x74, 0xfa, 0x26, 0x0,  0x1,  0xa8, 0x0,  0x1d, 0x76, 0xee, 0xb0, 0x15, 0xc,  0x17, 0x37, 0x1b, 0x55, 0x55,
      0xde, 0x79, 0x3f, 0xa3, 0x9f, 0xaf, 0xbd, 0x9f, 0xb,  0xba, 0x21, 0x2d, 0x3b, 0x66, 0x3c, 0x61, 0x99, 0xbf, 0xcd,
      0x8,  0x0,  0x1a, 0x30, 0x5a, 0xbd, 0x63, 0x79, 0x63, 0x84, 0xf7, 0x66, 0x38, 0xa9, 0x40, 0xc1, 0xb3, 0x45, 0xc6,
      0x16, 0x29, 0x30, 0x63, 0xdb, 0x9d, 0xaf, 0x70, 0x20, 0xb0, 0x21, 0x42, 0x59, 0x28, 0x91, 0x19, 0x31, 0x8,  0x0,
      0x1,  0x22, 0x16, 0x0,  0x16, 0xf,  0x47, 0xb4, 0x27, 0xcf, 0xe3, 0xf1, 0xf7, 0x7d, 0x70, 0xd7, 0x71, 0x94, 0xa5,
      0x81, 0x60, 0xeb, 0x99, 0x75, 0xb9, 0xee, 0xfe, 0x2,  0x0,  0x0,  0x3b, 0xf2, 0x26, 0x0,  0x7,  0xec, 0x19, 0xa6,
      0x55, 0xf,  0xcc, 0xe2, 0x0,  0xd,  0xe1, 0x82, 0x62, 0xfe, 0x81, 0x5a, 0xb3, 0x38, 0x37, 0x9d, 0x30, 0xc3, 0x35,
      0x1c, 0x0,  0x7,  0xae, 0x81, 0xa9, 0x84, 0x3,  0xdd, 0x35, 0x0,  0x1,  0xaa, 0x0,  0x1b, 0x40, 0x64, 0x9d, 0x62,
      0x16, 0x96, 0x30, 0xa4, 0x5,  0xec, 0x4f, 0x95, 0x65, 0x81, 0xda, 0xd2, 0x77, 0x53, 0x4b, 0x55, 0x14, 0x79, 0x1,
      0xbc, 0xa3, 0x6d, 0x4,  0x0,  0x10, 0x5e, 0x61, 0x2c, 0x59, 0x1f, 0xe6, 0x2f, 0xca, 0xf0, 0x9,  0xe5, 0xda, 0xbf,
      0x1a, 0x64, 0x6c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26124}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7452}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x76, 0xa, 0xa8, 0x2f, 0x74, 0xa9};
  uint8_t byteswillprops1[] = {0x6e, 0xc4, 0x7a, 0xac, 0x2d, 0xd6, 0x8d, 0xad,
                               0xa8, 0x24, 0x4d, 0x78, 0x14, 0xb8, 0x38};
  uint8_t byteswillprops2[] = {0x52, 0xc9, 0x61, 0x48, 0xa6, 0x2a, 0x42, 0xba, 0xa3, 0x2f, 0x91, 0xeb, 0xae, 0x1f, 0x3e,
                               0x53, 0x14, 0x2d, 0xbf, 0x89, 0xd1, 0x37, 0x5e, 0xd4, 0x79, 0x11, 0x54, 0x6f, 0x18};
  uint8_t byteswillprops3[] = {0x19, 0xf8};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops5[] = {0xc1, 0xc1, 0xea, 0x5f, 0xdf, 0x47, 0x40, 0xe8, 0x5e, 0x88,
                               0xda, 0xe9, 0x59, 0x31, 0x27, 0x14, 0xcc, 0x74, 0xfa};
  uint8_t byteswillprops7[] = {0x76, 0xee, 0xb0, 0x15, 0xc,  0x17, 0x37, 0x1b, 0x55, 0x55, 0xde, 0x79, 0x3f, 0xa3, 0x9f,
                               0xaf, 0xbd, 0x9f, 0xb,  0xba, 0x21, 0x2d, 0x3b, 0x66, 0x3c, 0x61, 0x99, 0xbf, 0xcd};
  uint8_t byteswillprops6[] = {0xa8};
  uint8_t byteswillprops8[] = {0x30, 0x5a, 0xbd, 0x63, 0x79, 0x63, 0x84, 0xf7, 0x66, 0x38, 0xa9, 0x40, 0xc1,
                               0xb3, 0x45, 0xc6, 0x16, 0x29, 0x30, 0x63, 0xdb, 0x9d, 0xaf, 0x70, 0x20, 0xb0};
  uint8_t byteswillprops9[] = {0x22};
  uint8_t byteswillprops10[] = {0xf,  0x47, 0xb4, 0x27, 0xcf, 0xe3, 0xf1, 0xf7, 0x7d, 0x70, 0xd7,
                                0x71, 0x94, 0xa5, 0x81, 0x60, 0xeb, 0x99, 0x75, 0xb9, 0xee, 0xfe};
  uint8_t byteswillprops12[] = {0xe1, 0x82, 0x62, 0xfe, 0x81, 0x5a, 0xb3, 0x38, 0x37, 0x9d, 0x30, 0xc3, 0x35};
  uint8_t byteswillprops11[] = {0xec, 0x19, 0xa6, 0x55, 0xf, 0xcc, 0xe2};
  uint8_t byteswillprops13[] = {0xae, 0x81, 0xa9, 0x84, 0x3, 0xdd, 0x35};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21322}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9552}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24731}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29502}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3252}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21121}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {1, (char*)&byteswillprops6}, .v = {29, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16985}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15346}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops11}, .v = {13, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops13}}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xaa};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x64, 0x9d, 0x62, 0x16, 0x96, 0x30, 0xa4, 0x5, 0xec, 0x4f, 0x95, 0x65, 0x81,
                                  0xda, 0xd2, 0x77, 0x53, 0x4b, 0x55, 0x14, 0x79, 0x1, 0xbc, 0xa3, 0x6d, 0x4};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10569;
  uint8_t client_id_bytes[] = {0xb9, 0x58, 0x67, 0x24, 0x5a, 0x48, 0x98, 0x84, 0x20, 0x21};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5e, 0x61, 0x2c, 0x59, 0x1f, 0xe6, 0x2f, 0xca,
                              0xf0, 0x9,  0xe5, 0xda, 0xbf, 0x1a, 0x64, 0x6c};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\251\140\165-\247FkO\242Y\DC2\f\236\DC2\223pL\DC1+\246\255", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 692, _connID =
// "h\254\SUB\167\243\223\&6e\ACK\209\169\208{K\152\224:\222\217Se]1", _properties = [PropMessageExpiryInterval
// 5476,PropSharedSubscriptionAvailable 41,PropCorrelationData "",PropReasonString
// "\221.\168\177\166UJoL\185\161",PropResponseInformation
// "\211\ACKA%\200\207\135\&9\b\140\SIH\b\254\&1\241X",PropCorrelationData
// "\229\SYN\150\140h\165h7\183\189\228\197\182\n\\1",PropSessionExpiryInterval 16965,PropReceiveMaximum
// 24656,PropServerReference
// "w\232l3\192t\223m\157\164\214YCo\ACK\142\CAN9\248\160\164\196\220\150\DC1",PropMaximumPacketSize
// 21188,PropServerKeepAlive 10134,PropContentType
// "3-G1\DC4jy\227\152B\217\241+\147\133\155\221D\160\be,\t\182h\180\\u\232\STX",PropTopicAlias
// 32612,PropWildcardSubscriptionAvailable 255]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xcd, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x2,  0xb4, 0x91, 0x1,  0x2,  0x0,  0x0,  0x15,
      0x64, 0x2a, 0x29, 0x9,  0x0,  0x0,  0x1f, 0x0,  0xb,  0xdd, 0x2e, 0xa8, 0xb1, 0xa6, 0x55, 0x4a, 0x6f, 0x4c, 0xb9,
      0xa1, 0x1a, 0x0,  0x11, 0xd3, 0x6,  0x41, 0x25, 0xc8, 0xcf, 0x87, 0x39, 0x8,  0x8c, 0xf,  0x48, 0x8,  0xfe, 0x31,
      0xf1, 0x58, 0x9,  0x0,  0x10, 0xe5, 0x16, 0x96, 0x8c, 0x68, 0xa5, 0x68, 0x37, 0xb7, 0xbd, 0xe4, 0xc5, 0xb6, 0xa,
      0x5c, 0x31, 0x11, 0x0,  0x0,  0x42, 0x45, 0x21, 0x60, 0x50, 0x1c, 0x0,  0x19, 0x77, 0xe8, 0x6c, 0x33, 0xc0, 0x74,
      0xdf, 0x6d, 0x9d, 0xa4, 0xd6, 0x59, 0x43, 0x6f, 0x6,  0x8e, 0x18, 0x39, 0xf8, 0xa0, 0xa4, 0xc4, 0xdc, 0x96, 0x11,
      0x27, 0x0,  0x0,  0x52, 0xc4, 0x13, 0x27, 0x96, 0x3,  0x0,  0x1e, 0x33, 0x2d, 0x47, 0x31, 0x14, 0x6a, 0x79, 0xe3,
      0x98, 0x42, 0xd9, 0xf1, 0x2b, 0x93, 0x85, 0x9b, 0xdd, 0x44, 0xa0, 0x8,  0x65, 0x2c, 0x9,  0xb6, 0x68, 0xb4, 0x5c,
      0x75, 0xe8, 0x2,  0x23, 0x7f, 0x64, 0x28, 0xff, 0x0,  0x17, 0x68, 0xfe, 0x1a, 0xa7, 0xf3, 0xdf, 0x36, 0x65, 0x6,
      0xd1, 0xa9, 0xd0, 0x7b, 0x4b, 0x98, 0xe0, 0x3a, 0xde, 0xd9, 0x53, 0x65, 0x5d, 0x31, 0x0,  0x15, 0xfb, 0x8c, 0xa5,
      0x2d, 0xf7, 0x46, 0x6b, 0x4f, 0xf2, 0x59, 0x12, 0xc,  0xec, 0x12, 0xdf, 0x70, 0x4c, 0x11, 0x2b, 0xf6, 0xff};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xdd, 0x2e, 0xa8, 0xb1, 0xa6, 0x55, 0x4a, 0x6f, 0x4c, 0xb9, 0xa1};
  uint8_t bytesprops2[] = {0xd3, 0x6, 0x41, 0x25, 0xc8, 0xcf, 0x87, 0x39, 0x8,
                           0x8c, 0xf, 0x48, 0x8,  0xfe, 0x31, 0xf1, 0x58};
  uint8_t bytesprops3[] = {0xe5, 0x16, 0x96, 0x8c, 0x68, 0xa5, 0x68, 0x37,
                           0xb7, 0xbd, 0xe4, 0xc5, 0xb6, 0xa,  0x5c, 0x31};
  uint8_t bytesprops4[] = {0x77, 0xe8, 0x6c, 0x33, 0xc0, 0x74, 0xdf, 0x6d, 0x9d, 0xa4, 0xd6, 0x59, 0x43,
                           0x6f, 0x6,  0x8e, 0x18, 0x39, 0xf8, 0xa0, 0xa4, 0xc4, 0xdc, 0x96, 0x11};
  uint8_t bytesprops5[] = {0x33, 0x2d, 0x47, 0x31, 0x14, 0x6a, 0x79, 0xe3, 0x98, 0x42, 0xd9, 0xf1, 0x2b, 0x93, 0x85,
                           0x9b, 0xdd, 0x44, 0xa0, 0x8,  0x65, 0x2c, 0x9,  0xb6, 0x68, 0xb4, 0x5c, 0x75, 0xe8, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5476}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16965}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24656}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21188}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10134}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32612}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 692;
  uint8_t client_id_bytes[] = {0x68, 0xfe, 0x1a, 0xa7, 0xf3, 0xdf, 0x36, 0x65, 0x6,  0xd1, 0xa9, 0xd0,
                               0x7b, 0x4b, 0x98, 0xe0, 0x3a, 0xde, 0xd9, 0x53, 0x65, 0x5d, 0x31};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfb, 0x8c, 0xa5, 0x2d, 0xf7, 0x46, 0x6b, 0x4f, 0xf2, 0x59, 0x12,
                              0xc,  0xec, 0x12, 0xdf, 0x70, 0x4c, 0x11, 0x2b, 0xf6, 0xff};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "NZ\205t\136\"\192\172", _password = Just ";", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic =
// "I\178\221P\DC2\179\161\234\145\EOT-\160eY\DEL'\191\250\&5|\172\EOT\240", _willMsg =
// "D]Y\226\&7\ESC\249\US8w\142\212z\211\143@\168d\NUL\149\STX\220e2", _willProps = [PropRequestProblemInformation
// 90,PropPayloadFormatIndicator 131,PropUserProperty "Y\179\197\215\NUL\163S\184.\133\156\178,\199$h\ENQ\224Bcf"
// "\163\\\EOTa@e\132|\DC1v\213\242\242\STX",PropAssignedClientIdentifier
// "C\139\217\192\210\207G\ACK@\SUB\175\&1#\ENQ}\165\142\172@\158\160E7",PropSharedSubscriptionAvailable
// 18,PropSessionExpiryInterval 21858,PropSubscriptionIdentifierAvailable 121,PropMessageExpiryInterval
// 15390,PropResponseTopic
// "\202pM4\158\192qc\DEL\181H.\180K-\217\128\206\&6\DC4\SOH~\240\216[\r#\130",PropSessionExpiryInterval
// 15558,PropServerReference
// "\CAN\187nA\DC2\219\NULm\163\&7\SOH|\188\161\179L\"\139nC-*2\196\157\137\128",PropWildcardSubscriptionAvailable
// 68,PropServerKeepAlive 8038,PropSubscriptionIdentifier 14,PropWillDelayInterval 20829,PropMessageExpiryInterval
// 12205,PropSubscriptionIdentifier 15,PropResponseInformation
// "<p\193\237\148\177\168\173\237\134\242\180X\241-\146\b\181\205\&8\EMu\t{4\173q\tc",PropRequestProblemInformation
// 74,PropResponseInformation "z\SYN",PropAuthenticationData "\183\156E]\f\STX9$m\225n\\K"]}), _cleanSession = False,
// _keepAlive = 2830, _connID = "\244\148g", _properties = [PropTopicAliasMaximum 23955,PropUserProperty
// "Sf\189\139#\226\NUL\205G\ETX\217;x\142\128\224\STX\175\219\182j4" "\148Z\231n
// \185",PropWildcardSubscriptionAvailable 47,PropServerKeepAlive 16742,PropContentType
// "\194\140\165\162\224+Z<\r\188\129\248/\177\SI.\163\157",PropReasonString
// "\171\170\208j\ESC\142\205\155y\US\DLE\208\183\211\&1\160H6P\177=n",PropRetainAvailable
// 65,PropRequestProblemInformation 127,PropSessionExpiryInterval 18958,PropMessageExpiryInterval 23941]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0x97, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0xb,  0xe,  0x65, 0x22, 0x5d, 0x93, 0x26, 0x0,
      0x16, 0x53, 0x66, 0xbd, 0x8b, 0x23, 0xe2, 0x0,  0xcd, 0x47, 0x3,  0xd9, 0x3b, 0x78, 0x8e, 0x80, 0xe0, 0x2,  0xaf,
      0xdb, 0xb6, 0x6a, 0x34, 0x0,  0x6,  0x94, 0x5a, 0xe7, 0x6e, 0x20, 0xb9, 0x28, 0x2f, 0x13, 0x41, 0x66, 0x3,  0x0,
      0x12, 0xc2, 0x8c, 0xa5, 0xa2, 0xe0, 0x2b, 0x5a, 0x3c, 0xd,  0xbc, 0x81, 0xf8, 0x2f, 0xb1, 0xf,  0x2e, 0xa3, 0x9d,
      0x1f, 0x0,  0x16, 0xab, 0xaa, 0xd0, 0x6a, 0x1b, 0x8e, 0xcd, 0x9b, 0x79, 0x1f, 0x10, 0xd0, 0xb7, 0xd3, 0x31, 0xa0,
      0x48, 0x36, 0x50, 0xb1, 0x3d, 0x6e, 0x25, 0x41, 0x17, 0x7f, 0x11, 0x0,  0x0,  0x4a, 0xe,  0x2,  0x0,  0x0,  0x5d,
      0x85, 0x0,  0x3,  0xf4, 0x94, 0x67, 0xe0, 0x1,  0x17, 0x5a, 0x1,  0x83, 0x26, 0x0,  0x15, 0x59, 0xb3, 0xc5, 0xd7,
      0x0,  0xa3, 0x53, 0xb8, 0x2e, 0x85, 0x9c, 0xb2, 0x2c, 0xc7, 0x24, 0x68, 0x5,  0xe0, 0x42, 0x63, 0x66, 0x0,  0xe,
      0xa3, 0x5c, 0x4,  0x61, 0x40, 0x65, 0x84, 0x7c, 0x11, 0x76, 0xd5, 0xf2, 0xf2, 0x2,  0x12, 0x0,  0x17, 0x43, 0x8b,
      0xd9, 0xc0, 0xd2, 0xcf, 0x47, 0x6,  0x40, 0x1a, 0xaf, 0x31, 0x23, 0x5,  0x7d, 0xa5, 0x8e, 0xac, 0x40, 0x9e, 0xa0,
      0x45, 0x37, 0x2a, 0x12, 0x11, 0x0,  0x0,  0x55, 0x62, 0x29, 0x79, 0x2,  0x0,  0x0,  0x3c, 0x1e, 0x8,  0x0,  0x1c,
      0xca, 0x70, 0x4d, 0x34, 0x9e, 0xc0, 0x71, 0x63, 0x7f, 0xb5, 0x48, 0x2e, 0xb4, 0x4b, 0x2d, 0xd9, 0x80, 0xce, 0x36,
      0x14, 0x1,  0x7e, 0xf0, 0xd8, 0x5b, 0xd,  0x23, 0x82, 0x11, 0x0,  0x0,  0x3c, 0xc6, 0x1c, 0x0,  0x1b, 0x18, 0xbb,
      0x6e, 0x41, 0x12, 0xdb, 0x0,  0x6d, 0xa3, 0x37, 0x1,  0x7c, 0xbc, 0xa1, 0xb3, 0x4c, 0x22, 0x8b, 0x6e, 0x43, 0x2d,
      0x2a, 0x32, 0xc4, 0x9d, 0x89, 0x80, 0x28, 0x44, 0x13, 0x1f, 0x66, 0xb,  0xe,  0x18, 0x0,  0x0,  0x51, 0x5d, 0x2,
      0x0,  0x0,  0x2f, 0xad, 0xb,  0xf,  0x1a, 0x0,  0x1d, 0x3c, 0x70, 0xc1, 0xed, 0x94, 0xb1, 0xa8, 0xad, 0xed, 0x86,
      0xf2, 0xb4, 0x58, 0xf1, 0x2d, 0x92, 0x8,  0xb5, 0xcd, 0x38, 0x19, 0x75, 0x9,  0x7b, 0x34, 0xad, 0x71, 0x9,  0x63,
      0x17, 0x4a, 0x1a, 0x0,  0x2,  0x7a, 0x16, 0x16, 0x0,  0xd,  0xb7, 0x9c, 0x45, 0x5d, 0xc,  0x2,  0x39, 0x24, 0x6d,
      0xe1, 0x6e, 0x5c, 0x4b, 0x0,  0x17, 0x49, 0xb2, 0xdd, 0x50, 0x12, 0xb3, 0xa1, 0xea, 0x91, 0x4,  0x2d, 0xa0, 0x65,
      0x59, 0x7f, 0x27, 0xbf, 0xfa, 0x35, 0x7c, 0xac, 0x4,  0xf0, 0x0,  0x18, 0x44, 0x5d, 0x59, 0xe2, 0x37, 0x1b, 0xf9,
      0x1f, 0x38, 0x77, 0x8e, 0xd4, 0x7a, 0xd3, 0x8f, 0x40, 0xa8, 0x64, 0x0,  0x95, 0x2,  0xdc, 0x65, 0x32, 0x0,  0x8,
      0x4e, 0x5a, 0xcd, 0x74, 0x88, 0x22, 0xc0, 0xac, 0x0,  0x1,  0x3b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x94, 0x5a, 0xe7, 0x6e, 0x20, 0xb9};
  uint8_t bytesprops0[] = {0x53, 0x66, 0xbd, 0x8b, 0x23, 0xe2, 0x0,  0xcd, 0x47, 0x3,  0xd9,
                           0x3b, 0x78, 0x8e, 0x80, 0xe0, 0x2,  0xaf, 0xdb, 0xb6, 0x6a, 0x34};
  uint8_t bytesprops2[] = {0xc2, 0x8c, 0xa5, 0xa2, 0xe0, 0x2b, 0x5a, 0x3c, 0xd,
                           0xbc, 0x81, 0xf8, 0x2f, 0xb1, 0xf,  0x2e, 0xa3, 0x9d};
  uint8_t bytesprops3[] = {0xab, 0xaa, 0xd0, 0x6a, 0x1b, 0x8e, 0xcd, 0x9b, 0x79, 0x1f, 0x10,
                           0xd0, 0xb7, 0xd3, 0x31, 0xa0, 0x48, 0x36, 0x50, 0xb1, 0x3d, 0x6e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23955}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops0}, .v = {6, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16742}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18958}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23941}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xa3, 0x5c, 0x4, 0x61, 0x40, 0x65, 0x84, 0x7c, 0x11, 0x76, 0xd5, 0xf2, 0xf2, 0x2};
  uint8_t byteswillprops0[] = {0x59, 0xb3, 0xc5, 0xd7, 0x0,  0xa3, 0x53, 0xb8, 0x2e, 0x85, 0x9c,
                               0xb2, 0x2c, 0xc7, 0x24, 0x68, 0x5,  0xe0, 0x42, 0x63, 0x66};
  uint8_t byteswillprops2[] = {0x43, 0x8b, 0xd9, 0xc0, 0xd2, 0xcf, 0x47, 0x6,  0x40, 0x1a, 0xaf, 0x31,
                               0x23, 0x5,  0x7d, 0xa5, 0x8e, 0xac, 0x40, 0x9e, 0xa0, 0x45, 0x37};
  uint8_t byteswillprops3[] = {0xca, 0x70, 0x4d, 0x34, 0x9e, 0xc0, 0x71, 0x63, 0x7f, 0xb5, 0x48, 0x2e, 0xb4, 0x4b,
                               0x2d, 0xd9, 0x80, 0xce, 0x36, 0x14, 0x1,  0x7e, 0xf0, 0xd8, 0x5b, 0xd,  0x23, 0x82};
  uint8_t byteswillprops4[] = {0x18, 0xbb, 0x6e, 0x41, 0x12, 0xdb, 0x0,  0x6d, 0xa3, 0x37, 0x1,  0x7c, 0xbc, 0xa1,
                               0xb3, 0x4c, 0x22, 0x8b, 0x6e, 0x43, 0x2d, 0x2a, 0x32, 0xc4, 0x9d, 0x89, 0x80};
  uint8_t byteswillprops5[] = {0x3c, 0x70, 0xc1, 0xed, 0x94, 0xb1, 0xa8, 0xad, 0xed, 0x86, 0xf2, 0xb4, 0x58, 0xf1, 0x2d,
                               0x92, 0x8,  0xb5, 0xcd, 0x38, 0x19, 0x75, 0x9,  0x7b, 0x34, 0xad, 0x71, 0x9,  0x63};
  uint8_t byteswillprops6[] = {0x7a, 0x16};
  uint8_t byteswillprops7[] = {0xb7, 0x9c, 0x45, 0x5d, 0xc, 0x2, 0x39, 0x24, 0x6d, 0xe1, 0x6e, 0x5c, 0x4b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops0}, .v = {14, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21858}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15390}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15558}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8038}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20829}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12205}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x49, 0xb2, 0xdd, 0x50, 0x12, 0xb3, 0xa1, 0xea, 0x91, 0x4, 0x2d, 0xa0,
                                0x65, 0x59, 0x7f, 0x27, 0xbf, 0xfa, 0x35, 0x7c, 0xac, 0x4, 0xf0};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0x5d, 0x59, 0xe2, 0x37, 0x1b, 0xf9, 0x1f, 0x38, 0x77, 0x8e, 0xd4,
                                  0x7a, 0xd3, 0x8f, 0x40, 0xa8, 0x64, 0x0,  0x95, 0x2,  0xdc, 0x65, 0x32};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2830;
  uint8_t client_id_bytes[] = {0xf4, 0x94, 0x67};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4e, 0x5a, 0xcd, 0x74, 0x88, 0x22, 0xc0, 0xac};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3b};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218\&6%\STX(5i0\189a\150\ENQ\229YH,0&^\167\f\254\209k", _password = Just
// "\202)\161\202\205\170z\SI\230\241\175\142\208\213\245\142]dM\EM\231\155\244", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\139\152\193\DC2\171\179\224m\168J\129\237\153t\SOH\ENQ\244G\203\EOT\US}\221\162", _willMsg =
// "\DLE\135\NAK^\193va\DC4\252\141-\RS", _willProps = [PropTopicAliasMaximum 24138,PropRequestProblemInformation
// 206,PropAssignedClientIdentifier "\134E\ENQ\230\130r\143\179Q\214\243\US9\235\250e\SI:6\153",PropTopicAliasMaximum
// 18146,PropSessionExpiryInterval 9339,PropSessionExpiryInterval 19391,PropContentType
// ",?a\152\US\141#\253[b\242\176",PropSubscriptionIdentifierAvailable 206,PropWillDelayInterval
// 15014,PropRequestResponseInformation 1,PropResponseInformation "\129\250@",PropRequestResponseInformation
// 153,PropSessionExpiryInterval 14314,PropResponseTopic "&",PropServerKeepAlive 1849,PropSessionExpiryInterval
// 23464,PropServerReference
// "^\192<\250\SYN$\155\SOHv\193\137\197\243\214\134\170\229V\GS\155S\ENQ@\204:@9\234F\228",PropAuthenticationData
// "\149#\133\128\&8\244/\ENQw\ESC\DC2",PropCorrelationData
// "\209\\\166.\238\187z\180\170\178",PropSharedSubscriptionAvailable 88,PropAuthenticationMethod
// "\178\STX\146\236\141\210<\235\171\249\ETB\DC3\170\ETX\149\255\213&\DLE@6\177\166\173\163\174",PropWildcardSubscriptionAvailable
// 74,PropRequestProblemInformation 212,PropMessageExpiryInterval 11103,PropMaximumPacketSize
// 29514,PropSessionExpiryInterval 25814,PropReceiveMaximum 25484,PropAssignedClientIdentifier
// "\b\165\&7\135Q\138\231\DC1\\/<\177o\GS\130",PropAuthenticationData "\178z\ETB\157\&4\165"]}), _cleanSession = True,
// _keepAlive = 11916, _connID = "z\209/\DEL\213B\229\RS\240B\238", _properties = [PropWildcardSubscriptionAvailable
// 204,PropSessionExpiryInterval 5011,PropWillDelayInterval 22555,PropResponseInformation
// "\204\221\ETX\227\199\137\140E\238\229\b\200I\EM\183^\DC4=\179\176M.",PropTopicAliasMaximum 17786,PropReceiveMaximum
// 29170,PropAuthenticationData "\190zC\231\153\254",PropMaximumPacketSize 17180,PropWildcardSubscriptionAvailable
// 59,PropRetainAvailable 78,PropResponseInformation "\v\251a\155\237",PropRequestProblemInformation 155]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0xa2, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x2e, 0x8c, 0x47, 0x28, 0xcc, 0x11, 0x0,  0x0,
      0x13, 0x93, 0x18, 0x0,  0x0,  0x58, 0x1b, 0x1a, 0x0,  0x16, 0xcc, 0xdd, 0x3,  0xe3, 0xc7, 0x89, 0x8c, 0x45, 0xee,
      0xe5, 0x8,  0xc8, 0x49, 0x19, 0xb7, 0x5e, 0x14, 0x3d, 0xb3, 0xb0, 0x4d, 0x2e, 0x22, 0x45, 0x7a, 0x21, 0x71, 0xf2,
      0x16, 0x0,  0x6,  0xbe, 0x7a, 0x43, 0xe7, 0x99, 0xfe, 0x27, 0x0,  0x0,  0x43, 0x1c, 0x28, 0x3b, 0x25, 0x4e, 0x1a,
      0x0,  0x5,  0xb,  0xfb, 0x61, 0x9b, 0xed, 0x17, 0x9b, 0x0,  0xb,  0x7a, 0xd1, 0x2f, 0x7f, 0xd5, 0x42, 0xe5, 0x1e,
      0xf0, 0x42, 0xee, 0xe6, 0x1,  0x22, 0x5e, 0x4a, 0x17, 0xce, 0x12, 0x0,  0x14, 0x86, 0x45, 0x5,  0xe6, 0x82, 0x72,
      0x8f, 0xb3, 0x51, 0xd6, 0xf3, 0x1f, 0x39, 0xeb, 0xfa, 0x65, 0xf,  0x3a, 0x36, 0x99, 0x22, 0x46, 0xe2, 0x11, 0x0,
      0x0,  0x24, 0x7b, 0x11, 0x0,  0x0,  0x4b, 0xbf, 0x3,  0x0,  0xc,  0x2c, 0x3f, 0x61, 0x98, 0x1f, 0x8d, 0x23, 0xfd,
      0x5b, 0x62, 0xf2, 0xb0, 0x29, 0xce, 0x18, 0x0,  0x0,  0x3a, 0xa6, 0x19, 0x1,  0x1a, 0x0,  0x3,  0x81, 0xfa, 0x40,
      0x19, 0x99, 0x11, 0x0,  0x0,  0x37, 0xea, 0x8,  0x0,  0x1,  0x26, 0x13, 0x7,  0x39, 0x11, 0x0,  0x0,  0x5b, 0xa8,
      0x1c, 0x0,  0x1e, 0x5e, 0xc0, 0x3c, 0xfa, 0x16, 0x24, 0x9b, 0x1,  0x76, 0xc1, 0x89, 0xc5, 0xf3, 0xd6, 0x86, 0xaa,
      0xe5, 0x56, 0x1d, 0x9b, 0x53, 0x5,  0x40, 0xcc, 0x3a, 0x40, 0x39, 0xea, 0x46, 0xe4, 0x16, 0x0,  0xb,  0x95, 0x23,
      0x85, 0x80, 0x38, 0xf4, 0x2f, 0x5,  0x77, 0x1b, 0x12, 0x9,  0x0,  0xa,  0xd1, 0x5c, 0xa6, 0x2e, 0xee, 0xbb, 0x7a,
      0xb4, 0xaa, 0xb2, 0x2a, 0x58, 0x15, 0x0,  0x1a, 0xb2, 0x2,  0x92, 0xec, 0x8d, 0xd2, 0x3c, 0xeb, 0xab, 0xf9, 0x17,
      0x13, 0xaa, 0x3,  0x95, 0xff, 0xd5, 0x26, 0x10, 0x40, 0x36, 0xb1, 0xa6, 0xad, 0xa3, 0xae, 0x28, 0x4a, 0x17, 0xd4,
      0x2,  0x0,  0x0,  0x2b, 0x5f, 0x27, 0x0,  0x0,  0x73, 0x4a, 0x11, 0x0,  0x0,  0x64, 0xd6, 0x21, 0x63, 0x8c, 0x12,
      0x0,  0xf,  0x8,  0xa5, 0x37, 0x87, 0x51, 0x8a, 0xe7, 0x11, 0x5c, 0x2f, 0x3c, 0xb1, 0x6f, 0x1d, 0x82, 0x16, 0x0,
      0x6,  0xb2, 0x7a, 0x17, 0x9d, 0x34, 0xa5, 0x0,  0x18, 0x8b, 0x98, 0xc1, 0x12, 0xab, 0xb3, 0xe0, 0x6d, 0xa8, 0x4a,
      0x81, 0xed, 0x99, 0x74, 0x1,  0x5,  0xf4, 0x47, 0xcb, 0x4,  0x1f, 0x7d, 0xdd, 0xa2, 0x0,  0xc,  0x10, 0x87, 0x15,
      0x5e, 0xc1, 0x76, 0x61, 0x14, 0xfc, 0x8d, 0x2d, 0x1e, 0x0,  0x18, 0xda, 0x36, 0x25, 0x2,  0x28, 0x35, 0x69, 0x30,
      0xbd, 0x61, 0x96, 0x5,  0xe5, 0x59, 0x48, 0x2c, 0x30, 0x26, 0x5e, 0xa7, 0xc,  0xfe, 0xd1, 0x6b, 0x0,  0x17, 0xca,
      0x29, 0xa1, 0xca, 0xcd, 0xaa, 0x7a, 0xf,  0xe6, 0xf1, 0xaf, 0x8e, 0xd0, 0xd5, 0xf5, 0x8e, 0x5d, 0x64, 0x4d, 0x19,
      0xe7, 0x9b, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xcc, 0xdd, 0x3,  0xe3, 0xc7, 0x89, 0x8c, 0x45, 0xee, 0xe5, 0x8,
                           0xc8, 0x49, 0x19, 0xb7, 0x5e, 0x14, 0x3d, 0xb3, 0xb0, 0x4d, 0x2e};
  uint8_t bytesprops1[] = {0xbe, 0x7a, 0x43, 0xe7, 0x99, 0xfe};
  uint8_t bytesprops2[] = {0xb, 0xfb, 0x61, 0x9b, 0xed};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5011}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22555}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17786}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29170}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17180}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 155}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x86, 0x45, 0x5,  0xe6, 0x82, 0x72, 0x8f, 0xb3, 0x51, 0xd6,
                               0xf3, 0x1f, 0x39, 0xeb, 0xfa, 0x65, 0xf,  0x3a, 0x36, 0x99};
  uint8_t byteswillprops1[] = {0x2c, 0x3f, 0x61, 0x98, 0x1f, 0x8d, 0x23, 0xfd, 0x5b, 0x62, 0xf2, 0xb0};
  uint8_t byteswillprops2[] = {0x81, 0xfa, 0x40};
  uint8_t byteswillprops3[] = {0x26};
  uint8_t byteswillprops4[] = {0x5e, 0xc0, 0x3c, 0xfa, 0x16, 0x24, 0x9b, 0x1,  0x76, 0xc1,
                               0x89, 0xc5, 0xf3, 0xd6, 0x86, 0xaa, 0xe5, 0x56, 0x1d, 0x9b,
                               0x53, 0x5,  0x40, 0xcc, 0x3a, 0x40, 0x39, 0xea, 0x46, 0xe4};
  uint8_t byteswillprops5[] = {0x95, 0x23, 0x85, 0x80, 0x38, 0xf4, 0x2f, 0x5, 0x77, 0x1b, 0x12};
  uint8_t byteswillprops6[] = {0xd1, 0x5c, 0xa6, 0x2e, 0xee, 0xbb, 0x7a, 0xb4, 0xaa, 0xb2};
  uint8_t byteswillprops7[] = {0xb2, 0x2,  0x92, 0xec, 0x8d, 0xd2, 0x3c, 0xeb, 0xab, 0xf9, 0x17, 0x13, 0xaa,
                               0x3,  0x95, 0xff, 0xd5, 0x26, 0x10, 0x40, 0x36, 0xb1, 0xa6, 0xad, 0xa3, 0xae};
  uint8_t byteswillprops8[] = {0x8, 0xa5, 0x37, 0x87, 0x51, 0x8a, 0xe7, 0x11, 0x5c, 0x2f, 0x3c, 0xb1, 0x6f, 0x1d, 0x82};
  uint8_t byteswillprops9[] = {0xb2, 0x7a, 0x17, 0x9d, 0x34, 0xa5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24138}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18146}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9339}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19391}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15014}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14314}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1849}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23464}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11103}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29514}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25814}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25484}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8b, 0x98, 0xc1, 0x12, 0xab, 0xb3, 0xe0, 0x6d, 0xa8, 0x4a, 0x81, 0xed,
                                0x99, 0x74, 0x1,  0x5,  0xf4, 0x47, 0xcb, 0x4,  0x1f, 0x7d, 0xdd, 0xa2};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x10, 0x87, 0x15, 0x5e, 0xc1, 0x76, 0x61, 0x14, 0xfc, 0x8d, 0x2d, 0x1e};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11916;
  uint8_t client_id_bytes[] = {0x7a, 0xd1, 0x2f, 0x7f, 0xd5, 0x42, 0xe5, 0x1e, 0xf0, 0x42, 0xee};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda, 0x36, 0x25, 0x2,  0x28, 0x35, 0x69, 0x30, 0xbd, 0x61, 0x96, 0x5,
                              0xe5, 0x59, 0x48, 0x2c, 0x30, 0x26, 0x5e, 0xa7, 0xc,  0xfe, 0xd1, 0x6b};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xca, 0x29, 0xa1, 0xca, 0xcd, 0xaa, 0x7a, 0xf,  0xe6, 0xf1, 0xaf, 0x8e,
                              0xd0, 0xd5, 0xf5, 0x8e, 0x5d, 0x64, 0x4d, 0x19, 0xe7, 0x9b, 0xf4};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\143y\166C\221w?;4\243\179\248z\136\a\221\DC3\228\DC1\156,\131\183sM\171&y", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic = "\226", _willMsg = "\240\178+p\166\192", _willProps =
// [PropAuthenticationMethod "\SUB\161\133Q7\DEL\226G\183\168\163\195\134\201\239iO",PropTopicAliasMaximum
// 27269,PropSubscriptionIdentifier 12,PropReasonString "\157",PropAssignedClientIdentifier
// "\242nkL\v\SI=G\170\238\222\&3\tf\233\221C(\151j",PropMessageExpiryInterval 31488,PropMaximumQoS
// 47,PropSessionExpiryInterval 15063,PropSubscriptionIdentifier 27,PropRequestResponseInformation
// 156,PropRequestResponseInformation 43,PropAssignedClientIdentifier "\147\241\222E\179\&25",PropReceiveMaximum
// 72,PropReceiveMaximum 30761,PropTopicAliasMaximum 24233,PropCorrelationData
// "\146\216y\197\134\196\173\211{\aUgEE\214\EM\147\182\229",PropSharedSubscriptionAvailable 207,PropServerReference
// "?\171\170\169\249\215\229W\157\&9\SOH\237\186|",PropSubscriptionIdentifierAvailable
// 42,PropSubscriptionIdentifierAvailable 28,PropMessageExpiryInterval 11243,PropRetainAvailable 136,PropUserProperty
// "\192\178\209\202\233\216<K\139\ETX8\NUL%\173"
// "[5\207\232\200\156mg\234\132\150.\182\212\242N\172j\t\167\&8p^\156\191d\226\r\NAK",PropServerKeepAlive
// 15404,PropRequestProblemInformation 182]}), _cleanSession = False, _keepAlive = 29711, _connID = "x2\200o\132\250",
// _properties = [PropTopicAliasMaximum 20098,PropSessionExpiryInterval 6071,PropUserProperty
// "\209I0\f\204\143\222\199\194\145\235\167\170\206\164\184"
// "\146/cJ\DLE\ETX\162\130\232\ETX\129\168\239\243\192U0y\171y\244\RS=\195[T\226\179\195\215",PropServerKeepAlive
// 10741,PropSessionExpiryInterval 20383,PropRequestResponseInformation 129,PropRetainAvailable 27,PropServerReference
// "8\210)x\254s\147\&02\142",PropMaximumPacketSize 6080,PropSubscriptionIdentifierAvailable 115,PropResponseInformation
// "\185\160\DLERJ\242",PropRequestProblemInformation 148,PropResponseInformation
// "TE\218\204\191\254\EMn\243o;\199\&4\rWyv\237",PropAuthenticationData "\202o\ENQ",PropTopicAlias
// 24233,PropAuthenticationMethod "\174",PropCorrelationData "\133\210\134\193}=\240a\212\130",PropMessageExpiryInterval
// 27712,PropResponseTopic "\a\199\190\138\218",PropRetainAvailable 226,PropContentType
// "\231\EOT\130\n",PropSessionExpiryInterval 26854,PropRequestResponseInformation 151,PropMessageExpiryInterval 851]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x10, 0xb8, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x74, 0xf,  0xb7, 0x1,  0x22, 0x4e, 0x82, 0x11,
      0x0,  0x0,  0x17, 0xb7, 0x26, 0x0,  0x10, 0xd1, 0x49, 0x30, 0xc,  0xcc, 0x8f, 0xde, 0xc7, 0xc2, 0x91, 0xeb, 0xa7,
      0xaa, 0xce, 0xa4, 0xb8, 0x0,  0x1e, 0x92, 0x2f, 0x63, 0x4a, 0x10, 0x3,  0xa2, 0x82, 0xe8, 0x3,  0x81, 0xa8, 0xef,
      0xf3, 0xc0, 0x55, 0x30, 0x79, 0xab, 0x79, 0xf4, 0x1e, 0x3d, 0xc3, 0x5b, 0x54, 0xe2, 0xb3, 0xc3, 0xd7, 0x13, 0x29,
      0xf5, 0x11, 0x0,  0x0,  0x4f, 0x9f, 0x19, 0x81, 0x25, 0x1b, 0x1c, 0x0,  0xa,  0x38, 0xd2, 0x29, 0x78, 0xfe, 0x73,
      0x93, 0x30, 0x32, 0x8e, 0x27, 0x0,  0x0,  0x17, 0xc0, 0x29, 0x73, 0x1a, 0x0,  0x6,  0xb9, 0xa0, 0x10, 0x52, 0x4a,
      0xf2, 0x17, 0x94, 0x1a, 0x0,  0x12, 0x54, 0x45, 0xda, 0xcc, 0xbf, 0xfe, 0x19, 0x6e, 0xf3, 0x6f, 0x3b, 0xc7, 0x34,
      0xd,  0x57, 0x79, 0x76, 0xed, 0x16, 0x0,  0x3,  0xca, 0x6f, 0x5,  0x23, 0x5e, 0xa9, 0x15, 0x0,  0x1,  0xae, 0x9,
      0x0,  0xa,  0x85, 0xd2, 0x86, 0xc1, 0x7d, 0x3d, 0xf0, 0x61, 0xd4, 0x82, 0x2,  0x0,  0x0,  0x6c, 0x40, 0x8,  0x0,
      0x5,  0x7,  0xc7, 0xbe, 0x8a, 0xda, 0x25, 0xe2, 0x3,  0x0,  0x4,  0xe7, 0x4,  0x82, 0xa,  0x11, 0x0,  0x0,  0x68,
      0xe6, 0x19, 0x97, 0x2,  0x0,  0x0,  0x3,  0x53, 0x0,  0x6,  0x78, 0x32, 0xc8, 0x6f, 0x84, 0xfa, 0xc2, 0x1,  0x15,
      0x0,  0x11, 0x1a, 0xa1, 0x85, 0x51, 0x37, 0x7f, 0xe2, 0x47, 0xb7, 0xa8, 0xa3, 0xc3, 0x86, 0xc9, 0xef, 0x69, 0x4f,
      0x22, 0x6a, 0x85, 0xb,  0xc,  0x1f, 0x0,  0x1,  0x9d, 0x12, 0x0,  0x14, 0xf2, 0x6e, 0x6b, 0x4c, 0xb,  0xf,  0x3d,
      0x47, 0xaa, 0xee, 0xde, 0x33, 0x9,  0x66, 0xe9, 0xdd, 0x43, 0x28, 0x97, 0x6a, 0x2,  0x0,  0x0,  0x7b, 0x0,  0x24,
      0x2f, 0x11, 0x0,  0x0,  0x3a, 0xd7, 0xb,  0x1b, 0x19, 0x9c, 0x19, 0x2b, 0x12, 0x0,  0x7,  0x93, 0xf1, 0xde, 0x45,
      0xb3, 0x32, 0x35, 0x21, 0x0,  0x48, 0x21, 0x78, 0x29, 0x22, 0x5e, 0xa9, 0x9,  0x0,  0x13, 0x92, 0xd8, 0x79, 0xc5,
      0x86, 0xc4, 0xad, 0xd3, 0x7b, 0x7,  0x55, 0x67, 0x45, 0x45, 0xd6, 0x19, 0x93, 0xb6, 0xe5, 0x2a, 0xcf, 0x1c, 0x0,
      0xe,  0x3f, 0xab, 0xaa, 0xa9, 0xf9, 0xd7, 0xe5, 0x57, 0x9d, 0x39, 0x1,  0xed, 0xba, 0x7c, 0x29, 0x2a, 0x29, 0x1c,
      0x2,  0x0,  0x0,  0x2b, 0xeb, 0x25, 0x88, 0x26, 0x0,  0xe,  0xc0, 0xb2, 0xd1, 0xca, 0xe9, 0xd8, 0x3c, 0x4b, 0x8b,
      0x3,  0x38, 0x0,  0x25, 0xad, 0x0,  0x1d, 0x5b, 0x35, 0xcf, 0xe8, 0xc8, 0x9c, 0x6d, 0x67, 0xea, 0x84, 0x96, 0x2e,
      0xb6, 0xd4, 0xf2, 0x4e, 0xac, 0x6a, 0x9,  0xa7, 0x38, 0x70, 0x5e, 0x9c, 0xbf, 0x64, 0xe2, 0xd,  0x15, 0x13, 0x3c,
      0x2c, 0x17, 0xb6, 0x0,  0x1,  0xe2, 0x0,  0x6,  0xf0, 0xb2, 0x2b, 0x70, 0xa6, 0xc0, 0x0,  0x1c, 0x8f, 0x79, 0xa6,
      0x43, 0xdd, 0x77, 0x3f, 0x3b, 0x34, 0xf3, 0xb3, 0xf8, 0x7a, 0x88, 0x7,  0xdd, 0x13, 0xe4, 0x11, 0x9c, 0x2c, 0x83,
      0xb7, 0x73, 0x4d, 0xab, 0x26, 0x79};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x92, 0x2f, 0x63, 0x4a, 0x10, 0x3,  0xa2, 0x82, 0xe8, 0x3,  0x81, 0xa8, 0xef, 0xf3, 0xc0,
                           0x55, 0x30, 0x79, 0xab, 0x79, 0xf4, 0x1e, 0x3d, 0xc3, 0x5b, 0x54, 0xe2, 0xb3, 0xc3, 0xd7};
  uint8_t bytesprops0[] = {0xd1, 0x49, 0x30, 0xc,  0xcc, 0x8f, 0xde, 0xc7,
                           0xc2, 0x91, 0xeb, 0xa7, 0xaa, 0xce, 0xa4, 0xb8};
  uint8_t bytesprops2[] = {0x38, 0xd2, 0x29, 0x78, 0xfe, 0x73, 0x93, 0x30, 0x32, 0x8e};
  uint8_t bytesprops3[] = {0xb9, 0xa0, 0x10, 0x52, 0x4a, 0xf2};
  uint8_t bytesprops4[] = {0x54, 0x45, 0xda, 0xcc, 0xbf, 0xfe, 0x19, 0x6e, 0xf3,
                           0x6f, 0x3b, 0xc7, 0x34, 0xd,  0x57, 0x79, 0x76, 0xed};
  uint8_t bytesprops5[] = {0xca, 0x6f, 0x5};
  uint8_t bytesprops6[] = {0xae};
  uint8_t bytesprops7[] = {0x85, 0xd2, 0x86, 0xc1, 0x7d, 0x3d, 0xf0, 0x61, 0xd4, 0x82};
  uint8_t bytesprops8[] = {0x7, 0xc7, 0xbe, 0x8a, 0xda};
  uint8_t bytesprops9[] = {0xe7, 0x4, 0x82, 0xa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20098}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6071}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops0}, .v = {30, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10741}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20383}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6080}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24233}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27712}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26854}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 851}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x1a, 0xa1, 0x85, 0x51, 0x37, 0x7f, 0xe2, 0x47, 0xb7,
                               0xa8, 0xa3, 0xc3, 0x86, 0xc9, 0xef, 0x69, 0x4f};
  uint8_t byteswillprops1[] = {0x9d};
  uint8_t byteswillprops2[] = {0xf2, 0x6e, 0x6b, 0x4c, 0xb,  0xf,  0x3d, 0x47, 0xaa, 0xee,
                               0xde, 0x33, 0x9,  0x66, 0xe9, 0xdd, 0x43, 0x28, 0x97, 0x6a};
  uint8_t byteswillprops3[] = {0x93, 0xf1, 0xde, 0x45, 0xb3, 0x32, 0x35};
  uint8_t byteswillprops4[] = {0x92, 0xd8, 0x79, 0xc5, 0x86, 0xc4, 0xad, 0xd3, 0x7b, 0x7,
                               0x55, 0x67, 0x45, 0x45, 0xd6, 0x19, 0x93, 0xb6, 0xe5};
  uint8_t byteswillprops5[] = {0x3f, 0xab, 0xaa, 0xa9, 0xf9, 0xd7, 0xe5, 0x57, 0x9d, 0x39, 0x1, 0xed, 0xba, 0x7c};
  uint8_t byteswillprops7[] = {0x5b, 0x35, 0xcf, 0xe8, 0xc8, 0x9c, 0x6d, 0x67, 0xea, 0x84, 0x96, 0x2e, 0xb6, 0xd4, 0xf2,
                               0x4e, 0xac, 0x6a, 0x9,  0xa7, 0x38, 0x70, 0x5e, 0x9c, 0xbf, 0x64, 0xe2, 0xd,  0x15};
  uint8_t byteswillprops6[] = {0xc0, 0xb2, 0xd1, 0xca, 0xe9, 0xd8, 0x3c, 0x4b, 0x8b, 0x3, 0x38, 0x0, 0x25, 0xad};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27269}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31488}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15063}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 72}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30761}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24233}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11243}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops6}, .v = {29, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15404}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 182}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0xb2, 0x2b, 0x70, 0xa6, 0xc0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29711;
  uint8_t client_id_bytes[] = {0x78, 0x32, 0xc8, 0x6f, 0x84, 0xfa};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x8f, 0x79, 0xa6, 0x43, 0xdd, 0x77, 0x3f, 0x3b, 0x34, 0xf3, 0xb3, 0xf8, 0x7a, 0x88,
                              0x7,  0xdd, 0x13, 0xe4, 0x11, 0x9c, 0x2c, 0x83, 0xb7, 0x73, 0x4d, 0xab, 0x26, 0x79};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\157\244\252!\no\225e", _password = Just
// "\203+\193\206\143\177\CAN\NUL\b\229\143p\249\aoT\130\140\199\197\139\130", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\188$&\229\204\146\186\244p\ACK\165dC\198G", _willMsg =
// ",n\136+E\195\136_K\222\148\132s\141{\231", _willProps = [PropCorrelationData
// "\EMI\134\SOc\159\SOH\243",PropSubscriptionIdentifier 15,PropReceiveMaximum 8553,PropAuthenticationData
// "\132]u\203\130\166\187\168t\240H\130|\r;3\222\159\129\231\215\181",PropResponseTopic
// "\253|\179&\159\255c",PropWillDelayInterval 17083,PropTopicAlias 3764,PropWildcardSubscriptionAvailable
// 106,PropMessageExpiryInterval 18550,PropResponseTopic
// "Md/\138TS<\159\233`\225f\202\197\DC1\SYNL\223\tbL\253\141f'^_*",PropServerKeepAlive 11002,PropResponseTopic
// "\207\218\236e\180*\NUL\241\169qc[a\f;\187&\131",PropPayloadFormatIndicator 209,PropPayloadFormatIndicator 65]}),
// _cleanSession = True, _keepAlive = 25534, _connID = "t\177\139,\191\139t\244\NAK\f\140!G\131k\141", _properties =
// [PropContentType "\253,\225\224\254?\255\224\211\SYNp\130\196\&3R",PropMessageExpiryInterval 18219]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0xf7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x63, 0xbe, 0x17, 0x3,  0x0,  0xf,
                   0xfd, 0x2c, 0xe1, 0xe0, 0xfe, 0x3f, 0xff, 0xe0, 0xd3, 0x16, 0x70, 0x82, 0xc4, 0x33, 0x52, 0x2,  0x0,
                   0x0,  0x47, 0x2b, 0x0,  0x10, 0x74, 0xb1, 0x8b, 0x2c, 0xbf, 0x8b, 0x74, 0xf4, 0x15, 0xc,  0x8c, 0x21,
                   0x47, 0x83, 0x6b, 0x8d, 0x7d, 0x9,  0x0,  0x8,  0x19, 0x49, 0x86, 0xe,  0x63, 0x9f, 0x1,  0xf3, 0xb,
                   0xf,  0x21, 0x21, 0x69, 0x16, 0x0,  0x16, 0x84, 0x5d, 0x75, 0xcb, 0x82, 0xa6, 0xbb, 0xa8, 0x74, 0xf0,
                   0x48, 0x82, 0x7c, 0xd,  0x3b, 0x33, 0xde, 0x9f, 0x81, 0xe7, 0xd7, 0xb5, 0x8,  0x0,  0x7,  0xfd, 0x7c,
                   0xb3, 0x26, 0x9f, 0xff, 0x63, 0x18, 0x0,  0x0,  0x42, 0xbb, 0x23, 0xe,  0xb4, 0x28, 0x6a, 0x2,  0x0,
                   0x0,  0x48, 0x76, 0x8,  0x0,  0x1c, 0x4d, 0x64, 0x2f, 0x8a, 0x54, 0x53, 0x3c, 0x9f, 0xe9, 0x60, 0xe1,
                   0x66, 0xca, 0xc5, 0x11, 0x16, 0x4c, 0xdf, 0x9,  0x62, 0x4c, 0xfd, 0x8d, 0x66, 0x27, 0x5e, 0x5f, 0x2a,
                   0x13, 0x2a, 0xfa, 0x8,  0x0,  0x12, 0xcf, 0xda, 0xec, 0x65, 0xb4, 0x2a, 0x0,  0xf1, 0xa9, 0x71, 0x63,
                   0x5b, 0x61, 0xc,  0x3b, 0xbb, 0x26, 0x83, 0x1,  0xd1, 0x1,  0x41, 0x0,  0xf,  0xbc, 0x24, 0x26, 0xe5,
                   0xcc, 0x92, 0xba, 0xf4, 0x70, 0x6,  0xa5, 0x64, 0x43, 0xc6, 0x47, 0x0,  0x10, 0x2c, 0x6e, 0x88, 0x2b,
                   0x45, 0xc3, 0x88, 0x5f, 0x4b, 0xde, 0x94, 0x84, 0x73, 0x8d, 0x7b, 0xe7, 0x0,  0x8,  0x9d, 0xf4, 0xfc,
                   0x21, 0xa,  0x6f, 0xe1, 0x65, 0x0,  0x16, 0xcb, 0x2b, 0xc1, 0xce, 0x8f, 0xb1, 0x18, 0x0,  0x8,  0xe5,
                   0x8f, 0x70, 0xf9, 0x7,  0x6f, 0x54, 0x82, 0x8c, 0xc7, 0xc5, 0x8b, 0x82};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xfd, 0x2c, 0xe1, 0xe0, 0xfe, 0x3f, 0xff, 0xe0, 0xd3, 0x16, 0x70, 0x82, 0xc4, 0x33, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18219}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x19, 0x49, 0x86, 0xe, 0x63, 0x9f, 0x1, 0xf3};
  uint8_t byteswillprops1[] = {0x84, 0x5d, 0x75, 0xcb, 0x82, 0xa6, 0xbb, 0xa8, 0x74, 0xf0, 0x48,
                               0x82, 0x7c, 0xd,  0x3b, 0x33, 0xde, 0x9f, 0x81, 0xe7, 0xd7, 0xb5};
  uint8_t byteswillprops2[] = {0xfd, 0x7c, 0xb3, 0x26, 0x9f, 0xff, 0x63};
  uint8_t byteswillprops3[] = {0x4d, 0x64, 0x2f, 0x8a, 0x54, 0x53, 0x3c, 0x9f, 0xe9, 0x60, 0xe1, 0x66, 0xca, 0xc5,
                               0x11, 0x16, 0x4c, 0xdf, 0x9,  0x62, 0x4c, 0xfd, 0x8d, 0x66, 0x27, 0x5e, 0x5f, 0x2a};
  uint8_t byteswillprops4[] = {0xcf, 0xda, 0xec, 0x65, 0xb4, 0x2a, 0x0,  0xf1, 0xa9,
                               0x71, 0x63, 0x5b, 0x61, 0xc,  0x3b, 0xbb, 0x26, 0x83};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8553}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17083}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3764}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18550}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11002}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 65}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbc, 0x24, 0x26, 0xe5, 0xcc, 0x92, 0xba, 0xf4,
                                0x70, 0x6,  0xa5, 0x64, 0x43, 0xc6, 0x47};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2c, 0x6e, 0x88, 0x2b, 0x45, 0xc3, 0x88, 0x5f,
                                  0x4b, 0xde, 0x94, 0x84, 0x73, 0x8d, 0x7b, 0xe7};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25534;
  uint8_t client_id_bytes[] = {0x74, 0xb1, 0x8b, 0x2c, 0xbf, 0x8b, 0x74, 0xf4,
                               0x15, 0xc,  0x8c, 0x21, 0x47, 0x83, 0x6b, 0x8d};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9d, 0xf4, 0xfc, 0x21, 0xa, 0x6f, 0xe1, 0x65};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0x2b, 0xc1, 0xce, 0x8f, 0xb1, 0x18, 0x0,  0x8,  0xe5, 0x8f,
                              0x70, 0xf9, 0x7,  0x6f, 0x54, 0x82, 0x8c, 0xc7, 0xc5, 0x8b, 0x82};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\DC2K\SOH\205\130\243\197\138\251g", _password = Just
// "\203\162\176\223n\163\159\204\NAK\t+\212", _lastWill = Nothing, _cleanSession = True, _keepAlive = 31053, _connID =
// "X\134\206\232\134\243\221\DC1\252", _properties = [PropAuthenticationData
// "}\SOH\129\&1\216S",PropSharedSubscriptionAvailable 26,PropWildcardSubscriptionAvailable 135,PropUserProperty
// "\r&\218\SOH\216{kV\142XS\182E\247D\162C" "\247\204w\212\157\255%\a\187K\v",PropMessageExpiryInterval
// 31117,PropServerKeepAlive 3900,PropRequestProblemInformation 83,PropRetainAvailable 226,PropTopicAlias
// 28186,PropMessageExpiryInterval 2261]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x72, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x79, 0x4d, 0x42, 0x16, 0x0,  0x6,  0x7d,
                   0x1,  0x81, 0x31, 0xd8, 0x53, 0x2a, 0x1a, 0x28, 0x87, 0x26, 0x0,  0x11, 0xd,  0x26, 0xda, 0x1,  0xd8,
                   0x7b, 0x6b, 0x56, 0x8e, 0x58, 0x53, 0xb6, 0x45, 0xf7, 0x44, 0xa2, 0x43, 0x0,  0xb,  0xf7, 0xcc, 0x77,
                   0xd4, 0x9d, 0xff, 0x25, 0x7,  0xbb, 0x4b, 0xb,  0x2,  0x0,  0x0,  0x79, 0x8d, 0x13, 0xf,  0x3c, 0x17,
                   0x53, 0x25, 0xe2, 0x23, 0x6e, 0x1a, 0x2,  0x0,  0x0,  0x8,  0xd5, 0x0,  0x9,  0x58, 0x86, 0xce, 0xe8,
                   0x86, 0xf3, 0xdd, 0x11, 0xfc, 0x0,  0xa,  0x12, 0x4b, 0x1,  0xcd, 0x82, 0xf3, 0xc5, 0x8a, 0xfb, 0x67,
                   0x0,  0xc,  0xcb, 0xa2, 0xb0, 0xdf, 0x6e, 0xa3, 0x9f, 0xcc, 0x15, 0x9,  0x2b, 0xd4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7d, 0x1, 0x81, 0x31, 0xd8, 0x53};
  uint8_t bytesprops2[] = {0xf7, 0xcc, 0x77, 0xd4, 0x9d, 0xff, 0x25, 0x7, 0xbb, 0x4b, 0xb};
  uint8_t bytesprops1[] = {0xd,  0x26, 0xda, 0x1,  0xd8, 0x7b, 0x6b, 0x56, 0x8e,
                           0x58, 0x53, 0xb6, 0x45, 0xf7, 0x44, 0xa2, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31117}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3900}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28186}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2261}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31053;
  uint8_t client_id_bytes[] = {0x58, 0x86, 0xce, 0xe8, 0x86, 0xf3, 0xdd, 0x11, 0xfc};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x12, 0x4b, 0x1, 0xcd, 0x82, 0xf3, 0xc5, 0x8a, 0xfb, 0x67};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0xa2, 0xb0, 0xdf, 0x6e, 0xa3, 0x9f, 0xcc, 0x15, 0x9, 0x2b, 0xd4};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SI\249\217\245+\148\214W4\194\166\EM\248\229\173\221\207!\207", _password = Just
// "\162\230\187s\155\185\166\184\194\DLE6", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic
// = "\NAK6\214\US\166`\243!\147\STX\254$x\152\221|]V\DC2\132\180{E#\STX|.\209\244", _willMsg =
// "\200\238p[\209Nf\186\211\186\213\164\&0\t\223\176", _willProps = [PropMaximumQoS 157,PropReceiveMaximum
// 16723,PropServerKeepAlive 27480,PropMaximumQoS 253,PropSubscriptionIdentifierAvailable 139,PropWillDelayInterval
// 11494,PropServerReference "\131\DC38j\252,b\147\&5\198\144",PropReasonString
// "\243\148$\128-\210\196\ENQ\187\171ZP\178]\246\SI\182\243\133ST\150\176\159_F",PropTopicAlias 31551,PropResponseTopic
// "Qj\231\141\&6\136\207\146\131N\DEL\171%+\197\145'[",PropServerReference "zf",PropMaximumQoS
// 241,PropPayloadFormatIndicator 135,PropRequestResponseInformation 193,PropSubscriptionIdentifierAvailable
// 41,PropResponseInformation "\199k\128y",PropAssignedClientIdentifier "e\146\175\173y\189\235\CAN0"]}), _cleanSession
// = True, _keepAlive = 12605, _connID = "\132\135\132`\t\238\191\184 \SOH\162", _properties =
// [PropMessageExpiryInterval 20650,PropAuthenticationData
// ";Y\134\213\220\FS\145\157\247\194\a\148\212\228\146\GS\SYNpKh\129\SOR\230q\248\178>\225",PropMaximumQoS
// 209,PropSessionExpiryInterval 6705,PropResponseTopic
// "\190-F\201\158\164H\167\236=\188",PropSubscriptionIdentifierAvailable 19,PropTopicAlias
// 4285,PropSharedSubscriptionAvailable 74,PropAssignedClientIdentifier "\172\DC2%\190\136",PropReasonString
// "UP\235\245\192YI\\\201$e\225\130\ENQn<2\141",PropTopicAlias 15039,PropMaximumQoS 17,PropTopicAlias
// 22926,PropCorrelationData "\CAN\239\FS\DC4\177\164o\246&\207",PropMessageExpiryInterval 20290]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x10, 0xd8, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x31, 0x3d, 0x78, 0x2,  0x0,  0x0,  0x50, 0xaa,
      0x16, 0x0,  0x1d, 0x3b, 0x59, 0x86, 0xd5, 0xdc, 0x1c, 0x91, 0x9d, 0xf7, 0xc2, 0x7,  0x94, 0xd4, 0xe4, 0x92, 0x1d,
      0x16, 0x70, 0x4b, 0x68, 0x81, 0xe,  0x52, 0xe6, 0x71, 0xf8, 0xb2, 0x3e, 0xe1, 0x24, 0xd1, 0x11, 0x0,  0x0,  0x1a,
      0x31, 0x8,  0x0,  0xb,  0xbe, 0x2d, 0x46, 0xc9, 0x9e, 0xa4, 0x48, 0xa7, 0xec, 0x3d, 0xbc, 0x29, 0x13, 0x23, 0x10,
      0xbd, 0x2a, 0x4a, 0x12, 0x0,  0x5,  0xac, 0x12, 0x25, 0xbe, 0x88, 0x1f, 0x0,  0x12, 0x55, 0x50, 0xeb, 0xf5, 0xc0,
      0x59, 0x49, 0x5c, 0xc9, 0x24, 0x65, 0xe1, 0x82, 0x5,  0x6e, 0x3c, 0x32, 0x8d, 0x23, 0x3a, 0xbf, 0x24, 0x11, 0x23,
      0x59, 0x8e, 0x9,  0x0,  0xa,  0x18, 0xef, 0x1c, 0x14, 0xb1, 0xa4, 0x6f, 0xf6, 0x26, 0xcf, 0x2,  0x0,  0x0,  0x4f,
      0x42, 0x0,  0xb,  0x84, 0x87, 0x84, 0x60, 0x9,  0xee, 0xbf, 0xb8, 0x20, 0x1,  0xa2, 0x74, 0x24, 0x9d, 0x21, 0x41,
      0x53, 0x13, 0x6b, 0x58, 0x24, 0xfd, 0x29, 0x8b, 0x18, 0x0,  0x0,  0x2c, 0xe6, 0x1c, 0x0,  0xb,  0x83, 0x13, 0x38,
      0x6a, 0xfc, 0x2c, 0x62, 0x93, 0x35, 0xc6, 0x90, 0x1f, 0x0,  0x1a, 0xf3, 0x94, 0x24, 0x80, 0x2d, 0xd2, 0xc4, 0x5,
      0xbb, 0xab, 0x5a, 0x50, 0xb2, 0x5d, 0xf6, 0xf,  0xb6, 0xf3, 0x85, 0x53, 0x54, 0x96, 0xb0, 0x9f, 0x5f, 0x46, 0x23,
      0x7b, 0x3f, 0x8,  0x0,  0x12, 0x51, 0x6a, 0xe7, 0x8d, 0x36, 0x88, 0xcf, 0x92, 0x83, 0x4e, 0x7f, 0xab, 0x25, 0x2b,
      0xc5, 0x91, 0x27, 0x5b, 0x1c, 0x0,  0x2,  0x7a, 0x66, 0x24, 0xf1, 0x1,  0x87, 0x19, 0xc1, 0x29, 0x29, 0x1a, 0x0,
      0x4,  0xc7, 0x6b, 0x80, 0x79, 0x12, 0x0,  0x9,  0x65, 0x92, 0xaf, 0xad, 0x79, 0xbd, 0xeb, 0x18, 0x30, 0x0,  0x1d,
      0x15, 0x36, 0xd6, 0x1f, 0xa6, 0x60, 0xf3, 0x21, 0x93, 0x2,  0xfe, 0x24, 0x78, 0x98, 0xdd, 0x7c, 0x5d, 0x56, 0x12,
      0x84, 0xb4, 0x7b, 0x45, 0x23, 0x2,  0x7c, 0x2e, 0xd1, 0xf4, 0x0,  0x10, 0xc8, 0xee, 0x70, 0x5b, 0xd1, 0x4e, 0x66,
      0xba, 0xd3, 0xba, 0xd5, 0xa4, 0x30, 0x9,  0xdf, 0xb0, 0x0,  0x13, 0xf,  0xf9, 0xd9, 0xf5, 0x2b, 0x94, 0xd6, 0x57,
      0x34, 0xc2, 0xa6, 0x19, 0xf8, 0xe5, 0xad, 0xdd, 0xcf, 0x21, 0xcf, 0x0,  0xb,  0xa2, 0xe6, 0xbb, 0x73, 0x9b, 0xb9,
      0xa6, 0xb8, 0xc2, 0x10, 0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3b, 0x59, 0x86, 0xd5, 0xdc, 0x1c, 0x91, 0x9d, 0xf7, 0xc2, 0x7,  0x94, 0xd4, 0xe4, 0x92,
                           0x1d, 0x16, 0x70, 0x4b, 0x68, 0x81, 0xe,  0x52, 0xe6, 0x71, 0xf8, 0xb2, 0x3e, 0xe1};
  uint8_t bytesprops1[] = {0xbe, 0x2d, 0x46, 0xc9, 0x9e, 0xa4, 0x48, 0xa7, 0xec, 0x3d, 0xbc};
  uint8_t bytesprops2[] = {0xac, 0x12, 0x25, 0xbe, 0x88};
  uint8_t bytesprops3[] = {0x55, 0x50, 0xeb, 0xf5, 0xc0, 0x59, 0x49, 0x5c, 0xc9,
                           0x24, 0x65, 0xe1, 0x82, 0x5,  0x6e, 0x3c, 0x32, 0x8d};
  uint8_t bytesprops4[] = {0x18, 0xef, 0x1c, 0x14, 0xb1, 0xa4, 0x6f, 0xf6, 0x26, 0xcf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20650}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6705}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4285}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15039}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22926}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20290}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x83, 0x13, 0x38, 0x6a, 0xfc, 0x2c, 0x62, 0x93, 0x35, 0xc6, 0x90};
  uint8_t byteswillprops1[] = {0xf3, 0x94, 0x24, 0x80, 0x2d, 0xd2, 0xc4, 0x5,  0xbb, 0xab, 0x5a, 0x50, 0xb2,
                               0x5d, 0xf6, 0xf,  0xb6, 0xf3, 0x85, 0x53, 0x54, 0x96, 0xb0, 0x9f, 0x5f, 0x46};
  uint8_t byteswillprops2[] = {0x51, 0x6a, 0xe7, 0x8d, 0x36, 0x88, 0xcf, 0x92, 0x83,
                               0x4e, 0x7f, 0xab, 0x25, 0x2b, 0xc5, 0x91, 0x27, 0x5b};
  uint8_t byteswillprops3[] = {0x7a, 0x66};
  uint8_t byteswillprops4[] = {0xc7, 0x6b, 0x80, 0x79};
  uint8_t byteswillprops5[] = {0x65, 0x92, 0xaf, 0xad, 0x79, 0xbd, 0xeb, 0x18, 0x30};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16723}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27480}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11494}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31551}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0x36, 0xd6, 0x1f, 0xa6, 0x60, 0xf3, 0x21, 0x93, 0x2, 0xfe, 0x24, 0x78, 0x98, 0xdd,
                                0x7c, 0x5d, 0x56, 0x12, 0x84, 0xb4, 0x7b, 0x45, 0x23, 0x2, 0x7c, 0x2e, 0xd1, 0xf4};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc8, 0xee, 0x70, 0x5b, 0xd1, 0x4e, 0x66, 0xba,
                                  0xd3, 0xba, 0xd5, 0xa4, 0x30, 0x9,  0xdf, 0xb0};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12605;
  uint8_t client_id_bytes[] = {0x84, 0x87, 0x84, 0x60, 0x9, 0xee, 0xbf, 0xb8, 0x20, 0x1, 0xa2};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf,  0xf9, 0xd9, 0xf5, 0x2b, 0x94, 0xd6, 0x57, 0x34, 0xc2,
                              0xa6, 0x19, 0xf8, 0xe5, 0xad, 0xdd, 0xcf, 0x21, 0xcf};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa2, 0xe6, 0xbb, 0x73, 0x9b, 0xb9, 0xa6, 0xb8, 0xc2, 0x10, 0x36};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\222\FS\NUL", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\236?v#\231\182\221\157[=\139|\191\209\208\147\164?\221=)\ETB?\217\223e", _willMsg =
// "n\212", _willProps = [PropRequestResponseInformation 94,PropPayloadFormatIndicator 132,PropContentType
// "p\128\239\STX\229\200",PropCorrelationData
// "\168\239}\235\219\230\139\&9\232L\237\181\208P\226\SYN\"\213zF",PropSharedSubscriptionAvailable 131,PropMaximumQoS
// 210,PropSessionExpiryInterval 31642]}), _cleanSession = False, _keepAlive = 12313, _connID = "%W\235
// )\183\218\188oO\152j\237\b!", _properties = [PropCorrelationData "",PropUserProperty
// "\219\242\DEL\229\232\&8\DC4\147\200\214@O0\216<\234\&4\159\204\231\139:^\204"
// "![s\250\196\NUL@\239?2\133\DC2\246\238\195V",PropTopicAliasMaximum 15720,PropMaximumPacketSize
// 32521,PropAuthenticationMethod "V",PropContentType
// "\228wB\STX\194\206%\CAN\253;\136\215\&4-\139\205\178\DC3_\234\146\226\199\ENQ",PropAuthenticationMethod
// "\t\169\192\150\246\214H\SYN\DC1`",PropUserProperty
// "\164\135\171\CAN\208\134:\172\201\184\ENQ\150s\183\181\241\202<\203\148q\249\t\148\137\176Ka\255\n"
// "\207\193\157\215D\164\FS{@\214\n",PropSharedSubscriptionAvailable 210,PropPayloadFormatIndicator
// 250,PropAuthenticationMethod "\140\250\165x\183l/)",PropServerKeepAlive 15023,PropServerKeepAlive
// 6531,PropUserProperty "\218 I\NULQ\196" "\EM\168\134\161z5\RSV\243\NAKZ\172e\219c\167"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xb2, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x30, 0x19, 0xc2, 0x1,  0x9,  0x0,  0x0,  0x26,
      0x0,  0x18, 0xdb, 0xf2, 0x7f, 0xe5, 0xe8, 0x38, 0x14, 0x93, 0xc8, 0xd6, 0x40, 0x4f, 0x30, 0xd8, 0x3c, 0xea, 0x34,
      0x9f, 0xcc, 0xe7, 0x8b, 0x3a, 0x5e, 0xcc, 0x0,  0x10, 0x21, 0x5b, 0x73, 0xfa, 0xc4, 0x0,  0x40, 0xef, 0x3f, 0x32,
      0x85, 0x12, 0xf6, 0xee, 0xc3, 0x56, 0x22, 0x3d, 0x68, 0x27, 0x0,  0x0,  0x7f, 0x9,  0x15, 0x0,  0x1,  0x56, 0x3,
      0x0,  0x18, 0xe4, 0x77, 0x42, 0x2,  0xc2, 0xce, 0x25, 0x18, 0xfd, 0x3b, 0x88, 0xd7, 0x34, 0x2d, 0x8b, 0xcd, 0xb2,
      0x13, 0x5f, 0xea, 0x92, 0xe2, 0xc7, 0x5,  0x15, 0x0,  0xa,  0x9,  0xa9, 0xc0, 0x96, 0xf6, 0xd6, 0x48, 0x16, 0x11,
      0x60, 0x26, 0x0,  0x1e, 0xa4, 0x87, 0xab, 0x18, 0xd0, 0x86, 0x3a, 0xac, 0xc9, 0xb8, 0x5,  0x96, 0x73, 0xb7, 0xb5,
      0xf1, 0xca, 0x3c, 0xcb, 0x94, 0x71, 0xf9, 0x9,  0x94, 0x89, 0xb0, 0x4b, 0x61, 0xff, 0xa,  0x0,  0xb,  0xcf, 0xc1,
      0x9d, 0xd7, 0x44, 0xa4, 0x1c, 0x7b, 0x40, 0xd6, 0xa,  0x2a, 0xd2, 0x1,  0xfa, 0x15, 0x0,  0x8,  0x8c, 0xfa, 0xa5,
      0x78, 0xb7, 0x6c, 0x2f, 0x29, 0x13, 0x3a, 0xaf, 0x13, 0x19, 0x83, 0x26, 0x0,  0x6,  0xda, 0x20, 0x49, 0x0,  0x51,
      0xc4, 0x0,  0x10, 0x19, 0xa8, 0x86, 0xa1, 0x7a, 0x35, 0x1e, 0x56, 0xf3, 0x15, 0x5a, 0xac, 0x65, 0xdb, 0x63, 0xa7,
      0x0,  0xf,  0x25, 0x57, 0xeb, 0x20, 0x29, 0xb7, 0xda, 0xbc, 0x6f, 0x4f, 0x98, 0x6a, 0xed, 0x8,  0x21, 0x2d, 0x19,
      0x5e, 0x1,  0x84, 0x3,  0x0,  0x6,  0x70, 0x80, 0xef, 0x2,  0xe5, 0xc8, 0x9,  0x0,  0x14, 0xa8, 0xef, 0x7d, 0xeb,
      0xdb, 0xe6, 0x8b, 0x39, 0xe8, 0x4c, 0xed, 0xb5, 0xd0, 0x50, 0xe2, 0x16, 0x22, 0xd5, 0x7a, 0x46, 0x2a, 0x83, 0x24,
      0xd2, 0x11, 0x0,  0x0,  0x7b, 0x9a, 0x0,  0x1a, 0xec, 0x3f, 0x76, 0x23, 0xe7, 0xb6, 0xdd, 0x9d, 0x5b, 0x3d, 0x8b,
      0x7c, 0xbf, 0xd1, 0xd0, 0x93, 0xa4, 0x3f, 0xdd, 0x3d, 0x29, 0x17, 0x3f, 0xd9, 0xdf, 0x65, 0x0,  0x2,  0x6e, 0xd4,
      0x0,  0x3,  0xde, 0x1c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0x21, 0x5b, 0x73, 0xfa, 0xc4, 0x0,  0x40, 0xef,
                           0x3f, 0x32, 0x85, 0x12, 0xf6, 0xee, 0xc3, 0x56};
  uint8_t bytesprops1[] = {0xdb, 0xf2, 0x7f, 0xe5, 0xe8, 0x38, 0x14, 0x93, 0xc8, 0xd6, 0x40, 0x4f,
                           0x30, 0xd8, 0x3c, 0xea, 0x34, 0x9f, 0xcc, 0xe7, 0x8b, 0x3a, 0x5e, 0xcc};
  uint8_t bytesprops3[] = {0x56};
  uint8_t bytesprops4[] = {0xe4, 0x77, 0x42, 0x2,  0xc2, 0xce, 0x25, 0x18, 0xfd, 0x3b, 0x88, 0xd7,
                           0x34, 0x2d, 0x8b, 0xcd, 0xb2, 0x13, 0x5f, 0xea, 0x92, 0xe2, 0xc7, 0x5};
  uint8_t bytesprops5[] = {0x9, 0xa9, 0xc0, 0x96, 0xf6, 0xd6, 0x48, 0x16, 0x11, 0x60};
  uint8_t bytesprops7[] = {0xcf, 0xc1, 0x9d, 0xd7, 0x44, 0xa4, 0x1c, 0x7b, 0x40, 0xd6, 0xa};
  uint8_t bytesprops6[] = {0xa4, 0x87, 0xab, 0x18, 0xd0, 0x86, 0x3a, 0xac, 0xc9, 0xb8, 0x5,  0x96, 0x73, 0xb7, 0xb5,
                           0xf1, 0xca, 0x3c, 0xcb, 0x94, 0x71, 0xf9, 0x9,  0x94, 0x89, 0xb0, 0x4b, 0x61, 0xff, 0xa};
  uint8_t bytesprops8[] = {0x8c, 0xfa, 0xa5, 0x78, 0xb7, 0x6c, 0x2f, 0x29};
  uint8_t bytesprops10[] = {0x19, 0xa8, 0x86, 0xa1, 0x7a, 0x35, 0x1e, 0x56,
                            0xf3, 0x15, 0x5a, 0xac, 0x65, 0xdb, 0x63, 0xa7};
  uint8_t bytesprops9[] = {0xda, 0x20, 0x49, 0x0, 0x51, 0xc4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops1}, .v = {16, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15720}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32521}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops6}, .v = {11, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15023}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6531}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops9}, .v = {16, (char*)&bytesprops10}}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x70, 0x80, 0xef, 0x2, 0xe5, 0xc8};
  uint8_t byteswillprops1[] = {0xa8, 0xef, 0x7d, 0xeb, 0xdb, 0xe6, 0x8b, 0x39, 0xe8, 0x4c,
                               0xed, 0xb5, 0xd0, 0x50, 0xe2, 0x16, 0x22, 0xd5, 0x7a, 0x46};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31642}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xec, 0x3f, 0x76, 0x23, 0xe7, 0xb6, 0xdd, 0x9d, 0x5b, 0x3d, 0x8b, 0x7c, 0xbf,
                                0xd1, 0xd0, 0x93, 0xa4, 0x3f, 0xdd, 0x3d, 0x29, 0x17, 0x3f, 0xd9, 0xdf, 0x65};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6e, 0xd4};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12313;
  uint8_t client_id_bytes[] = {0x25, 0x57, 0xeb, 0x20, 0x29, 0xb7, 0xda, 0xbc, 0x6f, 0x4f, 0x98, 0x6a, 0xed, 0x8, 0x21};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xde, 0x1c, 0x0};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\ENQ\177\248\150\234\US\132\246q", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\183\FS\DC1\132\182jmFH\GS\201\141\226\&3\n", _willMsg =
// "\134\204\FS{\151\206b\190e\177\149\v\146\182\240\197\189NN\183\242\207\\BM\fs\198H", _willProps =
// [PropServerKeepAlive 253,PropWillDelayInterval 12369,PropAuthenticationMethod "6"]}), _cleanSession = True,
// _keepAlive = 13514, _connID = "\161 \149\244\226\242\217\139I p\234\"\249\DLE\216>p\SOV\CAN\207\131", _properties =
// [PropAuthenticationData
// "~\223\208\175\211\192iA\151\215\172P\184\236\142OE\201Y\204iO\225\209\219VY\203",PropUserProperty
// "E\208\251\CAN\177J\CAN\\\222lb&\194>\230\158"
// "\226\147\172\156B\153\226x\SOH\158\ETXU\GS\193\188Gt+\n\237-.u\133\149",PropTopicAliasMaximum
// 10312,PropRequestResponseInformation 21,PropServerKeepAlive 7697,PropServerReference
// "X\219",PropAssignedClientIdentifier
// "VJ\ENQ\167\243}\244\\\204k\158}CO\RSg\206$\143\220\180E\184\176\234\174\131\199\180",PropServerReference
// "\200\&8\251e\205\186v\SYNf\128\227\SYN8\141",PropTopicAliasMaximum 16471,PropTopicAlias 28347,PropServerKeepAlive
// 11503,PropAuthenticationData "\153U\163\173\234J\243\188\&2c\150\233"]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0x90, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x34, 0xca, 0xa3, 0x1,  0x16, 0x0,  0x1c, 0x7e,
      0xdf, 0xd0, 0xaf, 0xd3, 0xc0, 0x69, 0x41, 0x97, 0xd7, 0xac, 0x50, 0xb8, 0xec, 0x8e, 0x4f, 0x45, 0xc9, 0x59, 0xcc,
      0x69, 0x4f, 0xe1, 0xd1, 0xdb, 0x56, 0x59, 0xcb, 0x26, 0x0,  0x10, 0x45, 0xd0, 0xfb, 0x18, 0xb1, 0x4a, 0x18, 0x5c,
      0xde, 0x6c, 0x62, 0x26, 0xc2, 0x3e, 0xe6, 0x9e, 0x0,  0x19, 0xe2, 0x93, 0xac, 0x9c, 0x42, 0x99, 0xe2, 0x78, 0x1,
      0x9e, 0x3,  0x55, 0x1d, 0xc1, 0xbc, 0x47, 0x74, 0x2b, 0xa,  0xed, 0x2d, 0x2e, 0x75, 0x85, 0x95, 0x22, 0x28, 0x48,
      0x19, 0x15, 0x13, 0x1e, 0x11, 0x1c, 0x0,  0x2,  0x58, 0xdb, 0x12, 0x0,  0x1d, 0x56, 0x4a, 0x5,  0xa7, 0xf3, 0x7d,
      0xf4, 0x5c, 0xcc, 0x6b, 0x9e, 0x7d, 0x43, 0x4f, 0x1e, 0x67, 0xce, 0x24, 0x8f, 0xdc, 0xb4, 0x45, 0xb8, 0xb0, 0xea,
      0xae, 0x83, 0xc7, 0xb4, 0x1c, 0x0,  0xe,  0xc8, 0x38, 0xfb, 0x65, 0xcd, 0xba, 0x76, 0x16, 0x66, 0x80, 0xe3, 0x16,
      0x38, 0x8d, 0x22, 0x40, 0x57, 0x23, 0x6e, 0xbb, 0x13, 0x2c, 0xef, 0x16, 0x0,  0xc,  0x99, 0x55, 0xa3, 0xad, 0xea,
      0x4a, 0xf3, 0xbc, 0x32, 0x63, 0x96, 0xe9, 0x0,  0x17, 0xa1, 0x20, 0x95, 0xf4, 0xe2, 0xf2, 0xd9, 0x8b, 0x49, 0x20,
      0x70, 0xea, 0x22, 0xf9, 0x10, 0xd8, 0x3e, 0x70, 0xe,  0x56, 0x18, 0xcf, 0x83, 0xc,  0x13, 0x0,  0xfd, 0x18, 0x0,
      0x0,  0x30, 0x51, 0x15, 0x0,  0x1,  0x36, 0x0,  0xf,  0xb7, 0x1c, 0x11, 0x84, 0xb6, 0x6a, 0x6d, 0x46, 0x48, 0x1d,
      0xc9, 0x8d, 0xe2, 0x33, 0xa,  0x0,  0x1d, 0x86, 0xcc, 0x1c, 0x7b, 0x97, 0xce, 0x62, 0xbe, 0x65, 0xb1, 0x95, 0xb,
      0x92, 0xb6, 0xf0, 0xc5, 0xbd, 0x4e, 0x4e, 0xb7, 0xf2, 0xcf, 0x5c, 0x42, 0x4d, 0xc,  0x73, 0xc6, 0x48, 0x0,  0x9,
      0x5,  0xb1, 0xf8, 0x96, 0xea, 0x1f, 0x84, 0xf6, 0x71};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7e, 0xdf, 0xd0, 0xaf, 0xd3, 0xc0, 0x69, 0x41, 0x97, 0xd7, 0xac, 0x50, 0xb8, 0xec,
                           0x8e, 0x4f, 0x45, 0xc9, 0x59, 0xcc, 0x69, 0x4f, 0xe1, 0xd1, 0xdb, 0x56, 0x59, 0xcb};
  uint8_t bytesprops2[] = {0xe2, 0x93, 0xac, 0x9c, 0x42, 0x99, 0xe2, 0x78, 0x1,  0x9e, 0x3,  0x55, 0x1d,
                           0xc1, 0xbc, 0x47, 0x74, 0x2b, 0xa,  0xed, 0x2d, 0x2e, 0x75, 0x85, 0x95};
  uint8_t bytesprops1[] = {0x45, 0xd0, 0xfb, 0x18, 0xb1, 0x4a, 0x18, 0x5c,
                           0xde, 0x6c, 0x62, 0x26, 0xc2, 0x3e, 0xe6, 0x9e};
  uint8_t bytesprops3[] = {0x58, 0xdb};
  uint8_t bytesprops4[] = {0x56, 0x4a, 0x5,  0xa7, 0xf3, 0x7d, 0xf4, 0x5c, 0xcc, 0x6b, 0x9e, 0x7d, 0x43, 0x4f, 0x1e,
                           0x67, 0xce, 0x24, 0x8f, 0xdc, 0xb4, 0x45, 0xb8, 0xb0, 0xea, 0xae, 0x83, 0xc7, 0xb4};
  uint8_t bytesprops5[] = {0xc8, 0x38, 0xfb, 0x65, 0xcd, 0xba, 0x76, 0x16, 0x66, 0x80, 0xe3, 0x16, 0x38, 0x8d};
  uint8_t bytesprops6[] = {0x99, 0x55, 0xa3, 0xad, 0xea, 0x4a, 0xf3, 0xbc, 0x32, 0x63, 0x96, 0xe9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {25, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10312}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7697}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16471}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28347}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11503}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x36};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 253}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12369}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb7, 0x1c, 0x11, 0x84, 0xb6, 0x6a, 0x6d, 0x46,
                                0x48, 0x1d, 0xc9, 0x8d, 0xe2, 0x33, 0xa};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x86, 0xcc, 0x1c, 0x7b, 0x97, 0xce, 0x62, 0xbe, 0x65, 0xb1,
                                  0x95, 0xb,  0x92, 0xb6, 0xf0, 0xc5, 0xbd, 0x4e, 0x4e, 0xb7,
                                  0xf2, 0xcf, 0x5c, 0x42, 0x4d, 0xc,  0x73, 0xc6, 0x48};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13514;
  uint8_t client_id_bytes[] = {0xa1, 0x20, 0x95, 0xf4, 0xe2, 0xf2, 0xd9, 0x8b, 0x49, 0x20, 0x70, 0xea,
                               0x22, 0xf9, 0x10, 0xd8, 0x3e, 0x70, 0xe,  0x56, 0x18, 0xcf, 0x83};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x5, 0xb1, 0xf8, 0x96, 0xea, 0x1f, 0x84, 0xf6, 0x71};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218r\168\139R\217\209\a@\135\239\135\152\130\140\156\230\152>\156\160", _password
// = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\220\218\137\179z\158\vc\CAN\128\SUBU\DC3\175n\201P\218B", _willMsg =
// "\218\174\233=\151\&7\204\204\181\t\146\180O\189\173.`\244\151\180I@0\252", _willProps = [PropServerReference
// "\185+\ACKp,\DC348\155\178'\197\r\252[\191\ENQ",PropMessageExpiryInterval 16461,PropWillDelayInterval
// 14555,PropSharedSubscriptionAvailable 229,PropServerReference "",PropRequestResponseInformation
// 34,PropSubscriptionIdentifier 24,PropMessageExpiryInterval 1953,PropTopicAlias 5336,PropSubscriptionIdentifier
// 24,PropServerKeepAlive 13981,PropAuthenticationMethod
// "-K\136\175O\234\SOH\137\NAK\188\205\GSZ\214\132\148\198\227Xw\a1,\ETX\EOT#V$",PropSubscriptionIdentifierAvailable
// 56,PropReceiveMaximum 13755,PropAssignedClientIdentifier "bf7",PropReceiveMaximum
// 20468,PropRequestResponseInformation 110,PropContentType "\153\153",PropReasonString
// "#\SYNo\149\211",PropUserProperty "\RS8\192;E\232J\nye8\238:\153\183\178\137\NAK\238\147\207\CAN\192"
// "(\235\218\154b",PropRequestResponseInformation 211,PropRetainAvailable 23,PropPayloadFormatIndicator
// 148,PropCorrelationData "\161\132\186I\178'9\205lh}\144\187\249\NUL\177M\STX
// \RS\n\154\159SNY\188C\194#",PropAuthenticationData
// "\214\253\205\207\250\155\157\148\190\226/S\156\220\235q\233\SUBA\v\180$\FS\221\ESC\165",PropMaximumQoS
// 187,PropSessionExpiryInterval 14562,PropSubscriptionIdentifierAvailable 242,PropReceiveMaximum 292,PropResponseTopic
// "\129\155\197zP\186\229\156\180\132\&3\FS)\156\179\213q=,\n"]}), _cleanSession = True, _keepAlive = 5227, _connID =
// "_\201\&2\202<\161\171\209\244\241\165", _properties = [PropTopicAliasMaximum 16149,PropTopicAliasMaximum
// 24850,PropResponseInformation "\131\163\236\190\&3'\193\233\141\150M>\205",PropReceiveMaximum
// 31161,PropSessionExpiryInterval 25873,PropSessionExpiryInterval 27557,PropWillDelayInterval
// 14599,PropAuthenticationMethod "\170\130\148\203\162I\210\177z\150X",PropWildcardSubscriptionAvailable
// 242,PropCorrelationData "P^\237\248",PropTopicAlias 11716,PropWillDelayInterval 10255,PropAuthenticationMethod
// "\202\255\154\170\175\187\151\&2\145MT\131\NAK\SOH\227\EOTQ\NAK\160\237?L\245",PropCorrelationData
// "\152\218\"\206\241\224U\129>",PropSessionExpiryInterval 23109,PropWildcardSubscriptionAvailable
// 229,PropPayloadFormatIndicator 181,PropServerKeepAlive 21011,PropReceiveMaximum 7128,PropServerReference
// "\179v\181\158T\217i",PropMaximumPacketSize 17720,PropMessageExpiryInterval 5161,PropSharedSubscriptionAvailable
// 116,PropAssignedClientIdentifier "\DC2J\130\&2@\201s\172u)R\175"]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x10, 0xfa, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xae, 0x14, 0x6b, 0xa1, 0x1,  0x22, 0x3f, 0x15, 0x22,
      0x61, 0x12, 0x1a, 0x0,  0xd,  0x83, 0xa3, 0xec, 0xbe, 0x33, 0x27, 0xc1, 0xe9, 0x8d, 0x96, 0x4d, 0x3e, 0xcd, 0x21,
      0x79, 0xb9, 0x11, 0x0,  0x0,  0x65, 0x11, 0x11, 0x0,  0x0,  0x6b, 0xa5, 0x18, 0x0,  0x0,  0x39, 0x7,  0x15, 0x0,
      0xb,  0xaa, 0x82, 0x94, 0xcb, 0xa2, 0x49, 0xd2, 0xb1, 0x7a, 0x96, 0x58, 0x28, 0xf2, 0x9,  0x0,  0x4,  0x50, 0x5e,
      0xed, 0xf8, 0x23, 0x2d, 0xc4, 0x18, 0x0,  0x0,  0x28, 0xf,  0x15, 0x0,  0x17, 0xca, 0xff, 0x9a, 0xaa, 0xaf, 0xbb,
      0x97, 0x32, 0x91, 0x4d, 0x54, 0x83, 0x15, 0x1,  0xe3, 0x4,  0x51, 0x15, 0xa0, 0xed, 0x3f, 0x4c, 0xf5, 0x9,  0x0,
      0x9,  0x98, 0xda, 0x22, 0xce, 0xf1, 0xe0, 0x55, 0x81, 0x3e, 0x11, 0x0,  0x0,  0x5a, 0x45, 0x28, 0xe5, 0x1,  0xb5,
      0x13, 0x52, 0x13, 0x21, 0x1b, 0xd8, 0x1c, 0x0,  0x7,  0xb3, 0x76, 0xb5, 0x9e, 0x54, 0xd9, 0x69, 0x27, 0x0,  0x0,
      0x45, 0x38, 0x2,  0x0,  0x0,  0x14, 0x29, 0x2a, 0x74, 0x12, 0x0,  0xc,  0x12, 0x4a, 0x82, 0x32, 0x40, 0xc9, 0x73,
      0xac, 0x75, 0x29, 0x52, 0xaf, 0x0,  0xb,  0x5f, 0xc9, 0x32, 0xca, 0x3c, 0xa1, 0xab, 0xd1, 0xf4, 0xf1, 0xa5, 0xf8,
      0x1,  0x1c, 0x0,  0x11, 0xb9, 0x2b, 0x6,  0x70, 0x2c, 0x13, 0x34, 0x38, 0x9b, 0xb2, 0x27, 0xc5, 0xd,  0xfc, 0x5b,
      0xbf, 0x5,  0x2,  0x0,  0x0,  0x40, 0x4d, 0x18, 0x0,  0x0,  0x38, 0xdb, 0x2a, 0xe5, 0x1c, 0x0,  0x0,  0x19, 0x22,
      0xb,  0x18, 0x2,  0x0,  0x0,  0x7,  0xa1, 0x23, 0x14, 0xd8, 0xb,  0x18, 0x13, 0x36, 0x9d, 0x15, 0x0,  0x1c, 0x2d,
      0x4b, 0x88, 0xaf, 0x4f, 0xea, 0x1,  0x89, 0x15, 0xbc, 0xcd, 0x1d, 0x5a, 0xd6, 0x84, 0x94, 0xc6, 0xe3, 0x58, 0x77,
      0x7,  0x31, 0x2c, 0x3,  0x4,  0x23, 0x56, 0x24, 0x29, 0x38, 0x21, 0x35, 0xbb, 0x12, 0x0,  0x3,  0x62, 0x66, 0x37,
      0x21, 0x4f, 0xf4, 0x19, 0x6e, 0x3,  0x0,  0x2,  0x99, 0x99, 0x1f, 0x0,  0x5,  0x23, 0x16, 0x6f, 0x95, 0xd3, 0x26,
      0x0,  0x17, 0x1e, 0x38, 0xc0, 0x3b, 0x45, 0xe8, 0x4a, 0xa,  0x79, 0x65, 0x38, 0xee, 0x3a, 0x99, 0xb7, 0xb2, 0x89,
      0x15, 0xee, 0x93, 0xcf, 0x18, 0xc0, 0x0,  0x5,  0x28, 0xeb, 0xda, 0x9a, 0x62, 0x19, 0xd3, 0x25, 0x17, 0x1,  0x94,
      0x9,  0x0,  0x1e, 0xa1, 0x84, 0xba, 0x49, 0xb2, 0x27, 0x39, 0xcd, 0x6c, 0x68, 0x7d, 0x90, 0xbb, 0xf9, 0x0,  0xb1,
      0x4d, 0x2,  0x20, 0x1e, 0xa,  0x9a, 0x9f, 0x53, 0x4e, 0x59, 0xbc, 0x43, 0xc2, 0x23, 0x16, 0x0,  0x1a, 0xd6, 0xfd,
      0xcd, 0xcf, 0xfa, 0x9b, 0x9d, 0x94, 0xbe, 0xe2, 0x2f, 0x53, 0x9c, 0xdc, 0xeb, 0x71, 0xe9, 0x1a, 0x41, 0xb,  0xb4,
      0x24, 0x1c, 0xdd, 0x1b, 0xa5, 0x24, 0xbb, 0x11, 0x0,  0x0,  0x38, 0xe2, 0x29, 0xf2, 0x21, 0x1,  0x24, 0x8,  0x0,
      0x14, 0x81, 0x9b, 0xc5, 0x7a, 0x50, 0xba, 0xe5, 0x9c, 0xb4, 0x84, 0x33, 0x1c, 0x29, 0x9c, 0xb3, 0xd5, 0x71, 0x3d,
      0x2c, 0xa,  0x0,  0x13, 0xdc, 0xda, 0x89, 0xb3, 0x7a, 0x9e, 0xb,  0x63, 0x18, 0x80, 0x1a, 0x55, 0x13, 0xaf, 0x6e,
      0xc9, 0x50, 0xda, 0x42, 0x0,  0x18, 0xda, 0xae, 0xe9, 0x3d, 0x97, 0x37, 0xcc, 0xcc, 0xb5, 0x9,  0x92, 0xb4, 0x4f,
      0xbd, 0xad, 0x2e, 0x60, 0xf4, 0x97, 0xb4, 0x49, 0x40, 0x30, 0xfc, 0x0,  0x15, 0xda, 0x72, 0xa8, 0x8b, 0x52, 0xd9,
      0xd1, 0x7,  0x40, 0x87, 0xef, 0x87, 0x98, 0x82, 0x8c, 0x9c, 0xe6, 0x98, 0x3e, 0x9c, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x83, 0xa3, 0xec, 0xbe, 0x33, 0x27, 0xc1, 0xe9, 0x8d, 0x96, 0x4d, 0x3e, 0xcd};
  uint8_t bytesprops1[] = {0xaa, 0x82, 0x94, 0xcb, 0xa2, 0x49, 0xd2, 0xb1, 0x7a, 0x96, 0x58};
  uint8_t bytesprops2[] = {0x50, 0x5e, 0xed, 0xf8};
  uint8_t bytesprops3[] = {0xca, 0xff, 0x9a, 0xaa, 0xaf, 0xbb, 0x97, 0x32, 0x91, 0x4d, 0x54, 0x83,
                           0x15, 0x1,  0xe3, 0x4,  0x51, 0x15, 0xa0, 0xed, 0x3f, 0x4c, 0xf5};
  uint8_t bytesprops4[] = {0x98, 0xda, 0x22, 0xce, 0xf1, 0xe0, 0x55, 0x81, 0x3e};
  uint8_t bytesprops5[] = {0xb3, 0x76, 0xb5, 0x9e, 0x54, 0xd9, 0x69};
  uint8_t bytesprops6[] = {0x12, 0x4a, 0x82, 0x32, 0x40, 0xc9, 0x73, 0xac, 0x75, 0x29, 0x52, 0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16149}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24850}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31161}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25873}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27557}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14599}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11716}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10255}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23109}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21011}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7128}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17720}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5161}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb9, 0x2b, 0x6,  0x70, 0x2c, 0x13, 0x34, 0x38, 0x9b,
                               0xb2, 0x27, 0xc5, 0xd,  0xfc, 0x5b, 0xbf, 0x5};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0x2d, 0x4b, 0x88, 0xaf, 0x4f, 0xea, 0x1, 0x89, 0x15, 0xbc, 0xcd, 0x1d, 0x5a, 0xd6,
                               0x84, 0x94, 0xc6, 0xe3, 0x58, 0x77, 0x7, 0x31, 0x2c, 0x3,  0x4,  0x23, 0x56, 0x24};
  uint8_t byteswillprops3[] = {0x62, 0x66, 0x37};
  uint8_t byteswillprops4[] = {0x99, 0x99};
  uint8_t byteswillprops5[] = {0x23, 0x16, 0x6f, 0x95, 0xd3};
  uint8_t byteswillprops7[] = {0x28, 0xeb, 0xda, 0x9a, 0x62};
  uint8_t byteswillprops6[] = {0x1e, 0x38, 0xc0, 0x3b, 0x45, 0xe8, 0x4a, 0xa,  0x79, 0x65, 0x38, 0xee,
                               0x3a, 0x99, 0xb7, 0xb2, 0x89, 0x15, 0xee, 0x93, 0xcf, 0x18, 0xc0};
  uint8_t byteswillprops8[] = {0xa1, 0x84, 0xba, 0x49, 0xb2, 0x27, 0x39, 0xcd, 0x6c, 0x68,
                               0x7d, 0x90, 0xbb, 0xf9, 0x0,  0xb1, 0x4d, 0x2,  0x20, 0x1e,
                               0xa,  0x9a, 0x9f, 0x53, 0x4e, 0x59, 0xbc, 0x43, 0xc2, 0x23};
  uint8_t byteswillprops9[] = {0xd6, 0xfd, 0xcd, 0xcf, 0xfa, 0x9b, 0x9d, 0x94, 0xbe, 0xe2, 0x2f, 0x53, 0x9c,
                               0xdc, 0xeb, 0x71, 0xe9, 0x1a, 0x41, 0xb,  0xb4, 0x24, 0x1c, 0xdd, 0x1b, 0xa5};
  uint8_t byteswillprops10[] = {0x81, 0x9b, 0xc5, 0x7a, 0x50, 0xba, 0xe5, 0x9c, 0xb4, 0x84,
                                0x33, 0x1c, 0x29, 0x9c, 0xb3, 0xd5, 0x71, 0x3d, 0x2c, 0xa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16461}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14555}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1953}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5336}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13981}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13755}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20468}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {23, (char*)&byteswillprops6}, .v = {5, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14562}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 292}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&byteswillprops10}}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdc, 0xda, 0x89, 0xb3, 0x7a, 0x9e, 0xb,  0x63, 0x18, 0x80,
                                0x1a, 0x55, 0x13, 0xaf, 0x6e, 0xc9, 0x50, 0xda, 0x42};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xae, 0xe9, 0x3d, 0x97, 0x37, 0xcc, 0xcc, 0xb5, 0x9,  0x92, 0xb4,
                                  0x4f, 0xbd, 0xad, 0x2e, 0x60, 0xf4, 0x97, 0xb4, 0x49, 0x40, 0x30, 0xfc};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5227;
  uint8_t client_id_bytes[] = {0x5f, 0xc9, 0x32, 0xca, 0x3c, 0xa1, 0xab, 0xd1, 0xf4, 0xf1, 0xa5};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda, 0x72, 0xa8, 0x8b, 0x52, 0xd9, 0xd1, 0x7,  0x40, 0x87, 0xef,
                              0x87, 0x98, 0x82, 0x8c, 0x9c, 0xe6, 0x98, 0x3e, 0x9c, 0xa0};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SO\"\229\f\229\n\211x\145\nR\255A\196y\255<T[\149\ETX", _password = Just
// "\161'\241\171\&2\"q\170\165\139\233\248\156t\244\158\231\233\134qNC", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "GN\138U(\GS\230\SI+X!Tu\213\190", _willMsg = "-\254\177Q\138W", _willProps =
// [PropSessionExpiryInterval 14298,PropMaximumPacketSize 28032,PropUserProperty
// "\130\228p\243B\176GS\194M\237\161v\RSN\193\150\230\251/" "\220\213",PropRequestResponseInformation
// 202,PropWillDelayInterval 17757,PropRequestProblemInformation 133,PropWildcardSubscriptionAvailable
// 215,PropMessageExpiryInterval 17105,PropMaximumPacketSize 13584,PropRetainAvailable 95,PropTopicAliasMaximum
// 22665,PropContentType "\173\&4\143l/\230\227<2\249\251~*N.\163j\250$o<K$:\140",PropSubscriptionIdentifier 28]}),
// _cleanSession = True, _keepAlive = 2566, _connID = "E\SYN}\225:uRG\213%\205w\191zFd\151r\157\ACK\219", _properties =
// [PropPayloadFormatIndicator 98,PropCorrelationData "\183,\227/G\SOH\184c+",PropServerKeepAlive
// 13835,PropRetainAvailable 49,PropMaximumQoS 225,PropResponseInformation "1n<\132\DC1i\135j",PropResponseTopic
// "uU",PropContentType "\208\168\255<\226zf\247",PropAssignedClientIdentifier
// "_a\137\128\206!~\215LF8\229\215\130jk\165\147*Z\253\181",PropCorrelationData
// "$\211\167\253\230%+cP\208\132\145\237k\181q\232\176@\222\165q",PropAuthenticationData
// ":\204\139\198\141Rnmn]S\175\141\142\204\DC2)\133\200T\238\NAK\180-",PropReceiveMaximum 21997,PropMaximumQoS
// 87,PropContentType "\231O:\ETX\140",PropAuthenticationMethod "\250H\SOH\165\&9\DC3",PropMessageExpiryInterval
// 19719,PropAuthenticationMethod "\239\&1\231\a\165\183\n\196Z\247\132<if\142\149\r",PropRetainAvailable
// 239,PropServerReference "\185n\131\&6\217 \NUL>",PropAuthenticationMethod
// "\134\243\201\207\246x\240\RS\194P\GS\FSl\217\188\154\143\180\242$\139\197\173\210\233\b\179\134\138",PropResponseInformation
// "N#\153\&4OL\131\149y\145\216\&7"]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0xb1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0xa,  0x6,  0xe8, 0x1,  0x1,  0x62, 0x9,  0x0,
      0x9,  0xb7, 0x2c, 0xe3, 0x2f, 0x47, 0x1,  0xb8, 0x63, 0x2b, 0x13, 0x36, 0xb,  0x25, 0x31, 0x24, 0xe1, 0x1a, 0x0,
      0x8,  0x31, 0x6e, 0x3c, 0x84, 0x11, 0x69, 0x87, 0x6a, 0x8,  0x0,  0x2,  0x75, 0x55, 0x3,  0x0,  0x8,  0xd0, 0xa8,
      0xff, 0x3c, 0xe2, 0x7a, 0x66, 0xf7, 0x12, 0x0,  0x16, 0x5f, 0x61, 0x89, 0x80, 0xce, 0x21, 0x7e, 0xd7, 0x4c, 0x46,
      0x38, 0xe5, 0xd7, 0x82, 0x6a, 0x6b, 0xa5, 0x93, 0x2a, 0x5a, 0xfd, 0xb5, 0x9,  0x0,  0x16, 0x24, 0xd3, 0xa7, 0xfd,
      0xe6, 0x25, 0x2b, 0x63, 0x50, 0xd0, 0x84, 0x91, 0xed, 0x6b, 0xb5, 0x71, 0xe8, 0xb0, 0x40, 0xde, 0xa5, 0x71, 0x16,
      0x0,  0x18, 0x3a, 0xcc, 0x8b, 0xc6, 0x8d, 0x52, 0x6e, 0x6d, 0x6e, 0x5d, 0x53, 0xaf, 0x8d, 0x8e, 0xcc, 0x12, 0x29,
      0x85, 0xc8, 0x54, 0xee, 0x15, 0xb4, 0x2d, 0x21, 0x55, 0xed, 0x24, 0x57, 0x3,  0x0,  0x5,  0xe7, 0x4f, 0x3a, 0x3,
      0x8c, 0x15, 0x0,  0x6,  0xfa, 0x48, 0x1,  0xa5, 0x39, 0x13, 0x2,  0x0,  0x0,  0x4d, 0x7,  0x15, 0x0,  0x11, 0xef,
      0x31, 0xe7, 0x7,  0xa5, 0xb7, 0xa,  0xc4, 0x5a, 0xf7, 0x84, 0x3c, 0x69, 0x66, 0x8e, 0x95, 0xd,  0x25, 0xef, 0x1c,
      0x0,  0x8,  0xb9, 0x6e, 0x83, 0x36, 0xd9, 0x20, 0x0,  0x3e, 0x15, 0x0,  0x1d, 0x86, 0xf3, 0xc9, 0xcf, 0xf6, 0x78,
      0xf0, 0x1e, 0xc2, 0x50, 0x1d, 0x1c, 0x6c, 0xd9, 0xbc, 0x9a, 0x8f, 0xb4, 0xf2, 0x24, 0x8b, 0xc5, 0xad, 0xd2, 0xe9,
      0x8,  0xb3, 0x86, 0x8a, 0x1a, 0x0,  0xc,  0x4e, 0x23, 0x99, 0x34, 0x4f, 0x4c, 0x83, 0x95, 0x79, 0x91, 0xd8, 0x37,
      0x0,  0x15, 0x45, 0x16, 0x7d, 0xe1, 0x3a, 0x75, 0x52, 0x47, 0xd5, 0x25, 0xcd, 0x77, 0xbf, 0x7a, 0x46, 0x64, 0x97,
      0x72, 0x9d, 0x6,  0xdb, 0x5d, 0x11, 0x0,  0x0,  0x37, 0xda, 0x27, 0x0,  0x0,  0x6d, 0x80, 0x26, 0x0,  0x14, 0x82,
      0xe4, 0x70, 0xf3, 0x42, 0xb0, 0x47, 0x53, 0xc2, 0x4d, 0xed, 0xa1, 0x76, 0x1e, 0x4e, 0xc1, 0x96, 0xe6, 0xfb, 0x2f,
      0x0,  0x2,  0xdc, 0xd5, 0x19, 0xca, 0x18, 0x0,  0x0,  0x45, 0x5d, 0x17, 0x85, 0x28, 0xd7, 0x2,  0x0,  0x0,  0x42,
      0xd1, 0x27, 0x0,  0x0,  0x35, 0x10, 0x25, 0x5f, 0x22, 0x58, 0x89, 0x3,  0x0,  0x19, 0xad, 0x34, 0x8f, 0x6c, 0x2f,
      0xe6, 0xe3, 0x3c, 0x32, 0xf9, 0xfb, 0x7e, 0x2a, 0x4e, 0x2e, 0xa3, 0x6a, 0xfa, 0x24, 0x6f, 0x3c, 0x4b, 0x24, 0x3a,
      0x8c, 0xb,  0x1c, 0x0,  0xf,  0x47, 0x4e, 0x8a, 0x55, 0x28, 0x1d, 0xe6, 0xf,  0x2b, 0x58, 0x21, 0x54, 0x75, 0xd5,
      0xbe, 0x0,  0x6,  0x2d, 0xfe, 0xb1, 0x51, 0x8a, 0x57, 0x0,  0x15, 0xe,  0x22, 0xe5, 0xc,  0xe5, 0xa,  0xd3, 0x78,
      0x91, 0xa,  0x52, 0xff, 0x41, 0xc4, 0x79, 0xff, 0x3c, 0x54, 0x5b, 0x95, 0x3,  0x0,  0x16, 0xa1, 0x27, 0xf1, 0xab,
      0x32, 0x22, 0x71, 0xaa, 0xa5, 0x8b, 0xe9, 0xf8, 0x9c, 0x74, 0xf4, 0x9e, 0xe7, 0xe9, 0x86, 0x71, 0x4e, 0x43};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb7, 0x2c, 0xe3, 0x2f, 0x47, 0x1, 0xb8, 0x63, 0x2b};
  uint8_t bytesprops1[] = {0x31, 0x6e, 0x3c, 0x84, 0x11, 0x69, 0x87, 0x6a};
  uint8_t bytesprops2[] = {0x75, 0x55};
  uint8_t bytesprops3[] = {0xd0, 0xa8, 0xff, 0x3c, 0xe2, 0x7a, 0x66, 0xf7};
  uint8_t bytesprops4[] = {0x5f, 0x61, 0x89, 0x80, 0xce, 0x21, 0x7e, 0xd7, 0x4c, 0x46, 0x38,
                           0xe5, 0xd7, 0x82, 0x6a, 0x6b, 0xa5, 0x93, 0x2a, 0x5a, 0xfd, 0xb5};
  uint8_t bytesprops5[] = {0x24, 0xd3, 0xa7, 0xfd, 0xe6, 0x25, 0x2b, 0x63, 0x50, 0xd0, 0x84,
                           0x91, 0xed, 0x6b, 0xb5, 0x71, 0xe8, 0xb0, 0x40, 0xde, 0xa5, 0x71};
  uint8_t bytesprops6[] = {0x3a, 0xcc, 0x8b, 0xc6, 0x8d, 0x52, 0x6e, 0x6d, 0x6e, 0x5d, 0x53, 0xaf,
                           0x8d, 0x8e, 0xcc, 0x12, 0x29, 0x85, 0xc8, 0x54, 0xee, 0x15, 0xb4, 0x2d};
  uint8_t bytesprops7[] = {0xe7, 0x4f, 0x3a, 0x3, 0x8c};
  uint8_t bytesprops8[] = {0xfa, 0x48, 0x1, 0xa5, 0x39, 0x13};
  uint8_t bytesprops9[] = {0xef, 0x31, 0xe7, 0x7,  0xa5, 0xb7, 0xa,  0xc4, 0x5a,
                           0xf7, 0x84, 0x3c, 0x69, 0x66, 0x8e, 0x95, 0xd};
  uint8_t bytesprops10[] = {0xb9, 0x6e, 0x83, 0x36, 0xd9, 0x20, 0x0, 0x3e};
  uint8_t bytesprops11[] = {0x86, 0xf3, 0xc9, 0xcf, 0xf6, 0x78, 0xf0, 0x1e, 0xc2, 0x50, 0x1d, 0x1c, 0x6c, 0xd9, 0xbc,
                            0x9a, 0x8f, 0xb4, 0xf2, 0x24, 0x8b, 0xc5, 0xad, 0xd2, 0xe9, 0x8,  0xb3, 0x86, 0x8a};
  uint8_t bytesprops12[] = {0x4e, 0x23, 0x99, 0x34, 0x4f, 0x4c, 0x83, 0x95, 0x79, 0x91, 0xd8, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13835}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21997}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19719}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xdc, 0xd5};
  uint8_t byteswillprops0[] = {0x82, 0xe4, 0x70, 0xf3, 0x42, 0xb0, 0x47, 0x53, 0xc2, 0x4d,
                               0xed, 0xa1, 0x76, 0x1e, 0x4e, 0xc1, 0x96, 0xe6, 0xfb, 0x2f};
  uint8_t byteswillprops2[] = {0xad, 0x34, 0x8f, 0x6c, 0x2f, 0xe6, 0xe3, 0x3c, 0x32, 0xf9, 0xfb, 0x7e, 0x2a,
                               0x4e, 0x2e, 0xa3, 0x6a, 0xfa, 0x24, 0x6f, 0x3c, 0x4b, 0x24, 0x3a, 0x8c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14298}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28032}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops0}, .v = {2, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17757}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17105}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13584}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22665}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x4e, 0x8a, 0x55, 0x28, 0x1d, 0xe6, 0xf,
                                0x2b, 0x58, 0x21, 0x54, 0x75, 0xd5, 0xbe};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2d, 0xfe, 0xb1, 0x51, 0x8a, 0x57};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2566;
  uint8_t client_id_bytes[] = {0x45, 0x16, 0x7d, 0xe1, 0x3a, 0x75, 0x52, 0x47, 0xd5, 0x25, 0xcd,
                               0x77, 0xbf, 0x7a, 0x46, 0x64, 0x97, 0x72, 0x9d, 0x6,  0xdb};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe,  0x22, 0xe5, 0xc,  0xe5, 0xa,  0xd3, 0x78, 0x91, 0xa, 0x52,
                              0xff, 0x41, 0xc4, 0x79, 0xff, 0x3c, 0x54, 0x5b, 0x95, 0x3};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa1, 0x27, 0xf1, 0xab, 0x32, 0x22, 0x71, 0xaa, 0xa5, 0x8b, 0xe9,
                              0xf8, 0x9c, 0x74, 0xf4, 0x9e, 0xe7, 0xe9, 0x86, 0x71, 0x4e, 0x43};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152\221\234q\203G\217\fNt\228\210\150\136\182i)\202\138\152\231\173\145\214",
// _password = Just "'\180\139\198S@\216", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic
// = "8c-\209\158\&6\143C\DC4\218\154\186y\201\RS\157N\158z\179p!i\176B\133]\193\202\DC1", _willMsg =
// "\161kV;\231\200\136\195\SI", _willProps = [PropTopicAliasMaximum 7867,PropContentType
// "\131\192\204\245\195\230\148\171g\163\197Jbk[S",PropServerReference
// "n\165\CAN`\132\210\194\f\"G\f\239",PropWillDelayInterval 20782,PropUserProperty
// "\FS`\208\217}+g\aC2=\210l\r\ENQ\218\241\EOT\129b\SOH\198\143\&6"
// "\248\227\174{\166\130\133a\DC4\203",PropRetainAvailable 100]}), _cleanSession = True, _keepAlive = 23001, _connID =
// "O\245i\ESC", _properties = [PropServerReference "\180\SOH)",PropReceiveMaximum 29954,PropMessageExpiryInterval
// 22203,PropRequestProblemInformation 106,PropSessionExpiryInterval 18514,PropWillDelayInterval
// 23155,PropRequestResponseInformation 130,PropWildcardSubscriptionAvailable 7]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0xd1, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x59, 0xd9, 0x1e, 0x1c, 0x0,  0x3,
                   0xb4, 0x1,  0x29, 0x21, 0x75, 0x2,  0x2,  0x0,  0x0,  0x56, 0xbb, 0x17, 0x6a, 0x11, 0x0,  0x0,  0x48,
                   0x52, 0x18, 0x0,  0x0,  0x5a, 0x73, 0x19, 0x82, 0x28, 0x7,  0x0,  0x4,  0x4f, 0xf5, 0x69, 0x1b, 0x53,
                   0x22, 0x1e, 0xbb, 0x3,  0x0,  0x10, 0x83, 0xc0, 0xcc, 0xf5, 0xc3, 0xe6, 0x94, 0xab, 0x67, 0xa3, 0xc5,
                   0x4a, 0x62, 0x6b, 0x5b, 0x53, 0x1c, 0x0,  0xc,  0x6e, 0xa5, 0x18, 0x60, 0x84, 0xd2, 0xc2, 0xc,  0x22,
                   0x47, 0xc,  0xef, 0x18, 0x0,  0x0,  0x51, 0x2e, 0x26, 0x0,  0x18, 0x1c, 0x60, 0xd0, 0xd9, 0x7d, 0x2b,
                   0x67, 0x7,  0x43, 0x32, 0x3d, 0xd2, 0x6c, 0xd,  0x5,  0xda, 0xf1, 0x4,  0x81, 0x62, 0x1,  0xc6, 0x8f,
                   0x36, 0x0,  0xa,  0xf8, 0xe3, 0xae, 0x7b, 0xa6, 0x82, 0x85, 0x61, 0x14, 0xcb, 0x25, 0x64, 0x0,  0x1e,
                   0x38, 0x63, 0x2d, 0xd1, 0x9e, 0x36, 0x8f, 0x43, 0x14, 0xda, 0x9a, 0xba, 0x79, 0xc9, 0x1e, 0x9d, 0x4e,
                   0x9e, 0x7a, 0xb3, 0x70, 0x21, 0x69, 0xb0, 0x42, 0x85, 0x5d, 0xc1, 0xca, 0x11, 0x0,  0x9,  0xa1, 0x6b,
                   0x56, 0x3b, 0xe7, 0xc8, 0x88, 0xc3, 0xf,  0x0,  0x18, 0x98, 0xdd, 0xea, 0x71, 0xcb, 0x47, 0xd9, 0xc,
                   0x4e, 0x74, 0xe4, 0xd2, 0x96, 0x88, 0xb6, 0x69, 0x29, 0xca, 0x8a, 0x98, 0xe7, 0xad, 0x91, 0xd6, 0x0,
                   0x7,  0x27, 0xb4, 0x8b, 0xc6, 0x53, 0x40, 0xd8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb4, 0x1, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29954}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22203}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18514}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23155}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x83, 0xc0, 0xcc, 0xf5, 0xc3, 0xe6, 0x94, 0xab,
                               0x67, 0xa3, 0xc5, 0x4a, 0x62, 0x6b, 0x5b, 0x53};
  uint8_t byteswillprops1[] = {0x6e, 0xa5, 0x18, 0x60, 0x84, 0xd2, 0xc2, 0xc, 0x22, 0x47, 0xc, 0xef};
  uint8_t byteswillprops3[] = {0xf8, 0xe3, 0xae, 0x7b, 0xa6, 0x82, 0x85, 0x61, 0x14, 0xcb};
  uint8_t byteswillprops2[] = {0x1c, 0x60, 0xd0, 0xd9, 0x7d, 0x2b, 0x67, 0x7,  0x43, 0x32, 0x3d, 0xd2,
                               0x6c, 0xd,  0x5,  0xda, 0xf1, 0x4,  0x81, 0x62, 0x1,  0xc6, 0x8f, 0x36};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7867}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20782}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {24, (char*)&byteswillprops2}, .v = {10, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 100}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x63, 0x2d, 0xd1, 0x9e, 0x36, 0x8f, 0x43, 0x14, 0xda,
                                0x9a, 0xba, 0x79, 0xc9, 0x1e, 0x9d, 0x4e, 0x9e, 0x7a, 0xb3,
                                0x70, 0x21, 0x69, 0xb0, 0x42, 0x85, 0x5d, 0xc1, 0xca, 0x11};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa1, 0x6b, 0x56, 0x3b, 0xe7, 0xc8, 0x88, 0xc3, 0xf};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23001;
  uint8_t client_id_bytes[] = {0x4f, 0xf5, 0x69, 0x1b};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98, 0xdd, 0xea, 0x71, 0xcb, 0x47, 0xd9, 0xc,  0x4e, 0x74, 0xe4, 0xd2,
                              0x96, 0x88, 0xb6, 0x69, 0x29, 0xca, 0x8a, 0x98, 0xe7, 0xad, 0x91, 0xd6};
  lwmqtt_string_t username = {24, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x27, 0xb4, 0x8b, 0xc6, 0x53, 0x40, 0xd8};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5047 [("H\129E$_\201\142?\214\245~\170",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\EOT\171",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("|\130\163TL\202",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\147^\181B\US12\255U",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\185\DC1\142\241\ENQ\"\ETX",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\139\130\222\tW\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x3e, 0x13, 0xb7, 0x0,  0xc,  0x48, 0x81, 0x45, 0x24, 0x5f, 0xc9, 0x8e, 0x3f, 0xd6, 0xf5,
                   0x7e, 0xaa, 0x2,  0x0,  0x2,  0x4,  0xab, 0x0,  0x0,  0x6,  0x7c, 0x82, 0xa3, 0x54, 0x4c, 0xca,
                   0x1,  0x0,  0x9,  0x93, 0x5e, 0xb5, 0x42, 0x1f, 0x31, 0x32, 0xff, 0x55, 0x2,  0x0,  0x7,  0xb9,
                   0x11, 0x8e, 0xf1, 0x5,  0x22, 0x3,  0x0,  0x0,  0x6,  0x8b, 0x82, 0xde, 0x9,  0x57, 0xf,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x48, 0x81, 0x45, 0x24, 0x5f, 0xc9, 0x8e, 0x3f, 0xd6, 0xf5, 0x7e, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4, 0xab};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7c, 0x82, 0xa3, 0x54, 0x4c, 0xca};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0x5e, 0xb5, 0x42, 0x1f, 0x31, 0x32, 0xff, 0x55};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb9, 0x11, 0x8e, 0xf1, 0x5, 0x22, 0x3};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8b, 0x82, 0xde, 0x9, 0x57, 0xf};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5047, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3206 [("\DC12^",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("\184\136",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("$\217\231uJ\220\&4\205\163\&2\171'\203P\ESC\252\228\SOH\202",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x23, 0xc,  0x86, 0x0,  0x3,  0x11, 0x32, 0x5e, 0x1,  0x0,  0x2,  0xb8,
                   0x88, 0x1,  0x0,  0x13, 0x24, 0xd9, 0xe7, 0x75, 0x4a, 0xdc, 0x34, 0xcd, 0xa3,
                   0x32, 0xab, 0x27, 0xcb, 0x50, 0x1b, 0xfc, 0xe4, 0x1,  0xca, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0x32, 0x5e};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb8, 0x88};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x24, 0xd9, 0xe7, 0x75, 0x4a, 0xdc, 0x34, 0xcd, 0xa3, 0x32,
                                     0xab, 0x27, 0xcb, 0x50, 0x1b, 0xfc, 0xe4, 0x1,  0xca};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3206, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13602 [("\183z",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2}),("1\166\179}\189\167\248\176&\209\EMo\162",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("`\230^\177X\132'\DLE}\211",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("4\242",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS
// = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x29, 0x35, 0x22, 0x0,  0x2,  0xb7, 0x7a, 0x2,  0x0, 0xd,  0x31, 0xa6, 0xb3, 0x7d,
                   0xbd, 0xa7, 0xf8, 0xb0, 0x26, 0xd1, 0x19, 0x6f, 0xa2, 0x1, 0x0,  0xa,  0x60, 0xe6, 0x5e,
                   0xb1, 0x58, 0x84, 0x27, 0x10, 0x7d, 0xd3, 0x2,  0x0,  0x2, 0x34, 0xf2, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x7a};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x31, 0xa6, 0xb3, 0x7d, 0xbd, 0xa7, 0xf8, 0xb0, 0x26, 0xd1, 0x19, 0x6f, 0xa2};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x60, 0xe6, 0x5e, 0xb1, 0x58, 0x84, 0x27, 0x10, 0x7d, 0xd3};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0xf2};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13602, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14384 [("\FS\128\241\248\208\137C~(\163%\158w",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("5X8\205\211\235pK\ETBW@\NUL:\138\244U\176\143\vel\244x_\255\153",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("r^\143\162\178\168\192\172\141.\SI\245\a\221\ETBN\254w\DC4\141\EMJ\141)3\194\246",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\t",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\144\194A\232\SOH\155\ESCL\\\214\&8\169\DC2\239\173\&0\DC4P:&",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("i\129\v\240\205@PA/",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("A!\225\138=",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\169\193\&8B\138\143\CAN~=\150\240\216U\168\DLECx\DEL(\245\135\&1G|1\144F",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x9a, 0x1,  0x38, 0x30, 0x0,  0xd,  0x1c, 0x80, 0xf1, 0xf8, 0xd0, 0x89, 0x43, 0x7e, 0x28,
                   0xa3, 0x25, 0x9e, 0x77, 0x1,  0x0,  0x1a, 0x35, 0x58, 0x38, 0xcd, 0xd3, 0xeb, 0x70, 0x4b, 0x17,
                   0x57, 0x40, 0x0,  0x3a, 0x8a, 0xf4, 0x55, 0xb0, 0x8f, 0xb,  0x65, 0x6c, 0xf4, 0x78, 0x5f, 0xff,
                   0x99, 0x1,  0x0,  0x1b, 0x72, 0x5e, 0x8f, 0xa2, 0xb2, 0xa8, 0xc0, 0xac, 0x8d, 0x2e, 0xf,  0xf5,
                   0x7,  0xdd, 0x17, 0x4e, 0xfe, 0x77, 0x14, 0x8d, 0x19, 0x4a, 0x8d, 0x29, 0x33, 0xc2, 0xf6, 0x2,
                   0x0,  0x1,  0x9,  0x2,  0x0,  0x14, 0x90, 0xc2, 0x41, 0xe8, 0x1,  0x9b, 0x1b, 0x4c, 0x5c, 0xd6,
                   0x38, 0xa9, 0x12, 0xef, 0xad, 0x30, 0x14, 0x50, 0x3a, 0x26, 0x1,  0x0,  0x9,  0x69, 0x81, 0xb,
                   0xf0, 0xcd, 0x40, 0x50, 0x41, 0x2f, 0x1,  0x0,  0x5,  0x41, 0x21, 0xe1, 0x8a, 0x3d, 0x1,  0x0,
                   0x1b, 0xa9, 0xc1, 0x38, 0x42, 0x8a, 0x8f, 0x18, 0x7e, 0x3d, 0x96, 0xf0, 0xd8, 0x55, 0xa8, 0x10,
                   0x43, 0x78, 0x7f, 0x28, 0xf5, 0x87, 0x31, 0x47, 0x7c, 0x31, 0x90, 0x46, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0x80, 0xf1, 0xf8, 0xd0, 0x89, 0x43, 0x7e, 0x28, 0xa3, 0x25, 0x9e, 0x77};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0x58, 0x38, 0xcd, 0xd3, 0xeb, 0x70, 0x4b, 0x17, 0x57, 0x40, 0x0,  0x3a,
                                     0x8a, 0xf4, 0x55, 0xb0, 0x8f, 0xb,  0x65, 0x6c, 0xf4, 0x78, 0x5f, 0xff, 0x99};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x72, 0x5e, 0x8f, 0xa2, 0xb2, 0xa8, 0xc0, 0xac, 0x8d, 0x2e, 0xf,  0xf5, 0x7, 0xdd,
                                     0x17, 0x4e, 0xfe, 0x77, 0x14, 0x8d, 0x19, 0x4a, 0x8d, 0x29, 0x33, 0xc2, 0xf6};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x90, 0xc2, 0x41, 0xe8, 0x1,  0x9b, 0x1b, 0x4c, 0x5c, 0xd6,
                                     0x38, 0xa9, 0x12, 0xef, 0xad, 0x30, 0x14, 0x50, 0x3a, 0x26};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0x81, 0xb, 0xf0, 0xcd, 0x40, 0x50, 0x41, 0x2f};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x21, 0xe1, 0x8a, 0x3d};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa9, 0xc1, 0x38, 0x42, 0x8a, 0x8f, 0x18, 0x7e, 0x3d, 0x96, 0xf0, 0xd8, 0x55, 0xa8,
                                     0x10, 0x43, 0x78, 0x7f, 0x28, 0xf5, 0x87, 0x31, 0x47, 0x7c, 0x31, 0x90, 0x46};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14384, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10952 [("\189\131\143u\249\178\237\221\225\135\200_E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\138:\130%\226\132\219i%\244x~=X\220\GS\224\244\133\144\194O\240\154",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\184*~\237,+2\155\&2P\221\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\172\&6\205I;\188o",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("-\ETB\193\208",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ENQ\r\210U\140\DC2\148\199\188\163\197]",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("yr \203n\154\&6\197\134\218xJ\DC4\144",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("8Y\218Q\175\&2",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x76, 0x2a, 0xc8, 0x0,  0xd,  0xbd, 0x83, 0x8f, 0x75, 0xf9, 0xb2, 0xed, 0xdd, 0xe1,
                   0x87, 0xc8, 0x5f, 0x45, 0x2,  0x0,  0x18, 0x8a, 0x3a, 0x82, 0x25, 0xe2, 0x84, 0xdb, 0x69,
                   0x25, 0xf4, 0x78, 0x7e, 0x3d, 0x58, 0xdc, 0x1d, 0xe0, 0xf4, 0x85, 0x90, 0xc2, 0x4f, 0xf0,
                   0x9a, 0x1,  0x0,  0xc,  0xb8, 0x2a, 0x7e, 0xed, 0x2c, 0x2b, 0x32, 0x9b, 0x32, 0x50, 0xdd,
                   0xc5, 0x0,  0x0,  0x7,  0xac, 0x36, 0xcd, 0x49, 0x3b, 0xbc, 0x6f, 0x2,  0x0,  0x4,  0x2d,
                   0x17, 0xc1, 0xd0, 0x1,  0x0,  0xc,  0x5,  0xd,  0xd2, 0x55, 0x8c, 0x12, 0x94, 0xc7, 0xbc,
                   0xa3, 0xc5, 0x5d, 0x1,  0x0,  0xe,  0x79, 0x72, 0x20, 0xcb, 0x6e, 0x9a, 0x36, 0xc5, 0x86,
                   0xda, 0x78, 0x4a, 0x14, 0x90, 0x1,  0x0,  0x6,  0x38, 0x59, 0xda, 0x51, 0xaf, 0x32, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xbd, 0x83, 0x8f, 0x75, 0xf9, 0xb2, 0xed, 0xdd, 0xe1, 0x87, 0xc8, 0x5f, 0x45};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8a, 0x3a, 0x82, 0x25, 0xe2, 0x84, 0xdb, 0x69, 0x25, 0xf4, 0x78, 0x7e,
                                     0x3d, 0x58, 0xdc, 0x1d, 0xe0, 0xf4, 0x85, 0x90, 0xc2, 0x4f, 0xf0, 0x9a};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb8, 0x2a, 0x7e, 0xed, 0x2c, 0x2b, 0x32, 0x9b, 0x32, 0x50, 0xdd, 0xc5};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xac, 0x36, 0xcd, 0x49, 0x3b, 0xbc, 0x6f};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2d, 0x17, 0xc1, 0xd0};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5, 0xd, 0xd2, 0x55, 0x8c, 0x12, 0x94, 0xc7, 0xbc, 0xa3, 0xc5, 0x5d};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x79, 0x72, 0x20, 0xcb, 0x6e, 0x9a, 0x36,
                                     0xc5, 0x86, 0xda, 0x78, 0x4a, 0x14, 0x90};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x38, 0x59, 0xda, 0x51, 0xaf, 0x32};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10952, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20143
// [("N\178\188\208\255\162\DEL;\181\212\177\147\234\168\234)\194x\206K)\DC1\247\191\&4f\155",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\f\163<Q_'\138_Bk2\219\197\237",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("Y\216yn2*\204\190",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("p_3}{5\172\184\FS\149\167\144\239fI\246@RL\220*\197L/N\217A\183\210",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\214L\190\SO\210\190\221VLW\157\159\167|@\167\&0<\t\230\SOM\DC3r\187\218\238",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x7e, 0x4e, 0xaf, 0x0,  0x1b, 0x4e, 0xb2, 0xbc, 0xd0, 0xff, 0xa2, 0x7f, 0x3b, 0xb5, 0xd4,
                   0xb1, 0x93, 0xea, 0xa8, 0xea, 0x29, 0xc2, 0x78, 0xce, 0x4b, 0x29, 0x11, 0xf7, 0xbf, 0x34, 0x66,
                   0x9b, 0x2,  0x0,  0xe,  0xc,  0xa3, 0x3c, 0x51, 0x5f, 0x27, 0x8a, 0x5f, 0x42, 0x6b, 0x32, 0xdb,
                   0xc5, 0xed, 0x2,  0x0,  0x8,  0x59, 0xd8, 0x79, 0x6e, 0x32, 0x2a, 0xcc, 0xbe, 0x0,  0x0,  0x1,
                   0x28, 0x0,  0x0,  0x1d, 0x70, 0x5f, 0x33, 0x7d, 0x7b, 0x35, 0xac, 0xb8, 0x1c, 0x95, 0xa7, 0x90,
                   0xef, 0x66, 0x49, 0xf6, 0x40, 0x52, 0x4c, 0xdc, 0x2a, 0xc5, 0x4c, 0x2f, 0x4e, 0xd9, 0x41, 0xb7,
                   0xd2, 0x1,  0x0,  0x1b, 0xd6, 0x4c, 0xbe, 0xe,  0xd2, 0xbe, 0xdd, 0x56, 0x4c, 0x57, 0x9d, 0x9f,
                   0xa7, 0x7c, 0x40, 0xa7, 0x30, 0x3c, 0x9,  0xe6, 0xe,  0x4d, 0x13, 0x72, 0xbb, 0xda, 0xee, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4e, 0xb2, 0xbc, 0xd0, 0xff, 0xa2, 0x7f, 0x3b, 0xb5, 0xd4, 0xb1, 0x93, 0xea, 0xa8,
                                     0xea, 0x29, 0xc2, 0x78, 0xce, 0x4b, 0x29, 0x11, 0xf7, 0xbf, 0x34, 0x66, 0x9b};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc, 0xa3, 0x3c, 0x51, 0x5f, 0x27, 0x8a, 0x5f, 0x42, 0x6b, 0x32, 0xdb, 0xc5, 0xed};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x59, 0xd8, 0x79, 0x6e, 0x32, 0x2a, 0xcc, 0xbe};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x28};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x70, 0x5f, 0x33, 0x7d, 0x7b, 0x35, 0xac, 0xb8, 0x1c, 0x95,
                                     0xa7, 0x90, 0xef, 0x66, 0x49, 0xf6, 0x40, 0x52, 0x4c, 0xdc,
                                     0x2a, 0xc5, 0x4c, 0x2f, 0x4e, 0xd9, 0x41, 0xb7, 0xd2};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd6, 0x4c, 0xbe, 0xe,  0xd2, 0xbe, 0xdd, 0x56, 0x4c, 0x57, 0x9d, 0x9f, 0xa7, 0x7c,
                                     0x40, 0xa7, 0x30, 0x3c, 0x9,  0xe6, 0xe,  0x4d, 0x13, 0x72, 0xbb, 0xda, 0xee};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20143, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3461 [(".J\171\DEL\160\194\225\225\175\215,B\140X\DC1\n`R\184j\164ZB\ENQ",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248a\225\201p\DC1\181Fv\210\218\SO\224\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("F\239\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\183.\246y\164\162\208y\STX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\202\130\192\137\231\STX\164\EM\195z\168#Tej\129O>kO\229g",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\255\175\ENQ\139\179%\241\252\148^\228T\243\DLE",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\DEL\152",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\ACK\168&\158\RS\EM(\144%\ACKy\f\185=\229\161\139\170\SOH",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\RSMD\EM\154\220\162\b\165\174\174Z\246\DLE$\b\193",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0xd,  0x85, 0x0,  0x18, 0x2e, 0x4a, 0xab, 0x7f, 0xa0, 0xc2, 0xe1, 0xe1, 0xaf,
                   0xd7, 0x2c, 0x42, 0x8c, 0x58, 0x11, 0xa,  0x60, 0x52, 0xb8, 0x6a, 0xa4, 0x5a, 0x42, 0x5,  0x2,
                   0x0,  0xe,  0xf8, 0x61, 0xe1, 0xc9, 0x70, 0x11, 0xb5, 0x46, 0x76, 0xd2, 0xda, 0xe,  0xe0, 0x1a,
                   0x1,  0x0,  0x3,  0x46, 0xef, 0xa0, 0x0,  0x0,  0x9,  0xb7, 0x2e, 0xf6, 0x79, 0xa4, 0xa2, 0xd0,
                   0x79, 0x2,  0x0,  0x0,  0x16, 0xca, 0x82, 0xc0, 0x89, 0xe7, 0x2,  0xa4, 0x19, 0xc3, 0x7a, 0xa8,
                   0x23, 0x54, 0x65, 0x6a, 0x81, 0x4f, 0x3e, 0x6b, 0x4f, 0xe5, 0x67, 0x0,  0x0,  0xf,  0x2c, 0xff,
                   0xaf, 0x5,  0x8b, 0xb3, 0x25, 0xf1, 0xfc, 0x94, 0x5e, 0xe4, 0x54, 0xf3, 0x10, 0x2,  0x0,  0x2,
                   0x7f, 0x98, 0x1,  0x0,  0x0,  0x0,  0x0,  0x13, 0x6,  0xa8, 0x26, 0x9e, 0x1e, 0x19, 0x28, 0x90,
                   0x25, 0x6,  0x79, 0xc,  0xb9, 0x3d, 0xe5, 0xa1, 0x8b, 0xaa, 0x1,  0x0,  0x0,  0x11, 0x1e, 0x4d,
                   0x44, 0x19, 0x9a, 0xdc, 0xa2, 0x8,  0xa5, 0xae, 0xae, 0x5a, 0xf6, 0x10, 0x24, 0x8,  0xc1, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x2e, 0x4a, 0xab, 0x7f, 0xa0, 0xc2, 0xe1, 0xe1, 0xaf, 0xd7, 0x2c, 0x42,
                                     0x8c, 0x58, 0x11, 0xa,  0x60, 0x52, 0xb8, 0x6a, 0xa4, 0x5a, 0x42, 0x5};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0x61, 0xe1, 0xc9, 0x70, 0x11, 0xb5, 0x46, 0x76, 0xd2, 0xda, 0xe, 0xe0, 0x1a};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0xef, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb7, 0x2e, 0xf6, 0x79, 0xa4, 0xa2, 0xd0, 0x79, 0x2};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xca, 0x82, 0xc0, 0x89, 0xe7, 0x2,  0xa4, 0x19, 0xc3, 0x7a, 0xa8,
                                     0x23, 0x54, 0x65, 0x6a, 0x81, 0x4f, 0x3e, 0x6b, 0x4f, 0xe5, 0x67};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2c, 0xff, 0xaf, 0x5,  0x8b, 0xb3, 0x25, 0xf1,
                                     0xfc, 0x94, 0x5e, 0xe4, 0x54, 0xf3, 0x10};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x7f, 0x98};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x6,  0xa8, 0x26, 0x9e, 0x1e, 0x19, 0x28, 0x90, 0x25, 0x6,
                                     0x79, 0xc,  0xb9, 0x3d, 0xe5, 0xa1, 0x8b, 0xaa, 0x1};
  lwmqtt_string_t topic_filter_s8 = {19, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1e, 0x4d, 0x44, 0x19, 0x9a, 0xdc, 0xa2, 0x8, 0xa5,
                                     0xae, 0xae, 0x5a, 0xf6, 0x10, 0x24, 0x8,  0xc1};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3461, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24628 [("J$\202\SOH\164s\193\241\FS\196\170\186\133\233\147!bV\164\233m\185\177wW",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Pu\230B\171\159)-\n\236\132r\193f\179`H\140\168\r&\ESC\241\173\219\190",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x3b, 0x60, 0x34, 0x0,  0x19, 0x4a, 0x24, 0xca, 0x1,  0xa4, 0x73, 0xc1, 0xf1, 0x1c, 0xc4,
                   0xaa, 0xba, 0x85, 0xe9, 0x93, 0x21, 0x62, 0x56, 0xa4, 0xe9, 0x6d, 0xb9, 0xb1, 0x77, 0x57, 0x2,
                   0x0,  0x1a, 0x50, 0x75, 0xe6, 0x42, 0xab, 0x9f, 0x29, 0x2d, 0xa,  0xec, 0x84, 0x72, 0xc1, 0x66,
                   0xb3, 0x60, 0x48, 0x8c, 0xa8, 0xd,  0x26, 0x1b, 0xf1, 0xad, 0xdb, 0xbe, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0x24, 0xca, 0x1,  0xa4, 0x73, 0xc1, 0xf1, 0x1c, 0xc4, 0xaa, 0xba, 0x85,
                                     0xe9, 0x93, 0x21, 0x62, 0x56, 0xa4, 0xe9, 0x6d, 0xb9, 0xb1, 0x77, 0x57};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x50, 0x75, 0xe6, 0x42, 0xab, 0x9f, 0x29, 0x2d, 0xa,  0xec, 0x84, 0x72, 0xc1,
                                     0x66, 0xb3, 0x60, 0x48, 0x8c, 0xa8, 0xd,  0x26, 0x1b, 0xf1, 0xad, 0xdb, 0xbe};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24628, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27288 [("\217\135\214\SIKL\f\214\225\208\141\236\194:4\212\162{\DLE\CAN",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\203\193<\223\198\148=\252\DC3=x\192\203\215\231\&2\211",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("-.N5P\STXC\CAN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\147\DLE\210K\RS,n\142:0O\217",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\STXs\187\214l$s\164\&9O\a\137M\132\197\"\151\179\229,\193\188^\173",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\252\138+\n\175\ETX\235\\s\224\216\249m\228WJ\fy\195\226\195#\182\139\215",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\143\237,\176$\130\243/\DLE\DEL\156\226\192\193I%D7a\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\160}\178\229\154'\175?\176I\167Y\243r+\148\192\&4\186X:\192\247r\246\132",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DC4\128\162\SO\152]\188\DC1\184\174M\136\DC4\203\235\164\203\ACK\136\208\255N\133\250\173",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("?'h\n\240j\b\244;\129\DEL\203\169\ENQ\149\140\131\168h\137$",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xe6, 0x1,  0x6a, 0x98, 0x0,  0x14, 0xd9, 0x87, 0xd6, 0xf,  0x4b, 0x4c, 0xc,  0xd6, 0xe1, 0xd0,
                   0x8d, 0xec, 0xc2, 0x3a, 0x34, 0xd4, 0xa2, 0x7b, 0x10, 0x18, 0x0,  0x0,  0x11, 0xcb, 0xc1, 0x3c, 0xdf,
                   0xc6, 0x94, 0x3d, 0xfc, 0x13, 0x3d, 0x78, 0xc0, 0xcb, 0xd7, 0xe7, 0x32, 0xd3, 0x2,  0x0,  0x8,  0x2d,
                   0x2e, 0x4e, 0x35, 0x50, 0x2,  0x43, 0x18, 0x2,  0x0,  0xc,  0x93, 0x10, 0xd2, 0x4b, 0x1e, 0x2c, 0x6e,
                   0x8e, 0x3a, 0x30, 0x4f, 0xd9, 0x2,  0x0,  0x18, 0x2,  0x73, 0xbb, 0xd6, 0x6c, 0x24, 0x73, 0xa4, 0x39,
                   0x4f, 0x7,  0x89, 0x4d, 0x84, 0xc5, 0x22, 0x97, 0xb3, 0xe5, 0x2c, 0xc1, 0xbc, 0x5e, 0xad, 0x0,  0x0,
                   0x19, 0xfc, 0x8a, 0x2b, 0xa,  0xaf, 0x3,  0xeb, 0x5c, 0x73, 0xe0, 0xd8, 0xf9, 0x6d, 0xe4, 0x57, 0x4a,
                   0xc,  0x79, 0xc3, 0xe2, 0xc3, 0x23, 0xb6, 0x8b, 0xd7, 0x1,  0x0,  0x14, 0x8f, 0xed, 0x2c, 0xb0, 0x24,
                   0x82, 0xf3, 0x2f, 0x10, 0x7f, 0x9c, 0xe2, 0xc0, 0xc1, 0x49, 0x25, 0x44, 0x37, 0x61, 0x1a, 0x2,  0x0,
                   0x1a, 0xa0, 0x7d, 0xb2, 0xe5, 0x9a, 0x27, 0xaf, 0x3f, 0xb0, 0x49, 0xa7, 0x59, 0xf3, 0x72, 0x2b, 0x94,
                   0xc0, 0x34, 0xba, 0x58, 0x3a, 0xc0, 0xf7, 0x72, 0xf6, 0x84, 0x0,  0x0,  0x19, 0x14, 0x80, 0xa2, 0xe,
                   0x98, 0x5d, 0xbc, 0x11, 0xb8, 0xae, 0x4d, 0x88, 0x14, 0xcb, 0xeb, 0xa4, 0xcb, 0x6,  0x88, 0xd0, 0xff,
                   0x4e, 0x85, 0xfa, 0xad, 0x1,  0x0,  0x15, 0x3f, 0x27, 0x68, 0xa,  0xf0, 0x6a, 0x8,  0xf4, 0x3b, 0x81,
                   0x7f, 0xcb, 0xa9, 0x5,  0x95, 0x8c, 0x83, 0xa8, 0x68, 0x89, 0x24, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0x87, 0xd6, 0xf,  0x4b, 0x4c, 0xc,  0xd6, 0xe1, 0xd0,
                                     0x8d, 0xec, 0xc2, 0x3a, 0x34, 0xd4, 0xa2, 0x7b, 0x10, 0x18};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0xc1, 0x3c, 0xdf, 0xc6, 0x94, 0x3d, 0xfc, 0x13,
                                     0x3d, 0x78, 0xc0, 0xcb, 0xd7, 0xe7, 0x32, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0x2e, 0x4e, 0x35, 0x50, 0x2, 0x43, 0x18};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0x10, 0xd2, 0x4b, 0x1e, 0x2c, 0x6e, 0x8e, 0x3a, 0x30, 0x4f, 0xd9};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2,  0x73, 0xbb, 0xd6, 0x6c, 0x24, 0x73, 0xa4, 0x39, 0x4f, 0x7,  0x89,
                                     0x4d, 0x84, 0xc5, 0x22, 0x97, 0xb3, 0xe5, 0x2c, 0xc1, 0xbc, 0x5e, 0xad};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x8a, 0x2b, 0xa, 0xaf, 0x3,  0xeb, 0x5c, 0x73, 0xe0, 0xd8, 0xf9, 0x6d,
                                     0xe4, 0x57, 0x4a, 0xc, 0x79, 0xc3, 0xe2, 0xc3, 0x23, 0xb6, 0x8b, 0xd7};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8f, 0xed, 0x2c, 0xb0, 0x24, 0x82, 0xf3, 0x2f, 0x10, 0x7f,
                                     0x9c, 0xe2, 0xc0, 0xc1, 0x49, 0x25, 0x44, 0x37, 0x61, 0x1a};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa0, 0x7d, 0xb2, 0xe5, 0x9a, 0x27, 0xaf, 0x3f, 0xb0, 0x49, 0xa7, 0x59, 0xf3,
                                     0x72, 0x2b, 0x94, 0xc0, 0x34, 0xba, 0x58, 0x3a, 0xc0, 0xf7, 0x72, 0xf6, 0x84};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x14, 0x80, 0xa2, 0xe,  0x98, 0x5d, 0xbc, 0x11, 0xb8, 0xae, 0x4d, 0x88, 0x14,
                                     0xcb, 0xeb, 0xa4, 0xcb, 0x6,  0x88, 0xd0, 0xff, 0x4e, 0x85, 0xfa, 0xad};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x3f, 0x27, 0x68, 0xa,  0xf0, 0x6a, 0x8,  0xf4, 0x3b, 0x81, 0x7f,
                                     0xcb, 0xa9, 0x5,  0x95, 0x8c, 0x83, 0xa8, 0x68, 0x89, 0x24};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27288, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14432 [("\132\142U\243\225d\SO^\184\204\176\ng\214\232",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ap\172QO\204\154J[\145n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\RS\167x\142;=\175\194m}:\128\206\146\&5 PF\224\155",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\168c\156\132\130\233l",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("\138\204\153\191\242P(t/<\251\206\247P*\239f",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SOH5\252\ETX\182\137\247D\155\b\175\SO\193\137\fS\148\225\133^a\a\207T\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\182\129\173\SUB\239\244",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\ACK\163\NAK\DC1\195\169\246\220\EMt-\224\251\210\190k\170\170\251\193\&0\DC1\208\233\&1\NUL1",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\n\SUB\192\143\n1\SYNu\131\135tm\186\224\200\235IQ4h>0",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("J\166;]\v@\SYNME\249\NAK
// \166\187\168h\EM,\194\193\148mF6\154d}\192",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\176\&9\ne\247S\212\228T\157k\157\139P\CAN\DC1\ESC\220\227$\252\ACK\217\192\128\128H\155\174",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xf2, 0x1,  0x38, 0x60, 0x0,  0xf,  0x84, 0x8e, 0x55, 0xf3, 0xe1, 0x64, 0xe,  0x5e, 0xb8, 0xcc, 0xb0, 0xa,
      0x67, 0xd6, 0xe8, 0x1,  0x0,  0xb,  0x7,  0x70, 0xac, 0x51, 0x4f, 0xcc, 0x9a, 0x4a, 0x5b, 0x91, 0x6e, 0x2,  0x0,
      0x14, 0x1e, 0xa7, 0x78, 0x8e, 0x3b, 0x3d, 0xaf, 0xc2, 0x6d, 0x7d, 0x3a, 0x80, 0xce, 0x92, 0x35, 0x20, 0x50, 0x46,
      0xe0, 0x9b, 0x0,  0x0,  0x7,  0xa8, 0x63, 0x9c, 0x84, 0x82, 0xe9, 0x6c, 0x1,  0x0,  0x11, 0x8a, 0xcc, 0x99, 0xbf,
      0xf2, 0x50, 0x28, 0x74, 0x2f, 0x3c, 0xfb, 0xce, 0xf7, 0x50, 0x2a, 0xef, 0x66, 0x2,  0x0,  0x19, 0x1,  0x35, 0xfc,
      0x3,  0xb6, 0x89, 0xf7, 0x44, 0x9b, 0x8,  0xaf, 0xe,  0xc1, 0x89, 0xc,  0x53, 0x94, 0xe1, 0x85, 0x5e, 0x61, 0x7,
      0xcf, 0x54, 0xa0, 0x0,  0x0,  0x6,  0xb6, 0x81, 0xad, 0x1a, 0xef, 0xf4, 0x0,  0x0,  0x1b, 0x6,  0xa3, 0x15, 0x11,
      0xc3, 0xa9, 0xf6, 0xdc, 0x19, 0x74, 0x2d, 0xe0, 0xfb, 0xd2, 0xbe, 0x6b, 0xaa, 0xaa, 0xfb, 0xc1, 0x30, 0x11, 0xd0,
      0xe9, 0x31, 0x0,  0x31, 0x2,  0x0,  0x16, 0xa,  0x1a, 0xc0, 0x8f, 0xa,  0x31, 0x16, 0x75, 0x83, 0x87, 0x74, 0x6d,
      0xba, 0xe0, 0xc8, 0xeb, 0x49, 0x51, 0x34, 0x68, 0x3e, 0x30, 0x2,  0x0,  0x1c, 0x4a, 0xa6, 0x3b, 0x5d, 0xb,  0x40,
      0x16, 0x4d, 0x45, 0xf9, 0x15, 0x20, 0xa6, 0xbb, 0xa8, 0x68, 0x19, 0x2c, 0xc2, 0xc1, 0x94, 0x6d, 0x46, 0x36, 0x9a,
      0x64, 0x7d, 0xc0, 0x1,  0x0,  0x1d, 0xb0, 0x39, 0xa,  0x65, 0xf7, 0x53, 0xd4, 0xe4, 0x54, 0x9d, 0x6b, 0x9d, 0x8b,
      0x50, 0x18, 0x11, 0x1b, 0xdc, 0xe3, 0x24, 0xfc, 0x6,  0xd9, 0xc0, 0x80, 0x80, 0x48, 0x9b, 0xae, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0x8e, 0x55, 0xf3, 0xe1, 0x64, 0xe, 0x5e,
                                     0xb8, 0xcc, 0xb0, 0xa,  0x67, 0xd6, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7, 0x70, 0xac, 0x51, 0x4f, 0xcc, 0x9a, 0x4a, 0x5b, 0x91, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1e, 0xa7, 0x78, 0x8e, 0x3b, 0x3d, 0xaf, 0xc2, 0x6d, 0x7d,
                                     0x3a, 0x80, 0xce, 0x92, 0x35, 0x20, 0x50, 0x46, 0xe0, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa8, 0x63, 0x9c, 0x84, 0x82, 0xe9, 0x6c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8a, 0xcc, 0x99, 0xbf, 0xf2, 0x50, 0x28, 0x74, 0x2f,
                                     0x3c, 0xfb, 0xce, 0xf7, 0x50, 0x2a, 0xef, 0x66};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1,  0x35, 0xfc, 0x3,  0xb6, 0x89, 0xf7, 0x44, 0x9b, 0x8,  0xaf, 0xe, 0xc1,
                                     0x89, 0xc,  0x53, 0x94, 0xe1, 0x85, 0x5e, 0x61, 0x7,  0xcf, 0x54, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb6, 0x81, 0xad, 0x1a, 0xef, 0xf4};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6,  0xa3, 0x15, 0x11, 0xc3, 0xa9, 0xf6, 0xdc, 0x19, 0x74, 0x2d, 0xe0, 0xfb, 0xd2,
                                     0xbe, 0x6b, 0xaa, 0xaa, 0xfb, 0xc1, 0x30, 0x11, 0xd0, 0xe9, 0x31, 0x0,  0x31};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa,  0x1a, 0xc0, 0x8f, 0xa,  0x31, 0x16, 0x75, 0x83, 0x87, 0x74,
                                     0x6d, 0xba, 0xe0, 0xc8, 0xeb, 0x49, 0x51, 0x34, 0x68, 0x3e, 0x30};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4a, 0xa6, 0x3b, 0x5d, 0xb,  0x40, 0x16, 0x4d, 0x45, 0xf9,
                                     0x15, 0x20, 0xa6, 0xbb, 0xa8, 0x68, 0x19, 0x2c, 0xc2, 0xc1,
                                     0x94, 0x6d, 0x46, 0x36, 0x9a, 0x64, 0x7d, 0xc0};
  lwmqtt_string_t topic_filter_s9 = {28, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xb0, 0x39, 0xa,  0x65, 0xf7, 0x53, 0xd4, 0xe4, 0x54, 0x9d,
                                      0x6b, 0x9d, 0x8b, 0x50, 0x18, 0x11, 0x1b, 0xdc, 0xe3, 0x24,
                                      0xfc, 0x6,  0xd9, 0xc0, 0x80, 0x80, 0x48, 0x9b, 0xae};
  lwmqtt_string_t topic_filter_s10 = {29, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14432, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29362 [("_\243\230\136\DEL\192\SOH\129",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(")^\224-\RSS\187\132\DLE\157\228F\236\193P/=
// \US\203\163d<\r>\228\239\253\SO\223",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("d!#X=\180_\191R\DEL\180\224\148\190i\152\228b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\209\139\ACKUg\\\156\248\"\241\232*\SUB\148\"~\131c\rpq\ENQ\DC3\212\179y\RSX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("_\231\198F\215\f\226\236\156vQ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\225_l!\242_",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x79, 0x72, 0xb2, 0x0,  0x8,  0x5f, 0xf3, 0xe6, 0x88, 0x7f, 0xc0, 0x1,  0x81, 0x0,  0x0,
                   0x1e, 0x29, 0x5e, 0xe0, 0x2d, 0x1e, 0x53, 0xbb, 0x84, 0x10, 0x9d, 0xe4, 0x46, 0xec, 0xc1, 0x50,
                   0x2f, 0x3d, 0x20, 0x1f, 0xcb, 0xa3, 0x64, 0x3c, 0xd,  0x3e, 0xe4, 0xef, 0xfd, 0xe,  0xdf, 0x0,
                   0x0,  0x12, 0x64, 0x21, 0x23, 0x58, 0x3d, 0xb4, 0x5f, 0xbf, 0x52, 0x7f, 0xb4, 0xe0, 0x94, 0xbe,
                   0x69, 0x98, 0xe4, 0x62, 0x1,  0x0,  0x1c, 0xd1, 0x8b, 0x6,  0x55, 0x67, 0x5c, 0x9c, 0xf8, 0x22,
                   0xf1, 0xe8, 0x2a, 0x1a, 0x94, 0x22, 0x7e, 0x83, 0x63, 0xd,  0x70, 0x71, 0x5,  0x13, 0xd4, 0xb3,
                   0x79, 0x1e, 0x58, 0x0,  0x0,  0xb,  0x5f, 0xe7, 0xc6, 0x46, 0xd7, 0xc,  0xe2, 0xec, 0x9c, 0x76,
                   0x51, 0x0,  0x0,  0x6,  0xe1, 0x5f, 0x6c, 0x21, 0xf2, 0x5f, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xf3, 0xe6, 0x88, 0x7f, 0xc0, 0x1, 0x81};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x29, 0x5e, 0xe0, 0x2d, 0x1e, 0x53, 0xbb, 0x84, 0x10, 0x9d,
                                     0xe4, 0x46, 0xec, 0xc1, 0x50, 0x2f, 0x3d, 0x20, 0x1f, 0xcb,
                                     0xa3, 0x64, 0x3c, 0xd,  0x3e, 0xe4, 0xef, 0xfd, 0xe,  0xdf};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x64, 0x21, 0x23, 0x58, 0x3d, 0xb4, 0x5f, 0xbf, 0x52,
                                     0x7f, 0xb4, 0xe0, 0x94, 0xbe, 0x69, 0x98, 0xe4, 0x62};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x8b, 0x6,  0x55, 0x67, 0x5c, 0x9c, 0xf8, 0x22, 0xf1,
                                     0xe8, 0x2a, 0x1a, 0x94, 0x22, 0x7e, 0x83, 0x63, 0xd,  0x70,
                                     0x71, 0x5,  0x13, 0xd4, 0xb3, 0x79, 0x1e, 0x58};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xe7, 0xc6, 0x46, 0xd7, 0xc, 0xe2, 0xec, 0x9c, 0x76, 0x51};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe1, 0x5f, 0x6c, 0x21, 0xf2, 0x5f};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29362, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18382
// [("\231\EM\193\193q\251\CAN\154\SYN\230\146\204c_\141w\148\DC3\215\RS!\ETXw\186x$n\182\231",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x22, 0x47, 0xce, 0x0,  0x1d, 0xe7, 0x19, 0xc1, 0xc1, 0x71, 0xfb,
                   0x18, 0x9a, 0x16, 0xe6, 0x92, 0xcc, 0x63, 0x5f, 0x8d, 0x77, 0x94, 0x13,
                   0xd7, 0x1e, 0x21, 0x3,  0x77, 0xba, 0x78, 0x24, 0x6e, 0xb6, 0xe7, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe7, 0x19, 0xc1, 0xc1, 0x71, 0xfb, 0x18, 0x9a, 0x16, 0xe6,
                                     0x92, 0xcc, 0x63, 0x5f, 0x8d, 0x77, 0x94, 0x13, 0xd7, 0x1e,
                                     0x21, 0x3,  0x77, 0xba, 0x78, 0x24, 0x6e, 0xb6, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18382, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3280 [("\252\153?\GSp",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("_\132\USe\201\201\207X\SI%\DC4\188n<\231p\ACK{\157\165\215\142\182\165\234\137\&6u",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\\3\146\160\169\t\156\ENQ\193$\238\197jL\b\216\252\216",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\ETX\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\a;J7U.\178\156\&8d\196\SO$\145\224\131Y\200\&2+;l",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("E\177t%H\185\EOTxHjzc\212\174}XI\SYNBe*\SOH\249Q6R\NUL-",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x7b, 0xc,  0xd0, 0x0,  0x5,  0xfc, 0x99, 0x3f, 0x1d, 0x70, 0x0,  0x0,  0x1c, 0x5f, 0x84,
                   0x1f, 0x65, 0xc9, 0xc9, 0xcf, 0x58, 0xf,  0x25, 0x14, 0xbc, 0x6e, 0x3c, 0xe7, 0x70, 0x6,  0x7b,
                   0x9d, 0xa5, 0xd7, 0x8e, 0xb6, 0xa5, 0xea, 0x89, 0x36, 0x75, 0x2,  0x0,  0x12, 0x5c, 0x33, 0x92,
                   0xa0, 0xa9, 0x9,  0x9c, 0x5,  0xc1, 0x24, 0xee, 0xc5, 0x6a, 0x4c, 0x8,  0xd8, 0xfc, 0xd8, 0x1,
                   0x0,  0x2,  0x3,  0xf0, 0x1,  0x0,  0x16, 0x7,  0x3b, 0x4a, 0x37, 0x55, 0x2e, 0xb2, 0x9c, 0x38,
                   0x64, 0xc4, 0xe,  0x24, 0x91, 0xe0, 0x83, 0x59, 0xc8, 0x32, 0x2b, 0x3b, 0x6c, 0x2,  0x0,  0x1c,
                   0x45, 0xb1, 0x74, 0x25, 0x48, 0xb9, 0x4,  0x78, 0x48, 0x6a, 0x7a, 0x63, 0xd4, 0xae, 0x7d, 0x58,
                   0x49, 0x16, 0x42, 0x65, 0x2a, 0x1,  0xf9, 0x51, 0x36, 0x52, 0x0,  0x2d, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xfc, 0x99, 0x3f, 0x1d, 0x70};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x84, 0x1f, 0x65, 0xc9, 0xc9, 0xcf, 0x58, 0xf,  0x25,
                                     0x14, 0xbc, 0x6e, 0x3c, 0xe7, 0x70, 0x6,  0x7b, 0x9d, 0xa5,
                                     0xd7, 0x8e, 0xb6, 0xa5, 0xea, 0x89, 0x36, 0x75};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x33, 0x92, 0xa0, 0xa9, 0x9, 0x9c, 0x5,  0xc1,
                                     0x24, 0xee, 0xc5, 0x6a, 0x4c, 0x8, 0xd8, 0xfc, 0xd8};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3, 0xf0};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7, 0x3b, 0x4a, 0x37, 0x55, 0x2e, 0xb2, 0x9c, 0x38, 0x64, 0xc4,
                                     0xe, 0x24, 0x91, 0xe0, 0x83, 0x59, 0xc8, 0x32, 0x2b, 0x3b, 0x6c};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x45, 0xb1, 0x74, 0x25, 0x48, 0xb9, 0x4,  0x78, 0x48, 0x6a,
                                     0x7a, 0x63, 0xd4, 0xae, 0x7d, 0x58, 0x49, 0x16, 0x42, 0x65,
                                     0x2a, 0x1,  0xf9, 0x51, 0x36, 0x52, 0x0,  0x2d};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3280, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4639 [("\165\EM\DC2g\NUL",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\ESCH\249\163F",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\203\206z\136",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\156`s_",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x20, 0x12, 0x1f, 0x0, 0x5,  0xa5, 0x19, 0x12, 0x67, 0x0, 0x2, 0x0,  0x5,  0x1b, 0x48, 0xf9,
                   0xa3, 0x46, 0x1,  0x0,  0x4, 0xcb, 0xce, 0x7a, 0x88, 0x1,  0x0, 0x4, 0x9c, 0x60, 0x73, 0x5f, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xa5, 0x19, 0x12, 0x67, 0x0};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1b, 0x48, 0xf9, 0xa3, 0x46};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcb, 0xce, 0x7a, 0x88};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9c, 0x60, 0x73, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4639, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23421 [("\251(\b\221xT^\230i\US\136\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\239\134\214\190s\242G\b\155\159\231F\196",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("R\224\a\fdO\239\252\137\148rl,\DELe\145\206_\153\201\&4\149\173\208\\\n[\213\227",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\221A\172\SYN\229\189\v\177\194\tM6\158\244\184\129\CANc;T\142\&1@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\159\222\ESC0\198\131\133\220\213\242\238\229\202\SUB\151\&4R\223c<f*\244",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SUB\DC3\233\208\227\197\&8\160\184\213\227p\215D\a\STX\134\173\&8\235\a\254!",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("R\223\249\176\254\216\245,\225\138\179",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0x5b, 0x7d, 0x0,  0xc,  0xfb, 0x28, 0x8,  0xdd, 0x78, 0x54, 0x5e, 0xe6, 0x69,
                   0x1f, 0x88, 0x4,  0x0,  0x0,  0xd,  0xef, 0x86, 0xd6, 0xbe, 0x73, 0xf2, 0x47, 0x8,  0x9b, 0x9f,
                   0xe7, 0x46, 0xc4, 0x0,  0x0,  0x1d, 0x52, 0xe0, 0x7,  0xc,  0x64, 0x4f, 0xef, 0xfc, 0x89, 0x94,
                   0x72, 0x6c, 0x2c, 0x7f, 0x65, 0x91, 0xce, 0x5f, 0x99, 0xc9, 0x34, 0x95, 0xad, 0xd0, 0x5c, 0xa,
                   0x5b, 0xd5, 0xe3, 0x2,  0x0,  0x17, 0xdd, 0x41, 0xac, 0x16, 0xe5, 0xbd, 0xb,  0xb1, 0xc2, 0x9,
                   0x4d, 0x36, 0x9e, 0xf4, 0xb8, 0x81, 0x18, 0x63, 0x3b, 0x54, 0x8e, 0x31, 0x40, 0x2,  0x0,  0x17,
                   0x9f, 0xde, 0x1b, 0x30, 0xc6, 0x83, 0x85, 0xdc, 0xd5, 0xf2, 0xee, 0xe5, 0xca, 0x1a, 0x97, 0x34,
                   0x52, 0xdf, 0x63, 0x3c, 0x66, 0x2a, 0xf4, 0x2,  0x0,  0x17, 0x1a, 0x13, 0xe9, 0xd0, 0xe3, 0xc5,
                   0x38, 0xa0, 0xb8, 0xd5, 0xe3, 0x70, 0xd7, 0x44, 0x7,  0x2,  0x86, 0xad, 0x38, 0xeb, 0x7,  0xfe,
                   0x21, 0x1,  0x0,  0xb,  0x52, 0xdf, 0xf9, 0xb0, 0xfe, 0xd8, 0xf5, 0x2c, 0xe1, 0x8a, 0xb3, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xfb, 0x28, 0x8, 0xdd, 0x78, 0x54, 0x5e, 0xe6, 0x69, 0x1f, 0x88, 0x4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0x86, 0xd6, 0xbe, 0x73, 0xf2, 0x47, 0x8, 0x9b, 0x9f, 0xe7, 0x46, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x52, 0xe0, 0x7,  0xc,  0x64, 0x4f, 0xef, 0xfc, 0x89, 0x94,
                                     0x72, 0x6c, 0x2c, 0x7f, 0x65, 0x91, 0xce, 0x5f, 0x99, 0xc9,
                                     0x34, 0x95, 0xad, 0xd0, 0x5c, 0xa,  0x5b, 0xd5, 0xe3};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xdd, 0x41, 0xac, 0x16, 0xe5, 0xbd, 0xb,  0xb1, 0xc2, 0x9,  0x4d, 0x36,
                                     0x9e, 0xf4, 0xb8, 0x81, 0x18, 0x63, 0x3b, 0x54, 0x8e, 0x31, 0x40};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9f, 0xde, 0x1b, 0x30, 0xc6, 0x83, 0x85, 0xdc, 0xd5, 0xf2, 0xee, 0xe5,
                                     0xca, 0x1a, 0x97, 0x34, 0x52, 0xdf, 0x63, 0x3c, 0x66, 0x2a, 0xf4};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1a, 0x13, 0xe9, 0xd0, 0xe3, 0xc5, 0x38, 0xa0, 0xb8, 0xd5, 0xe3, 0x70,
                                     0xd7, 0x44, 0x7,  0x2,  0x86, 0xad, 0x38, 0xeb, 0x7,  0xfe, 0x21};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0xdf, 0xf9, 0xb0, 0xfe, 0xd8, 0xf5, 0x2c, 0xe1, 0x8a, 0xb3};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23421, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29413
// [("\r\177\255\&8\205T\220\221\200I\135\179\NUL\b&\210<\160v\139\174\149p\226\&1\STX\227\170",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\NAKRLi\SO!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("^$\195\221qYtK1\165lY\230\255",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\GS\164\186\150\191\r\to\189\190\150\183))a\EM\235\DC2B\\\215G\237:\161",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("g\185\228[\DC1%6\FS$\251\239\210\133\149\184\&61\EOTS\131\190\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("4TB\235K\215N\"\198>L\171r:\136\128\t\nV1@\206",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\152\178\CAN\175Q\229h\DC19I\201\190>\230\164\181\242q51",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\176O\235\183\144\ETX\224\ACK\173\237*\DLE\129\NUL\CAN\151",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\210\189\SI\243c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\164\176\159\168\229\233v\159\v\223\227\158\207\190\216\187\203Z",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0xd0, 0x1,  0x72, 0xe5, 0x0,  0x1c, 0xd,  0xb1, 0xff, 0x38, 0xcd, 0x54, 0xdc, 0xdd, 0xc8, 0x49,
                   0x87, 0xb3, 0x0,  0x8,  0x26, 0xd2, 0x3c, 0xa0, 0x76, 0x8b, 0xae, 0x95, 0x70, 0xe2, 0x31, 0x2,  0xe3,
                   0xaa, 0x0,  0x0,  0x6,  0x15, 0x52, 0x4c, 0x69, 0xe,  0x21, 0x2,  0x0,  0xe,  0x5e, 0x24, 0xc3, 0xdd,
                   0x71, 0x59, 0x74, 0x4b, 0x31, 0xa5, 0x6c, 0x59, 0xe6, 0xff, 0x2,  0x0,  0x19, 0x1d, 0xa4, 0xba, 0x96,
                   0xbf, 0xd,  0x9,  0x6f, 0xbd, 0xbe, 0x96, 0xb7, 0x29, 0x29, 0x61, 0x19, 0xeb, 0x12, 0x42, 0x5c, 0xd7,
                   0x47, 0xed, 0x3a, 0xa1, 0x0,  0x0,  0x16, 0x67, 0xb9, 0xe4, 0x5b, 0x11, 0x25, 0x36, 0x1c, 0x24, 0xfb,
                   0xef, 0xd2, 0x85, 0x95, 0xb8, 0x36, 0x31, 0x4,  0x53, 0x83, 0xbe, 0x93, 0x1,  0x0,  0x16, 0x34, 0x54,
                   0x42, 0xeb, 0x4b, 0xd7, 0x4e, 0x22, 0xc6, 0x3e, 0x4c, 0xab, 0x72, 0x3a, 0x88, 0x80, 0x9,  0xa,  0x56,
                   0x31, 0x40, 0xce, 0x0,  0x0,  0x14, 0x98, 0xb2, 0x18, 0xaf, 0x51, 0xe5, 0x68, 0x11, 0x39, 0x49, 0xc9,
                   0xbe, 0x3e, 0xe6, 0xa4, 0xb5, 0xf2, 0x71, 0x35, 0x31, 0x1,  0x0,  0x10, 0xb0, 0x4f, 0xeb, 0xb7, 0x90,
                   0x3,  0xe0, 0x6,  0xad, 0xed, 0x2a, 0x10, 0x81, 0x0,  0x18, 0x97, 0x1,  0x0,  0x5,  0xd2, 0xbd, 0xf,
                   0xf3, 0x63, 0x0,  0x0,  0x12, 0xa4, 0xb0, 0x9f, 0xa8, 0xe5, 0xe9, 0x76, 0x9f, 0xb,  0xdf, 0xe3, 0x9e,
                   0xcf, 0xbe, 0xd8, 0xbb, 0xcb, 0x5a, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xb1, 0xff, 0x38, 0xcd, 0x54, 0xdc, 0xdd, 0xc8, 0x49,
                                     0x87, 0xb3, 0x0,  0x8,  0x26, 0xd2, 0x3c, 0xa0, 0x76, 0x8b,
                                     0xae, 0x95, 0x70, 0xe2, 0x31, 0x2,  0xe3, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x15, 0x52, 0x4c, 0x69, 0xe, 0x21};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5e, 0x24, 0xc3, 0xdd, 0x71, 0x59, 0x74,
                                     0x4b, 0x31, 0xa5, 0x6c, 0x59, 0xe6, 0xff};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1d, 0xa4, 0xba, 0x96, 0xbf, 0xd,  0x9,  0x6f, 0xbd, 0xbe, 0x96, 0xb7, 0x29,
                                     0x29, 0x61, 0x19, 0xeb, 0x12, 0x42, 0x5c, 0xd7, 0x47, 0xed, 0x3a, 0xa1};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x67, 0xb9, 0xe4, 0x5b, 0x11, 0x25, 0x36, 0x1c, 0x24, 0xfb, 0xef,
                                     0xd2, 0x85, 0x95, 0xb8, 0x36, 0x31, 0x4,  0x53, 0x83, 0xbe, 0x93};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x34, 0x54, 0x42, 0xeb, 0x4b, 0xd7, 0x4e, 0x22, 0xc6, 0x3e, 0x4c,
                                     0xab, 0x72, 0x3a, 0x88, 0x80, 0x9,  0xa,  0x56, 0x31, 0x40, 0xce};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x98, 0xb2, 0x18, 0xaf, 0x51, 0xe5, 0x68, 0x11, 0x39, 0x49,
                                     0xc9, 0xbe, 0x3e, 0xe6, 0xa4, 0xb5, 0xf2, 0x71, 0x35, 0x31};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb0, 0x4f, 0xeb, 0xb7, 0x90, 0x3, 0xe0, 0x6,
                                     0xad, 0xed, 0x2a, 0x10, 0x81, 0x0, 0x18, 0x97};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd2, 0xbd, 0xf, 0xf3, 0x63};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa4, 0xb0, 0x9f, 0xa8, 0xe5, 0xe9, 0x76, 0x9f, 0xb,
                                     0xdf, 0xe3, 0x9e, 0xcf, 0xbe, 0xd8, 0xbb, 0xcb, 0x5a};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29413, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 6204 [("O\CAN\197/\176M5\196\CAN\225\129Lt\140(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\182\157\155]\RS\202Z\206F\192\t\240bW\211\158\163b\219\147F3>",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\173U\245\ACK\156A\ENQ\208\187\208\DELX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\188\246\170$\240\EM",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\"~R\129\189*P\134\186\ETB\222\230\&4\168^\237\146\ACK\240\190q\205\153U\SOH^|H",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x65, 0x18, 0x3c, 0x0,  0xf,  0x4f, 0x18, 0xc5, 0x2f, 0xb0, 0x4d, 0x35, 0xc4, 0x18,
                   0xe1, 0x81, 0x4c, 0x74, 0x8c, 0x28, 0x2,  0x0,  0x17, 0xb6, 0x9d, 0x9b, 0x5d, 0x1e, 0xca,
                   0x5a, 0xce, 0x46, 0xc0, 0x9,  0xf0, 0x62, 0x57, 0xd3, 0x9e, 0xa3, 0x62, 0xdb, 0x93, 0x46,
                   0x33, 0x3e, 0x2,  0x0,  0xc,  0xad, 0x55, 0xf5, 0x6,  0x9c, 0x41, 0x5,  0xd0, 0xbb, 0xd0,
                   0x7f, 0x58, 0x1,  0x0,  0x6,  0xbc, 0xf6, 0xaa, 0x24, 0xf0, 0x19, 0x0,  0x0,  0x1c, 0x22,
                   0x7e, 0x52, 0x81, 0xbd, 0x2a, 0x50, 0x86, 0xba, 0x17, 0xde, 0xe6, 0x34, 0xa8, 0x5e, 0xed,
                   0x92, 0x6,  0xf0, 0xbe, 0x71, 0xcd, 0x99, 0x55, 0x1,  0x5e, 0x7c, 0x48, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0x18, 0xc5, 0x2f, 0xb0, 0x4d, 0x35, 0xc4,
                                     0x18, 0xe1, 0x81, 0x4c, 0x74, 0x8c, 0x28};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0x9d, 0x9b, 0x5d, 0x1e, 0xca, 0x5a, 0xce, 0x46, 0xc0, 0x9, 0xf0,
                                     0x62, 0x57, 0xd3, 0x9e, 0xa3, 0x62, 0xdb, 0x93, 0x46, 0x33, 0x3e};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xad, 0x55, 0xf5, 0x6, 0x9c, 0x41, 0x5, 0xd0, 0xbb, 0xd0, 0x7f, 0x58};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbc, 0xf6, 0xaa, 0x24, 0xf0, 0x19};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x22, 0x7e, 0x52, 0x81, 0xbd, 0x2a, 0x50, 0x86, 0xba, 0x17,
                                     0xde, 0xe6, 0x34, 0xa8, 0x5e, 0xed, 0x92, 0x6,  0xf0, 0xbe,
                                     0x71, 0xcd, 0x99, 0x55, 0x1,  0x5e, 0x7c, 0x48};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 6204, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8030 [("\234\190\DEL\176\250cyY\218\176\196\212\214",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\153\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\185D\196\STX\DC3\194\198\144\b\211h\192\175\SI\250aJ\177\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("6\ETB\STXr\219j\151-\227",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x39, 0x1f, 0x5e, 0x0,  0xd,  0xea, 0xbe, 0x7f, 0xb0, 0xfa, 0x63, 0x79, 0x59, 0xda,
                   0xb0, 0xc4, 0xd4, 0xd6, 0x2,  0x0,  0x2,  0x99, 0xae, 0x1,  0x0,  0x13, 0xb9, 0x44, 0xc4,
                   0x2,  0x13, 0xc2, 0xc6, 0x90, 0x8,  0xd3, 0x68, 0xc0, 0xaf, 0xf,  0xfa, 0x61, 0x4a, 0xb1,
                   0xa7, 0x1,  0x0,  0x9,  0x36, 0x17, 0x2,  0x72, 0xdb, 0x6a, 0x97, 0x2d, 0xe3, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea, 0xbe, 0x7f, 0xb0, 0xfa, 0x63, 0x79, 0x59, 0xda, 0xb0, 0xc4, 0xd4, 0xd6};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x99, 0xae};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb9, 0x44, 0xc4, 0x2, 0x13, 0xc2, 0xc6, 0x90, 0x8, 0xd3,
                                     0x68, 0xc0, 0xaf, 0xf, 0xfa, 0x61, 0x4a, 0xb1, 0xa7};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x17, 0x2, 0x72, 0xdb, 0x6a, 0x97, 0x2d, 0xe3};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8030, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25611
// [("\193&\245\253\192\158\"\200\178\219\187\160\173vT\207\DC4\253\200\NAKd_8\228:\218\238\129",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\219\189\166\255\198\&0\164\&0\ESCg\SOHr<\253Ms\CAN\ETX",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x36, 0x64, 0xb,  0x0,  0x1c, 0xc1, 0x26, 0xf5, 0xfd, 0xc0, 0x9e, 0x22, 0xc8,
                   0xb2, 0xdb, 0xbb, 0xa0, 0xad, 0x76, 0x54, 0xcf, 0x14, 0xfd, 0xc8, 0x15, 0x64, 0x5f,
                   0x38, 0xe4, 0x3a, 0xda, 0xee, 0x81, 0x1,  0x0,  0x12, 0xdb, 0xbd, 0xa6, 0xff, 0xc6,
                   0x30, 0xa4, 0x30, 0x1b, 0x67, 0x1,  0x72, 0x3c, 0xfd, 0x4d, 0x73, 0x18, 0x3,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xc1, 0x26, 0xf5, 0xfd, 0xc0, 0x9e, 0x22, 0xc8, 0xb2, 0xdb,
                                     0xbb, 0xa0, 0xad, 0x76, 0x54, 0xcf, 0x14, 0xfd, 0xc8, 0x15,
                                     0x64, 0x5f, 0x38, 0xe4, 0x3a, 0xda, 0xee, 0x81};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0xbd, 0xa6, 0xff, 0xc6, 0x30, 0xa4, 0x30, 0x1b,
                                     0x67, 0x1,  0x72, 0x3c, 0xfd, 0x4d, 0x73, 0x18, 0x3};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25611, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20073 [("\150\229\151f\221S\227F9\174\140\214\205\194\&6",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("b'\220g\205\179\146\202\229\249\GS\151R#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\NAK",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("\212m\205\&6\249'\241wU\144\246\172\DEL4b!*\199\&4K\220\225",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("h\235\206",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\252\156\160\253\208\193C\SI[\235\239\236\248\207J&b\135\248\157",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\SYN\167%\167C+\SOH\205\197\t3\244\136\RS\ETB\237:\n\EOTco\DC3~\160\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\131\204\157\FS\182\179\254}\198^zy\160P\255\NAK\192]\172\DLE(\173\129oIr\144u\212",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\230\212\130m\136\168\227\&6\206;\ACK\STX\242",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\249\t3\197x@\253D\DC4\"\229\193\219\163\145}\167\&9\182\145I",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("yW<\191",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0xca, 0x1,  0x4e, 0x69, 0x0,  0xf,  0x96, 0xe5, 0x97, 0x66, 0xdd, 0x53, 0xe3, 0x46, 0x39, 0xae, 0x8c, 0xd6,
      0xcd, 0xc2, 0x36, 0x1,  0x0,  0xe,  0x62, 0x27, 0xdc, 0x67, 0xcd, 0xb3, 0x92, 0xca, 0xe5, 0xf9, 0x1d, 0x97, 0x52,
      0x23, 0x1,  0x0,  0x1,  0x15, 0x2,  0x0,  0x16, 0xd4, 0x6d, 0xcd, 0x36, 0xf9, 0x27, 0xf1, 0x77, 0x55, 0x90, 0xf6,
      0xac, 0x7f, 0x34, 0x62, 0x21, 0x2a, 0xc7, 0x34, 0x4b, 0xdc, 0xe1, 0x2,  0x0,  0x3,  0x68, 0xeb, 0xce, 0x0,  0x0,
      0x14, 0xfc, 0x9c, 0xa0, 0xfd, 0xd0, 0xc1, 0x43, 0xf,  0x5b, 0xeb, 0xef, 0xec, 0xf8, 0xcf, 0x4a, 0x26, 0x62, 0x87,
      0xf8, 0x9d, 0x1,  0x0,  0x19, 0x16, 0xa7, 0x25, 0xa7, 0x43, 0x2b, 0x1,  0xcd, 0xc5, 0x9,  0x33, 0xf4, 0x88, 0x1e,
      0x17, 0xed, 0x3a, 0xa,  0x4,  0x63, 0x6f, 0x13, 0x7e, 0xa0, 0x87, 0x2,  0x0,  0x1d, 0x83, 0xcc, 0x9d, 0x1c, 0xb6,
      0xb3, 0xfe, 0x7d, 0xc6, 0x5e, 0x7a, 0x79, 0xa0, 0x50, 0xff, 0x15, 0xc0, 0x5d, 0xac, 0x10, 0x28, 0xad, 0x81, 0x6f,
      0x49, 0x72, 0x90, 0x75, 0xd4, 0x0,  0x0,  0xd,  0xe6, 0xd4, 0x82, 0x6d, 0x88, 0xa8, 0xe3, 0x36, 0xce, 0x3b, 0x6,
      0x2,  0xf2, 0x1,  0x0,  0x15, 0xf9, 0x9,  0x33, 0xc5, 0x78, 0x40, 0xfd, 0x44, 0x14, 0x22, 0xe5, 0xc1, 0xdb, 0xa3,
      0x91, 0x7d, 0xa7, 0x39, 0xb6, 0x91, 0x49, 0x2,  0x0,  0x4,  0x79, 0x57, 0x3c, 0xbf, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x96, 0xe5, 0x97, 0x66, 0xdd, 0x53, 0xe3, 0x46,
                                     0x39, 0xae, 0x8c, 0xd6, 0xcd, 0xc2, 0x36};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x62, 0x27, 0xdc, 0x67, 0xcd, 0xb3, 0x92,
                                     0xca, 0xe5, 0xf9, 0x1d, 0x97, 0x52, 0x23};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x15};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x6d, 0xcd, 0x36, 0xf9, 0x27, 0xf1, 0x77, 0x55, 0x90, 0xf6,
                                     0xac, 0x7f, 0x34, 0x62, 0x21, 0x2a, 0xc7, 0x34, 0x4b, 0xdc, 0xe1};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0xeb, 0xce};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x9c, 0xa0, 0xfd, 0xd0, 0xc1, 0x43, 0xf,  0x5b, 0xeb,
                                     0xef, 0xec, 0xf8, 0xcf, 0x4a, 0x26, 0x62, 0x87, 0xf8, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x16, 0xa7, 0x25, 0xa7, 0x43, 0x2b, 0x1,  0xcd, 0xc5, 0x9,  0x33, 0xf4, 0x88,
                                     0x1e, 0x17, 0xed, 0x3a, 0xa,  0x4,  0x63, 0x6f, 0x13, 0x7e, 0xa0, 0x87};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x83, 0xcc, 0x9d, 0x1c, 0xb6, 0xb3, 0xfe, 0x7d, 0xc6, 0x5e,
                                     0x7a, 0x79, 0xa0, 0x50, 0xff, 0x15, 0xc0, 0x5d, 0xac, 0x10,
                                     0x28, 0xad, 0x81, 0x6f, 0x49, 0x72, 0x90, 0x75, 0xd4};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe6, 0xd4, 0x82, 0x6d, 0x88, 0xa8, 0xe3, 0x36, 0xce, 0x3b, 0x6, 0x2, 0xf2};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xf9, 0x9,  0x33, 0xc5, 0x78, 0x40, 0xfd, 0x44, 0x14, 0x22, 0xe5,
                                     0xc1, 0xdb, 0xa3, 0x91, 0x7d, 0xa7, 0x39, 0xb6, 0x91, 0x49};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x79, 0x57, 0x3c, 0xbf};
  lwmqtt_string_t topic_filter_s10 = {4, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20073, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12782 [("\238\199\163\EOT$\228\173\174\EM\128vA\216",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\172,\203\248Z\129\GS\RSj.\208\aqM\178\167n7\235",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\229.\210\152\ETB\234\229V\FS\177\214\ETBE\143D\ETB\222\154\157&\204\247\239",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\198\151\141\&8-\DEL\251\FS\a\CANfH\231*i\179\172\r\239_\141S(~Y\236",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("9oU\227^\\\129P74A\252\165^<\US\206\&6\148\182\&1\154\238\235\248\210\164\ENQ\ACK\184",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x80, 0x1,  0x31, 0xee, 0x0,  0xd,  0xee, 0xc7, 0xa3, 0x4,  0x24, 0xe4, 0xad, 0xae, 0x19, 0x80,
                   0x76, 0x41, 0xd8, 0x2,  0x0,  0x13, 0xac, 0x2c, 0xcb, 0xf8, 0x5a, 0x81, 0x1d, 0x1e, 0x6a, 0x2e, 0xd0,
                   0x7,  0x71, 0x4d, 0xb2, 0xa7, 0x6e, 0x37, 0xeb, 0x0,  0x0,  0x17, 0xe5, 0x2e, 0xd2, 0x98, 0x17, 0xea,
                   0xe5, 0x56, 0x1c, 0xb1, 0xd6, 0x17, 0x45, 0x8f, 0x44, 0x17, 0xde, 0x9a, 0x9d, 0x26, 0xcc, 0xf7, 0xef,
                   0x1,  0x0,  0x1a, 0xc6, 0x97, 0x8d, 0x38, 0x2d, 0x7f, 0xfb, 0x1c, 0x7,  0x18, 0x66, 0x48, 0xe7, 0x2a,
                   0x69, 0xb3, 0xac, 0xd,  0xef, 0x5f, 0x8d, 0x53, 0x28, 0x7e, 0x59, 0xec, 0x0,  0x0,  0x1e, 0x39, 0x6f,
                   0x55, 0xe3, 0x5e, 0x5c, 0x81, 0x50, 0x37, 0x34, 0x41, 0xfc, 0xa5, 0x5e, 0x3c, 0x1f, 0xce, 0x36, 0x94,
                   0xb6, 0x31, 0x9a, 0xee, 0xeb, 0xf8, 0xd2, 0xa4, 0x5,  0x6,  0xb8, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xee, 0xc7, 0xa3, 0x4, 0x24, 0xe4, 0xad, 0xae, 0x19, 0x80, 0x76, 0x41, 0xd8};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xac, 0x2c, 0xcb, 0xf8, 0x5a, 0x81, 0x1d, 0x1e, 0x6a, 0x2e,
                                     0xd0, 0x7,  0x71, 0x4d, 0xb2, 0xa7, 0x6e, 0x37, 0xeb};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0x2e, 0xd2, 0x98, 0x17, 0xea, 0xe5, 0x56, 0x1c, 0xb1, 0xd6, 0x17,
                                     0x45, 0x8f, 0x44, 0x17, 0xde, 0x9a, 0x9d, 0x26, 0xcc, 0xf7, 0xef};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc6, 0x97, 0x8d, 0x38, 0x2d, 0x7f, 0xfb, 0x1c, 0x7,  0x18, 0x66, 0x48, 0xe7,
                                     0x2a, 0x69, 0xb3, 0xac, 0xd,  0xef, 0x5f, 0x8d, 0x53, 0x28, 0x7e, 0x59, 0xec};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x39, 0x6f, 0x55, 0xe3, 0x5e, 0x5c, 0x81, 0x50, 0x37, 0x34,
                                     0x41, 0xfc, 0xa5, 0x5e, 0x3c, 0x1f, 0xce, 0x36, 0x94, 0xb6,
                                     0x31, 0x9a, 0xee, 0xeb, 0xf8, 0xd2, 0xa4, 0x5,  0x6,  0xb8};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12782, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7994 [("w\248Bj\ETB\DC2\226U",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\190\217[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("4/\225\175\&4\185\&5j\228\195\217\184\142\145(7%\165fb]\156\STX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\131\156\225\148\176O5\ETX\213\218\214\174\214S\242\198Y\152\&2V%\188\222\GS8",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("1\US\176)\SYN3\SO\n\n4r\188\165vj\216\187]%\243\&244\SYN\186\166\r",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\170:\197\207\254\DLE\218c\r\134\184\235\NULq?\174\146B\227\240\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\151\237H\215M\151\DC4\144\228\180c\210\v\195\251",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\162\255\252\DC17\138\&3.\159W\239\237{Z/T\SO\132\246\251\170\243\186\162\177\&7",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\225)u\SUB\181#\ETB\132 \212\238G9{|-{h:@r0\186r\DC4\214\225\&4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("l$",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),(">\217\185\166\NAK\216\248(\172\194\189",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0xe0, 0x1,  0x1f, 0x3a, 0x0,  0x8,  0x77, 0xf8, 0x42, 0x6a, 0x17, 0x12, 0xe2, 0x55, 0x0,  0x0,  0x3,  0xbe,
      0xd9, 0x5b, 0x1,  0x0,  0x17, 0x34, 0x2f, 0xe1, 0xaf, 0x34, 0xb9, 0x35, 0x6a, 0xe4, 0xc3, 0xd9, 0xb8, 0x8e, 0x91,
      0x28, 0x37, 0x25, 0xa5, 0x66, 0x62, 0x5d, 0x9c, 0x2,  0x2,  0x0,  0x19, 0x83, 0x9c, 0xe1, 0x94, 0xb0, 0x4f, 0x35,
      0x3,  0xd5, 0xda, 0xd6, 0xae, 0xd6, 0x53, 0xf2, 0xc6, 0x59, 0x98, 0x32, 0x56, 0x25, 0xbc, 0xde, 0x1d, 0x38, 0x2,
      0x0,  0x1b, 0x31, 0x1f, 0xb0, 0x29, 0x16, 0x33, 0xe,  0xa,  0xa,  0x34, 0x72, 0xbc, 0xa5, 0x76, 0x6a, 0xd8, 0xbb,
      0x5d, 0x25, 0xf3, 0x32, 0x34, 0x34, 0x16, 0xba, 0xa6, 0xd,  0x1,  0x0,  0x15, 0xaa, 0x3a, 0xc5, 0xcf, 0xfe, 0x10,
      0xda, 0x63, 0xd,  0x86, 0xb8, 0xeb, 0x0,  0x71, 0x3f, 0xae, 0x92, 0x42, 0xe3, 0xf0, 0xd3, 0x2,  0x0,  0xf,  0x97,
      0xed, 0x48, 0xd7, 0x4d, 0x97, 0x14, 0x90, 0xe4, 0xb4, 0x63, 0xd2, 0xb,  0xc3, 0xfb, 0x0,  0x0,  0x1a, 0xa2, 0xff,
      0xfc, 0x11, 0x37, 0x8a, 0x33, 0x2e, 0x9f, 0x57, 0xef, 0xed, 0x7b, 0x5a, 0x2f, 0x54, 0xe,  0x84, 0xf6, 0xfb, 0xaa,
      0xf3, 0xba, 0xa2, 0xb1, 0x37, 0x2,  0x0,  0x1c, 0xe1, 0x29, 0x75, 0x1a, 0xb5, 0x23, 0x17, 0x84, 0x20, 0xd4, 0xee,
      0x47, 0x39, 0x7b, 0x7c, 0x2d, 0x7b, 0x68, 0x3a, 0x40, 0x72, 0x30, 0xba, 0x72, 0x14, 0xd6, 0xe1, 0x34, 0x1,  0x0,
      0x2,  0x6c, 0x24, 0x1,  0x0,  0xb,  0x3e, 0xd9, 0xb9, 0xa6, 0x15, 0xd8, 0xf8, 0x28, 0xac, 0xc2, 0xbd, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x77, 0xf8, 0x42, 0x6a, 0x17, 0x12, 0xe2, 0x55};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbe, 0xd9, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x34, 0x2f, 0xe1, 0xaf, 0x34, 0xb9, 0x35, 0x6a, 0xe4, 0xc3, 0xd9, 0xb8,
                                     0x8e, 0x91, 0x28, 0x37, 0x25, 0xa5, 0x66, 0x62, 0x5d, 0x9c, 0x2};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x83, 0x9c, 0xe1, 0x94, 0xb0, 0x4f, 0x35, 0x3,  0xd5, 0xda, 0xd6, 0xae, 0xd6,
                                     0x53, 0xf2, 0xc6, 0x59, 0x98, 0x32, 0x56, 0x25, 0xbc, 0xde, 0x1d, 0x38};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x1f, 0xb0, 0x29, 0x16, 0x33, 0xe,  0xa,  0xa,  0x34, 0x72, 0xbc, 0xa5, 0x76,
                                     0x6a, 0xd8, 0xbb, 0x5d, 0x25, 0xf3, 0x32, 0x34, 0x34, 0x16, 0xba, 0xa6, 0xd};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xaa, 0x3a, 0xc5, 0xcf, 0xfe, 0x10, 0xda, 0x63, 0xd,  0x86, 0xb8,
                                     0xeb, 0x0,  0x71, 0x3f, 0xae, 0x92, 0x42, 0xe3, 0xf0, 0xd3};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x97, 0xed, 0x48, 0xd7, 0x4d, 0x97, 0x14, 0x90,
                                     0xe4, 0xb4, 0x63, 0xd2, 0xb,  0xc3, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa2, 0xff, 0xfc, 0x11, 0x37, 0x8a, 0x33, 0x2e, 0x9f, 0x57, 0xef, 0xed, 0x7b,
                                     0x5a, 0x2f, 0x54, 0xe,  0x84, 0xf6, 0xfb, 0xaa, 0xf3, 0xba, 0xa2, 0xb1, 0x37};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe1, 0x29, 0x75, 0x1a, 0xb5, 0x23, 0x17, 0x84, 0x20, 0xd4,
                                     0xee, 0x47, 0x39, 0x7b, 0x7c, 0x2d, 0x7b, 0x68, 0x3a, 0x40,
                                     0x72, 0x30, 0xba, 0x72, 0x14, 0xd6, 0xe1, 0x34};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6c, 0x24};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x3e, 0xd9, 0xb9, 0xa6, 0x15, 0xd8, 0xf8, 0x28, 0xac, 0xc2, 0xbd};
  lwmqtt_string_t topic_filter_s10 = {11, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7994, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23842 [("\140\185\224\250R\251\"\210\238\130\148\253\176\167\230\DELx%",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("k\157(%\238\144\NAK\133\246\206\163w\161\180x5X\SI\SYN(\130\224u\222\247\155\175\200",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\188k9#!@s.\150+\ETBF\197\DC3i\159Z\197,\214\167\253\245\aE",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("+\194\188\205\157\178\221\t\245\213\254W\129\251A\aV\219\210\b\229<\149\204&\201\196\182U",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\222\146\234\140\195c\209LL$\222\179\153\DEL\208\218\132\209\214%\139\228\230",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\CAN\151aE\174\174\225\221%N\238d\SI\187",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0x5d, 0x22, 0x0,  0x12, 0x8c, 0xb9, 0xe0, 0xfa, 0x52, 0xfb, 0x22, 0xd2, 0xee,
                   0x82, 0x94, 0xfd, 0xb0, 0xa7, 0xe6, 0x7f, 0x78, 0x25, 0x1,  0x0,  0x1c, 0x6b, 0x9d, 0x28, 0x25,
                   0xee, 0x90, 0x15, 0x85, 0xf6, 0xce, 0xa3, 0x77, 0xa1, 0xb4, 0x78, 0x35, 0x58, 0xf,  0x16, 0x28,
                   0x82, 0xe0, 0x75, 0xde, 0xf7, 0x9b, 0xaf, 0xc8, 0x0,  0x0,  0x19, 0xbc, 0x6b, 0x39, 0x23, 0x21,
                   0x40, 0x73, 0x2e, 0x96, 0x2b, 0x17, 0x46, 0xc5, 0x13, 0x69, 0x9f, 0x5a, 0xc5, 0x2c, 0xd6, 0xa7,
                   0xfd, 0xf5, 0x7,  0x45, 0x0,  0x0,  0x1d, 0x2b, 0xc2, 0xbc, 0xcd, 0x9d, 0xb2, 0xdd, 0x9,  0xf5,
                   0xd5, 0xfe, 0x57, 0x81, 0xfb, 0x41, 0x7,  0x56, 0xdb, 0xd2, 0x8,  0xe5, 0x3c, 0x95, 0xcc, 0x26,
                   0xc9, 0xc4, 0xb6, 0x55, 0x2,  0x0,  0x17, 0xde, 0x92, 0xea, 0x8c, 0xc3, 0x63, 0xd1, 0x4c, 0x4c,
                   0x24, 0xde, 0xb3, 0x99, 0x7f, 0xd0, 0xda, 0x84, 0xd1, 0xd6, 0x25, 0x8b, 0xe4, 0xe6, 0x1,  0x0,
                   0xe,  0x18, 0x97, 0x61, 0x45, 0xae, 0xae, 0xe1, 0xdd, 0x25, 0x4e, 0xee, 0x64, 0xf,  0xbb, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0xb9, 0xe0, 0xfa, 0x52, 0xfb, 0x22, 0xd2, 0xee,
                                     0x82, 0x94, 0xfd, 0xb0, 0xa7, 0xe6, 0x7f, 0x78, 0x25};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x9d, 0x28, 0x25, 0xee, 0x90, 0x15, 0x85, 0xf6, 0xce,
                                     0xa3, 0x77, 0xa1, 0xb4, 0x78, 0x35, 0x58, 0xf,  0x16, 0x28,
                                     0x82, 0xe0, 0x75, 0xde, 0xf7, 0x9b, 0xaf, 0xc8};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xbc, 0x6b, 0x39, 0x23, 0x21, 0x40, 0x73, 0x2e, 0x96, 0x2b, 0x17, 0x46, 0xc5,
                                     0x13, 0x69, 0x9f, 0x5a, 0xc5, 0x2c, 0xd6, 0xa7, 0xfd, 0xf5, 0x7,  0x45};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0xc2, 0xbc, 0xcd, 0x9d, 0xb2, 0xdd, 0x9,  0xf5, 0xd5,
                                     0xfe, 0x57, 0x81, 0xfb, 0x41, 0x7,  0x56, 0xdb, 0xd2, 0x8,
                                     0xe5, 0x3c, 0x95, 0xcc, 0x26, 0xc9, 0xc4, 0xb6, 0x55};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xde, 0x92, 0xea, 0x8c, 0xc3, 0x63, 0xd1, 0x4c, 0x4c, 0x24, 0xde, 0xb3,
                                     0x99, 0x7f, 0xd0, 0xda, 0x84, 0xd1, 0xd6, 0x25, 0x8b, 0xe4, 0xe6};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x18, 0x97, 0x61, 0x45, 0xae, 0xae, 0xe1, 0xdd, 0x25, 0x4e, 0xee, 0x64, 0xf, 0xbb};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23842, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26921 [("K3\SI\145\&6N\152\205\207\211\175\226(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\232\&0\ESC1 |\197\148\&8\225\CAN*\229",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x22, 0x69, 0x29, 0x0,  0xd,  0x4b, 0x33, 0xf,  0x91, 0x36, 0x4e,
                   0x98, 0xcd, 0xcf, 0xd3, 0xaf, 0xe2, 0x28, 0x0,  0x0,  0xd,  0xe8, 0x30,
                   0x1b, 0x31, 0x20, 0x7c, 0xc5, 0x94, 0x38, 0xe1, 0x18, 0x2a, 0xe5, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x4b, 0x33, 0xf, 0x91, 0x36, 0x4e, 0x98, 0xcd, 0xcf, 0xd3, 0xaf, 0xe2, 0x28};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x30, 0x1b, 0x31, 0x20, 0x7c, 0xc5, 0x94, 0x38, 0xe1, 0x18, 0x2a, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26921, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21060 [("|\157\247\167%X\146\239\FSa@\163\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),(".\147\177\f\201\211\245\229\237\RS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\EOT\149z\193\&2\140\137\131\155#}#h\153\&4",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("oo\189n\216\174\b[\219d\225\166\b\146^/\138\130\132[\235",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\176\&5\141\&1\143<\138xIV~\187\\\234\250Sa\US\240\219w8vTXw",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\164\153\198\218k\176b\231\SO",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Y\156\203\236\EOT\225\149\165[\246\158\US(\248",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\140\170^\229\250K\220\216\241\233\146\"",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x92, 0x1,  0x52, 0x44, 0x0,  0xd,  0x7c, 0x9d, 0xf7, 0xa7, 0x25, 0x58, 0x92, 0xef, 0x1c, 0x61,
                   0x40, 0xa3, 0xe1, 0x1,  0x0,  0xa,  0x2e, 0x93, 0xb1, 0xc,  0xc9, 0xd3, 0xf5, 0xe5, 0xed, 0x1e, 0x1,
                   0x0,  0xf,  0x4,  0x95, 0x7a, 0xc1, 0x32, 0x8c, 0x89, 0x83, 0x9b, 0x23, 0x7d, 0x23, 0x68, 0x99, 0x34,
                   0x1,  0x0,  0x15, 0x6f, 0x6f, 0xbd, 0x6e, 0xd8, 0xae, 0x8,  0x5b, 0xdb, 0x64, 0xe1, 0xa6, 0x8,  0x92,
                   0x5e, 0x2f, 0x8a, 0x82, 0x84, 0x5b, 0xeb, 0x2,  0x0,  0x1a, 0xb0, 0x35, 0x8d, 0x31, 0x8f, 0x3c, 0x8a,
                   0x78, 0x49, 0x56, 0x7e, 0xbb, 0x5c, 0xea, 0xfa, 0x53, 0x61, 0x1f, 0xf0, 0xdb, 0x77, 0x38, 0x76, 0x54,
                   0x58, 0x77, 0x1,  0x0,  0x9,  0xa4, 0x99, 0xc6, 0xda, 0x6b, 0xb0, 0x62, 0xe7, 0xe,  0x2,  0x0,  0xe,
                   0x59, 0x9c, 0xcb, 0xec, 0x4,  0xe1, 0x95, 0xa5, 0x5b, 0xf6, 0x9e, 0x1f, 0x28, 0xf8, 0x2,  0x0,  0xc,
                   0x8c, 0xaa, 0x5e, 0xe5, 0xfa, 0x4b, 0xdc, 0xd8, 0xf1, 0xe9, 0x92, 0x22, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x7c, 0x9d, 0xf7, 0xa7, 0x25, 0x58, 0x92, 0xef, 0x1c, 0x61, 0x40, 0xa3, 0xe1};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2e, 0x93, 0xb1, 0xc, 0xc9, 0xd3, 0xf5, 0xe5, 0xed, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4,  0x95, 0x7a, 0xc1, 0x32, 0x8c, 0x89, 0x83,
                                     0x9b, 0x23, 0x7d, 0x23, 0x68, 0x99, 0x34};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6f, 0x6f, 0xbd, 0x6e, 0xd8, 0xae, 0x8,  0x5b, 0xdb, 0x64, 0xe1,
                                     0xa6, 0x8,  0x92, 0x5e, 0x2f, 0x8a, 0x82, 0x84, 0x5b, 0xeb};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb0, 0x35, 0x8d, 0x31, 0x8f, 0x3c, 0x8a, 0x78, 0x49, 0x56, 0x7e, 0xbb, 0x5c,
                                     0xea, 0xfa, 0x53, 0x61, 0x1f, 0xf0, 0xdb, 0x77, 0x38, 0x76, 0x54, 0x58, 0x77};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa4, 0x99, 0xc6, 0xda, 0x6b, 0xb0, 0x62, 0xe7, 0xe};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0x9c, 0xcb, 0xec, 0x4, 0xe1, 0x95, 0xa5, 0x5b, 0xf6, 0x9e, 0x1f, 0x28, 0xf8};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x8c, 0xaa, 0x5e, 0xe5, 0xfa, 0x4b, 0xdc, 0xd8, 0xf1, 0xe9, 0x92, 0x22};
  lwmqtt_string_t topic_filter_s7 = {12, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21060, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18677 [("=\161\253\230\ACK|8",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("$wX\204\158I\216\&9c\142@\195\248\186>\SUBi\SYN\165H\212\242\&3;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\153\231\243Nc7\160^\177\204:\236\247\fCy\174\181\172\131A",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x3f, 0x48, 0xf5, 0x0,  0x7,  0x3d, 0xa1, 0xfd, 0xe6, 0x6,  0x7c, 0x38, 0x0,  0x0,  0x18, 0x24,
                   0x77, 0x58, 0xcc, 0x9e, 0x49, 0xd8, 0x39, 0x63, 0x8e, 0x40, 0xc3, 0xf8, 0xba, 0x3e, 0x1a, 0x69, 0x16,
                   0xa5, 0x48, 0xd4, 0xf2, 0x33, 0x3b, 0x1,  0x0,  0x15, 0x99, 0xe7, 0xf3, 0x4e, 0x63, 0x37, 0xa0, 0x5e,
                   0xb1, 0xcc, 0x3a, 0xec, 0xf7, 0xc,  0x43, 0x79, 0xae, 0xb5, 0xac, 0x83, 0x41, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x3d, 0xa1, 0xfd, 0xe6, 0x6, 0x7c, 0x38};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x24, 0x77, 0x58, 0xcc, 0x9e, 0x49, 0xd8, 0x39, 0x63, 0x8e, 0x40, 0xc3,
                                     0xf8, 0xba, 0x3e, 0x1a, 0x69, 0x16, 0xa5, 0x48, 0xd4, 0xf2, 0x33, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x99, 0xe7, 0xf3, 0x4e, 0x63, 0x37, 0xa0, 0x5e, 0xb1, 0xcc, 0x3a,
                                     0xec, 0xf7, 0xc,  0x43, 0x79, 0xae, 0xb5, 0xac, 0x83, 0x41};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18677, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15426 [(">,\208\132\222\237\163V\189v\141\DC4<\218\135\r(U",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0x17, 0x3c, 0x42, 0x0,  0x12, 0x3e, 0x2c, 0xd0, 0x84, 0xde, 0xed, 0xa3,
                   0x56, 0xbd, 0x76, 0x8d, 0x14, 0x3c, 0xda, 0x87, 0xd,  0x28, 0x55, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x3e, 0x2c, 0xd0, 0x84, 0xde, 0xed, 0xa3, 0x56, 0xbd,
                                     0x76, 0x8d, 0x14, 0x3c, 0xda, 0x87, 0xd,  0x28, 0x55};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15426, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11166 [("\253",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\160\191\253\EOT\221\233mn\DLE0\180\USn",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("F\137\196\196\246j\196\202xY\172\CANg",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\209\FS\DC3#w\220<\201Ou\SI\131]\154\159",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("`\161lN\DLE\160\DC1s:",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("6",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x48, 0x2b, 0x9e, 0x0,  0x1,  0xfd, 0x1,  0x0,  0xd,  0xa0, 0xbf, 0xfd, 0x4,  0xdd,
                   0xe9, 0x6d, 0x6e, 0x10, 0x30, 0xb4, 0x1f, 0x6e, 0x1,  0x0,  0xd,  0x46, 0x89, 0xc4, 0xc4,
                   0xf6, 0x6a, 0xc4, 0xca, 0x78, 0x59, 0xac, 0x18, 0x67, 0x1,  0x0,  0xf,  0xd1, 0x1c, 0x13,
                   0x23, 0x77, 0xdc, 0x3c, 0xc9, 0x4f, 0x75, 0xf,  0x83, 0x5d, 0x9a, 0x9f, 0x2,  0x0,  0x9,
                   0x60, 0xa1, 0x6c, 0x4e, 0x10, 0xa0, 0x11, 0x73, 0x3a, 0x0,  0x0,  0x1,  0x36, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xfd};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xbf, 0xfd, 0x4, 0xdd, 0xe9, 0x6d, 0x6e, 0x10, 0x30, 0xb4, 0x1f, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0x89, 0xc4, 0xc4, 0xf6, 0x6a, 0xc4, 0xca, 0x78, 0x59, 0xac, 0x18, 0x67};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x1c, 0x13, 0x23, 0x77, 0xdc, 0x3c, 0xc9,
                                     0x4f, 0x75, 0xf,  0x83, 0x5d, 0x9a, 0x9f};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x60, 0xa1, 0x6c, 0x4e, 0x10, 0xa0, 0x11, 0x73, 0x3a};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x36};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11166, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9472 [("\243\DC2\199A\218\167\CAN\SYN\220w\165\160\NAK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247\192Pw\199\196)T\SI\142wV\188!\138\241[\171",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("]\205\240x6\SI\137\238\166K\152\156\181ri\NUL\224\130^\f\190\132\156\170\149\199U\142n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x47, 0x25, 0x0,  0x0,  0xd,  0xf3, 0x12, 0xc7, 0x41, 0xda, 0xa7, 0x18, 0x16, 0xdc,
                   0x77, 0xa5, 0xa0, 0x15, 0x2,  0x0,  0x12, 0xf7, 0xc0, 0x50, 0x77, 0xc7, 0xc4, 0x29, 0x54,
                   0xf,  0x8e, 0x77, 0x56, 0xbc, 0x21, 0x8a, 0xf1, 0x5b, 0xab, 0x2,  0x0,  0x1d, 0x5d, 0xcd,
                   0xf0, 0x78, 0x36, 0xf,  0x89, 0xee, 0xa6, 0x4b, 0x98, 0x9c, 0xb5, 0x72, 0x69, 0x0,  0xe0,
                   0x82, 0x5e, 0xc,  0xbe, 0x84, 0x9c, 0xaa, 0x95, 0xc7, 0x55, 0x8e, 0x6e, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf3, 0x12, 0xc7, 0x41, 0xda, 0xa7, 0x18, 0x16, 0xdc, 0x77, 0xa5, 0xa0, 0x15};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf7, 0xc0, 0x50, 0x77, 0xc7, 0xc4, 0x29, 0x54, 0xf,
                                     0x8e, 0x77, 0x56, 0xbc, 0x21, 0x8a, 0xf1, 0x5b, 0xab};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5d, 0xcd, 0xf0, 0x78, 0x36, 0xf,  0x89, 0xee, 0xa6, 0x4b,
                                     0x98, 0x9c, 0xb5, 0x72, 0x69, 0x0,  0xe0, 0x82, 0x5e, 0xc,
                                     0xbe, 0x84, 0x9c, 0xaa, 0x95, 0xc7, 0x55, 0x8e, 0x6e};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9472, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18189 [("\142\SUB\241ET\151\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("t\160\t\216\&0\193Dg",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\218\225\n\t_\\\243\201\136\236\156E\172\217C\208\EOTn\147\225\145",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167NE\EOT\132/\SIWTa\223|'\178]?\227\170O",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\208\238\156.\186\253",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\227\238\151ou]\230\234\ETB\aQ\170\218",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\249\a\164!\177YC\194\&0\183f\212\212Y\NAK\EOT\178\179",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\CANk+w\218\153\151\DEL\179U\STXl\DC2\SUBE\251\241\208",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\132B\f\206\169",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x97, 0x1,  0x47, 0xd,  0x0,  0x7,  0x8e, 0x1a, 0xf1, 0x45, 0x54, 0x97, 0xe8, 0x2,  0x0,
                   0x8,  0x74, 0xa0, 0x9,  0xd8, 0x30, 0xc1, 0x44, 0x67, 0x1,  0x0,  0x15, 0xda, 0xe1, 0xa,  0x9,
                   0x5f, 0x5c, 0xf3, 0xc9, 0x88, 0xec, 0x9c, 0x45, 0xac, 0xd9, 0x43, 0xd0, 0x4,  0x6e, 0x93, 0xe1,
                   0x91, 0x0,  0x0,  0x13, 0xa7, 0x4e, 0x45, 0x4,  0x84, 0x2f, 0xf,  0x57, 0x54, 0x61, 0xdf, 0x7c,
                   0x27, 0xb2, 0x5d, 0x3f, 0xe3, 0xaa, 0x4f, 0x2,  0x0,  0x6,  0xd0, 0xee, 0x9c, 0x2e, 0xba, 0xfd,
                   0x1,  0x0,  0xd,  0xe3, 0xee, 0x97, 0x6f, 0x75, 0x5d, 0xe6, 0xea, 0x17, 0x7,  0x51, 0xaa, 0xda,
                   0x2,  0x0,  0x0,  0x1,  0x0,  0x12, 0xf9, 0x7,  0xa4, 0x21, 0xb1, 0x59, 0x43, 0xc2, 0x30, 0xb7,
                   0x66, 0xd4, 0xd4, 0x59, 0x15, 0x4,  0xb2, 0xb3, 0x0,  0x0,  0x1,  0x5b, 0x0,  0x0,  0x12, 0x18,
                   0x6b, 0x2b, 0x77, 0xda, 0x99, 0x97, 0x7f, 0xb3, 0x55, 0x2,  0x6c, 0x12, 0x1a, 0x45, 0xfb, 0xf1,
                   0xd0, 0x0,  0x0,  0x5,  0x84, 0x42, 0xc,  0xce, 0xa9, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x8e, 0x1a, 0xf1, 0x45, 0x54, 0x97, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x74, 0xa0, 0x9, 0xd8, 0x30, 0xc1, 0x44, 0x67};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xda, 0xe1, 0xa,  0x9,  0x5f, 0x5c, 0xf3, 0xc9, 0x88, 0xec, 0x9c,
                                     0x45, 0xac, 0xd9, 0x43, 0xd0, 0x4,  0x6e, 0x93, 0xe1, 0x91};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa7, 0x4e, 0x45, 0x4,  0x84, 0x2f, 0xf,  0x57, 0x54, 0x61,
                                     0xdf, 0x7c, 0x27, 0xb2, 0x5d, 0x3f, 0xe3, 0xaa, 0x4f};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd0, 0xee, 0x9c, 0x2e, 0xba, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe3, 0xee, 0x97, 0x6f, 0x75, 0x5d, 0xe6, 0xea, 0x17, 0x7, 0x51, 0xaa, 0xda};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf9, 0x7,  0xa4, 0x21, 0xb1, 0x59, 0x43, 0xc2, 0x30,
                                     0xb7, 0x66, 0xd4, 0xd4, 0x59, 0x15, 0x4,  0xb2, 0xb3};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x5b};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x18, 0x6b, 0x2b, 0x77, 0xda, 0x99, 0x97, 0x7f, 0xb3,
                                     0x55, 0x2,  0x6c, 0x12, 0x1a, 0x45, 0xfb, 0xf1, 0xd0};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x84, 0x42, 0xc, 0xce, 0xa9};
  lwmqtt_string_t topic_filter_s10 = {5, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18189, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5047 [("H\129E$_\201\142?\214\245~\170",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\EOT\171",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("|\130\163TL\202",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\147^\181B\US12\255U",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal
// = False, _subQoS = QoS2}),("\185\DC1\142\241\ENQ\"\ETX",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\139\130\222\tW\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropRetainAvailable
// 155,PropTopicAlias 4606,PropContentType
// "rE!\226\208\253(f%\144\226\238\210\235p\a\DC3;&\224[q\250T\181}\192",PropMessageExpiryInterval
// 16020,PropRetainAvailable 0]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x69, 0x13, 0xb7, 0x2a, 0x25, 0x9b, 0x23, 0x11, 0xfe, 0x3,  0x0,  0x1b, 0x72, 0x45, 0x21,
                   0xe2, 0xd0, 0xfd, 0x28, 0x66, 0x25, 0x90, 0xe2, 0xee, 0xd2, 0xeb, 0x70, 0x7,  0x13, 0x3b, 0x26,
                   0xe0, 0x5b, 0x71, 0xfa, 0x54, 0xb5, 0x7d, 0xc0, 0x2,  0x0,  0x0,  0x3e, 0x94, 0x25, 0x0,  0x0,
                   0xc,  0x48, 0x81, 0x45, 0x24, 0x5f, 0xc9, 0x8e, 0x3f, 0xd6, 0xf5, 0x7e, 0xaa, 0xa,  0x0,  0x2,
                   0x4,  0xab, 0x2c, 0x0,  0x6,  0x7c, 0x82, 0xa3, 0x54, 0x4c, 0xca, 0x2d, 0x0,  0x9,  0x93, 0x5e,
                   0xb5, 0x42, 0x1f, 0x31, 0x32, 0xff, 0x55, 0x1a, 0x0,  0x7,  0xb9, 0x11, 0x8e, 0xf1, 0x5,  0x22,
                   0x3,  0x0,  0x0,  0x6,  0x8b, 0x82, 0xde, 0x9,  0x57, 0xf,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x48, 0x81, 0x45, 0x24, 0x5f, 0xc9, 0x8e, 0x3f, 0xd6, 0xf5, 0x7e, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4, 0xab};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7c, 0x82, 0xa3, 0x54, 0x4c, 0xca};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0x5e, 0xb5, 0x42, 0x1f, 0x31, 0x32, 0xff, 0x55};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb9, 0x11, 0x8e, 0xf1, 0x5, 0x22, 0x3};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8b, 0x82, 0xde, 0x9, 0x57, 0xf};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x72, 0x45, 0x21, 0xe2, 0xd0, 0xfd, 0x28, 0x66, 0x25, 0x90, 0xe2, 0xee, 0xd2, 0xeb,
                           0x70, 0x7,  0x13, 0x3b, 0x26, 0xe0, 0x5b, 0x71, 0xfa, 0x54, 0xb5, 0x7d, 0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4606}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16020}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 0}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5047, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3206 [("\DC12^",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS1}),("\184\136",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1}),("$\217\231uJ\220\&4\205\163\&2\171'\203P\ESC\252\228\SOH\202",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropReceiveMaximum 31812,PropSubscriptionIdentifierAvailable 200,PropMessageExpiryInterval 26308,PropServerKeepAlive
// 30441,PropTopicAliasMaximum 19633,PropWillDelayInterval 20710,PropCorrelationData
// "5\129\DLE\230\230\208\247\178\233\US",PropServerReference
// "\140\235\247\&2\198j\188\149\&8\243*\185\ETX\b\DEL\144\183Je\138\SI\227\193\218\239C\252"]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x64, 0xc,  0x86, 0x40, 0x21, 0x7c, 0x44, 0x29, 0xc8, 0x2,  0x0,  0x0,  0x66, 0xc4,
                   0x13, 0x76, 0xe9, 0x22, 0x4c, 0xb1, 0x18, 0x0,  0x0,  0x50, 0xe6, 0x9,  0x0,  0xa,  0x35,
                   0x81, 0x10, 0xe6, 0xe6, 0xd0, 0xf7, 0xb2, 0xe9, 0x1f, 0x1c, 0x0,  0x1b, 0x8c, 0xeb, 0xf7,
                   0x32, 0xc6, 0x6a, 0xbc, 0x95, 0x38, 0xf3, 0x2a, 0xb9, 0x3,  0x8,  0x7f, 0x90, 0xb7, 0x4a,
                   0x65, 0x8a, 0xf,  0xe3, 0xc1, 0xda, 0xef, 0x43, 0xfc, 0x0,  0x3,  0x11, 0x32, 0x5e, 0x15,
                   0x0,  0x2,  0xb8, 0x88, 0x15, 0x0,  0x13, 0x24, 0xd9, 0xe7, 0x75, 0x4a, 0xdc, 0x34, 0xcd,
                   0xa3, 0x32, 0xab, 0x27, 0xcb, 0x50, 0x1b, 0xfc, 0xe4, 0x1,  0xca, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0x32, 0x5e};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb8, 0x88};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x24, 0xd9, 0xe7, 0x75, 0x4a, 0xdc, 0x34, 0xcd, 0xa3, 0x32,
                                     0xab, 0x27, 0xcb, 0x50, 0x1b, 0xfc, 0xe4, 0x1,  0xca};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0x35, 0x81, 0x10, 0xe6, 0xe6, 0xd0, 0xf7, 0xb2, 0xe9, 0x1f};
  uint8_t bytesprops1[] = {0x8c, 0xeb, 0xf7, 0x32, 0xc6, 0x6a, 0xbc, 0x95, 0x38, 0xf3, 0x2a, 0xb9, 0x3, 0x8,
                           0x7f, 0x90, 0xb7, 0x4a, 0x65, 0x8a, 0xf,  0xe3, 0xc1, 0xda, 0xef, 0x43, 0xfc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31812}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26308}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30441}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19633}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20710}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3206, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13602 [("\183z",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS2}),("1\166\179}\189\167\248\176&\209\EMo\162",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("`\230^\177X\132'\DLE}\211",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("4\242",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationData
// "\210H\248t]\184-\DLE_1h\176\&2`7\164\228\139`L\133\247x\f\EOT\219\155\NAK\184",PropAssignedClientIdentifier
// "[\ACK\SO\137B\227\f\227\STX\ESC\147\167a\f\228$\244\248\159\252/m\EM5\165d",PropRetainAvailable
// 200,PropSessionExpiryInterval 14750,PropSessionExpiryInterval 29200,PropReceiveMaximum 27613]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x76, 0x35, 0x22, 0x4c, 0x16, 0x0,  0x1d, 0xd2, 0x48, 0xf8, 0x74, 0x5d, 0xb8, 0x2d,
                   0x10, 0x5f, 0x31, 0x68, 0xb0, 0x32, 0x60, 0x37, 0xa4, 0xe4, 0x8b, 0x60, 0x4c, 0x85, 0xf7,
                   0x78, 0xc,  0x4,  0xdb, 0x9b, 0x15, 0xb8, 0x12, 0x0,  0x1a, 0x5b, 0x6,  0xe,  0x89, 0x42,
                   0xe3, 0xc,  0xe3, 0x2,  0x1b, 0x93, 0xa7, 0x61, 0xc,  0xe4, 0x24, 0xf4, 0xf8, 0x9f, 0xfc,
                   0x2f, 0x6d, 0x19, 0x35, 0xa5, 0x64, 0x25, 0xc8, 0x11, 0x0,  0x0,  0x39, 0x9e, 0x11, 0x0,
                   0x0,  0x72, 0x10, 0x21, 0x6b, 0xdd, 0x0,  0x2,  0xb7, 0x7a, 0x2e, 0x0,  0xd,  0x31, 0xa6,
                   0xb3, 0x7d, 0xbd, 0xa7, 0xf8, 0xb0, 0x26, 0xd1, 0x19, 0x6f, 0xa2, 0x25, 0x0,  0xa,  0x60,
                   0xe6, 0x5e, 0xb1, 0x58, 0x84, 0x27, 0x10, 0x7d, 0xd3, 0x16, 0x0,  0x2,  0x34, 0xf2, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x7a};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x31, 0xa6, 0xb3, 0x7d, 0xbd, 0xa7, 0xf8, 0xb0, 0x26, 0xd1, 0x19, 0x6f, 0xa2};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x60, 0xe6, 0x5e, 0xb1, 0x58, 0x84, 0x27, 0x10, 0x7d, 0xd3};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0xf2};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0xd2, 0x48, 0xf8, 0x74, 0x5d, 0xb8, 0x2d, 0x10, 0x5f, 0x31, 0x68, 0xb0, 0x32, 0x60, 0x37,
                           0xa4, 0xe4, 0x8b, 0x60, 0x4c, 0x85, 0xf7, 0x78, 0xc,  0x4,  0xdb, 0x9b, 0x15, 0xb8};
  uint8_t bytesprops1[] = {0x5b, 0x6,  0xe,  0x89, 0x42, 0xe3, 0xc,  0xe3, 0x2,  0x1b, 0x93, 0xa7, 0x61,
                           0xc,  0xe4, 0x24, 0xf4, 0xf8, 0x9f, 0xfc, 0x2f, 0x6d, 0x19, 0x35, 0xa5, 0x64};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14750}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29200}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27613}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13602, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14384 [("\FS\128\241\248\208\137C~(\163%\158w",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("5X8\205\211\235pK\ETBW@\NUL:\138\244U\176\143\vel\244x_\255\153",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("r^\143\162\178\168\192\172\141.\SI\245\a\221\ETBN\254w\DC4\141\EMJ\141)3\194\246",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\t",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\144\194A\232\SOH\155\ESCL\\\214\&8\169\DC2\239\173\&0\DC4P:&",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("i\129\v\240\205@PA/",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS1}),("A!\225\138=",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS =
// QoS1}),("\169\193\&8B\138\143\CAN~=\150\240\216U\168\DLECx\DEL(\245\135\&1G|1\144F",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropSubscriptionIdentifier
// 27,PropMaximumQoS 159,PropResponseInformation ">@\179\ESCy\155\147\164\DC3\169",PropUserProperty
// "#\152\SUB\245|\GSb\153`\v\145Ob\242\183\254\195"
// "\192\225d\NAK\239\r\239\211h*\134\228^\148\158\214-\217\140\231\SYN\199\203m\185\162",PropPayloadFormatIndicator
// 251,PropMessageExpiryInterval 17985,PropWildcardSubscriptionAvailable 47,PropRetainAvailable 9,PropCorrelationData
// "\DC1\DEL#)\r\231\FS\245Ta$\RS\171\182\246\219\r\211\NAK\SYN",PropRequestResponseInformation
// 138,PropMessageExpiryInterval 4082,PropServerReference "
// \204\255\&7\193\208u\SUB\142\&7\167\165vD\217xu\195\240\192\180\231\ACK\186",PropRetainAvailable
// 102,PropRequestResponseInformation 215,PropRequestResponseInformation 117]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xa7, 0x2,  0x38, 0x30, 0x8b, 0x1,  0xb,  0x1b, 0x24, 0x9f, 0x1a, 0x0,  0xa,  0x3e, 0x40, 0xb3, 0x1b, 0x79,
      0x9b, 0x93, 0xa4, 0x13, 0xa9, 0x26, 0x0,  0x11, 0x23, 0x98, 0x1a, 0xf5, 0x7c, 0x1d, 0x62, 0x99, 0x60, 0xb,  0x91,
      0x4f, 0x62, 0xf2, 0xb7, 0xfe, 0xc3, 0x0,  0x1a, 0xc0, 0xe1, 0x64, 0x15, 0xef, 0xd,  0xef, 0xd3, 0x68, 0x2a, 0x86,
      0xe4, 0x5e, 0x94, 0x9e, 0xd6, 0x2d, 0xd9, 0x8c, 0xe7, 0x16, 0xc7, 0xcb, 0x6d, 0xb9, 0xa2, 0x1,  0xfb, 0x2,  0x0,
      0x0,  0x46, 0x41, 0x28, 0x2f, 0x25, 0x9,  0x9,  0x0,  0x14, 0x11, 0x7f, 0x23, 0x29, 0xd,  0xe7, 0x1c, 0xf5, 0x54,
      0x61, 0x24, 0x1e, 0xab, 0xb6, 0xf6, 0xdb, 0xd,  0xd3, 0x15, 0x16, 0x19, 0x8a, 0x2,  0x0,  0x0,  0xf,  0xf2, 0x1c,
      0x0,  0x18, 0x20, 0xcc, 0xff, 0x37, 0xc1, 0xd0, 0x75, 0x1a, 0x8e, 0x37, 0xa7, 0xa5, 0x76, 0x44, 0xd9, 0x78, 0x75,
      0xc3, 0xf0, 0xc0, 0xb4, 0xe7, 0x6,  0xba, 0x25, 0x66, 0x19, 0xd7, 0x19, 0x75, 0x0,  0xd,  0x1c, 0x80, 0xf1, 0xf8,
      0xd0, 0x89, 0x43, 0x7e, 0x28, 0xa3, 0x25, 0x9e, 0x77, 0x19, 0x0,  0x1a, 0x35, 0x58, 0x38, 0xcd, 0xd3, 0xeb, 0x70,
      0x4b, 0x17, 0x57, 0x40, 0x0,  0x3a, 0x8a, 0xf4, 0x55, 0xb0, 0x8f, 0xb,  0x65, 0x6c, 0xf4, 0x78, 0x5f, 0xff, 0x99,
      0x19, 0x0,  0x1b, 0x72, 0x5e, 0x8f, 0xa2, 0xb2, 0xa8, 0xc0, 0xac, 0x8d, 0x2e, 0xf,  0xf5, 0x7,  0xdd, 0x17, 0x4e,
      0xfe, 0x77, 0x14, 0x8d, 0x19, 0x4a, 0x8d, 0x29, 0x33, 0xc2, 0xf6, 0xe,  0x0,  0x1,  0x9,  0x2a, 0x0,  0x14, 0x90,
      0xc2, 0x41, 0xe8, 0x1,  0x9b, 0x1b, 0x4c, 0x5c, 0xd6, 0x38, 0xa9, 0x12, 0xef, 0xad, 0x30, 0x14, 0x50, 0x3a, 0x26,
      0x21, 0x0,  0x9,  0x69, 0x81, 0xb,  0xf0, 0xcd, 0x40, 0x50, 0x41, 0x2f, 0x19, 0x0,  0x5,  0x41, 0x21, 0xe1, 0x8a,
      0x3d, 0x25, 0x0,  0x1b, 0xa9, 0xc1, 0x38, 0x42, 0x8a, 0x8f, 0x18, 0x7e, 0x3d, 0x96, 0xf0, 0xd8, 0x55, 0xa8, 0x10,
      0x43, 0x78, 0x7f, 0x28, 0xf5, 0x87, 0x31, 0x47, 0x7c, 0x31, 0x90, 0x46, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0x80, 0xf1, 0xf8, 0xd0, 0x89, 0x43, 0x7e, 0x28, 0xa3, 0x25, 0x9e, 0x77};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0x58, 0x38, 0xcd, 0xd3, 0xeb, 0x70, 0x4b, 0x17, 0x57, 0x40, 0x0,  0x3a,
                                     0x8a, 0xf4, 0x55, 0xb0, 0x8f, 0xb,  0x65, 0x6c, 0xf4, 0x78, 0x5f, 0xff, 0x99};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x72, 0x5e, 0x8f, 0xa2, 0xb2, 0xa8, 0xc0, 0xac, 0x8d, 0x2e, 0xf,  0xf5, 0x7, 0xdd,
                                     0x17, 0x4e, 0xfe, 0x77, 0x14, 0x8d, 0x19, 0x4a, 0x8d, 0x29, 0x33, 0xc2, 0xf6};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x90, 0xc2, 0x41, 0xe8, 0x1,  0x9b, 0x1b, 0x4c, 0x5c, 0xd6,
                                     0x38, 0xa9, 0x12, 0xef, 0xad, 0x30, 0x14, 0x50, 0x3a, 0x26};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0x81, 0xb, 0xf0, 0xcd, 0x40, 0x50, 0x41, 0x2f};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x21, 0xe1, 0x8a, 0x3d};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa9, 0xc1, 0x38, 0x42, 0x8a, 0x8f, 0x18, 0x7e, 0x3d, 0x96, 0xf0, 0xd8, 0x55, 0xa8,
                                     0x10, 0x43, 0x78, 0x7f, 0x28, 0xf5, 0x87, 0x31, 0x47, 0x7c, 0x31, 0x90, 0x46};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0x3e, 0x40, 0xb3, 0x1b, 0x79, 0x9b, 0x93, 0xa4, 0x13, 0xa9};
  uint8_t bytesprops2[] = {0xc0, 0xe1, 0x64, 0x15, 0xef, 0xd,  0xef, 0xd3, 0x68, 0x2a, 0x86, 0xe4, 0x5e,
                           0x94, 0x9e, 0xd6, 0x2d, 0xd9, 0x8c, 0xe7, 0x16, 0xc7, 0xcb, 0x6d, 0xb9, 0xa2};
  uint8_t bytesprops1[] = {0x23, 0x98, 0x1a, 0xf5, 0x7c, 0x1d, 0x62, 0x99, 0x60,
                           0xb,  0x91, 0x4f, 0x62, 0xf2, 0xb7, 0xfe, 0xc3};
  uint8_t bytesprops3[] = {0x11, 0x7f, 0x23, 0x29, 0xd,  0xe7, 0x1c, 0xf5, 0x54, 0x61,
                           0x24, 0x1e, 0xab, 0xb6, 0xf6, 0xdb, 0xd,  0xd3, 0x15, 0x16};
  uint8_t bytesprops4[] = {0x20, 0xcc, 0xff, 0x37, 0xc1, 0xd0, 0x75, 0x1a, 0x8e, 0x37, 0xa7, 0xa5,
                           0x76, 0x44, 0xd9, 0x78, 0x75, 0xc3, 0xf0, 0xc0, 0xb4, 0xe7, 0x6,  0xba};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {26, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17985}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4082}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14384, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10952 [("\189\131\143u\249\178\237\221\225\135\200_E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\138:\130%\226\132\219i%\244x~=X\220\GS\224\244\133\144\194O\240\154",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\184*~\237,+2\155\&2P\221\197",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\172\&6\205I;\188o",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("-\ETB\193\208",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ENQ\r\210U\140\DC2\148\199\188\163\197]",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("yr \203n\154\&6\197\134\218xJ\DC4\144",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("8Y\218Q\175\&2",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS2})] [PropReasonString "\ENQT\246",PropMaximumQoS 247,PropAuthenticationMethod
// "K\r0\153\217\FS",PropRequestResponseInformation 112,PropReceiveMaximum 11958,PropPayloadFormatIndicator
// 68,PropMaximumQoS 59]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x91, 0x1,  0x2a, 0xc8, 0x1a, 0x1f, 0x0,  0x3,  0x5,  0x54, 0xf6, 0x24, 0xf7, 0x15, 0x0,  0x6,
                   0x4b, 0xd,  0x30, 0x99, 0xd9, 0x1c, 0x19, 0x70, 0x21, 0x2e, 0xb6, 0x1,  0x44, 0x24, 0x3b, 0x0,  0xd,
                   0xbd, 0x83, 0x8f, 0x75, 0xf9, 0xb2, 0xed, 0xdd, 0xe1, 0x87, 0xc8, 0x5f, 0x45, 0x2,  0x0,  0x18, 0x8a,
                   0x3a, 0x82, 0x25, 0xe2, 0x84, 0xdb, 0x69, 0x25, 0xf4, 0x78, 0x7e, 0x3d, 0x58, 0xdc, 0x1d, 0xe0, 0xf4,
                   0x85, 0x90, 0xc2, 0x4f, 0xf0, 0x9a, 0x1d, 0x0,  0xc,  0xb8, 0x2a, 0x7e, 0xed, 0x2c, 0x2b, 0x32, 0x9b,
                   0x32, 0x50, 0xdd, 0xc5, 0x1c, 0x0,  0x7,  0xac, 0x36, 0xcd, 0x49, 0x3b, 0xbc, 0x6f, 0x2e, 0x0,  0x4,
                   0x2d, 0x17, 0xc1, 0xd0, 0x1,  0x0,  0xc,  0x5,  0xd,  0xd2, 0x55, 0x8c, 0x12, 0x94, 0xc7, 0xbc, 0xa3,
                   0xc5, 0x5d, 0x2d, 0x0,  0xe,  0x79, 0x72, 0x20, 0xcb, 0x6e, 0x9a, 0x36, 0xc5, 0x86, 0xda, 0x78, 0x4a,
                   0x14, 0x90, 0x1,  0x0,  0x6,  0x38, 0x59, 0xda, 0x51, 0xaf, 0x32, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xbd, 0x83, 0x8f, 0x75, 0xf9, 0xb2, 0xed, 0xdd, 0xe1, 0x87, 0xc8, 0x5f, 0x45};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8a, 0x3a, 0x82, 0x25, 0xe2, 0x84, 0xdb, 0x69, 0x25, 0xf4, 0x78, 0x7e,
                                     0x3d, 0x58, 0xdc, 0x1d, 0xe0, 0xf4, 0x85, 0x90, 0xc2, 0x4f, 0xf0, 0x9a};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb8, 0x2a, 0x7e, 0xed, 0x2c, 0x2b, 0x32, 0x9b, 0x32, 0x50, 0xdd, 0xc5};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xac, 0x36, 0xcd, 0x49, 0x3b, 0xbc, 0x6f};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2d, 0x17, 0xc1, 0xd0};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5, 0xd, 0xd2, 0x55, 0x8c, 0x12, 0x94, 0xc7, 0xbc, 0xa3, 0xc5, 0x5d};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x79, 0x72, 0x20, 0xcb, 0x6e, 0x9a, 0x36,
                                     0xc5, 0x86, 0xda, 0x78, 0x4a, 0x14, 0x90};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x38, 0x59, 0xda, 0x51, 0xaf, 0x32};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0x5, 0x54, 0xf6};
  uint8_t bytesprops1[] = {0x4b, 0xd, 0x30, 0x99, 0xd9, 0x1c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11958}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 59}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10952, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20143
// [("N\178\188\208\255\162\DEL;\181\212\177\147\234\168\234)\194x\206K)\DC1\247\191\&4f\155",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\f\163<Q_'\138_Bk2\219\197\237",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("Y\216yn2*\204\190",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("p_3}{5\172\184\FS\149\167\144\239fI\246@RL\220*\197L/N\217A\183\210",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\214L\190\SO\210\190\221VLW\157\159\167|@\167\&0<\t\230\SOM\DC3r\187\218\238",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] []
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x7f, 0x4e, 0xaf, 0x0,  0x0,  0x1b, 0x4e, 0xb2, 0xbc, 0xd0, 0xff, 0xa2, 0x7f, 0x3b, 0xb5, 0xd4,
                   0xb1, 0x93, 0xea, 0xa8, 0xea, 0x29, 0xc2, 0x78, 0xce, 0x4b, 0x29, 0x11, 0xf7, 0xbf, 0x34, 0x66, 0x9b,
                   0x26, 0x0,  0xe,  0xc,  0xa3, 0x3c, 0x51, 0x5f, 0x27, 0x8a, 0x5f, 0x42, 0x6b, 0x32, 0xdb, 0xc5, 0xed,
                   0xa,  0x0,  0x8,  0x59, 0xd8, 0x79, 0x6e, 0x32, 0x2a, 0xcc, 0xbe, 0x2c, 0x0,  0x1,  0x28, 0xc,  0x0,
                   0x1d, 0x70, 0x5f, 0x33, 0x7d, 0x7b, 0x35, 0xac, 0xb8, 0x1c, 0x95, 0xa7, 0x90, 0xef, 0x66, 0x49, 0xf6,
                   0x40, 0x52, 0x4c, 0xdc, 0x2a, 0xc5, 0x4c, 0x2f, 0x4e, 0xd9, 0x41, 0xb7, 0xd2, 0x29, 0x0,  0x1b, 0xd6,
                   0x4c, 0xbe, 0xe,  0xd2, 0xbe, 0xdd, 0x56, 0x4c, 0x57, 0x9d, 0x9f, 0xa7, 0x7c, 0x40, 0xa7, 0x30, 0x3c,
                   0x9,  0xe6, 0xe,  0x4d, 0x13, 0x72, 0xbb, 0xda, 0xee, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4e, 0xb2, 0xbc, 0xd0, 0xff, 0xa2, 0x7f, 0x3b, 0xb5, 0xd4, 0xb1, 0x93, 0xea, 0xa8,
                                     0xea, 0x29, 0xc2, 0x78, 0xce, 0x4b, 0x29, 0x11, 0xf7, 0xbf, 0x34, 0x66, 0x9b};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc, 0xa3, 0x3c, 0x51, 0x5f, 0x27, 0x8a, 0x5f, 0x42, 0x6b, 0x32, 0xdb, 0xc5, 0xed};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x59, 0xd8, 0x79, 0x6e, 0x32, 0x2a, 0xcc, 0xbe};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x28};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x70, 0x5f, 0x33, 0x7d, 0x7b, 0x35, 0xac, 0xb8, 0x1c, 0x95,
                                     0xa7, 0x90, 0xef, 0x66, 0x49, 0xf6, 0x40, 0x52, 0x4c, 0xdc,
                                     0x2a, 0xc5, 0x4c, 0x2f, 0x4e, 0xd9, 0x41, 0xb7, 0xd2};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd6, 0x4c, 0xbe, 0xe,  0xd2, 0xbe, 0xdd, 0x56, 0x4c, 0x57, 0x9d, 0x9f, 0xa7, 0x7c,
                                     0x40, 0xa7, 0x30, 0x3c, 0x9,  0xe6, 0xe,  0x4d, 0x13, 0x72, 0xbb, 0xda, 0xee};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20143, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3461 [(".J\171\DEL\160\194\225\225\175\215,B\140X\DC1\n`R\184j\164ZB\ENQ",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248a\225\201p\DC1\181Fv\210\218\SO\224\SUB",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("F\239\160",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\183.\246y\164\162\208y\STX",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\202\130\192\137\231\STX\164\EM\195z\168#Tej\129O>kO\229g",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),(",\255\175\ENQ\139\179%\241\252\148^\228T\243\DLE",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\DEL\152",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\ACK\168&\158\RS\EM(\144%\ACKy\f\185=\229\161\139\170\SOH",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\RSMD\EM\154\220\162\b\165\174\174Z\246\DLE$\b\193",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropAuthenticationMethod
// "x\212\152\154t\129",PropWillDelayInterval 23768,PropMaximumPacketSize 4377,PropUserProperty "\218Wa\190I"
// "&",PropMessageExpiryInterval 12138,PropAuthenticationMethod
// "\144\205[\206\179\b\151\131\138\DC1\163\128\173\253(S\187_\173\235\174\209\240\229h^l\156",PropReasonString
// "\v\151Ft\139v\136\167\SO[q",PropMaximumQoS 123,PropServerKeepAlive 14339,PropContentType
// "\137\147\215\215\NAK\168`jX3\"\243",PropRequestResponseInformation 133,PropWillDelayInterval
// 26823,PropResponseInformation "\USn\226Y8\247\180\&4\241\&0N\vU",PropReasonString "\145",PropRetainAvailable
// 117,PropTopicAlias 7329,PropMaximumPacketSize 25747,PropMaximumQoS 237,PropWildcardSubscriptionAvailable
// 187,PropSessionExpiryInterval 28904,PropServerKeepAlive 25814,PropRequestResponseInformation 14]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xb6, 0x2,  0xd,  0x85, 0x97, 0x1,  0x15, 0x0,  0x6,  0x78, 0xd4, 0x98, 0x9a, 0x74, 0x81, 0x18, 0x0,  0x0,
      0x5c, 0xd8, 0x27, 0x0,  0x0,  0x11, 0x19, 0x26, 0x0,  0x5,  0xda, 0x57, 0x61, 0xbe, 0x49, 0x0,  0x1,  0x26, 0x2,
      0x0,  0x0,  0x2f, 0x6a, 0x15, 0x0,  0x1c, 0x90, 0xcd, 0x5b, 0xce, 0xb3, 0x8,  0x97, 0x83, 0x8a, 0x11, 0xa3, 0x80,
      0xad, 0xfd, 0x28, 0x53, 0xbb, 0x5f, 0xad, 0xeb, 0xae, 0xd1, 0xf0, 0xe5, 0x68, 0x5e, 0x6c, 0x9c, 0x1f, 0x0,  0xb,
      0xb,  0x97, 0x46, 0x74, 0x8b, 0x76, 0x88, 0xa7, 0xe,  0x5b, 0x71, 0x24, 0x7b, 0x13, 0x38, 0x3,  0x3,  0x0,  0xc,
      0x89, 0x93, 0xd7, 0xd7, 0x15, 0xa8, 0x60, 0x6a, 0x58, 0x33, 0x22, 0xf3, 0x19, 0x85, 0x18, 0x0,  0x0,  0x68, 0xc7,
      0x1a, 0x0,  0xd,  0x1f, 0x6e, 0xe2, 0x59, 0x38, 0xf7, 0xb4, 0x34, 0xf1, 0x30, 0x4e, 0xb,  0x55, 0x1f, 0x0,  0x1,
      0x91, 0x25, 0x75, 0x23, 0x1c, 0xa1, 0x27, 0x0,  0x0,  0x64, 0x93, 0x24, 0xed, 0x28, 0xbb, 0x11, 0x0,  0x0,  0x70,
      0xe8, 0x13, 0x64, 0xd6, 0x19, 0xe,  0x0,  0x18, 0x2e, 0x4a, 0xab, 0x7f, 0xa0, 0xc2, 0xe1, 0xe1, 0xaf, 0xd7, 0x2c,
      0x42, 0x8c, 0x58, 0x11, 0xa,  0x60, 0x52, 0xb8, 0x6a, 0xa4, 0x5a, 0x42, 0x5,  0x22, 0x0,  0xe,  0xf8, 0x61, 0xe1,
      0xc9, 0x70, 0x11, 0xb5, 0x46, 0x76, 0xd2, 0xda, 0xe,  0xe0, 0x1a, 0x2d, 0x0,  0x3,  0x46, 0xef, 0xa0, 0x18, 0x0,
      0x9,  0xb7, 0x2e, 0xf6, 0x79, 0xa4, 0xa2, 0xd0, 0x79, 0x2,  0x2c, 0x0,  0x16, 0xca, 0x82, 0xc0, 0x89, 0xe7, 0x2,
      0xa4, 0x19, 0xc3, 0x7a, 0xa8, 0x23, 0x54, 0x65, 0x6a, 0x81, 0x4f, 0x3e, 0x6b, 0x4f, 0xe5, 0x67, 0x28, 0x0,  0xf,
      0x2c, 0xff, 0xaf, 0x5,  0x8b, 0xb3, 0x25, 0xf1, 0xfc, 0x94, 0x5e, 0xe4, 0x54, 0xf3, 0x10, 0xe,  0x0,  0x2,  0x7f,
      0x98, 0x29, 0x0,  0x0,  0x18, 0x0,  0x13, 0x6,  0xa8, 0x26, 0x9e, 0x1e, 0x19, 0x28, 0x90, 0x25, 0x6,  0x79, 0xc,
      0xb9, 0x3d, 0xe5, 0xa1, 0x8b, 0xaa, 0x1,  0x4,  0x0,  0x11, 0x1e, 0x4d, 0x44, 0x19, 0x9a, 0xdc, 0xa2, 0x8,  0xa5,
      0xae, 0xae, 0x5a, 0xf6, 0x10, 0x24, 0x8,  0xc1, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x2e, 0x4a, 0xab, 0x7f, 0xa0, 0xc2, 0xe1, 0xe1, 0xaf, 0xd7, 0x2c, 0x42,
                                     0x8c, 0x58, 0x11, 0xa,  0x60, 0x52, 0xb8, 0x6a, 0xa4, 0x5a, 0x42, 0x5};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0x61, 0xe1, 0xc9, 0x70, 0x11, 0xb5, 0x46, 0x76, 0xd2, 0xda, 0xe, 0xe0, 0x1a};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0xef, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb7, 0x2e, 0xf6, 0x79, 0xa4, 0xa2, 0xd0, 0x79, 0x2};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xca, 0x82, 0xc0, 0x89, 0xe7, 0x2,  0xa4, 0x19, 0xc3, 0x7a, 0xa8,
                                     0x23, 0x54, 0x65, 0x6a, 0x81, 0x4f, 0x3e, 0x6b, 0x4f, 0xe5, 0x67};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2c, 0xff, 0xaf, 0x5,  0x8b, 0xb3, 0x25, 0xf1,
                                     0xfc, 0x94, 0x5e, 0xe4, 0x54, 0xf3, 0x10};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x7f, 0x98};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x6,  0xa8, 0x26, 0x9e, 0x1e, 0x19, 0x28, 0x90, 0x25, 0x6,
                                     0x79, 0xc,  0xb9, 0x3d, 0xe5, 0xa1, 0x8b, 0xaa, 0x1};
  lwmqtt_string_t topic_filter_s8 = {19, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1e, 0x4d, 0x44, 0x19, 0x9a, 0xdc, 0xa2, 0x8, 0xa5,
                                     0xae, 0xae, 0x5a, 0xf6, 0x10, 0x24, 0x8,  0xc1};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0x78, 0xd4, 0x98, 0x9a, 0x74, 0x81};
  uint8_t bytesprops2[] = {0x26};
  uint8_t bytesprops1[] = {0xda, 0x57, 0x61, 0xbe, 0x49};
  uint8_t bytesprops3[] = {0x90, 0xcd, 0x5b, 0xce, 0xb3, 0x8,  0x97, 0x83, 0x8a, 0x11, 0xa3, 0x80, 0xad, 0xfd,
                           0x28, 0x53, 0xbb, 0x5f, 0xad, 0xeb, 0xae, 0xd1, 0xf0, 0xe5, 0x68, 0x5e, 0x6c, 0x9c};
  uint8_t bytesprops4[] = {0xb, 0x97, 0x46, 0x74, 0x8b, 0x76, 0x88, 0xa7, 0xe, 0x5b, 0x71};
  uint8_t bytesprops5[] = {0x89, 0x93, 0xd7, 0xd7, 0x15, 0xa8, 0x60, 0x6a, 0x58, 0x33, 0x22, 0xf3};
  uint8_t bytesprops6[] = {0x1f, 0x6e, 0xe2, 0x59, 0x38, 0xf7, 0xb4, 0x34, 0xf1, 0x30, 0x4e, 0xb, 0x55};
  uint8_t bytesprops7[] = {0x91};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23768}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4377}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops1}, .v = {1, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12138}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14339}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26823}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7329}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25747}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28904}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25814}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 14}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3461, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24628 [("J$\202\SOH\164s\193\241\FS\196\170\186\133\233\147!bV\164\233m\185\177wW",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("Pu\230B\171\159)-\n\236\132r\193f\179`H\140\168\r&\ESC\241\173\219\190",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropCorrelationData
// "\153(\158EC\160\189\DLE\169\253\218\US\b\135\228\NUL\232S\225}\178\193\170\&6W)l\211g",PropReasonString
// "6`",PropResponseTopic "\165\EOT\NUL\163\169\235tpr\186\137#=\DEL\SYN",PropMaximumQoS 87]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x75, 0x60, 0x34, 0x39, 0x9,  0x0,  0x1d, 0x99, 0x28, 0x9e, 0x45, 0x43, 0xa0, 0xbd,
                   0x10, 0xa9, 0xfd, 0xda, 0x1f, 0x8,  0x87, 0xe4, 0x0,  0xe8, 0x53, 0xe1, 0x7d, 0xb2, 0xc1,
                   0xaa, 0x36, 0x57, 0x29, 0x6c, 0xd3, 0x67, 0x1f, 0x0,  0x2,  0x36, 0x60, 0x8,  0x0,  0xf,
                   0xa5, 0x4,  0x0,  0xa3, 0xa9, 0xeb, 0x74, 0x70, 0x72, 0xba, 0x89, 0x23, 0x3d, 0x7f, 0x16,
                   0x24, 0x57, 0x0,  0x19, 0x4a, 0x24, 0xca, 0x1,  0xa4, 0x73, 0xc1, 0xf1, 0x1c, 0xc4, 0xaa,
                   0xba, 0x85, 0xe9, 0x93, 0x21, 0x62, 0x56, 0xa4, 0xe9, 0x6d, 0xb9, 0xb1, 0x77, 0x57, 0x2e,
                   0x0,  0x1a, 0x50, 0x75, 0xe6, 0x42, 0xab, 0x9f, 0x29, 0x2d, 0xa,  0xec, 0x84, 0x72, 0xc1,
                   0x66, 0xb3, 0x60, 0x48, 0x8c, 0xa8, 0xd,  0x26, 0x1b, 0xf1, 0xad, 0xdb, 0xbe, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0x24, 0xca, 0x1,  0xa4, 0x73, 0xc1, 0xf1, 0x1c, 0xc4, 0xaa, 0xba, 0x85,
                                     0xe9, 0x93, 0x21, 0x62, 0x56, 0xa4, 0xe9, 0x6d, 0xb9, 0xb1, 0x77, 0x57};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x50, 0x75, 0xe6, 0x42, 0xab, 0x9f, 0x29, 0x2d, 0xa,  0xec, 0x84, 0x72, 0xc1,
                                     0x66, 0xb3, 0x60, 0x48, 0x8c, 0xa8, 0xd,  0x26, 0x1b, 0xf1, 0xad, 0xdb, 0xbe};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0x99, 0x28, 0x9e, 0x45, 0x43, 0xa0, 0xbd, 0x10, 0xa9, 0xfd, 0xda, 0x1f, 0x8,  0x87, 0xe4,
                           0x0,  0xe8, 0x53, 0xe1, 0x7d, 0xb2, 0xc1, 0xaa, 0x36, 0x57, 0x29, 0x6c, 0xd3, 0x67};
  uint8_t bytesprops1[] = {0x36, 0x60};
  uint8_t bytesprops2[] = {0xa5, 0x4, 0x0, 0xa3, 0xa9, 0xeb, 0x74, 0x70, 0x72, 0xba, 0x89, 0x23, 0x3d, 0x7f, 0x16};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24628, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27288 [("\217\135\214\SIKL\f\214\225\208\141\236\194:4\212\162{\DLE\CAN",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\203\193<\223\198\148=\252\DC3=x\192\203\215\231\&2\211",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("-.N5P\STXC\CAN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\147\DLE\210K\RS,n\142:0O\217",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\STXs\187\214l$s\164\&9O\a\137M\132\197\"\151\179\229,\193\188^\173",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\252\138+\n\175\ETX\235\\s\224\216\249m\228WJ\fy\195\226\195#\182\139\215",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\143\237,\176$\130\243/\DLE\DEL\156\226\192\193I%D7a\SUB",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\160}\178\229\154'\175?\176I\167Y\243r+\148\192\&4\186X:\192\247r\246\132",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DC4\128\162\SO\152]\188\DC1\184\174M\136\DC4\203\235\164\203\ACK\136\208\255N\133\250\173",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("?'h\n\240j\b\244;\129\DEL\203\169\ENQ\149\140\131\168h\137$",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropSessionExpiryInterval
// 1940,PropMaximumPacketSize 30321,PropSessionExpiryInterval 32334,PropUserProperty "'\240\247\249\192j\130\233\&6\133"
// "C\180\&0\139M\153{\235X@",PropSubscriptionIdentifierAvailable 218,PropTopicAliasMaximum 13456,PropContentType
// "\150\SUBd\169|R\n\147\137\\\154\130 H\152\183\133Y\201",PropServerKeepAlive 13969,PropSubscriptionIdentifier
// 16,PropWildcardSubscriptionAvailable 194,PropCorrelationData ""]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0xb4, 0x2,  0x6a, 0x98, 0x4d, 0x11, 0x0,  0x0,  0x7,  0x94, 0x27, 0x0,  0x0,  0x76, 0x71, 0x11, 0x0,  0x0,
      0x7e, 0x4e, 0x26, 0x0,  0xa,  0x27, 0xf0, 0xf7, 0xf9, 0xc0, 0x6a, 0x82, 0xe9, 0x36, 0x85, 0x0,  0xa,  0x43, 0xb4,
      0x30, 0x8b, 0x4d, 0x99, 0x7b, 0xeb, 0x58, 0x40, 0x29, 0xda, 0x22, 0x34, 0x90, 0x3,  0x0,  0x13, 0x96, 0x1a, 0x64,
      0xa9, 0x7c, 0x52, 0xa,  0x93, 0x89, 0x5c, 0x9a, 0x82, 0x20, 0x48, 0x98, 0xb7, 0x85, 0x59, 0xc9, 0x13, 0x36, 0x91,
      0xb,  0x10, 0x28, 0xc2, 0x9,  0x0,  0x0,  0x0,  0x14, 0xd9, 0x87, 0xd6, 0xf,  0x4b, 0x4c, 0xc,  0xd6, 0xe1, 0xd0,
      0x8d, 0xec, 0xc2, 0x3a, 0x34, 0xd4, 0xa2, 0x7b, 0x10, 0x18, 0x8,  0x0,  0x11, 0xcb, 0xc1, 0x3c, 0xdf, 0xc6, 0x94,
      0x3d, 0xfc, 0x13, 0x3d, 0x78, 0xc0, 0xcb, 0xd7, 0xe7, 0x32, 0xd3, 0x26, 0x0,  0x8,  0x2d, 0x2e, 0x4e, 0x35, 0x50,
      0x2,  0x43, 0x18, 0xa,  0x0,  0xc,  0x93, 0x10, 0xd2, 0x4b, 0x1e, 0x2c, 0x6e, 0x8e, 0x3a, 0x30, 0x4f, 0xd9, 0x2,
      0x0,  0x18, 0x2,  0x73, 0xbb, 0xd6, 0x6c, 0x24, 0x73, 0xa4, 0x39, 0x4f, 0x7,  0x89, 0x4d, 0x84, 0xc5, 0x22, 0x97,
      0xb3, 0xe5, 0x2c, 0xc1, 0xbc, 0x5e, 0xad, 0x10, 0x0,  0x19, 0xfc, 0x8a, 0x2b, 0xa,  0xaf, 0x3,  0xeb, 0x5c, 0x73,
      0xe0, 0xd8, 0xf9, 0x6d, 0xe4, 0x57, 0x4a, 0xc,  0x79, 0xc3, 0xe2, 0xc3, 0x23, 0xb6, 0x8b, 0xd7, 0x15, 0x0,  0x14,
      0x8f, 0xed, 0x2c, 0xb0, 0x24, 0x82, 0xf3, 0x2f, 0x10, 0x7f, 0x9c, 0xe2, 0xc0, 0xc1, 0x49, 0x25, 0x44, 0x37, 0x61,
      0x1a, 0x2e, 0x0,  0x1a, 0xa0, 0x7d, 0xb2, 0xe5, 0x9a, 0x27, 0xaf, 0x3f, 0xb0, 0x49, 0xa7, 0x59, 0xf3, 0x72, 0x2b,
      0x94, 0xc0, 0x34, 0xba, 0x58, 0x3a, 0xc0, 0xf7, 0x72, 0xf6, 0x84, 0x0,  0x0,  0x19, 0x14, 0x80, 0xa2, 0xe,  0x98,
      0x5d, 0xbc, 0x11, 0xb8, 0xae, 0x4d, 0x88, 0x14, 0xcb, 0xeb, 0xa4, 0xcb, 0x6,  0x88, 0xd0, 0xff, 0x4e, 0x85, 0xfa,
      0xad, 0x1d, 0x0,  0x15, 0x3f, 0x27, 0x68, 0xa,  0xf0, 0x6a, 0x8,  0xf4, 0x3b, 0x81, 0x7f, 0xcb, 0xa9, 0x5,  0x95,
      0x8c, 0x83, 0xa8, 0x68, 0x89, 0x24, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0x87, 0xd6, 0xf,  0x4b, 0x4c, 0xc,  0xd6, 0xe1, 0xd0,
                                     0x8d, 0xec, 0xc2, 0x3a, 0x34, 0xd4, 0xa2, 0x7b, 0x10, 0x18};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0xc1, 0x3c, 0xdf, 0xc6, 0x94, 0x3d, 0xfc, 0x13,
                                     0x3d, 0x78, 0xc0, 0xcb, 0xd7, 0xe7, 0x32, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0x2e, 0x4e, 0x35, 0x50, 0x2, 0x43, 0x18};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0x10, 0xd2, 0x4b, 0x1e, 0x2c, 0x6e, 0x8e, 0x3a, 0x30, 0x4f, 0xd9};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2,  0x73, 0xbb, 0xd6, 0x6c, 0x24, 0x73, 0xa4, 0x39, 0x4f, 0x7,  0x89,
                                     0x4d, 0x84, 0xc5, 0x22, 0x97, 0xb3, 0xe5, 0x2c, 0xc1, 0xbc, 0x5e, 0xad};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x8a, 0x2b, 0xa, 0xaf, 0x3,  0xeb, 0x5c, 0x73, 0xe0, 0xd8, 0xf9, 0x6d,
                                     0xe4, 0x57, 0x4a, 0xc, 0x79, 0xc3, 0xe2, 0xc3, 0x23, 0xb6, 0x8b, 0xd7};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8f, 0xed, 0x2c, 0xb0, 0x24, 0x82, 0xf3, 0x2f, 0x10, 0x7f,
                                     0x9c, 0xe2, 0xc0, 0xc1, 0x49, 0x25, 0x44, 0x37, 0x61, 0x1a};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa0, 0x7d, 0xb2, 0xe5, 0x9a, 0x27, 0xaf, 0x3f, 0xb0, 0x49, 0xa7, 0x59, 0xf3,
                                     0x72, 0x2b, 0x94, 0xc0, 0x34, 0xba, 0x58, 0x3a, 0xc0, 0xf7, 0x72, 0xf6, 0x84};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x14, 0x80, 0xa2, 0xe,  0x98, 0x5d, 0xbc, 0x11, 0xb8, 0xae, 0x4d, 0x88, 0x14,
                                     0xcb, 0xeb, 0xa4, 0xcb, 0x6,  0x88, 0xd0, 0xff, 0x4e, 0x85, 0xfa, 0xad};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x3f, 0x27, 0x68, 0xa,  0xf0, 0x6a, 0x8,  0xf4, 0x3b, 0x81, 0x7f,
                                     0xcb, 0xa9, 0x5,  0x95, 0x8c, 0x83, 0xa8, 0x68, 0x89, 0x24};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  uint8_t bytesprops1[] = {0x43, 0xb4, 0x30, 0x8b, 0x4d, 0x99, 0x7b, 0xeb, 0x58, 0x40};
  uint8_t bytesprops0[] = {0x27, 0xf0, 0xf7, 0xf9, 0xc0, 0x6a, 0x82, 0xe9, 0x36, 0x85};
  uint8_t bytesprops2[] = {0x96, 0x1a, 0x64, 0xa9, 0x7c, 0x52, 0xa,  0x93, 0x89, 0x5c,
                           0x9a, 0x82, 0x20, 0x48, 0x98, 0xb7, 0x85, 0x59, 0xc9};
  uint8_t bytesprops3[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1940}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30321}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32334}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {10, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13456}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13969}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27288, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14432 [("\132\142U\243\225d\SO^\184\204\176\ng\214\232",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\ap\172QO\204\154J[\145n",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\RS\167x\142;=\175\194m}:\128\206\146\&5 PF\224\155",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\168c\156\132\130\233l",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\138\204\153\191\242P(t/<\251\206\247P*\239f",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\SOH5\252\ETX\182\137\247D\155\b\175\SO\193\137\fS\148\225\133^a\a\207T\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\182\129\173\SUB\239\244",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\ACK\163\NAK\DC1\195\169\246\220\EMt-\224\251\210\190k\170\170\251\193\&0\DC1\208\233\&1\NUL1",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\n\SUB\192\143\n1\SYNu\131\135tm\186\224\200\235IQ4h>0",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("J\166;]\v@\SYNME\249\NAK
// \166\187\168h\EM,\194\193\148mF6\154d}\192",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = False, _subQoS =
// QoS1}),("\176\&9\ne\247S\212\228T\157k\157\139P\CAN\DC1\ESC\220\227$\252\ACK\217\192\128\128H\155\174",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropUserProperty
// "\142\218\SUBH\163\ACK\169\148\204M" "\DC2\184j;\156\173\ETB\nU\188\EOT>\207\159\rD\r",PropPayloadFormatIndicator
// 237,PropWildcardSubscriptionAvailable 4,PropSubscriptionIdentifierAvailable 162,PropServerReference
// "\170\DELT6\SOH\168\158\ESCR\253\162\161\132t\192\188+\165\218\t\225\DC4\163B\172",PropSubscriptionIdentifierAvailable
// 175,PropRequestResponseInformation 80,PropResponseInformation "8d",PropRequestProblemInformation
// 63,PropRetainAvailable 48,PropServerKeepAlive 22450,PropReceiveMaximum 14219,PropResponseTopic
// "m\217k\nt7\148(\186~\133\140\245\237J\ENQ",PropUserProperty "" "3\146\248\203m\190`\138\151
// r\200OT\133\145\ACK\ESC",PropResponseInformation "\RS\FSCx\152aH
// o\153\162\135\&3\246\\\236Q\167\132#\165\139O\161P",PropRequestProblemInformation 165,PropAuthenticationMethod
// "\194a\161\204\182 F\207\229\182E&C",PropMaximumQoS 35,PropAssignedClientIdentifier
// "\151\199\136{B\237\184\233\157~6\157Y\255\163v\161\t:",PropRequestProblemInformation
// 7,PropSharedSubscriptionAvailable 113]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xbd, 0x3,  0x38, 0x60, 0xc9, 0x1,  0x26, 0x0,  0xa,  0x8e, 0xda, 0x1a, 0x48, 0xa3, 0x6,  0xa9, 0x94, 0xcc,
      0x4d, 0x0,  0x11, 0x12, 0xb8, 0x6a, 0x3b, 0x9c, 0xad, 0x17, 0xa,  0x55, 0xbc, 0x4,  0x3e, 0xcf, 0x9f, 0xd,  0x44,
      0xd,  0x1,  0xed, 0x28, 0x4,  0x29, 0xa2, 0x1c, 0x0,  0x19, 0xaa, 0x7f, 0x54, 0x36, 0x1,  0xa8, 0x9e, 0x1b, 0x52,
      0xfd, 0xa2, 0xa1, 0x84, 0x74, 0xc0, 0xbc, 0x2b, 0xa5, 0xda, 0x9,  0xe1, 0x14, 0xa3, 0x42, 0xac, 0x29, 0xaf, 0x19,
      0x50, 0x1a, 0x0,  0x2,  0x38, 0x64, 0x17, 0x3f, 0x25, 0x30, 0x13, 0x57, 0xb2, 0x21, 0x37, 0x8b, 0x8,  0x0,  0x10,
      0x6d, 0xd9, 0x6b, 0xa,  0x74, 0x37, 0x94, 0x28, 0xba, 0x7e, 0x85, 0x8c, 0xf5, 0xed, 0x4a, 0x5,  0x26, 0x0,  0x0,
      0x0,  0x12, 0x33, 0x92, 0xf8, 0xcb, 0x6d, 0xbe, 0x60, 0x8a, 0x97, 0x20, 0x72, 0xc8, 0x4f, 0x54, 0x85, 0x91, 0x6,
      0x1b, 0x1a, 0x0,  0x19, 0x1e, 0x1c, 0x43, 0x78, 0x98, 0x61, 0x48, 0x20, 0x6f, 0x99, 0xa2, 0x87, 0x33, 0xf6, 0x5c,
      0xec, 0x51, 0xa7, 0x84, 0x23, 0xa5, 0x8b, 0x4f, 0xa1, 0x50, 0x17, 0xa5, 0x15, 0x0,  0xd,  0xc2, 0x61, 0xa1, 0xcc,
      0xb6, 0x20, 0x46, 0xcf, 0xe5, 0xb6, 0x45, 0x26, 0x43, 0x24, 0x23, 0x12, 0x0,  0x13, 0x97, 0xc7, 0x88, 0x7b, 0x42,
      0xed, 0xb8, 0xe9, 0x9d, 0x7e, 0x36, 0x9d, 0x59, 0xff, 0xa3, 0x76, 0xa1, 0x9,  0x3a, 0x17, 0x7,  0x2a, 0x71, 0x0,
      0xf,  0x84, 0x8e, 0x55, 0xf3, 0xe1, 0x64, 0xe,  0x5e, 0xb8, 0xcc, 0xb0, 0xa,  0x67, 0xd6, 0xe8, 0x5,  0x0,  0xb,
      0x7,  0x70, 0xac, 0x51, 0x4f, 0xcc, 0x9a, 0x4a, 0x5b, 0x91, 0x6e, 0x22, 0x0,  0x14, 0x1e, 0xa7, 0x78, 0x8e, 0x3b,
      0x3d, 0xaf, 0xc2, 0x6d, 0x7d, 0x3a, 0x80, 0xce, 0x92, 0x35, 0x20, 0x50, 0x46, 0xe0, 0x9b, 0x2c, 0x0,  0x7,  0xa8,
      0x63, 0x9c, 0x84, 0x82, 0xe9, 0x6c, 0x5,  0x0,  0x11, 0x8a, 0xcc, 0x99, 0xbf, 0xf2, 0x50, 0x28, 0x74, 0x2f, 0x3c,
      0xfb, 0xce, 0xf7, 0x50, 0x2a, 0xef, 0x66, 0x2e, 0x0,  0x19, 0x1,  0x35, 0xfc, 0x3,  0xb6, 0x89, 0xf7, 0x44, 0x9b,
      0x8,  0xaf, 0xe,  0xc1, 0x89, 0xc,  0x53, 0x94, 0xe1, 0x85, 0x5e, 0x61, 0x7,  0xcf, 0x54, 0xa0, 0x4,  0x0,  0x6,
      0xb6, 0x81, 0xad, 0x1a, 0xef, 0xf4, 0x8,  0x0,  0x1b, 0x6,  0xa3, 0x15, 0x11, 0xc3, 0xa9, 0xf6, 0xdc, 0x19, 0x74,
      0x2d, 0xe0, 0xfb, 0xd2, 0xbe, 0x6b, 0xaa, 0xaa, 0xfb, 0xc1, 0x30, 0x11, 0xd0, 0xe9, 0x31, 0x0,  0x31, 0xa,  0x0,
      0x16, 0xa,  0x1a, 0xc0, 0x8f, 0xa,  0x31, 0x16, 0x75, 0x83, 0x87, 0x74, 0x6d, 0xba, 0xe0, 0xc8, 0xeb, 0x49, 0x51,
      0x34, 0x68, 0x3e, 0x30, 0x16, 0x0,  0x1c, 0x4a, 0xa6, 0x3b, 0x5d, 0xb,  0x40, 0x16, 0x4d, 0x45, 0xf9, 0x15, 0x20,
      0xa6, 0xbb, 0xa8, 0x68, 0x19, 0x2c, 0xc2, 0xc1, 0x94, 0x6d, 0x46, 0x36, 0x9a, 0x64, 0x7d, 0xc0, 0x19, 0x0,  0x1d,
      0xb0, 0x39, 0xa,  0x65, 0xf7, 0x53, 0xd4, 0xe4, 0x54, 0x9d, 0x6b, 0x9d, 0x8b, 0x50, 0x18, 0x11, 0x1b, 0xdc, 0xe3,
      0x24, 0xfc, 0x6,  0xd9, 0xc0, 0x80, 0x80, 0x48, 0x9b, 0xae, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0x8e, 0x55, 0xf3, 0xe1, 0x64, 0xe, 0x5e,
                                     0xb8, 0xcc, 0xb0, 0xa,  0x67, 0xd6, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7, 0x70, 0xac, 0x51, 0x4f, 0xcc, 0x9a, 0x4a, 0x5b, 0x91, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1e, 0xa7, 0x78, 0x8e, 0x3b, 0x3d, 0xaf, 0xc2, 0x6d, 0x7d,
                                     0x3a, 0x80, 0xce, 0x92, 0x35, 0x20, 0x50, 0x46, 0xe0, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa8, 0x63, 0x9c, 0x84, 0x82, 0xe9, 0x6c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8a, 0xcc, 0x99, 0xbf, 0xf2, 0x50, 0x28, 0x74, 0x2f,
                                     0x3c, 0xfb, 0xce, 0xf7, 0x50, 0x2a, 0xef, 0x66};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1,  0x35, 0xfc, 0x3,  0xb6, 0x89, 0xf7, 0x44, 0x9b, 0x8,  0xaf, 0xe, 0xc1,
                                     0x89, 0xc,  0x53, 0x94, 0xe1, 0x85, 0x5e, 0x61, 0x7,  0xcf, 0x54, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb6, 0x81, 0xad, 0x1a, 0xef, 0xf4};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6,  0xa3, 0x15, 0x11, 0xc3, 0xa9, 0xf6, 0xdc, 0x19, 0x74, 0x2d, 0xe0, 0xfb, 0xd2,
                                     0xbe, 0x6b, 0xaa, 0xaa, 0xfb, 0xc1, 0x30, 0x11, 0xd0, 0xe9, 0x31, 0x0,  0x31};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa,  0x1a, 0xc0, 0x8f, 0xa,  0x31, 0x16, 0x75, 0x83, 0x87, 0x74,
                                     0x6d, 0xba, 0xe0, 0xc8, 0xeb, 0x49, 0x51, 0x34, 0x68, 0x3e, 0x30};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4a, 0xa6, 0x3b, 0x5d, 0xb,  0x40, 0x16, 0x4d, 0x45, 0xf9,
                                     0x15, 0x20, 0xa6, 0xbb, 0xa8, 0x68, 0x19, 0x2c, 0xc2, 0xc1,
                                     0x94, 0x6d, 0x46, 0x36, 0x9a, 0x64, 0x7d, 0xc0};
  lwmqtt_string_t topic_filter_s9 = {28, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xb0, 0x39, 0xa,  0x65, 0xf7, 0x53, 0xd4, 0xe4, 0x54, 0x9d,
                                      0x6b, 0x9d, 0x8b, 0x50, 0x18, 0x11, 0x1b, 0xdc, 0xe3, 0x24,
                                      0xfc, 0x6,  0xd9, 0xc0, 0x80, 0x80, 0x48, 0x9b, 0xae};
  lwmqtt_string_t topic_filter_s10 = {29, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops1[] = {0x12, 0xb8, 0x6a, 0x3b, 0x9c, 0xad, 0x17, 0xa, 0x55,
                           0xbc, 0x4,  0x3e, 0xcf, 0x9f, 0xd,  0x44, 0xd};
  uint8_t bytesprops0[] = {0x8e, 0xda, 0x1a, 0x48, 0xa3, 0x6, 0xa9, 0x94, 0xcc, 0x4d};
  uint8_t bytesprops2[] = {0xaa, 0x7f, 0x54, 0x36, 0x1,  0xa8, 0x9e, 0x1b, 0x52, 0xfd, 0xa2, 0xa1, 0x84,
                           0x74, 0xc0, 0xbc, 0x2b, 0xa5, 0xda, 0x9,  0xe1, 0x14, 0xa3, 0x42, 0xac};
  uint8_t bytesprops3[] = {0x38, 0x64};
  uint8_t bytesprops4[] = {0x6d, 0xd9, 0x6b, 0xa,  0x74, 0x37, 0x94, 0x28,
                           0xba, 0x7e, 0x85, 0x8c, 0xf5, 0xed, 0x4a, 0x5};
  uint8_t bytesprops6[] = {0x33, 0x92, 0xf8, 0xcb, 0x6d, 0xbe, 0x60, 0x8a, 0x97,
                           0x20, 0x72, 0xc8, 0x4f, 0x54, 0x85, 0x91, 0x6,  0x1b};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops7[] = {0x1e, 0x1c, 0x43, 0x78, 0x98, 0x61, 0x48, 0x20, 0x6f, 0x99, 0xa2, 0x87, 0x33,
                           0xf6, 0x5c, 0xec, 0x51, 0xa7, 0x84, 0x23, 0xa5, 0x8b, 0x4f, 0xa1, 0x50};
  uint8_t bytesprops8[] = {0xc2, 0x61, 0xa1, 0xcc, 0xb6, 0x20, 0x46, 0xcf, 0xe5, 0xb6, 0x45, 0x26, 0x43};
  uint8_t bytesprops9[] = {0x97, 0xc7, 0x88, 0x7b, 0x42, 0xed, 0xb8, 0xe9, 0x9d, 0x7e,
                           0x36, 0x9d, 0x59, 0xff, 0xa3, 0x76, 0xa1, 0x9,  0x3a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {17, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22450}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14219}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops5}, .v = {18, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 113}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14432, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29362 [("_\243\230\136\DEL\192\SOH\129",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),(")^\224-\RSS\187\132\DLE\157\228F\236\193P/=
// \US\203\163d<\r>\228\239\253\SO\223",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("d!#X=\180_\191R\DEL\180\224\148\190i\152\228b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\209\139\ACKUg\\\156\248\"\241\232*\SUB\148\"~\131c\rpq\ENQ\DC3\212\179y\RSX",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("_\231\198F\215\f\226\236\156vQ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS0}),("\225_l!\242_",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS0})] [PropSessionExpiryInterval 17671,PropPayloadFormatIndicator
// 109,PropReceiveMaximum 31944,PropMaximumQoS 115,PropAuthenticationMethod
// "AG\157\204\\\192q\186\177W\175=",PropSubscriptionIdentifierAvailable 57,PropSessionExpiryInterval
// 1970,PropTopicAliasMaximum 24957,PropCorrelationData
// "\217\180\148\160\CANiA\220z\140\188g*Oy\170\&2\230;\"\166\178\NUL\217\219<",PropAuthenticationMethod
// "7\SI",PropServerReference "\231\247\170\t\EM"]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0xc9, 0x1,  0x72, 0xb2, 0x4f, 0x11, 0x0,  0x0,  0x45, 0x7,  0x1,  0x6d, 0x21, 0x7c, 0xc8, 0x24,
                   0x73, 0x15, 0x0,  0xc,  0x41, 0x47, 0x9d, 0xcc, 0x5c, 0xc0, 0x71, 0xba, 0xb1, 0x57, 0xaf, 0x3d, 0x29,
                   0x39, 0x11, 0x0,  0x0,  0x7,  0xb2, 0x22, 0x61, 0x7d, 0x9,  0x0,  0x1a, 0xd9, 0xb4, 0x94, 0xa0, 0x18,
                   0x69, 0x41, 0xdc, 0x7a, 0x8c, 0xbc, 0x67, 0x2a, 0x4f, 0x79, 0xaa, 0x32, 0xe6, 0x3b, 0x22, 0xa6, 0xb2,
                   0x0,  0xd9, 0xdb, 0x3c, 0x15, 0x0,  0x2,  0x37, 0xf,  0x1c, 0x0,  0x5,  0xe7, 0xf7, 0xaa, 0x9,  0x19,
                   0x0,  0x8,  0x5f, 0xf3, 0xe6, 0x88, 0x7f, 0xc0, 0x1,  0x81, 0x2c, 0x0,  0x1e, 0x29, 0x5e, 0xe0, 0x2d,
                   0x1e, 0x53, 0xbb, 0x84, 0x10, 0x9d, 0xe4, 0x46, 0xec, 0xc1, 0x50, 0x2f, 0x3d, 0x20, 0x1f, 0xcb, 0xa3,
                   0x64, 0x3c, 0xd,  0x3e, 0xe4, 0xef, 0xfd, 0xe,  0xdf, 0x2c, 0x0,  0x12, 0x64, 0x21, 0x23, 0x58, 0x3d,
                   0xb4, 0x5f, 0xbf, 0x52, 0x7f, 0xb4, 0xe0, 0x94, 0xbe, 0x69, 0x98, 0xe4, 0x62, 0x9,  0x0,  0x1c, 0xd1,
                   0x8b, 0x6,  0x55, 0x67, 0x5c, 0x9c, 0xf8, 0x22, 0xf1, 0xe8, 0x2a, 0x1a, 0x94, 0x22, 0x7e, 0x83, 0x63,
                   0xd,  0x70, 0x71, 0x5,  0x13, 0xd4, 0xb3, 0x79, 0x1e, 0x58, 0x1c, 0x0,  0xb,  0x5f, 0xe7, 0xc6, 0x46,
                   0xd7, 0xc,  0xe2, 0xec, 0x9c, 0x76, 0x51, 0x4,  0x0,  0x6,  0xe1, 0x5f, 0x6c, 0x21, 0xf2, 0x5f, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xf3, 0xe6, 0x88, 0x7f, 0xc0, 0x1, 0x81};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x29, 0x5e, 0xe0, 0x2d, 0x1e, 0x53, 0xbb, 0x84, 0x10, 0x9d,
                                     0xe4, 0x46, 0xec, 0xc1, 0x50, 0x2f, 0x3d, 0x20, 0x1f, 0xcb,
                                     0xa3, 0x64, 0x3c, 0xd,  0x3e, 0xe4, 0xef, 0xfd, 0xe,  0xdf};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x64, 0x21, 0x23, 0x58, 0x3d, 0xb4, 0x5f, 0xbf, 0x52,
                                     0x7f, 0xb4, 0xe0, 0x94, 0xbe, 0x69, 0x98, 0xe4, 0x62};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x8b, 0x6,  0x55, 0x67, 0x5c, 0x9c, 0xf8, 0x22, 0xf1,
                                     0xe8, 0x2a, 0x1a, 0x94, 0x22, 0x7e, 0x83, 0x63, 0xd,  0x70,
                                     0x71, 0x5,  0x13, 0xd4, 0xb3, 0x79, 0x1e, 0x58};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xe7, 0xc6, 0x46, 0xd7, 0xc, 0xe2, 0xec, 0x9c, 0x76, 0x51};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe1, 0x5f, 0x6c, 0x21, 0xf2, 0x5f};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x41, 0x47, 0x9d, 0xcc, 0x5c, 0xc0, 0x71, 0xba, 0xb1, 0x57, 0xaf, 0x3d};
  uint8_t bytesprops1[] = {0xd9, 0xb4, 0x94, 0xa0, 0x18, 0x69, 0x41, 0xdc, 0x7a, 0x8c, 0xbc, 0x67, 0x2a,
                           0x4f, 0x79, 0xaa, 0x32, 0xe6, 0x3b, 0x22, 0xa6, 0xb2, 0x0,  0xd9, 0xdb, 0x3c};
  uint8_t bytesprops2[] = {0x37, 0xf};
  uint8_t bytesprops3[] = {0xe7, 0xf7, 0xaa, 0x9, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17671}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31944}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1970}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24957}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29362, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18382
// [("\231\EM\193\193q\251\CAN\154\SYN\230\146\204c_\141w\148\DC3\215\RS!\ETXw\186x$n\182\231",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropReasonString "\CANB\238hj\224\196'\158a\212\187\182@\252R\213t\232\172\160t",PropUserProperty
// "\134\SI)\190\160|\ETB\191L\190\230+\223\&7\165" "M\233\USZ\246\&7",PropWildcardSubscriptionAvailable
// 232,PropUserProperty "\GS\137\251W\186\DC2o" "\175!9x!",PropPayloadFormatIndicator 19,PropAuthenticationMethod
// "\155\207l_\130\157\153\NAK?\212(I\CAN\202\134NwZ\DC4\251",PropCorrelationData
// "<\133j\146\US%\245\222&u",PropSharedSubscriptionAvailable 232,PropCorrelationData
// "\192\182W\226\171\177^\223\192rK{\149\227\220",PropSubscriptionIdentifier 1,PropServerReference
// "",PropSubscriptionIdentifier 3,PropSubscriptionIdentifier 8,PropAssignedClientIdentifier
// "L-\191e\216",PropWillDelayInterval 25674,PropMessageExpiryInterval 17484,PropSessionExpiryInterval
// 4335,PropResponseTopic "~\ACK\DC3\218\190\SUB\195C\248t(!q\230/\238h\205\218\254\214",PropMessageExpiryInterval
// 2322,PropTopicAlias 2796,PropRequestProblemInformation 232,PropMaximumQoS 9,PropRequestResponseInformation
// 65,PropTopicAlias 26821,PropAssignedClientIdentifier
// "R\240a\227\151\225QM\213G\197\199*9\226\DEL\197\170\202\213J@\142&(\204",PropTopicAlias
// 9265,PropWildcardSubscriptionAvailable 53]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0x8f, 0x2,  0x47, 0xce, 0xeb, 0x1,  0x1f, 0x0,  0x16, 0x18, 0x42, 0xee, 0x68, 0x6a, 0xe0, 0xc4, 0x27, 0x9e,
      0x61, 0xd4, 0xbb, 0xb6, 0x40, 0xfc, 0x52, 0xd5, 0x74, 0xe8, 0xac, 0xa0, 0x74, 0x26, 0x0,  0xf,  0x86, 0xf,  0x29,
      0xbe, 0xa0, 0x7c, 0x17, 0xbf, 0x4c, 0xbe, 0xe6, 0x2b, 0xdf, 0x37, 0xa5, 0x0,  0x6,  0x4d, 0xe9, 0x1f, 0x5a, 0xf6,
      0x37, 0x28, 0xe8, 0x26, 0x0,  0x7,  0x1d, 0x89, 0xfb, 0x57, 0xba, 0x12, 0x6f, 0x0,  0x5,  0xaf, 0x21, 0x39, 0x78,
      0x21, 0x1,  0x13, 0x15, 0x0,  0x14, 0x9b, 0xcf, 0x6c, 0x5f, 0x82, 0x9d, 0x99, 0x15, 0x3f, 0xd4, 0x28, 0x49, 0x18,
      0xca, 0x86, 0x4e, 0x77, 0x5a, 0x14, 0xfb, 0x9,  0x0,  0xa,  0x3c, 0x85, 0x6a, 0x92, 0x1f, 0x25, 0xf5, 0xde, 0x26,
      0x75, 0x2a, 0xe8, 0x9,  0x0,  0xf,  0xc0, 0xb6, 0x57, 0xe2, 0xab, 0xb1, 0x5e, 0xdf, 0xc0, 0x72, 0x4b, 0x7b, 0x95,
      0xe3, 0xdc, 0xb,  0x1,  0x1c, 0x0,  0x0,  0xb,  0x3,  0xb,  0x8,  0x12, 0x0,  0x5,  0x4c, 0x2d, 0xbf, 0x65, 0xd8,
      0x18, 0x0,  0x0,  0x64, 0x4a, 0x2,  0x0,  0x0,  0x44, 0x4c, 0x11, 0x0,  0x0,  0x10, 0xef, 0x8,  0x0,  0x15, 0x7e,
      0x6,  0x13, 0xda, 0xbe, 0x1a, 0xc3, 0x43, 0xf8, 0x74, 0x28, 0x21, 0x71, 0xe6, 0x2f, 0xee, 0x68, 0xcd, 0xda, 0xfe,
      0xd6, 0x2,  0x0,  0x0,  0x9,  0x12, 0x23, 0xa,  0xec, 0x17, 0xe8, 0x24, 0x9,  0x19, 0x41, 0x23, 0x68, 0xc5, 0x12,
      0x0,  0x1a, 0x52, 0xf0, 0x61, 0xe3, 0x97, 0xe1, 0x51, 0x4d, 0xd5, 0x47, 0xc5, 0xc7, 0x2a, 0x39, 0xe2, 0x7f, 0xc5,
      0xaa, 0xca, 0xd5, 0x4a, 0x40, 0x8e, 0x26, 0x28, 0xcc, 0x23, 0x24, 0x31, 0x28, 0x35, 0x0,  0x1d, 0xe7, 0x19, 0xc1,
      0xc1, 0x71, 0xfb, 0x18, 0x9a, 0x16, 0xe6, 0x92, 0xcc, 0x63, 0x5f, 0x8d, 0x77, 0x94, 0x13, 0xd7, 0x1e, 0x21, 0x3,
      0x77, 0xba, 0x78, 0x24, 0x6e, 0xb6, 0xe7, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe7, 0x19, 0xc1, 0xc1, 0x71, 0xfb, 0x18, 0x9a, 0x16, 0xe6,
                                     0x92, 0xcc, 0x63, 0x5f, 0x8d, 0x77, 0x94, 0x13, 0xd7, 0x1e,
                                     0x21, 0x3,  0x77, 0xba, 0x78, 0x24, 0x6e, 0xb6, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0x18, 0x42, 0xee, 0x68, 0x6a, 0xe0, 0xc4, 0x27, 0x9e, 0x61, 0xd4,
                           0xbb, 0xb6, 0x40, 0xfc, 0x52, 0xd5, 0x74, 0xe8, 0xac, 0xa0, 0x74};
  uint8_t bytesprops2[] = {0x4d, 0xe9, 0x1f, 0x5a, 0xf6, 0x37};
  uint8_t bytesprops1[] = {0x86, 0xf, 0x29, 0xbe, 0xa0, 0x7c, 0x17, 0xbf, 0x4c, 0xbe, 0xe6, 0x2b, 0xdf, 0x37, 0xa5};
  uint8_t bytesprops4[] = {0xaf, 0x21, 0x39, 0x78, 0x21};
  uint8_t bytesprops3[] = {0x1d, 0x89, 0xfb, 0x57, 0xba, 0x12, 0x6f};
  uint8_t bytesprops5[] = {0x9b, 0xcf, 0x6c, 0x5f, 0x82, 0x9d, 0x99, 0x15, 0x3f, 0xd4,
                           0x28, 0x49, 0x18, 0xca, 0x86, 0x4e, 0x77, 0x5a, 0x14, 0xfb};
  uint8_t bytesprops6[] = {0x3c, 0x85, 0x6a, 0x92, 0x1f, 0x25, 0xf5, 0xde, 0x26, 0x75};
  uint8_t bytesprops7[] = {0xc0, 0xb6, 0x57, 0xe2, 0xab, 0xb1, 0x5e, 0xdf, 0xc0, 0x72, 0x4b, 0x7b, 0x95, 0xe3, 0xdc};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x4c, 0x2d, 0xbf, 0x65, 0xd8};
  uint8_t bytesprops10[] = {0x7e, 0x6,  0x13, 0xda, 0xbe, 0x1a, 0xc3, 0x43, 0xf8, 0x74, 0x28,
                            0x21, 0x71, 0xe6, 0x2f, 0xee, 0x68, 0xcd, 0xda, 0xfe, 0xd6};
  uint8_t bytesprops11[] = {0x52, 0xf0, 0x61, 0xe3, 0x97, 0xe1, 0x51, 0x4d, 0xd5, 0x47, 0xc5, 0xc7, 0x2a,
                            0x39, 0xe2, 0x7f, 0xc5, 0xaa, 0xca, 0xd5, 0x4a, 0x40, 0x8e, 0x26, 0x28, 0xcc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops1}, .v = {6, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {5, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25674}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17484}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4335}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2322}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2796}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26821}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9265}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 53}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18382, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3280 [("\252\153?\GSp",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("_\132\USe\201\201\207X\SI%\DC4\188n<\231p\ACK{\157\165\215\142\182\165\234\137\&6u",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\\3\146\160\169\t\156\ENQ\193$\238\197jL\b\216\252\216",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\ETX\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\a;J7U.\178\156\&8d\196\SO$\145\224\131Y\200\&2+;l",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("E\177t%H\185\EOTxHjzc\212\174}XI\SYNBe*\SOH\249Q6R\NUL-",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropRetainAvailable 175,PropAuthenticationData
// "\USv~\243c,\215\v\DC1\f6\144Fq\DC4\139\155\221\176s\STX)v\240",PropWildcardSubscriptionAvailable
// 10,PropRequestProblemInformation 16,PropCorrelationData "?}\242\DLE\167c\144\DEL\EOT\156j\153\147\136\225
// l\SOH\217\193\172\ETBH\v\DLE\192\ACK\246",PropMaximumPacketSize 3641,PropReasonString
// "\186\162n\130\150\147\146D\211E\181\230C\128\128?\248\209G\153\246\208\197\n\213PJ\SUB\156\201",PropWildcardSubscriptionAvailable
// 100,PropSubscriptionIdentifier 7,PropUserProperty "\NUL\246\DLEZWL-\NAK,4\169[C\128[\163k\200"
// "\188V\202\176h\CAN\165\200\GS$TP|\171kc\199\191-\ACK\233\231.5\235[\197i\158\138",PropRetainAvailable
// 77,PropRequestProblemInformation 176]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x82, 0xa0, 0x2,  0xc,  0xd0, 0xa3, 0x1,  0x25, 0xaf, 0x16, 0x0,  0x18, 0x1f, 0x76, 0x7e, 0xf3, 0x63, 0x2c, 0xd7,
      0xb,  0x11, 0xc,  0x36, 0x90, 0x46, 0x71, 0x14, 0x8b, 0x9b, 0xdd, 0xb0, 0x73, 0x2,  0x29, 0x76, 0xf0, 0x28, 0xa,
      0x17, 0x10, 0x9,  0x0,  0x1c, 0x3f, 0x7d, 0xf2, 0x10, 0xa7, 0x63, 0x90, 0x7f, 0x4,  0x9c, 0x6a, 0x99, 0x93, 0x88,
      0xe1, 0x20, 0x6c, 0x1,  0xd9, 0xc1, 0xac, 0x17, 0x48, 0xb,  0x10, 0xc0, 0x6,  0xf6, 0x27, 0x0,  0x0,  0xe,  0x39,
      0x1f, 0x0,  0x1e, 0xba, 0xa2, 0x6e, 0x82, 0x96, 0x93, 0x92, 0x44, 0xd3, 0x45, 0xb5, 0xe6, 0x43, 0x80, 0x80, 0x3f,
      0xf8, 0xd1, 0x47, 0x99, 0xf6, 0xd0, 0xc5, 0xa,  0xd5, 0x50, 0x4a, 0x1a, 0x9c, 0xc9, 0x28, 0x64, 0xb,  0x7,  0x26,
      0x0,  0x12, 0x0,  0xf6, 0x10, 0x5a, 0x57, 0x4c, 0x2d, 0x15, 0x2c, 0x34, 0xa9, 0x5b, 0x43, 0x80, 0x5b, 0xa3, 0x6b,
      0xc8, 0x0,  0x1e, 0xbc, 0x56, 0xca, 0xb0, 0x68, 0x18, 0xa5, 0xc8, 0x1d, 0x24, 0x54, 0x50, 0x7c, 0xab, 0x6b, 0x63,
      0xc7, 0xbf, 0x2d, 0x6,  0xe9, 0xe7, 0x2e, 0x35, 0xeb, 0x5b, 0xc5, 0x69, 0x9e, 0x8a, 0x25, 0x4d, 0x17, 0xb0, 0x0,
      0x5,  0xfc, 0x99, 0x3f, 0x1d, 0x70, 0x0,  0x0,  0x1c, 0x5f, 0x84, 0x1f, 0x65, 0xc9, 0xc9, 0xcf, 0x58, 0xf,  0x25,
      0x14, 0xbc, 0x6e, 0x3c, 0xe7, 0x70, 0x6,  0x7b, 0x9d, 0xa5, 0xd7, 0x8e, 0xb6, 0xa5, 0xea, 0x89, 0x36, 0x75, 0xa,
      0x0,  0x12, 0x5c, 0x33, 0x92, 0xa0, 0xa9, 0x9,  0x9c, 0x5,  0xc1, 0x24, 0xee, 0xc5, 0x6a, 0x4c, 0x8,  0xd8, 0xfc,
      0xd8, 0x25, 0x0,  0x2,  0x3,  0xf0, 0x9,  0x0,  0x16, 0x7,  0x3b, 0x4a, 0x37, 0x55, 0x2e, 0xb2, 0x9c, 0x38, 0x64,
      0xc4, 0xe,  0x24, 0x91, 0xe0, 0x83, 0x59, 0xc8, 0x32, 0x2b, 0x3b, 0x6c, 0x2a, 0x0,  0x1c, 0x45, 0xb1, 0x74, 0x25,
      0x48, 0xb9, 0x4,  0x78, 0x48, 0x6a, 0x7a, 0x63, 0xd4, 0xae, 0x7d, 0x58, 0x49, 0x16, 0x42, 0x65, 0x2a, 0x1,  0xf9,
      0x51, 0x36, 0x52, 0x0,  0x2d, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xfc, 0x99, 0x3f, 0x1d, 0x70};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x84, 0x1f, 0x65, 0xc9, 0xc9, 0xcf, 0x58, 0xf,  0x25,
                                     0x14, 0xbc, 0x6e, 0x3c, 0xe7, 0x70, 0x6,  0x7b, 0x9d, 0xa5,
                                     0xd7, 0x8e, 0xb6, 0xa5, 0xea, 0x89, 0x36, 0x75};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x33, 0x92, 0xa0, 0xa9, 0x9, 0x9c, 0x5,  0xc1,
                                     0x24, 0xee, 0xc5, 0x6a, 0x4c, 0x8, 0xd8, 0xfc, 0xd8};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3, 0xf0};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7, 0x3b, 0x4a, 0x37, 0x55, 0x2e, 0xb2, 0x9c, 0x38, 0x64, 0xc4,
                                     0xe, 0x24, 0x91, 0xe0, 0x83, 0x59, 0xc8, 0x32, 0x2b, 0x3b, 0x6c};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x45, 0xb1, 0x74, 0x25, 0x48, 0xb9, 0x4,  0x78, 0x48, 0x6a,
                                     0x7a, 0x63, 0xd4, 0xae, 0x7d, 0x58, 0x49, 0x16, 0x42, 0x65,
                                     0x2a, 0x1,  0xf9, 0x51, 0x36, 0x52, 0x0,  0x2d};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x1f, 0x76, 0x7e, 0xf3, 0x63, 0x2c, 0xd7, 0xb,  0x11, 0xc,  0x36, 0x90,
                           0x46, 0x71, 0x14, 0x8b, 0x9b, 0xdd, 0xb0, 0x73, 0x2,  0x29, 0x76, 0xf0};
  uint8_t bytesprops1[] = {0x3f, 0x7d, 0xf2, 0x10, 0xa7, 0x63, 0x90, 0x7f, 0x4,  0x9c, 0x6a, 0x99, 0x93, 0x88,
                           0xe1, 0x20, 0x6c, 0x1,  0xd9, 0xc1, 0xac, 0x17, 0x48, 0xb,  0x10, 0xc0, 0x6,  0xf6};
  uint8_t bytesprops2[] = {0xba, 0xa2, 0x6e, 0x82, 0x96, 0x93, 0x92, 0x44, 0xd3, 0x45, 0xb5, 0xe6, 0x43, 0x80, 0x80,
                           0x3f, 0xf8, 0xd1, 0x47, 0x99, 0xf6, 0xd0, 0xc5, 0xa,  0xd5, 0x50, 0x4a, 0x1a, 0x9c, 0xc9};
  uint8_t bytesprops4[] = {0xbc, 0x56, 0xca, 0xb0, 0x68, 0x18, 0xa5, 0xc8, 0x1d, 0x24, 0x54, 0x50, 0x7c, 0xab, 0x6b,
                           0x63, 0xc7, 0xbf, 0x2d, 0x6,  0xe9, 0xe7, 0x2e, 0x35, 0xeb, 0x5b, 0xc5, 0x69, 0x9e, 0x8a};
  uint8_t bytesprops3[] = {0x0,  0xf6, 0x10, 0x5a, 0x57, 0x4c, 0x2d, 0x15, 0x2c,
                           0x34, 0xa9, 0x5b, 0x43, 0x80, 0x5b, 0xa3, 0x6b, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3641}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops3}, .v = {30, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 176}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3280, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4639 [("\165\EM\DC2g\NUL",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\ESCH\249\163F",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\203\206z\136",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\156`s_",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropUserProperty
// "+G\189" "\DC1\FS\216\210;\145\164)\NUL\226^\147\141\DC3\254f",PropRequestResponseInformation
// 121,PropWildcardSubscriptionAvailable 148,PropRetainAvailable 5,PropRequestProblemInformation
// 249,PropAuthenticationMethod "\213q@H\255\190o}\213K\132\141",PropTopicAlias 2644,PropUserProperty " "
// "\r\157]J\153\172\135",PropAuthenticationMethod "\148\199\SOH|\192G\223U\251\232",PropMessageExpiryInterval 24483]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x72, 0x12, 0x1f, 0x51, 0x26, 0x0,  0x3,  0x2b, 0x47, 0xbd, 0x0,  0x10, 0x11, 0x1c, 0xd8, 0xd2,
                   0x3b, 0x91, 0xa4, 0x29, 0x0,  0xe2, 0x5e, 0x93, 0x8d, 0x13, 0xfe, 0x66, 0x19, 0x79, 0x28, 0x94, 0x25,
                   0x5,  0x17, 0xf9, 0x15, 0x0,  0xc,  0xd5, 0x71, 0x40, 0x48, 0xff, 0xbe, 0x6f, 0x7d, 0xd5, 0x4b, 0x84,
                   0x8d, 0x23, 0xa,  0x54, 0x26, 0x0,  0x1,  0x20, 0x0,  0x7,  0xd,  0x9d, 0x5d, 0x4a, 0x99, 0xac, 0x87,
                   0x15, 0x0,  0xa,  0x94, 0xc7, 0x1,  0x7c, 0xc0, 0x47, 0xdf, 0x55, 0xfb, 0xe8, 0x2,  0x0,  0x0,  0x5f,
                   0xa3, 0x0,  0x5,  0xa5, 0x19, 0x12, 0x67, 0x0,  0x22, 0x0,  0x5,  0x1b, 0x48, 0xf9, 0xa3, 0x46, 0x11,
                   0x0,  0x4,  0xcb, 0xce, 0x7a, 0x88, 0x2d, 0x0,  0x4,  0x9c, 0x60, 0x73, 0x5f, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xa5, 0x19, 0x12, 0x67, 0x0};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1b, 0x48, 0xf9, 0xa3, 0x46};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcb, 0xce, 0x7a, 0x88};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9c, 0x60, 0x73, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  uint8_t bytesprops1[] = {0x11, 0x1c, 0xd8, 0xd2, 0x3b, 0x91, 0xa4, 0x29,
                           0x0,  0xe2, 0x5e, 0x93, 0x8d, 0x13, 0xfe, 0x66};
  uint8_t bytesprops0[] = {0x2b, 0x47, 0xbd};
  uint8_t bytesprops2[] = {0xd5, 0x71, 0x40, 0x48, 0xff, 0xbe, 0x6f, 0x7d, 0xd5, 0x4b, 0x84, 0x8d};
  uint8_t bytesprops4[] = {0xd, 0x9d, 0x5d, 0x4a, 0x99, 0xac, 0x87};
  uint8_t bytesprops3[] = {0x20};
  uint8_t bytesprops5[] = {0x94, 0xc7, 0x1, 0x7c, 0xc0, 0x47, 0xdf, 0x55, 0xfb, 0xe8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops0}, .v = {16, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2644}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops3}, .v = {7, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24483}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4639, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23421 [("\251(\b\221xT^\230i\US\136\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\239\134\214\190s\242G\b\155\159\231F\196",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("R\224\a\fdO\239\252\137\148rl,\DELe\145\206_\153\201\&4\149\173\208\\\n[\213\227",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\221A\172\SYN\229\189\v\177\194\tM6\158\244\184\129\CANc;T\142\&1@",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\159\222\ESC0\198\131\133\220\213\242\238\229\202\SUB\151\&4R\223c<f*\244",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SUB\DC3\233\208\227\197\&8\160\184\213\227p\215D\a\STX\134\173\&8\235\a\254!",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("R\223\249\176\254\216\245,\225\138\179",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = False, _noLocal = True, _subQoS = QoS0})] [PropMessageExpiryInterval 3029,PropWildcardSubscriptionAvailable
// 166,PropSubscriptionIdentifier 12,PropAuthenticationMethod "@\195",PropRequestProblemInformation 49,PropMaximumQoS
// 128,PropServerKeepAlive 28504,PropSharedSubscriptionAvailable 43,PropSubscriptionIdentifierAvailable
// 43,PropAuthenticationMethod
// ";\153\146iDpYI2\221\f:j\157\206\195\DEL\ai}J\129\&7\245\250\223\220",PropSubscriptionIdentifier 0,PropResponseTopic
// "\173\132L\201\222\&6{\168J\f\130\238\206 \230\222\155\139\237v\137\180&Th\168 \158",PropContentType
// "\197{\138\139\SYN!\249\249uv\147, \129\171\186\131\ACKM\220\142\138\138Qv",PropSubscriptionIdentifier
// 35,PropPayloadFormatIndicator 19,PropServerReference "$@\197fi@\214",PropResponseInformation
// "~\203\171",PropRetainAvailable 119,PropSessionExpiryInterval 31246,PropServerKeepAlive 16116,PropTopicAliasMaximum
// 20297,PropUserProperty "@\SUB{\172\ETX\SI\230J_\178\210\160u7\228{"
// "tj\STX\245\DC4\ACKL\135",PropMessageExpiryInterval 19951,PropResponseTopic
// "\197\208L\205w\173\145\147p$\237\138\252\185"]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xe7, 0x2,  0x5b, 0x7d, 0xc8, 0x1,  0x2,  0x0,  0x0,  0xb,  0xd5, 0x28, 0xa6, 0xb,  0xc,  0x15, 0x0,  0x2,
      0x40, 0xc3, 0x17, 0x31, 0x24, 0x80, 0x13, 0x6f, 0x58, 0x2a, 0x2b, 0x29, 0x2b, 0x15, 0x0,  0x1b, 0x3b, 0x99, 0x92,
      0x69, 0x44, 0x70, 0x59, 0x49, 0x32, 0xdd, 0xc,  0x3a, 0x6a, 0x9d, 0xce, 0xc3, 0x7f, 0x7,  0x69, 0x7d, 0x4a, 0x81,
      0x37, 0xf5, 0xfa, 0xdf, 0xdc, 0xb,  0x0,  0x8,  0x0,  0x1c, 0xad, 0x84, 0x4c, 0xc9, 0xde, 0x36, 0x7b, 0xa8, 0x4a,
      0xc,  0x82, 0xee, 0xce, 0x20, 0xe6, 0xde, 0x9b, 0x8b, 0xed, 0x76, 0x89, 0xb4, 0x26, 0x54, 0x68, 0xa8, 0x20, 0x9e,
      0x3,  0x0,  0x19, 0xc5, 0x7b, 0x8a, 0x8b, 0x16, 0x21, 0xf9, 0xf9, 0x75, 0x76, 0x93, 0x2c, 0x20, 0x81, 0xab, 0xba,
      0x83, 0x6,  0x4d, 0xdc, 0x8e, 0x8a, 0x8a, 0x51, 0x76, 0xb,  0x23, 0x1,  0x13, 0x1c, 0x0,  0x7,  0x24, 0x40, 0xc5,
      0x66, 0x69, 0x40, 0xd6, 0x1a, 0x0,  0x3,  0x7e, 0xcb, 0xab, 0x25, 0x77, 0x11, 0x0,  0x0,  0x7a, 0xe,  0x13, 0x3e,
      0xf4, 0x22, 0x4f, 0x49, 0x26, 0x0,  0x10, 0x40, 0x1a, 0x7b, 0xac, 0x3,  0xf,  0xe6, 0x4a, 0x5f, 0xb2, 0xd2, 0xa0,
      0x75, 0x37, 0xe4, 0x7b, 0x0,  0x8,  0x74, 0x6a, 0x2,  0xf5, 0x14, 0x6,  0x4c, 0x87, 0x2,  0x0,  0x0,  0x4d, 0xef,
      0x8,  0x0,  0xe,  0xc5, 0xd0, 0x4c, 0xcd, 0x77, 0xad, 0x91, 0x93, 0x70, 0x24, 0xed, 0x8a, 0xfc, 0xb9, 0x0,  0xc,
      0xfb, 0x28, 0x8,  0xdd, 0x78, 0x54, 0x5e, 0xe6, 0x69, 0x1f, 0x88, 0x4,  0x4,  0x0,  0xd,  0xef, 0x86, 0xd6, 0xbe,
      0x73, 0xf2, 0x47, 0x8,  0x9b, 0x9f, 0xe7, 0x46, 0xc4, 0x14, 0x0,  0x1d, 0x52, 0xe0, 0x7,  0xc,  0x64, 0x4f, 0xef,
      0xfc, 0x89, 0x94, 0x72, 0x6c, 0x2c, 0x7f, 0x65, 0x91, 0xce, 0x5f, 0x99, 0xc9, 0x34, 0x95, 0xad, 0xd0, 0x5c, 0xa,
      0x5b, 0xd5, 0xe3, 0x12, 0x0,  0x17, 0xdd, 0x41, 0xac, 0x16, 0xe5, 0xbd, 0xb,  0xb1, 0xc2, 0x9,  0x4d, 0x36, 0x9e,
      0xf4, 0xb8, 0x81, 0x18, 0x63, 0x3b, 0x54, 0x8e, 0x31, 0x40, 0x12, 0x0,  0x17, 0x9f, 0xde, 0x1b, 0x30, 0xc6, 0x83,
      0x85, 0xdc, 0xd5, 0xf2, 0xee, 0xe5, 0xca, 0x1a, 0x97, 0x34, 0x52, 0xdf, 0x63, 0x3c, 0x66, 0x2a, 0xf4, 0x22, 0x0,
      0x17, 0x1a, 0x13, 0xe9, 0xd0, 0xe3, 0xc5, 0x38, 0xa0, 0xb8, 0xd5, 0xe3, 0x70, 0xd7, 0x44, 0x7,  0x2,  0x86, 0xad,
      0x38, 0xeb, 0x7,  0xfe, 0x21, 0x1d, 0x0,  0xb,  0x52, 0xdf, 0xf9, 0xb0, 0xfe, 0xd8, 0xf5, 0x2c, 0xe1, 0x8a, 0xb3,
      0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xfb, 0x28, 0x8, 0xdd, 0x78, 0x54, 0x5e, 0xe6, 0x69, 0x1f, 0x88, 0x4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0x86, 0xd6, 0xbe, 0x73, 0xf2, 0x47, 0x8, 0x9b, 0x9f, 0xe7, 0x46, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x52, 0xe0, 0x7,  0xc,  0x64, 0x4f, 0xef, 0xfc, 0x89, 0x94,
                                     0x72, 0x6c, 0x2c, 0x7f, 0x65, 0x91, 0xce, 0x5f, 0x99, 0xc9,
                                     0x34, 0x95, 0xad, 0xd0, 0x5c, 0xa,  0x5b, 0xd5, 0xe3};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xdd, 0x41, 0xac, 0x16, 0xe5, 0xbd, 0xb,  0xb1, 0xc2, 0x9,  0x4d, 0x36,
                                     0x9e, 0xf4, 0xb8, 0x81, 0x18, 0x63, 0x3b, 0x54, 0x8e, 0x31, 0x40};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9f, 0xde, 0x1b, 0x30, 0xc6, 0x83, 0x85, 0xdc, 0xd5, 0xf2, 0xee, 0xe5,
                                     0xca, 0x1a, 0x97, 0x34, 0x52, 0xdf, 0x63, 0x3c, 0x66, 0x2a, 0xf4};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1a, 0x13, 0xe9, 0xd0, 0xe3, 0xc5, 0x38, 0xa0, 0xb8, 0xd5, 0xe3, 0x70,
                                     0xd7, 0x44, 0x7,  0x2,  0x86, 0xad, 0x38, 0xeb, 0x7,  0xfe, 0x21};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0xdf, 0xf9, 0xb0, 0xfe, 0xd8, 0xf5, 0x2c, 0xe1, 0x8a, 0xb3};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x40, 0xc3};
  uint8_t bytesprops1[] = {0x3b, 0x99, 0x92, 0x69, 0x44, 0x70, 0x59, 0x49, 0x32, 0xdd, 0xc,  0x3a, 0x6a, 0x9d,
                           0xce, 0xc3, 0x7f, 0x7,  0x69, 0x7d, 0x4a, 0x81, 0x37, 0xf5, 0xfa, 0xdf, 0xdc};
  uint8_t bytesprops2[] = {0xad, 0x84, 0x4c, 0xc9, 0xde, 0x36, 0x7b, 0xa8, 0x4a, 0xc,  0x82, 0xee, 0xce, 0x20,
                           0xe6, 0xde, 0x9b, 0x8b, 0xed, 0x76, 0x89, 0xb4, 0x26, 0x54, 0x68, 0xa8, 0x20, 0x9e};
  uint8_t bytesprops3[] = {0xc5, 0x7b, 0x8a, 0x8b, 0x16, 0x21, 0xf9, 0xf9, 0x75, 0x76, 0x93, 0x2c, 0x20,
                           0x81, 0xab, 0xba, 0x83, 0x6,  0x4d, 0xdc, 0x8e, 0x8a, 0x8a, 0x51, 0x76};
  uint8_t bytesprops4[] = {0x24, 0x40, 0xc5, 0x66, 0x69, 0x40, 0xd6};
  uint8_t bytesprops5[] = {0x7e, 0xcb, 0xab};
  uint8_t bytesprops7[] = {0x74, 0x6a, 0x2, 0xf5, 0x14, 0x6, 0x4c, 0x87};
  uint8_t bytesprops6[] = {0x40, 0x1a, 0x7b, 0xac, 0x3,  0xf,  0xe6, 0x4a,
                           0x5f, 0xb2, 0xd2, 0xa0, 0x75, 0x37, 0xe4, 0x7b};
  uint8_t bytesprops8[] = {0xc5, 0xd0, 0x4c, 0xcd, 0x77, 0xad, 0x91, 0x93, 0x70, 0x24, 0xed, 0x8a, 0xfc, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3029}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28504}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 35}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31246}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16116}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20297}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops6}, .v = {8, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19951}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23421, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29413
// [("\r\177\255\&8\205T\220\221\200I\135\179\NUL\b&\210<\160v\139\174\149p\226\&1\STX\227\170",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\NAKRLi\SO!",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False,
// _subQoS = QoS2}),("^$\195\221qYtK1\165lY\230\255",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS =
// QoS2}),("\GS\164\186\150\191\r\to\189\190\150\183))a\EM\235\DC2B\\\215G\237:\161",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("g\185\228[\DC1%6\FS$\251\239\210\133\149\184\&61\EOTS\131\190\147",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("4TB\235K\215N\"\198>L\171r:\136\128\t\nV1@\206",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\152\178\CAN\175Q\229h\DC19I\201\190>\230\164\181\242q51",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\176O\235\183\144\ETX\224\ACK\173\237*\DLE\129\NUL\CAN\151",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\210\189\SI\243c",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\164\176\159\168\229\233v\159\v\223\227\158\207\190\216\187\203Z",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropTopicAlias
// 27259,PropServerKeepAlive 14117,PropContentType
// "\DLEh\182\216\DC2\t]\138Of\192M\ENQ\166\149)\188\139\US\213",PropRetainAvailable 33,PropResponseTopic
// "\243\v\247\US.+\207\227\161\209\150/D\237\225t",PropMaximumPacketSize 8492,PropPayloadFormatIndicator
// 3,PropResponseTopic
// "\STX\186\165\221l\193\221\SO2\159_\208\n\174\&1Q\240\229\243\201/\226X\162i\244\198",PropSharedSubscriptionAvailable
// 50,PropTopicAlias 22557,PropSubscriptionIdentifier 13,PropTopicAliasMaximum 8009,PropResponseTopic
// "\139\ACK|f\ACK\217\213u+\f\239\201\225K\199\213\ESC\189\EMv\214",PropSubscriptionIdentifierAvailable
// 104,PropResponseInformation "i\224\tR|\183\"\v\218\218x\245\199\SOH\203\234\231",PropRequestProblemInformation
// 71,PropRetainAvailable 129,PropSubscriptionIdentifierAvailable 84,PropAssignedClientIdentifier
// "!*\175\DC47\209",PropMessageExpiryInterval 466,PropMaximumPacketSize 2156,PropMaximumQoS
// 167,PropMessageExpiryInterval 23974,PropUserProperty "\168P\f\234\167SFw\231\245 \SYNPSo\NUL2j|"
// "~I",PropServerReference "\139\170w2P\143\241\193\DC3",PropReasonString
// "F\239j\220\140\132\DEL\191'\164\SYN\170[X\218\218\210\208ux\197?\186",PropWillDelayInterval 19569]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x82, 0xc6, 0x3,  0x72, 0xe5, 0xf4, 0x1,  0x23, 0x6a, 0x7b, 0x13, 0x37, 0x25, 0x3,  0x0,  0x14, 0x10, 0x68, 0xb6,
      0xd8, 0x12, 0x9,  0x5d, 0x8a, 0x4f, 0x66, 0xc0, 0x4d, 0x5,  0xa6, 0x95, 0x29, 0xbc, 0x8b, 0x1f, 0xd5, 0x25, 0x21,
      0x8,  0x0,  0x10, 0xf3, 0xb,  0xf7, 0x1f, 0x2e, 0x2b, 0xcf, 0xe3, 0xa1, 0xd1, 0x96, 0x2f, 0x44, 0xed, 0xe1, 0x74,
      0x27, 0x0,  0x0,  0x21, 0x2c, 0x1,  0x3,  0x8,  0x0,  0x1b, 0x2,  0xba, 0xa5, 0xdd, 0x6c, 0xc1, 0xdd, 0xe,  0x32,
      0x9f, 0x5f, 0xd0, 0xa,  0xae, 0x31, 0x51, 0xf0, 0xe5, 0xf3, 0xc9, 0x2f, 0xe2, 0x58, 0xa2, 0x69, 0xf4, 0xc6, 0x2a,
      0x32, 0x23, 0x58, 0x1d, 0xb,  0xd,  0x22, 0x1f, 0x49, 0x8,  0x0,  0x15, 0x8b, 0x6,  0x7c, 0x66, 0x6,  0xd9, 0xd5,
      0x75, 0x2b, 0xc,  0xef, 0xc9, 0xe1, 0x4b, 0xc7, 0xd5, 0x1b, 0xbd, 0x19, 0x76, 0xd6, 0x29, 0x68, 0x1a, 0x0,  0x11,
      0x69, 0xe0, 0x9,  0x52, 0x7c, 0xb7, 0x22, 0xb,  0xda, 0xda, 0x78, 0xf5, 0xc7, 0x1,  0xcb, 0xea, 0xe7, 0x17, 0x47,
      0x25, 0x81, 0x29, 0x54, 0x12, 0x0,  0x6,  0x21, 0x2a, 0xaf, 0x14, 0x37, 0xd1, 0x2,  0x0,  0x0,  0x1,  0xd2, 0x27,
      0x0,  0x0,  0x8,  0x6c, 0x24, 0xa7, 0x2,  0x0,  0x0,  0x5d, 0xa6, 0x26, 0x0,  0x13, 0xa8, 0x50, 0xc,  0xea, 0xa7,
      0x53, 0x46, 0x77, 0xe7, 0xf5, 0x20, 0x16, 0x50, 0x53, 0x6f, 0x0,  0x32, 0x6a, 0x7c, 0x0,  0x2,  0x7e, 0x49, 0x1c,
      0x0,  0x9,  0x8b, 0xaa, 0x77, 0x32, 0x50, 0x8f, 0xf1, 0xc1, 0x13, 0x1f, 0x0,  0x17, 0x46, 0xef, 0x6a, 0xdc, 0x8c,
      0x84, 0x7f, 0xbf, 0x27, 0xa4, 0x16, 0xaa, 0x5b, 0x58, 0xda, 0xda, 0xd2, 0xd0, 0x75, 0x78, 0xc5, 0x3f, 0xba, 0x18,
      0x0,  0x0,  0x4c, 0x71, 0x0,  0x1c, 0xd,  0xb1, 0xff, 0x38, 0xcd, 0x54, 0xdc, 0xdd, 0xc8, 0x49, 0x87, 0xb3, 0x0,
      0x8,  0x26, 0xd2, 0x3c, 0xa0, 0x76, 0x8b, 0xae, 0x95, 0x70, 0xe2, 0x31, 0x2,  0xe3, 0xaa, 0x10, 0x0,  0x6,  0x15,
      0x52, 0x4c, 0x69, 0xe,  0x21, 0x1a, 0x0,  0xe,  0x5e, 0x24, 0xc3, 0xdd, 0x71, 0x59, 0x74, 0x4b, 0x31, 0xa5, 0x6c,
      0x59, 0xe6, 0xff, 0x6,  0x0,  0x19, 0x1d, 0xa4, 0xba, 0x96, 0xbf, 0xd,  0x9,  0x6f, 0xbd, 0xbe, 0x96, 0xb7, 0x29,
      0x29, 0x61, 0x19, 0xeb, 0x12, 0x42, 0x5c, 0xd7, 0x47, 0xed, 0x3a, 0xa1, 0x24, 0x0,  0x16, 0x67, 0xb9, 0xe4, 0x5b,
      0x11, 0x25, 0x36, 0x1c, 0x24, 0xfb, 0xef, 0xd2, 0x85, 0x95, 0xb8, 0x36, 0x31, 0x4,  0x53, 0x83, 0xbe, 0x93, 0x25,
      0x0,  0x16, 0x34, 0x54, 0x42, 0xeb, 0x4b, 0xd7, 0x4e, 0x22, 0xc6, 0x3e, 0x4c, 0xab, 0x72, 0x3a, 0x88, 0x80, 0x9,
      0xa,  0x56, 0x31, 0x40, 0xce, 0x18, 0x0,  0x14, 0x98, 0xb2, 0x18, 0xaf, 0x51, 0xe5, 0x68, 0x11, 0x39, 0x49, 0xc9,
      0xbe, 0x3e, 0xe6, 0xa4, 0xb5, 0xf2, 0x71, 0x35, 0x31, 0x21, 0x0,  0x10, 0xb0, 0x4f, 0xeb, 0xb7, 0x90, 0x3,  0xe0,
      0x6,  0xad, 0xed, 0x2a, 0x10, 0x81, 0x0,  0x18, 0x97, 0x25, 0x0,  0x5,  0xd2, 0xbd, 0xf,  0xf3, 0x63, 0x1c, 0x0,
      0x12, 0xa4, 0xb0, 0x9f, 0xa8, 0xe5, 0xe9, 0x76, 0x9f, 0xb,  0xdf, 0xe3, 0x9e, 0xcf, 0xbe, 0xd8, 0xbb, 0xcb, 0x5a,
      0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xb1, 0xff, 0x38, 0xcd, 0x54, 0xdc, 0xdd, 0xc8, 0x49,
                                     0x87, 0xb3, 0x0,  0x8,  0x26, 0xd2, 0x3c, 0xa0, 0x76, 0x8b,
                                     0xae, 0x95, 0x70, 0xe2, 0x31, 0x2,  0xe3, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x15, 0x52, 0x4c, 0x69, 0xe, 0x21};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5e, 0x24, 0xc3, 0xdd, 0x71, 0x59, 0x74,
                                     0x4b, 0x31, 0xa5, 0x6c, 0x59, 0xe6, 0xff};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1d, 0xa4, 0xba, 0x96, 0xbf, 0xd,  0x9,  0x6f, 0xbd, 0xbe, 0x96, 0xb7, 0x29,
                                     0x29, 0x61, 0x19, 0xeb, 0x12, 0x42, 0x5c, 0xd7, 0x47, 0xed, 0x3a, 0xa1};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x67, 0xb9, 0xe4, 0x5b, 0x11, 0x25, 0x36, 0x1c, 0x24, 0xfb, 0xef,
                                     0xd2, 0x85, 0x95, 0xb8, 0x36, 0x31, 0x4,  0x53, 0x83, 0xbe, 0x93};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x34, 0x54, 0x42, 0xeb, 0x4b, 0xd7, 0x4e, 0x22, 0xc6, 0x3e, 0x4c,
                                     0xab, 0x72, 0x3a, 0x88, 0x80, 0x9,  0xa,  0x56, 0x31, 0x40, 0xce};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x98, 0xb2, 0x18, 0xaf, 0x51, 0xe5, 0x68, 0x11, 0x39, 0x49,
                                     0xc9, 0xbe, 0x3e, 0xe6, 0xa4, 0xb5, 0xf2, 0x71, 0x35, 0x31};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb0, 0x4f, 0xeb, 0xb7, 0x90, 0x3, 0xe0, 0x6,
                                     0xad, 0xed, 0x2a, 0x10, 0x81, 0x0, 0x18, 0x97};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd2, 0xbd, 0xf, 0xf3, 0x63};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa4, 0xb0, 0x9f, 0xa8, 0xe5, 0xe9, 0x76, 0x9f, 0xb,
                                     0xdf, 0xe3, 0x9e, 0xcf, 0xbe, 0xd8, 0xbb, 0xcb, 0x5a};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0x10, 0x68, 0xb6, 0xd8, 0x12, 0x9,  0x5d, 0x8a, 0x4f, 0x66,
                           0xc0, 0x4d, 0x5,  0xa6, 0x95, 0x29, 0xbc, 0x8b, 0x1f, 0xd5};
  uint8_t bytesprops1[] = {0xf3, 0xb,  0xf7, 0x1f, 0x2e, 0x2b, 0xcf, 0xe3,
                           0xa1, 0xd1, 0x96, 0x2f, 0x44, 0xed, 0xe1, 0x74};
  uint8_t bytesprops2[] = {0x2,  0xba, 0xa5, 0xdd, 0x6c, 0xc1, 0xdd, 0xe,  0x32, 0x9f, 0x5f, 0xd0, 0xa, 0xae,
                           0x31, 0x51, 0xf0, 0xe5, 0xf3, 0xc9, 0x2f, 0xe2, 0x58, 0xa2, 0x69, 0xf4, 0xc6};
  uint8_t bytesprops3[] = {0x8b, 0x6,  0x7c, 0x66, 0x6,  0xd9, 0xd5, 0x75, 0x2b, 0xc, 0xef,
                           0xc9, 0xe1, 0x4b, 0xc7, 0xd5, 0x1b, 0xbd, 0x19, 0x76, 0xd6};
  uint8_t bytesprops4[] = {0x69, 0xe0, 0x9,  0x52, 0x7c, 0xb7, 0x22, 0xb, 0xda,
                           0xda, 0x78, 0xf5, 0xc7, 0x1,  0xcb, 0xea, 0xe7};
  uint8_t bytesprops5[] = {0x21, 0x2a, 0xaf, 0x14, 0x37, 0xd1};
  uint8_t bytesprops7[] = {0x7e, 0x49};
  uint8_t bytesprops6[] = {0xa8, 0x50, 0xc,  0xea, 0xa7, 0x53, 0x46, 0x77, 0xe7, 0xf5,
                           0x20, 0x16, 0x50, 0x53, 0x6f, 0x0,  0x32, 0x6a, 0x7c};
  uint8_t bytesprops8[] = {0x8b, 0xaa, 0x77, 0x32, 0x50, 0x8f, 0xf1, 0xc1, 0x13};
  uint8_t bytesprops9[] = {0x46, 0xef, 0x6a, 0xdc, 0x8c, 0x84, 0x7f, 0xbf, 0x27, 0xa4, 0x16, 0xaa,
                           0x5b, 0x58, 0xda, 0xda, 0xd2, 0xd0, 0x75, 0x78, 0xc5, 0x3f, 0xba};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27259}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14117}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8492}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22557}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8009}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 466}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2156}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23974}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops6}, .v = {2, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19569}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29413, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 6204 [("O\CAN\197/\176M5\196\CAN\225\129Lt\140(",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\182\157\155]\RS\202Z\206F\192\t\240bW\211\158\163b\219\147F3>",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\173U\245\ACK\156A\ENQ\208\187\208\DELX",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\188\246\170$\240\EM",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\"~R\129\189*P\134\186\ETB\222\230\&4\168^\237\146\ACK\240\190q\205\153U\SOH^|H",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropReceiveMaximum
// 9386,PropPayloadFormatIndicator 171,PropRequestResponseInformation 192,PropReceiveMaximum
// 26762,PropSharedSubscriptionAvailable 198,PropAuthenticationData
// "\149\153e\137\n\EM\204\228Ns\205\DC3\NUL\162\155\NAK:\223\&5\CAN\248C\201\206\194n",PropMaximumPacketSize
// 8554,PropAssignedClientIdentifier "\160\138K\208\201\152\209\224\173T\217!\172",PropMessageExpiryInterval
// 19029,PropCorrelationData "y\195\175\ETX",PropServerReference
// "\138cfZ.\147a#\SYN.K%\163\186S\132YK\EM&\131\ETBd\245",PropMaximumPacketSize 20156,PropReasonString
// "\252\147",PropRetainAvailable 63,PropRequestResponseInformation 77,PropWildcardSubscriptionAvailable
// 242,PropSharedSubscriptionAvailable 230,PropMaximumQoS 54,PropResponseTopic "\225\ETBX\215\DC1\NUL\a"]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0xea, 0x1,  0x18, 0x3c, 0x83, 0x1,  0x21, 0x24, 0xaa, 0x1,  0xab, 0x19, 0xc0, 0x21, 0x68, 0x8a,
                   0x2a, 0xc6, 0x16, 0x0,  0x1a, 0x95, 0x99, 0x65, 0x89, 0xa,  0x19, 0xcc, 0xe4, 0x4e, 0x73, 0xcd, 0x13,
                   0x0,  0xa2, 0x9b, 0x15, 0x3a, 0xdf, 0x35, 0x18, 0xf8, 0x43, 0xc9, 0xce, 0xc2, 0x6e, 0x27, 0x0,  0x0,
                   0x21, 0x6a, 0x12, 0x0,  0xd,  0xa0, 0x8a, 0x4b, 0xd0, 0xc9, 0x98, 0xd1, 0xe0, 0xad, 0x54, 0xd9, 0x21,
                   0xac, 0x2,  0x0,  0x0,  0x4a, 0x55, 0x9,  0x0,  0x4,  0x79, 0xc3, 0xaf, 0x3,  0x1c, 0x0,  0x18, 0x8a,
                   0x63, 0x66, 0x5a, 0x2e, 0x93, 0x61, 0x23, 0x16, 0x2e, 0x4b, 0x25, 0xa3, 0xba, 0x53, 0x84, 0x59, 0x4b,
                   0x19, 0x26, 0x83, 0x17, 0x64, 0xf5, 0x27, 0x0,  0x0,  0x4e, 0xbc, 0x1f, 0x0,  0x2,  0xfc, 0x93, 0x25,
                   0x3f, 0x19, 0x4d, 0x28, 0xf2, 0x2a, 0xe6, 0x24, 0x36, 0x8,  0x0,  0x7,  0xe1, 0x17, 0x58, 0xd7, 0x11,
                   0x0,  0x7,  0x0,  0xf,  0x4f, 0x18, 0xc5, 0x2f, 0xb0, 0x4d, 0x35, 0xc4, 0x18, 0xe1, 0x81, 0x4c, 0x74,
                   0x8c, 0x28, 0x22, 0x0,  0x17, 0xb6, 0x9d, 0x9b, 0x5d, 0x1e, 0xca, 0x5a, 0xce, 0x46, 0xc0, 0x9,  0xf0,
                   0x62, 0x57, 0xd3, 0x9e, 0xa3, 0x62, 0xdb, 0x93, 0x46, 0x33, 0x3e, 0xa,  0x0,  0xc,  0xad, 0x55, 0xf5,
                   0x6,  0x9c, 0x41, 0x5,  0xd0, 0xbb, 0xd0, 0x7f, 0x58, 0x29, 0x0,  0x6,  0xbc, 0xf6, 0xaa, 0x24, 0xf0,
                   0x19, 0x14, 0x0,  0x1c, 0x22, 0x7e, 0x52, 0x81, 0xbd, 0x2a, 0x50, 0x86, 0xba, 0x17, 0xde, 0xe6, 0x34,
                   0xa8, 0x5e, 0xed, 0x92, 0x6,  0xf0, 0xbe, 0x71, 0xcd, 0x99, 0x55, 0x1,  0x5e, 0x7c, 0x48, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0x18, 0xc5, 0x2f, 0xb0, 0x4d, 0x35, 0xc4,
                                     0x18, 0xe1, 0x81, 0x4c, 0x74, 0x8c, 0x28};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0x9d, 0x9b, 0x5d, 0x1e, 0xca, 0x5a, 0xce, 0x46, 0xc0, 0x9, 0xf0,
                                     0x62, 0x57, 0xd3, 0x9e, 0xa3, 0x62, 0xdb, 0x93, 0x46, 0x33, 0x3e};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xad, 0x55, 0xf5, 0x6, 0x9c, 0x41, 0x5, 0xd0, 0xbb, 0xd0, 0x7f, 0x58};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbc, 0xf6, 0xaa, 0x24, 0xf0, 0x19};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x22, 0x7e, 0x52, 0x81, 0xbd, 0x2a, 0x50, 0x86, 0xba, 0x17,
                                     0xde, 0xe6, 0x34, 0xa8, 0x5e, 0xed, 0x92, 0x6,  0xf0, 0xbe,
                                     0x71, 0xcd, 0x99, 0x55, 0x1,  0x5e, 0x7c, 0x48};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  uint8_t bytesprops0[] = {0x95, 0x99, 0x65, 0x89, 0xa,  0x19, 0xcc, 0xe4, 0x4e, 0x73, 0xcd, 0x13, 0x0,
                           0xa2, 0x9b, 0x15, 0x3a, 0xdf, 0x35, 0x18, 0xf8, 0x43, 0xc9, 0xce, 0xc2, 0x6e};
  uint8_t bytesprops1[] = {0xa0, 0x8a, 0x4b, 0xd0, 0xc9, 0x98, 0xd1, 0xe0, 0xad, 0x54, 0xd9, 0x21, 0xac};
  uint8_t bytesprops2[] = {0x79, 0xc3, 0xaf, 0x3};
  uint8_t bytesprops3[] = {0x8a, 0x63, 0x66, 0x5a, 0x2e, 0x93, 0x61, 0x23, 0x16, 0x2e, 0x4b, 0x25,
                           0xa3, 0xba, 0x53, 0x84, 0x59, 0x4b, 0x19, 0x26, 0x83, 0x17, 0x64, 0xf5};
  uint8_t bytesprops4[] = {0xfc, 0x93};
  uint8_t bytesprops5[] = {0xe1, 0x17, 0x58, 0xd7, 0x11, 0x0, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9386}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26762}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8554}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19029}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20156}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 6204, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8030 [("\234\190\DEL\176\250cyY\218\176\196\212\214",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\153\174",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\185D\196\STX\DC3\194\198\144\b\211h\192\175\SI\250aJ\177\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("6\ETB\STXr\219j\151-\227",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropCorrelationData "\DC4\209\216\241/\ETX\t\222\191\213\146S@\199\GSS\ETB\244;\f\195\187\SYN",PropResponseTopic
// "\191\SOH\233\131\240\221\129\148\196\157\218{n\201+q\181\217t\137Y\FSv\GS\129",PropSessionExpiryInterval
// 6725,PropTopicAliasMaximum 6943,PropMessageExpiryInterval 32523,PropResponseTopic
// "K\238\134\187\253\128!*\re\167\135J%\245\251\136\t^\242G\SI\155\ETBxb-P\217",PropRequestResponseInformation
// 102,PropWillDelayInterval 31845,PropAuthenticationMethod
// "\231\US\NULZ\151\DLE\218\226\v\252\191\157\167[\232\155^\243\DEL\146\222(}",PropReceiveMaximum
// 23804,PropReasonString "&\155\SO\192\243\NAK\253\241\\\175\190\180.x\234`UF\"",PropResponseInformation
// "\250\156\\\137f\135\USNg\230YE\US\220\NUL|\224r\201\238\175r",PropSubscriptionIdentifierAvailable
// 238,PropServerKeepAlive 13004,PropAssignedClientIdentifier
// "\244\186\246_&\194\224v<l\"b\241\&8\RS\250_'",PropAuthenticationMethod "\251",PropServerKeepAlive
// 8890,PropReceiveMaximum 1564,PropCorrelationData "\224$k\ESC\"\160tdu\161\155\148*\195\161",PropServerReference
// "\236\139\176\176\155\133\142\193\137\186Y7",PropResponseInformation "U=\207\161",PropSharedSubscriptionAvailable
// 21,PropResponseInformation "\DC1\206d\SOH\152\\",PropTopicAlias 1312,PropMessageExpiryInterval
// 14055,PropCorrelationData "\237~E\199r\175\199\246\191\152\160F\234\177\CAN",PropSharedSubscriptionAvailable
// 220,PropAuthenticationMethod "\215\n\234\r\140g\191\255==\163\191\DC3\221\184\SUB\186i\203\180my\FS\239"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xff, 0x2,  0x1f, 0x5e, 0xc4, 0x2,  0x9,  0x0,  0x17, 0x14, 0xd1, 0xd8, 0xf1, 0x2f, 0x3,  0x9,  0xde, 0xbf,
      0xd5, 0x92, 0x53, 0x40, 0xc7, 0x1d, 0x53, 0x17, 0xf4, 0x3b, 0xc,  0xc3, 0xbb, 0x16, 0x8,  0x0,  0x19, 0xbf, 0x1,
      0xe9, 0x83, 0xf0, 0xdd, 0x81, 0x94, 0xc4, 0x9d, 0xda, 0x7b, 0x6e, 0xc9, 0x2b, 0x71, 0xb5, 0xd9, 0x74, 0x89, 0x59,
      0x1c, 0x76, 0x1d, 0x81, 0x11, 0x0,  0x0,  0x1a, 0x45, 0x22, 0x1b, 0x1f, 0x2,  0x0,  0x0,  0x7f, 0xb,  0x8,  0x0,
      0x1d, 0x4b, 0xee, 0x86, 0xbb, 0xfd, 0x80, 0x21, 0x2a, 0xd,  0x65, 0xa7, 0x87, 0x4a, 0x25, 0xf5, 0xfb, 0x88, 0x9,
      0x5e, 0xf2, 0x47, 0xf,  0x9b, 0x17, 0x78, 0x62, 0x2d, 0x50, 0xd9, 0x19, 0x66, 0x18, 0x0,  0x0,  0x7c, 0x65, 0x15,
      0x0,  0x17, 0xe7, 0x1f, 0x0,  0x5a, 0x97, 0x10, 0xda, 0xe2, 0xb,  0xfc, 0xbf, 0x9d, 0xa7, 0x5b, 0xe8, 0x9b, 0x5e,
      0xf3, 0x7f, 0x92, 0xde, 0x28, 0x7d, 0x21, 0x5c, 0xfc, 0x1f, 0x0,  0x13, 0x26, 0x9b, 0xe,  0xc0, 0xf3, 0x15, 0xfd,
      0xf1, 0x5c, 0xaf, 0xbe, 0xb4, 0x2e, 0x78, 0xea, 0x60, 0x55, 0x46, 0x22, 0x1a, 0x0,  0x16, 0xfa, 0x9c, 0x5c, 0x89,
      0x66, 0x87, 0x1f, 0x4e, 0x67, 0xe6, 0x59, 0x45, 0x1f, 0xdc, 0x0,  0x7c, 0xe0, 0x72, 0xc9, 0xee, 0xaf, 0x72, 0x29,
      0xee, 0x13, 0x32, 0xcc, 0x12, 0x0,  0x12, 0xf4, 0xba, 0xf6, 0x5f, 0x26, 0xc2, 0xe0, 0x76, 0x3c, 0x6c, 0x22, 0x62,
      0xf1, 0x38, 0x1e, 0xfa, 0x5f, 0x27, 0x15, 0x0,  0x1,  0xfb, 0x13, 0x22, 0xba, 0x21, 0x6,  0x1c, 0x9,  0x0,  0xf,
      0xe0, 0x24, 0x6b, 0x1b, 0x22, 0xa0, 0x74, 0x64, 0x75, 0xa1, 0x9b, 0x94, 0x2a, 0xc3, 0xa1, 0x1c, 0x0,  0xc,  0xec,
      0x8b, 0xb0, 0xb0, 0x9b, 0x85, 0x8e, 0xc1, 0x89, 0xba, 0x59, 0x37, 0x1a, 0x0,  0x4,  0x55, 0x3d, 0xcf, 0xa1, 0x2a,
      0x15, 0x1a, 0x0,  0x6,  0x11, 0xce, 0x64, 0x1,  0x98, 0x5c, 0x23, 0x5,  0x20, 0x2,  0x0,  0x0,  0x36, 0xe7, 0x9,
      0x0,  0xf,  0xed, 0x7e, 0x45, 0xc7, 0x72, 0xaf, 0xc7, 0xf6, 0xbf, 0x98, 0xa0, 0x46, 0xea, 0xb1, 0x18, 0x2a, 0xdc,
      0x15, 0x0,  0x18, 0xd7, 0xa,  0xea, 0xd,  0x8c, 0x67, 0xbf, 0xff, 0x3d, 0x3d, 0xa3, 0xbf, 0x13, 0xdd, 0xb8, 0x1a,
      0xba, 0x69, 0xcb, 0xb4, 0x6d, 0x79, 0x1c, 0xef, 0x0,  0xd,  0xea, 0xbe, 0x7f, 0xb0, 0xfa, 0x63, 0x79, 0x59, 0xda,
      0xb0, 0xc4, 0xd4, 0xd6, 0x2e, 0x0,  0x2,  0x99, 0xae, 0x5,  0x0,  0x13, 0xb9, 0x44, 0xc4, 0x2,  0x13, 0xc2, 0xc6,
      0x90, 0x8,  0xd3, 0x68, 0xc0, 0xaf, 0xf,  0xfa, 0x61, 0x4a, 0xb1, 0xa7, 0x5,  0x0,  0x9,  0x36, 0x17, 0x2,  0x72,
      0xdb, 0x6a, 0x97, 0x2d, 0xe3, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea, 0xbe, 0x7f, 0xb0, 0xfa, 0x63, 0x79, 0x59, 0xda, 0xb0, 0xc4, 0xd4, 0xd6};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x99, 0xae};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb9, 0x44, 0xc4, 0x2, 0x13, 0xc2, 0xc6, 0x90, 0x8, 0xd3,
                                     0x68, 0xc0, 0xaf, 0xf, 0xfa, 0x61, 0x4a, 0xb1, 0xa7};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x17, 0x2, 0x72, 0xdb, 0x6a, 0x97, 0x2d, 0xe3};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x14, 0xd1, 0xd8, 0xf1, 0x2f, 0x3,  0x9,  0xde, 0xbf, 0xd5, 0x92, 0x53,
                           0x40, 0xc7, 0x1d, 0x53, 0x17, 0xf4, 0x3b, 0xc,  0xc3, 0xbb, 0x16};
  uint8_t bytesprops1[] = {0xbf, 0x1,  0xe9, 0x83, 0xf0, 0xdd, 0x81, 0x94, 0xc4, 0x9d, 0xda, 0x7b, 0x6e,
                           0xc9, 0x2b, 0x71, 0xb5, 0xd9, 0x74, 0x89, 0x59, 0x1c, 0x76, 0x1d, 0x81};
  uint8_t bytesprops2[] = {0x4b, 0xee, 0x86, 0xbb, 0xfd, 0x80, 0x21, 0x2a, 0xd,  0x65, 0xa7, 0x87, 0x4a, 0x25, 0xf5,
                           0xfb, 0x88, 0x9,  0x5e, 0xf2, 0x47, 0xf,  0x9b, 0x17, 0x78, 0x62, 0x2d, 0x50, 0xd9};
  uint8_t bytesprops3[] = {0xe7, 0x1f, 0x0,  0x5a, 0x97, 0x10, 0xda, 0xe2, 0xb,  0xfc, 0xbf, 0x9d,
                           0xa7, 0x5b, 0xe8, 0x9b, 0x5e, 0xf3, 0x7f, 0x92, 0xde, 0x28, 0x7d};
  uint8_t bytesprops4[] = {0x26, 0x9b, 0xe,  0xc0, 0xf3, 0x15, 0xfd, 0xf1, 0x5c, 0xaf,
                           0xbe, 0xb4, 0x2e, 0x78, 0xea, 0x60, 0x55, 0x46, 0x22};
  uint8_t bytesprops5[] = {0xfa, 0x9c, 0x5c, 0x89, 0x66, 0x87, 0x1f, 0x4e, 0x67, 0xe6, 0x59,
                           0x45, 0x1f, 0xdc, 0x0,  0x7c, 0xe0, 0x72, 0xc9, 0xee, 0xaf, 0x72};
  uint8_t bytesprops6[] = {0xf4, 0xba, 0xf6, 0x5f, 0x26, 0xc2, 0xe0, 0x76, 0x3c,
                           0x6c, 0x22, 0x62, 0xf1, 0x38, 0x1e, 0xfa, 0x5f, 0x27};
  uint8_t bytesprops7[] = {0xfb};
  uint8_t bytesprops8[] = {0xe0, 0x24, 0x6b, 0x1b, 0x22, 0xa0, 0x74, 0x64, 0x75, 0xa1, 0x9b, 0x94, 0x2a, 0xc3, 0xa1};
  uint8_t bytesprops9[] = {0xec, 0x8b, 0xb0, 0xb0, 0x9b, 0x85, 0x8e, 0xc1, 0x89, 0xba, 0x59, 0x37};
  uint8_t bytesprops10[] = {0x55, 0x3d, 0xcf, 0xa1};
  uint8_t bytesprops11[] = {0x11, 0xce, 0x64, 0x1, 0x98, 0x5c};
  uint8_t bytesprops12[] = {0xed, 0x7e, 0x45, 0xc7, 0x72, 0xaf, 0xc7, 0xf6, 0xbf, 0x98, 0xa0, 0x46, 0xea, 0xb1, 0x18};
  uint8_t bytesprops13[] = {0xd7, 0xa,  0xea, 0xd,  0x8c, 0x67, 0xbf, 0xff, 0x3d, 0x3d, 0xa3, 0xbf,
                            0x13, 0xdd, 0xb8, 0x1a, 0xba, 0x69, 0xcb, 0xb4, 0x6d, 0x79, 0x1c, 0xef};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6725}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6943}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32523}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31845}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23804}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13004}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8890}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1564}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1312}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14055}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8030, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25611
// [("\193&\245\253\192\158\"\200\178\219\187\160\173vT\207\DC4\253\200\NAKd_8\228:\218\238\129",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\219\189\166\255\198\&0\164\&0\ESCg\SOHr<\253Ms\CAN\ETX",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropResponseTopic
// "AV/\249\CAN\191\r\201-\159\175\229\164\163\a\134u\148\NULY\229\185\184\191\ENQ\145\226}\135",PropResponseTopic
// "\167\188H\218\185\187=\RS\234\188\214\206\214\RS\180\242\194\179G",PropSubscriptionIdentifier
// 13,PropAuthenticationData "\162\255\205\225\175|]\235\137\&4\154\r\213\191",PropSessionExpiryInterval
// 14360,PropPayloadFormatIndicator 23,PropUserProperty "\DC1\167g\215\166\181\231M\213"
// "\153\142\SUB\254\NAK\128Y!\f0\183\137}\176\SYN\DEL\SYN)fQ;\202|\170\165\137=\238",PropServerReference
// "\SO\130\184\213",PropServerKeepAlive 27131,PropSubscriptionIdentifierAvailable 107,PropMessageExpiryInterval
// 11984,PropRetainAvailable 57,PropServerKeepAlive 20967,PropSubscriptionIdentifier 19,PropContentType
// "f3",PropWildcardSubscriptionAvailable 131,PropAssignedClientIdentifier "\182k\157\ENQ\133S\201\159\147\177<0C\162\EM
// \DC4\180\160w\STX\139r\162\204",PropPayloadFormatIndicator 211,PropRetainAvailable 164,PropServerReference
// "\247\142\221Z\220/\251",PropRetainAvailable 102,PropMaximumPacketSize 19042,PropTopicAliasMaximum
// 26201,PropServerKeepAlive 10394,PropMaximumPacketSize 8344,PropUserProperty "\ETB\134P"
// "\188\169\"D)\b\NAK~\186\178|\132?P\242",PropAuthenticationMethod "\177\b\251\&3J\248\RSl\226\f\231\a_\133"]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xb5, 0x2,  0x64, 0xb,  0xfd, 0x1,  0x8,  0x0,  0x1d, 0x41, 0x56, 0x2f, 0xf9, 0x18, 0xbf, 0xd,  0xc9, 0x2d,
      0x9f, 0xaf, 0xe5, 0xa4, 0xa3, 0x7,  0x86, 0x75, 0x94, 0x0,  0x59, 0xe5, 0xb9, 0xb8, 0xbf, 0x5,  0x91, 0xe2, 0x7d,
      0x87, 0x8,  0x0,  0x13, 0xa7, 0xbc, 0x48, 0xda, 0xb9, 0xbb, 0x3d, 0x1e, 0xea, 0xbc, 0xd6, 0xce, 0xd6, 0x1e, 0xb4,
      0xf2, 0xc2, 0xb3, 0x47, 0xb,  0xd,  0x16, 0x0,  0xe,  0xa2, 0xff, 0xcd, 0xe1, 0xaf, 0x7c, 0x5d, 0xeb, 0x89, 0x34,
      0x9a, 0xd,  0xd5, 0xbf, 0x11, 0x0,  0x0,  0x38, 0x18, 0x1,  0x17, 0x26, 0x0,  0x9,  0x11, 0xa7, 0x67, 0xd7, 0xa6,
      0xb5, 0xe7, 0x4d, 0xd5, 0x0,  0x1c, 0x99, 0x8e, 0x1a, 0xfe, 0x15, 0x80, 0x59, 0x21, 0xc,  0x30, 0xb7, 0x89, 0x7d,
      0xb0, 0x16, 0x7f, 0x16, 0x29, 0x66, 0x51, 0x3b, 0xca, 0x7c, 0xaa, 0xa5, 0x89, 0x3d, 0xee, 0x1c, 0x0,  0x4,  0xe,
      0x82, 0xb8, 0xd5, 0x13, 0x69, 0xfb, 0x29, 0x6b, 0x2,  0x0,  0x0,  0x2e, 0xd0, 0x25, 0x39, 0x13, 0x51, 0xe7, 0xb,
      0x13, 0x3,  0x0,  0x2,  0x66, 0x33, 0x28, 0x83, 0x12, 0x0,  0x19, 0xb6, 0x6b, 0x9d, 0x5,  0x85, 0x53, 0xc9, 0x9f,
      0x93, 0xb1, 0x3c, 0x30, 0x43, 0xa2, 0x19, 0x20, 0x14, 0xb4, 0xa0, 0x77, 0x2,  0x8b, 0x72, 0xa2, 0xcc, 0x1,  0xd3,
      0x25, 0xa4, 0x1c, 0x0,  0x7,  0xf7, 0x8e, 0xdd, 0x5a, 0xdc, 0x2f, 0xfb, 0x25, 0x66, 0x27, 0x0,  0x0,  0x4a, 0x62,
      0x22, 0x66, 0x59, 0x13, 0x28, 0x9a, 0x27, 0x0,  0x0,  0x20, 0x98, 0x26, 0x0,  0x3,  0x17, 0x86, 0x50, 0x0,  0xf,
      0xbc, 0xa9, 0x22, 0x44, 0x29, 0x8,  0x15, 0x7e, 0xba, 0xb2, 0x7c, 0x84, 0x3f, 0x50, 0xf2, 0x15, 0x0,  0xe,  0xb1,
      0x8,  0xfb, 0x33, 0x4a, 0xf8, 0x1e, 0x6c, 0xe2, 0xc,  0xe7, 0x7,  0x5f, 0x85, 0x0,  0x1c, 0xc1, 0x26, 0xf5, 0xfd,
      0xc0, 0x9e, 0x22, 0xc8, 0xb2, 0xdb, 0xbb, 0xa0, 0xad, 0x76, 0x54, 0xcf, 0x14, 0xfd, 0xc8, 0x15, 0x64, 0x5f, 0x38,
      0xe4, 0x3a, 0xda, 0xee, 0x81, 0xd,  0x0,  0x12, 0xdb, 0xbd, 0xa6, 0xff, 0xc6, 0x30, 0xa4, 0x30, 0x1b, 0x67, 0x1,
      0x72, 0x3c, 0xfd, 0x4d, 0x73, 0x18, 0x3,  0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xc1, 0x26, 0xf5, 0xfd, 0xc0, 0x9e, 0x22, 0xc8, 0xb2, 0xdb,
                                     0xbb, 0xa0, 0xad, 0x76, 0x54, 0xcf, 0x14, 0xfd, 0xc8, 0x15,
                                     0x64, 0x5f, 0x38, 0xe4, 0x3a, 0xda, 0xee, 0x81};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0xbd, 0xa6, 0xff, 0xc6, 0x30, 0xa4, 0x30, 0x1b,
                                     0x67, 0x1,  0x72, 0x3c, 0xfd, 0x4d, 0x73, 0x18, 0x3};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x41, 0x56, 0x2f, 0xf9, 0x18, 0xbf, 0xd,  0xc9, 0x2d, 0x9f, 0xaf, 0xe5, 0xa4, 0xa3, 0x7,
                           0x86, 0x75, 0x94, 0x0,  0x59, 0xe5, 0xb9, 0xb8, 0xbf, 0x5,  0x91, 0xe2, 0x7d, 0x87};
  uint8_t bytesprops1[] = {0xa7, 0xbc, 0x48, 0xda, 0xb9, 0xbb, 0x3d, 0x1e, 0xea, 0xbc,
                           0xd6, 0xce, 0xd6, 0x1e, 0xb4, 0xf2, 0xc2, 0xb3, 0x47};
  uint8_t bytesprops2[] = {0xa2, 0xff, 0xcd, 0xe1, 0xaf, 0x7c, 0x5d, 0xeb, 0x89, 0x34, 0x9a, 0xd, 0xd5, 0xbf};
  uint8_t bytesprops4[] = {0x99, 0x8e, 0x1a, 0xfe, 0x15, 0x80, 0x59, 0x21, 0xc,  0x30, 0xb7, 0x89, 0x7d, 0xb0,
                           0x16, 0x7f, 0x16, 0x29, 0x66, 0x51, 0x3b, 0xca, 0x7c, 0xaa, 0xa5, 0x89, 0x3d, 0xee};
  uint8_t bytesprops3[] = {0x11, 0xa7, 0x67, 0xd7, 0xa6, 0xb5, 0xe7, 0x4d, 0xd5};
  uint8_t bytesprops5[] = {0xe, 0x82, 0xb8, 0xd5};
  uint8_t bytesprops6[] = {0x66, 0x33};
  uint8_t bytesprops7[] = {0xb6, 0x6b, 0x9d, 0x5,  0x85, 0x53, 0xc9, 0x9f, 0x93, 0xb1, 0x3c, 0x30, 0x43,
                           0xa2, 0x19, 0x20, 0x14, 0xb4, 0xa0, 0x77, 0x2,  0x8b, 0x72, 0xa2, 0xcc};
  uint8_t bytesprops8[] = {0xf7, 0x8e, 0xdd, 0x5a, 0xdc, 0x2f, 0xfb};
  uint8_t bytesprops10[] = {0xbc, 0xa9, 0x22, 0x44, 0x29, 0x8, 0x15, 0x7e, 0xba, 0xb2, 0x7c, 0x84, 0x3f, 0x50, 0xf2};
  uint8_t bytesprops9[] = {0x17, 0x86, 0x50};
  uint8_t bytesprops11[] = {0xb1, 0x8, 0xfb, 0x33, 0x4a, 0xf8, 0x1e, 0x6c, 0xe2, 0xc, 0xe7, 0x7, 0x5f, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14360}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops3}, .v = {28, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27131}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11984}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20967}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19042}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26201}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10394}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8344}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops9}, .v = {15, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25611, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20073 [("\150\229\151f\221S\227F9\174\140\214\205\194\&6",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("b'\220g\205\179\146\202\229\249\GS\151R#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = True, _subQoS = QoS1}),("\NAK",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\212m\205\&6\249'\241wU\144\246\172\DEL4b!*\199\&4K\220\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("h\235\206",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\252\156\160\253\208\193C\SI[\235\239\236\248\207J&b\135\248\157",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\SYN\167%\167C+\SOH\205\197\t3\244\136\RS\ETB\237:\n\EOTco\DC3~\160\135",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\131\204\157\FS\182\179\254}\198^zy\160P\255\NAK\192]\172\DLE(\173\129oIr\144u\212",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\230\212\130m\136\168\227\&6\206;\ACK\STX\242",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\249\t3\197x@\253D\DC4\"\229\193\219\163\145}\167\&9\182\145I",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("yW<\191",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropAuthenticationData "\146\US\n\162'\207\224\248\&6j\183.(t\241J\DC1\t",PropMaximumPacketSize
// 10820,PropRequestResponseInformation 112,PropReceiveMaximum 16246,PropAssignedClientIdentifier
// "\241\130\203\133\CAN\217n\GS\aM\255\198\STX\b\214\241y\DC2\172\184|\159\202"]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0x84, 0x2,  0x4e, 0x69, 0x39, 0x16, 0x0,  0x12, 0x92, 0x1f, 0xa,  0xa2, 0x27, 0xcf, 0xe0, 0xf8, 0x36, 0x6a,
      0xb7, 0x2e, 0x28, 0x74, 0xf1, 0x4a, 0x11, 0x9,  0x27, 0x0,  0x0,  0x2a, 0x44, 0x19, 0x70, 0x21, 0x3f, 0x76, 0x12,
      0x0,  0x17, 0xf1, 0x82, 0xcb, 0x85, 0x18, 0xd9, 0x6e, 0x1d, 0x7,  0x4d, 0xff, 0xc6, 0x2,  0x8,  0xd6, 0xf1, 0x79,
      0x12, 0xac, 0xb8, 0x7c, 0x9f, 0xca, 0x0,  0xf,  0x96, 0xe5, 0x97, 0x66, 0xdd, 0x53, 0xe3, 0x46, 0x39, 0xae, 0x8c,
      0xd6, 0xcd, 0xc2, 0x36, 0x19, 0x0,  0xe,  0x62, 0x27, 0xdc, 0x67, 0xcd, 0xb3, 0x92, 0xca, 0xe5, 0xf9, 0x1d, 0x97,
      0x52, 0x23, 0x5,  0x0,  0x1,  0x15, 0x1a, 0x0,  0x16, 0xd4, 0x6d, 0xcd, 0x36, 0xf9, 0x27, 0xf1, 0x77, 0x55, 0x90,
      0xf6, 0xac, 0x7f, 0x34, 0x62, 0x21, 0x2a, 0xc7, 0x34, 0x4b, 0xdc, 0xe1, 0xe,  0x0,  0x3,  0x68, 0xeb, 0xce, 0xc,
      0x0,  0x14, 0xfc, 0x9c, 0xa0, 0xfd, 0xd0, 0xc1, 0x43, 0xf,  0x5b, 0xeb, 0xef, 0xec, 0xf8, 0xcf, 0x4a, 0x26, 0x62,
      0x87, 0xf8, 0x9d, 0x9,  0x0,  0x19, 0x16, 0xa7, 0x25, 0xa7, 0x43, 0x2b, 0x1,  0xcd, 0xc5, 0x9,  0x33, 0xf4, 0x88,
      0x1e, 0x17, 0xed, 0x3a, 0xa,  0x4,  0x63, 0x6f, 0x13, 0x7e, 0xa0, 0x87, 0x16, 0x0,  0x1d, 0x83, 0xcc, 0x9d, 0x1c,
      0xb6, 0xb3, 0xfe, 0x7d, 0xc6, 0x5e, 0x7a, 0x79, 0xa0, 0x50, 0xff, 0x15, 0xc0, 0x5d, 0xac, 0x10, 0x28, 0xad, 0x81,
      0x6f, 0x49, 0x72, 0x90, 0x75, 0xd4, 0x8,  0x0,  0xd,  0xe6, 0xd4, 0x82, 0x6d, 0x88, 0xa8, 0xe3, 0x36, 0xce, 0x3b,
      0x6,  0x2,  0xf2, 0x25, 0x0,  0x15, 0xf9, 0x9,  0x33, 0xc5, 0x78, 0x40, 0xfd, 0x44, 0x14, 0x22, 0xe5, 0xc1, 0xdb,
      0xa3, 0x91, 0x7d, 0xa7, 0x39, 0xb6, 0x91, 0x49, 0x12, 0x0,  0x4,  0x79, 0x57, 0x3c, 0xbf, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x96, 0xe5, 0x97, 0x66, 0xdd, 0x53, 0xe3, 0x46,
                                     0x39, 0xae, 0x8c, 0xd6, 0xcd, 0xc2, 0x36};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x62, 0x27, 0xdc, 0x67, 0xcd, 0xb3, 0x92,
                                     0xca, 0xe5, 0xf9, 0x1d, 0x97, 0x52, 0x23};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x15};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x6d, 0xcd, 0x36, 0xf9, 0x27, 0xf1, 0x77, 0x55, 0x90, 0xf6,
                                     0xac, 0x7f, 0x34, 0x62, 0x21, 0x2a, 0xc7, 0x34, 0x4b, 0xdc, 0xe1};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0xeb, 0xce};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x9c, 0xa0, 0xfd, 0xd0, 0xc1, 0x43, 0xf,  0x5b, 0xeb,
                                     0xef, 0xec, 0xf8, 0xcf, 0x4a, 0x26, 0x62, 0x87, 0xf8, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x16, 0xa7, 0x25, 0xa7, 0x43, 0x2b, 0x1,  0xcd, 0xc5, 0x9,  0x33, 0xf4, 0x88,
                                     0x1e, 0x17, 0xed, 0x3a, 0xa,  0x4,  0x63, 0x6f, 0x13, 0x7e, 0xa0, 0x87};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x83, 0xcc, 0x9d, 0x1c, 0xb6, 0xb3, 0xfe, 0x7d, 0xc6, 0x5e,
                                     0x7a, 0x79, 0xa0, 0x50, 0xff, 0x15, 0xc0, 0x5d, 0xac, 0x10,
                                     0x28, 0xad, 0x81, 0x6f, 0x49, 0x72, 0x90, 0x75, 0xd4};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe6, 0xd4, 0x82, 0x6d, 0x88, 0xa8, 0xe3, 0x36, 0xce, 0x3b, 0x6, 0x2, 0xf2};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xf9, 0x9,  0x33, 0xc5, 0x78, 0x40, 0xfd, 0x44, 0x14, 0x22, 0xe5,
                                     0xc1, 0xdb, 0xa3, 0x91, 0x7d, 0xa7, 0x39, 0xb6, 0x91, 0x49};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x79, 0x57, 0x3c, 0xbf};
  lwmqtt_string_t topic_filter_s10 = {4, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x92, 0x1f, 0xa,  0xa2, 0x27, 0xcf, 0xe0, 0xf8, 0x36,
                           0x6a, 0xb7, 0x2e, 0x28, 0x74, 0xf1, 0x4a, 0x11, 0x9};
  uint8_t bytesprops1[] = {0xf1, 0x82, 0xcb, 0x85, 0x18, 0xd9, 0x6e, 0x1d, 0x7,  0x4d, 0xff, 0xc6,
                           0x2,  0x8,  0xd6, 0xf1, 0x79, 0x12, 0xac, 0xb8, 0x7c, 0x9f, 0xca};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10820}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16246}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20073, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12782 [("\238\199\163\EOT$\228\173\174\EM\128vA\216",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\172,\203\248Z\129\GS\RSj.\208\aqM\178\167n7\235",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\229.\210\152\ETB\234\229V\FS\177\214\ETBE\143D\ETB\222\154\157&\204\247\239",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\198\151\141\&8-\DEL\251\FS\a\CANfH\231*i\179\172\r\239_\141S(~Y\236",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("9oU\227^\\\129P74A\252\165^<\US\206\&6\148\182\&1\154\238\235\248\210\164\ENQ\ACK\184",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})]
// [PropSharedSubscriptionAvailable 204,PropResponseInformation "E\170)=Q\201\t",PropAuthenticationData
// "\171\225\ETX;\176Zzi\246\195\237f\SI\199\232M\US\DC4\179*\160\177V\183\239n"]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0xaa, 0x1,  0x31, 0xee, 0x29, 0x2a, 0xcc, 0x1a, 0x0,  0x7,  0x45, 0xaa, 0x29, 0x3d, 0x51,
                   0xc9, 0x9,  0x16, 0x0,  0x1a, 0xab, 0xe1, 0x3,  0x3b, 0xb0, 0x5a, 0x7a, 0x69, 0xf6, 0xc3, 0xed,
                   0x66, 0xf,  0xc7, 0xe8, 0x4d, 0x1f, 0x14, 0xb3, 0x2a, 0xa0, 0xb1, 0x56, 0xb7, 0xef, 0x6e, 0x0,
                   0xd,  0xee, 0xc7, 0xa3, 0x4,  0x24, 0xe4, 0xad, 0xae, 0x19, 0x80, 0x76, 0x41, 0xd8, 0x1e, 0x0,
                   0x13, 0xac, 0x2c, 0xcb, 0xf8, 0x5a, 0x81, 0x1d, 0x1e, 0x6a, 0x2e, 0xd0, 0x7,  0x71, 0x4d, 0xb2,
                   0xa7, 0x6e, 0x37, 0xeb, 0x4,  0x0,  0x17, 0xe5, 0x2e, 0xd2, 0x98, 0x17, 0xea, 0xe5, 0x56, 0x1c,
                   0xb1, 0xd6, 0x17, 0x45, 0x8f, 0x44, 0x17, 0xde, 0x9a, 0x9d, 0x26, 0xcc, 0xf7, 0xef, 0x1d, 0x0,
                   0x1a, 0xc6, 0x97, 0x8d, 0x38, 0x2d, 0x7f, 0xfb, 0x1c, 0x7,  0x18, 0x66, 0x48, 0xe7, 0x2a, 0x69,
                   0xb3, 0xac, 0xd,  0xef, 0x5f, 0x8d, 0x53, 0x28, 0x7e, 0x59, 0xec, 0x0,  0x0,  0x1e, 0x39, 0x6f,
                   0x55, 0xe3, 0x5e, 0x5c, 0x81, 0x50, 0x37, 0x34, 0x41, 0xfc, 0xa5, 0x5e, 0x3c, 0x1f, 0xce, 0x36,
                   0x94, 0xb6, 0x31, 0x9a, 0xee, 0xeb, 0xf8, 0xd2, 0xa4, 0x5,  0x6,  0xb8, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xee, 0xc7, 0xa3, 0x4, 0x24, 0xe4, 0xad, 0xae, 0x19, 0x80, 0x76, 0x41, 0xd8};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xac, 0x2c, 0xcb, 0xf8, 0x5a, 0x81, 0x1d, 0x1e, 0x6a, 0x2e,
                                     0xd0, 0x7,  0x71, 0x4d, 0xb2, 0xa7, 0x6e, 0x37, 0xeb};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0x2e, 0xd2, 0x98, 0x17, 0xea, 0xe5, 0x56, 0x1c, 0xb1, 0xd6, 0x17,
                                     0x45, 0x8f, 0x44, 0x17, 0xde, 0x9a, 0x9d, 0x26, 0xcc, 0xf7, 0xef};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc6, 0x97, 0x8d, 0x38, 0x2d, 0x7f, 0xfb, 0x1c, 0x7,  0x18, 0x66, 0x48, 0xe7,
                                     0x2a, 0x69, 0xb3, 0xac, 0xd,  0xef, 0x5f, 0x8d, 0x53, 0x28, 0x7e, 0x59, 0xec};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x39, 0x6f, 0x55, 0xe3, 0x5e, 0x5c, 0x81, 0x50, 0x37, 0x34,
                                     0x41, 0xfc, 0xa5, 0x5e, 0x3c, 0x1f, 0xce, 0x36, 0x94, 0xb6,
                                     0x31, 0x9a, 0xee, 0xeb, 0xf8, 0xd2, 0xa4, 0x5,  0x6,  0xb8};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x45, 0xaa, 0x29, 0x3d, 0x51, 0xc9, 0x9};
  uint8_t bytesprops1[] = {0xab, 0xe1, 0x3,  0x3b, 0xb0, 0x5a, 0x7a, 0x69, 0xf6, 0xc3, 0xed, 0x66, 0xf,
                           0xc7, 0xe8, 0x4d, 0x1f, 0x14, 0xb3, 0x2a, 0xa0, 0xb1, 0x56, 0xb7, 0xef, 0x6e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12782, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7994 [("w\248Bj\ETB\DC2\226U",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS0}),("\190\217[",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("4/\225\175\&4\185\&5j\228\195\217\184\142\145(7%\165fb]\156\STX",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\131\156\225\148\176O5\ETX\213\218\214\174\214S\242\198Y\152\&2V%\188\222\GS8",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("1\US\176)\SYN3\SO\n\n4r\188\165vj\216\187]%\243\&244\SYN\186\166\r",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\170:\197\207\254\DLE\218c\r\134\184\235\NULq?\174\146B\227\240\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\151\237H\215M\151\DC4\144\228\180c\210\v\195\251",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\162\255\252\DC17\138\&3.\159W\239\237{Z/T\SO\132\246\251\170\243\186\162\177\&7",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\225)u\SUB\181#\ETB\132 \212\238G9{|-{h:@r0\186r\DC4\214\225\&4",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("l$",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),(">\217\185\166\NAK\216\248(\172\194\189",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1})] [PropAuthenticationData "\170\159z\238\186^\223\210",PropServerKeepAlive
// 8290,PropTopicAliasMaximum 4943,PropSharedSubscriptionAvailable 22,PropTopicAliasMaximum 9948,PropAuthenticationData
// "\176p\192\156\US\n\217\139Z\202X\234\140y,\195\147",PropReasonString
// "\250\136A\138\143b\181]e/V\134l=\185\248\np\129\172(\RS\186\SI",PropResponseTopic
// "/\184\181>>\231\SO\219'\147\130\177\238r\233 Gx\198Fd\215\209\SYN.\DC2\SO\177\129+",PropReasonString
// "\170",PropContentType
// "\147Mq\ENQB!\247\143\237b\ACK#\163\176\179\ESC`\198\133\205zK\SOH]\204\172Z\203\165",PropMaximumPacketSize
// 31659,PropMaximumPacketSize 4540,PropResponseInformation
// "\233{\135\f\247y&\204\237\254\&7\ACK\CAND\135\r0\183L\DELGc\194YW",PropMessageExpiryInterval
// 24650,PropPayloadFormatIndicator 205,PropContentType
// "F\166\236\159f\US\230t0%\242\231\165\222P\SO\163\&0\fGGw\143_G7\158\187",PropServerReference
// "\199\162\220\164v\209\209\DC3\216\226\&4\215\CAN\GS\215-\150\170\169\176\193_\131\148\242\205h\b\198",PropResponseInformation
// "\NAK\210\128z\200\208>\190\217\132\227C\182\239v\172\173.3\SUBy\143\171\229\181\144A",PropReasonString
// ">\242N9\182",PropUserProperty "\158\141\252\150"
// "\172\ETB\165B\189\196\222\173\240\200\159K\NUL",PropAuthenticationMethod
// "\186\213\132\224\ETB\237\141\aa\ETB`\135\194\219\243\184?\v\235b\ESC\137\180B\199",PropAuthenticationMethod
// "\247-\159\142G4\250\223\&1\178\173\223\144)",PropAuthenticationMethod
// "\209\SOl\251\222\192\DC4\SOU\DC2\US\199i\211\193\248\138\GS\231\202\223\128\214\184^\135\240S",PropContentType
// "\159#\142\233\"\154\DC4\214ikm\150\RS",PropMessageExpiryInterval 7285]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0xf5, 0x4,  0x1f, 0x3a, 0x93, 0x3,  0x16, 0x0,  0x8,  0xaa, 0x9f, 0x7a, 0xee, 0xba, 0x5e, 0xdf, 0xd2, 0x13,
      0x20, 0x62, 0x22, 0x13, 0x4f, 0x2a, 0x16, 0x22, 0x26, 0xdc, 0x16, 0x0,  0x11, 0xb0, 0x70, 0xc0, 0x9c, 0x1f, 0xa,
      0xd9, 0x8b, 0x5a, 0xca, 0x58, 0xea, 0x8c, 0x79, 0x2c, 0xc3, 0x93, 0x1f, 0x0,  0x18, 0xfa, 0x88, 0x41, 0x8a, 0x8f,
      0x62, 0xb5, 0x5d, 0x65, 0x2f, 0x56, 0x86, 0x6c, 0x3d, 0xb9, 0xf8, 0xa,  0x70, 0x81, 0xac, 0x28, 0x1e, 0xba, 0xf,
      0x8,  0x0,  0x1e, 0x2f, 0xb8, 0xb5, 0x3e, 0x3e, 0xe7, 0xe,  0xdb, 0x27, 0x93, 0x82, 0xb1, 0xee, 0x72, 0xe9, 0x20,
      0x47, 0x78, 0xc6, 0x46, 0x64, 0xd7, 0xd1, 0x16, 0x2e, 0x12, 0xe,  0xb1, 0x81, 0x2b, 0x1f, 0x0,  0x1,  0xaa, 0x3,
      0x0,  0x1d, 0x93, 0x4d, 0x71, 0x5,  0x42, 0x21, 0xf7, 0x8f, 0xed, 0x62, 0x6,  0x23, 0xa3, 0xb0, 0xb3, 0x1b, 0x60,
      0xc6, 0x85, 0xcd, 0x7a, 0x4b, 0x1,  0x5d, 0xcc, 0xac, 0x5a, 0xcb, 0xa5, 0x27, 0x0,  0x0,  0x7b, 0xab, 0x27, 0x0,
      0x0,  0x11, 0xbc, 0x1a, 0x0,  0x19, 0xe9, 0x7b, 0x87, 0xc,  0xf7, 0x79, 0x26, 0xcc, 0xed, 0xfe, 0x37, 0x6,  0x18,
      0x44, 0x87, 0xd,  0x30, 0xb7, 0x4c, 0x7f, 0x47, 0x63, 0xc2, 0x59, 0x57, 0x2,  0x0,  0x0,  0x60, 0x4a, 0x1,  0xcd,
      0x3,  0x0,  0x1c, 0x46, 0xa6, 0xec, 0x9f, 0x66, 0x1f, 0xe6, 0x74, 0x30, 0x25, 0xf2, 0xe7, 0xa5, 0xde, 0x50, 0xe,
      0xa3, 0x30, 0xc,  0x47, 0x47, 0x77, 0x8f, 0x5f, 0x47, 0x37, 0x9e, 0xbb, 0x1c, 0x0,  0x1d, 0xc7, 0xa2, 0xdc, 0xa4,
      0x76, 0xd1, 0xd1, 0x13, 0xd8, 0xe2, 0x34, 0xd7, 0x18, 0x1d, 0xd7, 0x2d, 0x96, 0xaa, 0xa9, 0xb0, 0xc1, 0x5f, 0x83,
      0x94, 0xf2, 0xcd, 0x68, 0x8,  0xc6, 0x1a, 0x0,  0x1b, 0x15, 0xd2, 0x80, 0x7a, 0xc8, 0xd0, 0x3e, 0xbe, 0xd9, 0x84,
      0xe3, 0x43, 0xb6, 0xef, 0x76, 0xac, 0xad, 0x2e, 0x33, 0x1a, 0x79, 0x8f, 0xab, 0xe5, 0xb5, 0x90, 0x41, 0x1f, 0x0,
      0x5,  0x3e, 0xf2, 0x4e, 0x39, 0xb6, 0x26, 0x0,  0x4,  0x9e, 0x8d, 0xfc, 0x96, 0x0,  0xd,  0xac, 0x17, 0xa5, 0x42,
      0xbd, 0xc4, 0xde, 0xad, 0xf0, 0xc8, 0x9f, 0x4b, 0x0,  0x15, 0x0,  0x19, 0xba, 0xd5, 0x84, 0xe0, 0x17, 0xed, 0x8d,
      0x7,  0x61, 0x17, 0x60, 0x87, 0xc2, 0xdb, 0xf3, 0xb8, 0x3f, 0xb,  0xeb, 0x62, 0x1b, 0x89, 0xb4, 0x42, 0xc7, 0x15,
      0x0,  0xe,  0xf7, 0x2d, 0x9f, 0x8e, 0x47, 0x34, 0xfa, 0xdf, 0x31, 0xb2, 0xad, 0xdf, 0x90, 0x29, 0x15, 0x0,  0x1c,
      0xd1, 0xe,  0x6c, 0xfb, 0xde, 0xc0, 0x14, 0xe,  0x55, 0x12, 0x1f, 0xc7, 0x69, 0xd3, 0xc1, 0xf8, 0x8a, 0x1d, 0xe7,
      0xca, 0xdf, 0x80, 0xd6, 0xb8, 0x5e, 0x87, 0xf0, 0x53, 0x3,  0x0,  0xd,  0x9f, 0x23, 0x8e, 0xe9, 0x22, 0x9a, 0x14,
      0xd6, 0x69, 0x6b, 0x6d, 0x96, 0x1e, 0x2,  0x0,  0x0,  0x1c, 0x75, 0x0,  0x8,  0x77, 0xf8, 0x42, 0x6a, 0x17, 0x12,
      0xe2, 0x55, 0x4,  0x0,  0x3,  0xbe, 0xd9, 0x5b, 0x29, 0x0,  0x17, 0x34, 0x2f, 0xe1, 0xaf, 0x34, 0xb9, 0x35, 0x6a,
      0xe4, 0xc3, 0xd9, 0xb8, 0x8e, 0x91, 0x28, 0x37, 0x25, 0xa5, 0x66, 0x62, 0x5d, 0x9c, 0x2,  0x1a, 0x0,  0x19, 0x83,
      0x9c, 0xe1, 0x94, 0xb0, 0x4f, 0x35, 0x3,  0xd5, 0xda, 0xd6, 0xae, 0xd6, 0x53, 0xf2, 0xc6, 0x59, 0x98, 0x32, 0x56,
      0x25, 0xbc, 0xde, 0x1d, 0x38, 0x22, 0x0,  0x1b, 0x31, 0x1f, 0xb0, 0x29, 0x16, 0x33, 0xe,  0xa,  0xa,  0x34, 0x72,
      0xbc, 0xa5, 0x76, 0x6a, 0xd8, 0xbb, 0x5d, 0x25, 0xf3, 0x32, 0x34, 0x34, 0x16, 0xba, 0xa6, 0xd,  0x29, 0x0,  0x15,
      0xaa, 0x3a, 0xc5, 0xcf, 0xfe, 0x10, 0xda, 0x63, 0xd,  0x86, 0xb8, 0xeb, 0x0,  0x71, 0x3f, 0xae, 0x92, 0x42, 0xe3,
      0xf0, 0xd3, 0xe,  0x0,  0xf,  0x97, 0xed, 0x48, 0xd7, 0x4d, 0x97, 0x14, 0x90, 0xe4, 0xb4, 0x63, 0xd2, 0xb,  0xc3,
      0xfb, 0x18, 0x0,  0x1a, 0xa2, 0xff, 0xfc, 0x11, 0x37, 0x8a, 0x33, 0x2e, 0x9f, 0x57, 0xef, 0xed, 0x7b, 0x5a, 0x2f,
      0x54, 0xe,  0x84, 0xf6, 0xfb, 0xaa, 0xf3, 0xba, 0xa2, 0xb1, 0x37, 0xa,  0x0,  0x1c, 0xe1, 0x29, 0x75, 0x1a, 0xb5,
      0x23, 0x17, 0x84, 0x20, 0xd4, 0xee, 0x47, 0x39, 0x7b, 0x7c, 0x2d, 0x7b, 0x68, 0x3a, 0x40, 0x72, 0x30, 0xba, 0x72,
      0x14, 0xd6, 0xe1, 0x34, 0x2d, 0x0,  0x2,  0x6c, 0x24, 0x1,  0x0,  0xb,  0x3e, 0xd9, 0xb9, 0xa6, 0x15, 0xd8, 0xf8,
      0x28, 0xac, 0xc2, 0xbd, 0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x77, 0xf8, 0x42, 0x6a, 0x17, 0x12, 0xe2, 0x55};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbe, 0xd9, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x34, 0x2f, 0xe1, 0xaf, 0x34, 0xb9, 0x35, 0x6a, 0xe4, 0xc3, 0xd9, 0xb8,
                                     0x8e, 0x91, 0x28, 0x37, 0x25, 0xa5, 0x66, 0x62, 0x5d, 0x9c, 0x2};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x83, 0x9c, 0xe1, 0x94, 0xb0, 0x4f, 0x35, 0x3,  0xd5, 0xda, 0xd6, 0xae, 0xd6,
                                     0x53, 0xf2, 0xc6, 0x59, 0x98, 0x32, 0x56, 0x25, 0xbc, 0xde, 0x1d, 0x38};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x1f, 0xb0, 0x29, 0x16, 0x33, 0xe,  0xa,  0xa,  0x34, 0x72, 0xbc, 0xa5, 0x76,
                                     0x6a, 0xd8, 0xbb, 0x5d, 0x25, 0xf3, 0x32, 0x34, 0x34, 0x16, 0xba, 0xa6, 0xd};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xaa, 0x3a, 0xc5, 0xcf, 0xfe, 0x10, 0xda, 0x63, 0xd,  0x86, 0xb8,
                                     0xeb, 0x0,  0x71, 0x3f, 0xae, 0x92, 0x42, 0xe3, 0xf0, 0xd3};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x97, 0xed, 0x48, 0xd7, 0x4d, 0x97, 0x14, 0x90,
                                     0xe4, 0xb4, 0x63, 0xd2, 0xb,  0xc3, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa2, 0xff, 0xfc, 0x11, 0x37, 0x8a, 0x33, 0x2e, 0x9f, 0x57, 0xef, 0xed, 0x7b,
                                     0x5a, 0x2f, 0x54, 0xe,  0x84, 0xf6, 0xfb, 0xaa, 0xf3, 0xba, 0xa2, 0xb1, 0x37};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe1, 0x29, 0x75, 0x1a, 0xb5, 0x23, 0x17, 0x84, 0x20, 0xd4,
                                     0xee, 0x47, 0x39, 0x7b, 0x7c, 0x2d, 0x7b, 0x68, 0x3a, 0x40,
                                     0x72, 0x30, 0xba, 0x72, 0x14, 0xd6, 0xe1, 0x34};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6c, 0x24};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x3e, 0xd9, 0xb9, 0xa6, 0x15, 0xd8, 0xf8, 0x28, 0xac, 0xc2, 0xbd};
  lwmqtt_string_t topic_filter_s10 = {11, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0xaa, 0x9f, 0x7a, 0xee, 0xba, 0x5e, 0xdf, 0xd2};
  uint8_t bytesprops1[] = {0xb0, 0x70, 0xc0, 0x9c, 0x1f, 0xa,  0xd9, 0x8b, 0x5a,
                           0xca, 0x58, 0xea, 0x8c, 0x79, 0x2c, 0xc3, 0x93};
  uint8_t bytesprops2[] = {0xfa, 0x88, 0x41, 0x8a, 0x8f, 0x62, 0xb5, 0x5d, 0x65, 0x2f, 0x56, 0x86,
                           0x6c, 0x3d, 0xb9, 0xf8, 0xa,  0x70, 0x81, 0xac, 0x28, 0x1e, 0xba, 0xf};
  uint8_t bytesprops3[] = {0x2f, 0xb8, 0xb5, 0x3e, 0x3e, 0xe7, 0xe,  0xdb, 0x27, 0x93, 0x82, 0xb1, 0xee, 0x72, 0xe9,
                           0x20, 0x47, 0x78, 0xc6, 0x46, 0x64, 0xd7, 0xd1, 0x16, 0x2e, 0x12, 0xe,  0xb1, 0x81, 0x2b};
  uint8_t bytesprops4[] = {0xaa};
  uint8_t bytesprops5[] = {0x93, 0x4d, 0x71, 0x5,  0x42, 0x21, 0xf7, 0x8f, 0xed, 0x62, 0x6,  0x23, 0xa3, 0xb0, 0xb3,
                           0x1b, 0x60, 0xc6, 0x85, 0xcd, 0x7a, 0x4b, 0x1,  0x5d, 0xcc, 0xac, 0x5a, 0xcb, 0xa5};
  uint8_t bytesprops6[] = {0xe9, 0x7b, 0x87, 0xc,  0xf7, 0x79, 0x26, 0xcc, 0xed, 0xfe, 0x37, 0x6, 0x18,
                           0x44, 0x87, 0xd,  0x30, 0xb7, 0x4c, 0x7f, 0x47, 0x63, 0xc2, 0x59, 0x57};
  uint8_t bytesprops7[] = {0x46, 0xa6, 0xec, 0x9f, 0x66, 0x1f, 0xe6, 0x74, 0x30, 0x25, 0xf2, 0xe7, 0xa5, 0xde,
                           0x50, 0xe,  0xa3, 0x30, 0xc,  0x47, 0x47, 0x77, 0x8f, 0x5f, 0x47, 0x37, 0x9e, 0xbb};
  uint8_t bytesprops8[] = {0xc7, 0xa2, 0xdc, 0xa4, 0x76, 0xd1, 0xd1, 0x13, 0xd8, 0xe2, 0x34, 0xd7, 0x18, 0x1d, 0xd7,
                           0x2d, 0x96, 0xaa, 0xa9, 0xb0, 0xc1, 0x5f, 0x83, 0x94, 0xf2, 0xcd, 0x68, 0x8,  0xc6};
  uint8_t bytesprops9[] = {0x15, 0xd2, 0x80, 0x7a, 0xc8, 0xd0, 0x3e, 0xbe, 0xd9, 0x84, 0xe3, 0x43, 0xb6, 0xef,
                           0x76, 0xac, 0xad, 0x2e, 0x33, 0x1a, 0x79, 0x8f, 0xab, 0xe5, 0xb5, 0x90, 0x41};
  uint8_t bytesprops10[] = {0x3e, 0xf2, 0x4e, 0x39, 0xb6};
  uint8_t bytesprops12[] = {0xac, 0x17, 0xa5, 0x42, 0xbd, 0xc4, 0xde, 0xad, 0xf0, 0xc8, 0x9f, 0x4b, 0x0};
  uint8_t bytesprops11[] = {0x9e, 0x8d, 0xfc, 0x96};
  uint8_t bytesprops13[] = {0xba, 0xd5, 0x84, 0xe0, 0x17, 0xed, 0x8d, 0x7,  0x61, 0x17, 0x60, 0x87, 0xc2,
                            0xdb, 0xf3, 0xb8, 0x3f, 0xb,  0xeb, 0x62, 0x1b, 0x89, 0xb4, 0x42, 0xc7};
  uint8_t bytesprops14[] = {0xf7, 0x2d, 0x9f, 0x8e, 0x47, 0x34, 0xfa, 0xdf, 0x31, 0xb2, 0xad, 0xdf, 0x90, 0x29};
  uint8_t bytesprops15[] = {0xd1, 0xe,  0x6c, 0xfb, 0xde, 0xc0, 0x14, 0xe,  0x55, 0x12, 0x1f, 0xc7, 0x69, 0xd3,
                            0xc1, 0xf8, 0x8a, 0x1d, 0xe7, 0xca, 0xdf, 0x80, 0xd6, 0xb8, 0x5e, 0x87, 0xf0, 0x53};
  uint8_t bytesprops16[] = {0x9f, 0x23, 0x8e, 0xe9, 0x22, 0x9a, 0x14, 0xd6, 0x69, 0x6b, 0x6d, 0x96, 0x1e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8290}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4943}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9948}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31659}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4540}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24650}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops11}, .v = {13, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7285}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7994, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23842 [("\140\185\224\250R\251\"\210\238\130\148\253\176\167\230\DELx%",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("k\157(%\238\144\NAK\133\246\206\163w\161\180x5X\SI\SYN(\130\224u\222\247\155\175\200",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\188k9#!@s.\150+\ETBF\197\DC3i\159Z\197,\214\167\253\245\aE",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("+\194\188\205\157\178\221\t\245\213\254W\129\251A\aV\219\210\b\229<\149\204&\201\196\182U",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\222\146\234\140\195c\209LL$\222\179\153\DEL\208\218\132\209\214%\139\228\230",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\CAN\151aE\174\174\225\221%N\238d\SI\187",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropWillDelayInterval 6427,PropServerReference
// "r\241:\181\231\231xy\251w\214\145[",PropMessageExpiryInterval 8166,PropSessionExpiryInterval
// 1244,PropRequestProblemInformation 241,PropSharedSubscriptionAvailable 206,PropRequestProblemInformation
// 179,PropTopicAliasMaximum 3266,PropContentType "\220;\ACK\SOH\229\228&S9{b\143\171J\133$cX",PropReceiveMaximum
// 27044,PropPayloadFormatIndicator 233,PropCorrelationData
// "\158\t\SO\149G,o\EM\133\196\182\224\&7\230\171}*\DEL\\\238\195",PropUserProperty "D\246\216\237^\159\ENQ\150t Nb"
// "",PropUserProperty "\201\132@h\202\139\192\221\DC2\241m\175s;\182\FS\128\227\159\225\208\247\ETB\196\237\255\182g"
// "\214\250\131%\195\195IG\138X\250\217",PropWillDelayInterval 20526,PropSubscriptionIdentifier
// 8,PropSessionExpiryInterval 21501,PropSubscriptionIdentifier 31,PropMaximumPacketSize 30816,PropMessageExpiryInterval
// 12097,PropMaximumQoS 191,PropWillDelayInterval 14550,PropMessageExpiryInterval 10328,PropMessageExpiryInterval
// 19723,PropMaximumQoS 67,PropWillDelayInterval 31618,PropResponseTopic
// "\218\254\b\221\224\253\168\183\161\181\b\128<R+_U\235"]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0xfc, 0x2,  0x5d, 0x22, 0xdd, 0x1,  0x18, 0x0,  0x0,  0x19, 0x1b, 0x1c, 0x0,  0xd,  0x72, 0xf1, 0x3a, 0xb5,
      0xe7, 0xe7, 0x78, 0x79, 0xfb, 0x77, 0xd6, 0x91, 0x5b, 0x2,  0x0,  0x0,  0x1f, 0xe6, 0x11, 0x0,  0x0,  0x4,  0xdc,
      0x17, 0xf1, 0x2a, 0xce, 0x17, 0xb3, 0x22, 0xc,  0xc2, 0x3,  0x0,  0x12, 0xdc, 0x3b, 0x6,  0x1,  0xe5, 0xe4, 0x26,
      0x53, 0x39, 0x7b, 0x62, 0x8f, 0xab, 0x4a, 0x85, 0x24, 0x63, 0x58, 0x21, 0x69, 0xa4, 0x1,  0xe9, 0x9,  0x0,  0x15,
      0x9e, 0x9,  0xe,  0x95, 0x47, 0x2c, 0x6f, 0x19, 0x85, 0xc4, 0xb6, 0xe0, 0x37, 0xe6, 0xab, 0x7d, 0x2a, 0x7f, 0x5c,
      0xee, 0xc3, 0x26, 0x0,  0xc,  0x44, 0xf6, 0xd8, 0xed, 0x5e, 0x9f, 0x5,  0x96, 0x74, 0x20, 0x4e, 0x62, 0x0,  0x0,
      0x26, 0x0,  0x1c, 0xc9, 0x84, 0x40, 0x68, 0xca, 0x8b, 0xc0, 0xdd, 0x12, 0xf1, 0x6d, 0xaf, 0x73, 0x3b, 0xb6, 0x1c,
      0x80, 0xe3, 0x9f, 0xe1, 0xd0, 0xf7, 0x17, 0xc4, 0xed, 0xff, 0xb6, 0x67, 0x0,  0xc,  0xd6, 0xfa, 0x83, 0x25, 0xc3,
      0xc3, 0x49, 0x47, 0x8a, 0x58, 0xfa, 0xd9, 0x18, 0x0,  0x0,  0x50, 0x2e, 0xb,  0x8,  0x11, 0x0,  0x0,  0x53, 0xfd,
      0xb,  0x1f, 0x27, 0x0,  0x0,  0x78, 0x60, 0x2,  0x0,  0x0,  0x2f, 0x41, 0x24, 0xbf, 0x18, 0x0,  0x0,  0x38, 0xd6,
      0x2,  0x0,  0x0,  0x28, 0x58, 0x2,  0x0,  0x0,  0x4d, 0xb,  0x24, 0x43, 0x18, 0x0,  0x0,  0x7b, 0x82, 0x8,  0x0,
      0x12, 0xda, 0xfe, 0x8,  0xdd, 0xe0, 0xfd, 0xa8, 0xb7, 0xa1, 0xb5, 0x8,  0x80, 0x3c, 0x52, 0x2b, 0x5f, 0x55, 0xeb,
      0x0,  0x12, 0x8c, 0xb9, 0xe0, 0xfa, 0x52, 0xfb, 0x22, 0xd2, 0xee, 0x82, 0x94, 0xfd, 0xb0, 0xa7, 0xe6, 0x7f, 0x78,
      0x25, 0x25, 0x0,  0x1c, 0x6b, 0x9d, 0x28, 0x25, 0xee, 0x90, 0x15, 0x85, 0xf6, 0xce, 0xa3, 0x77, 0xa1, 0xb4, 0x78,
      0x35, 0x58, 0xf,  0x16, 0x28, 0x82, 0xe0, 0x75, 0xde, 0xf7, 0x9b, 0xaf, 0xc8, 0x10, 0x0,  0x19, 0xbc, 0x6b, 0x39,
      0x23, 0x21, 0x40, 0x73, 0x2e, 0x96, 0x2b, 0x17, 0x46, 0xc5, 0x13, 0x69, 0x9f, 0x5a, 0xc5, 0x2c, 0xd6, 0xa7, 0xfd,
      0xf5, 0x7,  0x45, 0x14, 0x0,  0x1d, 0x2b, 0xc2, 0xbc, 0xcd, 0x9d, 0xb2, 0xdd, 0x9,  0xf5, 0xd5, 0xfe, 0x57, 0x81,
      0xfb, 0x41, 0x7,  0x56, 0xdb, 0xd2, 0x8,  0xe5, 0x3c, 0x95, 0xcc, 0x26, 0xc9, 0xc4, 0xb6, 0x55, 0x12, 0x0,  0x17,
      0xde, 0x92, 0xea, 0x8c, 0xc3, 0x63, 0xd1, 0x4c, 0x4c, 0x24, 0xde, 0xb3, 0x99, 0x7f, 0xd0, 0xda, 0x84, 0xd1, 0xd6,
      0x25, 0x8b, 0xe4, 0xe6, 0x21, 0x0,  0xe,  0x18, 0x97, 0x61, 0x45, 0xae, 0xae, 0xe1, 0xdd, 0x25, 0x4e, 0xee, 0x64,
      0xf,  0xbb, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0xb9, 0xe0, 0xfa, 0x52, 0xfb, 0x22, 0xd2, 0xee,
                                     0x82, 0x94, 0xfd, 0xb0, 0xa7, 0xe6, 0x7f, 0x78, 0x25};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x9d, 0x28, 0x25, 0xee, 0x90, 0x15, 0x85, 0xf6, 0xce,
                                     0xa3, 0x77, 0xa1, 0xb4, 0x78, 0x35, 0x58, 0xf,  0x16, 0x28,
                                     0x82, 0xe0, 0x75, 0xde, 0xf7, 0x9b, 0xaf, 0xc8};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xbc, 0x6b, 0x39, 0x23, 0x21, 0x40, 0x73, 0x2e, 0x96, 0x2b, 0x17, 0x46, 0xc5,
                                     0x13, 0x69, 0x9f, 0x5a, 0xc5, 0x2c, 0xd6, 0xa7, 0xfd, 0xf5, 0x7,  0x45};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0xc2, 0xbc, 0xcd, 0x9d, 0xb2, 0xdd, 0x9,  0xf5, 0xd5,
                                     0xfe, 0x57, 0x81, 0xfb, 0x41, 0x7,  0x56, 0xdb, 0xd2, 0x8,
                                     0xe5, 0x3c, 0x95, 0xcc, 0x26, 0xc9, 0xc4, 0xb6, 0x55};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xde, 0x92, 0xea, 0x8c, 0xc3, 0x63, 0xd1, 0x4c, 0x4c, 0x24, 0xde, 0xb3,
                                     0x99, 0x7f, 0xd0, 0xda, 0x84, 0xd1, 0xd6, 0x25, 0x8b, 0xe4, 0xe6};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x18, 0x97, 0x61, 0x45, 0xae, 0xae, 0xe1, 0xdd, 0x25, 0x4e, 0xee, 0x64, 0xf, 0xbb};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x72, 0xf1, 0x3a, 0xb5, 0xe7, 0xe7, 0x78, 0x79, 0xfb, 0x77, 0xd6, 0x91, 0x5b};
  uint8_t bytesprops1[] = {0xdc, 0x3b, 0x6,  0x1,  0xe5, 0xe4, 0x26, 0x53, 0x39,
                           0x7b, 0x62, 0x8f, 0xab, 0x4a, 0x85, 0x24, 0x63, 0x58};
  uint8_t bytesprops2[] = {0x9e, 0x9,  0xe,  0x95, 0x47, 0x2c, 0x6f, 0x19, 0x85, 0xc4, 0xb6,
                           0xe0, 0x37, 0xe6, 0xab, 0x7d, 0x2a, 0x7f, 0x5c, 0xee, 0xc3};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops3[] = {0x44, 0xf6, 0xd8, 0xed, 0x5e, 0x9f, 0x5, 0x96, 0x74, 0x20, 0x4e, 0x62};
  uint8_t bytesprops6[] = {0xd6, 0xfa, 0x83, 0x25, 0xc3, 0xc3, 0x49, 0x47, 0x8a, 0x58, 0xfa, 0xd9};
  uint8_t bytesprops5[] = {0xc9, 0x84, 0x40, 0x68, 0xca, 0x8b, 0xc0, 0xdd, 0x12, 0xf1, 0x6d, 0xaf, 0x73, 0x3b,
                           0xb6, 0x1c, 0x80, 0xe3, 0x9f, 0xe1, 0xd0, 0xf7, 0x17, 0xc4, 0xed, 0xff, 0xb6, 0x67};
  uint8_t bytesprops7[] = {0xda, 0xfe, 0x8,  0xdd, 0xe0, 0xfd, 0xa8, 0xb7, 0xa1,
                           0xb5, 0x8,  0x80, 0x3c, 0x52, 0x2b, 0x5f, 0x55, 0xeb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6427}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8166}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1244}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3266}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27044}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops3}, .v = {0, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops5}, .v = {12, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20526}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21501}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30816}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12097}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14550}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10328}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19723}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31618}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23842, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26921 [("K3\SI\145\&6N\152\205\207\211\175\226(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\232\&0\ESC1 |\197\148\&8\225\CAN*\229",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropReceiveMaximum 15170,PropMaximumQoS 125,PropServerKeepAlive 6331,PropAssignedClientIdentifier
// ">\211\130\153t\NAKk7\214D\ACKq\GS\150\243\233nW\160=\249(",PropReceiveMaximum 19285,PropSessionExpiryInterval
// 22725,PropSessionExpiryInterval 28884,PropSubscriptionIdentifierAvailable 49,PropSubscriptionIdentifierAvailable
// 194,PropRequestProblemInformation 1,PropTopicAliasMaximum 7896,PropSessionExpiryInterval 7833]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x5f, 0x69, 0x29, 0x3c, 0x21, 0x3b, 0x42, 0x24, 0x7d, 0x13, 0x18, 0xbb, 0x12, 0x0,  0x16, 0x3e,
                   0xd3, 0x82, 0x99, 0x74, 0x15, 0x6b, 0x37, 0xd6, 0x44, 0x6,  0x71, 0x1d, 0x96, 0xf3, 0xe9, 0x6e, 0x57,
                   0xa0, 0x3d, 0xf9, 0x28, 0x21, 0x4b, 0x55, 0x11, 0x0,  0x0,  0x58, 0xc5, 0x11, 0x0,  0x0,  0x70, 0xd4,
                   0x29, 0x31, 0x29, 0xc2, 0x17, 0x1,  0x22, 0x1e, 0xd8, 0x11, 0x0,  0x0,  0x1e, 0x99, 0x0,  0xd,  0x4b,
                   0x33, 0xf,  0x91, 0x36, 0x4e, 0x98, 0xcd, 0xcf, 0xd3, 0xaf, 0xe2, 0x28, 0xc,  0x0,  0xd,  0xe8, 0x30,
                   0x1b, 0x31, 0x20, 0x7c, 0xc5, 0x94, 0x38, 0xe1, 0x18, 0x2a, 0xe5, 0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x4b, 0x33, 0xf, 0x91, 0x36, 0x4e, 0x98, 0xcd, 0xcf, 0xd3, 0xaf, 0xe2, 0x28};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x30, 0x1b, 0x31, 0x20, 0x7c, 0xc5, 0x94, 0x38, 0xe1, 0x18, 0x2a, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x3e, 0xd3, 0x82, 0x99, 0x74, 0x15, 0x6b, 0x37, 0xd6, 0x44, 0x6,
                           0x71, 0x1d, 0x96, 0xf3, 0xe9, 0x6e, 0x57, 0xa0, 0x3d, 0xf9, 0x28};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15170}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6331}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19285}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22725}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28884}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7896}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7833}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26921, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21060 [("|\157\247\167%X\146\239\FSa@\163\225",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),(".\147\177\f\201\211\245\229\237\RS",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\EOT\149z\193\&2\140\137\131\155#}#h\153\&4",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("oo\189n\216\174\b[\219d\225\166\b\146^/\138\130\132[\235",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\176\&5\141\&1\143<\138xIV~\187\\\234\250Sa\US\240\219w8vTXw",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\164\153\198\218k\176b\231\SO",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("Y\156\203\236\EOT\225\149\165[\246\158\US(\248",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\140\170^\229\250K\220\216\241\233\146\"",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x93, 0x1,  0x52, 0x44, 0x0,  0x0,  0xd,  0x7c, 0x9d, 0xf7, 0xa7, 0x25, 0x58, 0x92, 0xef, 0x1c,
                   0x61, 0x40, 0xa3, 0xe1, 0x25, 0x0,  0xa,  0x2e, 0x93, 0xb1, 0xc,  0xc9, 0xd3, 0xf5, 0xe5, 0xed, 0x1e,
                   0x11, 0x0,  0xf,  0x4,  0x95, 0x7a, 0xc1, 0x32, 0x8c, 0x89, 0x83, 0x9b, 0x23, 0x7d, 0x23, 0x68, 0x99,
                   0x34, 0x21, 0x0,  0x15, 0x6f, 0x6f, 0xbd, 0x6e, 0xd8, 0xae, 0x8,  0x5b, 0xdb, 0x64, 0xe1, 0xa6, 0x8,
                   0x92, 0x5e, 0x2f, 0x8a, 0x82, 0x84, 0x5b, 0xeb, 0x12, 0x0,  0x1a, 0xb0, 0x35, 0x8d, 0x31, 0x8f, 0x3c,
                   0x8a, 0x78, 0x49, 0x56, 0x7e, 0xbb, 0x5c, 0xea, 0xfa, 0x53, 0x61, 0x1f, 0xf0, 0xdb, 0x77, 0x38, 0x76,
                   0x54, 0x58, 0x77, 0xd,  0x0,  0x9,  0xa4, 0x99, 0xc6, 0xda, 0x6b, 0xb0, 0x62, 0xe7, 0xe,  0x2a, 0x0,
                   0xe,  0x59, 0x9c, 0xcb, 0xec, 0x4,  0xe1, 0x95, 0xa5, 0x5b, 0xf6, 0x9e, 0x1f, 0x28, 0xf8, 0x22, 0x0,
                   0xc,  0x8c, 0xaa, 0x5e, 0xe5, 0xfa, 0x4b, 0xdc, 0xd8, 0xf1, 0xe9, 0x92, 0x22, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x7c, 0x9d, 0xf7, 0xa7, 0x25, 0x58, 0x92, 0xef, 0x1c, 0x61, 0x40, 0xa3, 0xe1};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2e, 0x93, 0xb1, 0xc, 0xc9, 0xd3, 0xf5, 0xe5, 0xed, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4,  0x95, 0x7a, 0xc1, 0x32, 0x8c, 0x89, 0x83,
                                     0x9b, 0x23, 0x7d, 0x23, 0x68, 0x99, 0x34};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6f, 0x6f, 0xbd, 0x6e, 0xd8, 0xae, 0x8,  0x5b, 0xdb, 0x64, 0xe1,
                                     0xa6, 0x8,  0x92, 0x5e, 0x2f, 0x8a, 0x82, 0x84, 0x5b, 0xeb};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb0, 0x35, 0x8d, 0x31, 0x8f, 0x3c, 0x8a, 0x78, 0x49, 0x56, 0x7e, 0xbb, 0x5c,
                                     0xea, 0xfa, 0x53, 0x61, 0x1f, 0xf0, 0xdb, 0x77, 0x38, 0x76, 0x54, 0x58, 0x77};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa4, 0x99, 0xc6, 0xda, 0x6b, 0xb0, 0x62, 0xe7, 0xe};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0x9c, 0xcb, 0xec, 0x4, 0xe1, 0x95, 0xa5, 0x5b, 0xf6, 0x9e, 0x1f, 0x28, 0xf8};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x8c, 0xaa, 0x5e, 0xe5, 0xfa, 0x4b, 0xdc, 0xd8, 0xf1, 0xe9, 0x92, 0x22};
  lwmqtt_string_t topic_filter_s7 = {12, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21060, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18677 [("=\161\253\230\ACK|8",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS =
// QoS0}),("$wX\204\158I\216\&9c\142@\195\248\186>\SUBi\SYN\165H\212\242\&3;",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\153\231\243Nc7\160^\177\204:\236\247\fCy\174\181\172\131A",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropTopicAlias
// 19406,PropTopicAlias 1380,PropCorrelationData "\200\148\&2[\251\r\ETB\234",PropSubscriptionIdentifierAvailable
// 14,PropResponseTopic "\193/\209\206\US\155-",PropServerKeepAlive 3091,PropCorrelationData
// "N\230\178\252OC\DEL\174\253p\250;\223M\222F\SO",PropMaximumQoS 220,PropSubscriptionIdentifier
// 32,PropSubscriptionIdentifierAvailable 34,PropMessageExpiryInterval 12666,PropCorrelationData
// "\CAN",PropRequestResponseInformation 197,PropSessionExpiryInterval 5342,PropWillDelayInterval
// 9931,PropMessageExpiryInterval 4431,PropTopicAliasMaximum 24873,PropRequestProblemInformation 210,PropServerKeepAlive
// 20259,PropTopicAlias 32129,PropRequestProblemInformation 253,PropReasonString "\134",PropMessageExpiryInterval
// 22401,PropSharedSubscriptionAvailable 51,PropTopicAlias 8670,PropSharedSubscriptionAvailable 252,PropServerReference
// ".ae\252\215",PropAuthenticationMethod
// "\235C\205\250\RS\181:O\CAN\156\248\204,b\NUL\148\196g\183\151\161",PropReceiveMaximum 25059]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0xd5, 0x1,  0x48, 0xf5, 0x94, 0x1,  0x23, 0x4b, 0xce, 0x23, 0x5,  0x64, 0x9,  0x0,  0x8,  0xc8,
                   0x94, 0x32, 0x5b, 0xfb, 0xd,  0x17, 0xea, 0x29, 0xe,  0x8,  0x0,  0x7,  0xc1, 0x2f, 0xd1, 0xce, 0x1f,
                   0x9b, 0x2d, 0x13, 0xc,  0x13, 0x9,  0x0,  0x11, 0x4e, 0xe6, 0xb2, 0xfc, 0x4f, 0x43, 0x7f, 0xae, 0xfd,
                   0x70, 0xfa, 0x3b, 0xdf, 0x4d, 0xde, 0x46, 0xe,  0x24, 0xdc, 0xb,  0x20, 0x29, 0x22, 0x2,  0x0,  0x0,
                   0x31, 0x7a, 0x9,  0x0,  0x1,  0x18, 0x19, 0xc5, 0x11, 0x0,  0x0,  0x14, 0xde, 0x18, 0x0,  0x0,  0x26,
                   0xcb, 0x2,  0x0,  0x0,  0x11, 0x4f, 0x22, 0x61, 0x29, 0x17, 0xd2, 0x13, 0x4f, 0x23, 0x23, 0x7d, 0x81,
                   0x17, 0xfd, 0x1f, 0x0,  0x1,  0x86, 0x2,  0x0,  0x0,  0x57, 0x81, 0x2a, 0x33, 0x23, 0x21, 0xde, 0x2a,
                   0xfc, 0x1c, 0x0,  0x5,  0x2e, 0x61, 0x65, 0xfc, 0xd7, 0x15, 0x0,  0x15, 0xeb, 0x43, 0xcd, 0xfa, 0x1e,
                   0xb5, 0x3a, 0x4f, 0x18, 0x9c, 0xf8, 0xcc, 0x2c, 0x62, 0x0,  0x94, 0xc4, 0x67, 0xb7, 0x97, 0xa1, 0x21,
                   0x61, 0xe3, 0x0,  0x7,  0x3d, 0xa1, 0xfd, 0xe6, 0x6,  0x7c, 0x38, 0x2c, 0x0,  0x18, 0x24, 0x77, 0x58,
                   0xcc, 0x9e, 0x49, 0xd8, 0x39, 0x63, 0x8e, 0x40, 0xc3, 0xf8, 0xba, 0x3e, 0x1a, 0x69, 0x16, 0xa5, 0x48,
                   0xd4, 0xf2, 0x33, 0x3b, 0x15, 0x0,  0x15, 0x99, 0xe7, 0xf3, 0x4e, 0x63, 0x37, 0xa0, 0x5e, 0xb1, 0xcc,
                   0x3a, 0xec, 0xf7, 0xc,  0x43, 0x79, 0xae, 0xb5, 0xac, 0x83, 0x41, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x3d, 0xa1, 0xfd, 0xe6, 0x6, 0x7c, 0x38};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x24, 0x77, 0x58, 0xcc, 0x9e, 0x49, 0xd8, 0x39, 0x63, 0x8e, 0x40, 0xc3,
                                     0xf8, 0xba, 0x3e, 0x1a, 0x69, 0x16, 0xa5, 0x48, 0xd4, 0xf2, 0x33, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x99, 0xe7, 0xf3, 0x4e, 0x63, 0x37, 0xa0, 0x5e, 0xb1, 0xcc, 0x3a,
                                     0xec, 0xf7, 0xc,  0x43, 0x79, 0xae, 0xb5, 0xac, 0x83, 0x41};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0xc8, 0x94, 0x32, 0x5b, 0xfb, 0xd, 0x17, 0xea};
  uint8_t bytesprops1[] = {0xc1, 0x2f, 0xd1, 0xce, 0x1f, 0x9b, 0x2d};
  uint8_t bytesprops2[] = {0x4e, 0xe6, 0xb2, 0xfc, 0x4f, 0x43, 0x7f, 0xae, 0xfd,
                           0x70, 0xfa, 0x3b, 0xdf, 0x4d, 0xde, 0x46, 0xe};
  uint8_t bytesprops3[] = {0x18};
  uint8_t bytesprops4[] = {0x86};
  uint8_t bytesprops5[] = {0x2e, 0x61, 0x65, 0xfc, 0xd7};
  uint8_t bytesprops6[] = {0xeb, 0x43, 0xcd, 0xfa, 0x1e, 0xb5, 0x3a, 0x4f, 0x18, 0x9c, 0xf8,
                           0xcc, 0x2c, 0x62, 0x0,  0x94, 0xc4, 0x67, 0xb7, 0x97, 0xa1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19406}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1380}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3091}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 32}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12666}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5342}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9931}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4431}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24873}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20259}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32129}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22401}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8670}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25059}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18677, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15426 [(">,\208\132\222\237\163V\189v\141\DC4<\218\135\r(U",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropSubscriptionIdentifierAvailable 250,PropResponseInformation "\237t",PropMessageExpiryInterval
// 6544,PropMaximumQoS 212,PropRequestProblemInformation 23,PropRequestResponseInformation 220,PropResponseInformation
// "\236\250\185\236O\167\245\211\195\249\ETBfEj\164\152\174H<\"",PropServerKeepAlive 25666,PropWillDelayInterval
// 7275,PropRetainAvailable 129,PropResponseTopic
// "\ETX+\a\NUL\SUB\247\145\223\201\152k]3M\"\152\233om\139<j\142/'\172\218",PropReceiveMaximum
// 29319,PropSessionExpiryInterval 24182,PropPayloadFormatIndicator 16,PropCorrelationData "\156\149\EOT\252
// \147\232\153\b\SUB\214\130S\136\159b]:\248,7\134\239\163\SUB\ETBT\a|\226",PropRequestProblemInformation
// 205,PropAssignedClientIdentifier "\169\RSf\198j\DELx/_ _\135,\235W'",PropCorrelationData
// "\215\SO\145\&4#>\SO\STX\174yQQj\163\227\167\SI",PropWildcardSubscriptionAvailable 63,PropAuthenticationMethod
// "\EM\163\200\208\DC1\149\182Q/\f)\161\206\252\221\142\&0C\219P%\158\245\202\154g",PropSharedSubscriptionAvailable
// 52,PropSessionExpiryInterval 15259]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xe4, 0x1,  0x3c, 0x42, 0xcb, 0x1,  0x29, 0xfa, 0x1a, 0x0,  0x2,  0xed, 0x74, 0x2,  0x0,  0x0,
                   0x19, 0x90, 0x24, 0xd4, 0x17, 0x17, 0x19, 0xdc, 0x1a, 0x0,  0x14, 0xec, 0xfa, 0xb9, 0xec, 0x4f, 0xa7,
                   0xf5, 0xd3, 0xc3, 0xf9, 0x17, 0x66, 0x45, 0x6a, 0xa4, 0x98, 0xae, 0x48, 0x3c, 0x22, 0x13, 0x64, 0x42,
                   0x18, 0x0,  0x0,  0x1c, 0x6b, 0x25, 0x81, 0x8,  0x0,  0x1b, 0x3,  0x2b, 0x7,  0x0,  0x1a, 0xf7, 0x91,
                   0xdf, 0xc9, 0x98, 0x6b, 0x5d, 0x33, 0x4d, 0x22, 0x98, 0xe9, 0x6f, 0x6d, 0x8b, 0x3c, 0x6a, 0x8e, 0x2f,
                   0x27, 0xac, 0xda, 0x21, 0x72, 0x87, 0x11, 0x0,  0x0,  0x5e, 0x76, 0x1,  0x10, 0x9,  0x0,  0x1e, 0x9c,
                   0x95, 0x4,  0xfc, 0x20, 0x93, 0xe8, 0x99, 0x8,  0x1a, 0xd6, 0x82, 0x53, 0x88, 0x9f, 0x62, 0x5d, 0x3a,
                   0xf8, 0x2c, 0x37, 0x86, 0xef, 0xa3, 0x1a, 0x17, 0x54, 0x7,  0x7c, 0xe2, 0x17, 0xcd, 0x12, 0x0,  0x10,
                   0xa9, 0x1e, 0x66, 0xc6, 0x6a, 0x7f, 0x78, 0x2f, 0x5f, 0x20, 0x5f, 0x87, 0x2c, 0xeb, 0x57, 0x27, 0x9,
                   0x0,  0x11, 0xd7, 0xe,  0x91, 0x34, 0x23, 0x3e, 0xe,  0x2,  0xae, 0x79, 0x51, 0x51, 0x6a, 0xa3, 0xe3,
                   0xa7, 0xf,  0x28, 0x3f, 0x15, 0x0,  0x1a, 0x19, 0xa3, 0xc8, 0xd0, 0x11, 0x95, 0xb6, 0x51, 0x2f, 0xc,
                   0x29, 0xa1, 0xce, 0xfc, 0xdd, 0x8e, 0x30, 0x43, 0xdb, 0x50, 0x25, 0x9e, 0xf5, 0xca, 0x9a, 0x67, 0x2a,
                   0x34, 0x11, 0x0,  0x0,  0x3b, 0x9b, 0x0,  0x12, 0x3e, 0x2c, 0xd0, 0x84, 0xde, 0xed, 0xa3, 0x56, 0xbd,
                   0x76, 0x8d, 0x14, 0x3c, 0xda, 0x87, 0xd,  0x28, 0x55, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x3e, 0x2c, 0xd0, 0x84, 0xde, 0xed, 0xa3, 0x56, 0xbd,
                                     0x76, 0x8d, 0x14, 0x3c, 0xda, 0x87, 0xd,  0x28, 0x55};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0xed, 0x74};
  uint8_t bytesprops1[] = {0xec, 0xfa, 0xb9, 0xec, 0x4f, 0xa7, 0xf5, 0xd3, 0xc3, 0xf9,
                           0x17, 0x66, 0x45, 0x6a, 0xa4, 0x98, 0xae, 0x48, 0x3c, 0x22};
  uint8_t bytesprops2[] = {0x3,  0x2b, 0x7,  0x0,  0x1a, 0xf7, 0x91, 0xdf, 0xc9, 0x98, 0x6b, 0x5d, 0x33, 0x4d,
                           0x22, 0x98, 0xe9, 0x6f, 0x6d, 0x8b, 0x3c, 0x6a, 0x8e, 0x2f, 0x27, 0xac, 0xda};
  uint8_t bytesprops3[] = {0x9c, 0x95, 0x4,  0xfc, 0x20, 0x93, 0xe8, 0x99, 0x8,  0x1a, 0xd6, 0x82, 0x53, 0x88, 0x9f,
                           0x62, 0x5d, 0x3a, 0xf8, 0x2c, 0x37, 0x86, 0xef, 0xa3, 0x1a, 0x17, 0x54, 0x7,  0x7c, 0xe2};
  uint8_t bytesprops4[] = {0xa9, 0x1e, 0x66, 0xc6, 0x6a, 0x7f, 0x78, 0x2f,
                           0x5f, 0x20, 0x5f, 0x87, 0x2c, 0xeb, 0x57, 0x27};
  uint8_t bytesprops5[] = {0xd7, 0xe,  0x91, 0x34, 0x23, 0x3e, 0xe,  0x2, 0xae,
                           0x79, 0x51, 0x51, 0x6a, 0xa3, 0xe3, 0xa7, 0xf};
  uint8_t bytesprops6[] = {0x19, 0xa3, 0xc8, 0xd0, 0x11, 0x95, 0xb6, 0x51, 0x2f, 0xc,  0x29, 0xa1, 0xce,
                           0xfc, 0xdd, 0x8e, 0x30, 0x43, 0xdb, 0x50, 0x25, 0x9e, 0xf5, 0xca, 0x9a, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6544}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25666}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7275}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29319}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24182}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15259}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15426, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11166 [("\253",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS1}),("\160\191\253\EOT\221\233mn\DLE0\180\USn",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("F\137\196\196\246j\196\202xY\172\CANg",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\209\FS\DC3#w\220<\201Ou\SI\131]\154\159",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("`\161lN\DLE\160\DC1s:",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("6",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropMaximumPacketSize 4921,PropRequestProblemInformation 188,PropResponseInformation
// "L\161Fb\169\174\&5f\231,\161\\\ry\209g\"\143\195\165",PropAuthenticationMethod
// "\142\RS\EM\SYN\197\NUL\156\209\ESC\132\154!\129H\205)M\161\202|Y\169\231",PropResponseTopic
// "\169\GS",PropUserProperty "\184\DC2\243\227\251\129\a\165\150\201?\231\195\240\189g\219\203>\196" "",PropContentType
// "\EOT`",PropMessageExpiryInterval 13915,PropAuthenticationData
// "8\150\213m\SOH\144\203~to\151t\158\240(\236\&5\DLE\138\193A%H\240\169\217\242",PropMessageExpiryInterval
// 25559,PropRequestResponseInformation 9,PropReasonString
// "T\"\167\249\163R:\ETX\239\US\213az\243\&9\203\160\178\154^p\202d\180",PropMessageExpiryInterval
// 13397,PropRequestResponseInformation 230,PropSessionExpiryInterval 7107,PropWillDelayInterval
// 23581,PropPayloadFormatIndicator 126,PropUserProperty "" "\217^\154\&7\166>\ESC\181",PropRequestProblemInformation
// 8,PropMessageExpiryInterval 16882,PropContentType
// "y\193n\168C\148\202z\245\162\CANU\210`\242\a\SYNT\188\174\223\144\EM",PropSubscriptionIdentifierAvailable
// 150,PropResponseInformation "\159;\198\253\160\217g\246@@\223\162\151N \151",PropReasonString
// "\234\150D\213\160\186b\nE\"\218\228\204\253\159\219\SYN\223\DC2*[",PropRetainAvailable 99,PropServerKeepAlive
// 14604,PropSubscriptionIdentifier 12,PropContentType "y\234\236\&7;\191`5(pw",PropSubscriptionIdentifierAvailable 74]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x82, 0xef, 0x2,  0x2b, 0x9e, 0xa5, 0x2,  0x27, 0x0,  0x0,  0x13, 0x39, 0x17, 0xbc, 0x1a, 0x0,  0x14, 0x4c, 0xa1,
      0x46, 0x62, 0xa9, 0xae, 0x35, 0x66, 0xe7, 0x2c, 0xa1, 0x5c, 0xd,  0x79, 0xd1, 0x67, 0x22, 0x8f, 0xc3, 0xa5, 0x15,
      0x0,  0x17, 0x8e, 0x1e, 0x19, 0x16, 0xc5, 0x0,  0x9c, 0xd1, 0x1b, 0x84, 0x9a, 0x21, 0x81, 0x48, 0xcd, 0x29, 0x4d,
      0xa1, 0xca, 0x7c, 0x59, 0xa9, 0xe7, 0x8,  0x0,  0x2,  0xa9, 0x1d, 0x26, 0x0,  0x14, 0xb8, 0x12, 0xf3, 0xe3, 0xfb,
      0x81, 0x7,  0xa5, 0x96, 0xc9, 0x3f, 0xe7, 0xc3, 0xf0, 0xbd, 0x67, 0xdb, 0xcb, 0x3e, 0xc4, 0x0,  0x0,  0x3,  0x0,
      0x2,  0x4,  0x60, 0x2,  0x0,  0x0,  0x36, 0x5b, 0x16, 0x0,  0x1b, 0x38, 0x96, 0xd5, 0x6d, 0x1,  0x90, 0xcb, 0x7e,
      0x74, 0x6f, 0x97, 0x74, 0x9e, 0xf0, 0x28, 0xec, 0x35, 0x10, 0x8a, 0xc1, 0x41, 0x25, 0x48, 0xf0, 0xa9, 0xd9, 0xf2,
      0x2,  0x0,  0x0,  0x63, 0xd7, 0x19, 0x9,  0x1f, 0x0,  0x18, 0x54, 0x22, 0xa7, 0xf9, 0xa3, 0x52, 0x3a, 0x3,  0xef,
      0x1f, 0xd5, 0x61, 0x7a, 0xf3, 0x39, 0xcb, 0xa0, 0xb2, 0x9a, 0x5e, 0x70, 0xca, 0x64, 0xb4, 0x2,  0x0,  0x0,  0x34,
      0x55, 0x19, 0xe6, 0x11, 0x0,  0x0,  0x1b, 0xc3, 0x18, 0x0,  0x0,  0x5c, 0x1d, 0x1,  0x7e, 0x26, 0x0,  0x0,  0x0,
      0x8,  0xd9, 0x5e, 0x9a, 0x37, 0xa6, 0x3e, 0x1b, 0xb5, 0x17, 0x8,  0x2,  0x0,  0x0,  0x41, 0xf2, 0x3,  0x0,  0x17,
      0x79, 0xc1, 0x6e, 0xa8, 0x43, 0x94, 0xca, 0x7a, 0xf5, 0xa2, 0x18, 0x55, 0xd2, 0x60, 0xf2, 0x7,  0x16, 0x54, 0xbc,
      0xae, 0xdf, 0x90, 0x19, 0x29, 0x96, 0x1a, 0x0,  0x10, 0x9f, 0x3b, 0xc6, 0xfd, 0xa0, 0xd9, 0x67, 0xf6, 0x40, 0x40,
      0xdf, 0xa2, 0x97, 0x4e, 0x20, 0x97, 0x1f, 0x0,  0x15, 0xea, 0x96, 0x44, 0xd5, 0xa0, 0xba, 0x62, 0xa,  0x45, 0x22,
      0xda, 0xe4, 0xcc, 0xfd, 0x9f, 0xdb, 0x16, 0xdf, 0x12, 0x2a, 0x5b, 0x25, 0x63, 0x13, 0x39, 0xc,  0xb,  0xc,  0x3,
      0x0,  0xb,  0x79, 0xea, 0xec, 0x37, 0x3b, 0xbf, 0x60, 0x35, 0x28, 0x70, 0x77, 0x29, 0x4a, 0x0,  0x1,  0xfd, 0x2d,
      0x0,  0xd,  0xa0, 0xbf, 0xfd, 0x4,  0xdd, 0xe9, 0x6d, 0x6e, 0x10, 0x30, 0xb4, 0x1f, 0x6e, 0x5,  0x0,  0xd,  0x46,
      0x89, 0xc4, 0xc4, 0xf6, 0x6a, 0xc4, 0xca, 0x78, 0x59, 0xac, 0x18, 0x67, 0x11, 0x0,  0xf,  0xd1, 0x1c, 0x13, 0x23,
      0x77, 0xdc, 0x3c, 0xc9, 0x4f, 0x75, 0xf,  0x83, 0x5d, 0x9a, 0x9f, 0xa,  0x0,  0x9,  0x60, 0xa1, 0x6c, 0x4e, 0x10,
      0xa0, 0x11, 0x73, 0x3a, 0x8,  0x0,  0x1,  0x36, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xfd};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xbf, 0xfd, 0x4, 0xdd, 0xe9, 0x6d, 0x6e, 0x10, 0x30, 0xb4, 0x1f, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0x89, 0xc4, 0xc4, 0xf6, 0x6a, 0xc4, 0xca, 0x78, 0x59, 0xac, 0x18, 0x67};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x1c, 0x13, 0x23, 0x77, 0xdc, 0x3c, 0xc9,
                                     0x4f, 0x75, 0xf,  0x83, 0x5d, 0x9a, 0x9f};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x60, 0xa1, 0x6c, 0x4e, 0x10, 0xa0, 0x11, 0x73, 0x3a};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x36};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x4c, 0xa1, 0x46, 0x62, 0xa9, 0xae, 0x35, 0x66, 0xe7, 0x2c,
                           0xa1, 0x5c, 0xd,  0x79, 0xd1, 0x67, 0x22, 0x8f, 0xc3, 0xa5};
  uint8_t bytesprops1[] = {0x8e, 0x1e, 0x19, 0x16, 0xc5, 0x0,  0x9c, 0xd1, 0x1b, 0x84, 0x9a, 0x21,
                           0x81, 0x48, 0xcd, 0x29, 0x4d, 0xa1, 0xca, 0x7c, 0x59, 0xa9, 0xe7};
  uint8_t bytesprops2[] = {0xa9, 0x1d};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops3[] = {0xb8, 0x12, 0xf3, 0xe3, 0xfb, 0x81, 0x7,  0xa5, 0x96, 0xc9,
                           0x3f, 0xe7, 0xc3, 0xf0, 0xbd, 0x67, 0xdb, 0xcb, 0x3e, 0xc4};
  uint8_t bytesprops5[] = {0x4, 0x60};
  uint8_t bytesprops6[] = {0x38, 0x96, 0xd5, 0x6d, 0x1,  0x90, 0xcb, 0x7e, 0x74, 0x6f, 0x97, 0x74, 0x9e, 0xf0,
                           0x28, 0xec, 0x35, 0x10, 0x8a, 0xc1, 0x41, 0x25, 0x48, 0xf0, 0xa9, 0xd9, 0xf2};
  uint8_t bytesprops7[] = {0x54, 0x22, 0xa7, 0xf9, 0xa3, 0x52, 0x3a, 0x3,  0xef, 0x1f, 0xd5, 0x61,
                           0x7a, 0xf3, 0x39, 0xcb, 0xa0, 0xb2, 0x9a, 0x5e, 0x70, 0xca, 0x64, 0xb4};
  uint8_t bytesprops9[] = {0xd9, 0x5e, 0x9a, 0x37, 0xa6, 0x3e, 0x1b, 0xb5};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops10[] = {0x79, 0xc1, 0x6e, 0xa8, 0x43, 0x94, 0xca, 0x7a, 0xf5, 0xa2, 0x18, 0x55,
                            0xd2, 0x60, 0xf2, 0x7,  0x16, 0x54, 0xbc, 0xae, 0xdf, 0x90, 0x19};
  uint8_t bytesprops11[] = {0x9f, 0x3b, 0xc6, 0xfd, 0xa0, 0xd9, 0x67, 0xf6,
                            0x40, 0x40, 0xdf, 0xa2, 0x97, 0x4e, 0x20, 0x97};
  uint8_t bytesprops12[] = {0xea, 0x96, 0x44, 0xd5, 0xa0, 0xba, 0x62, 0xa,  0x45, 0x22, 0xda,
                            0xe4, 0xcc, 0xfd, 0x9f, 0xdb, 0x16, 0xdf, 0x12, 0x2a, 0x5b};
  uint8_t bytesprops13[] = {0x79, 0xea, 0xec, 0x37, 0x3b, 0xbf, 0x60, 0x35, 0x28, 0x70, 0x77};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4921}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops3}, .v = {0, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13915}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25559}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13397}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7107}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23581}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops8}, .v = {8, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16882}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14604}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 74}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11166, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9472 [("\243\DC2\199A\218\167\CAN\SYN\220w\165\160\NAK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247\192Pw\199\196)T\SI\142wV\188!\138\241[\171",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("]\205\240x6\SI\137\238\166K\152\156\181ri\NUL\224\130^\f\190\132\156\170\149\199U\142n",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropSharedSubscriptionAvailable 99,PropReceiveMaximum 18943,PropRetainAvailable 72,PropRetainAvailable
// 59,PropSharedSubscriptionAvailable 37,PropPayloadFormatIndicator 14]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x55, 0x25, 0x0,  0xd,  0x2a, 0x63, 0x21, 0x49, 0xff, 0x25, 0x48, 0x25, 0x3b, 0x2a,
                   0x25, 0x1,  0xe,  0x0,  0xd,  0xf3, 0x12, 0xc7, 0x41, 0xda, 0xa7, 0x18, 0x16, 0xdc, 0x77,
                   0xa5, 0xa0, 0x15, 0x2,  0x0,  0x12, 0xf7, 0xc0, 0x50, 0x77, 0xc7, 0xc4, 0x29, 0x54, 0xf,
                   0x8e, 0x77, 0x56, 0xbc, 0x21, 0x8a, 0xf1, 0x5b, 0xab, 0xe,  0x0,  0x1d, 0x5d, 0xcd, 0xf0,
                   0x78, 0x36, 0xf,  0x89, 0xee, 0xa6, 0x4b, 0x98, 0x9c, 0xb5, 0x72, 0x69, 0x0,  0xe0, 0x82,
                   0x5e, 0xc,  0xbe, 0x84, 0x9c, 0xaa, 0x95, 0xc7, 0x55, 0x8e, 0x6e, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf3, 0x12, 0xc7, 0x41, 0xda, 0xa7, 0x18, 0x16, 0xdc, 0x77, 0xa5, 0xa0, 0x15};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf7, 0xc0, 0x50, 0x77, 0xc7, 0xc4, 0x29, 0x54, 0xf,
                                     0x8e, 0x77, 0x56, 0xbc, 0x21, 0x8a, 0xf1, 0x5b, 0xab};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5d, 0xcd, 0xf0, 0x78, 0x36, 0xf,  0x89, 0xee, 0xa6, 0x4b,
                                     0x98, 0x9c, 0xb5, 0x72, 0x69, 0x0,  0xe0, 0x82, 0x5e, 0xc,
                                     0xbe, 0x84, 0x9c, 0xaa, 0x95, 0xc7, 0x55, 0x8e, 0x6e};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}}, {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18943}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 72}}, {.prop = (lwmqtt_prop_t)37, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 37}}, {.prop = (lwmqtt_prop_t)1, .value = {.byte = 14}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9472, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18189 [("\142\SUB\241ET\151\232",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("t\160\t\216\&0\193Dg",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\218\225\n\t_\\\243\201\136\236\156E\172\217C\208\EOTn\147\225\145",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167NE\EOT\132/\SIWTa\223|'\178]?\227\170O",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\208\238\156.\186\253",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\227\238\151ou]\230\234\ETB\aQ\170\218",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2}),("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS1}),("\249\a\164!\177YC\194\&0\183f\212\212Y\NAK\EOT\178\179",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("[",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\CANk+w\218\153\151\DEL\179U\STXl\DC2\SUBE\251\241\208",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\132B\f\206\169",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropPayloadFormatIndicator
// 202,PropMaximumPacketSize 29573,PropWillDelayInterval 21956,PropServerKeepAlive 15460,PropSubscriptionIdentifier
// 21,PropMessageExpiryInterval 4729,PropSubscriptionIdentifierAvailable 188,PropMessageExpiryInterval
// 19861,PropReceiveMaximum 28358,PropPayloadFormatIndicator 237,PropCorrelationData "\203",PropResponseInformation
// "\182@\161\SUB\vT\157f4|\253 \197\230\SYN\NUL\205\165\199\134E\129n0",PropRequestProblemInformation
// 104,PropReasonString
// "\146\191\144\196\DC1\151\178\173\173!\192\213\f\252\&5\142\EOTL\243\152\231\181\250\161\SOna\135\159",PropResponseTopic
// "\228\212\161\SI\254\252\172\209o\"8\151",PropContentType
// "\199i\162\&9\226\ETB\252\231\254`\230\213\194\211b\212\207,\165\&5p\162C0j>\ETX\SYN",PropSharedSubscriptionAvailable
// 68,PropMaximumPacketSize 10716,PropMessageExpiryInterval 10250,PropSubscriptionIdentifier 7,PropMaximumPacketSize
// 2136,PropResponseTopic "\194\171?\150TB"]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x82, 0xc6, 0x2,  0x47, 0xd,  0xad, 0x1,  0x1,  0xca, 0x27, 0x0,  0x0,  0x73, 0x85, 0x18, 0x0,  0x0,  0x55, 0xc4,
      0x13, 0x3c, 0x64, 0xb,  0x15, 0x2,  0x0,  0x0,  0x12, 0x79, 0x29, 0xbc, 0x2,  0x0,  0x0,  0x4d, 0x95, 0x21, 0x6e,
      0xc6, 0x1,  0xed, 0x9,  0x0,  0x1,  0xcb, 0x1a, 0x0,  0x18, 0xb6, 0x40, 0xa1, 0x1a, 0xb,  0x54, 0x9d, 0x66, 0x34,
      0x7c, 0xfd, 0x20, 0xc5, 0xe6, 0x16, 0x0,  0xcd, 0xa5, 0xc7, 0x86, 0x45, 0x81, 0x6e, 0x30, 0x17, 0x68, 0x1f, 0x0,
      0x1d, 0x92, 0xbf, 0x90, 0xc4, 0x11, 0x97, 0xb2, 0xad, 0xad, 0x21, 0xc0, 0xd5, 0xc,  0xfc, 0x35, 0x8e, 0x4,  0x4c,
      0xf3, 0x98, 0xe7, 0xb5, 0xfa, 0xa1, 0xe,  0x6e, 0x61, 0x87, 0x9f, 0x8,  0x0,  0xc,  0xe4, 0xd4, 0xa1, 0xf,  0xfe,
      0xfc, 0xac, 0xd1, 0x6f, 0x22, 0x38, 0x97, 0x3,  0x0,  0x1c, 0xc7, 0x69, 0xa2, 0x39, 0xe2, 0x17, 0xfc, 0xe7, 0xfe,
      0x60, 0xe6, 0xd5, 0xc2, 0xd3, 0x62, 0xd4, 0xcf, 0x2c, 0xa5, 0x35, 0x70, 0xa2, 0x43, 0x30, 0x6a, 0x3e, 0x3,  0x16,
      0x2a, 0x44, 0x27, 0x0,  0x0,  0x29, 0xdc, 0x2,  0x0,  0x0,  0x28, 0xa,  0xb,  0x7,  0x27, 0x0,  0x0,  0x8,  0x58,
      0x8,  0x0,  0x6,  0xc2, 0xab, 0x3f, 0x96, 0x54, 0x42, 0x0,  0x7,  0x8e, 0x1a, 0xf1, 0x45, 0x54, 0x97, 0xe8, 0x2e,
      0x0,  0x8,  0x74, 0xa0, 0x9,  0xd8, 0x30, 0xc1, 0x44, 0x67, 0x9,  0x0,  0x15, 0xda, 0xe1, 0xa,  0x9,  0x5f, 0x5c,
      0xf3, 0xc9, 0x88, 0xec, 0x9c, 0x45, 0xac, 0xd9, 0x43, 0xd0, 0x4,  0x6e, 0x93, 0xe1, 0x91, 0x0,  0x0,  0x13, 0xa7,
      0x4e, 0x45, 0x4,  0x84, 0x2f, 0xf,  0x57, 0x54, 0x61, 0xdf, 0x7c, 0x27, 0xb2, 0x5d, 0x3f, 0xe3, 0xaa, 0x4f, 0x16,
      0x0,  0x6,  0xd0, 0xee, 0x9c, 0x2e, 0xba, 0xfd, 0xd,  0x0,  0xd,  0xe3, 0xee, 0x97, 0x6f, 0x75, 0x5d, 0xe6, 0xea,
      0x17, 0x7,  0x51, 0xaa, 0xda, 0x1e, 0x0,  0x0,  0x2d, 0x0,  0x12, 0xf9, 0x7,  0xa4, 0x21, 0xb1, 0x59, 0x43, 0xc2,
      0x30, 0xb7, 0x66, 0xd4, 0xd4, 0x59, 0x15, 0x4,  0xb2, 0xb3, 0x1c, 0x0,  0x1,  0x5b, 0x18, 0x0,  0x12, 0x18, 0x6b,
      0x2b, 0x77, 0xda, 0x99, 0x97, 0x7f, 0xb3, 0x55, 0x2,  0x6c, 0x12, 0x1a, 0x45, 0xfb, 0xf1, 0xd0, 0x20, 0x0,  0x5,
      0x84, 0x42, 0xc,  0xce, 0xa9, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x8e, 0x1a, 0xf1, 0x45, 0x54, 0x97, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x74, 0xa0, 0x9, 0xd8, 0x30, 0xc1, 0x44, 0x67};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xda, 0xe1, 0xa,  0x9,  0x5f, 0x5c, 0xf3, 0xc9, 0x88, 0xec, 0x9c,
                                     0x45, 0xac, 0xd9, 0x43, 0xd0, 0x4,  0x6e, 0x93, 0xe1, 0x91};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa7, 0x4e, 0x45, 0x4,  0x84, 0x2f, 0xf,  0x57, 0x54, 0x61,
                                     0xdf, 0x7c, 0x27, 0xb2, 0x5d, 0x3f, 0xe3, 0xaa, 0x4f};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd0, 0xee, 0x9c, 0x2e, 0xba, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe3, 0xee, 0x97, 0x6f, 0x75, 0x5d, 0xe6, 0xea, 0x17, 0x7, 0x51, 0xaa, 0xda};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf9, 0x7,  0xa4, 0x21, 0xb1, 0x59, 0x43, 0xc2, 0x30,
                                     0xb7, 0x66, 0xd4, 0xd4, 0x59, 0x15, 0x4,  0xb2, 0xb3};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x5b};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x18, 0x6b, 0x2b, 0x77, 0xda, 0x99, 0x97, 0x7f, 0xb3,
                                     0x55, 0x2,  0x6c, 0x12, 0x1a, 0x45, 0xfb, 0xf1, 0xd0};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x84, 0x42, 0xc, 0xce, 0xa9};
  lwmqtt_string_t topic_filter_s10 = {5, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0xcb};
  uint8_t bytesprops1[] = {0xb6, 0x40, 0xa1, 0x1a, 0xb,  0x54, 0x9d, 0x66, 0x34, 0x7c, 0xfd, 0x20,
                           0xc5, 0xe6, 0x16, 0x0,  0xcd, 0xa5, 0xc7, 0x86, 0x45, 0x81, 0x6e, 0x30};
  uint8_t bytesprops2[] = {0x92, 0xbf, 0x90, 0xc4, 0x11, 0x97, 0xb2, 0xad, 0xad, 0x21, 0xc0, 0xd5, 0xc,  0xfc, 0x35,
                           0x8e, 0x4,  0x4c, 0xf3, 0x98, 0xe7, 0xb5, 0xfa, 0xa1, 0xe,  0x6e, 0x61, 0x87, 0x9f};
  uint8_t bytesprops3[] = {0xe4, 0xd4, 0xa1, 0xf, 0xfe, 0xfc, 0xac, 0xd1, 0x6f, 0x22, 0x38, 0x97};
  uint8_t bytesprops4[] = {0xc7, 0x69, 0xa2, 0x39, 0xe2, 0x17, 0xfc, 0xe7, 0xfe, 0x60, 0xe6, 0xd5, 0xc2, 0xd3,
                           0x62, 0xd4, 0xcf, 0x2c, 0xa5, 0x35, 0x70, 0xa2, 0x43, 0x30, 0x6a, 0x3e, 0x3,  0x16};
  uint8_t bytesprops5[] = {0xc2, 0xab, 0x3f, 0x96, 0x54, 0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29573}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21956}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15460}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4729}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19861}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28358}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10716}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10250}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2136}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18189, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 30748 [Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Right QoS0,Right QoS1,Right
// QoS1,Left SubErrNotAuthorized,Left SubErrNotAuthorized,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0xb, 0x78, 0x1c, 0x1, 0x1, 0x83, 0x0, 0x1, 0x1, 0x87, 0x87, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30748);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 11486 [Right QoS1,Right QoS1,Right QoS1,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x6, 0x2c, 0xde, 0x1, 0x1, 0x1, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11486);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 31056 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS0,Right
// QoS0,Right QoS1] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x9, 0x79, 0x50, 0x87, 0x80, 0x2, 0x0, 0x0, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31056);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
}

// SubscribeResponse 7634 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS1] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x5, 0x1d, 0xd2, 0xa1, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7634);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 17449 [Left SubErrUnspecifiedError,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right
// QoS2,Right QoS1] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0xb, 0x44, 0x29, 0x80, 0x97, 0x80, 0x80, 0x91, 0x0, 0xa2, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17449);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 27369 [Left SubErrImplementationSpecificError,Right QoS1,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS0,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Left
// SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0xd, 0x6a, 0xe9, 0x83, 0x1, 0x0, 0x80, 0x2, 0x0, 0x0, 0x80, 0x87, 0x8f, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27369);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 9981 [Right QoS2,Right QoS1,Left SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Right
// QoS2,Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0xa, 0x26, 0xfd, 0x2, 0x1, 0x80, 0x91, 0x2, 0x83, 0x80, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9981);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
}

// SubscribeResponse 25704 [Right QoS1,Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x5, 0x64, 0x68, 0x1, 0x83, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25704);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 27290 [Right QoS0,Right QoS1,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS1,Left SubErrPacketIdentifierInUse,Right QoS2] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0xa, 0x6a, 0x9a, 0x0, 0x1, 0x1, 0x9e, 0x91, 0x1, 0x91, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27290);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 26187 [Left SubErrImplementationSpecificError,Right QoS1,Left SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x5, 0x66, 0x4b, 0x83, 0x1, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26187);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 26384 [Left SubErrUnspecifiedError,Left SubErrUnspecifiedError,Right QoS1,Left
// SubErrNotAuthorized,Right QoS0,Right QoS1,Left SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0xd, 0x67, 0x10, 0x80, 0x80, 0x1, 0x87, 0x0, 0x1, 0x83, 0x97, 0xa1, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26384);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 24874 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Right QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x7, 0x61, 0x2a, 0x2, 0x9e, 0x83, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24874);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 25167 [Left SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x3, 0x62, 0x4f, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25167);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 7252 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left SubErrUnspecifiedError,Right
// QoS2,Right QoS1,Right QoS2,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xb, 0x1c, 0x54, 0xa2, 0x0, 0x80, 0x2, 0x1, 0x2, 0x0, 0xa1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7252);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 22592 [Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x7, 0x58, 0x40, 0x80, 0x2, 0x0, 0xa1, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22592);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 1930 [Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right QoS2,Left SubErrQuotaExceeded,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrTopicFilterInvalid,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0xd, 0x7, 0x8a, 0xa2, 0xa2, 0x0, 0x2, 0x97, 0x1, 0xa1, 0x8f, 0x8f, 0x8f, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1930);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 32288 [Right QoS1,Right QoS0,Right QoS1,Right QoS2,Left SubErrImplementationSpecificError,Right
// QoS1,Left SubErrQuotaExceeded,Right QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0xd, 0x7e, 0x20, 0x1, 0x0, 0x1, 0x2, 0x83, 0x1, 0x97, 0x1, 0x91, 0x2, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32288);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 8665 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrQuotaExceeded,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x9, 0x21, 0xd9, 0x9e, 0x80, 0x97, 0x2, 0x8f, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8665);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 32158 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0x5, 0x7d, 0x9e, 0xa2, 0x0, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32158);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 9271 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS2,Right QoS0,Left
// SubErrQuotaExceeded,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x9, 0x24, 0x37, 0xa1, 0x1, 0x2, 0x0, 0x97, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9271);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 4115 [Left SubErrUnspecifiedError,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrNotAuthorized,Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x7, 0x10, 0x13, 0x80, 0x9e, 0x87, 0x9e, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4115);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 24961 [Right QoS2,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Left SubErrTopicFilterInvalid,Left
// SubErrQuotaExceeded,Right QoS0,Left SubErrQuotaExceeded,Right QoS2,Right QoS0] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0xc, 0x61, 0x81, 0x2, 0x0, 0x97, 0x0, 0x8f, 0x97, 0x0, 0x97, 0x2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24961);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 18340 [Right QoS2,Left SubErrTopicFilterInvalid,Right QoS1,Left SubErrImplementationSpecificError]
// []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x6, 0x47, 0xa4, 0x2, 0x8f, 0x1, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18340);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 8517 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS0] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x8, 0x21, 0x45, 0x9e, 0x0, 0xa1, 0xa2, 0x2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8517);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
}

// SubscribeResponse 31168 [Right QoS2,Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrNotAuthorized,Right QoS0,Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left
// SubErrPacketIdentifierInUse,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0xb, 0x79, 0xc0, 0x2, 0x8f, 0xa1, 0x87, 0x0, 0x9e, 0x1, 0x91, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31168);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 6558 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left
// SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Right
// QoS1,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x9, 0x19, 0x9e, 0x9e, 0x0, 0x83, 0x83, 0x83, 0x1, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6558);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 25528 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrImplementationSpecificError,Right QoS2] []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x7, 0x63, 0xb8, 0x9e, 0x80, 0x80, 0x83, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25528);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 29497 [Right QoS2,Right QoS2,Right QoS2,Right QoS1,Right QoS2,Left SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x8, 0x73, 0x39, 0x2, 0x2, 0x2, 0x1, 0x2, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29497);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 9048 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS1,Right QoS2,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0xd, 0x23, 0x58, 0x87, 0x80, 0x87, 0x1, 0x9e, 0x1, 0x1, 0x2, 0x2, 0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9048);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 18118 [Right QoS1] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0x3, 0x46, 0xc6, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18118);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}

// SubscribeResponse 30748 [Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Right QoS0,Right QoS1,Right
// QoS1,Left SubErrNotAuthorized,Left SubErrNotAuthorized,Left SubErrNotAuthorized] [PropAssignedClientIdentifier
// "",PropUserProperty "W\ESC\ACK\189t\NAK3\222"
// "\NUL\255\211{\199\176\144\GS\163\205\a>\178\NAK\r\NUL\134\207/\207\DEL\188\167\222\134\DEL",PropRetainAvailable
// 185,PropServerReference "x\233\186s\131\SI",PropRequestResponseInformation 88,PropRequestProblemInformation
// 231,PropSubscriptionIdentifier 26,PropMessageExpiryInterval 27266,PropResponseTopic
// "O$\158\ETX#\195x\SO\129\FS\249\189\178\STX\169\212;\202\154#<T\225\167\210m\251",PropRequestResponseInformation
// 41,PropMessageExpiryInterval 6105,PropTopicAliasMaximum 24211,PropServerKeepAlive 30566,PropServerReference
// "\nh\252\175",PropServerKeepAlive 8324,PropUserProperty "\162\145"
// "\244Q\240\GS\v\170G\140\198",PropWildcardSubscriptionAvailable 28,PropSubscriptionIdentifier
// 4,PropResponseInformation "\143\168\244/M\249\152:",PropMessageExpiryInterval 9752,PropPayloadFormatIndicator
// 77,PropMaximumQoS 71,PropRequestResponseInformation 64,PropTopicAlias 16158,PropReasonString
// "\131\244%\240\&7\205\234\223\247\167\205Nex\STX\157&\133\177u\252",PropRequestResponseInformation 2]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x90, 0xc9, 0x1,  0x78, 0x1c, 0xbc, 0x1,  0x12, 0x0,  0x0,  0x26, 0x0,  0x8,  0x57, 0x1b, 0x6,  0xbd, 0x74, 0x15,
      0x33, 0xde, 0x0,  0x1a, 0x0,  0xff, 0xd3, 0x7b, 0xc7, 0xb0, 0x90, 0x1d, 0xa3, 0xcd, 0x7,  0x3e, 0xb2, 0x15, 0xd,
      0x0,  0x86, 0xcf, 0x2f, 0xcf, 0x7f, 0xbc, 0xa7, 0xde, 0x86, 0x7f, 0x25, 0xb9, 0x1c, 0x0,  0x6,  0x78, 0xe9, 0xba,
      0x73, 0x83, 0xf,  0x19, 0x58, 0x17, 0xe7, 0xb,  0x1a, 0x2,  0x0,  0x0,  0x6a, 0x82, 0x8,  0x0,  0x1b, 0x4f, 0x24,
      0x9e, 0x3,  0x23, 0xc3, 0x78, 0xe,  0x81, 0x1c, 0xf9, 0xbd, 0xb2, 0x2,  0xa9, 0xd4, 0x3b, 0xca, 0x9a, 0x23, 0x3c,
      0x54, 0xe1, 0xa7, 0xd2, 0x6d, 0xfb, 0x19, 0x29, 0x2,  0x0,  0x0,  0x17, 0xd9, 0x22, 0x5e, 0x93, 0x13, 0x77, 0x66,
      0x1c, 0x0,  0x4,  0xa,  0x68, 0xfc, 0xaf, 0x13, 0x20, 0x84, 0x26, 0x0,  0x2,  0xa2, 0x91, 0x0,  0x9,  0xf4, 0x51,
      0xf0, 0x1d, 0xb,  0xaa, 0x47, 0x8c, 0xc6, 0x28, 0x1c, 0xb,  0x4,  0x1a, 0x0,  0x8,  0x8f, 0xa8, 0xf4, 0x2f, 0x4d,
      0xf9, 0x98, 0x3a, 0x2,  0x0,  0x0,  0x26, 0x18, 0x1,  0x4d, 0x24, 0x47, 0x19, 0x40, 0x23, 0x3f, 0x1e, 0x1f, 0x0,
      0x15, 0x83, 0xf4, 0x25, 0xf0, 0x37, 0xcd, 0xea, 0xdf, 0xf7, 0xa7, 0xcd, 0x4e, 0x65, 0x78, 0x2,  0x9d, 0x26, 0x85,
      0xb1, 0x75, 0xfc, 0x19, 0x2,  0x1,  0x1,  0x83, 0x0,  0x1,  0x1,  0x87, 0x87, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30748);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x87);
  EXPECT_EQ(granted_qos_levels[7], 0x87);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
}

// SubscribeResponse 11486 [Right QoS1,Right QoS1,Right QoS1,Left SubErrNotAuthorized] [PropTopicAlias
// 2406,PropContentType "\CANP&\171F\253D\140\141\206\&7\136I",PropReasonString
// "}0\151",PropWildcardSubscriptionAvailable 56,PropRetainAvailable 75,PropAuthenticationData
// "\175A\ETB\FS\154\196P\180\NAK\213f\227K\181.I\157\130x_\151",PropSubscriptionIdentifier 18,PropReceiveMaximum 21472]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x41, 0x2c, 0xde, 0x3a, 0x23, 0x9,  0x66, 0x3,  0x0,  0xd,  0x18, 0x50, 0x26, 0xab, 0x46, 0xfd,
                   0x44, 0x8c, 0x8d, 0xce, 0x37, 0x88, 0x49, 0x1f, 0x0,  0x3,  0x7d, 0x30, 0x97, 0x28, 0x38, 0x25, 0x4b,
                   0x16, 0x0,  0x15, 0xaf, 0x41, 0x17, 0x1c, 0x9a, 0xc4, 0x50, 0xb4, 0x15, 0xd5, 0x66, 0xe3, 0x4b, 0xb5,
                   0x2e, 0x49, 0x9d, 0x82, 0x78, 0x5f, 0x97, 0xb,  0x12, 0x21, 0x53, 0xe0, 0x1,  0x1,  0x1,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11486);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
}

// SubscribeResponse 31056 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS0,Right
// QoS0,Right QoS1] [PropResponseTopic "\174F\192\SOH",PropRetainAvailable 191,PropTopicAliasMaximum
// 14314,PropSessionExpiryInterval 5431,PropResponseTopic "\NUL\136",PropWildcardSubscriptionAvailable
// 103,PropAuthenticationData "\151\237*\173\128\US\220\254\220G",PropAssignedClientIdentifier
// "\EOT\138\182Z\131p&\130\158",PropMaximumQoS 242,PropAuthenticationMethod
// "\134\253\169\198\187\233\&1\218\130;G\196\221T\NUL\166\204X\131\STX\b\150",PropReasonString
// "sEc=3N\227",PropResponseTopic
// "\217X(\255U\249\a\168\SI`\229\DC4|\232\147\ACK\195\213}\131\178\GS\166/u",PropMessageExpiryInterval
// 14554,PropSubscriptionIdentifier 15,PropSharedSubscriptionAvailable 101,PropMessageExpiryInterval 4159]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x8b, 0x1,  0x79, 0x50, 0x80, 0x1,  0x8,  0x0,  0x4,  0xae, 0x46, 0xc0, 0x1,  0x25, 0xbf,
                   0x22, 0x37, 0xea, 0x11, 0x0,  0x0,  0x15, 0x37, 0x8,  0x0,  0x2,  0x0,  0x88, 0x28, 0x67, 0x16,
                   0x0,  0xa,  0x97, 0xed, 0x2a, 0xad, 0x80, 0x1f, 0xdc, 0xfe, 0xdc, 0x47, 0x12, 0x0,  0x9,  0x4,
                   0x8a, 0xb6, 0x5a, 0x83, 0x70, 0x26, 0x82, 0x9e, 0x24, 0xf2, 0x15, 0x0,  0x16, 0x86, 0xfd, 0xa9,
                   0xc6, 0xbb, 0xe9, 0x31, 0xda, 0x82, 0x3b, 0x47, 0xc4, 0xdd, 0x54, 0x0,  0xa6, 0xcc, 0x58, 0x83,
                   0x2,  0x8,  0x96, 0x1f, 0x0,  0x7,  0x73, 0x45, 0x63, 0x3d, 0x33, 0x4e, 0xe3, 0x8,  0x0,  0x19,
                   0xd9, 0x58, 0x28, 0xff, 0x55, 0xf9, 0x7,  0xa8, 0xf,  0x60, 0xe5, 0x14, 0x7c, 0xe8, 0x93, 0x6,
                   0xc3, 0xd5, 0x7d, 0x83, 0xb2, 0x1d, 0xa6, 0x2f, 0x75, 0x2,  0x0,  0x0,  0x38, 0xda, 0xb,  0xf,
                   0x2a, 0x65, 0x2,  0x0,  0x0,  0x10, 0x3f, 0x87, 0x80, 0x2,  0x0,  0x0,  0x0,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31056);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
}

// SubscribeResponse 7634 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS1]
// [PropWildcardSubscriptionAvailable 117,PropSessionExpiryInterval 19428,PropMaximumPacketSize 8971,PropMaximumQoS
// 43,PropRetainAvailable 125,PropMaximumPacketSize 11341,PropSharedSubscriptionAvailable 195,PropAuthenticationData
// "y\191)\242\\\STX\254\a\SI\GS'\159ak\230\140\164\162\130+\189\ESC",PropAssignedClientIdentifier
// "\254j\SUBjht\226\NUL\159-\145\203\151\RS\230\189Zo\174\254\141q\237\244",PropWildcardSubscriptionAvailable
// 152,PropMaximumQoS 35,PropTopicAliasMaximum 13672,PropSharedSubscriptionAvailable 216,PropAssignedClientIdentifier
// "\172\233",PropCorrelationData "\158\&1\t\137=]",PropSharedSubscriptionAvailable 150,PropMessageExpiryInterval
// 30357,PropReasonString "\188\"\207X\246\130\US\188R\253=\nQ\US\STX\132\169r",PropMaximumQoS 201,PropServerKeepAlive
// 8699,PropReasonString "\203\ENQ\145OC-2?\162\212",PropAuthenticationMethod
// "\221\156\SUB\142\236\138\128\nu\162\n\180\136j\229\228\&3",PropReceiveMaximum 9931]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0xae, 0x1,  0x1d, 0xd2, 0xa7, 0x1,  0x28, 0x75, 0x11, 0x0,  0x0,  0x4b, 0xe4, 0x27, 0x0,  0x0,
                   0x23, 0xb,  0x24, 0x2b, 0x25, 0x7d, 0x27, 0x0,  0x0,  0x2c, 0x4d, 0x2a, 0xc3, 0x16, 0x0,  0x16, 0x79,
                   0xbf, 0x29, 0xf2, 0x5c, 0x2,  0xfe, 0x7,  0xf,  0x1d, 0x27, 0x9f, 0x61, 0x6b, 0xe6, 0x8c, 0xa4, 0xa2,
                   0x82, 0x2b, 0xbd, 0x1b, 0x12, 0x0,  0x18, 0xfe, 0x6a, 0x1a, 0x6a, 0x68, 0x74, 0xe2, 0x0,  0x9f, 0x2d,
                   0x91, 0xcb, 0x97, 0x1e, 0xe6, 0xbd, 0x5a, 0x6f, 0xae, 0xfe, 0x8d, 0x71, 0xed, 0xf4, 0x28, 0x98, 0x24,
                   0x23, 0x22, 0x35, 0x68, 0x2a, 0xd8, 0x12, 0x0,  0x2,  0xac, 0xe9, 0x9,  0x0,  0x6,  0x9e, 0x31, 0x9,
                   0x89, 0x3d, 0x5d, 0x2a, 0x96, 0x2,  0x0,  0x0,  0x76, 0x95, 0x1f, 0x0,  0x12, 0xbc, 0x22, 0xcf, 0x58,
                   0xf6, 0x82, 0x1f, 0xbc, 0x52, 0xfd, 0x3d, 0xa,  0x51, 0x1f, 0x2,  0x84, 0xa9, 0x72, 0x24, 0xc9, 0x13,
                   0x21, 0xfb, 0x1f, 0x0,  0xa,  0xcb, 0x5,  0x91, 0x4f, 0x43, 0x2d, 0x32, 0x3f, 0xa2, 0xd4, 0x15, 0x0,
                   0x11, 0xdd, 0x9c, 0x1a, 0x8e, 0xec, 0x8a, 0x80, 0xa,  0x75, 0xa2, 0xa,  0xb4, 0x88, 0x6a, 0xe5, 0xe4,
                   0x33, 0x21, 0x26, 0xcb, 0xa1, 0x2,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7634);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 17449 [Left SubErrUnspecifiedError,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right
// QoS2,Right QoS1] [PropResponseInformation
// "\NAK\231\DC4$VU\152\205\ACK\138\245\171\157;\tw\183W",PropWillDelayInterval 2297,PropWillDelayInterval
// 6369,PropReceiveMaximum 14983,PropRetainAvailable 1,PropAuthenticationMethod
// "\r\156\&7*g\131\229\238\FSTN\211\135\182\225\153\146\147\194",PropTopicAliasMaximum 2942,PropTopicAlias
// 20633,PropRequestResponseInformation 3,PropReasonString "\212%",PropSubscriptionIdentifier
// 9,PropMessageExpiryInterval 25957,PropMaximumPacketSize 17017,PropResponseTopic
// ";\180\250D\ACK\235g_t\NAK6\174\137i\186E\182p\DLE\229;G\STX\181\237Y\191",PropPayloadFormatIndicator
// 92,PropRetainAvailable 102,PropRetainAvailable 170,PropRequestProblemInformation 152,PropUserProperty
// "\150\163\243\n\r\ETB\210\233\&3\176f\157\208\254m\175D\217\178[\226\169*\199\177\&6\145>\185"
// "\147\178\206\245\236D\222O\176\191\132y\196",PropRequestProblemInformation 141,PropRequestProblemInformation
// 72,PropTopicAlias 18280]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0xbc, 0x1,  0x44, 0x29, 0xaf, 0x1,  0x1a, 0x0,  0x12, 0x15, 0xe7, 0x14, 0x24, 0x56, 0x55,
                   0x98, 0xcd, 0x6,  0x8a, 0xf5, 0xab, 0x9d, 0x3b, 0x9,  0x77, 0xb7, 0x57, 0x18, 0x0,  0x0,  0x8,
                   0xf9, 0x18, 0x0,  0x0,  0x18, 0xe1, 0x21, 0x3a, 0x87, 0x25, 0x1,  0x15, 0x0,  0x13, 0xd,  0x9c,
                   0x37, 0x2a, 0x67, 0x83, 0xe5, 0xee, 0x1c, 0x54, 0x4e, 0xd3, 0x87, 0xb6, 0xe1, 0x99, 0x92, 0x93,
                   0xc2, 0x22, 0xb,  0x7e, 0x23, 0x50, 0x99, 0x19, 0x3,  0x1f, 0x0,  0x2,  0xd4, 0x25, 0xb,  0x9,
                   0x2,  0x0,  0x0,  0x65, 0x65, 0x27, 0x0,  0x0,  0x42, 0x79, 0x8,  0x0,  0x1b, 0x3b, 0xb4, 0xfa,
                   0x44, 0x6,  0xeb, 0x67, 0x5f, 0x74, 0x15, 0x36, 0xae, 0x89, 0x69, 0xba, 0x45, 0xb6, 0x70, 0x10,
                   0xe5, 0x3b, 0x47, 0x2,  0xb5, 0xed, 0x59, 0xbf, 0x1,  0x5c, 0x25, 0x66, 0x25, 0xaa, 0x17, 0x98,
                   0x26, 0x0,  0x1d, 0x96, 0xa3, 0xf3, 0xa,  0xd,  0x17, 0xd2, 0xe9, 0x33, 0xb0, 0x66, 0x9d, 0xd0,
                   0xfe, 0x6d, 0xaf, 0x44, 0xd9, 0xb2, 0x5b, 0xe2, 0xa9, 0x2a, 0xc7, 0xb1, 0x36, 0x91, 0x3e, 0xb9,
                   0x0,  0xd,  0x93, 0xb2, 0xce, 0xf5, 0xec, 0x44, 0xde, 0x4f, 0xb0, 0xbf, 0x84, 0x79, 0xc4, 0x17,
                   0x8d, 0x17, 0x48, 0x23, 0x47, 0x68, 0x80, 0x97, 0x80, 0x80, 0x91, 0x0,  0xa2, 0x2,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17449);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 27369 [Left SubErrImplementationSpecificError,Right QoS1,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS0,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Left
// SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported] [PropContentType
// "\234\146\&0.\151\163\229p=\r\164R\252\DC1\158\239\163Xg\180\ESC\255",PropReasonString
// "bz\245\DC4\195\233\144\224}\159g\138c\131\238L\138Ts\208\t\214]\EM\175\238:\144\255\252",PropPayloadFormatIndicator
// 208,PropAssignedClientIdentifier "\EMTh\229.\194\ETX+\148\197\DC3f\225\206u",PropCorrelationData
// "\183d\136\140cm.\195\205}\147\206\187",PropRequestResponseInformation 174,PropTopicAlias
// 18785,PropWildcardSubscriptionAvailable 140,PropTopicAliasMaximum 7985,PropRetainAvailable 248,PropUserProperty
// "\207\195\177\241,\US\134\254\205\130#\161\214\132\DC3"
// "K\EM\154U\SI\171b\220$\SUBS\180\244\150\254:\147p\221\207^",PropSharedSubscriptionAvailable
// 205,PropPayloadFormatIndicator 226,PropRequestProblemInformation 220,PropResponseTopic
// "o\148\EOT\232?\v7\ESCl\ETX\200\&2\158\255\DEL\175\130\173\204\DC2\EOTj\134\172",PropAuthenticationData
// "\146]\ESC\DLE\RSR/\"x\153\232M\NAKF\187\RS\139\179\249{\207\&2\143\180\252a\198vY\151"]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0xe4, 0x1,  0x6a, 0xe9, 0xd5, 0x1,  0x3,  0x0,  0x16, 0xea, 0x92, 0x30, 0x2e, 0x97, 0xa3, 0xe5,
                   0x70, 0x3d, 0xd,  0xa4, 0x52, 0xfc, 0x11, 0x9e, 0xef, 0xa3, 0x58, 0x67, 0xb4, 0x1b, 0xff, 0x1f, 0x0,
                   0x1e, 0x62, 0x7a, 0xf5, 0x14, 0xc3, 0xe9, 0x90, 0xe0, 0x7d, 0x9f, 0x67, 0x8a, 0x63, 0x83, 0xee, 0x4c,
                   0x8a, 0x54, 0x73, 0xd0, 0x9,  0xd6, 0x5d, 0x19, 0xaf, 0xee, 0x3a, 0x90, 0xff, 0xfc, 0x1,  0xd0, 0x12,
                   0x0,  0xf,  0x19, 0x54, 0x68, 0xe5, 0x2e, 0xc2, 0x3,  0x2b, 0x94, 0xc5, 0x13, 0x66, 0xe1, 0xce, 0x75,
                   0x9,  0x0,  0xd,  0xb7, 0x64, 0x88, 0x8c, 0x63, 0x6d, 0x2e, 0xc3, 0xcd, 0x7d, 0x93, 0xce, 0xbb, 0x19,
                   0xae, 0x23, 0x49, 0x61, 0x28, 0x8c, 0x22, 0x1f, 0x31, 0x25, 0xf8, 0x26, 0x0,  0xf,  0xcf, 0xc3, 0xb1,
                   0xf1, 0x2c, 0x1f, 0x86, 0xfe, 0xcd, 0x82, 0x23, 0xa1, 0xd6, 0x84, 0x13, 0x0,  0x15, 0x4b, 0x19, 0x9a,
                   0x55, 0xf,  0xab, 0x62, 0xdc, 0x24, 0x1a, 0x53, 0xb4, 0xf4, 0x96, 0xfe, 0x3a, 0x93, 0x70, 0xdd, 0xcf,
                   0x5e, 0x2a, 0xcd, 0x1,  0xe2, 0x17, 0xdc, 0x8,  0x0,  0x18, 0x6f, 0x94, 0x4,  0xe8, 0x3f, 0xb,  0x37,
                   0x1b, 0x6c, 0x3,  0xc8, 0x32, 0x9e, 0xff, 0x7f, 0xaf, 0x82, 0xad, 0xcc, 0x12, 0x4,  0x6a, 0x86, 0xac,
                   0x16, 0x0,  0x1e, 0x92, 0x5d, 0x1b, 0x10, 0x1e, 0x52, 0x2f, 0x22, 0x78, 0x99, 0xe8, 0x4d, 0x15, 0x46,
                   0xbb, 0x1e, 0x8b, 0xb3, 0xf9, 0x7b, 0xcf, 0x32, 0x8f, 0xb4, 0xfc, 0x61, 0xc6, 0x76, 0x59, 0x97, 0x83,
                   0x1,  0x0,  0x80, 0x2,  0x0,  0x0,  0x80, 0x87, 0x8f, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27369);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], 0x8F);
  EXPECT_EQ(granted_qos_levels[10], 0xA1);
}

// SubscribeResponse 9981 [Right QoS2,Right QoS1,Left SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Right
// QoS2,Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Left SubErrUnspecifiedError]
// [PropAuthenticationData "\152",PropMaximumQoS 127,PropTopicAlias 18865,PropCorrelationData
// "\EOT\ENQ\131\197Jh~\181Hr\177\SI\235:\132\247Av(",PropServerReference
// "t\EOT\203\168\221g\222\135\232>\fC\132_6\DLE\131\&5G\223K\161&\250\219\225Uq4N",PropWillDelayInterval
// 11881,PropRequestProblemInformation 159,PropMessageExpiryInterval 13721,PropCorrelationData
// "\242qt\128\153\anZ[\US\171",PropSubscriptionIdentifierAvailable 110,PropReasonString " \194\DLE\185\142\213t
// s%\159\n\214X\CAN\200p\DELVX)",PropCorrelationData
// "\215j}\SI\208!\142'?\STX\130\185\&3%L\218\ETB\212",PropSharedSubscriptionAvailable 42,PropAuthenticationData
// "H\149\252m\195\141\196\246\129/]\208P\162",PropRequestResponseInformation 32,PropSubscriptionIdentifierAvailable
// 41,PropWildcardSubscriptionAvailable 71,PropSharedSubscriptionAvailable 72]
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0xb0, 0x1,  0x26, 0xfd, 0xa4, 0x1,  0x16, 0x0,  0x1,  0x98, 0x24, 0x7f, 0x23, 0x49, 0xb1, 0x9,
                   0x0,  0x13, 0x4,  0x5,  0x83, 0xc5, 0x4a, 0x68, 0x7e, 0xb5, 0x48, 0x72, 0xb1, 0xf,  0xeb, 0x3a, 0x84,
                   0xf7, 0x41, 0x76, 0x28, 0x1c, 0x0,  0x1e, 0x74, 0x4,  0xcb, 0xa8, 0xdd, 0x67, 0xde, 0x87, 0xe8, 0x3e,
                   0xc,  0x43, 0x84, 0x5f, 0x36, 0x10, 0x83, 0x35, 0x47, 0xdf, 0x4b, 0xa1, 0x26, 0xfa, 0xdb, 0xe1, 0x55,
                   0x71, 0x34, 0x4e, 0x18, 0x0,  0x0,  0x2e, 0x69, 0x17, 0x9f, 0x2,  0x0,  0x0,  0x35, 0x99, 0x9,  0x0,
                   0xb,  0xf2, 0x71, 0x74, 0x80, 0x99, 0x7,  0x6e, 0x5a, 0x5b, 0x1f, 0xab, 0x29, 0x6e, 0x1f, 0x0,  0x15,
                   0x20, 0xc2, 0x10, 0xb9, 0x8e, 0xd5, 0x74, 0x20, 0x73, 0x25, 0x9f, 0xa,  0xd6, 0x58, 0x18, 0xc8, 0x70,
                   0x7f, 0x56, 0x58, 0x29, 0x9,  0x0,  0x12, 0xd7, 0x6a, 0x7d, 0xf,  0xd0, 0x21, 0x8e, 0x27, 0x3f, 0x2,
                   0x82, 0xb9, 0x33, 0x25, 0x4c, 0xda, 0x17, 0xd4, 0x2a, 0x2a, 0x16, 0x0,  0xe,  0x48, 0x95, 0xfc, 0x6d,
                   0xc3, 0x8d, 0xc4, 0xf6, 0x81, 0x2f, 0x5d, 0xd0, 0x50, 0xa2, 0x19, 0x20, 0x29, 0x29, 0x28, 0x47, 0x2a,
                   0x48, 0x2,  0x1,  0x80, 0x91, 0x2,  0x83, 0x80, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9981);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x91);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
}

// SubscribeResponse 25704 [Right QoS1,Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError]
// [PropWildcardSubscriptionAvailable 84,PropSessionExpiryInterval 13092,PropTopicAliasMaximum 19356]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x10, 0x64, 0x68, 0xa,  0x28, 0x54, 0x11, 0x0,
                   0x0,  0x33, 0x24, 0x22, 0x4b, 0x9c, 0x1,  0x83, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25704);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 27290 [Right QoS0,Right QoS1,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS1,Left SubErrPacketIdentifierInUse,Right QoS2] [PropSubscriptionIdentifier
// 24,PropReceiveMaximum 9995,PropAuthenticationMethod
// "\251\v\182\FS\250Q\241\212C\"K|N\249J+\200\137",PropRetainAvailable 189,PropServerReference
// "dN\213+\180\254m!\STX\182\r\204\182\&7\144\185\r\183\221\233\&3\159ki\209",PropWillDelayInterval
// 24527,PropSubscriptionIdentifier 19,PropContentType "\190/8\167\NUL",PropPayloadFormatIndicator 131,PropResponseTopic
// "",PropSessionExpiryInterval 13681,PropSessionExpiryInterval 3955,PropReceiveMaximum 13878,PropSubscriptionIdentifier
// 5,PropSessionExpiryInterval 4247,PropTopicAlias 6837,PropMessageExpiryInterval 32164]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x73, 0x6a, 0x9a, 0x68, 0xb,  0x18, 0x21, 0x27, 0xb,  0x15, 0x0,  0x12, 0xfb, 0xb,  0xb6, 0x1c,
                   0xfa, 0x51, 0xf1, 0xd4, 0x43, 0x22, 0x4b, 0x7c, 0x4e, 0xf9, 0x4a, 0x2b, 0xc8, 0x89, 0x25, 0xbd, 0x1c,
                   0x0,  0x19, 0x64, 0x4e, 0xd5, 0x2b, 0xb4, 0xfe, 0x6d, 0x21, 0x2,  0xb6, 0xd,  0xcc, 0xb6, 0x37, 0x90,
                   0xb9, 0xd,  0xb7, 0xdd, 0xe9, 0x33, 0x9f, 0x6b, 0x69, 0xd1, 0x18, 0x0,  0x0,  0x5f, 0xcf, 0xb,  0x13,
                   0x3,  0x0,  0x5,  0xbe, 0x2f, 0x38, 0xa7, 0x0,  0x1,  0x83, 0x8,  0x0,  0x0,  0x11, 0x0,  0x0,  0x35,
                   0x71, 0x11, 0x0,  0x0,  0xf,  0x73, 0x21, 0x36, 0x36, 0xb,  0x5,  0x11, 0x0,  0x0,  0x10, 0x97, 0x23,
                   0x1a, 0xb5, 0x2,  0x0,  0x0,  0x7d, 0xa4, 0x0,  0x1,  0x1,  0x9e, 0x91, 0x1,  0x91, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27290);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x91);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 26187 [Left SubErrImplementationSpecificError,Right QoS1,Left SubErrImplementationSpecificError]
// [PropMessageExpiryInterval 119,PropContentType "",PropServerReference "\140",PropAssignedClientIdentifier
// "b\173J\131\NAK\225\ETB0\128\DC3\161t`\SI\200\188\EOT\221\235\190\233Jp\226\133\205\ENQ`",PropRequestResponseInformation
// 20,PropAssignedClientIdentifier "\STXR\152?\189V\215\&0a\228\220?\239\NAK",PropAuthenticationMethod
// "S\FS\196\ACKElA\169>\147\165",PropRetainAvailable 147,PropMaximumQoS 250,PropSubscriptionIdentifier
// 19,PropSharedSubscriptionAvailable 48,PropMaximumPacketSize 14740,PropRetainAvailable 230,PropCorrelationData
// "\131|\198\219",PropUserProperty "\160\&9pU\209\220?l" ",;8c=A\\\147j\207\147F=\237\198\165\&5",PropMaximumPacketSize
// 14635,PropMaximumPacketSize 12754,PropPayloadFormatIndicator 40,PropSubscriptionIdentifier 13,PropResponseInformation
// "\f\147\&7\235\DC2\233\168#qoo\171\US\210\154\218e\204\190\&8",PropAuthenticationData
// "pQ\f\230Sr\142\&2\ETB/^[\225j\153\NAK\218-T\199\207$\224uH",PropReceiveMaximum 30595,PropRequestResponseInformation
// 43,PropContentType "36\210",PropAuthenticationData
// "\ETX\144y\161]\254w\163\EM\166\RS\213\133\253\CAN\158\157+4\220\198",PropMessageExpiryInterval 5797]
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {
      0x90, 0xf0, 0x1,  0x66, 0x4b, 0xe9, 0x1,  0x2,  0x0,  0x0,  0x0,  0x77, 0x3,  0x0,  0x0,  0x1c, 0x0,  0x1,  0x8c,
      0x12, 0x0,  0x1c, 0x62, 0xad, 0x4a, 0x83, 0x15, 0xe1, 0x17, 0x30, 0x80, 0x13, 0xa1, 0x74, 0x60, 0xf,  0xc8, 0xbc,
      0x4,  0xdd, 0xeb, 0xbe, 0xe9, 0x4a, 0x70, 0xe2, 0x85, 0xcd, 0x5,  0x60, 0x19, 0x14, 0x12, 0x0,  0xe,  0x2,  0x52,
      0x98, 0x3f, 0xbd, 0x56, 0xd7, 0x30, 0x61, 0xe4, 0xdc, 0x3f, 0xef, 0x15, 0x15, 0x0,  0xb,  0x53, 0x1c, 0xc4, 0x6,
      0x45, 0x6c, 0x41, 0xa9, 0x3e, 0x93, 0xa5, 0x25, 0x93, 0x24, 0xfa, 0xb,  0x13, 0x2a, 0x30, 0x27, 0x0,  0x0,  0x39,
      0x94, 0x25, 0xe6, 0x9,  0x0,  0x4,  0x83, 0x7c, 0xc6, 0xdb, 0x26, 0x0,  0x8,  0xa0, 0x39, 0x70, 0x55, 0xd1, 0xdc,
      0x3f, 0x6c, 0x0,  0x11, 0x2c, 0x3b, 0x38, 0x63, 0x3d, 0x41, 0x5c, 0x93, 0x6a, 0xcf, 0x93, 0x46, 0x3d, 0xed, 0xc6,
      0xa5, 0x35, 0x27, 0x0,  0x0,  0x39, 0x2b, 0x27, 0x0,  0x0,  0x31, 0xd2, 0x1,  0x28, 0xb,  0xd,  0x1a, 0x0,  0x14,
      0xc,  0x93, 0x37, 0xeb, 0x12, 0xe9, 0xa8, 0x23, 0x71, 0x6f, 0x6f, 0xab, 0x1f, 0xd2, 0x9a, 0xda, 0x65, 0xcc, 0xbe,
      0x38, 0x16, 0x0,  0x19, 0x70, 0x51, 0xc,  0xe6, 0x53, 0x72, 0x8e, 0x32, 0x17, 0x2f, 0x5e, 0x5b, 0xe1, 0x6a, 0x99,
      0x15, 0xda, 0x2d, 0x54, 0xc7, 0xcf, 0x24, 0xe0, 0x75, 0x48, 0x21, 0x77, 0x83, 0x19, 0x2b, 0x3,  0x0,  0x3,  0x33,
      0x36, 0xd2, 0x16, 0x0,  0x15, 0x3,  0x90, 0x79, 0xa1, 0x5d, 0xfe, 0x77, 0xa3, 0x19, 0xa6, 0x1e, 0xd5, 0x85, 0xfd,
      0x18, 0x9e, 0x9d, 0x2b, 0x34, 0xdc, 0xc6, 0x2,  0x0,  0x0,  0x16, 0xa5, 0x83, 0x1,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26187);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
}

// SubscribeResponse 26384 [Left SubErrUnspecifiedError,Left SubErrUnspecifiedError,Right QoS1,Left
// SubErrNotAuthorized,Right QoS0,Right QoS1,Left SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS2] [PropUserProperty "{\195\147\227k\139"
// "\174\SO\180\195\164&!}",PropMessageExpiryInterval 9881,PropMaximumQoS 232,PropResponseTopic
// "\174g\179\226\156l\223\176\DLE]+#\130 \128\135\196",PropMaximumPacketSize 12346,PropContentType "\193\216\252\189
// \206*\228\201\ETX\222Z\172\215\SOH\188\224SC6\252e\152w",PropAssignedClientIdentifier "\US\210\ETB\198\137\215\&1U"]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x67, 0x67, 0x10, 0x59, 0x26, 0x0,  0x6,  0x7b, 0xc3, 0x93, 0xe3, 0x6b, 0x8b, 0x0,
                   0x8,  0xae, 0xe,  0xb4, 0xc3, 0xa4, 0x26, 0x21, 0x7d, 0x2,  0x0,  0x0,  0x26, 0x99, 0x24,
                   0xe8, 0x8,  0x0,  0x11, 0xae, 0x67, 0xb3, 0xe2, 0x9c, 0x6c, 0xdf, 0xb0, 0x10, 0x5d, 0x2b,
                   0x23, 0x82, 0x20, 0x80, 0x87, 0xc4, 0x27, 0x0,  0x0,  0x30, 0x3a, 0x3,  0x0,  0x18, 0xc1,
                   0xd8, 0xfc, 0xbd, 0x20, 0xce, 0x2a, 0xe4, 0xc9, 0x3,  0xde, 0x5a, 0xac, 0xd7, 0x1,  0xbc,
                   0xe0, 0x53, 0x43, 0x36, 0xfc, 0x65, 0x98, 0x77, 0x12, 0x0,  0x8,  0x1f, 0xd2, 0x17, 0xc6,
                   0x89, 0xd7, 0x31, 0x55, 0x80, 0x80, 0x1,  0x87, 0x0,  0x1,  0x83, 0x97, 0xa1, 0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26384);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], 0x97);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 24874 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Right QoS1,Right QoS2] [PropReasonString "'\230\146\SIyi",PropResponseTopic
// "\146\136+\205\205X\201\147\231oR\151\247\&1lr\ETX\r\128\fy\DELW%gt\245\144i",PropContentType
// "\240G\SOq\255\189`\SYN\NAK%\CAN\RS1\173\187\SI\232]~\208\149\ACK",PropWillDelayInterval 17058,PropMaximumPacketSize
// 12076,PropMaximumQoS 214,PropRequestProblemInformation 88,PropServerReference
// "\204\212~\218iJ\143\151\242",PropAuthenticationMethod "\238\232\NUL\167",PropContentType
// "\255Y\DC3n\144\t\DC4\183=<\149\157\192\158cx\221\224\DC4D\211s\131Mr"]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x87, 0x1,  0x61, 0x2a, 0x7f, 0x1f, 0x0,  0x6,  0x27, 0xe6, 0x92, 0xf,  0x79, 0x69, 0x8,
                   0x0,  0x1d, 0x92, 0x88, 0x2b, 0xcd, 0xcd, 0x58, 0xc9, 0x93, 0xe7, 0x6f, 0x52, 0x97, 0xf7, 0x31,
                   0x6c, 0x72, 0x3,  0xd,  0x80, 0xc,  0x79, 0x7f, 0x57, 0x25, 0x67, 0x74, 0xf5, 0x90, 0x69, 0x3,
                   0x0,  0x16, 0xf0, 0x47, 0xe,  0x71, 0xff, 0xbd, 0x60, 0x16, 0x15, 0x25, 0x18, 0x1e, 0x31, 0xad,
                   0xbb, 0xf,  0xe8, 0x5d, 0x7e, 0xd0, 0x95, 0x6,  0x18, 0x0,  0x0,  0x42, 0xa2, 0x27, 0x0,  0x0,
                   0x2f, 0x2c, 0x24, 0xd6, 0x17, 0x58, 0x1c, 0x0,  0x9,  0xcc, 0xd4, 0x7e, 0xda, 0x69, 0x4a, 0x8f,
                   0x97, 0xf2, 0x15, 0x0,  0x4,  0xee, 0xe8, 0x0,  0xa7, 0x3,  0x0,  0x19, 0xff, 0x59, 0x13, 0x6e,
                   0x90, 0x9,  0x14, 0xb7, 0x3d, 0x3c, 0x95, 0x9d, 0xc0, 0x9e, 0x63, 0x78, 0xdd, 0xe0, 0x14, 0x44,
                   0xd3, 0x73, 0x83, 0x4d, 0x72, 0x2,  0x9e, 0x83, 0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24874);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 25167 [Left SubErrQuotaExceeded] [PropTopicAliasMaximum 17510,PropContentType
// "\GS",PropServerKeepAlive 2458,PropRetainAvailable 194,PropSharedSubscriptionAvailable 100,PropAuthenticationData
// "\195\231\239\DC4x\255\224\156\154\194f\216D\136<\201\STX",PropRequestResponseInformation 52,PropWillDelayInterval
// 29739,PropContentType
// "l\152\190\DC1$\SYN\250]S\144\255\&1\220\252\EM\170\ACK\203K\153\209\162",PropSubscriptionIdentifierAvailable 85]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x48, 0x62, 0x4f, 0x44, 0x22, 0x44, 0x66, 0x3,  0x0,  0x1,  0x1d, 0x13, 0x9,  0x9a,
                   0x25, 0xc2, 0x2a, 0x64, 0x16, 0x0,  0x11, 0xc3, 0xe7, 0xef, 0x14, 0x78, 0xff, 0xe0, 0x9c,
                   0x9a, 0xc2, 0x66, 0xd8, 0x44, 0x88, 0x3c, 0xc9, 0x2,  0x19, 0x34, 0x18, 0x0,  0x0,  0x74,
                   0x2b, 0x3,  0x0,  0x16, 0x6c, 0x98, 0xbe, 0x11, 0x24, 0x16, 0xfa, 0x5d, 0x53, 0x90, 0xff,
                   0x31, 0xdc, 0xfc, 0x19, 0xaa, 0x6,  0xcb, 0x4b, 0x99, 0xd1, 0xa2, 0x29, 0x55, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25167);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
}

// SubscribeResponse 7252 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left SubErrUnspecifiedError,Right
// QoS2,Right QoS1,Right QoS2,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0] [PropCorrelationData
// "\RS\SOH\152",PropRequestResponseInformation 7,PropWildcardSubscriptionAvailable 140,PropMaximumQoS
// 147,PropResponseInformation "\240\142\150R\252\236",PropRetainAvailable 125,PropPayloadFormatIndicator
// 9,PropContentType "\153\183\255\fB\212\134\216\ESC%\SUB",PropRequestResponseInformation
// 50,PropSubscriptionIdentifierAvailable 11,PropWillDelayInterval 15604,PropRetainAvailable 244,PropContentType
// "\"\201k1\246/`P\182\193\255\RSMQ\253\140\150+$\152\229\215E\179\225\182'`\156",PropWildcardSubscriptionAvailable
// 107,PropAssignedClientIdentifier "\255MI~\200\141\&4E\200s",PropRequestResponseInformation
// 225,PropSubscriptionIdentifier 4]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0x71, 0x1c, 0x54, 0x65, 0x9,  0x0,  0x3,  0x1e, 0x1,  0x98, 0x19, 0x7,  0x28, 0x8c, 0x24, 0x93,
                   0x1a, 0x0,  0x6,  0xf0, 0x8e, 0x96, 0x52, 0xfc, 0xec, 0x25, 0x7d, 0x1,  0x9,  0x3,  0x0,  0xb,  0x99,
                   0xb7, 0xff, 0xc,  0x42, 0xd4, 0x86, 0xd8, 0x1b, 0x25, 0x1a, 0x19, 0x32, 0x29, 0xb,  0x18, 0x0,  0x0,
                   0x3c, 0xf4, 0x25, 0xf4, 0x3,  0x0,  0x1d, 0x22, 0xc9, 0x6b, 0x31, 0xf6, 0x2f, 0x60, 0x50, 0xb6, 0xc1,
                   0xff, 0x1e, 0x4d, 0x51, 0xfd, 0x8c, 0x96, 0x2b, 0x24, 0x98, 0xe5, 0xd7, 0x45, 0xb3, 0xe1, 0xb6, 0x27,
                   0x60, 0x9c, 0x28, 0x6b, 0x12, 0x0,  0xa,  0xff, 0x4d, 0x49, 0x7e, 0xc8, 0x8d, 0x34, 0x45, 0xc8, 0x73,
                   0x19, 0xe1, 0xb,  0x4,  0xa2, 0x0,  0x80, 0x2,  0x1,  0x2,  0x0,  0xa1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7252);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0xA1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 22592 [Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrPacketIdentifierInUse] [PropAssignedClientIdentifier
// "\171\205",PropWildcardSubscriptionAvailable 207,PropSharedSubscriptionAvailable 40,PropReceiveMaximum
// 8158,PropTopicAliasMaximum 20860,PropRequestProblemInformation 162,PropPayloadFormatIndicator
// 188,PropSessionExpiryInterval 7412,PropMaximumPacketSize 2196,PropTopicAliasMaximum 10660,PropServerReference
// "\t\203Q\139\155\157S\255\179\241=\\\v!\184\r\224\t\192\247\152\&5Nz\SYN",PropSubscriptionIdentifierAvailable
// 223,PropMessageExpiryInterval 27404,PropWillDelayInterval 21950,PropResponseInformation
// "]t\209\230\DC2\ENQ\248\SO\182\NAK\137i\147\149N`g'h\179\161\232\130|\177\225",PropMaximumQoS 165,PropUserProperty
// "\157U!\"" "\164\DLE>+S\153t\210\&6(\132z\172\175JJE\US\ETX\ETB\184_\157",PropCorrelationData
// "\222\DC4\SI\195\210\246\SYNkqz[\160\255p\152\DC3Jd,,q\148\DC2\DC32\\",PropResponseTopic
// "\188==l\255\182JXe\150\&9\192l",PropResponseInformation
// "\133\DC36E_\255\178.7\f\130\250\181\250\&1l\210\231\129;K?\170\NUL\r\vWW",PropAuthenticationData
// "^\192",PropRequestProblemInformation 202,PropSessionExpiryInterval 9944,PropUserProperty
// "\239\STX\135\176x+\241\158\&7" "\225"]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0xf7, 0x1,  0x58, 0x40, 0xee, 0x1,  0x12, 0x0,  0x2,  0xab, 0xcd, 0x28, 0xcf, 0x2a, 0x28, 0x21,
                   0x1f, 0xde, 0x22, 0x51, 0x7c, 0x17, 0xa2, 0x1,  0xbc, 0x11, 0x0,  0x0,  0x1c, 0xf4, 0x27, 0x0,  0x0,
                   0x8,  0x94, 0x22, 0x29, 0xa4, 0x1c, 0x0,  0x19, 0x9,  0xcb, 0x51, 0x8b, 0x9b, 0x9d, 0x53, 0xff, 0xb3,
                   0xf1, 0x3d, 0x5c, 0xb,  0x21, 0xb8, 0xd,  0xe0, 0x9,  0xc0, 0xf7, 0x98, 0x35, 0x4e, 0x7a, 0x16, 0x29,
                   0xdf, 0x2,  0x0,  0x0,  0x6b, 0xc,  0x18, 0x0,  0x0,  0x55, 0xbe, 0x1a, 0x0,  0x1a, 0x5d, 0x74, 0xd1,
                   0xe6, 0x12, 0x5,  0xf8, 0xe,  0xb6, 0x15, 0x89, 0x69, 0x93, 0x95, 0x4e, 0x60, 0x67, 0x27, 0x68, 0xb3,
                   0xa1, 0xe8, 0x82, 0x7c, 0xb1, 0xe1, 0x24, 0xa5, 0x26, 0x0,  0x4,  0x9d, 0x55, 0x21, 0x22, 0x0,  0x17,
                   0xa4, 0x10, 0x3e, 0x2b, 0x53, 0x99, 0x74, 0xd2, 0x36, 0x28, 0x84, 0x7a, 0xac, 0xaf, 0x4a, 0x4a, 0x45,
                   0x1f, 0x3,  0x17, 0xb8, 0x5f, 0x9d, 0x9,  0x0,  0x1a, 0xde, 0x14, 0xf,  0xc3, 0xd2, 0xf6, 0x16, 0x6b,
                   0x71, 0x7a, 0x5b, 0xa0, 0xff, 0x70, 0x98, 0x13, 0x4a, 0x64, 0x2c, 0x2c, 0x71, 0x94, 0x12, 0x13, 0x32,
                   0x5c, 0x8,  0x0,  0xd,  0xbc, 0x3d, 0x3d, 0x6c, 0xff, 0xb6, 0x4a, 0x58, 0x65, 0x96, 0x39, 0xc0, 0x6c,
                   0x1a, 0x0,  0x1c, 0x85, 0x13, 0x36, 0x45, 0x5f, 0xff, 0xb2, 0x2e, 0x37, 0xc,  0x82, 0xfa, 0xb5, 0xfa,
                   0x31, 0x6c, 0xd2, 0xe7, 0x81, 0x3b, 0x4b, 0x3f, 0xaa, 0x0,  0xd,  0xb,  0x57, 0x57, 0x16, 0x0,  0x2,
                   0x5e, 0xc0, 0x17, 0xca, 0x11, 0x0,  0x0,  0x26, 0xd8, 0x26, 0x0,  0x9,  0xef, 0x2,  0x87, 0xb0, 0x78,
                   0x2b, 0xf1, 0x9e, 0x37, 0x0,  0x1,  0xe1, 0x80, 0x2,  0x0,  0xa1, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22592);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
}

// SubscribeResponse 1930 [Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right QoS2,Left SubErrQuotaExceeded,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrTopicFilterInvalid,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Left SubErrUnspecifiedError] [PropPayloadFormatIndicator 152,PropMessageExpiryInterval
// 4959,PropUserProperty "7\201b]v\237"
// "\SOH\159\194\223\SUBL\240\232\234\b\227\193\176y\216\&4\222\235\&7\141\163U",PropCorrelationData
// "\176\167l\148\185\207\204\165R\SI\145Q\DC3I\242\210F\216\160X;",PropSharedSubscriptionAvailable
// 200,PropAuthenticationMethod "\238\154D\219\219\&6\231\222\231\RS\212\180\SOH\155\ACK"]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x62, 0x7,  0x8a, 0x54, 0x1,  0x98, 0x2,  0x0,  0x0,  0x13, 0x5f, 0x26, 0x0,  0x6,  0x37, 0xc9,
                   0x62, 0x5d, 0x76, 0xed, 0x0,  0x16, 0x1,  0x9f, 0xc2, 0xdf, 0x1a, 0x4c, 0xf0, 0xe8, 0xea, 0x8,  0xe3,
                   0xc1, 0xb0, 0x79, 0xd8, 0x34, 0xde, 0xeb, 0x37, 0x8d, 0xa3, 0x55, 0x9,  0x0,  0x15, 0xb0, 0xa7, 0x6c,
                   0x94, 0xb9, 0xcf, 0xcc, 0xa5, 0x52, 0xf,  0x91, 0x51, 0x13, 0x49, 0xf2, 0xd2, 0x46, 0xd8, 0xa0, 0x58,
                   0x3b, 0x2a, 0xc8, 0x15, 0x0,  0xf,  0xee, 0x9a, 0x44, 0xdb, 0xdb, 0x36, 0xe7, 0xde, 0xe7, 0x1e, 0xd4,
                   0xb4, 0x1,  0x9b, 0x6,  0xa2, 0xa2, 0x0,  0x2,  0x97, 0x1,  0xa1, 0x8f, 0x8f, 0x8f, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1930);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0xA1);
  EXPECT_EQ(granted_qos_levels[7], 0x8F);
  EXPECT_EQ(granted_qos_levels[8], 0x8F);
  EXPECT_EQ(granted_qos_levels[9], 0x8F);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 32288 [Right QoS1,Right QoS0,Right QoS1,Right QoS2,Left SubErrImplementationSpecificError,Right
// QoS1,Left SubErrQuotaExceeded,Right QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrUnspecifiedError]
// [PropServerKeepAlive 23284,PropAssignedClientIdentifier
// "\190\249\154$@\SO\248G\209e\238:`O\254\242\151<\223",PropUserProperty
// "\ESCS\146a\EOT\245+\162\142\DEL\173\168\f\208C\200;\212\211,\253\238\154!\187\219\182o\130"
// "\235\157\162\209\247>c\EM\186O\NUL\150\220\EOTN\185",PropTopicAliasMaximum 30054,PropMaximumPacketSize
// 1391,PropSessionExpiryInterval 20428,PropSessionExpiryInterval 30001]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x6b, 0x7e, 0x20, 0x5d, 0x13, 0x5a, 0xf4, 0x12, 0x0,  0x13, 0xbe, 0xf9, 0x9a, 0x24, 0x40,
                   0xe,  0xf8, 0x47, 0xd1, 0x65, 0xee, 0x3a, 0x60, 0x4f, 0xfe, 0xf2, 0x97, 0x3c, 0xdf, 0x26, 0x0,
                   0x1d, 0x1b, 0x53, 0x92, 0x61, 0x4,  0xf5, 0x2b, 0xa2, 0x8e, 0x7f, 0xad, 0xa8, 0xc,  0xd0, 0x43,
                   0xc8, 0x3b, 0xd4, 0xd3, 0x2c, 0xfd, 0xee, 0x9a, 0x21, 0xbb, 0xdb, 0xb6, 0x6f, 0x82, 0x0,  0x10,
                   0xeb, 0x9d, 0xa2, 0xd1, 0xf7, 0x3e, 0x63, 0x19, 0xba, 0x4f, 0x0,  0x96, 0xdc, 0x4,  0x4e, 0xb9,
                   0x22, 0x75, 0x66, 0x27, 0x0,  0x0,  0x5,  0x6f, 0x11, 0x0,  0x0,  0x4f, 0xcc, 0x11, 0x0,  0x0,
                   0x75, 0x31, 0x1,  0x0,  0x1,  0x2,  0x83, 0x1,  0x97, 0x1,  0x91, 0x2,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32288);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x97);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x91);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 8665 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrQuotaExceeded,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS2,Right QoS2] [PropSharedSubscriptionAvailable
// 207,PropAssignedClientIdentifier
// "\249@q\US:\253\n\219\187\170X\168\DLE\154O@\DC4\186\255",PropRequestProblemInformation
// 174,PropRequestResponseInformation 157,PropRetainAvailable 88,PropWillDelayInterval
// 21067,PropSharedSubscriptionAvailable 113,PropResponseTopic "\207",PropWildcardSubscriptionAvailable
// 132,PropResponseInformation "\204$\250*\ACKiR",PropServerReference
// "\221\197\211\233G\GS\191_9i-\168\133f^)C\b",PropUserProperty "\199\143"
// "#N\192\243.R\244\DELT\191|\235,",PropMessageExpiryInterval 24446,PropTopicAliasMaximum
// 3665,PropSharedSubscriptionAvailable 102,PropReasonString
// "JG\149N\147\STXc|\191\210Z\156\246\249\128\252r",PropAssignedClientIdentifier
// "\236q\131\203\r\EM\ENQ!s)\201\245\176Q\185\133\243\145\143",PropWillDelayInterval 12649,PropServerReference ""]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0xa5, 0x1,  0x21, 0xd9, 0x9a, 0x1,  0x2a, 0xcf, 0x12, 0x0,  0x13, 0xf9, 0x40, 0x71, 0x1f, 0x3a,
                   0xfd, 0xa,  0xdb, 0xbb, 0xaa, 0x58, 0xa8, 0x10, 0x9a, 0x4f, 0x40, 0x14, 0xba, 0xff, 0x17, 0xae, 0x19,
                   0x9d, 0x25, 0x58, 0x18, 0x0,  0x0,  0x52, 0x4b, 0x2a, 0x71, 0x8,  0x0,  0x1,  0xcf, 0x28, 0x84, 0x1a,
                   0x0,  0x7,  0xcc, 0x24, 0xfa, 0x2a, 0x6,  0x69, 0x52, 0x1c, 0x0,  0x12, 0xdd, 0xc5, 0xd3, 0xe9, 0x47,
                   0x1d, 0xbf, 0x5f, 0x39, 0x69, 0x2d, 0xa8, 0x85, 0x66, 0x5e, 0x29, 0x43, 0x8,  0x26, 0x0,  0x2,  0xc7,
                   0x8f, 0x0,  0xd,  0x23, 0x4e, 0xc0, 0xf3, 0x2e, 0x52, 0xf4, 0x7f, 0x54, 0xbf, 0x7c, 0xeb, 0x2c, 0x2,
                   0x0,  0x0,  0x5f, 0x7e, 0x22, 0xe,  0x51, 0x2a, 0x66, 0x1f, 0x0,  0x11, 0x4a, 0x47, 0x95, 0x4e, 0x93,
                   0x2,  0x63, 0x7c, 0xbf, 0xd2, 0x5a, 0x9c, 0xf6, 0xf9, 0x80, 0xfc, 0x72, 0x12, 0x0,  0x13, 0xec, 0x71,
                   0x83, 0xcb, 0xd,  0x19, 0x5,  0x21, 0x73, 0x29, 0xc9, 0xf5, 0xb0, 0x51, 0xb9, 0x85, 0xf3, 0x91, 0x8f,
                   0x18, 0x0,  0x0,  0x31, 0x69, 0x1c, 0x0,  0x0,  0x9e, 0x80, 0x97, 0x2,  0x8f, 0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8665);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x8F);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 32158 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported] [PropAssignedClientIdentifier
// "\181\252\207\137\ETBo\129\ESC1\139\131\n3P\230D",PropSubscriptionIdentifierAvailable 255,PropMessageExpiryInterval
// 10411,PropSubscriptionIdentifierAvailable 213,PropCorrelationData
// "\NAK\222\151\139\218l\216\150\245\132g\194cT\186\242d\STX\159:i\132\FS/J\SUBm",PropUserProperty
// "\158\230Q\241b2x0\186\132NB4X\129D\129\128PQ\139\STX\230\203\&8`" "\156",PropRetainAvailable 197,PropRetainAvailable
// 24,PropMessageExpiryInterval 18114,PropContentType "|\239\150\EM\NAK[\220\129o\151\128",PropTopicAliasMaximum
// 18832,PropAuthenticationData
// "\219\SYN\CAN\227\249S\DEL\CAN/\129\ETB\240X\213Sub\176%!\SYN\135*\EM\NAK$",PropSubscriptionIdentifierAvailable
// 236,PropContentType "'\227\STXp`\174\DEL",PropContentType "\EOT\222\FS0\177\218",PropAuthenticationMethod
// "\168\251\181s\167j\SUB\SI} \ENQv\187Oi\US\233\ENQ\213\157x\232\208j/a\132\237M\a",PropAuthenticationMethod
// "a(\145",PropTopicAliasMaximum 7553,PropCorrelationData "",PropWillDelayInterval 5167,PropReasonString
// "",PropReceiveMaximum 15579,PropAssignedClientIdentifier "\ACK.\173",PropServerReference
// "\136\202\179@\163\228\215\&5:I\201\180\221\186\161Tw\130\154\174A\212",PropAssignedClientIdentifier
// "\211s18",PropTopicAliasMaximum 5758,PropServerKeepAlive 16122]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x90, 0x91, 0x2,  0x7d, 0x9e, 0x8a, 0x2,  0x12, 0x0,  0x10, 0xb5, 0xfc, 0xcf, 0x89, 0x17, 0x6f, 0x81, 0x1b, 0x31,
      0x8b, 0x83, 0xa,  0x33, 0x50, 0xe6, 0x44, 0x29, 0xff, 0x2,  0x0,  0x0,  0x28, 0xab, 0x29, 0xd5, 0x9,  0x0,  0x1b,
      0x15, 0xde, 0x97, 0x8b, 0xda, 0x6c, 0xd8, 0x96, 0xf5, 0x84, 0x67, 0xc2, 0x63, 0x54, 0xba, 0xf2, 0x64, 0x2,  0x9f,
      0x3a, 0x69, 0x84, 0x1c, 0x2f, 0x4a, 0x1a, 0x6d, 0x26, 0x0,  0x1a, 0x9e, 0xe6, 0x51, 0xf1, 0x62, 0x32, 0x78, 0x30,
      0xba, 0x84, 0x4e, 0x42, 0x34, 0x58, 0x81, 0x44, 0x81, 0x80, 0x50, 0x51, 0x8b, 0x2,  0xe6, 0xcb, 0x38, 0x60, 0x0,
      0x1,  0x9c, 0x25, 0xc5, 0x25, 0x18, 0x2,  0x0,  0x0,  0x46, 0xc2, 0x3,  0x0,  0xb,  0x7c, 0xef, 0x96, 0x19, 0x15,
      0x5b, 0xdc, 0x81, 0x6f, 0x97, 0x80, 0x22, 0x49, 0x90, 0x16, 0x0,  0x1a, 0xdb, 0x16, 0x18, 0xe3, 0xf9, 0x53, 0x7f,
      0x18, 0x2f, 0x81, 0x17, 0xf0, 0x58, 0xd5, 0x53, 0x75, 0x62, 0xb0, 0x25, 0x21, 0x16, 0x87, 0x2a, 0x19, 0x15, 0x24,
      0x29, 0xec, 0x3,  0x0,  0x7,  0x27, 0xe3, 0x2,  0x70, 0x60, 0xae, 0x7f, 0x3,  0x0,  0x6,  0x4,  0xde, 0x1c, 0x30,
      0xb1, 0xda, 0x15, 0x0,  0x1e, 0xa8, 0xfb, 0xb5, 0x73, 0xa7, 0x6a, 0x1a, 0xf,  0x7d, 0x20, 0x5,  0x76, 0xbb, 0x4f,
      0x69, 0x1f, 0xe9, 0x5,  0xd5, 0x9d, 0x78, 0xe8, 0xd0, 0x6a, 0x2f, 0x61, 0x84, 0xed, 0x4d, 0x7,  0x15, 0x0,  0x3,
      0x61, 0x28, 0x91, 0x22, 0x1d, 0x81, 0x9,  0x0,  0x0,  0x18, 0x0,  0x0,  0x14, 0x2f, 0x1f, 0x0,  0x0,  0x21, 0x3c,
      0xdb, 0x12, 0x0,  0x3,  0x6,  0x2e, 0xad, 0x1c, 0x0,  0x16, 0x88, 0xca, 0xb3, 0x40, 0xa3, 0xe4, 0xd7, 0x35, 0x3a,
      0x49, 0xc9, 0xb4, 0xdd, 0xba, 0xa1, 0x54, 0x77, 0x82, 0x9a, 0xae, 0x41, 0xd4, 0x12, 0x0,  0x4,  0xd3, 0x73, 0x31,
      0x38, 0x22, 0x16, 0x7e, 0x13, 0x3e, 0xfa, 0xa2, 0x0,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32158);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
}

// SubscribeResponse 9271 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS2,Right QoS0,Left
// SubErrQuotaExceeded,Right QoS0,Right QoS2] [PropReasonString
// "1\202]\141\169\238\189\178TQ\252\STX\172\201\151\132\237\250\158\229x",PropServerReference "\136\148
// m\248\DC1W/O",PropRequestResponseInformation 28,PropSubscriptionIdentifier 25,PropWillDelayInterval
// 22265,PropWildcardSubscriptionAvailable 195,PropTopicAlias 18986,PropMaximumPacketSize
// 19940,PropSubscriptionIdentifier 11,PropMessageExpiryInterval 22097]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x48, 0x24, 0x37, 0x3e, 0x1f, 0x0,  0x15, 0x31, 0xca, 0x5d, 0x8d, 0xa9, 0xee, 0xbd,
                   0xb2, 0x54, 0x51, 0xfc, 0x2,  0xac, 0xc9, 0x97, 0x84, 0xed, 0xfa, 0x9e, 0xe5, 0x78, 0x1c,
                   0x0,  0x9,  0x88, 0x94, 0x20, 0x6d, 0xf8, 0x11, 0x57, 0x2f, 0x4f, 0x19, 0x1c, 0xb,  0x19,
                   0x18, 0x0,  0x0,  0x56, 0xf9, 0x28, 0xc3, 0x23, 0x4a, 0x2a, 0x27, 0x0,  0x0,  0x4d, 0xe4,
                   0xb,  0xb,  0x2,  0x0,  0x0,  0x56, 0x51, 0xa1, 0x1,  0x2,  0x0,  0x97, 0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9271);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 4115 [Left SubErrUnspecifiedError,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrNotAuthorized,Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError] [PropTopicAlias
// 1711,PropReasonString "PZ\t<\222{\r\162",PropResponseTopic "a\129*\198\DEL\n",PropMessageExpiryInterval
// 23699,PropSharedSubscriptionAvailable 220]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x26, 0x10, 0x13, 0x1e, 0x23, 0x6,  0xaf, 0x1f, 0x0,  0x8,  0x50, 0x5a, 0x9,
                   0x3c, 0xde, 0x7b, 0xd,  0xa2, 0x8,  0x0,  0x6,  0x61, 0x81, 0x2a, 0xc6, 0x7f, 0xa,
                   0x2,  0x0,  0x0,  0x5c, 0x93, 0x2a, 0xdc, 0x80, 0x9e, 0x87, 0x9e, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4115);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 24961 [Right QoS2,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Left SubErrTopicFilterInvalid,Left
// SubErrQuotaExceeded,Right QoS0,Left SubErrQuotaExceeded,Right QoS2,Right QoS0] [PropServerReference
// "\nClt\172\176z6d\NUL\137\203\212\162QA\155\142\180p<\254\SI_qm",PropSubscriptionIdentifier
// 8,PropAssignedClientIdentifier "P\ETXqo\254\157\150\203Eu\226\141X\233\DEL\218Y\197`\NUL\b\152\134\SOHz\r"]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x49, 0x61, 0x81, 0x3c, 0x1c, 0x0,  0x1a, 0xa,  0x43, 0x6c, 0x74, 0xac, 0xb0, 0x7a,
                   0x36, 0x64, 0x0,  0x89, 0xcb, 0xd4, 0xa2, 0x51, 0x41, 0x9b, 0x8e, 0xb4, 0x70, 0x3c, 0xfe,
                   0xf,  0x5f, 0x71, 0x6d, 0xb,  0x8,  0x12, 0x0,  0x1a, 0x50, 0x3,  0x71, 0x6f, 0xfe, 0x9d,
                   0x96, 0xcb, 0x45, 0x75, 0xe2, 0x8d, 0x58, 0xe9, 0x7f, 0xda, 0x59, 0xc5, 0x60, 0x0,  0x8,
                   0x98, 0x86, 0x1,  0x7a, 0xd,  0x2,  0x0,  0x97, 0x0,  0x8f, 0x97, 0x0,  0x97, 0x2,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24961);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x8F);
  EXPECT_EQ(granted_qos_levels[5], 0x97);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x97);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 18340 [Right QoS2,Left SubErrTopicFilterInvalid,Right QoS1,Left SubErrImplementationSpecificError]
// [PropAuthenticationData
// "\206}\GS?\245\240\GS\212\ENQ\200\252+\231D\DC1\224\&6\248\DC3\145\181\202\169\207\250-",PropSessionExpiryInterval
// 2333,PropResponseTopic "Fj8\221\177O=o_\158\t\175\230\NUL",PropMaximumPacketSize 5429,PropAuthenticationMethod
// "\139\221\DC1\253z\146\EMZf\SI\213\&7*4\174\254\RS \SYN7\226\163\179\SOH\206B\NUL",PropRequestProblemInformation
// 54,PropAuthenticationData "n\242Y\240Q\CAN\205\&5+*\197\231$\169\179\US{M\171\187",PropTopicAliasMaximum
// 31685,PropSharedSubscriptionAvailable 54,PropMessageExpiryInterval 30661]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x80, 0x1,  0x47, 0xa4, 0x79, 0x16, 0x0,  0x1a, 0xce, 0x7d, 0x1d, 0x3f, 0xf5, 0xf0, 0x1d, 0xd4,
                   0x5,  0xc8, 0xfc, 0x2b, 0xe7, 0x44, 0x11, 0xe0, 0x36, 0xf8, 0x13, 0x91, 0xb5, 0xca, 0xa9, 0xcf, 0xfa,
                   0x2d, 0x11, 0x0,  0x0,  0x9,  0x1d, 0x8,  0x0,  0xe,  0x46, 0x6a, 0x38, 0xdd, 0xb1, 0x4f, 0x3d, 0x6f,
                   0x5f, 0x9e, 0x9,  0xaf, 0xe6, 0x0,  0x27, 0x0,  0x0,  0x15, 0x35, 0x15, 0x0,  0x1b, 0x8b, 0xdd, 0x11,
                   0xfd, 0x7a, 0x92, 0x19, 0x5a, 0x66, 0xf,  0xd5, 0x37, 0x2a, 0x34, 0xae, 0xfe, 0x1e, 0x20, 0x16, 0x37,
                   0xe2, 0xa3, 0xb3, 0x1,  0xce, 0x42, 0x0,  0x17, 0x36, 0x16, 0x0,  0x14, 0x6e, 0xf2, 0x59, 0xf0, 0x51,
                   0x18, 0xcd, 0x35, 0x2b, 0x2a, 0xc5, 0xe7, 0x24, 0xa9, 0xb3, 0x1f, 0x7b, 0x4d, 0xab, 0xbb, 0x22, 0x7b,
                   0xc5, 0x2a, 0x36, 0x2,  0x0,  0x0,  0x77, 0xc5, 0x2,  0x8f, 0x1,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18340);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
}

// SubscribeResponse 8517 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS0]
// [PropServerReference "\164\213\242\159g\236h\176\&9x\EOTT%V\153\229\"w\234\184\182\236",PropSessionExpiryInterval
// 16327,PropServerReference "\200^\129",PropTopicAliasMaximum 11537,PropSubscriptionIdentifierAvailable
// 214,PropReasonString "A\216Y\246\141\163\189)\136\&2\237t\128\176%\SIB&",PropReceiveMaximum
// 16877,PropWillDelayInterval 22070,PropUserProperty
// "\227\f\224k\f\212\251\ENQ\221\172\az\210v]P\RS\DLE|\204\185\253e\130r\214\197\175=7"
// "5\ACK\214\194\&1\211'\238bA\USs\177\STX",PropAssignedClientIdentifier
// "\ETB\225[X#\SO\182,\234\214\203N\SOH\242\202\ETB\178\161\143\148\165\&0*\v\162L\174\242\fM",PropSharedSubscriptionAvailable
// 209,PropMessageExpiryInterval 26844,PropReceiveMaximum 13624,PropResponseTopic "\144",PropAuthenticationData
// ",\DC2\164\176\SI\ETB\"w\237_1\192\174",PropMaximumQoS 183,PropRequestResponseInformation 146,PropAuthenticationData
// "\186U\227f\140\f\136s\160\191\239\DC2M)D\DC1\196\\{5\176\151\189\SOH\241\DEL\128",PropRetainAvailable
// 246,PropMessageExpiryInterval 15562,PropContentType
// "\213P\201G\210\239\216\223\223\238\&7\203\215P\145a\229\157\DC2\156\DC1",PropPayloadFormatIndicator
// 118,PropAssignedClientIdentifier "",PropRequestProblemInformation 202,PropWillDelayInterval 30258]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x8d, 0x2,  0x21, 0x45, 0x83, 0x2,  0x1c, 0x0,  0x16, 0xa4, 0xd5, 0xf2, 0x9f, 0x67, 0xec, 0x68,
                   0xb0, 0x39, 0x78, 0x4,  0x54, 0x25, 0x56, 0x99, 0xe5, 0x22, 0x77, 0xea, 0xb8, 0xb6, 0xec, 0x11, 0x0,
                   0x0,  0x3f, 0xc7, 0x1c, 0x0,  0x3,  0xc8, 0x5e, 0x81, 0x22, 0x2d, 0x11, 0x29, 0xd6, 0x1f, 0x0,  0x12,
                   0x41, 0xd8, 0x59, 0xf6, 0x8d, 0xa3, 0xbd, 0x29, 0x88, 0x32, 0xed, 0x74, 0x80, 0xb0, 0x25, 0xf,  0x42,
                   0x26, 0x21, 0x41, 0xed, 0x18, 0x0,  0x0,  0x56, 0x36, 0x26, 0x0,  0x1e, 0xe3, 0xc,  0xe0, 0x6b, 0xc,
                   0xd4, 0xfb, 0x5,  0xdd, 0xac, 0x7,  0x7a, 0xd2, 0x76, 0x5d, 0x50, 0x1e, 0x10, 0x7c, 0xcc, 0xb9, 0xfd,
                   0x65, 0x82, 0x72, 0xd6, 0xc5, 0xaf, 0x3d, 0x37, 0x0,  0xe,  0x35, 0x6,  0xd6, 0xc2, 0x31, 0xd3, 0x27,
                   0xee, 0x62, 0x41, 0x1f, 0x73, 0xb1, 0x2,  0x12, 0x0,  0x1e, 0x17, 0xe1, 0x5b, 0x58, 0x23, 0xe,  0xb6,
                   0x2c, 0xea, 0xd6, 0xcb, 0x4e, 0x1,  0xf2, 0xca, 0x17, 0xb2, 0xa1, 0x8f, 0x94, 0xa5, 0x30, 0x2a, 0xb,
                   0xa2, 0x4c, 0xae, 0xf2, 0xc,  0x4d, 0x2a, 0xd1, 0x2,  0x0,  0x0,  0x68, 0xdc, 0x21, 0x35, 0x38, 0x8,
                   0x0,  0x1,  0x90, 0x16, 0x0,  0xd,  0x2c, 0x12, 0xa4, 0xb0, 0xf,  0x17, 0x22, 0x77, 0xed, 0x5f, 0x31,
                   0xc0, 0xae, 0x24, 0xb7, 0x19, 0x92, 0x16, 0x0,  0x1b, 0xba, 0x55, 0xe3, 0x66, 0x8c, 0xc,  0x88, 0x73,
                   0xa0, 0xbf, 0xef, 0x12, 0x4d, 0x29, 0x44, 0x11, 0xc4, 0x5c, 0x7b, 0x35, 0xb0, 0x97, 0xbd, 0x1,  0xf1,
                   0x7f, 0x80, 0x25, 0xf6, 0x2,  0x0,  0x0,  0x3c, 0xca, 0x3,  0x0,  0x15, 0xd5, 0x50, 0xc9, 0x47, 0xd2,
                   0xef, 0xd8, 0xdf, 0xdf, 0xee, 0x37, 0xcb, 0xd7, 0x50, 0x91, 0x61, 0xe5, 0x9d, 0x12, 0x9c, 0x11, 0x1,
                   0x76, 0x12, 0x0,  0x0,  0x17, 0xca, 0x18, 0x0,  0x0,  0x76, 0x32, 0x9e, 0x0,  0xa1, 0xa2, 0x2,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8517);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
}

// SubscribeResponse 31168 [Right QoS2,Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrNotAuthorized,Right QoS0,Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left
// SubErrPacketIdentifierInUse,Left SubErrNotAuthorized] [PropSubscriptionIdentifierAvailable 144,PropUserProperty
// "\169r\208\173G\SOH\223\RS\220\129\249\198p2M\251w\151;Y\218\235\145\253Y\165n\242"
// "\ACK\196\134=\SI\145\227\EOTe\183\195\218\147\237",PropMessageExpiryInterval 21387,PropAssignedClientIdentifier
// "\146\201\243t\165\179\220\ENQ\138B\217d\132\rj\CAN\144"]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x56, 0x79, 0xc0, 0x4a, 0x29, 0x90, 0x26, 0x0,  0x1c, 0xa9, 0x72, 0xd0, 0xad, 0x47,
                   0x1,  0xdf, 0x1e, 0xdc, 0x81, 0xf9, 0xc6, 0x70, 0x32, 0x4d, 0xfb, 0x77, 0x97, 0x3b, 0x59,
                   0xda, 0xeb, 0x91, 0xfd, 0x59, 0xa5, 0x6e, 0xf2, 0x0,  0xe,  0x6,  0xc4, 0x86, 0x3d, 0xf,
                   0x91, 0xe3, 0x4,  0x65, 0xb7, 0xc3, 0xda, 0x93, 0xed, 0x2,  0x0,  0x0,  0x53, 0x8b, 0x12,
                   0x0,  0x11, 0x92, 0xc9, 0xf3, 0x74, 0xa5, 0xb3, 0xdc, 0x5,  0x8a, 0x42, 0xd9, 0x64, 0x84,
                   0xd,  0x6a, 0x18, 0x90, 0x2,  0x8f, 0xa1, 0x87, 0x0,  0x9e, 0x1,  0x91, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31168);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x9E);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x91);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
}

// SubscribeResponse 6558 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left
// SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Right
// QoS1,Left SubErrTopicFilterInvalid] [PropServerReference "",PropSubscriptionIdentifierAvailable
// 103,PropReceiveMaximum 28000,PropMessageExpiryInterval 22245,PropServerReference
// "\DC4\229\&0\DC2\147\DC3\237\213\155\SUB\193\US\\\221\178H\243\STX\238\128S\207o\141",PropMessageExpiryInterval
// 12590,PropSessionExpiryInterval 2530,PropCorrelationData
// "7\211h\190\&6\237\163\131\128j\233\226\a\173`\254`e\151\rm*\222=\248\159",PropPayloadFormatIndicator
// 19,PropReasonString "\150\f\186P!~V\SOH\179\210\DC2L/\247\STX\190 1\SUB5l\173",PropMessageExpiryInterval
// 3585,PropSessionExpiryInterval 9887,PropRetainAvailable 104,PropSubscriptionIdentifierAvailable
// 50,PropSubscriptionIdentifierAvailable 222,PropAssignedClientIdentifier
// "F\227\DLE\165\228\199dI\210\SUB\DC3\215E\139",PropAuthenticationData "|\207N\146A",PropTopicAlias
// 32016,PropTopicAliasMaximum 26219]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0xa4, 0x1,  0x19, 0x9e, 0x99, 0x1,  0x1c, 0x0,  0x0,  0x29, 0x67, 0x21, 0x6d, 0x60, 0x2,  0x0,
                   0x0,  0x56, 0xe5, 0x1c, 0x0,  0x18, 0x14, 0xe5, 0x30, 0x12, 0x93, 0x13, 0xed, 0xd5, 0x9b, 0x1a, 0xc1,
                   0x1f, 0x5c, 0xdd, 0xb2, 0x48, 0xf3, 0x2,  0xee, 0x80, 0x53, 0xcf, 0x6f, 0x8d, 0x2,  0x0,  0x0,  0x31,
                   0x2e, 0x11, 0x0,  0x0,  0x9,  0xe2, 0x9,  0x0,  0x1a, 0x37, 0xd3, 0x68, 0xbe, 0x36, 0xed, 0xa3, 0x83,
                   0x80, 0x6a, 0xe9, 0xe2, 0x7,  0xad, 0x60, 0xfe, 0x60, 0x65, 0x97, 0xd,  0x6d, 0x2a, 0xde, 0x3d, 0xf8,
                   0x9f, 0x1,  0x13, 0x1f, 0x0,  0x16, 0x96, 0xc,  0xba, 0x50, 0x21, 0x7e, 0x56, 0x1,  0xb3, 0xd2, 0x12,
                   0x4c, 0x2f, 0xf7, 0x2,  0xbe, 0x20, 0x31, 0x1a, 0x35, 0x6c, 0xad, 0x2,  0x0,  0x0,  0xe,  0x1,  0x11,
                   0x0,  0x0,  0x26, 0x9f, 0x25, 0x68, 0x29, 0x32, 0x29, 0xde, 0x12, 0x0,  0xe,  0x46, 0xe3, 0x10, 0xa5,
                   0xe4, 0xc7, 0x64, 0x49, 0xd2, 0x1a, 0x13, 0xd7, 0x45, 0x8b, 0x16, 0x0,  0x5,  0x7c, 0xcf, 0x4e, 0x92,
                   0x41, 0x23, 0x7d, 0x10, 0x22, 0x66, 0x6b, 0x9e, 0x0,  0x83, 0x83, 0x83, 0x1,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6558);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
}

// SubscribeResponse 25528 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrImplementationSpecificError,Right QoS2] [PropMessageExpiryInterval
// 30797,PropRetainAvailable 33,PropServerKeepAlive 21346,PropUserProperty "G\145\253\\M\131\224"
// "U",PropSubscriptionIdentifierAvailable 177]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x21, 0x63, 0xb8, 0x19, 0x2,  0x0,  0x0,  0x78, 0x4d, 0x25, 0x21,
                   0x13, 0x53, 0x62, 0x26, 0x0,  0x7,  0x47, 0x91, 0xfd, 0x5c, 0x4d, 0x83,
                   0xe0, 0x0,  0x1,  0x55, 0x29, 0xb1, 0x9e, 0x80, 0x80, 0x83, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25528);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 29497 [Right QoS2,Right QoS2,Right QoS2,Right QoS1,Right QoS2,Left SubErrPacketIdentifierInUse]
// [PropResponseTopic "\142\214",PropWildcardSubscriptionAvailable 159,PropServerKeepAlive 3120,PropResponseInformation
// "\196\181[.\250\238^\FS\197\218\DC38\202}h\136\fI\200&\209\192K\ENQ\253",PropRetainAvailable 200,PropRetainAvailable
// 136,PropTopicAliasMaximum 29048,PropRequestProblemInformation 129,PropUserProperty
// "2\230\CAN\157y\DC1w\130\179\189`\186Mz\SUBlK\237s\167. 4\168\ESC\205"
// "\207\129\251\149+\EOT\191\136",PropMaximumPacketSize 10414,PropReceiveMaximum 26546,PropRequestResponseInformation
// 24,PropResponseTopic "h\210\DEL\207m\156\151\219\136\231\157",PropAssignedClientIdentifier
// "t^$\170\239\&7\220S\133t\ACK",PropRequestResponseInformation 37,PropTopicAlias 26638,PropAuthenticationData
// "\244L?\243\SIr\RS~\136\a\196\207*\242\245\168U\161\222\167\131:M",PropAuthenticationMethod
// "UU\ESC\148\195\220\138\NAKS\207\140-\ENQ\228\137<\243\216\GS\164,\ENQ4\188\141\133",PropServerReference
// "\225\212\199\164\210\214\174\255\169",PropWillDelayInterval 4639,PropRequestProblemInformation 4,PropReasonString
// "?M\NAK>\DLE%\181j\SUB\US#\157\ETX\182\RSym\147\155\217\176\152\145)} \CANI",PropRequestProblemInformation 48]
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0xf6, 0x1,  0x73, 0x39, 0xec, 0x1,  0x8,  0x0,  0x2,  0x8e, 0xd6, 0x28, 0x9f, 0x13, 0xc,  0x30,
                   0x1a, 0x0,  0x19, 0xc4, 0xb5, 0x5b, 0x2e, 0xfa, 0xee, 0x5e, 0x1c, 0xc5, 0xda, 0x13, 0x38, 0xca, 0x7d,
                   0x68, 0x88, 0xc,  0x49, 0xc8, 0x26, 0xd1, 0xc0, 0x4b, 0x5,  0xfd, 0x25, 0xc8, 0x25, 0x88, 0x22, 0x71,
                   0x78, 0x17, 0x81, 0x26, 0x0,  0x1a, 0x32, 0xe6, 0x18, 0x9d, 0x79, 0x11, 0x77, 0x82, 0xb3, 0xbd, 0x60,
                   0xba, 0x4d, 0x7a, 0x1a, 0x6c, 0x4b, 0xed, 0x73, 0xa7, 0x2e, 0x20, 0x34, 0xa8, 0x1b, 0xcd, 0x0,  0x8,
                   0xcf, 0x81, 0xfb, 0x95, 0x2b, 0x4,  0xbf, 0x88, 0x27, 0x0,  0x0,  0x28, 0xae, 0x21, 0x67, 0xb2, 0x19,
                   0x18, 0x8,  0x0,  0xb,  0x68, 0xd2, 0x7f, 0xcf, 0x6d, 0x9c, 0x97, 0xdb, 0x88, 0xe7, 0x9d, 0x12, 0x0,
                   0xb,  0x74, 0x5e, 0x24, 0xaa, 0xef, 0x37, 0xdc, 0x53, 0x85, 0x74, 0x6,  0x19, 0x25, 0x23, 0x68, 0xe,
                   0x16, 0x0,  0x17, 0xf4, 0x4c, 0x3f, 0xf3, 0xf,  0x72, 0x1e, 0x7e, 0x88, 0x7,  0xc4, 0xcf, 0x2a, 0xf2,
                   0xf5, 0xa8, 0x55, 0xa1, 0xde, 0xa7, 0x83, 0x3a, 0x4d, 0x15, 0x0,  0x1a, 0x55, 0x55, 0x1b, 0x94, 0xc3,
                   0xdc, 0x8a, 0x15, 0x53, 0xcf, 0x8c, 0x2d, 0x5,  0xe4, 0x89, 0x3c, 0xf3, 0xd8, 0x1d, 0xa4, 0x2c, 0x5,
                   0x34, 0xbc, 0x8d, 0x85, 0x1c, 0x0,  0x9,  0xe1, 0xd4, 0xc7, 0xa4, 0xd2, 0xd6, 0xae, 0xff, 0xa9, 0x18,
                   0x0,  0x0,  0x12, 0x1f, 0x17, 0x4,  0x1f, 0x0,  0x1c, 0x3f, 0x4d, 0x15, 0x3e, 0x10, 0x25, 0xb5, 0x6a,
                   0x1a, 0x1f, 0x23, 0x9d, 0x3,  0xb6, 0x1e, 0x79, 0x6d, 0x93, 0x9b, 0xd9, 0xb0, 0x98, 0x91, 0x29, 0x7d,
                   0x20, 0x18, 0x49, 0x17, 0x30, 0x2,  0x2,  0x2,  0x1,  0x2,  0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29497);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x91);
}

// SubscribeResponse 9048 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS1,Right QoS2,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded] [PropServerKeepAlive 29652,PropServerReference
// "N\209\227[l\245\198\167\182\145\188\246\138\176\RS\a<\134\208\201\&79Z\204",PropReasonString
// "\NUL\NUL\212\248\213\239\233\206%1\207\168\183s^\US\150\DC3\160\RS\155\STX/T\129\SO:\222\158\252",PropMessageExpiryInterval
// 11470,PropWillDelayInterval 10358,PropMaximumPacketSize 11999,PropSessionExpiryInterval 29249,PropCorrelationData
// "\216\NUL\209\252;v \168bc\tV6C4j\r`\255\252@\EOT\147$\151\214",PropAssignedClientIdentifier
// "\167\146n/\CAN\130T[\203B\141",PropSubscriptionIdentifierAvailable 217,PropSubscriptionIdentifier
// 28,PropServerReference "\SYN\221RL\DC1`\DLE\156",PropContentType
// "\219r\154{\159F\194\159\236\US\154\146p\141\250",PropSharedSubscriptionAvailable
// 153,PropSubscriptionIdentifierAvailable 48,PropPayloadFormatIndicator 21,PropResponseTopic
// "\136\148W\180A\251X\189\216\174\242\tr\221\248\230\199\208\196\241",PropContentType
// "D\\\242\156:qp\159z\194`\175#\STX\189\SO\130\137/\191\234"]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0xe3, 0x1,  0x23, 0x58, 0xd4, 0x1,  0x13, 0x73, 0xd4, 0x1c, 0x0,  0x18, 0x4e, 0xd1, 0xe3, 0x5b,
                   0x6c, 0xf5, 0xc6, 0xa7, 0xb6, 0x91, 0xbc, 0xf6, 0x8a, 0xb0, 0x1e, 0x7,  0x3c, 0x86, 0xd0, 0xc9, 0x37,
                   0x39, 0x5a, 0xcc, 0x1f, 0x0,  0x1e, 0x0,  0x0,  0xd4, 0xf8, 0xd5, 0xef, 0xe9, 0xce, 0x25, 0x31, 0xcf,
                   0xa8, 0xb7, 0x73, 0x5e, 0x1f, 0x96, 0x13, 0xa0, 0x1e, 0x9b, 0x2,  0x2f, 0x54, 0x81, 0xe,  0x3a, 0xde,
                   0x9e, 0xfc, 0x2,  0x0,  0x0,  0x2c, 0xce, 0x18, 0x0,  0x0,  0x28, 0x76, 0x27, 0x0,  0x0,  0x2e, 0xdf,
                   0x11, 0x0,  0x0,  0x72, 0x41, 0x9,  0x0,  0x1a, 0xd8, 0x0,  0xd1, 0xfc, 0x3b, 0x76, 0x20, 0xa8, 0x62,
                   0x63, 0x9,  0x56, 0x36, 0x43, 0x34, 0x6a, 0xd,  0x60, 0xff, 0xfc, 0x40, 0x4,  0x93, 0x24, 0x97, 0xd6,
                   0x12, 0x0,  0xb,  0xa7, 0x92, 0x6e, 0x2f, 0x18, 0x82, 0x54, 0x5b, 0xcb, 0x42, 0x8d, 0x29, 0xd9, 0xb,
                   0x1c, 0x1c, 0x0,  0x8,  0x16, 0xdd, 0x52, 0x4c, 0x11, 0x60, 0x10, 0x9c, 0x3,  0x0,  0xf,  0xdb, 0x72,
                   0x9a, 0x7b, 0x9f, 0x46, 0xc2, 0x9f, 0xec, 0x1f, 0x9a, 0x92, 0x70, 0x8d, 0xfa, 0x2a, 0x99, 0x29, 0x30,
                   0x1,  0x15, 0x8,  0x0,  0x14, 0x88, 0x94, 0x57, 0xb4, 0x41, 0xfb, 0x58, 0xbd, 0xd8, 0xae, 0xf2, 0x9,
                   0x72, 0xdd, 0xf8, 0xe6, 0xc7, 0xd0, 0xc4, 0xf1, 0x3,  0x0,  0x15, 0x44, 0x5c, 0xf2, 0x9c, 0x3a, 0x71,
                   0x70, 0x9f, 0x7a, 0xc2, 0x60, 0xaf, 0x23, 0x2,  0xbd, 0xe,  0x82, 0x89, 0x2f, 0xbf, 0xea, 0x87, 0x80,
                   0x87, 0x1,  0x9e, 0x1,  0x1,  0x2,  0x2,  0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9048);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x9E);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0xA2);
  EXPECT_EQ(granted_qos_levels[10], 0x97);
}

// SubscribeResponse 18118 [Right QoS1] [PropTopicAlias 32552,PropCorrelationData
// "\219\205T\187\223\203V\US\254$:\211\206\181\253\162\EOT",PropUserProperty
// "\a\128D[\207\ETBuDt\141CZ\160\240\222\195\233\n\153\133U\ETB\168"
// "v\243\229\bv{\251\193'\186\143\ETX\DC2\254\147\244Q\128\FS\r\DEL$\ts*\233\191g\249",PropRequestProblemInformation
// 47,PropSessionExpiryInterval 29723,PropServerKeepAlive 6447,PropRequestProblemInformation
// 42,PropMessageExpiryInterval 16508,PropServerReference "\128b~\229\132",PropAuthenticationMethod
// "\215\SUB",PropSubscriptionIdentifierAvailable 109,PropAssignedClientIdentifier
// "\223}\146:J)\225\226\GS#\EOTn\227E7\184\248'u\ACK\223@\140\227U",PropMaximumQoS 22,PropServerReference
// "\248\225G\SO\209kK \188",PropWillDelayInterval 1146,PropResponseInformation
// "\202\215k(\209\237GUT\b\134P\249\180k\248.{\SO\173^",PropUserProperty
// "\rf.E\SI\151oopgY\232\&5\134{f$\211\n4\150\t\149\238\181\175/Z\EMx" "\ENQ2\154;",PropPayloadFormatIndicator
// 77,PropResponseTopic " \162h\149\NULP\226\226e\219\RS\236, \252Wgvb\FSM\224\237\187\ETXZ",PropMaximumQoS
// 117,PropResponseTopic "OV\RS\213p$\SUB\135"]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {
      0x90, 0x8f, 0x2,  0x46, 0xc6, 0x8a, 0x2,  0x23, 0x7f, 0x28, 0x9,  0x0,  0x11, 0xdb, 0xcd, 0x54, 0xbb, 0xdf, 0xcb,
      0x56, 0x1f, 0xfe, 0x24, 0x3a, 0xd3, 0xce, 0xb5, 0xfd, 0xa2, 0x4,  0x26, 0x0,  0x17, 0x7,  0x80, 0x44, 0x5b, 0xcf,
      0x17, 0x75, 0x44, 0x74, 0x8d, 0x43, 0x5a, 0xa0, 0xf0, 0xde, 0xc3, 0xe9, 0xa,  0x99, 0x85, 0x55, 0x17, 0xa8, 0x0,
      0x1d, 0x76, 0xf3, 0xe5, 0x8,  0x76, 0x7b, 0xfb, 0xc1, 0x27, 0xba, 0x8f, 0x3,  0x12, 0xfe, 0x93, 0xf4, 0x51, 0x80,
      0x1c, 0xd,  0x7f, 0x24, 0x9,  0x73, 0x2a, 0xe9, 0xbf, 0x67, 0xf9, 0x17, 0x2f, 0x11, 0x0,  0x0,  0x74, 0x1b, 0x13,
      0x19, 0x2f, 0x17, 0x2a, 0x2,  0x0,  0x0,  0x40, 0x7c, 0x1c, 0x0,  0x5,  0x80, 0x62, 0x7e, 0xe5, 0x84, 0x15, 0x0,
      0x2,  0xd7, 0x1a, 0x29, 0x6d, 0x12, 0x0,  0x19, 0xdf, 0x7d, 0x92, 0x3a, 0x4a, 0x29, 0xe1, 0xe2, 0x1d, 0x23, 0x4,
      0x6e, 0xe3, 0x45, 0x37, 0xb8, 0xf8, 0x27, 0x75, 0x6,  0xdf, 0x40, 0x8c, 0xe3, 0x55, 0x24, 0x16, 0x1c, 0x0,  0x9,
      0xf8, 0xe1, 0x47, 0xe,  0xd1, 0x6b, 0x4b, 0x20, 0xbc, 0x18, 0x0,  0x0,  0x4,  0x7a, 0x1a, 0x0,  0x15, 0xca, 0xd7,
      0x6b, 0x28, 0xd1, 0xed, 0x47, 0x55, 0x54, 0x8,  0x86, 0x50, 0xf9, 0xb4, 0x6b, 0xf8, 0x2e, 0x7b, 0xe,  0xad, 0x5e,
      0x26, 0x0,  0x1e, 0xd,  0x66, 0x2e, 0x45, 0xf,  0x97, 0x6f, 0x6f, 0x70, 0x67, 0x59, 0xe8, 0x35, 0x86, 0x7b, 0x66,
      0x24, 0xd3, 0xa,  0x34, 0x96, 0x9,  0x95, 0xee, 0xb5, 0xaf, 0x2f, 0x5a, 0x19, 0x78, 0x0,  0x4,  0x5,  0x32, 0x9a,
      0x3b, 0x1,  0x4d, 0x8,  0x0,  0x1a, 0x20, 0xa2, 0x68, 0x95, 0x0,  0x50, 0xe2, 0xe2, 0x65, 0xdb, 0x1e, 0xec, 0x2c,
      0x20, 0xfc, 0x57, 0x67, 0x76, 0x62, 0x1c, 0x4d, 0xe0, 0xed, 0xbb, 0x3,  0x5a, 0x24, 0x75, 0x8,  0x0,  0x8,  0x4f,
      0x56, 0x1e, 0xd5, 0x70, 0x24, 0x1a, 0x87, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18118);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}
