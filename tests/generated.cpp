#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\162[\135Y\179\166\248\129\206{\238\216oc:{M\ESC \SI\180[fv\192\SO", _pubPktID = 0, _pubBody =
// "\129\ETB\238\SYN)\SI\254", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x31, 0x23, 0x0,  0x1a, 0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce,
                   0x7b, 0xee, 0xd8, 0x6f, 0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b,
                   0x66, 0x76, 0xc0, 0xe,  0x81, 0x17, 0xee, 0x16, 0x29, 0xf,  0xfe};
  uint8_t topic_bytes[] = {0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b, 0xee, 0xd8, 0x6f,
                           0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76, 0xc0, 0xe};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0x17, 0xee, 0x16, 0x29, 0xf, 0xfe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\162[\135Y\179\166\248\129\206{\238\216oc:{M\ESC \SI\180[fv\192\SO", _pubPktID = 0, _pubBody =
// "\129\ETB\238\SYN)\SI\254", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x31, 0x23, 0x0,  0x1a, 0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce,
                   0x7b, 0xee, 0xd8, 0x6f, 0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b,
                   0x66, 0x76, 0xc0, 0xe,  0x81, 0x17, 0xee, 0x16, 0x29, 0xf,  0xfe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b, 0xee, 0xd8, 0x6f,
                               0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76, 0xc0, 0xe};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x81, 0x17, 0xee, 0x16, 0x29, 0xf, 0xfe};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\"\225\135\&6h>|U\199", _pubPktID =
// 10161, _pubBody = "\240\177C\238jP+", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3b, 0x14, 0x0,  0x9,  0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c,
                   0x55, 0xc7, 0x27, 0xb1, 0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  uint8_t topic_bytes[] = {0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10161, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\"\225\135\&6h>|U\199", _pubPktID =
// 10161, _pubBody = "\240\177C\238jP+", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x3b, 0x14, 0x0,  0x9,  0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c,
                   0x55, 0xc7, 0x27, 0xb1, 0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10161);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\\\247{A0\nX.\STX\243\151\STX\230}\221\144D<\209\NAKM\153\192\209=d\148\179\231", _pubPktID = 26319, _pubBody =
// "\166\229\136\206\180b\149", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x3c, 0x28, 0x0,  0x1d, 0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3,
                   0x97, 0x2,  0xe6, 0x7d, 0xdd, 0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1,
                   0x3d, 0x64, 0x94, 0xb3, 0xe7, 0x66, 0xcf, 0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  uint8_t topic_bytes[] = {0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6, 0x7d, 0xdd,
                           0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 26319, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\\\247{A0\nX.\STX\243\151\STX\230}\221\144D<\209\NAKM\153\192\209=d\148\179\231", _pubPktID = 26319, _pubBody =
// "\166\229\136\206\180b\149", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x3c, 0x28, 0x0,  0x1d, 0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3,
                   0x97, 0x2,  0xe6, 0x7d, 0xdd, 0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1,
                   0x3d, 0x64, 0x94, 0xb3, 0xe7, 0x66, 0xcf, 0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6, 0x7d, 0xdd,
                               0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 26319);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ETXTx", _pubPktID = 0, _pubBody =
// "Ei\SI", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x39, 0x8, 0x0, 0x3, 0x3, 0x54, 0x78, 0x45, 0x69, 0xf};
  uint8_t topic_bytes[] = {0x3, 0x54, 0x78};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x45, 0x69, 0xf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ETXTx", _pubPktID = 0, _pubBody =
// "Ei\SI", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x39, 0x8, 0x0, 0x3, 0x3, 0x54, 0x78, 0x45, 0x69, 0xf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3, 0x54, 0x78};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x69, 0xf};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 7815, _pubBody =
// "\168\142\FS", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x34, 0x7, 0x0, 0x0, 0x1e, 0x87, 0xa8, 0x8e, 0x1c};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa8, 0x8e, 0x1c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7815, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 7815, _pubBody =
// "\168\142\FS", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x34, 0x7, 0x0, 0x0, 0x1e, 0x87, 0xa8, 0x8e, 0x1c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa8, 0x8e, 0x1c};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7815);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\174\208\231e\229\225\201\ENQS\217\DEL\146\214\ENQ\145", _pubPktID = 25416, _pubBody =
// "\151\234\215\234\133\219\164\174\221\&1\EOTCs\212\"\141`\135\243\236q}6", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x33, 0x2a, 0x0,  0xf,  0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5,  0x53, 0xd9, 0x7f,
                   0x92, 0xd6, 0x5,  0x91, 0x63, 0x48, 0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd,
                   0x31, 0x4,  0x43, 0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  uint8_t topic_bytes[] = {0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5, 0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5, 0x91};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd, 0x31, 0x4, 0x43,
                         0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25416, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\174\208\231e\229\225\201\ENQS\217\DEL\146\214\ENQ\145", _pubPktID = 25416, _pubBody =
// "\151\234\215\234\133\219\164\174\221\&1\EOTCs\212\"\141`\135\243\236q}6", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x33, 0x2a, 0x0,  0xf,  0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5,  0x53, 0xd9, 0x7f,
                   0x92, 0xd6, 0x5,  0x91, 0x63, 0x48, 0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd,
                   0x31, 0x4,  0x43, 0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5, 0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5, 0x91};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd, 0x31, 0x4, 0x43,
                              0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25416);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "=\178\242\158\145\238\151\166;*4)",
// _pubPktID = 0, _pubBody = "s\252\179R\CANz\233E\191\b\150\SYN\142G\217\188\190\148z\234#\250\177\240\254m\219\SOH",
// _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x30, 0x2a, 0x0,  0xc,  0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34,
                   0x29, 0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                   0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  uint8_t topic_bytes[] = {0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                         0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "=\178\242\158\145\238\151\166;*4)",
// _pubPktID = 0, _pubBody = "s\252\179R\CANz\233E\191\b\150\SYN\142G\217\188\190\148z\234#\250\177\240\254m\219\SOH",
// _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x30, 0x2a, 0x0,  0xc,  0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34,
                   0x29, 0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                   0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                              0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\\\SUBg||N\DC41_\225\t\200Db_\163g\147\140\150]\254\216", _pubPktID = 0, _pubBody = "\130", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x1b, 0x0,  0x18, 0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1,
                   0x9,  0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8, 0x82};
  uint8_t topic_bytes[] = {0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                           0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\\\SUBg||N\DC41_\225\t\200Db_\163g\147\140\150]\254\216", _pubPktID = 0, _pubBody = "\130", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x30, 0x1b, 0x0,  0x18, 0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1,
                   0x9,  0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8, 0x82};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                               0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x82};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\167a*\t\248\248\176\&7", _pubPktID
// = 3229, _pubBody = "q\NUL\185\ACK\181\209\244d\DC1\207\251\203\230\128\DC1A(\215\169\248\224\136EM\156.\EOT\f",
// _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3c, 0x28, 0x0,  0x8,  0xa7, 0x61, 0x2a, 0x9,  0xf8, 0xf8, 0xb0, 0x37, 0xc,  0x9d,
                   0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                   0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  uint8_t topic_bytes[] = {0xa7, 0x61, 0x2a, 0x9, 0xf8, 0xf8, 0xb0, 0x37};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                         0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 3229, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\167a*\t\248\248\176\&7", _pubPktID
// = 3229, _pubBody = "q\NUL\185\ACK\181\209\244d\DC1\207\251\203\230\128\DC1A(\215\169\248\224\136EM\156.\EOT\f",
// _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3c, 0x28, 0x0,  0x8,  0xa7, 0x61, 0x2a, 0x9,  0xf8, 0xf8, 0xb0, 0x37, 0xc,  0x9d,
                   0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                   0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa7, 0x61, 0x2a, 0x9, 0xf8, 0xf8, 0xb0, 0x37};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                              0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3229);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[Q\172\216\185:|\162\194", _pubPktID
// = 10305, _pubBody = "\238\134", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3b, 0xf, 0x0, 0x9, 0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2, 0x28, 0x41, 0xee, 0x86};
  uint8_t topic_bytes[] = {0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xee, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10305, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[Q\172\216\185:|\162\194", _pubPktID
// = 10305, _pubBody = "\238\134", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x3b, 0xf, 0x0, 0x9, 0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2, 0x28, 0x41, 0xee, 0x86};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xee, 0x86};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10305);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ESC\169\150\136?o\142\230\b",
// _pubPktID = 0, _pubBody = "\203\ENQ\254)\215\158R\255\SOH\SOHM8\245\234\222t\225\187\175", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x31, 0x1e, 0x0,  0x9,  0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8,  0xcb, 0x5,  0xfe,
                   0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1,  0x1,  0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  uint8_t topic_bytes[] = {0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcb, 0x5,  0xfe, 0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1, 0x1,
                         0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ESC\169\150\136?o\142\230\b",
// _pubPktID = 0, _pubBody = "\203\ENQ\254)\215\158R\255\SOH\SOHM8\245\234\222t\225\187\175", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x31, 0x1e, 0x0,  0x9,  0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8,  0xcb, 0x5,  0xfe,
                   0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1,  0x1,  0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x5,  0xfe, 0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1, 0x1,
                              0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\186\b\221\f\178D\188&~\248P\ENQ\134\167\n\241\196v\203\245_\206\177\208\SI\FS", _pubPktID = 16783, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x3a, 0x1e, 0x0, 0x1a, 0xba, 0x8,  0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5,
                   0x86, 0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf,  0x1c, 0x41, 0x8f};
  uint8_t topic_bytes[] = {0xba, 0x8, 0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5, 0x86,
                           0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf, 0x1c};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16783, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\186\b\221\f\178D\188&~\248P\ENQ\134\167\n\241\196v\203\245_\206\177\208\SI\FS", _pubPktID = 16783, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x3a, 0x1e, 0x0, 0x1a, 0xba, 0x8,  0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5,
                   0x86, 0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf,  0x1c, 0x41, 0x8f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xba, 0x8, 0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5, 0x86,
                               0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf, 0x1c};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16783);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ";V\193\141}\175x\217i^\231g\247\v\203\183_\151\EM\\", _pubPktID = 0, _pubBody =
// "\162\166\173\187\NAK){\138\210Q^p+\SI\145Q\165\GS\166\249CG", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x31, 0x2c, 0x0,  0x14, 0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e, 0xe7, 0x67,
                   0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c, 0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a,
                   0xd2, 0x51, 0x5e, 0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  uint8_t topic_bytes[] = {0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e,
                           0xe7, 0x67, 0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a, 0xd2, 0x51, 0x5e,
                         0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ";V\193\141}\175x\217i^\231g\247\v\203\183_\151\EM\\", _pubPktID = 0, _pubBody =
// "\162\166\173\187\NAK){\138\210Q^p+\SI\145Q\165\GS\166\249CG", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x31, 0x2c, 0x0,  0x14, 0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e, 0xe7, 0x67,
                   0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c, 0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a,
                   0xd2, 0x51, 0x5e, 0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e,
                               0xe7, 0x67, 0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a, 0xd2, 0x51, 0x5e,
                              0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\141\253\251\DC4\210]", _pubPktID =
// 0, _pubBody = "a#\200\US\234\221\168\235\213|\205w", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x31, 0x14, 0x0,  0x6,  0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d, 0x61,
                   0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  uint8_t topic_bytes[] = {0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\141\253\251\DC4\210]", _pubPktID =
// 0, _pubBody = "a#\200\US\234\221\168\235\213|\205w", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x31, 0x14, 0x0,  0x6,  0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d, 0x61,
                   0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\n", _pubPktID = 15576, _pubBody =
// "\SYN\168.K\212\233\154\159\233j\172\130\DC2\187\203\187\155\ETX", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x3c, 0x17, 0x0,  0x1,  0xa,  0x3c, 0xd8, 0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9,
                   0x9a, 0x9f, 0xe9, 0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  uint8_t topic_bytes[] = {0xa};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9, 0x9a, 0x9f, 0xe9,
                         0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 15576, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\n", _pubPktID = 15576, _pubBody =
// "\SYN\168.K\212\233\154\159\233j\172\130\DC2\187\203\187\155\ETX", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x3c, 0x17, 0x0,  0x1,  0xa,  0x3c, 0xd8, 0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9,
                   0x9a, 0x9f, 0xe9, 0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9, 0x9a, 0x9f, 0xe9,
                              0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 15576);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\195\214\220\150\206L\a\225",
// _pubPktID = 0, _pubBody = "\203\137\DC3y\ETBf\GS\255}~\231\217kJ\ESCI\193\148\254p\247\ACKB\245", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x30, 0x22, 0x0,  0x8,  0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7,  0xe1,
                   0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                   0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  uint8_t topic_bytes[] = {0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7, 0xe1};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                         0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\195\214\220\150\206L\a\225",
// _pubPktID = 0, _pubBody = "\203\137\DC3y\ETBf\GS\255}~\231\217kJ\ESCI\193\148\254p\247\ACKB\245", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x30, 0x22, 0x0,  0x8,  0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7,  0xe1,
                   0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                   0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7, 0xe1};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                              0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\NUL=U\137\224\247\192", _pubPktID =
// 0, _pubBody = "\142\160\202\237f\186\202Fc1p\\\ACK\231J\193%\250kl", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x39, 0x1d, 0x0,  0x7,  0x0,  0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0, 0x8e, 0xa0, 0xca, 0xed, 0x66,
                   0xba, 0xca, 0x46, 0x63, 0x31, 0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  uint8_t topic_bytes[] = {0x0, 0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31,
                         0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\NUL=U\137\224\247\192", _pubPktID =
// 0, _pubBody = "\142\160\202\237f\186\202Fc1p\\\ACK\231J\193%\250kl", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x39, 0x1d, 0x0,  0x7,  0x0,  0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0, 0x8e, 0xa0, 0xca, 0xed, 0x66,
                   0xba, 0xca, 0x46, 0x63, 0x31, 0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x0, 0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31,
                              0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192\226\177\DC3\178\200n\184h\162\210\RS\153\149\253\&1\132\250\156\\\190\ETB\149 \192\247C\203", _pubPktID = 0,
// _pubBody = "\243<Y.\238/=\210\170\\\187", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x38, 0x29, 0x0,  0x1c, 0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2,
                   0x1e, 0x99, 0x95, 0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7,
                   0x43, 0xcb, 0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  uint8_t topic_bytes[] = {0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e, 0x99, 0x95,
                           0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192\226\177\DC3\178\200n\184h\162\210\RS\153\149\253\&1\132\250\156\\\190\ETB\149 \192\247C\203", _pubPktID = 0,
// _pubBody = "\243<Y.\238/=\210\170\\\187", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x38, 0x29, 0x0,  0x1c, 0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2,
                   0x1e, 0x99, 0x95, 0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7,
                   0x43, 0xcb, 0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e, 0x99, 0x95,
                               0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "Q\144\172\176:\255\255\236\209\134\204", _pubPktID = 29463, _pubBody =
// "\135s\STX\155A\v\217\&8\EOT^,\220\194\183\195\251\223H9g\164", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x3b, 0x24, 0x0,  0xb,  0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1,
                   0x86, 0xcc, 0x73, 0x17, 0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,
                   0x5e, 0x2c, 0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  uint8_t topic_bytes[] = {0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,  0x5e, 0x2c,
                         0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29463, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "Q\144\172\176:\255\255\236\209\134\204", _pubPktID = 29463, _pubBody =
// "\135s\STX\155A\v\217\&8\EOT^,\220\194\183\195\251\223H9g\164", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x3b, 0x24, 0x0,  0xb,  0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1,
                   0x86, 0xcc, 0x73, 0x17, 0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,
                   0x5e, 0x2c, 0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,  0x5e, 0x2c,
                              0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29463);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\220\&2\138\ETX\145\167\209n\146\EOT\ACK\187\213\216b\156\231@\149\194\129", _pubPktID = 25900, _pubBody = "+;\SYN",
// _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x34, 0x1c, 0x0,  0x15, 0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4,  0x6,
                   0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81, 0x65, 0x2c, 0x2b, 0x3b, 0x16};
  uint8_t topic_bytes[] = {0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4, 0x6,
                           0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x3b, 0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25900, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\220\&2\138\ETX\145\167\209n\146\EOT\ACK\187\213\216b\156\231@\149\194\129", _pubPktID = 25900, _pubBody = "+;\SYN",
// _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x34, 0x1c, 0x0,  0x15, 0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4,  0x6,
                   0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81, 0x65, 0x2c, 0x2b, 0x3b, 0x16};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4, 0x6,
                               0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x3b, 0x16};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25900);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\224", _pubPktID = 936, _pubBody =
// "6\245", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x3a, 0x7, 0x0, 0x1, 0xe0, 0x3, 0xa8, 0x36, 0xf5};
  uint8_t topic_bytes[] = {0xe0};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x36, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 936, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\224", _pubPktID = 936, _pubBody =
// "6\245", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x3a, 0x7, 0x0, 0x1, 0xe0, 0x3, 0xa8, 0x36, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe0};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x36, 0xf5};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 936);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "E\177\160\226\133O\252!\"\251\129\164{\STX\178\165g\229E\168\162\209>N\STXWn\191\235", _pubPktID = 0, _pubBody =
// "t\139\164\144a\157:\239\157\145M\SI\t\162\DC1\194D\143\134", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x30, 0x32, 0x0,  0x1d, 0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22,
                   0xfb, 0x81, 0xa4, 0x7b, 0x2,  0xb2, 0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1,
                   0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb, 0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d,
                   0x3a, 0xef, 0x9d, 0x91, 0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  uint8_t topic_bytes[] = {0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81, 0xa4, 0x7b, 0x2, 0xb2,
                           0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d, 0x3a, 0xef, 0x9d, 0x91,
                         0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "E\177\160\226\133O\252!\"\251\129\164{\STX\178\165g\229E\168\162\209>N\STXWn\191\235", _pubPktID = 0, _pubBody =
// "t\139\164\144a\157:\239\157\145M\SI\t\162\DC1\194D\143\134", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x30, 0x32, 0x0,  0x1d, 0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22,
                   0xfb, 0x81, 0xa4, 0x7b, 0x2,  0xb2, 0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1,
                   0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb, 0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d,
                   0x3a, 0xef, 0x9d, 0x91, 0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81, 0xa4, 0x7b, 0x2, 0xb2,
                               0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d, 0x3a, 0xef, 0x9d, 0x91,
                              0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\208\167\232\STX\DLE\GSQr\146|",
// _pubPktID = 8189, _pubBody = "c`\ESC\156x\229(\255\178\168\214\240a\217\197\224\170\174\&48pk\NAK\200\ETX\130\235",
// _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x3a, 0x29, 0x0,  0xa,  0xd0, 0xa7, 0xe8, 0x2,  0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c, 0x1f,
                   0xfd, 0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                   0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  uint8_t topic_bytes[] = {0xd0, 0xa7, 0xe8, 0x2, 0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                         0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 8189, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\208\167\232\STX\DLE\GSQr\146|",
// _pubPktID = 8189, _pubBody = "c`\ESC\156x\229(\255\178\168\214\240a\217\197\224\170\174\&48pk\NAK\200\ETX\130\235",
// _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x3a, 0x29, 0x0,  0xa,  0xd0, 0xa7, 0xe8, 0x2,  0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c, 0x1f,
                   0xfd, 0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                   0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd0, 0xa7, 0xe8, 0x2, 0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                              0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8189);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "b\245\197\244\&04\214\&6*\178",
// _pubPktID = 0, _pubBody = "\184", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x38, 0xd, 0x0, 0xa, 0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2, 0xb8};
  uint8_t topic_bytes[] = {0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "b\245\197\244\&04\214\&6*\178",
// _pubPktID = 0, _pubBody = "\184", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x38, 0xd, 0x0, 0xa, 0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2, 0xb8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb8};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\200\170v\196", _pubPktID = 30063,
// _pubBody = "\RS(g\190(g%\FS\249\135\DC1S\250\ACK(N\CANHC\157\RSK\175\DEL\225\159", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x4,  0xc8, 0xaa, 0x76, 0xc4, 0x75, 0x6f, 0x1e, 0x28,
                   0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa, 0x6,
                   0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  uint8_t topic_bytes[] = {0xc8, 0xaa, 0x76, 0xc4};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa,
                         0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 30063, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\200\170v\196", _pubPktID = 30063,
// _pubBody = "\RS(g\190(g%\FS\249\135\DC1S\250\ACK(N\CANHC\157\RSK\175\DEL\225\159", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x4,  0xc8, 0xaa, 0x76, 0xc4, 0x75, 0x6f, 0x1e, 0x28,
                   0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa, 0x6,
                   0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc8, 0xaa, 0x76, 0xc4};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa,
                              0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 30063);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\229<<\234;", _pubPktID = 0,
// _pubBody = "+ eK\208\CAN\232\179\167\129\227'Hqi\SO\163\r\168\188\157\247", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0x1d, 0x0,  0x5,  0xe5, 0x3c, 0x3c, 0xea, 0x3b, 0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8,
                   0xb3, 0xa7, 0x81, 0xe3, 0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  uint8_t topic_bytes[] = {0xe5, 0x3c, 0x3c, 0xea, 0x3b};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3,
                         0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\229<<\234;", _pubPktID = 0,
// _pubBody = "+ eK\208\CAN\232\179\167\129\227'Hqi\SO\163\r\168\188\157\247", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x31, 0x1d, 0x0,  0x5,  0xe5, 0x3c, 0x3c, 0xea, 0x3b, 0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8,
                   0xb3, 0xa7, 0x81, 0xe3, 0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe5, 0x3c, 0x3c, 0xea, 0x3b};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3,
                              0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ETX[\136\204X%<O\217v})\CAN&\DC2\200o\160\DC2h\214\215", _pubPktID = 0, _pubBody =
// "\SOHu\254\195M\192\254v<\221\FS\DC2\231[", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x31, 0x26, 0x0,  0x16, 0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76,
                   0x7d, 0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7, 0x1,  0x75,
                   0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  uint8_t topic_bytes[] = {0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d,
                           0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ETX[\136\204X%<O\217v})\CAN&\DC2\200o\160\DC2h\214\215", _pubPktID = 0, _pubBody =
// "\SOHu\254\195M\192\254v<\221\FS\DC2\231[", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x31, 0x26, 0x0,  0x16, 0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76,
                   0x7d, 0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7, 0x1,  0x75,
                   0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d,
                               0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201eh\234\223\242\222", _pubPktID =
// 0, _pubBody = " .@o\137\224\135\201\224\168\\&%,\220\&6\DC2\SI\209\132J\DC2]\FS\210\132\134\189\b~", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x38, 0x27, 0x0,  0x7,  0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde, 0x20, 0x2e, 0x40,
                   0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc, 0x36, 0x12,
                   0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  uint8_t topic_bytes[] = {0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                         0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201eh\234\223\242\222", _pubPktID =
// 0, _pubBody = " .@o\137\224\135\201\224\168\\&%,\220\&6\DC2\SI\209\132J\DC2]\FS\210\132\134\189\b~", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x38, 0x27, 0x0,  0x7,  0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde, 0x20, 0x2e, 0x40,
                   0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc, 0x36, 0x12,
                   0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                              0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\200\227JE\EM6\185bARg\185\190\226e\205R\n\v\167\CAN\DC3~\152nd8\155'", _pubPktID = 24808, _pubBody =
// "\FS\196\NUL\238\180K\252nl\r\235$v\169K\163\182\254\134\186", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x34, 0x36, 0x0,  0x1e, 0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41,
                   0x52, 0x67, 0xb9, 0xbe, 0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e,
                   0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27, 0x60, 0xe8, 0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b,
                   0xfc, 0x6e, 0x6c, 0xd,  0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  uint8_t topic_bytes[] = {0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41, 0x52, 0x67, 0xb9, 0xbe, 0xe2,
                           0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,
                         0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24808, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\200\227JE\EM6\185bARg\185\190\226e\205R\n\v\167\CAN\DC3~\152nd8\155'", _pubPktID = 24808, _pubBody =
// "\FS\196\NUL\238\180K\252nl\r\235$v\169K\163\182\254\134\186", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x34, 0x36, 0x0,  0x1e, 0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41,
                   0x52, 0x67, 0xb9, 0xbe, 0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e,
                   0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27, 0x60, 0xe8, 0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b,
                   0xfc, 0x6e, 0x6c, 0xd,  0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41,
                               0x52, 0x67, 0xb9, 0xbe, 0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,
                               0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27};
  lwmqtt_string_t exp_topic = {30, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,
                              0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24808);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 30);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\139Q\DC1\195\175\199\249J\b\183\226\228\185\ESC\245\128\130\166\n]\133:\228\231$K*v", _pubPktID = 0, _pubBody =
// "\SOH\135h\234D\134\149\210zy\n\143\141\&7Q", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x39, 0x2e, 0x0,  0x1d, 0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2,
                   0xe4, 0xb9, 0x1b, 0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a,
                   0x76, 0x1,  0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa,  0x8f, 0x8d, 0x37, 0x51};
  uint8_t topic_bytes[] = {0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2, 0xe4, 0xb9, 0x1b,
                           0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa, 0x8f, 0x8d, 0x37, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\139Q\DC1\195\175\199\249J\b\183\226\228\185\ESC\245\128\130\166\n]\133:\228\231$K*v", _pubPktID = 0, _pubBody =
// "\SOH\135h\234D\134\149\210zy\n\143\141\&7Q", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x39, 0x2e, 0x0,  0x1d, 0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2,
                   0xe4, 0xb9, 0x1b, 0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a,
                   0x76, 0x1,  0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa,  0x8f, 0x8d, 0x37, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2, 0xe4, 0xb9, 0x1b,
                               0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa, 0x8f, 0x8d, 0x37, 0x51};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\162[\135Y\179\166\248\129\206{\238\216oc:{M\ESC \SI\180[fv\192\SO", _pubPktID = 0, _pubBody =
// "\129\ETB\238\SYN)\SI\254", _pubProps = [PropAuthenticationData
// "\187\151\183'\US\238\213\205\t8u\181\SYNw",PropReasonString "\216\248-8Y\248\175",PropMessageExpiryInterval 8175]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x31, 0x44, 0x0,  0x1a, 0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b,
                   0xee, 0xd8, 0x6f, 0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76,
                   0xc0, 0xe,  0x20, 0x16, 0x0,  0xe,  0xbb, 0x97, 0xb7, 0x27, 0x1f, 0xee, 0xd5, 0xcd,
                   0x9,  0x38, 0x75, 0xb5, 0x16, 0x77, 0x1f, 0x0,  0x7,  0xd8, 0xf8, 0x2d, 0x38, 0x59,
                   0xf8, 0xaf, 0x2,  0x0,  0x0,  0x1f, 0xef, 0x81, 0x17, 0xee, 0x16, 0x29, 0xf,  0xfe};
  uint8_t topic_bytes[] = {0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b, 0xee, 0xd8, 0x6f,
                           0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76, 0xc0, 0xe};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0x17, 0xee, 0x16, 0x29, 0xf, 0xfe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0xbb, 0x97, 0xb7, 0x27, 0x1f, 0xee, 0xd5, 0xcd, 0x9, 0x38, 0x75, 0xb5, 0x16, 0x77};
  uint8_t bytesprops1[] = {0xd8, 0xf8, 0x2d, 0x38, 0x59, 0xf8, 0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8175}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\162[\135Y\179\166\248\129\206{\238\216oc:{M\ESC \SI\180[fv\192\SO", _pubPktID = 0, _pubBody =
// "\129\ETB\238\SYN)\SI\254", _pubProps = [PropAuthenticationData
// "\187\151\183'\US\238\213\205\t8u\181\SYNw",PropReasonString "\216\248-8Y\248\175",PropMessageExpiryInterval 8175]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x31, 0x44, 0x0,  0x1a, 0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b,
                   0xee, 0xd8, 0x6f, 0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76,
                   0xc0, 0xe,  0x20, 0x16, 0x0,  0xe,  0xbb, 0x97, 0xb7, 0x27, 0x1f, 0xee, 0xd5, 0xcd,
                   0x9,  0x38, 0x75, 0xb5, 0x16, 0x77, 0x1f, 0x0,  0x7,  0xd8, 0xf8, 0x2d, 0x38, 0x59,
                   0xf8, 0xaf, 0x2,  0x0,  0x0,  0x1f, 0xef, 0x81, 0x17, 0xee, 0x16, 0x29, 0xf,  0xfe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa2, 0x5b, 0x87, 0x59, 0xb3, 0xa6, 0xf8, 0x81, 0xce, 0x7b, 0xee, 0xd8, 0x6f,
                               0x63, 0x3a, 0x7b, 0x4d, 0x1b, 0x20, 0xf,  0xb4, 0x5b, 0x66, 0x76, 0xc0, 0xe};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x81, 0x17, 0xee, 0x16, 0x29, 0xf, 0xfe};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\"\225\135\&6h>|U\199", _pubPktID =
// 10161, _pubBody = "\240\177C\238jP+", _pubProps = [PropResponseInformation
// "\164L\197\211\149]\171\198\206\DEL\197",PropMaximumQoS 193,PropSubscriptionIdentifier 3,PropTopicAliasMaximum
// 19390,PropWillDelayInterval 23674,PropUserProperty "\168\245W"
// "\233\191\155/\NAK\138,\217\ETXK\203\f",PropAuthenticationMethod
// "\253\176O^\233P\174\DEL\205\160\STX\"N\228X9\141\&9\158\169]5\SYN",PropRequestResponseInformation
// 94,PropAssignedClientIdentifier "\233\243\203\207,",PropSubscriptionIdentifierAvailable 130,PropAuthenticationData
// "\161\213\202\DLE\202]\US\212-\166\238\145",PropPayloadFormatIndicator 9,PropRequestProblemInformation
// 208,PropTopicAlias 6428,PropServerReference "\173L\148\243dc\RS\141fFs\180%U3\135\250",PropReceiveMaximum
// 986,PropTopicAliasMaximum 26453,PropWillDelayInterval 7668,PropMaximumQoS 42,PropMessageExpiryInterval
// 18158,PropRetainAvailable 76,PropMessageExpiryInterval 5254,PropReceiveMaximum 28353,PropResponseInformation
// "\175dT\170H\161\242c\203\213\133\153\144\188\171~N\198+\252\156\171\NUL\227\224\135\221\180",PropCorrelationData
// "\DC3\227\186%;_\238\160",PropAuthenticationMethod "\247?\214",PropRequestProblemInformation
// 76,PropSubscriptionIdentifier 20]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x3b, 0xe4, 0x1,  0x0,  0x9,  0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7, 0x27, 0xb1, 0xce,
                   0x1,  0x1a, 0x0,  0xb,  0xa4, 0x4c, 0xc5, 0xd3, 0x95, 0x5d, 0xab, 0xc6, 0xce, 0x7f, 0xc5, 0x24, 0xc1,
                   0xb,  0x3,  0x22, 0x4b, 0xbe, 0x18, 0x0,  0x0,  0x5c, 0x7a, 0x26, 0x0,  0x3,  0xa8, 0xf5, 0x57, 0x0,
                   0xc,  0xe9, 0xbf, 0x9b, 0x2f, 0x15, 0x8a, 0x2c, 0xd9, 0x3,  0x4b, 0xcb, 0xc,  0x15, 0x0,  0x17, 0xfd,
                   0xb0, 0x4f, 0x5e, 0xe9, 0x50, 0xae, 0x7f, 0xcd, 0xa0, 0x2,  0x22, 0x4e, 0xe4, 0x58, 0x39, 0x8d, 0x39,
                   0x9e, 0xa9, 0x5d, 0x35, 0x16, 0x19, 0x5e, 0x12, 0x0,  0x5,  0xe9, 0xf3, 0xcb, 0xcf, 0x2c, 0x29, 0x82,
                   0x16, 0x0,  0xc,  0xa1, 0xd5, 0xca, 0x10, 0xca, 0x5d, 0x1f, 0xd4, 0x2d, 0xa6, 0xee, 0x91, 0x1,  0x9,
                   0x17, 0xd0, 0x23, 0x19, 0x1c, 0x1c, 0x0,  0x11, 0xad, 0x4c, 0x94, 0xf3, 0x64, 0x63, 0x1e, 0x8d, 0x66,
                   0x46, 0x73, 0xb4, 0x25, 0x55, 0x33, 0x87, 0xfa, 0x21, 0x3,  0xda, 0x22, 0x67, 0x55, 0x18, 0x0,  0x0,
                   0x1d, 0xf4, 0x24, 0x2a, 0x2,  0x0,  0x0,  0x46, 0xee, 0x25, 0x4c, 0x2,  0x0,  0x0,  0x14, 0x86, 0x21,
                   0x6e, 0xc1, 0x1a, 0x0,  0x1c, 0xaf, 0x64, 0x54, 0xaa, 0x48, 0xa1, 0xf2, 0x63, 0xcb, 0xd5, 0x85, 0x99,
                   0x90, 0xbc, 0xab, 0x7e, 0x4e, 0xc6, 0x2b, 0xfc, 0x9c, 0xab, 0x0,  0xe3, 0xe0, 0x87, 0xdd, 0xb4, 0x9,
                   0x0,  0x8,  0x13, 0xe3, 0xba, 0x25, 0x3b, 0x5f, 0xee, 0xa0, 0x15, 0x0,  0x3,  0xf7, 0x3f, 0xd6, 0x17,
                   0x4c, 0xb,  0x14, 0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  uint8_t topic_bytes[] = {0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0xa4, 0x4c, 0xc5, 0xd3, 0x95, 0x5d, 0xab, 0xc6, 0xce, 0x7f, 0xc5};
  uint8_t bytesprops2[] = {0xe9, 0xbf, 0x9b, 0x2f, 0x15, 0x8a, 0x2c, 0xd9, 0x3, 0x4b, 0xcb, 0xc};
  uint8_t bytesprops1[] = {0xa8, 0xf5, 0x57};
  uint8_t bytesprops3[] = {0xfd, 0xb0, 0x4f, 0x5e, 0xe9, 0x50, 0xae, 0x7f, 0xcd, 0xa0, 0x2, 0x22,
                           0x4e, 0xe4, 0x58, 0x39, 0x8d, 0x39, 0x9e, 0xa9, 0x5d, 0x35, 0x16};
  uint8_t bytesprops4[] = {0xe9, 0xf3, 0xcb, 0xcf, 0x2c};
  uint8_t bytesprops5[] = {0xa1, 0xd5, 0xca, 0x10, 0xca, 0x5d, 0x1f, 0xd4, 0x2d, 0xa6, 0xee, 0x91};
  uint8_t bytesprops6[] = {0xad, 0x4c, 0x94, 0xf3, 0x64, 0x63, 0x1e, 0x8d, 0x66,
                           0x46, 0x73, 0xb4, 0x25, 0x55, 0x33, 0x87, 0xfa};
  uint8_t bytesprops7[] = {0xaf, 0x64, 0x54, 0xaa, 0x48, 0xa1, 0xf2, 0x63, 0xcb, 0xd5, 0x85, 0x99, 0x90, 0xbc,
                           0xab, 0x7e, 0x4e, 0xc6, 0x2b, 0xfc, 0x9c, 0xab, 0x0,  0xe3, 0xe0, 0x87, 0xdd, 0xb4};
  uint8_t bytesprops8[] = {0x13, 0xe3, 0xba, 0x25, 0x3b, 0x5f, 0xee, 0xa0};
  uint8_t bytesprops9[] = {0xf7, 0x3f, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19390}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23674}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops1}, .v = {12, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6428}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 986}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26453}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7668}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18158}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5254}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28353}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10161, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\"\225\135\&6h>|U\199", _pubPktID =
// 10161, _pubBody = "\240\177C\238jP+", _pubProps = [PropResponseInformation
// "\164L\197\211\149]\171\198\206\DEL\197",PropMaximumQoS 193,PropSubscriptionIdentifier 3,PropTopicAliasMaximum
// 19390,PropWillDelayInterval 23674,PropUserProperty "\168\245W"
// "\233\191\155/\NAK\138,\217\ETXK\203\f",PropAuthenticationMethod
// "\253\176O^\233P\174\DEL\205\160\STX\"N\228X9\141\&9\158\169]5\SYN",PropRequestResponseInformation
// 94,PropAssignedClientIdentifier "\233\243\203\207,",PropSubscriptionIdentifierAvailable 130,PropAuthenticationData
// "\161\213\202\DLE\202]\US\212-\166\238\145",PropPayloadFormatIndicator 9,PropRequestProblemInformation
// 208,PropTopicAlias 6428,PropServerReference "\173L\148\243dc\RS\141fFs\180%U3\135\250",PropReceiveMaximum
// 986,PropTopicAliasMaximum 26453,PropWillDelayInterval 7668,PropMaximumQoS 42,PropMessageExpiryInterval
// 18158,PropRetainAvailable 76,PropMessageExpiryInterval 5254,PropReceiveMaximum 28353,PropResponseInformation
// "\175dT\170H\161\242c\203\213\133\153\144\188\171~N\198+\252\156\171\NUL\227\224\135\221\180",PropCorrelationData
// "\DC3\227\186%;_\238\160",PropAuthenticationMethod "\247?\214",PropRequestProblemInformation
// 76,PropSubscriptionIdentifier 20]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x3b, 0xe4, 0x1,  0x0,  0x9,  0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7, 0x27, 0xb1, 0xce,
                   0x1,  0x1a, 0x0,  0xb,  0xa4, 0x4c, 0xc5, 0xd3, 0x95, 0x5d, 0xab, 0xc6, 0xce, 0x7f, 0xc5, 0x24, 0xc1,
                   0xb,  0x3,  0x22, 0x4b, 0xbe, 0x18, 0x0,  0x0,  0x5c, 0x7a, 0x26, 0x0,  0x3,  0xa8, 0xf5, 0x57, 0x0,
                   0xc,  0xe9, 0xbf, 0x9b, 0x2f, 0x15, 0x8a, 0x2c, 0xd9, 0x3,  0x4b, 0xcb, 0xc,  0x15, 0x0,  0x17, 0xfd,
                   0xb0, 0x4f, 0x5e, 0xe9, 0x50, 0xae, 0x7f, 0xcd, 0xa0, 0x2,  0x22, 0x4e, 0xe4, 0x58, 0x39, 0x8d, 0x39,
                   0x9e, 0xa9, 0x5d, 0x35, 0x16, 0x19, 0x5e, 0x12, 0x0,  0x5,  0xe9, 0xf3, 0xcb, 0xcf, 0x2c, 0x29, 0x82,
                   0x16, 0x0,  0xc,  0xa1, 0xd5, 0xca, 0x10, 0xca, 0x5d, 0x1f, 0xd4, 0x2d, 0xa6, 0xee, 0x91, 0x1,  0x9,
                   0x17, 0xd0, 0x23, 0x19, 0x1c, 0x1c, 0x0,  0x11, 0xad, 0x4c, 0x94, 0xf3, 0x64, 0x63, 0x1e, 0x8d, 0x66,
                   0x46, 0x73, 0xb4, 0x25, 0x55, 0x33, 0x87, 0xfa, 0x21, 0x3,  0xda, 0x22, 0x67, 0x55, 0x18, 0x0,  0x0,
                   0x1d, 0xf4, 0x24, 0x2a, 0x2,  0x0,  0x0,  0x46, 0xee, 0x25, 0x4c, 0x2,  0x0,  0x0,  0x14, 0x86, 0x21,
                   0x6e, 0xc1, 0x1a, 0x0,  0x1c, 0xaf, 0x64, 0x54, 0xaa, 0x48, 0xa1, 0xf2, 0x63, 0xcb, 0xd5, 0x85, 0x99,
                   0x90, 0xbc, 0xab, 0x7e, 0x4e, 0xc6, 0x2b, 0xfc, 0x9c, 0xab, 0x0,  0xe3, 0xe0, 0x87, 0xdd, 0xb4, 0x9,
                   0x0,  0x8,  0x13, 0xe3, 0xba, 0x25, 0x3b, 0x5f, 0xee, 0xa0, 0x15, 0x0,  0x3,  0xf7, 0x3f, 0xd6, 0x17,
                   0x4c, 0xb,  0x14, 0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x22, 0xe1, 0x87, 0x36, 0x68, 0x3e, 0x7c, 0x55, 0xc7};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf0, 0xb1, 0x43, 0xee, 0x6a, 0x50, 0x2b};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10161);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\\\247{A0\nX.\STX\243\151\STX\230}\221\144D<\209\NAKM\153\192\209=d\148\179\231", _pubPktID = 26319, _pubBody =
// "\166\229\136\206\180b\149", _pubProps = [PropWillDelayInterval 6188,PropPayloadFormatIndicator 235]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x3c, 0x30, 0x0,  0x1d, 0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6,
                   0x7d, 0xdd, 0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7, 0x66,
                   0xcf, 0x7,  0x18, 0x0,  0x0,  0x18, 0x2c, 0x1,  0xeb, 0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  uint8_t topic_bytes[] = {0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6, 0x7d, 0xdd,
                           0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6188}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 235}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 26319, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\\\247{A0\nX.\STX\243\151\STX\230}\221\144D<\209\NAKM\153\192\209=d\148\179\231", _pubPktID = 26319, _pubBody =
// "\166\229\136\206\180b\149", _pubProps = [PropWillDelayInterval 6188,PropPayloadFormatIndicator 235]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x3c, 0x30, 0x0,  0x1d, 0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6,
                   0x7d, 0xdd, 0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7, 0x66,
                   0xcf, 0x7,  0x18, 0x0,  0x0,  0x18, 0x2c, 0x1,  0xeb, 0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0xf7, 0x7b, 0x41, 0x30, 0xa,  0x58, 0x2e, 0x2,  0xf3, 0x97, 0x2,  0xe6, 0x7d, 0xdd,
                               0x90, 0x44, 0x3c, 0xd1, 0x15, 0x4d, 0x99, 0xc0, 0xd1, 0x3d, 0x64, 0x94, 0xb3, 0xe7};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa6, 0xe5, 0x88, 0xce, 0xb4, 0x62, 0x95};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 26319);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ETXTx", _pubPktID = 0, _pubBody =
// "Ei\SI", _pubProps = [PropAssignedClientIdentifier
// "\247P\DC3-\230\239\243.\bn\"k\DC4\253\149",PropMessageExpiryInterval 25436,PropMessageExpiryInterval
// 27046,PropServerKeepAlive 53,PropServerReference
// "t\f\"t\SYN\215\SI\136j\245\255\SI\ENQj\166U\206\169\151\177\254\197sv\206\&2V\DC3\221\DC2",PropMaximumQoS
// 25,PropResponseTopic "\153\231\234\251P\160\250\135\163\DLE\166C\234JZ\184\226A",PropAuthenticationMethod
// "\218\175u@J\220\235\149(^\192\SOH\148\r;\153\222\134Z\237Xr\r\136 ",PropUserProperty
// "\239\&6\163'\244\&2\255\GSpmxEb\146\142\156\215\235t"
// "\175\&2\225\245\240\&2\DC1^\135\156\197\164\202",PropMessageExpiryInterval 31197,PropResponseInformation
// "#Jq\213\243K\217\176\&5\165\146\CAN^\204\216\ESC\218e[",PropMaximumPacketSize 11704,PropSharedSubscriptionAvailable
// 116,PropContentType
// "\DC4\t\166B1\168\252\NUL<;\vp\aI\194\175`\t+\170\tG\212\136\191\&8\203%\207Q",PropRequestResponseInformation
// 182,PropTopicAlias 22990,PropMaximumPacketSize 5336,PropTopicAlias 26427,PropContentType
// "\176\252\ETX\245\224\182T\227kK\198%\204V\a0\194\174\&5y\240\205\131\196"]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x39, 0x8d, 0x2,  0x0,  0x3,  0x3,  0x54, 0x78, 0x83, 0x2,  0x12, 0x0,  0xf,  0xf7, 0x50, 0x13, 0x2d,
                   0xe6, 0xef, 0xf3, 0x2e, 0x8,  0x6e, 0x22, 0x6b, 0x14, 0xfd, 0x95, 0x2,  0x0,  0x0,  0x63, 0x5c, 0x2,
                   0x0,  0x0,  0x69, 0xa6, 0x13, 0x0,  0x35, 0x1c, 0x0,  0x1e, 0x74, 0xc,  0x22, 0x74, 0x16, 0xd7, 0xf,
                   0x88, 0x6a, 0xf5, 0xff, 0xf,  0x5,  0x6a, 0xa6, 0x55, 0xce, 0xa9, 0x97, 0xb1, 0xfe, 0xc5, 0x73, 0x76,
                   0xce, 0x32, 0x56, 0x13, 0xdd, 0x12, 0x24, 0x19, 0x8,  0x0,  0x12, 0x99, 0xe7, 0xea, 0xfb, 0x50, 0xa0,
                   0xfa, 0x87, 0xa3, 0x10, 0xa6, 0x43, 0xea, 0x4a, 0x5a, 0xb8, 0xe2, 0x41, 0x15, 0x0,  0x19, 0xda, 0xaf,
                   0x75, 0x40, 0x4a, 0xdc, 0xeb, 0x95, 0x28, 0x5e, 0xc0, 0x1,  0x94, 0xd,  0x3b, 0x99, 0xde, 0x86, 0x5a,
                   0xed, 0x58, 0x72, 0xd,  0x88, 0x20, 0x26, 0x0,  0x13, 0xef, 0x36, 0xa3, 0x27, 0xf4, 0x32, 0xff, 0x1d,
                   0x70, 0x6d, 0x78, 0x45, 0x62, 0x92, 0x8e, 0x9c, 0xd7, 0xeb, 0x74, 0x0,  0xd,  0xaf, 0x32, 0xe1, 0xf5,
                   0xf0, 0x32, 0x11, 0x5e, 0x87, 0x9c, 0xc5, 0xa4, 0xca, 0x2,  0x0,  0x0,  0x79, 0xdd, 0x1a, 0x0,  0x13,
                   0x23, 0x4a, 0x71, 0xd5, 0xf3, 0x4b, 0xd9, 0xb0, 0x35, 0xa5, 0x92, 0x18, 0x5e, 0xcc, 0xd8, 0x1b, 0xda,
                   0x65, 0x5b, 0x27, 0x0,  0x0,  0x2d, 0xb8, 0x2a, 0x74, 0x3,  0x0,  0x1e, 0x14, 0x9,  0xa6, 0x42, 0x31,
                   0xa8, 0xfc, 0x0,  0x3c, 0x3b, 0xb,  0x70, 0x7,  0x49, 0xc2, 0xaf, 0x60, 0x9,  0x2b, 0xaa, 0x9,  0x47,
                   0xd4, 0x88, 0xbf, 0x38, 0xcb, 0x25, 0xcf, 0x51, 0x19, 0xb6, 0x23, 0x59, 0xce, 0x27, 0x0,  0x0,  0x14,
                   0xd8, 0x23, 0x67, 0x3b, 0x3,  0x0,  0x18, 0xb0, 0xfc, 0x3,  0xf5, 0xe0, 0xb6, 0x54, 0xe3, 0x6b, 0x4b,
                   0xc6, 0x25, 0xcc, 0x56, 0x7,  0x30, 0xc2, 0xae, 0x35, 0x79, 0xf0, 0xcd, 0x83, 0xc4, 0x45, 0x69, 0xf};
  uint8_t topic_bytes[] = {0x3, 0x54, 0x78};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x45, 0x69, 0xf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xf7, 0x50, 0x13, 0x2d, 0xe6, 0xef, 0xf3, 0x2e, 0x8, 0x6e, 0x22, 0x6b, 0x14, 0xfd, 0x95};
  uint8_t bytesprops1[] = {0x74, 0xc,  0x22, 0x74, 0x16, 0xd7, 0xf,  0x88, 0x6a, 0xf5, 0xff, 0xf,  0x5,  0x6a, 0xa6,
                           0x55, 0xce, 0xa9, 0x97, 0xb1, 0xfe, 0xc5, 0x73, 0x76, 0xce, 0x32, 0x56, 0x13, 0xdd, 0x12};
  uint8_t bytesprops2[] = {0x99, 0xe7, 0xea, 0xfb, 0x50, 0xa0, 0xfa, 0x87, 0xa3,
                           0x10, 0xa6, 0x43, 0xea, 0x4a, 0x5a, 0xb8, 0xe2, 0x41};
  uint8_t bytesprops3[] = {0xda, 0xaf, 0x75, 0x40, 0x4a, 0xdc, 0xeb, 0x95, 0x28, 0x5e, 0xc0, 0x1, 0x94,
                           0xd,  0x3b, 0x99, 0xde, 0x86, 0x5a, 0xed, 0x58, 0x72, 0xd,  0x88, 0x20};
  uint8_t bytesprops5[] = {0xaf, 0x32, 0xe1, 0xf5, 0xf0, 0x32, 0x11, 0x5e, 0x87, 0x9c, 0xc5, 0xa4, 0xca};
  uint8_t bytesprops4[] = {0xef, 0x36, 0xa3, 0x27, 0xf4, 0x32, 0xff, 0x1d, 0x70, 0x6d,
                           0x78, 0x45, 0x62, 0x92, 0x8e, 0x9c, 0xd7, 0xeb, 0x74};
  uint8_t bytesprops6[] = {0x23, 0x4a, 0x71, 0xd5, 0xf3, 0x4b, 0xd9, 0xb0, 0x35, 0xa5,
                           0x92, 0x18, 0x5e, 0xcc, 0xd8, 0x1b, 0xda, 0x65, 0x5b};
  uint8_t bytesprops7[] = {0x14, 0x9,  0xa6, 0x42, 0x31, 0xa8, 0xfc, 0x0,  0x3c, 0x3b, 0xb,  0x70, 0x7,  0x49, 0xc2,
                           0xaf, 0x60, 0x9,  0x2b, 0xaa, 0x9,  0x47, 0xd4, 0x88, 0xbf, 0x38, 0xcb, 0x25, 0xcf, 0x51};
  uint8_t bytesprops8[] = {0xb0, 0xfc, 0x3, 0xf5, 0xe0, 0xb6, 0x54, 0xe3, 0x6b, 0x4b, 0xc6, 0x25,
                           0xcc, 0x56, 0x7, 0x30, 0xc2, 0xae, 0x35, 0x79, 0xf0, 0xcd, 0x83, 0xc4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25436}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27046}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 53}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops4}, .v = {13, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31197}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11704}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22990}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5336}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26427}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ETXTx", _pubPktID = 0, _pubBody =
// "Ei\SI", _pubProps = [PropAssignedClientIdentifier
// "\247P\DC3-\230\239\243.\bn\"k\DC4\253\149",PropMessageExpiryInterval 25436,PropMessageExpiryInterval
// 27046,PropServerKeepAlive 53,PropServerReference
// "t\f\"t\SYN\215\SI\136j\245\255\SI\ENQj\166U\206\169\151\177\254\197sv\206\&2V\DC3\221\DC2",PropMaximumQoS
// 25,PropResponseTopic "\153\231\234\251P\160\250\135\163\DLE\166C\234JZ\184\226A",PropAuthenticationMethod
// "\218\175u@J\220\235\149(^\192\SOH\148\r;\153\222\134Z\237Xr\r\136 ",PropUserProperty
// "\239\&6\163'\244\&2\255\GSpmxEb\146\142\156\215\235t"
// "\175\&2\225\245\240\&2\DC1^\135\156\197\164\202",PropMessageExpiryInterval 31197,PropResponseInformation
// "#Jq\213\243K\217\176\&5\165\146\CAN^\204\216\ESC\218e[",PropMaximumPacketSize 11704,PropSharedSubscriptionAvailable
// 116,PropContentType
// "\DC4\t\166B1\168\252\NUL<;\vp\aI\194\175`\t+\170\tG\212\136\191\&8\203%\207Q",PropRequestResponseInformation
// 182,PropTopicAlias 22990,PropMaximumPacketSize 5336,PropTopicAlias 26427,PropContentType
// "\176\252\ETX\245\224\182T\227kK\198%\204V\a0\194\174\&5y\240\205\131\196"]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x39, 0x8d, 0x2,  0x0,  0x3,  0x3,  0x54, 0x78, 0x83, 0x2,  0x12, 0x0,  0xf,  0xf7, 0x50, 0x13, 0x2d,
                   0xe6, 0xef, 0xf3, 0x2e, 0x8,  0x6e, 0x22, 0x6b, 0x14, 0xfd, 0x95, 0x2,  0x0,  0x0,  0x63, 0x5c, 0x2,
                   0x0,  0x0,  0x69, 0xa6, 0x13, 0x0,  0x35, 0x1c, 0x0,  0x1e, 0x74, 0xc,  0x22, 0x74, 0x16, 0xd7, 0xf,
                   0x88, 0x6a, 0xf5, 0xff, 0xf,  0x5,  0x6a, 0xa6, 0x55, 0xce, 0xa9, 0x97, 0xb1, 0xfe, 0xc5, 0x73, 0x76,
                   0xce, 0x32, 0x56, 0x13, 0xdd, 0x12, 0x24, 0x19, 0x8,  0x0,  0x12, 0x99, 0xe7, 0xea, 0xfb, 0x50, 0xa0,
                   0xfa, 0x87, 0xa3, 0x10, 0xa6, 0x43, 0xea, 0x4a, 0x5a, 0xb8, 0xe2, 0x41, 0x15, 0x0,  0x19, 0xda, 0xaf,
                   0x75, 0x40, 0x4a, 0xdc, 0xeb, 0x95, 0x28, 0x5e, 0xc0, 0x1,  0x94, 0xd,  0x3b, 0x99, 0xde, 0x86, 0x5a,
                   0xed, 0x58, 0x72, 0xd,  0x88, 0x20, 0x26, 0x0,  0x13, 0xef, 0x36, 0xa3, 0x27, 0xf4, 0x32, 0xff, 0x1d,
                   0x70, 0x6d, 0x78, 0x45, 0x62, 0x92, 0x8e, 0x9c, 0xd7, 0xeb, 0x74, 0x0,  0xd,  0xaf, 0x32, 0xe1, 0xf5,
                   0xf0, 0x32, 0x11, 0x5e, 0x87, 0x9c, 0xc5, 0xa4, 0xca, 0x2,  0x0,  0x0,  0x79, 0xdd, 0x1a, 0x0,  0x13,
                   0x23, 0x4a, 0x71, 0xd5, 0xf3, 0x4b, 0xd9, 0xb0, 0x35, 0xa5, 0x92, 0x18, 0x5e, 0xcc, 0xd8, 0x1b, 0xda,
                   0x65, 0x5b, 0x27, 0x0,  0x0,  0x2d, 0xb8, 0x2a, 0x74, 0x3,  0x0,  0x1e, 0x14, 0x9,  0xa6, 0x42, 0x31,
                   0xa8, 0xfc, 0x0,  0x3c, 0x3b, 0xb,  0x70, 0x7,  0x49, 0xc2, 0xaf, 0x60, 0x9,  0x2b, 0xaa, 0x9,  0x47,
                   0xd4, 0x88, 0xbf, 0x38, 0xcb, 0x25, 0xcf, 0x51, 0x19, 0xb6, 0x23, 0x59, 0xce, 0x27, 0x0,  0x0,  0x14,
                   0xd8, 0x23, 0x67, 0x3b, 0x3,  0x0,  0x18, 0xb0, 0xfc, 0x3,  0xf5, 0xe0, 0xb6, 0x54, 0xe3, 0x6b, 0x4b,
                   0xc6, 0x25, 0xcc, 0x56, 0x7,  0x30, 0xc2, 0xae, 0x35, 0x79, 0xf0, 0xcd, 0x83, 0xc4, 0x45, 0x69, 0xf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3, 0x54, 0x78};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x69, 0xf};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 7815, _pubBody =
// "\168\142\FS", _pubProps = [PropResponseInformation "\208/+\158\144\255\SYN\SO\243Inw",PropTopicAliasMaximum
// 18437,PropTopicAliasMaximum 1104,PropSessionExpiryInterval 27902,PropServerReference
// "\134\174\231\235\232\CAN\178\130\CAN\216f\166 \145\172\141",PropTopicAliasMaximum 8918,PropMessageExpiryInterval
// 27657,PropAuthenticationMethod "\196'\\-",PropContentType
// "\150\\\188\244\131\167\193\136\DC4\CANB\v",PropSessionExpiryInterval 7240,PropAuthenticationMethod
// "\155\v:@\NAK\193\248M*",PropRetainAvailable 253,PropContentType
// "\NUL\252knZ\139JD\239\242%.\144\DC2\185\132R\f\244?",PropAssignedClientIdentifier
// "\209G\149\221\188\138*\FS\ACKu\181\161z\208\169\197\RS\250`r\213\168\237\&4H\174\245",PropReasonString
// "\238q\162m\237\204\214\246[\SI\DC3\151\142k\140\&8 a\SI\GS",PropSharedSubscriptionAvailable 1,PropTopicAliasMaximum
// 3287,PropMessageExpiryInterval 7895,PropRequestResponseInformation 238,PropRequestResponseInformation
// 247,PropRequestProblemInformation 76,PropCorrelationData
// "\194\211\165\148fO\208\198\167Xk\134w\255U`\169\EOT\133I\179u\241\ETXx\254",PropWillDelayInterval
// 20602,PropMessageExpiryInterval 24630,PropContentType
// "2\248\130\228\STX\203\237\146\161\153\250z\160H",PropMaximumPacketSize 18994,PropReasonString
// "\140-\216\252\240u\246\234\213\233y\253\167\196\223:\151"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x34, 0x94, 0x2,  0x0,  0x0,  0x1e, 0x87, 0x8b, 0x2,  0x1a, 0x0,  0xc,  0xd0, 0x2f, 0x2b, 0x9e, 0x90, 0xff, 0x16,
      0xe,  0xf3, 0x49, 0x6e, 0x77, 0x22, 0x48, 0x5,  0x22, 0x4,  0x50, 0x11, 0x0,  0x0,  0x6c, 0xfe, 0x1c, 0x0,  0x10,
      0x86, 0xae, 0xe7, 0xeb, 0xe8, 0x18, 0xb2, 0x82, 0x18, 0xd8, 0x66, 0xa6, 0x20, 0x91, 0xac, 0x8d, 0x22, 0x22, 0xd6,
      0x2,  0x0,  0x0,  0x6c, 0x9,  0x15, 0x0,  0x4,  0xc4, 0x27, 0x5c, 0x2d, 0x3,  0x0,  0xc,  0x96, 0x5c, 0xbc, 0xf4,
      0x83, 0xa7, 0xc1, 0x88, 0x14, 0x18, 0x42, 0xb,  0x11, 0x0,  0x0,  0x1c, 0x48, 0x15, 0x0,  0x9,  0x9b, 0xb,  0x3a,
      0x40, 0x15, 0xc1, 0xf8, 0x4d, 0x2a, 0x25, 0xfd, 0x3,  0x0,  0x14, 0x0,  0xfc, 0x6b, 0x6e, 0x5a, 0x8b, 0x4a, 0x44,
      0xef, 0xf2, 0x25, 0x2e, 0x90, 0x12, 0xb9, 0x84, 0x52, 0xc,  0xf4, 0x3f, 0x12, 0x0,  0x1b, 0xd1, 0x47, 0x95, 0xdd,
      0xbc, 0x8a, 0x2a, 0x1c, 0x6,  0x75, 0xb5, 0xa1, 0x7a, 0xd0, 0xa9, 0xc5, 0x1e, 0xfa, 0x60, 0x72, 0xd5, 0xa8, 0xed,
      0x34, 0x48, 0xae, 0xf5, 0x1f, 0x0,  0x14, 0xee, 0x71, 0xa2, 0x6d, 0xed, 0xcc, 0xd6, 0xf6, 0x5b, 0xf,  0x13, 0x97,
      0x8e, 0x6b, 0x8c, 0x38, 0x20, 0x61, 0xf,  0x1d, 0x2a, 0x1,  0x22, 0xc,  0xd7, 0x2,  0x0,  0x0,  0x1e, 0xd7, 0x19,
      0xee, 0x19, 0xf7, 0x17, 0x4c, 0x9,  0x0,  0x1a, 0xc2, 0xd3, 0xa5, 0x94, 0x66, 0x4f, 0xd0, 0xc6, 0xa7, 0x58, 0x6b,
      0x86, 0x77, 0xff, 0x55, 0x60, 0xa9, 0x4,  0x85, 0x49, 0xb3, 0x75, 0xf1, 0x3,  0x78, 0xfe, 0x18, 0x0,  0x0,  0x50,
      0x7a, 0x2,  0x0,  0x0,  0x60, 0x36, 0x3,  0x0,  0xe,  0x32, 0xf8, 0x82, 0xe4, 0x2,  0xcb, 0xed, 0x92, 0xa1, 0x99,
      0xfa, 0x7a, 0xa0, 0x48, 0x27, 0x0,  0x0,  0x4a, 0x32, 0x1f, 0x0,  0x11, 0x8c, 0x2d, 0xd8, 0xfc, 0xf0, 0x75, 0xf6,
      0xea, 0xd5, 0xe9, 0x79, 0xfd, 0xa7, 0xc4, 0xdf, 0x3a, 0x97, 0xa8, 0x8e, 0x1c};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa8, 0x8e, 0x1c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xd0, 0x2f, 0x2b, 0x9e, 0x90, 0xff, 0x16, 0xe, 0xf3, 0x49, 0x6e, 0x77};
  uint8_t bytesprops1[] = {0x86, 0xae, 0xe7, 0xeb, 0xe8, 0x18, 0xb2, 0x82,
                           0x18, 0xd8, 0x66, 0xa6, 0x20, 0x91, 0xac, 0x8d};
  uint8_t bytesprops2[] = {0xc4, 0x27, 0x5c, 0x2d};
  uint8_t bytesprops3[] = {0x96, 0x5c, 0xbc, 0xf4, 0x83, 0xa7, 0xc1, 0x88, 0x14, 0x18, 0x42, 0xb};
  uint8_t bytesprops4[] = {0x9b, 0xb, 0x3a, 0x40, 0x15, 0xc1, 0xf8, 0x4d, 0x2a};
  uint8_t bytesprops5[] = {0x0,  0xfc, 0x6b, 0x6e, 0x5a, 0x8b, 0x4a, 0x44, 0xef, 0xf2,
                           0x25, 0x2e, 0x90, 0x12, 0xb9, 0x84, 0x52, 0xc,  0xf4, 0x3f};
  uint8_t bytesprops6[] = {0xd1, 0x47, 0x95, 0xdd, 0xbc, 0x8a, 0x2a, 0x1c, 0x6,  0x75, 0xb5, 0xa1, 0x7a, 0xd0,
                           0xa9, 0xc5, 0x1e, 0xfa, 0x60, 0x72, 0xd5, 0xa8, 0xed, 0x34, 0x48, 0xae, 0xf5};
  uint8_t bytesprops7[] = {0xee, 0x71, 0xa2, 0x6d, 0xed, 0xcc, 0xd6, 0xf6, 0x5b, 0xf,
                           0x13, 0x97, 0x8e, 0x6b, 0x8c, 0x38, 0x20, 0x61, 0xf,  0x1d};
  uint8_t bytesprops8[] = {0xc2, 0xd3, 0xa5, 0x94, 0x66, 0x4f, 0xd0, 0xc6, 0xa7, 0x58, 0x6b, 0x86, 0x77,
                           0xff, 0x55, 0x60, 0xa9, 0x4,  0x85, 0x49, 0xb3, 0x75, 0xf1, 0x3,  0x78, 0xfe};
  uint8_t bytesprops9[] = {0x32, 0xf8, 0x82, 0xe4, 0x2, 0xcb, 0xed, 0x92, 0xa1, 0x99, 0xfa, 0x7a, 0xa0, 0x48};
  uint8_t bytesprops10[] = {0x8c, 0x2d, 0xd8, 0xfc, 0xf0, 0x75, 0xf6, 0xea, 0xd5,
                            0xe9, 0x79, 0xfd, 0xa7, 0xc4, 0xdf, 0x3a, 0x97};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18437}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1104}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27902}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8918}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27657}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7240}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3287}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7895}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20602}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24630}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18994}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7815, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 7815, _pubBody =
// "\168\142\FS", _pubProps = [PropResponseInformation "\208/+\158\144\255\SYN\SO\243Inw",PropTopicAliasMaximum
// 18437,PropTopicAliasMaximum 1104,PropSessionExpiryInterval 27902,PropServerReference
// "\134\174\231\235\232\CAN\178\130\CAN\216f\166 \145\172\141",PropTopicAliasMaximum 8918,PropMessageExpiryInterval
// 27657,PropAuthenticationMethod "\196'\\-",PropContentType
// "\150\\\188\244\131\167\193\136\DC4\CANB\v",PropSessionExpiryInterval 7240,PropAuthenticationMethod
// "\155\v:@\NAK\193\248M*",PropRetainAvailable 253,PropContentType
// "\NUL\252knZ\139JD\239\242%.\144\DC2\185\132R\f\244?",PropAssignedClientIdentifier
// "\209G\149\221\188\138*\FS\ACKu\181\161z\208\169\197\RS\250`r\213\168\237\&4H\174\245",PropReasonString
// "\238q\162m\237\204\214\246[\SI\DC3\151\142k\140\&8 a\SI\GS",PropSharedSubscriptionAvailable 1,PropTopicAliasMaximum
// 3287,PropMessageExpiryInterval 7895,PropRequestResponseInformation 238,PropRequestResponseInformation
// 247,PropRequestProblemInformation 76,PropCorrelationData
// "\194\211\165\148fO\208\198\167Xk\134w\255U`\169\EOT\133I\179u\241\ETXx\254",PropWillDelayInterval
// 20602,PropMessageExpiryInterval 24630,PropContentType
// "2\248\130\228\STX\203\237\146\161\153\250z\160H",PropMaximumPacketSize 18994,PropReasonString
// "\140-\216\252\240u\246\234\213\233y\253\167\196\223:\151"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {
      0x34, 0x94, 0x2,  0x0,  0x0,  0x1e, 0x87, 0x8b, 0x2,  0x1a, 0x0,  0xc,  0xd0, 0x2f, 0x2b, 0x9e, 0x90, 0xff, 0x16,
      0xe,  0xf3, 0x49, 0x6e, 0x77, 0x22, 0x48, 0x5,  0x22, 0x4,  0x50, 0x11, 0x0,  0x0,  0x6c, 0xfe, 0x1c, 0x0,  0x10,
      0x86, 0xae, 0xe7, 0xeb, 0xe8, 0x18, 0xb2, 0x82, 0x18, 0xd8, 0x66, 0xa6, 0x20, 0x91, 0xac, 0x8d, 0x22, 0x22, 0xd6,
      0x2,  0x0,  0x0,  0x6c, 0x9,  0x15, 0x0,  0x4,  0xc4, 0x27, 0x5c, 0x2d, 0x3,  0x0,  0xc,  0x96, 0x5c, 0xbc, 0xf4,
      0x83, 0xa7, 0xc1, 0x88, 0x14, 0x18, 0x42, 0xb,  0x11, 0x0,  0x0,  0x1c, 0x48, 0x15, 0x0,  0x9,  0x9b, 0xb,  0x3a,
      0x40, 0x15, 0xc1, 0xf8, 0x4d, 0x2a, 0x25, 0xfd, 0x3,  0x0,  0x14, 0x0,  0xfc, 0x6b, 0x6e, 0x5a, 0x8b, 0x4a, 0x44,
      0xef, 0xf2, 0x25, 0x2e, 0x90, 0x12, 0xb9, 0x84, 0x52, 0xc,  0xf4, 0x3f, 0x12, 0x0,  0x1b, 0xd1, 0x47, 0x95, 0xdd,
      0xbc, 0x8a, 0x2a, 0x1c, 0x6,  0x75, 0xb5, 0xa1, 0x7a, 0xd0, 0xa9, 0xc5, 0x1e, 0xfa, 0x60, 0x72, 0xd5, 0xa8, 0xed,
      0x34, 0x48, 0xae, 0xf5, 0x1f, 0x0,  0x14, 0xee, 0x71, 0xa2, 0x6d, 0xed, 0xcc, 0xd6, 0xf6, 0x5b, 0xf,  0x13, 0x97,
      0x8e, 0x6b, 0x8c, 0x38, 0x20, 0x61, 0xf,  0x1d, 0x2a, 0x1,  0x22, 0xc,  0xd7, 0x2,  0x0,  0x0,  0x1e, 0xd7, 0x19,
      0xee, 0x19, 0xf7, 0x17, 0x4c, 0x9,  0x0,  0x1a, 0xc2, 0xd3, 0xa5, 0x94, 0x66, 0x4f, 0xd0, 0xc6, 0xa7, 0x58, 0x6b,
      0x86, 0x77, 0xff, 0x55, 0x60, 0xa9, 0x4,  0x85, 0x49, 0xb3, 0x75, 0xf1, 0x3,  0x78, 0xfe, 0x18, 0x0,  0x0,  0x50,
      0x7a, 0x2,  0x0,  0x0,  0x60, 0x36, 0x3,  0x0,  0xe,  0x32, 0xf8, 0x82, 0xe4, 0x2,  0xcb, 0xed, 0x92, 0xa1, 0x99,
      0xfa, 0x7a, 0xa0, 0x48, 0x27, 0x0,  0x0,  0x4a, 0x32, 0x1f, 0x0,  0x11, 0x8c, 0x2d, 0xd8, 0xfc, 0xf0, 0x75, 0xf6,
      0xea, 0xd5, 0xe9, 0x79, 0xfd, 0xa7, 0xc4, 0xdf, 0x3a, 0x97, 0xa8, 0x8e, 0x1c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa8, 0x8e, 0x1c};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7815);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\174\208\231e\229\225\201\ENQS\217\DEL\146\214\ENQ\145", _pubPktID = 25416, _pubBody =
// "\151\234\215\234\133\219\164\174\221\&1\EOTCs\212\"\141`\135\243\236q}6", _pubProps = [PropSubscriptionIdentifier
// 25,PropTopicAlias 29625,PropSubscriptionIdentifier 0,PropSharedSubscriptionAvailable 209,PropServerReference
// "\vG\165\&1\148\EM.\205\130\USV\158\132\251\187",PropMaximumQoS 91,PropRequestResponseInformation 123,PropTopicAlias
// 17527,PropServerReference
// "T\226\150\184\232\235\133\234\223\158\137\DLE\142\\\225\134\223\209\252\FSn\204]\177\249",PropMessageExpiryInterval
// 987,PropMaximumQoS 227,PropMaximumQoS 97,PropRetainAvailable 25,PropResponseInformation
// "\221\233[\240\SYN\187\242~\196\STX\136\165\198\&5<w3\181\194",PropMaximumQoS 198,PropReasonString
// "\233\161\241\185G\f*u\185P\EOT 3\239\223\DC3\DEL,\181\151\fV0\246\224\235",PropMaximumPacketSize
// 4244,PropContentType "\189Z\139\150\218\246\DLE\135L\166\194*X\ETBLq\142\STX\216\241",PropRequestResponseInformation
// 52,PropMessageExpiryInterval 20035,PropAuthenticationData "\168",PropWillDelayInterval 29544,PropTopicAlias
// 13826,PropResponseInformation
// "\DLE\218\237\165\187\142H7t^]W\184(\US;B\tE\199\GS\205(\140\GS\nn\"\136",PropSubscriptionIdentifier
// 7,PropServerReference
// "(\DC4\179\158`\180\244\t,\152V\210'Z\220\ETX\246\GS!R\204\214\FS)Lx&w\182",PropRequestProblemInformation
// 40,PropTopicAliasMaximum 14562,PropContentType
// "\142\206\SIP+\GS\168\FS;R\183\184_\DC2\184\208\GS\156\&2\128\170\129\157\176\146"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x33, 0xbc, 0x2,  0x0,  0xf,  0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5,  0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5,
      0x91, 0x63, 0x48, 0x90, 0x2,  0xb,  0x19, 0x23, 0x73, 0xb9, 0xb,  0x0,  0x2a, 0xd1, 0x1c, 0x0,  0xf,  0xb,  0x47,
      0xa5, 0x31, 0x94, 0x19, 0x2e, 0xcd, 0x82, 0x1f, 0x56, 0x9e, 0x84, 0xfb, 0xbb, 0x24, 0x5b, 0x19, 0x7b, 0x23, 0x44,
      0x77, 0x1c, 0x0,  0x19, 0x54, 0xe2, 0x96, 0xb8, 0xe8, 0xeb, 0x85, 0xea, 0xdf, 0x9e, 0x89, 0x10, 0x8e, 0x5c, 0xe1,
      0x86, 0xdf, 0xd1, 0xfc, 0x1c, 0x6e, 0xcc, 0x5d, 0xb1, 0xf9, 0x2,  0x0,  0x0,  0x3,  0xdb, 0x24, 0xe3, 0x24, 0x61,
      0x25, 0x19, 0x1a, 0x0,  0x13, 0xdd, 0xe9, 0x5b, 0xf0, 0x16, 0xbb, 0xf2, 0x7e, 0xc4, 0x2,  0x88, 0xa5, 0xc6, 0x35,
      0x3c, 0x77, 0x33, 0xb5, 0xc2, 0x24, 0xc6, 0x1f, 0x0,  0x1a, 0xe9, 0xa1, 0xf1, 0xb9, 0x47, 0xc,  0x2a, 0x75, 0xb9,
      0x50, 0x4,  0x20, 0x33, 0xef, 0xdf, 0x13, 0x7f, 0x2c, 0xb5, 0x97, 0xc,  0x56, 0x30, 0xf6, 0xe0, 0xeb, 0x27, 0x0,
      0x0,  0x10, 0x94, 0x3,  0x0,  0x14, 0xbd, 0x5a, 0x8b, 0x96, 0xda, 0xf6, 0x10, 0x87, 0x4c, 0xa6, 0xc2, 0x2a, 0x58,
      0x17, 0x4c, 0x71, 0x8e, 0x2,  0xd8, 0xf1, 0x19, 0x34, 0x2,  0x0,  0x0,  0x4e, 0x43, 0x16, 0x0,  0x1,  0xa8, 0x18,
      0x0,  0x0,  0x73, 0x68, 0x23, 0x36, 0x2,  0x1a, 0x0,  0x1d, 0x10, 0xda, 0xed, 0xa5, 0xbb, 0x8e, 0x48, 0x37, 0x74,
      0x5e, 0x5d, 0x57, 0xb8, 0x28, 0x1f, 0x3b, 0x42, 0x9,  0x45, 0xc7, 0x1d, 0xcd, 0x28, 0x8c, 0x1d, 0xa,  0x6e, 0x22,
      0x88, 0xb,  0x7,  0x1c, 0x0,  0x1d, 0x28, 0x14, 0xb3, 0x9e, 0x60, 0xb4, 0xf4, 0x9,  0x2c, 0x98, 0x56, 0xd2, 0x27,
      0x5a, 0xdc, 0x3,  0xf6, 0x1d, 0x21, 0x52, 0xcc, 0xd6, 0x1c, 0x29, 0x4c, 0x78, 0x26, 0x77, 0xb6, 0x17, 0x28, 0x22,
      0x38, 0xe2, 0x3,  0x0,  0x19, 0x8e, 0xce, 0xf,  0x50, 0x2b, 0x1d, 0xa8, 0x1c, 0x3b, 0x52, 0xb7, 0xb8, 0x5f, 0x12,
      0xb8, 0xd0, 0x1d, 0x9c, 0x32, 0x80, 0xaa, 0x81, 0x9d, 0xb0, 0x92, 0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae,
      0xdd, 0x31, 0x4,  0x43, 0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  uint8_t topic_bytes[] = {0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5, 0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5, 0x91};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd, 0x31, 0x4, 0x43,
                         0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0xb, 0x47, 0xa5, 0x31, 0x94, 0x19, 0x2e, 0xcd, 0x82, 0x1f, 0x56, 0x9e, 0x84, 0xfb, 0xbb};
  uint8_t bytesprops1[] = {0x54, 0xe2, 0x96, 0xb8, 0xe8, 0xeb, 0x85, 0xea, 0xdf, 0x9e, 0x89, 0x10, 0x8e,
                           0x5c, 0xe1, 0x86, 0xdf, 0xd1, 0xfc, 0x1c, 0x6e, 0xcc, 0x5d, 0xb1, 0xf9};
  uint8_t bytesprops2[] = {0xdd, 0xe9, 0x5b, 0xf0, 0x16, 0xbb, 0xf2, 0x7e, 0xc4, 0x2,
                           0x88, 0xa5, 0xc6, 0x35, 0x3c, 0x77, 0x33, 0xb5, 0xc2};
  uint8_t bytesprops3[] = {0xe9, 0xa1, 0xf1, 0xb9, 0x47, 0xc,  0x2a, 0x75, 0xb9, 0x50, 0x4,  0x20, 0x33,
                           0xef, 0xdf, 0x13, 0x7f, 0x2c, 0xb5, 0x97, 0xc,  0x56, 0x30, 0xf6, 0xe0, 0xeb};
  uint8_t bytesprops4[] = {0xbd, 0x5a, 0x8b, 0x96, 0xda, 0xf6, 0x10, 0x87, 0x4c, 0xa6,
                           0xc2, 0x2a, 0x58, 0x17, 0x4c, 0x71, 0x8e, 0x2,  0xd8, 0xf1};
  uint8_t bytesprops5[] = {0xa8};
  uint8_t bytesprops6[] = {0x10, 0xda, 0xed, 0xa5, 0xbb, 0x8e, 0x48, 0x37, 0x74, 0x5e, 0x5d, 0x57, 0xb8, 0x28, 0x1f,
                           0x3b, 0x42, 0x9,  0x45, 0xc7, 0x1d, 0xcd, 0x28, 0x8c, 0x1d, 0xa,  0x6e, 0x22, 0x88};
  uint8_t bytesprops7[] = {0x28, 0x14, 0xb3, 0x9e, 0x60, 0xb4, 0xf4, 0x9,  0x2c, 0x98, 0x56, 0xd2, 0x27, 0x5a, 0xdc,
                           0x3,  0xf6, 0x1d, 0x21, 0x52, 0xcc, 0xd6, 0x1c, 0x29, 0x4c, 0x78, 0x26, 0x77, 0xb6};
  uint8_t bytesprops8[] = {0x8e, 0xce, 0xf,  0x50, 0x2b, 0x1d, 0xa8, 0x1c, 0x3b, 0x52, 0xb7, 0xb8, 0x5f,
                           0x12, 0xb8, 0xd0, 0x1d, 0x9c, 0x32, 0x80, 0xaa, 0x81, 0x9d, 0xb0, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29625}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17527}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 987}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4244}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20035}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29544}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13826}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14562}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25416, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\174\208\231e\229\225\201\ENQS\217\DEL\146\214\ENQ\145", _pubPktID = 25416, _pubBody =
// "\151\234\215\234\133\219\164\174\221\&1\EOTCs\212\"\141`\135\243\236q}6", _pubProps = [PropSubscriptionIdentifier
// 25,PropTopicAlias 29625,PropSubscriptionIdentifier 0,PropSharedSubscriptionAvailable 209,PropServerReference
// "\vG\165\&1\148\EM.\205\130\USV\158\132\251\187",PropMaximumQoS 91,PropRequestResponseInformation 123,PropTopicAlias
// 17527,PropServerReference
// "T\226\150\184\232\235\133\234\223\158\137\DLE\142\\\225\134\223\209\252\FSn\204]\177\249",PropMessageExpiryInterval
// 987,PropMaximumQoS 227,PropMaximumQoS 97,PropRetainAvailable 25,PropResponseInformation
// "\221\233[\240\SYN\187\242~\196\STX\136\165\198\&5<w3\181\194",PropMaximumQoS 198,PropReasonString
// "\233\161\241\185G\f*u\185P\EOT 3\239\223\DC3\DEL,\181\151\fV0\246\224\235",PropMaximumPacketSize
// 4244,PropContentType "\189Z\139\150\218\246\DLE\135L\166\194*X\ETBLq\142\STX\216\241",PropRequestResponseInformation
// 52,PropMessageExpiryInterval 20035,PropAuthenticationData "\168",PropWillDelayInterval 29544,PropTopicAlias
// 13826,PropResponseInformation
// "\DLE\218\237\165\187\142H7t^]W\184(\US;B\tE\199\GS\205(\140\GS\nn\"\136",PropSubscriptionIdentifier
// 7,PropServerReference
// "(\DC4\179\158`\180\244\t,\152V\210'Z\220\ETX\246\GS!R\204\214\FS)Lx&w\182",PropRequestProblemInformation
// 40,PropTopicAliasMaximum 14562,PropContentType
// "\142\206\SIP+\GS\168\FS;R\183\184_\DC2\184\208\GS\156\&2\128\170\129\157\176\146"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {
      0x33, 0xbc, 0x2,  0x0,  0xf,  0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5,  0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5,
      0x91, 0x63, 0x48, 0x90, 0x2,  0xb,  0x19, 0x23, 0x73, 0xb9, 0xb,  0x0,  0x2a, 0xd1, 0x1c, 0x0,  0xf,  0xb,  0x47,
      0xa5, 0x31, 0x94, 0x19, 0x2e, 0xcd, 0x82, 0x1f, 0x56, 0x9e, 0x84, 0xfb, 0xbb, 0x24, 0x5b, 0x19, 0x7b, 0x23, 0x44,
      0x77, 0x1c, 0x0,  0x19, 0x54, 0xe2, 0x96, 0xb8, 0xe8, 0xeb, 0x85, 0xea, 0xdf, 0x9e, 0x89, 0x10, 0x8e, 0x5c, 0xe1,
      0x86, 0xdf, 0xd1, 0xfc, 0x1c, 0x6e, 0xcc, 0x5d, 0xb1, 0xf9, 0x2,  0x0,  0x0,  0x3,  0xdb, 0x24, 0xe3, 0x24, 0x61,
      0x25, 0x19, 0x1a, 0x0,  0x13, 0xdd, 0xe9, 0x5b, 0xf0, 0x16, 0xbb, 0xf2, 0x7e, 0xc4, 0x2,  0x88, 0xa5, 0xc6, 0x35,
      0x3c, 0x77, 0x33, 0xb5, 0xc2, 0x24, 0xc6, 0x1f, 0x0,  0x1a, 0xe9, 0xa1, 0xf1, 0xb9, 0x47, 0xc,  0x2a, 0x75, 0xb9,
      0x50, 0x4,  0x20, 0x33, 0xef, 0xdf, 0x13, 0x7f, 0x2c, 0xb5, 0x97, 0xc,  0x56, 0x30, 0xf6, 0xe0, 0xeb, 0x27, 0x0,
      0x0,  0x10, 0x94, 0x3,  0x0,  0x14, 0xbd, 0x5a, 0x8b, 0x96, 0xda, 0xf6, 0x10, 0x87, 0x4c, 0xa6, 0xc2, 0x2a, 0x58,
      0x17, 0x4c, 0x71, 0x8e, 0x2,  0xd8, 0xf1, 0x19, 0x34, 0x2,  0x0,  0x0,  0x4e, 0x43, 0x16, 0x0,  0x1,  0xa8, 0x18,
      0x0,  0x0,  0x73, 0x68, 0x23, 0x36, 0x2,  0x1a, 0x0,  0x1d, 0x10, 0xda, 0xed, 0xa5, 0xbb, 0x8e, 0x48, 0x37, 0x74,
      0x5e, 0x5d, 0x57, 0xb8, 0x28, 0x1f, 0x3b, 0x42, 0x9,  0x45, 0xc7, 0x1d, 0xcd, 0x28, 0x8c, 0x1d, 0xa,  0x6e, 0x22,
      0x88, 0xb,  0x7,  0x1c, 0x0,  0x1d, 0x28, 0x14, 0xb3, 0x9e, 0x60, 0xb4, 0xf4, 0x9,  0x2c, 0x98, 0x56, 0xd2, 0x27,
      0x5a, 0xdc, 0x3,  0xf6, 0x1d, 0x21, 0x52, 0xcc, 0xd6, 0x1c, 0x29, 0x4c, 0x78, 0x26, 0x77, 0xb6, 0x17, 0x28, 0x22,
      0x38, 0xe2, 0x3,  0x0,  0x19, 0x8e, 0xce, 0xf,  0x50, 0x2b, 0x1d, 0xa8, 0x1c, 0x3b, 0x52, 0xb7, 0xb8, 0x5f, 0x12,
      0xb8, 0xd0, 0x1d, 0x9c, 0x32, 0x80, 0xaa, 0x81, 0x9d, 0xb0, 0x92, 0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae,
      0xdd, 0x31, 0x4,  0x43, 0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xae, 0xd0, 0xe7, 0x65, 0xe5, 0xe1, 0xc9, 0x5, 0x53, 0xd9, 0x7f, 0x92, 0xd6, 0x5, 0x91};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x97, 0xea, 0xd7, 0xea, 0x85, 0xdb, 0xa4, 0xae, 0xdd, 0x31, 0x4, 0x43,
                              0x73, 0xd4, 0x22, 0x8d, 0x60, 0x87, 0xf3, 0xec, 0x71, 0x7d, 0x36};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25416);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "=\178\242\158\145\238\151\166;*4)",
// _pubPktID = 0, _pubBody = "s\252\179R\CANz\233E\191\b\150\SYN\142G\217\188\190\148z\234#\250\177\240\254m\219\SOH",
// _pubProps = [PropRequestProblemInformation 201,PropServerKeepAlive 21147,PropTopicAlias
// 25249,PropMessageExpiryInterval 11702,PropReceiveMaximum 5760,PropMessageExpiryInterval 638,PropAuthenticationData
// "\147\157\151\rj:\\\132\228^\228",PropAuthenticationMethod
// "\136\193\v0%\ESC\167\153_\US\238G\SOH\239\214\227\&4\132\221\181\177\162?\\",PropWildcardSubscriptionAvailable
// 210,PropCorrelationData "\FS\v\214",PropAuthenticationData "\214>?=\242{L\234h\ENQx \165v|\148\"v\173x\215\230
// \249VF\142h}X",PropResponseTopic "\211\169\238n",PropSubscriptionIdentifier 24,PropServerKeepAlive
// 32603,PropMessageExpiryInterval 25708,PropRequestResponseInformation 57,PropResponseInformation
// "n\204\214\143\194\223\149(to\129",PropAuthenticationData
// "+\141q\161\DC1\228\160C\191[vZ:\212\137\150\190[\SUBv\204\&6d\f?y\am",PropMessageExpiryInterval 15130]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x30, 0xd8, 0x1,  0x0,  0xc,  0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29,
                   0xac, 0x1,  0x17, 0xc9, 0x13, 0x52, 0x9b, 0x23, 0x62, 0xa1, 0x2,  0x0,  0x0,  0x2d, 0xb6, 0x21, 0x16,
                   0x80, 0x2,  0x0,  0x0,  0x2,  0x7e, 0x16, 0x0,  0xb,  0x93, 0x9d, 0x97, 0xd,  0x6a, 0x3a, 0x5c, 0x84,
                   0xe4, 0x5e, 0xe4, 0x15, 0x0,  0x18, 0x88, 0xc1, 0xb,  0x30, 0x25, 0x1b, 0xa7, 0x99, 0x5f, 0x1f, 0xee,
                   0x47, 0x1,  0xef, 0xd6, 0xe3, 0x34, 0x84, 0xdd, 0xb5, 0xb1, 0xa2, 0x3f, 0x5c, 0x28, 0xd2, 0x9,  0x0,
                   0x3,  0x1c, 0xb,  0xd6, 0x16, 0x0,  0x1e, 0xd6, 0x3e, 0x3f, 0x3d, 0xf2, 0x7b, 0x4c, 0xea, 0x68, 0x5,
                   0x78, 0x20, 0xa5, 0x76, 0x7c, 0x94, 0x22, 0x76, 0xad, 0x78, 0xd7, 0xe6, 0x20, 0xf9, 0x56, 0x46, 0x8e,
                   0x68, 0x7d, 0x58, 0x8,  0x0,  0x4,  0xd3, 0xa9, 0xee, 0x6e, 0xb,  0x18, 0x13, 0x7f, 0x5b, 0x2,  0x0,
                   0x0,  0x64, 0x6c, 0x19, 0x39, 0x1a, 0x0,  0xb,  0x6e, 0xcc, 0xd6, 0x8f, 0xc2, 0xdf, 0x95, 0x28, 0x74,
                   0x6f, 0x81, 0x16, 0x0,  0x1c, 0x2b, 0x8d, 0x71, 0xa1, 0x11, 0xe4, 0xa0, 0x43, 0xbf, 0x5b, 0x76, 0x5a,
                   0x3a, 0xd4, 0x89, 0x96, 0xbe, 0x5b, 0x1a, 0x76, 0xcc, 0x36, 0x64, 0xc,  0x3f, 0x79, 0x7,  0x6d, 0x2,
                   0x0,  0x0,  0x3b, 0x1a, 0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e,
                   0x47, 0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  uint8_t topic_bytes[] = {0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                         0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0x93, 0x9d, 0x97, 0xd, 0x6a, 0x3a, 0x5c, 0x84, 0xe4, 0x5e, 0xe4};
  uint8_t bytesprops1[] = {0x88, 0xc1, 0xb,  0x30, 0x25, 0x1b, 0xa7, 0x99, 0x5f, 0x1f, 0xee, 0x47,
                           0x1,  0xef, 0xd6, 0xe3, 0x34, 0x84, 0xdd, 0xb5, 0xb1, 0xa2, 0x3f, 0x5c};
  uint8_t bytesprops2[] = {0x1c, 0xb, 0xd6};
  uint8_t bytesprops3[] = {0xd6, 0x3e, 0x3f, 0x3d, 0xf2, 0x7b, 0x4c, 0xea, 0x68, 0x5,  0x78, 0x20, 0xa5, 0x76, 0x7c,
                           0x94, 0x22, 0x76, 0xad, 0x78, 0xd7, 0xe6, 0x20, 0xf9, 0x56, 0x46, 0x8e, 0x68, 0x7d, 0x58};
  uint8_t bytesprops4[] = {0xd3, 0xa9, 0xee, 0x6e};
  uint8_t bytesprops5[] = {0x6e, 0xcc, 0xd6, 0x8f, 0xc2, 0xdf, 0x95, 0x28, 0x74, 0x6f, 0x81};
  uint8_t bytesprops6[] = {0x2b, 0x8d, 0x71, 0xa1, 0x11, 0xe4, 0xa0, 0x43, 0xbf, 0x5b, 0x76, 0x5a, 0x3a, 0xd4,
                           0x89, 0x96, 0xbe, 0x5b, 0x1a, 0x76, 0xcc, 0x36, 0x64, 0xc,  0x3f, 0x79, 0x7,  0x6d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21147}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25249}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11702}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5760}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 638}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32603}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25708}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15130}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "=\178\242\158\145\238\151\166;*4)",
// _pubPktID = 0, _pubBody = "s\252\179R\CANz\233E\191\b\150\SYN\142G\217\188\190\148z\234#\250\177\240\254m\219\SOH",
// _pubProps = [PropRequestProblemInformation 201,PropServerKeepAlive 21147,PropTopicAlias
// 25249,PropMessageExpiryInterval 11702,PropReceiveMaximum 5760,PropMessageExpiryInterval 638,PropAuthenticationData
// "\147\157\151\rj:\\\132\228^\228",PropAuthenticationMethod
// "\136\193\v0%\ESC\167\153_\US\238G\SOH\239\214\227\&4\132\221\181\177\162?\\",PropWildcardSubscriptionAvailable
// 210,PropCorrelationData "\FS\v\214",PropAuthenticationData "\214>?=\242{L\234h\ENQx \165v|\148\"v\173x\215\230
// \249VF\142h}X",PropResponseTopic "\211\169\238n",PropSubscriptionIdentifier 24,PropServerKeepAlive
// 32603,PropMessageExpiryInterval 25708,PropRequestResponseInformation 57,PropResponseInformation
// "n\204\214\143\194\223\149(to\129",PropAuthenticationData
// "+\141q\161\DC1\228\160C\191[vZ:\212\137\150\190[\SUBv\204\&6d\f?y\am",PropMessageExpiryInterval 15130]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x30, 0xd8, 0x1,  0x0,  0xc,  0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29,
                   0xac, 0x1,  0x17, 0xc9, 0x13, 0x52, 0x9b, 0x23, 0x62, 0xa1, 0x2,  0x0,  0x0,  0x2d, 0xb6, 0x21, 0x16,
                   0x80, 0x2,  0x0,  0x0,  0x2,  0x7e, 0x16, 0x0,  0xb,  0x93, 0x9d, 0x97, 0xd,  0x6a, 0x3a, 0x5c, 0x84,
                   0xe4, 0x5e, 0xe4, 0x15, 0x0,  0x18, 0x88, 0xc1, 0xb,  0x30, 0x25, 0x1b, 0xa7, 0x99, 0x5f, 0x1f, 0xee,
                   0x47, 0x1,  0xef, 0xd6, 0xe3, 0x34, 0x84, 0xdd, 0xb5, 0xb1, 0xa2, 0x3f, 0x5c, 0x28, 0xd2, 0x9,  0x0,
                   0x3,  0x1c, 0xb,  0xd6, 0x16, 0x0,  0x1e, 0xd6, 0x3e, 0x3f, 0x3d, 0xf2, 0x7b, 0x4c, 0xea, 0x68, 0x5,
                   0x78, 0x20, 0xa5, 0x76, 0x7c, 0x94, 0x22, 0x76, 0xad, 0x78, 0xd7, 0xe6, 0x20, 0xf9, 0x56, 0x46, 0x8e,
                   0x68, 0x7d, 0x58, 0x8,  0x0,  0x4,  0xd3, 0xa9, 0xee, 0x6e, 0xb,  0x18, 0x13, 0x7f, 0x5b, 0x2,  0x0,
                   0x0,  0x64, 0x6c, 0x19, 0x39, 0x1a, 0x0,  0xb,  0x6e, 0xcc, 0xd6, 0x8f, 0xc2, 0xdf, 0x95, 0x28, 0x74,
                   0x6f, 0x81, 0x16, 0x0,  0x1c, 0x2b, 0x8d, 0x71, 0xa1, 0x11, 0xe4, 0xa0, 0x43, 0xbf, 0x5b, 0x76, 0x5a,
                   0x3a, 0xd4, 0x89, 0x96, 0xbe, 0x5b, 0x1a, 0x76, 0xcc, 0x36, 0x64, 0xc,  0x3f, 0x79, 0x7,  0x6d, 0x2,
                   0x0,  0x0,  0x3b, 0x1a, 0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e,
                   0x47, 0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3d, 0xb2, 0xf2, 0x9e, 0x91, 0xee, 0x97, 0xa6, 0x3b, 0x2a, 0x34, 0x29};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73, 0xfc, 0xb3, 0x52, 0x18, 0x7a, 0xe9, 0x45, 0xbf, 0x8,  0x96, 0x16, 0x8e, 0x47,
                              0xd9, 0xbc, 0xbe, 0x94, 0x7a, 0xea, 0x23, 0xfa, 0xb1, 0xf0, 0xfe, 0x6d, 0xdb, 0x1};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\\\SUBg||N\DC41_\225\t\200Db_\163g\147\140\150]\254\216", _pubPktID = 0, _pubBody = "\130", _pubProps =
// [PropRequestProblemInformation 232]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x1e, 0x0,  0x18, 0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                   0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8, 0x2,  0x17, 0xe8, 0x82};
  uint8_t topic_bytes[] = {0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                           0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\\\SUBg||N\DC41_\225\t\200Db_\163g\147\140\150]\254\216", _pubPktID = 0, _pubBody = "\130", _pubProps =
// [PropRequestProblemInformation 232]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x30, 0x1e, 0x0,  0x18, 0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                   0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8, 0x2,  0x17, 0xe8, 0x82};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x94, 0x5c, 0x1a, 0x67, 0x7c, 0x7c, 0x4e, 0x14, 0x31, 0x5f, 0xe1, 0x9,
                               0xc8, 0x44, 0x62, 0x5f, 0xa3, 0x67, 0x93, 0x8c, 0x96, 0x5d, 0xfe, 0xd8};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x82};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\167a*\t\248\248\176\&7", _pubPktID
// = 3229, _pubBody = "q\NUL\185\ACK\181\209\244d\DC1\207\251\203\230\128\DC1A(\215\169\248\224\136EM\156.\EOT\f",
// _pubProps = [PropUserProperty "\171\178\180\177L\237\232\133"
// "\160\195\DLE\252\209\152\141p\DC2e\DC1\219\169",PropPayloadFormatIndicator 186,PropServerKeepAlive
// 22704,PropContentType "=\160\248h\156\&2\SOH\176S\176\145\NUL",PropUserProperty
// ":\ENQs\245\&6\252%}\133P!\201\213\155\179\215"
// "\162i\190\175\233]`\SOM,hBP\137\225\141\SUB\179)\180\229\183\154\233>\201\SYN\178",PropAssignedClientIdentifier
// "\153AI\128\142\&7\DC1\SIF]\189a\177\DC2\144{S\239)\240h\219\189\196\200\&4\238l",PropServerReference
// "\166\149\f_[\161\240\254\249\222\225\&2\EOT3\228+\140\144\218,\148\224\157h\181\248\207\213",PropTopicAlias
// 32605,PropTopicAliasMaximum 9453,PropResponseTopic
// "$\197\180\139\138\130\157\168PBR4\211\STXy\229\147\&9\253%\227\189\177\192",PropSubscriptionIdentifierAvailable
// 137,PropMessageExpiryInterval 31937,PropResponseInformation "\b",PropAssignedClientIdentifier
// "\196JG}\164\236Z\\\175\158o\160\169",PropWildcardSubscriptionAvailable 98,PropRequestResponseInformation
// 49,PropRequestProblemInformation 110]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x3c, 0x89, 0x2,  0x0,  0x8,  0xa7, 0x61, 0x2a, 0x9,  0xf8, 0xf8, 0xb0, 0x37, 0xc,  0x9d, 0xdf, 0x1,
                   0x26, 0x0,  0x8,  0xab, 0xb2, 0xb4, 0xb1, 0x4c, 0xed, 0xe8, 0x85, 0x0,  0xd,  0xa0, 0xc3, 0x10, 0xfc,
                   0xd1, 0x98, 0x8d, 0x70, 0x12, 0x65, 0x11, 0xdb, 0xa9, 0x1,  0xba, 0x13, 0x58, 0xb0, 0x3,  0x0,  0xc,
                   0x3d, 0xa0, 0xf8, 0x68, 0x9c, 0x32, 0x1,  0xb0, 0x53, 0xb0, 0x91, 0x0,  0x26, 0x0,  0x10, 0x3a, 0x5,
                   0x73, 0xf5, 0x36, 0xfc, 0x25, 0x7d, 0x85, 0x50, 0x21, 0xc9, 0xd5, 0x9b, 0xb3, 0xd7, 0x0,  0x1c, 0xa2,
                   0x69, 0xbe, 0xaf, 0xe9, 0x5d, 0x60, 0xe,  0x4d, 0x2c, 0x68, 0x42, 0x50, 0x89, 0xe1, 0x8d, 0x1a, 0xb3,
                   0x29, 0xb4, 0xe5, 0xb7, 0x9a, 0xe9, 0x3e, 0xc9, 0x16, 0xb2, 0x12, 0x0,  0x1c, 0x99, 0x41, 0x49, 0x80,
                   0x8e, 0x37, 0x11, 0xf,  0x46, 0x5d, 0xbd, 0x61, 0xb1, 0x12, 0x90, 0x7b, 0x53, 0xef, 0x29, 0xf0, 0x68,
                   0xdb, 0xbd, 0xc4, 0xc8, 0x34, 0xee, 0x6c, 0x1c, 0x0,  0x1c, 0xa6, 0x95, 0xc,  0x5f, 0x5b, 0xa1, 0xf0,
                   0xfe, 0xf9, 0xde, 0xe1, 0x32, 0x4,  0x33, 0xe4, 0x2b, 0x8c, 0x90, 0xda, 0x2c, 0x94, 0xe0, 0x9d, 0x68,
                   0xb5, 0xf8, 0xcf, 0xd5, 0x23, 0x7f, 0x5d, 0x22, 0x24, 0xed, 0x8,  0x0,  0x18, 0x24, 0xc5, 0xb4, 0x8b,
                   0x8a, 0x82, 0x9d, 0xa8, 0x50, 0x42, 0x52, 0x34, 0xd3, 0x2,  0x79, 0xe5, 0x93, 0x39, 0xfd, 0x25, 0xe3,
                   0xbd, 0xb1, 0xc0, 0x29, 0x89, 0x2,  0x0,  0x0,  0x7c, 0xc1, 0x1a, 0x0,  0x1,  0x8,  0x12, 0x0,  0xd,
                   0xc4, 0x4a, 0x47, 0x7d, 0xa4, 0xec, 0x5a, 0x5c, 0xaf, 0x9e, 0x6f, 0xa0, 0xa9, 0x28, 0x62, 0x19, 0x31,
                   0x17, 0x6e, 0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80, 0x11,
                   0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  uint8_t topic_bytes[] = {0xa7, 0x61, 0x2a, 0x9, 0xf8, 0xf8, 0xb0, 0x37};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                         0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops1[] = {0xa0, 0xc3, 0x10, 0xfc, 0xd1, 0x98, 0x8d, 0x70, 0x12, 0x65, 0x11, 0xdb, 0xa9};
  uint8_t bytesprops0[] = {0xab, 0xb2, 0xb4, 0xb1, 0x4c, 0xed, 0xe8, 0x85};
  uint8_t bytesprops2[] = {0x3d, 0xa0, 0xf8, 0x68, 0x9c, 0x32, 0x1, 0xb0, 0x53, 0xb0, 0x91, 0x0};
  uint8_t bytesprops4[] = {0xa2, 0x69, 0xbe, 0xaf, 0xe9, 0x5d, 0x60, 0xe,  0x4d, 0x2c, 0x68, 0x42, 0x50, 0x89,
                           0xe1, 0x8d, 0x1a, 0xb3, 0x29, 0xb4, 0xe5, 0xb7, 0x9a, 0xe9, 0x3e, 0xc9, 0x16, 0xb2};
  uint8_t bytesprops3[] = {0x3a, 0x5,  0x73, 0xf5, 0x36, 0xfc, 0x25, 0x7d,
                           0x85, 0x50, 0x21, 0xc9, 0xd5, 0x9b, 0xb3, 0xd7};
  uint8_t bytesprops5[] = {0x99, 0x41, 0x49, 0x80, 0x8e, 0x37, 0x11, 0xf,  0x46, 0x5d, 0xbd, 0x61, 0xb1, 0x12,
                           0x90, 0x7b, 0x53, 0xef, 0x29, 0xf0, 0x68, 0xdb, 0xbd, 0xc4, 0xc8, 0x34, 0xee, 0x6c};
  uint8_t bytesprops6[] = {0xa6, 0x95, 0xc,  0x5f, 0x5b, 0xa1, 0xf0, 0xfe, 0xf9, 0xde, 0xe1, 0x32, 0x4,  0x33,
                           0xe4, 0x2b, 0x8c, 0x90, 0xda, 0x2c, 0x94, 0xe0, 0x9d, 0x68, 0xb5, 0xf8, 0xcf, 0xd5};
  uint8_t bytesprops7[] = {0x24, 0xc5, 0xb4, 0x8b, 0x8a, 0x82, 0x9d, 0xa8, 0x50, 0x42, 0x52, 0x34,
                           0xd3, 0x2,  0x79, 0xe5, 0x93, 0x39, 0xfd, 0x25, 0xe3, 0xbd, 0xb1, 0xc0};
  uint8_t bytesprops8[] = {0x8};
  uint8_t bytesprops9[] = {0xc4, 0x4a, 0x47, 0x7d, 0xa4, 0xec, 0x5a, 0x5c, 0xaf, 0x9e, 0x6f, 0xa0, 0xa9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {13, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22704}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops3}, .v = {28, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32605}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9453}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31937}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 3229, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\167a*\t\248\248\176\&7", _pubPktID
// = 3229, _pubBody = "q\NUL\185\ACK\181\209\244d\DC1\207\251\203\230\128\DC1A(\215\169\248\224\136EM\156.\EOT\f",
// _pubProps = [PropUserProperty "\171\178\180\177L\237\232\133"
// "\160\195\DLE\252\209\152\141p\DC2e\DC1\219\169",PropPayloadFormatIndicator 186,PropServerKeepAlive
// 22704,PropContentType "=\160\248h\156\&2\SOH\176S\176\145\NUL",PropUserProperty
// ":\ENQs\245\&6\252%}\133P!\201\213\155\179\215"
// "\162i\190\175\233]`\SOM,hBP\137\225\141\SUB\179)\180\229\183\154\233>\201\SYN\178",PropAssignedClientIdentifier
// "\153AI\128\142\&7\DC1\SIF]\189a\177\DC2\144{S\239)\240h\219\189\196\200\&4\238l",PropServerReference
// "\166\149\f_[\161\240\254\249\222\225\&2\EOT3\228+\140\144\218,\148\224\157h\181\248\207\213",PropTopicAlias
// 32605,PropTopicAliasMaximum 9453,PropResponseTopic
// "$\197\180\139\138\130\157\168PBR4\211\STXy\229\147\&9\253%\227\189\177\192",PropSubscriptionIdentifierAvailable
// 137,PropMessageExpiryInterval 31937,PropResponseInformation "\b",PropAssignedClientIdentifier
// "\196JG}\164\236Z\\\175\158o\160\169",PropWildcardSubscriptionAvailable 98,PropRequestResponseInformation
// 49,PropRequestProblemInformation 110]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x3c, 0x89, 0x2,  0x0,  0x8,  0xa7, 0x61, 0x2a, 0x9,  0xf8, 0xf8, 0xb0, 0x37, 0xc,  0x9d, 0xdf, 0x1,
                   0x26, 0x0,  0x8,  0xab, 0xb2, 0xb4, 0xb1, 0x4c, 0xed, 0xe8, 0x85, 0x0,  0xd,  0xa0, 0xc3, 0x10, 0xfc,
                   0xd1, 0x98, 0x8d, 0x70, 0x12, 0x65, 0x11, 0xdb, 0xa9, 0x1,  0xba, 0x13, 0x58, 0xb0, 0x3,  0x0,  0xc,
                   0x3d, 0xa0, 0xf8, 0x68, 0x9c, 0x32, 0x1,  0xb0, 0x53, 0xb0, 0x91, 0x0,  0x26, 0x0,  0x10, 0x3a, 0x5,
                   0x73, 0xf5, 0x36, 0xfc, 0x25, 0x7d, 0x85, 0x50, 0x21, 0xc9, 0xd5, 0x9b, 0xb3, 0xd7, 0x0,  0x1c, 0xa2,
                   0x69, 0xbe, 0xaf, 0xe9, 0x5d, 0x60, 0xe,  0x4d, 0x2c, 0x68, 0x42, 0x50, 0x89, 0xe1, 0x8d, 0x1a, 0xb3,
                   0x29, 0xb4, 0xe5, 0xb7, 0x9a, 0xe9, 0x3e, 0xc9, 0x16, 0xb2, 0x12, 0x0,  0x1c, 0x99, 0x41, 0x49, 0x80,
                   0x8e, 0x37, 0x11, 0xf,  0x46, 0x5d, 0xbd, 0x61, 0xb1, 0x12, 0x90, 0x7b, 0x53, 0xef, 0x29, 0xf0, 0x68,
                   0xdb, 0xbd, 0xc4, 0xc8, 0x34, 0xee, 0x6c, 0x1c, 0x0,  0x1c, 0xa6, 0x95, 0xc,  0x5f, 0x5b, 0xa1, 0xf0,
                   0xfe, 0xf9, 0xde, 0xe1, 0x32, 0x4,  0x33, 0xe4, 0x2b, 0x8c, 0x90, 0xda, 0x2c, 0x94, 0xe0, 0x9d, 0x68,
                   0xb5, 0xf8, 0xcf, 0xd5, 0x23, 0x7f, 0x5d, 0x22, 0x24, 0xed, 0x8,  0x0,  0x18, 0x24, 0xc5, 0xb4, 0x8b,
                   0x8a, 0x82, 0x9d, 0xa8, 0x50, 0x42, 0x52, 0x34, 0xd3, 0x2,  0x79, 0xe5, 0x93, 0x39, 0xfd, 0x25, 0xe3,
                   0xbd, 0xb1, 0xc0, 0x29, 0x89, 0x2,  0x0,  0x0,  0x7c, 0xc1, 0x1a, 0x0,  0x1,  0x8,  0x12, 0x0,  0xd,
                   0xc4, 0x4a, 0x47, 0x7d, 0xa4, 0xec, 0x5a, 0x5c, 0xaf, 0x9e, 0x6f, 0xa0, 0xa9, 0x28, 0x62, 0x19, 0x31,
                   0x17, 0x6e, 0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80, 0x11,
                   0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa7, 0x61, 0x2a, 0x9, 0xf8, 0xf8, 0xb0, 0x37};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x71, 0x0,  0xb9, 0x6,  0xb5, 0xd1, 0xf4, 0x64, 0x11, 0xcf, 0xfb, 0xcb, 0xe6, 0x80,
                              0x11, 0x41, 0x28, 0xd7, 0xa9, 0xf8, 0xe0, 0x88, 0x45, 0x4d, 0x9c, 0x2e, 0x4,  0xc};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3229);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[Q\172\216\185:|\162\194", _pubPktID
// = 10305, _pubBody = "\238\134", _pubProps = [PropReceiveMaximum 10817,PropReceiveMaximum
// 24022,PropMessageExpiryInterval 23639,PropUserProperty "H\173\DC3" "\225\CAN|w\147\168K\247(}
// \132\196\t^L",PropMessageExpiryInterval 16643,PropWildcardSubscriptionAvailable 163,PropWillDelayInterval
// 22770,PropUserProperty "m1A\161\&5e\159-\215\178"
// "<\206L{\DEL\177M^m\142S\SYN\200\&2\158\DC2:\242",PropWillDelayInterval 28106,PropWildcardSubscriptionAvailable
// 221,PropTopicAliasMaximum 13801,PropSubscriptionIdentifier 11,PropWillDelayInterval 19944,PropMaximumQoS
// 186,PropWillDelayInterval 5955,PropSessionExpiryInterval 6777,PropSessionExpiryInterval 22897,PropTopicAlias
// 6180,PropRetainAvailable 93,PropResponseTopic
// "\177\232\138\239\152\219;\164\229C\151'\224\&7\251\199\204R/\SO\nu\142\158\SI\DC1%\231",PropSessionExpiryInterval
// 22932,PropUserProperty "\191p" "\195\DC2\240Y\184\ENQ\150\163\180\173\217\198\ACKa\149N\252\\/\v\170\218
// ,\206\166",PropSharedSubscriptionAvailable 241,PropContentType "",PropReceiveMaximum 8513,PropRetainAvailable 77]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x3b, 0xd7, 0x1,  0x0,  0x9,  0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2, 0x28, 0x41, 0xc6,
                   0x1,  0x21, 0x2a, 0x41, 0x21, 0x5d, 0xd6, 0x2,  0x0,  0x0,  0x5c, 0x57, 0x26, 0x0,  0x3,  0x48, 0xad,
                   0x13, 0x0,  0x10, 0xe1, 0x18, 0x7c, 0x77, 0x93, 0xa8, 0x4b, 0xf7, 0x28, 0x7d, 0x20, 0x84, 0xc4, 0x9,
                   0x5e, 0x4c, 0x2,  0x0,  0x0,  0x41, 0x3,  0x28, 0xa3, 0x18, 0x0,  0x0,  0x58, 0xf2, 0x26, 0x0,  0xa,
                   0x6d, 0x31, 0x41, 0xa1, 0x35, 0x65, 0x9f, 0x2d, 0xd7, 0xb2, 0x0,  0x12, 0x3c, 0xce, 0x4c, 0x7b, 0x7f,
                   0xb1, 0x4d, 0x5e, 0x6d, 0x8e, 0x53, 0x16, 0xc8, 0x32, 0x9e, 0x12, 0x3a, 0xf2, 0x18, 0x0,  0x0,  0x6d,
                   0xca, 0x28, 0xdd, 0x22, 0x35, 0xe9, 0xb,  0xb,  0x18, 0x0,  0x0,  0x4d, 0xe8, 0x24, 0xba, 0x18, 0x0,
                   0x0,  0x17, 0x43, 0x11, 0x0,  0x0,  0x1a, 0x79, 0x11, 0x0,  0x0,  0x59, 0x71, 0x23, 0x18, 0x24, 0x25,
                   0x5d, 0x8,  0x0,  0x1c, 0xb1, 0xe8, 0x8a, 0xef, 0x98, 0xdb, 0x3b, 0xa4, 0xe5, 0x43, 0x97, 0x27, 0xe0,
                   0x37, 0xfb, 0xc7, 0xcc, 0x52, 0x2f, 0xe,  0xa,  0x75, 0x8e, 0x9e, 0xf,  0x11, 0x25, 0xe7, 0x11, 0x0,
                   0x0,  0x59, 0x94, 0x26, 0x0,  0x2,  0xbf, 0x70, 0x0,  0x1a, 0xc3, 0x12, 0xf0, 0x59, 0xb8, 0x5,  0x96,
                   0xa3, 0xb4, 0xad, 0xd9, 0xc6, 0x6,  0x61, 0x95, 0x4e, 0xfc, 0x5c, 0x2f, 0xb,  0xaa, 0xda, 0x20, 0x2c,
                   0xce, 0xa6, 0x2a, 0xf1, 0x3,  0x0,  0x0,  0x21, 0x21, 0x41, 0x25, 0x4d, 0xee, 0x86};
  uint8_t topic_bytes[] = {0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xee, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops1[] = {0xe1, 0x18, 0x7c, 0x77, 0x93, 0xa8, 0x4b, 0xf7,
                           0x28, 0x7d, 0x20, 0x84, 0xc4, 0x9,  0x5e, 0x4c};
  uint8_t bytesprops0[] = {0x48, 0xad, 0x13};
  uint8_t bytesprops3[] = {0x3c, 0xce, 0x4c, 0x7b, 0x7f, 0xb1, 0x4d, 0x5e, 0x6d,
                           0x8e, 0x53, 0x16, 0xc8, 0x32, 0x9e, 0x12, 0x3a, 0xf2};
  uint8_t bytesprops2[] = {0x6d, 0x31, 0x41, 0xa1, 0x35, 0x65, 0x9f, 0x2d, 0xd7, 0xb2};
  uint8_t bytesprops4[] = {0xb1, 0xe8, 0x8a, 0xef, 0x98, 0xdb, 0x3b, 0xa4, 0xe5, 0x43, 0x97, 0x27, 0xe0, 0x37,
                           0xfb, 0xc7, 0xcc, 0x52, 0x2f, 0xe,  0xa,  0x75, 0x8e, 0x9e, 0xf,  0x11, 0x25, 0xe7};
  uint8_t bytesprops6[] = {0xc3, 0x12, 0xf0, 0x59, 0xb8, 0x5,  0x96, 0xa3, 0xb4, 0xad, 0xd9, 0xc6, 0x6,
                           0x61, 0x95, 0x4e, 0xfc, 0x5c, 0x2f, 0xb,  0xaa, 0xda, 0x20, 0x2c, 0xce, 0xa6};
  uint8_t bytesprops5[] = {0xbf, 0x70};
  uint8_t bytesprops7[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10817}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24022}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23639}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops0}, .v = {16, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16643}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22770}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {18, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28106}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13801}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19944}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5955}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6777}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22897}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6180}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22932}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops5}, .v = {26, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8513}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 77}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10305, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[Q\172\216\185:|\162\194", _pubPktID
// = 10305, _pubBody = "\238\134", _pubProps = [PropReceiveMaximum 10817,PropReceiveMaximum
// 24022,PropMessageExpiryInterval 23639,PropUserProperty "H\173\DC3" "\225\CAN|w\147\168K\247(}
// \132\196\t^L",PropMessageExpiryInterval 16643,PropWildcardSubscriptionAvailable 163,PropWillDelayInterval
// 22770,PropUserProperty "m1A\161\&5e\159-\215\178"
// "<\206L{\DEL\177M^m\142S\SYN\200\&2\158\DC2:\242",PropWillDelayInterval 28106,PropWildcardSubscriptionAvailable
// 221,PropTopicAliasMaximum 13801,PropSubscriptionIdentifier 11,PropWillDelayInterval 19944,PropMaximumQoS
// 186,PropWillDelayInterval 5955,PropSessionExpiryInterval 6777,PropSessionExpiryInterval 22897,PropTopicAlias
// 6180,PropRetainAvailable 93,PropResponseTopic
// "\177\232\138\239\152\219;\164\229C\151'\224\&7\251\199\204R/\SO\nu\142\158\SI\DC1%\231",PropSessionExpiryInterval
// 22932,PropUserProperty "\191p" "\195\DC2\240Y\184\ENQ\150\163\180\173\217\198\ACKa\149N\252\\/\v\170\218
// ,\206\166",PropSharedSubscriptionAvailable 241,PropContentType "",PropReceiveMaximum 8513,PropRetainAvailable 77]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x3b, 0xd7, 0x1,  0x0,  0x9,  0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2, 0x28, 0x41, 0xc6,
                   0x1,  0x21, 0x2a, 0x41, 0x21, 0x5d, 0xd6, 0x2,  0x0,  0x0,  0x5c, 0x57, 0x26, 0x0,  0x3,  0x48, 0xad,
                   0x13, 0x0,  0x10, 0xe1, 0x18, 0x7c, 0x77, 0x93, 0xa8, 0x4b, 0xf7, 0x28, 0x7d, 0x20, 0x84, 0xc4, 0x9,
                   0x5e, 0x4c, 0x2,  0x0,  0x0,  0x41, 0x3,  0x28, 0xa3, 0x18, 0x0,  0x0,  0x58, 0xf2, 0x26, 0x0,  0xa,
                   0x6d, 0x31, 0x41, 0xa1, 0x35, 0x65, 0x9f, 0x2d, 0xd7, 0xb2, 0x0,  0x12, 0x3c, 0xce, 0x4c, 0x7b, 0x7f,
                   0xb1, 0x4d, 0x5e, 0x6d, 0x8e, 0x53, 0x16, 0xc8, 0x32, 0x9e, 0x12, 0x3a, 0xf2, 0x18, 0x0,  0x0,  0x6d,
                   0xca, 0x28, 0xdd, 0x22, 0x35, 0xe9, 0xb,  0xb,  0x18, 0x0,  0x0,  0x4d, 0xe8, 0x24, 0xba, 0x18, 0x0,
                   0x0,  0x17, 0x43, 0x11, 0x0,  0x0,  0x1a, 0x79, 0x11, 0x0,  0x0,  0x59, 0x71, 0x23, 0x18, 0x24, 0x25,
                   0x5d, 0x8,  0x0,  0x1c, 0xb1, 0xe8, 0x8a, 0xef, 0x98, 0xdb, 0x3b, 0xa4, 0xe5, 0x43, 0x97, 0x27, 0xe0,
                   0x37, 0xfb, 0xc7, 0xcc, 0x52, 0x2f, 0xe,  0xa,  0x75, 0x8e, 0x9e, 0xf,  0x11, 0x25, 0xe7, 0x11, 0x0,
                   0x0,  0x59, 0x94, 0x26, 0x0,  0x2,  0xbf, 0x70, 0x0,  0x1a, 0xc3, 0x12, 0xf0, 0x59, 0xb8, 0x5,  0x96,
                   0xa3, 0xb4, 0xad, 0xd9, 0xc6, 0x6,  0x61, 0x95, 0x4e, 0xfc, 0x5c, 0x2f, 0xb,  0xaa, 0xda, 0x20, 0x2c,
                   0xce, 0xa6, 0x2a, 0xf1, 0x3,  0x0,  0x0,  0x21, 0x21, 0x41, 0x25, 0x4d, 0xee, 0x86};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x51, 0xac, 0xd8, 0xb9, 0x3a, 0x7c, 0xa2, 0xc2};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xee, 0x86};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10305);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ESC\169\150\136?o\142\230\b",
// _pubPktID = 0, _pubBody = "\203\ENQ\254)\215\158R\255\SOH\SOHM8\245\234\222t\225\187\175", _pubProps =
// [PropSessionExpiryInterval 22238,PropAssignedClientIdentifier
// "\223\149\250\ETB\ETB\143\248\212\164\252\226\221\172\237\180\&1\255\219\198\140\182\224\253\210\b",PropSharedSubscriptionAvailable
// 194,PropContentType "8!",PropPayloadFormatIndicator 206,PropContentType
// "M\176\177\DC2\aN\210\NAK\207c\144\219\EMH[",PropResponseInformation "S",PropReceiveMaximum
// 24749,PropTopicAliasMaximum 10148,PropRetainAvailable 247,PropMaximumQoS 100,PropReceiveMaximum
// 2658,PropPayloadFormatIndicator 72,PropReceiveMaximum 18557,PropWillDelayInterval 16949,PropAssignedClientIdentifier
// "bz\192\140\235\209<\DLE\174\237P\184h",PropSessionExpiryInterval 3362,PropServerReference
// "T\178\147.\154\&4u\178\217\222\DLE\131\132\142a\DC4\224\158\215\224}\SYN\208\175p\203\240\240p'",PropSharedSubscriptionAvailable
// 250,PropTopicAliasMaximum 27083,PropMaximumQoS 140,PropTopicAliasMaximum 17705]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x31, 0xb7, 0x1,  0x0,  0x9,  0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8,  0x97, 0x1,  0x11,
                   0x0,  0x0,  0x56, 0xde, 0x12, 0x0,  0x19, 0xdf, 0x95, 0xfa, 0x17, 0x17, 0x8f, 0xf8, 0xd4, 0xa4, 0xfc,
                   0xe2, 0xdd, 0xac, 0xed, 0xb4, 0x31, 0xff, 0xdb, 0xc6, 0x8c, 0xb6, 0xe0, 0xfd, 0xd2, 0x8,  0x2a, 0xc2,
                   0x3,  0x0,  0x2,  0x38, 0x21, 0x1,  0xce, 0x3,  0x0,  0xf,  0x4d, 0xb0, 0xb1, 0x12, 0x7,  0x4e, 0xd2,
                   0x15, 0xcf, 0x63, 0x90, 0xdb, 0x19, 0x48, 0x5b, 0x1a, 0x0,  0x1,  0x53, 0x21, 0x60, 0xad, 0x22, 0x27,
                   0xa4, 0x25, 0xf7, 0x24, 0x64, 0x21, 0xa,  0x62, 0x1,  0x48, 0x21, 0x48, 0x7d, 0x18, 0x0,  0x0,  0x42,
                   0x35, 0x12, 0x0,  0xd,  0x62, 0x7a, 0xc0, 0x8c, 0xeb, 0xd1, 0x3c, 0x10, 0xae, 0xed, 0x50, 0xb8, 0x68,
                   0x11, 0x0,  0x0,  0xd,  0x22, 0x1c, 0x0,  0x1e, 0x54, 0xb2, 0x93, 0x2e, 0x9a, 0x34, 0x75, 0xb2, 0xd9,
                   0xde, 0x10, 0x83, 0x84, 0x8e, 0x61, 0x14, 0xe0, 0x9e, 0xd7, 0xe0, 0x7d, 0x16, 0xd0, 0xaf, 0x70, 0xcb,
                   0xf0, 0xf0, 0x70, 0x27, 0x2a, 0xfa, 0x22, 0x69, 0xcb, 0x24, 0x8c, 0x22, 0x45, 0x29, 0xcb, 0x5,  0xfe,
                   0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1,  0x1,  0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  uint8_t topic_bytes[] = {0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcb, 0x5,  0xfe, 0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1, 0x1,
                         0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xdf, 0x95, 0xfa, 0x17, 0x17, 0x8f, 0xf8, 0xd4, 0xa4, 0xfc, 0xe2, 0xdd, 0xac,
                           0xed, 0xb4, 0x31, 0xff, 0xdb, 0xc6, 0x8c, 0xb6, 0xe0, 0xfd, 0xd2, 0x8};
  uint8_t bytesprops1[] = {0x38, 0x21};
  uint8_t bytesprops2[] = {0x4d, 0xb0, 0xb1, 0x12, 0x7, 0x4e, 0xd2, 0x15, 0xcf, 0x63, 0x90, 0xdb, 0x19, 0x48, 0x5b};
  uint8_t bytesprops3[] = {0x53};
  uint8_t bytesprops4[] = {0x62, 0x7a, 0xc0, 0x8c, 0xeb, 0xd1, 0x3c, 0x10, 0xae, 0xed, 0x50, 0xb8, 0x68};
  uint8_t bytesprops5[] = {0x54, 0xb2, 0x93, 0x2e, 0x9a, 0x34, 0x75, 0xb2, 0xd9, 0xde, 0x10, 0x83, 0x84, 0x8e, 0x61,
                           0x14, 0xe0, 0x9e, 0xd7, 0xe0, 0x7d, 0x16, 0xd0, 0xaf, 0x70, 0xcb, 0xf0, 0xf0, 0x70, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22238}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24749}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10148}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2658}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18557}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16949}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3362}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27083}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17705}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\ESC\169\150\136?o\142\230\b",
// _pubPktID = 0, _pubBody = "\203\ENQ\254)\215\158R\255\SOH\SOHM8\245\234\222t\225\187\175", _pubProps =
// [PropSessionExpiryInterval 22238,PropAssignedClientIdentifier
// "\223\149\250\ETB\ETB\143\248\212\164\252\226\221\172\237\180\&1\255\219\198\140\182\224\253\210\b",PropSharedSubscriptionAvailable
// 194,PropContentType "8!",PropPayloadFormatIndicator 206,PropContentType
// "M\176\177\DC2\aN\210\NAK\207c\144\219\EMH[",PropResponseInformation "S",PropReceiveMaximum
// 24749,PropTopicAliasMaximum 10148,PropRetainAvailable 247,PropMaximumQoS 100,PropReceiveMaximum
// 2658,PropPayloadFormatIndicator 72,PropReceiveMaximum 18557,PropWillDelayInterval 16949,PropAssignedClientIdentifier
// "bz\192\140\235\209<\DLE\174\237P\184h",PropSessionExpiryInterval 3362,PropServerReference
// "T\178\147.\154\&4u\178\217\222\DLE\131\132\142a\DC4\224\158\215\224}\SYN\208\175p\203\240\240p'",PropSharedSubscriptionAvailable
// 250,PropTopicAliasMaximum 27083,PropMaximumQoS 140,PropTopicAliasMaximum 17705]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x31, 0xb7, 0x1,  0x0,  0x9,  0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8,  0x97, 0x1,  0x11,
                   0x0,  0x0,  0x56, 0xde, 0x12, 0x0,  0x19, 0xdf, 0x95, 0xfa, 0x17, 0x17, 0x8f, 0xf8, 0xd4, 0xa4, 0xfc,
                   0xe2, 0xdd, 0xac, 0xed, 0xb4, 0x31, 0xff, 0xdb, 0xc6, 0x8c, 0xb6, 0xe0, 0xfd, 0xd2, 0x8,  0x2a, 0xc2,
                   0x3,  0x0,  0x2,  0x38, 0x21, 0x1,  0xce, 0x3,  0x0,  0xf,  0x4d, 0xb0, 0xb1, 0x12, 0x7,  0x4e, 0xd2,
                   0x15, 0xcf, 0x63, 0x90, 0xdb, 0x19, 0x48, 0x5b, 0x1a, 0x0,  0x1,  0x53, 0x21, 0x60, 0xad, 0x22, 0x27,
                   0xa4, 0x25, 0xf7, 0x24, 0x64, 0x21, 0xa,  0x62, 0x1,  0x48, 0x21, 0x48, 0x7d, 0x18, 0x0,  0x0,  0x42,
                   0x35, 0x12, 0x0,  0xd,  0x62, 0x7a, 0xc0, 0x8c, 0xeb, 0xd1, 0x3c, 0x10, 0xae, 0xed, 0x50, 0xb8, 0x68,
                   0x11, 0x0,  0x0,  0xd,  0x22, 0x1c, 0x0,  0x1e, 0x54, 0xb2, 0x93, 0x2e, 0x9a, 0x34, 0x75, 0xb2, 0xd9,
                   0xde, 0x10, 0x83, 0x84, 0x8e, 0x61, 0x14, 0xe0, 0x9e, 0xd7, 0xe0, 0x7d, 0x16, 0xd0, 0xaf, 0x70, 0xcb,
                   0xf0, 0xf0, 0x70, 0x27, 0x2a, 0xfa, 0x22, 0x69, 0xcb, 0x24, 0x8c, 0x22, 0x45, 0x29, 0xcb, 0x5,  0xfe,
                   0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1,  0x1,  0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1b, 0xa9, 0x96, 0x88, 0x3f, 0x6f, 0x8e, 0xe6, 0x8};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x5,  0xfe, 0x29, 0xd7, 0x9e, 0x52, 0xff, 0x1, 0x1,
                              0x4d, 0x38, 0xf5, 0xea, 0xde, 0x74, 0xe1, 0xbb, 0xaf};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\186\b\221\f\178D\188&~\248P\ENQ\134\167\n\241\196v\203\245_\206\177\208\SI\FS", _pubPktID = 16783, _pubBody = "",
// _pubProps = [PropServerKeepAlive 27404,PropReceiveMaximum 26000,PropRequestResponseInformation
// 194,PropMessageExpiryInterval 12227,PropMessageExpiryInterval 3446,PropTopicAlias 16275,PropServerReference
// "R\239\GS\FS\185\167(",PropTopicAliasMaximum 32156,PropResponseInformation
// "\DC3\217\133#\ACKa\130>i\191o\US\240\162\EM\EMN\241\&02c\244-\143/\225",PropWillDelayInterval
// 3283,PropRetainAvailable 193,PropServerReference "\b\147\130\231\SI\200&\v.2T\164T\176\186\GS",PropMaximumQoS 109]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x3a, 0x7a, 0x0,  0x1a, 0xba, 0x8,  0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5,
                   0x86, 0xa7, 0xa,  0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf,  0x1c, 0x41, 0x8f,
                   0x5b, 0x13, 0x6b, 0xc,  0x21, 0x65, 0x90, 0x19, 0xc2, 0x2,  0x0,  0x0,  0x2f, 0xc3, 0x2,  0x0,
                   0x0,  0xd,  0x76, 0x23, 0x3f, 0x93, 0x1c, 0x0,  0x7,  0x52, 0xef, 0x1d, 0x1c, 0xb9, 0xa7, 0x28,
                   0x22, 0x7d, 0x9c, 0x1a, 0x0,  0x1a, 0x13, 0xd9, 0x85, 0x23, 0x6,  0x61, 0x82, 0x3e, 0x69, 0xbf,
                   0x6f, 0x1f, 0xf0, 0xa2, 0x19, 0x19, 0x4e, 0xf1, 0x30, 0x32, 0x63, 0xf4, 0x2d, 0x8f, 0x2f, 0xe1,
                   0x18, 0x0,  0x0,  0xc,  0xd3, 0x25, 0xc1, 0x1c, 0x0,  0x10, 0x8,  0x93, 0x82, 0xe7, 0xf,  0xc8,
                   0x26, 0xb,  0x2e, 0x32, 0x54, 0xa4, 0x54, 0xb0, 0xba, 0x1d, 0x24, 0x6d};
  uint8_t topic_bytes[] = {0xba, 0x8, 0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5, 0x86,
                           0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf, 0x1c};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x52, 0xef, 0x1d, 0x1c, 0xb9, 0xa7, 0x28};
  uint8_t bytesprops1[] = {0x13, 0xd9, 0x85, 0x23, 0x6,  0x61, 0x82, 0x3e, 0x69, 0xbf, 0x6f, 0x1f, 0xf0,
                           0xa2, 0x19, 0x19, 0x4e, 0xf1, 0x30, 0x32, 0x63, 0xf4, 0x2d, 0x8f, 0x2f, 0xe1};
  uint8_t bytesprops2[] = {0x8, 0x93, 0x82, 0xe7, 0xf, 0xc8, 0x26, 0xb, 0x2e, 0x32, 0x54, 0xa4, 0x54, 0xb0, 0xba, 0x1d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27404}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26000}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12227}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3446}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16275}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32156}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3283}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 109}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16783, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\186\b\221\f\178D\188&~\248P\ENQ\134\167\n\241\196v\203\245_\206\177\208\SI\FS", _pubPktID = 16783, _pubBody = "",
// _pubProps = [PropServerKeepAlive 27404,PropReceiveMaximum 26000,PropRequestResponseInformation
// 194,PropMessageExpiryInterval 12227,PropMessageExpiryInterval 3446,PropTopicAlias 16275,PropServerReference
// "R\239\GS\FS\185\167(",PropTopicAliasMaximum 32156,PropResponseInformation
// "\DC3\217\133#\ACKa\130>i\191o\US\240\162\EM\EMN\241\&02c\244-\143/\225",PropWillDelayInterval
// 3283,PropRetainAvailable 193,PropServerReference "\b\147\130\231\SI\200&\v.2T\164T\176\186\GS",PropMaximumQoS 109]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x3a, 0x7a, 0x0,  0x1a, 0xba, 0x8,  0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5,
                   0x86, 0xa7, 0xa,  0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf,  0x1c, 0x41, 0x8f,
                   0x5b, 0x13, 0x6b, 0xc,  0x21, 0x65, 0x90, 0x19, 0xc2, 0x2,  0x0,  0x0,  0x2f, 0xc3, 0x2,  0x0,
                   0x0,  0xd,  0x76, 0x23, 0x3f, 0x93, 0x1c, 0x0,  0x7,  0x52, 0xef, 0x1d, 0x1c, 0xb9, 0xa7, 0x28,
                   0x22, 0x7d, 0x9c, 0x1a, 0x0,  0x1a, 0x13, 0xd9, 0x85, 0x23, 0x6,  0x61, 0x82, 0x3e, 0x69, 0xbf,
                   0x6f, 0x1f, 0xf0, 0xa2, 0x19, 0x19, 0x4e, 0xf1, 0x30, 0x32, 0x63, 0xf4, 0x2d, 0x8f, 0x2f, 0xe1,
                   0x18, 0x0,  0x0,  0xc,  0xd3, 0x25, 0xc1, 0x1c, 0x0,  0x10, 0x8,  0x93, 0x82, 0xe7, 0xf,  0xc8,
                   0x26, 0xb,  0x2e, 0x32, 0x54, 0xa4, 0x54, 0xb0, 0xba, 0x1d, 0x24, 0x6d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xba, 0x8, 0xdd, 0xc,  0xb2, 0x44, 0xbc, 0x26, 0x7e, 0xf8, 0x50, 0x5, 0x86,
                               0xa7, 0xa, 0xf1, 0xc4, 0x76, 0xcb, 0xf5, 0x5f, 0xce, 0xb1, 0xd0, 0xf, 0x1c};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16783);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ";V\193\141}\175x\217i^\231g\247\v\203\183_\151\EM\\", _pubPktID = 0, _pubBody =
// "\162\166\173\187\NAK){\138\210Q^p+\SI\145Q\165\GS\166\249CG", _pubProps = [PropResponseTopic
// "\DC1",PropAssignedClientIdentifier "\241\167*\EM\224*\174z\a\192\192\236_\177G\STX+\224\213/\SI",PropServerReference
// ">\191\&29\210.y\158\162\248b\185\171\255\SUBs\SI\167\243\142\&0@\210\DC1\214\132\SYNl`",PropMessageExpiryInterval
// 19534,PropTopicAliasMaximum 1048,PropCorrelationData
// "\190\248P&\175Y\199\166yC\188\237\252\&7Q2\215d",PropPayloadFormatIndicator 150,PropRequestProblemInformation
// 178,PropWildcardSubscriptionAvailable 154,PropWildcardSubscriptionAvailable 38,PropTopicAlias
// 4361,PropWillDelayInterval 18009,PropMaximumQoS 185,PropAuthenticationMethod
// ",\172\253\251\160\243",PropSessionExpiryInterval 23756]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x31, 0xa6, 0x1,  0x0,  0x14, 0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e, 0xe7, 0x67,
                   0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c, 0x79, 0x8,  0x0,  0x1,  0x11, 0x12, 0x0,  0x15, 0xf1,
                   0xa7, 0x2a, 0x19, 0xe0, 0x2a, 0xae, 0x7a, 0x7,  0xc0, 0xc0, 0xec, 0x5f, 0xb1, 0x47, 0x2,  0x2b, 0xe0,
                   0xd5, 0x2f, 0xf,  0x1c, 0x0,  0x1d, 0x3e, 0xbf, 0x32, 0x39, 0xd2, 0x2e, 0x79, 0x9e, 0xa2, 0xf8, 0x62,
                   0xb9, 0xab, 0xff, 0x1a, 0x73, 0xf,  0xa7, 0xf3, 0x8e, 0x30, 0x40, 0xd2, 0x11, 0xd6, 0x84, 0x16, 0x6c,
                   0x60, 0x2,  0x0,  0x0,  0x4c, 0x4e, 0x22, 0x4,  0x18, 0x9,  0x0,  0x12, 0xbe, 0xf8, 0x50, 0x26, 0xaf,
                   0x59, 0xc7, 0xa6, 0x79, 0x43, 0xbc, 0xed, 0xfc, 0x37, 0x51, 0x32, 0xd7, 0x64, 0x1,  0x96, 0x17, 0xb2,
                   0x28, 0x9a, 0x28, 0x26, 0x23, 0x11, 0x9,  0x18, 0x0,  0x0,  0x46, 0x59, 0x24, 0xb9, 0x15, 0x0,  0x6,
                   0x2c, 0xac, 0xfd, 0xfb, 0xa0, 0xf3, 0x11, 0x0,  0x0,  0x5c, 0xcc, 0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29,
                   0x7b, 0x8a, 0xd2, 0x51, 0x5e, 0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  uint8_t topic_bytes[] = {0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e,
                           0xe7, 0x67, 0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a, 0xd2, 0x51, 0x5e,
                         0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x11};
  uint8_t bytesprops1[] = {0xf1, 0xa7, 0x2a, 0x19, 0xe0, 0x2a, 0xae, 0x7a, 0x7,  0xc0, 0xc0,
                           0xec, 0x5f, 0xb1, 0x47, 0x2,  0x2b, 0xe0, 0xd5, 0x2f, 0xf};
  uint8_t bytesprops2[] = {0x3e, 0xbf, 0x32, 0x39, 0xd2, 0x2e, 0x79, 0x9e, 0xa2, 0xf8, 0x62, 0xb9, 0xab, 0xff, 0x1a,
                           0x73, 0xf,  0xa7, 0xf3, 0x8e, 0x30, 0x40, 0xd2, 0x11, 0xd6, 0x84, 0x16, 0x6c, 0x60};
  uint8_t bytesprops3[] = {0xbe, 0xf8, 0x50, 0x26, 0xaf, 0x59, 0xc7, 0xa6, 0x79,
                           0x43, 0xbc, 0xed, 0xfc, 0x37, 0x51, 0x32, 0xd7, 0x64};
  uint8_t bytesprops4[] = {0x2c, 0xac, 0xfd, 0xfb, 0xa0, 0xf3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19534}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1048}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4361}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18009}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23756}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ";V\193\141}\175x\217i^\231g\247\v\203\183_\151\EM\\", _pubPktID = 0, _pubBody =
// "\162\166\173\187\NAK){\138\210Q^p+\SI\145Q\165\GS\166\249CG", _pubProps = [PropResponseTopic
// "\DC1",PropAssignedClientIdentifier "\241\167*\EM\224*\174z\a\192\192\236_\177G\STX+\224\213/\SI",PropServerReference
// ">\191\&29\210.y\158\162\248b\185\171\255\SUBs\SI\167\243\142\&0@\210\DC1\214\132\SYNl`",PropMessageExpiryInterval
// 19534,PropTopicAliasMaximum 1048,PropCorrelationData
// "\190\248P&\175Y\199\166yC\188\237\252\&7Q2\215d",PropPayloadFormatIndicator 150,PropRequestProblemInformation
// 178,PropWildcardSubscriptionAvailable 154,PropWildcardSubscriptionAvailable 38,PropTopicAlias
// 4361,PropWillDelayInterval 18009,PropMaximumQoS 185,PropAuthenticationMethod
// ",\172\253\251\160\243",PropSessionExpiryInterval 23756]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x31, 0xa6, 0x1,  0x0,  0x14, 0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e, 0xe7, 0x67,
                   0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c, 0x79, 0x8,  0x0,  0x1,  0x11, 0x12, 0x0,  0x15, 0xf1,
                   0xa7, 0x2a, 0x19, 0xe0, 0x2a, 0xae, 0x7a, 0x7,  0xc0, 0xc0, 0xec, 0x5f, 0xb1, 0x47, 0x2,  0x2b, 0xe0,
                   0xd5, 0x2f, 0xf,  0x1c, 0x0,  0x1d, 0x3e, 0xbf, 0x32, 0x39, 0xd2, 0x2e, 0x79, 0x9e, 0xa2, 0xf8, 0x62,
                   0xb9, 0xab, 0xff, 0x1a, 0x73, 0xf,  0xa7, 0xf3, 0x8e, 0x30, 0x40, 0xd2, 0x11, 0xd6, 0x84, 0x16, 0x6c,
                   0x60, 0x2,  0x0,  0x0,  0x4c, 0x4e, 0x22, 0x4,  0x18, 0x9,  0x0,  0x12, 0xbe, 0xf8, 0x50, 0x26, 0xaf,
                   0x59, 0xc7, 0xa6, 0x79, 0x43, 0xbc, 0xed, 0xfc, 0x37, 0x51, 0x32, 0xd7, 0x64, 0x1,  0x96, 0x17, 0xb2,
                   0x28, 0x9a, 0x28, 0x26, 0x23, 0x11, 0x9,  0x18, 0x0,  0x0,  0x46, 0x59, 0x24, 0xb9, 0x15, 0x0,  0x6,
                   0x2c, 0xac, 0xfd, 0xfb, 0xa0, 0xf3, 0x11, 0x0,  0x0,  0x5c, 0xcc, 0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29,
                   0x7b, 0x8a, 0xd2, 0x51, 0x5e, 0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0x56, 0xc1, 0x8d, 0x7d, 0xaf, 0x78, 0xd9, 0x69, 0x5e,
                               0xe7, 0x67, 0xf7, 0xb,  0xcb, 0xb7, 0x5f, 0x97, 0x19, 0x5c};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa2, 0xa6, 0xad, 0xbb, 0x15, 0x29, 0x7b, 0x8a, 0xd2, 0x51, 0x5e,
                              0x70, 0x2b, 0xf,  0x91, 0x51, 0xa5, 0x1d, 0xa6, 0xf9, 0x43, 0x47};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\141\253\251\DC4\210]", _pubPktID =
// 0, _pubBody = "a#\200\US\234\221\168\235\213|\205w", _pubProps = [PropResponseTopic
// "\EM\166\243\154!\131e6!cq%;\221x\190J\250\206\170\189\a\172G\220c\195\US?\186",PropMessageExpiryInterval
// 9099,PropTopicAliasMaximum 17515,PropUserProperty "\184\130kV\184c\196:'\ESC\DC4\131\206@\133"
// "\197\140st\149{3W\157\FS\NUL\153\128\133+y\150)Gcz^l\140a\161<",PropTopicAliasMaximum 6907,PropServerKeepAlive
// 14769,PropPayloadFormatIndicator 38,PropAuthenticationMethod
// "\240\ETX\248\&6gl\v\216\200\212D\RSe\170\198\&8[(\GSx",PropMaximumPacketSize 29348,PropAuthenticationData
// "\178\153\146_\192=\f\143\178?4Ck/M",PropRequestProblemInformation 49,PropCorrelationData
// "\ETXd\nV\130\181L\167\137\251\174I\199\&2V\130\215\225\r\209<d0",PropCorrelationData
// "\179\160\167\161)\CAN\171\181#\213\216\152\157|b\140\216\200\145\&9G\150d\155|9\ESC\255O",PropAuthenticationData
// "\248\201M\235\\\226\&4\194S\205\159h\139\b\129\f\149u\161T\NAKG\186k\SI\247\181\215\152\244",PropTopicAliasMaximum
// 7990,PropPayloadFormatIndicator 157,PropRequestProblemInformation 26,PropSubscriptionIdentifierAvailable
// 175,PropSubscriptionIdentifier 0,PropUserProperty "b\bI\DC3\153e\205\203\192\210\ENQ!\"\146\156\181|"
// "\tPa;\DLE\\\DC4\168\185#TJ\150\140\EOT\136]\200\243t.<\SYN\210B; ",PropResponseInformation
// "\136\&1\170\145$\252\SYN\152\195\172I\178yB\ri\219\197\178\182\184\181\198\226\208",PropResponseTopic
// "_\SI>k\141\162U\181"]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x31, 0xe4, 0x2,  0x0,  0x6,  0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d, 0xce, 0x2,  0x8,  0x0,  0x1e, 0x19, 0xa6, 0xf3,
      0x9a, 0x21, 0x83, 0x65, 0x36, 0x21, 0x63, 0x71, 0x25, 0x3b, 0xdd, 0x78, 0xbe, 0x4a, 0xfa, 0xce, 0xaa, 0xbd, 0x7,
      0xac, 0x47, 0xdc, 0x63, 0xc3, 0x1f, 0x3f, 0xba, 0x2,  0x0,  0x0,  0x23, 0x8b, 0x22, 0x44, 0x6b, 0x26, 0x0,  0xf,
      0xb8, 0x82, 0x6b, 0x56, 0xb8, 0x63, 0xc4, 0x3a, 0x27, 0x1b, 0x14, 0x83, 0xce, 0x40, 0x85, 0x0,  0x1b, 0xc5, 0x8c,
      0x73, 0x74, 0x95, 0x7b, 0x33, 0x57, 0x9d, 0x1c, 0x0,  0x99, 0x80, 0x85, 0x2b, 0x79, 0x96, 0x29, 0x47, 0x63, 0x7a,
      0x5e, 0x6c, 0x8c, 0x61, 0xa1, 0x3c, 0x22, 0x1a, 0xfb, 0x13, 0x39, 0xb1, 0x1,  0x26, 0x15, 0x0,  0x14, 0xf0, 0x3,
      0xf8, 0x36, 0x67, 0x6c, 0xb,  0xd8, 0xc8, 0xd4, 0x44, 0x1e, 0x65, 0xaa, 0xc6, 0x38, 0x5b, 0x28, 0x1d, 0x78, 0x27,
      0x0,  0x0,  0x72, 0xa4, 0x16, 0x0,  0xf,  0xb2, 0x99, 0x92, 0x5f, 0xc0, 0x3d, 0xc,  0x8f, 0xb2, 0x3f, 0x34, 0x43,
      0x6b, 0x2f, 0x4d, 0x17, 0x31, 0x9,  0x0,  0x17, 0x3,  0x64, 0xa,  0x56, 0x82, 0xb5, 0x4c, 0xa7, 0x89, 0xfb, 0xae,
      0x49, 0xc7, 0x32, 0x56, 0x82, 0xd7, 0xe1, 0xd,  0xd1, 0x3c, 0x64, 0x30, 0x9,  0x0,  0x1d, 0xb3, 0xa0, 0xa7, 0xa1,
      0x29, 0x18, 0xab, 0xb5, 0x23, 0xd5, 0xd8, 0x98, 0x9d, 0x7c, 0x62, 0x8c, 0xd8, 0xc8, 0x91, 0x39, 0x47, 0x96, 0x64,
      0x9b, 0x7c, 0x39, 0x1b, 0xff, 0x4f, 0x16, 0x0,  0x1e, 0xf8, 0xc9, 0x4d, 0xeb, 0x5c, 0xe2, 0x34, 0xc2, 0x53, 0xcd,
      0x9f, 0x68, 0x8b, 0x8,  0x81, 0xc,  0x95, 0x75, 0xa1, 0x54, 0x15, 0x47, 0xba, 0x6b, 0xf,  0xf7, 0xb5, 0xd7, 0x98,
      0xf4, 0x22, 0x1f, 0x36, 0x1,  0x9d, 0x17, 0x1a, 0x29, 0xaf, 0xb,  0x0,  0x26, 0x0,  0x11, 0x62, 0x8,  0x49, 0x13,
      0x99, 0x65, 0xcd, 0xcb, 0xc0, 0xd2, 0x5,  0x21, 0x22, 0x92, 0x9c, 0xb5, 0x7c, 0x0,  0x1b, 0x9,  0x50, 0x61, 0x3b,
      0x10, 0x5c, 0x14, 0xa8, 0xb9, 0x23, 0x54, 0x4a, 0x96, 0x8c, 0x4,  0x88, 0x5d, 0xc8, 0xf3, 0x74, 0x2e, 0x3c, 0x16,
      0xd2, 0x42, 0x3b, 0x20, 0x1a, 0x0,  0x19, 0x88, 0x31, 0xaa, 0x91, 0x24, 0xfc, 0x16, 0x98, 0xc3, 0xac, 0x49, 0xb2,
      0x79, 0x42, 0xd,  0x69, 0xdb, 0xc5, 0xb2, 0xb6, 0xb8, 0xb5, 0xc6, 0xe2, 0xd0, 0x8,  0x0,  0x8,  0x5f, 0xf,  0x3e,
      0x6b, 0x8d, 0xa2, 0x55, 0xb5, 0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  uint8_t topic_bytes[] = {0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x19, 0xa6, 0xf3, 0x9a, 0x21, 0x83, 0x65, 0x36, 0x21, 0x63, 0x71, 0x25, 0x3b, 0xdd, 0x78,
                           0xbe, 0x4a, 0xfa, 0xce, 0xaa, 0xbd, 0x7,  0xac, 0x47, 0xdc, 0x63, 0xc3, 0x1f, 0x3f, 0xba};
  uint8_t bytesprops2[] = {0xc5, 0x8c, 0x73, 0x74, 0x95, 0x7b, 0x33, 0x57, 0x9d, 0x1c, 0x0,  0x99, 0x80, 0x85,
                           0x2b, 0x79, 0x96, 0x29, 0x47, 0x63, 0x7a, 0x5e, 0x6c, 0x8c, 0x61, 0xa1, 0x3c};
  uint8_t bytesprops1[] = {0xb8, 0x82, 0x6b, 0x56, 0xb8, 0x63, 0xc4, 0x3a, 0x27, 0x1b, 0x14, 0x83, 0xce, 0x40, 0x85};
  uint8_t bytesprops3[] = {0xf0, 0x3,  0xf8, 0x36, 0x67, 0x6c, 0xb,  0xd8, 0xc8, 0xd4,
                           0x44, 0x1e, 0x65, 0xaa, 0xc6, 0x38, 0x5b, 0x28, 0x1d, 0x78};
  uint8_t bytesprops4[] = {0xb2, 0x99, 0x92, 0x5f, 0xc0, 0x3d, 0xc, 0x8f, 0xb2, 0x3f, 0x34, 0x43, 0x6b, 0x2f, 0x4d};
  uint8_t bytesprops5[] = {0x3,  0x64, 0xa,  0x56, 0x82, 0xb5, 0x4c, 0xa7, 0x89, 0xfb, 0xae, 0x49,
                           0xc7, 0x32, 0x56, 0x82, 0xd7, 0xe1, 0xd,  0xd1, 0x3c, 0x64, 0x30};
  uint8_t bytesprops6[] = {0xb3, 0xa0, 0xa7, 0xa1, 0x29, 0x18, 0xab, 0xb5, 0x23, 0xd5, 0xd8, 0x98, 0x9d, 0x7c, 0x62,
                           0x8c, 0xd8, 0xc8, 0x91, 0x39, 0x47, 0x96, 0x64, 0x9b, 0x7c, 0x39, 0x1b, 0xff, 0x4f};
  uint8_t bytesprops7[] = {0xf8, 0xc9, 0x4d, 0xeb, 0x5c, 0xe2, 0x34, 0xc2, 0x53, 0xcd, 0x9f, 0x68, 0x8b, 0x8,  0x81,
                           0xc,  0x95, 0x75, 0xa1, 0x54, 0x15, 0x47, 0xba, 0x6b, 0xf,  0xf7, 0xb5, 0xd7, 0x98, 0xf4};
  uint8_t bytesprops9[] = {0x9, 0x50, 0x61, 0x3b, 0x10, 0x5c, 0x14, 0xa8, 0xb9, 0x23, 0x54, 0x4a, 0x96, 0x8c,
                           0x4, 0x88, 0x5d, 0xc8, 0xf3, 0x74, 0x2e, 0x3c, 0x16, 0xd2, 0x42, 0x3b, 0x20};
  uint8_t bytesprops8[] = {0x62, 0x8, 0x49, 0x13, 0x99, 0x65, 0xcd, 0xcb, 0xc0,
                           0xd2, 0x5, 0x21, 0x22, 0x92, 0x9c, 0xb5, 0x7c};
  uint8_t bytesprops10[] = {0x88, 0x31, 0xaa, 0x91, 0x24, 0xfc, 0x16, 0x98, 0xc3, 0xac, 0x49, 0xb2, 0x79,
                            0x42, 0xd,  0x69, 0xdb, 0xc5, 0xb2, 0xb6, 0xb8, 0xb5, 0xc6, 0xe2, 0xd0};
  uint8_t bytesprops11[] = {0x5f, 0xf, 0x3e, 0x6b, 0x8d, 0xa2, 0x55, 0xb5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9099}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17515}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6907}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14769}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29348}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7990}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops8}, .v = {27, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\141\253\251\DC4\210]", _pubPktID =
// 0, _pubBody = "a#\200\US\234\221\168\235\213|\205w", _pubProps = [PropResponseTopic
// "\EM\166\243\154!\131e6!cq%;\221x\190J\250\206\170\189\a\172G\220c\195\US?\186",PropMessageExpiryInterval
// 9099,PropTopicAliasMaximum 17515,PropUserProperty "\184\130kV\184c\196:'\ESC\DC4\131\206@\133"
// "\197\140st\149{3W\157\FS\NUL\153\128\133+y\150)Gcz^l\140a\161<",PropTopicAliasMaximum 6907,PropServerKeepAlive
// 14769,PropPayloadFormatIndicator 38,PropAuthenticationMethod
// "\240\ETX\248\&6gl\v\216\200\212D\RSe\170\198\&8[(\GSx",PropMaximumPacketSize 29348,PropAuthenticationData
// "\178\153\146_\192=\f\143\178?4Ck/M",PropRequestProblemInformation 49,PropCorrelationData
// "\ETXd\nV\130\181L\167\137\251\174I\199\&2V\130\215\225\r\209<d0",PropCorrelationData
// "\179\160\167\161)\CAN\171\181#\213\216\152\157|b\140\216\200\145\&9G\150d\155|9\ESC\255O",PropAuthenticationData
// "\248\201M\235\\\226\&4\194S\205\159h\139\b\129\f\149u\161T\NAKG\186k\SI\247\181\215\152\244",PropTopicAliasMaximum
// 7990,PropPayloadFormatIndicator 157,PropRequestProblemInformation 26,PropSubscriptionIdentifierAvailable
// 175,PropSubscriptionIdentifier 0,PropUserProperty "b\bI\DC3\153e\205\203\192\210\ENQ!\"\146\156\181|"
// "\tPa;\DLE\\\DC4\168\185#TJ\150\140\EOT\136]\200\243t.<\SYN\210B; ",PropResponseInformation
// "\136\&1\170\145$\252\SYN\152\195\172I\178yB\ri\219\197\178\182\184\181\198\226\208",PropResponseTopic
// "_\SI>k\141\162U\181"]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {
      0x31, 0xe4, 0x2,  0x0,  0x6,  0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d, 0xce, 0x2,  0x8,  0x0,  0x1e, 0x19, 0xa6, 0xf3,
      0x9a, 0x21, 0x83, 0x65, 0x36, 0x21, 0x63, 0x71, 0x25, 0x3b, 0xdd, 0x78, 0xbe, 0x4a, 0xfa, 0xce, 0xaa, 0xbd, 0x7,
      0xac, 0x47, 0xdc, 0x63, 0xc3, 0x1f, 0x3f, 0xba, 0x2,  0x0,  0x0,  0x23, 0x8b, 0x22, 0x44, 0x6b, 0x26, 0x0,  0xf,
      0xb8, 0x82, 0x6b, 0x56, 0xb8, 0x63, 0xc4, 0x3a, 0x27, 0x1b, 0x14, 0x83, 0xce, 0x40, 0x85, 0x0,  0x1b, 0xc5, 0x8c,
      0x73, 0x74, 0x95, 0x7b, 0x33, 0x57, 0x9d, 0x1c, 0x0,  0x99, 0x80, 0x85, 0x2b, 0x79, 0x96, 0x29, 0x47, 0x63, 0x7a,
      0x5e, 0x6c, 0x8c, 0x61, 0xa1, 0x3c, 0x22, 0x1a, 0xfb, 0x13, 0x39, 0xb1, 0x1,  0x26, 0x15, 0x0,  0x14, 0xf0, 0x3,
      0xf8, 0x36, 0x67, 0x6c, 0xb,  0xd8, 0xc8, 0xd4, 0x44, 0x1e, 0x65, 0xaa, 0xc6, 0x38, 0x5b, 0x28, 0x1d, 0x78, 0x27,
      0x0,  0x0,  0x72, 0xa4, 0x16, 0x0,  0xf,  0xb2, 0x99, 0x92, 0x5f, 0xc0, 0x3d, 0xc,  0x8f, 0xb2, 0x3f, 0x34, 0x43,
      0x6b, 0x2f, 0x4d, 0x17, 0x31, 0x9,  0x0,  0x17, 0x3,  0x64, 0xa,  0x56, 0x82, 0xb5, 0x4c, 0xa7, 0x89, 0xfb, 0xae,
      0x49, 0xc7, 0x32, 0x56, 0x82, 0xd7, 0xe1, 0xd,  0xd1, 0x3c, 0x64, 0x30, 0x9,  0x0,  0x1d, 0xb3, 0xa0, 0xa7, 0xa1,
      0x29, 0x18, 0xab, 0xb5, 0x23, 0xd5, 0xd8, 0x98, 0x9d, 0x7c, 0x62, 0x8c, 0xd8, 0xc8, 0x91, 0x39, 0x47, 0x96, 0x64,
      0x9b, 0x7c, 0x39, 0x1b, 0xff, 0x4f, 0x16, 0x0,  0x1e, 0xf8, 0xc9, 0x4d, 0xeb, 0x5c, 0xe2, 0x34, 0xc2, 0x53, 0xcd,
      0x9f, 0x68, 0x8b, 0x8,  0x81, 0xc,  0x95, 0x75, 0xa1, 0x54, 0x15, 0x47, 0xba, 0x6b, 0xf,  0xf7, 0xb5, 0xd7, 0x98,
      0xf4, 0x22, 0x1f, 0x36, 0x1,  0x9d, 0x17, 0x1a, 0x29, 0xaf, 0xb,  0x0,  0x26, 0x0,  0x11, 0x62, 0x8,  0x49, 0x13,
      0x99, 0x65, 0xcd, 0xcb, 0xc0, 0xd2, 0x5,  0x21, 0x22, 0x92, 0x9c, 0xb5, 0x7c, 0x0,  0x1b, 0x9,  0x50, 0x61, 0x3b,
      0x10, 0x5c, 0x14, 0xa8, 0xb9, 0x23, 0x54, 0x4a, 0x96, 0x8c, 0x4,  0x88, 0x5d, 0xc8, 0xf3, 0x74, 0x2e, 0x3c, 0x16,
      0xd2, 0x42, 0x3b, 0x20, 0x1a, 0x0,  0x19, 0x88, 0x31, 0xaa, 0x91, 0x24, 0xfc, 0x16, 0x98, 0xc3, 0xac, 0x49, 0xb2,
      0x79, 0x42, 0xd,  0x69, 0xdb, 0xc5, 0xb2, 0xb6, 0xb8, 0xb5, 0xc6, 0xe2, 0xd0, 0x8,  0x0,  0x8,  0x5f, 0xf,  0x3e,
      0x6b, 0x8d, 0xa2, 0x55, 0xb5, 0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8d, 0xfd, 0xfb, 0x14, 0xd2, 0x5d};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x61, 0x23, 0xc8, 0x1f, 0xea, 0xdd, 0xa8, 0xeb, 0xd5, 0x7c, 0xcd, 0x77};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\n", _pubPktID = 15576, _pubBody =
// "\SYN\168.K\212\233\154\159\233j\172\130\DC2\187\203\187\155\ETX", _pubProps = [PropMaximumQoS
// 93,PropPayloadFormatIndicator 146,PropReceiveMaximum 21533,PropWillDelayInterval 20406,PropMaximumPacketSize
// 22453,PropMessageExpiryInterval 7551,PropRequestResponseInformation 41,PropMaximumQoS 142,PropResponseInformation
// "\198I\SI\ACK\152p\128",PropUserProperty
// "\157\178l\206\ETBB\132\174\235P\204\151\NAK\239\\^\177v/:\\\243Q\148\153\178{\205"
// "\DEL\158\131",PropRequestResponseInformation 90,PropMaximumQoS 159,PropTopicAlias 22855,PropMessageExpiryInterval
// 24420,PropWillDelayInterval 10065,PropSessionExpiryInterval 18232,PropAssignedClientIdentifier
// "\147\185\FS\bn\205\194\143\SYN",PropSessionExpiryInterval 13363,PropMessageExpiryInterval
// 26041,PropSubscriptionIdentifierAvailable 166,PropResponseInformation "F\157",PropWillDelayInterval
// 26757,PropServerReference "\209\247\248\150\ACKW}"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x3c, 0xa3, 0x1,  0x0,  0x1,  0xa,  0x3c, 0xd8, 0x8a, 0x1,  0x24, 0x5d, 0x1,  0x92, 0x21, 0x54, 0x1d,
                   0x18, 0x0,  0x0,  0x4f, 0xb6, 0x27, 0x0,  0x0,  0x57, 0xb5, 0x2,  0x0,  0x0,  0x1d, 0x7f, 0x19, 0x29,
                   0x24, 0x8e, 0x1a, 0x0,  0x7,  0xc6, 0x49, 0xf,  0x6,  0x98, 0x70, 0x80, 0x26, 0x0,  0x1c, 0x9d, 0xb2,
                   0x6c, 0xce, 0x17, 0x42, 0x84, 0xae, 0xeb, 0x50, 0xcc, 0x97, 0x15, 0xef, 0x5c, 0x5e, 0xb1, 0x76, 0x2f,
                   0x3a, 0x5c, 0xf3, 0x51, 0x94, 0x99, 0xb2, 0x7b, 0xcd, 0x0,  0x3,  0x7f, 0x9e, 0x83, 0x19, 0x5a, 0x24,
                   0x9f, 0x23, 0x59, 0x47, 0x2,  0x0,  0x0,  0x5f, 0x64, 0x18, 0x0,  0x0,  0x27, 0x51, 0x11, 0x0,  0x0,
                   0x47, 0x38, 0x12, 0x0,  0x9,  0x93, 0xb9, 0x1c, 0x8,  0x6e, 0xcd, 0xc2, 0x8f, 0x16, 0x11, 0x0,  0x0,
                   0x34, 0x33, 0x2,  0x0,  0x0,  0x65, 0xb9, 0x29, 0xa6, 0x1a, 0x0,  0x2,  0x46, 0x9d, 0x18, 0x0,  0x0,
                   0x68, 0x85, 0x1c, 0x0,  0x7,  0xd1, 0xf7, 0xf8, 0x96, 0x6,  0x57, 0x7d, 0x16, 0xa8, 0x2e, 0x4b, 0xd4,
                   0xe9, 0x9a, 0x9f, 0xe9, 0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  uint8_t topic_bytes[] = {0xa};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9, 0x9a, 0x9f, 0xe9,
                         0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0xc6, 0x49, 0xf, 0x6, 0x98, 0x70, 0x80};
  uint8_t bytesprops2[] = {0x7f, 0x9e, 0x83};
  uint8_t bytesprops1[] = {0x9d, 0xb2, 0x6c, 0xce, 0x17, 0x42, 0x84, 0xae, 0xeb, 0x50, 0xcc, 0x97, 0x15, 0xef,
                           0x5c, 0x5e, 0xb1, 0x76, 0x2f, 0x3a, 0x5c, 0xf3, 0x51, 0x94, 0x99, 0xb2, 0x7b, 0xcd};
  uint8_t bytesprops3[] = {0x93, 0xb9, 0x1c, 0x8, 0x6e, 0xcd, 0xc2, 0x8f, 0x16};
  uint8_t bytesprops4[] = {0x46, 0x9d};
  uint8_t bytesprops5[] = {0xd1, 0xf7, 0xf8, 0x96, 0x6, 0x57, 0x7d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21533}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20406}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22453}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7551}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops1}, .v = {3, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22855}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24420}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10065}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18232}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13363}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26041}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26757}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 15576, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\n", _pubPktID = 15576, _pubBody =
// "\SYN\168.K\212\233\154\159\233j\172\130\DC2\187\203\187\155\ETX", _pubProps = [PropMaximumQoS
// 93,PropPayloadFormatIndicator 146,PropReceiveMaximum 21533,PropWillDelayInterval 20406,PropMaximumPacketSize
// 22453,PropMessageExpiryInterval 7551,PropRequestResponseInformation 41,PropMaximumQoS 142,PropResponseInformation
// "\198I\SI\ACK\152p\128",PropUserProperty
// "\157\178l\206\ETBB\132\174\235P\204\151\NAK\239\\^\177v/:\\\243Q\148\153\178{\205"
// "\DEL\158\131",PropRequestResponseInformation 90,PropMaximumQoS 159,PropTopicAlias 22855,PropMessageExpiryInterval
// 24420,PropWillDelayInterval 10065,PropSessionExpiryInterval 18232,PropAssignedClientIdentifier
// "\147\185\FS\bn\205\194\143\SYN",PropSessionExpiryInterval 13363,PropMessageExpiryInterval
// 26041,PropSubscriptionIdentifierAvailable 166,PropResponseInformation "F\157",PropWillDelayInterval
// 26757,PropServerReference "\209\247\248\150\ACKW}"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x3c, 0xa3, 0x1,  0x0,  0x1,  0xa,  0x3c, 0xd8, 0x8a, 0x1,  0x24, 0x5d, 0x1,  0x92, 0x21, 0x54, 0x1d,
                   0x18, 0x0,  0x0,  0x4f, 0xb6, 0x27, 0x0,  0x0,  0x57, 0xb5, 0x2,  0x0,  0x0,  0x1d, 0x7f, 0x19, 0x29,
                   0x24, 0x8e, 0x1a, 0x0,  0x7,  0xc6, 0x49, 0xf,  0x6,  0x98, 0x70, 0x80, 0x26, 0x0,  0x1c, 0x9d, 0xb2,
                   0x6c, 0xce, 0x17, 0x42, 0x84, 0xae, 0xeb, 0x50, 0xcc, 0x97, 0x15, 0xef, 0x5c, 0x5e, 0xb1, 0x76, 0x2f,
                   0x3a, 0x5c, 0xf3, 0x51, 0x94, 0x99, 0xb2, 0x7b, 0xcd, 0x0,  0x3,  0x7f, 0x9e, 0x83, 0x19, 0x5a, 0x24,
                   0x9f, 0x23, 0x59, 0x47, 0x2,  0x0,  0x0,  0x5f, 0x64, 0x18, 0x0,  0x0,  0x27, 0x51, 0x11, 0x0,  0x0,
                   0x47, 0x38, 0x12, 0x0,  0x9,  0x93, 0xb9, 0x1c, 0x8,  0x6e, 0xcd, 0xc2, 0x8f, 0x16, 0x11, 0x0,  0x0,
                   0x34, 0x33, 0x2,  0x0,  0x0,  0x65, 0xb9, 0x29, 0xa6, 0x1a, 0x0,  0x2,  0x46, 0x9d, 0x18, 0x0,  0x0,
                   0x68, 0x85, 0x1c, 0x0,  0x7,  0xd1, 0xf7, 0xf8, 0x96, 0x6,  0x57, 0x7d, 0x16, 0xa8, 0x2e, 0x4b, 0xd4,
                   0xe9, 0x9a, 0x9f, 0xe9, 0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0xa8, 0x2e, 0x4b, 0xd4, 0xe9, 0x9a, 0x9f, 0xe9,
                              0x6a, 0xac, 0x82, 0x12, 0xbb, 0xcb, 0xbb, 0x9b, 0x3};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 15576);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\195\214\220\150\206L\a\225",
// _pubPktID = 0, _pubBody = "\203\137\DC3y\ETBf\GS\255}~\231\217kJ\ESCI\193\148\254p\247\ACKB\245", _pubProps =
// [PropMaximumQoS 244,PropCorrelationData
// "\181\249\159\175\155\170\r\191X\253\226\180\181\235\168\\\165\195f\NAK",PropSubscriptionIdentifierAvailable
// 149,PropWildcardSubscriptionAvailable 9,PropTopicAliasMaximum 27472,PropMessageExpiryInterval 269,PropReasonString
// "\230o\STX{l\138p",PropMessageExpiryInterval 32244,PropWillDelayInterval 26373,PropTopicAliasMaximum
// 26296,PropWillDelayInterval 17842,PropMessageExpiryInterval 14239,PropRetainAvailable 179,PropUserProperty
// "\222\211\187\&9\254\208\239"
// "\n\t\224E\NAK\195\SUB\209@\235\214\182\ETBn%_$o\159\v\206\254",PropSubscriptionIdentifierAvailable
// 94,PropServerKeepAlive 3204,PropTopicAlias 992]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x30, 0x95, 0x1,  0x0,  0x8,  0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7,  0xe1, 0x72, 0x24, 0xf4, 0x9,
                   0x0,  0x14, 0xb5, 0xf9, 0x9f, 0xaf, 0x9b, 0xaa, 0xd,  0xbf, 0x58, 0xfd, 0xe2, 0xb4, 0xb5, 0xeb, 0xa8,
                   0x5c, 0xa5, 0xc3, 0x66, 0x15, 0x29, 0x95, 0x28, 0x9,  0x22, 0x6b, 0x50, 0x2,  0x0,  0x0,  0x1,  0xd,
                   0x1f, 0x0,  0x7,  0xe6, 0x6f, 0x2,  0x7b, 0x6c, 0x8a, 0x70, 0x2,  0x0,  0x0,  0x7d, 0xf4, 0x18, 0x0,
                   0x0,  0x67, 0x5,  0x22, 0x66, 0xb8, 0x18, 0x0,  0x0,  0x45, 0xb2, 0x2,  0x0,  0x0,  0x37, 0x9f, 0x25,
                   0xb3, 0x26, 0x0,  0x7,  0xde, 0xd3, 0xbb, 0x39, 0xfe, 0xd0, 0xef, 0x0,  0x16, 0xa,  0x9,  0xe0, 0x45,
                   0x15, 0xc3, 0x1a, 0xd1, 0x40, 0xeb, 0xd6, 0xb6, 0x17, 0x6e, 0x25, 0x5f, 0x24, 0x6f, 0x9f, 0xb,  0xce,
                   0xfe, 0x29, 0x5e, 0x13, 0xc,  0x84, 0x23, 0x3,  0xe0, 0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff,
                   0x7d, 0x7e, 0xe7, 0xd9, 0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  uint8_t topic_bytes[] = {0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7, 0xe1};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                         0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0xb5, 0xf9, 0x9f, 0xaf, 0x9b, 0xaa, 0xd,  0xbf, 0x58, 0xfd,
                           0xe2, 0xb4, 0xb5, 0xeb, 0xa8, 0x5c, 0xa5, 0xc3, 0x66, 0x15};
  uint8_t bytesprops1[] = {0xe6, 0x6f, 0x2, 0x7b, 0x6c, 0x8a, 0x70};
  uint8_t bytesprops3[] = {0xa,  0x9,  0xe0, 0x45, 0x15, 0xc3, 0x1a, 0xd1, 0x40, 0xeb, 0xd6,
                           0xb6, 0x17, 0x6e, 0x25, 0x5f, 0x24, 0x6f, 0x9f, 0xb,  0xce, 0xfe};
  uint8_t bytesprops2[] = {0xde, 0xd3, 0xbb, 0x39, 0xfe, 0xd0, 0xef};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27472}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 269}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32244}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26373}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26296}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17842}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14239}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops2}, .v = {22, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3204}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 992}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\195\214\220\150\206L\a\225",
// _pubPktID = 0, _pubBody = "\203\137\DC3y\ETBf\GS\255}~\231\217kJ\ESCI\193\148\254p\247\ACKB\245", _pubProps =
// [PropMaximumQoS 244,PropCorrelationData
// "\181\249\159\175\155\170\r\191X\253\226\180\181\235\168\\\165\195f\NAK",PropSubscriptionIdentifierAvailable
// 149,PropWildcardSubscriptionAvailable 9,PropTopicAliasMaximum 27472,PropMessageExpiryInterval 269,PropReasonString
// "\230o\STX{l\138p",PropMessageExpiryInterval 32244,PropWillDelayInterval 26373,PropTopicAliasMaximum
// 26296,PropWillDelayInterval 17842,PropMessageExpiryInterval 14239,PropRetainAvailable 179,PropUserProperty
// "\222\211\187\&9\254\208\239"
// "\n\t\224E\NAK\195\SUB\209@\235\214\182\ETBn%_$o\159\v\206\254",PropSubscriptionIdentifierAvailable
// 94,PropServerKeepAlive 3204,PropTopicAlias 992]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x30, 0x95, 0x1,  0x0,  0x8,  0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7,  0xe1, 0x72, 0x24, 0xf4, 0x9,
                   0x0,  0x14, 0xb5, 0xf9, 0x9f, 0xaf, 0x9b, 0xaa, 0xd,  0xbf, 0x58, 0xfd, 0xe2, 0xb4, 0xb5, 0xeb, 0xa8,
                   0x5c, 0xa5, 0xc3, 0x66, 0x15, 0x29, 0x95, 0x28, 0x9,  0x22, 0x6b, 0x50, 0x2,  0x0,  0x0,  0x1,  0xd,
                   0x1f, 0x0,  0x7,  0xe6, 0x6f, 0x2,  0x7b, 0x6c, 0x8a, 0x70, 0x2,  0x0,  0x0,  0x7d, 0xf4, 0x18, 0x0,
                   0x0,  0x67, 0x5,  0x22, 0x66, 0xb8, 0x18, 0x0,  0x0,  0x45, 0xb2, 0x2,  0x0,  0x0,  0x37, 0x9f, 0x25,
                   0xb3, 0x26, 0x0,  0x7,  0xde, 0xd3, 0xbb, 0x39, 0xfe, 0xd0, 0xef, 0x0,  0x16, 0xa,  0x9,  0xe0, 0x45,
                   0x15, 0xc3, 0x1a, 0xd1, 0x40, 0xeb, 0xd6, 0xb6, 0x17, 0x6e, 0x25, 0x5f, 0x24, 0x6f, 0x9f, 0xb,  0xce,
                   0xfe, 0x29, 0x5e, 0x13, 0xc,  0x84, 0x23, 0x3,  0xe0, 0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff,
                   0x7d, 0x7e, 0xe7, 0xd9, 0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc3, 0xd6, 0xdc, 0x96, 0xce, 0x4c, 0x7, 0xe1};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x89, 0x13, 0x79, 0x17, 0x66, 0x1d, 0xff, 0x7d, 0x7e, 0xe7, 0xd9,
                              0x6b, 0x4a, 0x1b, 0x49, 0xc1, 0x94, 0xfe, 0x70, 0xf7, 0x6,  0x42, 0xf5};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\NUL=U\137\224\247\192", _pubPktID =
// 0, _pubBody = "\142\160\202\237f\186\202Fc1p\\\ACK\231J\193%\250kl", _pubProps = [PropResponseTopic
// "O\141*\235\&3\DC4\168\162\EOT;\RS\229",PropAuthenticationMethod
// "\131\STX\192\RSs)\157\145\222\238\178\137\162\244&\161\157\221mfd\201G\253\147S",PropPayloadFormatIndicator
// 181,PropRetainAvailable 216,PropContentType
// "\241\roz\NAK\216\238\192\155\249\200\211\129\f$*\175\147",PropReasonString
// "b\ta\190\187\148\DEL\170L\215e\197\240\151\DLE\223\SO\232\153\&9\155'r\207\168\210i",PropWildcardSubscriptionAvailable
// 225,PropMaximumPacketSize 26717,PropMaximumQoS 92,PropMaximumQoS 102,PropUserProperty
// "\196\FS\172\\\213+m\242\DLEo=\189=\213\218\243<\188\253\152F\209\133\252\139\170\159\207V"
// "\202\129\NULU\177\233\203\246hv\ETX\240\&9E\229B6\252\&4\155\136\r\231\229",PropMessageExpiryInterval
// 20811,PropAuthenticationMethod
// "\CAN8\213\197#\136\254\192\152I\237_n{9X/t\152\a+\165\&8\181\&2\226\151",PropMessageExpiryInterval
// 24371,PropSubscriptionIdentifier 27,PropUserProperty "\136"
// "yb\RS\DEL)\198o\EOTs\180\DC1e\213\214!\182Ql\251\137\154\165\137\216\144\218\247\130+\227",PropUserProperty
// "\177\132U^\v\249\252\145]\v\250b\184\US5zN\STX\195m"
// "\173\n\156\165\GS\255\195u\181\142\178\134\252kX\220*\RSm",PropSubscriptionIdentifier 16,PropResponseInformation
// "\149l&~\225\129\140f.\206\195p\152\156\202<T\130+\162)kgnD\"",PropMessageExpiryInterval
// 15417,PropSessionExpiryInterval 18665]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x39, 0xea, 0x2,  0x0,  0x7,  0x0,  0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0, 0xcb, 0x2,  0x8,  0x0,  0xc,  0x4f, 0x8d,
      0x2a, 0xeb, 0x33, 0x14, 0xa8, 0xa2, 0x4,  0x3b, 0x1e, 0xe5, 0x15, 0x0,  0x1a, 0x83, 0x2,  0xc0, 0x1e, 0x73, 0x29,
      0x9d, 0x91, 0xde, 0xee, 0xb2, 0x89, 0xa2, 0xf4, 0x26, 0xa1, 0x9d, 0xdd, 0x6d, 0x66, 0x64, 0xc9, 0x47, 0xfd, 0x93,
      0x53, 0x1,  0xb5, 0x25, 0xd8, 0x3,  0x0,  0x12, 0xf1, 0xd,  0x6f, 0x7a, 0x15, 0xd8, 0xee, 0xc0, 0x9b, 0xf9, 0xc8,
      0xd3, 0x81, 0xc,  0x24, 0x2a, 0xaf, 0x93, 0x1f, 0x0,  0x1b, 0x62, 0x9,  0x61, 0xbe, 0xbb, 0x94, 0x7f, 0xaa, 0x4c,
      0xd7, 0x65, 0xc5, 0xf0, 0x97, 0x10, 0xdf, 0xe,  0xe8, 0x99, 0x39, 0x9b, 0x27, 0x72, 0xcf, 0xa8, 0xd2, 0x69, 0x28,
      0xe1, 0x27, 0x0,  0x0,  0x68, 0x5d, 0x24, 0x5c, 0x24, 0x66, 0x26, 0x0,  0x1d, 0xc4, 0x1c, 0xac, 0x5c, 0xd5, 0x2b,
      0x6d, 0xf2, 0x10, 0x6f, 0x3d, 0xbd, 0x3d, 0xd5, 0xda, 0xf3, 0x3c, 0xbc, 0xfd, 0x98, 0x46, 0xd1, 0x85, 0xfc, 0x8b,
      0xaa, 0x9f, 0xcf, 0x56, 0x0,  0x18, 0xca, 0x81, 0x0,  0x55, 0xb1, 0xe9, 0xcb, 0xf6, 0x68, 0x76, 0x3,  0xf0, 0x39,
      0x45, 0xe5, 0x42, 0x36, 0xfc, 0x34, 0x9b, 0x88, 0xd,  0xe7, 0xe5, 0x2,  0x0,  0x0,  0x51, 0x4b, 0x15, 0x0,  0x1b,
      0x18, 0x38, 0xd5, 0xc5, 0x23, 0x88, 0xfe, 0xc0, 0x98, 0x49, 0xed, 0x5f, 0x6e, 0x7b, 0x39, 0x58, 0x2f, 0x74, 0x98,
      0x7,  0x2b, 0xa5, 0x38, 0xb5, 0x32, 0xe2, 0x97, 0x2,  0x0,  0x0,  0x5f, 0x33, 0xb,  0x1b, 0x26, 0x0,  0x1,  0x88,
      0x0,  0x1e, 0x79, 0x62, 0x1e, 0x7f, 0x29, 0xc6, 0x6f, 0x4,  0x73, 0xb4, 0x11, 0x65, 0xd5, 0xd6, 0x21, 0xb6, 0x51,
      0x6c, 0xfb, 0x89, 0x9a, 0xa5, 0x89, 0xd8, 0x90, 0xda, 0xf7, 0x82, 0x2b, 0xe3, 0x26, 0x0,  0x14, 0xb1, 0x84, 0x55,
      0x5e, 0xb,  0xf9, 0xfc, 0x91, 0x5d, 0xb,  0xfa, 0x62, 0xb8, 0x1f, 0x35, 0x7a, 0x4e, 0x2,  0xc3, 0x6d, 0x0,  0x13,
      0xad, 0xa,  0x9c, 0xa5, 0x1d, 0xff, 0xc3, 0x75, 0xb5, 0x8e, 0xb2, 0x86, 0xfc, 0x6b, 0x58, 0xdc, 0x2a, 0x1e, 0x6d,
      0xb,  0x10, 0x1a, 0x0,  0x1a, 0x95, 0x6c, 0x26, 0x7e, 0xe1, 0x81, 0x8c, 0x66, 0x2e, 0xce, 0xc3, 0x70, 0x98, 0x9c,
      0xca, 0x3c, 0x54, 0x82, 0x2b, 0xa2, 0x29, 0x6b, 0x67, 0x6e, 0x44, 0x22, 0x2,  0x0,  0x0,  0x3c, 0x39, 0x11, 0x0,
      0x0,  0x48, 0xe9, 0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31, 0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1,
      0x25, 0xfa, 0x6b, 0x6c};
  uint8_t topic_bytes[] = {0x0, 0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31,
                         0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x4f, 0x8d, 0x2a, 0xeb, 0x33, 0x14, 0xa8, 0xa2, 0x4, 0x3b, 0x1e, 0xe5};
  uint8_t bytesprops1[] = {0x83, 0x2,  0xc0, 0x1e, 0x73, 0x29, 0x9d, 0x91, 0xde, 0xee, 0xb2, 0x89, 0xa2,
                           0xf4, 0x26, 0xa1, 0x9d, 0xdd, 0x6d, 0x66, 0x64, 0xc9, 0x47, 0xfd, 0x93, 0x53};
  uint8_t bytesprops2[] = {0xf1, 0xd,  0x6f, 0x7a, 0x15, 0xd8, 0xee, 0xc0, 0x9b,
                           0xf9, 0xc8, 0xd3, 0x81, 0xc,  0x24, 0x2a, 0xaf, 0x93};
  uint8_t bytesprops3[] = {0x62, 0x9,  0x61, 0xbe, 0xbb, 0x94, 0x7f, 0xaa, 0x4c, 0xd7, 0x65, 0xc5, 0xf0, 0x97,
                           0x10, 0xdf, 0xe,  0xe8, 0x99, 0x39, 0x9b, 0x27, 0x72, 0xcf, 0xa8, 0xd2, 0x69};
  uint8_t bytesprops5[] = {0xca, 0x81, 0x0,  0x55, 0xb1, 0xe9, 0xcb, 0xf6, 0x68, 0x76, 0x3,  0xf0,
                           0x39, 0x45, 0xe5, 0x42, 0x36, 0xfc, 0x34, 0x9b, 0x88, 0xd,  0xe7, 0xe5};
  uint8_t bytesprops4[] = {0xc4, 0x1c, 0xac, 0x5c, 0xd5, 0x2b, 0x6d, 0xf2, 0x10, 0x6f, 0x3d, 0xbd, 0x3d, 0xd5, 0xda,
                           0xf3, 0x3c, 0xbc, 0xfd, 0x98, 0x46, 0xd1, 0x85, 0xfc, 0x8b, 0xaa, 0x9f, 0xcf, 0x56};
  uint8_t bytesprops6[] = {0x18, 0x38, 0xd5, 0xc5, 0x23, 0x88, 0xfe, 0xc0, 0x98, 0x49, 0xed, 0x5f, 0x6e, 0x7b,
                           0x39, 0x58, 0x2f, 0x74, 0x98, 0x7,  0x2b, 0xa5, 0x38, 0xb5, 0x32, 0xe2, 0x97};
  uint8_t bytesprops8[] = {0x79, 0x62, 0x1e, 0x7f, 0x29, 0xc6, 0x6f, 0x4,  0x73, 0xb4, 0x11, 0x65, 0xd5, 0xd6, 0x21,
                           0xb6, 0x51, 0x6c, 0xfb, 0x89, 0x9a, 0xa5, 0x89, 0xd8, 0x90, 0xda, 0xf7, 0x82, 0x2b, 0xe3};
  uint8_t bytesprops7[] = {0x88};
  uint8_t bytesprops10[] = {0xad, 0xa,  0x9c, 0xa5, 0x1d, 0xff, 0xc3, 0x75, 0xb5, 0x8e,
                            0xb2, 0x86, 0xfc, 0x6b, 0x58, 0xdc, 0x2a, 0x1e, 0x6d};
  uint8_t bytesprops9[] = {0xb1, 0x84, 0x55, 0x5e, 0xb,  0xf9, 0xfc, 0x91, 0x5d, 0xb,
                           0xfa, 0x62, 0xb8, 0x1f, 0x35, 0x7a, 0x4e, 0x2,  0xc3, 0x6d};
  uint8_t bytesprops11[] = {0x95, 0x6c, 0x26, 0x7e, 0xe1, 0x81, 0x8c, 0x66, 0x2e, 0xce, 0xc3, 0x70, 0x98,
                            0x9c, 0xca, 0x3c, 0x54, 0x82, 0x2b, 0xa2, 0x29, 0x6b, 0x67, 0x6e, 0x44, 0x22};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26717}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {24, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20811}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24371}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops7}, .v = {30, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops9}, .v = {19, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15417}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18665}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\NUL=U\137\224\247\192", _pubPktID =
// 0, _pubBody = "\142\160\202\237f\186\202Fc1p\\\ACK\231J\193%\250kl", _pubProps = [PropResponseTopic
// "O\141*\235\&3\DC4\168\162\EOT;\RS\229",PropAuthenticationMethod
// "\131\STX\192\RSs)\157\145\222\238\178\137\162\244&\161\157\221mfd\201G\253\147S",PropPayloadFormatIndicator
// 181,PropRetainAvailable 216,PropContentType
// "\241\roz\NAK\216\238\192\155\249\200\211\129\f$*\175\147",PropReasonString
// "b\ta\190\187\148\DEL\170L\215e\197\240\151\DLE\223\SO\232\153\&9\155'r\207\168\210i",PropWildcardSubscriptionAvailable
// 225,PropMaximumPacketSize 26717,PropMaximumQoS 92,PropMaximumQoS 102,PropUserProperty
// "\196\FS\172\\\213+m\242\DLEo=\189=\213\218\243<\188\253\152F\209\133\252\139\170\159\207V"
// "\202\129\NULU\177\233\203\246hv\ETX\240\&9E\229B6\252\&4\155\136\r\231\229",PropMessageExpiryInterval
// 20811,PropAuthenticationMethod
// "\CAN8\213\197#\136\254\192\152I\237_n{9X/t\152\a+\165\&8\181\&2\226\151",PropMessageExpiryInterval
// 24371,PropSubscriptionIdentifier 27,PropUserProperty "\136"
// "yb\RS\DEL)\198o\EOTs\180\DC1e\213\214!\182Ql\251\137\154\165\137\216\144\218\247\130+\227",PropUserProperty
// "\177\132U^\v\249\252\145]\v\250b\184\US5zN\STX\195m"
// "\173\n\156\165\GS\255\195u\181\142\178\134\252kX\220*\RSm",PropSubscriptionIdentifier 16,PropResponseInformation
// "\149l&~\225\129\140f.\206\195p\152\156\202<T\130+\162)kgnD\"",PropMessageExpiryInterval
// 15417,PropSessionExpiryInterval 18665]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x39, 0xea, 0x2,  0x0,  0x7,  0x0,  0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0, 0xcb, 0x2,  0x8,  0x0,  0xc,  0x4f, 0x8d,
      0x2a, 0xeb, 0x33, 0x14, 0xa8, 0xa2, 0x4,  0x3b, 0x1e, 0xe5, 0x15, 0x0,  0x1a, 0x83, 0x2,  0xc0, 0x1e, 0x73, 0x29,
      0x9d, 0x91, 0xde, 0xee, 0xb2, 0x89, 0xa2, 0xf4, 0x26, 0xa1, 0x9d, 0xdd, 0x6d, 0x66, 0x64, 0xc9, 0x47, 0xfd, 0x93,
      0x53, 0x1,  0xb5, 0x25, 0xd8, 0x3,  0x0,  0x12, 0xf1, 0xd,  0x6f, 0x7a, 0x15, 0xd8, 0xee, 0xc0, 0x9b, 0xf9, 0xc8,
      0xd3, 0x81, 0xc,  0x24, 0x2a, 0xaf, 0x93, 0x1f, 0x0,  0x1b, 0x62, 0x9,  0x61, 0xbe, 0xbb, 0x94, 0x7f, 0xaa, 0x4c,
      0xd7, 0x65, 0xc5, 0xf0, 0x97, 0x10, 0xdf, 0xe,  0xe8, 0x99, 0x39, 0x9b, 0x27, 0x72, 0xcf, 0xa8, 0xd2, 0x69, 0x28,
      0xe1, 0x27, 0x0,  0x0,  0x68, 0x5d, 0x24, 0x5c, 0x24, 0x66, 0x26, 0x0,  0x1d, 0xc4, 0x1c, 0xac, 0x5c, 0xd5, 0x2b,
      0x6d, 0xf2, 0x10, 0x6f, 0x3d, 0xbd, 0x3d, 0xd5, 0xda, 0xf3, 0x3c, 0xbc, 0xfd, 0x98, 0x46, 0xd1, 0x85, 0xfc, 0x8b,
      0xaa, 0x9f, 0xcf, 0x56, 0x0,  0x18, 0xca, 0x81, 0x0,  0x55, 0xb1, 0xe9, 0xcb, 0xf6, 0x68, 0x76, 0x3,  0xf0, 0x39,
      0x45, 0xe5, 0x42, 0x36, 0xfc, 0x34, 0x9b, 0x88, 0xd,  0xe7, 0xe5, 0x2,  0x0,  0x0,  0x51, 0x4b, 0x15, 0x0,  0x1b,
      0x18, 0x38, 0xd5, 0xc5, 0x23, 0x88, 0xfe, 0xc0, 0x98, 0x49, 0xed, 0x5f, 0x6e, 0x7b, 0x39, 0x58, 0x2f, 0x74, 0x98,
      0x7,  0x2b, 0xa5, 0x38, 0xb5, 0x32, 0xe2, 0x97, 0x2,  0x0,  0x0,  0x5f, 0x33, 0xb,  0x1b, 0x26, 0x0,  0x1,  0x88,
      0x0,  0x1e, 0x79, 0x62, 0x1e, 0x7f, 0x29, 0xc6, 0x6f, 0x4,  0x73, 0xb4, 0x11, 0x65, 0xd5, 0xd6, 0x21, 0xb6, 0x51,
      0x6c, 0xfb, 0x89, 0x9a, 0xa5, 0x89, 0xd8, 0x90, 0xda, 0xf7, 0x82, 0x2b, 0xe3, 0x26, 0x0,  0x14, 0xb1, 0x84, 0x55,
      0x5e, 0xb,  0xf9, 0xfc, 0x91, 0x5d, 0xb,  0xfa, 0x62, 0xb8, 0x1f, 0x35, 0x7a, 0x4e, 0x2,  0xc3, 0x6d, 0x0,  0x13,
      0xad, 0xa,  0x9c, 0xa5, 0x1d, 0xff, 0xc3, 0x75, 0xb5, 0x8e, 0xb2, 0x86, 0xfc, 0x6b, 0x58, 0xdc, 0x2a, 0x1e, 0x6d,
      0xb,  0x10, 0x1a, 0x0,  0x1a, 0x95, 0x6c, 0x26, 0x7e, 0xe1, 0x81, 0x8c, 0x66, 0x2e, 0xce, 0xc3, 0x70, 0x98, 0x9c,
      0xca, 0x3c, 0x54, 0x82, 0x2b, 0xa2, 0x29, 0x6b, 0x67, 0x6e, 0x44, 0x22, 0x2,  0x0,  0x0,  0x3c, 0x39, 0x11, 0x0,
      0x0,  0x48, 0xe9, 0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31, 0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1,
      0x25, 0xfa, 0x6b, 0x6c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x0, 0x3d, 0x55, 0x89, 0xe0, 0xf7, 0xc0};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8e, 0xa0, 0xca, 0xed, 0x66, 0xba, 0xca, 0x46, 0x63, 0x31,
                              0x70, 0x5c, 0x6,  0xe7, 0x4a, 0xc1, 0x25, 0xfa, 0x6b, 0x6c};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192\226\177\DC3\178\200n\184h\162\210\RS\153\149\253\&1\132\250\156\\\190\ETB\149 \192\247C\203", _pubPktID = 0,
// _pubBody = "\243<Y.\238/=\210\170\\\187", _pubProps = [PropContentType
// "qg\GS\ENQ\ESC\246\195",PropAssignedClientIdentifier "\RS\"$Y",PropTopicAliasMaximum 24373,PropMaximumPacketSize
// 26574,PropReasonString "\214\216\239)6\GSgPn\220\SUB\f\142:'\146{\155\187",PropMaximumQoS 7,PropContentType
// "\210\135J\EOT\162\SI\146\208JT\SI",PropReasonString "HD\133",PropUserProperty
// "\172a\183\201.\252\134\"M\b\171\190\ETX\229ya\229t\152\218B\160\205\NUL\137\223\DC2\SO"
// "\167\215\193\DC3\159dL~\164c\137\\\236+\130\196\254\162PC\205",PropSessionExpiryInterval 18408,PropTopicAliasMaximum
// 17712,PropRequestProblemInformation 46,PropTopicAlias 17979,PropResponseTopic
// "\170Kc\229\236\&8\151\144{4\224\255\236\191\&0\NAK",PropSharedSubscriptionAvailable 110,PropReceiveMaximum
// 15470,PropMaximumPacketSize 31364]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x38, 0xd0, 0x1,  0x0,  0x1c, 0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e,
                   0x99, 0x95, 0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb, 0xa5,
                   0x1,  0x3,  0x0,  0x7,  0x71, 0x67, 0x1d, 0x5,  0x1b, 0xf6, 0xc3, 0x12, 0x0,  0x4,  0x1e, 0x22, 0x24,
                   0x59, 0x22, 0x5f, 0x35, 0x27, 0x0,  0x0,  0x67, 0xce, 0x1f, 0x0,  0x13, 0xd6, 0xd8, 0xef, 0x29, 0x36,
                   0x1d, 0x67, 0x50, 0x6e, 0xdc, 0x1a, 0xc,  0x8e, 0x3a, 0x27, 0x92, 0x7b, 0x9b, 0xbb, 0x24, 0x7,  0x3,
                   0x0,  0xb,  0xd2, 0x87, 0x4a, 0x4,  0xa2, 0xf,  0x92, 0xd0, 0x4a, 0x54, 0xf,  0x1f, 0x0,  0x3,  0x48,
                   0x44, 0x85, 0x26, 0x0,  0x1c, 0xac, 0x61, 0xb7, 0xc9, 0x2e, 0xfc, 0x86, 0x22, 0x4d, 0x8,  0xab, 0xbe,
                   0x3,  0xe5, 0x79, 0x61, 0xe5, 0x74, 0x98, 0xda, 0x42, 0xa0, 0xcd, 0x0,  0x89, 0xdf, 0x12, 0xe,  0x0,
                   0x15, 0xa7, 0xd7, 0xc1, 0x13, 0x9f, 0x64, 0x4c, 0x7e, 0xa4, 0x63, 0x89, 0x5c, 0xec, 0x2b, 0x82, 0xc4,
                   0xfe, 0xa2, 0x50, 0x43, 0xcd, 0x11, 0x0,  0x0,  0x47, 0xe8, 0x22, 0x45, 0x30, 0x17, 0x2e, 0x23, 0x46,
                   0x3b, 0x8,  0x0,  0x10, 0xaa, 0x4b, 0x63, 0xe5, 0xec, 0x38, 0x97, 0x90, 0x7b, 0x34, 0xe0, 0xff, 0xec,
                   0xbf, 0x30, 0x15, 0x2a, 0x6e, 0x21, 0x3c, 0x6e, 0x27, 0x0,  0x0,  0x7a, 0x84, 0xf3, 0x3c, 0x59, 0x2e,
                   0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  uint8_t topic_bytes[] = {0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e, 0x99, 0x95,
                           0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x71, 0x67, 0x1d, 0x5, 0x1b, 0xf6, 0xc3};
  uint8_t bytesprops1[] = {0x1e, 0x22, 0x24, 0x59};
  uint8_t bytesprops2[] = {0xd6, 0xd8, 0xef, 0x29, 0x36, 0x1d, 0x67, 0x50, 0x6e, 0xdc,
                           0x1a, 0xc,  0x8e, 0x3a, 0x27, 0x92, 0x7b, 0x9b, 0xbb};
  uint8_t bytesprops3[] = {0xd2, 0x87, 0x4a, 0x4, 0xa2, 0xf, 0x92, 0xd0, 0x4a, 0x54, 0xf};
  uint8_t bytesprops4[] = {0x48, 0x44, 0x85};
  uint8_t bytesprops6[] = {0xa7, 0xd7, 0xc1, 0x13, 0x9f, 0x64, 0x4c, 0x7e, 0xa4, 0x63, 0x89,
                           0x5c, 0xec, 0x2b, 0x82, 0xc4, 0xfe, 0xa2, 0x50, 0x43, 0xcd};
  uint8_t bytesprops5[] = {0xac, 0x61, 0xb7, 0xc9, 0x2e, 0xfc, 0x86, 0x22, 0x4d, 0x8, 0xab, 0xbe, 0x3,  0xe5,
                           0x79, 0x61, 0xe5, 0x74, 0x98, 0xda, 0x42, 0xa0, 0xcd, 0x0, 0x89, 0xdf, 0x12, 0xe};
  uint8_t bytesprops7[] = {0xaa, 0x4b, 0x63, 0xe5, 0xec, 0x38, 0x97, 0x90,
                           0x7b, 0x34, 0xe0, 0xff, 0xec, 0xbf, 0x30, 0x15};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24373}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26574}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops5}, .v = {21, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18408}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17712}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17979}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15470}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31364}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192\226\177\DC3\178\200n\184h\162\210\RS\153\149\253\&1\132\250\156\\\190\ETB\149 \192\247C\203", _pubPktID = 0,
// _pubBody = "\243<Y.\238/=\210\170\\\187", _pubProps = [PropContentType
// "qg\GS\ENQ\ESC\246\195",PropAssignedClientIdentifier "\RS\"$Y",PropTopicAliasMaximum 24373,PropMaximumPacketSize
// 26574,PropReasonString "\214\216\239)6\GSgPn\220\SUB\f\142:'\146{\155\187",PropMaximumQoS 7,PropContentType
// "\210\135J\EOT\162\SI\146\208JT\SI",PropReasonString "HD\133",PropUserProperty
// "\172a\183\201.\252\134\"M\b\171\190\ETX\229ya\229t\152\218B\160\205\NUL\137\223\DC2\SO"
// "\167\215\193\DC3\159dL~\164c\137\\\236+\130\196\254\162PC\205",PropSessionExpiryInterval 18408,PropTopicAliasMaximum
// 17712,PropRequestProblemInformation 46,PropTopicAlias 17979,PropResponseTopic
// "\170Kc\229\236\&8\151\144{4\224\255\236\191\&0\NAK",PropSharedSubscriptionAvailable 110,PropReceiveMaximum
// 15470,PropMaximumPacketSize 31364]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x38, 0xd0, 0x1,  0x0,  0x1c, 0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e,
                   0x99, 0x95, 0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb, 0xa5,
                   0x1,  0x3,  0x0,  0x7,  0x71, 0x67, 0x1d, 0x5,  0x1b, 0xf6, 0xc3, 0x12, 0x0,  0x4,  0x1e, 0x22, 0x24,
                   0x59, 0x22, 0x5f, 0x35, 0x27, 0x0,  0x0,  0x67, 0xce, 0x1f, 0x0,  0x13, 0xd6, 0xd8, 0xef, 0x29, 0x36,
                   0x1d, 0x67, 0x50, 0x6e, 0xdc, 0x1a, 0xc,  0x8e, 0x3a, 0x27, 0x92, 0x7b, 0x9b, 0xbb, 0x24, 0x7,  0x3,
                   0x0,  0xb,  0xd2, 0x87, 0x4a, 0x4,  0xa2, 0xf,  0x92, 0xd0, 0x4a, 0x54, 0xf,  0x1f, 0x0,  0x3,  0x48,
                   0x44, 0x85, 0x26, 0x0,  0x1c, 0xac, 0x61, 0xb7, 0xc9, 0x2e, 0xfc, 0x86, 0x22, 0x4d, 0x8,  0xab, 0xbe,
                   0x3,  0xe5, 0x79, 0x61, 0xe5, 0x74, 0x98, 0xda, 0x42, 0xa0, 0xcd, 0x0,  0x89, 0xdf, 0x12, 0xe,  0x0,
                   0x15, 0xa7, 0xd7, 0xc1, 0x13, 0x9f, 0x64, 0x4c, 0x7e, 0xa4, 0x63, 0x89, 0x5c, 0xec, 0x2b, 0x82, 0xc4,
                   0xfe, 0xa2, 0x50, 0x43, 0xcd, 0x11, 0x0,  0x0,  0x47, 0xe8, 0x22, 0x45, 0x30, 0x17, 0x2e, 0x23, 0x46,
                   0x3b, 0x8,  0x0,  0x10, 0xaa, 0x4b, 0x63, 0xe5, 0xec, 0x38, 0x97, 0x90, 0x7b, 0x34, 0xe0, 0xff, 0xec,
                   0xbf, 0x30, 0x15, 0x2a, 0x6e, 0x21, 0x3c, 0x6e, 0x27, 0x0,  0x0,  0x7a, 0x84, 0xf3, 0x3c, 0x59, 0x2e,
                   0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc0, 0xe2, 0xb1, 0x13, 0xb2, 0xc8, 0x6e, 0xb8, 0x68, 0xa2, 0xd2, 0x1e, 0x99, 0x95,
                               0xfd, 0x31, 0x84, 0xfa, 0x9c, 0x5c, 0xbe, 0x17, 0x95, 0x20, 0xc0, 0xf7, 0x43, 0xcb};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf3, 0x3c, 0x59, 0x2e, 0xee, 0x2f, 0x3d, 0xd2, 0xaa, 0x5c, 0xbb};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "Q\144\172\176:\255\255\236\209\134\204", _pubPktID = 29463, _pubBody =
// "\135s\STX\155A\v\217\&8\EOT^,\220\194\183\195\251\223H9g\164", _pubProps = [PropSubscriptionIdentifierAvailable
// 1,PropSharedSubscriptionAvailable 127,PropAssignedClientIdentifier
// "\SI\NULB[\DC3\137\155\255\ENQ\SUBqa\DC3\234%\158\184\200\129\155",PropSubscriptionIdentifierAvailable
// 246,PropTopicAliasMaximum 4016,PropTopicAliasMaximum 9506]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {0x3b, 0x48, 0x0,  0xb,  0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc,
                   0x73, 0x17, 0x23, 0x29, 0x1,  0x2a, 0x7f, 0x12, 0x0,  0x14, 0xf,  0x0,  0x42, 0x5b, 0x13,
                   0x89, 0x9b, 0xff, 0x5,  0x1a, 0x71, 0x61, 0x13, 0xea, 0x25, 0x9e, 0xb8, 0xc8, 0x81, 0x9b,
                   0x29, 0xf6, 0x22, 0xf,  0xb0, 0x22, 0x25, 0x22, 0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9,
                   0x38, 0x4,  0x5e, 0x2c, 0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  uint8_t topic_bytes[] = {0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,  0x5e, 0x2c,
                         0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xf,  0x0,  0x42, 0x5b, 0x13, 0x89, 0x9b, 0xff, 0x5,  0x1a,
                           0x71, 0x61, 0x13, 0xea, 0x25, 0x9e, 0xb8, 0xc8, 0x81, 0x9b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4016}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9506}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29463, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "Q\144\172\176:\255\255\236\209\134\204", _pubPktID = 29463, _pubBody =
// "\135s\STX\155A\v\217\&8\EOT^,\220\194\183\195\251\223H9g\164", _pubProps = [PropSubscriptionIdentifierAvailable
// 1,PropSharedSubscriptionAvailable 127,PropAssignedClientIdentifier
// "\SI\NULB[\DC3\137\155\255\ENQ\SUBqa\DC3\234%\158\184\200\129\155",PropSubscriptionIdentifierAvailable
// 246,PropTopicAliasMaximum 4016,PropTopicAliasMaximum 9506]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {0x3b, 0x48, 0x0,  0xb,  0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc,
                   0x73, 0x17, 0x23, 0x29, 0x1,  0x2a, 0x7f, 0x12, 0x0,  0x14, 0xf,  0x0,  0x42, 0x5b, 0x13,
                   0x89, 0x9b, 0xff, 0x5,  0x1a, 0x71, 0x61, 0x13, 0xea, 0x25, 0x9e, 0xb8, 0xc8, 0x81, 0x9b,
                   0x29, 0xf6, 0x22, 0xf,  0xb0, 0x22, 0x25, 0x22, 0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9,
                   0x38, 0x4,  0x5e, 0x2c, 0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x51, 0x90, 0xac, 0xb0, 0x3a, 0xff, 0xff, 0xec, 0xd1, 0x86, 0xcc};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87, 0x73, 0x2,  0x9b, 0x41, 0xb,  0xd9, 0x38, 0x4,  0x5e, 0x2c,
                              0xdc, 0xc2, 0xb7, 0xc3, 0xfb, 0xdf, 0x48, 0x39, 0x67, 0xa4};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29463);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\220\&2\138\ETX\145\167\209n\146\EOT\ACK\187\213\216b\156\231@\149\194\129", _pubPktID = 25900, _pubBody = "+;\SYN",
// _pubProps = [PropAuthenticationMethod "\195\EOT\243\165\152",PropSubscriptionIdentifierAvailable
// 98,PropAuthenticationMethod "\215\SI\221\162#\222\249#\131",PropReasonString
// "u\140\147\SYN\247ur\254\171\128\227R\ENQ\231\"\rG\225\198\217\205G/\173",PropResponseInformation
// "\206P\163",PropReasonString "(UAe\DEL\234\160\&4R\GS#q\218L\DC4\135H\129",PropSubscriptionIdentifierAvailable
// 81,PropResponseInformation "\232\189",PropAssignedClientIdentifier "\228.B\224Ey$g\202f",PropAuthenticationData
// "\149\ACK\139'\236\239m\191",PropMaximumQoS 220,PropAssignedClientIdentifier
// "b@\DEL\EM\144[-\181\162\157\199=\204",PropAuthenticationMethod
// "\169\&6\a\197\ACKV{C~\ACK\166\216u",PropServerReference
// "\148w%aR,\ENQh=1K\DC2\252\251\132\166LA",PropAssignedClientIdentifier "/\212]\208",PropReceiveMaximum 28597]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x34, 0xca, 0x1,  0x0,  0x15, 0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4,  0x6,  0xbb, 0xd5, 0xd8,
      0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81, 0x65, 0x2c, 0xac, 0x1,  0x15, 0x0,  0x5,  0xc3, 0x4,  0xf3, 0xa5, 0x98,
      0x29, 0x62, 0x15, 0x0,  0x9,  0xd7, 0xf,  0xdd, 0xa2, 0x23, 0xde, 0xf9, 0x23, 0x83, 0x1f, 0x0,  0x18, 0x75, 0x8c,
      0x93, 0x16, 0xf7, 0x75, 0x72, 0xfe, 0xab, 0x80, 0xe3, 0x52, 0x5,  0xe7, 0x22, 0xd,  0x47, 0xe1, 0xc6, 0xd9, 0xcd,
      0x47, 0x2f, 0xad, 0x1a, 0x0,  0x3,  0xce, 0x50, 0xa3, 0x1f, 0x0,  0x12, 0x28, 0x55, 0x41, 0x65, 0x7f, 0xea, 0xa0,
      0x34, 0x52, 0x1d, 0x23, 0x71, 0xda, 0x4c, 0x14, 0x87, 0x48, 0x81, 0x29, 0x51, 0x1a, 0x0,  0x2,  0xe8, 0xbd, 0x12,
      0x0,  0xa,  0xe4, 0x2e, 0x42, 0xe0, 0x45, 0x79, 0x24, 0x67, 0xca, 0x66, 0x16, 0x0,  0x8,  0x95, 0x6,  0x8b, 0x27,
      0xec, 0xef, 0x6d, 0xbf, 0x24, 0xdc, 0x12, 0x0,  0xd,  0x62, 0x40, 0x7f, 0x19, 0x90, 0x5b, 0x2d, 0xb5, 0xa2, 0x9d,
      0xc7, 0x3d, 0xcc, 0x15, 0x0,  0xd,  0xa9, 0x36, 0x7,  0xc5, 0x6,  0x56, 0x7b, 0x43, 0x7e, 0x6,  0xa6, 0xd8, 0x75,
      0x1c, 0x0,  0x12, 0x94, 0x77, 0x25, 0x61, 0x52, 0x2c, 0x5,  0x68, 0x3d, 0x31, 0x4b, 0x12, 0xfc, 0xfb, 0x84, 0xa6,
      0x4c, 0x41, 0x12, 0x0,  0x4,  0x2f, 0xd4, 0x5d, 0xd0, 0x21, 0x6f, 0xb5, 0x2b, 0x3b, 0x16};
  uint8_t topic_bytes[] = {0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4, 0x6,
                           0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x3b, 0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xc3, 0x4, 0xf3, 0xa5, 0x98};
  uint8_t bytesprops1[] = {0xd7, 0xf, 0xdd, 0xa2, 0x23, 0xde, 0xf9, 0x23, 0x83};
  uint8_t bytesprops2[] = {0x75, 0x8c, 0x93, 0x16, 0xf7, 0x75, 0x72, 0xfe, 0xab, 0x80, 0xe3, 0x52,
                           0x5,  0xe7, 0x22, 0xd,  0x47, 0xe1, 0xc6, 0xd9, 0xcd, 0x47, 0x2f, 0xad};
  uint8_t bytesprops3[] = {0xce, 0x50, 0xa3};
  uint8_t bytesprops4[] = {0x28, 0x55, 0x41, 0x65, 0x7f, 0xea, 0xa0, 0x34, 0x52,
                           0x1d, 0x23, 0x71, 0xda, 0x4c, 0x14, 0x87, 0x48, 0x81};
  uint8_t bytesprops5[] = {0xe8, 0xbd};
  uint8_t bytesprops6[] = {0xe4, 0x2e, 0x42, 0xe0, 0x45, 0x79, 0x24, 0x67, 0xca, 0x66};
  uint8_t bytesprops7[] = {0x95, 0x6, 0x8b, 0x27, 0xec, 0xef, 0x6d, 0xbf};
  uint8_t bytesprops8[] = {0x62, 0x40, 0x7f, 0x19, 0x90, 0x5b, 0x2d, 0xb5, 0xa2, 0x9d, 0xc7, 0x3d, 0xcc};
  uint8_t bytesprops9[] = {0xa9, 0x36, 0x7, 0xc5, 0x6, 0x56, 0x7b, 0x43, 0x7e, 0x6, 0xa6, 0xd8, 0x75};
  uint8_t bytesprops10[] = {0x94, 0x77, 0x25, 0x61, 0x52, 0x2c, 0x5,  0x68, 0x3d,
                            0x31, 0x4b, 0x12, 0xfc, 0xfb, 0x84, 0xa6, 0x4c, 0x41};
  uint8_t bytesprops11[] = {0x2f, 0xd4, 0x5d, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28597}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25900, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\220\&2\138\ETX\145\167\209n\146\EOT\ACK\187\213\216b\156\231@\149\194\129", _pubPktID = 25900, _pubBody = "+;\SYN",
// _pubProps = [PropAuthenticationMethod "\195\EOT\243\165\152",PropSubscriptionIdentifierAvailable
// 98,PropAuthenticationMethod "\215\SI\221\162#\222\249#\131",PropReasonString
// "u\140\147\SYN\247ur\254\171\128\227R\ENQ\231\"\rG\225\198\217\205G/\173",PropResponseInformation
// "\206P\163",PropReasonString "(UAe\DEL\234\160\&4R\GS#q\218L\DC4\135H\129",PropSubscriptionIdentifierAvailable
// 81,PropResponseInformation "\232\189",PropAssignedClientIdentifier "\228.B\224Ey$g\202f",PropAuthenticationData
// "\149\ACK\139'\236\239m\191",PropMaximumQoS 220,PropAssignedClientIdentifier
// "b@\DEL\EM\144[-\181\162\157\199=\204",PropAuthenticationMethod
// "\169\&6\a\197\ACKV{C~\ACK\166\216u",PropServerReference
// "\148w%aR,\ENQh=1K\DC2\252\251\132\166LA",PropAssignedClientIdentifier "/\212]\208",PropReceiveMaximum 28597]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x34, 0xca, 0x1,  0x0,  0x15, 0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4,  0x6,  0xbb, 0xd5, 0xd8,
      0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81, 0x65, 0x2c, 0xac, 0x1,  0x15, 0x0,  0x5,  0xc3, 0x4,  0xf3, 0xa5, 0x98,
      0x29, 0x62, 0x15, 0x0,  0x9,  0xd7, 0xf,  0xdd, 0xa2, 0x23, 0xde, 0xf9, 0x23, 0x83, 0x1f, 0x0,  0x18, 0x75, 0x8c,
      0x93, 0x16, 0xf7, 0x75, 0x72, 0xfe, 0xab, 0x80, 0xe3, 0x52, 0x5,  0xe7, 0x22, 0xd,  0x47, 0xe1, 0xc6, 0xd9, 0xcd,
      0x47, 0x2f, 0xad, 0x1a, 0x0,  0x3,  0xce, 0x50, 0xa3, 0x1f, 0x0,  0x12, 0x28, 0x55, 0x41, 0x65, 0x7f, 0xea, 0xa0,
      0x34, 0x52, 0x1d, 0x23, 0x71, 0xda, 0x4c, 0x14, 0x87, 0x48, 0x81, 0x29, 0x51, 0x1a, 0x0,  0x2,  0xe8, 0xbd, 0x12,
      0x0,  0xa,  0xe4, 0x2e, 0x42, 0xe0, 0x45, 0x79, 0x24, 0x67, 0xca, 0x66, 0x16, 0x0,  0x8,  0x95, 0x6,  0x8b, 0x27,
      0xec, 0xef, 0x6d, 0xbf, 0x24, 0xdc, 0x12, 0x0,  0xd,  0x62, 0x40, 0x7f, 0x19, 0x90, 0x5b, 0x2d, 0xb5, 0xa2, 0x9d,
      0xc7, 0x3d, 0xcc, 0x15, 0x0,  0xd,  0xa9, 0x36, 0x7,  0xc5, 0x6,  0x56, 0x7b, 0x43, 0x7e, 0x6,  0xa6, 0xd8, 0x75,
      0x1c, 0x0,  0x12, 0x94, 0x77, 0x25, 0x61, 0x52, 0x2c, 0x5,  0x68, 0x3d, 0x31, 0x4b, 0x12, 0xfc, 0xfb, 0x84, 0xa6,
      0x4c, 0x41, 0x12, 0x0,  0x4,  0x2f, 0xd4, 0x5d, 0xd0, 0x21, 0x6f, 0xb5, 0x2b, 0x3b, 0x16};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdc, 0x32, 0x8a, 0x3,  0x91, 0xa7, 0xd1, 0x6e, 0x92, 0x4, 0x6,
                               0xbb, 0xd5, 0xd8, 0x62, 0x9c, 0xe7, 0x40, 0x95, 0xc2, 0x81};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x3b, 0x16};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25900);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\224", _pubPktID = 936, _pubBody =
// "6\245", _pubProps = [PropReasonString "\166\240\229cSm\228\224\238\155\244\a(\172",PropResponseInformation
// "\\\186\146\160mi\GS\217\ETXf\DEL\228\160\183\156\204\&7\a\152\232\179\253\182\246",PropAuthenticationData
// "\243*\210\USHX\142\129\193\167o\235}c\199\141",PropCorrelationData "\166\203\246\255\206@\180\228\188\EM7\211v
// ",PropSharedSubscriptionAvailable 173,PropSharedSubscriptionAvailable 56,PropWillDelayInterval
// 2519,PropAssignedClientIdentifier "",PropMaximumQoS 178,PropResponseInformation
// "\160n\142\131\154}\138\192\ETB}",PropUserProperty
// "8?\242\247\156CD\"\192\&4\222\175U\207&\186\231j\190Rx\202\220\151\192?\215\162"
// "\229'\225\142s\204\144\195\235*O\SOH8\a;8\183",PropWildcardSubscriptionAvailable 173,PropRetainAvailable
// 124,PropResponseInformation
// "\DLE)\214\150;\SO\249-.\150%\159\ETX@\SYN\131\ACK\229\248\ESC\208\&4s\182\ETB[A\r\187\235",PropUserProperty
// "\216\188\208\242\r\SUB\234\133\254\RS\254V\178T"
// "\174\142V^C\145\&0\DELy\176w\141\174\138i\251~\\Ui\132'",PropMaximumQoS 247]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x3a, 0xf6, 0x1,  0x0,  0x1,  0xe0, 0x3,  0xa8, 0xed, 0x1,  0x1f, 0x0,  0xe,  0xa6, 0xf0, 0xe5, 0x63,
                   0x53, 0x6d, 0xe4, 0xe0, 0xee, 0x9b, 0xf4, 0x7,  0x28, 0xac, 0x1a, 0x0,  0x18, 0x5c, 0xba, 0x92, 0xa0,
                   0x6d, 0x69, 0x1d, 0xd9, 0x3,  0x66, 0x7f, 0xe4, 0xa0, 0xb7, 0x9c, 0xcc, 0x37, 0x7,  0x98, 0xe8, 0xb3,
                   0xfd, 0xb6, 0xf6, 0x16, 0x0,  0x10, 0xf3, 0x2a, 0xd2, 0x1f, 0x48, 0x58, 0x8e, 0x81, 0xc1, 0xa7, 0x6f,
                   0xeb, 0x7d, 0x63, 0xc7, 0x8d, 0x9,  0x0,  0xe,  0xa6, 0xcb, 0xf6, 0xff, 0xce, 0x40, 0xb4, 0xe4, 0xbc,
                   0x19, 0x37, 0xd3, 0x76, 0x20, 0x2a, 0xad, 0x2a, 0x38, 0x18, 0x0,  0x0,  0x9,  0xd7, 0x12, 0x0,  0x0,
                   0x24, 0xb2, 0x1a, 0x0,  0xa,  0xa0, 0x6e, 0x8e, 0x83, 0x9a, 0x7d, 0x8a, 0xc0, 0x17, 0x7d, 0x26, 0x0,
                   0x1c, 0x38, 0x3f, 0xf2, 0xf7, 0x9c, 0x43, 0x44, 0x22, 0xc0, 0x34, 0xde, 0xaf, 0x55, 0xcf, 0x26, 0xba,
                   0xe7, 0x6a, 0xbe, 0x52, 0x78, 0xca, 0xdc, 0x97, 0xc0, 0x3f, 0xd7, 0xa2, 0x0,  0x11, 0xe5, 0x27, 0xe1,
                   0x8e, 0x73, 0xcc, 0x90, 0xc3, 0xeb, 0x2a, 0x4f, 0x1,  0x38, 0x7,  0x3b, 0x38, 0xb7, 0x28, 0xad, 0x25,
                   0x7c, 0x1a, 0x0,  0x1e, 0x10, 0x29, 0xd6, 0x96, 0x3b, 0xe,  0xf9, 0x2d, 0x2e, 0x96, 0x25, 0x9f, 0x3,
                   0x40, 0x16, 0x83, 0x6,  0xe5, 0xf8, 0x1b, 0xd0, 0x34, 0x73, 0xb6, 0x17, 0x5b, 0x41, 0xd,  0xbb, 0xeb,
                   0x26, 0x0,  0xe,  0xd8, 0xbc, 0xd0, 0xf2, 0xd,  0x1a, 0xea, 0x85, 0xfe, 0x1e, 0xfe, 0x56, 0xb2, 0x54,
                   0x0,  0x16, 0xae, 0x8e, 0x56, 0x5e, 0x43, 0x91, 0x30, 0x7f, 0x79, 0xb0, 0x77, 0x8d, 0xae, 0x8a, 0x69,
                   0xfb, 0x7e, 0x5c, 0x55, 0x69, 0x84, 0x27, 0x24, 0xf7, 0x36, 0xf5};
  uint8_t topic_bytes[] = {0xe0};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x36, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0xa6, 0xf0, 0xe5, 0x63, 0x53, 0x6d, 0xe4, 0xe0, 0xee, 0x9b, 0xf4, 0x7, 0x28, 0xac};
  uint8_t bytesprops1[] = {0x5c, 0xba, 0x92, 0xa0, 0x6d, 0x69, 0x1d, 0xd9, 0x3,  0x66, 0x7f, 0xe4,
                           0xa0, 0xb7, 0x9c, 0xcc, 0x37, 0x7,  0x98, 0xe8, 0xb3, 0xfd, 0xb6, 0xf6};
  uint8_t bytesprops2[] = {0xf3, 0x2a, 0xd2, 0x1f, 0x48, 0x58, 0x8e, 0x81,
                           0xc1, 0xa7, 0x6f, 0xeb, 0x7d, 0x63, 0xc7, 0x8d};
  uint8_t bytesprops3[] = {0xa6, 0xcb, 0xf6, 0xff, 0xce, 0x40, 0xb4, 0xe4, 0xbc, 0x19, 0x37, 0xd3, 0x76, 0x20};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0xa0, 0x6e, 0x8e, 0x83, 0x9a, 0x7d, 0x8a, 0xc0, 0x17, 0x7d};
  uint8_t bytesprops7[] = {0xe5, 0x27, 0xe1, 0x8e, 0x73, 0xcc, 0x90, 0xc3, 0xeb,
                           0x2a, 0x4f, 0x1,  0x38, 0x7,  0x3b, 0x38, 0xb7};
  uint8_t bytesprops6[] = {0x38, 0x3f, 0xf2, 0xf7, 0x9c, 0x43, 0x44, 0x22, 0xc0, 0x34, 0xde, 0xaf, 0x55, 0xcf,
                           0x26, 0xba, 0xe7, 0x6a, 0xbe, 0x52, 0x78, 0xca, 0xdc, 0x97, 0xc0, 0x3f, 0xd7, 0xa2};
  uint8_t bytesprops8[] = {0x10, 0x29, 0xd6, 0x96, 0x3b, 0xe,  0xf9, 0x2d, 0x2e, 0x96, 0x25, 0x9f, 0x3, 0x40, 0x16,
                           0x83, 0x6,  0xe5, 0xf8, 0x1b, 0xd0, 0x34, 0x73, 0xb6, 0x17, 0x5b, 0x41, 0xd, 0xbb, 0xeb};
  uint8_t bytesprops10[] = {0xae, 0x8e, 0x56, 0x5e, 0x43, 0x91, 0x30, 0x7f, 0x79, 0xb0, 0x77,
                            0x8d, 0xae, 0x8a, 0x69, 0xfb, 0x7e, 0x5c, 0x55, 0x69, 0x84, 0x27};
  uint8_t bytesprops9[] = {0xd8, 0xbc, 0xd0, 0xf2, 0xd, 0x1a, 0xea, 0x85, 0xfe, 0x1e, 0xfe, 0x56, 0xb2, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2519}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops6}, .v = {17, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops9}, .v = {22, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 936, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\224", _pubPktID = 936, _pubBody =
// "6\245", _pubProps = [PropReasonString "\166\240\229cSm\228\224\238\155\244\a(\172",PropResponseInformation
// "\\\186\146\160mi\GS\217\ETXf\DEL\228\160\183\156\204\&7\a\152\232\179\253\182\246",PropAuthenticationData
// "\243*\210\USHX\142\129\193\167o\235}c\199\141",PropCorrelationData "\166\203\246\255\206@\180\228\188\EM7\211v
// ",PropSharedSubscriptionAvailable 173,PropSharedSubscriptionAvailable 56,PropWillDelayInterval
// 2519,PropAssignedClientIdentifier "",PropMaximumQoS 178,PropResponseInformation
// "\160n\142\131\154}\138\192\ETB}",PropUserProperty
// "8?\242\247\156CD\"\192\&4\222\175U\207&\186\231j\190Rx\202\220\151\192?\215\162"
// "\229'\225\142s\204\144\195\235*O\SOH8\a;8\183",PropWildcardSubscriptionAvailable 173,PropRetainAvailable
// 124,PropResponseInformation
// "\DLE)\214\150;\SO\249-.\150%\159\ETX@\SYN\131\ACK\229\248\ESC\208\&4s\182\ETB[A\r\187\235",PropUserProperty
// "\216\188\208\242\r\SUB\234\133\254\RS\254V\178T"
// "\174\142V^C\145\&0\DELy\176w\141\174\138i\251~\\Ui\132'",PropMaximumQoS 247]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {0x3a, 0xf6, 0x1,  0x0,  0x1,  0xe0, 0x3,  0xa8, 0xed, 0x1,  0x1f, 0x0,  0xe,  0xa6, 0xf0, 0xe5, 0x63,
                   0x53, 0x6d, 0xe4, 0xe0, 0xee, 0x9b, 0xf4, 0x7,  0x28, 0xac, 0x1a, 0x0,  0x18, 0x5c, 0xba, 0x92, 0xa0,
                   0x6d, 0x69, 0x1d, 0xd9, 0x3,  0x66, 0x7f, 0xe4, 0xa0, 0xb7, 0x9c, 0xcc, 0x37, 0x7,  0x98, 0xe8, 0xb3,
                   0xfd, 0xb6, 0xf6, 0x16, 0x0,  0x10, 0xf3, 0x2a, 0xd2, 0x1f, 0x48, 0x58, 0x8e, 0x81, 0xc1, 0xa7, 0x6f,
                   0xeb, 0x7d, 0x63, 0xc7, 0x8d, 0x9,  0x0,  0xe,  0xa6, 0xcb, 0xf6, 0xff, 0xce, 0x40, 0xb4, 0xe4, 0xbc,
                   0x19, 0x37, 0xd3, 0x76, 0x20, 0x2a, 0xad, 0x2a, 0x38, 0x18, 0x0,  0x0,  0x9,  0xd7, 0x12, 0x0,  0x0,
                   0x24, 0xb2, 0x1a, 0x0,  0xa,  0xa0, 0x6e, 0x8e, 0x83, 0x9a, 0x7d, 0x8a, 0xc0, 0x17, 0x7d, 0x26, 0x0,
                   0x1c, 0x38, 0x3f, 0xf2, 0xf7, 0x9c, 0x43, 0x44, 0x22, 0xc0, 0x34, 0xde, 0xaf, 0x55, 0xcf, 0x26, 0xba,
                   0xe7, 0x6a, 0xbe, 0x52, 0x78, 0xca, 0xdc, 0x97, 0xc0, 0x3f, 0xd7, 0xa2, 0x0,  0x11, 0xe5, 0x27, 0xe1,
                   0x8e, 0x73, 0xcc, 0x90, 0xc3, 0xeb, 0x2a, 0x4f, 0x1,  0x38, 0x7,  0x3b, 0x38, 0xb7, 0x28, 0xad, 0x25,
                   0x7c, 0x1a, 0x0,  0x1e, 0x10, 0x29, 0xd6, 0x96, 0x3b, 0xe,  0xf9, 0x2d, 0x2e, 0x96, 0x25, 0x9f, 0x3,
                   0x40, 0x16, 0x83, 0x6,  0xe5, 0xf8, 0x1b, 0xd0, 0x34, 0x73, 0xb6, 0x17, 0x5b, 0x41, 0xd,  0xbb, 0xeb,
                   0x26, 0x0,  0xe,  0xd8, 0xbc, 0xd0, 0xf2, 0xd,  0x1a, 0xea, 0x85, 0xfe, 0x1e, 0xfe, 0x56, 0xb2, 0x54,
                   0x0,  0x16, 0xae, 0x8e, 0x56, 0x5e, 0x43, 0x91, 0x30, 0x7f, 0x79, 0xb0, 0x77, 0x8d, 0xae, 0x8a, 0x69,
                   0xfb, 0x7e, 0x5c, 0x55, 0x69, 0x84, 0x27, 0x24, 0xf7, 0x36, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe0};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x36, 0xf5};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 936);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "E\177\160\226\133O\252!\"\251\129\164{\STX\178\165g\229E\168\162\209>N\STXWn\191\235", _pubPktID = 0, _pubBody =
// "t\139\164\144a\157:\239\157\145M\SI\t\162\DC1\194D\143\134", _pubProps = [PropContentType
// "\aB\249\179\ESC\SOH\193\252\164f\136\224",PropRequestResponseInformation 214,PropReceiveMaximum
// 4070,PropSubscriptionIdentifierAvailable 193,PropRequestProblemInformation 237,PropSharedSubscriptionAvailable
// 176,PropPayloadFormatIndicator 69,PropSessionExpiryInterval 30221,PropSubscriptionIdentifierAvailable
// 79,PropMessageExpiryInterval 25509,PropAuthenticationData
// "\131\231\181\168G\US>\238V\138\\F>B|\133\233\175",PropTopicAliasMaximum 2402,PropRetainAvailable 204]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x30, 0x75, 0x0,  0x1d, 0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81,
                   0xa4, 0x7b, 0x2,  0xb2, 0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57,
                   0x6e, 0xbf, 0xeb, 0x42, 0x3,  0x0,  0xc,  0x7,  0x42, 0xf9, 0xb3, 0x1b, 0x1,  0xc1, 0xfc,
                   0xa4, 0x66, 0x88, 0xe0, 0x19, 0xd6, 0x21, 0xf,  0xe6, 0x29, 0xc1, 0x17, 0xed, 0x2a, 0xb0,
                   0x1,  0x45, 0x11, 0x0,  0x0,  0x76, 0xd,  0x29, 0x4f, 0x2,  0x0,  0x0,  0x63, 0xa5, 0x16,
                   0x0,  0x12, 0x83, 0xe7, 0xb5, 0xa8, 0x47, 0x1f, 0x3e, 0xee, 0x56, 0x8a, 0x5c, 0x46, 0x3e,
                   0x42, 0x7c, 0x85, 0xe9, 0xaf, 0x22, 0x9,  0x62, 0x25, 0xcc, 0x74, 0x8b, 0xa4, 0x90, 0x61,
                   0x9d, 0x3a, 0xef, 0x9d, 0x91, 0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  uint8_t topic_bytes[] = {0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81, 0xa4, 0x7b, 0x2, 0xb2,
                           0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d, 0x3a, 0xef, 0x9d, 0x91,
                         0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x7, 0x42, 0xf9, 0xb3, 0x1b, 0x1, 0xc1, 0xfc, 0xa4, 0x66, 0x88, 0xe0};
  uint8_t bytesprops1[] = {0x83, 0xe7, 0xb5, 0xa8, 0x47, 0x1f, 0x3e, 0xee, 0x56,
                           0x8a, 0x5c, 0x46, 0x3e, 0x42, 0x7c, 0x85, 0xe9, 0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4070}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30221}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25509}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2402}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "E\177\160\226\133O\252!\"\251\129\164{\STX\178\165g\229E\168\162\209>N\STXWn\191\235", _pubPktID = 0, _pubBody =
// "t\139\164\144a\157:\239\157\145M\SI\t\162\DC1\194D\143\134", _pubProps = [PropContentType
// "\aB\249\179\ESC\SOH\193\252\164f\136\224",PropRequestResponseInformation 214,PropReceiveMaximum
// 4070,PropSubscriptionIdentifierAvailable 193,PropRequestProblemInformation 237,PropSharedSubscriptionAvailable
// 176,PropPayloadFormatIndicator 69,PropSessionExpiryInterval 30221,PropSubscriptionIdentifierAvailable
// 79,PropMessageExpiryInterval 25509,PropAuthenticationData
// "\131\231\181\168G\US>\238V\138\\F>B|\133\233\175",PropTopicAliasMaximum 2402,PropRetainAvailable 204]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x30, 0x75, 0x0,  0x1d, 0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81,
                   0xa4, 0x7b, 0x2,  0xb2, 0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57,
                   0x6e, 0xbf, 0xeb, 0x42, 0x3,  0x0,  0xc,  0x7,  0x42, 0xf9, 0xb3, 0x1b, 0x1,  0xc1, 0xfc,
                   0xa4, 0x66, 0x88, 0xe0, 0x19, 0xd6, 0x21, 0xf,  0xe6, 0x29, 0xc1, 0x17, 0xed, 0x2a, 0xb0,
                   0x1,  0x45, 0x11, 0x0,  0x0,  0x76, 0xd,  0x29, 0x4f, 0x2,  0x0,  0x0,  0x63, 0xa5, 0x16,
                   0x0,  0x12, 0x83, 0xe7, 0xb5, 0xa8, 0x47, 0x1f, 0x3e, 0xee, 0x56, 0x8a, 0x5c, 0x46, 0x3e,
                   0x42, 0x7c, 0x85, 0xe9, 0xaf, 0x22, 0x9,  0x62, 0x25, 0xcc, 0x74, 0x8b, 0xa4, 0x90, 0x61,
                   0x9d, 0x3a, 0xef, 0x9d, 0x91, 0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x45, 0xb1, 0xa0, 0xe2, 0x85, 0x4f, 0xfc, 0x21, 0x22, 0xfb, 0x81, 0xa4, 0x7b, 0x2, 0xb2,
                               0xa5, 0x67, 0xe5, 0x45, 0xa8, 0xa2, 0xd1, 0x3e, 0x4e, 0x2,  0x57, 0x6e, 0xbf, 0xeb};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x74, 0x8b, 0xa4, 0x90, 0x61, 0x9d, 0x3a, 0xef, 0x9d, 0x91,
                              0x4d, 0xf,  0x9,  0xa2, 0x11, 0xc2, 0x44, 0x8f, 0x86};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\208\167\232\STX\DLE\GSQr\146|",
// _pubPktID = 8189, _pubBody = "c`\ESC\156x\229(\255\178\168\214\240a\217\197\224\170\174\&48pk\NAK\200\ETX\130\235",
// _pubProps = [PropPayloadFormatIndicator 219,PropServerKeepAlive 25155,PropCorrelationData
// "\v\224\240\182",PropRetainAvailable 10,PropAssignedClientIdentifier
// "\173\DEL\168\159v\DLEi\203\212\235@\221\181c\129\178\201\251\135\NUL\190\188bc>\195c",PropTopicAlias
// 18173,PropSessionExpiryInterval 627,PropResponseInformation "[j\202B\212|\237\252\207",PropRequestResponseInformation
// 209]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x3a, 0x6c, 0x0,  0xa,  0xd0, 0xa7, 0xe8, 0x2,  0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c, 0x1f, 0xfd,
                   0x42, 0x1,  0xdb, 0x13, 0x62, 0x43, 0x9,  0x0,  0x4,  0xb,  0xe0, 0xf0, 0xb6, 0x25, 0xa,  0x12,
                   0x0,  0x1b, 0xad, 0x7f, 0xa8, 0x9f, 0x76, 0x10, 0x69, 0xcb, 0xd4, 0xeb, 0x40, 0xdd, 0xb5, 0x63,
                   0x81, 0xb2, 0xc9, 0xfb, 0x87, 0x0,  0xbe, 0xbc, 0x62, 0x63, 0x3e, 0xc3, 0x63, 0x23, 0x46, 0xfd,
                   0x11, 0x0,  0x0,  0x2,  0x73, 0x1a, 0x0,  0x9,  0x5b, 0x6a, 0xca, 0x42, 0xd4, 0x7c, 0xed, 0xfc,
                   0xcf, 0x19, 0xd1, 0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61,
                   0xd9, 0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  uint8_t topic_bytes[] = {0xd0, 0xa7, 0xe8, 0x2, 0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                         0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0xb, 0xe0, 0xf0, 0xb6};
  uint8_t bytesprops1[] = {0xad, 0x7f, 0xa8, 0x9f, 0x76, 0x10, 0x69, 0xcb, 0xd4, 0xeb, 0x40, 0xdd, 0xb5, 0x63,
                           0x81, 0xb2, 0xc9, 0xfb, 0x87, 0x0,  0xbe, 0xbc, 0x62, 0x63, 0x3e, 0xc3, 0x63};
  uint8_t bytesprops2[] = {0x5b, 0x6a, 0xca, 0x42, 0xd4, 0x7c, 0xed, 0xfc, 0xcf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25155}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18173}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 627}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 209}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 8189, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\208\167\232\STX\DLE\GSQr\146|",
// _pubPktID = 8189, _pubBody = "c`\ESC\156x\229(\255\178\168\214\240a\217\197\224\170\174\&48pk\NAK\200\ETX\130\235",
// _pubProps = [PropPayloadFormatIndicator 219,PropServerKeepAlive 25155,PropCorrelationData
// "\v\224\240\182",PropRetainAvailable 10,PropAssignedClientIdentifier
// "\173\DEL\168\159v\DLEi\203\212\235@\221\181c\129\178\201\251\135\NUL\190\188bc>\195c",PropTopicAlias
// 18173,PropSessionExpiryInterval 627,PropResponseInformation "[j\202B\212|\237\252\207",PropRequestResponseInformation
// 209]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x3a, 0x6c, 0x0,  0xa,  0xd0, 0xa7, 0xe8, 0x2,  0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c, 0x1f, 0xfd,
                   0x42, 0x1,  0xdb, 0x13, 0x62, 0x43, 0x9,  0x0,  0x4,  0xb,  0xe0, 0xf0, 0xb6, 0x25, 0xa,  0x12,
                   0x0,  0x1b, 0xad, 0x7f, 0xa8, 0x9f, 0x76, 0x10, 0x69, 0xcb, 0xd4, 0xeb, 0x40, 0xdd, 0xb5, 0x63,
                   0x81, 0xb2, 0xc9, 0xfb, 0x87, 0x0,  0xbe, 0xbc, 0x62, 0x63, 0x3e, 0xc3, 0x63, 0x23, 0x46, 0xfd,
                   0x11, 0x0,  0x0,  0x2,  0x73, 0x1a, 0x0,  0x9,  0x5b, 0x6a, 0xca, 0x42, 0xd4, 0x7c, 0xed, 0xfc,
                   0xcf, 0x19, 0xd1, 0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61,
                   0xd9, 0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd0, 0xa7, 0xe8, 0x2, 0x10, 0x1d, 0x51, 0x72, 0x92, 0x7c};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x63, 0x60, 0x1b, 0x9c, 0x78, 0xe5, 0x28, 0xff, 0xb2, 0xa8, 0xd6, 0xf0, 0x61, 0xd9,
                              0xc5, 0xe0, 0xaa, 0xae, 0x34, 0x38, 0x70, 0x6b, 0x15, 0xc8, 0x3,  0x82, 0xeb};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8189);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "b\245\197\244\&04\214\&6*\178",
// _pubPktID = 0, _pubBody = "\184", _pubProps = [PropSubscriptionIdentifier 30,PropReasonString
// "7c\157K\v\162l\155?\162\133\203o\236\152!4\149\249\160\US\139\DEL^\130^\130",PropMessageExpiryInterval
// 346,PropTopicAliasMaximum 7985]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x38, 0x36, 0x0,  0xa,  0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2,
                   0x28, 0xb,  0x1e, 0x1f, 0x0,  0x1b, 0x37, 0x63, 0x9d, 0x4b, 0xb,  0xa2, 0x6c, 0x9b,
                   0x3f, 0xa2, 0x85, 0xcb, 0x6f, 0xec, 0x98, 0x21, 0x34, 0x95, 0xf9, 0xa0, 0x1f, 0x8b,
                   0x7f, 0x5e, 0x82, 0x5e, 0x82, 0x2,  0x0,  0x0,  0x1,  0x5a, 0x22, 0x1f, 0x31, 0xb8};
  uint8_t topic_bytes[] = {0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x37, 0x63, 0x9d, 0x4b, 0xb,  0xa2, 0x6c, 0x9b, 0x3f, 0xa2, 0x85, 0xcb, 0x6f, 0xec,
                           0x98, 0x21, 0x34, 0x95, 0xf9, 0xa0, 0x1f, 0x8b, 0x7f, 0x5e, 0x82, 0x5e, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 346}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7985}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "b\245\197\244\&04\214\&6*\178",
// _pubPktID = 0, _pubBody = "\184", _pubProps = [PropSubscriptionIdentifier 30,PropReasonString
// "7c\157K\v\162l\155?\162\133\203o\236\152!4\149\249\160\US\139\DEL^\130^\130",PropMessageExpiryInterval
// 346,PropTopicAliasMaximum 7985]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x38, 0x36, 0x0,  0xa,  0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2,
                   0x28, 0xb,  0x1e, 0x1f, 0x0,  0x1b, 0x37, 0x63, 0x9d, 0x4b, 0xb,  0xa2, 0x6c, 0x9b,
                   0x3f, 0xa2, 0x85, 0xcb, 0x6f, 0xec, 0x98, 0x21, 0x34, 0x95, 0xf9, 0xa0, 0x1f, 0x8b,
                   0x7f, 0x5e, 0x82, 0x5e, 0x82, 0x2,  0x0,  0x0,  0x1,  0x5a, 0x22, 0x1f, 0x31, 0xb8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x62, 0xf5, 0xc5, 0xf4, 0x30, 0x34, 0xd6, 0x36, 0x2a, 0xb2};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb8};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\200\170v\196", _pubPktID = 30063,
// _pubBody = "\RS(g\190(g%\FS\249\135\DC1S\250\ACK(N\CANHC\157\RSK\175\DEL\225\159", _pubProps = [PropRetainAvailable
// 155,PropRequestResponseInformation 86,PropResponseInformation "e\216\214f\152\213C\173",PropReasonString
// "(\131\DEL\DC12\229E\233\146$6\164\165\SO\148",PropResponseTopic
// "\248y\172\190\154^\221\DC3/\166\SO\193N3\164@HN\203\185\247\168\USR\RS\248R\241i\217",PropSharedSubscriptionAvailable
// 148,PropWildcardSubscriptionAvailable 183,PropWillDelayInterval 14294]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x3c, 0x6e, 0x0,  0x4,  0xc8, 0xaa, 0x76, 0xc4, 0x75, 0x6f, 0x4b, 0x25, 0x9b, 0x19, 0x56, 0x1a,
                   0x0,  0x8,  0x65, 0xd8, 0xd6, 0x66, 0x98, 0xd5, 0x43, 0xad, 0x1f, 0x0,  0xf,  0x28, 0x83, 0x7f,
                   0x11, 0x32, 0xe5, 0x45, 0xe9, 0x92, 0x24, 0x36, 0xa4, 0xa5, 0xe,  0x94, 0x8,  0x0,  0x1e, 0xf8,
                   0x79, 0xac, 0xbe, 0x9a, 0x5e, 0xdd, 0x13, 0x2f, 0xa6, 0xe,  0xc1, 0x4e, 0x33, 0xa4, 0x40, 0x48,
                   0x4e, 0xcb, 0xb9, 0xf7, 0xa8, 0x1f, 0x52, 0x1e, 0xf8, 0x52, 0xf1, 0x69, 0xd9, 0x2a, 0x94, 0x28,
                   0xb7, 0x18, 0x0,  0x0,  0x37, 0xd6, 0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87,
                   0x11, 0x53, 0xfa, 0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  uint8_t topic_bytes[] = {0xc8, 0xaa, 0x76, 0xc4};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa,
                         0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x65, 0xd8, 0xd6, 0x66, 0x98, 0xd5, 0x43, 0xad};
  uint8_t bytesprops1[] = {0x28, 0x83, 0x7f, 0x11, 0x32, 0xe5, 0x45, 0xe9, 0x92, 0x24, 0x36, 0xa4, 0xa5, 0xe, 0x94};
  uint8_t bytesprops2[] = {0xf8, 0x79, 0xac, 0xbe, 0x9a, 0x5e, 0xdd, 0x13, 0x2f, 0xa6, 0xe,  0xc1, 0x4e, 0x33, 0xa4,
                           0x40, 0x48, 0x4e, 0xcb, 0xb9, 0xf7, 0xa8, 0x1f, 0x52, 0x1e, 0xf8, 0x52, 0xf1, 0x69, 0xd9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14294}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 30063, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\200\170v\196", _pubPktID = 30063,
// _pubBody = "\RS(g\190(g%\FS\249\135\DC1S\250\ACK(N\CANHC\157\RSK\175\DEL\225\159", _pubProps = [PropRetainAvailable
// 155,PropRequestResponseInformation 86,PropResponseInformation "e\216\214f\152\213C\173",PropReasonString
// "(\131\DEL\DC12\229E\233\146$6\164\165\SO\148",PropResponseTopic
// "\248y\172\190\154^\221\DC3/\166\SO\193N3\164@HN\203\185\247\168\USR\RS\248R\241i\217",PropSharedSubscriptionAvailable
// 148,PropWildcardSubscriptionAvailable 183,PropWillDelayInterval 14294]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x3c, 0x6e, 0x0,  0x4,  0xc8, 0xaa, 0x76, 0xc4, 0x75, 0x6f, 0x4b, 0x25, 0x9b, 0x19, 0x56, 0x1a,
                   0x0,  0x8,  0x65, 0xd8, 0xd6, 0x66, 0x98, 0xd5, 0x43, 0xad, 0x1f, 0x0,  0xf,  0x28, 0x83, 0x7f,
                   0x11, 0x32, 0xe5, 0x45, 0xe9, 0x92, 0x24, 0x36, 0xa4, 0xa5, 0xe,  0x94, 0x8,  0x0,  0x1e, 0xf8,
                   0x79, 0xac, 0xbe, 0x9a, 0x5e, 0xdd, 0x13, 0x2f, 0xa6, 0xe,  0xc1, 0x4e, 0x33, 0xa4, 0x40, 0x48,
                   0x4e, 0xcb, 0xb9, 0xf7, 0xa8, 0x1f, 0x52, 0x1e, 0xf8, 0x52, 0xf1, 0x69, 0xd9, 0x2a, 0x94, 0x28,
                   0xb7, 0x18, 0x0,  0x0,  0x37, 0xd6, 0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87,
                   0x11, 0x53, 0xfa, 0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc8, 0xaa, 0x76, 0xc4};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1e, 0x28, 0x67, 0xbe, 0x28, 0x67, 0x25, 0x1c, 0xf9, 0x87, 0x11, 0x53, 0xfa,
                              0x6,  0x28, 0x4e, 0x18, 0x48, 0x43, 0x9d, 0x1e, 0x4b, 0xaf, 0x7f, 0xe1, 0x9f};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 30063);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\229<<\234;", _pubPktID = 0,
// _pubBody = "+ eK\208\CAN\232\179\167\129\227'Hqi\SO\163\r\168\188\157\247", _pubProps = [PropReasonString
// "\218&",PropMaximumQoS 139,PropUserProperty "u9\246l\ETB\227?V@~"
// "\246\248KBQ\ACK",PropSubscriptionIdentifierAvailable 161,PropRetainAvailable 146,PropAssignedClientIdentifier
// "\189\233\146\140Ir\207px9\172g\193\216Z\243\244\133\137\RSybT\172E\133L",PropRequestProblemInformation
// 56,PropSharedSubscriptionAvailable 91,PropAssignedClientIdentifier "\DC2\146",PropResponseInformation
// "A\250\217\RS\228v\ACK30rj\157\222\181\181#LE\221!\234\DC28\151\129\211\156\210\183",PropReasonString
// "\SO",PropReceiveMaximum 9804,PropSessionExpiryInterval 21555,PropSessionExpiryInterval 19432,PropUserProperty
// "\202pV\252{\200\197\154\140\US\154\157\184\183\218\213\171"
// "\189\DC2\143\236\177\153\SOH6\227\246f\SUB\191\143`",PropTopicAliasMaximum 19556,PropTopicAlias 6627,PropMaximumQoS
// 46,PropAuthenticationData "\241\\\130\DC1\172\ETX\RS\128y\ENQ\211\138V\255\RS\199u\222w\241\219\178",PropMaximumQoS
// 40,PropAuthenticationMethod "Q\171"]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0xe4, 0x1,  0x0,  0x5,  0xe5, 0x3c, 0x3c, 0xea, 0x3b, 0xc5, 0x1,  0x1f, 0x0,  0x2,  0xda, 0x26,
                   0x24, 0x8b, 0x26, 0x0,  0xa,  0x75, 0x39, 0xf6, 0x6c, 0x17, 0xe3, 0x3f, 0x56, 0x40, 0x7e, 0x0,  0x6,
                   0xf6, 0xf8, 0x4b, 0x42, 0x51, 0x6,  0x29, 0xa1, 0x25, 0x92, 0x12, 0x0,  0x1b, 0xbd, 0xe9, 0x92, 0x8c,
                   0x49, 0x72, 0xcf, 0x70, 0x78, 0x39, 0xac, 0x67, 0xc1, 0xd8, 0x5a, 0xf3, 0xf4, 0x85, 0x89, 0x1e, 0x79,
                   0x62, 0x54, 0xac, 0x45, 0x85, 0x4c, 0x17, 0x38, 0x2a, 0x5b, 0x12, 0x0,  0x2,  0x12, 0x92, 0x1a, 0x0,
                   0x1d, 0x41, 0xfa, 0xd9, 0x1e, 0xe4, 0x76, 0x6,  0x33, 0x30, 0x72, 0x6a, 0x9d, 0xde, 0xb5, 0xb5, 0x23,
                   0x4c, 0x45, 0xdd, 0x21, 0xea, 0x12, 0x38, 0x97, 0x81, 0xd3, 0x9c, 0xd2, 0xb7, 0x1f, 0x0,  0x1,  0xe,
                   0x21, 0x26, 0x4c, 0x11, 0x0,  0x0,  0x54, 0x33, 0x11, 0x0,  0x0,  0x4b, 0xe8, 0x26, 0x0,  0x11, 0xca,
                   0x70, 0x56, 0xfc, 0x7b, 0xc8, 0xc5, 0x9a, 0x8c, 0x1f, 0x9a, 0x9d, 0xb8, 0xb7, 0xda, 0xd5, 0xab, 0x0,
                   0xf,  0xbd, 0x12, 0x8f, 0xec, 0xb1, 0x99, 0x1,  0x36, 0xe3, 0xf6, 0x66, 0x1a, 0xbf, 0x8f, 0x60, 0x22,
                   0x4c, 0x64, 0x23, 0x19, 0xe3, 0x24, 0x2e, 0x16, 0x0,  0x16, 0xf1, 0x5c, 0x82, 0x11, 0xac, 0x3,  0x1e,
                   0x80, 0x79, 0x5,  0xd3, 0x8a, 0x56, 0xff, 0x1e, 0xc7, 0x75, 0xde, 0x77, 0xf1, 0xdb, 0xb2, 0x24, 0x28,
                   0x15, 0x0,  0x2,  0x51, 0xab, 0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3, 0x27,
                   0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  uint8_t topic_bytes[] = {0xe5, 0x3c, 0x3c, 0xea, 0x3b};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3,
                         0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0xda, 0x26};
  uint8_t bytesprops2[] = {0xf6, 0xf8, 0x4b, 0x42, 0x51, 0x6};
  uint8_t bytesprops1[] = {0x75, 0x39, 0xf6, 0x6c, 0x17, 0xe3, 0x3f, 0x56, 0x40, 0x7e};
  uint8_t bytesprops3[] = {0xbd, 0xe9, 0x92, 0x8c, 0x49, 0x72, 0xcf, 0x70, 0x78, 0x39, 0xac, 0x67, 0xc1, 0xd8,
                           0x5a, 0xf3, 0xf4, 0x85, 0x89, 0x1e, 0x79, 0x62, 0x54, 0xac, 0x45, 0x85, 0x4c};
  uint8_t bytesprops4[] = {0x12, 0x92};
  uint8_t bytesprops5[] = {0x41, 0xfa, 0xd9, 0x1e, 0xe4, 0x76, 0x6,  0x33, 0x30, 0x72, 0x6a, 0x9d, 0xde, 0xb5, 0xb5,
                           0x23, 0x4c, 0x45, 0xdd, 0x21, 0xea, 0x12, 0x38, 0x97, 0x81, 0xd3, 0x9c, 0xd2, 0xb7};
  uint8_t bytesprops6[] = {0xe};
  uint8_t bytesprops8[] = {0xbd, 0x12, 0x8f, 0xec, 0xb1, 0x99, 0x1, 0x36, 0xe3, 0xf6, 0x66, 0x1a, 0xbf, 0x8f, 0x60};
  uint8_t bytesprops7[] = {0xca, 0x70, 0x56, 0xfc, 0x7b, 0xc8, 0xc5, 0x9a, 0x8c,
                           0x1f, 0x9a, 0x9d, 0xb8, 0xb7, 0xda, 0xd5, 0xab};
  uint8_t bytesprops9[] = {0xf1, 0x5c, 0x82, 0x11, 0xac, 0x3,  0x1e, 0x80, 0x79, 0x5,  0xd3,
                           0x8a, 0x56, 0xff, 0x1e, 0xc7, 0x75, 0xde, 0x77, 0xf1, 0xdb, 0xb2};
  uint8_t bytesprops10[] = {0x51, 0xab};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops1}, .v = {6, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9804}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21555}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19432}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops7}, .v = {15, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19556}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6627}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\229<<\234;", _pubPktID = 0,
// _pubBody = "+ eK\208\CAN\232\179\167\129\227'Hqi\SO\163\r\168\188\157\247", _pubProps = [PropReasonString
// "\218&",PropMaximumQoS 139,PropUserProperty "u9\246l\ETB\227?V@~"
// "\246\248KBQ\ACK",PropSubscriptionIdentifierAvailable 161,PropRetainAvailable 146,PropAssignedClientIdentifier
// "\189\233\146\140Ir\207px9\172g\193\216Z\243\244\133\137\RSybT\172E\133L",PropRequestProblemInformation
// 56,PropSharedSubscriptionAvailable 91,PropAssignedClientIdentifier "\DC2\146",PropResponseInformation
// "A\250\217\RS\228v\ACK30rj\157\222\181\181#LE\221!\234\DC28\151\129\211\156\210\183",PropReasonString
// "\SO",PropReceiveMaximum 9804,PropSessionExpiryInterval 21555,PropSessionExpiryInterval 19432,PropUserProperty
// "\202pV\252{\200\197\154\140\US\154\157\184\183\218\213\171"
// "\189\DC2\143\236\177\153\SOH6\227\246f\SUB\191\143`",PropTopicAliasMaximum 19556,PropTopicAlias 6627,PropMaximumQoS
// 46,PropAuthenticationData "\241\\\130\DC1\172\ETX\RS\128y\ENQ\211\138V\255\RS\199u\222w\241\219\178",PropMaximumQoS
// 40,PropAuthenticationMethod "Q\171"]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x31, 0xe4, 0x1,  0x0,  0x5,  0xe5, 0x3c, 0x3c, 0xea, 0x3b, 0xc5, 0x1,  0x1f, 0x0,  0x2,  0xda, 0x26,
                   0x24, 0x8b, 0x26, 0x0,  0xa,  0x75, 0x39, 0xf6, 0x6c, 0x17, 0xe3, 0x3f, 0x56, 0x40, 0x7e, 0x0,  0x6,
                   0xf6, 0xf8, 0x4b, 0x42, 0x51, 0x6,  0x29, 0xa1, 0x25, 0x92, 0x12, 0x0,  0x1b, 0xbd, 0xe9, 0x92, 0x8c,
                   0x49, 0x72, 0xcf, 0x70, 0x78, 0x39, 0xac, 0x67, 0xc1, 0xd8, 0x5a, 0xf3, 0xf4, 0x85, 0x89, 0x1e, 0x79,
                   0x62, 0x54, 0xac, 0x45, 0x85, 0x4c, 0x17, 0x38, 0x2a, 0x5b, 0x12, 0x0,  0x2,  0x12, 0x92, 0x1a, 0x0,
                   0x1d, 0x41, 0xfa, 0xd9, 0x1e, 0xe4, 0x76, 0x6,  0x33, 0x30, 0x72, 0x6a, 0x9d, 0xde, 0xb5, 0xb5, 0x23,
                   0x4c, 0x45, 0xdd, 0x21, 0xea, 0x12, 0x38, 0x97, 0x81, 0xd3, 0x9c, 0xd2, 0xb7, 0x1f, 0x0,  0x1,  0xe,
                   0x21, 0x26, 0x4c, 0x11, 0x0,  0x0,  0x54, 0x33, 0x11, 0x0,  0x0,  0x4b, 0xe8, 0x26, 0x0,  0x11, 0xca,
                   0x70, 0x56, 0xfc, 0x7b, 0xc8, 0xc5, 0x9a, 0x8c, 0x1f, 0x9a, 0x9d, 0xb8, 0xb7, 0xda, 0xd5, 0xab, 0x0,
                   0xf,  0xbd, 0x12, 0x8f, 0xec, 0xb1, 0x99, 0x1,  0x36, 0xe3, 0xf6, 0x66, 0x1a, 0xbf, 0x8f, 0x60, 0x22,
                   0x4c, 0x64, 0x23, 0x19, 0xe3, 0x24, 0x2e, 0x16, 0x0,  0x16, 0xf1, 0x5c, 0x82, 0x11, 0xac, 0x3,  0x1e,
                   0x80, 0x79, 0x5,  0xd3, 0x8a, 0x56, 0xff, 0x1e, 0xc7, 0x75, 0xde, 0x77, 0xf1, 0xdb, 0xb2, 0x24, 0x28,
                   0x15, 0x0,  0x2,  0x51, 0xab, 0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3, 0x27,
                   0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe5, 0x3c, 0x3c, 0xea, 0x3b};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x20, 0x65, 0x4b, 0xd0, 0x18, 0xe8, 0xb3, 0xa7, 0x81, 0xe3,
                              0x27, 0x48, 0x71, 0x69, 0xe,  0xa3, 0xd,  0xa8, 0xbc, 0x9d, 0xf7};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ETX[\136\204X%<O\217v})\CAN&\DC2\200o\160\DC2h\214\215", _pubPktID = 0, _pubBody =
// "\SOHu\254\195M\192\254v<\221\FS\DC2\231[", _pubProps = [PropServerReference
// "\157\253\143f\215_\243\SYNV\239\215\160\ETB\SOH\231\161e\196\255\241\245\241\224",PropTopicAlias
// 9757,PropPayloadFormatIndicator 27,PropSubscriptionIdentifierAvailable 49,PropReceiveMaximum 3025]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x31, 0x4b, 0x0,  0x16, 0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d, 0x29,
                   0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7, 0x24, 0x1c, 0x0,  0x17, 0x9d, 0xfd,
                   0x8f, 0x66, 0xd7, 0x5f, 0xf3, 0x16, 0x56, 0xef, 0xd7, 0xa0, 0x17, 0x1,  0xe7, 0xa1, 0x65, 0xc4,
                   0xff, 0xf1, 0xf5, 0xf1, 0xe0, 0x23, 0x26, 0x1d, 0x1,  0x1b, 0x29, 0x31, 0x21, 0xb,  0xd1, 0x1,
                   0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  uint8_t topic_bytes[] = {0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d,
                           0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x9d, 0xfd, 0x8f, 0x66, 0xd7, 0x5f, 0xf3, 0x16, 0x56, 0xef, 0xd7, 0xa0,
                           0x17, 0x1,  0xe7, 0xa1, 0x65, 0xc4, 0xff, 0xf1, 0xf5, 0xf1, 0xe0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9757}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3025}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ETX[\136\204X%<O\217v})\CAN&\DC2\200o\160\DC2h\214\215", _pubPktID = 0, _pubBody =
// "\SOHu\254\195M\192\254v<\221\FS\DC2\231[", _pubProps = [PropServerReference
// "\157\253\143f\215_\243\SYNV\239\215\160\ETB\SOH\231\161e\196\255\241\245\241\224",PropTopicAlias
// 9757,PropPayloadFormatIndicator 27,PropSubscriptionIdentifierAvailable 49,PropReceiveMaximum 3025]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x31, 0x4b, 0x0,  0x16, 0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d, 0x29,
                   0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7, 0x24, 0x1c, 0x0,  0x17, 0x9d, 0xfd,
                   0x8f, 0x66, 0xd7, 0x5f, 0xf3, 0x16, 0x56, 0xef, 0xd7, 0xa0, 0x17, 0x1,  0xe7, 0xa1, 0x65, 0xc4,
                   0xff, 0xf1, 0xf5, 0xf1, 0xe0, 0x23, 0x26, 0x1d, 0x1,  0x1b, 0x29, 0x31, 0x21, 0xb,  0xd1, 0x1,
                   0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3,  0x5b, 0x88, 0xcc, 0x58, 0x25, 0x3c, 0x4f, 0xd9, 0x76, 0x7d,
                               0x29, 0x18, 0x26, 0x12, 0xc8, 0x6f, 0xa0, 0x12, 0x68, 0xd6, 0xd7};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0x75, 0xfe, 0xc3, 0x4d, 0xc0, 0xfe, 0x76, 0x3c, 0xdd, 0x1c, 0x12, 0xe7, 0x5b};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201eh\234\223\242\222", _pubPktID =
// 0, _pubBody = " .@o\137\224\135\201\224\168\\&%,\220\&6\DC2\SI\209\132J\DC2]\FS\210\132\134\189\b~", _pubProps =
// [PropAssignedClientIdentifier "\t",PropAssignedClientIdentifier "\173\246$\137\207\204\GSg\192{\"5\ACKp\140\FSf"]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x38, 0x40, 0x0,  0x7,  0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde, 0x18, 0x12, 0x0,  0x1,  0x9,  0x12,
                   0x0,  0x11, 0xad, 0xf6, 0x24, 0x89, 0xcf, 0xcc, 0x1d, 0x67, 0xc0, 0x7b, 0x22, 0x35, 0x6,  0x70, 0x8c,
                   0x1c, 0x66, 0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                   0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  uint8_t topic_bytes[] = {0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                         0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0x9};
  uint8_t bytesprops1[] = {0xad, 0xf6, 0x24, 0x89, 0xcf, 0xcc, 0x1d, 0x67, 0xc0,
                           0x7b, 0x22, 0x35, 0x6,  0x70, 0x8c, 0x1c, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201eh\234\223\242\222", _pubPktID =
// 0, _pubBody = " .@o\137\224\135\201\224\168\\&%,\220\&6\DC2\SI\209\132J\DC2]\FS\210\132\134\189\b~", _pubProps =
// [PropAssignedClientIdentifier "\t",PropAssignedClientIdentifier "\173\246$\137\207\204\GSg\192{\"5\ACKp\140\FSf"]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x38, 0x40, 0x0,  0x7,  0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde, 0x18, 0x12, 0x0,  0x1,  0x9,  0x12,
                   0x0,  0x11, 0xad, 0xf6, 0x24, 0x89, 0xcf, 0xcc, 0x1d, 0x67, 0xc0, 0x7b, 0x22, 0x35, 0x6,  0x70, 0x8c,
                   0x1c, 0x66, 0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                   0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc9, 0x65, 0x68, 0xea, 0xdf, 0xf2, 0xde};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x20, 0x2e, 0x40, 0x6f, 0x89, 0xe0, 0x87, 0xc9, 0xe0, 0xa8, 0x5c, 0x26, 0x25, 0x2c, 0xdc,
                              0x36, 0x12, 0xf,  0xd1, 0x84, 0x4a, 0x12, 0x5d, 0x1c, 0xd2, 0x84, 0x86, 0xbd, 0x8,  0x7e};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\200\227JE\EM6\185bARg\185\190\226e\205R\n\v\167\CAN\DC3~\152nd8\155'", _pubPktID = 24808, _pubBody =
// "\FS\196\NUL\238\180K\252nl\r\235$v\169K\163\182\254\134\186", _pubProps = [PropTopicAliasMaximum
// 26688,PropRetainAvailable 162,PropServerReference "\253u\144\199x\215\&0\142\v\161\177\US",PropMessageExpiryInterval
// 14586,PropCorrelationData
// "A\158C\241A\224\156\198'oa\227\&2<U\242Z\SYN}\166?v\150\222x",PropWildcardSubscriptionAvailable 84,PropTopicAlias
// 7300,PropReceiveMaximum 29553,PropServerKeepAlive 25807,PropMessageExpiryInterval 30045,PropTopicAliasMaximum
// 1288,PropReasonString "\195P\137\CAN",PropSessionExpiryInterval 20775,PropTopicAlias 11468,PropAuthenticationMethod
// "\246\DC2PU\NAK\227\144\&8a\RS\188\SI\133?W\235\173\DC25em 3\235t\GS\132d\210",PropServerKeepAlive
// 10764,PropServerReference "\136\179\205\215\EM\177JH\182",PropServerKeepAlive
// 2869,PropSubscriptionIdentifierAvailable 28,PropResponseInformation
// "\167\170\US\130\232v\ESC\201\217\159\164\129\154\157:\170\186\194z\168zi\164\DEL",PropRequestResponseInformation
// 200]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x34, 0xe0, 0x1,  0x0,  0x1e, 0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41, 0x52, 0x67, 0xb9, 0xbe,
      0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27, 0x60, 0xe8, 0xa8,
      0x1,  0x22, 0x68, 0x40, 0x25, 0xa2, 0x1c, 0x0,  0xc,  0xfd, 0x75, 0x90, 0xc7, 0x78, 0xd7, 0x30, 0x8e, 0xb,  0xa1,
      0xb1, 0x1f, 0x2,  0x0,  0x0,  0x38, 0xfa, 0x9,  0x0,  0x19, 0x41, 0x9e, 0x43, 0xf1, 0x41, 0xe0, 0x9c, 0xc6, 0x27,
      0x6f, 0x61, 0xe3, 0x32, 0x3c, 0x55, 0xf2, 0x5a, 0x16, 0x7d, 0xa6, 0x3f, 0x76, 0x96, 0xde, 0x78, 0x28, 0x54, 0x23,
      0x1c, 0x84, 0x21, 0x73, 0x71, 0x13, 0x64, 0xcf, 0x2,  0x0,  0x0,  0x75, 0x5d, 0x22, 0x5,  0x8,  0x1f, 0x0,  0x4,
      0xc3, 0x50, 0x89, 0x18, 0x11, 0x0,  0x0,  0x51, 0x27, 0x23, 0x2c, 0xcc, 0x15, 0x0,  0x1d, 0xf6, 0x12, 0x50, 0x55,
      0x15, 0xe3, 0x90, 0x38, 0x61, 0x1e, 0xbc, 0xf,  0x85, 0x3f, 0x57, 0xeb, 0xad, 0x12, 0x35, 0x65, 0x6d, 0x20, 0x33,
      0xeb, 0x74, 0x1d, 0x84, 0x64, 0xd2, 0x13, 0x2a, 0xc,  0x1c, 0x0,  0x9,  0x88, 0xb3, 0xcd, 0xd7, 0x19, 0xb1, 0x4a,
      0x48, 0xb6, 0x13, 0xb,  0x35, 0x29, 0x1c, 0x1a, 0x0,  0x18, 0xa7, 0xaa, 0x1f, 0x82, 0xe8, 0x76, 0x1b, 0xc9, 0xd9,
      0x9f, 0xa4, 0x81, 0x9a, 0x9d, 0x3a, 0xaa, 0xba, 0xc2, 0x7a, 0xa8, 0x7a, 0x69, 0xa4, 0x7f, 0x19, 0xc8, 0x1c, 0xc4,
      0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,  0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  uint8_t topic_bytes[] = {0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41, 0x52, 0x67, 0xb9, 0xbe, 0xe2,
                           0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,
                         0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0xfd, 0x75, 0x90, 0xc7, 0x78, 0xd7, 0x30, 0x8e, 0xb, 0xa1, 0xb1, 0x1f};
  uint8_t bytesprops1[] = {0x41, 0x9e, 0x43, 0xf1, 0x41, 0xe0, 0x9c, 0xc6, 0x27, 0x6f, 0x61, 0xe3, 0x32,
                           0x3c, 0x55, 0xf2, 0x5a, 0x16, 0x7d, 0xa6, 0x3f, 0x76, 0x96, 0xde, 0x78};
  uint8_t bytesprops2[] = {0xc3, 0x50, 0x89, 0x18};
  uint8_t bytesprops3[] = {0xf6, 0x12, 0x50, 0x55, 0x15, 0xe3, 0x90, 0x38, 0x61, 0x1e, 0xbc, 0xf,  0x85, 0x3f, 0x57,
                           0xeb, 0xad, 0x12, 0x35, 0x65, 0x6d, 0x20, 0x33, 0xeb, 0x74, 0x1d, 0x84, 0x64, 0xd2};
  uint8_t bytesprops4[] = {0x88, 0xb3, 0xcd, 0xd7, 0x19, 0xb1, 0x4a, 0x48, 0xb6};
  uint8_t bytesprops5[] = {0xa7, 0xaa, 0x1f, 0x82, 0xe8, 0x76, 0x1b, 0xc9, 0xd9, 0x9f, 0xa4, 0x81,
                           0x9a, 0x9d, 0x3a, 0xaa, 0xba, 0xc2, 0x7a, 0xa8, 0x7a, 0x69, 0xa4, 0x7f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26688}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14586}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7300}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29553}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25807}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30045}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1288}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20775}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11468}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10764}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2869}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24808, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "{\200\227JE\EM6\185bARg\185\190\226e\205R\n\v\167\CAN\DC3~\152nd8\155'", _pubPktID = 24808, _pubBody =
// "\FS\196\NUL\238\180K\252nl\r\235$v\169K\163\182\254\134\186", _pubProps = [PropTopicAliasMaximum
// 26688,PropRetainAvailable 162,PropServerReference "\253u\144\199x\215\&0\142\v\161\177\US",PropMessageExpiryInterval
// 14586,PropCorrelationData
// "A\158C\241A\224\156\198'oa\227\&2<U\242Z\SYN}\166?v\150\222x",PropWildcardSubscriptionAvailable 84,PropTopicAlias
// 7300,PropReceiveMaximum 29553,PropServerKeepAlive 25807,PropMessageExpiryInterval 30045,PropTopicAliasMaximum
// 1288,PropReasonString "\195P\137\CAN",PropSessionExpiryInterval 20775,PropTopicAlias 11468,PropAuthenticationMethod
// "\246\DC2PU\NAK\227\144\&8a\RS\188\SI\133?W\235\173\DC25em 3\235t\GS\132d\210",PropServerKeepAlive
// 10764,PropServerReference "\136\179\205\215\EM\177JH\182",PropServerKeepAlive
// 2869,PropSubscriptionIdentifierAvailable 28,PropResponseInformation
// "\167\170\US\130\232v\ESC\201\217\159\164\129\154\157:\170\186\194z\168zi\164\DEL",PropRequestResponseInformation
// 200]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {
      0x34, 0xe0, 0x1,  0x0,  0x1e, 0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41, 0x52, 0x67, 0xb9, 0xbe,
      0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,  0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27, 0x60, 0xe8, 0xa8,
      0x1,  0x22, 0x68, 0x40, 0x25, 0xa2, 0x1c, 0x0,  0xc,  0xfd, 0x75, 0x90, 0xc7, 0x78, 0xd7, 0x30, 0x8e, 0xb,  0xa1,
      0xb1, 0x1f, 0x2,  0x0,  0x0,  0x38, 0xfa, 0x9,  0x0,  0x19, 0x41, 0x9e, 0x43, 0xf1, 0x41, 0xe0, 0x9c, 0xc6, 0x27,
      0x6f, 0x61, 0xe3, 0x32, 0x3c, 0x55, 0xf2, 0x5a, 0x16, 0x7d, 0xa6, 0x3f, 0x76, 0x96, 0xde, 0x78, 0x28, 0x54, 0x23,
      0x1c, 0x84, 0x21, 0x73, 0x71, 0x13, 0x64, 0xcf, 0x2,  0x0,  0x0,  0x75, 0x5d, 0x22, 0x5,  0x8,  0x1f, 0x0,  0x4,
      0xc3, 0x50, 0x89, 0x18, 0x11, 0x0,  0x0,  0x51, 0x27, 0x23, 0x2c, 0xcc, 0x15, 0x0,  0x1d, 0xf6, 0x12, 0x50, 0x55,
      0x15, 0xe3, 0x90, 0x38, 0x61, 0x1e, 0xbc, 0xf,  0x85, 0x3f, 0x57, 0xeb, 0xad, 0x12, 0x35, 0x65, 0x6d, 0x20, 0x33,
      0xeb, 0x74, 0x1d, 0x84, 0x64, 0xd2, 0x13, 0x2a, 0xc,  0x1c, 0x0,  0x9,  0x88, 0xb3, 0xcd, 0xd7, 0x19, 0xb1, 0x4a,
      0x48, 0xb6, 0x13, 0xb,  0x35, 0x29, 0x1c, 0x1a, 0x0,  0x18, 0xa7, 0xaa, 0x1f, 0x82, 0xe8, 0x76, 0x1b, 0xc9, 0xd9,
      0x9f, 0xa4, 0x81, 0x9a, 0x9d, 0x3a, 0xaa, 0xba, 0xc2, 0x7a, 0xa8, 0x7a, 0x69, 0xa4, 0x7f, 0x19, 0xc8, 0x1c, 0xc4,
      0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,  0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7b, 0xc8, 0xe3, 0x4a, 0x45, 0x19, 0x36, 0xb9, 0x62, 0x41,
                               0x52, 0x67, 0xb9, 0xbe, 0xe2, 0x65, 0xcd, 0x52, 0xa,  0xb,
                               0xa7, 0x18, 0x13, 0x7e, 0x98, 0x6e, 0x64, 0x38, 0x9b, 0x27};
  lwmqtt_string_t exp_topic = {30, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1c, 0xc4, 0x0,  0xee, 0xb4, 0x4b, 0xfc, 0x6e, 0x6c, 0xd,
                              0xeb, 0x24, 0x76, 0xa9, 0x4b, 0xa3, 0xb6, 0xfe, 0x86, 0xba};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24808);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 30);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\139Q\DC1\195\175\199\249J\b\183\226\228\185\ESC\245\128\130\166\n]\133:\228\231$K*v", _pubPktID = 0, _pubBody =
// "\SOH\135h\234D\134\149\210zy\n\143\141\&7Q", _pubProps = [PropSharedSubscriptionAvailable
// 210,PropRequestResponseInformation 98,PropCorrelationData "\234\138CL\DC24qZ\195\134Qu\ETB
// \178\t\242\247\SYNGi\147z\DC1j",PropMaximumPacketSize 9483,PropWildcardSubscriptionAvailable
// 51,PropWildcardSubscriptionAvailable 35,PropUserProperty "\NUL\rw\164\th\199|\158$\164\222}\175\219"
// "",PropPayloadFormatIndicator 231,PropMaximumQoS 8,PropRequestProblemInformation 148,PropMaximumPacketSize
// 21886,PropReceiveMaximum 28042,PropRetainAvailable 68,PropRequestProblemInformation 3,PropMaximumQoS
// 58,PropRequestResponseInformation 255,PropRequestResponseInformation 253,PropWildcardSubscriptionAvailable
// 15,PropRetainAvailable 71,PropSessionExpiryInterval 22458,PropMessageExpiryInterval 15175,PropReceiveMaximum
// 13058,PropResponseInformation "\150Z(\215\v0"]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x39, 0x9e, 0x1,  0x0,  0x1d, 0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2,
                   0xe4, 0xb9, 0x1b, 0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76,
                   0x6f, 0x2a, 0xd2, 0x19, 0x62, 0x9,  0x0,  0x19, 0xea, 0x8a, 0x43, 0x4c, 0x12, 0x34, 0x71, 0x5a, 0xc3,
                   0x86, 0x51, 0x75, 0x17, 0x20, 0xb2, 0x9,  0xf2, 0xf7, 0x16, 0x47, 0x69, 0x93, 0x7a, 0x11, 0x6a, 0x27,
                   0x0,  0x0,  0x25, 0xb,  0x28, 0x33, 0x28, 0x23, 0x26, 0x0,  0xf,  0x0,  0xd,  0x77, 0xa4, 0x9,  0x68,
                   0xc7, 0x7c, 0x9e, 0x24, 0xa4, 0xde, 0x7d, 0xaf, 0xdb, 0x0,  0x0,  0x1,  0xe7, 0x24, 0x8,  0x17, 0x94,
                   0x27, 0x0,  0x0,  0x55, 0x7e, 0x21, 0x6d, 0x8a, 0x25, 0x44, 0x17, 0x3,  0x24, 0x3a, 0x19, 0xff, 0x19,
                   0xfd, 0x28, 0xf,  0x25, 0x47, 0x11, 0x0,  0x0,  0x57, 0xba, 0x2,  0x0,  0x0,  0x3b, 0x47, 0x21, 0x33,
                   0x2,  0x1a, 0x0,  0x6,  0x96, 0x5a, 0x28, 0xd7, 0xb,  0x30, 0x1,  0x87, 0x68, 0xea, 0x44, 0x86, 0x95,
                   0xd2, 0x7a, 0x79, 0xa,  0x8f, 0x8d, 0x37, 0x51};
  uint8_t topic_bytes[] = {0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2, 0xe4, 0xb9, 0x1b,
                           0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1, 0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa, 0x8f, 0x8d, 0x37, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0xea, 0x8a, 0x43, 0x4c, 0x12, 0x34, 0x71, 0x5a, 0xc3, 0x86, 0x51, 0x75, 0x17,
                           0x20, 0xb2, 0x9,  0xf2, 0xf7, 0x16, 0x47, 0x69, 0x93, 0x7a, 0x11, 0x6a};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops1[] = {0x0, 0xd, 0x77, 0xa4, 0x9, 0x68, 0xc7, 0x7c, 0x9e, 0x24, 0xa4, 0xde, 0x7d, 0xaf, 0xdb};
  uint8_t bytesprops3[] = {0x96, 0x5a, 0x28, 0xd7, 0xb, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9483}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops1}, .v = {0, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21886}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28042}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22458}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15175}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13058}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\139Q\DC1\195\175\199\249J\b\183\226\228\185\ESC\245\128\130\166\n]\133:\228\231$K*v", _pubPktID = 0, _pubBody =
// "\SOH\135h\234D\134\149\210zy\n\143\141\&7Q", _pubProps = [PropSharedSubscriptionAvailable
// 210,PropRequestResponseInformation 98,PropCorrelationData "\234\138CL\DC24qZ\195\134Qu\ETB
// \178\t\242\247\SYNGi\147z\DC1j",PropMaximumPacketSize 9483,PropWildcardSubscriptionAvailable
// 51,PropWildcardSubscriptionAvailable 35,PropUserProperty "\NUL\rw\164\th\199|\158$\164\222}\175\219"
// "",PropPayloadFormatIndicator 231,PropMaximumQoS 8,PropRequestProblemInformation 148,PropMaximumPacketSize
// 21886,PropReceiveMaximum 28042,PropRetainAvailable 68,PropRequestProblemInformation 3,PropMaximumQoS
// 58,PropRequestResponseInformation 255,PropRequestResponseInformation 253,PropWildcardSubscriptionAvailable
// 15,PropRetainAvailable 71,PropSessionExpiryInterval 22458,PropMessageExpiryInterval 15175,PropReceiveMaximum
// 13058,PropResponseInformation "\150Z(\215\v0"]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x39, 0x9e, 0x1,  0x0,  0x1d, 0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2,
                   0xe4, 0xb9, 0x1b, 0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76,
                   0x6f, 0x2a, 0xd2, 0x19, 0x62, 0x9,  0x0,  0x19, 0xea, 0x8a, 0x43, 0x4c, 0x12, 0x34, 0x71, 0x5a, 0xc3,
                   0x86, 0x51, 0x75, 0x17, 0x20, 0xb2, 0x9,  0xf2, 0xf7, 0x16, 0x47, 0x69, 0x93, 0x7a, 0x11, 0x6a, 0x27,
                   0x0,  0x0,  0x25, 0xb,  0x28, 0x33, 0x28, 0x23, 0x26, 0x0,  0xf,  0x0,  0xd,  0x77, 0xa4, 0x9,  0x68,
                   0xc7, 0x7c, 0x9e, 0x24, 0xa4, 0xde, 0x7d, 0xaf, 0xdb, 0x0,  0x0,  0x1,  0xe7, 0x24, 0x8,  0x17, 0x94,
                   0x27, 0x0,  0x0,  0x55, 0x7e, 0x21, 0x6d, 0x8a, 0x25, 0x44, 0x17, 0x3,  0x24, 0x3a, 0x19, 0xff, 0x19,
                   0xfd, 0x28, 0xf,  0x25, 0x47, 0x11, 0x0,  0x0,  0x57, 0xba, 0x2,  0x0,  0x0,  0x3b, 0x47, 0x21, 0x33,
                   0x2,  0x1a, 0x0,  0x6,  0x96, 0x5a, 0x28, 0xd7, 0xb,  0x30, 0x1,  0x87, 0x68, 0xea, 0x44, 0x86, 0x95,
                   0xd2, 0x7a, 0x79, 0xa,  0x8f, 0x8d, 0x37, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xda, 0x8b, 0x51, 0x11, 0xc3, 0xaf, 0xc7, 0xf9, 0x4a, 0x8,  0xb7, 0xe2, 0xe4, 0xb9, 0x1b,
                               0xf5, 0x80, 0x82, 0xa6, 0xa,  0x5d, 0x85, 0x3a, 0xe4, 0xe7, 0x24, 0x4b, 0x2a, 0x76};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0x87, 0x68, 0xea, 0x44, 0x86, 0x95, 0xd2, 0x7a, 0x79, 0xa, 0x8f, 0x8d, 0x37, 0x51};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Just "\247\bJ@ON", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\200\&8\143\219\210\&8\154\ETB\191\209\ENQ\247\151j\ETX\STX\DLEwW\DC4(\171\239",
// _willMsg = "\239\163,\150S\ETXA\235Q\144\193p~G\249\214\218Wh\175\200\235;\235np\154t", _willProps = []}),
// _cleanSession = True, _keepAlive = 24957, _connID = "\SUB\DC4P\DC4\ENQ\160\SO\226\141\r\251", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa6, 0x61, 0x7d, 0x0,  0xb,  0x1a,
                   0x14, 0x50, 0x14, 0x5,  0xa0, 0xe,  0xe2, 0x8d, 0xd,  0xfb, 0x0,  0x17, 0xc8, 0x38, 0x8f,
                   0xdb, 0xd2, 0x38, 0x9a, 0x17, 0xbf, 0xd1, 0x5,  0xf7, 0x97, 0x6a, 0x3,  0x2,  0x10, 0x77,
                   0x57, 0x14, 0x28, 0xab, 0xef, 0x0,  0x1c, 0xef, 0xa3, 0x2c, 0x96, 0x53, 0x3,  0x41, 0xeb,
                   0x51, 0x90, 0xc1, 0x70, 0x7e, 0x47, 0xf9, 0xd6, 0xda, 0x57, 0x68, 0xaf, 0xc8, 0xeb, 0x3b,
                   0xeb, 0x6e, 0x70, 0x9a, 0x74, 0x0,  0x6,  0xf7, 0x8,  0x4a, 0x40, 0x4f, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc8, 0x38, 0x8f, 0xdb, 0xd2, 0x38, 0x9a, 0x17, 0xbf, 0xd1, 0x5, 0xf7,
                                0x97, 0x6a, 0x3,  0x2,  0x10, 0x77, 0x57, 0x14, 0x28, 0xab, 0xef};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xef, 0xa3, 0x2c, 0x96, 0x53, 0x3,  0x41, 0xeb, 0x51, 0x90, 0xc1, 0x70, 0x7e, 0x47,
                                  0xf9, 0xd6, 0xda, 0x57, 0x68, 0xaf, 0xc8, 0xeb, 0x3b, 0xeb, 0x6e, 0x70, 0x9a, 0x74};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24957;
  uint8_t client_id_bytes[] = {0x1a, 0x14, 0x50, 0x14, 0x5, 0xa0, 0xe, 0xe2, 0x8d, 0xd, 0xfb};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf7, 0x8, 0x4a, 0x40, 0x4f, 0x4e};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\DC4\245qv", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\132\165\SUB\228Tg9\NULV.~\142\194\226:", _willMsg =
// "\176\179\172\a1r\164{\SOH\143\130V5\US-ElV\146<RT\170\225e", _willProps = []}), _cleanSession = True, _keepAlive =
// 4963, _connID = "\146\SUB.7\232\244R\ETX\175U\192\149\DEL\185Mm\ESC\165\239l\189\149\181R", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb6, 0x13, 0x63, 0x0,  0x18, 0x92,
                   0x1a, 0x2e, 0x37, 0xe8, 0xf4, 0x52, 0x3,  0xaf, 0x55, 0xc0, 0x95, 0x7f, 0xb9, 0x4d, 0x6d,
                   0x1b, 0xa5, 0xef, 0x6c, 0xbd, 0x95, 0xb5, 0x52, 0x0,  0xf,  0x84, 0xa5, 0x1a, 0xe4, 0x54,
                   0x67, 0x39, 0x0,  0x56, 0x2e, 0x7e, 0x8e, 0xc2, 0xe2, 0x3a, 0x0,  0x19, 0xb0, 0xb3, 0xac,
                   0x7,  0x31, 0x72, 0xa4, 0x7b, 0x1,  0x8f, 0x82, 0x56, 0x35, 0x1f, 0x2d, 0x45, 0x6c, 0x56,
                   0x92, 0x3c, 0x52, 0x54, 0xaa, 0xe1, 0x65, 0x0,  0x4,  0x14, 0xf5, 0x71, 0x76};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x84, 0xa5, 0x1a, 0xe4, 0x54, 0x67, 0x39, 0x0,
                                0x56, 0x2e, 0x7e, 0x8e, 0xc2, 0xe2, 0x3a};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb0, 0xb3, 0xac, 0x7,  0x31, 0x72, 0xa4, 0x7b, 0x1,  0x8f, 0x82, 0x56, 0x35,
                                  0x1f, 0x2d, 0x45, 0x6c, 0x56, 0x92, 0x3c, 0x52, 0x54, 0xaa, 0xe1, 0x65};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4963;
  uint8_t client_id_bytes[] = {0x92, 0x1a, 0x2e, 0x37, 0xe8, 0xf4, 0x52, 0x3,  0xaf, 0x55, 0xc0, 0x95,
                               0x7f, 0xb9, 0x4d, 0x6d, 0x1b, 0xa5, 0xef, 0x6c, 0xbd, 0x95, 0xb5, 0x52};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x14, 0xf5, 0x71, 0x76};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\209\146\&2\164V", _willMsg =
// "\189\145\130\DC2U`\130\244\235\250\194@\222\162-\187\250\RS\SO\213$zF\EOT\t\197", _willProps = []}), _cleanSession =
// True, _keepAlive = 4029, _connID = "\ETB\180\164\136M><\142\&9\159Dn\bA\197\NUL2", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0xf,  0xbd, 0x0,  0x11, 0x17, 0xb4, 0xa4,
                   0x88, 0x4d, 0x3e, 0x3c, 0x8e, 0x39, 0x9f, 0x44, 0x6e, 0x8,  0x41, 0xc5, 0x0,  0x32, 0x0,  0x5,  0xd1,
                   0x92, 0x32, 0xa4, 0x56, 0x0,  0x1a, 0xbd, 0x91, 0x82, 0x12, 0x55, 0x60, 0x82, 0xf4, 0xeb, 0xfa, 0xc2,
                   0x40, 0xde, 0xa2, 0x2d, 0xbb, 0xfa, 0x1e, 0xe,  0xd5, 0x24, 0x7a, 0x46, 0x4,  0x9,  0xc5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0x92, 0x32, 0xa4, 0x56};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0x91, 0x82, 0x12, 0x55, 0x60, 0x82, 0xf4, 0xeb, 0xfa, 0xc2, 0x40, 0xde,
                                  0xa2, 0x2d, 0xbb, 0xfa, 0x1e, 0xe,  0xd5, 0x24, 0x7a, 0x46, 0x4,  0x9,  0xc5};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4029;
  uint8_t client_id_bytes[] = {0x17, 0xb4, 0xa4, 0x88, 0x4d, 0x3e, 0x3c, 0x8e, 0x39,
                               0x9f, 0x44, 0x6e, 0x8,  0x41, 0xc5, 0x0,  0x32};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "F\237\221 :fM\163\208\237Y\ENQ\245\179\250$\234\187", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 28626, _connID = "2\249o\r\221\161\151?\DC4\182_} \251\159",
// _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x6f, 0xd2, 0x0,  0xf,  0x32, 0xf9, 0x6f,
                   0xd,  0xdd, 0xa1, 0x97, 0x3f, 0x14, 0xb6, 0x5f, 0x7d, 0x20, 0xfb, 0x9f, 0x0,  0x12, 0x46, 0xed, 0xdd,
                   0x20, 0x3a, 0x66, 0x4d, 0xa3, 0xd0, 0xed, 0x59, 0x5,  0xf5, 0xb3, 0xfa, 0x24, 0xea, 0xbb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28626;
  uint8_t client_id_bytes[] = {0x32, 0xf9, 0x6f, 0xd, 0xdd, 0xa1, 0x97, 0x3f, 0x14, 0xb6, 0x5f, 0x7d, 0x20, 0xfb, 0x9f};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x46, 0xed, 0xdd, 0x20, 0x3a, 0x66, 0x4d, 0xa3, 0xd0,
                              0xed, 0x59, 0x5,  0xf5, 0xb3, 0xfa, 0x24, 0xea, 0xbb};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 28697, _connID = "\203\185\&0\b\162/\DC4\184\135\214\244(e)\232\150t\248\130\139\217D\233k\138\237\\\202",
// _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x28, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x70, 0x19, 0x0,  0x1c,
                   0xcb, 0xb9, 0x30, 0x8,  0xa2, 0x2f, 0x14, 0xb8, 0x87, 0xd6, 0xf4, 0x28, 0x65, 0x29,
                   0xe8, 0x96, 0x74, 0xf8, 0x82, 0x8b, 0xd9, 0x44, 0xe9, 0x6b, 0x8a, 0xed, 0x5c, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28697;
  uint8_t client_id_bytes[] = {0xcb, 0xb9, 0x30, 0x8,  0xa2, 0x2f, 0x14, 0xb8, 0x87, 0xd6, 0xf4, 0x28, 0x65, 0x29,
                               0xe8, 0x96, 0x74, 0xf8, 0x82, 0x8b, 0xd9, 0x44, 0xe9, 0x6b, 0x8a, 0xed, 0x5c, 0xca};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETX\167/\DLE?I\DEL\214T$", _password = Just
// "\SUB\181v\f\SO\128\188\245\DEL\145\178\224\247\166\&8", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\212\201\CANR|p\199", _willMsg =
// "\171\188\151\239\EM#[\DC3\EM\SI1F0\134S8\195:\144\207\US\CANc\209?\213\190@\186", _willProps = []}), _cleanSession =
// True, _keepAlive = 14165, _connID = "s@\"\140E\205\ESCb\193\200%\173\206\NAK)\152s", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x62, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x37, 0x55, 0x0,  0x11, 0x73, 0x40, 0x22,
                   0x8c, 0x45, 0xcd, 0x1b, 0x62, 0xc1, 0xc8, 0x25, 0xad, 0xce, 0x15, 0x29, 0x98, 0x73, 0x0,  0x7,  0xd4,
                   0xc9, 0x18, 0x52, 0x7c, 0x70, 0xc7, 0x0,  0x1d, 0xab, 0xbc, 0x97, 0xef, 0x19, 0x23, 0x5b, 0x13, 0x19,
                   0xf,  0x31, 0x46, 0x30, 0x86, 0x53, 0x38, 0xc3, 0x3a, 0x90, 0xcf, 0x1f, 0x18, 0x63, 0xd1, 0x3f, 0xd5,
                   0xbe, 0x40, 0xba, 0x0,  0xa,  0x3,  0xa7, 0x2f, 0x10, 0x3f, 0x49, 0x7f, 0xd6, 0x54, 0x24, 0x0,  0xf,
                   0x1a, 0xb5, 0x76, 0xc,  0xe,  0x80, 0xbc, 0xf5, 0x7f, 0x91, 0xb2, 0xe0, 0xf7, 0xa6, 0x38};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd4, 0xc9, 0x18, 0x52, 0x7c, 0x70, 0xc7};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xab, 0xbc, 0x97, 0xef, 0x19, 0x23, 0x5b, 0x13, 0x19, 0xf,
                                  0x31, 0x46, 0x30, 0x86, 0x53, 0x38, 0xc3, 0x3a, 0x90, 0xcf,
                                  0x1f, 0x18, 0x63, 0xd1, 0x3f, 0xd5, 0xbe, 0x40, 0xba};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14165;
  uint8_t client_id_bytes[] = {0x73, 0x40, 0x22, 0x8c, 0x45, 0xcd, 0x1b, 0x62, 0xc1,
                               0xc8, 0x25, 0xad, 0xce, 0x15, 0x29, 0x98, 0x73};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3, 0xa7, 0x2f, 0x10, 0x3f, 0x49, 0x7f, 0xd6, 0x54, 0x24};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1a, 0xb5, 0x76, 0xc, 0xe, 0x80, 0xbc, 0xf5, 0x7f, 0x91, 0xb2, 0xe0, 0xf7, 0xa6, 0x38};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\223\&2\199@j\160\253\250\206\223!\137Hi\230\SUB`\181\222",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\217", _willMsg = "D~6I\EOT\181",
// _willProps = []}), _cleanSession = False, _keepAlive = 27312, _connID = "\179\202\212\v\189N", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x1d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4, 0x14, 0x6a, 0xb0, 0x0,  0x6, 0xb3, 0xca,
                   0xd4, 0xb,  0xbd, 0x4e, 0x0,  0x1,  0xd9, 0x0,  0x6, 0x44, 0x7e, 0x36, 0x49, 0x4, 0xb5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0x7e, 0x36, 0x49, 0x4, 0xb5};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27312;
  uint8_t client_id_bytes[] = {0xb3, 0xca, 0xd4, 0xb, 0xbd, 0x4e};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xdf, 0x32, 0xc7, 0x40, 0x6a, 0xa0, 0xfd, 0xfa, 0xce, 0xdf,
                              0x21, 0x89, 0x48, 0x69, 0xe6, 0x1a, 0x60, 0xb5, 0xde};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\EMS\165f>\192\196\FS\155\179\128]\225\223\DLE\151e@\159h\136\238\221\&9\205\DEL", _willMsg =
// "\DLE\ETB\v\131b\241\161<\217", _willProps = []}), _cleanSession = True, _keepAlive = 20507, _connID =
// "-\202\240\v`\SOH\255oj\230\172\EM\212J", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x50, 0x1b, 0x0,  0xe,  0x2d, 0xca, 0xf0,
                   0xb,  0x60, 0x1,  0xff, 0x6f, 0x6a, 0xe6, 0xac, 0x19, 0xd4, 0x4a, 0x0,  0x1a, 0x19, 0x53, 0xa5, 0x66,
                   0x3e, 0xc0, 0xc4, 0x1c, 0x9b, 0xb3, 0x80, 0x5d, 0xe1, 0xdf, 0x10, 0x97, 0x65, 0x40, 0x9f, 0x68, 0x88,
                   0xee, 0xdd, 0x39, 0xcd, 0x7f, 0x0,  0x9,  0x10, 0x17, 0xb,  0x83, 0x62, 0xf1, 0xa1, 0x3c, 0xd9};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x19, 0x53, 0xa5, 0x66, 0x3e, 0xc0, 0xc4, 0x1c, 0x9b, 0xb3, 0x80, 0x5d, 0xe1,
                                0xdf, 0x10, 0x97, 0x65, 0x40, 0x9f, 0x68, 0x88, 0xee, 0xdd, 0x39, 0xcd, 0x7f};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x10, 0x17, 0xb, 0x83, 0x62, 0xf1, 0xa1, 0x3c, 0xd9};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20507;
  uint8_t client_id_bytes[] = {0x2d, 0xca, 0xf0, 0xb, 0x60, 0x1, 0xff, 0x6f, 0x6a, 0xe6, 0xac, 0x19, 0xd4, 0x4a};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\207\218?<\130\251\SI\189E\184\US\216$Z{?\252|\252", _password = Just
// "\184b#\224}]\DC4\210", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "J=\ESCG\249
// t\STX\247m\RS\147\RS\157\225K\NUL\148G\203", _willMsg =
// "q\155\"+\180\161,\176\&9D\251\159!\164(|\235\247\178\213p\208\"\199~%X\226\251", _willProps = []}), _cleanSession =
// False, _keepAlive = 8484, _connID = "\219\138\191|*\231\ACK\191WZCrWZ\r\ETXLA\247|6", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x75, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x21, 0x24, 0x0,  0x15, 0xdb,
                   0x8a, 0xbf, 0x7c, 0x2a, 0xe7, 0x6,  0xbf, 0x57, 0x5a, 0x43, 0x72, 0x57, 0x5a, 0xd,  0x3,
                   0x4c, 0x41, 0xf7, 0x7c, 0x36, 0x0,  0x14, 0x4a, 0x3d, 0x1b, 0x47, 0xf9, 0x20, 0x74, 0x2,
                   0xf7, 0x6d, 0x1e, 0x93, 0x1e, 0x9d, 0xe1, 0x4b, 0x0,  0x94, 0x47, 0xcb, 0x0,  0x1d, 0x71,
                   0x9b, 0x22, 0x2b, 0xb4, 0xa1, 0x2c, 0xb0, 0x39, 0x44, 0xfb, 0x9f, 0x21, 0xa4, 0x28, 0x7c,
                   0xeb, 0xf7, 0xb2, 0xd5, 0x70, 0xd0, 0x22, 0xc7, 0x7e, 0x25, 0x58, 0xe2, 0xfb, 0x0,  0x13,
                   0xcf, 0xda, 0x3f, 0x3c, 0x82, 0xfb, 0xf,  0xbd, 0x45, 0xb8, 0x1f, 0xd8, 0x24, 0x5a, 0x7b,
                   0x3f, 0xfc, 0x7c, 0xfc, 0x0,  0x8,  0xb8, 0x62, 0x23, 0xe0, 0x7d, 0x5d, 0x14, 0xd2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4a, 0x3d, 0x1b, 0x47, 0xf9, 0x20, 0x74, 0x2,  0xf7, 0x6d,
                                0x1e, 0x93, 0x1e, 0x9d, 0xe1, 0x4b, 0x0,  0x94, 0x47, 0xcb};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x71, 0x9b, 0x22, 0x2b, 0xb4, 0xa1, 0x2c, 0xb0, 0x39, 0x44,
                                  0xfb, 0x9f, 0x21, 0xa4, 0x28, 0x7c, 0xeb, 0xf7, 0xb2, 0xd5,
                                  0x70, 0xd0, 0x22, 0xc7, 0x7e, 0x25, 0x58, 0xe2, 0xfb};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 8484;
  uint8_t client_id_bytes[] = {0xdb, 0x8a, 0xbf, 0x7c, 0x2a, 0xe7, 0x6,  0xbf, 0x57, 0x5a, 0x43,
                               0x72, 0x57, 0x5a, 0xd,  0x3,  0x4c, 0x41, 0xf7, 0x7c, 0x36};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcf, 0xda, 0x3f, 0x3c, 0x82, 0xfb, 0xf,  0xbd, 0x45, 0xb8,
                              0x1f, 0xd8, 0x24, 0x5a, 0x7b, 0x3f, 0xfc, 0x7c, 0xfc};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb8, 0x62, 0x23, 0xe0, 0x7d, 0x5d, 0x14, 0xd2};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\DC2Bw\158G\232{\204\238N\218\&9\f\150", _password = Just
// "/ME\221/\224L\203\216\150\t=\195a\169\197P[\251\137\DC3\219\152\253\ENQL\153\239", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\160TX\134\176\USa\167\209[\146\&0", _willMsg =
// "\130\128b\DC1U\178\198J:\"\154\&9\174\144\&79\222\DEL\212\204'\ENQ\227\139\&7\132", _willProps = []}), _cleanSession
// = True, _keepAlive = 18071, _connID = "\150\237n\166\229\ETBi;m\233\SYN,\137\212\196\218", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x75, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x46, 0x97, 0x0,  0x10, 0x96,
                   0xed, 0x6e, 0xa6, 0xe5, 0x17, 0x69, 0x3b, 0x6d, 0xe9, 0x16, 0x2c, 0x89, 0xd4, 0xc4, 0xda,
                   0x0,  0xc,  0xa0, 0x54, 0x58, 0x86, 0xb0, 0x1f, 0x61, 0xa7, 0xd1, 0x5b, 0x92, 0x30, 0x0,
                   0x1a, 0x82, 0x80, 0x62, 0x11, 0x55, 0xb2, 0xc6, 0x4a, 0x3a, 0x22, 0x9a, 0x39, 0xae, 0x90,
                   0x37, 0x39, 0xde, 0x7f, 0xd4, 0xcc, 0x27, 0x5,  0xe3, 0x8b, 0x37, 0x84, 0x0,  0xf,  0xcc,
                   0x12, 0x42, 0x77, 0x9e, 0x47, 0xe8, 0x7b, 0xcc, 0xee, 0x4e, 0xda, 0x39, 0xc,  0x96, 0x0,
                   0x1c, 0x2f, 0x4d, 0x45, 0xdd, 0x2f, 0xe0, 0x4c, 0xcb, 0xd8, 0x96, 0x9,  0x3d, 0xc3, 0x61,
                   0xa9, 0xc5, 0x50, 0x5b, 0xfb, 0x89, 0x13, 0xdb, 0x98, 0xfd, 0x5,  0x4c, 0x99, 0xef};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa0, 0x54, 0x58, 0x86, 0xb0, 0x1f, 0x61, 0xa7, 0xd1, 0x5b, 0x92, 0x30};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x80, 0x62, 0x11, 0x55, 0xb2, 0xc6, 0x4a, 0x3a, 0x22, 0x9a, 0x39, 0xae,
                                  0x90, 0x37, 0x39, 0xde, 0x7f, 0xd4, 0xcc, 0x27, 0x5,  0xe3, 0x8b, 0x37, 0x84};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18071;
  uint8_t client_id_bytes[] = {0x96, 0xed, 0x6e, 0xa6, 0xe5, 0x17, 0x69, 0x3b,
                               0x6d, 0xe9, 0x16, 0x2c, 0x89, 0xd4, 0xc4, 0xda};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x12, 0x42, 0x77, 0x9e, 0x47, 0xe8, 0x7b, 0xcc, 0xee, 0x4e, 0xda, 0x39, 0xc, 0x96};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0x4d, 0x45, 0xdd, 0x2f, 0xe0, 0x4c, 0xcb, 0xd8, 0x96, 0x9, 0x3d, 0xc3, 0x61,
                              0xa9, 0xc5, 0x50, 0x5b, 0xfb, 0x89, 0x13, 0xdb, 0x98, 0xfd, 0x5, 0x4c, 0x99, 0xef};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\170\169T\181z[8\SOH\237A\171\211\161", _password = Just "\216/I\167", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "i\\\223d\254\201\208#u\SUB\184\178\254^g",
// _willMsg = "\130\b\SOHn\241D<\208", _willProps = []}), _cleanSession = False, _keepAlive = 20715, _connID =
// "\238Vc]\r\147\142\177>\228\133\&4\185\GS", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x4a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x50, 0xeb, 0x0,  0xe,  0xee, 0x56,
                   0x63, 0x5d, 0xd,  0x93, 0x8e, 0xb1, 0x3e, 0xe4, 0x85, 0x34, 0xb9, 0x1d, 0x0,  0xf,  0x69, 0x5c,
                   0xdf, 0x64, 0xfe, 0xc9, 0xd0, 0x23, 0x75, 0x1a, 0xb8, 0xb2, 0xfe, 0x5e, 0x67, 0x0,  0x8,  0x82,
                   0x8,  0x1,  0x6e, 0xf1, 0x44, 0x3c, 0xd0, 0x0,  0xd,  0xaa, 0xa9, 0x54, 0xb5, 0x7a, 0x5b, 0x38,
                   0x1,  0xed, 0x41, 0xab, 0xd3, 0xa1, 0x0,  0x4,  0xd8, 0x2f, 0x49, 0xa7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x69, 0x5c, 0xdf, 0x64, 0xfe, 0xc9, 0xd0, 0x23,
                                0x75, 0x1a, 0xb8, 0xb2, 0xfe, 0x5e, 0x67};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x8, 0x1, 0x6e, 0xf1, 0x44, 0x3c, 0xd0};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20715;
  uint8_t client_id_bytes[] = {0xee, 0x56, 0x63, 0x5d, 0xd, 0x93, 0x8e, 0xb1, 0x3e, 0xe4, 0x85, 0x34, 0xb9, 0x1d};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xaa, 0xa9, 0x54, 0xb5, 0x7a, 0x5b, 0x38, 0x1, 0xed, 0x41, 0xab, 0xd3, 0xa1};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd8, 0x2f, 0x49, 0xa7};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\128", _willMsg = "G\244\250\238\173\220\204", _willProps = []}), _cleanSession = True,
// _keepAlive = 28847, _connID = "IP", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x1a, 0x0, 0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x70, 0xaf, 0x0,  0x2,
                   0x49, 0x50, 0x0, 0x1, 0x80, 0x0,  0x7,  0x47, 0xf4, 0xfa, 0xee, 0xad, 0xdc, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x47, 0xf4, 0xfa, 0xee, 0xad, 0xdc, 0xcc};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28847;
  uint8_t client_id_bytes[] = {0x49, 0x50};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "hWE\168_M\187,\211\130\251B\217\\\139X\246p\GSUQ\252\&7\198\223\143}\191\164",
// _password = Just "\221\"\180", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "/\161\ETX\236\174\202\142\ACK\ENQ&\231\230Zg", _willMsg = "\164:(\192D\224", _willProps = []}), _cleanSession =
// False, _keepAlive = 7983, _connID = "\255\v<\218q\253\223)BQ\136u\236\220\156&\164\".", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x5b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0x1f, 0x2f, 0x0,  0x13, 0xff, 0xb,
                   0x3c, 0xda, 0x71, 0xfd, 0xdf, 0x29, 0x42, 0x51, 0x88, 0x75, 0xec, 0xdc, 0x9c, 0x26, 0xa4, 0x22,
                   0x2e, 0x0,  0xe,  0x2f, 0xa1, 0x3,  0xec, 0xae, 0xca, 0x8e, 0x6,  0x5,  0x26, 0xe7, 0xe6, 0x5a,
                   0x67, 0x0,  0x6,  0xa4, 0x3a, 0x28, 0xc0, 0x44, 0xe0, 0x0,  0x1d, 0x68, 0x57, 0x45, 0xa8, 0x5f,
                   0x4d, 0xbb, 0x2c, 0xd3, 0x82, 0xfb, 0x42, 0xd9, 0x5c, 0x8b, 0x58, 0xf6, 0x70, 0x1d, 0x55, 0x51,
                   0xfc, 0x37, 0xc6, 0xdf, 0x8f, 0x7d, 0xbf, 0xa4, 0x0,  0x3,  0xdd, 0x22, 0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2f, 0xa1, 0x3, 0xec, 0xae, 0xca, 0x8e, 0x6, 0x5, 0x26, 0xe7, 0xe6, 0x5a, 0x67};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x3a, 0x28, 0xc0, 0x44, 0xe0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 7983;
  uint8_t client_id_bytes[] = {0xff, 0xb,  0x3c, 0xda, 0x71, 0xfd, 0xdf, 0x29, 0x42, 0x51,
                               0x88, 0x75, 0xec, 0xdc, 0x9c, 0x26, 0xa4, 0x22, 0x2e};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x68, 0x57, 0x45, 0xa8, 0x5f, 0x4d, 0xbb, 0x2c, 0xd3, 0x82, 0xfb, 0x42, 0xd9, 0x5c, 0x8b,
                              0x58, 0xf6, 0x70, 0x1d, 0x55, 0x51, 0xfc, 0x37, 0xc6, 0xdf, 0x8f, 0x7d, 0xbf, 0xa4};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdd, 0x22, 0xb4};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "I\SI\221-\132?i\130\DC4\231\186", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 15604, _connID = "\246\207\188\170T\240a\203\184x\230X\199\147{8_\SO;\188)",
// _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x21, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x3c, 0xf4,
                   0x0,  0x15, 0xf6, 0xcf, 0xbc, 0xaa, 0x54, 0xf0, 0x61, 0xcb, 0xb8, 0x78,
                   0xe6, 0x58, 0xc7, 0x93, 0x7b, 0x38, 0x5f, 0xe,  0x3b, 0xbc, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15604;
  uint8_t client_id_bytes[] = {0xf6, 0xcf, 0xbc, 0xaa, 0x54, 0xf0, 0x61, 0xcb, 0xb8, 0x78, 0xe6,
                               0x58, 0xc7, 0x93, 0x7b, 0x38, 0x5f, 0xe,  0x3b, 0xbc, 0x29};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x49, 0xf, 0xdd, 0x2d, 0x84, 0x3f, 0x69, 0x82, 0x14, 0xe7, 0xba};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "Y4l\EOT[\245\243\233\211\199c\CANhx\DC4\190g\175\RS\147\191'\223\137<6", _willMsg =
// "\139|6\245\194\246\236j", _willProps = []}), _cleanSession = True, _keepAlive = 1098, _connID =
// "\242\250\148C\fX\219\222", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x4,  0x4a, 0x0,  0x8,  0xf2,
                   0xfa, 0x94, 0x43, 0xc,  0x58, 0xdb, 0xde, 0x0,  0x1a, 0x59, 0x34, 0x6c, 0x4,  0x5b, 0xf5,
                   0xf3, 0xe9, 0xd3, 0xc7, 0x63, 0x18, 0x68, 0x78, 0x14, 0xbe, 0x67, 0xaf, 0x1e, 0x93, 0xbf,
                   0x27, 0xdf, 0x89, 0x3c, 0x36, 0x0,  0x8,  0x8b, 0x7c, 0x36, 0xf5, 0xc2, 0xf6, 0xec, 0x6a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x59, 0x34, 0x6c, 0x4,  0x5b, 0xf5, 0xf3, 0xe9, 0xd3, 0xc7, 0x63, 0x18, 0x68,
                                0x78, 0x14, 0xbe, 0x67, 0xaf, 0x1e, 0x93, 0xbf, 0x27, 0xdf, 0x89, 0x3c, 0x36};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8b, 0x7c, 0x36, 0xf5, 0xc2, 0xf6, 0xec, 0x6a};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1098;
  uint8_t client_id_bytes[] = {0xf2, 0xfa, 0x94, 0x43, 0xc, 0x58, 0xdb, 0xde};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\DC3\243\159\217u&\163Y\NAKhh\155\169\&4\142\166\213k\248t\130\212\216\DC3\173\140\DLE\DC4R:", _password = Just
// "&m\142x\192", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\146\238\tq\148_\147\ENQ", _willMsg = "\251", _willProps = []}), _cleanSession = True, _keepAlive = 25890, _connID =
// "\r\156\147\220\152hj\136^\SUB\177\ETX>i", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x65, 0x22, 0x0,  0xe,  0xd,  0x9c,
                   0x93, 0xdc, 0x98, 0x68, 0x6a, 0x88, 0x5e, 0x1a, 0xb1, 0x3,  0x3e, 0x69, 0x0,  0x8,  0x92, 0xee,
                   0x9,  0x71, 0x94, 0x5f, 0x93, 0x5,  0x0,  0x1,  0xfb, 0x0,  0x1e, 0x13, 0xf3, 0x9f, 0xd9, 0x75,
                   0x26, 0xa3, 0x59, 0x15, 0x68, 0x68, 0x9b, 0xa9, 0x34, 0x8e, 0xa6, 0xd5, 0x6b, 0xf8, 0x74, 0x82,
                   0xd4, 0xd8, 0x13, 0xad, 0x8c, 0x10, 0x14, 0x52, 0x3a, 0x0,  0x5,  0x26, 0x6d, 0x8e, 0x78, 0xc0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x92, 0xee, 0x9, 0x71, 0x94, 0x5f, 0x93, 0x5};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25890;
  uint8_t client_id_bytes[] = {0xd, 0x9c, 0x93, 0xdc, 0x98, 0x68, 0x6a, 0x88, 0x5e, 0x1a, 0xb1, 0x3, 0x3e, 0x69};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x13, 0xf3, 0x9f, 0xd9, 0x75, 0x26, 0xa3, 0x59, 0x15, 0x68, 0x68, 0x9b, 0xa9, 0x34, 0x8e,
                              0xa6, 0xd5, 0x6b, 0xf8, 0x74, 0x82, 0xd4, 0xd8, 0x13, 0xad, 0x8c, 0x10, 0x14, 0x52, 0x3a};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x26, 0x6d, 0x8e, 0x78, 0xc0};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\193<~>\224\218\213\230+\253\204S21l", _password = Just "\208`1MG\177\a\230\254",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 24689, _connID =
// "\215'G$\ESCg\194\223\191:\ETX\166\139\193n\180\156\140\165\209\206\tj\241\ETB\237\210\212Jt", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x60, 0x71, 0x0,  0x1e, 0xd7,
                   0x27, 0x47, 0x24, 0x1b, 0x67, 0xc2, 0xdf, 0xbf, 0x3a, 0x3,  0xa6, 0x8b, 0xc1, 0x6e, 0xb4,
                   0x9c, 0x8c, 0xa5, 0xd1, 0xce, 0x9,  0x6a, 0xf1, 0x17, 0xed, 0xd2, 0xd4, 0x4a, 0x74, 0x0,
                   0xf,  0xc1, 0x3c, 0x7e, 0x3e, 0xe0, 0xda, 0xd5, 0xe6, 0x2b, 0xfd, 0xcc, 0x53, 0x32, 0x31,
                   0x6c, 0x0,  0x9,  0xd0, 0x60, 0x31, 0x4d, 0x47, 0xb1, 0x7,  0xe6, 0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24689;
  uint8_t client_id_bytes[] = {0xd7, 0x27, 0x47, 0x24, 0x1b, 0x67, 0xc2, 0xdf, 0xbf, 0x3a,
                               0x3,  0xa6, 0x8b, 0xc1, 0x6e, 0xb4, 0x9c, 0x8c, 0xa5, 0xd1,
                               0xce, 0x9,  0x6a, 0xf1, 0x17, 0xed, 0xd2, 0xd4, 0x4a, 0x74};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc1, 0x3c, 0x7e, 0x3e, 0xe0, 0xda, 0xd5, 0xe6, 0x2b, 0xfd, 0xcc, 0x53, 0x32, 0x31, 0x6c};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd0, 0x60, 0x31, 0x4d, 0x47, 0xb1, 0x7, 0xe6, 0xfe};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\163}\NULy\RS\158NX4\187\195\203rzn\170(\172\129\146(]jr\168Q\169 \195\200", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "", _willMsg = "\244~\217'Tx\238\164\179\193!,\167", _willProps = []}),
// _cleanSession = False, _keepAlive = 26060, _connID =
// "ta\163\130\232\170\157\144\190\ETB\172\170g\"\136\233\NAK\NAK\231\ETX\160\SYN~\ENQG\220\208\150\241", _properties =
// []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x65, 0xcc, 0x0,  0x1d, 0x74,
                   0x61, 0xa3, 0x82, 0xe8, 0xaa, 0x9d, 0x90, 0xbe, 0x17, 0xac, 0xaa, 0x67, 0x22, 0x88, 0xe9,
                   0x15, 0x15, 0xe7, 0x3,  0xa0, 0x16, 0x7e, 0x5,  0x47, 0xdc, 0xd0, 0x96, 0xf1, 0x0,  0x0,
                   0x0,  0xd,  0xf4, 0x7e, 0xd9, 0x27, 0x54, 0x78, 0xee, 0xa4, 0xb3, 0xc1, 0x21, 0x2c, 0xa7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf4, 0x7e, 0xd9, 0x27, 0x54, 0x78, 0xee, 0xa4, 0xb3, 0xc1, 0x21, 0x2c, 0xa7};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26060;
  uint8_t client_id_bytes[] = {0x74, 0x61, 0xa3, 0x82, 0xe8, 0xaa, 0x9d, 0x90, 0xbe, 0x17, 0xac, 0xaa, 0x67, 0x22, 0x88,
                               0xe9, 0x15, 0x15, 0xe7, 0x3,  0xa0, 0x16, 0x7e, 0x5,  0x47, 0xdc, 0xd0, 0x96, 0xf1};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa3, 0x7d, 0x0,  0x79, 0x1e, 0x9e, 0x4e, 0x58, 0x34, 0xbb, 0xc3, 0xcb, 0x72, 0x7a, 0x6e,
                              0xaa, 0x28, 0xac, 0x81, 0x92, 0x28, 0x5d, 0x6a, 0x72, 0xa8, 0x51, 0xa9, 0x20, 0xc3, 0xc8};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "b\218e\239\183\CAN\191\&2\226\216\211h\139\177i\206P\217\216\241\162\247\&3Q0\255G", _password = Just
// "\134h4\201\252\b\204\DC1\165,\191\253\vJ\240X^\167\US\159\224(\229f\223c", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS0, _willTopic = "\165Ue\188\167\r\197\235M\161$\227j)\243\233e!X\DC2M\158}", _willMsg =
// ":])y\210Yhl\128}\247\163hG", _willProps = []}), _cleanSession = False, _keepAlive = 4784, _connID =
// "o\EOT\144\EOTo`,\SIr\191\185\&6i\246\150\254", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x7e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x12, 0xb0, 0x0,  0x10, 0x6f, 0x4,
                   0x90, 0x4,  0x6f, 0x60, 0x2c, 0xf,  0x72, 0xbf, 0xb9, 0x36, 0x69, 0xf6, 0x96, 0xfe, 0x0,  0x17,
                   0xa5, 0x55, 0x65, 0xbc, 0xa7, 0xd,  0xc5, 0xeb, 0x4d, 0xa1, 0x24, 0xe3, 0x6a, 0x29, 0xf3, 0xe9,
                   0x65, 0x21, 0x58, 0x12, 0x4d, 0x9e, 0x7d, 0x0,  0xe,  0x3a, 0x5d, 0x29, 0x79, 0xd2, 0x59, 0x68,
                   0x6c, 0x80, 0x7d, 0xf7, 0xa3, 0x68, 0x47, 0x0,  0x1b, 0x62, 0xda, 0x65, 0xef, 0xb7, 0x18, 0xbf,
                   0x32, 0xe2, 0xd8, 0xd3, 0x68, 0x8b, 0xb1, 0x69, 0xce, 0x50, 0xd9, 0xd8, 0xf1, 0xa2, 0xf7, 0x33,
                   0x51, 0x30, 0xff, 0x47, 0x0,  0x1a, 0x86, 0x68, 0x34, 0xc9, 0xfc, 0x8,  0xcc, 0x11, 0xa5, 0x2c,
                   0xbf, 0xfd, 0xb,  0x4a, 0xf0, 0x58, 0x5e, 0xa7, 0x1f, 0x9f, 0xe0, 0x28, 0xe5, 0x66, 0xdf, 0x63};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa5, 0x55, 0x65, 0xbc, 0xa7, 0xd,  0xc5, 0xeb, 0x4d, 0xa1, 0x24, 0xe3,
                                0x6a, 0x29, 0xf3, 0xe9, 0x65, 0x21, 0x58, 0x12, 0x4d, 0x9e, 0x7d};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0x5d, 0x29, 0x79, 0xd2, 0x59, 0x68, 0x6c, 0x80, 0x7d, 0xf7, 0xa3, 0x68, 0x47};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4784;
  uint8_t client_id_bytes[] = {0x6f, 0x4,  0x90, 0x4,  0x6f, 0x60, 0x2c, 0xf,
                               0x72, 0xbf, 0xb9, 0x36, 0x69, 0xf6, 0x96, 0xfe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x62, 0xda, 0x65, 0xef, 0xb7, 0x18, 0xbf, 0x32, 0xe2, 0xd8, 0xd3, 0x68, 0x8b, 0xb1,
                              0x69, 0xce, 0x50, 0xd9, 0xd8, 0xf1, 0xa2, 0xf7, 0x33, 0x51, 0x30, 0xff, 0x47};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x86, 0x68, 0x34, 0xc9, 0xfc, 0x8,  0xcc, 0x11, 0xa5, 0x2c, 0xbf, 0xfd, 0xb,
                              0x4a, 0xf0, 0x58, 0x5e, 0xa7, 0x1f, 0x9f, 0xe0, 0x28, 0xe5, 0x66, 0xdf, 0x63};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%0V8\236", _password = Just "Q\245\GS\148#\160\195\156\184jCX\DC3\EM4k", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "w%h\153A\237", _willMsg = "\GS\201n\b\226\NUL",
// _willProps = []}), _cleanSession = True, _keepAlive = 17312, _connID = "\201\234;\NAKS", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x43, 0xa0, 0x0,  0x5,  0xc9,
                   0xea, 0x3b, 0x15, 0x53, 0x0,  0x6,  0x77, 0x25, 0x68, 0x99, 0x41, 0xed, 0x0,  0x6,  0x1d,
                   0xc9, 0x6e, 0x8,  0xe2, 0x0,  0x0,  0x5,  0x25, 0x30, 0x56, 0x38, 0xec, 0x0,  0x10, 0x51,
                   0xf5, 0x1d, 0x94, 0x23, 0xa0, 0xc3, 0x9c, 0xb8, 0x6a, 0x43, 0x58, 0x13, 0x19, 0x34, 0x6b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x77, 0x25, 0x68, 0x99, 0x41, 0xed};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0xc9, 0x6e, 0x8, 0xe2, 0x0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17312;
  uint8_t client_id_bytes[] = {0xc9, 0xea, 0x3b, 0x15, 0x53};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x30, 0x56, 0x38, 0xec};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x51, 0xf5, 0x1d, 0x94, 0x23, 0xa0, 0xc3, 0x9c,
                              0xb8, 0x6a, 0x43, 0x58, 0x13, 0x19, 0x34, 0x6b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\n\216?v+\184\ACKT", _password = Just "f\232\200\n", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "R\180\EM\225w\208\US\DC2X5\243[\225:a\225\DC17\225BK4", _willMsg
// = "\SUB\214\DC3\210\166<\201\147Vy\142\f\161\223BFAO,\EOT\178OU", _willProps = []}), _cleanSession = True, _keepAlive
// = 20729, _connID = ")\f6\175\243\RS\147wQ\178\140rR", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x50, 0xf9, 0x0,  0xd,  0x29, 0xc,
                   0x36, 0xaf, 0xf3, 0x1e, 0x93, 0x77, 0x51, 0xb2, 0x8c, 0x72, 0x52, 0x0,  0x16, 0x52, 0xb4, 0x19,
                   0xe1, 0x77, 0xd0, 0x1f, 0x12, 0x58, 0x35, 0xf3, 0x5b, 0xe1, 0x3a, 0x61, 0xe1, 0x11, 0x37, 0xe1,
                   0x42, 0x4b, 0x34, 0x0,  0x17, 0x1a, 0xd6, 0x13, 0xd2, 0xa6, 0x3c, 0xc9, 0x93, 0x56, 0x79, 0x8e,
                   0xc,  0xa1, 0xdf, 0x42, 0x46, 0x41, 0x4f, 0x2c, 0x4,  0xb2, 0x4f, 0x55, 0x0,  0x8,  0xa,  0xd8,
                   0x3f, 0x76, 0x2b, 0xb8, 0x6,  0x54, 0x0,  0x4,  0x66, 0xe8, 0xc8, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x52, 0xb4, 0x19, 0xe1, 0x77, 0xd0, 0x1f, 0x12, 0x58, 0x35, 0xf3,
                                0x5b, 0xe1, 0x3a, 0x61, 0xe1, 0x11, 0x37, 0xe1, 0x42, 0x4b, 0x34};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1a, 0xd6, 0x13, 0xd2, 0xa6, 0x3c, 0xc9, 0x93, 0x56, 0x79, 0x8e, 0xc,
                                  0xa1, 0xdf, 0x42, 0x46, 0x41, 0x4f, 0x2c, 0x4,  0xb2, 0x4f, 0x55};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20729;
  uint8_t client_id_bytes[] = {0x29, 0xc, 0x36, 0xaf, 0xf3, 0x1e, 0x93, 0x77, 0x51, 0xb2, 0x8c, 0x72, 0x52};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa, 0xd8, 0x3f, 0x76, 0x2b, 0xb8, 0x6, 0x54};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x66, 0xe8, 0xc8, 0xa};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218", _password = Just
// "\157\199_\231w\v\CAN\198\175\204\172\255\223\220\130\250!\147\249\203$a\136\131\EMn\SOHO\252", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 1033, _connID = "\252\aa\128~\196\ESC\154\131\&6\174", _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x4,  0x9,  0x0,  0xb,  0xfc,
                   0x7,  0x61, 0x80, 0x7e, 0xc4, 0x1b, 0x9a, 0x83, 0x36, 0xae, 0x0,  0x1,  0xda, 0x0,  0x1d,
                   0x9d, 0xc7, 0x5f, 0xe7, 0x77, 0xb,  0x18, 0xc6, 0xaf, 0xcc, 0xac, 0xff, 0xdf, 0xdc, 0x82,
                   0xfa, 0x21, 0x93, 0xf9, 0xcb, 0x24, 0x61, 0x88, 0x83, 0x19, 0x6e, 0x1,  0x4f, 0xfc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1033;
  uint8_t client_id_bytes[] = {0xfc, 0x7, 0x61, 0x80, 0x7e, 0xc4, 0x1b, 0x9a, 0x83, 0x36, 0xae};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x9d, 0xc7, 0x5f, 0xe7, 0x77, 0xb,  0x18, 0xc6, 0xaf, 0xcc, 0xac, 0xff, 0xdf, 0xdc, 0x82,
                              0xfa, 0x21, 0x93, 0xf9, 0xcb, 0x24, 0x61, 0x88, 0x83, 0x19, 0x6e, 0x1,  0x4f, 0xfc};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\140\163RpjPE\225/:\ESC", _password = Just
// "\224\162k\234^k\194\DC3\157\n\DC4\228\216\234\160.o\NAKr\219\DC1\ETB", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\138\162?\130\159\141?\154+\DC4B\246\249\DEL1;-\244\132W;", _willMsg =
// "~j\245\255", _willProps = []}), _cleanSession = False, _keepAlive = 9554, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0x25, 0x52, 0x0,  0x0,  0x0,  0x15,
                   0x8a, 0xa2, 0x3f, 0x82, 0x9f, 0x8d, 0x3f, 0x9a, 0x2b, 0x14, 0x42, 0xf6, 0xf9, 0x7f, 0x31, 0x3b,
                   0x2d, 0xf4, 0x84, 0x57, 0x3b, 0x0,  0x4,  0x7e, 0x6a, 0xf5, 0xff, 0x0,  0xb,  0x8c, 0xa3, 0x52,
                   0x70, 0x6a, 0x50, 0x45, 0xe1, 0x2f, 0x3a, 0x1b, 0x0,  0x16, 0xe0, 0xa2, 0x6b, 0xea, 0x5e, 0x6b,
                   0xc2, 0x13, 0x9d, 0xa,  0x14, 0xe4, 0xd8, 0xea, 0xa0, 0x2e, 0x6f, 0x15, 0x72, 0xdb, 0x11, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8a, 0xa2, 0x3f, 0x82, 0x9f, 0x8d, 0x3f, 0x9a, 0x2b, 0x14, 0x42,
                                0xf6, 0xf9, 0x7f, 0x31, 0x3b, 0x2d, 0xf4, 0x84, 0x57, 0x3b};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7e, 0x6a, 0xf5, 0xff};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9554;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8c, 0xa3, 0x52, 0x70, 0x6a, 0x50, 0x45, 0xe1, 0x2f, 0x3a, 0x1b};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xa2, 0x6b, 0xea, 0x5e, 0x6b, 0xc2, 0x13, 0x9d, 0xa,  0x14,
                              0xe4, 0xd8, 0xea, 0xa0, 0x2e, 0x6f, 0x15, 0x72, 0xdb, 0x11, 0x17};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\184\n\192\249\GS\b\140\182\DC3\152 }=&7\DC4\181k", _password = Just
// "\150/\SO\220", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\r\243Owl", _willMsg =
// "\251\re\178 \ACK\242Y2h\FS\DEL\160X\254\171\133\v\217\160\DC2p\DC1\207\EM", _willProps = []}), _cleanSession = True,
// _keepAlive = 22347, _connID = "\148/\140]", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x4c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x57, 0x4b, 0x0,  0x4,  0x94, 0x2f,
                   0x8c, 0x5d, 0x0,  0x5,  0xd,  0xf3, 0x4f, 0x77, 0x6c, 0x0,  0x19, 0xfb, 0xd,  0x65, 0xb2, 0x20,
                   0x6,  0xf2, 0x59, 0x32, 0x68, 0x1c, 0x7f, 0xa0, 0x58, 0xfe, 0xab, 0x85, 0xb,  0xd9, 0xa0, 0x12,
                   0x70, 0x11, 0xcf, 0x19, 0x0,  0x12, 0xb8, 0xa,  0xc0, 0xf9, 0x1d, 0x8,  0x8c, 0xb6, 0x13, 0x98,
                   0x20, 0x7d, 0x3d, 0x26, 0x37, 0x14, 0xb5, 0x6b, 0x0,  0x4,  0x96, 0x2f, 0xe,  0xdc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd, 0xf3, 0x4f, 0x77, 0x6c};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0xd,  0x65, 0xb2, 0x20, 0x6,  0xf2, 0x59, 0x32, 0x68, 0x1c, 0x7f, 0xa0,
                                  0x58, 0xfe, 0xab, 0x85, 0xb,  0xd9, 0xa0, 0x12, 0x70, 0x11, 0xcf, 0x19};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22347;
  uint8_t client_id_bytes[] = {0x94, 0x2f, 0x8c, 0x5d};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb8, 0xa,  0xc0, 0xf9, 0x1d, 0x8,  0x8c, 0xb6, 0x13,
                              0x98, 0x20, 0x7d, 0x3d, 0x26, 0x37, 0x14, 0xb5, 0x6b};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x2f, 0xe, 0xdc};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\183\178\ESC", _password = Just "-\203Id", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS1, _willTopic =
// "oH%\176\195\240\217\234x\176Z\ETX\204\SO\DC3\DEL\138\181\252\US\254\147\218:\146\231\\\144", _willMsg = "n\EM\186",
// _willProps = []}), _cleanSession = True, _keepAlive = 18592, _connID = "\155j\169\&4\DC3T\219\&4P", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x48, 0xa0, 0x0,  0x9,
                   0x9b, 0x6a, 0xa9, 0x34, 0x13, 0x54, 0xdb, 0x34, 0x50, 0x0,  0x1c, 0x6f, 0x48, 0x25,
                   0xb0, 0xc3, 0xf0, 0xd9, 0xea, 0x78, 0xb0, 0x5a, 0x3,  0xcc, 0xe,  0x13, 0x7f, 0x8a,
                   0xb5, 0xfc, 0x1f, 0xfe, 0x93, 0xda, 0x3a, 0x92, 0xe7, 0x5c, 0x90, 0x0,  0x3,  0x6e,
                   0x19, 0xba, 0x0,  0x3,  0xb7, 0xb2, 0x1b, 0x0,  0x4,  0x2d, 0xcb, 0x49, 0x64};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6f, 0x48, 0x25, 0xb0, 0xc3, 0xf0, 0xd9, 0xea, 0x78, 0xb0, 0x5a, 0x3,  0xcc, 0xe,
                                0x13, 0x7f, 0x8a, 0xb5, 0xfc, 0x1f, 0xfe, 0x93, 0xda, 0x3a, 0x92, 0xe7, 0x5c, 0x90};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6e, 0x19, 0xba};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18592;
  uint8_t client_id_bytes[] = {0x9b, 0x6a, 0xa9, 0x34, 0x13, 0x54, 0xdb, 0x34, 0x50};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb7, 0xb2, 0x1b};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2d, 0xcb, 0x49, 0x64};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\164\207\151\149\193\237\154\&5;\151\f\187\235\141\182k?\198\208\205\150",
// _password = Just "\238\185\&5!R\163\189", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic
// = "\162r\149\182\167\158V@)qJ\240#\236\180\134\195xN", _willMsg = "y\213_\183\130", _willProps = []}), _cleanSession
// = False, _keepAlive = 10272, _connID = "\171\r5?\187", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x4d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x28, 0x20, 0x0,  0x5,  0xab, 0xd,
                   0x35, 0x3f, 0xbb, 0x0,  0x13, 0xa2, 0x72, 0x95, 0xb6, 0xa7, 0x9e, 0x56, 0x40, 0x29, 0x71, 0x4a,
                   0xf0, 0x23, 0xec, 0xb4, 0x86, 0xc3, 0x78, 0x4e, 0x0,  0x5,  0x79, 0xd5, 0x5f, 0xb7, 0x82, 0x0,
                   0x15, 0xa4, 0xcf, 0x97, 0x95, 0xc1, 0xed, 0x9a, 0x35, 0x3b, 0x97, 0xc,  0xbb, 0xeb, 0x8d, 0xb6,
                   0x6b, 0x3f, 0xc6, 0xd0, 0xcd, 0x96, 0x0,  0x7,  0xee, 0xb9, 0x35, 0x21, 0x52, 0xa3, 0xbd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa2, 0x72, 0x95, 0xb6, 0xa7, 0x9e, 0x56, 0x40, 0x29, 0x71,
                                0x4a, 0xf0, 0x23, 0xec, 0xb4, 0x86, 0xc3, 0x78, 0x4e};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x79, 0xd5, 0x5f, 0xb7, 0x82};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10272;
  uint8_t client_id_bytes[] = {0xab, 0xd, 0x35, 0x3f, 0xbb};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa4, 0xcf, 0x97, 0x95, 0xc1, 0xed, 0x9a, 0x35, 0x3b, 0x97, 0xc,
                              0xbb, 0xeb, 0x8d, 0xb6, 0x6b, 0x3f, 0xc6, 0xd0, 0xcd, 0x96};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xee, 0xb9, 0x35, 0x21, 0x52, 0xa3, 0xbd};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "\SIj\176\132r\238\172\184r\158pjf\GS\159\&7\185\DEL\211", _willMsg = "", _willProps = []}),
// _cleanSession = False, _keepAlive = 10342, _connID = "F/\a\165\170Bk\248\200\ENQ\199\172\&4\128", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x31, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x4,  0x28, 0x66, 0x0,  0xe,  0x46, 0x2f, 0x7,
                   0xa5, 0xaa, 0x42, 0x6b, 0xf8, 0xc8, 0x5,  0xc7, 0xac, 0x34, 0x80, 0x0,  0x13, 0xf,  0x6a, 0xb0, 0x84,
                   0x72, 0xee, 0xac, 0xb8, 0x72, 0x9e, 0x70, 0x6a, 0x66, 0x1d, 0x9f, 0x37, 0xb9, 0x7f, 0xd3, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf,  0x6a, 0xb0, 0x84, 0x72, 0xee, 0xac, 0xb8, 0x72, 0x9e,
                                0x70, 0x6a, 0x66, 0x1d, 0x9f, 0x37, 0xb9, 0x7f, 0xd3};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10342;
  uint8_t client_id_bytes[] = {0x46, 0x2f, 0x7, 0xa5, 0xaa, 0x42, 0x6b, 0xf8, 0xc8, 0x5, 0xc7, 0xac, 0x34, 0x80};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\177,\US\162\249\rU", _password = Just "\186$\184J\CAN:\210T\160t\185\242",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\248\192cB\223\ACK\132s!q\246\236pQ-R", _willMsg = "@\152\ETBp\180{\SI\148\180\&8\r\230\252vY\151]\223/\232&n",
// _willProps = []}), _cleanSession = True, _keepAlive = 1497, _connID = "\ENQfB\178\EOT\DLE\139\233\169H\233\GS[",
// _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x5,  0xd9, 0x0,  0xd,  0x5,  0x66,
                   0x42, 0xb2, 0x4,  0x10, 0x8b, 0xe9, 0xa9, 0x48, 0xe9, 0x1d, 0x5b, 0x0,  0x10, 0xf8, 0xc0, 0x63,
                   0x42, 0xdf, 0x6,  0x84, 0x73, 0x21, 0x71, 0xf6, 0xec, 0x70, 0x51, 0x2d, 0x52, 0x0,  0x16, 0x40,
                   0x98, 0x17, 0x70, 0xb4, 0x7b, 0xf,  0x94, 0xb4, 0x38, 0xd,  0xe6, 0xfc, 0x76, 0x59, 0x97, 0x5d,
                   0xdf, 0x2f, 0xe8, 0x26, 0x6e, 0x0,  0x7,  0xb1, 0x2c, 0x1f, 0xa2, 0xf9, 0xd,  0x55, 0x0,  0xc,
                   0xba, 0x24, 0xb8, 0x4a, 0x18, 0x3a, 0xd2, 0x54, 0xa0, 0x74, 0xb9, 0xf2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0xc0, 0x63, 0x42, 0xdf, 0x6,  0x84, 0x73,
                                0x21, 0x71, 0xf6, 0xec, 0x70, 0x51, 0x2d, 0x52};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x98, 0x17, 0x70, 0xb4, 0x7b, 0xf,  0x94, 0xb4, 0x38, 0xd,
                                  0xe6, 0xfc, 0x76, 0x59, 0x97, 0x5d, 0xdf, 0x2f, 0xe8, 0x26, 0x6e};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1497;
  uint8_t client_id_bytes[] = {0x5, 0x66, 0x42, 0xb2, 0x4, 0x10, 0x8b, 0xe9, 0xa9, 0x48, 0xe9, 0x1d, 0x5b};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb1, 0x2c, 0x1f, 0xa2, 0xf9, 0xd, 0x55};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xba, 0x24, 0xb8, 0x4a, 0x18, 0x3a, 0xd2, 0x54, 0xa0, 0x74, 0xb9, 0xf2};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\137\131H\193\255h\165\215p\165", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\194\&8\235\&3\136P\198a", _willMsg =
// "\ESC}E\DLE\133\162\200\238\202o\182\242", _willProps = []}), _cleanSession = False, _keepAlive = 17930, _connID =
// "\152@\239K\222UU\185", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x38, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x46, 0xa,  0x0,  0x8,  0x98,
                   0x40, 0xef, 0x4b, 0xde, 0x55, 0x55, 0xb9, 0x0,  0x8,  0xc2, 0x38, 0xeb, 0x33, 0x88, 0x50,
                   0xc6, 0x61, 0x0,  0xc,  0x1b, 0x7d, 0x45, 0x10, 0x85, 0xa2, 0xc8, 0xee, 0xca, 0x6f, 0xb6,
                   0xf2, 0x0,  0xa,  0x89, 0x83, 0x48, 0xc1, 0xff, 0x68, 0xa5, 0xd7, 0x70, 0xa5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc2, 0x38, 0xeb, 0x33, 0x88, 0x50, 0xc6, 0x61};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1b, 0x7d, 0x45, 0x10, 0x85, 0xa2, 0xc8, 0xee, 0xca, 0x6f, 0xb6, 0xf2};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17930;
  uint8_t client_id_bytes[] = {0x98, 0x40, 0xef, 0x4b, 0xde, 0x55, 0x55, 0xb9};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x89, 0x83, 0x48, 0xc1, 0xff, 0x68, 0xa5, 0xd7, 0x70, 0xa5};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "E?\ENQ\194E\208h\161\GSV2\189", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\143E\250\224\248%\EOT?\DC3_m\189\NAK\216\163\252\138B\142\RS",
// _willMsg = "|\253OH.E\US*\182\240-;\234\180\237\239\&2\136B\128\241\131", _willProps = []}), _cleanSession = True,
// _keepAlive = 6426, _connID = "J\158>Hv\SYNdF\SOH\160)\DC1*'#id\188iaD\192\b\213\152rW\251", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x19, 0x1a, 0x0,  0x1c, 0x4a,
                   0x9e, 0x3e, 0x48, 0x76, 0x16, 0x64, 0x46, 0x1,  0xa0, 0x29, 0x11, 0x2a, 0x27, 0x23, 0x69,
                   0x64, 0xbc, 0x69, 0x61, 0x44, 0xc0, 0x8,  0xd5, 0x98, 0x72, 0x57, 0xfb, 0x0,  0x14, 0x8f,
                   0x45, 0xfa, 0xe0, 0xf8, 0x25, 0x4,  0x3f, 0x13, 0x5f, 0x6d, 0xbd, 0x15, 0xd8, 0xa3, 0xfc,
                   0x8a, 0x42, 0x8e, 0x1e, 0x0,  0x16, 0x7c, 0xfd, 0x4f, 0x48, 0x2e, 0x45, 0x1f, 0x2a, 0xb6,
                   0xf0, 0x2d, 0x3b, 0xea, 0xb4, 0xed, 0xef, 0x32, 0x88, 0x42, 0x80, 0xf1, 0x83};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0x45, 0xfa, 0xe0, 0xf8, 0x25, 0x4,  0x3f, 0x13, 0x5f,
                                0x6d, 0xbd, 0x15, 0xd8, 0xa3, 0xfc, 0x8a, 0x42, 0x8e, 0x1e};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7c, 0xfd, 0x4f, 0x48, 0x2e, 0x45, 0x1f, 0x2a, 0xb6, 0xf0, 0x2d,
                                  0x3b, 0xea, 0xb4, 0xed, 0xef, 0x32, 0x88, 0x42, 0x80, 0xf1, 0x83};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6426;
  uint8_t client_id_bytes[] = {0x4a, 0x9e, 0x3e, 0x48, 0x76, 0x16, 0x64, 0x46, 0x1, 0xa0, 0x29, 0x11, 0x2a, 0x27,
                               0x23, 0x69, 0x64, 0xbc, 0x69, 0x61, 0x44, 0xc0, 0x8, 0xd5, 0x98, 0x72, 0x57, 0xfb};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x45, 0x3f, 0x5, 0xc2, 0x45, 0xd0, 0x68, 0xa1, 0x1d, 0x56, 0x32, 0xbd};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\247\bJ@ON", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\200\&8\143\219\210\&8\154\ETB\191\209\ENQ\247\151j\ETX\STX\DLEwW\DC4(\171\239",
// _willMsg = "\239\163,\150S\ETXA\235Q\144\193p~G\249\214\218Wh\175\200\235;\235np\154t", _willProps = [PropContentType
// "\236\STX\225\178i",PropUserProperty "\187\&3\128\f\USu8" "t\164_\166\&4
// \254\230xga<lr\227\240\138U\242\164fG\133\152\161H\196\ETB\173\198",PropRequestResponseInformation
// 201,PropSharedSubscriptionAvailable 30,PropReasonString "\198x\US\145g",PropReasonString
// "\232\fj4\148u",PropReceiveMaximum 11759,PropRequestProblemInformation 152,PropAssignedClientIdentifier "\237\146\150
// \DEL\174\SYN*\212\ENQ)"]}), _cleanSession = True, _keepAlive = 24957, _connID =
// "\SUB\DC4P\DC4\ENQ\160\SO\226\141\r\251", _properties = [PropAuthenticationMethod
// "A\207\NAKa\141\177P\144\EOT\v\151C\182\NAK\157\SUBW\179FX\NAK\n2vE",PropSubscriptionIdentifier 2]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0xd0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa6, 0x61, 0x7d, 0x1e, 0x15, 0x0,  0x19,
                   0x41, 0xcf, 0x15, 0x61, 0x8d, 0xb1, 0x50, 0x90, 0x4,  0xb,  0x97, 0x43, 0xb6, 0x15, 0x9d, 0x1a, 0x57,
                   0xb3, 0x46, 0x58, 0x15, 0xa,  0x32, 0x76, 0x45, 0xb,  0x2,  0x0,  0xb,  0x1a, 0x14, 0x50, 0x14, 0x5,
                   0xa0, 0xe,  0xe2, 0x8d, 0xd,  0xfb, 0x5a, 0x3,  0x0,  0x5,  0xec, 0x2,  0xe1, 0xb2, 0x69, 0x26, 0x0,
                   0x7,  0xbb, 0x33, 0x80, 0xc,  0x1f, 0x75, 0x38, 0x0,  0x1e, 0x74, 0xa4, 0x5f, 0xa6, 0x34, 0x20, 0xfe,
                   0xe6, 0x78, 0x67, 0x61, 0x3c, 0x6c, 0x72, 0xe3, 0xf0, 0x8a, 0x55, 0xf2, 0xa4, 0x66, 0x47, 0x85, 0x98,
                   0xa1, 0x48, 0xc4, 0x17, 0xad, 0xc6, 0x19, 0xc9, 0x2a, 0x1e, 0x1f, 0x0,  0x5,  0xc6, 0x78, 0x1f, 0x91,
                   0x67, 0x1f, 0x0,  0x6,  0xe8, 0xc,  0x6a, 0x34, 0x94, 0x75, 0x21, 0x2d, 0xef, 0x17, 0x98, 0x12, 0x0,
                   0xb,  0xed, 0x92, 0x96, 0x20, 0x7f, 0xae, 0x16, 0x2a, 0xd4, 0x5,  0x29, 0x0,  0x17, 0xc8, 0x38, 0x8f,
                   0xdb, 0xd2, 0x38, 0x9a, 0x17, 0xbf, 0xd1, 0x5,  0xf7, 0x97, 0x6a, 0x3,  0x2,  0x10, 0x77, 0x57, 0x14,
                   0x28, 0xab, 0xef, 0x0,  0x1c, 0xef, 0xa3, 0x2c, 0x96, 0x53, 0x3,  0x41, 0xeb, 0x51, 0x90, 0xc1, 0x70,
                   0x7e, 0x47, 0xf9, 0xd6, 0xda, 0x57, 0x68, 0xaf, 0xc8, 0xeb, 0x3b, 0xeb, 0x6e, 0x70, 0x9a, 0x74, 0x0,
                   0x6,  0xf7, 0x8,  0x4a, 0x40, 0x4f, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x41, 0xcf, 0x15, 0x61, 0x8d, 0xb1, 0x50, 0x90, 0x4, 0xb,  0x97, 0x43, 0xb6,
                           0x15, 0x9d, 0x1a, 0x57, 0xb3, 0x46, 0x58, 0x15, 0xa, 0x32, 0x76, 0x45};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xec, 0x2, 0xe1, 0xb2, 0x69};
  uint8_t byteswillprops2[] = {0x74, 0xa4, 0x5f, 0xa6, 0x34, 0x20, 0xfe, 0xe6, 0x78, 0x67,
                               0x61, 0x3c, 0x6c, 0x72, 0xe3, 0xf0, 0x8a, 0x55, 0xf2, 0xa4,
                               0x66, 0x47, 0x85, 0x98, 0xa1, 0x48, 0xc4, 0x17, 0xad, 0xc6};
  uint8_t byteswillprops1[] = {0xbb, 0x33, 0x80, 0xc, 0x1f, 0x75, 0x38};
  uint8_t byteswillprops3[] = {0xc6, 0x78, 0x1f, 0x91, 0x67};
  uint8_t byteswillprops4[] = {0xe8, 0xc, 0x6a, 0x34, 0x94, 0x75};
  uint8_t byteswillprops5[] = {0xed, 0x92, 0x96, 0x20, 0x7f, 0xae, 0x16, 0x2a, 0xd4, 0x5, 0x29};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops1}, .v = {30, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11759}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc8, 0x38, 0x8f, 0xdb, 0xd2, 0x38, 0x9a, 0x17, 0xbf, 0xd1, 0x5, 0xf7,
                                0x97, 0x6a, 0x3,  0x2,  0x10, 0x77, 0x57, 0x14, 0x28, 0xab, 0xef};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xef, 0xa3, 0x2c, 0x96, 0x53, 0x3,  0x41, 0xeb, 0x51, 0x90, 0xc1, 0x70, 0x7e, 0x47,
                                  0xf9, 0xd6, 0xda, 0x57, 0x68, 0xaf, 0xc8, 0xeb, 0x3b, 0xeb, 0x6e, 0x70, 0x9a, 0x74};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24957;
  uint8_t client_id_bytes[] = {0x1a, 0x14, 0x50, 0x14, 0x5, 0xa0, 0xe, 0xe2, 0x8d, 0xd, 0xfb};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf7, 0x8, 0x4a, 0x40, 0x4f, 0x4e};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\DC4\245qv", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\132\165\SUB\228Tg9\NULV.~\142\194\226:", _willMsg =
// "\176\179\172\a1r\164{\SOH\143\130V5\US-ElV\146<RT\170\225e", _willProps = [PropServerReference
// "\129\168}P\v\157f^lk\167\SOC\201\170\STXM\DC2\233\173/\145",PropMessageExpiryInterval
// 19601,PropSubscriptionIdentifier 13,PropSessionExpiryInterval 16335]}), _cleanSession = True, _keepAlive = 4963,
// _connID = "\146\SUB.7\232\244R\ETX\175U\192\149\DEL\185Mm\ESC\165\239l\189\149\181R", _properties = []}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x7d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb6, 0x13, 0x63, 0x0,  0x0,  0x18, 0x92,
                   0x1a, 0x2e, 0x37, 0xe8, 0xf4, 0x52, 0x3,  0xaf, 0x55, 0xc0, 0x95, 0x7f, 0xb9, 0x4d, 0x6d, 0x1b,
                   0xa5, 0xef, 0x6c, 0xbd, 0x95, 0xb5, 0x52, 0x25, 0x1c, 0x0,  0x16, 0x81, 0xa8, 0x7d, 0x50, 0xb,
                   0x9d, 0x66, 0x5e, 0x6c, 0x6b, 0xa7, 0xe,  0x43, 0xc9, 0xaa, 0x2,  0x4d, 0x12, 0xe9, 0xad, 0x2f,
                   0x91, 0x2,  0x0,  0x0,  0x4c, 0x91, 0xb,  0xd,  0x11, 0x0,  0x0,  0x3f, 0xcf, 0x0,  0xf,  0x84,
                   0xa5, 0x1a, 0xe4, 0x54, 0x67, 0x39, 0x0,  0x56, 0x2e, 0x7e, 0x8e, 0xc2, 0xe2, 0x3a, 0x0,  0x19,
                   0xb0, 0xb3, 0xac, 0x7,  0x31, 0x72, 0xa4, 0x7b, 0x1,  0x8f, 0x82, 0x56, 0x35, 0x1f, 0x2d, 0x45,
                   0x6c, 0x56, 0x92, 0x3c, 0x52, 0x54, 0xaa, 0xe1, 0x65, 0x0,  0x4,  0x14, 0xf5, 0x71, 0x76};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x81, 0xa8, 0x7d, 0x50, 0xb, 0x9d, 0x66, 0x5e, 0x6c, 0x6b, 0xa7,
                               0xe,  0x43, 0xc9, 0xaa, 0x2, 0x4d, 0x12, 0xe9, 0xad, 0x2f, 0x91};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19601}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16335}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x84, 0xa5, 0x1a, 0xe4, 0x54, 0x67, 0x39, 0x0,
                                0x56, 0x2e, 0x7e, 0x8e, 0xc2, 0xe2, 0x3a};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb0, 0xb3, 0xac, 0x7,  0x31, 0x72, 0xa4, 0x7b, 0x1,  0x8f, 0x82, 0x56, 0x35,
                                  0x1f, 0x2d, 0x45, 0x6c, 0x56, 0x92, 0x3c, 0x52, 0x54, 0xaa, 0xe1, 0x65};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4963;
  uint8_t client_id_bytes[] = {0x92, 0x1a, 0x2e, 0x37, 0xe8, 0xf4, 0x52, 0x3,  0xaf, 0x55, 0xc0, 0x95,
                               0x7f, 0xb9, 0x4d, 0x6d, 0x1b, 0xa5, 0xef, 0x6c, 0xbd, 0x95, 0xb5, 0x52};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x14, 0xf5, 0x71, 0x76};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\209\146\&2\164V", _willMsg =
// "\189\145\130\DC2U`\130\244\235\250\194@\222\162-\187\250\RS\SO\213$zF\EOT\t\197", _willProps =
// [PropRequestProblemInformation 83,PropResponseInformation
// "!\209\235\FS\170\&2\234\141m\238T\192ZgEH\SO\172\198\189\186\209\191\149\156r\246\&4/\f",PropRequestResponseInformation
// 84,PropMessageExpiryInterval 9800,PropUserProperty "" "f-",PropUserProperty "r\162\222\210$nPa,\206{\174\145\233jT"
// "O|",PropUserProperty "S\b_I)\\\198\145Mz\217\&1\142QZ\250'\214Cp\141\177\\i\249\232;"
// "\198",PropAssignedClientIdentifier "[\149p6I\208\188P\NUL\136\201\209gJ\159&\171\NUL\247",PropMaximumQoS
// 17,PropAssignedClientIdentifier
// "\250\rp\207s\223\220\SUBT\192<\176\b\232\r\GS\243\203F1\148#r\167\DC1",PropSubscriptionIdentifierAvailable
// 60,PropResponseInformation
// "\STX\254\198\248\141\197+\157!a5\136\225\129\bK\172\221\145\204\231\246\234\166bO",PropServerReference
// "\f<5I\186h\129\ETB\196",PropSharedSubscriptionAvailable 213,PropTopicAlias 16842,PropMessageExpiryInterval
// 1598,PropMaximumPacketSize 29381,PropMaximumPacketSize 23683,PropReceiveMaximum 727,PropSubscriptionIdentifier 23]}),
// _cleanSession = True, _keepAlive = 4029, _connID = "\ETB\180\164\136M><\142\&9\159Dn\bA\197\NUL2", _properties =
// [PropMaximumPacketSize 32513,PropAuthenticationMethod "\168i\223e0\STX",PropTopicAliasMaximum
// 4235,PropMessageExpiryInterval 16501,PropResponseTopic
// "\208\148\163\ACK\198\176M\245FqB\212\205iD\190W\165/\161:\138\206\&0\246",PropRequestProblemInformation
// 178,PropSubscriptionIdentifier 11,PropResponseInformation
// "\232p,\EOT\234/|\203\218\236t\SUB!\186tT\250\233\SUB\190\&0\\\228\154\a\189B",PropAuthenticationData
// "\211\189\207l\b(\211\171'x\189\201\132\137;\DC4SC*sP$\167yX>x",PropWillDelayInterval 7419,PropMaximumPacketSize
// 16457,PropRetainAvailable 183,PropAuthenticationData
// "_`C\233}\141\248\213\167C\142\254\vo\"2&\226$&a\\\235TW\203\173\195",PropAssignedClientIdentifier
// "\\|\213o\173\170\249\210c?Y\149\189[9\243\239w\SI\235Rd\202\154^\222\DELU\180\247",PropTopicAlias
// 26546,PropSessionExpiryInterval 24695,PropResponseInformation "y\DC3\212",PropReceiveMaximum
// 10210,PropAuthenticationMethod "",PropSessionExpiryInterval 2004,PropAuthenticationData "\254\206\ESCo\133\186
// \US\145_W:\170\149\224\128og\249\161IE\145N\137",PropAssignedClientIdentifier
// "\v\224\193\194\204\215\249\ACKF",PropMessageExpiryInterval 23854,PropSharedSubscriptionAvailable 245]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0xab, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0xf,  0xbd, 0x86, 0x2,  0x27, 0x0,  0x0,  0x7f,
      0x1,  0x15, 0x0,  0x6,  0xa8, 0x69, 0xdf, 0x65, 0x30, 0x2,  0x22, 0x10, 0x8b, 0x2,  0x0,  0x0,  0x40, 0x75, 0x8,
      0x0,  0x19, 0xd0, 0x94, 0xa3, 0x6,  0xc6, 0xb0, 0x4d, 0xf5, 0x46, 0x71, 0x42, 0xd4, 0xcd, 0x69, 0x44, 0xbe, 0x57,
      0xa5, 0x2f, 0xa1, 0x3a, 0x8a, 0xce, 0x30, 0xf6, 0x17, 0xb2, 0xb,  0xb,  0x1a, 0x0,  0x1b, 0xe8, 0x70, 0x2c, 0x4,
      0xea, 0x2f, 0x7c, 0xcb, 0xda, 0xec, 0x74, 0x1a, 0x21, 0xba, 0x74, 0x54, 0xfa, 0xe9, 0x1a, 0xbe, 0x30, 0x5c, 0xe4,
      0x9a, 0x7,  0xbd, 0x42, 0x16, 0x0,  0x1b, 0xd3, 0xbd, 0xcf, 0x6c, 0x8,  0x28, 0xd3, 0xab, 0x27, 0x78, 0xbd, 0xc9,
      0x84, 0x89, 0x3b, 0x14, 0x53, 0x43, 0x2a, 0x73, 0x50, 0x24, 0xa7, 0x79, 0x58, 0x3e, 0x78, 0x18, 0x0,  0x0,  0x1c,
      0xfb, 0x27, 0x0,  0x0,  0x40, 0x49, 0x25, 0xb7, 0x16, 0x0,  0x1c, 0x5f, 0x60, 0x43, 0xe9, 0x7d, 0x8d, 0xf8, 0xd5,
      0xa7, 0x43, 0x8e, 0xfe, 0xb,  0x6f, 0x22, 0x32, 0x26, 0xe2, 0x24, 0x26, 0x61, 0x5c, 0xeb, 0x54, 0x57, 0xcb, 0xad,
      0xc3, 0x12, 0x0,  0x1e, 0x5c, 0x7c, 0xd5, 0x6f, 0xad, 0xaa, 0xf9, 0xd2, 0x63, 0x3f, 0x59, 0x95, 0xbd, 0x5b, 0x39,
      0xf3, 0xef, 0x77, 0xf,  0xeb, 0x52, 0x64, 0xca, 0x9a, 0x5e, 0xde, 0x7f, 0x55, 0xb4, 0xf7, 0x23, 0x67, 0xb2, 0x11,
      0x0,  0x0,  0x60, 0x77, 0x1a, 0x0,  0x3,  0x79, 0x13, 0xd4, 0x21, 0x27, 0xe2, 0x15, 0x0,  0x0,  0x11, 0x0,  0x0,
      0x7,  0xd4, 0x16, 0x0,  0x19, 0xfe, 0xce, 0x1b, 0x6f, 0x85, 0xba, 0x20, 0x1f, 0x91, 0x5f, 0x57, 0x3a, 0xaa, 0x95,
      0xe0, 0x80, 0x6f, 0x67, 0xf9, 0xa1, 0x49, 0x45, 0x91, 0x4e, 0x89, 0x12, 0x0,  0x9,  0xb,  0xe0, 0xc1, 0xc2, 0xcc,
      0xd7, 0xf9, 0x6,  0x46, 0x2,  0x0,  0x0,  0x5d, 0x2e, 0x2a, 0xf5, 0x0,  0x11, 0x17, 0xb4, 0xa4, 0x88, 0x4d, 0x3e,
      0x3c, 0x8e, 0x39, 0x9f, 0x44, 0x6e, 0x8,  0x41, 0xc5, 0x0,  0x32, 0xe1, 0x1,  0x17, 0x53, 0x1a, 0x0,  0x1e, 0x21,
      0xd1, 0xeb, 0x1c, 0xaa, 0x32, 0xea, 0x8d, 0x6d, 0xee, 0x54, 0xc0, 0x5a, 0x67, 0x45, 0x48, 0xe,  0xac, 0xc6, 0xbd,
      0xba, 0xd1, 0xbf, 0x95, 0x9c, 0x72, 0xf6, 0x34, 0x2f, 0xc,  0x19, 0x54, 0x2,  0x0,  0x0,  0x26, 0x48, 0x26, 0x0,
      0x0,  0x0,  0x2,  0x66, 0x2d, 0x26, 0x0,  0x10, 0x72, 0xa2, 0xde, 0xd2, 0x24, 0x6e, 0x50, 0x61, 0x2c, 0xce, 0x7b,
      0xae, 0x91, 0xe9, 0x6a, 0x54, 0x0,  0x2,  0x4f, 0x7c, 0x26, 0x0,  0x1b, 0x53, 0x8,  0x5f, 0x49, 0x29, 0x5c, 0xc6,
      0x91, 0x4d, 0x7a, 0xd9, 0x31, 0x8e, 0x51, 0x5a, 0xfa, 0x27, 0xd6, 0x43, 0x70, 0x8d, 0xb1, 0x5c, 0x69, 0xf9, 0xe8,
      0x3b, 0x0,  0x1,  0xc6, 0x12, 0x0,  0x13, 0x5b, 0x95, 0x70, 0x36, 0x49, 0xd0, 0xbc, 0x50, 0x0,  0x88, 0xc9, 0xd1,
      0x67, 0x4a, 0x9f, 0x26, 0xab, 0x0,  0xf7, 0x24, 0x11, 0x12, 0x0,  0x19, 0xfa, 0xd,  0x70, 0xcf, 0x73, 0xdf, 0xdc,
      0x1a, 0x54, 0xc0, 0x3c, 0xb0, 0x8,  0xe8, 0xd,  0x1d, 0xf3, 0xcb, 0x46, 0x31, 0x94, 0x23, 0x72, 0xa7, 0x11, 0x29,
      0x3c, 0x1a, 0x0,  0x1a, 0x2,  0xfe, 0xc6, 0xf8, 0x8d, 0xc5, 0x2b, 0x9d, 0x21, 0x61, 0x35, 0x88, 0xe1, 0x81, 0x8,
      0x4b, 0xac, 0xdd, 0x91, 0xcc, 0xe7, 0xf6, 0xea, 0xa6, 0x62, 0x4f, 0x1c, 0x0,  0x9,  0xc,  0x3c, 0x35, 0x49, 0xba,
      0x68, 0x81, 0x17, 0xc4, 0x2a, 0xd5, 0x23, 0x41, 0xca, 0x2,  0x0,  0x0,  0x6,  0x3e, 0x27, 0x0,  0x0,  0x72, 0xc5,
      0x27, 0x0,  0x0,  0x5c, 0x83, 0x21, 0x2,  0xd7, 0xb,  0x17, 0x0,  0x5,  0xd1, 0x92, 0x32, 0xa4, 0x56, 0x0,  0x1a,
      0xbd, 0x91, 0x82, 0x12, 0x55, 0x60, 0x82, 0xf4, 0xeb, 0xfa, 0xc2, 0x40, 0xde, 0xa2, 0x2d, 0xbb, 0xfa, 0x1e, 0xe,
      0xd5, 0x24, 0x7a, 0x46, 0x4,  0x9,  0xc5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa8, 0x69, 0xdf, 0x65, 0x30, 0x2};
  uint8_t bytesprops1[] = {0xd0, 0x94, 0xa3, 0x6,  0xc6, 0xb0, 0x4d, 0xf5, 0x46, 0x71, 0x42, 0xd4, 0xcd,
                           0x69, 0x44, 0xbe, 0x57, 0xa5, 0x2f, 0xa1, 0x3a, 0x8a, 0xce, 0x30, 0xf6};
  uint8_t bytesprops2[] = {0xe8, 0x70, 0x2c, 0x4,  0xea, 0x2f, 0x7c, 0xcb, 0xda, 0xec, 0x74, 0x1a, 0x21, 0xba,
                           0x74, 0x54, 0xfa, 0xe9, 0x1a, 0xbe, 0x30, 0x5c, 0xe4, 0x9a, 0x7,  0xbd, 0x42};
  uint8_t bytesprops3[] = {0xd3, 0xbd, 0xcf, 0x6c, 0x8,  0x28, 0xd3, 0xab, 0x27, 0x78, 0xbd, 0xc9, 0x84, 0x89,
                           0x3b, 0x14, 0x53, 0x43, 0x2a, 0x73, 0x50, 0x24, 0xa7, 0x79, 0x58, 0x3e, 0x78};
  uint8_t bytesprops4[] = {0x5f, 0x60, 0x43, 0xe9, 0x7d, 0x8d, 0xf8, 0xd5, 0xa7, 0x43, 0x8e, 0xfe, 0xb,  0x6f,
                           0x22, 0x32, 0x26, 0xe2, 0x24, 0x26, 0x61, 0x5c, 0xeb, 0x54, 0x57, 0xcb, 0xad, 0xc3};
  uint8_t bytesprops5[] = {0x5c, 0x7c, 0xd5, 0x6f, 0xad, 0xaa, 0xf9, 0xd2, 0x63, 0x3f, 0x59, 0x95, 0xbd, 0x5b, 0x39,
                           0xf3, 0xef, 0x77, 0xf,  0xeb, 0x52, 0x64, 0xca, 0x9a, 0x5e, 0xde, 0x7f, 0x55, 0xb4, 0xf7};
  uint8_t bytesprops6[] = {0x79, 0x13, 0xd4};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0xfe, 0xce, 0x1b, 0x6f, 0x85, 0xba, 0x20, 0x1f, 0x91, 0x5f, 0x57, 0x3a, 0xaa,
                           0x95, 0xe0, 0x80, 0x6f, 0x67, 0xf9, 0xa1, 0x49, 0x45, 0x91, 0x4e, 0x89};
  uint8_t bytesprops9[] = {0xb, 0xe0, 0xc1, 0xc2, 0xcc, 0xd7, 0xf9, 0x6, 0x46};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32513}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4235}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16501}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7419}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16457}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26546}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24695}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10210}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2004}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23854}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 245}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x21, 0xd1, 0xeb, 0x1c, 0xaa, 0x32, 0xea, 0x8d, 0x6d, 0xee, 0x54, 0xc0, 0x5a, 0x67, 0x45,
                               0x48, 0xe,  0xac, 0xc6, 0xbd, 0xba, 0xd1, 0xbf, 0x95, 0x9c, 0x72, 0xf6, 0x34, 0x2f, 0xc};
  uint8_t byteswillprops2[] = {0x66, 0x2d};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops4[] = {0x4f, 0x7c};
  uint8_t byteswillprops3[] = {0x72, 0xa2, 0xde, 0xd2, 0x24, 0x6e, 0x50, 0x61,
                               0x2c, 0xce, 0x7b, 0xae, 0x91, 0xe9, 0x6a, 0x54};
  uint8_t byteswillprops6[] = {0xc6};
  uint8_t byteswillprops5[] = {0x53, 0x8,  0x5f, 0x49, 0x29, 0x5c, 0xc6, 0x91, 0x4d, 0x7a, 0xd9, 0x31, 0x8e, 0x51,
                               0x5a, 0xfa, 0x27, 0xd6, 0x43, 0x70, 0x8d, 0xb1, 0x5c, 0x69, 0xf9, 0xe8, 0x3b};
  uint8_t byteswillprops7[] = {0x5b, 0x95, 0x70, 0x36, 0x49, 0xd0, 0xbc, 0x50, 0x0, 0x88,
                               0xc9, 0xd1, 0x67, 0x4a, 0x9f, 0x26, 0xab, 0x0,  0xf7};
  uint8_t byteswillprops8[] = {0xfa, 0xd, 0x70, 0xcf, 0x73, 0xdf, 0xdc, 0x1a, 0x54, 0xc0, 0x3c, 0xb0, 0x8,
                               0xe8, 0xd, 0x1d, 0xf3, 0xcb, 0x46, 0x31, 0x94, 0x23, 0x72, 0xa7, 0x11};
  uint8_t byteswillprops9[] = {0x2,  0xfe, 0xc6, 0xf8, 0x8d, 0xc5, 0x2b, 0x9d, 0x21, 0x61, 0x35, 0x88, 0xe1,
                               0x81, 0x8,  0x4b, 0xac, 0xdd, 0x91, 0xcc, 0xe7, 0xf6, 0xea, 0xa6, 0x62, 0x4f};
  uint8_t byteswillprops10[] = {0xc, 0x3c, 0x35, 0x49, 0xba, 0x68, 0x81, 0x17, 0xc4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9800}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops1}, .v = {2, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops3}, .v = {2, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {27, (char*)&byteswillprops5}, .v = {1, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16842}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1598}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29381}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23683}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 727}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0x92, 0x32, 0xa4, 0x56};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0x91, 0x82, 0x12, 0x55, 0x60, 0x82, 0xf4, 0xeb, 0xfa, 0xc2, 0x40, 0xde,
                                  0xa2, 0x2d, 0xbb, 0xfa, 0x1e, 0xe,  0xd5, 0x24, 0x7a, 0x46, 0x4,  0x9,  0xc5};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4029;
  uint8_t client_id_bytes[] = {0x17, 0xb4, 0xa4, 0x88, 0x4d, 0x3e, 0x3c, 0x8e, 0x39,
                               0x9f, 0x44, 0x6e, 0x8,  0x41, 0xc5, 0x0,  0x32};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "F\237\221 :fM\163\208\237Y\ENQ\245\179\250$\234\187", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 28626, _connID = "2\249o\r\221\161\151?\DC4\182_} \251\159",
// _properties = [PropTopicAliasMaximum 9492,PropSubscriptionIdentifier 16,PropAssignedClientIdentifier
// "t\207",PropResponseTopic
// "e\SI/\254K\NAK\205\DC4G\248C\140\&1\185\186t6]\139\171\145u\193w\131",PropAssignedClientIdentifier
// "H\157\158l-b\228\241\229,\229F\209\255(\168\bM\182#",PropTopicAliasMaximum 20871,PropSessionExpiryInterval
// 253,PropResponseInformation
// "_\227f\\X6\144\213\&4VPi\181\169Z\171a\141A\210\RSt\215\223Lg\238\215",PropRetainAvailable
// 165,PropAuthenticationData ";D\155W",PropWillDelayInterval 4393,PropMessageExpiryInterval
// 14413,PropAssignedClientIdentifier
// "!\132\167\&1\DC2C\203\157R\US\236\153\DC2\231\239\DLE\213l\171\241\131\252\t\156",PropPayloadFormatIndicator
// 204,PropUserProperty "X\134M\162\254\231^\138\STX_\177\DLE\\Kh\231~L\207\EM\ESC\237&6\254\140\190w|n"
// "\146]\233L\172\&1\175\162M\233\179\213L\239q=;\207\"\148",PropCorrelationData
// "k\DC1\130}J",PropRequestProblemInformation 46,PropSessionExpiryInterval 10169,PropAssignedClientIdentifier
// "\165\179\&3\172g\236G\178S\164e,\ESCiz",PropRequestResponseInformation 110,PropMaximumPacketSize
// 22080,PropReceiveMaximum 12311,PropSubscriptionIdentifierAvailable 92,PropTopicAlias 27810]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xac, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x6f, 0xd2, 0xfb, 0x1,  0x22, 0x25, 0x14, 0xb,
      0x10, 0x12, 0x0,  0x2,  0x74, 0xcf, 0x8,  0x0,  0x19, 0x65, 0xf,  0x2f, 0xfe, 0x4b, 0x15, 0xcd, 0x14, 0x47, 0xf8,
      0x43, 0x8c, 0x31, 0xb9, 0xba, 0x74, 0x36, 0x5d, 0x8b, 0xab, 0x91, 0x75, 0xc1, 0x77, 0x83, 0x12, 0x0,  0x14, 0x48,
      0x9d, 0x9e, 0x6c, 0x2d, 0x62, 0xe4, 0xf1, 0xe5, 0x2c, 0xe5, 0x46, 0xd1, 0xff, 0x28, 0xa8, 0x8,  0x4d, 0xb6, 0x23,
      0x22, 0x51, 0x87, 0x11, 0x0,  0x0,  0x0,  0xfd, 0x1a, 0x0,  0x1c, 0x5f, 0xe3, 0x66, 0x5c, 0x58, 0x36, 0x90, 0xd5,
      0x34, 0x56, 0x50, 0x69, 0xb5, 0xa9, 0x5a, 0xab, 0x61, 0x8d, 0x41, 0xd2, 0x1e, 0x74, 0xd7, 0xdf, 0x4c, 0x67, 0xee,
      0xd7, 0x25, 0xa5, 0x16, 0x0,  0x4,  0x3b, 0x44, 0x9b, 0x57, 0x18, 0x0,  0x0,  0x11, 0x29, 0x2,  0x0,  0x0,  0x38,
      0x4d, 0x12, 0x0,  0x18, 0x21, 0x84, 0xa7, 0x31, 0x12, 0x43, 0xcb, 0x9d, 0x52, 0x1f, 0xec, 0x99, 0x12, 0xe7, 0xef,
      0x10, 0xd5, 0x6c, 0xab, 0xf1, 0x83, 0xfc, 0x9,  0x9c, 0x1,  0xcc, 0x26, 0x0,  0x1e, 0x58, 0x86, 0x4d, 0xa2, 0xfe,
      0xe7, 0x5e, 0x8a, 0x2,  0x5f, 0xb1, 0x10, 0x5c, 0x4b, 0x68, 0xe7, 0x7e, 0x4c, 0xcf, 0x19, 0x1b, 0xed, 0x26, 0x36,
      0xfe, 0x8c, 0xbe, 0x77, 0x7c, 0x6e, 0x0,  0x14, 0x92, 0x5d, 0xe9, 0x4c, 0xac, 0x31, 0xaf, 0xa2, 0x4d, 0xe9, 0xb3,
      0xd5, 0x4c, 0xef, 0x71, 0x3d, 0x3b, 0xcf, 0x22, 0x94, 0x9,  0x0,  0x5,  0x6b, 0x11, 0x82, 0x7d, 0x4a, 0x17, 0x2e,
      0x11, 0x0,  0x0,  0x27, 0xb9, 0x12, 0x0,  0xf,  0xa5, 0xb3, 0x33, 0xac, 0x67, 0xec, 0x47, 0xb2, 0x53, 0xa4, 0x65,
      0x2c, 0x1b, 0x69, 0x7a, 0x19, 0x6e, 0x27, 0x0,  0x0,  0x56, 0x40, 0x21, 0x30, 0x17, 0x29, 0x5c, 0x23, 0x6c, 0xa2,
      0x0,  0xf,  0x32, 0xf9, 0x6f, 0xd,  0xdd, 0xa1, 0x97, 0x3f, 0x14, 0xb6, 0x5f, 0x7d, 0x20, 0xfb, 0x9f, 0x0,  0x12,
      0x46, 0xed, 0xdd, 0x20, 0x3a, 0x66, 0x4d, 0xa3, 0xd0, 0xed, 0x59, 0x5,  0xf5, 0xb3, 0xfa, 0x24, 0xea, 0xbb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x74, 0xcf};
  uint8_t bytesprops1[] = {0x65, 0xf,  0x2f, 0xfe, 0x4b, 0x15, 0xcd, 0x14, 0x47, 0xf8, 0x43, 0x8c, 0x31,
                           0xb9, 0xba, 0x74, 0x36, 0x5d, 0x8b, 0xab, 0x91, 0x75, 0xc1, 0x77, 0x83};
  uint8_t bytesprops2[] = {0x48, 0x9d, 0x9e, 0x6c, 0x2d, 0x62, 0xe4, 0xf1, 0xe5, 0x2c,
                           0xe5, 0x46, 0xd1, 0xff, 0x28, 0xa8, 0x8,  0x4d, 0xb6, 0x23};
  uint8_t bytesprops3[] = {0x5f, 0xe3, 0x66, 0x5c, 0x58, 0x36, 0x90, 0xd5, 0x34, 0x56, 0x50, 0x69, 0xb5, 0xa9,
                           0x5a, 0xab, 0x61, 0x8d, 0x41, 0xd2, 0x1e, 0x74, 0xd7, 0xdf, 0x4c, 0x67, 0xee, 0xd7};
  uint8_t bytesprops4[] = {0x3b, 0x44, 0x9b, 0x57};
  uint8_t bytesprops5[] = {0x21, 0x84, 0xa7, 0x31, 0x12, 0x43, 0xcb, 0x9d, 0x52, 0x1f, 0xec, 0x99,
                           0x12, 0xe7, 0xef, 0x10, 0xd5, 0x6c, 0xab, 0xf1, 0x83, 0xfc, 0x9,  0x9c};
  uint8_t bytesprops7[] = {0x92, 0x5d, 0xe9, 0x4c, 0xac, 0x31, 0xaf, 0xa2, 0x4d, 0xe9,
                           0xb3, 0xd5, 0x4c, 0xef, 0x71, 0x3d, 0x3b, 0xcf, 0x22, 0x94};
  uint8_t bytesprops6[] = {0x58, 0x86, 0x4d, 0xa2, 0xfe, 0xe7, 0x5e, 0x8a, 0x2,  0x5f, 0xb1, 0x10, 0x5c, 0x4b, 0x68,
                           0xe7, 0x7e, 0x4c, 0xcf, 0x19, 0x1b, 0xed, 0x26, 0x36, 0xfe, 0x8c, 0xbe, 0x77, 0x7c, 0x6e};
  uint8_t bytesprops8[] = {0x6b, 0x11, 0x82, 0x7d, 0x4a};
  uint8_t bytesprops9[] = {0xa5, 0xb3, 0x33, 0xac, 0x67, 0xec, 0x47, 0xb2, 0x53, 0xa4, 0x65, 0x2c, 0x1b, 0x69, 0x7a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9492}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20871}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 253}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4393}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14413}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops6}, .v = {20, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10169}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22080}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12311}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27810}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28626;
  uint8_t client_id_bytes[] = {0x32, 0xf9, 0x6f, 0xd, 0xdd, 0xa1, 0x97, 0x3f, 0x14, 0xb6, 0x5f, 0x7d, 0x20, 0xfb, 0x9f};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x46, 0xed, 0xdd, 0x20, 0x3a, 0x66, 0x4d, 0xa3, 0xd0,
                              0xed, 0x59, 0x5,  0xf5, 0xb3, 0xfa, 0x24, 0xea, 0xbb};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 28697, _connID = "\203\185\&0\b\162/\DC4\184\135\214\244(e)\232\150t\248\130\139\217D\233k\138\237\\\202",
// _properties = [PropTopicAlias 7303,PropReasonString
// "\183\139\253+\155\228\DC2VU\222\232\r\247o|\FS\SYN\"NE",PropPayloadFormatIndicator
// 13,PropSharedSubscriptionAvailable 176,PropMaximumQoS 235,PropPayloadFormatIndicator 62,PropTopicAlias
// 2640,PropTopicAlias 32301,PropRequestResponseInformation 103,PropServerKeepAlive 17611,PropContentType
// "\EOT\SI\186\201W\239\167\202\204\210\153\233^\222+=\186\&6+",PropRequestProblemInformation 45]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x6e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x70, 0x19, 0x45, 0x23, 0x1c, 0x87,
                   0x1f, 0x0,  0x14, 0xb7, 0x8b, 0xfd, 0x2b, 0x9b, 0xe4, 0x12, 0x56, 0x55, 0xde, 0xe8, 0xd,  0xf7,
                   0x6f, 0x7c, 0x1c, 0x16, 0x22, 0x4e, 0x45, 0x1,  0xd,  0x2a, 0xb0, 0x24, 0xeb, 0x1,  0x3e, 0x23,
                   0xa,  0x50, 0x23, 0x7e, 0x2d, 0x19, 0x67, 0x13, 0x44, 0xcb, 0x3,  0x0,  0x13, 0x4,  0xf,  0xba,
                   0xc9, 0x57, 0xef, 0xa7, 0xca, 0xcc, 0xd2, 0x99, 0xe9, 0x5e, 0xde, 0x2b, 0x3d, 0xba, 0x36, 0x2b,
                   0x17, 0x2d, 0x0,  0x1c, 0xcb, 0xb9, 0x30, 0x8,  0xa2, 0x2f, 0x14, 0xb8, 0x87, 0xd6, 0xf4, 0x28,
                   0x65, 0x29, 0xe8, 0x96, 0x74, 0xf8, 0x82, 0x8b, 0xd9, 0x44, 0xe9, 0x6b, 0x8a, 0xed, 0x5c, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb7, 0x8b, 0xfd, 0x2b, 0x9b, 0xe4, 0x12, 0x56, 0x55, 0xde,
                           0xe8, 0xd,  0xf7, 0x6f, 0x7c, 0x1c, 0x16, 0x22, 0x4e, 0x45};
  uint8_t bytesprops1[] = {0x4,  0xf,  0xba, 0xc9, 0x57, 0xef, 0xa7, 0xca, 0xcc, 0xd2,
                           0x99, 0xe9, 0x5e, 0xde, 0x2b, 0x3d, 0xba, 0x36, 0x2b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7303}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2640}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32301}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17611}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 45}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28697;
  uint8_t client_id_bytes[] = {0xcb, 0xb9, 0x30, 0x8,  0xa2, 0x2f, 0x14, 0xb8, 0x87, 0xd6, 0xf4, 0x28, 0x65, 0x29,
                               0xe8, 0x96, 0x74, 0xf8, 0x82, 0x8b, 0xd9, 0x44, 0xe9, 0x6b, 0x8a, 0xed, 0x5c, 0xca};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETX\167/\DLE?I\DEL\214T$", _password = Just
// "\SUB\181v\f\SO\128\188\245\DEL\145\178\224\247\166\&8", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\212\201\CANR|p\199", _willMsg =
// "\171\188\151\239\EM#[\DC3\EM\SI1F0\134S8\195:\144\207\US\CANc\209?\213\190@\186", _willProps =
// [PropRequestProblemInformation 167,PropTopicAliasMaximum 5511,PropPayloadFormatIndicator 29,PropMessageExpiryInterval
// 30108,PropUserProperty "\240@7\DC2\185\SYN\211\&2X\226\132\140\254\DC3"
// "\129E\194x\153\137\200\251\131?D\220K",PropMessageExpiryInterval 4336,PropUserProperty
// "\199\186p\141\&0]\129?\193\r\NUL\217\182\216\248\a\215\t\145\199"
// "\RS\DC3\211\ETB\174h\244]\161\248c\190\250'\242m\GSc\144n?6\f\192P\ETX\208\208\139",PropSessionExpiryInterval
// 8037,PropWillDelayInterval 18302,PropPayloadFormatIndicator 202,PropReasonString
// "u4\147\195\128\219/\253:\212\190In\187\199o\RS\161\227\209LbH\145+",PropRequestResponseInformation
// 201,PropMaximumQoS 175,PropSubscriptionIdentifierAvailable 178,PropRequestProblemInformation
// 239,PropSessionExpiryInterval 8424,PropUserProperty "\219\246\169x\136\219\212\211\239"
// "\193\176\f\222f\132\190\182\160D"]}), _cleanSession = True, _keepAlive = 14165, _connID =
// "s@\"\140E\205\ESCb\193\200%\173\206\NAK)\152s", _properties = [PropAuthenticationData "\189,/\228j\223\SUB
// \153IHJ$\191\246f",PropAuthenticationData
// "\135\131CLX1\194Q\246n1\247\149\DC3\208Y\195\173:3:@+\GS\185",PropResponseTopic
// "\r\141\ESC\215PT\154\216\US*I",PropServerKeepAlive 16067,PropResponseTopic
// "\149\ETX\239\233\247\US\186\211\GS\SI\199\ESC\159\184\212\187\253&\SO\SO\DC1\FS\253\&3~",PropResponseTopic
// "rp_\173\162",PropReceiveMaximum 19811,PropAssignedClientIdentifier
// "\ESC\n\186\222\159\139",PropRequestProblemInformation 9,PropReasonString
// "\rBi\234\227\&7\249LO\236*\182>qR3\147h)\245j0\137\242A*H",PropSessionExpiryInterval 27006,PropAuthenticationMethod
// "L\219\128W\144}\158\221Y-\202\210\SOH1\230O\b\195",PropSubscriptionIdentifier 25,PropServerReference
// "v\DC3\156ni\154\193\DC3\228\180\156\198J*B\249\233\DEL\GS\145G\133\&4\143\235\195\134",PropRetainAvailable
// 166,PropRetainAvailable 198,PropWillDelayInterval 23170,PropSubscriptionIdentifier 23,PropMaximumQoS
// 23,PropAuthenticationData "\182@)",PropWillDelayInterval 7608,PropSubscriptionIdentifierAvailable 47,PropReasonString
// "\DC1\218\182",PropMaximumPacketSize 1376,PropAuthenticationMethod
// "G\215\199&\SUB0\DLE\160\217\157<u\235\DC2z\174\166\147y\135\191\241\192\255rE\193\196^4",PropSessionExpiryInterval
// 14329,PropSharedSubscriptionAvailable 31,PropReasonString
// "Y\224\183:\206Rv\215\183\238\161c\254\169\SYNf{nW36\151\SO\SUB2jzO",PropTopicAlias 20018]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xd3, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x37, 0x55, 0xb9, 0x2,  0x16, 0x0,  0x10, 0xbd,
      0x2c, 0x2f, 0xe4, 0x6a, 0xdf, 0x1a, 0x20, 0x99, 0x49, 0x48, 0x4a, 0x24, 0xbf, 0xf6, 0x66, 0x16, 0x0,  0x19, 0x87,
      0x83, 0x43, 0x4c, 0x58, 0x31, 0xc2, 0x51, 0xf6, 0x6e, 0x31, 0xf7, 0x95, 0x13, 0xd0, 0x59, 0xc3, 0xad, 0x3a, 0x33,
      0x3a, 0x40, 0x2b, 0x1d, 0xb9, 0x8,  0x0,  0xb,  0xd,  0x8d, 0x1b, 0xd7, 0x50, 0x54, 0x9a, 0xd8, 0x1f, 0x2a, 0x49,
      0x13, 0x3e, 0xc3, 0x8,  0x0,  0x19, 0x95, 0x3,  0xef, 0xe9, 0xf7, 0x1f, 0xba, 0xd3, 0x1d, 0xf,  0xc7, 0x1b, 0x9f,
      0xb8, 0xd4, 0xbb, 0xfd, 0x26, 0xe,  0xe,  0x11, 0x1c, 0xfd, 0x33, 0x7e, 0x8,  0x0,  0x5,  0x72, 0x70, 0x5f, 0xad,
      0xa2, 0x21, 0x4d, 0x63, 0x12, 0x0,  0x6,  0x1b, 0xa,  0xba, 0xde, 0x9f, 0x8b, 0x17, 0x9,  0x1f, 0x0,  0x1b, 0xd,
      0x42, 0x69, 0xea, 0xe3, 0x37, 0xf9, 0x4c, 0x4f, 0xec, 0x2a, 0xb6, 0x3e, 0x71, 0x52, 0x33, 0x93, 0x68, 0x29, 0xf5,
      0x6a, 0x30, 0x89, 0xf2, 0x41, 0x2a, 0x48, 0x11, 0x0,  0x0,  0x69, 0x7e, 0x15, 0x0,  0x12, 0x4c, 0xdb, 0x80, 0x57,
      0x90, 0x7d, 0x9e, 0xdd, 0x59, 0x2d, 0xca, 0xd2, 0x1,  0x31, 0xe6, 0x4f, 0x8,  0xc3, 0xb,  0x19, 0x1c, 0x0,  0x1b,
      0x76, 0x13, 0x9c, 0x6e, 0x69, 0x9a, 0xc1, 0x13, 0xe4, 0xb4, 0x9c, 0xc6, 0x4a, 0x2a, 0x42, 0xf9, 0xe9, 0x7f, 0x1d,
      0x91, 0x47, 0x85, 0x34, 0x8f, 0xeb, 0xc3, 0x86, 0x25, 0xa6, 0x25, 0xc6, 0x18, 0x0,  0x0,  0x5a, 0x82, 0xb,  0x17,
      0x24, 0x17, 0x16, 0x0,  0x3,  0xb6, 0x40, 0x29, 0x18, 0x0,  0x0,  0x1d, 0xb8, 0x29, 0x2f, 0x1f, 0x0,  0x3,  0x11,
      0xda, 0xb6, 0x27, 0x0,  0x0,  0x5,  0x60, 0x15, 0x0,  0x1e, 0x47, 0xd7, 0xc7, 0x26, 0x1a, 0x30, 0x10, 0xa0, 0xd9,
      0x9d, 0x3c, 0x75, 0xeb, 0x12, 0x7a, 0xae, 0xa6, 0x93, 0x79, 0x87, 0xbf, 0xf1, 0xc0, 0xff, 0x72, 0x45, 0xc1, 0xc4,
      0x5e, 0x34, 0x11, 0x0,  0x0,  0x37, 0xf9, 0x2a, 0x1f, 0x1f, 0x0,  0x1c, 0x59, 0xe0, 0xb7, 0x3a, 0xce, 0x52, 0x76,
      0xd7, 0xb7, 0xee, 0xa1, 0x63, 0xfe, 0xa9, 0x16, 0x66, 0x7b, 0x6e, 0x57, 0x33, 0x36, 0x97, 0xe,  0x1a, 0x32, 0x6a,
      0x7a, 0x4f, 0x23, 0x4e, 0x32, 0x0,  0x11, 0x73, 0x40, 0x22, 0x8c, 0x45, 0xcd, 0x1b, 0x62, 0xc1, 0xc8, 0x25, 0xad,
      0xce, 0x15, 0x29, 0x98, 0x73, 0xb4, 0x1,  0x17, 0xa7, 0x22, 0x15, 0x87, 0x1,  0x1d, 0x2,  0x0,  0x0,  0x75, 0x9c,
      0x26, 0x0,  0xe,  0xf0, 0x40, 0x37, 0x12, 0xb9, 0x16, 0xd3, 0x32, 0x58, 0xe2, 0x84, 0x8c, 0xfe, 0x13, 0x0,  0xd,
      0x81, 0x45, 0xc2, 0x78, 0x99, 0x89, 0xc8, 0xfb, 0x83, 0x3f, 0x44, 0xdc, 0x4b, 0x2,  0x0,  0x0,  0x10, 0xf0, 0x26,
      0x0,  0x14, 0xc7, 0xba, 0x70, 0x8d, 0x30, 0x5d, 0x81, 0x3f, 0xc1, 0xd,  0x0,  0xd9, 0xb6, 0xd8, 0xf8, 0x7,  0xd7,
      0x9,  0x91, 0xc7, 0x0,  0x1d, 0x1e, 0x13, 0xd3, 0x17, 0xae, 0x68, 0xf4, 0x5d, 0xa1, 0xf8, 0x63, 0xbe, 0xfa, 0x27,
      0xf2, 0x6d, 0x1d, 0x63, 0x90, 0x6e, 0x3f, 0x36, 0xc,  0xc0, 0x50, 0x3,  0xd0, 0xd0, 0x8b, 0x11, 0x0,  0x0,  0x1f,
      0x65, 0x18, 0x0,  0x0,  0x47, 0x7e, 0x1,  0xca, 0x1f, 0x0,  0x19, 0x75, 0x34, 0x93, 0xc3, 0x80, 0xdb, 0x2f, 0xfd,
      0x3a, 0xd4, 0xbe, 0x49, 0x6e, 0xbb, 0xc7, 0x6f, 0x1e, 0xa1, 0xe3, 0xd1, 0x4c, 0x62, 0x48, 0x91, 0x2b, 0x19, 0xc9,
      0x24, 0xaf, 0x29, 0xb2, 0x17, 0xef, 0x11, 0x0,  0x0,  0x20, 0xe8, 0x26, 0x0,  0x9,  0xdb, 0xf6, 0xa9, 0x78, 0x88,
      0xdb, 0xd4, 0xd3, 0xef, 0x0,  0xa,  0xc1, 0xb0, 0xc,  0xde, 0x66, 0x84, 0xbe, 0xb6, 0xa0, 0x44, 0x0,  0x7,  0xd4,
      0xc9, 0x18, 0x52, 0x7c, 0x70, 0xc7, 0x0,  0x1d, 0xab, 0xbc, 0x97, 0xef, 0x19, 0x23, 0x5b, 0x13, 0x19, 0xf,  0x31,
      0x46, 0x30, 0x86, 0x53, 0x38, 0xc3, 0x3a, 0x90, 0xcf, 0x1f, 0x18, 0x63, 0xd1, 0x3f, 0xd5, 0xbe, 0x40, 0xba, 0x0,
      0xa,  0x3,  0xa7, 0x2f, 0x10, 0x3f, 0x49, 0x7f, 0xd6, 0x54, 0x24, 0x0,  0xf,  0x1a, 0xb5, 0x76, 0xc,  0xe,  0x80,
      0xbc, 0xf5, 0x7f, 0x91, 0xb2, 0xe0, 0xf7, 0xa6, 0x38};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbd, 0x2c, 0x2f, 0xe4, 0x6a, 0xdf, 0x1a, 0x20,
                           0x99, 0x49, 0x48, 0x4a, 0x24, 0xbf, 0xf6, 0x66};
  uint8_t bytesprops1[] = {0x87, 0x83, 0x43, 0x4c, 0x58, 0x31, 0xc2, 0x51, 0xf6, 0x6e, 0x31, 0xf7, 0x95,
                           0x13, 0xd0, 0x59, 0xc3, 0xad, 0x3a, 0x33, 0x3a, 0x40, 0x2b, 0x1d, 0xb9};
  uint8_t bytesprops2[] = {0xd, 0x8d, 0x1b, 0xd7, 0x50, 0x54, 0x9a, 0xd8, 0x1f, 0x2a, 0x49};
  uint8_t bytesprops3[] = {0x95, 0x3,  0xef, 0xe9, 0xf7, 0x1f, 0xba, 0xd3, 0x1d, 0xf,  0xc7, 0x1b, 0x9f,
                           0xb8, 0xd4, 0xbb, 0xfd, 0x26, 0xe,  0xe,  0x11, 0x1c, 0xfd, 0x33, 0x7e};
  uint8_t bytesprops4[] = {0x72, 0x70, 0x5f, 0xad, 0xa2};
  uint8_t bytesprops5[] = {0x1b, 0xa, 0xba, 0xde, 0x9f, 0x8b};
  uint8_t bytesprops6[] = {0xd,  0x42, 0x69, 0xea, 0xe3, 0x37, 0xf9, 0x4c, 0x4f, 0xec, 0x2a, 0xb6, 0x3e, 0x71,
                           0x52, 0x33, 0x93, 0x68, 0x29, 0xf5, 0x6a, 0x30, 0x89, 0xf2, 0x41, 0x2a, 0x48};
  uint8_t bytesprops7[] = {0x4c, 0xdb, 0x80, 0x57, 0x90, 0x7d, 0x9e, 0xdd, 0x59,
                           0x2d, 0xca, 0xd2, 0x1,  0x31, 0xe6, 0x4f, 0x8,  0xc3};
  uint8_t bytesprops8[] = {0x76, 0x13, 0x9c, 0x6e, 0x69, 0x9a, 0xc1, 0x13, 0xe4, 0xb4, 0x9c, 0xc6, 0x4a, 0x2a,
                           0x42, 0xf9, 0xe9, 0x7f, 0x1d, 0x91, 0x47, 0x85, 0x34, 0x8f, 0xeb, 0xc3, 0x86};
  uint8_t bytesprops9[] = {0xb6, 0x40, 0x29};
  uint8_t bytesprops10[] = {0x11, 0xda, 0xb6};
  uint8_t bytesprops11[] = {0x47, 0xd7, 0xc7, 0x26, 0x1a, 0x30, 0x10, 0xa0, 0xd9, 0x9d, 0x3c, 0x75, 0xeb, 0x12, 0x7a,
                            0xae, 0xa6, 0x93, 0x79, 0x87, 0xbf, 0xf1, 0xc0, 0xff, 0x72, 0x45, 0xc1, 0xc4, 0x5e, 0x34};
  uint8_t bytesprops12[] = {0x59, 0xe0, 0xb7, 0x3a, 0xce, 0x52, 0x76, 0xd7, 0xb7, 0xee, 0xa1, 0x63, 0xfe, 0xa9,
                            0x16, 0x66, 0x7b, 0x6e, 0x57, 0x33, 0x36, 0x97, 0xe,  0x1a, 0x32, 0x6a, 0x7a, 0x4f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16067}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19811}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27006}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23170}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7608}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1376}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14329}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20018}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x81, 0x45, 0xc2, 0x78, 0x99, 0x89, 0xc8, 0xfb, 0x83, 0x3f, 0x44, 0xdc, 0x4b};
  uint8_t byteswillprops0[] = {0xf0, 0x40, 0x37, 0x12, 0xb9, 0x16, 0xd3, 0x32, 0x58, 0xe2, 0x84, 0x8c, 0xfe, 0x13};
  uint8_t byteswillprops3[] = {0x1e, 0x13, 0xd3, 0x17, 0xae, 0x68, 0xf4, 0x5d, 0xa1, 0xf8, 0x63, 0xbe, 0xfa, 0x27, 0xf2,
                               0x6d, 0x1d, 0x63, 0x90, 0x6e, 0x3f, 0x36, 0xc,  0xc0, 0x50, 0x3,  0xd0, 0xd0, 0x8b};
  uint8_t byteswillprops2[] = {0xc7, 0xba, 0x70, 0x8d, 0x30, 0x5d, 0x81, 0x3f, 0xc1, 0xd,
                               0x0,  0xd9, 0xb6, 0xd8, 0xf8, 0x7,  0xd7, 0x9,  0x91, 0xc7};
  uint8_t byteswillprops4[] = {0x75, 0x34, 0x93, 0xc3, 0x80, 0xdb, 0x2f, 0xfd, 0x3a, 0xd4, 0xbe, 0x49, 0x6e,
                               0xbb, 0xc7, 0x6f, 0x1e, 0xa1, 0xe3, 0xd1, 0x4c, 0x62, 0x48, 0x91, 0x2b};
  uint8_t byteswillprops6[] = {0xc1, 0xb0, 0xc, 0xde, 0x66, 0x84, 0xbe, 0xb6, 0xa0, 0x44};
  uint8_t byteswillprops5[] = {0xdb, 0xf6, 0xa9, 0x78, 0x88, 0xdb, 0xd4, 0xd3, 0xef};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5511}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30108}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops0}, .v = {13, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4336}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops2}, .v = {29, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8037}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18302}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8424}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops5}, .v = {10, (char*)&byteswillprops6}}}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd4, 0xc9, 0x18, 0x52, 0x7c, 0x70, 0xc7};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xab, 0xbc, 0x97, 0xef, 0x19, 0x23, 0x5b, 0x13, 0x19, 0xf,
                                  0x31, 0x46, 0x30, 0x86, 0x53, 0x38, 0xc3, 0x3a, 0x90, 0xcf,
                                  0x1f, 0x18, 0x63, 0xd1, 0x3f, 0xd5, 0xbe, 0x40, 0xba};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14165;
  uint8_t client_id_bytes[] = {0x73, 0x40, 0x22, 0x8c, 0x45, 0xcd, 0x1b, 0x62, 0xc1,
                               0xc8, 0x25, 0xad, 0xce, 0x15, 0x29, 0x98, 0x73};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3, 0xa7, 0x2f, 0x10, 0x3f, 0x49, 0x7f, 0xd6, 0x54, 0x24};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1a, 0xb5, 0x76, 0xc, 0xe, 0x80, 0xbc, 0xf5, 0x7f, 0x91, 0xb2, 0xe0, 0xf7, 0xa6, 0x38};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\223\&2\199@j\160\253\250\206\223!\137Hi\230\SUB`\181\222",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\217", _willMsg = "D~6I\EOT\181",
// _willProps = [PropPayloadFormatIndicator 156,PropRequestResponseInformation 77,PropServerKeepAlive
// 3956,PropTopicAlias 28656,PropRequestProblemInformation 102,PropRequestResponseInformation 170,PropTopicAlias
// 4936,PropMaximumQoS 205,PropRequestProblemInformation 59,PropSessionExpiryInterval 20589,PropMaximumQoS
// 111,PropReceiveMaximum 32392,PropSharedSubscriptionAvailable 15,PropMessageExpiryInterval
// 30902,PropAuthenticationData "\168\\\144\255+ Aj\222\198\226X\159\179\136",PropMessageExpiryInterval
// 8553,PropUserProperty "b\154\f\251{a\149"
// "\206a\161\169\253V\US\155y\177\194\214\149b\128\215\195\150\179\171",PropAuthenticationMethod
// "kg\233\ETX\139\ESC\169\190v\172\t\n|\224 ",PropMessageExpiryInterval 26952,PropMessageExpiryInterval
// 3730,PropWillDelayInterval 28842,PropMaximumPacketSize 10225,PropRequestProblemInformation
// 149,PropResponseInformation "R_\NAK\215\206Y\146N\178\179\nvF6L "]}), _cleanSession = False, _keepAlive = 27312,
// _connID = "\179\202\212\v\189N", _properties = [PropSubscriptionIdentifierAvailable 169,PropContentType
// "\193\145\202\244\141}A\CAN\252~9\189\&1",PropSubscriptionIdentifier 19]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xe1, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x6a, 0xb0, 0x14, 0x29, 0xa9, 0x3,  0x0,  0xd,
      0xc1, 0x91, 0xca, 0xf4, 0x8d, 0x7d, 0x41, 0x18, 0xfc, 0x7e, 0x39, 0xbd, 0x31, 0xb,  0x13, 0x0,  0x6,  0xb3, 0xca,
      0xd4, 0xb,  0xbd, 0x4e, 0x98, 0x1,  0x1,  0x9c, 0x19, 0x4d, 0x13, 0xf,  0x74, 0x23, 0x6f, 0xf0, 0x17, 0x66, 0x19,
      0xaa, 0x23, 0x13, 0x48, 0x24, 0xcd, 0x17, 0x3b, 0x11, 0x0,  0x0,  0x50, 0x6d, 0x24, 0x6f, 0x21, 0x7e, 0x88, 0x2a,
      0xf,  0x2,  0x0,  0x0,  0x78, 0xb6, 0x16, 0x0,  0xf,  0xa8, 0x5c, 0x90, 0xff, 0x2b, 0x20, 0x41, 0x6a, 0xde, 0xc6,
      0xe2, 0x58, 0x9f, 0xb3, 0x88, 0x2,  0x0,  0x0,  0x21, 0x69, 0x26, 0x0,  0x7,  0x62, 0x9a, 0xc,  0xfb, 0x7b, 0x61,
      0x95, 0x0,  0x14, 0xce, 0x61, 0xa1, 0xa9, 0xfd, 0x56, 0x1f, 0x9b, 0x79, 0xb1, 0xc2, 0xd6, 0x95, 0x62, 0x80, 0xd7,
      0xc3, 0x96, 0xb3, 0xab, 0x15, 0x0,  0xf,  0x6b, 0x67, 0xe9, 0x3,  0x8b, 0x1b, 0xa9, 0xbe, 0x76, 0xac, 0x9,  0xa,
      0x7c, 0xe0, 0x20, 0x2,  0x0,  0x0,  0x69, 0x48, 0x2,  0x0,  0x0,  0xe,  0x92, 0x18, 0x0,  0x0,  0x70, 0xaa, 0x27,
      0x0,  0x0,  0x27, 0xf1, 0x17, 0x95, 0x1a, 0x0,  0x10, 0x52, 0x5f, 0x15, 0xd7, 0xce, 0x59, 0x92, 0x4e, 0xb2, 0xb3,
      0xa,  0x76, 0x46, 0x36, 0x4c, 0x20, 0x0,  0x1,  0xd9, 0x0,  0x6,  0x44, 0x7e, 0x36, 0x49, 0x4,  0xb5, 0x0,  0x13,
      0xdf, 0x32, 0xc7, 0x40, 0x6a, 0xa0, 0xfd, 0xfa, 0xce, 0xdf, 0x21, 0x89, 0x48, 0x69, 0xe6, 0x1a, 0x60, 0xb5, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc1, 0x91, 0xca, 0xf4, 0x8d, 0x7d, 0x41, 0x18, 0xfc, 0x7e, 0x39, 0xbd, 0x31};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa8, 0x5c, 0x90, 0xff, 0x2b, 0x20, 0x41, 0x6a,
                               0xde, 0xc6, 0xe2, 0x58, 0x9f, 0xb3, 0x88};
  uint8_t byteswillprops2[] = {0xce, 0x61, 0xa1, 0xa9, 0xfd, 0x56, 0x1f, 0x9b, 0x79, 0xb1,
                               0xc2, 0xd6, 0x95, 0x62, 0x80, 0xd7, 0xc3, 0x96, 0xb3, 0xab};
  uint8_t byteswillprops1[] = {0x62, 0x9a, 0xc, 0xfb, 0x7b, 0x61, 0x95};
  uint8_t byteswillprops3[] = {0x6b, 0x67, 0xe9, 0x3, 0x8b, 0x1b, 0xa9, 0xbe, 0x76, 0xac, 0x9, 0xa, 0x7c, 0xe0, 0x20};
  uint8_t byteswillprops4[] = {0x52, 0x5f, 0x15, 0xd7, 0xce, 0x59, 0x92, 0x4e,
                               0xb2, 0xb3, 0xa,  0x76, 0x46, 0x36, 0x4c, 0x20};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3956}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28656}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4936}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20589}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32392}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30902}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8553}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops1}, .v = {20, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26952}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3730}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28842}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10225}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0x7e, 0x36, 0x49, 0x4, 0xb5};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27312;
  uint8_t client_id_bytes[] = {0xb3, 0xca, 0xd4, 0xb, 0xbd, 0x4e};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xdf, 0x32, 0xc7, 0x40, 0x6a, 0xa0, 0xfd, 0xfa, 0xce, 0xdf,
                              0x21, 0x89, 0x48, 0x69, 0xe6, 0x1a, 0x60, 0xb5, 0xde};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\EMS\165f>\192\196\FS\155\179\128]\225\223\DLE\151e@\159h\136\238\221\&9\205\DEL", _willMsg =
// "\DLE\ETB\v\131b\241\161<\217", _willProps = [PropRequestProblemInformation 76,PropMaximumPacketSize
// 30952,PropCorrelationData "\142a\227G\135\166\150\DEL",PropReceiveMaximum 21637,PropSubscriptionIdentifier
// 11,PropResponseInformation "",PropReceiveMaximum 31926,PropAssignedClientIdentifier
// "Q\192t5f8\150hL\DC4\NUL",PropWildcardSubscriptionAvailable 176,PropReasonString
// "\162\136\ETX\r6\209\168'\DC2jB\162\188\n\195\206\196\&7\139\187",PropAuthenticationMethod
// "\DC4\t@\FS1\149\214H\189;x\156X\188c\155q\135",PropTopicAliasMaximum 429,PropAuthenticationData "\158
// v\176\180\142\&1t\235\EOTV",PropAuthenticationMethod
// "#\223F\164\187\157\229\204A\239\&3\SOH\237^1j\151}@\149\230=W\252\159]\fe",PropPayloadFormatIndicator
// 119,PropReceiveMaximum 32265,PropAuthenticationMethod
// "2\241\&8\ACK9\SOH\163q\220\165uY\160\220\164p\157M\207\221\227/o\204\156",PropSharedSubscriptionAvailable
// 14,PropUserProperty "!\199\171P\DLE\GS\201\SUBE\150\246\&4"
// "^\132\233\156\US@j`\139\142#\150\232/\142B\DC3q`h\131",PropAuthenticationMethod "\US\192~Y",PropServerReference
// ")\\%\169~\137\170\223\159\ESC\194\196\226&\171Z",PropWillDelayInterval 680,PropMaximumQoS
// 48,PropRequestProblemInformation 159,PropServerReference
// "\139\DC3<#\238\149\159>\GS\226+j[\205\153\178S-\232\247\132O\231\STX\ACK\160\255\132\181\241",PropSubscriptionIdentifier
// 19,PropResponseInformation "=&\220\143\255\245\a\231",PropMaximumPacketSize 23158,PropResponseInformation
// "\232\246jr\aGG\166f+G\131Q\196!\249\vV"]}), _cleanSession = True, _keepAlive = 20507, _connID =
// "-\202\240\v`\SOH\255oj\230\172\EM\212J", _properties = [PropRetainAvailable 201,PropSubscriptionIdentifierAvailable
// 131,PropMessageExpiryInterval 20159,PropWillDelayInterval 18712,PropCorrelationData
// "\202\205\170X\211\248W:\203\RS\221\134\163o\252L\156G\171_B\234\165D\n\240",PropWillDelayInterval
// 21003,PropPayloadFormatIndicator 66,PropAuthenticationData
// "$T\159\193\130H(\\\180\190u\DC4H$\173ncj\249d\195>\225n\247W4\165\130\154",PropMaximumPacketSize 28012]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0xd9, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x50, 0x1b, 0x58, 0x25, 0xc9, 0x29, 0x83, 0x2,
      0x0,  0x0,  0x4e, 0xbf, 0x18, 0x0,  0x0,  0x49, 0x18, 0x9,  0x0,  0x1a, 0xca, 0xcd, 0xaa, 0x58, 0xd3, 0xf8, 0x57,
      0x3a, 0xcb, 0x1e, 0xdd, 0x86, 0xa3, 0x6f, 0xfc, 0x4c, 0x9c, 0x47, 0xab, 0x5f, 0x42, 0xea, 0xa5, 0x44, 0xa,  0xf0,
      0x18, 0x0,  0x0,  0x52, 0xb,  0x1,  0x42, 0x16, 0x0,  0x1e, 0x24, 0x54, 0x9f, 0xc1, 0x82, 0x48, 0x28, 0x5c, 0xb4,
      0xbe, 0x75, 0x14, 0x48, 0x24, 0xad, 0x6e, 0x63, 0x6a, 0xf9, 0x64, 0xc3, 0x3e, 0xe1, 0x6e, 0xf7, 0x57, 0x34, 0xa5,
      0x82, 0x9a, 0x27, 0x0,  0x0,  0x6d, 0x6c, 0x0,  0xe,  0x2d, 0xca, 0xf0, 0xb,  0x60, 0x1,  0xff, 0x6f, 0x6a, 0xe6,
      0xac, 0x19, 0xd4, 0x4a, 0xbd, 0x2,  0x17, 0x4c, 0x27, 0x0,  0x0,  0x78, 0xe8, 0x9,  0x0,  0x8,  0x8e, 0x61, 0xe3,
      0x47, 0x87, 0xa6, 0x96, 0x7f, 0x21, 0x54, 0x85, 0xb,  0xb,  0x1a, 0x0,  0x0,  0x21, 0x7c, 0xb6, 0x12, 0x0,  0xb,
      0x51, 0xc0, 0x74, 0x35, 0x66, 0x38, 0x96, 0x68, 0x4c, 0x14, 0x0,  0x28, 0xb0, 0x1f, 0x0,  0x14, 0xa2, 0x88, 0x3,
      0xd,  0x36, 0xd1, 0xa8, 0x27, 0x12, 0x6a, 0x42, 0xa2, 0xbc, 0xa,  0xc3, 0xce, 0xc4, 0x37, 0x8b, 0xbb, 0x15, 0x0,
      0x12, 0x14, 0x9,  0x40, 0x1c, 0x31, 0x95, 0xd6, 0x48, 0xbd, 0x3b, 0x78, 0x9c, 0x58, 0xbc, 0x63, 0x9b, 0x71, 0x87,
      0x22, 0x1,  0xad, 0x16, 0x0,  0xb,  0x9e, 0x20, 0x76, 0xb0, 0xb4, 0x8e, 0x31, 0x74, 0xeb, 0x4,  0x56, 0x15, 0x0,
      0x1c, 0x23, 0xdf, 0x46, 0xa4, 0xbb, 0x9d, 0xe5, 0xcc, 0x41, 0xef, 0x33, 0x1,  0xed, 0x5e, 0x31, 0x6a, 0x97, 0x7d,
      0x40, 0x95, 0xe6, 0x3d, 0x57, 0xfc, 0x9f, 0x5d, 0xc,  0x65, 0x1,  0x77, 0x21, 0x7e, 0x9,  0x15, 0x0,  0x19, 0x32,
      0xf1, 0x38, 0x6,  0x39, 0x1,  0xa3, 0x71, 0xdc, 0xa5, 0x75, 0x59, 0xa0, 0xdc, 0xa4, 0x70, 0x9d, 0x4d, 0xcf, 0xdd,
      0xe3, 0x2f, 0x6f, 0xcc, 0x9c, 0x2a, 0xe,  0x26, 0x0,  0xc,  0x21, 0xc7, 0xab, 0x50, 0x10, 0x1d, 0xc9, 0x1a, 0x45,
      0x96, 0xf6, 0x34, 0x0,  0x15, 0x5e, 0x84, 0xe9, 0x9c, 0x1f, 0x40, 0x6a, 0x60, 0x8b, 0x8e, 0x23, 0x96, 0xe8, 0x2f,
      0x8e, 0x42, 0x13, 0x71, 0x60, 0x68, 0x83, 0x15, 0x0,  0x4,  0x1f, 0xc0, 0x7e, 0x59, 0x1c, 0x0,  0x10, 0x29, 0x5c,
      0x25, 0xa9, 0x7e, 0x89, 0xaa, 0xdf, 0x9f, 0x1b, 0xc2, 0xc4, 0xe2, 0x26, 0xab, 0x5a, 0x18, 0x0,  0x0,  0x2,  0xa8,
      0x24, 0x30, 0x17, 0x9f, 0x1c, 0x0,  0x1e, 0x8b, 0x13, 0x3c, 0x23, 0xee, 0x95, 0x9f, 0x3e, 0x1d, 0xe2, 0x2b, 0x6a,
      0x5b, 0xcd, 0x99, 0xb2, 0x53, 0x2d, 0xe8, 0xf7, 0x84, 0x4f, 0xe7, 0x2,  0x6,  0xa0, 0xff, 0x84, 0xb5, 0xf1, 0xb,
      0x13, 0x1a, 0x0,  0x8,  0x3d, 0x26, 0xdc, 0x8f, 0xff, 0xf5, 0x7,  0xe7, 0x27, 0x0,  0x0,  0x5a, 0x76, 0x1a, 0x0,
      0x12, 0xe8, 0xf6, 0x6a, 0x72, 0x7,  0x47, 0x47, 0xa6, 0x66, 0x2b, 0x47, 0x83, 0x51, 0xc4, 0x21, 0xf9, 0xb,  0x56,
      0x0,  0x1a, 0x19, 0x53, 0xa5, 0x66, 0x3e, 0xc0, 0xc4, 0x1c, 0x9b, 0xb3, 0x80, 0x5d, 0xe1, 0xdf, 0x10, 0x97, 0x65,
      0x40, 0x9f, 0x68, 0x88, 0xee, 0xdd, 0x39, 0xcd, 0x7f, 0x0,  0x9,  0x10, 0x17, 0xb,  0x83, 0x62, 0xf1, 0xa1, 0x3c,
      0xd9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xca, 0xcd, 0xaa, 0x58, 0xd3, 0xf8, 0x57, 0x3a, 0xcb, 0x1e, 0xdd, 0x86, 0xa3,
                           0x6f, 0xfc, 0x4c, 0x9c, 0x47, 0xab, 0x5f, 0x42, 0xea, 0xa5, 0x44, 0xa,  0xf0};
  uint8_t bytesprops1[] = {0x24, 0x54, 0x9f, 0xc1, 0x82, 0x48, 0x28, 0x5c, 0xb4, 0xbe, 0x75, 0x14, 0x48, 0x24, 0xad,
                           0x6e, 0x63, 0x6a, 0xf9, 0x64, 0xc3, 0x3e, 0xe1, 0x6e, 0xf7, 0x57, 0x34, 0xa5, 0x82, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20159}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18712}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21003}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28012}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8e, 0x61, 0xe3, 0x47, 0x87, 0xa6, 0x96, 0x7f};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0x51, 0xc0, 0x74, 0x35, 0x66, 0x38, 0x96, 0x68, 0x4c, 0x14, 0x0};
  uint8_t byteswillprops3[] = {0xa2, 0x88, 0x3,  0xd, 0x36, 0xd1, 0xa8, 0x27, 0x12, 0x6a,
                               0x42, 0xa2, 0xbc, 0xa, 0xc3, 0xce, 0xc4, 0x37, 0x8b, 0xbb};
  uint8_t byteswillprops4[] = {0x14, 0x9,  0x40, 0x1c, 0x31, 0x95, 0xd6, 0x48, 0xbd,
                               0x3b, 0x78, 0x9c, 0x58, 0xbc, 0x63, 0x9b, 0x71, 0x87};
  uint8_t byteswillprops5[] = {0x9e, 0x20, 0x76, 0xb0, 0xb4, 0x8e, 0x31, 0x74, 0xeb, 0x4, 0x56};
  uint8_t byteswillprops6[] = {0x23, 0xdf, 0x46, 0xa4, 0xbb, 0x9d, 0xe5, 0xcc, 0x41, 0xef, 0x33, 0x1,  0xed, 0x5e,
                               0x31, 0x6a, 0x97, 0x7d, 0x40, 0x95, 0xe6, 0x3d, 0x57, 0xfc, 0x9f, 0x5d, 0xc,  0x65};
  uint8_t byteswillprops7[] = {0x32, 0xf1, 0x38, 0x6,  0x39, 0x1,  0xa3, 0x71, 0xdc, 0xa5, 0x75, 0x59, 0xa0,
                               0xdc, 0xa4, 0x70, 0x9d, 0x4d, 0xcf, 0xdd, 0xe3, 0x2f, 0x6f, 0xcc, 0x9c};
  uint8_t byteswillprops9[] = {0x5e, 0x84, 0xe9, 0x9c, 0x1f, 0x40, 0x6a, 0x60, 0x8b, 0x8e, 0x23,
                               0x96, 0xe8, 0x2f, 0x8e, 0x42, 0x13, 0x71, 0x60, 0x68, 0x83};
  uint8_t byteswillprops8[] = {0x21, 0xc7, 0xab, 0x50, 0x10, 0x1d, 0xc9, 0x1a, 0x45, 0x96, 0xf6, 0x34};
  uint8_t byteswillprops10[] = {0x1f, 0xc0, 0x7e, 0x59};
  uint8_t byteswillprops11[] = {0x29, 0x5c, 0x25, 0xa9, 0x7e, 0x89, 0xaa, 0xdf,
                                0x9f, 0x1b, 0xc2, 0xc4, 0xe2, 0x26, 0xab, 0x5a};
  uint8_t byteswillprops12[] = {0x8b, 0x13, 0x3c, 0x23, 0xee, 0x95, 0x9f, 0x3e, 0x1d, 0xe2,
                                0x2b, 0x6a, 0x5b, 0xcd, 0x99, 0xb2, 0x53, 0x2d, 0xe8, 0xf7,
                                0x84, 0x4f, 0xe7, 0x2,  0x6,  0xa0, 0xff, 0x84, 0xb5, 0xf1};
  uint8_t byteswillprops13[] = {0x3d, 0x26, 0xdc, 0x8f, 0xff, 0xf5, 0x7, 0xe7};
  uint8_t byteswillprops14[] = {0xe8, 0xf6, 0x6a, 0x72, 0x7,  0x47, 0x47, 0xa6, 0x66,
                                0x2b, 0x47, 0x83, 0x51, 0xc4, 0x21, 0xf9, 0xb,  0x56};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30952}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21637}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31926}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 429}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32265}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {12, (char*)&byteswillprops8}, .v = {21, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 680}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23158}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops14}}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x19, 0x53, 0xa5, 0x66, 0x3e, 0xc0, 0xc4, 0x1c, 0x9b, 0xb3, 0x80, 0x5d, 0xe1,
                                0xdf, 0x10, 0x97, 0x65, 0x40, 0x9f, 0x68, 0x88, 0xee, 0xdd, 0x39, 0xcd, 0x7f};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x10, 0x17, 0xb, 0x83, 0x62, 0xf1, 0xa1, 0x3c, 0xd9};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20507;
  uint8_t client_id_bytes[] = {0x2d, 0xca, 0xf0, 0xb, 0x60, 0x1, 0xff, 0x6f, 0x6a, 0xe6, 0xac, 0x19, 0xd4, 0x4a};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\207\218?<\130\251\SI\189E\184\US\216$Z{?\252|\252", _password = Just
// "\184b#\224}]\DC4\210", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "J=\ESCG\249
// t\STX\247m\RS\147\RS\157\225K\NUL\148G\203", _willMsg =
// "q\155\"+\180\161,\176\&9D\251\159!\164(|\235\247\178\213p\208\"\199~%X\226\251", _willProps =
// [PropWildcardSubscriptionAvailable 149,PropResponseInformation
// "\DEL\135\&4\218\224\228\235r@)\209\225\140\144UGV\217\142T\vq\216W\156\177\231",PropReasonString
// "\231\135\DLER\239n7\b\219P\250d>\141\152\STX\163",PropSubscriptionIdentifier 8,PropMaximumQoS
// 227,PropCorrelationData "\239:L}\DC4)\233\EOT",PropTopicAlias 31130,PropSharedSubscriptionAvailable
// 221,PropMessageExpiryInterval 22834,PropAuthenticationMethod "&o\138*\229\249-\v\191",PropMaximumPacketSize
// 32076,PropContentType "D\229[*i",PropAuthenticationData
// "4\218\191\172'-\\\131\RS\192\133c\254",PropSessionExpiryInterval 14123,PropSharedSubscriptionAvailable
// 84,PropAssignedClientIdentifier "",PropSubscriptionIdentifier 6,PropMessageExpiryInterval 30788,PropCorrelationData
// "\148\v@\246\151\144\&3\141\162",PropMaximumQoS 199,PropWillDelayInterval 7016,PropWillDelayInterval
// 16814,PropWillDelayInterval 24150,PropAssignedClientIdentifier
// "\vAD\RSI\254\179\142\128\205ix\191\NUL\130u\235\150/l\GSq",PropSharedSubscriptionAvailable
// 8,PropAssignedClientIdentifier "U\GS;\DC2\207",PropAuthenticationData "\DEL\209\FS",PropServerKeepAlive 24347]}),
// _cleanSession = False, _keepAlive = 8484, _connID = "\219\138\191|*\231\ACK\191WZCrWZ\r\ETXLA\247|6", _properties =
// [PropAuthenticationData "T6_m\148\177\CANP\ETB\191[\213\162\129\175\164!\DC1NM\b\248\ETX[9\181\181",PropMaximumQoS
// 18,PropUserProperty "\211\172K\174p3\STXf6\214\DC35\204\145"
// "(k'\160;k\158\199\238\186K\255\161\222\172\tNh\146*\147U\200N",PropMessageExpiryInterval
// 9906,PropAuthenticationMethod "d\184\180\131\255V\255\163\237;",PropTopicAliasMaximum 4996,PropCorrelationData
// "\253\177(\194\221u\n\145\145a\196;\193\231\173\200\143\194\225\155\194\145e\244T",PropAssignedClientIdentifier
// "t",PropReasonString "\224\EOT\220\199\223]\r\158\130\229\163\243\199\188\165\242qs",PropMaximumQoS
// 198,PropTopicAlias 9276,PropResponseInformation "\203\143\173\179\233\209\131d",PropServerReference
// "\230.\145\fd8=\253x\140\SOH\137\233\199\238\206\&9\164\216-@\144",PropMessageExpiryInterval
// 10006,PropSessionExpiryInterval 2484,PropReasonString
// "o\b}\156\167\185\196T\222b\STX8T\201\170\146Ql",PropMessageExpiryInterval 16834,PropReceiveMaximum
// 26987,PropSubscriptionIdentifierAvailable 169,PropWildcardSubscriptionAvailable 38,PropAuthenticationMethod
// "|\137",PropCorrelationData
// "\147b{\233\235\149\219\183\213\SYN\172\174\EM\176y\130\160\199w\254]W'\229sb\170\&1\201v",PropRequestResponseInformation
// 78]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xda, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x21, 0x24, 0x91, 0x2,  0x16, 0x0,  0x1b, 0x54,
      0x36, 0x5f, 0x6d, 0x94, 0xb1, 0x18, 0x50, 0x17, 0xbf, 0x5b, 0xd5, 0xa2, 0x81, 0xaf, 0xa4, 0x21, 0x11, 0x4e, 0x4d,
      0x8,  0xf8, 0x3,  0x5b, 0x39, 0xb5, 0xb5, 0x24, 0x12, 0x26, 0x0,  0xe,  0xd3, 0xac, 0x4b, 0xae, 0x70, 0x33, 0x2,
      0x66, 0x36, 0xd6, 0x13, 0x35, 0xcc, 0x91, 0x0,  0x18, 0x28, 0x6b, 0x27, 0xa0, 0x3b, 0x6b, 0x9e, 0xc7, 0xee, 0xba,
      0x4b, 0xff, 0xa1, 0xde, 0xac, 0x9,  0x4e, 0x68, 0x92, 0x2a, 0x93, 0x55, 0xc8, 0x4e, 0x2,  0x0,  0x0,  0x26, 0xb2,
      0x15, 0x0,  0xa,  0x64, 0xb8, 0xb4, 0x83, 0xff, 0x56, 0xff, 0xa3, 0xed, 0x3b, 0x22, 0x13, 0x84, 0x9,  0x0,  0x19,
      0xfd, 0xb1, 0x28, 0xc2, 0xdd, 0x75, 0xa,  0x91, 0x91, 0x61, 0xc4, 0x3b, 0xc1, 0xe7, 0xad, 0xc8, 0x8f, 0xc2, 0xe1,
      0x9b, 0xc2, 0x91, 0x65, 0xf4, 0x54, 0x12, 0x0,  0x1,  0x74, 0x1f, 0x0,  0x12, 0xe0, 0x4,  0xdc, 0xc7, 0xdf, 0x5d,
      0xd,  0x9e, 0x82, 0xe5, 0xa3, 0xf3, 0xc7, 0xbc, 0xa5, 0xf2, 0x71, 0x73, 0x24, 0xc6, 0x23, 0x24, 0x3c, 0x1a, 0x0,
      0x8,  0xcb, 0x8f, 0xad, 0xb3, 0xe9, 0xd1, 0x83, 0x64, 0x1c, 0x0,  0x16, 0xe6, 0x2e, 0x91, 0xc,  0x64, 0x38, 0x3d,
      0xfd, 0x78, 0x8c, 0x1,  0x89, 0xe9, 0xc7, 0xee, 0xce, 0x39, 0xa4, 0xd8, 0x2d, 0x40, 0x90, 0x2,  0x0,  0x0,  0x27,
      0x16, 0x11, 0x0,  0x0,  0x9,  0xb4, 0x1f, 0x0,  0x12, 0x6f, 0x8,  0x7d, 0x9c, 0xa7, 0xb9, 0xc4, 0x54, 0xde, 0x62,
      0x2,  0x38, 0x54, 0xc9, 0xaa, 0x92, 0x51, 0x6c, 0x2,  0x0,  0x0,  0x41, 0xc2, 0x21, 0x69, 0x6b, 0x29, 0xa9, 0x28,
      0x26, 0x15, 0x0,  0x2,  0x7c, 0x89, 0x9,  0x0,  0x1e, 0x93, 0x62, 0x7b, 0xe9, 0xeb, 0x95, 0xdb, 0xb7, 0xd5, 0x16,
      0xac, 0xae, 0x19, 0xb0, 0x79, 0x82, 0xa0, 0xc7, 0x77, 0xfe, 0x5d, 0x57, 0x27, 0xe5, 0x73, 0x62, 0xaa, 0x31, 0xc9,
      0x76, 0x19, 0x4e, 0x0,  0x15, 0xdb, 0x8a, 0xbf, 0x7c, 0x2a, 0xe7, 0x6,  0xbf, 0x57, 0x5a, 0x43, 0x72, 0x57, 0x5a,
      0xd,  0x3,  0x4c, 0x41, 0xf7, 0x7c, 0x36, 0xd0, 0x1,  0x28, 0x95, 0x1a, 0x0,  0x1b, 0x7f, 0x87, 0x34, 0xda, 0xe0,
      0xe4, 0xeb, 0x72, 0x40, 0x29, 0xd1, 0xe1, 0x8c, 0x90, 0x55, 0x47, 0x56, 0xd9, 0x8e, 0x54, 0xb,  0x71, 0xd8, 0x57,
      0x9c, 0xb1, 0xe7, 0x1f, 0x0,  0x11, 0xe7, 0x87, 0x10, 0x52, 0xef, 0x6e, 0x37, 0x8,  0xdb, 0x50, 0xfa, 0x64, 0x3e,
      0x8d, 0x98, 0x2,  0xa3, 0xb,  0x8,  0x24, 0xe3, 0x9,  0x0,  0x8,  0xef, 0x3a, 0x4c, 0x7d, 0x14, 0x29, 0xe9, 0x4,
      0x23, 0x79, 0x9a, 0x2a, 0xdd, 0x2,  0x0,  0x0,  0x59, 0x32, 0x15, 0x0,  0x9,  0x26, 0x6f, 0x8a, 0x2a, 0xe5, 0xf9,
      0x2d, 0xb,  0xbf, 0x27, 0x0,  0x0,  0x7d, 0x4c, 0x3,  0x0,  0x5,  0x44, 0xe5, 0x5b, 0x2a, 0x69, 0x16, 0x0,  0xd,
      0x34, 0xda, 0xbf, 0xac, 0x27, 0x2d, 0x5c, 0x83, 0x1e, 0xc0, 0x85, 0x63, 0xfe, 0x11, 0x0,  0x0,  0x37, 0x2b, 0x2a,
      0x54, 0x12, 0x0,  0x0,  0xb,  0x6,  0x2,  0x0,  0x0,  0x78, 0x44, 0x9,  0x0,  0x9,  0x94, 0xb,  0x40, 0xf6, 0x97,
      0x90, 0x33, 0x8d, 0xa2, 0x24, 0xc7, 0x18, 0x0,  0x0,  0x1b, 0x68, 0x18, 0x0,  0x0,  0x41, 0xae, 0x18, 0x0,  0x0,
      0x5e, 0x56, 0x12, 0x0,  0x16, 0xb,  0x41, 0x44, 0x1e, 0x49, 0xfe, 0xb3, 0x8e, 0x80, 0xcd, 0x69, 0x78, 0xbf, 0x0,
      0x82, 0x75, 0xeb, 0x96, 0x2f, 0x6c, 0x1d, 0x71, 0x2a, 0x8,  0x12, 0x0,  0x5,  0x55, 0x1d, 0x3b, 0x12, 0xcf, 0x16,
      0x0,  0x3,  0x7f, 0xd1, 0x1c, 0x13, 0x5f, 0x1b, 0x0,  0x14, 0x4a, 0x3d, 0x1b, 0x47, 0xf9, 0x20, 0x74, 0x2,  0xf7,
      0x6d, 0x1e, 0x93, 0x1e, 0x9d, 0xe1, 0x4b, 0x0,  0x94, 0x47, 0xcb, 0x0,  0x1d, 0x71, 0x9b, 0x22, 0x2b, 0xb4, 0xa1,
      0x2c, 0xb0, 0x39, 0x44, 0xfb, 0x9f, 0x21, 0xa4, 0x28, 0x7c, 0xeb, 0xf7, 0xb2, 0xd5, 0x70, 0xd0, 0x22, 0xc7, 0x7e,
      0x25, 0x58, 0xe2, 0xfb, 0x0,  0x13, 0xcf, 0xda, 0x3f, 0x3c, 0x82, 0xfb, 0xf,  0xbd, 0x45, 0xb8, 0x1f, 0xd8, 0x24,
      0x5a, 0x7b, 0x3f, 0xfc, 0x7c, 0xfc, 0x0,  0x8,  0xb8, 0x62, 0x23, 0xe0, 0x7d, 0x5d, 0x14, 0xd2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x54, 0x36, 0x5f, 0x6d, 0x94, 0xb1, 0x18, 0x50, 0x17, 0xbf, 0x5b, 0xd5, 0xa2, 0x81,
                           0xaf, 0xa4, 0x21, 0x11, 0x4e, 0x4d, 0x8,  0xf8, 0x3,  0x5b, 0x39, 0xb5, 0xb5};
  uint8_t bytesprops2[] = {0x28, 0x6b, 0x27, 0xa0, 0x3b, 0x6b, 0x9e, 0xc7, 0xee, 0xba, 0x4b, 0xff,
                           0xa1, 0xde, 0xac, 0x9,  0x4e, 0x68, 0x92, 0x2a, 0x93, 0x55, 0xc8, 0x4e};
  uint8_t bytesprops1[] = {0xd3, 0xac, 0x4b, 0xae, 0x70, 0x33, 0x2, 0x66, 0x36, 0xd6, 0x13, 0x35, 0xcc, 0x91};
  uint8_t bytesprops3[] = {0x64, 0xb8, 0xb4, 0x83, 0xff, 0x56, 0xff, 0xa3, 0xed, 0x3b};
  uint8_t bytesprops4[] = {0xfd, 0xb1, 0x28, 0xc2, 0xdd, 0x75, 0xa,  0x91, 0x91, 0x61, 0xc4, 0x3b, 0xc1,
                           0xe7, 0xad, 0xc8, 0x8f, 0xc2, 0xe1, 0x9b, 0xc2, 0x91, 0x65, 0xf4, 0x54};
  uint8_t bytesprops5[] = {0x74};
  uint8_t bytesprops6[] = {0xe0, 0x4,  0xdc, 0xc7, 0xdf, 0x5d, 0xd,  0x9e, 0x82,
                           0xe5, 0xa3, 0xf3, 0xc7, 0xbc, 0xa5, 0xf2, 0x71, 0x73};
  uint8_t bytesprops7[] = {0xcb, 0x8f, 0xad, 0xb3, 0xe9, 0xd1, 0x83, 0x64};
  uint8_t bytesprops8[] = {0xe6, 0x2e, 0x91, 0xc,  0x64, 0x38, 0x3d, 0xfd, 0x78, 0x8c, 0x1,
                           0x89, 0xe9, 0xc7, 0xee, 0xce, 0x39, 0xa4, 0xd8, 0x2d, 0x40, 0x90};
  uint8_t bytesprops9[] = {0x6f, 0x8, 0x7d, 0x9c, 0xa7, 0xb9, 0xc4, 0x54, 0xde,
                           0x62, 0x2, 0x38, 0x54, 0xc9, 0xaa, 0x92, 0x51, 0x6c};
  uint8_t bytesprops10[] = {0x7c, 0x89};
  uint8_t bytesprops11[] = {0x93, 0x62, 0x7b, 0xe9, 0xeb, 0x95, 0xdb, 0xb7, 0xd5, 0x16, 0xac, 0xae, 0x19, 0xb0, 0x79,
                            0x82, 0xa0, 0xc7, 0x77, 0xfe, 0x5d, 0x57, 0x27, 0xe5, 0x73, 0x62, 0xaa, 0x31, 0xc9, 0x76};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops1}, .v = {24, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9906}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4996}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9276}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10006}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2484}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16834}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26987}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 78}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7f, 0x87, 0x34, 0xda, 0xe0, 0xe4, 0xeb, 0x72, 0x40, 0x29, 0xd1, 0xe1, 0x8c, 0x90,
                               0x55, 0x47, 0x56, 0xd9, 0x8e, 0x54, 0xb,  0x71, 0xd8, 0x57, 0x9c, 0xb1, 0xe7};
  uint8_t byteswillprops1[] = {0xe7, 0x87, 0x10, 0x52, 0xef, 0x6e, 0x37, 0x8, 0xdb,
                               0x50, 0xfa, 0x64, 0x3e, 0x8d, 0x98, 0x2,  0xa3};
  uint8_t byteswillprops2[] = {0xef, 0x3a, 0x4c, 0x7d, 0x14, 0x29, 0xe9, 0x4};
  uint8_t byteswillprops3[] = {0x26, 0x6f, 0x8a, 0x2a, 0xe5, 0xf9, 0x2d, 0xb, 0xbf};
  uint8_t byteswillprops4[] = {0x44, 0xe5, 0x5b, 0x2a, 0x69};
  uint8_t byteswillprops5[] = {0x34, 0xda, 0xbf, 0xac, 0x27, 0x2d, 0x5c, 0x83, 0x1e, 0xc0, 0x85, 0x63, 0xfe};
  uint8_t byteswillprops6[] = {0};
  uint8_t byteswillprops7[] = {0x94, 0xb, 0x40, 0xf6, 0x97, 0x90, 0x33, 0x8d, 0xa2};
  uint8_t byteswillprops8[] = {0xb,  0x41, 0x44, 0x1e, 0x49, 0xfe, 0xb3, 0x8e, 0x80, 0xcd, 0x69,
                               0x78, 0xbf, 0x0,  0x82, 0x75, 0xeb, 0x96, 0x2f, 0x6c, 0x1d, 0x71};
  uint8_t byteswillprops9[] = {0x55, 0x1d, 0x3b, 0x12, 0xcf};
  uint8_t byteswillprops10[] = {0x7f, 0xd1, 0x1c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31130}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22834}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32076}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14123}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30788}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7016}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16814}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24150}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24347}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4a, 0x3d, 0x1b, 0x47, 0xf9, 0x20, 0x74, 0x2,  0xf7, 0x6d,
                                0x1e, 0x93, 0x1e, 0x9d, 0xe1, 0x4b, 0x0,  0x94, 0x47, 0xcb};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x71, 0x9b, 0x22, 0x2b, 0xb4, 0xa1, 0x2c, 0xb0, 0x39, 0x44,
                                  0xfb, 0x9f, 0x21, 0xa4, 0x28, 0x7c, 0xeb, 0xf7, 0xb2, 0xd5,
                                  0x70, 0xd0, 0x22, 0xc7, 0x7e, 0x25, 0x58, 0xe2, 0xfb};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 8484;
  uint8_t client_id_bytes[] = {0xdb, 0x8a, 0xbf, 0x7c, 0x2a, 0xe7, 0x6,  0xbf, 0x57, 0x5a, 0x43,
                               0x72, 0x57, 0x5a, 0xd,  0x3,  0x4c, 0x41, 0xf7, 0x7c, 0x36};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcf, 0xda, 0x3f, 0x3c, 0x82, 0xfb, 0xf,  0xbd, 0x45, 0xb8,
                              0x1f, 0xd8, 0x24, 0x5a, 0x7b, 0x3f, 0xfc, 0x7c, 0xfc};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb8, 0x62, 0x23, 0xe0, 0x7d, 0x5d, 0x14, 0xd2};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\DC2Bw\158G\232{\204\238N\218\&9\f\150", _password = Just
// "/ME\221/\224L\203\216\150\t=\195a\169\197P[\251\137\DC3\219\152\253\ENQL\153\239", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\160TX\134\176\USa\167\209[\146\&0", _willMsg =
// "\130\128b\DC1U\178\198J:\"\154\&9\174\144\&79\222\DEL\212\204'\ENQ\227\139\&7\132", _willProps =
// [PropWildcardSubscriptionAvailable 219,PropSharedSubscriptionAvailable 19,PropRequestResponseInformation
// 226,PropSessionExpiryInterval 30066,PropContentType
// "\212\184\141\\\143%W\190|\152\DC3\193E\n\t\237\159\184?\194\129|\131\231\171G\230\&0!\188",PropTopicAliasMaximum
// 2047,PropMessageExpiryInterval 25577,PropSubscriptionIdentifier 10,PropAuthenticationMethod
// "\193\235,\149\&7\212X",PropAuthenticationMethod "\206\254Wz\ETB\174)\179#\ETB\159W\174",PropCorrelationData
// "%\NAKH\EM&\166\208\192\EM\226\133\223\ENQ6\FS\138\156d}\145Gv",PropRetainAvailable 154,PropAuthenticationData
// "\162\151\SUBN\234\SUB\226\&3\SYN8\152\156*\249\137k6\175\250x\158\135!\208\STX+\194\a\246",PropRequestResponseInformation
// 245,PropAssignedClientIdentifier
// "\181h&v\183[\189\STX]P2\182\SYNO\179\f\245\226\166\189\236\247o\250]\193M\229",PropSharedSubscriptionAvailable
// 20,PropContentType "\247V\148\159\223`\a\244\217b\ETB:\217",PropReasonString
// "h\241\252P3\136\n\tg6\SI\136o\DC2I]\189bfy\DEL9L\131\199/\169{g\180"]}), _cleanSession = True, _keepAlive = 18071,
// _connID = "\150\237n\166\229\ETBi;m\233\SYN,\137\212\196\218", _properties = [PropSessionExpiryInterval
// 24708,PropSharedSubscriptionAvailable 250,PropSharedSubscriptionAvailable 94,PropWillDelayInterval
// 2639,PropServerReference
// "l\130\ACK\250\EM\186\NUL_\184\226\r\139\134\224\229\149\155\137\207x\132\175\224\&7q\SO\254\t\140",PropMaximumQoS
// 156,PropSessionExpiryInterval 14655,PropWillDelayInterval 11878,PropTopicAliasMaximum 16102,PropContentType
// "\193\STX9\155\155t6\235\154U\132!",PropWildcardSubscriptionAvailable 200,PropContentType
// "\200\v\b\224*\ETB\193\232\\\168G\129\233\238\129\246\171#x\204x",PropRetainAvailable 204,PropMaximumPacketSize
// 29406,PropRequestResponseInformation 23,PropReceiveMaximum 13674,PropContentType
// "\204z\250\GS\191\179\133\254V\f.\137\159LK\170h\163\SYN",PropSharedSubscriptionAvailable
// 188,PropAssignedClientIdentifier
// "\135=\NAKf\239\205\152\238$\149\SOHF8\137\141\194\255/7\209\EOT\251\STX%\201O\218",PropReasonString
// "\130\SOH\STX\162:H\145\174]\200\196\220A",PropRequestProblemInformation 47,PropReceiveMaximum
// 23351,PropSharedSubscriptionAvailable 124,PropMaximumQoS 69,PropCorrelationData "g",PropServerKeepAlive
// 20731,PropWillDelayInterval 14078,PropRequestResponseInformation 112]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xa7, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x46, 0x97, 0xcf, 0x1,  0x11, 0x0,  0x0,  0x60,
      0x84, 0x2a, 0xfa, 0x2a, 0x5e, 0x18, 0x0,  0x0,  0xa,  0x4f, 0x1c, 0x0,  0x1d, 0x6c, 0x82, 0x6,  0xfa, 0x19, 0xba,
      0x0,  0x5f, 0xb8, 0xe2, 0xd,  0x8b, 0x86, 0xe0, 0xe5, 0x95, 0x9b, 0x89, 0xcf, 0x78, 0x84, 0xaf, 0xe0, 0x37, 0x71,
      0xe,  0xfe, 0x9,  0x8c, 0x24, 0x9c, 0x11, 0x0,  0x0,  0x39, 0x3f, 0x18, 0x0,  0x0,  0x2e, 0x66, 0x22, 0x3e, 0xe6,
      0x3,  0x0,  0xc,  0xc1, 0x2,  0x39, 0x9b, 0x9b, 0x74, 0x36, 0xeb, 0x9a, 0x55, 0x84, 0x21, 0x28, 0xc8, 0x3,  0x0,
      0x15, 0xc8, 0xb,  0x8,  0xe0, 0x2a, 0x17, 0xc1, 0xe8, 0x5c, 0xa8, 0x47, 0x81, 0xe9, 0xee, 0x81, 0xf6, 0xab, 0x23,
      0x78, 0xcc, 0x78, 0x25, 0xcc, 0x27, 0x0,  0x0,  0x72, 0xde, 0x19, 0x17, 0x21, 0x35, 0x6a, 0x3,  0x0,  0x13, 0xcc,
      0x7a, 0xfa, 0x1d, 0xbf, 0xb3, 0x85, 0xfe, 0x56, 0xc,  0x2e, 0x89, 0x9f, 0x4c, 0x4b, 0xaa, 0x68, 0xa3, 0x16, 0x2a,
      0xbc, 0x12, 0x0,  0x1b, 0x87, 0x3d, 0x15, 0x66, 0xef, 0xcd, 0x98, 0xee, 0x24, 0x95, 0x1,  0x46, 0x38, 0x89, 0x8d,
      0xc2, 0xff, 0x2f, 0x37, 0xd1, 0x4,  0xfb, 0x2,  0x25, 0xc9, 0x4f, 0xda, 0x1f, 0x0,  0xd,  0x82, 0x1,  0x2,  0xa2,
      0x3a, 0x48, 0x91, 0xae, 0x5d, 0xc8, 0xc4, 0xdc, 0x41, 0x17, 0x2f, 0x21, 0x5b, 0x37, 0x2a, 0x7c, 0x24, 0x45, 0x9,
      0x0,  0x1,  0x67, 0x13, 0x50, 0xfb, 0x18, 0x0,  0x0,  0x36, 0xfe, 0x19, 0x70, 0x0,  0x10, 0x96, 0xed, 0x6e, 0xa6,
      0xe5, 0x17, 0x69, 0x3b, 0x6d, 0xe9, 0x16, 0x2c, 0x89, 0xd4, 0xc4, 0xda, 0xdf, 0x1,  0x28, 0xdb, 0x2a, 0x13, 0x19,
      0xe2, 0x11, 0x0,  0x0,  0x75, 0x72, 0x3,  0x0,  0x1e, 0xd4, 0xb8, 0x8d, 0x5c, 0x8f, 0x25, 0x57, 0xbe, 0x7c, 0x98,
      0x13, 0xc1, 0x45, 0xa,  0x9,  0xed, 0x9f, 0xb8, 0x3f, 0xc2, 0x81, 0x7c, 0x83, 0xe7, 0xab, 0x47, 0xe6, 0x30, 0x21,
      0xbc, 0x22, 0x7,  0xff, 0x2,  0x0,  0x0,  0x63, 0xe9, 0xb,  0xa,  0x15, 0x0,  0x7,  0xc1, 0xeb, 0x2c, 0x95, 0x37,
      0xd4, 0x58, 0x15, 0x0,  0xd,  0xce, 0xfe, 0x57, 0x7a, 0x17, 0xae, 0x29, 0xb3, 0x23, 0x17, 0x9f, 0x57, 0xae, 0x9,
      0x0,  0x16, 0x25, 0x15, 0x48, 0x19, 0x26, 0xa6, 0xd0, 0xc0, 0x19, 0xe2, 0x85, 0xdf, 0x5,  0x36, 0x1c, 0x8a, 0x9c,
      0x64, 0x7d, 0x91, 0x47, 0x76, 0x25, 0x9a, 0x16, 0x0,  0x1d, 0xa2, 0x97, 0x1a, 0x4e, 0xea, 0x1a, 0xe2, 0x33, 0x16,
      0x38, 0x98, 0x9c, 0x2a, 0xf9, 0x89, 0x6b, 0x36, 0xaf, 0xfa, 0x78, 0x9e, 0x87, 0x21, 0xd0, 0x2,  0x2b, 0xc2, 0x7,
      0xf6, 0x19, 0xf5, 0x12, 0x0,  0x1c, 0xb5, 0x68, 0x26, 0x76, 0xb7, 0x5b, 0xbd, 0x2,  0x5d, 0x50, 0x32, 0xb6, 0x16,
      0x4f, 0xb3, 0xc,  0xf5, 0xe2, 0xa6, 0xbd, 0xec, 0xf7, 0x6f, 0xfa, 0x5d, 0xc1, 0x4d, 0xe5, 0x2a, 0x14, 0x3,  0x0,
      0xd,  0xf7, 0x56, 0x94, 0x9f, 0xdf, 0x60, 0x7,  0xf4, 0xd9, 0x62, 0x17, 0x3a, 0xd9, 0x1f, 0x0,  0x1e, 0x68, 0xf1,
      0xfc, 0x50, 0x33, 0x88, 0xa,  0x9,  0x67, 0x36, 0xf,  0x88, 0x6f, 0x12, 0x49, 0x5d, 0xbd, 0x62, 0x66, 0x79, 0x7f,
      0x39, 0x4c, 0x83, 0xc7, 0x2f, 0xa9, 0x7b, 0x67, 0xb4, 0x0,  0xc,  0xa0, 0x54, 0x58, 0x86, 0xb0, 0x1f, 0x61, 0xa7,
      0xd1, 0x5b, 0x92, 0x30, 0x0,  0x1a, 0x82, 0x80, 0x62, 0x11, 0x55, 0xb2, 0xc6, 0x4a, 0x3a, 0x22, 0x9a, 0x39, 0xae,
      0x90, 0x37, 0x39, 0xde, 0x7f, 0xd4, 0xcc, 0x27, 0x5,  0xe3, 0x8b, 0x37, 0x84, 0x0,  0xf,  0xcc, 0x12, 0x42, 0x77,
      0x9e, 0x47, 0xe8, 0x7b, 0xcc, 0xee, 0x4e, 0xda, 0x39, 0xc,  0x96, 0x0,  0x1c, 0x2f, 0x4d, 0x45, 0xdd, 0x2f, 0xe0,
      0x4c, 0xcb, 0xd8, 0x96, 0x9,  0x3d, 0xc3, 0x61, 0xa9, 0xc5, 0x50, 0x5b, 0xfb, 0x89, 0x13, 0xdb, 0x98, 0xfd, 0x5,
      0x4c, 0x99, 0xef};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6c, 0x82, 0x6,  0xfa, 0x19, 0xba, 0x0,  0x5f, 0xb8, 0xe2, 0xd, 0x8b, 0x86, 0xe0, 0xe5,
                           0x95, 0x9b, 0x89, 0xcf, 0x78, 0x84, 0xaf, 0xe0, 0x37, 0x71, 0xe, 0xfe, 0x9,  0x8c};
  uint8_t bytesprops1[] = {0xc1, 0x2, 0x39, 0x9b, 0x9b, 0x74, 0x36, 0xeb, 0x9a, 0x55, 0x84, 0x21};
  uint8_t bytesprops2[] = {0xc8, 0xb,  0x8,  0xe0, 0x2a, 0x17, 0xc1, 0xe8, 0x5c, 0xa8, 0x47,
                           0x81, 0xe9, 0xee, 0x81, 0xf6, 0xab, 0x23, 0x78, 0xcc, 0x78};
  uint8_t bytesprops3[] = {0xcc, 0x7a, 0xfa, 0x1d, 0xbf, 0xb3, 0x85, 0xfe, 0x56, 0xc,
                           0x2e, 0x89, 0x9f, 0x4c, 0x4b, 0xaa, 0x68, 0xa3, 0x16};
  uint8_t bytesprops4[] = {0x87, 0x3d, 0x15, 0x66, 0xef, 0xcd, 0x98, 0xee, 0x24, 0x95, 0x1,  0x46, 0x38, 0x89,
                           0x8d, 0xc2, 0xff, 0x2f, 0x37, 0xd1, 0x4,  0xfb, 0x2,  0x25, 0xc9, 0x4f, 0xda};
  uint8_t bytesprops5[] = {0x82, 0x1, 0x2, 0xa2, 0x3a, 0x48, 0x91, 0xae, 0x5d, 0xc8, 0xc4, 0xdc, 0x41};
  uint8_t bytesprops6[] = {0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24708}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2639}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14655}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11878}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16102}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29406}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13674}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23351}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20731}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14078}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 112}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd4, 0xb8, 0x8d, 0x5c, 0x8f, 0x25, 0x57, 0xbe, 0x7c, 0x98,
                               0x13, 0xc1, 0x45, 0xa,  0x9,  0xed, 0x9f, 0xb8, 0x3f, 0xc2,
                               0x81, 0x7c, 0x83, 0xe7, 0xab, 0x47, 0xe6, 0x30, 0x21, 0xbc};
  uint8_t byteswillprops1[] = {0xc1, 0xeb, 0x2c, 0x95, 0x37, 0xd4, 0x58};
  uint8_t byteswillprops2[] = {0xce, 0xfe, 0x57, 0x7a, 0x17, 0xae, 0x29, 0xb3, 0x23, 0x17, 0x9f, 0x57, 0xae};
  uint8_t byteswillprops3[] = {0x25, 0x15, 0x48, 0x19, 0x26, 0xa6, 0xd0, 0xc0, 0x19, 0xe2, 0x85,
                               0xdf, 0x5,  0x36, 0x1c, 0x8a, 0x9c, 0x64, 0x7d, 0x91, 0x47, 0x76};
  uint8_t byteswillprops4[] = {0xa2, 0x97, 0x1a, 0x4e, 0xea, 0x1a, 0xe2, 0x33, 0x16, 0x38, 0x98, 0x9c, 0x2a, 0xf9, 0x89,
                               0x6b, 0x36, 0xaf, 0xfa, 0x78, 0x9e, 0x87, 0x21, 0xd0, 0x2,  0x2b, 0xc2, 0x7,  0xf6};
  uint8_t byteswillprops5[] = {0xb5, 0x68, 0x26, 0x76, 0xb7, 0x5b, 0xbd, 0x2,  0x5d, 0x50, 0x32, 0xb6, 0x16, 0x4f,
                               0xb3, 0xc,  0xf5, 0xe2, 0xa6, 0xbd, 0xec, 0xf7, 0x6f, 0xfa, 0x5d, 0xc1, 0x4d, 0xe5};
  uint8_t byteswillprops6[] = {0xf7, 0x56, 0x94, 0x9f, 0xdf, 0x60, 0x7, 0xf4, 0xd9, 0x62, 0x17, 0x3a, 0xd9};
  uint8_t byteswillprops7[] = {0x68, 0xf1, 0xfc, 0x50, 0x33, 0x88, 0xa,  0x9,  0x67, 0x36,
                               0xf,  0x88, 0x6f, 0x12, 0x49, 0x5d, 0xbd, 0x62, 0x66, 0x79,
                               0x7f, 0x39, 0x4c, 0x83, 0xc7, 0x2f, 0xa9, 0x7b, 0x67, 0xb4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30066}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2047}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25577}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa0, 0x54, 0x58, 0x86, 0xb0, 0x1f, 0x61, 0xa7, 0xd1, 0x5b, 0x92, 0x30};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x80, 0x62, 0x11, 0x55, 0xb2, 0xc6, 0x4a, 0x3a, 0x22, 0x9a, 0x39, 0xae,
                                  0x90, 0x37, 0x39, 0xde, 0x7f, 0xd4, 0xcc, 0x27, 0x5,  0xe3, 0x8b, 0x37, 0x84};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18071;
  uint8_t client_id_bytes[] = {0x96, 0xed, 0x6e, 0xa6, 0xe5, 0x17, 0x69, 0x3b,
                               0x6d, 0xe9, 0x16, 0x2c, 0x89, 0xd4, 0xc4, 0xda};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x12, 0x42, 0x77, 0x9e, 0x47, 0xe8, 0x7b, 0xcc, 0xee, 0x4e, 0xda, 0x39, 0xc, 0x96};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0x4d, 0x45, 0xdd, 0x2f, 0xe0, 0x4c, 0xcb, 0xd8, 0x96, 0x9, 0x3d, 0xc3, 0x61,
                              0xa9, 0xc5, 0x50, 0x5b, 0xfb, 0x89, 0x13, 0xdb, 0x98, 0xfd, 0x5, 0x4c, 0x99, 0xef};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\170\169T\181z[8\SOH\237A\171\211\161", _password = Just "\216/I\167", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "i\\\223d\254\201\208#u\SUB\184\178\254^g",
// _willMsg = "\130\b\SOHn\241D<\208", _willProps = [PropAssignedClientIdentifier
// "\241\&2\DC4\187*\232\&5Jf\133y.\245T\255\&7+\140z0\DC2-\DLEe\190\243\213P\236",PropServerKeepAlive
// 17912,PropAuthenticationData "\159\233G\221",PropMessageExpiryInterval 10456,PropWillDelayInterval
// 6209,PropContentType "\198\147Xgv",PropServerKeepAlive 29007,PropAuthenticationData "\NAK\167v\SYN"]}), _cleanSession
// = False, _keepAlive = 20715, _connID = "\238Vc]\r\147\142\177>\228\133\&4\185\GS", _properties =
// [PropMessageExpiryInterval 1066,PropTopicAlias 16219,PropSubscriptionIdentifierAvailable
// 142,PropWildcardSubscriptionAvailable 211,PropRequestResponseInformation 233,PropRequestResponseInformation
// 2,PropRetainAvailable 154,PropTopicAlias 15714,PropPayloadFormatIndicator 42,PropWildcardSubscriptionAvailable
// 140,PropCorrelationData
// "m\198\ESC\222m7Ju\192J,\255\DLE\ACKW\247a\179%Q\214\227\212h\ETB\231",PropRequestResponseInformation
// 57,PropPayloadFormatIndicator 117,PropMaximumQoS 212,PropUserProperty
// "-\176\r\DEL\230}cU\\\163\243\STX`\v\250\&3\EM\f#j?\202<\141O\217\129\EM\186a"
// "qn\154f\136\r8\171\DC1\246",PropMessageExpiryInterval 1610,PropUserProperty
// "\SYN-\142J\224\SI,6\175\189\GS80\133M\t;&\211\203\170\147" "\179\189\192S\205\150\203<\129\ENQ\175"]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xa7, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x50, 0xeb, 0x94, 0x1,  0x2,  0x0,  0x0,  0x4,
      0x2a, 0x23, 0x3f, 0x5b, 0x29, 0x8e, 0x28, 0xd3, 0x19, 0xe9, 0x19, 0x2,  0x25, 0x9a, 0x23, 0x3d, 0x62, 0x1,  0x2a,
      0x28, 0x8c, 0x9,  0x0,  0x1a, 0x6d, 0xc6, 0x1b, 0xde, 0x6d, 0x37, 0x4a, 0x75, 0xc0, 0x4a, 0x2c, 0xff, 0x10, 0x6,
      0x57, 0xf7, 0x61, 0xb3, 0x25, 0x51, 0xd6, 0xe3, 0xd4, 0x68, 0x17, 0xe7, 0x19, 0x39, 0x1,  0x75, 0x24, 0xd4, 0x26,
      0x0,  0x1e, 0x2d, 0xb0, 0xd,  0x7f, 0xe6, 0x7d, 0x63, 0x55, 0x5c, 0xa3, 0xf3, 0x2,  0x60, 0xb,  0xfa, 0x33, 0x19,
      0xc,  0x23, 0x6a, 0x3f, 0xca, 0x3c, 0x8d, 0x4f, 0xd9, 0x81, 0x19, 0xba, 0x61, 0x0,  0xa,  0x71, 0x6e, 0x9a, 0x66,
      0x88, 0xd,  0x38, 0xab, 0x11, 0xf6, 0x2,  0x0,  0x0,  0x6,  0x4a, 0x26, 0x0,  0x16, 0x16, 0x2d, 0x8e, 0x4a, 0xe0,
      0xf,  0x2c, 0x36, 0xaf, 0xbd, 0x1d, 0x38, 0x30, 0x85, 0x4d, 0x9,  0x3b, 0x26, 0xd3, 0xcb, 0xaa, 0x93, 0x0,  0xb,
      0xb3, 0xbd, 0xc0, 0x53, 0xcd, 0x96, 0xcb, 0x3c, 0x81, 0x5,  0xaf, 0x0,  0xe,  0xee, 0x56, 0x63, 0x5d, 0xd,  0x93,
      0x8e, 0xb1, 0x3e, 0xe4, 0x85, 0x34, 0xb9, 0x1d, 0x46, 0x12, 0x0,  0x1d, 0xf1, 0x32, 0x14, 0xbb, 0x2a, 0xe8, 0x35,
      0x4a, 0x66, 0x85, 0x79, 0x2e, 0xf5, 0x54, 0xff, 0x37, 0x2b, 0x8c, 0x7a, 0x30, 0x12, 0x2d, 0x10, 0x65, 0xbe, 0xf3,
      0xd5, 0x50, 0xec, 0x13, 0x45, 0xf8, 0x16, 0x0,  0x4,  0x9f, 0xe9, 0x47, 0xdd, 0x2,  0x0,  0x0,  0x28, 0xd8, 0x18,
      0x0,  0x0,  0x18, 0x41, 0x3,  0x0,  0x5,  0xc6, 0x93, 0x58, 0x67, 0x76, 0x13, 0x71, 0x4f, 0x16, 0x0,  0x4,  0x15,
      0xa7, 0x76, 0x16, 0x0,  0xf,  0x69, 0x5c, 0xdf, 0x64, 0xfe, 0xc9, 0xd0, 0x23, 0x75, 0x1a, 0xb8, 0xb2, 0xfe, 0x5e,
      0x67, 0x0,  0x8,  0x82, 0x8,  0x1,  0x6e, 0xf1, 0x44, 0x3c, 0xd0, 0x0,  0xd,  0xaa, 0xa9, 0x54, 0xb5, 0x7a, 0x5b,
      0x38, 0x1,  0xed, 0x41, 0xab, 0xd3, 0xa1, 0x0,  0x4,  0xd8, 0x2f, 0x49, 0xa7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6d, 0xc6, 0x1b, 0xde, 0x6d, 0x37, 0x4a, 0x75, 0xc0, 0x4a, 0x2c, 0xff, 0x10,
                           0x6,  0x57, 0xf7, 0x61, 0xb3, 0x25, 0x51, 0xd6, 0xe3, 0xd4, 0x68, 0x17, 0xe7};
  uint8_t bytesprops2[] = {0x71, 0x6e, 0x9a, 0x66, 0x88, 0xd, 0x38, 0xab, 0x11, 0xf6};
  uint8_t bytesprops1[] = {0x2d, 0xb0, 0xd, 0x7f, 0xe6, 0x7d, 0x63, 0x55, 0x5c, 0xa3, 0xf3, 0x2,  0x60, 0xb,  0xfa,
                           0x33, 0x19, 0xc, 0x23, 0x6a, 0x3f, 0xca, 0x3c, 0x8d, 0x4f, 0xd9, 0x81, 0x19, 0xba, 0x61};
  uint8_t bytesprops4[] = {0xb3, 0xbd, 0xc0, 0x53, 0xcd, 0x96, 0xcb, 0x3c, 0x81, 0x5, 0xaf};
  uint8_t bytesprops3[] = {0x16, 0x2d, 0x8e, 0x4a, 0xe0, 0xf,  0x2c, 0x36, 0xaf, 0xbd, 0x1d,
                           0x38, 0x30, 0x85, 0x4d, 0x9,  0x3b, 0x26, 0xd3, 0xcb, 0xaa, 0x93};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1066}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16219}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15714}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops1}, .v = {10, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1610}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops3}, .v = {11, (char*)&bytesprops4}}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf1, 0x32, 0x14, 0xbb, 0x2a, 0xe8, 0x35, 0x4a, 0x66, 0x85, 0x79, 0x2e, 0xf5, 0x54, 0xff,
                               0x37, 0x2b, 0x8c, 0x7a, 0x30, 0x12, 0x2d, 0x10, 0x65, 0xbe, 0xf3, 0xd5, 0x50, 0xec};
  uint8_t byteswillprops1[] = {0x9f, 0xe9, 0x47, 0xdd};
  uint8_t byteswillprops2[] = {0xc6, 0x93, 0x58, 0x67, 0x76};
  uint8_t byteswillprops3[] = {0x15, 0xa7, 0x76, 0x16};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17912}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10456}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6209}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29007}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&byteswillprops3}}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x69, 0x5c, 0xdf, 0x64, 0xfe, 0xc9, 0xd0, 0x23,
                                0x75, 0x1a, 0xb8, 0xb2, 0xfe, 0x5e, 0x67};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x82, 0x8, 0x1, 0x6e, 0xf1, 0x44, 0x3c, 0xd0};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20715;
  uint8_t client_id_bytes[] = {0xee, 0x56, 0x63, 0x5d, 0xd, 0x93, 0x8e, 0xb1, 0x3e, 0xe4, 0x85, 0x34, 0xb9, 0x1d};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xaa, 0xa9, 0x54, 0xb5, 0x7a, 0x5b, 0x38, 0x1, 0xed, 0x41, 0xab, 0xd3, 0xa1};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd8, 0x2f, 0x49, 0xa7};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\128", _willMsg = "G\244\250\238\173\220\204", _willProps = [PropServerKeepAlive
// 30225,PropRetainAvailable 120,PropUserProperty "r|M\rx\197\nG\t\147\215}\158\176\233\132C\164\ENQx`!Q"
// "\226}Z{\168|OL\GS\155)\229Q\166",PropAssignedClientIdentifier "\\\245\RSS\198\DLEY`\EM\210%\186
// \239\193\186SR\216d#\SOx\239``",PropServerReference "\RS\172\142",PropSharedSubscriptionAvailable
// 237,PropResponseInformation "\155\241P\172-\174\142\RSx\139G3\180\250\&5\255!\NUL\173\n\144",PropRetainAvailable
// 199,PropSubscriptionIdentifier 19,PropAuthenticationData
// "_!i\159]\238\\\SI\128\194\198\230i\138",PropAuthenticationMethod
// "I\159l\214\226\158\245R\140\213\199\156cO\183\SO\249Qgk`\n\200\FSM\t",PropTopicAlias 15985,PropAuthenticationData
// "\228\150\233\227",PropTopicAlias 6436,PropRequestProblemInformation 224,PropAuthenticationMethod
// "((\182Wo\245t<\DC2\227\184\160\200\157\&6\148",PropSubscriptionIdentifierAvailable 75,PropRequestResponseInformation
// 45]}), _cleanSession = True, _keepAlive = 28847, _connID = "IP", _properties = [PropWildcardSubscriptionAvailable
// 111,PropReceiveMaximum 14339,PropResponseTopic "\148\162\143\176\245\194",PropContentType
// "\223\212FBW&\184s\206\183\&7",PropAuthenticationMethod
// "\146\204Op\161\&3]+\182\148e\211\172\159^\141`>\243\189\251w.\DC4\233\164$\167\236",PropSharedSubscriptionAvailable
// 181,PropContentType "\168a\130\"\205\208S\218 /F9\255r\185\ETX",PropMessageExpiryInterval 6731,PropWillDelayInterval
// 22863,PropRequestProblemInformation 161,PropAuthenticationMethod "\179\205g\128H\128a\137jb\SYNe\n",PropContentType
// "\170\DC3S\DC41S\191;\vYw\154\176!H\b\148\161~\ETXs\180%\DC2\183",PropAuthenticationData
// "\155\203",PropSessionExpiryInterval 5522,PropResponseInformation
// "\195\202\180\227\178p#\183\178_j\236\US\EM\DC1\165\160",PropSubscriptionIdentifier 2,PropUserProperty
// "\151\199@N\145h\195>\196\211\200X\212\178!\ESC\179"
// "\132\170\182\138\243\152\SUB\223\129\158\181\174\ETX",PropUserProperty "#[\GS/w\138\130\238\DLE\223;(2\152E\128"
// "!\v\133\SOt\139b\136\SO\211uc\147\ACK\DC3\144\169I\159\SOH9#\153\154^\156\168V`\130",PropTopicAliasMaximum
// 13969,PropSharedSubscriptionAvailable 151,PropResponseTopic
// "\184I4u\219D|N1\SUB/\DC1\238N,$\222\ENQ\229\235\140\&4\166",PropWildcardSubscriptionAvailable 27,PropUserProperty
// "\202\207\143\FSW\"\150Z \150/\234\&7\USI\172o\196\NAKr%\216\ESC\254\175\220\&8\135\FS"
// "\226\177\f\b\141x\188\154\205\224g)\173y\170EiU\186[\150=\RS\233&",PropContentType
// "\239J\250$L\169\196\170\196-`H\217\134\227t\fq\NUL\249\178CZY\255\130"]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xda, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x70, 0xaf, 0xf8, 0x2,  0x28, 0x6f, 0x21, 0x38,
      0x3,  0x8,  0x0,  0x6,  0x94, 0xa2, 0x8f, 0xb0, 0xf5, 0xc2, 0x3,  0x0,  0xb,  0xdf, 0xd4, 0x46, 0x42, 0x57, 0x26,
      0xb8, 0x73, 0xce, 0xb7, 0x37, 0x15, 0x0,  0x1d, 0x92, 0xcc, 0x4f, 0x70, 0xa1, 0x33, 0x5d, 0x2b, 0xb6, 0x94, 0x65,
      0xd3, 0xac, 0x9f, 0x5e, 0x8d, 0x60, 0x3e, 0xf3, 0xbd, 0xfb, 0x77, 0x2e, 0x14, 0xe9, 0xa4, 0x24, 0xa7, 0xec, 0x2a,
      0xb5, 0x3,  0x0,  0x10, 0xa8, 0x61, 0x82, 0x22, 0xcd, 0xd0, 0x53, 0xda, 0x20, 0x2f, 0x46, 0x39, 0xff, 0x72, 0xb9,
      0x3,  0x2,  0x0,  0x0,  0x1a, 0x4b, 0x18, 0x0,  0x0,  0x59, 0x4f, 0x17, 0xa1, 0x15, 0x0,  0xd,  0xb3, 0xcd, 0x67,
      0x80, 0x48, 0x80, 0x61, 0x89, 0x6a, 0x62, 0x16, 0x65, 0xa,  0x3,  0x0,  0x19, 0xaa, 0x13, 0x53, 0x14, 0x31, 0x53,
      0xbf, 0x3b, 0xb,  0x59, 0x77, 0x9a, 0xb0, 0x21, 0x48, 0x8,  0x94, 0xa1, 0x7e, 0x3,  0x73, 0xb4, 0x25, 0x12, 0xb7,
      0x16, 0x0,  0x2,  0x9b, 0xcb, 0x11, 0x0,  0x0,  0x15, 0x92, 0x1a, 0x0,  0x11, 0xc3, 0xca, 0xb4, 0xe3, 0xb2, 0x70,
      0x23, 0xb7, 0xb2, 0x5f, 0x6a, 0xec, 0x1f, 0x19, 0x11, 0xa5, 0xa0, 0xb,  0x2,  0x26, 0x0,  0x11, 0x97, 0xc7, 0x40,
      0x4e, 0x91, 0x68, 0xc3, 0x3e, 0xc4, 0xd3, 0xc8, 0x58, 0xd4, 0xb2, 0x21, 0x1b, 0xb3, 0x0,  0xd,  0x84, 0xaa, 0xb6,
      0x8a, 0xf3, 0x98, 0x1a, 0xdf, 0x81, 0x9e, 0xb5, 0xae, 0x3,  0x26, 0x0,  0x10, 0x23, 0x5b, 0x1d, 0x2f, 0x77, 0x8a,
      0x82, 0xee, 0x10, 0xdf, 0x3b, 0x28, 0x32, 0x98, 0x45, 0x80, 0x0,  0x1e, 0x21, 0xb,  0x85, 0xe,  0x74, 0x8b, 0x62,
      0x88, 0xe,  0xd3, 0x75, 0x63, 0x93, 0x6,  0x13, 0x90, 0xa9, 0x49, 0x9f, 0x1,  0x39, 0x23, 0x99, 0x9a, 0x5e, 0x9c,
      0xa8, 0x56, 0x60, 0x82, 0x22, 0x36, 0x91, 0x2a, 0x97, 0x8,  0x0,  0x17, 0xb8, 0x49, 0x34, 0x75, 0xdb, 0x44, 0x7c,
      0x4e, 0x31, 0x1a, 0x2f, 0x11, 0xee, 0x4e, 0x2c, 0x24, 0xde, 0x5,  0xe5, 0xeb, 0x8c, 0x34, 0xa6, 0x28, 0x1b, 0x26,
      0x0,  0x1d, 0xca, 0xcf, 0x8f, 0x1c, 0x57, 0x22, 0x96, 0x5a, 0x20, 0x96, 0x2f, 0xea, 0x37, 0x1f, 0x49, 0xac, 0x6f,
      0xc4, 0x15, 0x72, 0x25, 0xd8, 0x1b, 0xfe, 0xaf, 0xdc, 0x38, 0x87, 0x1c, 0x0,  0x19, 0xe2, 0xb1, 0xc,  0x8,  0x8d,
      0x78, 0xbc, 0x9a, 0xcd, 0xe0, 0x67, 0x29, 0xad, 0x79, 0xaa, 0x45, 0x69, 0x55, 0xba, 0x5b, 0x96, 0x3d, 0x1e, 0xe9,
      0x26, 0x3,  0x0,  0x1a, 0xef, 0x4a, 0xfa, 0x24, 0x4c, 0xa9, 0xc4, 0xaa, 0xc4, 0x2d, 0x60, 0x48, 0xd9, 0x86, 0xe3,
      0x74, 0xc,  0x71, 0x0,  0xf9, 0xb2, 0x43, 0x5a, 0x59, 0xff, 0x82, 0x0,  0x2,  0x49, 0x50, 0xc4, 0x1,  0x13, 0x76,
      0x11, 0x25, 0x78, 0x26, 0x0,  0x17, 0x72, 0x7c, 0x4d, 0xd,  0x78, 0xc5, 0xa,  0x47, 0x9,  0x93, 0xd7, 0x7d, 0x9e,
      0xb0, 0xe9, 0x84, 0x43, 0xa4, 0x5,  0x78, 0x60, 0x21, 0x51, 0x0,  0xe,  0xe2, 0x7d, 0x5a, 0x7b, 0xa8, 0x7c, 0x4f,
      0x4c, 0x1d, 0x9b, 0x29, 0xe5, 0x51, 0xa6, 0x12, 0x0,  0x1a, 0x5c, 0xf5, 0x1e, 0x53, 0xc6, 0x10, 0x59, 0x60, 0x19,
      0xd2, 0x25, 0xba, 0x20, 0xef, 0xc1, 0xba, 0x53, 0x52, 0xd8, 0x64, 0x23, 0xe,  0x78, 0xef, 0x60, 0x60, 0x1c, 0x0,
      0x3,  0x1e, 0xac, 0x8e, 0x2a, 0xed, 0x1a, 0x0,  0x15, 0x9b, 0xf1, 0x50, 0xac, 0x2d, 0xae, 0x8e, 0x1e, 0x78, 0x8b,
      0x47, 0x33, 0xb4, 0xfa, 0x35, 0xff, 0x21, 0x0,  0xad, 0xa,  0x90, 0x25, 0xc7, 0xb,  0x13, 0x16, 0x0,  0xe,  0x5f,
      0x21, 0x69, 0x9f, 0x5d, 0xee, 0x5c, 0xf,  0x80, 0xc2, 0xc6, 0xe6, 0x69, 0x8a, 0x15, 0x0,  0x1a, 0x49, 0x9f, 0x6c,
      0xd6, 0xe2, 0x9e, 0xf5, 0x52, 0x8c, 0xd5, 0xc7, 0x9c, 0x63, 0x4f, 0xb7, 0xe,  0xf9, 0x51, 0x67, 0x6b, 0x60, 0xa,
      0xc8, 0x1c, 0x4d, 0x9,  0x23, 0x3e, 0x71, 0x16, 0x0,  0x4,  0xe4, 0x96, 0xe9, 0xe3, 0x23, 0x19, 0x24, 0x17, 0xe0,
      0x15, 0x0,  0x10, 0x28, 0x28, 0xb6, 0x57, 0x6f, 0xf5, 0x74, 0x3c, 0x12, 0xe3, 0xb8, 0xa0, 0xc8, 0x9d, 0x36, 0x94,
      0x29, 0x4b, 0x19, 0x2d, 0x0,  0x1,  0x80, 0x0,  0x7,  0x47, 0xf4, 0xfa, 0xee, 0xad, 0xdc, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x94, 0xa2, 0x8f, 0xb0, 0xf5, 0xc2};
  uint8_t bytesprops1[] = {0xdf, 0xd4, 0x46, 0x42, 0x57, 0x26, 0xb8, 0x73, 0xce, 0xb7, 0x37};
  uint8_t bytesprops2[] = {0x92, 0xcc, 0x4f, 0x70, 0xa1, 0x33, 0x5d, 0x2b, 0xb6, 0x94, 0x65, 0xd3, 0xac, 0x9f, 0x5e,
                           0x8d, 0x60, 0x3e, 0xf3, 0xbd, 0xfb, 0x77, 0x2e, 0x14, 0xe9, 0xa4, 0x24, 0xa7, 0xec};
  uint8_t bytesprops3[] = {0xa8, 0x61, 0x82, 0x22, 0xcd, 0xd0, 0x53, 0xda,
                           0x20, 0x2f, 0x46, 0x39, 0xff, 0x72, 0xb9, 0x3};
  uint8_t bytesprops4[] = {0xb3, 0xcd, 0x67, 0x80, 0x48, 0x80, 0x61, 0x89, 0x6a, 0x62, 0x16, 0x65, 0xa};
  uint8_t bytesprops5[] = {0xaa, 0x13, 0x53, 0x14, 0x31, 0x53, 0xbf, 0x3b, 0xb,  0x59, 0x77, 0x9a, 0xb0,
                           0x21, 0x48, 0x8,  0x94, 0xa1, 0x7e, 0x3,  0x73, 0xb4, 0x25, 0x12, 0xb7};
  uint8_t bytesprops6[] = {0x9b, 0xcb};
  uint8_t bytesprops7[] = {0xc3, 0xca, 0xb4, 0xe3, 0xb2, 0x70, 0x23, 0xb7, 0xb2,
                           0x5f, 0x6a, 0xec, 0x1f, 0x19, 0x11, 0xa5, 0xa0};
  uint8_t bytesprops9[] = {0x84, 0xaa, 0xb6, 0x8a, 0xf3, 0x98, 0x1a, 0xdf, 0x81, 0x9e, 0xb5, 0xae, 0x3};
  uint8_t bytesprops8[] = {0x97, 0xc7, 0x40, 0x4e, 0x91, 0x68, 0xc3, 0x3e, 0xc4,
                           0xd3, 0xc8, 0x58, 0xd4, 0xb2, 0x21, 0x1b, 0xb3};
  uint8_t bytesprops11[] = {0x21, 0xb,  0x85, 0xe,  0x74, 0x8b, 0x62, 0x88, 0xe,  0xd3, 0x75, 0x63, 0x93, 0x6,  0x13,
                            0x90, 0xa9, 0x49, 0x9f, 0x1,  0x39, 0x23, 0x99, 0x9a, 0x5e, 0x9c, 0xa8, 0x56, 0x60, 0x82};
  uint8_t bytesprops10[] = {0x23, 0x5b, 0x1d, 0x2f, 0x77, 0x8a, 0x82, 0xee,
                            0x10, 0xdf, 0x3b, 0x28, 0x32, 0x98, 0x45, 0x80};
  uint8_t bytesprops12[] = {0xb8, 0x49, 0x34, 0x75, 0xdb, 0x44, 0x7c, 0x4e, 0x31, 0x1a, 0x2f, 0x11,
                            0xee, 0x4e, 0x2c, 0x24, 0xde, 0x5,  0xe5, 0xeb, 0x8c, 0x34, 0xa6};
  uint8_t bytesprops14[] = {0xe2, 0xb1, 0xc,  0x8,  0x8d, 0x78, 0xbc, 0x9a, 0xcd, 0xe0, 0x67, 0x29, 0xad,
                            0x79, 0xaa, 0x45, 0x69, 0x55, 0xba, 0x5b, 0x96, 0x3d, 0x1e, 0xe9, 0x26};
  uint8_t bytesprops13[] = {0xca, 0xcf, 0x8f, 0x1c, 0x57, 0x22, 0x96, 0x5a, 0x20, 0x96, 0x2f, 0xea, 0x37, 0x1f, 0x49,
                            0xac, 0x6f, 0xc4, 0x15, 0x72, 0x25, 0xd8, 0x1b, 0xfe, 0xaf, 0xdc, 0x38, 0x87, 0x1c};
  uint8_t bytesprops15[] = {0xef, 0x4a, 0xfa, 0x24, 0x4c, 0xa9, 0xc4, 0xaa, 0xc4, 0x2d, 0x60, 0x48, 0xd9,
                            0x86, 0xe3, 0x74, 0xc,  0x71, 0x0,  0xf9, 0xb2, 0x43, 0x5a, 0x59, 0xff, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14339}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6731}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22863}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5522}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops8}, .v = {13, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&bytesprops10}, .v = {30, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13969}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {29, (char*)&bytesprops13}, .v = {25, (char*)&bytesprops14}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops15}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xe2, 0x7d, 0x5a, 0x7b, 0xa8, 0x7c, 0x4f, 0x4c, 0x1d, 0x9b, 0x29, 0xe5, 0x51, 0xa6};
  uint8_t byteswillprops0[] = {0x72, 0x7c, 0x4d, 0xd,  0x78, 0xc5, 0xa, 0x47, 0x9,  0x93, 0xd7, 0x7d,
                               0x9e, 0xb0, 0xe9, 0x84, 0x43, 0xa4, 0x5, 0x78, 0x60, 0x21, 0x51};
  uint8_t byteswillprops2[] = {0x5c, 0xf5, 0x1e, 0x53, 0xc6, 0x10, 0x59, 0x60, 0x19, 0xd2, 0x25, 0xba, 0x20,
                               0xef, 0xc1, 0xba, 0x53, 0x52, 0xd8, 0x64, 0x23, 0xe,  0x78, 0xef, 0x60, 0x60};
  uint8_t byteswillprops3[] = {0x1e, 0xac, 0x8e};
  uint8_t byteswillprops4[] = {0x9b, 0xf1, 0x50, 0xac, 0x2d, 0xae, 0x8e, 0x1e, 0x78, 0x8b, 0x47,
                               0x33, 0xb4, 0xfa, 0x35, 0xff, 0x21, 0x0,  0xad, 0xa,  0x90};
  uint8_t byteswillprops5[] = {0x5f, 0x21, 0x69, 0x9f, 0x5d, 0xee, 0x5c, 0xf, 0x80, 0xc2, 0xc6, 0xe6, 0x69, 0x8a};
  uint8_t byteswillprops6[] = {0x49, 0x9f, 0x6c, 0xd6, 0xe2, 0x9e, 0xf5, 0x52, 0x8c, 0xd5, 0xc7, 0x9c, 0x63,
                               0x4f, 0xb7, 0xe,  0xf9, 0x51, 0x67, 0x6b, 0x60, 0xa,  0xc8, 0x1c, 0x4d, 0x9};
  uint8_t byteswillprops7[] = {0xe4, 0x96, 0xe9, 0xe3};
  uint8_t byteswillprops8[] = {0x28, 0x28, 0xb6, 0x57, 0x6f, 0xf5, 0x74, 0x3c,
                               0x12, 0xe3, 0xb8, 0xa0, 0xc8, 0x9d, 0x36, 0x94};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30225}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {23, (char*)&byteswillprops0}, .v = {14, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15985}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6436}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 45}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x47, 0xf4, 0xfa, 0xee, 0xad, 0xdc, 0xcc};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28847;
  uint8_t client_id_bytes[] = {0x49, 0x50};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "hWE\168_M\187,\211\130\251B\217\\\139X\246p\GSUQ\252\&7\198\223\143}\191\164",
// _password = Just "\221\"\180", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "/\161\ETX\236\174\202\142\ACK\ENQ&\231\230Zg", _willMsg = "\164:(\192D\224", _willProps = [PropAuthenticationData
// "\218\NAKY\230\f\ETX \198\248\205\147\251\DLEu\240.\197(\243\227\146\144\218_",PropRequestResponseInformation
// 37,PropReasonString "Y\r\183N",PropSharedSubscriptionAvailable 205,PropSubscriptionIdentifier
// 18,PropAuthenticationData "+\248\172\244T[]\133\179",PropMaximumPacketSize 630,PropSubscriptionIdentifierAvailable
// 228,PropRequestProblemInformation 107,PropContentType "\214\202[\223O\227\225mQV\217\"\172\242",PropServerReference
// "\177\SOo\245\225\a\149R\134v<~\212c\ETB \216m-\"^\182\183B\f\238\136\150\245\170",PropPayloadFormatIndicator
// 31,PropSharedSubscriptionAvailable 120,PropWildcardSubscriptionAvailable 66,PropMessageExpiryInterval
// 25661,PropAssignedClientIdentifier
// "G\SO\206\177\226m\129\171\ACK1\155\236\224\213\236O\232\160\156\190\199J_\244",PropPayloadFormatIndicator
// 166,PropMaximumPacketSize 15157,PropWillDelayInterval 26991,PropAuthenticationMethod ";3"]}), _cleanSession = False,
// _keepAlive = 7983, _connID = "\255\v<\218q\253\223)BQ\136u\236\220\156&\164\".", _properties = [PropReasonString
// "\SI\161\162\224u\185\134\v)\236&\235\168\SIXVY\181\201K\STX",PropServerReference "\160",PropSessionExpiryInterval
// 26008,PropResponseTopic
// "u\DC2\DC1HP\158\175=hw\DEL4\248|\244\DC1+\236J\227sU\247\207\134\ETB",PropPayloadFormatIndicator
// 51,PropWildcardSubscriptionAvailable 153,PropSubscriptionIdentifierAvailable 79,PropSharedSubscriptionAvailable
// 34,PropRequestProblemInformation 127,PropRequestResponseInformation 40]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0xce, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0x1f, 0x2f, 0x4a, 0x1f, 0x0,  0x15, 0xf,  0xa1,
      0xa2, 0xe0, 0x75, 0xb9, 0x86, 0xb,  0x29, 0xec, 0x26, 0xeb, 0xa8, 0xf,  0x58, 0x56, 0x59, 0xb5, 0xc9, 0x4b, 0x2,
      0x1c, 0x0,  0x1,  0xa0, 0x11, 0x0,  0x0,  0x65, 0x98, 0x8,  0x0,  0x1a, 0x75, 0x12, 0x11, 0x48, 0x50, 0x9e, 0xaf,
      0x3d, 0x68, 0x77, 0x7f, 0x34, 0xf8, 0x7c, 0xf4, 0x11, 0x2b, 0xec, 0x4a, 0xe3, 0x73, 0x55, 0xf7, 0xcf, 0x86, 0x17,
      0x1,  0x33, 0x28, 0x99, 0x29, 0x4f, 0x2a, 0x22, 0x17, 0x7f, 0x19, 0x28, 0x0,  0x13, 0xff, 0xb,  0x3c, 0xda, 0x71,
      0xfd, 0xdf, 0x29, 0x42, 0x51, 0x88, 0x75, 0xec, 0xdc, 0x9c, 0x26, 0xa4, 0x22, 0x2e, 0xa6, 0x1,  0x16, 0x0,  0x18,
      0xda, 0x15, 0x59, 0xe6, 0xc,  0x3,  0x20, 0xc6, 0xf8, 0xcd, 0x93, 0xfb, 0x10, 0x75, 0xf0, 0x2e, 0xc5, 0x28, 0xf3,
      0xe3, 0x92, 0x90, 0xda, 0x5f, 0x19, 0x25, 0x1f, 0x0,  0x4,  0x59, 0xd,  0xb7, 0x4e, 0x2a, 0xcd, 0xb,  0x12, 0x16,
      0x0,  0x9,  0x2b, 0xf8, 0xac, 0xf4, 0x54, 0x5b, 0x5d, 0x85, 0xb3, 0x27, 0x0,  0x0,  0x2,  0x76, 0x29, 0xe4, 0x17,
      0x6b, 0x3,  0x0,  0xe,  0xd6, 0xca, 0x5b, 0xdf, 0x4f, 0xe3, 0xe1, 0x6d, 0x51, 0x56, 0xd9, 0x22, 0xac, 0xf2, 0x1c,
      0x0,  0x1e, 0xb1, 0xe,  0x6f, 0xf5, 0xe1, 0x7,  0x95, 0x52, 0x86, 0x76, 0x3c, 0x7e, 0xd4, 0x63, 0x17, 0x20, 0xd8,
      0x6d, 0x2d, 0x22, 0x5e, 0xb6, 0xb7, 0x42, 0xc,  0xee, 0x88, 0x96, 0xf5, 0xaa, 0x1,  0x1f, 0x2a, 0x78, 0x28, 0x42,
      0x2,  0x0,  0x0,  0x64, 0x3d, 0x12, 0x0,  0x18, 0x47, 0xe,  0xce, 0xb1, 0xe2, 0x6d, 0x81, 0xab, 0x6,  0x31, 0x9b,
      0xec, 0xe0, 0xd5, 0xec, 0x4f, 0xe8, 0xa0, 0x9c, 0xbe, 0xc7, 0x4a, 0x5f, 0xf4, 0x1,  0xa6, 0x27, 0x0,  0x0,  0x3b,
      0x35, 0x18, 0x0,  0x0,  0x69, 0x6f, 0x15, 0x0,  0x2,  0x3b, 0x33, 0x0,  0xe,  0x2f, 0xa1, 0x3,  0xec, 0xae, 0xca,
      0x8e, 0x6,  0x5,  0x26, 0xe7, 0xe6, 0x5a, 0x67, 0x0,  0x6,  0xa4, 0x3a, 0x28, 0xc0, 0x44, 0xe0, 0x0,  0x1d, 0x68,
      0x57, 0x45, 0xa8, 0x5f, 0x4d, 0xbb, 0x2c, 0xd3, 0x82, 0xfb, 0x42, 0xd9, 0x5c, 0x8b, 0x58, 0xf6, 0x70, 0x1d, 0x55,
      0x51, 0xfc, 0x37, 0xc6, 0xdf, 0x8f, 0x7d, 0xbf, 0xa4, 0x0,  0x3,  0xdd, 0x22, 0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf,  0xa1, 0xa2, 0xe0, 0x75, 0xb9, 0x86, 0xb,  0x29, 0xec, 0x26,
                           0xeb, 0xa8, 0xf,  0x58, 0x56, 0x59, 0xb5, 0xc9, 0x4b, 0x2};
  uint8_t bytesprops1[] = {0xa0};
  uint8_t bytesprops2[] = {0x75, 0x12, 0x11, 0x48, 0x50, 0x9e, 0xaf, 0x3d, 0x68, 0x77, 0x7f, 0x34, 0xf8,
                           0x7c, 0xf4, 0x11, 0x2b, 0xec, 0x4a, 0xe3, 0x73, 0x55, 0xf7, 0xcf, 0x86, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26008}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xda, 0x15, 0x59, 0xe6, 0xc,  0x3,  0x20, 0xc6, 0xf8, 0xcd, 0x93, 0xfb,
                               0x10, 0x75, 0xf0, 0x2e, 0xc5, 0x28, 0xf3, 0xe3, 0x92, 0x90, 0xda, 0x5f};
  uint8_t byteswillprops1[] = {0x59, 0xd, 0xb7, 0x4e};
  uint8_t byteswillprops2[] = {0x2b, 0xf8, 0xac, 0xf4, 0x54, 0x5b, 0x5d, 0x85, 0xb3};
  uint8_t byteswillprops3[] = {0xd6, 0xca, 0x5b, 0xdf, 0x4f, 0xe3, 0xe1, 0x6d, 0x51, 0x56, 0xd9, 0x22, 0xac, 0xf2};
  uint8_t byteswillprops4[] = {0xb1, 0xe,  0x6f, 0xf5, 0xe1, 0x7,  0x95, 0x52, 0x86, 0x76,
                               0x3c, 0x7e, 0xd4, 0x63, 0x17, 0x20, 0xd8, 0x6d, 0x2d, 0x22,
                               0x5e, 0xb6, 0xb7, 0x42, 0xc,  0xee, 0x88, 0x96, 0xf5, 0xaa};
  uint8_t byteswillprops5[] = {0x47, 0xe,  0xce, 0xb1, 0xe2, 0x6d, 0x81, 0xab, 0x6,  0x31, 0x9b, 0xec,
                               0xe0, 0xd5, 0xec, 0x4f, 0xe8, 0xa0, 0x9c, 0xbe, 0xc7, 0x4a, 0x5f, 0xf4};
  uint8_t byteswillprops6[] = {0x3b, 0x33};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 630}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25661}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15157}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26991}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2f, 0xa1, 0x3, 0xec, 0xae, 0xca, 0x8e, 0x6, 0x5, 0x26, 0xe7, 0xe6, 0x5a, 0x67};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x3a, 0x28, 0xc0, 0x44, 0xe0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 7983;
  uint8_t client_id_bytes[] = {0xff, 0xb,  0x3c, 0xda, 0x71, 0xfd, 0xdf, 0x29, 0x42, 0x51,
                               0x88, 0x75, 0xec, 0xdc, 0x9c, 0x26, 0xa4, 0x22, 0x2e};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x68, 0x57, 0x45, 0xa8, 0x5f, 0x4d, 0xbb, 0x2c, 0xd3, 0x82, 0xfb, 0x42, 0xd9, 0x5c, 0x8b,
                              0x58, 0xf6, 0x70, 0x1d, 0x55, 0x51, 0xfc, 0x37, 0xc6, 0xdf, 0x8f, 0x7d, 0xbf, 0xa4};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdd, 0x22, 0xb4};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "I\SI\221-\132?i\130\DC4\231\186", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 15604, _connID = "\246\207\188\170T\240a\203\184x\230X\199\147{8_\SO;\188)",
// _properties = [PropServerReference "\218zK#\138uM",PropServerKeepAlive 3564,PropServerKeepAlive
// 6693,PropResponseTopic "\172\v.\245\225Ll\146\f\240,D\230",PropResponseTopic "",PropWillDelayInterval
// 17189,PropContentType "\147\190Jwf\167\254lJ5\180\168\233\159jG\177o\214o",PropAuthenticationData
// "\211PO\130'\ETB\222\207R\ENQ\f",PropSessionExpiryInterval 54,PropServerKeepAlive 12425,PropServerReference
// "\ACK\222S\204\DC1\141\SO\SI\rV\232\DLE\220&M?\208m\128\192",PropRetainAvailable 171,PropSubscriptionIdentifier
// 10,PropResponseInformation "U\DC2E\145\130\227\240",PropReasonString
// "C\t\DC4\NUL\196\250\218\173\SI\235\233\206)\239\&7\197\170()\157\237\176O\179;\253f\166\a",PropSubscriptionIdentifierAvailable
// 138,PropReasonString "\225\241\222Y\n\234\245\250\252S=\ESC}",PropSharedSubscriptionAvailable 14,PropServerKeepAlive
// 12324,PropMaximumQoS 12,PropMaximumPacketSize 10973,PropMaximumQoS 38,PropWillDelayInterval 7796,PropRetainAvailable
// 21,PropRetainAvailable 93,PropAuthenticationData
// "\199\245\198\230b\156\163I\SYN2\226\ENQ\154u\218\242\206\240\217\160X\254\198",PropSessionExpiryInterval
// 6316,PropServerKeepAlive 2977,PropSharedSubscriptionAvailable 210]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0x97, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x40, 0x3c, 0xf4, 0xe7, 0x1,  0x1c, 0x0,  0x7,  0xda,
      0x7a, 0x4b, 0x23, 0x8a, 0x75, 0x4d, 0x13, 0xd,  0xec, 0x13, 0x1a, 0x25, 0x8,  0x0,  0xd,  0xac, 0xb,  0x2e, 0xf5,
      0xe1, 0x4c, 0x6c, 0x92, 0xc,  0xf0, 0x2c, 0x44, 0xe6, 0x8,  0x0,  0x0,  0x18, 0x0,  0x0,  0x43, 0x25, 0x3,  0x0,
      0x14, 0x93, 0xbe, 0x4a, 0x77, 0x66, 0xa7, 0xfe, 0x6c, 0x4a, 0x35, 0xb4, 0xa8, 0xe9, 0x9f, 0x6a, 0x47, 0xb1, 0x6f,
      0xd6, 0x6f, 0x16, 0x0,  0xb,  0xd3, 0x50, 0x4f, 0x82, 0x27, 0x17, 0xde, 0xcf, 0x52, 0x5,  0xc,  0x11, 0x0,  0x0,
      0x0,  0x36, 0x13, 0x30, 0x89, 0x1c, 0x0,  0x14, 0x6,  0xde, 0x53, 0xcc, 0x11, 0x8d, 0xe,  0xf,  0xd,  0x56, 0xe8,
      0x10, 0xdc, 0x26, 0x4d, 0x3f, 0xd0, 0x6d, 0x80, 0xc0, 0x25, 0xab, 0xb,  0xa,  0x1a, 0x0,  0x7,  0x55, 0x12, 0x45,
      0x91, 0x82, 0xe3, 0xf0, 0x1f, 0x0,  0x1d, 0x43, 0x9,  0x14, 0x0,  0xc4, 0xfa, 0xda, 0xad, 0xf,  0xeb, 0xe9, 0xce,
      0x29, 0xef, 0x37, 0xc5, 0xaa, 0x28, 0x29, 0x9d, 0xed, 0xb0, 0x4f, 0xb3, 0x3b, 0xfd, 0x66, 0xa6, 0x7,  0x29, 0x8a,
      0x1f, 0x0,  0xd,  0xe1, 0xf1, 0xde, 0x59, 0xa,  0xea, 0xf5, 0xfa, 0xfc, 0x53, 0x3d, 0x1b, 0x7d, 0x2a, 0xe,  0x13,
      0x30, 0x24, 0x24, 0xc,  0x27, 0x0,  0x0,  0x2a, 0xdd, 0x24, 0x26, 0x18, 0x0,  0x0,  0x1e, 0x74, 0x25, 0x15, 0x25,
      0x5d, 0x16, 0x0,  0x17, 0xc7, 0xf5, 0xc6, 0xe6, 0x62, 0x9c, 0xa3, 0x49, 0x16, 0x32, 0xe2, 0x5,  0x9a, 0x75, 0xda,
      0xf2, 0xce, 0xf0, 0xd9, 0xa0, 0x58, 0xfe, 0xc6, 0x11, 0x0,  0x0,  0x18, 0xac, 0x13, 0xb,  0xa1, 0x2a, 0xd2, 0x0,
      0x15, 0xf6, 0xcf, 0xbc, 0xaa, 0x54, 0xf0, 0x61, 0xcb, 0xb8, 0x78, 0xe6, 0x58, 0xc7, 0x93, 0x7b, 0x38, 0x5f, 0xe,
      0x3b, 0xbc, 0x29, 0x0,  0xb,  0x49, 0xf,  0xdd, 0x2d, 0x84, 0x3f, 0x69, 0x82, 0x14, 0xe7, 0xba};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xda, 0x7a, 0x4b, 0x23, 0x8a, 0x75, 0x4d};
  uint8_t bytesprops1[] = {0xac, 0xb, 0x2e, 0xf5, 0xe1, 0x4c, 0x6c, 0x92, 0xc, 0xf0, 0x2c, 0x44, 0xe6};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x93, 0xbe, 0x4a, 0x77, 0x66, 0xa7, 0xfe, 0x6c, 0x4a, 0x35,
                           0xb4, 0xa8, 0xe9, 0x9f, 0x6a, 0x47, 0xb1, 0x6f, 0xd6, 0x6f};
  uint8_t bytesprops4[] = {0xd3, 0x50, 0x4f, 0x82, 0x27, 0x17, 0xde, 0xcf, 0x52, 0x5, 0xc};
  uint8_t bytesprops5[] = {0x6,  0xde, 0x53, 0xcc, 0x11, 0x8d, 0xe,  0xf,  0xd,  0x56,
                           0xe8, 0x10, 0xdc, 0x26, 0x4d, 0x3f, 0xd0, 0x6d, 0x80, 0xc0};
  uint8_t bytesprops6[] = {0x55, 0x12, 0x45, 0x91, 0x82, 0xe3, 0xf0};
  uint8_t bytesprops7[] = {0x43, 0x9,  0x14, 0x0,  0xc4, 0xfa, 0xda, 0xad, 0xf,  0xeb, 0xe9, 0xce, 0x29, 0xef, 0x37,
                           0xc5, 0xaa, 0x28, 0x29, 0x9d, 0xed, 0xb0, 0x4f, 0xb3, 0x3b, 0xfd, 0x66, 0xa6, 0x7};
  uint8_t bytesprops8[] = {0xe1, 0xf1, 0xde, 0x59, 0xa, 0xea, 0xf5, 0xfa, 0xfc, 0x53, 0x3d, 0x1b, 0x7d};
  uint8_t bytesprops9[] = {0xc7, 0xf5, 0xc6, 0xe6, 0x62, 0x9c, 0xa3, 0x49, 0x16, 0x32, 0xe2, 0x5,
                           0x9a, 0x75, 0xda, 0xf2, 0xce, 0xf0, 0xd9, 0xa0, 0x58, 0xfe, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3564}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6693}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17189}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 54}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12425}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12324}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10973}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7796}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6316}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2977}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15604;
  uint8_t client_id_bytes[] = {0xf6, 0xcf, 0xbc, 0xaa, 0x54, 0xf0, 0x61, 0xcb, 0xb8, 0x78, 0xe6,
                               0x58, 0xc7, 0x93, 0x7b, 0x38, 0x5f, 0xe,  0x3b, 0xbc, 0x29};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x49, 0xf, 0xdd, 0x2d, 0x84, 0x3f, 0x69, 0x82, 0x14, 0xe7, 0xba};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "Y4l\EOT[\245\243\233\211\199c\CANhx\DC4\190g\175\RS\147\191'\223\137<6", _willMsg =
// "\139|6\245\194\246\236j", _willProps = [PropSessionExpiryInterval 28956,PropTopicAliasMaximum 4577,PropContentType
// "\176\ETX\161\157\200\&4\v^\187\219W5\188[\227\135\128\176\207Cn\"d\236<5\149",PropRequestProblemInformation
// 102,PropResponseInformation "\"\255Z\199r\DLE\132\FS",PropReceiveMaximum 7492,PropAuthenticationMethod
// "o\242\129\170\251\156\\\177\220\238H",PropMaximumPacketSize 1156,PropUserProperty
// "\233^\206P\t\230\215\a_pj\181v\\\164\139\&6\188\203\145\238\233\141\198b\253\206?"
// "\224\161\SUBW\241\184U\252\227\154\SO3\248\140\&3\142\"\187\&4\246\208+2\222TO&u",PropRequestProblemInformation
// 225,PropMaximumQoS 219,PropCorrelationData
// "7mk\"\176\248\240\ACK\205V*\195To\167\187\233\241\162\226|\236",PropMaximumQoS 150,PropWillDelayInterval
// 16062,PropUserProperty "\208\245" "4\128D2K",PropWillDelayInterval 28121,PropWillDelayInterval 3146,PropReasonString
// "\128\DELd\150%Ab\ESC5Y\172*p\212",PropSubscriptionIdentifier 1,PropMessageExpiryInterval 2118]}), _cleanSession =
// True, _keepAlive = 1098, _connID = "\242\250\148C\fX\219\222", _properties = [PropCorrelationData
// "\138\205\206[H\228\194\DC2\177\142\144\248j",PropWillDelayInterval 30821,PropServerKeepAlive
// 14707,PropWildcardSubscriptionAvailable 164,PropPayloadFormatIndicator 50,PropTopicAlias 88,PropResponseTopic
// "\224v\RS\171*[&\184\240*\164\217.\203\170\160J)\241\131",PropRetainAvailable 90,PropResponseInformation
// "\160\238*\184\169^\254\148\137\229\&3,D\f\SOH",PropRetainAvailable 38,PropAuthenticationData
// "\134\211d\157\t\162\\\202\183\EOT\204\165\136X\228\t=\160w\152\186\SUB\209_-J\221\184\&3\240",PropMaximumPacketSize
// 26252,PropAuthenticationData
// "\197\CAN\EMD\205N\ACK\215\191\249\236\v\249\159\253\DC4\SUB\225cS+\161",PropMaximumPacketSize
// 17119,PropAuthenticationMethod "\173\247\CAN!\219\251\SO\202\185\152u\158M.`Y\161<By%y\ETX\DC4",PropRetainAvailable
// 2,PropTopicAliasMaximum 25430]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0xc6, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x16, 0x4,  0x4a, 0xb0, 0x1,  0x9,  0x0,  0xd,  0x8a,
      0xcd, 0xce, 0x5b, 0x48, 0xe4, 0xc2, 0x12, 0xb1, 0x8e, 0x90, 0xf8, 0x6a, 0x18, 0x0,  0x0,  0x78, 0x65, 0x13, 0x39,
      0x73, 0x28, 0xa4, 0x1,  0x32, 0x23, 0x0,  0x58, 0x8,  0x0,  0x14, 0xe0, 0x76, 0x1e, 0xab, 0x2a, 0x5b, 0x26, 0xb8,
      0xf0, 0x2a, 0xa4, 0xd9, 0x2e, 0xcb, 0xaa, 0xa0, 0x4a, 0x29, 0xf1, 0x83, 0x25, 0x5a, 0x1a, 0x0,  0xf,  0xa0, 0xee,
      0x2a, 0xb8, 0xa9, 0x5e, 0xfe, 0x94, 0x89, 0xe5, 0x33, 0x2c, 0x44, 0xc,  0x1,  0x25, 0x26, 0x16, 0x0,  0x1e, 0x86,
      0xd3, 0x64, 0x9d, 0x9,  0xa2, 0x5c, 0xca, 0xb7, 0x4,  0xcc, 0xa5, 0x88, 0x58, 0xe4, 0x9,  0x3d, 0xa0, 0x77, 0x98,
      0xba, 0x1a, 0xd1, 0x5f, 0x2d, 0x4a, 0xdd, 0xb8, 0x33, 0xf0, 0x27, 0x0,  0x0,  0x66, 0x8c, 0x16, 0x0,  0x16, 0xc5,
      0x18, 0x19, 0x44, 0xcd, 0x4e, 0x6,  0xd7, 0xbf, 0xf9, 0xec, 0xb,  0xf9, 0x9f, 0xfd, 0x14, 0x1a, 0xe1, 0x63, 0x53,
      0x2b, 0xa1, 0x27, 0x0,  0x0,  0x42, 0xdf, 0x15, 0x0,  0x18, 0xad, 0xf7, 0x18, 0x21, 0xdb, 0xfb, 0xe,  0xca, 0xb9,
      0x98, 0x75, 0x9e, 0x4d, 0x2e, 0x60, 0x59, 0xa1, 0x3c, 0x42, 0x79, 0x25, 0x79, 0x3,  0x14, 0x25, 0x2,  0x22, 0x63,
      0x56, 0x0,  0x8,  0xf2, 0xfa, 0x94, 0x43, 0xc,  0x58, 0xdb, 0xde, 0xd8, 0x1,  0x11, 0x0,  0x0,  0x71, 0x1c, 0x22,
      0x11, 0xe1, 0x3,  0x0,  0x1b, 0xb0, 0x3,  0xa1, 0x9d, 0xc8, 0x34, 0xb,  0x5e, 0xbb, 0xdb, 0x57, 0x35, 0xbc, 0x5b,
      0xe3, 0x87, 0x80, 0xb0, 0xcf, 0x43, 0x6e, 0x22, 0x64, 0xec, 0x3c, 0x35, 0x95, 0x17, 0x66, 0x1a, 0x0,  0x8,  0x22,
      0xff, 0x5a, 0xc7, 0x72, 0x10, 0x84, 0x1c, 0x21, 0x1d, 0x44, 0x15, 0x0,  0xb,  0x6f, 0xf2, 0x81, 0xaa, 0xfb, 0x9c,
      0x5c, 0xb1, 0xdc, 0xee, 0x48, 0x27, 0x0,  0x0,  0x4,  0x84, 0x26, 0x0,  0x1c, 0xe9, 0x5e, 0xce, 0x50, 0x9,  0xe6,
      0xd7, 0x7,  0x5f, 0x70, 0x6a, 0xb5, 0x76, 0x5c, 0xa4, 0x8b, 0x36, 0xbc, 0xcb, 0x91, 0xee, 0xe9, 0x8d, 0xc6, 0x62,
      0xfd, 0xce, 0x3f, 0x0,  0x1c, 0xe0, 0xa1, 0x1a, 0x57, 0xf1, 0xb8, 0x55, 0xfc, 0xe3, 0x9a, 0xe,  0x33, 0xf8, 0x8c,
      0x33, 0x8e, 0x22, 0xbb, 0x34, 0xf6, 0xd0, 0x2b, 0x32, 0xde, 0x54, 0x4f, 0x26, 0x75, 0x17, 0xe1, 0x24, 0xdb, 0x9,
      0x0,  0x16, 0x37, 0x6d, 0x6b, 0x22, 0xb0, 0xf8, 0xf0, 0x6,  0xcd, 0x56, 0x2a, 0xc3, 0x54, 0x6f, 0xa7, 0xbb, 0xe9,
      0xf1, 0xa2, 0xe2, 0x7c, 0xec, 0x24, 0x96, 0x18, 0x0,  0x0,  0x3e, 0xbe, 0x26, 0x0,  0x2,  0xd0, 0xf5, 0x0,  0x5,
      0x34, 0x80, 0x44, 0x32, 0x4b, 0x18, 0x0,  0x0,  0x6d, 0xd9, 0x18, 0x0,  0x0,  0xc,  0x4a, 0x1f, 0x0,  0xe,  0x80,
      0x7f, 0x64, 0x96, 0x25, 0x41, 0x62, 0x1b, 0x35, 0x59, 0xac, 0x2a, 0x70, 0xd4, 0xb,  0x1,  0x2,  0x0,  0x0,  0x8,
      0x46, 0x0,  0x1a, 0x59, 0x34, 0x6c, 0x4,  0x5b, 0xf5, 0xf3, 0xe9, 0xd3, 0xc7, 0x63, 0x18, 0x68, 0x78, 0x14, 0xbe,
      0x67, 0xaf, 0x1e, 0x93, 0xbf, 0x27, 0xdf, 0x89, 0x3c, 0x36, 0x0,  0x8,  0x8b, 0x7c, 0x36, 0xf5, 0xc2, 0xf6, 0xec,
      0x6a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8a, 0xcd, 0xce, 0x5b, 0x48, 0xe4, 0xc2, 0x12, 0xb1, 0x8e, 0x90, 0xf8, 0x6a};
  uint8_t bytesprops1[] = {0xe0, 0x76, 0x1e, 0xab, 0x2a, 0x5b, 0x26, 0xb8, 0xf0, 0x2a,
                           0xa4, 0xd9, 0x2e, 0xcb, 0xaa, 0xa0, 0x4a, 0x29, 0xf1, 0x83};
  uint8_t bytesprops2[] = {0xa0, 0xee, 0x2a, 0xb8, 0xa9, 0x5e, 0xfe, 0x94, 0x89, 0xe5, 0x33, 0x2c, 0x44, 0xc, 0x1};
  uint8_t bytesprops3[] = {0x86, 0xd3, 0x64, 0x9d, 0x9,  0xa2, 0x5c, 0xca, 0xb7, 0x4,  0xcc, 0xa5, 0x88, 0x58, 0xe4,
                           0x9,  0x3d, 0xa0, 0x77, 0x98, 0xba, 0x1a, 0xd1, 0x5f, 0x2d, 0x4a, 0xdd, 0xb8, 0x33, 0xf0};
  uint8_t bytesprops4[] = {0xc5, 0x18, 0x19, 0x44, 0xcd, 0x4e, 0x6,  0xd7, 0xbf, 0xf9, 0xec,
                           0xb,  0xf9, 0x9f, 0xfd, 0x14, 0x1a, 0xe1, 0x63, 0x53, 0x2b, 0xa1};
  uint8_t bytesprops5[] = {0xad, 0xf7, 0x18, 0x21, 0xdb, 0xfb, 0xe,  0xca, 0xb9, 0x98, 0x75, 0x9e,
                           0x4d, 0x2e, 0x60, 0x59, 0xa1, 0x3c, 0x42, 0x79, 0x25, 0x79, 0x3,  0x14};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30821}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14707}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 88}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26252}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17119}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25430}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb0, 0x3,  0xa1, 0x9d, 0xc8, 0x34, 0xb,  0x5e, 0xbb, 0xdb, 0x57, 0x35, 0xbc, 0x5b,
                               0xe3, 0x87, 0x80, 0xb0, 0xcf, 0x43, 0x6e, 0x22, 0x64, 0xec, 0x3c, 0x35, 0x95};
  uint8_t byteswillprops1[] = {0x22, 0xff, 0x5a, 0xc7, 0x72, 0x10, 0x84, 0x1c};
  uint8_t byteswillprops2[] = {0x6f, 0xf2, 0x81, 0xaa, 0xfb, 0x9c, 0x5c, 0xb1, 0xdc, 0xee, 0x48};
  uint8_t byteswillprops4[] = {0xe0, 0xa1, 0x1a, 0x57, 0xf1, 0xb8, 0x55, 0xfc, 0xe3, 0x9a, 0xe,  0x33, 0xf8, 0x8c,
                               0x33, 0x8e, 0x22, 0xbb, 0x34, 0xf6, 0xd0, 0x2b, 0x32, 0xde, 0x54, 0x4f, 0x26, 0x75};
  uint8_t byteswillprops3[] = {0xe9, 0x5e, 0xce, 0x50, 0x9,  0xe6, 0xd7, 0x7,  0x5f, 0x70, 0x6a, 0xb5, 0x76, 0x5c,
                               0xa4, 0x8b, 0x36, 0xbc, 0xcb, 0x91, 0xee, 0xe9, 0x8d, 0xc6, 0x62, 0xfd, 0xce, 0x3f};
  uint8_t byteswillprops5[] = {0x37, 0x6d, 0x6b, 0x22, 0xb0, 0xf8, 0xf0, 0x6,  0xcd, 0x56, 0x2a,
                               0xc3, 0x54, 0x6f, 0xa7, 0xbb, 0xe9, 0xf1, 0xa2, 0xe2, 0x7c, 0xec};
  uint8_t byteswillprops7[] = {0x34, 0x80, 0x44, 0x32, 0x4b};
  uint8_t byteswillprops6[] = {0xd0, 0xf5};
  uint8_t byteswillprops8[] = {0x80, 0x7f, 0x64, 0x96, 0x25, 0x41, 0x62, 0x1b, 0x35, 0x59, 0xac, 0x2a, 0x70, 0xd4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28956}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4577}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7492}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1156}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {28, (char*)&byteswillprops3}, .v = {28, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16062}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops6}, .v = {5, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28121}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3146}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2118}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x59, 0x34, 0x6c, 0x4,  0x5b, 0xf5, 0xf3, 0xe9, 0xd3, 0xc7, 0x63, 0x18, 0x68,
                                0x78, 0x14, 0xbe, 0x67, 0xaf, 0x1e, 0x93, 0xbf, 0x27, 0xdf, 0x89, 0x3c, 0x36};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8b, 0x7c, 0x36, 0xf5, 0xc2, 0xf6, 0xec, 0x6a};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1098;
  uint8_t client_id_bytes[] = {0xf2, 0xfa, 0x94, 0x43, 0xc, 0x58, 0xdb, 0xde};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\DC3\243\159\217u&\163Y\NAKhh\155\169\&4\142\166\213k\248t\130\212\216\DC3\173\140\DLE\DC4R:", _password = Just
// "&m\142x\192", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\146\238\tq\148_\147\ENQ", _willMsg = "\251", _willProps = [PropReceiveMaximum 7576,PropReasonString
// "\nI~:\143\185i\147\&7\193t\231\156\244@\255\144\192\177P;*\253\161\131\156H\164",PropRetainAvailable
// 43,PropTopicAliasMaximum 27423,PropAuthenticationData
// "\212\EOT\CAN\188\251\142\180\b\NAK\219=\239\157\166J\SI\n\144",PropPayloadFormatIndicator
// 144,PropRequestProblemInformation 99,PropRequestProblemInformation 234]}), _cleanSession = True, _keepAlive = 25890,
// _connID = "\r\156\147\220\152hj\136^\SUB\177\ETX>i", _properties = [PropAuthenticationData
// "\240\143\228\249\190=\241\216!o%E\NUL\128\240",PropReceiveMaximum 23280,PropResponseInformation
// "\191\DELF\142U\209`",PropReasonString
// "S\254\128C\166:z\176#@\231#B\195\240\201r\216\DC3\184\210{\184n\EM\176\nO",PropMessageExpiryInterval
// 24863,PropTopicAlias 28084,PropPayloadFormatIndicator 198,PropCorrelationData
// "[3\254^;\131\231\132\182\151\195l\180X2\220&\231\137DQ\168",PropSharedSubscriptionAvailable 224]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0xf5, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x65, 0x22, 0x63, 0x16, 0x0,  0xf,
                   0xf0, 0x8f, 0xe4, 0xf9, 0xbe, 0x3d, 0xf1, 0xd8, 0x21, 0x6f, 0x25, 0x45, 0x0,  0x80, 0xf0, 0x21, 0x5a,
                   0xf0, 0x1a, 0x0,  0x7,  0xbf, 0x7f, 0x46, 0x8e, 0x55, 0xd1, 0x60, 0x1f, 0x0,  0x1c, 0x53, 0xfe, 0x80,
                   0x43, 0xa6, 0x3a, 0x7a, 0xb0, 0x23, 0x40, 0xe7, 0x23, 0x42, 0xc3, 0xf0, 0xc9, 0x72, 0xd8, 0x13, 0xb8,
                   0xd2, 0x7b, 0xb8, 0x6e, 0x19, 0xb0, 0xa,  0x4f, 0x2,  0x0,  0x0,  0x61, 0x1f, 0x23, 0x6d, 0xb4, 0x1,
                   0xc6, 0x9,  0x0,  0x16, 0x5b, 0x33, 0xfe, 0x5e, 0x3b, 0x83, 0xe7, 0x84, 0xb6, 0x97, 0xc3, 0x6c, 0xb4,
                   0x58, 0x32, 0xdc, 0x26, 0xe7, 0x89, 0x44, 0x51, 0xa8, 0x2a, 0xe0, 0x0,  0xe,  0xd,  0x9c, 0x93, 0xdc,
                   0x98, 0x68, 0x6a, 0x88, 0x5e, 0x1a, 0xb1, 0x3,  0x3e, 0x69, 0x42, 0x21, 0x1d, 0x98, 0x1f, 0x0,  0x1c,
                   0xa,  0x49, 0x7e, 0x3a, 0x8f, 0xb9, 0x69, 0x93, 0x37, 0xc1, 0x74, 0xe7, 0x9c, 0xf4, 0x40, 0xff, 0x90,
                   0xc0, 0xb1, 0x50, 0x3b, 0x2a, 0xfd, 0xa1, 0x83, 0x9c, 0x48, 0xa4, 0x25, 0x2b, 0x22, 0x6b, 0x1f, 0x16,
                   0x0,  0x12, 0xd4, 0x4,  0x18, 0xbc, 0xfb, 0x8e, 0xb4, 0x8,  0x15, 0xdb, 0x3d, 0xef, 0x9d, 0xa6, 0x4a,
                   0xf,  0xa,  0x90, 0x1,  0x90, 0x17, 0x63, 0x17, 0xea, 0x0,  0x8,  0x92, 0xee, 0x9,  0x71, 0x94, 0x5f,
                   0x93, 0x5,  0x0,  0x1,  0xfb, 0x0,  0x1e, 0x13, 0xf3, 0x9f, 0xd9, 0x75, 0x26, 0xa3, 0x59, 0x15, 0x68,
                   0x68, 0x9b, 0xa9, 0x34, 0x8e, 0xa6, 0xd5, 0x6b, 0xf8, 0x74, 0x82, 0xd4, 0xd8, 0x13, 0xad, 0x8c, 0x10,
                   0x14, 0x52, 0x3a, 0x0,  0x5,  0x26, 0x6d, 0x8e, 0x78, 0xc0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf0, 0x8f, 0xe4, 0xf9, 0xbe, 0x3d, 0xf1, 0xd8, 0x21, 0x6f, 0x25, 0x45, 0x0, 0x80, 0xf0};
  uint8_t bytesprops1[] = {0xbf, 0x7f, 0x46, 0x8e, 0x55, 0xd1, 0x60};
  uint8_t bytesprops2[] = {0x53, 0xfe, 0x80, 0x43, 0xa6, 0x3a, 0x7a, 0xb0, 0x23, 0x40, 0xe7, 0x23, 0x42, 0xc3,
                           0xf0, 0xc9, 0x72, 0xd8, 0x13, 0xb8, 0xd2, 0x7b, 0xb8, 0x6e, 0x19, 0xb0, 0xa,  0x4f};
  uint8_t bytesprops3[] = {0x5b, 0x33, 0xfe, 0x5e, 0x3b, 0x83, 0xe7, 0x84, 0xb6, 0x97, 0xc3,
                           0x6c, 0xb4, 0x58, 0x32, 0xdc, 0x26, 0xe7, 0x89, 0x44, 0x51, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23280}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24863}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28084}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa,  0x49, 0x7e, 0x3a, 0x8f, 0xb9, 0x69, 0x93, 0x37, 0xc1, 0x74, 0xe7, 0x9c, 0xf4,
                               0x40, 0xff, 0x90, 0xc0, 0xb1, 0x50, 0x3b, 0x2a, 0xfd, 0xa1, 0x83, 0x9c, 0x48, 0xa4};
  uint8_t byteswillprops1[] = {0xd4, 0x4,  0x18, 0xbc, 0xfb, 0x8e, 0xb4, 0x8, 0x15,
                               0xdb, 0x3d, 0xef, 0x9d, 0xa6, 0x4a, 0xf,  0xa, 0x90};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7576}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27423}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 234}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x92, 0xee, 0x9, 0x71, 0x94, 0x5f, 0x93, 0x5};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25890;
  uint8_t client_id_bytes[] = {0xd, 0x9c, 0x93, 0xdc, 0x98, 0x68, 0x6a, 0x88, 0x5e, 0x1a, 0xb1, 0x3, 0x3e, 0x69};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x13, 0xf3, 0x9f, 0xd9, 0x75, 0x26, 0xa3, 0x59, 0x15, 0x68, 0x68, 0x9b, 0xa9, 0x34, 0x8e,
                              0xa6, 0xd5, 0x6b, 0xf8, 0x74, 0x82, 0xd4, 0xd8, 0x13, 0xad, 0x8c, 0x10, 0x14, 0x52, 0x3a};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x26, 0x6d, 0x8e, 0x78, 0xc0};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\193<~>\224\218\213\230+\253\204S21l", _password = Just "\208`1MG\177\a\230\254",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 24689, _connID =
// "\215'G$\ESCg\194\223\191:\ETX\166\139\193n\180\156\140\165\209\206\tj\241\ETB\237\210\212Jt", _properties =
// [PropAuthenticationMethod "\150\184\NUL\NUL\a@"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x50, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x60, 0x71, 0x9,  0x15, 0x0,  0x6,  0x96,
                   0xb8, 0x0,  0x0,  0x7,  0x40, 0x0,  0x1e, 0xd7, 0x27, 0x47, 0x24, 0x1b, 0x67, 0xc2, 0xdf, 0xbf, 0x3a,
                   0x3,  0xa6, 0x8b, 0xc1, 0x6e, 0xb4, 0x9c, 0x8c, 0xa5, 0xd1, 0xce, 0x9,  0x6a, 0xf1, 0x17, 0xed, 0xd2,
                   0xd4, 0x4a, 0x74, 0x0,  0xf,  0xc1, 0x3c, 0x7e, 0x3e, 0xe0, 0xda, 0xd5, 0xe6, 0x2b, 0xfd, 0xcc, 0x53,
                   0x32, 0x31, 0x6c, 0x0,  0x9,  0xd0, 0x60, 0x31, 0x4d, 0x47, 0xb1, 0x7,  0xe6, 0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x96, 0xb8, 0x0, 0x0, 0x7, 0x40};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24689;
  uint8_t client_id_bytes[] = {0xd7, 0x27, 0x47, 0x24, 0x1b, 0x67, 0xc2, 0xdf, 0xbf, 0x3a,
                               0x3,  0xa6, 0x8b, 0xc1, 0x6e, 0xb4, 0x9c, 0x8c, 0xa5, 0xd1,
                               0xce, 0x9,  0x6a, 0xf1, 0x17, 0xed, 0xd2, 0xd4, 0x4a, 0x74};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc1, 0x3c, 0x7e, 0x3e, 0xe0, 0xda, 0xd5, 0xe6, 0x2b, 0xfd, 0xcc, 0x53, 0x32, 0x31, 0x6c};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd0, 0x60, 0x31, 0x4d, 0x47, 0xb1, 0x7, 0xe6, 0xfe};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\163}\NULy\RS\158NX4\187\195\203rzn\170(\172\129\146(]jr\168Q\169 \195\200", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "", _willMsg = "\244~\217'Tx\238\164\179\193!,\167", _willProps =
// [PropMessageExpiryInterval 19201,PropResponseTopic "\185\213\211",PropSubscriptionIdentifierAvailable
// 223,PropMaximumQoS 244,PropMessageExpiryInterval 23312,PropSubscriptionIdentifierAvailable 97,PropRetainAvailable
// 147,PropResponseTopic "\205\132"]}), _cleanSession = False, _keepAlive = 26060, _connID =
// "ta\163\130\232\170\157\144\190\ETB\172\170g\"\136\233\NAK\NAK\231\ETX\160\SYN~\ENQG\220\208\150\241", _properties =
// []}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x74, 0x65, 0xcc, 0x0,  0x0,  0x1d, 0x74,
                   0x61, 0xa3, 0x82, 0xe8, 0xaa, 0x9d, 0x90, 0xbe, 0x17, 0xac, 0xaa, 0x67, 0x22, 0x88, 0xe9, 0x15,
                   0x15, 0xe7, 0x3,  0xa0, 0x16, 0x7e, 0x5,  0x47, 0xdc, 0xd0, 0x96, 0xf1, 0x1d, 0x2,  0x0,  0x0,
                   0x4b, 0x1,  0x8,  0x0,  0x3,  0xb9, 0xd5, 0xd3, 0x29, 0xdf, 0x24, 0xf4, 0x2,  0x0,  0x0,  0x5b,
                   0x10, 0x29, 0x61, 0x25, 0x93, 0x8,  0x0,  0x2,  0xcd, 0x84, 0x0,  0x0,  0x0,  0xd,  0xf4, 0x7e,
                   0xd9, 0x27, 0x54, 0x78, 0xee, 0xa4, 0xb3, 0xc1, 0x21, 0x2c, 0xa7, 0x0,  0x1e, 0xa3, 0x7d, 0x0,
                   0x79, 0x1e, 0x9e, 0x4e, 0x58, 0x34, 0xbb, 0xc3, 0xcb, 0x72, 0x7a, 0x6e, 0xaa, 0x28, 0xac, 0x81,
                   0x92, 0x28, 0x5d, 0x6a, 0x72, 0xa8, 0x51, 0xa9, 0x20, 0xc3, 0xc8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb9, 0xd5, 0xd3};
  uint8_t byteswillprops1[] = {0xcd, 0x84};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19201}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23312}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf4, 0x7e, 0xd9, 0x27, 0x54, 0x78, 0xee, 0xa4, 0xb3, 0xc1, 0x21, 0x2c, 0xa7};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26060;
  uint8_t client_id_bytes[] = {0x74, 0x61, 0xa3, 0x82, 0xe8, 0xaa, 0x9d, 0x90, 0xbe, 0x17, 0xac, 0xaa, 0x67, 0x22, 0x88,
                               0xe9, 0x15, 0x15, 0xe7, 0x3,  0xa0, 0x16, 0x7e, 0x5,  0x47, 0xdc, 0xd0, 0x96, 0xf1};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa3, 0x7d, 0x0,  0x79, 0x1e, 0x9e, 0x4e, 0x58, 0x34, 0xbb, 0xc3, 0xcb, 0x72, 0x7a, 0x6e,
                              0xaa, 0x28, 0xac, 0x81, 0x92, 0x28, 0x5d, 0x6a, 0x72, 0xa8, 0x51, 0xa9, 0x20, 0xc3, 0xc8};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "b\218e\239\183\CAN\191\&2\226\216\211h\139\177i\206P\217\216\241\162\247\&3Q0\255G", _password = Just
// "\134h4\201\252\b\204\DC1\165,\191\253\vJ\240X^\167\US\159\224(\229f\223c", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS0, _willTopic = "\165Ue\188\167\r\197\235M\161$\227j)\243\233e!X\DC2M\158}", _willMsg =
// ":])y\210Yhl\128}\247\163hG", _willProps = [PropReceiveMaximum 15050,PropSubscriptionIdentifierAvailable
// 199,PropUserProperty "s\ESCo\189\191\148\171\129\227_\197\143o2\156?\140\128#\DC4\EM2Y\240\SYN\190\&1\253\131\172"
// "\175\232\132\189\132jy\166",PropMaximumQoS 67,PropContentType
// "(_}\135\220e\141\198#Z\130\&1\175\130\248\246\187\FS\196\227\132",PropWillDelayInterval 8465,PropRetainAvailable
// 167,PropResponseTopic "\255\142\t\SI\SUB\219\&4\238\188\RSGt\195\184\189\191\236\DEL\200\161",PropReasonString
// "",PropServerReference
// "\235\131\247\&4\SOH\229&`\EM\184P\236\&4\205\228\218\GS\185\179\STX9\ETX\188\251\167",PropResponseTopic
// "d\218\"\196\224\162\&5/",PropSubscriptionIdentifier 26,PropRequestProblemInformation
// 114,PropWildcardSubscriptionAvailable 233,PropMessageExpiryInterval 5629,PropRequestResponseInformation 52]}),
// _cleanSession = False, _keepAlive = 4784, _connID = "o\EOT\144\EOTo`,\SIr\191\185\&6i\246\150\254", _properties =
// [PropSubscriptionIdentifier 16,PropSessionExpiryInterval 4281,PropMaximumPacketSize 6189,PropMaximumPacketSize 1916]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xb1, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x12, 0xb0, 0x11, 0xb,  0x10, 0x11, 0x0,  0x0,
      0x10, 0xb9, 0x27, 0x0,  0x0,  0x18, 0x2d, 0x27, 0x0,  0x0,  0x7,  0x7c, 0x0,  0x10, 0x6f, 0x4,  0x90, 0x4,  0x6f,
      0x60, 0x2c, 0xf,  0x72, 0xbf, 0xb9, 0x36, 0x69, 0xf6, 0x96, 0xfe, 0x9f, 0x1,  0x21, 0x3a, 0xca, 0x29, 0xc7, 0x26,
      0x0,  0x1e, 0x73, 0x1b, 0x6f, 0xbd, 0xbf, 0x94, 0xab, 0x81, 0xe3, 0x5f, 0xc5, 0x8f, 0x6f, 0x32, 0x9c, 0x3f, 0x8c,
      0x80, 0x23, 0x14, 0x19, 0x32, 0x59, 0xf0, 0x16, 0xbe, 0x31, 0xfd, 0x83, 0xac, 0x0,  0x8,  0xaf, 0xe8, 0x84, 0xbd,
      0x84, 0x6a, 0x79, 0xa6, 0x24, 0x43, 0x3,  0x0,  0x15, 0x28, 0x5f, 0x7d, 0x87, 0xdc, 0x65, 0x8d, 0xc6, 0x23, 0x5a,
      0x82, 0x31, 0xaf, 0x82, 0xf8, 0xf6, 0xbb, 0x1c, 0xc4, 0xe3, 0x84, 0x18, 0x0,  0x0,  0x21, 0x11, 0x25, 0xa7, 0x8,
      0x0,  0x14, 0xff, 0x8e, 0x9,  0xf,  0x1a, 0xdb, 0x34, 0xee, 0xbc, 0x1e, 0x47, 0x74, 0xc3, 0xb8, 0xbd, 0xbf, 0xec,
      0x7f, 0xc8, 0xa1, 0x1f, 0x0,  0x0,  0x1c, 0x0,  0x19, 0xeb, 0x83, 0xf7, 0x34, 0x1,  0xe5, 0x26, 0x60, 0x19, 0xb8,
      0x50, 0xec, 0x34, 0xcd, 0xe4, 0xda, 0x1d, 0xb9, 0xb3, 0x2,  0x39, 0x3,  0xbc, 0xfb, 0xa7, 0x8,  0x0,  0x8,  0x64,
      0xda, 0x22, 0xc4, 0xe0, 0xa2, 0x35, 0x2f, 0xb,  0x1a, 0x17, 0x72, 0x28, 0xe9, 0x2,  0x0,  0x0,  0x15, 0xfd, 0x19,
      0x34, 0x0,  0x17, 0xa5, 0x55, 0x65, 0xbc, 0xa7, 0xd,  0xc5, 0xeb, 0x4d, 0xa1, 0x24, 0xe3, 0x6a, 0x29, 0xf3, 0xe9,
      0x65, 0x21, 0x58, 0x12, 0x4d, 0x9e, 0x7d, 0x0,  0xe,  0x3a, 0x5d, 0x29, 0x79, 0xd2, 0x59, 0x68, 0x6c, 0x80, 0x7d,
      0xf7, 0xa3, 0x68, 0x47, 0x0,  0x1b, 0x62, 0xda, 0x65, 0xef, 0xb7, 0x18, 0xbf, 0x32, 0xe2, 0xd8, 0xd3, 0x68, 0x8b,
      0xb1, 0x69, 0xce, 0x50, 0xd9, 0xd8, 0xf1, 0xa2, 0xf7, 0x33, 0x51, 0x30, 0xff, 0x47, 0x0,  0x1a, 0x86, 0x68, 0x34,
      0xc9, 0xfc, 0x8,  0xcc, 0x11, 0xa5, 0x2c, 0xbf, 0xfd, 0xb,  0x4a, 0xf0, 0x58, 0x5e, 0xa7, 0x1f, 0x9f, 0xe0, 0x28,
      0xe5, 0x66, 0xdf, 0x63};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4281}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6189}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1916}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xaf, 0xe8, 0x84, 0xbd, 0x84, 0x6a, 0x79, 0xa6};
  uint8_t byteswillprops0[] = {0x73, 0x1b, 0x6f, 0xbd, 0xbf, 0x94, 0xab, 0x81, 0xe3, 0x5f,
                               0xc5, 0x8f, 0x6f, 0x32, 0x9c, 0x3f, 0x8c, 0x80, 0x23, 0x14,
                               0x19, 0x32, 0x59, 0xf0, 0x16, 0xbe, 0x31, 0xfd, 0x83, 0xac};
  uint8_t byteswillprops2[] = {0x28, 0x5f, 0x7d, 0x87, 0xdc, 0x65, 0x8d, 0xc6, 0x23, 0x5a, 0x82,
                               0x31, 0xaf, 0x82, 0xf8, 0xf6, 0xbb, 0x1c, 0xc4, 0xe3, 0x84};
  uint8_t byteswillprops3[] = {0xff, 0x8e, 0x9,  0xf,  0x1a, 0xdb, 0x34, 0xee, 0xbc, 0x1e,
                               0x47, 0x74, 0xc3, 0xb8, 0xbd, 0xbf, 0xec, 0x7f, 0xc8, 0xa1};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops5[] = {0xeb, 0x83, 0xf7, 0x34, 0x1,  0xe5, 0x26, 0x60, 0x19, 0xb8, 0x50, 0xec, 0x34,
                               0xcd, 0xe4, 0xda, 0x1d, 0xb9, 0xb3, 0x2,  0x39, 0x3,  0xbc, 0xfb, 0xa7};
  uint8_t byteswillprops6[] = {0x64, 0xda, 0x22, 0xc4, 0xe0, 0xa2, 0x35, 0x2f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15050}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops0}, .v = {8, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8465}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5629}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 52}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa5, 0x55, 0x65, 0xbc, 0xa7, 0xd,  0xc5, 0xeb, 0x4d, 0xa1, 0x24, 0xe3,
                                0x6a, 0x29, 0xf3, 0xe9, 0x65, 0x21, 0x58, 0x12, 0x4d, 0x9e, 0x7d};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0x5d, 0x29, 0x79, 0xd2, 0x59, 0x68, 0x6c, 0x80, 0x7d, 0xf7, 0xa3, 0x68, 0x47};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4784;
  uint8_t client_id_bytes[] = {0x6f, 0x4,  0x90, 0x4,  0x6f, 0x60, 0x2c, 0xf,
                               0x72, 0xbf, 0xb9, 0x36, 0x69, 0xf6, 0x96, 0xfe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x62, 0xda, 0x65, 0xef, 0xb7, 0x18, 0xbf, 0x32, 0xe2, 0xd8, 0xd3, 0x68, 0x8b, 0xb1,
                              0x69, 0xce, 0x50, 0xd9, 0xd8, 0xf1, 0xa2, 0xf7, 0x33, 0x51, 0x30, 0xff, 0x47};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x86, 0x68, 0x34, 0xc9, 0xfc, 0x8,  0xcc, 0x11, 0xa5, 0x2c, 0xbf, 0xfd, 0xb,
                              0x4a, 0xf0, 0x58, 0x5e, 0xa7, 0x1f, 0x9f, 0xe0, 0x28, 0xe5, 0x66, 0xdf, 0x63};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%0V8\236", _password = Just "Q\245\GS\148#\160\195\156\184jCX\DC3\EM4k", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "w%h\153A\237", _willMsg = "\GS\201n\b\226\NUL",
// _willProps = []}), _cleanSession = True, _keepAlive = 17312, _connID = "\201\234;\NAKS", _properties =
// [PropRequestResponseInformation 76,PropContentType
// "'\170\&5\197Cf\176cA\203\223\170\234\187\175\145h\241KJ\199\248\153\141/\193\204=\228"]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x5e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x43, 0xa0, 0x22, 0x19, 0x4c, 0x3,
                   0x0,  0x1d, 0x27, 0xaa, 0x35, 0xc5, 0x43, 0x66, 0xb0, 0x63, 0x41, 0xcb, 0xdf, 0xaa, 0xea, 0xbb,
                   0xaf, 0x91, 0x68, 0xf1, 0x4b, 0x4a, 0xc7, 0xf8, 0x99, 0x8d, 0x2f, 0xc1, 0xcc, 0x3d, 0xe4, 0x0,
                   0x5,  0xc9, 0xea, 0x3b, 0x15, 0x53, 0x0,  0x0,  0x6,  0x77, 0x25, 0x68, 0x99, 0x41, 0xed, 0x0,
                   0x6,  0x1d, 0xc9, 0x6e, 0x8,  0xe2, 0x0,  0x0,  0x5,  0x25, 0x30, 0x56, 0x38, 0xec, 0x0,  0x10,
                   0x51, 0xf5, 0x1d, 0x94, 0x23, 0xa0, 0xc3, 0x9c, 0xb8, 0x6a, 0x43, 0x58, 0x13, 0x19, 0x34, 0x6b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x27, 0xaa, 0x35, 0xc5, 0x43, 0x66, 0xb0, 0x63, 0x41, 0xcb, 0xdf, 0xaa, 0xea, 0xbb, 0xaf,
                           0x91, 0x68, 0xf1, 0x4b, 0x4a, 0xc7, 0xf8, 0x99, 0x8d, 0x2f, 0xc1, 0xcc, 0x3d, 0xe4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x77, 0x25, 0x68, 0x99, 0x41, 0xed};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0xc9, 0x6e, 0x8, 0xe2, 0x0};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17312;
  uint8_t client_id_bytes[] = {0xc9, 0xea, 0x3b, 0x15, 0x53};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x30, 0x56, 0x38, 0xec};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x51, 0xf5, 0x1d, 0x94, 0x23, 0xa0, 0xc3, 0x9c,
                              0xb8, 0x6a, 0x43, 0x58, 0x13, 0x19, 0x34, 0x6b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\n\216?v+\184\ACKT", _password = Just "f\232\200\n", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "R\180\EM\225w\208\US\DC2X5\243[\225:a\225\DC17\225BK4", _willMsg
// = "\SUB\214\DC3\210\166<\201\147Vy\142\f\161\223BFAO,\EOT\178OU", _willProps = [PropContentType
// "\170\RS\221\196\153N\EM\178\227\n\153s@",PropTopicAlias 22120,PropRetainAvailable 227,PropRequestProblemInformation
// 243,PropReasonString "\158J\154\178\246a\131\SI\189\144\159\ETX\STX\225}~I\217w\ACK\196",PropMessageExpiryInterval
// 21232]}), _cleanSession = True, _keepAlive = 20729, _connID = ")\f6\175\243\RS\147wQ\178\140rR", _properties =
// [PropSessionExpiryInterval 28247,PropMaximumPacketSize 15308,PropReasonString
// "K\n\241M:\157\f\162\206\NAK*\NAK\188R",PropAssignedClientIdentifier "\165"]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0xaf, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x50, 0xf9, 0x1f, 0x11, 0x0,  0x0,
                   0x6e, 0x57, 0x27, 0x0,  0x0,  0x3b, 0xcc, 0x1f, 0x0,  0xe,  0x4b, 0xa,  0xf1, 0x4d, 0x3a, 0x9d, 0xc,
                   0xa2, 0xce, 0x15, 0x2a, 0x15, 0xbc, 0x52, 0x12, 0x0,  0x1,  0xa5, 0x0,  0xd,  0x29, 0xc,  0x36, 0xaf,
                   0xf3, 0x1e, 0x93, 0x77, 0x51, 0xb2, 0x8c, 0x72, 0x52, 0x34, 0x3,  0x0,  0xd,  0xaa, 0x1e, 0xdd, 0xc4,
                   0x99, 0x4e, 0x19, 0xb2, 0xe3, 0xa,  0x99, 0x73, 0x40, 0x23, 0x56, 0x68, 0x25, 0xe3, 0x17, 0xf3, 0x1f,
                   0x0,  0x15, 0x9e, 0x4a, 0x9a, 0xb2, 0xf6, 0x61, 0x83, 0xf,  0xbd, 0x90, 0x9f, 0x3,  0x2,  0xe1, 0x7d,
                   0x7e, 0x49, 0xd9, 0x77, 0x6,  0xc4, 0x2,  0x0,  0x0,  0x52, 0xf0, 0x0,  0x16, 0x52, 0xb4, 0x19, 0xe1,
                   0x77, 0xd0, 0x1f, 0x12, 0x58, 0x35, 0xf3, 0x5b, 0xe1, 0x3a, 0x61, 0xe1, 0x11, 0x37, 0xe1, 0x42, 0x4b,
                   0x34, 0x0,  0x17, 0x1a, 0xd6, 0x13, 0xd2, 0xa6, 0x3c, 0xc9, 0x93, 0x56, 0x79, 0x8e, 0xc,  0xa1, 0xdf,
                   0x42, 0x46, 0x41, 0x4f, 0x2c, 0x4,  0xb2, 0x4f, 0x55, 0x0,  0x8,  0xa,  0xd8, 0x3f, 0x76, 0x2b, 0xb8,
                   0x6,  0x54, 0x0,  0x4,  0x66, 0xe8, 0xc8, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4b, 0xa, 0xf1, 0x4d, 0x3a, 0x9d, 0xc, 0xa2, 0xce, 0x15, 0x2a, 0x15, 0xbc, 0x52};
  uint8_t bytesprops1[] = {0xa5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28247}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15308}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xaa, 0x1e, 0xdd, 0xc4, 0x99, 0x4e, 0x19, 0xb2, 0xe3, 0xa, 0x99, 0x73, 0x40};
  uint8_t byteswillprops1[] = {0x9e, 0x4a, 0x9a, 0xb2, 0xf6, 0x61, 0x83, 0xf,  0xbd, 0x90, 0x9f,
                               0x3,  0x2,  0xe1, 0x7d, 0x7e, 0x49, 0xd9, 0x77, 0x6,  0xc4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22120}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21232}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x52, 0xb4, 0x19, 0xe1, 0x77, 0xd0, 0x1f, 0x12, 0x58, 0x35, 0xf3,
                                0x5b, 0xe1, 0x3a, 0x61, 0xe1, 0x11, 0x37, 0xe1, 0x42, 0x4b, 0x34};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1a, 0xd6, 0x13, 0xd2, 0xa6, 0x3c, 0xc9, 0x93, 0x56, 0x79, 0x8e, 0xc,
                                  0xa1, 0xdf, 0x42, 0x46, 0x41, 0x4f, 0x2c, 0x4,  0xb2, 0x4f, 0x55};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20729;
  uint8_t client_id_bytes[] = {0x29, 0xc, 0x36, 0xaf, 0xf3, 0x1e, 0x93, 0x77, 0x51, 0xb2, 0x8c, 0x72, 0x52};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa, 0xd8, 0x3f, 0x76, 0x2b, 0xb8, 0x6, 0x54};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x66, 0xe8, 0xc8, 0xa};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\218", _password = Just
// "\157\199_\231w\v\CAN\198\175\204\172\255\223\220\130\250!\147\249\203$a\136\131\EMn\SOHO\252", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 1033, _connID = "\252\aa\128~\196\ESC\154\131\&6\174", _properties =
// [PropResponseInformation "8\246k\235\ESC\161*`-_^\138",PropTopicAliasMaximum 22551,PropAuthenticationMethod
// "L\"\188\172\f5\131\196\151\229q\US\tL\EOT-(\f$\220A<;\201\DLE\156\203",PropServerReference
// "\RSP\ESC{\147!\245\216\151x\b\248f\SYNV\129p=\155t\173",PropContentType
// "&\243-1\242\245(pJ\238WE\202\236",PropTopicAliasMaximum 24056,PropServerReference
// "Y\a=\173B?\244\178Z_\ACK\n\191\172\212\231\208\DC1^;^(Q\191\141\239'\ACKwI",PropUserProperty "\155\a\141\197\170"
// "\138\211\140V\193\192Z\223\GSx\238\253\SUB\216\186\217(\158\&0\"\184\215\220\EM\214\209\211\205",PropSessionExpiryInterval
// 11502,PropAuthenticationMethod
// "\171%8\152\229\a\160^\DC1\US\DC2]\158\151\DC16?3\160\238=J\228",PropAuthenticationData "(!\ETB\219J|",PropMaximumQoS
// 11,PropUserProperty "\226\134\181Z\228B\221\150\244\GS\233\227\&2\US\196\241\149\181q\184k\178\158\251\156o"
// "\194_\DC4>m.W\176M\204\f\212<\245w\151\r\150h\230eU\183\236"]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x10, 0xbf, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x4,  0x9,  0x84, 0x2,  0x1a, 0x0,  0xc,  0x38,
      0xf6, 0x6b, 0xeb, 0x1b, 0xa1, 0x2a, 0x60, 0x2d, 0x5f, 0x5e, 0x8a, 0x22, 0x58, 0x17, 0x15, 0x0,  0x1b, 0x4c, 0x22,
      0xbc, 0xac, 0xc,  0x35, 0x83, 0xc4, 0x97, 0xe5, 0x71, 0x1f, 0x9,  0x4c, 0x4,  0x2d, 0x28, 0xc,  0x24, 0xdc, 0x41,
      0x3c, 0x3b, 0xc9, 0x10, 0x9c, 0xcb, 0x1c, 0x0,  0x15, 0x1e, 0x50, 0x1b, 0x7b, 0x93, 0x21, 0xf5, 0xd8, 0x97, 0x78,
      0x8,  0xf8, 0x66, 0x16, 0x56, 0x81, 0x70, 0x3d, 0x9b, 0x74, 0xad, 0x3,  0x0,  0xe,  0x26, 0xf3, 0x2d, 0x31, 0xf2,
      0xf5, 0x28, 0x70, 0x4a, 0xee, 0x57, 0x45, 0xca, 0xec, 0x22, 0x5d, 0xf8, 0x1c, 0x0,  0x1e, 0x59, 0x7,  0x3d, 0xad,
      0x42, 0x3f, 0xf4, 0xb2, 0x5a, 0x5f, 0x6,  0xa,  0xbf, 0xac, 0xd4, 0xe7, 0xd0, 0x11, 0x5e, 0x3b, 0x5e, 0x28, 0x51,
      0xbf, 0x8d, 0xef, 0x27, 0x6,  0x77, 0x49, 0x26, 0x0,  0x5,  0x9b, 0x7,  0x8d, 0xc5, 0xaa, 0x0,  0x1c, 0x8a, 0xd3,
      0x8c, 0x56, 0xc1, 0xc0, 0x5a, 0xdf, 0x1d, 0x78, 0xee, 0xfd, 0x1a, 0xd8, 0xba, 0xd9, 0x28, 0x9e, 0x30, 0x22, 0xb8,
      0xd7, 0xdc, 0x19, 0xd6, 0xd1, 0xd3, 0xcd, 0x11, 0x0,  0x0,  0x2c, 0xee, 0x15, 0x0,  0x17, 0xab, 0x25, 0x38, 0x98,
      0xe5, 0x7,  0xa0, 0x5e, 0x11, 0x1f, 0x12, 0x5d, 0x9e, 0x97, 0x11, 0x36, 0x3f, 0x33, 0xa0, 0xee, 0x3d, 0x4a, 0xe4,
      0x16, 0x0,  0x6,  0x28, 0x21, 0x17, 0xdb, 0x4a, 0x7c, 0x24, 0xb,  0x26, 0x0,  0x1a, 0xe2, 0x86, 0xb5, 0x5a, 0xe4,
      0x42, 0xdd, 0x96, 0xf4, 0x1d, 0xe9, 0xe3, 0x32, 0x1f, 0xc4, 0xf1, 0x95, 0xb5, 0x71, 0xb8, 0x6b, 0xb2, 0x9e, 0xfb,
      0x9c, 0x6f, 0x0,  0x18, 0xc2, 0x5f, 0x14, 0x3e, 0x6d, 0x2e, 0x57, 0xb0, 0x4d, 0xcc, 0xc,  0xd4, 0x3c, 0xf5, 0x77,
      0x97, 0xd,  0x96, 0x68, 0xe6, 0x65, 0x55, 0xb7, 0xec, 0x0,  0xb,  0xfc, 0x7,  0x61, 0x80, 0x7e, 0xc4, 0x1b, 0x9a,
      0x83, 0x36, 0xae, 0x0,  0x1,  0xda, 0x0,  0x1d, 0x9d, 0xc7, 0x5f, 0xe7, 0x77, 0xb,  0x18, 0xc6, 0xaf, 0xcc, 0xac,
      0xff, 0xdf, 0xdc, 0x82, 0xfa, 0x21, 0x93, 0xf9, 0xcb, 0x24, 0x61, 0x88, 0x83, 0x19, 0x6e, 0x1,  0x4f, 0xfc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x38, 0xf6, 0x6b, 0xeb, 0x1b, 0xa1, 0x2a, 0x60, 0x2d, 0x5f, 0x5e, 0x8a};
  uint8_t bytesprops1[] = {0x4c, 0x22, 0xbc, 0xac, 0xc,  0x35, 0x83, 0xc4, 0x97, 0xe5, 0x71, 0x1f, 0x9, 0x4c,
                           0x4,  0x2d, 0x28, 0xc,  0x24, 0xdc, 0x41, 0x3c, 0x3b, 0xc9, 0x10, 0x9c, 0xcb};
  uint8_t bytesprops2[] = {0x1e, 0x50, 0x1b, 0x7b, 0x93, 0x21, 0xf5, 0xd8, 0x97, 0x78, 0x8,
                           0xf8, 0x66, 0x16, 0x56, 0x81, 0x70, 0x3d, 0x9b, 0x74, 0xad};
  uint8_t bytesprops3[] = {0x26, 0xf3, 0x2d, 0x31, 0xf2, 0xf5, 0x28, 0x70, 0x4a, 0xee, 0x57, 0x45, 0xca, 0xec};
  uint8_t bytesprops4[] = {0x59, 0x7,  0x3d, 0xad, 0x42, 0x3f, 0xf4, 0xb2, 0x5a, 0x5f, 0x6,  0xa,  0xbf, 0xac, 0xd4,
                           0xe7, 0xd0, 0x11, 0x5e, 0x3b, 0x5e, 0x28, 0x51, 0xbf, 0x8d, 0xef, 0x27, 0x6,  0x77, 0x49};
  uint8_t bytesprops6[] = {0x8a, 0xd3, 0x8c, 0x56, 0xc1, 0xc0, 0x5a, 0xdf, 0x1d, 0x78, 0xee, 0xfd, 0x1a, 0xd8,
                           0xba, 0xd9, 0x28, 0x9e, 0x30, 0x22, 0xb8, 0xd7, 0xdc, 0x19, 0xd6, 0xd1, 0xd3, 0xcd};
  uint8_t bytesprops5[] = {0x9b, 0x7, 0x8d, 0xc5, 0xaa};
  uint8_t bytesprops7[] = {0xab, 0x25, 0x38, 0x98, 0xe5, 0x7,  0xa0, 0x5e, 0x11, 0x1f, 0x12, 0x5d,
                           0x9e, 0x97, 0x11, 0x36, 0x3f, 0x33, 0xa0, 0xee, 0x3d, 0x4a, 0xe4};
  uint8_t bytesprops8[] = {0x28, 0x21, 0x17, 0xdb, 0x4a, 0x7c};
  uint8_t bytesprops10[] = {0xc2, 0x5f, 0x14, 0x3e, 0x6d, 0x2e, 0x57, 0xb0, 0x4d, 0xcc, 0xc,  0xd4,
                            0x3c, 0xf5, 0x77, 0x97, 0xd,  0x96, 0x68, 0xe6, 0x65, 0x55, 0xb7, 0xec};
  uint8_t bytesprops9[] = {0xe2, 0x86, 0xb5, 0x5a, 0xe4, 0x42, 0xdd, 0x96, 0xf4, 0x1d, 0xe9, 0xe3, 0x32,
                           0x1f, 0xc4, 0xf1, 0x95, 0xb5, 0x71, 0xb8, 0x6b, 0xb2, 0x9e, 0xfb, 0x9c, 0x6f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22551}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24056}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops5}, .v = {28, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11502}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops9}, .v = {24, (char*)&bytesprops10}}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1033;
  uint8_t client_id_bytes[] = {0xfc, 0x7, 0x61, 0x80, 0x7e, 0xc4, 0x1b, 0x9a, 0x83, 0x36, 0xae};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xda};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x9d, 0xc7, 0x5f, 0xe7, 0x77, 0xb,  0x18, 0xc6, 0xaf, 0xcc, 0xac, 0xff, 0xdf, 0xdc, 0x82,
                              0xfa, 0x21, 0x93, 0xf9, 0xcb, 0x24, 0x61, 0x88, 0x83, 0x19, 0x6e, 0x1,  0x4f, 0xfc};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\140\163RpjPE\225/:\ESC", _password = Just
// "\224\162k\234^k\194\DC3\157\n\DC4\228\216\234\160.o\NAKr\219\DC1\ETB", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\138\162?\130\159\141?\154+\DC4B\246\249\DEL1;-\244\132W;", _willMsg =
// "~j\245\255", _willProps = [PropAuthenticationData "",PropContentType
// "\DLE\229\157\202\219r\251\238\t\128",PropMessageExpiryInterval 31508,PropMaximumQoS 108,PropUserProperty
// "*\245\230\140\139s\239\161" "\255\203\204)D\210\164|\STX."]}), _cleanSession = False, _keepAlive = 9554, _connID =
// "", _properties = [PropReceiveMaximum 164,PropTopicAlias 21466,PropSessionExpiryInterval 7448,PropMaximumQoS
// 142,PropMaximumQoS 68,PropTopicAliasMaximum 7595,PropMessageExpiryInterval 9170,PropContentType
// "\216=",PropCorrelationData "OC\138\206\239\SI\159\SUB\173\221\253\220G\240\149\179",PropResponseTopic
// "\218\SI",PropRequestProblemInformation 196,PropResponseTopic "\DLE\239\205uk\216\200\225R"]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0xc0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0x25, 0x52, 0x42, 0x21, 0x0,  0xa4,
                   0x23, 0x53, 0xda, 0x11, 0x0,  0x0,  0x1d, 0x18, 0x24, 0x8e, 0x24, 0x44, 0x22, 0x1d, 0xab, 0x2,  0x0,
                   0x0,  0x23, 0xd2, 0x3,  0x0,  0x2,  0xd8, 0x3d, 0x9,  0x0,  0x10, 0x4f, 0x43, 0x8a, 0xce, 0xef, 0xf,
                   0x9f, 0x1a, 0xad, 0xdd, 0xfd, 0xdc, 0x47, 0xf0, 0x95, 0xb3, 0x8,  0x0,  0x2,  0xda, 0xf,  0x17, 0xc4,
                   0x8,  0x0,  0x9,  0x10, 0xef, 0xcd, 0x75, 0x6b, 0xd8, 0xc8, 0xe1, 0x52, 0x0,  0x0,  0x2e, 0x16, 0x0,
                   0x0,  0x3,  0x0,  0xa,  0x10, 0xe5, 0x9d, 0xca, 0xdb, 0x72, 0xfb, 0xee, 0x9,  0x80, 0x2,  0x0,  0x0,
                   0x7b, 0x14, 0x24, 0x6c, 0x26, 0x0,  0x8,  0x2a, 0xf5, 0xe6, 0x8c, 0x8b, 0x73, 0xef, 0xa1, 0x0,  0xa,
                   0xff, 0xcb, 0xcc, 0x29, 0x44, 0xd2, 0xa4, 0x7c, 0x2,  0x2e, 0x0,  0x15, 0x8a, 0xa2, 0x3f, 0x82, 0x9f,
                   0x8d, 0x3f, 0x9a, 0x2b, 0x14, 0x42, 0xf6, 0xf9, 0x7f, 0x31, 0x3b, 0x2d, 0xf4, 0x84, 0x57, 0x3b, 0x0,
                   0x4,  0x7e, 0x6a, 0xf5, 0xff, 0x0,  0xb,  0x8c, 0xa3, 0x52, 0x70, 0x6a, 0x50, 0x45, 0xe1, 0x2f, 0x3a,
                   0x1b, 0x0,  0x16, 0xe0, 0xa2, 0x6b, 0xea, 0x5e, 0x6b, 0xc2, 0x13, 0x9d, 0xa,  0x14, 0xe4, 0xd8, 0xea,
                   0xa0, 0x2e, 0x6f, 0x15, 0x72, 0xdb, 0x11, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd8, 0x3d};
  uint8_t bytesprops1[] = {0x4f, 0x43, 0x8a, 0xce, 0xef, 0xf,  0x9f, 0x1a,
                           0xad, 0xdd, 0xfd, 0xdc, 0x47, 0xf0, 0x95, 0xb3};
  uint8_t bytesprops2[] = {0xda, 0xf};
  uint8_t bytesprops3[] = {0x10, 0xef, 0xcd, 0x75, 0x6b, 0xd8, 0xc8, 0xe1, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 164}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21466}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7448}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7595}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9170}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0x10, 0xe5, 0x9d, 0xca, 0xdb, 0x72, 0xfb, 0xee, 0x9, 0x80};
  uint8_t byteswillprops3[] = {0xff, 0xcb, 0xcc, 0x29, 0x44, 0xd2, 0xa4, 0x7c, 0x2, 0x2e};
  uint8_t byteswillprops2[] = {0x2a, 0xf5, 0xe6, 0x8c, 0x8b, 0x73, 0xef, 0xa1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31508}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops2}, .v = {10, (char*)&byteswillprops3}}}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8a, 0xa2, 0x3f, 0x82, 0x9f, 0x8d, 0x3f, 0x9a, 0x2b, 0x14, 0x42,
                                0xf6, 0xf9, 0x7f, 0x31, 0x3b, 0x2d, 0xf4, 0x84, 0x57, 0x3b};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7e, 0x6a, 0xf5, 0xff};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9554;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8c, 0xa3, 0x52, 0x70, 0x6a, 0x50, 0x45, 0xe1, 0x2f, 0x3a, 0x1b};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xa2, 0x6b, 0xea, 0x5e, 0x6b, 0xc2, 0x13, 0x9d, 0xa,  0x14,
                              0xe4, 0xd8, 0xea, 0xa0, 0x2e, 0x6f, 0x15, 0x72, 0xdb, 0x11, 0x17};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\184\n\192\249\GS\b\140\182\DC3\152 }=&7\DC4\181k", _password = Just
// "\150/\SO\220", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\r\243Owl", _willMsg =
// "\251\re\178 \ACK\242Y2h\FS\DEL\160X\254\171\133\v\217\160\DC2p\DC1\207\EM", _willProps = [PropWillDelayInterval
// 123,PropRetainAvailable 53,PropResponseTopic "\fR\199\&6Yt\188\165N<\137\165\193",PropWillDelayInterval
// 20706,PropMaximumQoS 251,PropResponseTopic "\205\163\&8\161\SI\150R\161\226e\162\SI",PropResponseTopic
// "\141\GS\235t0\221_\166\219\b<\236\175\180/\196",PropSessionExpiryInterval 4095,PropPayloadFormatIndicator
// 152,PropMessageExpiryInterval 1317,PropCorrelationData "&\176",PropWillDelayInterval 218]}), _cleanSession = True,
// _keepAlive = 22347, _connID = "\148/\140]", _properties = [PropMessageExpiryInterval
// 26942,PropWildcardSubscriptionAvailable 33,PropWillDelayInterval 28021,PropServerReference
// "\182k\169\204\223\196\170\197\215\199\193KZ\234hw\a\NUL\r\153\184\245\a\DC3H1\EOT",PropResponseInformation
// "D\143",PropSubscriptionIdentifier 5,PropRequestResponseInformation 152,PropAuthenticationMethod
// "\131\r\194\180",PropSubscriptionIdentifierAvailable 165,PropWillDelayInterval 18492,PropSharedSubscriptionAvailable
// 99,PropMessageExpiryInterval 7198]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x10, 0xec, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x57, 0x4b, 0x48, 0x2,  0x0,  0x0,  0x69, 0x3e,
      0x28, 0x21, 0x18, 0x0,  0x0,  0x6d, 0x75, 0x1c, 0x0,  0x1b, 0xb6, 0x6b, 0xa9, 0xcc, 0xdf, 0xc4, 0xaa, 0xc5, 0xd7,
      0xc7, 0xc1, 0x4b, 0x5a, 0xea, 0x68, 0x77, 0x7,  0x0,  0xd,  0x99, 0xb8, 0xf5, 0x7,  0x13, 0x48, 0x31, 0x4,  0x1a,
      0x0,  0x2,  0x44, 0x8f, 0xb,  0x5,  0x19, 0x98, 0x15, 0x0,  0x4,  0x83, 0xd,  0xc2, 0xb4, 0x29, 0xa5, 0x18, 0x0,
      0x0,  0x48, 0x3c, 0x2a, 0x63, 0x2,  0x0,  0x0,  0x1c, 0x1e, 0x0,  0x4,  0x94, 0x2f, 0x8c, 0x5d, 0x56, 0x18, 0x0,
      0x0,  0x0,  0x7b, 0x25, 0x35, 0x8,  0x0,  0xd,  0xc,  0x52, 0xc7, 0x36, 0x59, 0x74, 0xbc, 0xa5, 0x4e, 0x3c, 0x89,
      0xa5, 0xc1, 0x18, 0x0,  0x0,  0x50, 0xe2, 0x24, 0xfb, 0x8,  0x0,  0xc,  0xcd, 0xa3, 0x38, 0xa1, 0xf,  0x96, 0x52,
      0xa1, 0xe2, 0x65, 0xa2, 0xf,  0x8,  0x0,  0x10, 0x8d, 0x1d, 0xeb, 0x74, 0x30, 0xdd, 0x5f, 0xa6, 0xdb, 0x8,  0x3c,
      0xec, 0xaf, 0xb4, 0x2f, 0xc4, 0x11, 0x0,  0x0,  0xf,  0xff, 0x1,  0x98, 0x2,  0x0,  0x0,  0x5,  0x25, 0x9,  0x0,
      0x2,  0x26, 0xb0, 0x18, 0x0,  0x0,  0x0,  0xda, 0x0,  0x5,  0xd,  0xf3, 0x4f, 0x77, 0x6c, 0x0,  0x19, 0xfb, 0xd,
      0x65, 0xb2, 0x20, 0x6,  0xf2, 0x59, 0x32, 0x68, 0x1c, 0x7f, 0xa0, 0x58, 0xfe, 0xab, 0x85, 0xb,  0xd9, 0xa0, 0x12,
      0x70, 0x11, 0xcf, 0x19, 0x0,  0x12, 0xb8, 0xa,  0xc0, 0xf9, 0x1d, 0x8,  0x8c, 0xb6, 0x13, 0x98, 0x20, 0x7d, 0x3d,
      0x26, 0x37, 0x14, 0xb5, 0x6b, 0x0,  0x4,  0x96, 0x2f, 0xe,  0xdc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb6, 0x6b, 0xa9, 0xcc, 0xdf, 0xc4, 0xaa, 0xc5, 0xd7, 0xc7, 0xc1, 0x4b, 0x5a, 0xea,
                           0x68, 0x77, 0x7,  0x0,  0xd,  0x99, 0xb8, 0xf5, 0x7,  0x13, 0x48, 0x31, 0x4};
  uint8_t bytesprops1[] = {0x44, 0x8f};
  uint8_t bytesprops2[] = {0x83, 0xd, 0xc2, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26942}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28021}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18492}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7198}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc, 0x52, 0xc7, 0x36, 0x59, 0x74, 0xbc, 0xa5, 0x4e, 0x3c, 0x89, 0xa5, 0xc1};
  uint8_t byteswillprops1[] = {0xcd, 0xa3, 0x38, 0xa1, 0xf, 0x96, 0x52, 0xa1, 0xe2, 0x65, 0xa2, 0xf};
  uint8_t byteswillprops2[] = {0x8d, 0x1d, 0xeb, 0x74, 0x30, 0xdd, 0x5f, 0xa6,
                               0xdb, 0x8,  0x3c, 0xec, 0xaf, 0xb4, 0x2f, 0xc4};
  uint8_t byteswillprops3[] = {0x26, 0xb0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 123}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20706}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4095}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1317}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 218}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd, 0xf3, 0x4f, 0x77, 0x6c};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0xd,  0x65, 0xb2, 0x20, 0x6,  0xf2, 0x59, 0x32, 0x68, 0x1c, 0x7f, 0xa0,
                                  0x58, 0xfe, 0xab, 0x85, 0xb,  0xd9, 0xa0, 0x12, 0x70, 0x11, 0xcf, 0x19};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22347;
  uint8_t client_id_bytes[] = {0x94, 0x2f, 0x8c, 0x5d};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb8, 0xa,  0xc0, 0xf9, 0x1d, 0x8,  0x8c, 0xb6, 0x13,
                              0x98, 0x20, 0x7d, 0x3d, 0x26, 0x37, 0x14, 0xb5, 0x6b};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x2f, 0xe, 0xdc};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\183\178\ESC", _password = Just "-\203Id", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS1, _willTopic =
// "oH%\176\195\240\217\234x\176Z\ETX\204\SO\DC3\DEL\138\181\252\US\254\147\218:\146\231\\\144", _willMsg = "n\EM\186",
// _willProps = [PropResponseInformation "f\180\145\218\SYNn\169\151N\138\144\b\145\231\229\185",PropTopicAliasMaximum
// 31420,PropSharedSubscriptionAvailable 113,PropUserProperty "|\148\NAK\DLE\152\232\187\204Q;\203\229y"
// "\197T:g",PropRetainAvailable 161,PropReasonString
// ":\142\205q9J\FSV\NUL\\\199C\166\131\194\183\147/\248#V7K~",PropWildcardSubscriptionAvailable
// 173,PropResponseInformation "\173\182\195\225\129\129",PropCorrelationData
// "\DC2\193\207Q\DLE\151\CAN\131\GS\129\195\144\238<P\149",PropMessageExpiryInterval 14703]}), _cleanSession = True,
// _keepAlive = 18592, _connID = "\155j\169\&4\DC3T\219\&4P", _properties = [PropUserProperty
// "\160\253\137\181\224\218]\159" "\FSlo-\v\185\STX\DC3Y`\209[N\166",PropMessageExpiryInterval
// 3165,PropTopicAliasMaximum 30141,PropSubscriptionIdentifier 4,PropServerKeepAlive 25106,PropTopicAlias
// 20555,PropContentType "$WV\209",PropMessageExpiryInterval 6536,PropWildcardSubscriptionAvailable 95,PropResponseTopic
// "\134\150#\DC4\145\181*\217\203\189\&0\230@*\182\v\161\139D_\NUL\NAKV\SOH\251\218\145\US^V",PropReasonString
// "N\211\175),K0\138f\176\216Yj,\166#",PropCorrelationData "\t\156\128{\199",PropPayloadFormatIndicator
// 208,PropRetainAvailable 22,PropSubscriptionIdentifier 28,PropRequestResponseInformation 47,PropResponseInformation
// "&\149\199\164E&1\147\248\r,",PropResponseInformation
// "=\238f|r\147\ETX\215\184\193T`\ESC\171@\140}s\218\186\EMUq\178R\163",PropWillDelayInterval 32409,PropUserProperty
// "_\222\153e\155\184f\145\175\143\SO3\198\225\166\168c'K" "\DC1%\221\149"]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x10, 0xfd, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x48, 0xa0, 0xc9, 0x1,  0x26, 0x0,  0x8,  0xa0,
      0xfd, 0x89, 0xb5, 0xe0, 0xda, 0x5d, 0x9f, 0x0,  0xe,  0x1c, 0x6c, 0x6f, 0x2d, 0xb,  0xb9, 0x2,  0x13, 0x59, 0x60,
      0xd1, 0x5b, 0x4e, 0xa6, 0x2,  0x0,  0x0,  0xc,  0x5d, 0x22, 0x75, 0xbd, 0xb,  0x4,  0x13, 0x62, 0x12, 0x23, 0x50,
      0x4b, 0x3,  0x0,  0x4,  0x24, 0x57, 0x56, 0xd1, 0x2,  0x0,  0x0,  0x19, 0x88, 0x28, 0x5f, 0x8,  0x0,  0x1e, 0x86,
      0x96, 0x23, 0x14, 0x91, 0xb5, 0x2a, 0xd9, 0xcb, 0xbd, 0x30, 0xe6, 0x40, 0x2a, 0xb6, 0xb,  0xa1, 0x8b, 0x44, 0x5f,
      0x0,  0x15, 0x56, 0x1,  0xfb, 0xda, 0x91, 0x1f, 0x5e, 0x56, 0x1f, 0x0,  0x10, 0x4e, 0xd3, 0xaf, 0x29, 0x2c, 0x4b,
      0x30, 0x8a, 0x66, 0xb0, 0xd8, 0x59, 0x6a, 0x2c, 0xa6, 0x23, 0x9,  0x0,  0x5,  0x9,  0x9c, 0x80, 0x7b, 0xc7, 0x1,
      0xd0, 0x25, 0x16, 0xb,  0x1c, 0x19, 0x2f, 0x1a, 0x0,  0xb,  0x26, 0x95, 0xc7, 0xa4, 0x45, 0x26, 0x31, 0x93, 0xf8,
      0xd,  0x2c, 0x1a, 0x0,  0x1a, 0x3d, 0xee, 0x66, 0x7c, 0x72, 0x93, 0x3,  0xd7, 0xb8, 0xc1, 0x54, 0x60, 0x1b, 0xab,
      0x40, 0x8c, 0x7d, 0x73, 0xda, 0xba, 0x19, 0x55, 0x71, 0xb2, 0x52, 0xa3, 0x18, 0x0,  0x0,  0x7e, 0x99, 0x26, 0x0,
      0x13, 0x5f, 0xde, 0x99, 0x65, 0x9b, 0xb8, 0x66, 0x91, 0xaf, 0x8f, 0xe,  0x33, 0xc6, 0xe1, 0xa6, 0xa8, 0x63, 0x27,
      0x4b, 0x0,  0x4,  0x11, 0x25, 0xdd, 0x95, 0x0,  0x9,  0x9b, 0x6a, 0xa9, 0x34, 0x13, 0x54, 0xdb, 0x34, 0x50, 0x6e,
      0x1a, 0x0,  0x10, 0x66, 0xb4, 0x91, 0xda, 0x16, 0x6e, 0xa9, 0x97, 0x4e, 0x8a, 0x90, 0x8,  0x91, 0xe7, 0xe5, 0xb9,
      0x22, 0x7a, 0xbc, 0x2a, 0x71, 0x26, 0x0,  0xd,  0x7c, 0x94, 0x15, 0x10, 0x98, 0xe8, 0xbb, 0xcc, 0x51, 0x3b, 0xcb,
      0xe5, 0x79, 0x0,  0x4,  0xc5, 0x54, 0x3a, 0x67, 0x25, 0xa1, 0x1f, 0x0,  0x18, 0x3a, 0x8e, 0xcd, 0x71, 0x39, 0x4a,
      0x1c, 0x56, 0x0,  0x5c, 0xc7, 0x43, 0xa6, 0x83, 0xc2, 0xb7, 0x93, 0x2f, 0xf8, 0x23, 0x56, 0x37, 0x4b, 0x7e, 0x28,
      0xad, 0x1a, 0x0,  0x6,  0xad, 0xb6, 0xc3, 0xe1, 0x81, 0x81, 0x9,  0x0,  0x10, 0x12, 0xc1, 0xcf, 0x51, 0x10, 0x97,
      0x18, 0x83, 0x1d, 0x81, 0xc3, 0x90, 0xee, 0x3c, 0x50, 0x95, 0x2,  0x0,  0x0,  0x39, 0x6f, 0x0,  0x1c, 0x6f, 0x48,
      0x25, 0xb0, 0xc3, 0xf0, 0xd9, 0xea, 0x78, 0xb0, 0x5a, 0x3,  0xcc, 0xe,  0x13, 0x7f, 0x8a, 0xb5, 0xfc, 0x1f, 0xfe,
      0x93, 0xda, 0x3a, 0x92, 0xe7, 0x5c, 0x90, 0x0,  0x3,  0x6e, 0x19, 0xba, 0x0,  0x3,  0xb7, 0xb2, 0x1b, 0x0,  0x4,
      0x2d, 0xcb, 0x49, 0x64};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x1c, 0x6c, 0x6f, 0x2d, 0xb, 0xb9, 0x2, 0x13, 0x59, 0x60, 0xd1, 0x5b, 0x4e, 0xa6};
  uint8_t bytesprops0[] = {0xa0, 0xfd, 0x89, 0xb5, 0xe0, 0xda, 0x5d, 0x9f};
  uint8_t bytesprops2[] = {0x24, 0x57, 0x56, 0xd1};
  uint8_t bytesprops3[] = {0x86, 0x96, 0x23, 0x14, 0x91, 0xb5, 0x2a, 0xd9, 0xcb, 0xbd, 0x30, 0xe6, 0x40, 0x2a, 0xb6,
                           0xb,  0xa1, 0x8b, 0x44, 0x5f, 0x0,  0x15, 0x56, 0x1,  0xfb, 0xda, 0x91, 0x1f, 0x5e, 0x56};
  uint8_t bytesprops4[] = {0x4e, 0xd3, 0xaf, 0x29, 0x2c, 0x4b, 0x30, 0x8a,
                           0x66, 0xb0, 0xd8, 0x59, 0x6a, 0x2c, 0xa6, 0x23};
  uint8_t bytesprops5[] = {0x9, 0x9c, 0x80, 0x7b, 0xc7};
  uint8_t bytesprops6[] = {0x26, 0x95, 0xc7, 0xa4, 0x45, 0x26, 0x31, 0x93, 0xf8, 0xd, 0x2c};
  uint8_t bytesprops7[] = {0x3d, 0xee, 0x66, 0x7c, 0x72, 0x93, 0x3,  0xd7, 0xb8, 0xc1, 0x54, 0x60, 0x1b,
                           0xab, 0x40, 0x8c, 0x7d, 0x73, 0xda, 0xba, 0x19, 0x55, 0x71, 0xb2, 0x52, 0xa3};
  uint8_t bytesprops9[] = {0x11, 0x25, 0xdd, 0x95};
  uint8_t bytesprops8[] = {0x5f, 0xde, 0x99, 0x65, 0x9b, 0xb8, 0x66, 0x91, 0xaf, 0x8f,
                           0xe,  0x33, 0xc6, 0xe1, 0xa6, 0xa8, 0x63, 0x27, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {14, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3165}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30141}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25106}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20555}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6536}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32409}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops8}, .v = {4, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x66, 0xb4, 0x91, 0xda, 0x16, 0x6e, 0xa9, 0x97,
                               0x4e, 0x8a, 0x90, 0x8,  0x91, 0xe7, 0xe5, 0xb9};
  uint8_t byteswillprops2[] = {0xc5, 0x54, 0x3a, 0x67};
  uint8_t byteswillprops1[] = {0x7c, 0x94, 0x15, 0x10, 0x98, 0xe8, 0xbb, 0xcc, 0x51, 0x3b, 0xcb, 0xe5, 0x79};
  uint8_t byteswillprops3[] = {0x3a, 0x8e, 0xcd, 0x71, 0x39, 0x4a, 0x1c, 0x56, 0x0,  0x5c, 0xc7, 0x43,
                               0xa6, 0x83, 0xc2, 0xb7, 0x93, 0x2f, 0xf8, 0x23, 0x56, 0x37, 0x4b, 0x7e};
  uint8_t byteswillprops4[] = {0xad, 0xb6, 0xc3, 0xe1, 0x81, 0x81};
  uint8_t byteswillprops5[] = {0x12, 0xc1, 0xcf, 0x51, 0x10, 0x97, 0x18, 0x83,
                               0x1d, 0x81, 0xc3, 0x90, 0xee, 0x3c, 0x50, 0x95};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31420}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops1}, .v = {4, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14703}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6f, 0x48, 0x25, 0xb0, 0xc3, 0xf0, 0xd9, 0xea, 0x78, 0xb0, 0x5a, 0x3,  0xcc, 0xe,
                                0x13, 0x7f, 0x8a, 0xb5, 0xfc, 0x1f, 0xfe, 0x93, 0xda, 0x3a, 0x92, 0xe7, 0x5c, 0x90};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6e, 0x19, 0xba};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18592;
  uint8_t client_id_bytes[] = {0x9b, 0x6a, 0xa9, 0x34, 0x13, 0x54, 0xdb, 0x34, 0x50};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb7, 0xb2, 0x1b};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2d, 0xcb, 0x49, 0x64};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\164\207\151\149\193\237\154\&5;\151\f\187\235\141\182k?\198\208\205\150",
// _password = Just "\238\185\&5!R\163\189", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic
// = "\162r\149\182\167\158V@)qJ\240#\236\180\134\195xN", _willMsg = "y\213_\183\130", _willProps =
// [PropAuthenticationData "R\\\236\144#\137\252\195$",PropReasonString
// "Av\206\NUL\183_\206(gv\160xy\173o\231/`\134\158\203\STX\178\156s2",PropResponseTopic
// "e\DLE\244\142!t",PropAuthenticationData "\DEL\130\233",PropServerKeepAlive 14614,PropRetainAvailable
// 134,PropAuthenticationMethod
// "\RS\214\US6_!\166H\236\214\155\138C\202\135\166\225\177\244",PropSharedSubscriptionAvailable
// 79,PropMessageExpiryInterval 8665,PropAssignedClientIdentifier
// ".\186\248\224\STXs\158_\DLEk\ETB\a\141\240",PropServerReference
// "\205(4#-\199\249\135\SIbNPyM\208\161\204\229\192\v\148\DC1\159\142",PropMaximumPacketSize
// 30032,PropSubscriptionIdentifier 4,PropReasonString
// "\209:\SOH\185+\184\207\243\249\235r\210]?\235`k\254gJ\151;\202\&8_\212",PropAuthenticationData
// "\195\&1\168\FS\150\198\248\EOT\213\214\139\227T\166\&0x\DEL",PropSubscriptionIdentifier 21,PropResponseTopic
// "\f;\251r\133\b\ESC\200\219\223\ESC!\141\133\&3\EMs",PropSharedSubscriptionAvailable 79,PropPayloadFormatIndicator
// 243,PropAuthenticationData "(\188A\235r\208`\201\EM](\175t\163\238\217\160X~YK",PropReasonString
// "\131`\137\DELo#\156\223\242\DC1l\140;\218\196f$]6\"S=4\182\176\255\255\151C\ESC",PropServerReference
// "E\166\CAN",PropServerReference
// "\204p\185\183\183m\155\188\238\FS\146\179Mw)\rv\216\&38\213\EM\ACK\128}u",PropCorrelationData
// "\149\232H",PropResponseInformation "\196\ETX|\DC4Kt\142\\\183\217\198\207V\193\"*\r",PropSubscriptionIdentifier
// 25,PropResponseTopic "-\160P\189\&3\rF\142\221\DC2$\181",PropAssignedClientIdentifier "u\235"]}), _cleanSession =
// False, _keepAlive = 10272, _connID = "\171\r5?\187", _properties = [PropMaximumPacketSize 10997,PropResponseTopic
// "VZ\NULK\134\DC2\134\139T\190UA\128\&2\180\196it\181",PropTopicAlias 22484,PropServerReference "0\252\STX
// \131ic\SI\SOe\230]\132'\232\163\225\ACK\233",PropResponseTopic
// "\229?{0\245\191\175\150\NUL\226\r\223\255\171\158\178@p\168\199",PropSessionExpiryInterval 12502,PropTopicAlias
// 14906,PropMessageExpiryInterval 20156,PropAuthenticationData
// "\188\210pR\191\163(zT\168\143\243.4\152\SUB\139\253^",PropResponseInformation
// "\194\225l\143SK\251tv\181G\148\165\131",PropUserProperty
// "\DC2\178\214\143\252\244%#w0\DC2\210\SUB\177\229\bE\173\133" "\237\218",PropRequestProblemInformation
// 140,PropReceiveMaximum 19767,PropReasonString "@w\DC3\143@\STX\178^\ACK\194\158\&3\166\181",PropMessageExpiryInterval
// 3897,PropResponseTopic "\149\r\248",PropAssignedClientIdentifier "\133\DC3|l\231-\186\NAK\ESC",PropMaximumPacketSize
// 5499,PropContentType "\148\199\196\233ai\155c\USL\210\193
// \152}X!\151\187E\DLE\183\151",PropSubscriptionIdentifierAvailable 65,PropWillDelayInterval 15667,PropRetainAvailable
// 157,PropServerKeepAlive 32012,PropMessageExpiryInterval 23157,PropMaximumPacketSize
// 13539,PropSubscriptionIdentifierAvailable 1,PropRequestProblemInformation 232,PropSubscriptionIdentifier 18]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xb6, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x28, 0x20, 0x81, 0x2,  0x27, 0x0,  0x0,  0x2a,
      0xf5, 0x8,  0x0,  0x13, 0x56, 0x5a, 0x0,  0x4b, 0x86, 0x12, 0x86, 0x8b, 0x54, 0xbe, 0x55, 0x41, 0x80, 0x32, 0xb4,
      0xc4, 0x69, 0x74, 0xb5, 0x23, 0x57, 0xd4, 0x1c, 0x0,  0x13, 0x30, 0xfc, 0x2,  0x20, 0x83, 0x69, 0x63, 0xf,  0xe,
      0x65, 0xe6, 0x5d, 0x84, 0x27, 0xe8, 0xa3, 0xe1, 0x6,  0xe9, 0x8,  0x0,  0x14, 0xe5, 0x3f, 0x7b, 0x30, 0xf5, 0xbf,
      0xaf, 0x96, 0x0,  0xe2, 0xd,  0xdf, 0xff, 0xab, 0x9e, 0xb2, 0x40, 0x70, 0xa8, 0xc7, 0x11, 0x0,  0x0,  0x30, 0xd6,
      0x23, 0x3a, 0x3a, 0x2,  0x0,  0x0,  0x4e, 0xbc, 0x16, 0x0,  0x13, 0xbc, 0xd2, 0x70, 0x52, 0xbf, 0xa3, 0x28, 0x7a,
      0x54, 0xa8, 0x8f, 0xf3, 0x2e, 0x34, 0x98, 0x1a, 0x8b, 0xfd, 0x5e, 0x1a, 0x0,  0xe,  0xc2, 0xe1, 0x6c, 0x8f, 0x53,
      0x4b, 0xfb, 0x74, 0x76, 0xb5, 0x47, 0x94, 0xa5, 0x83, 0x26, 0x0,  0x13, 0x12, 0xb2, 0xd6, 0x8f, 0xfc, 0xf4, 0x25,
      0x23, 0x77, 0x30, 0x12, 0xd2, 0x1a, 0xb1, 0xe5, 0x8,  0x45, 0xad, 0x85, 0x0,  0x2,  0xed, 0xda, 0x17, 0x8c, 0x21,
      0x4d, 0x37, 0x1f, 0x0,  0xe,  0x40, 0x77, 0x13, 0x8f, 0x40, 0x2,  0xb2, 0x5e, 0x6,  0xc2, 0x9e, 0x33, 0xa6, 0xb5,
      0x2,  0x0,  0x0,  0xf,  0x39, 0x8,  0x0,  0x3,  0x95, 0xd,  0xf8, 0x12, 0x0,  0x9,  0x85, 0x13, 0x7c, 0x6c, 0xe7,
      0x2d, 0xba, 0x15, 0x1b, 0x27, 0x0,  0x0,  0x15, 0x7b, 0x3,  0x0,  0x17, 0x94, 0xc7, 0xc4, 0xe9, 0x61, 0x69, 0x9b,
      0x63, 0x1f, 0x4c, 0xd2, 0xc1, 0x20, 0x98, 0x7d, 0x58, 0x21, 0x97, 0xbb, 0x45, 0x10, 0xb7, 0x97, 0x29, 0x41, 0x18,
      0x0,  0x0,  0x3d, 0x33, 0x25, 0x9d, 0x13, 0x7d, 0xc,  0x2,  0x0,  0x0,  0x5a, 0x75, 0x27, 0x0,  0x0,  0x34, 0xe3,
      0x29, 0x1,  0x17, 0xe8, 0xb,  0x12, 0x0,  0x5,  0xab, 0xd,  0x35, 0x3f, 0xbb, 0xe4, 0x2,  0x16, 0x0,  0x9,  0x52,
      0x5c, 0xec, 0x90, 0x23, 0x89, 0xfc, 0xc3, 0x24, 0x1f, 0x0,  0x1a, 0x41, 0x76, 0xce, 0x0,  0xb7, 0x5f, 0xce, 0x28,
      0x67, 0x76, 0xa0, 0x78, 0x79, 0xad, 0x6f, 0xe7, 0x2f, 0x60, 0x86, 0x9e, 0xcb, 0x2,  0xb2, 0x9c, 0x73, 0x32, 0x8,
      0x0,  0x6,  0x65, 0x10, 0xf4, 0x8e, 0x21, 0x74, 0x16, 0x0,  0x3,  0x7f, 0x82, 0xe9, 0x13, 0x39, 0x16, 0x25, 0x86,
      0x15, 0x0,  0x13, 0x1e, 0xd6, 0x1f, 0x36, 0x5f, 0x21, 0xa6, 0x48, 0xec, 0xd6, 0x9b, 0x8a, 0x43, 0xca, 0x87, 0xa6,
      0xe1, 0xb1, 0xf4, 0x2a, 0x4f, 0x2,  0x0,  0x0,  0x21, 0xd9, 0x12, 0x0,  0xe,  0x2e, 0xba, 0xf8, 0xe0, 0x2,  0x73,
      0x9e, 0x5f, 0x10, 0x6b, 0x17, 0x7,  0x8d, 0xf0, 0x1c, 0x0,  0x18, 0xcd, 0x28, 0x34, 0x23, 0x2d, 0xc7, 0xf9, 0x87,
      0xf,  0x62, 0x4e, 0x50, 0x79, 0x4d, 0xd0, 0xa1, 0xcc, 0xe5, 0xc0, 0xb,  0x94, 0x11, 0x9f, 0x8e, 0x27, 0x0,  0x0,
      0x75, 0x50, 0xb,  0x4,  0x1f, 0x0,  0x1a, 0xd1, 0x3a, 0x1,  0xb9, 0x2b, 0xb8, 0xcf, 0xf3, 0xf9, 0xeb, 0x72, 0xd2,
      0x5d, 0x3f, 0xeb, 0x60, 0x6b, 0xfe, 0x67, 0x4a, 0x97, 0x3b, 0xca, 0x38, 0x5f, 0xd4, 0x16, 0x0,  0x11, 0xc3, 0x31,
      0xa8, 0x1c, 0x96, 0xc6, 0xf8, 0x4,  0xd5, 0xd6, 0x8b, 0xe3, 0x54, 0xa6, 0x30, 0x78, 0x7f, 0xb,  0x15, 0x8,  0x0,
      0x11, 0xc,  0x3b, 0xfb, 0x72, 0x85, 0x8,  0x1b, 0xc8, 0xdb, 0xdf, 0x1b, 0x21, 0x8d, 0x85, 0x33, 0x19, 0x73, 0x2a,
      0x4f, 0x1,  0xf3, 0x16, 0x0,  0x15, 0x28, 0xbc, 0x41, 0xeb, 0x72, 0xd0, 0x60, 0xc9, 0x19, 0x5d, 0x28, 0xaf, 0x74,
      0xa3, 0xee, 0xd9, 0xa0, 0x58, 0x7e, 0x59, 0x4b, 0x1f, 0x0,  0x1e, 0x83, 0x60, 0x89, 0x7f, 0x6f, 0x23, 0x9c, 0xdf,
      0xf2, 0x11, 0x6c, 0x8c, 0x3b, 0xda, 0xc4, 0x66, 0x24, 0x5d, 0x36, 0x22, 0x53, 0x3d, 0x34, 0xb6, 0xb0, 0xff, 0xff,
      0x97, 0x43, 0x1b, 0x1c, 0x0,  0x3,  0x45, 0xa6, 0x18, 0x1c, 0x0,  0x1a, 0xcc, 0x70, 0xb9, 0xb7, 0xb7, 0x6d, 0x9b,
      0xbc, 0xee, 0x1c, 0x92, 0xb3, 0x4d, 0x77, 0x29, 0xd,  0x76, 0xd8, 0x33, 0x38, 0xd5, 0x19, 0x6,  0x80, 0x7d, 0x75,
      0x9,  0x0,  0x3,  0x95, 0xe8, 0x48, 0x1a, 0x0,  0x11, 0xc4, 0x3,  0x7c, 0x14, 0x4b, 0x74, 0x8e, 0x5c, 0xb7, 0xd9,
      0xc6, 0xcf, 0x56, 0xc1, 0x22, 0x2a, 0xd,  0xb,  0x19, 0x8,  0x0,  0xc,  0x2d, 0xa0, 0x50, 0xbd, 0x33, 0xd,  0x46,
      0x8e, 0xdd, 0x12, 0x24, 0xb5, 0x12, 0x0,  0x2,  0x75, 0xeb, 0x0,  0x13, 0xa2, 0x72, 0x95, 0xb6, 0xa7, 0x9e, 0x56,
      0x40, 0x29, 0x71, 0x4a, 0xf0, 0x23, 0xec, 0xb4, 0x86, 0xc3, 0x78, 0x4e, 0x0,  0x5,  0x79, 0xd5, 0x5f, 0xb7, 0x82,
      0x0,  0x15, 0xa4, 0xcf, 0x97, 0x95, 0xc1, 0xed, 0x9a, 0x35, 0x3b, 0x97, 0xc,  0xbb, 0xeb, 0x8d, 0xb6, 0x6b, 0x3f,
      0xc6, 0xd0, 0xcd, 0x96, 0x0,  0x7,  0xee, 0xb9, 0x35, 0x21, 0x52, 0xa3, 0xbd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x56, 0x5a, 0x0,  0x4b, 0x86, 0x12, 0x86, 0x8b, 0x54, 0xbe,
                           0x55, 0x41, 0x80, 0x32, 0xb4, 0xc4, 0x69, 0x74, 0xb5};
  uint8_t bytesprops1[] = {0x30, 0xfc, 0x2,  0x20, 0x83, 0x69, 0x63, 0xf, 0xe, 0x65,
                           0xe6, 0x5d, 0x84, 0x27, 0xe8, 0xa3, 0xe1, 0x6, 0xe9};
  uint8_t bytesprops2[] = {0xe5, 0x3f, 0x7b, 0x30, 0xf5, 0xbf, 0xaf, 0x96, 0x0,  0xe2,
                           0xd,  0xdf, 0xff, 0xab, 0x9e, 0xb2, 0x40, 0x70, 0xa8, 0xc7};
  uint8_t bytesprops3[] = {0xbc, 0xd2, 0x70, 0x52, 0xbf, 0xa3, 0x28, 0x7a, 0x54, 0xa8,
                           0x8f, 0xf3, 0x2e, 0x34, 0x98, 0x1a, 0x8b, 0xfd, 0x5e};
  uint8_t bytesprops4[] = {0xc2, 0xe1, 0x6c, 0x8f, 0x53, 0x4b, 0xfb, 0x74, 0x76, 0xb5, 0x47, 0x94, 0xa5, 0x83};
  uint8_t bytesprops6[] = {0xed, 0xda};
  uint8_t bytesprops5[] = {0x12, 0xb2, 0xd6, 0x8f, 0xfc, 0xf4, 0x25, 0x23, 0x77, 0x30,
                           0x12, 0xd2, 0x1a, 0xb1, 0xe5, 0x8,  0x45, 0xad, 0x85};
  uint8_t bytesprops7[] = {0x40, 0x77, 0x13, 0x8f, 0x40, 0x2, 0xb2, 0x5e, 0x6, 0xc2, 0x9e, 0x33, 0xa6, 0xb5};
  uint8_t bytesprops8[] = {0x95, 0xd, 0xf8};
  uint8_t bytesprops9[] = {0x85, 0x13, 0x7c, 0x6c, 0xe7, 0x2d, 0xba, 0x15, 0x1b};
  uint8_t bytesprops10[] = {0x94, 0xc7, 0xc4, 0xe9, 0x61, 0x69, 0x9b, 0x63, 0x1f, 0x4c, 0xd2, 0xc1,
                            0x20, 0x98, 0x7d, 0x58, 0x21, 0x97, 0xbb, 0x45, 0x10, 0xb7, 0x97};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10997}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22484}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12502}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14906}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20156}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops5}, .v = {2, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19767}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3897}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5499}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15667}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32012}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23157}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13539}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x52, 0x5c, 0xec, 0x90, 0x23, 0x89, 0xfc, 0xc3, 0x24};
  uint8_t byteswillprops1[] = {0x41, 0x76, 0xce, 0x0,  0xb7, 0x5f, 0xce, 0x28, 0x67, 0x76, 0xa0, 0x78, 0x79,
                               0xad, 0x6f, 0xe7, 0x2f, 0x60, 0x86, 0x9e, 0xcb, 0x2,  0xb2, 0x9c, 0x73, 0x32};
  uint8_t byteswillprops2[] = {0x65, 0x10, 0xf4, 0x8e, 0x21, 0x74};
  uint8_t byteswillprops3[] = {0x7f, 0x82, 0xe9};
  uint8_t byteswillprops4[] = {0x1e, 0xd6, 0x1f, 0x36, 0x5f, 0x21, 0xa6, 0x48, 0xec, 0xd6,
                               0x9b, 0x8a, 0x43, 0xca, 0x87, 0xa6, 0xe1, 0xb1, 0xf4};
  uint8_t byteswillprops5[] = {0x2e, 0xba, 0xf8, 0xe0, 0x2, 0x73, 0x9e, 0x5f, 0x10, 0x6b, 0x17, 0x7, 0x8d, 0xf0};
  uint8_t byteswillprops6[] = {0xcd, 0x28, 0x34, 0x23, 0x2d, 0xc7, 0xf9, 0x87, 0xf,  0x62, 0x4e, 0x50,
                               0x79, 0x4d, 0xd0, 0xa1, 0xcc, 0xe5, 0xc0, 0xb,  0x94, 0x11, 0x9f, 0x8e};
  uint8_t byteswillprops7[] = {0xd1, 0x3a, 0x1,  0xb9, 0x2b, 0xb8, 0xcf, 0xf3, 0xf9, 0xeb, 0x72, 0xd2, 0x5d,
                               0x3f, 0xeb, 0x60, 0x6b, 0xfe, 0x67, 0x4a, 0x97, 0x3b, 0xca, 0x38, 0x5f, 0xd4};
  uint8_t byteswillprops8[] = {0xc3, 0x31, 0xa8, 0x1c, 0x96, 0xc6, 0xf8, 0x4, 0xd5,
                               0xd6, 0x8b, 0xe3, 0x54, 0xa6, 0x30, 0x78, 0x7f};
  uint8_t byteswillprops9[] = {0xc,  0x3b, 0xfb, 0x72, 0x85, 0x8,  0x1b, 0xc8, 0xdb,
                               0xdf, 0x1b, 0x21, 0x8d, 0x85, 0x33, 0x19, 0x73};
  uint8_t byteswillprops10[] = {0x28, 0xbc, 0x41, 0xeb, 0x72, 0xd0, 0x60, 0xc9, 0x19, 0x5d, 0x28,
                                0xaf, 0x74, 0xa3, 0xee, 0xd9, 0xa0, 0x58, 0x7e, 0x59, 0x4b};
  uint8_t byteswillprops11[] = {0x83, 0x60, 0x89, 0x7f, 0x6f, 0x23, 0x9c, 0xdf, 0xf2, 0x11,
                                0x6c, 0x8c, 0x3b, 0xda, 0xc4, 0x66, 0x24, 0x5d, 0x36, 0x22,
                                0x53, 0x3d, 0x34, 0xb6, 0xb0, 0xff, 0xff, 0x97, 0x43, 0x1b};
  uint8_t byteswillprops12[] = {0x45, 0xa6, 0x18};
  uint8_t byteswillprops13[] = {0xcc, 0x70, 0xb9, 0xb7, 0xb7, 0x6d, 0x9b, 0xbc, 0xee, 0x1c, 0x92, 0xb3, 0x4d,
                                0x77, 0x29, 0xd,  0x76, 0xd8, 0x33, 0x38, 0xd5, 0x19, 0x6,  0x80, 0x7d, 0x75};
  uint8_t byteswillprops14[] = {0x95, 0xe8, 0x48};
  uint8_t byteswillprops15[] = {0xc4, 0x3,  0x7c, 0x14, 0x4b, 0x74, 0x8e, 0x5c, 0xb7,
                                0xd9, 0xc6, 0xcf, 0x56, 0xc1, 0x22, 0x2a, 0xd};
  uint8_t byteswillprops16[] = {0x2d, 0xa0, 0x50, 0xbd, 0x33, 0xd, 0x46, 0x8e, 0xdd, 0x12, 0x24, 0xb5};
  uint8_t byteswillprops17[] = {0x75, 0xeb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14614}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8665}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30032}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops15}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&byteswillprops16}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&byteswillprops17}}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa2, 0x72, 0x95, 0xb6, 0xa7, 0x9e, 0x56, 0x40, 0x29, 0x71,
                                0x4a, 0xf0, 0x23, 0xec, 0xb4, 0x86, 0xc3, 0x78, 0x4e};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x79, 0xd5, 0x5f, 0xb7, 0x82};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10272;
  uint8_t client_id_bytes[] = {0xab, 0xd, 0x35, 0x3f, 0xbb};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa4, 0xcf, 0x97, 0x95, 0xc1, 0xed, 0x9a, 0x35, 0x3b, 0x97, 0xc,
                              0xbb, 0xeb, 0x8d, 0xb6, 0x6b, 0x3f, 0xc6, 0xd0, 0xcd, 0x96};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xee, 0xb9, 0x35, 0x21, 0x52, 0xa3, 0xbd};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "\SIj\176\132r\238\172\184r\158pjf\GS\159\&7\185\DEL\211", _willMsg = "", _willProps =
// [PropReceiveMaximum 4017,PropAuthenticationMethod
// "\206\168\167;\232\140\206,\145\144|\f\236",PropAssignedClientIdentifier
// "\DC1O\165O\143\"\165\254\165\247\137X\STX\186\ETX|I\233\&18-",PropServerReference
// "\164u\252\185\r\158\162\t\138\205>\"\ACK\193\196\169S\NAK\223\141\DELg",PropTopicAlias 12500,PropReceiveMaximum
// 14890,PropReceiveMaximum 3217,PropServerKeepAlive 8194,PropReasonString "\184",PropPayloadFormatIndicator
// 210,PropSubscriptionIdentifierAvailable 134,PropResponseInformation
// "\242\217\174[\237\165f6\169\EOT\213\199\197J\228\207",PropServerReference
// "7Q\128\143\234_G\221Q\198\229\\\EOT\166\254\136[\211_\b\199",PropWildcardSubscriptionAvailable 165]}), _cleanSession
// = False, _keepAlive = 10342, _connID = "F/\a\165\170Bk\248\200\ENQ\199\172\&4\128", _properties = [PropUserProperty
// "\RS\ESCZ\205\FS\218\177\250"
// "\198\DC4\DC3\162:\DC4\165B\243\195.\218\FS;\152h\156.\143O\237\176\203\230\&4\197\t}\210",PropReceiveMaximum
// 19041,PropCorrelationData
// "\242\ESC\154\251\US\238\\\191\234$\FS\173\164V\EOT\ETXn\219\151Y\DEL[\227\202\149\177\245\238",PropSubscriptionIdentifierAvailable
// 221,PropResponseTopic
// "\223&\184=>\NULF?\SO\129\141\216\218$\DC3~\250F%=E<\219e'\235\200",PropAssignedClientIdentifier
// "F\176\255\138\130\ENQ\FS1\\@n\218\251\STX",PropRequestProblemInformation 146,PropAuthenticationMethod
// "\210\190\248\ETB>x1'\246*BM\ESC\174W",PropReasonString
// "\217\229\166\165\243\GS\240\181|\143Y\GS\t\169*\US\US\136\135\156W\166\131\145*\130\168'",PropWildcardSubscriptionAvailable
// 143,PropSubscriptionIdentifierAvailable 39,PropMaximumQoS 235,PropWildcardSubscriptionAvailable
// 236,PropMaximumPacketSize 22864,PropUserProperty "\239\ENQ0f" "G\156}\145N\166
// ]\197\223\a\226\163\200W\147}s\217\EM\145\170|\202\t",PropWildcardSubscriptionAvailable 16,PropTopicAlias 18534]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0x9e, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4,  0x28, 0x66, 0xe4, 0x1,  0x26, 0x0,  0x8,  0x1e,
      0x1b, 0x5a, 0xcd, 0x1c, 0xda, 0xb1, 0xfa, 0x0,  0x1d, 0xc6, 0x14, 0x13, 0xa2, 0x3a, 0x14, 0xa5, 0x42, 0xf3, 0xc3,
      0x2e, 0xda, 0x1c, 0x3b, 0x98, 0x68, 0x9c, 0x2e, 0x8f, 0x4f, 0xed, 0xb0, 0xcb, 0xe6, 0x34, 0xc5, 0x9,  0x7d, 0xd2,
      0x21, 0x4a, 0x61, 0x9,  0x0,  0x1c, 0xf2, 0x1b, 0x9a, 0xfb, 0x1f, 0xee, 0x5c, 0xbf, 0xea, 0x24, 0x1c, 0xad, 0xa4,
      0x56, 0x4,  0x3,  0x6e, 0xdb, 0x97, 0x59, 0x7f, 0x5b, 0xe3, 0xca, 0x95, 0xb1, 0xf5, 0xee, 0x29, 0xdd, 0x8,  0x0,
      0x1b, 0xdf, 0x26, 0xb8, 0x3d, 0x3e, 0x0,  0x46, 0x3f, 0xe,  0x81, 0x8d, 0xd8, 0xda, 0x24, 0x13, 0x7e, 0xfa, 0x46,
      0x25, 0x3d, 0x45, 0x3c, 0xdb, 0x65, 0x27, 0xeb, 0xc8, 0x12, 0x0,  0xe,  0x46, 0xb0, 0xff, 0x8a, 0x82, 0x5,  0x1c,
      0x31, 0x5c, 0x40, 0x6e, 0xda, 0xfb, 0x2,  0x17, 0x92, 0x15, 0x0,  0xf,  0xd2, 0xbe, 0xf8, 0x17, 0x3e, 0x78, 0x31,
      0x27, 0xf6, 0x2a, 0x42, 0x4d, 0x1b, 0xae, 0x57, 0x1f, 0x0,  0x1c, 0xd9, 0xe5, 0xa6, 0xa5, 0xf3, 0x1d, 0xf0, 0xb5,
      0x7c, 0x8f, 0x59, 0x1d, 0x9,  0xa9, 0x2a, 0x1f, 0x1f, 0x88, 0x87, 0x9c, 0x57, 0xa6, 0x83, 0x91, 0x2a, 0x82, 0xa8,
      0x27, 0x28, 0x8f, 0x29, 0x27, 0x24, 0xeb, 0x28, 0xec, 0x27, 0x0,  0x0,  0x59, 0x50, 0x26, 0x0,  0x4,  0xef, 0x5,
      0x30, 0x66, 0x0,  0x19, 0x47, 0x9c, 0x7d, 0x91, 0x4e, 0xa6, 0x20, 0x5d, 0xc5, 0xdf, 0x7,  0xe2, 0xa3, 0xc8, 0x57,
      0x93, 0x7d, 0x73, 0xd9, 0x19, 0x91, 0xaa, 0x7c, 0xca, 0x9,  0x28, 0x10, 0x23, 0x48, 0x66, 0x0,  0xe,  0x46, 0x2f,
      0x7,  0xa5, 0xaa, 0x42, 0x6b, 0xf8, 0xc8, 0x5,  0xc7, 0xac, 0x34, 0x80, 0x85, 0x1,  0x21, 0xf,  0xb1, 0x15, 0x0,
      0xd,  0xce, 0xa8, 0xa7, 0x3b, 0xe8, 0x8c, 0xce, 0x2c, 0x91, 0x90, 0x7c, 0xc,  0xec, 0x12, 0x0,  0x15, 0x11, 0x4f,
      0xa5, 0x4f, 0x8f, 0x22, 0xa5, 0xfe, 0xa5, 0xf7, 0x89, 0x58, 0x2,  0xba, 0x3,  0x7c, 0x49, 0xe9, 0x31, 0x38, 0x2d,
      0x1c, 0x0,  0x16, 0xa4, 0x75, 0xfc, 0xb9, 0xd,  0x9e, 0xa2, 0x9,  0x8a, 0xcd, 0x3e, 0x22, 0x6,  0xc1, 0xc4, 0xa9,
      0x53, 0x15, 0xdf, 0x8d, 0x7f, 0x67, 0x23, 0x30, 0xd4, 0x21, 0x3a, 0x2a, 0x21, 0xc,  0x91, 0x13, 0x20, 0x2,  0x1f,
      0x0,  0x1,  0xb8, 0x1,  0xd2, 0x29, 0x86, 0x1a, 0x0,  0x10, 0xf2, 0xd9, 0xae, 0x5b, 0xed, 0xa5, 0x66, 0x36, 0xa9,
      0x4,  0xd5, 0xc7, 0xc5, 0x4a, 0xe4, 0xcf, 0x1c, 0x0,  0x15, 0x37, 0x51, 0x80, 0x8f, 0xea, 0x5f, 0x47, 0xdd, 0x51,
      0xc6, 0xe5, 0x5c, 0x4,  0xa6, 0xfe, 0x88, 0x5b, 0xd3, 0x5f, 0x8,  0xc7, 0x28, 0xa5, 0x0,  0x13, 0xf,  0x6a, 0xb0,
      0x84, 0x72, 0xee, 0xac, 0xb8, 0x72, 0x9e, 0x70, 0x6a, 0x66, 0x1d, 0x9f, 0x37, 0xb9, 0x7f, 0xd3, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xc6, 0x14, 0x13, 0xa2, 0x3a, 0x14, 0xa5, 0x42, 0xf3, 0xc3, 0x2e, 0xda, 0x1c, 0x3b, 0x98,
                           0x68, 0x9c, 0x2e, 0x8f, 0x4f, 0xed, 0xb0, 0xcb, 0xe6, 0x34, 0xc5, 0x9,  0x7d, 0xd2};
  uint8_t bytesprops0[] = {0x1e, 0x1b, 0x5a, 0xcd, 0x1c, 0xda, 0xb1, 0xfa};
  uint8_t bytesprops2[] = {0xf2, 0x1b, 0x9a, 0xfb, 0x1f, 0xee, 0x5c, 0xbf, 0xea, 0x24, 0x1c, 0xad, 0xa4, 0x56,
                           0x4,  0x3,  0x6e, 0xdb, 0x97, 0x59, 0x7f, 0x5b, 0xe3, 0xca, 0x95, 0xb1, 0xf5, 0xee};
  uint8_t bytesprops3[] = {0xdf, 0x26, 0xb8, 0x3d, 0x3e, 0x0,  0x46, 0x3f, 0xe,  0x81, 0x8d, 0xd8, 0xda, 0x24,
                           0x13, 0x7e, 0xfa, 0x46, 0x25, 0x3d, 0x45, 0x3c, 0xdb, 0x65, 0x27, 0xeb, 0xc8};
  uint8_t bytesprops4[] = {0x46, 0xb0, 0xff, 0x8a, 0x82, 0x5, 0x1c, 0x31, 0x5c, 0x40, 0x6e, 0xda, 0xfb, 0x2};
  uint8_t bytesprops5[] = {0xd2, 0xbe, 0xf8, 0x17, 0x3e, 0x78, 0x31, 0x27, 0xf6, 0x2a, 0x42, 0x4d, 0x1b, 0xae, 0x57};
  uint8_t bytesprops6[] = {0xd9, 0xe5, 0xa6, 0xa5, 0xf3, 0x1d, 0xf0, 0xb5, 0x7c, 0x8f, 0x59, 0x1d, 0x9,  0xa9,
                           0x2a, 0x1f, 0x1f, 0x88, 0x87, 0x9c, 0x57, 0xa6, 0x83, 0x91, 0x2a, 0x82, 0xa8, 0x27};
  uint8_t bytesprops8[] = {0x47, 0x9c, 0x7d, 0x91, 0x4e, 0xa6, 0x20, 0x5d, 0xc5, 0xdf, 0x7,  0xe2, 0xa3,
                           0xc8, 0x57, 0x93, 0x7d, 0x73, 0xd9, 0x19, 0x91, 0xaa, 0x7c, 0xca, 0x9};
  uint8_t bytesprops7[] = {0xef, 0x5, 0x30, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {29, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19041}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22864}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops7}, .v = {25, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18534}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xce, 0xa8, 0xa7, 0x3b, 0xe8, 0x8c, 0xce, 0x2c, 0x91, 0x90, 0x7c, 0xc, 0xec};
  uint8_t byteswillprops1[] = {0x11, 0x4f, 0xa5, 0x4f, 0x8f, 0x22, 0xa5, 0xfe, 0xa5, 0xf7, 0x89,
                               0x58, 0x2,  0xba, 0x3,  0x7c, 0x49, 0xe9, 0x31, 0x38, 0x2d};
  uint8_t byteswillprops2[] = {0xa4, 0x75, 0xfc, 0xb9, 0xd,  0x9e, 0xa2, 0x9,  0x8a, 0xcd, 0x3e,
                               0x22, 0x6,  0xc1, 0xc4, 0xa9, 0x53, 0x15, 0xdf, 0x8d, 0x7f, 0x67};
  uint8_t byteswillprops3[] = {0xb8};
  uint8_t byteswillprops4[] = {0xf2, 0xd9, 0xae, 0x5b, 0xed, 0xa5, 0x66, 0x36,
                               0xa9, 0x4,  0xd5, 0xc7, 0xc5, 0x4a, 0xe4, 0xcf};
  uint8_t byteswillprops5[] = {0x37, 0x51, 0x80, 0x8f, 0xea, 0x5f, 0x47, 0xdd, 0x51, 0xc6, 0xe5,
                               0x5c, 0x4,  0xa6, 0xfe, 0x88, 0x5b, 0xd3, 0x5f, 0x8,  0xc7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4017}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12500}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14890}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3217}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8194}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 165}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf,  0x6a, 0xb0, 0x84, 0x72, 0xee, 0xac, 0xb8, 0x72, 0x9e,
                                0x70, 0x6a, 0x66, 0x1d, 0x9f, 0x37, 0xb9, 0x7f, 0xd3};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10342;
  uint8_t client_id_bytes[] = {0x46, 0x2f, 0x7, 0xa5, 0xaa, 0x42, 0x6b, 0xf8, 0xc8, 0x5, 0xc7, 0xac, 0x34, 0x80};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\177,\US\162\249\rU", _password = Just "\186$\184J\CAN:\210T\160t\185\242",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\248\192cB\223\ACK\132s!q\246\236pQ-R", _willMsg = "@\152\ETBp\180{\SI\148\180\&8\r\230\252vY\151]\223/\232&n",
// _willProps = [PropCorrelationData "\178\203fb\158\n\239\218\DC2\164\199\133\164\130\GS\SO\213",PropTopicAliasMaximum
// 32637,PropSharedSubscriptionAvailable 101,PropReasonString "Z|\141~x",PropAuthenticationData
// "{*v\171vl\186\&2\191U\SI\223\170\196\n\129\185\249\246\253Q\EOT\203j",PropRequestProblemInformation
// 201,PropAuthenticationMethod "\\z\201\239\DC3\185\218B\ETB\ETX\237\176\211m\161`",PropRequestProblemInformation
// 115,PropResponseInformation "hY\161m\164\US\221\ETBpI\203;a\223\230\155\NUL\232",PropRequestProblemInformation
// 25,PropPayloadFormatIndicator 245,PropMessageExpiryInterval 23460,PropSessionExpiryInterval 989,PropTopicAlias
// 10792,PropMaximumPacketSize 20351,PropSharedSubscriptionAvailable 225]}), _cleanSession = True, _keepAlive = 1497,
// _connID = "\ENQfB\178\EOT\DLE\139\233\169H\233\GS[", _properties = [PropResponseTopic
// "}\204\DC2B\159\NAK\157r\222[;\150\193UE\183\nIE\176\158\129\192,\158\&1\188\SUB\193",PropTopicAlias
// 19059,PropAuthenticationMethod "=Gp\247\239\214A\203\133\255\133ss@\249&|\133\178@\244\236/Z\190",PropUserProperty
// "\138\ACK\167\217\209F\179\232\164\GSw\209rgT\NAKQ\193\224\178\176M"
// ")\246\DLE;\207\192BLHX\239\160l\DELp\136\f^_F=\143",PropMaximumPacketSize 14420,PropSessionExpiryInterval
// 695,PropServerReference "{1\174\242-\131\182\SO\156\193'\EOTY\DEL;\131_",PropRequestProblemInformation
// 218,PropSubscriptionIdentifier 20,PropMessageExpiryInterval 757,PropCorrelationData
// "\170\RS\210\161H\195\SO\EM\224\247\251\211\143\153G\DLE(\150\202",PropSessionExpiryInterval
// 10859,PropPayloadFormatIndicator 138,PropRequestProblemInformation 9,PropUserProperty
// "\166\140\&0\t\245~\STX\156N\157,_I\RS;\141"
// "\128\&8\229\128\&4?h\145\a\128\&25\129",PropSubscriptionIdentifierAvailable 71,PropSubscriptionIdentifierAvailable
// 24,PropSubscriptionIdentifier 22,PropTopicAlias 25715,PropRequestProblemInformation 58,PropRequestProblemInformation
// 211,PropMessageExpiryInterval 15137,PropTopicAlias 18099]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x5,  0xd9, 0xed, 0x1,  0x8,  0x0,  0x1d, 0x7d,
      0xcc, 0x12, 0x42, 0x9f, 0x15, 0x9d, 0x72, 0xde, 0x5b, 0x3b, 0x96, 0xc1, 0x55, 0x45, 0xb7, 0xa,  0x49, 0x45, 0xb0,
      0x9e, 0x81, 0xc0, 0x2c, 0x9e, 0x31, 0xbc, 0x1a, 0xc1, 0x23, 0x4a, 0x73, 0x15, 0x0,  0x19, 0x3d, 0x47, 0x70, 0xf7,
      0xef, 0xd6, 0x41, 0xcb, 0x85, 0xff, 0x85, 0x73, 0x73, 0x40, 0xf9, 0x26, 0x7c, 0x85, 0xb2, 0x40, 0xf4, 0xec, 0x2f,
      0x5a, 0xbe, 0x26, 0x0,  0x16, 0x8a, 0x6,  0xa7, 0xd9, 0xd1, 0x46, 0xb3, 0xe8, 0xa4, 0x1d, 0x77, 0xd1, 0x72, 0x67,
      0x54, 0x15, 0x51, 0xc1, 0xe0, 0xb2, 0xb0, 0x4d, 0x0,  0x16, 0x29, 0xf6, 0x10, 0x3b, 0xcf, 0xc0, 0x42, 0x4c, 0x48,
      0x58, 0xef, 0xa0, 0x6c, 0x7f, 0x70, 0x88, 0xc,  0x5e, 0x5f, 0x46, 0x3d, 0x8f, 0x27, 0x0,  0x0,  0x38, 0x54, 0x11,
      0x0,  0x0,  0x2,  0xb7, 0x1c, 0x0,  0x11, 0x7b, 0x31, 0xae, 0xf2, 0x2d, 0x83, 0xb6, 0xe,  0x9c, 0xc1, 0x27, 0x4,
      0x59, 0x7f, 0x3b, 0x83, 0x5f, 0x17, 0xda, 0xb,  0x14, 0x2,  0x0,  0x0,  0x2,  0xf5, 0x9,  0x0,  0x13, 0xaa, 0x1e,
      0xd2, 0xa1, 0x48, 0xc3, 0xe,  0x19, 0xe0, 0xf7, 0xfb, 0xd3, 0x8f, 0x99, 0x47, 0x10, 0x28, 0x96, 0xca, 0x11, 0x0,
      0x0,  0x2a, 0x6b, 0x1,  0x8a, 0x17, 0x9,  0x26, 0x0,  0x10, 0xa6, 0x8c, 0x30, 0x9,  0xf5, 0x7e, 0x2,  0x9c, 0x4e,
      0x9d, 0x2c, 0x5f, 0x49, 0x1e, 0x3b, 0x8d, 0x0,  0xd,  0x80, 0x38, 0xe5, 0x80, 0x34, 0x3f, 0x68, 0x91, 0x7,  0x80,
      0x32, 0x35, 0x81, 0x29, 0x47, 0x29, 0x18, 0xb,  0x16, 0x23, 0x64, 0x73, 0x17, 0x3a, 0x17, 0xd3, 0x2,  0x0,  0x0,
      0x3b, 0x21, 0x23, 0x46, 0xb3, 0x0,  0xd,  0x5,  0x66, 0x42, 0xb2, 0x4,  0x10, 0x8b, 0xe9, 0xa9, 0x48, 0xe9, 0x1d,
      0x5b, 0x80, 0x1,  0x9,  0x0,  0x11, 0xb2, 0xcb, 0x66, 0x62, 0x9e, 0xa,  0xef, 0xda, 0x12, 0xa4, 0xc7, 0x85, 0xa4,
      0x82, 0x1d, 0xe,  0xd5, 0x22, 0x7f, 0x7d, 0x2a, 0x65, 0x1f, 0x0,  0x5,  0x5a, 0x7c, 0x8d, 0x7e, 0x78, 0x16, 0x0,
      0x18, 0x7b, 0x2a, 0x76, 0xab, 0x76, 0x6c, 0xba, 0x32, 0xbf, 0x55, 0xf,  0xdf, 0xaa, 0xc4, 0xa,  0x81, 0xb9, 0xf9,
      0xf6, 0xfd, 0x51, 0x4,  0xcb, 0x6a, 0x17, 0xc9, 0x15, 0x0,  0x10, 0x5c, 0x7a, 0xc9, 0xef, 0x13, 0xb9, 0xda, 0x42,
      0x17, 0x3,  0xed, 0xb0, 0xd3, 0x6d, 0xa1, 0x60, 0x17, 0x73, 0x1a, 0x0,  0x12, 0x68, 0x59, 0xa1, 0x6d, 0xa4, 0x1f,
      0xdd, 0x17, 0x70, 0x49, 0xcb, 0x3b, 0x61, 0xdf, 0xe6, 0x9b, 0x0,  0xe8, 0x17, 0x19, 0x1,  0xf5, 0x2,  0x0,  0x0,
      0x5b, 0xa4, 0x11, 0x0,  0x0,  0x3,  0xdd, 0x23, 0x2a, 0x28, 0x27, 0x0,  0x0,  0x4f, 0x7f, 0x2a, 0xe1, 0x0,  0x10,
      0xf8, 0xc0, 0x63, 0x42, 0xdf, 0x6,  0x84, 0x73, 0x21, 0x71, 0xf6, 0xec, 0x70, 0x51, 0x2d, 0x52, 0x0,  0x16, 0x40,
      0x98, 0x17, 0x70, 0xb4, 0x7b, 0xf,  0x94, 0xb4, 0x38, 0xd,  0xe6, 0xfc, 0x76, 0x59, 0x97, 0x5d, 0xdf, 0x2f, 0xe8,
      0x26, 0x6e, 0x0,  0x7,  0xb1, 0x2c, 0x1f, 0xa2, 0xf9, 0xd,  0x55, 0x0,  0xc,  0xba, 0x24, 0xb8, 0x4a, 0x18, 0x3a,
      0xd2, 0x54, 0xa0, 0x74, 0xb9, 0xf2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7d, 0xcc, 0x12, 0x42, 0x9f, 0x15, 0x9d, 0x72, 0xde, 0x5b, 0x3b, 0x96, 0xc1, 0x55, 0x45,
                           0xb7, 0xa,  0x49, 0x45, 0xb0, 0x9e, 0x81, 0xc0, 0x2c, 0x9e, 0x31, 0xbc, 0x1a, 0xc1};
  uint8_t bytesprops1[] = {0x3d, 0x47, 0x70, 0xf7, 0xef, 0xd6, 0x41, 0xcb, 0x85, 0xff, 0x85, 0x73, 0x73,
                           0x40, 0xf9, 0x26, 0x7c, 0x85, 0xb2, 0x40, 0xf4, 0xec, 0x2f, 0x5a, 0xbe};
  uint8_t bytesprops3[] = {0x29, 0xf6, 0x10, 0x3b, 0xcf, 0xc0, 0x42, 0x4c, 0x48, 0x58, 0xef,
                           0xa0, 0x6c, 0x7f, 0x70, 0x88, 0xc,  0x5e, 0x5f, 0x46, 0x3d, 0x8f};
  uint8_t bytesprops2[] = {0x8a, 0x6,  0xa7, 0xd9, 0xd1, 0x46, 0xb3, 0xe8, 0xa4, 0x1d, 0x77,
                           0xd1, 0x72, 0x67, 0x54, 0x15, 0x51, 0xc1, 0xe0, 0xb2, 0xb0, 0x4d};
  uint8_t bytesprops4[] = {0x7b, 0x31, 0xae, 0xf2, 0x2d, 0x83, 0xb6, 0xe, 0x9c,
                           0xc1, 0x27, 0x4,  0x59, 0x7f, 0x3b, 0x83, 0x5f};
  uint8_t bytesprops5[] = {0xaa, 0x1e, 0xd2, 0xa1, 0x48, 0xc3, 0xe,  0x19, 0xe0, 0xf7,
                           0xfb, 0xd3, 0x8f, 0x99, 0x47, 0x10, 0x28, 0x96, 0xca};
  uint8_t bytesprops7[] = {0x80, 0x38, 0xe5, 0x80, 0x34, 0x3f, 0x68, 0x91, 0x7, 0x80, 0x32, 0x35, 0x81};
  uint8_t bytesprops6[] = {0xa6, 0x8c, 0x30, 0x9,  0xf5, 0x7e, 0x2,  0x9c,
                           0x4e, 0x9d, 0x2c, 0x5f, 0x49, 0x1e, 0x3b, 0x8d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19059}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops2}, .v = {22, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14420}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 695}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 757}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10859}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops6}, .v = {13, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25715}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15137}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18099}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb2, 0xcb, 0x66, 0x62, 0x9e, 0xa,  0xef, 0xda, 0x12,
                               0xa4, 0xc7, 0x85, 0xa4, 0x82, 0x1d, 0xe,  0xd5};
  uint8_t byteswillprops1[] = {0x5a, 0x7c, 0x8d, 0x7e, 0x78};
  uint8_t byteswillprops2[] = {0x7b, 0x2a, 0x76, 0xab, 0x76, 0x6c, 0xba, 0x32, 0xbf, 0x55, 0xf,  0xdf,
                               0xaa, 0xc4, 0xa,  0x81, 0xb9, 0xf9, 0xf6, 0xfd, 0x51, 0x4,  0xcb, 0x6a};
  uint8_t byteswillprops3[] = {0x5c, 0x7a, 0xc9, 0xef, 0x13, 0xb9, 0xda, 0x42,
                               0x17, 0x3,  0xed, 0xb0, 0xd3, 0x6d, 0xa1, 0x60};
  uint8_t byteswillprops4[] = {0x68, 0x59, 0xa1, 0x6d, 0xa4, 0x1f, 0xdd, 0x17, 0x70,
                               0x49, 0xcb, 0x3b, 0x61, 0xdf, 0xe6, 0x9b, 0x0,  0xe8};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32637}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23460}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 989}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10792}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20351}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 225}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0xc0, 0x63, 0x42, 0xdf, 0x6,  0x84, 0x73,
                                0x21, 0x71, 0xf6, 0xec, 0x70, 0x51, 0x2d, 0x52};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x98, 0x17, 0x70, 0xb4, 0x7b, 0xf,  0x94, 0xb4, 0x38, 0xd,
                                  0xe6, 0xfc, 0x76, 0x59, 0x97, 0x5d, 0xdf, 0x2f, 0xe8, 0x26, 0x6e};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1497;
  uint8_t client_id_bytes[] = {0x5, 0x66, 0x42, 0xb2, 0x4, 0x10, 0x8b, 0xe9, 0xa9, 0x48, 0xe9, 0x1d, 0x5b};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb1, 0x2c, 0x1f, 0xa2, 0xf9, 0xd, 0x55};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xba, 0x24, 0xb8, 0x4a, 0x18, 0x3a, 0xd2, 0x54, 0xa0, 0x74, 0xb9, 0xf2};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\137\131H\193\255h\165\215p\165", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\194\&8\235\&3\136P\198a", _willMsg =
// "\ESC}E\DLE\133\162\200\238\202o\182\242", _willProps = [PropRetainAvailable 35,PropMessageExpiryInterval
// 27416,PropSubscriptionIdentifier 26,PropRequestProblemInformation 20,PropAssignedClientIdentifier
// "\"\183\DC1>f=\146\206\142\161\211\&2$\155\188\132j\SO\247\144\171 ~&\135?",PropMaximumQoS
// 127,PropRequestResponseInformation 19,PropTopicAliasMaximum 2785,PropMessageExpiryInterval
// 22684,PropPayloadFormatIndicator 23,PropContentType
// "\255\GS\172\&8\203\&9s6\242\NAK$\202\141\228\DLE\161#\231\214k\133z\146\154$\187\&6X'p",PropWillDelayInterval
// 29351,PropTopicAliasMaximum 12599,PropResponseInformation "TR\206rc\219dP\178\a\175\229",PropTopicAliasMaximum
// 21478,PropSubscriptionIdentifier 11,PropRequestProblemInformation 29,PropMaximumQoS 0,PropServerKeepAlive 21983]}),
// _cleanSession = False, _keepAlive = 17930, _connID = "\152@\239K\222UU\185", _properties = [PropWillDelayInterval
// 32405,PropSubscriptionIdentifier 7,PropSubscriptionIdentifier 29,PropSubscriptionIdentifier 16,PropServerReference
// "\130o\165\DC3b\192\165\&3\138",PropReceiveMaximum 10388,PropUserProperty
// "\241?\SI\142\ETB\246N\144\226h\b\140:\FS]Z\207." "Ve5q\156\DEL\131\172\146\NAK\164J,#\SUB%W\NUL",PropContentType
// "\131\DEL\136\139\&60\209\202\142\&1\195\225\186\180\234v\193\136A\ETX|\220\254\bw\NULd\208b\180"]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0x98, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x46, 0xa,  0x64, 0x18, 0x0,  0x0,  0x7e, 0x95,
      0xb,  0x7,  0xb,  0x1d, 0xb,  0x10, 0x1c, 0x0,  0x9,  0x82, 0x6f, 0xa5, 0x13, 0x62, 0xc0, 0xa5, 0x33, 0x8a, 0x21,
      0x28, 0x94, 0x26, 0x0,  0x12, 0xf1, 0x3f, 0xf,  0x8e, 0x17, 0xf6, 0x4e, 0x90, 0xe2, 0x68, 0x8,  0x8c, 0x3a, 0x1c,
      0x5d, 0x5a, 0xcf, 0x2e, 0x0,  0x12, 0x56, 0x65, 0x35, 0x71, 0x9c, 0x7f, 0x83, 0xac, 0x92, 0x15, 0xa4, 0x4a, 0x2c,
      0x23, 0x1a, 0x25, 0x57, 0x0,  0x3,  0x0,  0x1e, 0x83, 0x7f, 0x88, 0x8b, 0x36, 0x30, 0xd1, 0xca, 0x8e, 0x31, 0xc3,
      0xe1, 0xba, 0xb4, 0xea, 0x76, 0xc1, 0x88, 0x41, 0x3,  0x7c, 0xdc, 0xfe, 0x8,  0x77, 0x0,  0x64, 0xd0, 0x62, 0xb4,
      0x0,  0x8,  0x98, 0x40, 0xef, 0x4b, 0xde, 0x55, 0x55, 0xb9, 0x7a, 0x25, 0x23, 0x2,  0x0,  0x0,  0x6b, 0x18, 0xb,
      0x1a, 0x17, 0x14, 0x12, 0x0,  0x1a, 0x22, 0xb7, 0x11, 0x3e, 0x66, 0x3d, 0x92, 0xce, 0x8e, 0xa1, 0xd3, 0x32, 0x24,
      0x9b, 0xbc, 0x84, 0x6a, 0xe,  0xf7, 0x90, 0xab, 0x20, 0x7e, 0x26, 0x87, 0x3f, 0x24, 0x7f, 0x19, 0x13, 0x22, 0xa,
      0xe1, 0x2,  0x0,  0x0,  0x58, 0x9c, 0x1,  0x17, 0x3,  0x0,  0x1e, 0xff, 0x1d, 0xac, 0x38, 0xcb, 0x39, 0x73, 0x36,
      0xf2, 0x15, 0x24, 0xca, 0x8d, 0xe4, 0x10, 0xa1, 0x23, 0xe7, 0xd6, 0x6b, 0x85, 0x7a, 0x92, 0x9a, 0x24, 0xbb, 0x36,
      0x58, 0x27, 0x70, 0x18, 0x0,  0x0,  0x72, 0xa7, 0x22, 0x31, 0x37, 0x1a, 0x0,  0xc,  0x54, 0x52, 0xce, 0x72, 0x63,
      0xdb, 0x64, 0x50, 0xb2, 0x7,  0xaf, 0xe5, 0x22, 0x53, 0xe6, 0xb,  0xb,  0x17, 0x1d, 0x24, 0x0,  0x13, 0x55, 0xdf,
      0x0,  0x8,  0xc2, 0x38, 0xeb, 0x33, 0x88, 0x50, 0xc6, 0x61, 0x0,  0xc,  0x1b, 0x7d, 0x45, 0x10, 0x85, 0xa2, 0xc8,
      0xee, 0xca, 0x6f, 0xb6, 0xf2, 0x0,  0xa,  0x89, 0x83, 0x48, 0xc1, 0xff, 0x68, 0xa5, 0xd7, 0x70, 0xa5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x82, 0x6f, 0xa5, 0x13, 0x62, 0xc0, 0xa5, 0x33, 0x8a};
  uint8_t bytesprops2[] = {0x56, 0x65, 0x35, 0x71, 0x9c, 0x7f, 0x83, 0xac, 0x92,
                           0x15, 0xa4, 0x4a, 0x2c, 0x23, 0x1a, 0x25, 0x57, 0x0};
  uint8_t bytesprops1[] = {0xf1, 0x3f, 0xf,  0x8e, 0x17, 0xf6, 0x4e, 0x90, 0xe2,
                           0x68, 0x8,  0x8c, 0x3a, 0x1c, 0x5d, 0x5a, 0xcf, 0x2e};
  uint8_t bytesprops3[] = {0x83, 0x7f, 0x88, 0x8b, 0x36, 0x30, 0xd1, 0xca, 0x8e, 0x31, 0xc3, 0xe1, 0xba, 0xb4, 0xea,
                           0x76, 0xc1, 0x88, 0x41, 0x3,  0x7c, 0xdc, 0xfe, 0x8,  0x77, 0x0,  0x64, 0xd0, 0x62, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32405}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10388}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x22, 0xb7, 0x11, 0x3e, 0x66, 0x3d, 0x92, 0xce, 0x8e, 0xa1, 0xd3, 0x32, 0x24,
                               0x9b, 0xbc, 0x84, 0x6a, 0xe,  0xf7, 0x90, 0xab, 0x20, 0x7e, 0x26, 0x87, 0x3f};
  uint8_t byteswillprops1[] = {0xff, 0x1d, 0xac, 0x38, 0xcb, 0x39, 0x73, 0x36, 0xf2, 0x15,
                               0x24, 0xca, 0x8d, 0xe4, 0x10, 0xa1, 0x23, 0xe7, 0xd6, 0x6b,
                               0x85, 0x7a, 0x92, 0x9a, 0x24, 0xbb, 0x36, 0x58, 0x27, 0x70};
  uint8_t byteswillprops2[] = {0x54, 0x52, 0xce, 0x72, 0x63, 0xdb, 0x64, 0x50, 0xb2, 0x7, 0xaf, 0xe5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27416}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2785}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22684}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29351}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12599}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21478}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21983}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc2, 0x38, 0xeb, 0x33, 0x88, 0x50, 0xc6, 0x61};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1b, 0x7d, 0x45, 0x10, 0x85, 0xa2, 0xc8, 0xee, 0xca, 0x6f, 0xb6, 0xf2};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17930;
  uint8_t client_id_bytes[] = {0x98, 0x40, 0xef, 0x4b, 0xde, 0x55, 0x55, 0xb9};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x89, 0x83, 0x48, 0xc1, 0xff, 0x68, 0xa5, 0xd7, 0x70, 0xa5};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "E?\ENQ\194E\208h\161\GSV2\189", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\143E\250\224\248%\EOT?\DC3_m\189\NAK\216\163\252\138B\142\RS",
// _willMsg = "|\253OH.E\US*\182\240-;\234\180\237\239\&2\136B\128\241\131", _willProps = [PropRetainAvailable
// 250,PropReasonString "\255G1L\175\209|#Pe",PropRetainAvailable 221,PropReasonString "",PropRetainAvailable 25]}),
// _cleanSession = True, _keepAlive = 6426, _connID = "J\158>Hv\SYNdF\SOH\160)\DC1*'#id\188iaD\192\b\213\152rW\251",
// _properties = [PropMaximumPacketSize 23862,PropSubscriptionIdentifierAvailable 121,PropRequestProblemInformation
// 59,PropAuthenticationData "\145j",PropSubscriptionIdentifierAvailable 234,PropSharedSubscriptionAvailable
// 208,PropMessageExpiryInterval 32125,PropMessageExpiryInterval 22174,PropSessionExpiryInterval 9012,PropReceiveMaximum
// 11528,PropWillDelayInterval 20923,PropResponseTopic "\183\193l\142\ETX\184",PropWildcardSubscriptionAvailable
// 90,PropTopicAliasMaximum 14239,PropSubscriptionIdentifierAvailable 250,PropAuthenticationData
// "IP\153\&8+\148\&3;gc\165A\194`\151\252\232\209\189\SYN#\DC3\179\b\225\158\142\128",PropWildcardSubscriptionAvailable
// 76,PropReasonString "b\244\216\253o\141\240\"\183\238\134l\186f\219g\212c\214\160",PropWildcardSubscriptionAvailable
// 172,PropRequestResponseInformation 106,PropRetainAvailable 24,PropRetainAvailable 49,PropTopicAliasMaximum
// 23078,PropServerKeepAlive 5765,PropSessionExpiryInterval 27036,PropAssignedClientIdentifier
// "\254\232\248\199\165\GS\233z\206}\245@\177\162o@\206\135"]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0x96, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x19, 0x1a, 0x99, 0x1,  0x27, 0x0,  0x0,  0x5d,
      0x36, 0x29, 0x79, 0x17, 0x3b, 0x16, 0x0,  0x2,  0x91, 0x6a, 0x29, 0xea, 0x2a, 0xd0, 0x2,  0x0,  0x0,  0x7d, 0x7d,
      0x2,  0x0,  0x0,  0x56, 0x9e, 0x11, 0x0,  0x0,  0x23, 0x34, 0x21, 0x2d, 0x8,  0x18, 0x0,  0x0,  0x51, 0xbb, 0x8,
      0x0,  0x6,  0xb7, 0xc1, 0x6c, 0x8e, 0x3,  0xb8, 0x28, 0x5a, 0x22, 0x37, 0x9f, 0x29, 0xfa, 0x16, 0x0,  0x1c, 0x49,
      0x50, 0x99, 0x38, 0x2b, 0x94, 0x33, 0x3b, 0x67, 0x63, 0xa5, 0x41, 0xc2, 0x60, 0x97, 0xfc, 0xe8, 0xd1, 0xbd, 0x16,
      0x23, 0x13, 0xb3, 0x8,  0xe1, 0x9e, 0x8e, 0x80, 0x28, 0x4c, 0x1f, 0x0,  0x14, 0x62, 0xf4, 0xd8, 0xfd, 0x6f, 0x8d,
      0xf0, 0x22, 0xb7, 0xee, 0x86, 0x6c, 0xba, 0x66, 0xdb, 0x67, 0xd4, 0x63, 0xd6, 0xa0, 0x28, 0xac, 0x19, 0x6a, 0x25,
      0x18, 0x25, 0x31, 0x22, 0x5a, 0x26, 0x13, 0x16, 0x85, 0x11, 0x0,  0x0,  0x69, 0x9c, 0x12, 0x0,  0x12, 0xfe, 0xe8,
      0xf8, 0xc7, 0xa5, 0x1d, 0xe9, 0x7a, 0xce, 0x7d, 0xf5, 0x40, 0xb1, 0xa2, 0x6f, 0x40, 0xce, 0x87, 0x0,  0x1c, 0x4a,
      0x9e, 0x3e, 0x48, 0x76, 0x16, 0x64, 0x46, 0x1,  0xa0, 0x29, 0x11, 0x2a, 0x27, 0x23, 0x69, 0x64, 0xbc, 0x69, 0x61,
      0x44, 0xc0, 0x8,  0xd5, 0x98, 0x72, 0x57, 0xfb, 0x16, 0x25, 0xfa, 0x1f, 0x0,  0xa,  0xff, 0x47, 0x31, 0x4c, 0xaf,
      0xd1, 0x7c, 0x23, 0x50, 0x65, 0x25, 0xdd, 0x1f, 0x0,  0x0,  0x25, 0x19, 0x0,  0x14, 0x8f, 0x45, 0xfa, 0xe0, 0xf8,
      0x25, 0x4,  0x3f, 0x13, 0x5f, 0x6d, 0xbd, 0x15, 0xd8, 0xa3, 0xfc, 0x8a, 0x42, 0x8e, 0x1e, 0x0,  0x16, 0x7c, 0xfd,
      0x4f, 0x48, 0x2e, 0x45, 0x1f, 0x2a, 0xb6, 0xf0, 0x2d, 0x3b, 0xea, 0xb4, 0xed, 0xef, 0x32, 0x88, 0x42, 0x80, 0xf1,
      0x83, 0x0,  0xc,  0x45, 0x3f, 0x5,  0xc2, 0x45, 0xd0, 0x68, 0xa1, 0x1d, 0x56, 0x32, 0xbd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x91, 0x6a};
  uint8_t bytesprops1[] = {0xb7, 0xc1, 0x6c, 0x8e, 0x3, 0xb8};
  uint8_t bytesprops2[] = {0x49, 0x50, 0x99, 0x38, 0x2b, 0x94, 0x33, 0x3b, 0x67, 0x63, 0xa5, 0x41, 0xc2, 0x60,
                           0x97, 0xfc, 0xe8, 0xd1, 0xbd, 0x16, 0x23, 0x13, 0xb3, 0x8,  0xe1, 0x9e, 0x8e, 0x80};
  uint8_t bytesprops3[] = {0x62, 0xf4, 0xd8, 0xfd, 0x6f, 0x8d, 0xf0, 0x22, 0xb7, 0xee,
                           0x86, 0x6c, 0xba, 0x66, 0xdb, 0x67, 0xd4, 0x63, 0xd6, 0xa0};
  uint8_t bytesprops4[] = {0xfe, 0xe8, 0xf8, 0xc7, 0xa5, 0x1d, 0xe9, 0x7a, 0xce,
                           0x7d, 0xf5, 0x40, 0xb1, 0xa2, 0x6f, 0x40, 0xce, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23862}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32125}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22174}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9012}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11528}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20923}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14239}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23078}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5765}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27036}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xff, 0x47, 0x31, 0x4c, 0xaf, 0xd1, 0x7c, 0x23, 0x50, 0x65};
  uint8_t byteswillprops1[] = {0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 25}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8f, 0x45, 0xfa, 0xe0, 0xf8, 0x25, 0x4,  0x3f, 0x13, 0x5f,
                                0x6d, 0xbd, 0x15, 0xd8, 0xa3, 0xfc, 0x8a, 0x42, 0x8e, 0x1e};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7c, 0xfd, 0x4f, 0x48, 0x2e, 0x45, 0x1f, 0x2a, 0xb6, 0xf0, 0x2d,
                                  0x3b, 0xea, 0xb4, 0xed, 0xef, 0x32, 0x88, 0x42, 0x80, 0xf1, 0x83};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6426;
  uint8_t client_id_bytes[] = {0x4a, 0x9e, 0x3e, 0x48, 0x76, 0x16, 0x64, 0x46, 0x1, 0xa0, 0x29, 0x11, 0x2a, 0x27,
                               0x23, 0x69, 0x64, 0xbc, 0x69, 0x61, 0x44, 0xc0, 0x8, 0xd5, 0x98, 0x72, 0x57, 0xfb};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x45, 0x3f, 0x5, 0xc2, 0x45, 0xd0, 0x68, 0xa1, 0x1d, 0x56, 0x32, 0xbd};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22060 [("\223\227\254#\231\fk\254CT\157\246_G\GSI",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\212\DC4\172\SI\161\ETX[\171~`Y\188\185\181pS\206X",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x2a, 0x56, 0x2c, 0x0,  0x10, 0xdf, 0xe3, 0xfe, 0x23, 0xe7, 0xc,  0x6b, 0xfe, 0x43,
                   0x54, 0x9d, 0xf6, 0x5f, 0x47, 0x1d, 0x49, 0x0,  0x0,  0x12, 0xd4, 0x14, 0xac, 0xf,  0xa1,
                   0x3,  0x5b, 0xab, 0x7e, 0x60, 0x59, 0xbc, 0xb9, 0xb5, 0x70, 0x53, 0xce, 0x58, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xdf, 0xe3, 0xfe, 0x23, 0xe7, 0xc,  0x6b, 0xfe,
                                     0x43, 0x54, 0x9d, 0xf6, 0x5f, 0x47, 0x1d, 0x49};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd4, 0x14, 0xac, 0xf,  0xa1, 0x3,  0x5b, 0xab, 0x7e,
                                     0x60, 0x59, 0xbc, 0xb9, 0xb5, 0x70, 0x53, 0xce, 0x58};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22060, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21589
// [("\204\251XL\209\150\136\SUB\146\187\US\196\153\150d\219\213\209\RS\174\175\144^\140\138\147\203\240\214\215",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("g\160\ESC\225\199\RS!%|\ACKG\217v\148w\135\203",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("I*\141\&7!n",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\250wi\NAK0H\153\149m1#\244\243j\171jT\193\248\219\EOT\246X\217\161\192",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\241\239J(\216\192=\130\197-h|\170B\US\204]\166\204\149\152|\EOT\221X*U\138w\238",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\137;E\ETX\186\180\221\246\229\182\247\208",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("}\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("t\205_\220\162g\141/cH",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\135\137\149\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\165\DC36\SUBG\US}\220\EM\SI\137\251\204?\210\EOT#\bLN\129",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0xc1, 0x1,  0x54, 0x55, 0x0,  0x1e, 0xcc, 0xfb, 0x58, 0x4c, 0xd1, 0x96, 0x88, 0x1a, 0x92, 0xbb,
                   0x1f, 0xc4, 0x99, 0x96, 0x64, 0xdb, 0xd5, 0xd1, 0x1e, 0xae, 0xaf, 0x90, 0x5e, 0x8c, 0x8a, 0x93, 0xcb,
                   0xf0, 0xd6, 0xd7, 0x0,  0x0,  0x11, 0x67, 0xa0, 0x1b, 0xe1, 0xc7, 0x1e, 0x21, 0x25, 0x7c, 0x6,  0x47,
                   0xd9, 0x76, 0x94, 0x77, 0x87, 0xcb, 0x1,  0x0,  0x6,  0x49, 0x2a, 0x8d, 0x37, 0x21, 0x6e, 0x0,  0x0,
                   0x1a, 0xfa, 0x77, 0x69, 0x15, 0x30, 0x48, 0x99, 0x95, 0x6d, 0x31, 0x23, 0xf4, 0xf3, 0x6a, 0xab, 0x6a,
                   0x54, 0xc1, 0xf8, 0xdb, 0x4,  0xf6, 0x58, 0xd9, 0xa1, 0xc0, 0x0,  0x0,  0x1e, 0xf1, 0xef, 0x4a, 0x28,
                   0xd8, 0xc0, 0x3d, 0x82, 0xc5, 0x2d, 0x68, 0x7c, 0xaa, 0x42, 0x1f, 0xcc, 0x5d, 0xa6, 0xcc, 0x95, 0x98,
                   0x7c, 0x4,  0xdd, 0x58, 0x2a, 0x55, 0x8a, 0x77, 0xee, 0x0,  0x0,  0x0,  0x1,  0x0,  0xc,  0x89, 0x3b,
                   0x45, 0x3,  0xba, 0xb4, 0xdd, 0xf6, 0xe5, 0xb6, 0xf7, 0xd0, 0x0,  0x0,  0x2,  0x7d, 0xf0, 0x2,  0x0,
                   0xa,  0x74, 0xcd, 0x5f, 0xdc, 0xa2, 0x67, 0x8d, 0x2f, 0x63, 0x48, 0x2,  0x0,  0x4,  0x87, 0x89, 0x95,
                   0xd0, 0x2,  0x0,  0x15, 0xa5, 0x13, 0x36, 0x1a, 0x47, 0x1f, 0x7d, 0xdc, 0x19, 0xf,  0x89, 0xfb, 0xcc,
                   0x3f, 0xd2, 0x4,  0x23, 0x8,  0x4c, 0x4e, 0x81, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xcc, 0xfb, 0x58, 0x4c, 0xd1, 0x96, 0x88, 0x1a, 0x92, 0xbb,
                                     0x1f, 0xc4, 0x99, 0x96, 0x64, 0xdb, 0xd5, 0xd1, 0x1e, 0xae,
                                     0xaf, 0x90, 0x5e, 0x8c, 0x8a, 0x93, 0xcb, 0xf0, 0xd6, 0xd7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x67, 0xa0, 0x1b, 0xe1, 0xc7, 0x1e, 0x21, 0x25, 0x7c,
                                     0x6,  0x47, 0xd9, 0x76, 0x94, 0x77, 0x87, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x49, 0x2a, 0x8d, 0x37, 0x21, 0x6e};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfa, 0x77, 0x69, 0x15, 0x30, 0x48, 0x99, 0x95, 0x6d, 0x31, 0x23, 0xf4, 0xf3,
                                     0x6a, 0xab, 0x6a, 0x54, 0xc1, 0xf8, 0xdb, 0x4,  0xf6, 0x58, 0xd9, 0xa1, 0xc0};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf1, 0xef, 0x4a, 0x28, 0xd8, 0xc0, 0x3d, 0x82, 0xc5, 0x2d,
                                     0x68, 0x7c, 0xaa, 0x42, 0x1f, 0xcc, 0x5d, 0xa6, 0xcc, 0x95,
                                     0x98, 0x7c, 0x4,  0xdd, 0x58, 0x2a, 0x55, 0x8a, 0x77, 0xee};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x89, 0x3b, 0x45, 0x3, 0xba, 0xb4, 0xdd, 0xf6, 0xe5, 0xb6, 0xf7, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7d, 0xf0};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x74, 0xcd, 0x5f, 0xdc, 0xa2, 0x67, 0x8d, 0x2f, 0x63, 0x48};
  lwmqtt_string_t topic_filter_s8 = {10, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x87, 0x89, 0x95, 0xd0};
  lwmqtt_string_t topic_filter_s9 = {4, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa5, 0x13, 0x36, 0x1a, 0x47, 0x1f, 0x7d, 0xdc, 0x19, 0xf, 0x89,
                                      0xfb, 0xcc, 0x3f, 0xd2, 0x4,  0x23, 0x8,  0x4c, 0x4e, 0x81};
  lwmqtt_string_t topic_filter_s10 = {21, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21589, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25658 [("\135\217dy\159J\NULIZ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("~|l\v\rK\139\EMPB\237\236M\165\138",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x20, 0x64, 0x3a, 0x0, 0x9, 0x87, 0xd9, 0x64, 0x79, 0x9f, 0x4a, 0x0,  0x49, 0x5a, 0x2,  0x0,
                   0xf,  0x7e, 0x7c, 0x6c, 0xb, 0xd, 0x4b, 0x8b, 0x19, 0x50, 0x42, 0xed, 0xec, 0x4d, 0xa5, 0x8a, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x87, 0xd9, 0x64, 0x79, 0x9f, 0x4a, 0x0, 0x49, 0x5a};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0x7c, 0x6c, 0xb,  0xd,  0x4b, 0x8b, 0x19,
                                     0x50, 0x42, 0xed, 0xec, 0x4d, 0xa5, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25658, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3081 [("`\165\DC2QfJ\249\SI\229\168\140",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\175\219X\239\225\227x\227\ETB\252\181h",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\168#\148j\132a\191~\220R\159N\200\142j\222\155\217)\STX\rz\233",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("?\223\227x\250\168\161\217j\189b\253dAOF\239\202\227",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\160\136\fl(\220\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\152\146\139\145\146",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\197\241H\131\203;\238\152\EOT\187CUa\222\142\128\EM\SUBq",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\ACK_\244\234\207,W\239J\240\181\240fXg\231",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("{\\\162.Ggs\SOH\145\237\&7T\146",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x9a, 0x1,  0xc,  0x9,  0x0,  0xb,  0x60, 0xa5, 0x12, 0x51, 0x66, 0x4a, 0xf9, 0xf,  0xe5,
                   0xa8, 0x8c, 0x2,  0x0,  0xc,  0xaf, 0xdb, 0x58, 0xef, 0xe1, 0xe3, 0x78, 0xe3, 0x17, 0xfc, 0xb5,
                   0x68, 0x1,  0x0,  0x17, 0xa8, 0x23, 0x94, 0x6a, 0x84, 0x61, 0xbf, 0x7e, 0xdc, 0x52, 0x9f, 0x4e,
                   0xc8, 0x8e, 0x6a, 0xde, 0x9b, 0xd9, 0x29, 0x2,  0xd,  0x7a, 0xe9, 0x2,  0x0,  0x13, 0x3f, 0xdf,
                   0xe3, 0x78, 0xfa, 0xa8, 0xa1, 0xd9, 0x6a, 0xbd, 0x62, 0xfd, 0x64, 0x41, 0x4f, 0x46, 0xef, 0xca,
                   0xe3, 0x2,  0x0,  0x7,  0xa0, 0x88, 0xc,  0x6c, 0x28, 0xdc, 0x9b, 0x2,  0x0,  0x5,  0x98, 0x92,
                   0x8b, 0x91, 0x92, 0x2,  0x0,  0x13, 0xc5, 0xf1, 0x48, 0x83, 0xcb, 0x3b, 0xee, 0x98, 0x4,  0xbb,
                   0x43, 0x55, 0x61, 0xde, 0x8e, 0x80, 0x19, 0x1a, 0x71, 0x0,  0x0,  0x10, 0x6,  0x5f, 0xf4, 0xea,
                   0xcf, 0x2c, 0x57, 0xef, 0x4a, 0xf0, 0xb5, 0xf0, 0x66, 0x58, 0x67, 0xe7, 0x2,  0x0,  0xd,  0x7b,
                   0x5c, 0xa2, 0x2e, 0x47, 0x67, 0x73, 0x1,  0x91, 0xed, 0x37, 0x54, 0x92, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x60, 0xa5, 0x12, 0x51, 0x66, 0x4a, 0xf9, 0xf, 0xe5, 0xa8, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaf, 0xdb, 0x58, 0xef, 0xe1, 0xe3, 0x78, 0xe3, 0x17, 0xfc, 0xb5, 0x68};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa8, 0x23, 0x94, 0x6a, 0x84, 0x61, 0xbf, 0x7e, 0xdc, 0x52, 0x9f, 0x4e,
                                     0xc8, 0x8e, 0x6a, 0xde, 0x9b, 0xd9, 0x29, 0x2,  0xd,  0x7a, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3f, 0xdf, 0xe3, 0x78, 0xfa, 0xa8, 0xa1, 0xd9, 0x6a, 0xbd,
                                     0x62, 0xfd, 0x64, 0x41, 0x4f, 0x46, 0xef, 0xca, 0xe3};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0x88, 0xc, 0x6c, 0x28, 0xdc, 0x9b};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x98, 0x92, 0x8b, 0x91, 0x92};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc5, 0xf1, 0x48, 0x83, 0xcb, 0x3b, 0xee, 0x98, 0x4, 0xbb,
                                     0x43, 0x55, 0x61, 0xde, 0x8e, 0x80, 0x19, 0x1a, 0x71};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6,  0x5f, 0xf4, 0xea, 0xcf, 0x2c, 0x57, 0xef,
                                     0x4a, 0xf0, 0xb5, 0xf0, 0x66, 0x58, 0x67, 0xe7};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x7b, 0x5c, 0xa2, 0x2e, 0x47, 0x67, 0x73, 0x1, 0x91, 0xed, 0x37, 0x54, 0x92};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3081, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26803 [("G0\203x\EOT9\163\234\244~\250\213\DEL\247z'\226",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m,s\SO\194G\181\182\&9\128N\200\150;gq9\182u?e\\\252\219\SO\133\DC2\146\242W",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\129\156\160\NAK\194\&8\202\196Y
// \172\147\213\175\141*\168\ETB\195y\147",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("iM\SYN\223q\DEL@J\183\233\132\254[*",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("jX\ra\242\DC1\ETB@E\181\181\252R",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\224\GSH\ESCU\212",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x79, 0x68, 0xb3, 0x0,  0x11, 0x47, 0x30, 0xcb, 0x78, 0x4,  0x39, 0xa3, 0xea, 0xf4, 0x7e,
                   0xfa, 0xd5, 0x7f, 0xf7, 0x7a, 0x27, 0xe2, 0x2,  0x0,  0x1e, 0x6d, 0x2c, 0x73, 0xe,  0xc2, 0x47,
                   0xb5, 0xb6, 0x39, 0x80, 0x4e, 0xc8, 0x96, 0x3b, 0x67, 0x71, 0x39, 0xb6, 0x75, 0x3f, 0x65, 0x5c,
                   0xfc, 0xdb, 0xe,  0x85, 0x12, 0x92, 0xf2, 0x57, 0x2,  0x0,  0x15, 0x81, 0x9c, 0xa0, 0x15, 0xc2,
                   0x38, 0xca, 0xc4, 0x59, 0x20, 0xac, 0x93, 0xd5, 0xaf, 0x8d, 0x2a, 0xa8, 0x17, 0xc3, 0x79, 0x93,
                   0x1,  0x0,  0xe,  0x69, 0x4d, 0x16, 0xdf, 0x71, 0x7f, 0x40, 0x4a, 0xb7, 0xe9, 0x84, 0xfe, 0x5b,
                   0x2a, 0x1,  0x0,  0xd,  0x6a, 0x58, 0xd,  0x61, 0xf2, 0x11, 0x17, 0x40, 0x45, 0xb5, 0xb5, 0xfc,
                   0x52, 0x1,  0x0,  0x6,  0xe0, 0x1d, 0x48, 0x1b, 0x55, 0xd4, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x30, 0xcb, 0x78, 0x4,  0x39, 0xa3, 0xea, 0xf4,
                                     0x7e, 0xfa, 0xd5, 0x7f, 0xf7, 0x7a, 0x27, 0xe2};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6d, 0x2c, 0x73, 0xe,  0xc2, 0x47, 0xb5, 0xb6, 0x39, 0x80,
                                     0x4e, 0xc8, 0x96, 0x3b, 0x67, 0x71, 0x39, 0xb6, 0x75, 0x3f,
                                     0x65, 0x5c, 0xfc, 0xdb, 0xe,  0x85, 0x12, 0x92, 0xf2, 0x57};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x81, 0x9c, 0xa0, 0x15, 0xc2, 0x38, 0xca, 0xc4, 0x59, 0x20, 0xac,
                                     0x93, 0xd5, 0xaf, 0x8d, 0x2a, 0xa8, 0x17, 0xc3, 0x79, 0x93};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x69, 0x4d, 0x16, 0xdf, 0x71, 0x7f, 0x40,
                                     0x4a, 0xb7, 0xe9, 0x84, 0xfe, 0x5b, 0x2a};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6a, 0x58, 0xd, 0x61, 0xf2, 0x11, 0x17, 0x40, 0x45, 0xb5, 0xb5, 0xfc, 0x52};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe0, 0x1d, 0x48, 0x1b, 0x55, 0xd4};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26803, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11145 [("\164AU\201Ck<Q?\b\255%\175\SYN\193,]\130\138N\f",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x1a, 0x2b, 0x89, 0x0,  0x15, 0xa4, 0x41, 0x55, 0xc9, 0x43, 0x6b, 0x3c, 0x51,
                   0x3f, 0x8,  0xff, 0x25, 0xaf, 0x16, 0xc1, 0x2c, 0x5d, 0x82, 0x8a, 0x4e, 0xc,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xa4, 0x41, 0x55, 0xc9, 0x43, 0x6b, 0x3c, 0x51, 0x3f, 0x8, 0xff,
                                     0x25, 0xaf, 0x16, 0xc1, 0x2c, 0x5d, 0x82, 0x8a, 0x4e, 0xc};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11145, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31044 [("\187\200\156!\158\f4\STX\NUL\172\ENQ\244~\208\172B\DC3)\145C1\166m\208\175\254T",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\DC1|\CAN\219\DC3\143\242\ENQ\DC4V\CAN\136\136o\SO\ESC\DC3/\158;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\140n\149gP\165\133C\183\140\144\195I\r\RS\215 \202EX\EOT\203\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\EM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("p<\149\181\SYN\235b<N\242\203pS\173",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\250\ENQ\194\165\153;\151\173\143\220z\175n\168\&6\187\232\SI\153\132G\189\SUB\171v\247\178W\219",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\181\216\214e\225\&0#]\206\240\&7\199\ETX\133\132\148\216\&7c;I\US\212\EOT\US\218u\178",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("z\137FLm07=\230F\205\242\r\164\221",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\190\181`\130\234\187\176F\193\149\242\223\&7\130\167>\ACK\SYN_G\244\236M\230\204",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xd3, 0x1,  0x79, 0x44, 0x0,  0x1b, 0xbb, 0xc8, 0x9c, 0x21, 0x9e, 0xc,  0x34, 0x2,  0x0,  0xac,
                   0x5,  0xf4, 0x7e, 0xd0, 0xac, 0x42, 0x13, 0x29, 0x91, 0x43, 0x31, 0xa6, 0x6d, 0xd0, 0xaf, 0xfe, 0x54,
                   0x1,  0x0,  0x14, 0x11, 0x7c, 0x18, 0xdb, 0x13, 0x8f, 0xf2, 0x5,  0x14, 0x56, 0x18, 0x88, 0x88, 0x6f,
                   0xe,  0x1b, 0x13, 0x2f, 0x9e, 0x3b, 0x2,  0x0,  0x17, 0x8c, 0x6e, 0x95, 0x67, 0x50, 0xa5, 0x85, 0x43,
                   0xb7, 0x8c, 0x90, 0xc3, 0x49, 0xd,  0x1e, 0xd7, 0x20, 0xca, 0x45, 0x58, 0x4,  0xcb, 0x87, 0x0,  0x0,
                   0x1,  0x19, 0x0,  0x0,  0xe,  0x70, 0x3c, 0x95, 0xb5, 0x16, 0xeb, 0x62, 0x3c, 0x4e, 0xf2, 0xcb, 0x70,
                   0x53, 0xad, 0x0,  0x0,  0x1d, 0xfa, 0x5,  0xc2, 0xa5, 0x99, 0x3b, 0x97, 0xad, 0x8f, 0xdc, 0x7a, 0xaf,
                   0x6e, 0xa8, 0x36, 0xbb, 0xe8, 0xf,  0x99, 0x84, 0x47, 0xbd, 0x1a, 0xab, 0x76, 0xf7, 0xb2, 0x57, 0xdb,
                   0x1,  0x0,  0x1c, 0xb5, 0xd8, 0xd6, 0x65, 0xe1, 0x30, 0x23, 0x5d, 0xce, 0xf0, 0x37, 0xc7, 0x3,  0x85,
                   0x84, 0x94, 0xd8, 0x37, 0x63, 0x3b, 0x49, 0x1f, 0xd4, 0x4,  0x1f, 0xda, 0x75, 0xb2, 0x2,  0x0,  0xf,
                   0x7a, 0x89, 0x46, 0x4c, 0x6d, 0x30, 0x37, 0x3d, 0xe6, 0x46, 0xcd, 0xf2, 0xd,  0xa4, 0xdd, 0x1,  0x0,
                   0x19, 0xbe, 0xb5, 0x60, 0x82, 0xea, 0xbb, 0xb0, 0x46, 0xc1, 0x95, 0xf2, 0xdf, 0x37, 0x82, 0xa7, 0x3e,
                   0x6,  0x16, 0x5f, 0x47, 0xf4, 0xec, 0x4d, 0xe6, 0xcc, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xbb, 0xc8, 0x9c, 0x21, 0x9e, 0xc,  0x34, 0x2,  0x0,  0xac, 0x5,  0xf4, 0x7e, 0xd0,
                                     0xac, 0x42, 0x13, 0x29, 0x91, 0x43, 0x31, 0xa6, 0x6d, 0xd0, 0xaf, 0xfe, 0x54};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x11, 0x7c, 0x18, 0xdb, 0x13, 0x8f, 0xf2, 0x5,  0x14, 0x56,
                                     0x18, 0x88, 0x88, 0x6f, 0xe,  0x1b, 0x13, 0x2f, 0x9e, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8c, 0x6e, 0x95, 0x67, 0x50, 0xa5, 0x85, 0x43, 0xb7, 0x8c, 0x90, 0xc3,
                                     0x49, 0xd,  0x1e, 0xd7, 0x20, 0xca, 0x45, 0x58, 0x4,  0xcb, 0x87};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x19};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x70, 0x3c, 0x95, 0xb5, 0x16, 0xeb, 0x62,
                                     0x3c, 0x4e, 0xf2, 0xcb, 0x70, 0x53, 0xad};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x5,  0xc2, 0xa5, 0x99, 0x3b, 0x97, 0xad, 0x8f, 0xdc,
                                     0x7a, 0xaf, 0x6e, 0xa8, 0x36, 0xbb, 0xe8, 0xf,  0x99, 0x84,
                                     0x47, 0xbd, 0x1a, 0xab, 0x76, 0xf7, 0xb2, 0x57, 0xdb};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb5, 0xd8, 0xd6, 0x65, 0xe1, 0x30, 0x23, 0x5d, 0xce, 0xf0,
                                     0x37, 0xc7, 0x3,  0x85, 0x84, 0x94, 0xd8, 0x37, 0x63, 0x3b,
                                     0x49, 0x1f, 0xd4, 0x4,  0x1f, 0xda, 0x75, 0xb2};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7a, 0x89, 0x46, 0x4c, 0x6d, 0x30, 0x37, 0x3d,
                                     0xe6, 0x46, 0xcd, 0xf2, 0xd,  0xa4, 0xdd};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xbe, 0xb5, 0x60, 0x82, 0xea, 0xbb, 0xb0, 0x46, 0xc1, 0x95, 0xf2, 0xdf, 0x37,
                                     0x82, 0xa7, 0x3e, 0x6,  0x16, 0x5f, 0x47, 0xf4, 0xec, 0x4d, 0xe6, 0xcc};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31044, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8770 [("\246\142&\218\222\148\226\196\212s~U\253",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\189\174\GS0\252J
// \229\&3J\f\139\225\150\221\DC4p\226\223",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\169Q;\220&z\151\248\&5\149\161\202h\ENQ\162\148\158\137b\203\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x40, 0x22, 0x42, 0x0,  0xd,  0xf6, 0x8e, 0x26, 0xda, 0xde, 0x94, 0xe2, 0xc4, 0xd4, 0x73, 0x7e,
                   0x55, 0xfd, 0x0,  0x0,  0x13, 0xbd, 0xae, 0x1d, 0x30, 0xfc, 0x4a, 0x20, 0xe5, 0x33, 0x4a, 0xc,  0x8b,
                   0xe1, 0x96, 0xdd, 0x14, 0x70, 0xe2, 0xdf, 0x2,  0x0,  0x15, 0xa9, 0x51, 0x3b, 0xdc, 0x26, 0x7a, 0x97,
                   0xf8, 0x35, 0x95, 0xa1, 0xca, 0x68, 0x5,  0xa2, 0x94, 0x9e, 0x89, 0x62, 0xcb, 0xc,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf6, 0x8e, 0x26, 0xda, 0xde, 0x94, 0xe2, 0xc4, 0xd4, 0x73, 0x7e, 0x55, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xae, 0x1d, 0x30, 0xfc, 0x4a, 0x20, 0xe5, 0x33, 0x4a,
                                     0xc,  0x8b, 0xe1, 0x96, 0xdd, 0x14, 0x70, 0xe2, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x51, 0x3b, 0xdc, 0x26, 0x7a, 0x97, 0xf8, 0x35, 0x95, 0xa1,
                                     0xca, 0x68, 0x5,  0xa2, 0x94, 0x9e, 0x89, 0x62, 0xcb, 0xc};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8770, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15580
// [("\145\183m\232\217\188\204_\223\249\161\170\156\133T\234\233\159\235\&2H\175J\211\149j",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("]\151",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\238\244E\141\168\203\228s?\190\232J\139\182N\157",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x37, 0x3c, 0xdc, 0x0,  0x1a, 0x91, 0xb7, 0x6d, 0xe8, 0xd9, 0xbc, 0xcc, 0x5f, 0xdf,
                   0xf9, 0xa1, 0xaa, 0x9c, 0x85, 0x54, 0xea, 0xe9, 0x9f, 0xeb, 0x32, 0x48, 0xaf, 0x4a, 0xd3,
                   0x95, 0x6a, 0x0,  0x0,  0x2,  0x5d, 0x97, 0x2,  0x0,  0x10, 0xee, 0xf4, 0x45, 0x8d, 0xa8,
                   0xcb, 0xe4, 0x73, 0x3f, 0xbe, 0xe8, 0x4a, 0x8b, 0xb6, 0x4e, 0x9d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x91, 0xb7, 0x6d, 0xe8, 0xd9, 0xbc, 0xcc, 0x5f, 0xdf, 0xf9, 0xa1, 0xaa, 0x9c,
                                     0x85, 0x54, 0xea, 0xe9, 0x9f, 0xeb, 0x32, 0x48, 0xaf, 0x4a, 0xd3, 0x95, 0x6a};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5d, 0x97};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xee, 0xf4, 0x45, 0x8d, 0xa8, 0xcb, 0xe4, 0x73,
                                     0x3f, 0xbe, 0xe8, 0x4a, 0x8b, 0xb6, 0x4e, 0x9d};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15580, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10667 [("I\153\NUL\206\134\163T\222V`b\232I\232\254u\213}=\145\234\200$\183#\148\179",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("T\SYN\184.5\131\&8r'\221\184\170AuL",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\194\SUB\SYN\139\NUL\NUL\233\RS\226\177\SUB\183\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\135\196\232\200\SOHm\GS\194\235\n|\SOH\251\ETB\f7\137\FS\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\225\240\SOH \SUB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(":1R\165-\228F\219>\136\EOT?\198\224\DC2\129Z\215\250V\188\192\150\220\CAN\185\202\208^",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("A\140\&8\DC4?\EMv\CAN\214\t\FS'\255\208n\209\218\188\140\229o@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("6\141\148A\161M\182\EM\129\DC4R",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("W'\224\128}N\177m\137c.\r!",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\159\&6B~\216U\149-\240\230\194\218\157\166\NAK",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\161\160\GS\211\175d\178\213\SOHv\135\171%\155B/\222\FS9(\185g\173\174x_I\224)",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0xea, 0x1,  0x29, 0xab, 0x0,  0x1b, 0x49, 0x99, 0x0,  0xce, 0x86, 0xa3, 0x54, 0xde, 0x56, 0x60,
                   0x62, 0xe8, 0x49, 0xe8, 0xfe, 0x75, 0xd5, 0x7d, 0x3d, 0x91, 0xea, 0xc8, 0x24, 0xb7, 0x23, 0x94, 0xb3,
                   0x1,  0x0,  0xf,  0x54, 0x16, 0xb8, 0x2e, 0x35, 0x83, 0x38, 0x72, 0x27, 0xdd, 0xb8, 0xaa, 0x41, 0x75,
                   0x4c, 0x1,  0x0,  0xd,  0xc2, 0x1a, 0x16, 0x8b, 0x0,  0x0,  0xe9, 0x1e, 0xe2, 0xb1, 0x1a, 0xb7, 0x80,
                   0x0,  0x0,  0x13, 0x87, 0xc4, 0xe8, 0xc8, 0x1,  0x6d, 0x1d, 0xc2, 0xeb, 0xa,  0x7c, 0x1,  0xfb, 0x17,
                   0xc,  0x37, 0x89, 0x1c, 0xd3, 0x2,  0x0,  0x5,  0xe1, 0xf0, 0x1,  0x20, 0x1a, 0x0,  0x0,  0x1d, 0x3a,
                   0x31, 0x52, 0xa5, 0x2d, 0xe4, 0x46, 0xdb, 0x3e, 0x88, 0x4,  0x3f, 0xc6, 0xe0, 0x12, 0x81, 0x5a, 0xd7,
                   0xfa, 0x56, 0xbc, 0xc0, 0x96, 0xdc, 0x18, 0xb9, 0xca, 0xd0, 0x5e, 0x2,  0x0,  0x16, 0x41, 0x8c, 0x38,
                   0x14, 0x3f, 0x19, 0x76, 0x18, 0xd6, 0x9,  0x1c, 0x27, 0xff, 0xd0, 0x6e, 0xd1, 0xda, 0xbc, 0x8c, 0xe5,
                   0x6f, 0x40, 0x1,  0x0,  0xb,  0x36, 0x8d, 0x94, 0x41, 0xa1, 0x4d, 0xb6, 0x19, 0x81, 0x14, 0x52, 0x2,
                   0x0,  0xd,  0x57, 0x27, 0xe0, 0x80, 0x7d, 0x4e, 0xb1, 0x6d, 0x89, 0x63, 0x2e, 0xd,  0x21, 0x0,  0x0,
                   0xf,  0x9f, 0x36, 0x42, 0x7e, 0xd8, 0x55, 0x95, 0x2d, 0xf0, 0xe6, 0xc2, 0xda, 0x9d, 0xa6, 0x15, 0x0,
                   0x0,  0x1e, 0x31, 0xa1, 0xa0, 0x1d, 0xd3, 0xaf, 0x64, 0xb2, 0xd5, 0x1,  0x76, 0x87, 0xab, 0x25, 0x9b,
                   0x42, 0x2f, 0xde, 0x1c, 0x39, 0x28, 0xb9, 0x67, 0xad, 0xae, 0x78, 0x5f, 0x49, 0xe0, 0x29, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0x99, 0x0,  0xce, 0x86, 0xa3, 0x54, 0xde, 0x56, 0x60, 0x62, 0xe8, 0x49, 0xe8,
                                     0xfe, 0x75, 0xd5, 0x7d, 0x3d, 0x91, 0xea, 0xc8, 0x24, 0xb7, 0x23, 0x94, 0xb3};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0x16, 0xb8, 0x2e, 0x35, 0x83, 0x38, 0x72,
                                     0x27, 0xdd, 0xb8, 0xaa, 0x41, 0x75, 0x4c};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc2, 0x1a, 0x16, 0x8b, 0x0, 0x0, 0xe9, 0x1e, 0xe2, 0xb1, 0x1a, 0xb7, 0x80};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x87, 0xc4, 0xe8, 0xc8, 0x1, 0x6d, 0x1d, 0xc2, 0xeb, 0xa,
                                     0x7c, 0x1,  0xfb, 0x17, 0xc, 0x37, 0x89, 0x1c, 0xd3};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe1, 0xf0, 0x1, 0x20, 0x1a};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3a, 0x31, 0x52, 0xa5, 0x2d, 0xe4, 0x46, 0xdb, 0x3e, 0x88,
                                     0x4,  0x3f, 0xc6, 0xe0, 0x12, 0x81, 0x5a, 0xd7, 0xfa, 0x56,
                                     0xbc, 0xc0, 0x96, 0xdc, 0x18, 0xb9, 0xca, 0xd0, 0x5e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x8c, 0x38, 0x14, 0x3f, 0x19, 0x76, 0x18, 0xd6, 0x9,  0x1c,
                                     0x27, 0xff, 0xd0, 0x6e, 0xd1, 0xda, 0xbc, 0x8c, 0xe5, 0x6f, 0x40};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x36, 0x8d, 0x94, 0x41, 0xa1, 0x4d, 0xb6, 0x19, 0x81, 0x14, 0x52};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x57, 0x27, 0xe0, 0x80, 0x7d, 0x4e, 0xb1, 0x6d, 0x89, 0x63, 0x2e, 0xd, 0x21};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x9f, 0x36, 0x42, 0x7e, 0xd8, 0x55, 0x95, 0x2d,
                                     0xf0, 0xe6, 0xc2, 0xda, 0x9d, 0xa6, 0x15};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x31, 0xa1, 0xa0, 0x1d, 0xd3, 0xaf, 0x64, 0xb2, 0xd5, 0x1,
                                      0x76, 0x87, 0xab, 0x25, 0x9b, 0x42, 0x2f, 0xde, 0x1c, 0x39,
                                      0x28, 0xb9, 0x67, 0xad, 0xae, 0x78, 0x5f, 0x49, 0xe0, 0x29};
  lwmqtt_string_t topic_filter_s10 = {30, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10667, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13196 [("\171M\DLE+(\172\SIL\DEL",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS2}),("\182H\165\138\247\bHO\207\164\ACKr\239\151\ENQ\137\190k\182\&4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\231~\137\219\155\189\239N\199\208$X\206\145\176Q0\SIv\145\ETX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\135\&4Dk@\b\247\150\217%:t\198f\195\&4",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\186,\216\227\251\233`o\219\177\179\DC4\ETB\226\180\143\194\CAN\202\140\&1Y\213\a\ACKq\165^",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x6f, 0x33, 0x8c, 0x0,  0x9,  0xab, 0x4d, 0x10, 0x2b, 0x28, 0xac, 0xf,  0x4c, 0x7f, 0x2,  0x0,
                   0x14, 0xb6, 0x48, 0xa5, 0x8a, 0xf7, 0x8,  0x48, 0x4f, 0xcf, 0xa4, 0x6,  0x72, 0xef, 0x97, 0x5,  0x89,
                   0xbe, 0x6b, 0xb6, 0x34, 0x2,  0x0,  0x15, 0xe7, 0x7e, 0x89, 0xdb, 0x9b, 0xbd, 0xef, 0x4e, 0xc7, 0xd0,
                   0x24, 0x58, 0xce, 0x91, 0xb0, 0x51, 0x30, 0xf,  0x76, 0x91, 0x3,  0x2,  0x0,  0x10, 0x87, 0x34, 0x44,
                   0x6b, 0x40, 0x8,  0xf7, 0x96, 0xd9, 0x25, 0x3a, 0x74, 0xc6, 0x66, 0xc3, 0x34, 0x2,  0x0,  0x1c, 0xba,
                   0x2c, 0xd8, 0xe3, 0xfb, 0xe9, 0x60, 0x6f, 0xdb, 0xb1, 0xb3, 0x14, 0x17, 0xe2, 0xb4, 0x8f, 0xc2, 0x18,
                   0xca, 0x8c, 0x31, 0x59, 0xd5, 0x7,  0x6,  0x71, 0xa5, 0x5e, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x4d, 0x10, 0x2b, 0x28, 0xac, 0xf, 0x4c, 0x7f};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0x48, 0xa5, 0x8a, 0xf7, 0x8,  0x48, 0x4f, 0xcf, 0xa4,
                                     0x6,  0x72, 0xef, 0x97, 0x5,  0x89, 0xbe, 0x6b, 0xb6, 0x34};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe7, 0x7e, 0x89, 0xdb, 0x9b, 0xbd, 0xef, 0x4e, 0xc7, 0xd0, 0x24,
                                     0x58, 0xce, 0x91, 0xb0, 0x51, 0x30, 0xf,  0x76, 0x91, 0x3};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x87, 0x34, 0x44, 0x6b, 0x40, 0x8,  0xf7, 0x96,
                                     0xd9, 0x25, 0x3a, 0x74, 0xc6, 0x66, 0xc3, 0x34};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xba, 0x2c, 0xd8, 0xe3, 0xfb, 0xe9, 0x60, 0x6f, 0xdb, 0xb1,
                                     0xb3, 0x14, 0x17, 0xe2, 0xb4, 0x8f, 0xc2, 0x18, 0xca, 0x8c,
                                     0x31, 0x59, 0xd5, 0x7,  0x6,  0x71, 0xa5, 0x5e};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13196, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11145 [("\237\a\171\195\220\245\232@\229P\146~C\193\193\139\138\EOTF\139\ACK\135\ETX\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x1d, 0x2b, 0x89, 0x0,  0x18, 0xed, 0x7, 0xab, 0xc3, 0xdc, 0xf5, 0xe8, 0x40, 0xe5, 0x50,
                   0x92, 0x7e, 0x43, 0xc1, 0xc1, 0x8b, 0x8a, 0x4, 0x46, 0x8b, 0x6,  0x87, 0x3,  0xfd, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x7,  0xab, 0xc3, 0xdc, 0xf5, 0xe8, 0x40, 0xe5, 0x50, 0x92, 0x7e,
                                     0x43, 0xc1, 0xc1, 0x8b, 0x8a, 0x4,  0x46, 0x8b, 0x6,  0x87, 0x3,  0xfd};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11145, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22549
// [("q&N\176\217\FS\143\140\217\b\164\171\163\233\237\200\214\223\156\197\201\182e\DC3q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\251N<\255g\164",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\236\US\180\241\219\242\200\196\229J\244\135\&7]\225L\136\132\213\128\&8\252\234\US\157\230k\NAK}g",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\157FH\237\157\&9\207X2\190\240\162\239\164",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x59, 0x58, 0x15, 0x0,  0x19, 0x71, 0x26, 0x4e, 0xb0, 0xd9, 0x1c, 0x8f, 0x8c, 0xd9, 0x8,
                   0xa4, 0xab, 0xa3, 0xe9, 0xed, 0xc8, 0xd6, 0xdf, 0x9c, 0xc5, 0xc9, 0xb6, 0x65, 0x13, 0x71, 0x0,
                   0x0,  0x6,  0xfb, 0x4e, 0x3c, 0xff, 0x67, 0xa4, 0x1,  0x0,  0x1e, 0xec, 0x1f, 0xb4, 0xf1, 0xdb,
                   0xf2, 0xc8, 0xc4, 0xe5, 0x4a, 0xf4, 0x87, 0x37, 0x5d, 0xe1, 0x4c, 0x88, 0x84, 0xd5, 0x80, 0x38,
                   0xfc, 0xea, 0x1f, 0x9d, 0xe6, 0x6b, 0x15, 0x7d, 0x67, 0x2,  0x0,  0xe,  0x9d, 0x46, 0x48, 0xed,
                   0x9d, 0x39, 0xcf, 0x58, 0x32, 0xbe, 0xf0, 0xa2, 0xef, 0xa4, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0x26, 0x4e, 0xb0, 0xd9, 0x1c, 0x8f, 0x8c, 0xd9, 0x8,  0xa4, 0xab, 0xa3,
                                     0xe9, 0xed, 0xc8, 0xd6, 0xdf, 0x9c, 0xc5, 0xc9, 0xb6, 0x65, 0x13, 0x71};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfb, 0x4e, 0x3c, 0xff, 0x67, 0xa4};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x1f, 0xb4, 0xf1, 0xdb, 0xf2, 0xc8, 0xc4, 0xe5, 0x4a,
                                     0xf4, 0x87, 0x37, 0x5d, 0xe1, 0x4c, 0x88, 0x84, 0xd5, 0x80,
                                     0x38, 0xfc, 0xea, 0x1f, 0x9d, 0xe6, 0x6b, 0x15, 0x7d, 0x67};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9d, 0x46, 0x48, 0xed, 0x9d, 0x39, 0xcf,
                                     0x58, 0x32, 0xbe, 0xf0, 0xa2, 0xef, 0xa4};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22549, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18393 [("{\US\242",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\201=\vz\142\EOT\237}\162$\ETXL\232c\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247y\217\183\158j\243\153\130ub\232\193\210\DC4lt\EOTGRnv",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("8\140\&6\235T\162\129K\250\154E\163q\165\161\233\218\239\191\198%\208\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\138)\154\144@\221\174\188\n\143\197\159E6\191\149\251",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("Vi\140c:I\156\DEL\172\220A\GS9zg\167",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\193\198\250h\138\172\219di\163g\DC3\186`\129\162\202w\171\252",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x92, 0x1,  0x47, 0xd9, 0x0,  0x3,  0x7b, 0x1f, 0xf2, 0x0,  0x0,  0xf,  0xc9, 0x3d, 0xb,  0x7a,
                   0x8e, 0x4,  0xed, 0x7d, 0xa2, 0x24, 0x3,  0x4c, 0xe8, 0x63, 0x1e, 0x2,  0x0,  0x16, 0xf7, 0x79, 0xd9,
                   0xb7, 0x9e, 0x6a, 0xf3, 0x99, 0x82, 0x75, 0x62, 0xe8, 0xc1, 0xd2, 0x14, 0x6c, 0x74, 0x4,  0x47, 0x52,
                   0x6e, 0x76, 0x1,  0x0,  0x17, 0x38, 0x8c, 0x36, 0xeb, 0x54, 0xa2, 0x81, 0x4b, 0xfa, 0x9a, 0x45, 0xa3,
                   0x71, 0xa5, 0xa1, 0xe9, 0xda, 0xef, 0xbf, 0xc6, 0x25, 0xd0, 0xde, 0x2,  0x0,  0x1,  0xa7, 0x0,  0x0,
                   0x0,  0x0,  0x0,  0x11, 0x8a, 0x29, 0x9a, 0x90, 0x40, 0xdd, 0xae, 0xbc, 0xa,  0x8f, 0xc5, 0x9f, 0x45,
                   0x36, 0xbf, 0x95, 0xfb, 0x0,  0x0,  0x10, 0x56, 0x69, 0x8c, 0x63, 0x3a, 0x49, 0x9c, 0x7f, 0xac, 0xdc,
                   0x41, 0x1d, 0x39, 0x7a, 0x67, 0xa7, 0x1,  0x0,  0x14, 0xc1, 0xc6, 0xfa, 0x68, 0x8a, 0xac, 0xdb, 0x64,
                   0x69, 0xa3, 0x67, 0x13, 0xba, 0x60, 0x81, 0xa2, 0xca, 0x77, 0xab, 0xfc, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x7b, 0x1f, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc9, 0x3d, 0xb, 0x7a, 0x8e, 0x4,  0xed, 0x7d,
                                     0xa2, 0x24, 0x3, 0x4c, 0xe8, 0x63, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf7, 0x79, 0xd9, 0xb7, 0x9e, 0x6a, 0xf3, 0x99, 0x82, 0x75, 0x62,
                                     0xe8, 0xc1, 0xd2, 0x14, 0x6c, 0x74, 0x4,  0x47, 0x52, 0x6e, 0x76};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x38, 0x8c, 0x36, 0xeb, 0x54, 0xa2, 0x81, 0x4b, 0xfa, 0x9a, 0x45, 0xa3,
                                     0x71, 0xa5, 0xa1, 0xe9, 0xda, 0xef, 0xbf, 0xc6, 0x25, 0xd0, 0xde};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s4 = {1, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8a, 0x29, 0x9a, 0x90, 0x40, 0xdd, 0xae, 0xbc, 0xa,
                                     0x8f, 0xc5, 0x9f, 0x45, 0x36, 0xbf, 0x95, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x56, 0x69, 0x8c, 0x63, 0x3a, 0x49, 0x9c, 0x7f,
                                     0xac, 0xdc, 0x41, 0x1d, 0x39, 0x7a, 0x67, 0xa7};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc1, 0xc6, 0xfa, 0x68, 0x8a, 0xac, 0xdb, 0x64, 0x69, 0xa3,
                                     0x67, 0x13, 0xba, 0x60, 0x81, 0xa2, 0xca, 0x77, 0xab, 0xfc};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18393, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28507 [("\146\199\232\fj\226d",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("*\213\134P\169\&0S\207\229-\255G\158",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\226\203\183\nO\231\151\nD\225\208!\169N\166\228\220#\DC2WU\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\251\t\179",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("~\144J\231\"6\CAN\145#\205z]\ETXUK\212\&7\145\EOT\176\252\SO",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("a&xM$\210\&9\179\194\SI\232\178-s\215;\DC3E\193\184\RS\SOH\177:S\170\ESC\167\158\220",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\243<g\211\198\"Qzu\184R\a_c\a\145(}%\SUBn1\DEL& .\228\165",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\241\132\161\156\244\141F\218\249\201\204\144\202\196\&9`\GS\165",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("q\153\236Z\130\171\216\197\231W\253\192\139w\159\140\236\ENQ\215~\174\170t\NUL\154\179{\GS\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("0^\RS\201\&4\228\214UU\a.\252\227V\\\SOH\198\n.\162\217\196",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\167Y1\156C@\EOTw\191",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xee, 0x1,  0x6f, 0x5b, 0x0,  0x7,  0x92, 0xc7, 0xe8, 0xc,  0x6a, 0xe2, 0x64, 0x2,  0x0,  0xd,  0x2a, 0xd5,
      0x86, 0x50, 0xa9, 0x30, 0x53, 0xcf, 0xe5, 0x2d, 0xff, 0x47, 0x9e, 0x1,  0x0,  0x16, 0xe2, 0xcb, 0xb7, 0xa,  0x4f,
      0xe7, 0x97, 0xa,  0x44, 0xe1, 0xd0, 0x21, 0xa9, 0x4e, 0xa6, 0xe4, 0xdc, 0x23, 0x12, 0x57, 0x55, 0xf,  0x0,  0x0,
      0x3,  0xfb, 0x9,  0xb3, 0x1,  0x0,  0x16, 0x7e, 0x90, 0x4a, 0xe7, 0x22, 0x36, 0x18, 0x91, 0x23, 0xcd, 0x7a, 0x5d,
      0x3,  0x55, 0x4b, 0xd4, 0x37, 0x91, 0x4,  0xb0, 0xfc, 0xe,  0x1,  0x0,  0x1e, 0x61, 0x26, 0x78, 0x4d, 0x24, 0xd2,
      0x39, 0xb3, 0xc2, 0xf,  0xe8, 0xb2, 0x2d, 0x73, 0xd7, 0x3b, 0x13, 0x45, 0xc1, 0xb8, 0x1e, 0x1,  0xb1, 0x3a, 0x53,
      0xaa, 0x1b, 0xa7, 0x9e, 0xdc, 0x0,  0x0,  0x1c, 0xf3, 0x3c, 0x67, 0xd3, 0xc6, 0x22, 0x51, 0x7a, 0x75, 0xb8, 0x52,
      0x7,  0x5f, 0x63, 0x7,  0x91, 0x28, 0x7d, 0x25, 0x1a, 0x6e, 0x31, 0x7f, 0x26, 0x20, 0x2e, 0xe4, 0xa5, 0x1,  0x0,
      0x12, 0xf1, 0x84, 0xa1, 0x9c, 0xf4, 0x8d, 0x46, 0xda, 0xf9, 0xc9, 0xcc, 0x90, 0xca, 0xc4, 0x39, 0x60, 0x1d, 0xa5,
      0x2,  0x0,  0x1d, 0x71, 0x99, 0xec, 0x5a, 0x82, 0xab, 0xd8, 0xc5, 0xe7, 0x57, 0xfd, 0xc0, 0x8b, 0x77, 0x9f, 0x8c,
      0xec, 0x5,  0xd7, 0x7e, 0xae, 0xaa, 0x74, 0x0,  0x9a, 0xb3, 0x7b, 0x1d, 0xfd, 0x1,  0x0,  0x16, 0x30, 0x5e, 0x1e,
      0xc9, 0x34, 0xe4, 0xd6, 0x55, 0x55, 0x7,  0x2e, 0xfc, 0xe3, 0x56, 0x5c, 0x1,  0xc6, 0xa,  0x2e, 0xa2, 0xd9, 0xc4,
      0x0,  0x0,  0x9,  0xa7, 0x59, 0x31, 0x9c, 0x43, 0x40, 0x4,  0x77, 0xbf, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x92, 0xc7, 0xe8, 0xc, 0x6a, 0xe2, 0x64};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2a, 0xd5, 0x86, 0x50, 0xa9, 0x30, 0x53, 0xcf, 0xe5, 0x2d, 0xff, 0x47, 0x9e};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe2, 0xcb, 0xb7, 0xa,  0x4f, 0xe7, 0x97, 0xa,  0x44, 0xe1, 0xd0,
                                     0x21, 0xa9, 0x4e, 0xa6, 0xe4, 0xdc, 0x23, 0x12, 0x57, 0x55, 0xf};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfb, 0x9, 0xb3};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7e, 0x90, 0x4a, 0xe7, 0x22, 0x36, 0x18, 0x91, 0x23, 0xcd, 0x7a,
                                     0x5d, 0x3,  0x55, 0x4b, 0xd4, 0x37, 0x91, 0x4,  0xb0, 0xfc, 0xe};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x61, 0x26, 0x78, 0x4d, 0x24, 0xd2, 0x39, 0xb3, 0xc2, 0xf,
                                     0xe8, 0xb2, 0x2d, 0x73, 0xd7, 0x3b, 0x13, 0x45, 0xc1, 0xb8,
                                     0x1e, 0x1,  0xb1, 0x3a, 0x53, 0xaa, 0x1b, 0xa7, 0x9e, 0xdc};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf3, 0x3c, 0x67, 0xd3, 0xc6, 0x22, 0x51, 0x7a, 0x75, 0xb8,
                                     0x52, 0x7,  0x5f, 0x63, 0x7,  0x91, 0x28, 0x7d, 0x25, 0x1a,
                                     0x6e, 0x31, 0x7f, 0x26, 0x20, 0x2e, 0xe4, 0xa5};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf1, 0x84, 0xa1, 0x9c, 0xf4, 0x8d, 0x46, 0xda, 0xf9,
                                     0xc9, 0xcc, 0x90, 0xca, 0xc4, 0x39, 0x60, 0x1d, 0xa5};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x71, 0x99, 0xec, 0x5a, 0x82, 0xab, 0xd8, 0xc5, 0xe7, 0x57,
                                     0xfd, 0xc0, 0x8b, 0x77, 0x9f, 0x8c, 0xec, 0x5,  0xd7, 0x7e,
                                     0xae, 0xaa, 0x74, 0x0,  0x9a, 0xb3, 0x7b, 0x1d, 0xfd};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x30, 0x5e, 0x1e, 0xc9, 0x34, 0xe4, 0xd6, 0x55, 0x55, 0x7,  0x2e,
                                     0xfc, 0xe3, 0x56, 0x5c, 0x1,  0xc6, 0xa,  0x2e, 0xa2, 0xd9, 0xc4};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa7, 0x59, 0x31, 0x9c, 0x43, 0x40, 0x4, 0x77, 0xbf};
  lwmqtt_string_t topic_filter_s10 = {9, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28507, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23094 [("\128\&6\225\129\221\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\163\250\137\240\239Q\202\n\217\167\232\STX\199\245m\147/\184\154\ESC\\-F\223\n\141\220\&1'\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\254\143\243T\251\204J",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("\250\165\218\255^o\227\134\STXZ\172\209\130\n7F\146\SO\237~H",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\173\FS\206\233\172\r\198\\\142\185*\217L1\233v`",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x62, 0x5a, 0x36, 0x0,  0x6,  0x80, 0x36, 0xe1, 0x81, 0xdd, 0xaa, 0x0,  0x0,  0x1e, 0xa3, 0xfa,
                   0x89, 0xf0, 0xef, 0x51, 0xca, 0xa,  0xd9, 0xa7, 0xe8, 0x2,  0xc7, 0xf5, 0x6d, 0x93, 0x2f, 0xb8, 0x9a,
                   0x1b, 0x5c, 0x2d, 0x46, 0xdf, 0xa,  0x8d, 0xdc, 0x31, 0x27, 0xc4, 0x2,  0x0,  0x7,  0xfe, 0x8f, 0xf3,
                   0x54, 0xfb, 0xcc, 0x4a, 0x0,  0x0,  0x15, 0xfa, 0xa5, 0xda, 0xff, 0x5e, 0x6f, 0xe3, 0x86, 0x2,  0x5a,
                   0xac, 0xd1, 0x82, 0xa,  0x37, 0x46, 0x92, 0xe,  0xed, 0x7e, 0x48, 0x0,  0x0,  0x11, 0xad, 0x1c, 0xce,
                   0xe9, 0xac, 0xd,  0xc6, 0x5c, 0x8e, 0xb9, 0x2a, 0xd9, 0x4c, 0x31, 0xe9, 0x76, 0x60, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0x36, 0xe1, 0x81, 0xdd, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa3, 0xfa, 0x89, 0xf0, 0xef, 0x51, 0xca, 0xa,  0xd9, 0xa7,
                                     0xe8, 0x2,  0xc7, 0xf5, 0x6d, 0x93, 0x2f, 0xb8, 0x9a, 0x1b,
                                     0x5c, 0x2d, 0x46, 0xdf, 0xa,  0x8d, 0xdc, 0x31, 0x27, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfe, 0x8f, 0xf3, 0x54, 0xfb, 0xcc, 0x4a};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfa, 0xa5, 0xda, 0xff, 0x5e, 0x6f, 0xe3, 0x86, 0x2,  0x5a, 0xac,
                                     0xd1, 0x82, 0xa,  0x37, 0x46, 0x92, 0xe,  0xed, 0x7e, 0x48};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xad, 0x1c, 0xce, 0xe9, 0xac, 0xd,  0xc6, 0x5c, 0x8e,
                                     0xb9, 0x2a, 0xd9, 0x4c, 0x31, 0xe9, 0x76, 0x60};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23094, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7726 [("\143]\132\&9x\254\"\152\138W\190\240~<U\178\182iJq\228\135N\NUL\156m\185\232\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\195\205\236\USx%\189\181\215b\178\160\164u\241*\226\141V=9t\228(\228",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("n\SOG\164\166!\CAN\241\CANL\166\170AT\220\186\136\194\163\223\209\233;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\142\DLEG\CANDX8\GSp\223\137\248Wb5\RS\157\214\142\SYN\177K\ENQr\NUL",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\212r\ENQ\223Vje;r\193\137AS6\239\&1\167~\192\&2\174q\243",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("+\DLE.\136\EOT\139\175\183\191\181",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170Fn\158",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("\233/\176\br$c\158\v\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("h-\196\177\189\250J\CANE\236\154\218\131\142\183\ACK\247\154\169#\207c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("T\231\n\r,03!\135\DC2\225lU?\SI\132\208\254\164\159\177\195\t\132\220j?",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\164\238\144r\220E\CANQ\216\130\171\SYN)D\160\179U",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0xfa, 0x1,  0x1e, 0x2e, 0x0,  0x1d, 0x8f, 0x5d, 0x84, 0x39, 0x78, 0xfe, 0x22, 0x98, 0x8a, 0x57,
                   0xbe, 0xf0, 0x7e, 0x3c, 0x55, 0xb2, 0xb6, 0x69, 0x4a, 0x71, 0xe4, 0x87, 0x4e, 0x0,  0x9c, 0x6d, 0xb9,
                   0xe8, 0xfe, 0x2,  0x0,  0x19, 0xc3, 0xcd, 0xec, 0x1f, 0x78, 0x25, 0xbd, 0xb5, 0xd7, 0x62, 0xb2, 0xa0,
                   0xa4, 0x75, 0xf1, 0x2a, 0xe2, 0x8d, 0x56, 0x3d, 0x39, 0x74, 0xe4, 0x28, 0xe4, 0x1,  0x0,  0x17, 0x6e,
                   0xe,  0x47, 0xa4, 0xa6, 0x21, 0x18, 0xf1, 0x18, 0x4c, 0xa6, 0xaa, 0x41, 0x54, 0xdc, 0xba, 0x88, 0xc2,
                   0xa3, 0xdf, 0xd1, 0xe9, 0x3b, 0x2,  0x0,  0x19, 0x8e, 0x10, 0x47, 0x18, 0x44, 0x58, 0x38, 0x1d, 0x70,
                   0xdf, 0x89, 0xf8, 0x57, 0x62, 0x35, 0x1e, 0x9d, 0xd6, 0x8e, 0x16, 0xb1, 0x4b, 0x5,  0x72, 0x0,  0x1,
                   0x0,  0x17, 0xd4, 0x72, 0x5,  0xdf, 0x56, 0x6a, 0x65, 0x3b, 0x72, 0xc1, 0x89, 0x41, 0x53, 0x36, 0xef,
                   0x31, 0xa7, 0x7e, 0xc0, 0x32, 0xae, 0x71, 0xf3, 0x0,  0x0,  0xa,  0x2b, 0x10, 0x2e, 0x88, 0x4,  0x8b,
                   0xaf, 0xb7, 0xbf, 0xb5, 0x0,  0x0,  0x4,  0xaa, 0x46, 0x6e, 0x9e, 0x2,  0x0,  0xa,  0xe9, 0x2f, 0xb0,
                   0x8,  0x72, 0x24, 0x63, 0x9e, 0xb,  0xe8, 0x2,  0x0,  0x16, 0x68, 0x2d, 0xc4, 0xb1, 0xbd, 0xfa, 0x4a,
                   0x18, 0x45, 0xec, 0x9a, 0xda, 0x83, 0x8e, 0xb7, 0x6,  0xf7, 0x9a, 0xa9, 0x23, 0xcf, 0x63, 0x0,  0x0,
                   0x1b, 0x54, 0xe7, 0xa,  0xd,  0x2c, 0x30, 0x33, 0x21, 0x87, 0x12, 0xe1, 0x6c, 0x55, 0x3f, 0xf,  0x84,
                   0xd0, 0xfe, 0xa4, 0x9f, 0xb1, 0xc3, 0x9,  0x84, 0xdc, 0x6a, 0x3f, 0x0,  0x0,  0x11, 0xa4, 0xee, 0x90,
                   0x72, 0xdc, 0x45, 0x18, 0x51, 0xd8, 0x82, 0xab, 0x16, 0x29, 0x44, 0xa0, 0xb3, 0x55, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x8f, 0x5d, 0x84, 0x39, 0x78, 0xfe, 0x22, 0x98, 0x8a, 0x57,
                                     0xbe, 0xf0, 0x7e, 0x3c, 0x55, 0xb2, 0xb6, 0x69, 0x4a, 0x71,
                                     0xe4, 0x87, 0x4e, 0x0,  0x9c, 0x6d, 0xb9, 0xe8, 0xfe};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0xcd, 0xec, 0x1f, 0x78, 0x25, 0xbd, 0xb5, 0xd7, 0x62, 0xb2, 0xa0, 0xa4,
                                     0x75, 0xf1, 0x2a, 0xe2, 0x8d, 0x56, 0x3d, 0x39, 0x74, 0xe4, 0x28, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6e, 0xe,  0x47, 0xa4, 0xa6, 0x21, 0x18, 0xf1, 0x18, 0x4c, 0xa6, 0xaa,
                                     0x41, 0x54, 0xdc, 0xba, 0x88, 0xc2, 0xa3, 0xdf, 0xd1, 0xe9, 0x3b};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8e, 0x10, 0x47, 0x18, 0x44, 0x58, 0x38, 0x1d, 0x70, 0xdf, 0x89, 0xf8, 0x57,
                                     0x62, 0x35, 0x1e, 0x9d, 0xd6, 0x8e, 0x16, 0xb1, 0x4b, 0x5,  0x72, 0x0};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0x72, 0x5,  0xdf, 0x56, 0x6a, 0x65, 0x3b, 0x72, 0xc1, 0x89, 0x41,
                                     0x53, 0x36, 0xef, 0x31, 0xa7, 0x7e, 0xc0, 0x32, 0xae, 0x71, 0xf3};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2b, 0x10, 0x2e, 0x88, 0x4, 0x8b, 0xaf, 0xb7, 0xbf, 0xb5};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0x46, 0x6e, 0x9e};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe9, 0x2f, 0xb0, 0x8, 0x72, 0x24, 0x63, 0x9e, 0xb, 0xe8};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x68, 0x2d, 0xc4, 0xb1, 0xbd, 0xfa, 0x4a, 0x18, 0x45, 0xec, 0x9a,
                                     0xda, 0x83, 0x8e, 0xb7, 0x6,  0xf7, 0x9a, 0xa9, 0x23, 0xcf, 0x63};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x54, 0xe7, 0xa,  0xd,  0x2c, 0x30, 0x33, 0x21, 0x87, 0x12, 0xe1, 0x6c, 0x55, 0x3f,
                                     0xf,  0x84, 0xd0, 0xfe, 0xa4, 0x9f, 0xb1, 0xc3, 0x9,  0x84, 0xdc, 0x6a, 0x3f};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa4, 0xee, 0x90, 0x72, 0xdc, 0x45, 0x18, 0x51, 0xd8,
                                      0x82, 0xab, 0x16, 0x29, 0x44, 0xa0, 0xb3, 0x55};
  lwmqtt_string_t topic_filter_s10 = {17, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7726, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1195 [("\ETX\191\156\US3\137\&5\190a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\165\NAK\196P
// \236\172\197M\140\177r\SUB\159",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\RS\207\192\216\168",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("3\221i\DC1\162\226\214EnW\250\156\230\182;V\195\230d\NUL\174<\173J\139\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\250u\151\159P'\139\EM\157U\250+\NAKH\146+V\202Rz",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\199USx\174ia\GSz\ACK\DC2\\)\192\SOHC\142`/|\206J`DO",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\234\194\129~z9_E\fvk\232\168i1})/\136RT\141\170\184:\210@\227I",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("D\169\215/0R\DEL\201>\234\155>\147W\SOv%\NAK\US\230l",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\155\"\219\&9`\138\145\182\&3\178\147\226G\a[h\191`\212`\185\143",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("a]\205\220o\197]\139qT\177$?P\151\158\141=\231\157\249k\231H\159\163.",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0xe6, 0x1,  0x4,  0xab, 0x0,  0x9,  0x3,  0xbf, 0x9c, 0x1f, 0x33, 0x89, 0x35, 0xbe, 0x61, 0x0,
                   0x0,  0xe,  0xa5, 0x15, 0xc4, 0x50, 0x20, 0xec, 0xac, 0xc5, 0x4d, 0x8c, 0xb1, 0x72, 0x1a, 0x9f, 0x0,
                   0x0,  0x5,  0x1e, 0xcf, 0xc0, 0xd8, 0xa8, 0x0,  0x0,  0x1a, 0x33, 0xdd, 0x69, 0x11, 0xa2, 0xe2, 0xd6,
                   0x45, 0x6e, 0x57, 0xfa, 0x9c, 0xe6, 0xb6, 0x3b, 0x56, 0xc3, 0xe6, 0x64, 0x0,  0xae, 0x3c, 0xad, 0x4a,
                   0x8b, 0xa0, 0x1,  0x0,  0x14, 0xfa, 0x75, 0x97, 0x9f, 0x50, 0x27, 0x8b, 0x19, 0x9d, 0x55, 0xfa, 0x2b,
                   0x15, 0x48, 0x92, 0x2b, 0x56, 0xca, 0x52, 0x7a, 0x1,  0x0,  0x19, 0xc7, 0x55, 0x53, 0x78, 0xae, 0x69,
                   0x61, 0x1d, 0x7a, 0x6,  0x12, 0x5c, 0x29, 0xc0, 0x1,  0x43, 0x8e, 0x60, 0x2f, 0x7c, 0xce, 0x4a, 0x60,
                   0x44, 0x4f, 0x1,  0x0,  0x1d, 0xea, 0xc2, 0x81, 0x7e, 0x7a, 0x39, 0x5f, 0x45, 0xc,  0x76, 0x6b, 0xe8,
                   0xa8, 0x69, 0x31, 0x7d, 0x29, 0x2f, 0x88, 0x52, 0x54, 0x8d, 0xaa, 0xb8, 0x3a, 0xd2, 0x40, 0xe3, 0x49,
                   0x1,  0x0,  0x15, 0x44, 0xa9, 0xd7, 0x2f, 0x30, 0x52, 0x7f, 0xc9, 0x3e, 0xea, 0x9b, 0x3e, 0x93, 0x57,
                   0xe,  0x76, 0x25, 0x15, 0x1f, 0xe6, 0x6c, 0x1,  0x0,  0x16, 0x9b, 0x22, 0xdb, 0x39, 0x60, 0x8a, 0x91,
                   0xb6, 0x33, 0xb2, 0x93, 0xe2, 0x47, 0x7,  0x5b, 0x68, 0xbf, 0x60, 0xd4, 0x60, 0xb9, 0x8f, 0x0,  0x0,
                   0x1b, 0x61, 0x5d, 0xcd, 0xdc, 0x6f, 0xc5, 0x5d, 0x8b, 0x71, 0x54, 0xb1, 0x24, 0x3f, 0x50, 0x97, 0x9e,
                   0x8d, 0x3d, 0xe7, 0x9d, 0xf9, 0x6b, 0xe7, 0x48, 0x9f, 0xa3, 0x2e, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x3, 0xbf, 0x9c, 0x1f, 0x33, 0x89, 0x35, 0xbe, 0x61};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa5, 0x15, 0xc4, 0x50, 0x20, 0xec, 0xac,
                                     0xc5, 0x4d, 0x8c, 0xb1, 0x72, 0x1a, 0x9f};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1e, 0xcf, 0xc0, 0xd8, 0xa8};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x33, 0xdd, 0x69, 0x11, 0xa2, 0xe2, 0xd6, 0x45, 0x6e, 0x57, 0xfa, 0x9c, 0xe6,
                                     0xb6, 0x3b, 0x56, 0xc3, 0xe6, 0x64, 0x0,  0xae, 0x3c, 0xad, 0x4a, 0x8b, 0xa0};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfa, 0x75, 0x97, 0x9f, 0x50, 0x27, 0x8b, 0x19, 0x9d, 0x55,
                                     0xfa, 0x2b, 0x15, 0x48, 0x92, 0x2b, 0x56, 0xca, 0x52, 0x7a};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc7, 0x55, 0x53, 0x78, 0xae, 0x69, 0x61, 0x1d, 0x7a, 0x6,  0x12, 0x5c, 0x29,
                                     0xc0, 0x1,  0x43, 0x8e, 0x60, 0x2f, 0x7c, 0xce, 0x4a, 0x60, 0x44, 0x4f};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xea, 0xc2, 0x81, 0x7e, 0x7a, 0x39, 0x5f, 0x45, 0xc,  0x76,
                                     0x6b, 0xe8, 0xa8, 0x69, 0x31, 0x7d, 0x29, 0x2f, 0x88, 0x52,
                                     0x54, 0x8d, 0xaa, 0xb8, 0x3a, 0xd2, 0x40, 0xe3, 0x49};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x44, 0xa9, 0xd7, 0x2f, 0x30, 0x52, 0x7f, 0xc9, 0x3e, 0xea, 0x9b,
                                     0x3e, 0x93, 0x57, 0xe,  0x76, 0x25, 0x15, 0x1f, 0xe6, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x9b, 0x22, 0xdb, 0x39, 0x60, 0x8a, 0x91, 0xb6, 0x33, 0xb2, 0x93,
                                     0xe2, 0x47, 0x7,  0x5b, 0x68, 0xbf, 0x60, 0xd4, 0x60, 0xb9, 0x8f};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x61, 0x5d, 0xcd, 0xdc, 0x6f, 0xc5, 0x5d, 0x8b, 0x71, 0x54, 0xb1, 0x24, 0x3f, 0x50,
                                     0x97, 0x9e, 0x8d, 0x3d, 0xe7, 0x9d, 0xf9, 0x6b, 0xe7, 0x48, 0x9f, 0xa3, 0x2e};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1195, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4397
// [("\SUB\ETX\210\235\182\"\235m\202\r6\154h\136\163\131\130\186$\186\129+[\232\241\213\194x\211\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\192#0\201ZxW\ENQ\210 ^}0\SOH\CAN\213\248",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS2}),("j\249\215G\224\163\155\205/\178\206fT\139\&0~\215\CAN\233!\DC4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\EOT\211",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\136\FS\200\185\171\231^l\SO\167\145f\226\219\143`\t^\137F\163",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x72, 0x11, 0x2d, 0x0,  0x1e, 0x1a, 0x3,  0xd2, 0xeb, 0xb6, 0x22, 0xeb, 0x6d, 0xca, 0xd,  0x36,
                   0x9a, 0x68, 0x88, 0xa3, 0x83, 0x82, 0xba, 0x24, 0xba, 0x81, 0x2b, 0x5b, 0xe8, 0xf1, 0xd5, 0xc2, 0x78,
                   0xd3, 0xbb, 0x2,  0x0,  0x11, 0xc0, 0x23, 0x30, 0xc9, 0x5a, 0x78, 0x57, 0x5,  0xd2, 0x20, 0x5e, 0x7d,
                   0x30, 0x1,  0x18, 0xd5, 0xf8, 0x2,  0x0,  0x15, 0x6a, 0xf9, 0xd7, 0x47, 0xe0, 0xa3, 0x9b, 0xcd, 0x2f,
                   0xb2, 0xce, 0x66, 0x54, 0x8b, 0x30, 0x7e, 0xd7, 0x18, 0xe9, 0x21, 0x14, 0x1,  0x0,  0x0,  0x0,  0x0,
                   0x2,  0x4,  0xd3, 0x1,  0x0,  0x15, 0x88, 0x1c, 0xc8, 0xb9, 0xab, 0xe7, 0x5e, 0x6c, 0xe,  0xa7, 0x91,
                   0x66, 0xe2, 0xdb, 0x8f, 0x60, 0x9,  0x5e, 0x89, 0x46, 0xa3, 0x0,  0x0,  0x0,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x1a, 0x3,  0xd2, 0xeb, 0xb6, 0x22, 0xeb, 0x6d, 0xca, 0xd,
                                     0x36, 0x9a, 0x68, 0x88, 0xa3, 0x83, 0x82, 0xba, 0x24, 0xba,
                                     0x81, 0x2b, 0x5b, 0xe8, 0xf1, 0xd5, 0xc2, 0x78, 0xd3, 0xbb};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc0, 0x23, 0x30, 0xc9, 0x5a, 0x78, 0x57, 0x5, 0xd2,
                                     0x20, 0x5e, 0x7d, 0x30, 0x1,  0x18, 0xd5, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6a, 0xf9, 0xd7, 0x47, 0xe0, 0xa3, 0x9b, 0xcd, 0x2f, 0xb2, 0xce,
                                     0x66, 0x54, 0x8b, 0x30, 0x7e, 0xd7, 0x18, 0xe9, 0x21, 0x14};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4, 0xd3};
  lwmqtt_string_t topic_filter_s4 = {2, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x88, 0x1c, 0xc8, 0xb9, 0xab, 0xe7, 0x5e, 0x6c, 0xe,  0xa7, 0x91,
                                     0x66, 0xe2, 0xdb, 0x8f, 0x60, 0x9,  0x5e, 0x89, 0x46, 0xa3};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4397, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27847
// [("\243<\205\142\254\168U\222\165,\134\130\135\225_\143\205\US\162\203D\ETBR\SO\n\242\194",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("s\199\173\183n\252\245\235\237\ETX\SOH\189\190M9\160/+",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\148",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("4x\187\128\139\&3\a\DC3\233\136\CAN{\200\172B\213\155\SYNS\175\221\183\195\GS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0x54, 0x6c, 0xc7, 0x0,  0x1b, 0xf3, 0x3c, 0xcd, 0x8e, 0xfe, 0xa8, 0x55, 0xde, 0xa5,
                   0x2c, 0x86, 0x82, 0x87, 0xe1, 0x5f, 0x8f, 0xcd, 0x1f, 0xa2, 0xcb, 0x44, 0x17, 0x52, 0xe,
                   0xa,  0xf2, 0xc2, 0x2,  0x0,  0x12, 0x73, 0xc7, 0xad, 0xb7, 0x6e, 0xfc, 0xf5, 0xeb, 0xed,
                   0x3,  0x1,  0xbd, 0xbe, 0x4d, 0x39, 0xa0, 0x2f, 0x2b, 0x0,  0x0,  0x1,  0x94, 0x2,  0x0,
                   0x18, 0x34, 0x78, 0xbb, 0x80, 0x8b, 0x33, 0x7,  0x13, 0xe9, 0x88, 0x18, 0x7b, 0xc8, 0xac,
                   0x42, 0xd5, 0x9b, 0x16, 0x53, 0xaf, 0xdd, 0xb7, 0xc3, 0x1d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf3, 0x3c, 0xcd, 0x8e, 0xfe, 0xa8, 0x55, 0xde, 0xa5, 0x2c, 0x86, 0x82, 0x87, 0xe1,
                                     0x5f, 0x8f, 0xcd, 0x1f, 0xa2, 0xcb, 0x44, 0x17, 0x52, 0xe,  0xa,  0xf2, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x73, 0xc7, 0xad, 0xb7, 0x6e, 0xfc, 0xf5, 0xeb, 0xed,
                                     0x3,  0x1,  0xbd, 0xbe, 0x4d, 0x39, 0xa0, 0x2f, 0x2b};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x94};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0x78, 0xbb, 0x80, 0x8b, 0x33, 0x7,  0x13, 0xe9, 0x88, 0x18, 0x7b,
                                     0xc8, 0xac, 0x42, 0xd5, 0x9b, 0x16, 0x53, 0xaf, 0xdd, 0xb7, 0xc3, 0x1d};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27847, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29011 [("L\255\232\&7",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\ENQ
// \STX\209\189\DEL\160\167\&6~\254\SYN\144\246\217(\GS\207(c\142\241",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\237\194\247\230\ETX\134\225\f\SI\143\242\181\&1+\226EO\223\186\144se\216HY>\170\209",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\155O\191\161v\218\167\168_\147\DC1",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\FS\236xY=!\172\241\217\230\209\222\179\DC2\SI",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("d}\134\162\229\233`\212\248\207\DC4\254\137\186\232KP\165\222\144",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\241\197)E\130G\STX\248\&7w\179\173\243\vTB\FS\212o\195jN\201\151Z\NUL",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\194\235)\201J\157\SOH3\t|\DC4\164\v\175\206\SOHY\236 \166(\212\130",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\181H\154\233\193\216W\142\190\172\173\206\ACKC`",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("s\231w\220\208\DC4\157\191\CAN\EOTo\187\170.c\DLE-\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0xd9, 0x1,  0x71, 0x53, 0x0,  0x4,  0x4c, 0xff, 0xe8, 0x37, 0x0,  0x0,  0x0,  0x0,  0x0,  0x16,
                   0x5,  0x20, 0x2,  0xd1, 0xbd, 0x7f, 0xa0, 0xa7, 0x36, 0x7e, 0xfe, 0x16, 0x90, 0xf6, 0xd9, 0x28, 0x1d,
                   0xcf, 0x28, 0x63, 0x8e, 0xf1, 0x1,  0x0,  0x1c, 0xed, 0xc2, 0xf7, 0xe6, 0x3,  0x86, 0xe1, 0xc,  0xf,
                   0x8f, 0xf2, 0xb5, 0x31, 0x2b, 0xe2, 0x45, 0x4f, 0xdf, 0xba, 0x90, 0x73, 0x65, 0xd8, 0x48, 0x59, 0x3e,
                   0xaa, 0xd1, 0x0,  0x0,  0xb,  0x9b, 0x4f, 0xbf, 0xa1, 0x76, 0xda, 0xa7, 0xa8, 0x5f, 0x93, 0x11, 0x0,
                   0x0,  0xf,  0x1c, 0xec, 0x78, 0x59, 0x3d, 0x21, 0xac, 0xf1, 0xd9, 0xe6, 0xd1, 0xde, 0xb3, 0x12, 0xf,
                   0x1,  0x0,  0x14, 0x64, 0x7d, 0x86, 0xa2, 0xe5, 0xe9, 0x60, 0xd4, 0xf8, 0xcf, 0x14, 0xfe, 0x89, 0xba,
                   0xe8, 0x4b, 0x50, 0xa5, 0xde, 0x90, 0x2,  0x0,  0x1a, 0xf1, 0xc5, 0x29, 0x45, 0x82, 0x47, 0x2,  0xf8,
                   0x37, 0x77, 0xb3, 0xad, 0xf3, 0xb,  0x54, 0x42, 0x1c, 0xd4, 0x6f, 0xc3, 0x6a, 0x4e, 0xc9, 0x97, 0x5a,
                   0x0,  0x0,  0x0,  0x17, 0xc2, 0xeb, 0x29, 0xc9, 0x4a, 0x9d, 0x1,  0x33, 0x9,  0x7c, 0x14, 0xa4, 0xb,
                   0xaf, 0xce, 0x1,  0x59, 0xec, 0x20, 0xa6, 0x28, 0xd4, 0x82, 0x1,  0x0,  0xf,  0xb5, 0x48, 0x9a, 0xe9,
                   0xc1, 0xd8, 0x57, 0x8e, 0xbe, 0xac, 0xad, 0xce, 0x6,  0x43, 0x60, 0x0,  0x0,  0x12, 0x73, 0xe7, 0x77,
                   0xdc, 0xd0, 0x14, 0x9d, 0xbf, 0x18, 0x4,  0x6f, 0xbb, 0xaa, 0x2e, 0x63, 0x10, 0x2d, 0xdb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x4c, 0xff, 0xe8, 0x37};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5,  0x20, 0x2,  0xd1, 0xbd, 0x7f, 0xa0, 0xa7, 0x36, 0x7e, 0xfe,
                                     0x16, 0x90, 0xf6, 0xd9, 0x28, 0x1d, 0xcf, 0x28, 0x63, 0x8e, 0xf1};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xed, 0xc2, 0xf7, 0xe6, 0x3,  0x86, 0xe1, 0xc,  0xf,  0x8f,
                                     0xf2, 0xb5, 0x31, 0x2b, 0xe2, 0x45, 0x4f, 0xdf, 0xba, 0x90,
                                     0x73, 0x65, 0xd8, 0x48, 0x59, 0x3e, 0xaa, 0xd1};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9b, 0x4f, 0xbf, 0xa1, 0x76, 0xda, 0xa7, 0xa8, 0x5f, 0x93, 0x11};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1c, 0xec, 0x78, 0x59, 0x3d, 0x21, 0xac, 0xf1,
                                     0xd9, 0xe6, 0xd1, 0xde, 0xb3, 0x12, 0xf};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x64, 0x7d, 0x86, 0xa2, 0xe5, 0xe9, 0x60, 0xd4, 0xf8, 0xcf,
                                     0x14, 0xfe, 0x89, 0xba, 0xe8, 0x4b, 0x50, 0xa5, 0xde, 0x90};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf1, 0xc5, 0x29, 0x45, 0x82, 0x47, 0x2,  0xf8, 0x37, 0x77, 0xb3, 0xad, 0xf3,
                                     0xb,  0x54, 0x42, 0x1c, 0xd4, 0x6f, 0xc3, 0x6a, 0x4e, 0xc9, 0x97, 0x5a, 0x0};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc2, 0xeb, 0x29, 0xc9, 0x4a, 0x9d, 0x1,  0x33, 0x9,  0x7c, 0x14, 0xa4,
                                     0xb,  0xaf, 0xce, 0x1,  0x59, 0xec, 0x20, 0xa6, 0x28, 0xd4, 0x82};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb5, 0x48, 0x9a, 0xe9, 0xc1, 0xd8, 0x57, 0x8e,
                                     0xbe, 0xac, 0xad, 0xce, 0x6,  0x43, 0x60};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x73, 0xe7, 0x77, 0xdc, 0xd0, 0x14, 0x9d, 0xbf, 0x18,
                                      0x4,  0x6f, 0xbb, 0xaa, 0x2e, 0x63, 0x10, 0x2d, 0xdb};
  lwmqtt_string_t topic_filter_s10 = {18, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29011, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29705 [("\amn\138\157\180\217\219",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0}),("!!Va\217\152",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\249\n}\251\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\158\v\b\RS\149\235Vv\NAK\240\135d\189r\203\185b\176\ETB\195,EE\185y",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x3a, 0x74, 0x9,  0x0,  0x8,  0x7,  0x6d, 0x6e, 0x8a, 0x9d, 0xb4, 0xd9, 0xdb, 0x0,
                   0x0,  0x6,  0x21, 0x21, 0x56, 0x61, 0xd9, 0x98, 0x2,  0x0,  0x5,  0xf9, 0xa,  0x7d, 0xfb,
                   0xaa, 0x1,  0x0,  0x19, 0x9e, 0xb,  0x8,  0x1e, 0x95, 0xeb, 0x56, 0x76, 0x15, 0xf0, 0x87,
                   0x64, 0xbd, 0x72, 0xcb, 0xb9, 0x62, 0xb0, 0x17, 0xc3, 0x2c, 0x45, 0x45, 0xb9, 0x79, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x7, 0x6d, 0x6e, 0x8a, 0x9d, 0xb4, 0xd9, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x21, 0x21, 0x56, 0x61, 0xd9, 0x98};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf9, 0xa, 0x7d, 0xfb, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9e, 0xb,  0x8,  0x1e, 0x95, 0xeb, 0x56, 0x76, 0x15, 0xf0, 0x87, 0x64, 0xbd,
                                     0x72, 0xcb, 0xb9, 0x62, 0xb0, 0x17, 0xc3, 0x2c, 0x45, 0x45, 0xb9, 0x79};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29705, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30426 [("\SYNez\ACK\162N\176`#\DLEr6\206\183\167\183\224\241\&4OY\ENQ\162'\169\187\136A",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\152",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("mD\188mxN\232n\174\197\149e\174/\"\187\196\138\131\232",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\193]\DC2\n\228\224l6\162\149f\"J.\240\202",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(":q\223\215|h\a\208G\164\\~\231q_R\131\211\242\198\EM\CAN\220(\158\DLE\133",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\225\243\168\&79\184\251\210N\f>-\149\138K\n\155\217\220\DC33T\250\255UB=\188\RS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("_\174@\222\188\207\224\212\179\190C\206",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\165\SYN\186\167:\ETX\214\DC2\145O\237\221\197",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0xac, 0x1,  0x76, 0xda, 0x0,  0x1c, 0x16, 0x65, 0x7a, 0x6,  0xa2, 0x4e, 0xb0, 0x60, 0x23,
                   0x10, 0x72, 0x36, 0xce, 0xb7, 0xa7, 0xb7, 0xe0, 0xf1, 0x34, 0x4f, 0x59, 0x5,  0xa2, 0x27, 0xa9,
                   0xbb, 0x88, 0x41, 0x2,  0x0,  0x1,  0x98, 0x0,  0x0,  0x14, 0x6d, 0x44, 0xbc, 0x6d, 0x78, 0x4e,
                   0xe8, 0x6e, 0xae, 0xc5, 0x95, 0x65, 0xae, 0x2f, 0x22, 0xbb, 0xc4, 0x8a, 0x83, 0xe8, 0x2,  0x0,
                   0x10, 0xc1, 0x5d, 0x12, 0xa,  0xe4, 0xe0, 0x6c, 0x36, 0xa2, 0x95, 0x66, 0x22, 0x4a, 0x2e, 0xf0,
                   0xca, 0x0,  0x0,  0x1b, 0x3a, 0x71, 0xdf, 0xd7, 0x7c, 0x68, 0x7,  0xd0, 0x47, 0xa4, 0x5c, 0x7e,
                   0xe7, 0x71, 0x5f, 0x52, 0x83, 0xd3, 0xf2, 0xc6, 0x19, 0x18, 0xdc, 0x28, 0x9e, 0x10, 0x85, 0x1,
                   0x0,  0x1d, 0xe1, 0xf3, 0xa8, 0x37, 0x39, 0xb8, 0xfb, 0xd2, 0x4e, 0xc,  0x3e, 0x2d, 0x95, 0x8a,
                   0x4b, 0xa,  0x9b, 0xd9, 0xdc, 0x13, 0x33, 0x54, 0xfa, 0xff, 0x55, 0x42, 0x3d, 0xbc, 0x1e, 0x0,
                   0x0,  0xc,  0x5f, 0xae, 0x40, 0xde, 0xbc, 0xcf, 0xe0, 0xd4, 0xb3, 0xbe, 0x43, 0xce, 0x1,  0x0,
                   0xd,  0xa5, 0x16, 0xba, 0xa7, 0x3a, 0x3,  0xd6, 0x12, 0x91, 0x4f, 0xed, 0xdd, 0xc5, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x16, 0x65, 0x7a, 0x6,  0xa2, 0x4e, 0xb0, 0x60, 0x23, 0x10,
                                     0x72, 0x36, 0xce, 0xb7, 0xa7, 0xb7, 0xe0, 0xf1, 0x34, 0x4f,
                                     0x59, 0x5,  0xa2, 0x27, 0xa9, 0xbb, 0x88, 0x41};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x98};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6d, 0x44, 0xbc, 0x6d, 0x78, 0x4e, 0xe8, 0x6e, 0xae, 0xc5,
                                     0x95, 0x65, 0xae, 0x2f, 0x22, 0xbb, 0xc4, 0x8a, 0x83, 0xe8};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0x5d, 0x12, 0xa,  0xe4, 0xe0, 0x6c, 0x36,
                                     0xa2, 0x95, 0x66, 0x22, 0x4a, 0x2e, 0xf0, 0xca};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3a, 0x71, 0xdf, 0xd7, 0x7c, 0x68, 0x7,  0xd0, 0x47, 0xa4, 0x5c, 0x7e, 0xe7, 0x71,
                                     0x5f, 0x52, 0x83, 0xd3, 0xf2, 0xc6, 0x19, 0x18, 0xdc, 0x28, 0x9e, 0x10, 0x85};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe1, 0xf3, 0xa8, 0x37, 0x39, 0xb8, 0xfb, 0xd2, 0x4e, 0xc,
                                     0x3e, 0x2d, 0x95, 0x8a, 0x4b, 0xa,  0x9b, 0xd9, 0xdc, 0x13,
                                     0x33, 0x54, 0xfa, 0xff, 0x55, 0x42, 0x3d, 0xbc, 0x1e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5f, 0xae, 0x40, 0xde, 0xbc, 0xcf, 0xe0, 0xd4, 0xb3, 0xbe, 0x43, 0xce};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa5, 0x16, 0xba, 0xa7, 0x3a, 0x3, 0xd6, 0x12, 0x91, 0x4f, 0xed, 0xdd, 0xc5};
  lwmqtt_string_t topic_filter_s7 = {13, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30426, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21987 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("Cz\235\f\236\158'=\190",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("l\166=\210\242k\194\162\DLE}w\148\202W\216\US\178\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("x\t\SO\224\131\ENQ\\\237\221\168\246&x\STX\246T\228\249\194\129\SUB",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\223\SI\255\235\250\134\ETX\178u\210",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x4b, 0x55, 0xe3, 0x0,  0x0,  0x2,  0x0,  0x9,  0x43, 0x7a, 0xeb, 0xc,  0xec, 0x9e, 0x27,
                   0x3d, 0xbe, 0x2,  0x0,  0x12, 0x6c, 0xa6, 0x3d, 0xd2, 0xf2, 0x6b, 0xc2, 0xa2, 0x10, 0x7d, 0x77,
                   0x94, 0xca, 0x57, 0xd8, 0x1f, 0xb2, 0xc,  0x1,  0x0,  0x15, 0x78, 0x9,  0xe,  0xe0, 0x83, 0x5,
                   0x5c, 0xed, 0xdd, 0xa8, 0xf6, 0x26, 0x78, 0x2,  0xf6, 0x54, 0xe4, 0xf9, 0xc2, 0x81, 0x1a, 0x0,
                   0x0,  0xa,  0xdf, 0xf,  0xff, 0xeb, 0xfa, 0x86, 0x3,  0xb2, 0x75, 0xd2, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x43, 0x7a, 0xeb, 0xc, 0xec, 0x9e, 0x27, 0x3d, 0xbe};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6c, 0xa6, 0x3d, 0xd2, 0xf2, 0x6b, 0xc2, 0xa2, 0x10,
                                     0x7d, 0x77, 0x94, 0xca, 0x57, 0xd8, 0x1f, 0xb2, 0xc};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x78, 0x9,  0xe, 0xe0, 0x83, 0x5,  0x5c, 0xed, 0xdd, 0xa8, 0xf6,
                                     0x26, 0x78, 0x2, 0xf6, 0x54, 0xe4, 0xf9, 0xc2, 0x81, 0x1a};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdf, 0xf, 0xff, 0xeb, 0xfa, 0x86, 0x3, 0xb2, 0x75, 0xd2};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21987, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23704 [("t \154\149\224\EM\158fEc\239\249\&6\231\DC4\159",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\253\\\220\193&\209[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("e",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("R[&",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("^\169\135\136\143\241q\SI\254\254",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x36, 0x5c, 0x98, 0x0,  0x10, 0x74, 0x20, 0x9a, 0x95, 0xe0, 0x19, 0x9e, 0x66,
                   0x45, 0x63, 0xef, 0xf9, 0x36, 0xe7, 0x14, 0x9f, 0x1,  0x0,  0x7,  0xfd, 0x5c, 0xdc,
                   0xc1, 0x26, 0xd1, 0x5b, 0x2,  0x0,  0x1,  0x65, 0x1,  0x0,  0x3,  0x52, 0x5b, 0x26,
                   0x1,  0x0,  0xa,  0x5e, 0xa9, 0x87, 0x88, 0x8f, 0xf1, 0x71, 0xf,  0xfe, 0xfe, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x74, 0x20, 0x9a, 0x95, 0xe0, 0x19, 0x9e, 0x66,
                                     0x45, 0x63, 0xef, 0xf9, 0x36, 0xe7, 0x14, 0x9f};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfd, 0x5c, 0xdc, 0xc1, 0x26, 0xd1, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x52, 0x5b, 0x26};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5e, 0xa9, 0x87, 0x88, 0x8f, 0xf1, 0x71, 0xf, 0xfe, 0xfe};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23704, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25818 [("\235\&1\a\173\150\175\208\&8",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0xd, 0x64, 0xda, 0x0, 0x8, 0xeb, 0x31, 0x7, 0xad, 0x96, 0xaf, 0xd0, 0x38, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0x31, 0x7, 0xad, 0x96, 0xaf, 0xd0, 0x38};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25818, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19332 [("-\196\154\190n\186/h\n\161\203p\157Ap",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("~\210\229q\182\141\167%]a\fh\248\233\253\167>\NAKu\US\STX\133:",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\144;#\ENQ\236h-\ETX\243\164R3\237\241\129\171\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\254\167a\227\GS\169X\240\139\CAN\242\212K\164g]T\203\246\141",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\252=6J\200\227L",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("U\199y\ETX\222\t\"\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2}),("\202\SUB\220\214,g\158Ugne6\221\DLE\222}n\252\&1w/\NUL\171\244vou",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("-\SO\230DQ\130\178\\\129\&2i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\205\132\136\DC2y",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ACK)\174\200\186",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\140\197o\USH\162P\197x$\209\218\SI\172\GS\176\147\204\148\CAN\226\CAN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xc3, 0x1,  0x4b, 0x84, 0x0,  0xf,  0x2d, 0xc4, 0x9a, 0xbe, 0x6e, 0xba, 0x2f, 0x68, 0xa,  0xa1,
                   0xcb, 0x70, 0x9d, 0x41, 0x70, 0x0,  0x0,  0x17, 0x7e, 0xd2, 0xe5, 0x71, 0xb6, 0x8d, 0xa7, 0x25, 0x5d,
                   0x61, 0xc,  0x68, 0xf8, 0xe9, 0xfd, 0xa7, 0x3e, 0x15, 0x75, 0x1f, 0x2,  0x85, 0x3a, 0x2,  0x0,  0x11,
                   0x90, 0x3b, 0x23, 0x5,  0xec, 0x68, 0x2d, 0x3,  0xf3, 0xa4, 0x52, 0x33, 0xed, 0xf1, 0x81, 0xab, 0xe1,
                   0x0,  0x0,  0x14, 0xfe, 0xa7, 0x61, 0xe3, 0x1d, 0xa9, 0x58, 0xf0, 0x8b, 0x18, 0xf2, 0xd4, 0x4b, 0xa4,
                   0x67, 0x5d, 0x54, 0xcb, 0xf6, 0x8d, 0x1,  0x0,  0x7,  0xfc, 0x3d, 0x36, 0x4a, 0xc8, 0xe3, 0x4c, 0x2,
                   0x0,  0x8,  0x55, 0xc7, 0x79, 0x3,  0xde, 0x9,  0x22, 0xe8, 0x2,  0x0,  0x1b, 0xca, 0x1a, 0xdc, 0xd6,
                   0x2c, 0x67, 0x9e, 0x55, 0x67, 0x6e, 0x65, 0x36, 0xdd, 0x10, 0xde, 0x7d, 0x6e, 0xfc, 0x31, 0x77, 0x2f,
                   0x0,  0xab, 0xf4, 0x76, 0x6f, 0x75, 0x1,  0x0,  0xb,  0x2d, 0xe,  0xe6, 0x44, 0x51, 0x82, 0xb2, 0x5c,
                   0x81, 0x32, 0x69, 0x0,  0x0,  0x5,  0xcd, 0x84, 0x88, 0x12, 0x79, 0x0,  0x0,  0x5,  0x6,  0x29, 0xae,
                   0xc8, 0xba, 0x1,  0x0,  0x16, 0x8c, 0xc5, 0x6f, 0x1f, 0x48, 0xa2, 0x50, 0xc5, 0x78, 0x24, 0xd1, 0xda,
                   0xf,  0xac, 0x1d, 0xb0, 0x93, 0xcc, 0x94, 0x18, 0xe2, 0x18, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2d, 0xc4, 0x9a, 0xbe, 0x6e, 0xba, 0x2f, 0x68,
                                     0xa,  0xa1, 0xcb, 0x70, 0x9d, 0x41, 0x70};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0xd2, 0xe5, 0x71, 0xb6, 0x8d, 0xa7, 0x25, 0x5d, 0x61, 0xc, 0x68,
                                     0xf8, 0xe9, 0xfd, 0xa7, 0x3e, 0x15, 0x75, 0x1f, 0x2,  0x85, 0x3a};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x90, 0x3b, 0x23, 0x5,  0xec, 0x68, 0x2d, 0x3, 0xf3,
                                     0xa4, 0x52, 0x33, 0xed, 0xf1, 0x81, 0xab, 0xe1};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfe, 0xa7, 0x61, 0xe3, 0x1d, 0xa9, 0x58, 0xf0, 0x8b, 0x18,
                                     0xf2, 0xd4, 0x4b, 0xa4, 0x67, 0x5d, 0x54, 0xcb, 0xf6, 0x8d};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfc, 0x3d, 0x36, 0x4a, 0xc8, 0xe3, 0x4c};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0xc7, 0x79, 0x3, 0xde, 0x9, 0x22, 0xe8};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0x1a, 0xdc, 0xd6, 0x2c, 0x67, 0x9e, 0x55, 0x67, 0x6e, 0x65, 0x36, 0xdd, 0x10,
                                     0xde, 0x7d, 0x6e, 0xfc, 0x31, 0x77, 0x2f, 0x0,  0xab, 0xf4, 0x76, 0x6f, 0x75};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2d, 0xe, 0xe6, 0x44, 0x51, 0x82, 0xb2, 0x5c, 0x81, 0x32, 0x69};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xcd, 0x84, 0x88, 0x12, 0x79};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6, 0x29, 0xae, 0xc8, 0xba};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x8c, 0xc5, 0x6f, 0x1f, 0x48, 0xa2, 0x50, 0xc5, 0x78, 0x24, 0xd1,
                                      0xda, 0xf,  0xac, 0x1d, 0xb0, 0x93, 0xcc, 0x94, 0x18, 0xe2, 0x18};
  lwmqtt_string_t topic_filter_s10 = {22, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19332, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20518 [("\184",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\208\138rec7\DLE\135k\b\245\159\135\&8\198\&0x\EM\188\ESC",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("OC{\222\a\203\253\158#\181\203J&\a\179\STX6\141\175\135\212QE\DC4<\207",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("qa\DC3x\197\165\234`\236\156",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("j\241\241/\244.\251\220v\185(f\144\147\f\170\246\219",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("f\189\233W\169\244b\222\169",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x6b, 0x50, 0x26, 0x0,  0x1,  0xb8, 0x1,  0x0,  0x14, 0xd0, 0x8a, 0x72, 0x65, 0x63, 0x37,
                   0x10, 0x87, 0x6b, 0x8,  0xf5, 0x9f, 0x87, 0x38, 0xc6, 0x30, 0x78, 0x19, 0xbc, 0x1b, 0x0,  0x0,
                   0x0,  0x1,  0x0,  0x1a, 0x4f, 0x43, 0x7b, 0xde, 0x7,  0xcb, 0xfd, 0x9e, 0x23, 0xb5, 0xcb, 0x4a,
                   0x26, 0x7,  0xb3, 0x2,  0x36, 0x8d, 0xaf, 0x87, 0xd4, 0x51, 0x45, 0x14, 0x3c, 0xcf, 0x0,  0x0,
                   0xa,  0x71, 0x61, 0x13, 0x78, 0xc5, 0xa5, 0xea, 0x60, 0xec, 0x9c, 0x2,  0x0,  0x12, 0x6a, 0xf1,
                   0xf1, 0x2f, 0xf4, 0x2e, 0xfb, 0xdc, 0x76, 0xb9, 0x28, 0x66, 0x90, 0x93, 0xc,  0xaa, 0xf6, 0xdb,
                   0x0,  0x0,  0x9,  0x66, 0xbd, 0xe9, 0x57, 0xa9, 0xf4, 0x62, 0xde, 0xa9, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xb8};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x8a, 0x72, 0x65, 0x63, 0x37, 0x10, 0x87, 0x6b, 0x8,
                                     0xf5, 0x9f, 0x87, 0x38, 0xc6, 0x30, 0x78, 0x19, 0xbc, 0x1b};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4f, 0x43, 0x7b, 0xde, 0x7,  0xcb, 0xfd, 0x9e, 0x23, 0xb5, 0xcb, 0x4a, 0x26,
                                     0x7,  0xb3, 0x2,  0x36, 0x8d, 0xaf, 0x87, 0xd4, 0x51, 0x45, 0x14, 0x3c, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x71, 0x61, 0x13, 0x78, 0xc5, 0xa5, 0xea, 0x60, 0xec, 0x9c};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0xf1, 0xf1, 0x2f, 0xf4, 0x2e, 0xfb, 0xdc, 0x76,
                                     0xb9, 0x28, 0x66, 0x90, 0x93, 0xc,  0xaa, 0xf6, 0xdb};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x66, 0xbd, 0xe9, 0x57, 0xa9, 0xf4, 0x62, 0xde, 0xa9};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20518, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4648 [("\172K\233\189\190\a>\228I\131=\247\DEL\255",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("d\206\145J",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\192\f%\166\NAK\218D3Q\180\233O'N\DC39i5\236\&2r",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\195\233]\b\254s\198E",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\161\EOTL\192\&7\180m\152*\178,\241`\199\167 ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\159\FS\203g6+\169\183\247\253\137\168\SO\174\243\r\EOT\tH\EOTkQ\a)G#:7\204\DC3",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\RSB)}\225\170\218\238\205\247",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x7e, 0x12, 0x28, 0x0,  0xe,  0xac, 0x4b, 0xe9, 0xbd, 0xbe, 0x7,  0x3e, 0xe4, 0x49, 0x83,
                   0x3d, 0xf7, 0x7f, 0xff, 0x0,  0x0,  0x4,  0x64, 0xce, 0x91, 0x4a, 0x1,  0x0,  0x15, 0xc0, 0xc,
                   0x25, 0xa6, 0x15, 0xda, 0x44, 0x33, 0x51, 0xb4, 0xe9, 0x4f, 0x27, 0x4e, 0x13, 0x39, 0x69, 0x35,
                   0xec, 0x32, 0x72, 0x2,  0x0,  0x8,  0xc3, 0xe9, 0x5d, 0x8,  0xfe, 0x73, 0xc6, 0x45, 0x2,  0x0,
                   0x10, 0xa1, 0x4,  0x4c, 0xc0, 0x37, 0xb4, 0x6d, 0x98, 0x2a, 0xb2, 0x2c, 0xf1, 0x60, 0xc7, 0xa7,
                   0x20, 0x0,  0x0,  0x1e, 0x9f, 0x1c, 0xcb, 0x67, 0x36, 0x2b, 0xa9, 0xb7, 0xf7, 0xfd, 0x89, 0xa8,
                   0xe,  0xae, 0xf3, 0xd,  0x4,  0x9,  0x48, 0x4,  0x6b, 0x51, 0x7,  0x29, 0x47, 0x23, 0x3a, 0x37,
                   0xcc, 0x13, 0x0,  0x0,  0xa,  0x1e, 0x42, 0x29, 0x7d, 0xe1, 0xaa, 0xda, 0xee, 0xcd, 0xf7, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xac, 0x4b, 0xe9, 0xbd, 0xbe, 0x7, 0x3e, 0xe4, 0x49, 0x83, 0x3d, 0xf7, 0x7f, 0xff};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x64, 0xce, 0x91, 0x4a};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc0, 0xc,  0x25, 0xa6, 0x15, 0xda, 0x44, 0x33, 0x51, 0xb4, 0xe9,
                                     0x4f, 0x27, 0x4e, 0x13, 0x39, 0x69, 0x35, 0xec, 0x32, 0x72};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc3, 0xe9, 0x5d, 0x8, 0xfe, 0x73, 0xc6, 0x45};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa1, 0x4,  0x4c, 0xc0, 0x37, 0xb4, 0x6d, 0x98,
                                     0x2a, 0xb2, 0x2c, 0xf1, 0x60, 0xc7, 0xa7, 0x20};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9f, 0x1c, 0xcb, 0x67, 0x36, 0x2b, 0xa9, 0xb7, 0xf7, 0xfd,
                                     0x89, 0xa8, 0xe,  0xae, 0xf3, 0xd,  0x4,  0x9,  0x48, 0x4,
                                     0x6b, 0x51, 0x7,  0x29, 0x47, 0x23, 0x3a, 0x37, 0xcc, 0x13};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1e, 0x42, 0x29, 0x7d, 0xe1, 0xaa, 0xda, 0xee, 0xcd, 0xf7};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4648, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13920 [(";q\215\241\130b\220s",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0xd, 0x36, 0x60, 0x0, 0x8, 0x3b, 0x71, 0xd7, 0xf1, 0x82, 0x62, 0xdc, 0x73, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0x71, 0xd7, 0xf1, 0x82, 0x62, 0xdc, 0x73};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13920, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22060 [("\223\227\254#\231\fk\254CT\157\246_G\GSI",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\212\DC4\172\SI\161\ETX[\171~`Y\188\185\181pS\206X",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropServerReference
// "r\181\rI\ETB\181\203[\215^([\160+\174\197\230\SI\139%\177\137r\232_s\253\DC3\n",PropServerReference
// "\ETB\242\ESC\151\128r\176<\167\209N\RS\232\NAK\196\SOM\138\209\191\134\191\190\221\221\183\167Z",PropTopicAliasMaximum
// 17608,PropResponseInformation
// "\SI\r\193<N\DLE\163I[\n\239\222\202\SUB\251\SI\162_\NUL\155\201",PropSubscriptionIdentifier
// 4,PropAssignedClientIdentifier "\197\186\STX\179\168\EOT\158\150",PropPayloadFormatIndicator 155,PropRetainAvailable
// 69,PropReceiveMaximum 23497]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x99, 0x1,  0x56, 0x2c, 0x6e, 0x1c, 0x0,  0x1d, 0x72, 0xb5, 0xd,  0x49, 0x17, 0xb5, 0xcb,
                   0x5b, 0xd7, 0x5e, 0x28, 0x5b, 0xa0, 0x2b, 0xae, 0xc5, 0xe6, 0xf,  0x8b, 0x25, 0xb1, 0x89, 0x72,
                   0xe8, 0x5f, 0x73, 0xfd, 0x13, 0xa,  0x1c, 0x0,  0x1c, 0x17, 0xf2, 0x1b, 0x97, 0x80, 0x72, 0xb0,
                   0x3c, 0xa7, 0xd1, 0x4e, 0x1e, 0xe8, 0x15, 0xc4, 0xe,  0x4d, 0x8a, 0xd1, 0xbf, 0x86, 0xbf, 0xbe,
                   0xdd, 0xdd, 0xb7, 0xa7, 0x5a, 0x22, 0x44, 0xc8, 0x1a, 0x0,  0x15, 0xf,  0xd,  0xc1, 0x3c, 0x4e,
                   0x10, 0xa3, 0x49, 0x5b, 0xa,  0xef, 0xde, 0xca, 0x1a, 0xfb, 0xf,  0xa2, 0x5f, 0x0,  0x9b, 0xc9,
                   0xb,  0x4,  0x12, 0x0,  0x8,  0xc5, 0xba, 0x2,  0xb3, 0xa8, 0x4,  0x9e, 0x96, 0x1,  0x9b, 0x25,
                   0x45, 0x21, 0x5b, 0xc9, 0x0,  0x10, 0xdf, 0xe3, 0xfe, 0x23, 0xe7, 0xc,  0x6b, 0xfe, 0x43, 0x54,
                   0x9d, 0xf6, 0x5f, 0x47, 0x1d, 0x49, 0x10, 0x0,  0x12, 0xd4, 0x14, 0xac, 0xf,  0xa1, 0x3,  0x5b,
                   0xab, 0x7e, 0x60, 0x59, 0xbc, 0xb9, 0xb5, 0x70, 0x53, 0xce, 0x58, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xdf, 0xe3, 0xfe, 0x23, 0xe7, 0xc,  0x6b, 0xfe,
                                     0x43, 0x54, 0x9d, 0xf6, 0x5f, 0x47, 0x1d, 0x49};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd4, 0x14, 0xac, 0xf,  0xa1, 0x3,  0x5b, 0xab, 0x7e,
                                     0x60, 0x59, 0xbc, 0xb9, 0xb5, 0x70, 0x53, 0xce, 0x58};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0x72, 0xb5, 0xd, 0x49, 0x17, 0xb5, 0xcb, 0x5b, 0xd7, 0x5e, 0x28, 0x5b, 0xa0, 0x2b, 0xae,
                           0xc5, 0xe6, 0xf, 0x8b, 0x25, 0xb1, 0x89, 0x72, 0xe8, 0x5f, 0x73, 0xfd, 0x13, 0xa};
  uint8_t bytesprops1[] = {0x17, 0xf2, 0x1b, 0x97, 0x80, 0x72, 0xb0, 0x3c, 0xa7, 0xd1, 0x4e, 0x1e, 0xe8, 0x15,
                           0xc4, 0xe,  0x4d, 0x8a, 0xd1, 0xbf, 0x86, 0xbf, 0xbe, 0xdd, 0xdd, 0xb7, 0xa7, 0x5a};
  uint8_t bytesprops2[] = {0xf,  0xd,  0xc1, 0x3c, 0x4e, 0x10, 0xa3, 0x49, 0x5b, 0xa, 0xef,
                           0xde, 0xca, 0x1a, 0xfb, 0xf,  0xa2, 0x5f, 0x0,  0x9b, 0xc9};
  uint8_t bytesprops3[] = {0xc5, 0xba, 0x2, 0xb3, 0xa8, 0x4, 0x9e, 0x96};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17608}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23497}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22060, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21589
// [("\204\251XL\209\150\136\SUB\146\187\US\196\153\150d\219\213\209\RS\174\175\144^\140\138\147\203\240\214\215",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("g\160\ESC\225\199\RS!%|\ACKG\217v\148w\135\203",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("I*\141\&7!n",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\250wi\NAK0H\153\149m1#\244\243j\171jT\193\248\219\EOT\246X\217\161\192",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\241\239J(\216\192=\130\197-h|\170B\US\204]\166\204\149\152|\EOT\221X*U\138w\238",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\137;E\ETX\186\180\221\246\229\182\247\208",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("}\240",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("t\205_\220\162g\141/cH",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\135\137\149\208",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\165\DC36\SUBG\US}\220\EM\SI\137\251\204?\210\EOT#\bLN\129",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropResponseInformation
// "1\129\243\187f*|\232",PropServerKeepAlive 9919]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0xd0, 0x1,  0x54, 0x55, 0xe,  0x1a, 0x0,  0x8,  0x31, 0x81, 0xf3, 0xbb, 0x66, 0x2a, 0x7c, 0xe8,
                   0x13, 0x26, 0xbf, 0x0,  0x1e, 0xcc, 0xfb, 0x58, 0x4c, 0xd1, 0x96, 0x88, 0x1a, 0x92, 0xbb, 0x1f, 0xc4,
                   0x99, 0x96, 0x64, 0xdb, 0xd5, 0xd1, 0x1e, 0xae, 0xaf, 0x90, 0x5e, 0x8c, 0x8a, 0x93, 0xcb, 0xf0, 0xd6,
                   0xd7, 0x14, 0x0,  0x11, 0x67, 0xa0, 0x1b, 0xe1, 0xc7, 0x1e, 0x21, 0x25, 0x7c, 0x6,  0x47, 0xd9, 0x76,
                   0x94, 0x77, 0x87, 0xcb, 0x29, 0x0,  0x6,  0x49, 0x2a, 0x8d, 0x37, 0x21, 0x6e, 0x0,  0x0,  0x1a, 0xfa,
                   0x77, 0x69, 0x15, 0x30, 0x48, 0x99, 0x95, 0x6d, 0x31, 0x23, 0xf4, 0xf3, 0x6a, 0xab, 0x6a, 0x54, 0xc1,
                   0xf8, 0xdb, 0x4,  0xf6, 0x58, 0xd9, 0xa1, 0xc0, 0x1c, 0x0,  0x1e, 0xf1, 0xef, 0x4a, 0x28, 0xd8, 0xc0,
                   0x3d, 0x82, 0xc5, 0x2d, 0x68, 0x7c, 0xaa, 0x42, 0x1f, 0xcc, 0x5d, 0xa6, 0xcc, 0x95, 0x98, 0x7c, 0x4,
                   0xdd, 0x58, 0x2a, 0x55, 0x8a, 0x77, 0xee, 0x18, 0x0,  0x0,  0x5,  0x0,  0xc,  0x89, 0x3b, 0x45, 0x3,
                   0xba, 0xb4, 0xdd, 0xf6, 0xe5, 0xb6, 0xf7, 0xd0, 0x28, 0x0,  0x2,  0x7d, 0xf0, 0x12, 0x0,  0xa,  0x74,
                   0xcd, 0x5f, 0xdc, 0xa2, 0x67, 0x8d, 0x2f, 0x63, 0x48, 0x1a, 0x0,  0x4,  0x87, 0x89, 0x95, 0xd0, 0x12,
                   0x0,  0x15, 0xa5, 0x13, 0x36, 0x1a, 0x47, 0x1f, 0x7d, 0xdc, 0x19, 0xf,  0x89, 0xfb, 0xcc, 0x3f, 0xd2,
                   0x4,  0x23, 0x8,  0x4c, 0x4e, 0x81, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xcc, 0xfb, 0x58, 0x4c, 0xd1, 0x96, 0x88, 0x1a, 0x92, 0xbb,
                                     0x1f, 0xc4, 0x99, 0x96, 0x64, 0xdb, 0xd5, 0xd1, 0x1e, 0xae,
                                     0xaf, 0x90, 0x5e, 0x8c, 0x8a, 0x93, 0xcb, 0xf0, 0xd6, 0xd7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x67, 0xa0, 0x1b, 0xe1, 0xc7, 0x1e, 0x21, 0x25, 0x7c,
                                     0x6,  0x47, 0xd9, 0x76, 0x94, 0x77, 0x87, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x49, 0x2a, 0x8d, 0x37, 0x21, 0x6e};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfa, 0x77, 0x69, 0x15, 0x30, 0x48, 0x99, 0x95, 0x6d, 0x31, 0x23, 0xf4, 0xf3,
                                     0x6a, 0xab, 0x6a, 0x54, 0xc1, 0xf8, 0xdb, 0x4,  0xf6, 0x58, 0xd9, 0xa1, 0xc0};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf1, 0xef, 0x4a, 0x28, 0xd8, 0xc0, 0x3d, 0x82, 0xc5, 0x2d,
                                     0x68, 0x7c, 0xaa, 0x42, 0x1f, 0xcc, 0x5d, 0xa6, 0xcc, 0x95,
                                     0x98, 0x7c, 0x4,  0xdd, 0x58, 0x2a, 0x55, 0x8a, 0x77, 0xee};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x89, 0x3b, 0x45, 0x3, 0xba, 0xb4, 0xdd, 0xf6, 0xe5, 0xb6, 0xf7, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7d, 0xf0};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x74, 0xcd, 0x5f, 0xdc, 0xa2, 0x67, 0x8d, 0x2f, 0x63, 0x48};
  lwmqtt_string_t topic_filter_s8 = {10, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x87, 0x89, 0x95, 0xd0};
  lwmqtt_string_t topic_filter_s9 = {4, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa5, 0x13, 0x36, 0x1a, 0x47, 0x1f, 0x7d, 0xdc, 0x19, 0xf, 0x89,
                                      0xfb, 0xcc, 0x3f, 0xd2, 0x4,  0x23, 0x8,  0x4c, 0x4e, 0x81};
  lwmqtt_string_t topic_filter_s10 = {21, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0x31, 0x81, 0xf3, 0xbb, 0x66, 0x2a, 0x7c, 0xe8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9919}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21589, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25658 [("\135\217dy\159J\NULIZ",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("~|l\v\rK\139\EMPB\237\236M\165\138",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})]
// [PropRequestProblemInformation 79,PropRetainAvailable 116,PropContentType "[",PropMaximumPacketSize
// 24345,PropRequestResponseInformation 139,PropReceiveMaximum 19854,PropRetainAvailable 90,PropResponseInformation
// "\GS\135Ko\150\201\&0",PropMessageExpiryInterval 28084,PropMaximumPacketSize 6563,PropAuthenticationData
// "9Xk",PropSubscriptionIdentifier 22,PropRequestProblemInformation 247,PropTopicAlias 5595,PropContentType
// "\181\208i'2\161\162\192Wx\206\255\132Z\174e\224a~\149",PropWillDelayInterval 19259,PropContentType
// "\215\221%\216\191\DC2XX\253\232\156m\247\232\144\CAN\178\215[p\243&]\166",PropUserProperty "\228\150"
// "q!\193\SO\239$\165\b\168T\219!\154o\214\227skV\232",PropRetainAvailable 201,PropRetainAvailable
// 53,PropSubscriptionIdentifier 18,PropSubscriptionIdentifier 29,PropWildcardSubscriptionAvailable
// 25,PropTopicAliasMaximum 31978,PropAuthenticationMethod
// "Bf\146\ESCfn\170(\243(\EM\158t\ETX\158\160\GS\132\SICC\248",PropAuthenticationData
// "\134:\b\195\240\181\209\156<:H\174\172\232\190\243\128\189\150\208IOJ\200\155\154\DLE\219\GS)",PropSessionExpiryInterval
// 15712,PropContentType "\249\193&1r\a\197,\159\154 \205mq\223\161r\202\130.>C\129\&8\131",PropReceiveMaximum 29108]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x82, 0x94, 0x2,  0x64, 0x3a, 0xf2, 0x1,  0x17, 0x4f, 0x25, 0x74, 0x3,  0x0,  0x1,  0x5b, 0x27, 0x0,  0x0,  0x5f,
      0x19, 0x19, 0x8b, 0x21, 0x4d, 0x8e, 0x25, 0x5a, 0x1a, 0x0,  0x7,  0x1d, 0x87, 0x4b, 0x6f, 0x96, 0xc9, 0x30, 0x2,
      0x0,  0x0,  0x6d, 0xb4, 0x27, 0x0,  0x0,  0x19, 0xa3, 0x16, 0x0,  0x3,  0x39, 0x58, 0x6b, 0xb,  0x16, 0x17, 0xf7,
      0x23, 0x15, 0xdb, 0x3,  0x0,  0x14, 0xb5, 0xd0, 0x69, 0x27, 0x32, 0xa1, 0xa2, 0xc0, 0x57, 0x78, 0xce, 0xff, 0x84,
      0x5a, 0xae, 0x65, 0xe0, 0x61, 0x7e, 0x95, 0x18, 0x0,  0x0,  0x4b, 0x3b, 0x3,  0x0,  0x18, 0xd7, 0xdd, 0x25, 0xd8,
      0xbf, 0x12, 0x58, 0x58, 0xfd, 0xe8, 0x9c, 0x6d, 0xf7, 0xe8, 0x90, 0x18, 0xb2, 0xd7, 0x5b, 0x70, 0xf3, 0x26, 0x5d,
      0xa6, 0x26, 0x0,  0x2,  0xe4, 0x96, 0x0,  0x14, 0x71, 0x21, 0xc1, 0xe,  0xef, 0x24, 0xa5, 0x8,  0xa8, 0x54, 0xdb,
      0x21, 0x9a, 0x6f, 0xd6, 0xe3, 0x73, 0x6b, 0x56, 0xe8, 0x25, 0xc9, 0x25, 0x35, 0xb,  0x12, 0xb,  0x1d, 0x28, 0x19,
      0x22, 0x7c, 0xea, 0x15, 0x0,  0x16, 0x42, 0x66, 0x92, 0x1b, 0x66, 0x6e, 0xaa, 0x28, 0xf3, 0x28, 0x19, 0x9e, 0x74,
      0x3,  0x9e, 0xa0, 0x1d, 0x84, 0xf,  0x43, 0x43, 0xf8, 0x16, 0x0,  0x1e, 0x86, 0x3a, 0x8,  0xc3, 0xf0, 0xb5, 0xd1,
      0x9c, 0x3c, 0x3a, 0x48, 0xae, 0xac, 0xe8, 0xbe, 0xf3, 0x80, 0xbd, 0x96, 0xd0, 0x49, 0x4f, 0x4a, 0xc8, 0x9b, 0x9a,
      0x10, 0xdb, 0x1d, 0x29, 0x11, 0x0,  0x0,  0x3d, 0x60, 0x3,  0x0,  0x19, 0xf9, 0xc1, 0x26, 0x31, 0x72, 0x7,  0xc5,
      0x2c, 0x9f, 0x9a, 0x20, 0xcd, 0x6d, 0x71, 0xdf, 0xa1, 0x72, 0xca, 0x82, 0x2e, 0x3e, 0x43, 0x81, 0x38, 0x83, 0x21,
      0x71, 0xb4, 0x0,  0x9,  0x87, 0xd9, 0x64, 0x79, 0x9f, 0x4a, 0x0,  0x49, 0x5a, 0x22, 0x0,  0xf,  0x7e, 0x7c, 0x6c,
      0xb,  0xd,  0x4b, 0x8b, 0x19, 0x50, 0x42, 0xed, 0xec, 0x4d, 0xa5, 0x8a, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x87, 0xd9, 0x64, 0x79, 0x9f, 0x4a, 0x0, 0x49, 0x5a};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0x7c, 0x6c, 0xb,  0xd,  0x4b, 0x8b, 0x19,
                                     0x50, 0x42, 0xed, 0xec, 0x4d, 0xa5, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0x5b};
  uint8_t bytesprops1[] = {0x1d, 0x87, 0x4b, 0x6f, 0x96, 0xc9, 0x30};
  uint8_t bytesprops2[] = {0x39, 0x58, 0x6b};
  uint8_t bytesprops3[] = {0xb5, 0xd0, 0x69, 0x27, 0x32, 0xa1, 0xa2, 0xc0, 0x57, 0x78,
                           0xce, 0xff, 0x84, 0x5a, 0xae, 0x65, 0xe0, 0x61, 0x7e, 0x95};
  uint8_t bytesprops4[] = {0xd7, 0xdd, 0x25, 0xd8, 0xbf, 0x12, 0x58, 0x58, 0xfd, 0xe8, 0x9c, 0x6d,
                           0xf7, 0xe8, 0x90, 0x18, 0xb2, 0xd7, 0x5b, 0x70, 0xf3, 0x26, 0x5d, 0xa6};
  uint8_t bytesprops6[] = {0x71, 0x21, 0xc1, 0xe,  0xef, 0x24, 0xa5, 0x8,  0xa8, 0x54,
                           0xdb, 0x21, 0x9a, 0x6f, 0xd6, 0xe3, 0x73, 0x6b, 0x56, 0xe8};
  uint8_t bytesprops5[] = {0xe4, 0x96};
  uint8_t bytesprops7[] = {0x42, 0x66, 0x92, 0x1b, 0x66, 0x6e, 0xaa, 0x28, 0xf3, 0x28, 0x19,
                           0x9e, 0x74, 0x3,  0x9e, 0xa0, 0x1d, 0x84, 0xf,  0x43, 0x43, 0xf8};
  uint8_t bytesprops8[] = {0x86, 0x3a, 0x8,  0xc3, 0xf0, 0xb5, 0xd1, 0x9c, 0x3c, 0x3a, 0x48, 0xae, 0xac, 0xe8, 0xbe,
                           0xf3, 0x80, 0xbd, 0x96, 0xd0, 0x49, 0x4f, 0x4a, 0xc8, 0x9b, 0x9a, 0x10, 0xdb, 0x1d, 0x29};
  uint8_t bytesprops9[] = {0xf9, 0xc1, 0x26, 0x31, 0x72, 0x7,  0xc5, 0x2c, 0x9f, 0x9a, 0x20, 0xcd, 0x6d,
                           0x71, 0xdf, 0xa1, 0x72, 0xca, 0x82, 0x2e, 0x3e, 0x43, 0x81, 0x38, 0x83};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24345}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19854}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28084}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6563}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5595}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19259}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops5}, .v = {20, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31978}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15712}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29108}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25658, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3081 [("`\165\DC2QfJ\249\SI\229\168\140",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\175\219X\239\225\227x\227\ETB\252\181h",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\168#\148j\132a\191~\220R\159N\200\142j\222\155\217)\STX\rz\233",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("?\223\227x\250\168\161\217j\189b\253dAOF\239\202\227",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\160\136\fl(\220\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\152\146\139\145\146",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\197\241H\131\203;\238\152\EOT\187CUa\222\142\128\EM\SUBq",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\ACK_\244\234\207,W\239J\240\181\240fXg\231",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("{\\\162.Ggs\SOH\145\237\&7T\146",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropTopicAlias 30114,PropRequestResponseInformation 126,PropContentType "\t\191_\216\RS\US7.\SUB
// ,\208\153\132\222\204\197\197\176\233\219",PropAuthenticationMethod
// "\191d\158f\222Q\196\254\194`:\233\f\133\191a\141\r\249\175\164\225so\229\188",PropResponseTopic
// "m9`\249\133\213\149\190A\170G",PropAuthenticationData
// "\222\164I\140\207gn\206\183\DC2\NUL30\252\128\185\RS\191\214_\160\180\&7\164QuF3\FS",PropServerReference
// "\190\173j",PropAuthenticationData "\228\179\EM\159\173%w\143\239)\233\240\&2\196",PropMessageExpiryInterval
// 29813,PropMaximumQoS 102,PropServerReference "\187L",PropServerKeepAlive 30422,PropAuthenticationMethod
// "\234x\f!\209\DC2\198\166\169",PropMessageExpiryInterval 32593,PropReasonString
// "^\141\&5\229\133B\254]{\230o",PropWildcardSubscriptionAvailable 112,PropSubscriptionIdentifierAvailable
// 135,PropResponseTopic "",PropMessageExpiryInterval 20318,PropRetainAvailable 209,PropMaximumPacketSize
// 2052,PropTopicAliasMaximum 10929,PropAssignedClientIdentifier
// "\134\US85\205?\225\167\234\acZN\179\136\NAK\221\150-",PropAuthenticationMethod "\201|\174u_\EM"]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xfe, 0x2,  0xc,  0x9,  0xe2, 0x1,  0x23, 0x75, 0xa2, 0x19, 0x7e, 0x3,  0x0,  0x15, 0x9,  0xbf, 0x5f, 0xd8,
      0x1e, 0x1f, 0x37, 0x2e, 0x1a, 0x20, 0x2c, 0xd0, 0x99, 0x84, 0xde, 0xcc, 0xc5, 0xc5, 0xb0, 0xe9, 0xdb, 0x15, 0x0,
      0x1a, 0xbf, 0x64, 0x9e, 0x66, 0xde, 0x51, 0xc4, 0xfe, 0xc2, 0x60, 0x3a, 0xe9, 0xc,  0x85, 0xbf, 0x61, 0x8d, 0xd,
      0xf9, 0xaf, 0xa4, 0xe1, 0x73, 0x6f, 0xe5, 0xbc, 0x8,  0x0,  0xb,  0x6d, 0x39, 0x60, 0xf9, 0x85, 0xd5, 0x95, 0xbe,
      0x41, 0xaa, 0x47, 0x16, 0x0,  0x1d, 0xde, 0xa4, 0x49, 0x8c, 0xcf, 0x67, 0x6e, 0xce, 0xb7, 0x12, 0x0,  0x33, 0x30,
      0xfc, 0x80, 0xb9, 0x1e, 0xbf, 0xd6, 0x5f, 0xa0, 0xb4, 0x37, 0xa4, 0x51, 0x75, 0x46, 0x33, 0x1c, 0x1c, 0x0,  0x3,
      0xbe, 0xad, 0x6a, 0x16, 0x0,  0xe,  0xe4, 0xb3, 0x19, 0x9f, 0xad, 0x25, 0x77, 0x8f, 0xef, 0x29, 0xe9, 0xf0, 0x32,
      0xc4, 0x2,  0x0,  0x0,  0x74, 0x75, 0x24, 0x66, 0x1c, 0x0,  0x2,  0xbb, 0x4c, 0x13, 0x76, 0xd6, 0x15, 0x0,  0x9,
      0xea, 0x78, 0xc,  0x21, 0xd1, 0x12, 0xc6, 0xa6, 0xa9, 0x2,  0x0,  0x0,  0x7f, 0x51, 0x1f, 0x0,  0xb,  0x5e, 0x8d,
      0x35, 0xe5, 0x85, 0x42, 0xfe, 0x5d, 0x7b, 0xe6, 0x6f, 0x28, 0x70, 0x29, 0x87, 0x8,  0x0,  0x0,  0x2,  0x0,  0x0,
      0x4f, 0x5e, 0x25, 0xd1, 0x27, 0x0,  0x0,  0x8,  0x4,  0x22, 0x2a, 0xb1, 0x12, 0x0,  0x13, 0x86, 0x1f, 0x38, 0x35,
      0xcd, 0x3f, 0xe1, 0xa7, 0xea, 0x7,  0x63, 0x5a, 0x4e, 0xb3, 0x88, 0x15, 0xdd, 0x96, 0x2d, 0x15, 0x0,  0x6,  0xc9,
      0x7c, 0xae, 0x75, 0x5f, 0x19, 0x0,  0xb,  0x60, 0xa5, 0x12, 0x51, 0x66, 0x4a, 0xf9, 0xf,  0xe5, 0xa8, 0x8c, 0x22,
      0x0,  0xc,  0xaf, 0xdb, 0x58, 0xef, 0xe1, 0xe3, 0x78, 0xe3, 0x17, 0xfc, 0xb5, 0x68, 0x1,  0x0,  0x17, 0xa8, 0x23,
      0x94, 0x6a, 0x84, 0x61, 0xbf, 0x7e, 0xdc, 0x52, 0x9f, 0x4e, 0xc8, 0x8e, 0x6a, 0xde, 0x9b, 0xd9, 0x29, 0x2,  0xd,
      0x7a, 0xe9, 0x2a, 0x0,  0x13, 0x3f, 0xdf, 0xe3, 0x78, 0xfa, 0xa8, 0xa1, 0xd9, 0x6a, 0xbd, 0x62, 0xfd, 0x64, 0x41,
      0x4f, 0x46, 0xef, 0xca, 0xe3, 0x16, 0x0,  0x7,  0xa0, 0x88, 0xc,  0x6c, 0x28, 0xdc, 0x9b, 0x6,  0x0,  0x5,  0x98,
      0x92, 0x8b, 0x91, 0x92, 0x26, 0x0,  0x13, 0xc5, 0xf1, 0x48, 0x83, 0xcb, 0x3b, 0xee, 0x98, 0x4,  0xbb, 0x43, 0x55,
      0x61, 0xde, 0x8e, 0x80, 0x19, 0x1a, 0x71, 0x4,  0x0,  0x10, 0x6,  0x5f, 0xf4, 0xea, 0xcf, 0x2c, 0x57, 0xef, 0x4a,
      0xf0, 0xb5, 0xf0, 0x66, 0x58, 0x67, 0xe7, 0x2e, 0x0,  0xd,  0x7b, 0x5c, 0xa2, 0x2e, 0x47, 0x67, 0x73, 0x1,  0x91,
      0xed, 0x37, 0x54, 0x92, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x60, 0xa5, 0x12, 0x51, 0x66, 0x4a, 0xf9, 0xf, 0xe5, 0xa8, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaf, 0xdb, 0x58, 0xef, 0xe1, 0xe3, 0x78, 0xe3, 0x17, 0xfc, 0xb5, 0x68};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa8, 0x23, 0x94, 0x6a, 0x84, 0x61, 0xbf, 0x7e, 0xdc, 0x52, 0x9f, 0x4e,
                                     0xc8, 0x8e, 0x6a, 0xde, 0x9b, 0xd9, 0x29, 0x2,  0xd,  0x7a, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3f, 0xdf, 0xe3, 0x78, 0xfa, 0xa8, 0xa1, 0xd9, 0x6a, 0xbd,
                                     0x62, 0xfd, 0x64, 0x41, 0x4f, 0x46, 0xef, 0xca, 0xe3};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0x88, 0xc, 0x6c, 0x28, 0xdc, 0x9b};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x98, 0x92, 0x8b, 0x91, 0x92};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc5, 0xf1, 0x48, 0x83, 0xcb, 0x3b, 0xee, 0x98, 0x4, 0xbb,
                                     0x43, 0x55, 0x61, 0xde, 0x8e, 0x80, 0x19, 0x1a, 0x71};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6,  0x5f, 0xf4, 0xea, 0xcf, 0x2c, 0x57, 0xef,
                                     0x4a, 0xf0, 0xb5, 0xf0, 0x66, 0x58, 0x67, 0xe7};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x7b, 0x5c, 0xa2, 0x2e, 0x47, 0x67, 0x73, 0x1, 0x91, 0xed, 0x37, 0x54, 0x92};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0x9,  0xbf, 0x5f, 0xd8, 0x1e, 0x1f, 0x37, 0x2e, 0x1a, 0x20, 0x2c,
                           0xd0, 0x99, 0x84, 0xde, 0xcc, 0xc5, 0xc5, 0xb0, 0xe9, 0xdb};
  uint8_t bytesprops1[] = {0xbf, 0x64, 0x9e, 0x66, 0xde, 0x51, 0xc4, 0xfe, 0xc2, 0x60, 0x3a, 0xe9, 0xc,
                           0x85, 0xbf, 0x61, 0x8d, 0xd,  0xf9, 0xaf, 0xa4, 0xe1, 0x73, 0x6f, 0xe5, 0xbc};
  uint8_t bytesprops2[] = {0x6d, 0x39, 0x60, 0xf9, 0x85, 0xd5, 0x95, 0xbe, 0x41, 0xaa, 0x47};
  uint8_t bytesprops3[] = {0xde, 0xa4, 0x49, 0x8c, 0xcf, 0x67, 0x6e, 0xce, 0xb7, 0x12, 0x0,  0x33, 0x30, 0xfc, 0x80,
                           0xb9, 0x1e, 0xbf, 0xd6, 0x5f, 0xa0, 0xb4, 0x37, 0xa4, 0x51, 0x75, 0x46, 0x33, 0x1c};
  uint8_t bytesprops4[] = {0xbe, 0xad, 0x6a};
  uint8_t bytesprops5[] = {0xe4, 0xb3, 0x19, 0x9f, 0xad, 0x25, 0x77, 0x8f, 0xef, 0x29, 0xe9, 0xf0, 0x32, 0xc4};
  uint8_t bytesprops6[] = {0xbb, 0x4c};
  uint8_t bytesprops7[] = {0xea, 0x78, 0xc, 0x21, 0xd1, 0x12, 0xc6, 0xa6, 0xa9};
  uint8_t bytesprops8[] = {0x5e, 0x8d, 0x35, 0xe5, 0x85, 0x42, 0xfe, 0x5d, 0x7b, 0xe6, 0x6f};
  uint8_t bytesprops9[] = {0};
  uint8_t bytesprops10[] = {0x86, 0x1f, 0x38, 0x35, 0xcd, 0x3f, 0xe1, 0xa7, 0xea, 0x7,
                            0x63, 0x5a, 0x4e, 0xb3, 0x88, 0x15, 0xdd, 0x96, 0x2d};
  uint8_t bytesprops11[] = {0xc9, 0x7c, 0xae, 0x75, 0x5f, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30114}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29813}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30422}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32593}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20318}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2052}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10929}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3081, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26803 [("G0\203x\EOT9\163\234\244~\250\213\DEL\247z'\226",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m,s\SO\194G\181\182\&9\128N\200\150;gq9\182u?e\\\252\219\SO\133\DC2\146\242W",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\129\156\160\NAK\194\&8\202\196Y
// \172\147\213\175\141*\168\ETB\195y\147",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("iM\SYN\223q\DEL@J\183\233\132\254[*",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("jX\ra\242\DC1\ETB@E\181\181\252R",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\224\GSH\ESCU\212",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropReceiveMaximum 7683,PropMessageExpiryInterval
// 31743,PropAuthenticationMethod "\STXL\254\223\133\190H\217\228\f",PropServerReference
// "^\244\132\253?e\ENQ\\",PropSessionExpiryInterval 16241,PropResponseTopic
// "\246\137\225H\161r\219\203\242\149\ETB?\173e2\219\130\192\&7"]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0xb5, 0x1,  0x68, 0xb3, 0x3b, 0x21, 0x1e, 0x3,  0x2,  0x0,  0x0,  0x7b, 0xff, 0x15, 0x0,  0xa,
                   0x2,  0x4c, 0xfe, 0xdf, 0x85, 0xbe, 0x48, 0xd9, 0xe4, 0xc,  0x1c, 0x0,  0x8,  0x5e, 0xf4, 0x84, 0xfd,
                   0x3f, 0x65, 0x5,  0x5c, 0x11, 0x0,  0x0,  0x3f, 0x71, 0x8,  0x0,  0x13, 0xf6, 0x89, 0xe1, 0x48, 0xa1,
                   0x72, 0xdb, 0xcb, 0xf2, 0x95, 0x17, 0x3f, 0xad, 0x65, 0x32, 0xdb, 0x82, 0xc0, 0x37, 0x0,  0x11, 0x47,
                   0x30, 0xcb, 0x78, 0x4,  0x39, 0xa3, 0xea, 0xf4, 0x7e, 0xfa, 0xd5, 0x7f, 0xf7, 0x7a, 0x27, 0xe2, 0x12,
                   0x0,  0x1e, 0x6d, 0x2c, 0x73, 0xe,  0xc2, 0x47, 0xb5, 0xb6, 0x39, 0x80, 0x4e, 0xc8, 0x96, 0x3b, 0x67,
                   0x71, 0x39, 0xb6, 0x75, 0x3f, 0x65, 0x5c, 0xfc, 0xdb, 0xe,  0x85, 0x12, 0x92, 0xf2, 0x57, 0x12, 0x0,
                   0x15, 0x81, 0x9c, 0xa0, 0x15, 0xc2, 0x38, 0xca, 0xc4, 0x59, 0x20, 0xac, 0x93, 0xd5, 0xaf, 0x8d, 0x2a,
                   0xa8, 0x17, 0xc3, 0x79, 0x93, 0x11, 0x0,  0xe,  0x69, 0x4d, 0x16, 0xdf, 0x71, 0x7f, 0x40, 0x4a, 0xb7,
                   0xe9, 0x84, 0xfe, 0x5b, 0x2a, 0x1,  0x0,  0xd,  0x6a, 0x58, 0xd,  0x61, 0xf2, 0x11, 0x17, 0x40, 0x45,
                   0xb5, 0xb5, 0xfc, 0x52, 0x21, 0x0,  0x6,  0xe0, 0x1d, 0x48, 0x1b, 0x55, 0xd4, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x30, 0xcb, 0x78, 0x4,  0x39, 0xa3, 0xea, 0xf4,
                                     0x7e, 0xfa, 0xd5, 0x7f, 0xf7, 0x7a, 0x27, 0xe2};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6d, 0x2c, 0x73, 0xe,  0xc2, 0x47, 0xb5, 0xb6, 0x39, 0x80,
                                     0x4e, 0xc8, 0x96, 0x3b, 0x67, 0x71, 0x39, 0xb6, 0x75, 0x3f,
                                     0x65, 0x5c, 0xfc, 0xdb, 0xe,  0x85, 0x12, 0x92, 0xf2, 0x57};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x81, 0x9c, 0xa0, 0x15, 0xc2, 0x38, 0xca, 0xc4, 0x59, 0x20, 0xac,
                                     0x93, 0xd5, 0xaf, 0x8d, 0x2a, 0xa8, 0x17, 0xc3, 0x79, 0x93};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x69, 0x4d, 0x16, 0xdf, 0x71, 0x7f, 0x40,
                                     0x4a, 0xb7, 0xe9, 0x84, 0xfe, 0x5b, 0x2a};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6a, 0x58, 0xd, 0x61, 0xf2, 0x11, 0x17, 0x40, 0x45, 0xb5, 0xb5, 0xfc, 0x52};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe0, 0x1d, 0x48, 0x1b, 0x55, 0xd4};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x2, 0x4c, 0xfe, 0xdf, 0x85, 0xbe, 0x48, 0xd9, 0xe4, 0xc};
  uint8_t bytesprops1[] = {0x5e, 0xf4, 0x84, 0xfd, 0x3f, 0x65, 0x5, 0x5c};
  uint8_t bytesprops2[] = {0xf6, 0x89, 0xe1, 0x48, 0xa1, 0x72, 0xdb, 0xcb, 0xf2, 0x95,
                           0x17, 0x3f, 0xad, 0x65, 0x32, 0xdb, 0x82, 0xc0, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7683}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31743}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16241}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26803, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11145 [("\164AU\201Ck<Q?\b\255%\175\SYN\193,]\130\138N\f",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropWildcardSubscriptionAvailable 45,PropTopicAlias 7512,PropResponseTopic
// "\249\228b\158\&3\173\141Q<\f\166\&2c\242\135\246.)\229",PropRetainAvailable 218,PropSubscriptionIdentifierAvailable
// 146,PropRequestResponseInformation 58,PropResponseTopic
// "\145\SO!qk\151:U\DC1\232\254Bd'J?t",PropWildcardSubscriptionAvailable 20,PropRequestResponseInformation
// 88,PropMaximumQoS 62,PropAssignedClientIdentifier "xXK\221",PropPayloadFormatIndicator
// 7,PropSharedSubscriptionAvailable 88,PropAuthenticationMethod "\130`\b\240\&7\198\&0\SUB\164\226
// qv\213\196P|D",PropAssignedClientIdentifier "r\SO\169\ENQ\222J\179W\\\226\193",PropReasonString
// "\CAN\217b\219\161A\129\242\SYN\146\234\181k-\243\153\255zi\183\va+E\EMN\164\230\229\211",PropServerKeepAlive 1364]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xa9, 0x1,  0x2b, 0x89, 0x8d, 0x1,  0x28, 0x2d, 0x23, 0x1d, 0x58, 0x8,  0x0,  0x13, 0xf9,
                   0xe4, 0x62, 0x9e, 0x33, 0xad, 0x8d, 0x51, 0x3c, 0xc,  0xa6, 0x32, 0x63, 0xf2, 0x87, 0xf6, 0x2e,
                   0x29, 0xe5, 0x25, 0xda, 0x29, 0x92, 0x19, 0x3a, 0x8,  0x0,  0x11, 0x91, 0xe,  0x21, 0x71, 0x6b,
                   0x97, 0x3a, 0x55, 0x11, 0xe8, 0xfe, 0x42, 0x64, 0x27, 0x4a, 0x3f, 0x74, 0x28, 0x14, 0x19, 0x58,
                   0x24, 0x3e, 0x12, 0x0,  0x4,  0x78, 0x58, 0x4b, 0xdd, 0x1,  0x7,  0x2a, 0x58, 0x15, 0x0,  0x12,
                   0x82, 0x60, 0x8,  0xf0, 0x37, 0xc6, 0x30, 0x1a, 0xa4, 0xe2, 0x20, 0x71, 0x76, 0xd5, 0xc4, 0x50,
                   0x7c, 0x44, 0x12, 0x0,  0xb,  0x72, 0xe,  0xa9, 0x5,  0xde, 0x4a, 0xb3, 0x57, 0x5c, 0xe2, 0xc1,
                   0x1f, 0x0,  0x1e, 0x18, 0xd9, 0x62, 0xdb, 0xa1, 0x41, 0x81, 0xf2, 0x16, 0x92, 0xea, 0xb5, 0x6b,
                   0x2d, 0xf3, 0x99, 0xff, 0x7a, 0x69, 0xb7, 0xb,  0x61, 0x2b, 0x45, 0x19, 0x4e, 0xa4, 0xe6, 0xe5,
                   0xd3, 0x13, 0x5,  0x54, 0x0,  0x15, 0xa4, 0x41, 0x55, 0xc9, 0x43, 0x6b, 0x3c, 0x51, 0x3f, 0x8,
                   0xff, 0x25, 0xaf, 0x16, 0xc1, 0x2c, 0x5d, 0x82, 0x8a, 0x4e, 0xc,  0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xa4, 0x41, 0x55, 0xc9, 0x43, 0x6b, 0x3c, 0x51, 0x3f, 0x8, 0xff,
                                     0x25, 0xaf, 0x16, 0xc1, 0x2c, 0x5d, 0x82, 0x8a, 0x4e, 0xc};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0xf9, 0xe4, 0x62, 0x9e, 0x33, 0xad, 0x8d, 0x51, 0x3c, 0xc,
                           0xa6, 0x32, 0x63, 0xf2, 0x87, 0xf6, 0x2e, 0x29, 0xe5};
  uint8_t bytesprops1[] = {0x91, 0xe,  0x21, 0x71, 0x6b, 0x97, 0x3a, 0x55, 0x11,
                           0xe8, 0xfe, 0x42, 0x64, 0x27, 0x4a, 0x3f, 0x74};
  uint8_t bytesprops2[] = {0x78, 0x58, 0x4b, 0xdd};
  uint8_t bytesprops3[] = {0x82, 0x60, 0x8,  0xf0, 0x37, 0xc6, 0x30, 0x1a, 0xa4,
                           0xe2, 0x20, 0x71, 0x76, 0xd5, 0xc4, 0x50, 0x7c, 0x44};
  uint8_t bytesprops4[] = {0x72, 0xe, 0xa9, 0x5, 0xde, 0x4a, 0xb3, 0x57, 0x5c, 0xe2, 0xc1};
  uint8_t bytesprops5[] = {0x18, 0xd9, 0x62, 0xdb, 0xa1, 0x41, 0x81, 0xf2, 0x16, 0x92, 0xea, 0xb5, 0x6b, 0x2d, 0xf3,
                           0x99, 0xff, 0x7a, 0x69, 0xb7, 0xb,  0x61, 0x2b, 0x45, 0x19, 0x4e, 0xa4, 0xe6, 0xe5, 0xd3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7512}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1364}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11145, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31044 [("\187\200\156!\158\f4\STX\NUL\172\ENQ\244~\208\172B\DC3)\145C1\166m\208\175\254T",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\DC1|\CAN\219\DC3\143\242\ENQ\DC4V\CAN\136\136o\SO\ESC\DC3/\158;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\140n\149gP\165\133C\183\140\144\195I\r\RS\215 \202EX\EOT\203\135",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\EM",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("p<\149\181\SYN\235b<N\242\203pS\173",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS =
// QoS0}),("\250\ENQ\194\165\153;\151\173\143\220z\175n\168\&6\187\232\SI\153\132G\189\SUB\171v\247\178W\219",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\181\216\214e\225\&0#]\206\240\&7\199\ETX\133\132\148\216\&7c;I\US\212\EOT\US\218u\178",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("z\137FLm07=\230F\205\242\r\164\221",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\190\181`\130\234\187\176F\193\149\242\223\&7\130\167>\ACK\SYN_G\244\236M\230\204",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropRetainAvailable 101,PropContentType "&\\\165",PropMaximumPacketSize 20497,PropMessageExpiryInterval
// 18487,PropServerReference "c\228\200\129\177n\NUL\168A\195\249\232\239\171\148\154",PropRetainAvailable
// 246,PropMessageExpiryInterval 3316,PropResponseTopic "\"\186",PropPayloadFormatIndicator 25,PropTopicAliasMaximum
// 6042,PropResponseInformation "\149eE\137\222\&0\202\143\DC1C\234\157|[\249\178?",PropMessageExpiryInterval
// 22525,PropResponseInformation "\197\250[\230\a\242\180R\186\163\170\240\247t\187\238\DEL
// t\"\164\156+\130\164",PropRequestResponseInformation 170]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xc1, 0x2,  0x79, 0x44, 0x6d, 0x25, 0x65, 0x3,  0x0,  0x3,  0x26, 0x5c, 0xa5, 0x27, 0x0,  0x0,  0x50,
      0x11, 0x2,  0x0,  0x0,  0x48, 0x37, 0x1c, 0x0,  0x10, 0x63, 0xe4, 0xc8, 0x81, 0xb1, 0x6e, 0x0,  0xa8, 0x41,
      0xc3, 0xf9, 0xe8, 0xef, 0xab, 0x94, 0x9a, 0x25, 0xf6, 0x2,  0x0,  0x0,  0xc,  0xf4, 0x8,  0x0,  0x2,  0x22,
      0xba, 0x1,  0x19, 0x22, 0x17, 0x9a, 0x1a, 0x0,  0x11, 0x95, 0x65, 0x45, 0x89, 0xde, 0x30, 0xca, 0x8f, 0x11,
      0x43, 0xea, 0x9d, 0x7c, 0x5b, 0xf9, 0xb2, 0x3f, 0x2,  0x0,  0x0,  0x57, 0xfd, 0x1a, 0x0,  0x19, 0xc5, 0xfa,
      0x5b, 0xe6, 0x7,  0xf2, 0xb4, 0x52, 0xba, 0xa3, 0xaa, 0xf0, 0xf7, 0x74, 0xbb, 0xee, 0x7f, 0x20, 0x74, 0x22,
      0xa4, 0x9c, 0x2b, 0x82, 0xa4, 0x19, 0xaa, 0x0,  0x1b, 0xbb, 0xc8, 0x9c, 0x21, 0x9e, 0xc,  0x34, 0x2,  0x0,
      0xac, 0x5,  0xf4, 0x7e, 0xd0, 0xac, 0x42, 0x13, 0x29, 0x91, 0x43, 0x31, 0xa6, 0x6d, 0xd0, 0xaf, 0xfe, 0x54,
      0x21, 0x0,  0x14, 0x11, 0x7c, 0x18, 0xdb, 0x13, 0x8f, 0xf2, 0x5,  0x14, 0x56, 0x18, 0x88, 0x88, 0x6f, 0xe,
      0x1b, 0x13, 0x2f, 0x9e, 0x3b, 0x2,  0x0,  0x17, 0x8c, 0x6e, 0x95, 0x67, 0x50, 0xa5, 0x85, 0x43, 0xb7, 0x8c,
      0x90, 0xc3, 0x49, 0xd,  0x1e, 0xd7, 0x20, 0xca, 0x45, 0x58, 0x4,  0xcb, 0x87, 0x14, 0x0,  0x1,  0x19, 0x1c,
      0x0,  0xe,  0x70, 0x3c, 0x95, 0xb5, 0x16, 0xeb, 0x62, 0x3c, 0x4e, 0xf2, 0xcb, 0x70, 0x53, 0xad, 0x1c, 0x0,
      0x1d, 0xfa, 0x5,  0xc2, 0xa5, 0x99, 0x3b, 0x97, 0xad, 0x8f, 0xdc, 0x7a, 0xaf, 0x6e, 0xa8, 0x36, 0xbb, 0xe8,
      0xf,  0x99, 0x84, 0x47, 0xbd, 0x1a, 0xab, 0x76, 0xf7, 0xb2, 0x57, 0xdb, 0x19, 0x0,  0x1c, 0xb5, 0xd8, 0xd6,
      0x65, 0xe1, 0x30, 0x23, 0x5d, 0xce, 0xf0, 0x37, 0xc7, 0x3,  0x85, 0x84, 0x94, 0xd8, 0x37, 0x63, 0x3b, 0x49,
      0x1f, 0xd4, 0x4,  0x1f, 0xda, 0x75, 0xb2, 0x6,  0x0,  0xf,  0x7a, 0x89, 0x46, 0x4c, 0x6d, 0x30, 0x37, 0x3d,
      0xe6, 0x46, 0xcd, 0xf2, 0xd,  0xa4, 0xdd, 0x21, 0x0,  0x19, 0xbe, 0xb5, 0x60, 0x82, 0xea, 0xbb, 0xb0, 0x46,
      0xc1, 0x95, 0xf2, 0xdf, 0x37, 0x82, 0xa7, 0x3e, 0x6,  0x16, 0x5f, 0x47, 0xf4, 0xec, 0x4d, 0xe6, 0xcc, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xbb, 0xc8, 0x9c, 0x21, 0x9e, 0xc,  0x34, 0x2,  0x0,  0xac, 0x5,  0xf4, 0x7e, 0xd0,
                                     0xac, 0x42, 0x13, 0x29, 0x91, 0x43, 0x31, 0xa6, 0x6d, 0xd0, 0xaf, 0xfe, 0x54};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x11, 0x7c, 0x18, 0xdb, 0x13, 0x8f, 0xf2, 0x5,  0x14, 0x56,
                                     0x18, 0x88, 0x88, 0x6f, 0xe,  0x1b, 0x13, 0x2f, 0x9e, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8c, 0x6e, 0x95, 0x67, 0x50, 0xa5, 0x85, 0x43, 0xb7, 0x8c, 0x90, 0xc3,
                                     0x49, 0xd,  0x1e, 0xd7, 0x20, 0xca, 0x45, 0x58, 0x4,  0xcb, 0x87};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x19};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x70, 0x3c, 0x95, 0xb5, 0x16, 0xeb, 0x62,
                                     0x3c, 0x4e, 0xf2, 0xcb, 0x70, 0x53, 0xad};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x5,  0xc2, 0xa5, 0x99, 0x3b, 0x97, 0xad, 0x8f, 0xdc,
                                     0x7a, 0xaf, 0x6e, 0xa8, 0x36, 0xbb, 0xe8, 0xf,  0x99, 0x84,
                                     0x47, 0xbd, 0x1a, 0xab, 0x76, 0xf7, 0xb2, 0x57, 0xdb};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb5, 0xd8, 0xd6, 0x65, 0xe1, 0x30, 0x23, 0x5d, 0xce, 0xf0,
                                     0x37, 0xc7, 0x3,  0x85, 0x84, 0x94, 0xd8, 0x37, 0x63, 0x3b,
                                     0x49, 0x1f, 0xd4, 0x4,  0x1f, 0xda, 0x75, 0xb2};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7a, 0x89, 0x46, 0x4c, 0x6d, 0x30, 0x37, 0x3d,
                                     0xe6, 0x46, 0xcd, 0xf2, 0xd,  0xa4, 0xdd};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xbe, 0xb5, 0x60, 0x82, 0xea, 0xbb, 0xb0, 0x46, 0xc1, 0x95, 0xf2, 0xdf, 0x37,
                                     0x82, 0xa7, 0x3e, 0x6,  0x16, 0x5f, 0x47, 0xf4, 0xec, 0x4d, 0xe6, 0xcc};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  uint8_t bytesprops0[] = {0x26, 0x5c, 0xa5};
  uint8_t bytesprops1[] = {0x63, 0xe4, 0xc8, 0x81, 0xb1, 0x6e, 0x0,  0xa8,
                           0x41, 0xc3, 0xf9, 0xe8, 0xef, 0xab, 0x94, 0x9a};
  uint8_t bytesprops2[] = {0x22, 0xba};
  uint8_t bytesprops3[] = {0x95, 0x65, 0x45, 0x89, 0xde, 0x30, 0xca, 0x8f, 0x11,
                           0x43, 0xea, 0x9d, 0x7c, 0x5b, 0xf9, 0xb2, 0x3f};
  uint8_t bytesprops4[] = {0xc5, 0xfa, 0x5b, 0xe6, 0x7,  0xf2, 0xb4, 0x52, 0xba, 0xa3, 0xaa, 0xf0, 0xf7,
                           0x74, 0xbb, 0xee, 0x7f, 0x20, 0x74, 0x22, 0xa4, 0x9c, 0x2b, 0x82, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20497}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18487}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3316}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6042}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22525}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 170}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31044, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8770 [("\246\142&\218\222\148\226\196\212s~U\253",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\189\174\GS0\252J
// \229\&3J\f\139\225\150\221\DC4p\226\223",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\169Q;\220&z\151\248\&5\149\161\202h\ENQ\162\148\158\137b\203\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropSessionExpiryInterval 9936,PropSessionExpiryInterval 30050,PropServerReference
// "\SUB|\201K\186(\FS\r\206\252\DC2\237\146Qw",PropWillDelayInterval 32549,PropReasonString
// "i\DC32\234\247\183",PropResponseTopic
// "[\238\247)\US\163\191\&3\202\245\198>\191t\aN'\229\148\176\ESC\202\SOH",PropUserProperty
// "f\222\236MO\EM71\132\198mB\241\177\178\ETB"
// "G\GS\252#v\237\198d\187\187r\187\162\152\&7\SOH+\225\ETX",PropRetainAvailable 171,PropRetainAvailable
// 209,PropTopicAlias 15467,PropTopicAliasMaximum 17442,PropResponseTopic
// "\219\132-\135\129#.\214\206\184i\238\DC3\130\220\US\168\248T\RSD\SYN\SUBB\185\SUB\135\129",PropAuthenticationData "W
// \218C\190\149\240",PropPayloadFormatIndicator 81,PropCorrelationData
// "\247\232^\221CdI./B",PropRequestProblemInformation 89,PropResponseInformation
// "\EM\138\225i\197\247\188u\196\NAK\"y\234\254o\GS\158\155\248\227\151\250n\142\255\195\SYN\135\181",PropMaximumQoS
// 163,PropPayloadFormatIndicator 45,PropServerReference
// "\SYN@\DLE\207\222\SOH\184\213\&33?&\t\159",PropSessionExpiryInterval 6115,PropServerReference
// "#N\SOH\ESC\SO\ETBbN\155\r[\173",PropWillDelayInterval 15590,PropSubscriptionIdentifierAvailable
// 72,PropReceiveMaximum 1371,PropUserProperty "7\DC1\204\177,\170IK\144\133\218`\156\223X\134\150\DELs\247:"
// "\192uN\191G\a\246\150\253\&9\192\SO\DC3\196\162\196\205]{\213g\148B#\177\224>\239t",PropMessageExpiryInterval
// 3198,PropReceiveMaximum 19723]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x82, 0x84, 0x3,  0x22, 0x42, 0xc2, 0x2,  0x11, 0x0,  0x0,  0x26, 0xd0, 0x11, 0x0,  0x0,  0x75, 0x62, 0x1c, 0x0,
      0xf,  0x1a, 0x7c, 0xc9, 0x4b, 0xba, 0x28, 0x1c, 0xd,  0xce, 0xfc, 0x12, 0xed, 0x92, 0x51, 0x77, 0x18, 0x0,  0x0,
      0x7f, 0x25, 0x1f, 0x0,  0x6,  0x69, 0x13, 0x32, 0xea, 0xf7, 0xb7, 0x8,  0x0,  0x17, 0x5b, 0xee, 0xf7, 0x29, 0x1f,
      0xa3, 0xbf, 0x33, 0xca, 0xf5, 0xc6, 0x3e, 0xbf, 0x74, 0x7,  0x4e, 0x27, 0xe5, 0x94, 0xb0, 0x1b, 0xca, 0x1,  0x26,
      0x0,  0x10, 0x66, 0xde, 0xec, 0x4d, 0x4f, 0x19, 0x37, 0x31, 0x84, 0xc6, 0x6d, 0x42, 0xf1, 0xb1, 0xb2, 0x17, 0x0,
      0x13, 0x47, 0x1d, 0xfc, 0x23, 0x76, 0xed, 0xc6, 0x64, 0xbb, 0xbb, 0x72, 0xbb, 0xa2, 0x98, 0x37, 0x1,  0x2b, 0xe1,
      0x3,  0x25, 0xab, 0x25, 0xd1, 0x23, 0x3c, 0x6b, 0x22, 0x44, 0x22, 0x8,  0x0,  0x1c, 0xdb, 0x84, 0x2d, 0x87, 0x81,
      0x23, 0x2e, 0xd6, 0xce, 0xb8, 0x69, 0xee, 0x13, 0x82, 0xdc, 0x1f, 0xa8, 0xf8, 0x54, 0x1e, 0x44, 0x16, 0x1a, 0x42,
      0xb9, 0x1a, 0x87, 0x81, 0x16, 0x0,  0x7,  0x57, 0x20, 0xda, 0x43, 0xbe, 0x95, 0xf0, 0x1,  0x51, 0x9,  0x0,  0xa,
      0xf7, 0xe8, 0x5e, 0xdd, 0x43, 0x64, 0x49, 0x2e, 0x2f, 0x42, 0x17, 0x59, 0x1a, 0x0,  0x1d, 0x19, 0x8a, 0xe1, 0x69,
      0xc5, 0xf7, 0xbc, 0x75, 0xc4, 0x15, 0x22, 0x79, 0xea, 0xfe, 0x6f, 0x1d, 0x9e, 0x9b, 0xf8, 0xe3, 0x97, 0xfa, 0x6e,
      0x8e, 0xff, 0xc3, 0x16, 0x87, 0xb5, 0x24, 0xa3, 0x1,  0x2d, 0x1c, 0x0,  0xe,  0x16, 0x40, 0x10, 0xcf, 0xde, 0x1,
      0xb8, 0xd5, 0x33, 0x33, 0x3f, 0x26, 0x9,  0x9f, 0x11, 0x0,  0x0,  0x17, 0xe3, 0x1c, 0x0,  0xc,  0x23, 0x4e, 0x1,
      0x1b, 0xe,  0x17, 0x62, 0x4e, 0x9b, 0xd,  0x5b, 0xad, 0x18, 0x0,  0x0,  0x3c, 0xe6, 0x29, 0x48, 0x21, 0x5,  0x5b,
      0x26, 0x0,  0x15, 0x37, 0x11, 0xcc, 0xb1, 0x2c, 0xaa, 0x49, 0x4b, 0x90, 0x85, 0xda, 0x60, 0x9c, 0xdf, 0x58, 0x86,
      0x96, 0x7f, 0x73, 0xf7, 0x3a, 0x0,  0x1d, 0xc0, 0x75, 0x4e, 0xbf, 0x47, 0x7,  0xf6, 0x96, 0xfd, 0x39, 0xc0, 0xe,
      0x13, 0xc4, 0xa2, 0xc4, 0xcd, 0x5d, 0x7b, 0xd5, 0x67, 0x94, 0x42, 0x23, 0xb1, 0xe0, 0x3e, 0xef, 0x74, 0x2,  0x0,
      0x0,  0xc,  0x7e, 0x21, 0x4d, 0xb,  0x0,  0xd,  0xf6, 0x8e, 0x26, 0xda, 0xde, 0x94, 0xe2, 0xc4, 0xd4, 0x73, 0x7e,
      0x55, 0xfd, 0x10, 0x0,  0x13, 0xbd, 0xae, 0x1d, 0x30, 0xfc, 0x4a, 0x20, 0xe5, 0x33, 0x4a, 0xc,  0x8b, 0xe1, 0x96,
      0xdd, 0x14, 0x70, 0xe2, 0xdf, 0x2,  0x0,  0x15, 0xa9, 0x51, 0x3b, 0xdc, 0x26, 0x7a, 0x97, 0xf8, 0x35, 0x95, 0xa1,
      0xca, 0x68, 0x5,  0xa2, 0x94, 0x9e, 0x89, 0x62, 0xcb, 0xc,  0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf6, 0x8e, 0x26, 0xda, 0xde, 0x94, 0xe2, 0xc4, 0xd4, 0x73, 0x7e, 0x55, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xae, 0x1d, 0x30, 0xfc, 0x4a, 0x20, 0xe5, 0x33, 0x4a,
                                     0xc,  0x8b, 0xe1, 0x96, 0xdd, 0x14, 0x70, 0xe2, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x51, 0x3b, 0xdc, 0x26, 0x7a, 0x97, 0xf8, 0x35, 0x95, 0xa1,
                                     0xca, 0x68, 0x5,  0xa2, 0x94, 0x9e, 0x89, 0x62, 0xcb, 0xc};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0x1a, 0x7c, 0xc9, 0x4b, 0xba, 0x28, 0x1c, 0xd, 0xce, 0xfc, 0x12, 0xed, 0x92, 0x51, 0x77};
  uint8_t bytesprops1[] = {0x69, 0x13, 0x32, 0xea, 0xf7, 0xb7};
  uint8_t bytesprops2[] = {0x5b, 0xee, 0xf7, 0x29, 0x1f, 0xa3, 0xbf, 0x33, 0xca, 0xf5, 0xc6, 0x3e,
                           0xbf, 0x74, 0x7,  0x4e, 0x27, 0xe5, 0x94, 0xb0, 0x1b, 0xca, 0x1};
  uint8_t bytesprops4[] = {0x47, 0x1d, 0xfc, 0x23, 0x76, 0xed, 0xc6, 0x64, 0xbb, 0xbb,
                           0x72, 0xbb, 0xa2, 0x98, 0x37, 0x1,  0x2b, 0xe1, 0x3};
  uint8_t bytesprops3[] = {0x66, 0xde, 0xec, 0x4d, 0x4f, 0x19, 0x37, 0x31,
                           0x84, 0xc6, 0x6d, 0x42, 0xf1, 0xb1, 0xb2, 0x17};
  uint8_t bytesprops5[] = {0xdb, 0x84, 0x2d, 0x87, 0x81, 0x23, 0x2e, 0xd6, 0xce, 0xb8, 0x69, 0xee, 0x13, 0x82,
                           0xdc, 0x1f, 0xa8, 0xf8, 0x54, 0x1e, 0x44, 0x16, 0x1a, 0x42, 0xb9, 0x1a, 0x87, 0x81};
  uint8_t bytesprops6[] = {0x57, 0x20, 0xda, 0x43, 0xbe, 0x95, 0xf0};
  uint8_t bytesprops7[] = {0xf7, 0xe8, 0x5e, 0xdd, 0x43, 0x64, 0x49, 0x2e, 0x2f, 0x42};
  uint8_t bytesprops8[] = {0x19, 0x8a, 0xe1, 0x69, 0xc5, 0xf7, 0xbc, 0x75, 0xc4, 0x15, 0x22, 0x79, 0xea, 0xfe, 0x6f,
                           0x1d, 0x9e, 0x9b, 0xf8, 0xe3, 0x97, 0xfa, 0x6e, 0x8e, 0xff, 0xc3, 0x16, 0x87, 0xb5};
  uint8_t bytesprops9[] = {0x16, 0x40, 0x10, 0xcf, 0xde, 0x1, 0xb8, 0xd5, 0x33, 0x33, 0x3f, 0x26, 0x9, 0x9f};
  uint8_t bytesprops10[] = {0x23, 0x4e, 0x1, 0x1b, 0xe, 0x17, 0x62, 0x4e, 0x9b, 0xd, 0x5b, 0xad};
  uint8_t bytesprops12[] = {0xc0, 0x75, 0x4e, 0xbf, 0x47, 0x7,  0xf6, 0x96, 0xfd, 0x39, 0xc0, 0xe,  0x13, 0xc4, 0xa2,
                            0xc4, 0xcd, 0x5d, 0x7b, 0xd5, 0x67, 0x94, 0x42, 0x23, 0xb1, 0xe0, 0x3e, 0xef, 0x74};
  uint8_t bytesprops11[] = {0x37, 0x11, 0xcc, 0xb1, 0x2c, 0xaa, 0x49, 0x4b, 0x90, 0x85, 0xda,
                            0x60, 0x9c, 0xdf, 0x58, 0x86, 0x96, 0x7f, 0x73, 0xf7, 0x3a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9936}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30050}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32549}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops3}, .v = {19, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15467}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17442}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6115}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15590}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1371}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&bytesprops11}, .v = {29, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3198}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19723}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8770, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15580
// [("\145\183m\232\217\188\204_\223\249\161\170\156\133T\234\233\159\235\&2H\175J\211\149j",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("]\151",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\238\244E\141\168\203\228s?\190\232J\139\182N\157",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropAssignedClientIdentifier
// "O,\169e`v\182\133\201{\177\141L\192\157\142\128\243\145\133\163\140",PropRequestResponseInformation
// 235,PropSubscriptionIdentifier 23,PropAssignedClientIdentifier
// "\135\142\141\222\141\SYN\\2\139i0r<(\237\169F\249\220\233",PropReceiveMaximum 29989,PropMessageExpiryInterval
// 28800,PropAuthenticationData "\243\152",PropMessageExpiryInterval 17966,PropSharedSubscriptionAvailable
// 153,PropResponseTopic
// "\v\FS\131\164Ml\229z\207\FS\EM,\227\250L\164H\b0\170\162\b6\139\167\169\171",PropServerReference
// "\133\224\SOq\173\244\SI\v\ACKw\SOH{\226\164z",PropSubscriptionIdentifier 10,PropUserProperty
// "\253\156\217\b\208@\146" "\aY\EM\234",PropRequestProblemInformation 148,PropContentType
// "\237]{\ENQ3w\196\186",PropRequestResponseInformation 28,PropMaximumPacketSize 1417,PropWillDelayInterval
// 10215,PropMaximumPacketSize 8387,PropAssignedClientIdentifier "\162\&5",PropRequestResponseInformation
// 158,PropMessageExpiryInterval 8655,PropMaximumQoS 49,PropServerKeepAlive 9880,PropRequestResponseInformation
// 70,PropSubscriptionIdentifier 15,PropAuthenticationData
// ",o\155\&0\139\252IS\234N,=\179\&1p\v\193\155\&2\230",PropWillDelayInterval 1640,PropTopicAlias
// 21613,PropMessageExpiryInterval 10411]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0x9a, 0x2,  0x3c, 0xdc, 0xe1, 0x1,  0x12, 0x0,  0x16, 0x4f, 0x2c, 0xa9, 0x65, 0x60, 0x76, 0xb6, 0x85, 0xc9,
      0x7b, 0xb1, 0x8d, 0x4c, 0xc0, 0x9d, 0x8e, 0x80, 0xf3, 0x91, 0x85, 0xa3, 0x8c, 0x19, 0xeb, 0xb,  0x17, 0x12, 0x0,
      0x14, 0x87, 0x8e, 0x8d, 0xde, 0x8d, 0x16, 0x5c, 0x32, 0x8b, 0x69, 0x30, 0x72, 0x3c, 0x28, 0xed, 0xa9, 0x46, 0xf9,
      0xdc, 0xe9, 0x21, 0x75, 0x25, 0x2,  0x0,  0x0,  0x70, 0x80, 0x16, 0x0,  0x2,  0xf3, 0x98, 0x2,  0x0,  0x0,  0x46,
      0x2e, 0x2a, 0x99, 0x8,  0x0,  0x1b, 0xb,  0x1c, 0x83, 0xa4, 0x4d, 0x6c, 0xe5, 0x7a, 0xcf, 0x1c, 0x19, 0x2c, 0xe3,
      0xfa, 0x4c, 0xa4, 0x48, 0x8,  0x30, 0xaa, 0xa2, 0x8,  0x36, 0x8b, 0xa7, 0xa9, 0xab, 0x1c, 0x0,  0xf,  0x85, 0xe0,
      0xe,  0x71, 0xad, 0xf4, 0xf,  0xb,  0x6,  0x77, 0x1,  0x7b, 0xe2, 0xa4, 0x7a, 0xb,  0xa,  0x26, 0x0,  0x7,  0xfd,
      0x9c, 0xd9, 0x8,  0xd0, 0x40, 0x92, 0x0,  0x4,  0x7,  0x59, 0x19, 0xea, 0x17, 0x94, 0x3,  0x0,  0x8,  0xed, 0x5d,
      0x7b, 0x5,  0x33, 0x77, 0xc4, 0xba, 0x19, 0x1c, 0x27, 0x0,  0x0,  0x5,  0x89, 0x18, 0x0,  0x0,  0x27, 0xe7, 0x27,
      0x0,  0x0,  0x20, 0xc3, 0x12, 0x0,  0x2,  0xa2, 0x35, 0x19, 0x9e, 0x2,  0x0,  0x0,  0x21, 0xcf, 0x24, 0x31, 0x13,
      0x26, 0x98, 0x19, 0x46, 0xb,  0xf,  0x16, 0x0,  0x14, 0x2c, 0x6f, 0x9b, 0x30, 0x8b, 0xfc, 0x49, 0x53, 0xea, 0x4e,
      0x2c, 0x3d, 0xb3, 0x31, 0x70, 0xb,  0xc1, 0x9b, 0x32, 0xe6, 0x18, 0x0,  0x0,  0x6,  0x68, 0x23, 0x54, 0x6d, 0x2,
      0x0,  0x0,  0x28, 0xab, 0x0,  0x1a, 0x91, 0xb7, 0x6d, 0xe8, 0xd9, 0xbc, 0xcc, 0x5f, 0xdf, 0xf9, 0xa1, 0xaa, 0x9c,
      0x85, 0x54, 0xea, 0xe9, 0x9f, 0xeb, 0x32, 0x48, 0xaf, 0x4a, 0xd3, 0x95, 0x6a, 0x8,  0x0,  0x2,  0x5d, 0x97, 0x1e,
      0x0,  0x10, 0xee, 0xf4, 0x45, 0x8d, 0xa8, 0xcb, 0xe4, 0x73, 0x3f, 0xbe, 0xe8, 0x4a, 0x8b, 0xb6, 0x4e, 0x9d, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x91, 0xb7, 0x6d, 0xe8, 0xd9, 0xbc, 0xcc, 0x5f, 0xdf, 0xf9, 0xa1, 0xaa, 0x9c,
                                     0x85, 0x54, 0xea, 0xe9, 0x9f, 0xeb, 0x32, 0x48, 0xaf, 0x4a, 0xd3, 0x95, 0x6a};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5d, 0x97};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xee, 0xf4, 0x45, 0x8d, 0xa8, 0xcb, 0xe4, 0x73,
                                     0x3f, 0xbe, 0xe8, 0x4a, 0x8b, 0xb6, 0x4e, 0x9d};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0x4f, 0x2c, 0xa9, 0x65, 0x60, 0x76, 0xb6, 0x85, 0xc9, 0x7b, 0xb1,
                           0x8d, 0x4c, 0xc0, 0x9d, 0x8e, 0x80, 0xf3, 0x91, 0x85, 0xa3, 0x8c};
  uint8_t bytesprops1[] = {0x87, 0x8e, 0x8d, 0xde, 0x8d, 0x16, 0x5c, 0x32, 0x8b, 0x69,
                           0x30, 0x72, 0x3c, 0x28, 0xed, 0xa9, 0x46, 0xf9, 0xdc, 0xe9};
  uint8_t bytesprops2[] = {0xf3, 0x98};
  uint8_t bytesprops3[] = {0xb,  0x1c, 0x83, 0xa4, 0x4d, 0x6c, 0xe5, 0x7a, 0xcf, 0x1c, 0x19, 0x2c, 0xe3, 0xfa,
                           0x4c, 0xa4, 0x48, 0x8,  0x30, 0xaa, 0xa2, 0x8,  0x36, 0x8b, 0xa7, 0xa9, 0xab};
  uint8_t bytesprops4[] = {0x85, 0xe0, 0xe, 0x71, 0xad, 0xf4, 0xf, 0xb, 0x6, 0x77, 0x1, 0x7b, 0xe2, 0xa4, 0x7a};
  uint8_t bytesprops6[] = {0x7, 0x59, 0x19, 0xea};
  uint8_t bytesprops5[] = {0xfd, 0x9c, 0xd9, 0x8, 0xd0, 0x40, 0x92};
  uint8_t bytesprops7[] = {0xed, 0x5d, 0x7b, 0x5, 0x33, 0x77, 0xc4, 0xba};
  uint8_t bytesprops8[] = {0xa2, 0x35};
  uint8_t bytesprops9[] = {0x2c, 0x6f, 0x9b, 0x30, 0x8b, 0xfc, 0x49, 0x53, 0xea, 0x4e,
                           0x2c, 0x3d, 0xb3, 0x31, 0x70, 0xb,  0xc1, 0x9b, 0x32, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29989}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28800}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17966}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops5}, .v = {4, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1417}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10215}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8387}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8655}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9880}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1640}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21613}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10411}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15580, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10667 [("I\153\NUL\206\134\163T\222V`b\232I\232\254u\213}=\145\234\200$\183#\148\179",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("T\SYN\184.5\131\&8r'\221\184\170AuL",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1}),("\194\SUB\SYN\139\NUL\NUL\233\RS\226\177\SUB\183\128",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\135\196\232\200\SOHm\GS\194\235\n|\SOH\251\ETB\f7\137\FS\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\225\240\SOH \SUB",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),(":1R\165-\228F\219>\136\EOT?\198\224\DC2\129Z\215\250V\188\192\150\220\CAN\185\202\208^",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("A\140\&8\DC4?\EMv\CAN\214\t\FS'\255\208n\209\218\188\140\229o@",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("6\141\148A\161M\182\EM\129\DC4R",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS2}),("W'\224\128}N\177m\137c.\r!",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\159\&6B~\216U\149-\240\230\194\218\157\166\NAK",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("1\161\160\GS\211\175d\178\213\SOHv\135\171%\155B/\222\FS9(\185g\173\174x_I\224)",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropTopicAlias
// 14265,PropAuthenticationData
// "\234\176J\177M{\135\SUB\163~\SUB\158\235\158\179\DEL\173\DC2\191\143\234\aU\214/\134X\t",PropSharedSubscriptionAvailable
// 90,PropMaximumQoS 85,PropRequestProblemInformation 140,PropContentType
// "lJ\161\ETX\FS\175\&1\184\227\140",PropReasonString
// "o\f\162\GS\235H\DEL\195\n\179\133\185\DC3\130\ENQ\158\219z]",PropWillDelayInterval 10700,PropReceiveMaximum 9910]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xbe, 0x2,  0x29, 0xab, 0x53, 0x23, 0x37, 0xb9, 0x16, 0x0,  0x1c, 0xea, 0xb0, 0x4a, 0xb1, 0x4d, 0x7b, 0x87,
      0x1a, 0xa3, 0x7e, 0x1a, 0x9e, 0xeb, 0x9e, 0xb3, 0x7f, 0xad, 0x12, 0xbf, 0x8f, 0xea, 0x7,  0x55, 0xd6, 0x2f, 0x86,
      0x58, 0x9,  0x2a, 0x5a, 0x24, 0x55, 0x17, 0x8c, 0x3,  0x0,  0xa,  0x6c, 0x4a, 0xa1, 0x3,  0x1c, 0xaf, 0x31, 0xb8,
      0xe3, 0x8c, 0x1f, 0x0,  0x13, 0x6f, 0xc,  0xa2, 0x1d, 0xeb, 0x48, 0x7f, 0xc3, 0xa,  0xb3, 0x85, 0xb9, 0x13, 0x82,
      0x5,  0x9e, 0xdb, 0x7a, 0x5d, 0x18, 0x0,  0x0,  0x29, 0xcc, 0x21, 0x26, 0xb6, 0x0,  0x1b, 0x49, 0x99, 0x0,  0xce,
      0x86, 0xa3, 0x54, 0xde, 0x56, 0x60, 0x62, 0xe8, 0x49, 0xe8, 0xfe, 0x75, 0xd5, 0x7d, 0x3d, 0x91, 0xea, 0xc8, 0x24,
      0xb7, 0x23, 0x94, 0xb3, 0x25, 0x0,  0xf,  0x54, 0x16, 0xb8, 0x2e, 0x35, 0x83, 0x38, 0x72, 0x27, 0xdd, 0xb8, 0xaa,
      0x41, 0x75, 0x4c, 0x5,  0x0,  0xd,  0xc2, 0x1a, 0x16, 0x8b, 0x0,  0x0,  0xe9, 0x1e, 0xe2, 0xb1, 0x1a, 0xb7, 0x80,
      0x2c, 0x0,  0x13, 0x87, 0xc4, 0xe8, 0xc8, 0x1,  0x6d, 0x1d, 0xc2, 0xeb, 0xa,  0x7c, 0x1,  0xfb, 0x17, 0xc,  0x37,
      0x89, 0x1c, 0xd3, 0xe,  0x0,  0x5,  0xe1, 0xf0, 0x1,  0x20, 0x1a, 0x18, 0x0,  0x1d, 0x3a, 0x31, 0x52, 0xa5, 0x2d,
      0xe4, 0x46, 0xdb, 0x3e, 0x88, 0x4,  0x3f, 0xc6, 0xe0, 0x12, 0x81, 0x5a, 0xd7, 0xfa, 0x56, 0xbc, 0xc0, 0x96, 0xdc,
      0x18, 0xb9, 0xca, 0xd0, 0x5e, 0x1e, 0x0,  0x16, 0x41, 0x8c, 0x38, 0x14, 0x3f, 0x19, 0x76, 0x18, 0xd6, 0x9,  0x1c,
      0x27, 0xff, 0xd0, 0x6e, 0xd1, 0xda, 0xbc, 0x8c, 0xe5, 0x6f, 0x40, 0x1d, 0x0,  0xb,  0x36, 0x8d, 0x94, 0x41, 0xa1,
      0x4d, 0xb6, 0x19, 0x81, 0x14, 0x52, 0x2a, 0x0,  0xd,  0x57, 0x27, 0xe0, 0x80, 0x7d, 0x4e, 0xb1, 0x6d, 0x89, 0x63,
      0x2e, 0xd,  0x21, 0x10, 0x0,  0xf,  0x9f, 0x36, 0x42, 0x7e, 0xd8, 0x55, 0x95, 0x2d, 0xf0, 0xe6, 0xc2, 0xda, 0x9d,
      0xa6, 0x15, 0x2c, 0x0,  0x1e, 0x31, 0xa1, 0xa0, 0x1d, 0xd3, 0xaf, 0x64, 0xb2, 0xd5, 0x1,  0x76, 0x87, 0xab, 0x25,
      0x9b, 0x42, 0x2f, 0xde, 0x1c, 0x39, 0x28, 0xb9, 0x67, 0xad, 0xae, 0x78, 0x5f, 0x49, 0xe0, 0x29, 0x1a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0x99, 0x0,  0xce, 0x86, 0xa3, 0x54, 0xde, 0x56, 0x60, 0x62, 0xe8, 0x49, 0xe8,
                                     0xfe, 0x75, 0xd5, 0x7d, 0x3d, 0x91, 0xea, 0xc8, 0x24, 0xb7, 0x23, 0x94, 0xb3};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0x16, 0xb8, 0x2e, 0x35, 0x83, 0x38, 0x72,
                                     0x27, 0xdd, 0xb8, 0xaa, 0x41, 0x75, 0x4c};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc2, 0x1a, 0x16, 0x8b, 0x0, 0x0, 0xe9, 0x1e, 0xe2, 0xb1, 0x1a, 0xb7, 0x80};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x87, 0xc4, 0xe8, 0xc8, 0x1, 0x6d, 0x1d, 0xc2, 0xeb, 0xa,
                                     0x7c, 0x1,  0xfb, 0x17, 0xc, 0x37, 0x89, 0x1c, 0xd3};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe1, 0xf0, 0x1, 0x20, 0x1a};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3a, 0x31, 0x52, 0xa5, 0x2d, 0xe4, 0x46, 0xdb, 0x3e, 0x88,
                                     0x4,  0x3f, 0xc6, 0xe0, 0x12, 0x81, 0x5a, 0xd7, 0xfa, 0x56,
                                     0xbc, 0xc0, 0x96, 0xdc, 0x18, 0xb9, 0xca, 0xd0, 0x5e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x8c, 0x38, 0x14, 0x3f, 0x19, 0x76, 0x18, 0xd6, 0x9,  0x1c,
                                     0x27, 0xff, 0xd0, 0x6e, 0xd1, 0xda, 0xbc, 0x8c, 0xe5, 0x6f, 0x40};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x36, 0x8d, 0x94, 0x41, 0xa1, 0x4d, 0xb6, 0x19, 0x81, 0x14, 0x52};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x57, 0x27, 0xe0, 0x80, 0x7d, 0x4e, 0xb1, 0x6d, 0x89, 0x63, 0x2e, 0xd, 0x21};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x9f, 0x36, 0x42, 0x7e, 0xd8, 0x55, 0x95, 0x2d,
                                     0xf0, 0xe6, 0xc2, 0xda, 0x9d, 0xa6, 0x15};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x31, 0xa1, 0xa0, 0x1d, 0xd3, 0xaf, 0x64, 0xb2, 0xd5, 0x1,
                                      0x76, 0x87, 0xab, 0x25, 0x9b, 0x42, 0x2f, 0xde, 0x1c, 0x39,
                                      0x28, 0xb9, 0x67, 0xad, 0xae, 0x78, 0x5f, 0x49, 0xe0, 0x29};
  lwmqtt_string_t topic_filter_s10 = {30, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0xea, 0xb0, 0x4a, 0xb1, 0x4d, 0x7b, 0x87, 0x1a, 0xa3, 0x7e, 0x1a, 0x9e, 0xeb, 0x9e,
                           0xb3, 0x7f, 0xad, 0x12, 0xbf, 0x8f, 0xea, 0x7,  0x55, 0xd6, 0x2f, 0x86, 0x58, 0x9};
  uint8_t bytesprops1[] = {0x6c, 0x4a, 0xa1, 0x3, 0x1c, 0xaf, 0x31, 0xb8, 0xe3, 0x8c};
  uint8_t bytesprops2[] = {0x6f, 0xc,  0xa2, 0x1d, 0xeb, 0x48, 0x7f, 0xc3, 0xa, 0xb3,
                           0x85, 0xb9, 0x13, 0x82, 0x5,  0x9e, 0xdb, 0x7a, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14265}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10700}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9910}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10667, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13196 [("\171M\DLE+(\172\SIL\DEL",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\182H\165\138\247\bHO\207\164\ACKr\239\151\ENQ\137\190k\182\&4",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\231~\137\219\155\189\239N\199\208$X\206\145\176Q0\SIv\145\ETX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\135\&4Dk@\b\247\150\217%:t\198f\195\&4",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS =
// QoS2}),("\186,\216\227\251\233`o\219\177\179\DC4\ETB\226\180\143\194\CAN\202\140\&1Y\213\a\ACKq\165^",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropReceiveMaximum 2979,PropReceiveMaximum 20597,PropTopicAliasMaximum 24577,PropSharedSubscriptionAvailable
// 21,PropAssignedClientIdentifier "\232\145\174\232\140r\209\DC4H\STX\219\132\229\208",PropUserProperty "\167\&0"
// "\222\SOH[P\215\215]}'\238\223"]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x9e, 0x1,  0x33, 0x8c, 0x2e, 0x21, 0xb,  0xa3, 0x21, 0x50, 0x75, 0x22, 0x60, 0x1,  0x2a, 0x15,
                   0x12, 0x0,  0xe,  0xe8, 0x91, 0xae, 0xe8, 0x8c, 0x72, 0xd1, 0x14, 0x48, 0x2,  0xdb, 0x84, 0xe5, 0xd0,
                   0x26, 0x0,  0x2,  0xa7, 0x30, 0x0,  0xb,  0xde, 0x1,  0x5b, 0x50, 0xd7, 0xd7, 0x5d, 0x7d, 0x27, 0xee,
                   0xdf, 0x0,  0x9,  0xab, 0x4d, 0x10, 0x2b, 0x28, 0xac, 0xf,  0x4c, 0x7f, 0x2a, 0x0,  0x14, 0xb6, 0x48,
                   0xa5, 0x8a, 0xf7, 0x8,  0x48, 0x4f, 0xcf, 0xa4, 0x6,  0x72, 0xef, 0x97, 0x5,  0x89, 0xbe, 0x6b, 0xb6,
                   0x34, 0x1a, 0x0,  0x15, 0xe7, 0x7e, 0x89, 0xdb, 0x9b, 0xbd, 0xef, 0x4e, 0xc7, 0xd0, 0x24, 0x58, 0xce,
                   0x91, 0xb0, 0x51, 0x30, 0xf,  0x76, 0x91, 0x3,  0x2,  0x0,  0x10, 0x87, 0x34, 0x44, 0x6b, 0x40, 0x8,
                   0xf7, 0x96, 0xd9, 0x25, 0x3a, 0x74, 0xc6, 0x66, 0xc3, 0x34, 0xa,  0x0,  0x1c, 0xba, 0x2c, 0xd8, 0xe3,
                   0xfb, 0xe9, 0x60, 0x6f, 0xdb, 0xb1, 0xb3, 0x14, 0x17, 0xe2, 0xb4, 0x8f, 0xc2, 0x18, 0xca, 0x8c, 0x31,
                   0x59, 0xd5, 0x7,  0x6,  0x71, 0xa5, 0x5e, 0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x4d, 0x10, 0x2b, 0x28, 0xac, 0xf, 0x4c, 0x7f};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0x48, 0xa5, 0x8a, 0xf7, 0x8,  0x48, 0x4f, 0xcf, 0xa4,
                                     0x6,  0x72, 0xef, 0x97, 0x5,  0x89, 0xbe, 0x6b, 0xb6, 0x34};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe7, 0x7e, 0x89, 0xdb, 0x9b, 0xbd, 0xef, 0x4e, 0xc7, 0xd0, 0x24,
                                     0x58, 0xce, 0x91, 0xb0, 0x51, 0x30, 0xf,  0x76, 0x91, 0x3};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x87, 0x34, 0x44, 0x6b, 0x40, 0x8,  0xf7, 0x96,
                                     0xd9, 0x25, 0x3a, 0x74, 0xc6, 0x66, 0xc3, 0x34};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xba, 0x2c, 0xd8, 0xe3, 0xfb, 0xe9, 0x60, 0x6f, 0xdb, 0xb1,
                                     0xb3, 0x14, 0x17, 0xe2, 0xb4, 0x8f, 0xc2, 0x18, 0xca, 0x8c,
                                     0x31, 0x59, 0xd5, 0x7,  0x6,  0x71, 0xa5, 0x5e};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  uint8_t bytesprops0[] = {0xe8, 0x91, 0xae, 0xe8, 0x8c, 0x72, 0xd1, 0x14, 0x48, 0x2, 0xdb, 0x84, 0xe5, 0xd0};
  uint8_t bytesprops2[] = {0xde, 0x1, 0x5b, 0x50, 0xd7, 0xd7, 0x5d, 0x7d, 0x27, 0xee, 0xdf};
  uint8_t bytesprops1[] = {0xa7, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2979}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20597}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24577}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13196, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11145 [("\237\a\171\195\220\245\232@\229P\146~C\193\193\139\138\EOTF\139\ACK\135\ETX\253",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})]
// [PropMessageExpiryInterval 3734,PropMaximumPacketSize 5015]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x28, 0x2b, 0x89, 0xa,  0x2,  0x0,  0x0,  0xe,  0x96, 0x27, 0x0,  0x0,  0x13,
                   0x97, 0x0,  0x18, 0xed, 0x7,  0xab, 0xc3, 0xdc, 0xf5, 0xe8, 0x40, 0xe5, 0x50, 0x92,
                   0x7e, 0x43, 0xc1, 0xc1, 0x8b, 0x8a, 0x4,  0x46, 0x8b, 0x6,  0x87, 0x3,  0xfd, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x7,  0xab, 0xc3, 0xdc, 0xf5, 0xe8, 0x40, 0xe5, 0x50, 0x92, 0x7e,
                                     0x43, 0xc1, 0xc1, 0x8b, 0x8a, 0x4,  0x46, 0x8b, 0x6,  0x87, 0x3,  0xfd};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3734}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5015}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11145, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22549
// [("q&N\176\217\FS\143\140\217\b\164\171\163\233\237\200\214\223\156\197\201\182e\DC3q",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\251N<\255g\164",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\236\US\180\241\219\242\200\196\229J\244\135\&7]\225L\136\132\213\128\&8\252\234\US\157\230k\NAK}g",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\157FH\237\157\&9\207X2\190\240\162\239\164",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropSharedSubscriptionAvailable
// 37,PropSharedSubscriptionAvailable 153,PropSessionExpiryInterval 29426,PropMessageExpiryInterval
// 23723,PropMessageExpiryInterval 8643,PropSessionExpiryInterval 10393,PropPayloadFormatIndicator 48,PropResponseTopic
// "t\227\219\204E\144=*n\DEL",PropReasonString
// "\219\209\ETB\SOH\GS\161\150\221\175\DC3\213\199\131\DEL\235\190_vaZ\218\128\155\209\&9\137",PropResponseInformation
// "\155\136\CAN ^\222\SUBH\187\128\n\150\238_\192",PropRequestResponseInformation 164,PropServerKeepAlive
// 1216,PropSubscriptionIdentifier 23,PropServerKeepAlive 24368,PropSessionExpiryInterval 2690,PropSessionExpiryInterval
// 28694,PropMessageExpiryInterval 21697,PropRetainAvailable 56,PropMessageExpiryInterval 31144,PropAuthenticationMethod
// "",PropReceiveMaximum 10744,PropTopicAlias 16979,PropReasonString
// "\253\vH\234\142\163o\193\150\192\158\157\241\221\200",PropTopicAlias 11000]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x82, 0xef, 0x1,  0x58, 0x15, 0x94, 0x1,  0x2a, 0x25, 0x2a, 0x99, 0x11, 0x0,  0x0,  0x72, 0xf2, 0x2,  0x0,  0x0,
      0x5c, 0xab, 0x2,  0x0,  0x0,  0x21, 0xc3, 0x11, 0x0,  0x0,  0x28, 0x99, 0x1,  0x30, 0x8,  0x0,  0xa,  0x74, 0xe3,
      0xdb, 0xcc, 0x45, 0x90, 0x3d, 0x2a, 0x6e, 0x7f, 0x1f, 0x0,  0x1a, 0xdb, 0xd1, 0x17, 0x1,  0x1d, 0xa1, 0x96, 0xdd,
      0xaf, 0x13, 0xd5, 0xc7, 0x83, 0x7f, 0xeb, 0xbe, 0x5f, 0x76, 0x61, 0x5a, 0xda, 0x80, 0x9b, 0xd1, 0x39, 0x89, 0x1a,
      0x0,  0xf,  0x9b, 0x88, 0x18, 0x20, 0x5e, 0xde, 0x1a, 0x48, 0xbb, 0x80, 0xa,  0x96, 0xee, 0x5f, 0xc0, 0x19, 0xa4,
      0x13, 0x4,  0xc0, 0xb,  0x17, 0x13, 0x5f, 0x30, 0x11, 0x0,  0x0,  0xa,  0x82, 0x11, 0x0,  0x0,  0x70, 0x16, 0x2,
      0x0,  0x0,  0x54, 0xc1, 0x25, 0x38, 0x2,  0x0,  0x0,  0x79, 0xa8, 0x15, 0x0,  0x0,  0x21, 0x29, 0xf8, 0x23, 0x42,
      0x53, 0x1f, 0x0,  0xf,  0xfd, 0xb,  0x48, 0xea, 0x8e, 0xa3, 0x6f, 0xc1, 0x96, 0xc0, 0x9e, 0x9d, 0xf1, 0xdd, 0xc8,
      0x23, 0x2a, 0xf8, 0x0,  0x19, 0x71, 0x26, 0x4e, 0xb0, 0xd9, 0x1c, 0x8f, 0x8c, 0xd9, 0x8,  0xa4, 0xab, 0xa3, 0xe9,
      0xed, 0xc8, 0xd6, 0xdf, 0x9c, 0xc5, 0xc9, 0xb6, 0x65, 0x13, 0x71, 0x2c, 0x0,  0x6,  0xfb, 0x4e, 0x3c, 0xff, 0x67,
      0xa4, 0x29, 0x0,  0x1e, 0xec, 0x1f, 0xb4, 0xf1, 0xdb, 0xf2, 0xc8, 0xc4, 0xe5, 0x4a, 0xf4, 0x87, 0x37, 0x5d, 0xe1,
      0x4c, 0x88, 0x84, 0xd5, 0x80, 0x38, 0xfc, 0xea, 0x1f, 0x9d, 0xe6, 0x6b, 0x15, 0x7d, 0x67, 0x1a, 0x0,  0xe,  0x9d,
      0x46, 0x48, 0xed, 0x9d, 0x39, 0xcf, 0x58, 0x32, 0xbe, 0xf0, 0xa2, 0xef, 0xa4, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0x26, 0x4e, 0xb0, 0xd9, 0x1c, 0x8f, 0x8c, 0xd9, 0x8,  0xa4, 0xab, 0xa3,
                                     0xe9, 0xed, 0xc8, 0xd6, 0xdf, 0x9c, 0xc5, 0xc9, 0xb6, 0x65, 0x13, 0x71};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfb, 0x4e, 0x3c, 0xff, 0x67, 0xa4};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x1f, 0xb4, 0xf1, 0xdb, 0xf2, 0xc8, 0xc4, 0xe5, 0x4a,
                                     0xf4, 0x87, 0x37, 0x5d, 0xe1, 0x4c, 0x88, 0x84, 0xd5, 0x80,
                                     0x38, 0xfc, 0xea, 0x1f, 0x9d, 0xe6, 0x6b, 0x15, 0x7d, 0x67};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9d, 0x46, 0x48, 0xed, 0x9d, 0x39, 0xcf,
                                     0x58, 0x32, 0xbe, 0xf0, 0xa2, 0xef, 0xa4};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x74, 0xe3, 0xdb, 0xcc, 0x45, 0x90, 0x3d, 0x2a, 0x6e, 0x7f};
  uint8_t bytesprops1[] = {0xdb, 0xd1, 0x17, 0x1,  0x1d, 0xa1, 0x96, 0xdd, 0xaf, 0x13, 0xd5, 0xc7, 0x83,
                           0x7f, 0xeb, 0xbe, 0x5f, 0x76, 0x61, 0x5a, 0xda, 0x80, 0x9b, 0xd1, 0x39, 0x89};
  uint8_t bytesprops2[] = {0x9b, 0x88, 0x18, 0x20, 0x5e, 0xde, 0x1a, 0x48, 0xbb, 0x80, 0xa, 0x96, 0xee, 0x5f, 0xc0};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xfd, 0xb, 0x48, 0xea, 0x8e, 0xa3, 0x6f, 0xc1, 0x96, 0xc0, 0x9e, 0x9d, 0xf1, 0xdd, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29426}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23723}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8643}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10393}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1216}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24368}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2690}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28694}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21697}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31144}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10744}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16979}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11000}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22549, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18393 [("{\US\242",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS0}),("\201=\vz\142\EOT\237}\162$\ETXL\232c\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247y\217\183\158j\243\153\130ub\232\193\210\DC4lt\EOTGRnv",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("8\140\&6\235T\162\129K\250\154E\163q\165\161\233\218\239\191\198%\208\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\167",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\138)\154\144@\221\174\188\n\143\197\159E6\191\149\251",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("Vi\140c:I\156\DEL\172\220A\GS9zg\167",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\193\198\250h\138\172\219di\163g\DC3\186`\129\162\202w\171\252",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropUserProperty
// "\DLE\254\218\246s\229\a\NAK\225k\164"
// "?\246\177\148'$\135\STX\161EI}\US\128\b\224\171e\213E\139YvT\216\204\&2",PropSubscriptionIdentifier
// 21,PropSubscriptionIdentifierAvailable 204,PropSharedSubscriptionAvailable 55,PropRequestProblemInformation
// 165,PropRequestProblemInformation 55,PropServerKeepAlive 19127,PropAuthenticationData
// "S\DELtZ%y\190^5\186\US\FS_",PropCorrelationData
// "D(\DC1\160\136\166\b\SYN{[\231t\133\181\128\183\160s\DEL\EOT\STX\200\167\206"]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0xf6, 0x1,  0x47, 0xd9, 0x63, 0x26, 0x0,  0xb,  0x10, 0xfe, 0xda, 0xf6, 0x73, 0xe5, 0x7,  0x15,
                   0xe1, 0x6b, 0xa4, 0x0,  0x1b, 0x3f, 0xf6, 0xb1, 0x94, 0x27, 0x24, 0x87, 0x2,  0xa1, 0x45, 0x49, 0x7d,
                   0x1f, 0x80, 0x8,  0xe0, 0xab, 0x65, 0xd5, 0x45, 0x8b, 0x59, 0x76, 0x54, 0xd8, 0xcc, 0x32, 0xb,  0x15,
                   0x29, 0xcc, 0x2a, 0x37, 0x17, 0xa5, 0x17, 0x37, 0x13, 0x4a, 0xb7, 0x16, 0x0,  0xd,  0x53, 0x7f, 0x74,
                   0x5a, 0x25, 0x79, 0xbe, 0x5e, 0x35, 0xba, 0x1f, 0x1c, 0x5f, 0x9,  0x0,  0x18, 0x44, 0x28, 0x11, 0xa0,
                   0x88, 0xa6, 0x8,  0x16, 0x7b, 0x5b, 0xe7, 0x74, 0x85, 0xb5, 0x80, 0xb7, 0xa0, 0x73, 0x7f, 0x4,  0x2,
                   0xc8, 0xa7, 0xce, 0x0,  0x3,  0x7b, 0x1f, 0xf2, 0x28, 0x0,  0xf,  0xc9, 0x3d, 0xb,  0x7a, 0x8e, 0x4,
                   0xed, 0x7d, 0xa2, 0x24, 0x3,  0x4c, 0xe8, 0x63, 0x1e, 0x2,  0x0,  0x16, 0xf7, 0x79, 0xd9, 0xb7, 0x9e,
                   0x6a, 0xf3, 0x99, 0x82, 0x75, 0x62, 0xe8, 0xc1, 0xd2, 0x14, 0x6c, 0x74, 0x4,  0x47, 0x52, 0x6e, 0x76,
                   0x29, 0x0,  0x17, 0x38, 0x8c, 0x36, 0xeb, 0x54, 0xa2, 0x81, 0x4b, 0xfa, 0x9a, 0x45, 0xa3, 0x71, 0xa5,
                   0xa1, 0xe9, 0xda, 0xef, 0xbf, 0xc6, 0x25, 0xd0, 0xde, 0xe,  0x0,  0x1,  0xa7, 0x20, 0x0,  0x0,  0x28,
                   0x0,  0x11, 0x8a, 0x29, 0x9a, 0x90, 0x40, 0xdd, 0xae, 0xbc, 0xa,  0x8f, 0xc5, 0x9f, 0x45, 0x36, 0xbf,
                   0x95, 0xfb, 0x18, 0x0,  0x10, 0x56, 0x69, 0x8c, 0x63, 0x3a, 0x49, 0x9c, 0x7f, 0xac, 0xdc, 0x41, 0x1d,
                   0x39, 0x7a, 0x67, 0xa7, 0x1,  0x0,  0x14, 0xc1, 0xc6, 0xfa, 0x68, 0x8a, 0xac, 0xdb, 0x64, 0x69, 0xa3,
                   0x67, 0x13, 0xba, 0x60, 0x81, 0xa2, 0xca, 0x77, 0xab, 0xfc, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x7b, 0x1f, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc9, 0x3d, 0xb, 0x7a, 0x8e, 0x4,  0xed, 0x7d,
                                     0xa2, 0x24, 0x3, 0x4c, 0xe8, 0x63, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf7, 0x79, 0xd9, 0xb7, 0x9e, 0x6a, 0xf3, 0x99, 0x82, 0x75, 0x62,
                                     0xe8, 0xc1, 0xd2, 0x14, 0x6c, 0x74, 0x4,  0x47, 0x52, 0x6e, 0x76};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x38, 0x8c, 0x36, 0xeb, 0x54, 0xa2, 0x81, 0x4b, 0xfa, 0x9a, 0x45, 0xa3,
                                     0x71, 0xa5, 0xa1, 0xe9, 0xda, 0xef, 0xbf, 0xc6, 0x25, 0xd0, 0xde};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s4 = {1, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8a, 0x29, 0x9a, 0x90, 0x40, 0xdd, 0xae, 0xbc, 0xa,
                                     0x8f, 0xc5, 0x9f, 0x45, 0x36, 0xbf, 0x95, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x56, 0x69, 0x8c, 0x63, 0x3a, 0x49, 0x9c, 0x7f,
                                     0xac, 0xdc, 0x41, 0x1d, 0x39, 0x7a, 0x67, 0xa7};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc1, 0xc6, 0xfa, 0x68, 0x8a, 0xac, 0xdb, 0x64, 0x69, 0xa3,
                                     0x67, 0x13, 0xba, 0x60, 0x81, 0xa2, 0xca, 0x77, 0xab, 0xfc};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  uint8_t bytesprops1[] = {0x3f, 0xf6, 0xb1, 0x94, 0x27, 0x24, 0x87, 0x2,  0xa1, 0x45, 0x49, 0x7d, 0x1f, 0x80,
                           0x8,  0xe0, 0xab, 0x65, 0xd5, 0x45, 0x8b, 0x59, 0x76, 0x54, 0xd8, 0xcc, 0x32};
  uint8_t bytesprops0[] = {0x10, 0xfe, 0xda, 0xf6, 0x73, 0xe5, 0x7, 0x15, 0xe1, 0x6b, 0xa4};
  uint8_t bytesprops2[] = {0x53, 0x7f, 0x74, 0x5a, 0x25, 0x79, 0xbe, 0x5e, 0x35, 0xba, 0x1f, 0x1c, 0x5f};
  uint8_t bytesprops3[] = {0x44, 0x28, 0x11, 0xa0, 0x88, 0xa6, 0x8,  0x16, 0x7b, 0x5b, 0xe7, 0x74,
                           0x85, 0xb5, 0x80, 0xb7, 0xa0, 0x73, 0x7f, 0x4,  0x2,  0xc8, 0xa7, 0xce};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {27, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19127}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18393, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28507 [("\146\199\232\fj\226d",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("*\213\134P\169\&0S\207\229-\255G\158",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\226\203\183\nO\231\151\nD\225\208!\169N\166\228\220#\DC2WU\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\251\t\179",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("~\144J\231\"6\CAN\145#\205z]\ETXUK\212\&7\145\EOT\176\252\SO",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("a&xM$\210\&9\179\194\SI\232\178-s\215;\DC3E\193\184\RS\SOH\177:S\170\ESC\167\158\220",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\243<g\211\198\"Qzu\184R\a_c\a\145(}%\SUBn1\DEL& .\228\165",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\241\132\161\156\244\141F\218\249\201\204\144\202\196\&9`\GS\165",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("q\153\236Z\130\171\216\197\231W\253\192\139w\159\140\236\ENQ\215~\174\170t\NUL\154\179{\GS\253",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("0^\RS\201\&4\228\214UU\a.\252\227V\\\SOH\198\n.\162\217\196",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("\167Y1\156C@\EOTw\191",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})]
// [PropTopicAliasMaximum 10480,PropWildcardSubscriptionAvailable 100,PropRequestProblemInformation
// 123,PropTopicAliasMaximum 13965,PropSessionExpiryInterval 14160,PropMaximumQoS 235]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0x80, 0x2,  0x6f, 0x5b, 0x11, 0x22, 0x28, 0xf0, 0x28, 0x64, 0x17, 0x7b, 0x22, 0x36, 0x8d, 0x11, 0x0,  0x0,
      0x37, 0x50, 0x24, 0xeb, 0x0,  0x7,  0x92, 0xc7, 0xe8, 0xc,  0x6a, 0xe2, 0x64, 0x2a, 0x0,  0xd,  0x2a, 0xd5, 0x86,
      0x50, 0xa9, 0x30, 0x53, 0xcf, 0xe5, 0x2d, 0xff, 0x47, 0x9e, 0x25, 0x0,  0x16, 0xe2, 0xcb, 0xb7, 0xa,  0x4f, 0xe7,
      0x97, 0xa,  0x44, 0xe1, 0xd0, 0x21, 0xa9, 0x4e, 0xa6, 0xe4, 0xdc, 0x23, 0x12, 0x57, 0x55, 0xf,  0x0,  0x0,  0x3,
      0xfb, 0x9,  0xb3, 0x1d, 0x0,  0x16, 0x7e, 0x90, 0x4a, 0xe7, 0x22, 0x36, 0x18, 0x91, 0x23, 0xcd, 0x7a, 0x5d, 0x3,
      0x55, 0x4b, 0xd4, 0x37, 0x91, 0x4,  0xb0, 0xfc, 0xe,  0x25, 0x0,  0x1e, 0x61, 0x26, 0x78, 0x4d, 0x24, 0xd2, 0x39,
      0xb3, 0xc2, 0xf,  0xe8, 0xb2, 0x2d, 0x73, 0xd7, 0x3b, 0x13, 0x45, 0xc1, 0xb8, 0x1e, 0x1,  0xb1, 0x3a, 0x53, 0xaa,
      0x1b, 0xa7, 0x9e, 0xdc, 0x18, 0x0,  0x1c, 0xf3, 0x3c, 0x67, 0xd3, 0xc6, 0x22, 0x51, 0x7a, 0x75, 0xb8, 0x52, 0x7,
      0x5f, 0x63, 0x7,  0x91, 0x28, 0x7d, 0x25, 0x1a, 0x6e, 0x31, 0x7f, 0x26, 0x20, 0x2e, 0xe4, 0xa5, 0x25, 0x0,  0x12,
      0xf1, 0x84, 0xa1, 0x9c, 0xf4, 0x8d, 0x46, 0xda, 0xf9, 0xc9, 0xcc, 0x90, 0xca, 0xc4, 0x39, 0x60, 0x1d, 0xa5, 0x1e,
      0x0,  0x1d, 0x71, 0x99, 0xec, 0x5a, 0x82, 0xab, 0xd8, 0xc5, 0xe7, 0x57, 0xfd, 0xc0, 0x8b, 0x77, 0x9f, 0x8c, 0xec,
      0x5,  0xd7, 0x7e, 0xae, 0xaa, 0x74, 0x0,  0x9a, 0xb3, 0x7b, 0x1d, 0xfd, 0x21, 0x0,  0x16, 0x30, 0x5e, 0x1e, 0xc9,
      0x34, 0xe4, 0xd6, 0x55, 0x55, 0x7,  0x2e, 0xfc, 0xe3, 0x56, 0x5c, 0x1,  0xc6, 0xa,  0x2e, 0xa2, 0xd9, 0xc4, 0x18,
      0x0,  0x9,  0xa7, 0x59, 0x31, 0x9c, 0x43, 0x40, 0x4,  0x77, 0xbf, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x92, 0xc7, 0xe8, 0xc, 0x6a, 0xe2, 0x64};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2a, 0xd5, 0x86, 0x50, 0xa9, 0x30, 0x53, 0xcf, 0xe5, 0x2d, 0xff, 0x47, 0x9e};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe2, 0xcb, 0xb7, 0xa,  0x4f, 0xe7, 0x97, 0xa,  0x44, 0xe1, 0xd0,
                                     0x21, 0xa9, 0x4e, 0xa6, 0xe4, 0xdc, 0x23, 0x12, 0x57, 0x55, 0xf};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfb, 0x9, 0xb3};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7e, 0x90, 0x4a, 0xe7, 0x22, 0x36, 0x18, 0x91, 0x23, 0xcd, 0x7a,
                                     0x5d, 0x3,  0x55, 0x4b, 0xd4, 0x37, 0x91, 0x4,  0xb0, 0xfc, 0xe};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x61, 0x26, 0x78, 0x4d, 0x24, 0xd2, 0x39, 0xb3, 0xc2, 0xf,
                                     0xe8, 0xb2, 0x2d, 0x73, 0xd7, 0x3b, 0x13, 0x45, 0xc1, 0xb8,
                                     0x1e, 0x1,  0xb1, 0x3a, 0x53, 0xaa, 0x1b, 0xa7, 0x9e, 0xdc};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf3, 0x3c, 0x67, 0xd3, 0xc6, 0x22, 0x51, 0x7a, 0x75, 0xb8,
                                     0x52, 0x7,  0x5f, 0x63, 0x7,  0x91, 0x28, 0x7d, 0x25, 0x1a,
                                     0x6e, 0x31, 0x7f, 0x26, 0x20, 0x2e, 0xe4, 0xa5};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf1, 0x84, 0xa1, 0x9c, 0xf4, 0x8d, 0x46, 0xda, 0xf9,
                                     0xc9, 0xcc, 0x90, 0xca, 0xc4, 0x39, 0x60, 0x1d, 0xa5};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x71, 0x99, 0xec, 0x5a, 0x82, 0xab, 0xd8, 0xc5, 0xe7, 0x57,
                                     0xfd, 0xc0, 0x8b, 0x77, 0x9f, 0x8c, 0xec, 0x5,  0xd7, 0x7e,
                                     0xae, 0xaa, 0x74, 0x0,  0x9a, 0xb3, 0x7b, 0x1d, 0xfd};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x30, 0x5e, 0x1e, 0xc9, 0x34, 0xe4, 0xd6, 0x55, 0x55, 0x7,  0x2e,
                                     0xfc, 0xe3, 0x56, 0x5c, 0x1,  0xc6, 0xa,  0x2e, 0xa2, 0xd9, 0xc4};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa7, 0x59, 0x31, 0x9c, 0x43, 0x40, 0x4, 0x77, 0xbf};
  lwmqtt_string_t topic_filter_s10 = {9, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10480}}, {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 123}},    {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13965}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14160}}, {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28507, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23094 [("\128\&6\225\129\221\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\163\250\137\240\239Q\202\n\217\167\232\STX\199\245m\147/\184\154\ESC\\-F\223\n\141\220\&1'\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\254\143\243T\251\204J",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\250\165\218\255^o\227\134\STXZ\172\209\130\n7F\146\SO\237~H",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\173\FS\206\233\172\r\198\\\142\185*\217L1\233v`",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropTopicAlias 3117,PropMaximumPacketSize 28793]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x6b, 0x5a, 0x36, 0x8,  0x23, 0xc,  0x2d, 0x27, 0x0,  0x0,  0x70, 0x79, 0x0,  0x6,  0x80,
                   0x36, 0xe1, 0x81, 0xdd, 0xaa, 0x0,  0x0,  0x1e, 0xa3, 0xfa, 0x89, 0xf0, 0xef, 0x51, 0xca, 0xa,
                   0xd9, 0xa7, 0xe8, 0x2,  0xc7, 0xf5, 0x6d, 0x93, 0x2f, 0xb8, 0x9a, 0x1b, 0x5c, 0x2d, 0x46, 0xdf,
                   0xa,  0x8d, 0xdc, 0x31, 0x27, 0xc4, 0x2,  0x0,  0x7,  0xfe, 0x8f, 0xf3, 0x54, 0xfb, 0xcc, 0x4a,
                   0x1c, 0x0,  0x15, 0xfa, 0xa5, 0xda, 0xff, 0x5e, 0x6f, 0xe3, 0x86, 0x2,  0x5a, 0xac, 0xd1, 0x82,
                   0xa,  0x37, 0x46, 0x92, 0xe,  0xed, 0x7e, 0x48, 0x10, 0x0,  0x11, 0xad, 0x1c, 0xce, 0xe9, 0xac,
                   0xd,  0xc6, 0x5c, 0x8e, 0xb9, 0x2a, 0xd9, 0x4c, 0x31, 0xe9, 0x76, 0x60, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0x36, 0xe1, 0x81, 0xdd, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa3, 0xfa, 0x89, 0xf0, 0xef, 0x51, 0xca, 0xa,  0xd9, 0xa7,
                                     0xe8, 0x2,  0xc7, 0xf5, 0x6d, 0x93, 0x2f, 0xb8, 0x9a, 0x1b,
                                     0x5c, 0x2d, 0x46, 0xdf, 0xa,  0x8d, 0xdc, 0x31, 0x27, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfe, 0x8f, 0xf3, 0x54, 0xfb, 0xcc, 0x4a};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfa, 0xa5, 0xda, 0xff, 0x5e, 0x6f, 0xe3, 0x86, 0x2,  0x5a, 0xac,
                                     0xd1, 0x82, 0xa,  0x37, 0x46, 0x92, 0xe,  0xed, 0x7e, 0x48};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xad, 0x1c, 0xce, 0xe9, 0xac, 0xd,  0xc6, 0x5c, 0x8e,
                                     0xb9, 0x2a, 0xd9, 0x4c, 0x31, 0xe9, 0x76, 0x60};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3117}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28793}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23094, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7726 [("\143]\132\&9x\254\"\152\138W\190\240~<U\178\182iJq\228\135N\NUL\156m\185\232\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\195\205\236\USx%\189\181\215b\178\160\164u\241*\226\141V=9t\228(\228",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("n\SOG\164\166!\CAN\241\CANL\166\170AT\220\186\136\194\163\223\209\233;",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\142\DLEG\CANDX8\GSp\223\137\248Wb5\RS\157\214\142\SYN\177K\ENQr\NUL",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\212r\ENQ\223Vje;r\193\137AS6\239\&1\167~\192\&2\174q\243",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("+\DLE.\136\EOT\139\175\183\191\181",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170Fn\158",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS2}),("\233/\176\br$c\158\v\232",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("h-\196\177\189\250J\CANE\236\154\218\131\142\183\ACK\247\154\169#\207c",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("T\231\n\r,03!\135\DC2\225lU?\SI\132\208\254\164\159\177\195\t\132\220j?",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\164\238\144r\220E\CANQ\216\130\171\SYN)D\160\179U",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropServerKeepAlive 10066,PropMaximumQoS
// 119,PropSessionExpiryInterval 12417,PropAuthenticationMethod
// "\186\244\151\226\na\139\155\239\133t\NAKg\RS$\238\SO",PropWildcardSubscriptionAvailable 179,PropTopicAliasMaximum
// 21147]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x9e, 0x2,  0x1e, 0x2e, 0x23, 0x13, 0x27, 0x52, 0x24, 0x77, 0x11, 0x0,  0x0,  0x30, 0x81, 0x15,
                   0x0,  0x11, 0xba, 0xf4, 0x97, 0xe2, 0xa,  0x61, 0x8b, 0x9b, 0xef, 0x85, 0x74, 0x15, 0x67, 0x1e, 0x24,
                   0xee, 0xe,  0x28, 0xb3, 0x22, 0x52, 0x9b, 0x0,  0x1d, 0x8f, 0x5d, 0x84, 0x39, 0x78, 0xfe, 0x22, 0x98,
                   0x8a, 0x57, 0xbe, 0xf0, 0x7e, 0x3c, 0x55, 0xb2, 0xb6, 0x69, 0x4a, 0x71, 0xe4, 0x87, 0x4e, 0x0,  0x9c,
                   0x6d, 0xb9, 0xe8, 0xfe, 0x6,  0x0,  0x19, 0xc3, 0xcd, 0xec, 0x1f, 0x78, 0x25, 0xbd, 0xb5, 0xd7, 0x62,
                   0xb2, 0xa0, 0xa4, 0x75, 0xf1, 0x2a, 0xe2, 0x8d, 0x56, 0x3d, 0x39, 0x74, 0xe4, 0x28, 0xe4, 0x15, 0x0,
                   0x17, 0x6e, 0xe,  0x47, 0xa4, 0xa6, 0x21, 0x18, 0xf1, 0x18, 0x4c, 0xa6, 0xaa, 0x41, 0x54, 0xdc, 0xba,
                   0x88, 0xc2, 0xa3, 0xdf, 0xd1, 0xe9, 0x3b, 0x2e, 0x0,  0x19, 0x8e, 0x10, 0x47, 0x18, 0x44, 0x58, 0x38,
                   0x1d, 0x70, 0xdf, 0x89, 0xf8, 0x57, 0x62, 0x35, 0x1e, 0x9d, 0xd6, 0x8e, 0x16, 0xb1, 0x4b, 0x5,  0x72,
                   0x0,  0x9,  0x0,  0x17, 0xd4, 0x72, 0x5,  0xdf, 0x56, 0x6a, 0x65, 0x3b, 0x72, 0xc1, 0x89, 0x41, 0x53,
                   0x36, 0xef, 0x31, 0xa7, 0x7e, 0xc0, 0x32, 0xae, 0x71, 0xf3, 0x4,  0x0,  0xa,  0x2b, 0x10, 0x2e, 0x88,
                   0x4,  0x8b, 0xaf, 0xb7, 0xbf, 0xb5, 0x0,  0x0,  0x4,  0xaa, 0x46, 0x6e, 0x9e, 0x2e, 0x0,  0xa,  0xe9,
                   0x2f, 0xb0, 0x8,  0x72, 0x24, 0x63, 0x9e, 0xb,  0xe8, 0x22, 0x0,  0x16, 0x68, 0x2d, 0xc4, 0xb1, 0xbd,
                   0xfa, 0x4a, 0x18, 0x45, 0xec, 0x9a, 0xda, 0x83, 0x8e, 0xb7, 0x6,  0xf7, 0x9a, 0xa9, 0x23, 0xcf, 0x63,
                   0x18, 0x0,  0x1b, 0x54, 0xe7, 0xa,  0xd,  0x2c, 0x30, 0x33, 0x21, 0x87, 0x12, 0xe1, 0x6c, 0x55, 0x3f,
                   0xf,  0x84, 0xd0, 0xfe, 0xa4, 0x9f, 0xb1, 0xc3, 0x9,  0x84, 0xdc, 0x6a, 0x3f, 0x14, 0x0,  0x11, 0xa4,
                   0xee, 0x90, 0x72, 0xdc, 0x45, 0x18, 0x51, 0xd8, 0x82, 0xab, 0x16, 0x29, 0x44, 0xa0, 0xb3, 0x55, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x8f, 0x5d, 0x84, 0x39, 0x78, 0xfe, 0x22, 0x98, 0x8a, 0x57,
                                     0xbe, 0xf0, 0x7e, 0x3c, 0x55, 0xb2, 0xb6, 0x69, 0x4a, 0x71,
                                     0xe4, 0x87, 0x4e, 0x0,  0x9c, 0x6d, 0xb9, 0xe8, 0xfe};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0xcd, 0xec, 0x1f, 0x78, 0x25, 0xbd, 0xb5, 0xd7, 0x62, 0xb2, 0xa0, 0xa4,
                                     0x75, 0xf1, 0x2a, 0xe2, 0x8d, 0x56, 0x3d, 0x39, 0x74, 0xe4, 0x28, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6e, 0xe,  0x47, 0xa4, 0xa6, 0x21, 0x18, 0xf1, 0x18, 0x4c, 0xa6, 0xaa,
                                     0x41, 0x54, 0xdc, 0xba, 0x88, 0xc2, 0xa3, 0xdf, 0xd1, 0xe9, 0x3b};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8e, 0x10, 0x47, 0x18, 0x44, 0x58, 0x38, 0x1d, 0x70, 0xdf, 0x89, 0xf8, 0x57,
                                     0x62, 0x35, 0x1e, 0x9d, 0xd6, 0x8e, 0x16, 0xb1, 0x4b, 0x5,  0x72, 0x0};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0x72, 0x5,  0xdf, 0x56, 0x6a, 0x65, 0x3b, 0x72, 0xc1, 0x89, 0x41,
                                     0x53, 0x36, 0xef, 0x31, 0xa7, 0x7e, 0xc0, 0x32, 0xae, 0x71, 0xf3};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2b, 0x10, 0x2e, 0x88, 0x4, 0x8b, 0xaf, 0xb7, 0xbf, 0xb5};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0x46, 0x6e, 0x9e};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe9, 0x2f, 0xb0, 0x8, 0x72, 0x24, 0x63, 0x9e, 0xb, 0xe8};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x68, 0x2d, 0xc4, 0xb1, 0xbd, 0xfa, 0x4a, 0x18, 0x45, 0xec, 0x9a,
                                     0xda, 0x83, 0x8e, 0xb7, 0x6,  0xf7, 0x9a, 0xa9, 0x23, 0xcf, 0x63};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x54, 0xe7, 0xa,  0xd,  0x2c, 0x30, 0x33, 0x21, 0x87, 0x12, 0xe1, 0x6c, 0x55, 0x3f,
                                     0xf,  0x84, 0xd0, 0xfe, 0xa4, 0x9f, 0xb1, 0xc3, 0x9,  0x84, 0xdc, 0x6a, 0x3f};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xa4, 0xee, 0x90, 0x72, 0xdc, 0x45, 0x18, 0x51, 0xd8,
                                      0x82, 0xab, 0x16, 0x29, 0x44, 0xa0, 0xb3, 0x55};
  lwmqtt_string_t topic_filter_s10 = {17, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0xba, 0xf4, 0x97, 0xe2, 0xa,  0x61, 0x8b, 0x9b, 0xef,
                           0x85, 0x74, 0x15, 0x67, 0x1e, 0x24, 0xee, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10066}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12417}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21147}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7726, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1195 [("\ETX\191\156\US3\137\&5\190a",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\165\NAK\196P
// \236\172\197M\140\177r\SUB\159",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal
// = True, _subQoS = QoS0}),("\RS\207\192\216\168",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS =
// QoS0}),("3\221i\DC1\162\226\214EnW\250\156\230\182;V\195\230d\NUL\174<\173J\139\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\250u\151\159P'\139\EM\157U\250+\NAKH\146+V\202Rz",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\199USx\174ia\GSz\ACK\DC2\\)\192\SOHC\142`/|\206J`DO",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\234\194\129~z9_E\fvk\232\168i1})/\136RT\141\170\184:\210@\227I",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("D\169\215/0R\DEL\201>\234\155>\147W\SOv%\NAK\US\230l",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\155\"\219\&9`\138\145\182\&3\178\147\226G\a[h\191`\212`\185\143",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("a]\205\220o\197]\139qT\177$?P\151\158\141=\231\157\249k\231H\159\163.",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropCorrelationData
// "\173\161\DC1\166\244Z\167\&1\139Po\237\170\193\138=\244\187",PropWillDelayInterval 12750,PropSubscriptionIdentifier
// 6,PropReasonString "*\162\180\&3\182\222\210\250Y\189\&5m\253\172",PropRequestResponseInformation 6,PropResponseTopic
// "\DEL\204\228\143\203K\254B4\181\NULA\DELRe\245\223\183\237%x0*\240*c",PropWillDelayInterval 1053,PropServerReference
// "h\ETXm`\226\164\&3\178qd{\154\183y",PropRequestProblemInformation 21,PropMaximumPacketSize
// 31500,PropRequestResponseInformation 119,PropMaximumPacketSize 10228,PropServerKeepAlive 10977,PropResponseTopic
// "/\167\&6\228JC\209\207\DC4\214_|R\207!\133\SOHB",PropWillDelayInterval 10162,PropSessionExpiryInterval
// 24718,PropAuthenticationData "\227\214\EOT\SO\235n\144\232",PropSharedSubscriptionAvailable
// 176,PropPayloadFormatIndicator 55]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0x89, 0x3,  0x4,  0xab, 0xa1, 0x1,  0x9,  0x0,  0x12, 0xad, 0xa1, 0x11, 0xa6, 0xf4, 0x5a, 0xa7, 0x31, 0x8b,
      0x50, 0x6f, 0xed, 0xaa, 0xc1, 0x8a, 0x3d, 0xf4, 0xbb, 0x18, 0x0,  0x0,  0x31, 0xce, 0xb,  0x6,  0x1f, 0x0,  0xe,
      0x2a, 0xa2, 0xb4, 0x33, 0xb6, 0xde, 0xd2, 0xfa, 0x59, 0xbd, 0x35, 0x6d, 0xfd, 0xac, 0x19, 0x6,  0x8,  0x0,  0x1a,
      0x7f, 0xcc, 0xe4, 0x8f, 0xcb, 0x4b, 0xfe, 0x42, 0x34, 0xb5, 0x0,  0x41, 0x7f, 0x52, 0x65, 0xf5, 0xdf, 0xb7, 0xed,
      0x25, 0x78, 0x30, 0x2a, 0xf0, 0x2a, 0x63, 0x18, 0x0,  0x0,  0x4,  0x1d, 0x1c, 0x0,  0xe,  0x68, 0x3,  0x6d, 0x60,
      0xe2, 0xa4, 0x33, 0xb2, 0x71, 0x64, 0x7b, 0x9a, 0xb7, 0x79, 0x17, 0x15, 0x27, 0x0,  0x0,  0x7b, 0xc,  0x19, 0x77,
      0x27, 0x0,  0x0,  0x27, 0xf4, 0x13, 0x2a, 0xe1, 0x8,  0x0,  0x12, 0x2f, 0xa7, 0x36, 0xe4, 0x4a, 0x43, 0xd1, 0xcf,
      0x14, 0xd6, 0x5f, 0x7c, 0x52, 0xcf, 0x21, 0x85, 0x1,  0x42, 0x18, 0x0,  0x0,  0x27, 0xb2, 0x11, 0x0,  0x0,  0x60,
      0x8e, 0x16, 0x0,  0x8,  0xe3, 0xd6, 0x4,  0xe,  0xeb, 0x6e, 0x90, 0xe8, 0x2a, 0xb0, 0x1,  0x37, 0x0,  0x9,  0x3,
      0xbf, 0x9c, 0x1f, 0x33, 0x89, 0x35, 0xbe, 0x61, 0x24, 0x0,  0xe,  0xa5, 0x15, 0xc4, 0x50, 0x20, 0xec, 0xac, 0xc5,
      0x4d, 0x8c, 0xb1, 0x72, 0x1a, 0x9f, 0x1c, 0x0,  0x5,  0x1e, 0xcf, 0xc0, 0xd8, 0xa8, 0x8,  0x0,  0x1a, 0x33, 0xdd,
      0x69, 0x11, 0xa2, 0xe2, 0xd6, 0x45, 0x6e, 0x57, 0xfa, 0x9c, 0xe6, 0xb6, 0x3b, 0x56, 0xc3, 0xe6, 0x64, 0x0,  0xae,
      0x3c, 0xad, 0x4a, 0x8b, 0xa0, 0x9,  0x0,  0x14, 0xfa, 0x75, 0x97, 0x9f, 0x50, 0x27, 0x8b, 0x19, 0x9d, 0x55, 0xfa,
      0x2b, 0x15, 0x48, 0x92, 0x2b, 0x56, 0xca, 0x52, 0x7a, 0x25, 0x0,  0x19, 0xc7, 0x55, 0x53, 0x78, 0xae, 0x69, 0x61,
      0x1d, 0x7a, 0x6,  0x12, 0x5c, 0x29, 0xc0, 0x1,  0x43, 0x8e, 0x60, 0x2f, 0x7c, 0xce, 0x4a, 0x60, 0x44, 0x4f, 0x25,
      0x0,  0x1d, 0xea, 0xc2, 0x81, 0x7e, 0x7a, 0x39, 0x5f, 0x45, 0xc,  0x76, 0x6b, 0xe8, 0xa8, 0x69, 0x31, 0x7d, 0x29,
      0x2f, 0x88, 0x52, 0x54, 0x8d, 0xaa, 0xb8, 0x3a, 0xd2, 0x40, 0xe3, 0x49, 0x5,  0x0,  0x15, 0x44, 0xa9, 0xd7, 0x2f,
      0x30, 0x52, 0x7f, 0xc9, 0x3e, 0xea, 0x9b, 0x3e, 0x93, 0x57, 0xe,  0x76, 0x25, 0x15, 0x1f, 0xe6, 0x6c, 0x5,  0x0,
      0x16, 0x9b, 0x22, 0xdb, 0x39, 0x60, 0x8a, 0x91, 0xb6, 0x33, 0xb2, 0x93, 0xe2, 0x47, 0x7,  0x5b, 0x68, 0xbf, 0x60,
      0xd4, 0x60, 0xb9, 0x8f, 0x1c, 0x0,  0x1b, 0x61, 0x5d, 0xcd, 0xdc, 0x6f, 0xc5, 0x5d, 0x8b, 0x71, 0x54, 0xb1, 0x24,
      0x3f, 0x50, 0x97, 0x9e, 0x8d, 0x3d, 0xe7, 0x9d, 0xf9, 0x6b, 0xe7, 0x48, 0x9f, 0xa3, 0x2e, 0x25};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x3, 0xbf, 0x9c, 0x1f, 0x33, 0x89, 0x35, 0xbe, 0x61};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa5, 0x15, 0xc4, 0x50, 0x20, 0xec, 0xac,
                                     0xc5, 0x4d, 0x8c, 0xb1, 0x72, 0x1a, 0x9f};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1e, 0xcf, 0xc0, 0xd8, 0xa8};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x33, 0xdd, 0x69, 0x11, 0xa2, 0xe2, 0xd6, 0x45, 0x6e, 0x57, 0xfa, 0x9c, 0xe6,
                                     0xb6, 0x3b, 0x56, 0xc3, 0xe6, 0x64, 0x0,  0xae, 0x3c, 0xad, 0x4a, 0x8b, 0xa0};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfa, 0x75, 0x97, 0x9f, 0x50, 0x27, 0x8b, 0x19, 0x9d, 0x55,
                                     0xfa, 0x2b, 0x15, 0x48, 0x92, 0x2b, 0x56, 0xca, 0x52, 0x7a};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc7, 0x55, 0x53, 0x78, 0xae, 0x69, 0x61, 0x1d, 0x7a, 0x6,  0x12, 0x5c, 0x29,
                                     0xc0, 0x1,  0x43, 0x8e, 0x60, 0x2f, 0x7c, 0xce, 0x4a, 0x60, 0x44, 0x4f};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xea, 0xc2, 0x81, 0x7e, 0x7a, 0x39, 0x5f, 0x45, 0xc,  0x76,
                                     0x6b, 0xe8, 0xa8, 0x69, 0x31, 0x7d, 0x29, 0x2f, 0x88, 0x52,
                                     0x54, 0x8d, 0xaa, 0xb8, 0x3a, 0xd2, 0x40, 0xe3, 0x49};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x44, 0xa9, 0xd7, 0x2f, 0x30, 0x52, 0x7f, 0xc9, 0x3e, 0xea, 0x9b,
                                     0x3e, 0x93, 0x57, 0xe,  0x76, 0x25, 0x15, 0x1f, 0xe6, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x9b, 0x22, 0xdb, 0x39, 0x60, 0x8a, 0x91, 0xb6, 0x33, 0xb2, 0x93,
                                     0xe2, 0x47, 0x7,  0x5b, 0x68, 0xbf, 0x60, 0xd4, 0x60, 0xb9, 0x8f};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x61, 0x5d, 0xcd, 0xdc, 0x6f, 0xc5, 0x5d, 0x8b, 0x71, 0x54, 0xb1, 0x24, 0x3f, 0x50,
                                     0x97, 0x9e, 0x8d, 0x3d, 0xe7, 0x9d, 0xf9, 0x6b, 0xe7, 0x48, 0x9f, 0xa3, 0x2e};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0xad, 0xa1, 0x11, 0xa6, 0xf4, 0x5a, 0xa7, 0x31, 0x8b,
                           0x50, 0x6f, 0xed, 0xaa, 0xc1, 0x8a, 0x3d, 0xf4, 0xbb};
  uint8_t bytesprops1[] = {0x2a, 0xa2, 0xb4, 0x33, 0xb6, 0xde, 0xd2, 0xfa, 0x59, 0xbd, 0x35, 0x6d, 0xfd, 0xac};
  uint8_t bytesprops2[] = {0x7f, 0xcc, 0xe4, 0x8f, 0xcb, 0x4b, 0xfe, 0x42, 0x34, 0xb5, 0x0,  0x41, 0x7f,
                           0x52, 0x65, 0xf5, 0xdf, 0xb7, 0xed, 0x25, 0x78, 0x30, 0x2a, 0xf0, 0x2a, 0x63};
  uint8_t bytesprops3[] = {0x68, 0x3, 0x6d, 0x60, 0xe2, 0xa4, 0x33, 0xb2, 0x71, 0x64, 0x7b, 0x9a, 0xb7, 0x79};
  uint8_t bytesprops4[] = {0x2f, 0xa7, 0x36, 0xe4, 0x4a, 0x43, 0xd1, 0xcf, 0x14,
                           0xd6, 0x5f, 0x7c, 0x52, 0xcf, 0x21, 0x85, 0x1,  0x42};
  uint8_t bytesprops5[] = {0xe3, 0xd6, 0x4, 0xe, 0xeb, 0x6e, 0x90, 0xe8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12750}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1053}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31500}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10228}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10977}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10162}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24718}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1195, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4397
// [("\SUB\ETX\210\235\182\"\235m\202\r6\154h\136\163\131\130\186$\186\129+[\232\241\213\194x\211\187",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\192#0\201ZxW\ENQ\210 ^}0\SOH\CAN\213\248",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = True, _noLocal = False, _subQoS =
// QoS2}),("j\249\215G\224\163\155\205/\178\206fT\139\&0~\215\CAN\233!\DC4",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\EOT\211",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\136\FS\200\185\171\231^l\SO\167\145f\226\219\143`\t^\137F\163",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropResponseInformation
// "\STX'\188\v\191\no\240\SYN\213G\165",PropSubscriptionIdentifier 25,PropResponseInformation
// "\234\130g\223,ah\b=\202\DC2\DC3\133\132\163\221.\a\DEL\172\SUB\205t\254v\201&\251",PropSessionExpiryInterval
// 20154,PropMaximumPacketSize 1765,PropWillDelayInterval 10094,PropMessageExpiryInterval 1449,PropContentType
// "\nj\190'\196\206]\148\191C\190\169n_",PropAuthenticationData
// "\133\180V\130\SO\173\138\133\151\DC2\128A\199\a\r|C\201\148\238=&R\210",PropMessageExpiryInterval
// 24951,PropRetainAvailable 95,PropRequestResponseInformation 41]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xec, 0x1,  0x11, 0x2d, 0x79, 0x1a, 0x0,  0xc,  0x2,  0x27, 0xbc, 0xb,  0xbf, 0xa,  0x6f, 0xf0, 0x16, 0xd5,
      0x47, 0xa5, 0xb,  0x19, 0x1a, 0x0,  0x1c, 0xea, 0x82, 0x67, 0xdf, 0x2c, 0x61, 0x68, 0x8,  0x3d, 0xca, 0x12, 0x13,
      0x85, 0x84, 0xa3, 0xdd, 0x2e, 0x7,  0x7f, 0xac, 0x1a, 0xcd, 0x74, 0xfe, 0x76, 0xc9, 0x26, 0xfb, 0x11, 0x0,  0x0,
      0x4e, 0xba, 0x27, 0x0,  0x0,  0x6,  0xe5, 0x18, 0x0,  0x0,  0x27, 0x6e, 0x2,  0x0,  0x0,  0x5,  0xa9, 0x3,  0x0,
      0xe,  0xa,  0x6a, 0xbe, 0x27, 0xc4, 0xce, 0x5d, 0x94, 0xbf, 0x43, 0xbe, 0xa9, 0x6e, 0x5f, 0x16, 0x0,  0x18, 0x85,
      0xb4, 0x56, 0x82, 0xe,  0xad, 0x8a, 0x85, 0x97, 0x12, 0x80, 0x41, 0xc7, 0x7,  0xd,  0x7c, 0x43, 0xc9, 0x94, 0xee,
      0x3d, 0x26, 0x52, 0xd2, 0x2,  0x0,  0x0,  0x61, 0x77, 0x25, 0x5f, 0x19, 0x29, 0x0,  0x1e, 0x1a, 0x3,  0xd2, 0xeb,
      0xb6, 0x22, 0xeb, 0x6d, 0xca, 0xd,  0x36, 0x9a, 0x68, 0x88, 0xa3, 0x83, 0x82, 0xba, 0x24, 0xba, 0x81, 0x2b, 0x5b,
      0xe8, 0xf1, 0xd5, 0xc2, 0x78, 0xd3, 0xbb, 0x16, 0x0,  0x11, 0xc0, 0x23, 0x30, 0xc9, 0x5a, 0x78, 0x57, 0x5,  0xd2,
      0x20, 0x5e, 0x7d, 0x30, 0x1,  0x18, 0xd5, 0xf8, 0xa,  0x0,  0x15, 0x6a, 0xf9, 0xd7, 0x47, 0xe0, 0xa3, 0x9b, 0xcd,
      0x2f, 0xb2, 0xce, 0x66, 0x54, 0x8b, 0x30, 0x7e, 0xd7, 0x18, 0xe9, 0x21, 0x14, 0x21, 0x0,  0x0,  0x24, 0x0,  0x2,
      0x4,  0xd3, 0x5,  0x0,  0x15, 0x88, 0x1c, 0xc8, 0xb9, 0xab, 0xe7, 0x5e, 0x6c, 0xe,  0xa7, 0x91, 0x66, 0xe2, 0xdb,
      0x8f, 0x60, 0x9,  0x5e, 0x89, 0x46, 0xa3, 0x4,  0x0,  0x0,  0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x1a, 0x3,  0xd2, 0xeb, 0xb6, 0x22, 0xeb, 0x6d, 0xca, 0xd,
                                     0x36, 0x9a, 0x68, 0x88, 0xa3, 0x83, 0x82, 0xba, 0x24, 0xba,
                                     0x81, 0x2b, 0x5b, 0xe8, 0xf1, 0xd5, 0xc2, 0x78, 0xd3, 0xbb};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc0, 0x23, 0x30, 0xc9, 0x5a, 0x78, 0x57, 0x5, 0xd2,
                                     0x20, 0x5e, 0x7d, 0x30, 0x1,  0x18, 0xd5, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6a, 0xf9, 0xd7, 0x47, 0xe0, 0xa3, 0x9b, 0xcd, 0x2f, 0xb2, 0xce,
                                     0x66, 0x54, 0x8b, 0x30, 0x7e, 0xd7, 0x18, 0xe9, 0x21, 0x14};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4, 0xd3};
  lwmqtt_string_t topic_filter_s4 = {2, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x88, 0x1c, 0xc8, 0xb9, 0xab, 0xe7, 0x5e, 0x6c, 0xe,  0xa7, 0x91,
                                     0x66, 0xe2, 0xdb, 0x8f, 0x60, 0x9,  0x5e, 0x89, 0x46, 0xa3};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x2, 0x27, 0xbc, 0xb, 0xbf, 0xa, 0x6f, 0xf0, 0x16, 0xd5, 0x47, 0xa5};
  uint8_t bytesprops1[] = {0xea, 0x82, 0x67, 0xdf, 0x2c, 0x61, 0x68, 0x8,  0x3d, 0xca, 0x12, 0x13, 0x85, 0x84,
                           0xa3, 0xdd, 0x2e, 0x7,  0x7f, 0xac, 0x1a, 0xcd, 0x74, 0xfe, 0x76, 0xc9, 0x26, 0xfb};
  uint8_t bytesprops2[] = {0xa, 0x6a, 0xbe, 0x27, 0xc4, 0xce, 0x5d, 0x94, 0xbf, 0x43, 0xbe, 0xa9, 0x6e, 0x5f};
  uint8_t bytesprops3[] = {0x85, 0xb4, 0x56, 0x82, 0xe,  0xad, 0x8a, 0x85, 0x97, 0x12, 0x80, 0x41,
                           0xc7, 0x7,  0xd,  0x7c, 0x43, 0xc9, 0x94, 0xee, 0x3d, 0x26, 0x52, 0xd2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20154}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1765}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10094}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1449}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24951}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 41}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4397, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27847
// [("\243<\205\142\254\168U\222\165,\134\130\135\225_\143\205\US\162\203D\ETBR\SO\n\242\194",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("s\199\173\183n\252\245\235\237\ETX\SOH\189\190M9\160/+",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\148",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("4x\187\128\139\&3\a\DC3\233\136\CAN{\200\172B\213\155\SYNS\175\221\183\195\GS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropServerReference
// "h\158\218u\224\"\219 \181#&\SYN\166y(\243y\154+\225\131\187/_\157Qi(\145\166",PropSharedSubscriptionAvailable
// 111,PropTopicAlias 8625,PropAssignedClientIdentifier
// "G\CAN\200\230\&4qhbYu8\249\204\131\DC1s\215\242\232\DC2\149\"\248",PropCorrelationData
// "D\158y\EM%\232}\138\194S\DC17\138\242\STX\222\DC2\ENQ\192\192\128a\179\244E\r\183\178\SO*",PropCorrelationData
// "\198\222+\196\129)_\198G\129\\\SOj\SOd\ENQ",PropRequestProblemInformation 177,PropAssignedClientIdentifier
// "\247d\239\179\141\t\RS\174\STX;",PropServerKeepAlive 966,PropMessageExpiryInterval 17493,PropServerReference
// "\161\129\179\&1\177\200\232\177/\ETX\251\187&\210>\CAN",PropWildcardSubscriptionAvailable 96,PropCorrelationData
// "\131,\227\DC4k\n\205\185\184)Z\205\215a%\144{j\201\205`\228\177R",PropWillDelayInterval
// 31922,PropAuthenticationMethod "\178Q[",PropWildcardSubscriptionAvailable 255,PropReasonString "",PropResponseTopic
// "\202\151\153F",PropRetainAvailable 126,PropResponseTopic
// "\239\DC40\139\154\&9\157hZ^m\NAK\195\156\214\229\138\152",PropAssignedClientIdentifier "\233",PropRetainAvailable
// 181,PropRequestProblemInformation 208,PropMaximumPacketSize 6700,PropUserProperty "itp\171\GS=\214m\136{Z\129\210t"
// "\235\233\RSc)6\241\237\147^\139\137\n\ACK\173_;x>\206\167\138\207\233\ETB\231\EM\255o",PropSubscriptionIdentifier
// 9,PropMaximumPacketSize 19656,PropReceiveMaximum 2700,PropSessionExpiryInterval 20638]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0x8b, 0x3,  0x6c, 0xc7, 0xb5, 0x2,  0x1c, 0x0,  0x1e, 0x68, 0x9e, 0xda, 0x75, 0xe0, 0x22, 0xdb, 0x20, 0xb5,
      0x23, 0x26, 0x16, 0xa6, 0x79, 0x28, 0xf3, 0x79, 0x9a, 0x2b, 0xe1, 0x83, 0xbb, 0x2f, 0x5f, 0x9d, 0x51, 0x69, 0x28,
      0x91, 0xa6, 0x2a, 0x6f, 0x23, 0x21, 0xb1, 0x12, 0x0,  0x17, 0x47, 0x18, 0xc8, 0xe6, 0x34, 0x71, 0x68, 0x62, 0x59,
      0x75, 0x38, 0xf9, 0xcc, 0x83, 0x11, 0x73, 0xd7, 0xf2, 0xe8, 0x12, 0x95, 0x22, 0xf8, 0x9,  0x0,  0x1e, 0x44, 0x9e,
      0x79, 0x19, 0x25, 0xe8, 0x7d, 0x8a, 0xc2, 0x53, 0x11, 0x37, 0x8a, 0xf2, 0x2,  0xde, 0x12, 0x5,  0xc0, 0xc0, 0x80,
      0x61, 0xb3, 0xf4, 0x45, 0xd,  0xb7, 0xb2, 0xe,  0x2a, 0x9,  0x0,  0x10, 0xc6, 0xde, 0x2b, 0xc4, 0x81, 0x29, 0x5f,
      0xc6, 0x47, 0x81, 0x5c, 0xe,  0x6a, 0xe,  0x64, 0x5,  0x17, 0xb1, 0x12, 0x0,  0xa,  0xf7, 0x64, 0xef, 0xb3, 0x8d,
      0x9,  0x1e, 0xae, 0x2,  0x3b, 0x13, 0x3,  0xc6, 0x2,  0x0,  0x0,  0x44, 0x55, 0x1c, 0x0,  0x10, 0xa1, 0x81, 0xb3,
      0x31, 0xb1, 0xc8, 0xe8, 0xb1, 0x2f, 0x3,  0xfb, 0xbb, 0x26, 0xd2, 0x3e, 0x18, 0x28, 0x60, 0x9,  0x0,  0x18, 0x83,
      0x2c, 0xe3, 0x14, 0x6b, 0xa,  0xcd, 0xb9, 0xb8, 0x29, 0x5a, 0xcd, 0xd7, 0x61, 0x25, 0x90, 0x7b, 0x6a, 0xc9, 0xcd,
      0x60, 0xe4, 0xb1, 0x52, 0x18, 0x0,  0x0,  0x7c, 0xb2, 0x15, 0x0,  0x3,  0xb2, 0x51, 0x5b, 0x28, 0xff, 0x1f, 0x0,
      0x0,  0x8,  0x0,  0x4,  0xca, 0x97, 0x99, 0x46, 0x25, 0x7e, 0x8,  0x0,  0x12, 0xef, 0x14, 0x30, 0x8b, 0x9a, 0x39,
      0x9d, 0x68, 0x5a, 0x5e, 0x6d, 0x15, 0xc3, 0x9c, 0xd6, 0xe5, 0x8a, 0x98, 0x12, 0x0,  0x1,  0xe9, 0x25, 0xb5, 0x17,
      0xd0, 0x27, 0x0,  0x0,  0x1a, 0x2c, 0x26, 0x0,  0xe,  0x69, 0x74, 0x70, 0xab, 0x1d, 0x3d, 0xd6, 0x6d, 0x88, 0x7b,
      0x5a, 0x81, 0xd2, 0x74, 0x0,  0x1d, 0xeb, 0xe9, 0x1e, 0x63, 0x29, 0x36, 0xf1, 0xed, 0x93, 0x5e, 0x8b, 0x89, 0xa,
      0x6,  0xad, 0x5f, 0x3b, 0x78, 0x3e, 0xce, 0xa7, 0x8a, 0xcf, 0xe9, 0x17, 0xe7, 0x19, 0xff, 0x6f, 0xb,  0x9,  0x27,
      0x0,  0x0,  0x4c, 0xc8, 0x21, 0xa,  0x8c, 0x11, 0x0,  0x0,  0x50, 0x9e, 0x0,  0x1b, 0xf3, 0x3c, 0xcd, 0x8e, 0xfe,
      0xa8, 0x55, 0xde, 0xa5, 0x2c, 0x86, 0x82, 0x87, 0xe1, 0x5f, 0x8f, 0xcd, 0x1f, 0xa2, 0xcb, 0x44, 0x17, 0x52, 0xe,
      0xa,  0xf2, 0xc2, 0x16, 0x0,  0x12, 0x73, 0xc7, 0xad, 0xb7, 0x6e, 0xfc, 0xf5, 0xeb, 0xed, 0x3,  0x1,  0xbd, 0xbe,
      0x4d, 0x39, 0xa0, 0x2f, 0x2b, 0x24, 0x0,  0x1,  0x94, 0x2e, 0x0,  0x18, 0x34, 0x78, 0xbb, 0x80, 0x8b, 0x33, 0x7,
      0x13, 0xe9, 0x88, 0x18, 0x7b, 0xc8, 0xac, 0x42, 0xd5, 0x9b, 0x16, 0x53, 0xaf, 0xdd, 0xb7, 0xc3, 0x1d, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf3, 0x3c, 0xcd, 0x8e, 0xfe, 0xa8, 0x55, 0xde, 0xa5, 0x2c, 0x86, 0x82, 0x87, 0xe1,
                                     0x5f, 0x8f, 0xcd, 0x1f, 0xa2, 0xcb, 0x44, 0x17, 0x52, 0xe,  0xa,  0xf2, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x73, 0xc7, 0xad, 0xb7, 0x6e, 0xfc, 0xf5, 0xeb, 0xed,
                                     0x3,  0x1,  0xbd, 0xbe, 0x4d, 0x39, 0xa0, 0x2f, 0x2b};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x94};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0x78, 0xbb, 0x80, 0x8b, 0x33, 0x7,  0x13, 0xe9, 0x88, 0x18, 0x7b,
                                     0xc8, 0xac, 0x42, 0xd5, 0x9b, 0x16, 0x53, 0xaf, 0xdd, 0xb7, 0xc3, 0x1d};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x68, 0x9e, 0xda, 0x75, 0xe0, 0x22, 0xdb, 0x20, 0xb5, 0x23, 0x26, 0x16, 0xa6, 0x79, 0x28,
                           0xf3, 0x79, 0x9a, 0x2b, 0xe1, 0x83, 0xbb, 0x2f, 0x5f, 0x9d, 0x51, 0x69, 0x28, 0x91, 0xa6};
  uint8_t bytesprops1[] = {0x47, 0x18, 0xc8, 0xe6, 0x34, 0x71, 0x68, 0x62, 0x59, 0x75, 0x38, 0xf9,
                           0xcc, 0x83, 0x11, 0x73, 0xd7, 0xf2, 0xe8, 0x12, 0x95, 0x22, 0xf8};
  uint8_t bytesprops2[] = {0x44, 0x9e, 0x79, 0x19, 0x25, 0xe8, 0x7d, 0x8a, 0xc2, 0x53, 0x11, 0x37, 0x8a, 0xf2, 0x2,
                           0xde, 0x12, 0x5,  0xc0, 0xc0, 0x80, 0x61, 0xb3, 0xf4, 0x45, 0xd,  0xb7, 0xb2, 0xe,  0x2a};
  uint8_t bytesprops3[] = {0xc6, 0xde, 0x2b, 0xc4, 0x81, 0x29, 0x5f, 0xc6, 0x47, 0x81, 0x5c, 0xe, 0x6a, 0xe, 0x64, 0x5};
  uint8_t bytesprops4[] = {0xf7, 0x64, 0xef, 0xb3, 0x8d, 0x9, 0x1e, 0xae, 0x2, 0x3b};
  uint8_t bytesprops5[] = {0xa1, 0x81, 0xb3, 0x31, 0xb1, 0xc8, 0xe8, 0xb1,
                           0x2f, 0x3,  0xfb, 0xbb, 0x26, 0xd2, 0x3e, 0x18};
  uint8_t bytesprops6[] = {0x83, 0x2c, 0xe3, 0x14, 0x6b, 0xa,  0xcd, 0xb9, 0xb8, 0x29, 0x5a, 0xcd,
                           0xd7, 0x61, 0x25, 0x90, 0x7b, 0x6a, 0xc9, 0xcd, 0x60, 0xe4, 0xb1, 0x52};
  uint8_t bytesprops7[] = {0xb2, 0x51, 0x5b};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0xca, 0x97, 0x99, 0x46};
  uint8_t bytesprops10[] = {0xef, 0x14, 0x30, 0x8b, 0x9a, 0x39, 0x9d, 0x68, 0x5a,
                            0x5e, 0x6d, 0x15, 0xc3, 0x9c, 0xd6, 0xe5, 0x8a, 0x98};
  uint8_t bytesprops11[] = {0xe9};
  uint8_t bytesprops13[] = {0xeb, 0xe9, 0x1e, 0x63, 0x29, 0x36, 0xf1, 0xed, 0x93, 0x5e, 0x8b, 0x89, 0xa,  0x6, 0xad,
                            0x5f, 0x3b, 0x78, 0x3e, 0xce, 0xa7, 0x8a, 0xcf, 0xe9, 0x17, 0xe7, 0x19, 0xff, 0x6f};
  uint8_t bytesprops12[] = {0x69, 0x74, 0x70, 0xab, 0x1d, 0x3d, 0xd6, 0x6d, 0x88, 0x7b, 0x5a, 0x81, 0xd2, 0x74};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8625}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 966}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17493}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31922}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6700}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&bytesprops12}, .v = {29, (char*)&bytesprops13}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19656}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2700}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20638}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27847, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29011 [("L\255\232\&7",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS0}),("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS0}),("\ENQ
// \STX\209\189\DEL\160\167\&6~\254\SYN\144\246\217(\GS\207(c\142\241",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\237\194\247\230\ETX\134\225\f\SI\143\242\181\&1+\226EO\223\186\144se\216HY>\170\209",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\155O\191\161v\218\167\168_\147\DC1",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS0}),("\FS\236xY=!\172\241\217\230\209\222\179\DC2\SI",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("d}\134\162\229\233`\212\248\207\DC4\254\137\186\232KP\165\222\144",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\241\197)E\130G\STX\248\&7w\179\173\243\vTB\FS\212o\195jN\201\151Z\NUL",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\194\235)\201J\157\SOH3\t|\DC4\164\v\175\206\SOHY\236 \166(\212\130",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\181H\154\233\193\216W\142\190\172\173\206\ACKC`",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("s\231w\220\208\DC4\157\191\CAN\EOTo\187\170.c\DLE-\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0xda, 0x1,  0x71, 0x53, 0x0,  0x0,  0x4,  0x4c, 0xff, 0xe8, 0x37, 0x2c, 0x0,  0x0,  0x28, 0x0,
                   0x16, 0x5,  0x20, 0x2,  0xd1, 0xbd, 0x7f, 0xa0, 0xa7, 0x36, 0x7e, 0xfe, 0x16, 0x90, 0xf6, 0xd9, 0x28,
                   0x1d, 0xcf, 0x28, 0x63, 0x8e, 0xf1, 0x1d, 0x0,  0x1c, 0xed, 0xc2, 0xf7, 0xe6, 0x3,  0x86, 0xe1, 0xc,
                   0xf,  0x8f, 0xf2, 0xb5, 0x31, 0x2b, 0xe2, 0x45, 0x4f, 0xdf, 0xba, 0x90, 0x73, 0x65, 0xd8, 0x48, 0x59,
                   0x3e, 0xaa, 0xd1, 0x18, 0x0,  0xb,  0x9b, 0x4f, 0xbf, 0xa1, 0x76, 0xda, 0xa7, 0xa8, 0x5f, 0x93, 0x11,
                   0x2c, 0x0,  0xf,  0x1c, 0xec, 0x78, 0x59, 0x3d, 0x21, 0xac, 0xf1, 0xd9, 0xe6, 0xd1, 0xde, 0xb3, 0x12,
                   0xf,  0x1d, 0x0,  0x14, 0x64, 0x7d, 0x86, 0xa2, 0xe5, 0xe9, 0x60, 0xd4, 0xf8, 0xcf, 0x14, 0xfe, 0x89,
                   0xba, 0xe8, 0x4b, 0x50, 0xa5, 0xde, 0x90, 0xe,  0x0,  0x1a, 0xf1, 0xc5, 0x29, 0x45, 0x82, 0x47, 0x2,
                   0xf8, 0x37, 0x77, 0xb3, 0xad, 0xf3, 0xb,  0x54, 0x42, 0x1c, 0xd4, 0x6f, 0xc3, 0x6a, 0x4e, 0xc9, 0x97,
                   0x5a, 0x0,  0x1c, 0x0,  0x17, 0xc2, 0xeb, 0x29, 0xc9, 0x4a, 0x9d, 0x1,  0x33, 0x9,  0x7c, 0x14, 0xa4,
                   0xb,  0xaf, 0xce, 0x1,  0x59, 0xec, 0x20, 0xa6, 0x28, 0xd4, 0x82, 0x2d, 0x0,  0xf,  0xb5, 0x48, 0x9a,
                   0xe9, 0xc1, 0xd8, 0x57, 0x8e, 0xbe, 0xac, 0xad, 0xce, 0x6,  0x43, 0x60, 0x1c, 0x0,  0x12, 0x73, 0xe7,
                   0x77, 0xdc, 0xd0, 0x14, 0x9d, 0xbf, 0x18, 0x4,  0x6f, 0xbb, 0xaa, 0x2e, 0x63, 0x10, 0x2d, 0xdb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x4c, 0xff, 0xe8, 0x37};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5,  0x20, 0x2,  0xd1, 0xbd, 0x7f, 0xa0, 0xa7, 0x36, 0x7e, 0xfe,
                                     0x16, 0x90, 0xf6, 0xd9, 0x28, 0x1d, 0xcf, 0x28, 0x63, 0x8e, 0xf1};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xed, 0xc2, 0xf7, 0xe6, 0x3,  0x86, 0xe1, 0xc,  0xf,  0x8f,
                                     0xf2, 0xb5, 0x31, 0x2b, 0xe2, 0x45, 0x4f, 0xdf, 0xba, 0x90,
                                     0x73, 0x65, 0xd8, 0x48, 0x59, 0x3e, 0xaa, 0xd1};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9b, 0x4f, 0xbf, 0xa1, 0x76, 0xda, 0xa7, 0xa8, 0x5f, 0x93, 0x11};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1c, 0xec, 0x78, 0x59, 0x3d, 0x21, 0xac, 0xf1,
                                     0xd9, 0xe6, 0xd1, 0xde, 0xb3, 0x12, 0xf};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x64, 0x7d, 0x86, 0xa2, 0xe5, 0xe9, 0x60, 0xd4, 0xf8, 0xcf,
                                     0x14, 0xfe, 0x89, 0xba, 0xe8, 0x4b, 0x50, 0xa5, 0xde, 0x90};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf1, 0xc5, 0x29, 0x45, 0x82, 0x47, 0x2,  0xf8, 0x37, 0x77, 0xb3, 0xad, 0xf3,
                                     0xb,  0x54, 0x42, 0x1c, 0xd4, 0x6f, 0xc3, 0x6a, 0x4e, 0xc9, 0x97, 0x5a, 0x0};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc2, 0xeb, 0x29, 0xc9, 0x4a, 0x9d, 0x1,  0x33, 0x9,  0x7c, 0x14, 0xa4,
                                     0xb,  0xaf, 0xce, 0x1,  0x59, 0xec, 0x20, 0xa6, 0x28, 0xd4, 0x82};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb5, 0x48, 0x9a, 0xe9, 0xc1, 0xd8, 0x57, 0x8e,
                                     0xbe, 0xac, 0xad, 0xce, 0x6,  0x43, 0x60};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x73, 0xe7, 0x77, 0xdc, 0xd0, 0x14, 0x9d, 0xbf, 0x18,
                                      0x4,  0x6f, 0xbb, 0xaa, 0x2e, 0x63, 0x10, 0x2d, 0xdb};
  lwmqtt_string_t topic_filter_s10 = {18, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29011, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29705 [("\amn\138\157\180\217\219",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0}),("!!Va\217\152",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\249\n}\251\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\158\v\b\RS\149\235Vv\NAK\240\135d\189r\203\185b\176\ETB\195,EE\185y",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropSessionExpiryInterval
// 28284,PropResponseTopic "L"]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x44, 0x74, 0x9,  0x9,  0x11, 0x0,  0x0,  0x6e, 0x7c, 0x8,  0x0,  0x1,  0x4c,
                   0x0,  0x8,  0x7,  0x6d, 0x6e, 0x8a, 0x9d, 0xb4, 0xd9, 0xdb, 0x0,  0x0,  0x6,  0x21,
                   0x21, 0x56, 0x61, 0xd9, 0x98, 0xa,  0x0,  0x5,  0xf9, 0xa,  0x7d, 0xfb, 0xaa, 0x1,
                   0x0,  0x19, 0x9e, 0xb,  0x8,  0x1e, 0x95, 0xeb, 0x56, 0x76, 0x15, 0xf0, 0x87, 0x64,
                   0xbd, 0x72, 0xcb, 0xb9, 0x62, 0xb0, 0x17, 0xc3, 0x2c, 0x45, 0x45, 0xb9, 0x79, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x7, 0x6d, 0x6e, 0x8a, 0x9d, 0xb4, 0xd9, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x21, 0x21, 0x56, 0x61, 0xd9, 0x98};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf9, 0xa, 0x7d, 0xfb, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9e, 0xb,  0x8,  0x1e, 0x95, 0xeb, 0x56, 0x76, 0x15, 0xf0, 0x87, 0x64, 0xbd,
                                     0x72, 0xcb, 0xb9, 0x62, 0xb0, 0x17, 0xc3, 0x2c, 0x45, 0x45, 0xb9, 0x79};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x4c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28284}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29705, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30426 [("\SYNez\ACK\162N\176`#\DLEr6\206\183\167\183\224\241\&4OY\ENQ\162'\169\187\136A",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("mD\188mxN\232n\174\197\149e\174/\"\187\196\138\131\232",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\193]\DC2\n\228\224l6\162\149f\"J.\240\202",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),(":q\223\215|h\a\208G\164\\~\231q_R\131\211\242\198\EM\CAN\220(\158\DLE\133",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\225\243\168\&79\184\251\210N\f>-\149\138K\n\155\217\220\DC33T\250\255UB=\188\RS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("_\174@\222\188\207\224\212\179\190C\206",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\165\SYN\186\167:\ETX\214\DC2\145O\237\221\197",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropResponseTopic
// ">\197d\SOH\141\182\233\152\161e3\\'F\NUL\242\238\201\137>\226`d\247\216\f",PropUserProperty
// "\DLEC\133\DEL)fF;hO\202+\136\v\160\197i\238\DC1\215"
// "\212n\170#\146\197]\216\179\237\237K,B\227\"\190\DEL\ETXeIS\196",PropWillDelayInterval
// 20679,PropAuthenticationMethod "\\\254\&1\196^^\175b\136\ESC4d@n\241\STXs>'W\\=:w",PropMaximumPacketSize
// 3791,PropServerKeepAlive 29126,PropResponseTopic "\137\SI",PropMessageExpiryInterval 2636,PropServerKeepAlive
// 7512,PropRequestProblemInformation 204,PropSessionExpiryInterval 10542,PropTopicAlias 2720,PropMaximumPacketSize
// 30315,PropResponseInformation
// "\221\CAN\229\NAK\164\195\155\SOH\244\193\"\t\140\133\140\206\216\158\211\242\DLE\210",PropSubscriptionIdentifierAvailable
// 131,PropTopicAliasMaximum 31102,PropAuthenticationMethod "x\159d\133\SOH\161\198fD",PropAuthenticationMethod "Z\197"]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0xee, 0x2,  0x76, 0xda, 0xc0, 0x1,  0x8,  0x0,  0x1a, 0x3e, 0xc5, 0x64, 0x1,  0x8d, 0xb6, 0xe9, 0x98, 0xa1,
      0x65, 0x33, 0x5c, 0x27, 0x46, 0x0,  0xf2, 0xee, 0xc9, 0x89, 0x3e, 0xe2, 0x60, 0x64, 0xf7, 0xd8, 0xc,  0x26, 0x0,
      0x14, 0x10, 0x43, 0x85, 0x7f, 0x29, 0x66, 0x46, 0x3b, 0x68, 0x4f, 0xca, 0x2b, 0x88, 0xb,  0xa0, 0xc5, 0x69, 0xee,
      0x11, 0xd7, 0x0,  0x17, 0xd4, 0x6e, 0xaa, 0x23, 0x92, 0xc5, 0x5d, 0xd8, 0xb3, 0xed, 0xed, 0x4b, 0x2c, 0x42, 0xe3,
      0x22, 0xbe, 0x7f, 0x3,  0x65, 0x49, 0x53, 0xc4, 0x18, 0x0,  0x0,  0x50, 0xc7, 0x15, 0x0,  0x18, 0x5c, 0xfe, 0x31,
      0xc4, 0x5e, 0x5e, 0xaf, 0x62, 0x88, 0x1b, 0x34, 0x64, 0x40, 0x6e, 0xf1, 0x2,  0x73, 0x3e, 0x27, 0x57, 0x5c, 0x3d,
      0x3a, 0x77, 0x27, 0x0,  0x0,  0xe,  0xcf, 0x13, 0x71, 0xc6, 0x8,  0x0,  0x2,  0x89, 0xf,  0x2,  0x0,  0x0,  0xa,
      0x4c, 0x13, 0x1d, 0x58, 0x17, 0xcc, 0x11, 0x0,  0x0,  0x29, 0x2e, 0x23, 0xa,  0xa0, 0x27, 0x0,  0x0,  0x76, 0x6b,
      0x1a, 0x0,  0x16, 0xdd, 0x18, 0xe5, 0x15, 0xa4, 0xc3, 0x9b, 0x1,  0xf4, 0xc1, 0x22, 0x9,  0x8c, 0x85, 0x8c, 0xce,
      0xd8, 0x9e, 0xd3, 0xf2, 0x10, 0xd2, 0x29, 0x83, 0x22, 0x79, 0x7e, 0x15, 0x0,  0x9,  0x78, 0x9f, 0x64, 0x85, 0x1,
      0xa1, 0xc6, 0x66, 0x44, 0x15, 0x0,  0x2,  0x5a, 0xc5, 0x0,  0x1c, 0x16, 0x65, 0x7a, 0x6,  0xa2, 0x4e, 0xb0, 0x60,
      0x23, 0x10, 0x72, 0x36, 0xce, 0xb7, 0xa7, 0xb7, 0xe0, 0xf1, 0x34, 0x4f, 0x59, 0x5,  0xa2, 0x27, 0xa9, 0xbb, 0x88,
      0x41, 0x2a, 0x0,  0x1,  0x98, 0x0,  0x0,  0x14, 0x6d, 0x44, 0xbc, 0x6d, 0x78, 0x4e, 0xe8, 0x6e, 0xae, 0xc5, 0x95,
      0x65, 0xae, 0x2f, 0x22, 0xbb, 0xc4, 0x8a, 0x83, 0xe8, 0x26, 0x0,  0x10, 0xc1, 0x5d, 0x12, 0xa,  0xe4, 0xe0, 0x6c,
      0x36, 0xa2, 0x95, 0x66, 0x22, 0x4a, 0x2e, 0xf0, 0xca, 0x28, 0x0,  0x1b, 0x3a, 0x71, 0xdf, 0xd7, 0x7c, 0x68, 0x7,
      0xd0, 0x47, 0xa4, 0x5c, 0x7e, 0xe7, 0x71, 0x5f, 0x52, 0x83, 0xd3, 0xf2, 0xc6, 0x19, 0x18, 0xdc, 0x28, 0x9e, 0x10,
      0x85, 0x29, 0x0,  0x1d, 0xe1, 0xf3, 0xa8, 0x37, 0x39, 0xb8, 0xfb, 0xd2, 0x4e, 0xc,  0x3e, 0x2d, 0x95, 0x8a, 0x4b,
      0xa,  0x9b, 0xd9, 0xdc, 0x13, 0x33, 0x54, 0xfa, 0xff, 0x55, 0x42, 0x3d, 0xbc, 0x1e, 0xc,  0x0,  0xc,  0x5f, 0xae,
      0x40, 0xde, 0xbc, 0xcf, 0xe0, 0xd4, 0xb3, 0xbe, 0x43, 0xce, 0x19, 0x0,  0xd,  0xa5, 0x16, 0xba, 0xa7, 0x3a, 0x3,
      0xd6, 0x12, 0x91, 0x4f, 0xed, 0xdd, 0xc5, 0x9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x16, 0x65, 0x7a, 0x6,  0xa2, 0x4e, 0xb0, 0x60, 0x23, 0x10,
                                     0x72, 0x36, 0xce, 0xb7, 0xa7, 0xb7, 0xe0, 0xf1, 0x34, 0x4f,
                                     0x59, 0x5,  0xa2, 0x27, 0xa9, 0xbb, 0x88, 0x41};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x98};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6d, 0x44, 0xbc, 0x6d, 0x78, 0x4e, 0xe8, 0x6e, 0xae, 0xc5,
                                     0x95, 0x65, 0xae, 0x2f, 0x22, 0xbb, 0xc4, 0x8a, 0x83, 0xe8};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0x5d, 0x12, 0xa,  0xe4, 0xe0, 0x6c, 0x36,
                                     0xa2, 0x95, 0x66, 0x22, 0x4a, 0x2e, 0xf0, 0xca};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3a, 0x71, 0xdf, 0xd7, 0x7c, 0x68, 0x7,  0xd0, 0x47, 0xa4, 0x5c, 0x7e, 0xe7, 0x71,
                                     0x5f, 0x52, 0x83, 0xd3, 0xf2, 0xc6, 0x19, 0x18, 0xdc, 0x28, 0x9e, 0x10, 0x85};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe1, 0xf3, 0xa8, 0x37, 0x39, 0xb8, 0xfb, 0xd2, 0x4e, 0xc,
                                     0x3e, 0x2d, 0x95, 0x8a, 0x4b, 0xa,  0x9b, 0xd9, 0xdc, 0x13,
                                     0x33, 0x54, 0xfa, 0xff, 0x55, 0x42, 0x3d, 0xbc, 0x1e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5f, 0xae, 0x40, 0xde, 0xbc, 0xcf, 0xe0, 0xd4, 0xb3, 0xbe, 0x43, 0xce};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa5, 0x16, 0xba, 0xa7, 0x3a, 0x3, 0xd6, 0x12, 0x91, 0x4f, 0xed, 0xdd, 0xc5};
  lwmqtt_string_t topic_filter_s7 = {13, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0x3e, 0xc5, 0x64, 0x1,  0x8d, 0xb6, 0xe9, 0x98, 0xa1, 0x65, 0x33, 0x5c, 0x27,
                           0x46, 0x0,  0xf2, 0xee, 0xc9, 0x89, 0x3e, 0xe2, 0x60, 0x64, 0xf7, 0xd8, 0xc};
  uint8_t bytesprops2[] = {0xd4, 0x6e, 0xaa, 0x23, 0x92, 0xc5, 0x5d, 0xd8, 0xb3, 0xed, 0xed, 0x4b,
                           0x2c, 0x42, 0xe3, 0x22, 0xbe, 0x7f, 0x3,  0x65, 0x49, 0x53, 0xc4};
  uint8_t bytesprops1[] = {0x10, 0x43, 0x85, 0x7f, 0x29, 0x66, 0x46, 0x3b, 0x68, 0x4f,
                           0xca, 0x2b, 0x88, 0xb,  0xa0, 0xc5, 0x69, 0xee, 0x11, 0xd7};
  uint8_t bytesprops3[] = {0x5c, 0xfe, 0x31, 0xc4, 0x5e, 0x5e, 0xaf, 0x62, 0x88, 0x1b, 0x34, 0x64,
                           0x40, 0x6e, 0xf1, 0x2,  0x73, 0x3e, 0x27, 0x57, 0x5c, 0x3d, 0x3a, 0x77};
  uint8_t bytesprops4[] = {0x89, 0xf};
  uint8_t bytesprops5[] = {0xdd, 0x18, 0xe5, 0x15, 0xa4, 0xc3, 0x9b, 0x1,  0xf4, 0xc1, 0x22,
                           0x9,  0x8c, 0x85, 0x8c, 0xce, 0xd8, 0x9e, 0xd3, 0xf2, 0x10, 0xd2};
  uint8_t bytesprops6[] = {0x78, 0x9f, 0x64, 0x85, 0x1, 0xa1, 0xc6, 0x66, 0x44};
  uint8_t bytesprops7[] = {0x5a, 0xc5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {23, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20679}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3791}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29126}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2636}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7512}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10542}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2720}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30315}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31102}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30426, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21987 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS2}),("Cz\235\f\236\158'=\190",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("l\166=\210\242k\194\162\DLE}w\148\202W\216\US\178\f",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("x\t\SO\224\131\ENQ\\\237\221\168\246&x\STX\246T\228\249\194\129\SUB",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\223\SI\255\235\250\134\ETX\178u\210",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2})] [PropMessageExpiryInterval 3349,PropContentType
// "C\236\n\232\162K",PropUserProperty "\145\162j\195>\181"
// "\141\239\221w\227\244)\a\DLE2h\170js\203\165\&1\214*",PropResponseInformation "
// J>!\132\t\146\FS\144x\187\154d\166\130\&6\143$JH\216\185\227",PropPayloadFormatIndicator 134]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x94, 0x1,  0x55, 0xe3, 0x48, 0x2,  0x0,  0x0,  0xd,  0x15, 0x3,  0x0,  0x6,  0x43, 0xec, 0xa,
                   0xe8, 0xa2, 0x4b, 0x26, 0x0,  0x6,  0x91, 0xa2, 0x6a, 0xc3, 0x3e, 0xb5, 0x0,  0x13, 0x8d, 0xef, 0xdd,
                   0x77, 0xe3, 0xf4, 0x29, 0x7,  0x10, 0x32, 0x68, 0xaa, 0x6a, 0x73, 0xcb, 0xa5, 0x31, 0xd6, 0x2a, 0x1a,
                   0x0,  0x17, 0x20, 0x4a, 0x3e, 0x21, 0x84, 0x9,  0x92, 0x1c, 0x90, 0x78, 0xbb, 0x9a, 0x64, 0xa6, 0x82,
                   0x36, 0x8f, 0x24, 0x4a, 0x48, 0xd8, 0xb9, 0xe3, 0x1,  0x86, 0x0,  0x0,  0xa,  0x0,  0x9,  0x43, 0x7a,
                   0xeb, 0xc,  0xec, 0x9e, 0x27, 0x3d, 0xbe, 0x2,  0x0,  0x12, 0x6c, 0xa6, 0x3d, 0xd2, 0xf2, 0x6b, 0xc2,
                   0xa2, 0x10, 0x7d, 0x77, 0x94, 0xca, 0x57, 0xd8, 0x1f, 0xb2, 0xc,  0x2d, 0x0,  0x15, 0x78, 0x9,  0xe,
                   0xe0, 0x83, 0x5,  0x5c, 0xed, 0xdd, 0xa8, 0xf6, 0x26, 0x78, 0x2,  0xf6, 0x54, 0xe4, 0xf9, 0xc2, 0x81,
                   0x1a, 0x24, 0x0,  0xa,  0xdf, 0xf,  0xff, 0xeb, 0xfa, 0x86, 0x3,  0xb2, 0x75, 0xd2, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x43, 0x7a, 0xeb, 0xc, 0xec, 0x9e, 0x27, 0x3d, 0xbe};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6c, 0xa6, 0x3d, 0xd2, 0xf2, 0x6b, 0xc2, 0xa2, 0x10,
                                     0x7d, 0x77, 0x94, 0xca, 0x57, 0xd8, 0x1f, 0xb2, 0xc};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x78, 0x9,  0xe, 0xe0, 0x83, 0x5,  0x5c, 0xed, 0xdd, 0xa8, 0xf6,
                                     0x26, 0x78, 0x2, 0xf6, 0x54, 0xe4, 0xf9, 0xc2, 0x81, 0x1a};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdf, 0xf, 0xff, 0xeb, 0xfa, 0x86, 0x3, 0xb2, 0x75, 0xd2};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x43, 0xec, 0xa, 0xe8, 0xa2, 0x4b};
  uint8_t bytesprops2[] = {0x8d, 0xef, 0xdd, 0x77, 0xe3, 0xf4, 0x29, 0x7,  0x10, 0x32,
                           0x68, 0xaa, 0x6a, 0x73, 0xcb, 0xa5, 0x31, 0xd6, 0x2a};
  uint8_t bytesprops1[] = {0x91, 0xa2, 0x6a, 0xc3, 0x3e, 0xb5};
  uint8_t bytesprops3[] = {0x20, 0x4a, 0x3e, 0x21, 0x84, 0x9,  0x92, 0x1c, 0x90, 0x78, 0xbb, 0x9a,
                           0x64, 0xa6, 0x82, 0x36, 0x8f, 0x24, 0x4a, 0x48, 0xd8, 0xb9, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3349}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {19, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 134}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21987, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23704 [("t \154\149\224\EM\158fEc\239\249\&6\231\DC4\159",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\253\\\220\193&\209[",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("e",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("R[&",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("^\169\135\136\143\241q\SI\254\254",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationData "
// \168|\206\130&N\174en2aK\138",PropAssignedClientIdentifier
// "\215`\195\147\209\b\197V\184&5\161\137\215PD",PropSubscriptionIdentifierAvailable 121,PropResponseTopic
// "B\ae\234\GS\148\192\128\159X",PropRequestResponseInformation 196,PropWildcardSubscriptionAvailable
// 36,PropSharedSubscriptionAvailable 186,PropSubscriptionIdentifier 29,PropWillDelayInterval
// 23802,PropSubscriptionIdentifier 0,PropRequestResponseInformation 106,PropTopicAlias 30327,PropServerKeepAlive
// 7428,PropAuthenticationData "\ESC\177|@\239\GS\228\SYNTB\ENQ*\RS\248\214l\244\172\145\237/",PropResponseTopic
// "\159qn\179H5\158k\146",PropTopicAlias 10678,PropWillDelayInterval 31517,PropMessageExpiryInterval 1842]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xb2, 0x1,  0x5c, 0x98, 0x7b, 0x16, 0x0,  0xe,  0x20, 0xa8, 0x7c, 0xce, 0x82, 0x26, 0x4e, 0xae,
                   0x65, 0x6e, 0x32, 0x61, 0x4b, 0x8a, 0x12, 0x0,  0x10, 0xd7, 0x60, 0xc3, 0x93, 0xd1, 0x8,  0xc5, 0x56,
                   0xb8, 0x26, 0x35, 0xa1, 0x89, 0xd7, 0x50, 0x44, 0x29, 0x79, 0x8,  0x0,  0xa,  0x42, 0x7,  0x65, 0xea,
                   0x1d, 0x94, 0xc0, 0x80, 0x9f, 0x58, 0x19, 0xc4, 0x28, 0x24, 0x2a, 0xba, 0xb,  0x1d, 0x18, 0x0,  0x0,
                   0x5c, 0xfa, 0xb,  0x0,  0x19, 0x6a, 0x23, 0x76, 0x77, 0x13, 0x1d, 0x4,  0x16, 0x0,  0x15, 0x1b, 0xb1,
                   0x7c, 0x40, 0xef, 0x1d, 0xe4, 0x16, 0x54, 0x42, 0x5,  0x2a, 0x1e, 0xf8, 0xd6, 0x6c, 0xf4, 0xac, 0x91,
                   0xed, 0x2f, 0x8,  0x0,  0x9,  0x9f, 0x71, 0x6e, 0xb3, 0x48, 0x35, 0x9e, 0x6b, 0x92, 0x23, 0x29, 0xb6,
                   0x18, 0x0,  0x0,  0x7b, 0x1d, 0x2,  0x0,  0x0,  0x7,  0x32, 0x0,  0x10, 0x74, 0x20, 0x9a, 0x95, 0xe0,
                   0x19, 0x9e, 0x66, 0x45, 0x63, 0xef, 0xf9, 0x36, 0xe7, 0x14, 0x9f, 0x1d, 0x0,  0x7,  0xfd, 0x5c, 0xdc,
                   0xc1, 0x26, 0xd1, 0x5b, 0x2a, 0x0,  0x1,  0x65, 0x2d, 0x0,  0x3,  0x52, 0x5b, 0x26, 0x21, 0x0,  0xa,
                   0x5e, 0xa9, 0x87, 0x88, 0x8f, 0xf1, 0x71, 0xf,  0xfe, 0xfe, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x74, 0x20, 0x9a, 0x95, 0xe0, 0x19, 0x9e, 0x66,
                                     0x45, 0x63, 0xef, 0xf9, 0x36, 0xe7, 0x14, 0x9f};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfd, 0x5c, 0xdc, 0xc1, 0x26, 0xd1, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x52, 0x5b, 0x26};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5e, 0xa9, 0x87, 0x88, 0x8f, 0xf1, 0x71, 0xf, 0xfe, 0xfe};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x20, 0xa8, 0x7c, 0xce, 0x82, 0x26, 0x4e, 0xae, 0x65, 0x6e, 0x32, 0x61, 0x4b, 0x8a};
  uint8_t bytesprops1[] = {0xd7, 0x60, 0xc3, 0x93, 0xd1, 0x8,  0xc5, 0x56,
                           0xb8, 0x26, 0x35, 0xa1, 0x89, 0xd7, 0x50, 0x44};
  uint8_t bytesprops2[] = {0x42, 0x7, 0x65, 0xea, 0x1d, 0x94, 0xc0, 0x80, 0x9f, 0x58};
  uint8_t bytesprops3[] = {0x1b, 0xb1, 0x7c, 0x40, 0xef, 0x1d, 0xe4, 0x16, 0x54, 0x42, 0x5,
                           0x2a, 0x1e, 0xf8, 0xd6, 0x6c, 0xf4, 0xac, 0x91, 0xed, 0x2f};
  uint8_t bytesprops4[] = {0x9f, 0x71, 0x6e, 0xb3, 0x48, 0x35, 0x9e, 0x6b, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23802}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30327}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7428}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10678}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31517}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1842}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23704, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25818 [("\235\&1\a\173\150\175\208\&8",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropSubscriptionIdentifierAvailable
// 144,PropPayloadFormatIndicator 206,PropMaximumPacketSize 27231,PropRequestResponseInformation 156,PropResponseTopic
// "_\211\188\198\192<\aE\211\217\248\139\251y\245\233\166\230P\232d\216\141:\208\131\EOT\130",PropSubscriptionIdentifierAvailable
// 1,PropAuthenticationData
// "\211~\162\CAN\ETBX\231\DEL\SOH\205\177\254\234N\ETB)\216\167\252\DELi\136\222",PropReceiveMaximum
// 2956,PropPayloadFormatIndicator 15,PropUserProperty "a
// (\135\161^\156\ACK\DC2\133/\136T\243\152\236\252\DEL\165MV\227r\128"
// "\235R>\DLE\166&\218\130\157\211\167\NAK{\227\NUL\174\169\191q"]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x89, 0x1,  0x64, 0xda, 0x7b, 0x29, 0x90, 0x1,  0xce, 0x27, 0x0,  0x0,  0x6a, 0x5f, 0x19,
                   0x9c, 0x8,  0x0,  0x1c, 0x5f, 0xd3, 0xbc, 0xc6, 0xc0, 0x3c, 0x7,  0x45, 0xd3, 0xd9, 0xf8, 0x8b,
                   0xfb, 0x79, 0xf5, 0xe9, 0xa6, 0xe6, 0x50, 0xe8, 0x64, 0xd8, 0x8d, 0x3a, 0xd0, 0x83, 0x4,  0x82,
                   0x29, 0x1,  0x16, 0x0,  0x17, 0xd3, 0x7e, 0xa2, 0x18, 0x17, 0x58, 0xe7, 0x7f, 0x1,  0xcd, 0xb1,
                   0xfe, 0xea, 0x4e, 0x17, 0x29, 0xd8, 0xa7, 0xfc, 0x7f, 0x69, 0x88, 0xde, 0x21, 0xb,  0x8c, 0x1,
                   0xf,  0x26, 0x0,  0x18, 0x61, 0x20, 0x28, 0x87, 0xa1, 0x5e, 0x9c, 0x6,  0x12, 0x85, 0x2f, 0x88,
                   0x54, 0xf3, 0x98, 0xec, 0xfc, 0x7f, 0xa5, 0x4d, 0x56, 0xe3, 0x72, 0x80, 0x0,  0x13, 0xeb, 0x52,
                   0x3e, 0x10, 0xa6, 0x26, 0xda, 0x82, 0x9d, 0xd3, 0xa7, 0x15, 0x7b, 0xe3, 0x0,  0xae, 0xa9, 0xbf,
                   0x71, 0x0,  0x8,  0xeb, 0x31, 0x7,  0xad, 0x96, 0xaf, 0xd0, 0x38, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0x31, 0x7, 0xad, 0x96, 0xaf, 0xd0, 0x38};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x5f, 0xd3, 0xbc, 0xc6, 0xc0, 0x3c, 0x7,  0x45, 0xd3, 0xd9, 0xf8, 0x8b, 0xfb, 0x79,
                           0xf5, 0xe9, 0xa6, 0xe6, 0x50, 0xe8, 0x64, 0xd8, 0x8d, 0x3a, 0xd0, 0x83, 0x4,  0x82};
  uint8_t bytesprops1[] = {0xd3, 0x7e, 0xa2, 0x18, 0x17, 0x58, 0xe7, 0x7f, 0x1,  0xcd, 0xb1, 0xfe,
                           0xea, 0x4e, 0x17, 0x29, 0xd8, 0xa7, 0xfc, 0x7f, 0x69, 0x88, 0xde};
  uint8_t bytesprops3[] = {0xeb, 0x52, 0x3e, 0x10, 0xa6, 0x26, 0xda, 0x82, 0x9d, 0xd3,
                           0xa7, 0x15, 0x7b, 0xe3, 0x0,  0xae, 0xa9, 0xbf, 0x71};
  uint8_t bytesprops2[] = {0x61, 0x20, 0x28, 0x87, 0xa1, 0x5e, 0x9c, 0x6,  0x12, 0x85, 0x2f, 0x88,
                           0x54, 0xf3, 0x98, 0xec, 0xfc, 0x7f, 0xa5, 0x4d, 0x56, 0xe3, 0x72, 0x80};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27231}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2956}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops2}, .v = {19, (char*)&bytesprops3}}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25818, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19332 [("-\196\154\190n\186/h\n\161\203p\157Ap",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("~\210\229q\182\141\167%]a\fh\248\233\253\167>\NAKu\US\STX\133:",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\144;#\ENQ\236h-\ETX\243\164R3\237\241\129\171\225",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\254\167a\227\GS\169X\240\139\CAN\242\212K\164g]T\203\246\141",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\252=6J\200\227L",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("U\199y\ETX\222\t\"\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS2}),("\202\SUB\220\214,g\158Ugne6\221\DLE\222}n\252\&1w/\NUL\171\244vou",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("-\SO\230DQ\130\178\\\129\&2i",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\205\132\136\DC2y",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ACK)\174\200\186",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\140\197o\USH\162P\197x$\209\218\SI\172\GS\176\147\204\148\CAN\226\CAN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropServerReference
// "`\SYN\DC1\153a\bn{xL\165p\242}?",PropAuthenticationData "\158\156\v\243) '4}}\SUB-\a",PropSessionExpiryInterval
// 15033,PropContentType "",PropSharedSubscriptionAvailable 192,PropAuthenticationData
// "\200\178\228\203i\203\185\US\135\170\v\227r\239\151\&6\EOT\141d\196&\241\145\234\179",PropUserProperty
// "\151\SUB\174\204\214\158" "T\138\253u\229\193!\158+\145J",PropReasonString
// "\252%8\154V\233\204\191\241\DC3l\244\DC4\246\252|`",PropSharedSubscriptionAvailable 67,PropReasonString
// "\STX",PropAssignedClientIdentifier
// "m2\197\179\208\191\193\230\181\DC3\168\137?.\ENQ\US\145RM\158(",PropMessageExpiryInterval
// 29660,PropMaximumPacketSize 2329,PropSubscriptionIdentifier 21,PropAuthenticationMethod
// "\RS)C&E\143m\241\169\US\205e<+\240@\220\254\172\169\241\SIc9\141",PropResponseTopic
// "\SYN*\216!\139\&1\224\&5K=\147K1\145\149:\133rB\156{\GS\188-",PropMessageExpiryInterval
// 1646,PropSubscriptionIdentifierAvailable 78,PropWillDelayInterval 23060,PropSubscriptionIdentifierAvailable 83]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x82, 0xa6, 0x3,  0x4b, 0x84, 0xe1, 0x1,  0x1c, 0x0,  0xf,  0x60, 0x16, 0x11, 0x99, 0x61, 0x8,  0x6e, 0x7b, 0x78,
      0x4c, 0xa5, 0x70, 0xf2, 0x7d, 0x3f, 0x16, 0x0,  0xd,  0x9e, 0x9c, 0xb,  0xf3, 0x29, 0x20, 0x27, 0x34, 0x7d, 0x7d,
      0x1a, 0x2d, 0x7,  0x11, 0x0,  0x0,  0x3a, 0xb9, 0x3,  0x0,  0x0,  0x2a, 0xc0, 0x16, 0x0,  0x19, 0xc8, 0xb2, 0xe4,
      0xcb, 0x69, 0xcb, 0xb9, 0x1f, 0x87, 0xaa, 0xb,  0xe3, 0x72, 0xef, 0x97, 0x36, 0x4,  0x8d, 0x64, 0xc4, 0x26, 0xf1,
      0x91, 0xea, 0xb3, 0x26, 0x0,  0x6,  0x97, 0x1a, 0xae, 0xcc, 0xd6, 0x9e, 0x0,  0xb,  0x54, 0x8a, 0xfd, 0x75, 0xe5,
      0xc1, 0x21, 0x9e, 0x2b, 0x91, 0x4a, 0x1f, 0x0,  0x11, 0xfc, 0x25, 0x38, 0x9a, 0x56, 0xe9, 0xcc, 0xbf, 0xf1, 0x13,
      0x6c, 0xf4, 0x14, 0xf6, 0xfc, 0x7c, 0x60, 0x2a, 0x43, 0x1f, 0x0,  0x1,  0x2,  0x12, 0x0,  0x15, 0x6d, 0x32, 0xc5,
      0xb3, 0xd0, 0xbf, 0xc1, 0xe6, 0xb5, 0x13, 0xa8, 0x89, 0x3f, 0x2e, 0x5,  0x1f, 0x91, 0x52, 0x4d, 0x9e, 0x28, 0x2,
      0x0,  0x0,  0x73, 0xdc, 0x27, 0x0,  0x0,  0x9,  0x19, 0xb,  0x15, 0x15, 0x0,  0x19, 0x1e, 0x29, 0x43, 0x26, 0x45,
      0x8f, 0x6d, 0xf1, 0xa9, 0x1f, 0xcd, 0x65, 0x3c, 0x2b, 0xf0, 0x40, 0xdc, 0xfe, 0xac, 0xa9, 0xf1, 0xf,  0x63, 0x39,
      0x8d, 0x8,  0x0,  0x18, 0x16, 0x2a, 0xd8, 0x21, 0x8b, 0x31, 0xe0, 0x35, 0x4b, 0x3d, 0x93, 0x4b, 0x31, 0x91, 0x95,
      0x3a, 0x85, 0x72, 0x42, 0x9c, 0x7b, 0x1d, 0xbc, 0x2d, 0x2,  0x0,  0x0,  0x6,  0x6e, 0x29, 0x4e, 0x18, 0x0,  0x0,
      0x5a, 0x14, 0x29, 0x53, 0x0,  0xf,  0x2d, 0xc4, 0x9a, 0xbe, 0x6e, 0xba, 0x2f, 0x68, 0xa,  0xa1, 0xcb, 0x70, 0x9d,
      0x41, 0x70, 0x4,  0x0,  0x17, 0x7e, 0xd2, 0xe5, 0x71, 0xb6, 0x8d, 0xa7, 0x25, 0x5d, 0x61, 0xc,  0x68, 0xf8, 0xe9,
      0xfd, 0xa7, 0x3e, 0x15, 0x75, 0x1f, 0x2,  0x85, 0x3a, 0x22, 0x0,  0x11, 0x90, 0x3b, 0x23, 0x5,  0xec, 0x68, 0x2d,
      0x3,  0xf3, 0xa4, 0x52, 0x33, 0xed, 0xf1, 0x81, 0xab, 0xe1, 0x14, 0x0,  0x14, 0xfe, 0xa7, 0x61, 0xe3, 0x1d, 0xa9,
      0x58, 0xf0, 0x8b, 0x18, 0xf2, 0xd4, 0x4b, 0xa4, 0x67, 0x5d, 0x54, 0xcb, 0xf6, 0x8d, 0x1d, 0x0,  0x7,  0xfc, 0x3d,
      0x36, 0x4a, 0xc8, 0xe3, 0x4c, 0xe,  0x0,  0x8,  0x55, 0xc7, 0x79, 0x3,  0xde, 0x9,  0x22, 0xe8, 0xe,  0x0,  0x1b,
      0xca, 0x1a, 0xdc, 0xd6, 0x2c, 0x67, 0x9e, 0x55, 0x67, 0x6e, 0x65, 0x36, 0xdd, 0x10, 0xde, 0x7d, 0x6e, 0xfc, 0x31,
      0x77, 0x2f, 0x0,  0xab, 0xf4, 0x76, 0x6f, 0x75, 0x1d, 0x0,  0xb,  0x2d, 0xe,  0xe6, 0x44, 0x51, 0x82, 0xb2, 0x5c,
      0x81, 0x32, 0x69, 0x2c, 0x0,  0x5,  0xcd, 0x84, 0x88, 0x12, 0x79, 0x20, 0x0,  0x5,  0x6,  0x29, 0xae, 0xc8, 0xba,
      0x11, 0x0,  0x16, 0x8c, 0xc5, 0x6f, 0x1f, 0x48, 0xa2, 0x50, 0xc5, 0x78, 0x24, 0xd1, 0xda, 0xf,  0xac, 0x1d, 0xb0,
      0x93, 0xcc, 0x94, 0x18, 0xe2, 0x18, 0xe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2d, 0xc4, 0x9a, 0xbe, 0x6e, 0xba, 0x2f, 0x68,
                                     0xa,  0xa1, 0xcb, 0x70, 0x9d, 0x41, 0x70};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0xd2, 0xe5, 0x71, 0xb6, 0x8d, 0xa7, 0x25, 0x5d, 0x61, 0xc, 0x68,
                                     0xf8, 0xe9, 0xfd, 0xa7, 0x3e, 0x15, 0x75, 0x1f, 0x2,  0x85, 0x3a};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x90, 0x3b, 0x23, 0x5,  0xec, 0x68, 0x2d, 0x3, 0xf3,
                                     0xa4, 0x52, 0x33, 0xed, 0xf1, 0x81, 0xab, 0xe1};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfe, 0xa7, 0x61, 0xe3, 0x1d, 0xa9, 0x58, 0xf0, 0x8b, 0x18,
                                     0xf2, 0xd4, 0x4b, 0xa4, 0x67, 0x5d, 0x54, 0xcb, 0xf6, 0x8d};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfc, 0x3d, 0x36, 0x4a, 0xc8, 0xe3, 0x4c};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0xc7, 0x79, 0x3, 0xde, 0x9, 0x22, 0xe8};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0x1a, 0xdc, 0xd6, 0x2c, 0x67, 0x9e, 0x55, 0x67, 0x6e, 0x65, 0x36, 0xdd, 0x10,
                                     0xde, 0x7d, 0x6e, 0xfc, 0x31, 0x77, 0x2f, 0x0,  0xab, 0xf4, 0x76, 0x6f, 0x75};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2d, 0xe, 0xe6, 0x44, 0x51, 0x82, 0xb2, 0x5c, 0x81, 0x32, 0x69};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xcd, 0x84, 0x88, 0x12, 0x79};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6, 0x29, 0xae, 0xc8, 0xba};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x8c, 0xc5, 0x6f, 0x1f, 0x48, 0xa2, 0x50, 0xc5, 0x78, 0x24, 0xd1,
                                      0xda, 0xf,  0xac, 0x1d, 0xb0, 0x93, 0xcc, 0x94, 0x18, 0xe2, 0x18};
  lwmqtt_string_t topic_filter_s10 = {22, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x60, 0x16, 0x11, 0x99, 0x61, 0x8, 0x6e, 0x7b, 0x78, 0x4c, 0xa5, 0x70, 0xf2, 0x7d, 0x3f};
  uint8_t bytesprops1[] = {0x9e, 0x9c, 0xb, 0xf3, 0x29, 0x20, 0x27, 0x34, 0x7d, 0x7d, 0x1a, 0x2d, 0x7};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0xc8, 0xb2, 0xe4, 0xcb, 0x69, 0xcb, 0xb9, 0x1f, 0x87, 0xaa, 0xb,  0xe3, 0x72,
                           0xef, 0x97, 0x36, 0x4,  0x8d, 0x64, 0xc4, 0x26, 0xf1, 0x91, 0xea, 0xb3};
  uint8_t bytesprops5[] = {0x54, 0x8a, 0xfd, 0x75, 0xe5, 0xc1, 0x21, 0x9e, 0x2b, 0x91, 0x4a};
  uint8_t bytesprops4[] = {0x97, 0x1a, 0xae, 0xcc, 0xd6, 0x9e};
  uint8_t bytesprops6[] = {0xfc, 0x25, 0x38, 0x9a, 0x56, 0xe9, 0xcc, 0xbf, 0xf1,
                           0x13, 0x6c, 0xf4, 0x14, 0xf6, 0xfc, 0x7c, 0x60};
  uint8_t bytesprops7[] = {0x2};
  uint8_t bytesprops8[] = {0x6d, 0x32, 0xc5, 0xb3, 0xd0, 0xbf, 0xc1, 0xe6, 0xb5, 0x13, 0xa8,
                           0x89, 0x3f, 0x2e, 0x5,  0x1f, 0x91, 0x52, 0x4d, 0x9e, 0x28};
  uint8_t bytesprops9[] = {0x1e, 0x29, 0x43, 0x26, 0x45, 0x8f, 0x6d, 0xf1, 0xa9, 0x1f, 0xcd, 0x65, 0x3c,
                           0x2b, 0xf0, 0x40, 0xdc, 0xfe, 0xac, 0xa9, 0xf1, 0xf,  0x63, 0x39, 0x8d};
  uint8_t bytesprops10[] = {0x16, 0x2a, 0xd8, 0x21, 0x8b, 0x31, 0xe0, 0x35, 0x4b, 0x3d, 0x93, 0x4b,
                            0x31, 0x91, 0x95, 0x3a, 0x85, 0x72, 0x42, 0x9c, 0x7b, 0x1d, 0xbc, 0x2d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15033}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops4}, .v = {11, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29660}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2329}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1646}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23060}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 83}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19332, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20518 [("\184",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\208\138rec7\DLE\135k\b\245\159\135\&8\198\&0x\EM\188\ESC",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("OC{\222\a\203\253\158#\181\203J&\a\179\STX6\141\175\135\212QE\DC4<\207",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("qa\DC3x\197\165\234`\236\156",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS2}),("j\241\241/\244.\251\220v\185(f\144\147\f\170\246\219",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("f\189\233W\169\244b\222\169",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] [PropAuthenticationMethod
// "\227\218\145n\182T\238|~i\ESCZ^_",PropRequestProblemInformation 24,PropSubscriptionIdentifierAvailable
// 55,PropReasonString "!\214\143:~",PropAuthenticationData "\202\140\159J\245\154 '4\159\238\DC1\141",PropTopicAlias
// 10438,PropTopicAlias 6509,PropTopicAlias 30518,PropPayloadFormatIndicator 101,PropRequestResponseInformation
// 103,PropSharedSubscriptionAvailable 143,PropSessionExpiryInterval 5218,PropWillDelayInterval
// 31083,PropServerReference "\147\235[N\214*\128\&0",PropSessionExpiryInterval 19195,PropResponseTopic
// "\197",PropPayloadFormatIndicator 100,PropServerReference
// "\209K\246A\176\192<\CAN\219\ETB\132\190\219\152H\176R\CAN\205\253\170\\`!l\195\a\DC2\DLEL",PropReasonString
// "\160\&2\210#\DC3\DC3\160\230\251\211\243\202\217\226\142\151_S\EOT}?\SO\166\222\EM6\159\175\EOT",PropMaximumPacketSize
// 21571,PropUserProperty "\STX\154\CAN\169jr\241\202P"
// "k\ESC\182\EM[\251\251\184\&7ah9\214\211\156J#\251\136\145\227I\185",PropMessageExpiryInterval
// 5854,PropSubscriptionIdentifier 28]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x82, 0xbb, 0x2,  0x50, 0x26, 0xce, 0x1,  0x15, 0x0,  0xe,  0xe3, 0xda, 0x91, 0x6e, 0xb6, 0x54, 0xee, 0x7c, 0x7e,
      0x69, 0x1b, 0x5a, 0x5e, 0x5f, 0x17, 0x18, 0x29, 0x37, 0x1f, 0x0,  0x5,  0x21, 0xd6, 0x8f, 0x3a, 0x7e, 0x16, 0x0,
      0xd,  0xca, 0x8c, 0x9f, 0x4a, 0xf5, 0x9a, 0x20, 0x27, 0x34, 0x9f, 0xee, 0x11, 0x8d, 0x23, 0x28, 0xc6, 0x23, 0x19,
      0x6d, 0x23, 0x77, 0x36, 0x1,  0x65, 0x19, 0x67, 0x2a, 0x8f, 0x11, 0x0,  0x0,  0x14, 0x62, 0x18, 0x0,  0x0,  0x79,
      0x6b, 0x1c, 0x0,  0x8,  0x93, 0xeb, 0x5b, 0x4e, 0xd6, 0x2a, 0x80, 0x30, 0x11, 0x0,  0x0,  0x4a, 0xfb, 0x8,  0x0,
      0x1,  0xc5, 0x1,  0x64, 0x1c, 0x0,  0x1e, 0xd1, 0x4b, 0xf6, 0x41, 0xb0, 0xc0, 0x3c, 0x18, 0xdb, 0x17, 0x84, 0xbe,
      0xdb, 0x98, 0x48, 0xb0, 0x52, 0x18, 0xcd, 0xfd, 0xaa, 0x5c, 0x60, 0x21, 0x6c, 0xc3, 0x7,  0x12, 0x10, 0x4c, 0x1f,
      0x0,  0x1d, 0xa0, 0x32, 0xd2, 0x23, 0x13, 0x13, 0xa0, 0xe6, 0xfb, 0xd3, 0xf3, 0xca, 0xd9, 0xe2, 0x8e, 0x97, 0x5f,
      0x53, 0x4,  0x7d, 0x3f, 0xe,  0xa6, 0xde, 0x19, 0x36, 0x9f, 0xaf, 0x4,  0x27, 0x0,  0x0,  0x54, 0x43, 0x26, 0x0,
      0x9,  0x2,  0x9a, 0x18, 0xa9, 0x6a, 0x72, 0xf1, 0xca, 0x50, 0x0,  0x17, 0x6b, 0x1b, 0xb6, 0x19, 0x5b, 0xfb, 0xfb,
      0xb8, 0x37, 0x61, 0x68, 0x39, 0xd6, 0xd3, 0x9c, 0x4a, 0x23, 0xfb, 0x88, 0x91, 0xe3, 0x49, 0xb9, 0x2,  0x0,  0x0,
      0x16, 0xde, 0xb,  0x1c, 0x0,  0x1,  0xb8, 0x11, 0x0,  0x14, 0xd0, 0x8a, 0x72, 0x65, 0x63, 0x37, 0x10, 0x87, 0x6b,
      0x8,  0xf5, 0x9f, 0x87, 0x38, 0xc6, 0x30, 0x78, 0x19, 0xbc, 0x1b, 0x24, 0x0,  0x0,  0xd,  0x0,  0x1a, 0x4f, 0x43,
      0x7b, 0xde, 0x7,  0xcb, 0xfd, 0x9e, 0x23, 0xb5, 0xcb, 0x4a, 0x26, 0x7,  0xb3, 0x2,  0x36, 0x8d, 0xaf, 0x87, 0xd4,
      0x51, 0x45, 0x14, 0x3c, 0xcf, 0xc,  0x0,  0xa,  0x71, 0x61, 0x13, 0x78, 0xc5, 0xa5, 0xea, 0x60, 0xec, 0x9c, 0xe,
      0x0,  0x12, 0x6a, 0xf1, 0xf1, 0x2f, 0xf4, 0x2e, 0xfb, 0xdc, 0x76, 0xb9, 0x28, 0x66, 0x90, 0x93, 0xc,  0xaa, 0xf6,
      0xdb, 0xc,  0x0,  0x9,  0x66, 0xbd, 0xe9, 0x57, 0xa9, 0xf4, 0x62, 0xde, 0xa9, 0x21};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xb8};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x8a, 0x72, 0x65, 0x63, 0x37, 0x10, 0x87, 0x6b, 0x8,
                                     0xf5, 0x9f, 0x87, 0x38, 0xc6, 0x30, 0x78, 0x19, 0xbc, 0x1b};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4f, 0x43, 0x7b, 0xde, 0x7,  0xcb, 0xfd, 0x9e, 0x23, 0xb5, 0xcb, 0x4a, 0x26,
                                     0x7,  0xb3, 0x2,  0x36, 0x8d, 0xaf, 0x87, 0xd4, 0x51, 0x45, 0x14, 0x3c, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x71, 0x61, 0x13, 0x78, 0xc5, 0xa5, 0xea, 0x60, 0xec, 0x9c};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0xf1, 0xf1, 0x2f, 0xf4, 0x2e, 0xfb, 0xdc, 0x76,
                                     0xb9, 0x28, 0x66, 0x90, 0x93, 0xc,  0xaa, 0xf6, 0xdb};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x66, 0xbd, 0xe9, 0x57, 0xa9, 0xf4, 0x62, 0xde, 0xa9};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  uint8_t bytesprops0[] = {0xe3, 0xda, 0x91, 0x6e, 0xb6, 0x54, 0xee, 0x7c, 0x7e, 0x69, 0x1b, 0x5a, 0x5e, 0x5f};
  uint8_t bytesprops1[] = {0x21, 0xd6, 0x8f, 0x3a, 0x7e};
  uint8_t bytesprops2[] = {0xca, 0x8c, 0x9f, 0x4a, 0xf5, 0x9a, 0x20, 0x27, 0x34, 0x9f, 0xee, 0x11, 0x8d};
  uint8_t bytesprops3[] = {0x93, 0xeb, 0x5b, 0x4e, 0xd6, 0x2a, 0x80, 0x30};
  uint8_t bytesprops4[] = {0xc5};
  uint8_t bytesprops5[] = {0xd1, 0x4b, 0xf6, 0x41, 0xb0, 0xc0, 0x3c, 0x18, 0xdb, 0x17, 0x84, 0xbe, 0xdb, 0x98, 0x48,
                           0xb0, 0x52, 0x18, 0xcd, 0xfd, 0xaa, 0x5c, 0x60, 0x21, 0x6c, 0xc3, 0x7,  0x12, 0x10, 0x4c};
  uint8_t bytesprops6[] = {0xa0, 0x32, 0xd2, 0x23, 0x13, 0x13, 0xa0, 0xe6, 0xfb, 0xd3, 0xf3, 0xca, 0xd9, 0xe2, 0x8e,
                           0x97, 0x5f, 0x53, 0x4,  0x7d, 0x3f, 0xe,  0xa6, 0xde, 0x19, 0x36, 0x9f, 0xaf, 0x4};
  uint8_t bytesprops8[] = {0x6b, 0x1b, 0xb6, 0x19, 0x5b, 0xfb, 0xfb, 0xb8, 0x37, 0x61, 0x68, 0x39,
                           0xd6, 0xd3, 0x9c, 0x4a, 0x23, 0xfb, 0x88, 0x91, 0xe3, 0x49, 0xb9};
  uint8_t bytesprops7[] = {0x2, 0x9a, 0x18, 0xa9, 0x6a, 0x72, 0xf1, 0xca, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10438}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6509}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30518}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5218}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31083}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19195}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21571}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops7}, .v = {23, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5854}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20518, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4648 [("\172K\233\189\190\a>\228I\131=\247\DEL\255",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("d\206\145J",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\192\f%\166\NAK\218D3Q\180\233O'N\DC39i5\236\&2r",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\195\233]\b\254s\198E",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\161\EOTL\192\&7\180m\152*\178,\241`\199\167 ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\159\FS\203g6+\169\183\247\253\137\168\SO\174\243\r\EOT\tH\EOTkQ\a)G#:7\204\DC3",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\RSB)}\225\170\218\238\205\247",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] [PropUserProperty "\242\203\"\220\218\214"
// "\NUL?\DC4<d\148\&3\170\129/\199>\232\&9\208]\208\NULW\154\185\177\STX\254",PropReceiveMaximum
// 4372,PropSubscriptionIdentifier 15,PropPayloadFormatIndicator 95,PropReasonString
// "D\170\DC2d\148:\f\220\164\254\174",PropSubscriptionIdentifierAvailable 122,PropMaximumQoS 207,PropServerKeepAlive
// 3358,PropMaximumQoS 74,PropWillDelayInterval 18357]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0xc5, 0x1,  0x12, 0x28, 0x46, 0x26, 0x0,  0x6,  0xf2, 0xcb, 0x22, 0xdc, 0xda, 0xd6, 0x0,  0x18,
                   0x0,  0x3f, 0x14, 0x3c, 0x64, 0x94, 0x33, 0xaa, 0x81, 0x2f, 0xc7, 0x3e, 0xe8, 0x39, 0xd0, 0x5d, 0xd0,
                   0x0,  0x57, 0x9a, 0xb9, 0xb1, 0x2,  0xfe, 0x21, 0x11, 0x14, 0xb,  0xf,  0x1,  0x5f, 0x1f, 0x0,  0xb,
                   0x44, 0xaa, 0x12, 0x64, 0x94, 0x3a, 0xc,  0xdc, 0xa4, 0xfe, 0xae, 0x29, 0x7a, 0x24, 0xcf, 0x13, 0xd,
                   0x1e, 0x24, 0x4a, 0x18, 0x0,  0x0,  0x47, 0xb5, 0x0,  0xe,  0xac, 0x4b, 0xe9, 0xbd, 0xbe, 0x7,  0x3e,
                   0xe4, 0x49, 0x83, 0x3d, 0xf7, 0x7f, 0xff, 0x14, 0x0,  0x4,  0x64, 0xce, 0x91, 0x4a, 0x1,  0x0,  0x15,
                   0xc0, 0xc,  0x25, 0xa6, 0x15, 0xda, 0x44, 0x33, 0x51, 0xb4, 0xe9, 0x4f, 0x27, 0x4e, 0x13, 0x39, 0x69,
                   0x35, 0xec, 0x32, 0x72, 0x2,  0x0,  0x8,  0xc3, 0xe9, 0x5d, 0x8,  0xfe, 0x73, 0xc6, 0x45, 0x2e, 0x0,
                   0x10, 0xa1, 0x4,  0x4c, 0xc0, 0x37, 0xb4, 0x6d, 0x98, 0x2a, 0xb2, 0x2c, 0xf1, 0x60, 0xc7, 0xa7, 0x20,
                   0x8,  0x0,  0x1e, 0x9f, 0x1c, 0xcb, 0x67, 0x36, 0x2b, 0xa9, 0xb7, 0xf7, 0xfd, 0x89, 0xa8, 0xe,  0xae,
                   0xf3, 0xd,  0x4,  0x9,  0x48, 0x4,  0x6b, 0x51, 0x7,  0x29, 0x47, 0x23, 0x3a, 0x37, 0xcc, 0x13, 0x18,
                   0x0,  0xa,  0x1e, 0x42, 0x29, 0x7d, 0xe1, 0xaa, 0xda, 0xee, 0xcd, 0xf7, 0x12};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xac, 0x4b, 0xe9, 0xbd, 0xbe, 0x7, 0x3e, 0xe4, 0x49, 0x83, 0x3d, 0xf7, 0x7f, 0xff};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x64, 0xce, 0x91, 0x4a};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc0, 0xc,  0x25, 0xa6, 0x15, 0xda, 0x44, 0x33, 0x51, 0xb4, 0xe9,
                                     0x4f, 0x27, 0x4e, 0x13, 0x39, 0x69, 0x35, 0xec, 0x32, 0x72};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc3, 0xe9, 0x5d, 0x8, 0xfe, 0x73, 0xc6, 0x45};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa1, 0x4,  0x4c, 0xc0, 0x37, 0xb4, 0x6d, 0x98,
                                     0x2a, 0xb2, 0x2c, 0xf1, 0x60, 0xc7, 0xa7, 0x20};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9f, 0x1c, 0xcb, 0x67, 0x36, 0x2b, 0xa9, 0xb7, 0xf7, 0xfd,
                                     0x89, 0xa8, 0xe,  0xae, 0xf3, 0xd,  0x4,  0x9,  0x48, 0x4,
                                     0x6b, 0x51, 0x7,  0x29, 0x47, 0x23, 0x3a, 0x37, 0xcc, 0x13};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1e, 0x42, 0x29, 0x7d, 0xe1, 0xaa, 0xda, 0xee, 0xcd, 0xf7};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  uint8_t bytesprops1[] = {0x0,  0x3f, 0x14, 0x3c, 0x64, 0x94, 0x33, 0xaa, 0x81, 0x2f, 0xc7, 0x3e,
                           0xe8, 0x39, 0xd0, 0x5d, 0xd0, 0x0,  0x57, 0x9a, 0xb9, 0xb1, 0x2,  0xfe};
  uint8_t bytesprops0[] = {0xf2, 0xcb, 0x22, 0xdc, 0xda, 0xd6};
  uint8_t bytesprops2[] = {0x44, 0xaa, 0x12, 0x64, 0x94, 0x3a, 0xc, 0xdc, 0xa4, 0xfe, 0xae};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {24, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4372}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3358}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18357}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4648, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13920 [(";q\215\241\130b\220s",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropMessageExpiryInterval
// 7604,PropResponseInformation "\194\181\171\148\138l\NUL\194\229\254m\134@\245\194\170\234",PropUserProperty
// "M\f\245\229\241Y\130\152\DEL8/fJ\193\139\DLE\243\146\134UC`\151,\229\237\132K\235"
// "\254f'G\236UH\222",PropMaximumQoS 22,PropRequestProblemInformation 80,PropAuthenticationMethod
// "\169\&7\177v.=\237Z\184Q\186\RS\222",PropMessageExpiryInterval 31770,PropSubscriptionIdentifier
// 15,PropAuthenticationData "\151m[ZUo]\141\131\195e\181\SOH\168\ETB5C\248",PropTopicAlias
// 32243,PropSubscriptionIdentifierAvailable 45,PropReceiveMaximum 9546,PropMaximumPacketSize
// 28536,PropSubscriptionIdentifier 25,PropRetainAvailable 82,PropContentType
// "\198\148\179\174G\212\153HId\187\208\181f\SOH\182\255X\140/\189\214\244<\145-",PropUserProperty
// "\v\221I\226\230\174|\SOH|\161\176_\210\US\ETBwW\244\255z\EMI56"
// "7\176\134\192`\226i1\223\146b\221\140\&8#\DC3c\129",PropSessionExpiryInterval 23112,PropWillDelayInterval
// 3222,PropServerReference "",PropSubscriptionIdentifierAvailable 39,PropTopicAliasMaximum 26662]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x82, 0xf1, 0x1,  0x36, 0x60, 0xe2, 0x1,  0x2,  0x0,  0x0,  0x1d, 0xb4, 0x1a, 0x0,  0x11, 0xc2, 0xb5, 0xab, 0x94,
      0x8a, 0x6c, 0x0,  0xc2, 0xe5, 0xfe, 0x6d, 0x86, 0x40, 0xf5, 0xc2, 0xaa, 0xea, 0x26, 0x0,  0x1d, 0x4d, 0xc,  0xf5,
      0xe5, 0xf1, 0x59, 0x82, 0x98, 0x7f, 0x38, 0x2f, 0x66, 0x4a, 0xc1, 0x8b, 0x10, 0xf3, 0x92, 0x86, 0x55, 0x43, 0x60,
      0x97, 0x2c, 0xe5, 0xed, 0x84, 0x4b, 0xeb, 0x0,  0x8,  0xfe, 0x66, 0x27, 0x47, 0xec, 0x55, 0x48, 0xde, 0x24, 0x16,
      0x17, 0x50, 0x15, 0x0,  0xd,  0xa9, 0x37, 0xb1, 0x76, 0x2e, 0x3d, 0xed, 0x5a, 0xb8, 0x51, 0xba, 0x1e, 0xde, 0x2,
      0x0,  0x0,  0x7c, 0x1a, 0xb,  0xf,  0x16, 0x0,  0x12, 0x97, 0x6d, 0x5b, 0x5a, 0x55, 0x6f, 0x5d, 0x8d, 0x83, 0xc3,
      0x65, 0xb5, 0x1,  0xa8, 0x17, 0x35, 0x43, 0xf8, 0x23, 0x7d, 0xf3, 0x29, 0x2d, 0x21, 0x25, 0x4a, 0x27, 0x0,  0x0,
      0x6f, 0x78, 0xb,  0x19, 0x25, 0x52, 0x3,  0x0,  0x1a, 0xc6, 0x94, 0xb3, 0xae, 0x47, 0xd4, 0x99, 0x48, 0x49, 0x64,
      0xbb, 0xd0, 0xb5, 0x66, 0x1,  0xb6, 0xff, 0x58, 0x8c, 0x2f, 0xbd, 0xd6, 0xf4, 0x3c, 0x91, 0x2d, 0x26, 0x0,  0x18,
      0xb,  0xdd, 0x49, 0xe2, 0xe6, 0xae, 0x7c, 0x1,  0x7c, 0xa1, 0xb0, 0x5f, 0xd2, 0x1f, 0x17, 0x77, 0x57, 0xf4, 0xff,
      0x7a, 0x19, 0x49, 0x35, 0x36, 0x0,  0x12, 0x37, 0xb0, 0x86, 0xc0, 0x60, 0xe2, 0x69, 0x31, 0xdf, 0x92, 0x62, 0xdd,
      0x8c, 0x38, 0x23, 0x13, 0x63, 0x81, 0x11, 0x0,  0x0,  0x5a, 0x48, 0x18, 0x0,  0x0,  0xc,  0x96, 0x1c, 0x0,  0x0,
      0x29, 0x27, 0x22, 0x68, 0x26, 0x0,  0x8,  0x3b, 0x71, 0xd7, 0xf1, 0x82, 0x62, 0xdc, 0x73, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0x71, 0xd7, 0xf1, 0x82, 0x62, 0xdc, 0x73};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0xc2, 0xb5, 0xab, 0x94, 0x8a, 0x6c, 0x0,  0xc2, 0xe5,
                           0xfe, 0x6d, 0x86, 0x40, 0xf5, 0xc2, 0xaa, 0xea};
  uint8_t bytesprops2[] = {0xfe, 0x66, 0x27, 0x47, 0xec, 0x55, 0x48, 0xde};
  uint8_t bytesprops1[] = {0x4d, 0xc,  0xf5, 0xe5, 0xf1, 0x59, 0x82, 0x98, 0x7f, 0x38, 0x2f, 0x66, 0x4a, 0xc1, 0x8b,
                           0x10, 0xf3, 0x92, 0x86, 0x55, 0x43, 0x60, 0x97, 0x2c, 0xe5, 0xed, 0x84, 0x4b, 0xeb};
  uint8_t bytesprops3[] = {0xa9, 0x37, 0xb1, 0x76, 0x2e, 0x3d, 0xed, 0x5a, 0xb8, 0x51, 0xba, 0x1e, 0xde};
  uint8_t bytesprops4[] = {0x97, 0x6d, 0x5b, 0x5a, 0x55, 0x6f, 0x5d, 0x8d, 0x83,
                           0xc3, 0x65, 0xb5, 0x1,  0xa8, 0x17, 0x35, 0x43, 0xf8};
  uint8_t bytesprops5[] = {0xc6, 0x94, 0xb3, 0xae, 0x47, 0xd4, 0x99, 0x48, 0x49, 0x64, 0xbb, 0xd0, 0xb5,
                           0x66, 0x1,  0xb6, 0xff, 0x58, 0x8c, 0x2f, 0xbd, 0xd6, 0xf4, 0x3c, 0x91, 0x2d};
  uint8_t bytesprops7[] = {0x37, 0xb0, 0x86, 0xc0, 0x60, 0xe2, 0x69, 0x31, 0xdf,
                           0x92, 0x62, 0xdd, 0x8c, 0x38, 0x23, 0x13, 0x63, 0x81};
  uint8_t bytesprops6[] = {0xb,  0xdd, 0x49, 0xe2, 0xe6, 0xae, 0x7c, 0x1,  0x7c, 0xa1, 0xb0, 0x5f,
                           0xd2, 0x1f, 0x17, 0x77, 0x57, 0xf4, 0xff, 0x7a, 0x19, 0x49, 0x35, 0x36};
  uint8_t bytesprops8[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7604}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31770}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32243}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9546}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28536}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops6}, .v = {18, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23112}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3222}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26662}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13920, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 4646 [Right QoS1,Left SubErrUnspecifiedError,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right
// QoS0,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0xb, 0x12, 0x26, 0x1, 0x80, 0x2, 0xa1, 0x1, 0x1, 0xa2, 0x0, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4646);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 3536 [Right QoS1,Left SubErrUnspecifiedError,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x5, 0xd, 0xd0, 0x1, 0x80, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3536);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 13945 [Left SubErrPacketIdentifierInUse,Right QoS1] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x4, 0x36, 0x79, 0x91, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13945);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
}

// SubscribeResponse 27071 [Right QoS0,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0xa, 0x69, 0xbf, 0x0, 0x1, 0xa2, 0x0, 0x80, 0x2, 0xa2, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27071);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
}

// SubscribeResponse 29147 [Right QoS2,Right QoS2,Left SubErrImplementationSpecificError,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x8, 0x71, 0xdb, 0x2, 0x2, 0x83, 0x80, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29147);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
}

// SubscribeResponse 9531 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Left
// SubErrTopicFilterInvalid,Right QoS1,Left SubErrNotAuthorized,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0xc, 0x25, 0x3b, 0x1, 0xa1, 0x2, 0x8f, 0x1, 0x87, 0x0, 0x9e, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9531);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 30374 [Left SubErrQuotaExceeded,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x4, 0x76, 0xa6, 0x97, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30374);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 8812 [Right QoS0,Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrTopicFilterInvalid,Right QoS0,Right QoS2,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0xb, 0x22, 0x6c, 0x0, 0x2, 0x91, 0x1, 0x8f, 0x0, 0x2, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8812);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 31341 [Left SubErrImplementationSpecificError,Right QoS2,Left SubErrQuotaExceeded,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS1] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0xa, 0x7a, 0x6d, 0x83, 0x2, 0x97, 0x1, 0x9e, 0x91, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31341);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 16134 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Left
// SubErrNotAuthorized,Right QoS1,Right QoS0,Left SubErrUnspecifiedError,Right QoS1] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0xa, 0x3f, 0x6, 0x1, 0xa1, 0x1, 0x87, 0x1, 0x0, 0x80, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16134);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 27712 [Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Right QoS0] []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x5, 0x6c, 0x40, 0x83, 0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27712);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 23389 [Right QoS2,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right
// QoS2,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x8, 0x5b, 0x5d, 0x2, 0x1, 0xa2, 0x0, 0x2, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23389);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 3364 [Right QoS0,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x4, 0xd, 0x24, 0x0, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3364);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 8138 [Right QoS0,Right QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0x5, 0x1f, 0xca, 0x0, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8138);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 7647 [Left SubErrTopicFilterInvalid,Left SubErrNotAuthorized,Left SubErrTopicFilterInvalid,Left
// SubErrUnspecifiedError,Left SubErrQuotaExceeded,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrQuotaExceeded,Left SubErrNotAuthorized,Left SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0xb, 0x1d, 0xdf, 0x8f, 0x87, 0x8f, 0x80, 0x97, 0xa1, 0x97, 0x87, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7647);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 4989 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x4, 0x13, 0x7d, 0x1, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4989);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 12633 [Right QoS2,Right QoS0,Right QoS0,Right QoS1] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x6, 0x31, 0x59, 0x2, 0x0, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12633);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
}

// SubscribeResponse 1188 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x4, 0x4, 0xa4, 0x0, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1188);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 17587 [Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrTopicFilterInvalid,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS1,Right QoS0,Left
// SubErrNotAuthorized,Right QoS0] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xc, 0x44, 0xb3, 0x0, 0x2, 0xa2, 0x8f, 0xa2, 0x2, 0x1, 0x0, 0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17587);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 7329 [Right QoS2,Left SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x4, 0x1c, 0xa1, 0x2, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7329);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 19479 [Right QoS1] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x3, 0x4c, 0x17, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19479);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}

// SubscribeResponse 4187 [Right QoS2,Right QoS1,Left SubErrQuotaExceeded,Right QoS1,Right QoS0,Right QoS2,Left
// SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x9, 0x10, 0x5b, 0x2, 0x1, 0x97, 0x1, 0x0, 0x2, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4187);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 1954 [Left SubErrNotAuthorized,Right QoS2,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0xa, 0x7, 0xa2, 0x87, 0x2, 0x80, 0x8f, 0xa2, 0x83, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1954);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 9962 [Left SubErrPacketIdentifierInUse,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrNotAuthorized,Right QoS1,Left SubErrQuotaExceeded,Right QoS1] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x8, 0x26, 0xea, 0x91, 0xa2, 0x87, 0x1, 0x97, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9962);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 16427 [Left SubErrQuotaExceeded,Right QoS0,Right QoS2,Right QoS2,Right QoS1] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x7, 0x40, 0x2b, 0x97, 0x0, 0x2, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16427);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
}

// SubscribeResponse 14848 [Left SubErrImplementationSpecificError,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x4, 0x3a, 0x0, 0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14848);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 15477 [Left SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Right QoS2,Right QoS2,Right
// QoS1,Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0xc, 0x3c, 0x75, 0x91, 0x87, 0x2, 0x2, 0x1, 0x9e, 0x80, 0x0, 0x1, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15477);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 13181 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right
// QoS2,Left SubErrImplementationSpecificError,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS1,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0xb, 0x33, 0x7d, 0x87, 0x80, 0x87, 0x2, 0x83, 0xa1, 0x91, 0x1, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13181);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 32677 [Right QoS1,Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x7, 0x7f, 0xa5, 0x1, 0x80, 0x2, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32677);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 14851 [Right QoS0,Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrImplementationSpecificError,Left SubErrNotAuthorized,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xa, 0x3a, 0x3, 0x0, 0x87, 0x80, 0x9e, 0x1, 0x83, 0x87, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14851);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
}

// SubscribeResponse 4646 [Right QoS1,Left SubErrUnspecifiedError,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right
// QoS0,Left SubErrUnspecifiedError] [PropSubscriptionIdentifier 22,PropRequestResponseInformation
// 17,PropSubscriptionIdentifierAvailable 50,PropWildcardSubscriptionAvailable 51,PropRetainAvailable
// 233,PropReceiveMaximum 23309,PropResponseInformation
// "\251\r{G\166E\137\154\133JK\160\247\208\231t\177$]\193\240*\184\133\162\247R\165%\137",PropRequestResponseInformation
// 8,PropServerReference
// "\145\248\135d)\213B\n\135EJ\198\NAK\203\&6\153\214\173\141\138\236\NULy\DC1\215<\227sd",PropSubscriptionIdentifierAvailable
// 81,PropUserProperty "TK\156\b\130,\232\ENQ'\SYN\SUB6G\206\163\133\&4\EM\EM\213J "
// "\150\178Zd\187\233\237U\229\RS\DEL}/P\187\221\226\203~",PropUserProperty
// "v!l\151;4\STX=\222\238\SUB\f\136\178\175\134+5" "\154f\CANv\175+)",PropSessionExpiryInterval
// 29233,PropWildcardSubscriptionAvailable 6,PropMessageExpiryInterval 12194,PropResponseInformation
// "\215\254\&9\189\150\DC1\164HQ\216\v\185\167S)n%\200\188N~\SUBQ",PropSubscriptionIdentifier
// 27,PropWildcardSubscriptionAvailable 13,PropMessageExpiryInterval 7423,PropWillDelayInterval 28935,PropResponseTopic
// "",PropTopicAliasMaximum 2012,PropPayloadFormatIndicator 112,PropReceiveMaximum 15776,PropCorrelationData
// "B\202\134W\f=k\RS.\249\ACK\211\252~yv\234G\129_\218\129i",PropAuthenticationMethod
// "\136\224\SOH\US1E\244\f<e\200",PropMaximumPacketSize 12574,PropMaximumQoS 169,PropWildcardSubscriptionAvailable 126]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x9b, 0x2,  0x12, 0x26, 0x8e, 0x2,  0xb,  0x16, 0x19, 0x11, 0x29, 0x32, 0x28, 0x33, 0x25, 0xe9,
                   0x21, 0x5b, 0xd,  0x1a, 0x0,  0x1e, 0xfb, 0xd,  0x7b, 0x47, 0xa6, 0x45, 0x89, 0x9a, 0x85, 0x4a, 0x4b,
                   0xa0, 0xf7, 0xd0, 0xe7, 0x74, 0xb1, 0x24, 0x5d, 0xc1, 0xf0, 0x2a, 0xb8, 0x85, 0xa2, 0xf7, 0x52, 0xa5,
                   0x25, 0x89, 0x19, 0x8,  0x1c, 0x0,  0x1d, 0x91, 0xf8, 0x87, 0x64, 0x29, 0xd5, 0x42, 0xa,  0x87, 0x45,
                   0x4a, 0xc6, 0x15, 0xcb, 0x36, 0x99, 0xd6, 0xad, 0x8d, 0x8a, 0xec, 0x0,  0x79, 0x11, 0xd7, 0x3c, 0xe3,
                   0x73, 0x64, 0x29, 0x51, 0x26, 0x0,  0x16, 0x54, 0x4b, 0x9c, 0x8,  0x82, 0x2c, 0xe8, 0x5,  0x27, 0x16,
                   0x1a, 0x36, 0x47, 0xce, 0xa3, 0x85, 0x34, 0x19, 0x19, 0xd5, 0x4a, 0x20, 0x0,  0x13, 0x96, 0xb2, 0x5a,
                   0x64, 0xbb, 0xe9, 0xed, 0x55, 0xe5, 0x1e, 0x7f, 0x7d, 0x2f, 0x50, 0xbb, 0xdd, 0xe2, 0xcb, 0x7e, 0x26,
                   0x0,  0x12, 0x76, 0x21, 0x6c, 0x97, 0x3b, 0x34, 0x2,  0x3d, 0xde, 0xee, 0x1a, 0xc,  0x88, 0xb2, 0xaf,
                   0x86, 0x2b, 0x35, 0x0,  0x7,  0x9a, 0x66, 0x18, 0x76, 0xaf, 0x2b, 0x29, 0x11, 0x0,  0x0,  0x72, 0x31,
                   0x28, 0x6,  0x2,  0x0,  0x0,  0x2f, 0xa2, 0x1a, 0x0,  0x17, 0xd7, 0xfe, 0x39, 0xbd, 0x96, 0x11, 0xa4,
                   0x48, 0x51, 0xd8, 0xb,  0xb9, 0xa7, 0x53, 0x29, 0x6e, 0x25, 0xc8, 0xbc, 0x4e, 0x7e, 0x1a, 0x51, 0xb,
                   0x1b, 0x28, 0xd,  0x2,  0x0,  0x0,  0x1c, 0xff, 0x18, 0x0,  0x0,  0x71, 0x7,  0x8,  0x0,  0x0,  0x22,
                   0x7,  0xdc, 0x1,  0x70, 0x21, 0x3d, 0xa0, 0x9,  0x0,  0x17, 0x42, 0xca, 0x86, 0x57, 0xc,  0x3d, 0x6b,
                   0x1e, 0x2e, 0xf9, 0x6,  0xd3, 0xfc, 0x7e, 0x79, 0x76, 0xea, 0x47, 0x81, 0x5f, 0xda, 0x81, 0x69, 0x15,
                   0x0,  0xb,  0x88, 0xe0, 0x1,  0x1f, 0x31, 0x45, 0xf4, 0xc,  0x3c, 0x65, 0xc8, 0x27, 0x0,  0x0,  0x31,
                   0x1e, 0x24, 0xa9, 0x28, 0x7e, 0x1,  0x80, 0x2,  0xa1, 0x1,  0x1,  0xa2, 0x0,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4646);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 3536 [Right QoS1,Left SubErrUnspecifiedError,Left SubErrSubscriptionIdentifiersNotSupported]
// [PropRequestResponseInformation 109,PropRequestResponseInformation 109,PropSharedSubscriptionAvailable
// 138,PropResponseInformation "m\NAK\b\195\197\EM\CANf/p\STXD\ETX\FSP",PropSharedSubscriptionAvailable
// 136,PropSessionExpiryInterval 17021,PropAssignedClientIdentifier "\ENQ;\239N\164",PropCorrelationData
// "\193r",PropRequestResponseInformation 33,PropWillDelayInterval 25681,PropMessageExpiryInterval 28150,PropMaximumQoS
// 14,PropServerReference "Nk@\151\a"]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x48, 0xd,  0xd0, 0x42, 0x19, 0x6d, 0x19, 0x6d, 0x2a, 0x8a, 0x1a, 0x0,  0xf,  0x6d,
                   0x15, 0x8,  0xc3, 0xc5, 0x19, 0x18, 0x66, 0x2f, 0x70, 0x2,  0x44, 0x3,  0x1c, 0x50, 0x2a,
                   0x88, 0x11, 0x0,  0x0,  0x42, 0x7d, 0x12, 0x0,  0x5,  0x5,  0x3b, 0xef, 0x4e, 0xa4, 0x9,
                   0x0,  0x2,  0xc1, 0x72, 0x19, 0x21, 0x18, 0x0,  0x0,  0x64, 0x51, 0x2,  0x0,  0x0,  0x6d,
                   0xf6, 0x24, 0xe,  0x1c, 0x0,  0x5,  0x4e, 0x6b, 0x40, 0x97, 0x7,  0x1,  0x80, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3536);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
}

// SubscribeResponse 13945 [Left SubErrPacketIdentifierInUse,Right QoS1] [PropRetainAvailable 65,PropContentType
// "\135\228\243\175j\204\&4`\ENQ\243\EOT2",PropUserProperty "\205l\138&\179\f)Z-\201f\251V\216\212\231\134\184\t"
// "\208}3\184\170\225\191\173D\212\SI",PropAuthenticationMethod
// "\128\255C\231\245D\180g\168Xj\231\196\226|\182\135\220B6\156"]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x51, 0x36, 0x79, 0x4c, 0x25, 0x41, 0x3,  0x0,  0xc,  0x87, 0xe4, 0xf3, 0xaf, 0x6a, 0xcc, 0x34,
                   0x60, 0x5,  0xf3, 0x4,  0x32, 0x26, 0x0,  0x13, 0xcd, 0x6c, 0x8a, 0x26, 0xb3, 0xc,  0x29, 0x5a, 0x2d,
                   0xc9, 0x66, 0xfb, 0x56, 0xd8, 0xd4, 0xe7, 0x86, 0xb8, 0x9,  0x0,  0xb,  0xd0, 0x7d, 0x33, 0xb8, 0xaa,
                   0xe1, 0xbf, 0xad, 0x44, 0xd4, 0xf,  0x15, 0x0,  0x15, 0x80, 0xff, 0x43, 0xe7, 0xf5, 0x44, 0xb4, 0x67,
                   0xa8, 0x58, 0x6a, 0xe7, 0xc4, 0xe2, 0x7c, 0xb6, 0x87, 0xdc, 0x42, 0x36, 0x9c, 0x91, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13945);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
}

// SubscribeResponse 27071 [Right QoS0,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropAssignedClientIdentifier "U\133\173\209?}c\144\173",PropUserProperty
// "7m\185IS\200" "\255\204B(-\141\&3\NAK;\215\129q\184\147\204,\196\229\&0\231 ",PropReasonString
// "e\ETX\154\169~\201\231\145\149\DC3\203z*\171>",PropRequestResponseInformation 168,PropMessageExpiryInterval
// 1846,PropMessageExpiryInterval 19979,PropAuthenticationData "J\177
// D\182_w\USH\180\207\ETB\235\180\DC3)3\213x1c\186h\206\200m\227\221X",PropRequestProblemInformation 53,PropMaximumQoS
// 146,PropReceiveMaximum 25571,PropServerKeepAlive 3299,PropPayloadFormatIndicator 255,PropReasonString
// "q\245\154\&2",PropTopicAlias 15510]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x8c, 0x1,  0x69, 0xbf, 0x80, 0x1,  0x12, 0x0,  0x9,  0x55, 0x85, 0xad, 0xd1, 0x3f, 0x7d,
                   0x63, 0x90, 0xad, 0x26, 0x0,  0x6,  0x37, 0x6d, 0xb9, 0x49, 0x53, 0xc8, 0x0,  0x15, 0xff, 0xcc,
                   0x42, 0x28, 0x2d, 0x8d, 0x33, 0x15, 0x3b, 0xd7, 0x81, 0x71, 0xb8, 0x93, 0xcc, 0x2c, 0xc4, 0xe5,
                   0x30, 0xe7, 0x20, 0x1f, 0x0,  0xf,  0x65, 0x3,  0x9a, 0xa9, 0x7e, 0xc9, 0xe7, 0x91, 0x95, 0x13,
                   0xcb, 0x7a, 0x2a, 0xab, 0x3e, 0x19, 0xa8, 0x2,  0x0,  0x0,  0x7,  0x36, 0x2,  0x0,  0x0,  0x4e,
                   0xb,  0x16, 0x0,  0x1d, 0x4a, 0xb1, 0x20, 0x44, 0xb6, 0x5f, 0x77, 0x1f, 0x48, 0xb4, 0xcf, 0x17,
                   0xeb, 0xb4, 0x13, 0x29, 0x33, 0xd5, 0x78, 0x31, 0x63, 0xba, 0x68, 0xce, 0xc8, 0x6d, 0xe3, 0xdd,
                   0x58, 0x17, 0x35, 0x24, 0x92, 0x21, 0x63, 0xe3, 0x13, 0xc,  0xe3, 0x1,  0xff, 0x1f, 0x0,  0x4,
                   0x71, 0xf5, 0x9a, 0x32, 0x23, 0x3c, 0x96, 0x0,  0x1,  0xa2, 0x0,  0x80, 0x2,  0xa2, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27071);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], 0xA1);
}

// SubscribeResponse 29147 [Right QoS2,Right QoS2,Left SubErrImplementationSpecificError,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS2] [PropSubscriptionIdentifier 29,PropWillDelayInterval
// 5901,PropReasonString "\NUL/\153\168\GS|$\190\232\210\158\132\ACK\179q",PropWildcardSubscriptionAvailable
// 76,PropRetainAvailable 119,PropSubscriptionIdentifier 16,PropUserProperty
// "CY]\r\239\238Q\222i\a\251\SO\202\147\216?\f\SUB\213p\232a\227]"
// "#\ETX\USL[\DEL*\167qJ\219\226r\DC2\198*\189!\255\169\&6\244",PropCorrelationData
// "\208}\132x\197hO\STX\SOH|l\208G\EM\178\FS",PropMessageExpiryInterval 14507,PropMaximumPacketSize
// 19945,PropSubscriptionIdentifierAvailable 170,PropRetainAvailable 214,PropRequestResponseInformation
// 42,PropResponseInformation "\r\ENQrX\226\143[\DEL"]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x8a, 0x1,  0x71, 0xdb, 0x80, 0x1,  0xb,  0x1d, 0x18, 0x0,  0x0,  0x17, 0xd,  0x1f, 0x0,
                   0xf,  0x0,  0x2f, 0x99, 0xa8, 0x1d, 0x7c, 0x24, 0xbe, 0xe8, 0xd2, 0x9e, 0x84, 0x6,  0xb3, 0x71,
                   0x28, 0x4c, 0x25, 0x77, 0xb,  0x10, 0x26, 0x0,  0x18, 0x43, 0x59, 0x5d, 0xd,  0xef, 0xee, 0x51,
                   0xde, 0x69, 0x7,  0xfb, 0xe,  0xca, 0x93, 0xd8, 0x3f, 0xc,  0x1a, 0xd5, 0x70, 0xe8, 0x61, 0xe3,
                   0x5d, 0x0,  0x16, 0x23, 0x3,  0x1f, 0x4c, 0x5b, 0x7f, 0x2a, 0xa7, 0x71, 0x4a, 0xdb, 0xe2, 0x72,
                   0x12, 0xc6, 0x2a, 0xbd, 0x21, 0xff, 0xa9, 0x36, 0xf4, 0x9,  0x0,  0x10, 0xd0, 0x7d, 0x84, 0x78,
                   0xc5, 0x68, 0x4f, 0x2,  0x1,  0x7c, 0x6c, 0xd0, 0x47, 0x19, 0xb2, 0x1c, 0x2,  0x0,  0x0,  0x38,
                   0xab, 0x27, 0x0,  0x0,  0x4d, 0xe9, 0x29, 0xaa, 0x25, 0xd6, 0x19, 0x2a, 0x1a, 0x0,  0x8,  0xd,
                   0x5,  0x72, 0x58, 0xe2, 0x8f, 0x5b, 0x7f, 0x2,  0x2,  0x83, 0x80, 0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29147);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
}

// SubscribeResponse 9531 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Left
// SubErrTopicFilterInvalid,Right QoS1,Left SubErrNotAuthorized,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS2] [PropSessionExpiryInterval 6243,PropTopicAliasMaximum
// 1854,PropPayloadFormatIndicator 70,PropContentType
// "\US\193\232\200!\f\171\222\146\"\200\184J\195{\189\RS\233\208\131%",PropWildcardSubscriptionAvailable
// 154,PropReasonString "\255\219\130u\251\218gb\224\138\&4%?L\200Tw:\217\&2\223",PropWillDelayInterval
// 16298,PropMessageExpiryInterval 18664,PropUserProperty
// "\173\176\RS\EM\245\182o\167\250m\215\164A\184\b\NUL\142\130\214Z" "b\\\147\131\155\231\EOT\239E",PropReceiveMaximum
// 22869,PropMaximumQoS 216,PropWildcardSubscriptionAvailable 93,PropResponseInformation
// "'\180\RSY8\150\DEL\SOH\186\CAN\155d\246\147\174c\149t",PropSubscriptionIdentifier 21,PropReceiveMaximum
// 6947,PropWillDelayInterval 6293,PropTopicAliasMaximum 13827,PropUserProperty ""
// "\133\219n\US\SYN\235\DC2\193\&9\v^\221\170l\RS\211",PropSharedSubscriptionAvailable
// 144,PropWildcardSubscriptionAvailable 8,PropUserProperty "1\DC3\200\161\220\139\t\EOTl;\143\200\240\172"
// "\SYN\255\214aA\244\141\251e#\168\\\178\168R\174"]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {
      0x90, 0xdb, 0x1,  0x25, 0x3b, 0xcd, 0x1,  0x11, 0x0,  0x0,  0x18, 0x63, 0x22, 0x7,  0x3e, 0x1,  0x46, 0x3,  0x0,
      0x15, 0x1f, 0xc1, 0xe8, 0xc8, 0x21, 0xc,  0xab, 0xde, 0x92, 0x22, 0xc8, 0xb8, 0x4a, 0xc3, 0x7b, 0xbd, 0x1e, 0xe9,
      0xd0, 0x83, 0x25, 0x28, 0x9a, 0x1f, 0x0,  0x15, 0xff, 0xdb, 0x82, 0x75, 0xfb, 0xda, 0x67, 0x62, 0xe0, 0x8a, 0x34,
      0x25, 0x3f, 0x4c, 0xc8, 0x54, 0x77, 0x3a, 0xd9, 0x32, 0xdf, 0x18, 0x0,  0x0,  0x3f, 0xaa, 0x2,  0x0,  0x0,  0x48,
      0xe8, 0x26, 0x0,  0x14, 0xad, 0xb0, 0x1e, 0x19, 0xf5, 0xb6, 0x6f, 0xa7, 0xfa, 0x6d, 0xd7, 0xa4, 0x41, 0xb8, 0x8,
      0x0,  0x8e, 0x82, 0xd6, 0x5a, 0x0,  0x9,  0x62, 0x5c, 0x93, 0x83, 0x9b, 0xe7, 0x4,  0xef, 0x45, 0x21, 0x59, 0x55,
      0x24, 0xd8, 0x28, 0x5d, 0x1a, 0x0,  0x12, 0x27, 0xb4, 0x1e, 0x59, 0x38, 0x96, 0x7f, 0x1,  0xba, 0x18, 0x9b, 0x64,
      0xf6, 0x93, 0xae, 0x63, 0x95, 0x74, 0xb,  0x15, 0x21, 0x1b, 0x23, 0x18, 0x0,  0x0,  0x18, 0x95, 0x22, 0x36, 0x3,
      0x26, 0x0,  0x0,  0x0,  0x10, 0x85, 0xdb, 0x6e, 0x1f, 0x16, 0xeb, 0x12, 0xc1, 0x39, 0xb,  0x5e, 0xdd, 0xaa, 0x6c,
      0x1e, 0xd3, 0x2a, 0x90, 0x28, 0x8,  0x26, 0x0,  0xe,  0x31, 0x13, 0xc8, 0xa1, 0xdc, 0x8b, 0x9,  0x4,  0x6c, 0x3b,
      0x8f, 0xc8, 0xf0, 0xac, 0x0,  0x10, 0x16, 0xff, 0xd6, 0x61, 0x41, 0xf4, 0x8d, 0xfb, 0x65, 0x23, 0xa8, 0x5c, 0xb2,
      0xa8, 0x52, 0xae, 0x1,  0xa1, 0x2,  0x8f, 0x1,  0x87, 0x0,  0x9e, 0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9531);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 30374 [Left SubErrQuotaExceeded,Left SubErrSubscriptionIdentifiersNotSupported]
// [PropMaximumPacketSize 8115,PropTopicAliasMaximum 8706,PropCorrelationData "\142\200\t\132\150
// \227\a\180\227\185)\187W\163u",PropPayloadFormatIndicator 54,PropRequestProblemInformation 50]
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x24, 0x76, 0xa6, 0x1f, 0x27, 0x0,  0x0,  0x1f, 0xb3, 0x22, 0x22, 0x2,
                   0x9,  0x0,  0x10, 0x8e, 0xc8, 0x9,  0x84, 0x96, 0x20, 0xe3, 0x7,  0xb4, 0xe3,
                   0xb9, 0x29, 0xbb, 0x57, 0xa3, 0x75, 0x1,  0x36, 0x17, 0x32, 0x97, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30374);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
}

// SubscribeResponse 8812 [Right QoS0,Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrTopicFilterInvalid,Right QoS0,Right QoS2,Right QoS0,Right QoS2] [PropCorrelationData
// "\DC4\166GV",PropSubscriptionIdentifier 2,PropServerReference "\201\&5G\142\154l]\238\192",PropMaximumQoS
// 49,PropWillDelayInterval 926,PropReceiveMaximum 24762,PropServerKeepAlive 23026,PropSubscriptionIdentifierAvailable
// 15,PropResponseTopic "\v 9\178\134\ACK\191\198$^\198A\SId\154",PropAuthenticationMethod "4C",PropWillDelayInterval
// 13004]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x4c, 0x22, 0x6c, 0x40, 0x9,  0x0,  0x4,  0x14, 0xa6, 0x47, 0x56, 0xb,  0x2,  0x1c, 0x0,
                   0x9,  0xc9, 0x35, 0x47, 0x8e, 0x9a, 0x6c, 0x5d, 0xee, 0xc0, 0x24, 0x31, 0x18, 0x0,  0x0,  0x3,
                   0x9e, 0x21, 0x60, 0xba, 0x13, 0x59, 0xf2, 0x29, 0xf,  0x8,  0x0,  0xf,  0xb,  0x20, 0x39, 0xb2,
                   0x86, 0x6,  0xbf, 0xc6, 0x24, 0x5e, 0xc6, 0x41, 0xf,  0x64, 0x9a, 0x15, 0x0,  0x2,  0x34, 0x43,
                   0x18, 0x0,  0x0,  0x32, 0xcc, 0x0,  0x2,  0x91, 0x1,  0x8f, 0x0,  0x2,  0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8812);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x8F);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 31341 [Left SubErrImplementationSpecificError,Right QoS2,Left SubErrQuotaExceeded,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS1]
// [PropRequestProblemInformation 94,PropContentType "\224\243",PropAuthenticationData "h\ACK",PropRetainAvailable
// 17,PropResponseInformation "\154\255\DEL\RS\164\v\185M5",PropPayloadFormatIndicator 184,PropAuthenticationData
// "\DEL\133\156\&1\170",PropResponseInformation
// "\133\DLE\209\141\243\EMH\166\185\STXA\177\128\STXT",PropWillDelayInterval 27214,PropSessionExpiryInterval
// 14089,PropAssignedClientIdentifier "l\213\178\159"]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x52, 0x7a, 0x6d, 0x47, 0x17, 0x5e, 0x3,  0x0,  0x2,  0xe0, 0xf3, 0x16, 0x0,  0x2,  0x68, 0x6,
                   0x25, 0x11, 0x1a, 0x0,  0x9,  0x9a, 0xff, 0x7f, 0x1e, 0xa4, 0xb,  0xb9, 0x4d, 0x35, 0x1,  0xb8, 0x16,
                   0x0,  0x5,  0x7f, 0x85, 0x9c, 0x31, 0xaa, 0x1a, 0x0,  0xf,  0x85, 0x10, 0xd1, 0x8d, 0xf3, 0x19, 0x48,
                   0xa6, 0xb9, 0x2,  0x41, 0xb1, 0x80, 0x2,  0x54, 0x18, 0x0,  0x0,  0x6a, 0x4e, 0x11, 0x0,  0x0,  0x37,
                   0x9,  0x12, 0x0,  0x4,  0x6c, 0xd5, 0xb2, 0x9f, 0x83, 0x2,  0x97, 0x1,  0x9e, 0x91, 0x0,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31341);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x9E);
  EXPECT_EQ(granted_qos_levels[5], 0x91);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 16134 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Left
// SubErrNotAuthorized,Right QoS1,Right QoS0,Left SubErrUnspecifiedError,Right QoS1] [PropResponseTopic
// "571\167\180\147\252\128\246X\152Z\242\v9\186",PropAuthenticationMethod "g\139\DC4",PropTopicAliasMaximum
// 5202,PropWildcardSubscriptionAvailable 185,PropTopicAlias 10282,PropSubscriptionIdentifier 9,PropServerKeepAlive
// 22027,PropResponseTopic "GG\SUB\139\226\a\160\t\167g\148\172\ETB\183\185\188n\241",PropCorrelationData
// "\220\249\232\235:'",PropResponseInformation
// "u>\210\204\214\137\161.\161\192F\197",PropSubscriptionIdentifierAvailable 153,PropAssignedClientIdentifier
// "O\203\171\198\175j\201\241\DLE\CAN\179tv2\147\148",PropMaximumPacketSize 21008,PropUserProperty
// "\t\US\171A\CANs\163\177T}fE\173iVvi\200Y" ":\152G\CANZ\252",PropReceiveMaximum
// 26151,PropSubscriptionIdentifierAvailable 4]
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x9c, 0x1,  0x3f, 0x6,  0x90, 0x1,  0x8,  0x0,  0x10, 0x35, 0x37, 0x31, 0xa7, 0xb4, 0x93,
                   0xfc, 0x80, 0xf6, 0x58, 0x98, 0x5a, 0xf2, 0xb,  0x39, 0xba, 0x15, 0x0,  0x3,  0x67, 0x8b, 0x14,
                   0x22, 0x14, 0x52, 0x28, 0xb9, 0x23, 0x28, 0x2a, 0xb,  0x9,  0x13, 0x56, 0xb,  0x8,  0x0,  0x12,
                   0x47, 0x47, 0x1a, 0x8b, 0xe2, 0x7,  0xa0, 0x9,  0xa7, 0x67, 0x94, 0xac, 0x17, 0xb7, 0xb9, 0xbc,
                   0x6e, 0xf1, 0x9,  0x0,  0x6,  0xdc, 0xf9, 0xe8, 0xeb, 0x3a, 0x27, 0x1a, 0x0,  0xc,  0x75, 0x3e,
                   0xd2, 0xcc, 0xd6, 0x89, 0xa1, 0x2e, 0xa1, 0xc0, 0x46, 0xc5, 0x29, 0x99, 0x12, 0x0,  0x10, 0x4f,
                   0xcb, 0xab, 0xc6, 0xaf, 0x6a, 0xc9, 0xf1, 0x10, 0x18, 0xb3, 0x74, 0x76, 0x32, 0x93, 0x94, 0x27,
                   0x0,  0x0,  0x52, 0x10, 0x26, 0x0,  0x13, 0x9,  0x1f, 0xab, 0x41, 0x18, 0x73, 0xa3, 0xb1, 0x54,
                   0x7d, 0x66, 0x45, 0xad, 0x69, 0x56, 0x76, 0x69, 0xc8, 0x59, 0x0,  0x6,  0x3a, 0x98, 0x47, 0x18,
                   0x5a, 0xfc, 0x21, 0x66, 0x27, 0x29, 0x4,  0x1,  0xa1, 0x1,  0x87, 0x1,  0x0,  0x80, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16134);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 27712 [Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Right QoS0]
// [PropTopicAliasMaximum 15336,PropResponseInformation "%\219\212w7\218M\157\143\237r\aAO\213,",PropServerKeepAlive
// 29870,PropReceiveMaximum 339]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x22, 0x6c, 0x40, 0x1c, 0x22, 0x3b, 0xe8, 0x1a, 0x0,  0x10, 0x25,
                   0xdb, 0xd4, 0x77, 0x37, 0xda, 0x4d, 0x9d, 0x8f, 0xed, 0x72, 0x7,  0x41,
                   0x4f, 0xd5, 0x2c, 0x13, 0x74, 0xae, 0x21, 0x1,  0x53, 0x83, 0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27712);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 23389 [Right QoS2,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right
// QoS2,Left SubErrTopicFilterInvalid] [PropReasonString
// ">c'\236\255R\147\155\184\217\234z\234\222\128",PropRequestResponseInformation 230,PropMessageExpiryInterval
// 1522,PropSharedSubscriptionAvailable 116,PropResponseInformation "\241\150V$",PropCorrelationData
// "\218",PropSubscriptionIdentifier 14,PropReasonString
// "a\v\135P\205e\RS\182\241\204\135\211\138\"\164oE\DC3\150\220\131\148\176\216\a\132B\212C\165",PropSessionExpiryInterval
// 3925,PropSessionExpiryInterval 8684,PropMaximumPacketSize 29880,PropSubscriptionIdentifierAvailable
// 151,PropServerKeepAlive 11995]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x66, 0x5b, 0x5d, 0x5d, 0x1f, 0x0,  0xf,  0x3e, 0x63, 0x27, 0xec, 0xff, 0x52, 0x93,
                   0x9b, 0xb8, 0xd9, 0xea, 0x7a, 0xea, 0xde, 0x80, 0x19, 0xe6, 0x2,  0x0,  0x0,  0x5,  0xf2,
                   0x2a, 0x74, 0x1a, 0x0,  0x4,  0xf1, 0x96, 0x56, 0x24, 0x9,  0x0,  0x1,  0xda, 0xb,  0xe,
                   0x1f, 0x0,  0x1e, 0x61, 0xb,  0x87, 0x50, 0xcd, 0x65, 0x1e, 0xb6, 0xf1, 0xcc, 0x87, 0xd3,
                   0x8a, 0x22, 0xa4, 0x6f, 0x45, 0x13, 0x96, 0xdc, 0x83, 0x94, 0xb0, 0xd8, 0x7,  0x84, 0x42,
                   0xd4, 0x43, 0xa5, 0x11, 0x0,  0x0,  0xf,  0x55, 0x11, 0x0,  0x0,  0x21, 0xec, 0x27, 0x0,
                   0x0,  0x74, 0xb8, 0x29, 0x97, 0x13, 0x2e, 0xdb, 0x2,  0x1,  0xa2, 0x0,  0x2,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23389);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x8F);
}

// SubscribeResponse 3364 [Right QoS0,Left SubErrUnspecifiedError] [PropRequestResponseInformation
// 171,PropWildcardSubscriptionAvailable 54,PropRetainAvailable 169,PropAuthenticationData
// "\231S\SYN\130\168a~\202\192@y\150\251\201\FS&\SO[\224\170\193\142\173\177\235R",PropTopicAlias
// 13874,PropSharedSubscriptionAvailable 133,PropTopicAlias 1693,PropMessageExpiryInterval
// 17193,PropWildcardSubscriptionAvailable 83,PropTopicAlias 933,PropResponseTopic
// "E\243\170\t\180\191|X\150.N\185\182\254l\244\153",PropMaximumPacketSize 24169,PropServerReference
// "$\249*\140\197\133)+",PropPayloadFormatIndicator 194,PropSubscriptionIdentifierAvailable 124,PropWillDelayInterval
// 9096,PropResponseTopic
// "\132\143\135\168\f\251M\EOT\174\SORcp\RS\243\172\RS\209\199z\195\217\250\224Y\210\251",PropAuthenticationMethod
// "\208\181\202D\EM\FS\176\206g\183\191\166\249Rk\254\228\GSC\129\&6\149",PropReasonString
// "?\DC1\176\135\171\196\219X#p\207L-\143\140\131\207\153d|\211\206",PropTopicAliasMaximum
// 29896,PropSubscriptionIdentifier 26,PropServerReference
// "\SUB\161\250\&6\DC1^\SOH7)\DELI\222\138\201\ACK\240\189\199\&2",PropWildcardSubscriptionAvailable 147,PropTopicAlias
// 8676,PropMessageExpiryInterval 29724,PropSessionExpiryInterval 18665,PropUserProperty
// "\n\US\166jm\162\229\197U\233\131\229^$\b\155\200\214\187\196\156=6\241\139)\185T\ACK"
// "\181\SYN\201\250\166\207\172,\177\150\151\243\158\158oZ\222\DC3\247\147^\246x\184\197\130"]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {
      0x90, 0x9e, 0x2,  0xd,  0x24, 0x98, 0x2,  0x19, 0xab, 0x28, 0x36, 0x25, 0xa9, 0x16, 0x0,  0x1a, 0xe7, 0x53, 0x16,
      0x82, 0xa8, 0x61, 0x7e, 0xca, 0xc0, 0x40, 0x79, 0x96, 0xfb, 0xc9, 0x1c, 0x26, 0xe,  0x5b, 0xe0, 0xaa, 0xc1, 0x8e,
      0xad, 0xb1, 0xeb, 0x52, 0x23, 0x36, 0x32, 0x2a, 0x85, 0x23, 0x6,  0x9d, 0x2,  0x0,  0x0,  0x43, 0x29, 0x28, 0x53,
      0x23, 0x3,  0xa5, 0x8,  0x0,  0x11, 0x45, 0xf3, 0xaa, 0x9,  0xb4, 0xbf, 0x7c, 0x58, 0x96, 0x2e, 0x4e, 0xb9, 0xb6,
      0xfe, 0x6c, 0xf4, 0x99, 0x27, 0x0,  0x0,  0x5e, 0x69, 0x1c, 0x0,  0x8,  0x24, 0xf9, 0x2a, 0x8c, 0xc5, 0x85, 0x29,
      0x2b, 0x1,  0xc2, 0x29, 0x7c, 0x18, 0x0,  0x0,  0x23, 0x88, 0x8,  0x0,  0x1b, 0x84, 0x8f, 0x87, 0xa8, 0xc,  0xfb,
      0x4d, 0x4,  0xae, 0xe,  0x52, 0x63, 0x70, 0x1e, 0xf3, 0xac, 0x1e, 0xd1, 0xc7, 0x7a, 0xc3, 0xd9, 0xfa, 0xe0, 0x59,
      0xd2, 0xfb, 0x15, 0x0,  0x16, 0xd0, 0xb5, 0xca, 0x44, 0x19, 0x1c, 0xb0, 0xce, 0x67, 0xb7, 0xbf, 0xa6, 0xf9, 0x52,
      0x6b, 0xfe, 0xe4, 0x1d, 0x43, 0x81, 0x36, 0x95, 0x1f, 0x0,  0x16, 0x3f, 0x11, 0xb0, 0x87, 0xab, 0xc4, 0xdb, 0x58,
      0x23, 0x70, 0xcf, 0x4c, 0x2d, 0x8f, 0x8c, 0x83, 0xcf, 0x99, 0x64, 0x7c, 0xd3, 0xce, 0x22, 0x74, 0xc8, 0xb,  0x1a,
      0x1c, 0x0,  0x13, 0x1a, 0xa1, 0xfa, 0x36, 0x11, 0x5e, 0x1,  0x37, 0x29, 0x7f, 0x49, 0xde, 0x8a, 0xc9, 0x6,  0xf0,
      0xbd, 0xc7, 0x32, 0x28, 0x93, 0x23, 0x21, 0xe4, 0x2,  0x0,  0x0,  0x74, 0x1c, 0x11, 0x0,  0x0,  0x48, 0xe9, 0x26,
      0x0,  0x1d, 0xa,  0x1f, 0xa6, 0x6a, 0x6d, 0xa2, 0xe5, 0xc5, 0x55, 0xe9, 0x83, 0xe5, 0x5e, 0x24, 0x8,  0x9b, 0xc8,
      0xd6, 0xbb, 0xc4, 0x9c, 0x3d, 0x36, 0xf1, 0x8b, 0x29, 0xb9, 0x54, 0x6,  0x0,  0x1a, 0xb5, 0x16, 0xc9, 0xfa, 0xa6,
      0xcf, 0xac, 0x2c, 0xb1, 0x96, 0x97, 0xf3, 0x9e, 0x9e, 0x6f, 0x5a, 0xde, 0x13, 0xf7, 0x93, 0x5e, 0xf6, 0x78, 0xb8,
      0xc5, 0x82, 0x0,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3364);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
}

// SubscribeResponse 8138 [Right QoS0,Right QoS1,Right QoS2] [PropRequestResponseInformation 205,PropUserProperty
// "N'\157\207$\151\235" "\197s\159\159\v\210\190\177DM\230N\138|i?`4\DEL \224\250\192a'\246X",PropReasonString
// "\199\170\197\SYN",PropSubscriptionIdentifier 13,PropRequestResponseInformation 161,PropUserProperty
// "\FSGFUWV\232\184\180{\ACK\253\181]y\138\167\ETB\157\&1\184N\163"
// "\247\176\&3\255\213\226\a\152\190\DEL\248sz\172s\DC1\SYNy",PropAuthenticationMethod
// "pL\167\EOT\203\133\&1\197D\181;\186_",PropMessageExpiryInterval 31515,PropAuthenticationMethod
// "\216k\143\208GU\CAN\ETX[\SI}\215\131S\FSg\226\GSC",PropWildcardSubscriptionAvailable 7,PropResponseInformation
// ":\233\164H\214\162\178B\STX\180A\160'\SOH\"\181Y\189&\DC4",PropAuthenticationData
// "~\EOT\223\158\150\216{\196\CANqE\252\EM\156\212\238B\166\SOH-\166\149z?\175/\140O\197",PropReasonString
// "o\217\221H\134t\157\b\170\156Ep\169\253\147\176@\222ov#O\128J\DC1C\134",PropTopicAlias 512,PropMessageExpiryInterval
// 29859,PropRequestResponseInformation 21,PropReceiveMaximum 4053,PropUserProperty
// "\219\208\200\148\DC29\217\DC24o\224" "\DC2wP\190",PropSubscriptionIdentifierAvailable 226,PropReceiveMaximum
// 16548,PropAssignedClientIdentifier "7Yw3\141\231\183",PropTopicAlias 8751]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0x9e, 0x2,  0x1f, 0xca, 0x97, 0x2,  0x19, 0xcd, 0x26, 0x0,  0x7,  0x4e, 0x27, 0x9d, 0xcf, 0x24,
                   0x97, 0xeb, 0x0,  0x1b, 0xc5, 0x73, 0x9f, 0x9f, 0xb,  0xd2, 0xbe, 0xb1, 0x44, 0x4d, 0xe6, 0x4e, 0x8a,
                   0x7c, 0x69, 0x3f, 0x60, 0x34, 0x7f, 0x20, 0xe0, 0xfa, 0xc0, 0x61, 0x27, 0xf6, 0x58, 0x1f, 0x0,  0x4,
                   0xc7, 0xaa, 0xc5, 0x16, 0xb,  0xd,  0x19, 0xa1, 0x26, 0x0,  0x17, 0x1c, 0x47, 0x46, 0x55, 0x57, 0x56,
                   0xe8, 0xb8, 0xb4, 0x7b, 0x6,  0xfd, 0xb5, 0x5d, 0x79, 0x8a, 0xa7, 0x17, 0x9d, 0x31, 0xb8, 0x4e, 0xa3,
                   0x0,  0x12, 0xf7, 0xb0, 0x33, 0xff, 0xd5, 0xe2, 0x7,  0x98, 0xbe, 0x7f, 0xf8, 0x73, 0x7a, 0xac, 0x73,
                   0x11, 0x16, 0x79, 0x15, 0x0,  0xd,  0x70, 0x4c, 0xa7, 0x4,  0xcb, 0x85, 0x31, 0xc5, 0x44, 0xb5, 0x3b,
                   0xba, 0x5f, 0x2,  0x0,  0x0,  0x7b, 0x1b, 0x15, 0x0,  0x13, 0xd8, 0x6b, 0x8f, 0xd0, 0x47, 0x55, 0x18,
                   0x3,  0x5b, 0xf,  0x7d, 0xd7, 0x83, 0x53, 0x1c, 0x67, 0xe2, 0x1d, 0x43, 0x28, 0x7,  0x1a, 0x0,  0x14,
                   0x3a, 0xe9, 0xa4, 0x48, 0xd6, 0xa2, 0xb2, 0x42, 0x2,  0xb4, 0x41, 0xa0, 0x27, 0x1,  0x22, 0xb5, 0x59,
                   0xbd, 0x26, 0x14, 0x16, 0x0,  0x1d, 0x7e, 0x4,  0xdf, 0x9e, 0x96, 0xd8, 0x7b, 0xc4, 0x18, 0x71, 0x45,
                   0xfc, 0x19, 0x9c, 0xd4, 0xee, 0x42, 0xa6, 0x1,  0x2d, 0xa6, 0x95, 0x7a, 0x3f, 0xaf, 0x2f, 0x8c, 0x4f,
                   0xc5, 0x1f, 0x0,  0x1b, 0x6f, 0xd9, 0xdd, 0x48, 0x86, 0x74, 0x9d, 0x8,  0xaa, 0x9c, 0x45, 0x70, 0xa9,
                   0xfd, 0x93, 0xb0, 0x40, 0xde, 0x6f, 0x76, 0x23, 0x4f, 0x80, 0x4a, 0x11, 0x43, 0x86, 0x23, 0x2,  0x0,
                   0x2,  0x0,  0x0,  0x74, 0xa3, 0x19, 0x15, 0x21, 0xf,  0xd5, 0x26, 0x0,  0xb,  0xdb, 0xd0, 0xc8, 0x94,
                   0x12, 0x39, 0xd9, 0x12, 0x34, 0x6f, 0xe0, 0x0,  0x4,  0x12, 0x77, 0x50, 0xbe, 0x29, 0xe2, 0x21, 0x40,
                   0xa4, 0x12, 0x0,  0x7,  0x37, 0x59, 0x77, 0x33, 0x8d, 0xe7, 0xb7, 0x23, 0x22, 0x2f, 0x0,  0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8138);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 7647 [Left SubErrTopicFilterInvalid,Left SubErrNotAuthorized,Left SubErrTopicFilterInvalid,Left
// SubErrUnspecifiedError,Left SubErrQuotaExceeded,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrQuotaExceeded,Left SubErrNotAuthorized,Left SubErrQuotaExceeded] [PropWillDelayInterval 18079,PropMaximumQoS
// 251,PropWillDelayInterval 8818,PropRetainAvailable 64,PropMessageExpiryInterval 24146,PropAuthenticationData
// "\150\233Rm+\170H0\249\189\141\178\199\234:\184\158\234-\vu\218\201Cza",PropTopicAlias
// 11739,PropSessionExpiryInterval 25398,PropWildcardSubscriptionAvailable 141,PropMaximumPacketSize
// 6767,PropReasonString "?Q\n",PropSubscriptionIdentifierAvailable 218,PropPayloadFormatIndicator
// 10,PropSharedSubscriptionAvailable 239,PropAuthenticationMethod "\250I",PropMessageExpiryInterval
// 32723,PropSessionExpiryInterval 2619,PropMaximumPacketSize 15529,PropTopicAliasMaximum 27150,PropTopicAliasMaximum
// 17762,PropSubscriptionIdentifierAvailable 49]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x73, 0x1d, 0xdf, 0x67, 0x18, 0x0,  0x0,  0x46, 0x9f, 0x24, 0xfb, 0x18, 0x0,  0x0,  0x22, 0x72,
                   0x25, 0x40, 0x2,  0x0,  0x0,  0x5e, 0x52, 0x16, 0x0,  0x1a, 0x96, 0xe9, 0x52, 0x6d, 0x2b, 0xaa, 0x48,
                   0x30, 0xf9, 0xbd, 0x8d, 0xb2, 0xc7, 0xea, 0x3a, 0xb8, 0x9e, 0xea, 0x2d, 0xb,  0x75, 0xda, 0xc9, 0x43,
                   0x7a, 0x61, 0x23, 0x2d, 0xdb, 0x11, 0x0,  0x0,  0x63, 0x36, 0x28, 0x8d, 0x27, 0x0,  0x0,  0x1a, 0x6f,
                   0x1f, 0x0,  0x3,  0x3f, 0x51, 0xa,  0x29, 0xda, 0x1,  0xa,  0x2a, 0xef, 0x15, 0x0,  0x2,  0xfa, 0x49,
                   0x2,  0x0,  0x0,  0x7f, 0xd3, 0x11, 0x0,  0x0,  0xa,  0x3b, 0x27, 0x0,  0x0,  0x3c, 0xa9, 0x22, 0x6a,
                   0xe,  0x22, 0x45, 0x62, 0x29, 0x31, 0x8f, 0x87, 0x8f, 0x80, 0x97, 0xa1, 0x97, 0x87, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7647);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], 0xA1);
  EXPECT_EQ(granted_qos_levels[6], 0x97);
  EXPECT_EQ(granted_qos_levels[7], 0x87);
  EXPECT_EQ(granted_qos_levels[8], 0x97);
}

// SubscribeResponse 4989 [Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported] [PropWillDelayInterval 22475]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0xa, 0x13, 0x7d, 0x5, 0x18, 0x0, 0x0, 0x57, 0xcb, 0x1, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4989);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
}

// SubscribeResponse 12633 [Right QoS2,Right QoS0,Right QoS0,Right QoS1] [PropPayloadFormatIndicator 144,PropMaximumQoS
// 159,PropPayloadFormatIndicator 65]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0xd, 0x31, 0x59, 0x6, 0x1, 0x90, 0x24, 0x9f, 0x1, 0x41, 0x2, 0x0, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12633);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
}

// SubscribeResponse 1188 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported] [PropMaximumPacketSize
// 18249,PropWildcardSubscriptionAvailable 131,PropTopicAlias 26908,PropResponseTopic
// "\239\255!7\234\DC3\220kv\129\247k\209\226\ACK\222\148\160\227e\SUBo\225",PropSessionExpiryInterval
// 32084,PropAuthenticationMethod
// "\246`C\209\218\227\196Z0\153\143\v\254\212j\223\t\182\202\251\208\NULX",PropRequestResponseInformation
// 196,PropSubscriptionIdentifier 21,PropWildcardSubscriptionAvailable 32,PropReceiveMaximum
// 3585,PropRequestProblemInformation 163,PropCorrelationData
// "\245\159K\133\158G\207\132L\223\168w\172\162Gu{3\196",PropContentType
// "\182\DC3Rh\218\CAN\196\164W\220\EM",PropServerKeepAlive 28344,PropSessionExpiryInterval 9213,PropTopicAliasMaximum
// 29557,PropMaximumPacketSize 1064,PropMaximumPacketSize 6638]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x8d, 0x1,  0x4,  0xa4, 0x87, 0x1,  0x27, 0x0,  0x0,  0x47, 0x49, 0x28, 0x83, 0x23, 0x69,
                   0x1c, 0x8,  0x0,  0x17, 0xef, 0xff, 0x21, 0x37, 0xea, 0x13, 0xdc, 0x6b, 0x76, 0x81, 0xf7, 0x6b,
                   0xd1, 0xe2, 0x6,  0xde, 0x94, 0xa0, 0xe3, 0x65, 0x1a, 0x6f, 0xe1, 0x11, 0x0,  0x0,  0x7d, 0x54,
                   0x15, 0x0,  0x17, 0xf6, 0x60, 0x43, 0xd1, 0xda, 0xe3, 0xc4, 0x5a, 0x30, 0x99, 0x8f, 0xb,  0xfe,
                   0xd4, 0x6a, 0xdf, 0x9,  0xb6, 0xca, 0xfb, 0xd0, 0x0,  0x58, 0x19, 0xc4, 0xb,  0x15, 0x28, 0x20,
                   0x21, 0xe,  0x1,  0x17, 0xa3, 0x9,  0x0,  0x13, 0xf5, 0x9f, 0x4b, 0x85, 0x9e, 0x47, 0xcf, 0x84,
                   0x4c, 0xdf, 0xa8, 0x77, 0xac, 0xa2, 0x47, 0x75, 0x7b, 0x33, 0xc4, 0x3,  0x0,  0xb,  0xb6, 0x13,
                   0x52, 0x68, 0xda, 0x18, 0xc4, 0xa4, 0x57, 0xdc, 0x19, 0x13, 0x6e, 0xb8, 0x11, 0x0,  0x0,  0x23,
                   0xfd, 0x22, 0x73, 0x75, 0x27, 0x0,  0x0,  0x4,  0x28, 0x27, 0x0,  0x0,  0x19, 0xee, 0x0,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1188);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
}

// SubscribeResponse 17587 [Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrTopicFilterInvalid,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS1,Right QoS0,Left
// SubErrNotAuthorized,Right QoS0] [PropResponseTopic
// "j\205\183\182\235\tQ\168\206F]R\149-{\243]\243@\147\242\ETX{K\247@",PropRequestResponseInformation
// 119,PropAssignedClientIdentifier "n=E\128*\174\154\DLE\DLE\143n\251s)c\203\219\211\193Lo\241q#=\195",PropReasonString
// "$\128\164\202wr3M+\133T\207|Y\142\194$UV\148",PropRequestProblemInformation 41,PropMessageExpiryInterval
// 5040,PropAuthenticationMethod
// "m\US\198\223qI\152\160>.\182\vP\150A\165\249\"&\171\ESCf\180LAC",PropSubscriptionIdentifierAvailable
// 139,PropResponseInformation "\176\t_\135\137\246|[\191\187\182i\US\150\EOT",PropMessageExpiryInterval
// 1423,PropRetainAvailable 245,PropWillDelayInterval 29895,PropUserProperty "\a\ETBQ\SO\134\139\NAKdX\206\145Z"
// "\178\165x\140\GS\203\ETX\DC1\161Z\128\162\237a\f\255N\174\196\NAK-\136\176\218",PropSubscriptionIdentifierAvailable
// 120,PropReasonString "C",PropSubscriptionIdentifierAvailable 10,PropResponseTopic
// "\f\201\DLE\238",PropSharedSubscriptionAvailable 70,PropResponseInformation
// "\151\249\232r\150\188\191F\208\237\177\142s\a\232L\169\203\206\193.w",PropResponseTopic
// "!u\a\209",PropAuthenticationData "\EM\138\137\158\NULG\181\205\US\132\221\145H\153\244\"",PropServerKeepAlive
// 12070,PropReasonString "\192\209\193\154*+\228\215d",PropAssignedClientIdentifier
// "+\214\233H\199$\"\198|_\182\135\137[4\131\209\139\161\214\n\193\DC1\130\199\DC3l",PropPayloadFormatIndicator
// 29,PropRequestProblemInformation 87,PropServerKeepAlive 22897,PropContentType "\181\&0 \243F"]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x90, 0xce, 0x2,  0x44, 0xb3, 0xc0, 0x2,  0x8,  0x0,  0x1a, 0x6a, 0xcd, 0xb7, 0xb6, 0xeb, 0x9,  0x51, 0xa8, 0xce,
      0x46, 0x5d, 0x52, 0x95, 0x2d, 0x7b, 0xf3, 0x5d, 0xf3, 0x40, 0x93, 0xf2, 0x3,  0x7b, 0x4b, 0xf7, 0x40, 0x19, 0x77,
      0x12, 0x0,  0x1a, 0x6e, 0x3d, 0x45, 0x80, 0x2a, 0xae, 0x9a, 0x10, 0x10, 0x8f, 0x6e, 0xfb, 0x73, 0x29, 0x63, 0xcb,
      0xdb, 0xd3, 0xc1, 0x4c, 0x6f, 0xf1, 0x71, 0x23, 0x3d, 0xc3, 0x1f, 0x0,  0x14, 0x24, 0x80, 0xa4, 0xca, 0x77, 0x72,
      0x33, 0x4d, 0x2b, 0x85, 0x54, 0xcf, 0x7c, 0x59, 0x8e, 0xc2, 0x24, 0x55, 0x56, 0x94, 0x17, 0x29, 0x2,  0x0,  0x0,
      0x13, 0xb0, 0x15, 0x0,  0x1a, 0x6d, 0x1f, 0xc6, 0xdf, 0x71, 0x49, 0x98, 0xa0, 0x3e, 0x2e, 0xb6, 0xb,  0x50, 0x96,
      0x41, 0xa5, 0xf9, 0x22, 0x26, 0xab, 0x1b, 0x66, 0xb4, 0x4c, 0x41, 0x43, 0x29, 0x8b, 0x1a, 0x0,  0xf,  0xb0, 0x9,
      0x5f, 0x87, 0x89, 0xf6, 0x7c, 0x5b, 0xbf, 0xbb, 0xb6, 0x69, 0x1f, 0x96, 0x4,  0x2,  0x0,  0x0,  0x5,  0x8f, 0x25,
      0xf5, 0x18, 0x0,  0x0,  0x74, 0xc7, 0x26, 0x0,  0xc,  0x7,  0x17, 0x51, 0xe,  0x86, 0x8b, 0x15, 0x64, 0x58, 0xce,
      0x91, 0x5a, 0x0,  0x18, 0xb2, 0xa5, 0x78, 0x8c, 0x1d, 0xcb, 0x3,  0x11, 0xa1, 0x5a, 0x80, 0xa2, 0xed, 0x61, 0xc,
      0xff, 0x4e, 0xae, 0xc4, 0x15, 0x2d, 0x88, 0xb0, 0xda, 0x29, 0x78, 0x1f, 0x0,  0x1,  0x43, 0x29, 0xa,  0x8,  0x0,
      0x4,  0xc,  0xc9, 0x10, 0xee, 0x2a, 0x46, 0x1a, 0x0,  0x16, 0x97, 0xf9, 0xe8, 0x72, 0x96, 0xbc, 0xbf, 0x46, 0xd0,
      0xed, 0xb1, 0x8e, 0x73, 0x7,  0xe8, 0x4c, 0xa9, 0xcb, 0xce, 0xc1, 0x2e, 0x77, 0x8,  0x0,  0x4,  0x21, 0x75, 0x7,
      0xd1, 0x16, 0x0,  0x10, 0x19, 0x8a, 0x89, 0x9e, 0x0,  0x47, 0xb5, 0xcd, 0x1f, 0x84, 0xdd, 0x91, 0x48, 0x99, 0xf4,
      0x22, 0x13, 0x2f, 0x26, 0x1f, 0x0,  0x9,  0xc0, 0xd1, 0xc1, 0x9a, 0x2a, 0x2b, 0xe4, 0xd7, 0x64, 0x12, 0x0,  0x1b,
      0x2b, 0xd6, 0xe9, 0x48, 0xc7, 0x24, 0x22, 0xc6, 0x7c, 0x5f, 0xb6, 0x87, 0x89, 0x5b, 0x34, 0x83, 0xd1, 0x8b, 0xa1,
      0xd6, 0xa,  0xc1, 0x11, 0x82, 0xc7, 0x13, 0x6c, 0x1,  0x1d, 0x17, 0x57, 0x13, 0x59, 0x71, 0x3,  0x0,  0x5,  0xb5,
      0x30, 0x20, 0xf3, 0x46, 0x0,  0x2,  0xa2, 0x8f, 0xa2, 0x2,  0x1,  0x0,  0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17587);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 7329 [Right QoS2,Left SubErrPacketIdentifierInUse] [PropRequestProblemInformation
// 249,PropTopicAlias 26290,PropSharedSubscriptionAvailable 248,PropUserProperty
// "T\178\&3\176L\222h;\184s\134\180\157\b\226\SI\ETB\207M\186}Y?\141\162\208\DLE"
// "`{>|\\\202\249$\195\&5\EM\188B\191\131\227\241\215\173\&3\191p\147\175",PropReasonString
// "\DC1(\184P\199\184\196\ESC\153\209/",PropWillDelayInterval 7562,PropCorrelationData
// "_\FS/\185G\205\169^\217\246\NULi\FS\227\SOH\229gh\246\225",PropSharedSubscriptionAvailable 220,PropMaximumQoS
// 176,PropMessageExpiryInterval 18923,PropWillDelayInterval 18806,PropUserProperty
// "PN\139\221\197GeM\164\201\169q\144\186\184wZ\223\200\199\181\203?\246\v\192" "\215\174",PropAuthenticationMethod
// "\146\195\DC4\149\150\239\203\248!P\206N\"8\234?\163o!\STX\165\204t\196,d",PropResponseInformation
// "\185;\166_T\154-P\166\DEL",PropTopicAliasMaximum 25060,PropAuthenticationData "\\\184",PropPayloadFormatIndicator
// 248,PropSubscriptionIdentifierAvailable 126,PropMaximumQoS 10,PropTopicAliasMaximum 2628,PropResponseTopic
// "\220\n\156\SOj}oL",PropRequestProblemInformation 244,PropRequestProblemInformation 191,PropServerKeepAlive
// 5460,PropMessageExpiryInterval 16666]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x90, 0xf0, 0x1,  0x1c, 0xa1, 0xea, 0x1,  0x17, 0xf9, 0x23, 0x66, 0xb2, 0x2a, 0xf8, 0x26, 0x0,  0x1b, 0x54, 0xb2,
      0x33, 0xb0, 0x4c, 0xde, 0x68, 0x3b, 0xb8, 0x73, 0x86, 0xb4, 0x9d, 0x8,  0xe2, 0xf,  0x17, 0xcf, 0x4d, 0xba, 0x7d,
      0x59, 0x3f, 0x8d, 0xa2, 0xd0, 0x10, 0x0,  0x18, 0x60, 0x7b, 0x3e, 0x7c, 0x5c, 0xca, 0xf9, 0x24, 0xc3, 0x35, 0x19,
      0xbc, 0x42, 0xbf, 0x83, 0xe3, 0xf1, 0xd7, 0xad, 0x33, 0xbf, 0x70, 0x93, 0xaf, 0x1f, 0x0,  0xb,  0x11, 0x28, 0xb8,
      0x50, 0xc7, 0xb8, 0xc4, 0x1b, 0x99, 0xd1, 0x2f, 0x18, 0x0,  0x0,  0x1d, 0x8a, 0x9,  0x0,  0x14, 0x5f, 0x1c, 0x2f,
      0xb9, 0x47, 0xcd, 0xa9, 0x5e, 0xd9, 0xf6, 0x0,  0x69, 0x1c, 0xe3, 0x1,  0xe5, 0x67, 0x68, 0xf6, 0xe1, 0x2a, 0xdc,
      0x24, 0xb0, 0x2,  0x0,  0x0,  0x49, 0xeb, 0x18, 0x0,  0x0,  0x49, 0x76, 0x26, 0x0,  0x1a, 0x50, 0x4e, 0x8b, 0xdd,
      0xc5, 0x47, 0x65, 0x4d, 0xa4, 0xc9, 0xa9, 0x71, 0x90, 0xba, 0xb8, 0x77, 0x5a, 0xdf, 0xc8, 0xc7, 0xb5, 0xcb, 0x3f,
      0xf6, 0xb,  0xc0, 0x0,  0x2,  0xd7, 0xae, 0x15, 0x0,  0x1a, 0x92, 0xc3, 0x14, 0x95, 0x96, 0xef, 0xcb, 0xf8, 0x21,
      0x50, 0xce, 0x4e, 0x22, 0x38, 0xea, 0x3f, 0xa3, 0x6f, 0x21, 0x2,  0xa5, 0xcc, 0x74, 0xc4, 0x2c, 0x64, 0x1a, 0x0,
      0xa,  0xb9, 0x3b, 0xa6, 0x5f, 0x54, 0x9a, 0x2d, 0x50, 0xa6, 0x7f, 0x22, 0x61, 0xe4, 0x16, 0x0,  0x2,  0x5c, 0xb8,
      0x1,  0xf8, 0x29, 0x7e, 0x24, 0xa,  0x22, 0xa,  0x44, 0x8,  0x0,  0x8,  0xdc, 0xa,  0x9c, 0xe,  0x6a, 0x7d, 0x6f,
      0x4c, 0x17, 0xf4, 0x17, 0xbf, 0x13, 0x15, 0x54, 0x2,  0x0,  0x0,  0x41, 0x1a, 0x2,  0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7329);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
}

// SubscribeResponse 19479 [Right QoS1] [PropMessageExpiryInterval 22457,PropRequestResponseInformation
// 8,PropWildcardSubscriptionAvailable 23,PropMessageExpiryInterval 24259,PropSharedSubscriptionAvailable
// 44,PropWildcardSubscriptionAvailable 9,PropSubscriptionIdentifier 21]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x18, 0x4c, 0x17, 0x14, 0x2,  0x0,  0x0,  0x57, 0xb9, 0x19, 0x8,  0x28,
                   0x17, 0x2,  0x0,  0x0,  0x5e, 0xc3, 0x2a, 0x2c, 0x28, 0x9,  0xb,  0x15, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19479);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}

// SubscribeResponse 4187 [Right QoS2,Right QoS1,Left SubErrQuotaExceeded,Right QoS1,Right QoS0,Right QoS2,Left
// SubErrImplementationSpecificError] [PropCorrelationData
// "\199\232\188I\216\178+\205\243\189\248w[\140\233E\165\&5:\167\173\&5J\153^\SOHA\199",PropReasonString
// "\224ZZ.8\152k\ETXE\137\187!+\NAK\147@",PropAuthenticationMethod
// "\221\130\RS'\143\237\134\198\SO\174\201m\150\220\168\134l\NAKL2y\253-\215\246",PropCorrelationData
// ".\142\FS\185\160$(\173\&5x\204-7\189\234uY\228\132\156F\210\251\145\129\136\144\249",PropSharedSubscriptionAvailable
// 209,PropMessageExpiryInterval 2510,PropSharedSubscriptionAvailable 231,PropAuthenticationMethod "\171\DLE
// WY\166>\ENQK\176n\246\177\252k\165\DC3h#-E\254\226",PropSubscriptionIdentifierAvailable 199,PropUserProperty
// "\157\248\154o\185" "*\ETBo\154",PropAssignedClientIdentifier "\210U\199\232\192Zy\RSX",PropResponseInformation
// "\182\&9\140\192VC\186 \168\RS\220",PropPayloadFormatIndicator 125,PropMessageExpiryInterval 26196,PropTopicAlias
// 2336,PropRetainAvailable 220,PropWildcardSubscriptionAvailable 12,PropServerReference
// "\EOT\a\250P\218\131\STX\EM\EOT\175\141\250\235]\ETX*)\249F\205\149\DEL@\229=T\205Z\183\219",PropSessionExpiryInterval
// 32172,PropSubscriptionIdentifier 14,PropAssignedClientIdentifier "\STX$C\145\STX\ETX",PropServerKeepAlive
// 21027,PropMessageExpiryInterval 24132,PropReceiveMaximum 30095,PropServerReference
// "s\173\191\208\&6\\\STX\206\DC1\131\241\165\DLE\t\230\r",PropTopicAlias 14796,PropRetainAvailable 120]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {
      0x90, 0xa7, 0x2,  0x10, 0x5b, 0x9c, 0x2,  0x9,  0x0,  0x1c, 0xc7, 0xe8, 0xbc, 0x49, 0xd8, 0xb2, 0x2b, 0xcd, 0xf3,
      0xbd, 0xf8, 0x77, 0x5b, 0x8c, 0xe9, 0x45, 0xa5, 0x35, 0x3a, 0xa7, 0xad, 0x35, 0x4a, 0x99, 0x5e, 0x1,  0x41, 0xc7,
      0x1f, 0x0,  0x10, 0xe0, 0x5a, 0x5a, 0x2e, 0x38, 0x98, 0x6b, 0x3,  0x45, 0x89, 0xbb, 0x21, 0x2b, 0x15, 0x93, 0x40,
      0x15, 0x0,  0x19, 0xdd, 0x82, 0x1e, 0x27, 0x8f, 0xed, 0x86, 0xc6, 0xe,  0xae, 0xc9, 0x6d, 0x96, 0xdc, 0xa8, 0x86,
      0x6c, 0x15, 0x4c, 0x32, 0x79, 0xfd, 0x2d, 0xd7, 0xf6, 0x9,  0x0,  0x1c, 0x2e, 0x8e, 0x1c, 0xb9, 0xa0, 0x24, 0x28,
      0xad, 0x35, 0x78, 0xcc, 0x2d, 0x37, 0xbd, 0xea, 0x75, 0x59, 0xe4, 0x84, 0x9c, 0x46, 0xd2, 0xfb, 0x91, 0x81, 0x88,
      0x90, 0xf9, 0x2a, 0xd1, 0x2,  0x0,  0x0,  0x9,  0xce, 0x2a, 0xe7, 0x15, 0x0,  0x17, 0xab, 0x10, 0x20, 0x57, 0x59,
      0xa6, 0x3e, 0x5,  0x4b, 0xb0, 0x6e, 0xf6, 0xb1, 0xfc, 0x6b, 0xa5, 0x13, 0x68, 0x23, 0x2d, 0x45, 0xfe, 0xe2, 0x29,
      0xc7, 0x26, 0x0,  0x5,  0x9d, 0xf8, 0x9a, 0x6f, 0xb9, 0x0,  0x4,  0x2a, 0x17, 0x6f, 0x9a, 0x12, 0x0,  0x9,  0xd2,
      0x55, 0xc7, 0xe8, 0xc0, 0x5a, 0x79, 0x1e, 0x58, 0x1a, 0x0,  0xb,  0xb6, 0x39, 0x8c, 0xc0, 0x56, 0x43, 0xba, 0x20,
      0xa8, 0x1e, 0xdc, 0x1,  0x7d, 0x2,  0x0,  0x0,  0x66, 0x54, 0x23, 0x9,  0x20, 0x25, 0xdc, 0x28, 0xc,  0x1c, 0x0,
      0x1e, 0x4,  0x7,  0xfa, 0x50, 0xda, 0x83, 0x2,  0x19, 0x4,  0xaf, 0x8d, 0xfa, 0xeb, 0x5d, 0x3,  0x2a, 0x29, 0xf9,
      0x46, 0xcd, 0x95, 0x7f, 0x40, 0xe5, 0x3d, 0x54, 0xcd, 0x5a, 0xb7, 0xdb, 0x11, 0x0,  0x0,  0x7d, 0xac, 0xb,  0xe,
      0x12, 0x0,  0x6,  0x2,  0x24, 0x43, 0x91, 0x2,  0x3,  0x13, 0x52, 0x23, 0x2,  0x0,  0x0,  0x5e, 0x44, 0x21, 0x75,
      0x8f, 0x1c, 0x0,  0x10, 0x73, 0xad, 0xbf, 0xd0, 0x36, 0x5c, 0x2,  0xce, 0x11, 0x83, 0xf1, 0xa5, 0x10, 0x9,  0xe6,
      0xd,  0x23, 0x39, 0xcc, 0x25, 0x78, 0x2,  0x1,  0x97, 0x1,  0x0,  0x2,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4187);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
}

// SubscribeResponse 1954 [Left SubErrNotAuthorized,Right QoS2,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Right QoS2] [PropWildcardSubscriptionAvailable 1,PropWildcardSubscriptionAvailable 77,PropServerKeepAlive
// 4976,PropSharedSubscriptionAvailable 54,PropReceiveMaximum 9243,PropRequestProblemInformation 35,PropServerKeepAlive
// 529]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x1c, 0x7,  0xa2, 0x11, 0x28, 0x1,  0x28, 0x4d, 0x13, 0x13, 0x70, 0x2a, 0x36, 0x21,
                   0x24, 0x1b, 0x17, 0x23, 0x13, 0x2,  0x11, 0x87, 0x2,  0x80, 0x8f, 0xa2, 0x83, 0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1954);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 9962 [Left SubErrPacketIdentifierInUse,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrNotAuthorized,Right QoS1,Left SubErrQuotaExceeded,Right QoS1] [PropMaximumQoS 33,PropPayloadFormatIndicator
// 170,PropMessageExpiryInterval 9660,PropServerKeepAlive 20380,PropPayloadFormatIndicator 9,PropWillDelayInterval
// 18773,PropRequestProblemInformation 73,PropResponseInformation
// "\191\166J\b\ETB\249\139\SOHx^\232\218\136q\166hn\SUB\SYN6\136\231\179l\147\SUB\242T\ESC",PropSessionExpiryInterval
// 24270]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x43, 0x26, 0xea, 0x3a, 0x24, 0x21, 0x1,  0xaa, 0x2,  0x0,  0x0,  0x25, 0xbc,
                   0x13, 0x4f, 0x9c, 0x1,  0x9,  0x18, 0x0,  0x0,  0x49, 0x55, 0x17, 0x49, 0x1a, 0x0,
                   0x1d, 0xbf, 0xa6, 0x4a, 0x8,  0x17, 0xf9, 0x8b, 0x1,  0x78, 0x5e, 0xe8, 0xda, 0x88,
                   0x71, 0xa6, 0x68, 0x6e, 0x1a, 0x16, 0x36, 0x88, 0xe7, 0xb3, 0x6c, 0x93, 0x1a, 0xf2,
                   0x54, 0x1b, 0x11, 0x0,  0x0,  0x5e, 0xce, 0x91, 0xa2, 0x87, 0x1,  0x97, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9962);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 16427 [Left SubErrQuotaExceeded,Right QoS0,Right QoS2,Right QoS2,Right QoS1]
// [PropRequestResponseInformation 104,PropServerReference "\171",PropSubscriptionIdentifier 24,PropAuthenticationData
// "1",PropAssignedClientIdentifier
// "\209\246\222`\DC2\132.\217E:l\133\145\221g\248\215\&1\208\172M\239\252\&3",PropSubscriptionIdentifier
// 7,PropMessageExpiryInterval 31633,PropMaximumPacketSize 12879,PropSessionExpiryInterval 4551,PropCorrelationData
// "\250Q@",PropWillDelayInterval 11026,PropReasonString "K\146\247[e\253c\221\184y]fG\128\218L\200\129",PropTopicAlias
// 9372,PropServerReference
// "\160\245\250y\147\180\182\RS\217M\134\a\245wQ\178Z\143E\208\248\212\181\139ye\130PC",PropMaximumQoS
// 220,PropAuthenticationMethod
// "\170\250#\131>\147QF\142\234\CAN\DC4\173j\ETXe\236\ACK\186\211\215;D\US]",PropUserProperty
// "\178\153Rs\169\169\141\DC1\130\&0\170xek\183\143\208C\NAK\v"
// "\243\DLE'j\140$\206e\226F\174\247\241Zs\148\144\221\166R\153$\209\133\248",PropTopicAlias
// 7597,PropAuthenticationData "\221\160\DC2\CAN\237W=S\167\EM^6ATm",PropAuthenticationData "'\193r;\208\DC1"]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {
      0x90, 0xf2, 0x1,  0x40, 0x2b, 0xe9, 0x1,  0x19, 0x68, 0x1c, 0x0,  0x1,  0xab, 0xb,  0x18, 0x16, 0x0,  0x1,  0x31,
      0x12, 0x0,  0x18, 0xd1, 0xf6, 0xde, 0x60, 0x12, 0x84, 0x2e, 0xd9, 0x45, 0x3a, 0x6c, 0x85, 0x91, 0xdd, 0x67, 0xf8,
      0xd7, 0x31, 0xd0, 0xac, 0x4d, 0xef, 0xfc, 0x33, 0xb,  0x7,  0x2,  0x0,  0x0,  0x7b, 0x91, 0x27, 0x0,  0x0,  0x32,
      0x4f, 0x11, 0x0,  0x0,  0x11, 0xc7, 0x9,  0x0,  0x3,  0xfa, 0x51, 0x40, 0x18, 0x0,  0x0,  0x2b, 0x12, 0x1f, 0x0,
      0x12, 0x4b, 0x92, 0xf7, 0x5b, 0x65, 0xfd, 0x63, 0xdd, 0xb8, 0x79, 0x5d, 0x66, 0x47, 0x80, 0xda, 0x4c, 0xc8, 0x81,
      0x23, 0x24, 0x9c, 0x1c, 0x0,  0x1d, 0xa0, 0xf5, 0xfa, 0x79, 0x93, 0xb4, 0xb6, 0x1e, 0xd9, 0x4d, 0x86, 0x7,  0xf5,
      0x77, 0x51, 0xb2, 0x5a, 0x8f, 0x45, 0xd0, 0xf8, 0xd4, 0xb5, 0x8b, 0x79, 0x65, 0x82, 0x50, 0x43, 0x24, 0xdc, 0x15,
      0x0,  0x19, 0xaa, 0xfa, 0x23, 0x83, 0x3e, 0x93, 0x51, 0x46, 0x8e, 0xea, 0x18, 0x14, 0xad, 0x6a, 0x3,  0x65, 0xec,
      0x6,  0xba, 0xd3, 0xd7, 0x3b, 0x44, 0x1f, 0x5d, 0x26, 0x0,  0x14, 0xb2, 0x99, 0x52, 0x73, 0xa9, 0xa9, 0x8d, 0x11,
      0x82, 0x30, 0xaa, 0x78, 0x65, 0x6b, 0xb7, 0x8f, 0xd0, 0x43, 0x15, 0xb,  0x0,  0x19, 0xf3, 0x10, 0x27, 0x6a, 0x8c,
      0x24, 0xce, 0x65, 0xe2, 0x46, 0xae, 0xf7, 0xf1, 0x5a, 0x73, 0x94, 0x90, 0xdd, 0xa6, 0x52, 0x99, 0x24, 0xd1, 0x85,
      0xf8, 0x23, 0x1d, 0xad, 0x16, 0x0,  0xf,  0xdd, 0xa0, 0x12, 0x18, 0xed, 0x57, 0x3d, 0x53, 0xa7, 0x19, 0x5e, 0x36,
      0x41, 0x54, 0x6d, 0x16, 0x0,  0x6,  0x27, 0xc1, 0x72, 0x3b, 0xd0, 0x11, 0x97, 0x0,  0x2,  0x2,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16427);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
}

// SubscribeResponse 14848 [Left SubErrImplementationSpecificError,Left SubErrSubscriptionIdentifiersNotSupported]
// [PropAuthenticationMethod "\247\225\239\136\176\&4",PropReceiveMaximum 9177,PropTopicAlias
// 31213,PropMessageExpiryInterval 28807,PropAuthenticationData
// "yG\175\195\166\213\225rZ\180\166y\242\185;\174B\213\200\204<%\245`\188\t("]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x37, 0x3a, 0x0,  0x32, 0x15, 0x0,  0x6,  0xf7, 0xe1, 0xef, 0x88, 0xb0, 0x34, 0x21,
                   0x23, 0xd9, 0x23, 0x79, 0xed, 0x2,  0x0,  0x0,  0x70, 0x87, 0x16, 0x0,  0x1b, 0x79, 0x47,
                   0xaf, 0xc3, 0xa6, 0xd5, 0xe1, 0x72, 0x5a, 0xb4, 0xa6, 0x79, 0xf2, 0xb9, 0x3b, 0xae, 0x42,
                   0xd5, 0xc8, 0xcc, 0x3c, 0x25, 0xf5, 0x60, 0xbc, 0x9,  0x28, 0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14848);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
}

// SubscribeResponse 15477 [Left SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Right QoS2,Right QoS2,Right
// QoS1,Left SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported] [PropCorrelationData "\rs\233\246",PropReceiveMaximum
// 20152,PropPayloadFormatIndicator 57,PropMessageExpiryInterval 1359,PropMessageExpiryInterval
// 416,PropAssignedClientIdentifier "9(<\DLEb\v\177",PropCorrelationData
// "\251V\195\DC3(\180\133\199\140l,\194\253>\209d,<\244\180\208\156b",PropMaximumPacketSize 16384,PropServerKeepAlive
// 4743,PropUserProperty "\201\ENQT\158=c+Sz\166;H"
// "\255\r\159D\255\217_\211Q\211\DC4)\241\&4\228\233\233\182\247\ETB\146",PropRetainAvailable 89,PropMaximumPacketSize
// 12246,PropAuthenticationData
// "\154M\163\186A\197\ETBA\168e\204\219M\227\205\&8@\169\t\148\143u\233\136\170",PropMessageExpiryInterval
// 9201,PropWillDelayInterval 21887,PropResponseInformation ".?`8",PropAssignedClientIdentifier
// "\203\nsi\226`\151\184,J\STXM\233\FS\254\GS",PropRetainAvailable 242,PropRequestResponseInformation
// 207,PropSessionExpiryInterval 22939,PropAuthenticationMethod "A!\163>\SO",PropMaximumPacketSize
// 4575,PropRetainAvailable 139,PropAssignedClientIdentifier
// "&\213\DC3\196\185\196\&1x\247\198\134\241\137a\211%\133;\147\222\&9_;uuoV\223'\148",PropRequestResponseInformation
// 61,PropRequestResponseInformation 212,PropRequestProblemInformation 58,PropUserProperty
// "\220:\237\190Kv\206\137\183\ETB\168R\189W\194\171q;\141U,\148\216kT\GS\203*"
// "\185\225L\GSq-\237\203H\224",PropUserProperty "\SITp>Q\163\157oR\USI\195\v\247i\RSYW\206d\255\251\224W\162"
// "\231hkmJp\\<0"]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {
      0x90, 0xce, 0x2,  0x3c, 0x75, 0xc0, 0x2,  0x9,  0x0,  0x4,  0xd,  0x73, 0xe9, 0xf6, 0x21, 0x4e, 0xb8, 0x1,  0x39,
      0x2,  0x0,  0x0,  0x5,  0x4f, 0x2,  0x0,  0x0,  0x1,  0xa0, 0x12, 0x0,  0x7,  0x39, 0x28, 0x3c, 0x10, 0x62, 0xb,
      0xb1, 0x9,  0x0,  0x17, 0xfb, 0x56, 0xc3, 0x13, 0x28, 0xb4, 0x85, 0xc7, 0x8c, 0x6c, 0x2c, 0xc2, 0xfd, 0x3e, 0xd1,
      0x64, 0x2c, 0x3c, 0xf4, 0xb4, 0xd0, 0x9c, 0x62, 0x27, 0x0,  0x0,  0x40, 0x0,  0x13, 0x12, 0x87, 0x26, 0x0,  0xc,
      0xc9, 0x5,  0x54, 0x9e, 0x3d, 0x63, 0x2b, 0x53, 0x7a, 0xa6, 0x3b, 0x48, 0x0,  0x15, 0xff, 0xd,  0x9f, 0x44, 0xff,
      0xd9, 0x5f, 0xd3, 0x51, 0xd3, 0x14, 0x29, 0xf1, 0x34, 0xe4, 0xe9, 0xe9, 0xb6, 0xf7, 0x17, 0x92, 0x25, 0x59, 0x27,
      0x0,  0x0,  0x2f, 0xd6, 0x16, 0x0,  0x19, 0x9a, 0x4d, 0xa3, 0xba, 0x41, 0xc5, 0x17, 0x41, 0xa8, 0x65, 0xcc, 0xdb,
      0x4d, 0xe3, 0xcd, 0x38, 0x40, 0xa9, 0x9,  0x94, 0x8f, 0x75, 0xe9, 0x88, 0xaa, 0x2,  0x0,  0x0,  0x23, 0xf1, 0x18,
      0x0,  0x0,  0x55, 0x7f, 0x1a, 0x0,  0x4,  0x2e, 0x3f, 0x60, 0x38, 0x12, 0x0,  0x10, 0xcb, 0xa,  0x73, 0x69, 0xe2,
      0x60, 0x97, 0xb8, 0x2c, 0x4a, 0x2,  0x4d, 0xe9, 0x1c, 0xfe, 0x1d, 0x25, 0xf2, 0x19, 0xcf, 0x11, 0x0,  0x0,  0x59,
      0x9b, 0x15, 0x0,  0x5,  0x41, 0x21, 0xa3, 0x3e, 0xe,  0x27, 0x0,  0x0,  0x11, 0xdf, 0x25, 0x8b, 0x12, 0x0,  0x1e,
      0x26, 0xd5, 0x13, 0xc4, 0xb9, 0xc4, 0x31, 0x78, 0xf7, 0xc6, 0x86, 0xf1, 0x89, 0x61, 0xd3, 0x25, 0x85, 0x3b, 0x93,
      0xde, 0x39, 0x5f, 0x3b, 0x75, 0x75, 0x6f, 0x56, 0xdf, 0x27, 0x94, 0x19, 0x3d, 0x19, 0xd4, 0x17, 0x3a, 0x26, 0x0,
      0x1c, 0xdc, 0x3a, 0xed, 0xbe, 0x4b, 0x76, 0xce, 0x89, 0xb7, 0x17, 0xa8, 0x52, 0xbd, 0x57, 0xc2, 0xab, 0x71, 0x3b,
      0x8d, 0x55, 0x2c, 0x94, 0xd8, 0x6b, 0x54, 0x1d, 0xcb, 0x2a, 0x0,  0xa,  0xb9, 0xe1, 0x4c, 0x1d, 0x71, 0x2d, 0xed,
      0xcb, 0x48, 0xe0, 0x26, 0x0,  0x19, 0xf,  0x54, 0x70, 0x3e, 0x51, 0xa3, 0x9d, 0x6f, 0x52, 0x1f, 0x49, 0xc3, 0xb,
      0xf7, 0x69, 0x1e, 0x59, 0x57, 0xce, 0x64, 0xff, 0xfb, 0xe0, 0x57, 0xa2, 0x0,  0x9,  0xe7, 0x68, 0x6b, 0x6d, 0x4a,
      0x70, 0x5c, 0x3c, 0x30, 0x91, 0x87, 0x2,  0x2,  0x1,  0x9e, 0x80, 0x0,  0x1,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15477);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x9E);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], 0xA2);
}

// SubscribeResponse 13181 [Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right
// QoS2,Left SubErrImplementationSpecificError,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS1,Left SubErrUnspecifiedError] []
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0xc, 0x33, 0x7d, 0x0, 0x87, 0x80, 0x87, 0x2, 0x83, 0xa1, 0x91, 0x1, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13181);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], 0xA1);
  EXPECT_EQ(granted_qos_levels[6], 0x91);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 32677 [Right QoS1,Left SubErrUnspecifiedError,Right QoS2,Right QoS0,Right QoS2]
// [PropWillDelayInterval 12589,PropAuthenticationMethod "\129\137\142\235H
// \251|,K2\230\192+/^\176X\133\198\GSX\ENQ9",PropReasonString "eH\142\&3\189\203\235W\146",PropContentType
// "D\160|\f\237{G>\166\218\187\145\187\250\153\175\210\247\SI\v\ESC\167",PropServerReference "",PropWillDelayInterval
// 9311,PropUserProperty "\168=R\203\211\187%\205\&6!*zW\STX\191\157\147\&9=\183y"
// "A\138\133\178f\225U\213\&4w\241T^\175\226l\138\248\222Be^\US{m\184\242\"\n",PropSubscriptionIdentifierAvailable
// 212,PropRequestResponseInformation 189,PropMaximumPacketSize 13803,PropAuthenticationData
// "`!8e",PropMessageExpiryInterval 3947,PropSubscriptionIdentifier 26,PropMessageExpiryInterval 17424,PropMaximumQoS
// 58,PropSubscriptionIdentifierAvailable 188,PropCorrelationData
// "*\162\212\170\201\152\213\129",PropRequestResponseInformation 251,PropCorrelationData
// "\172i\SYNA\196\181\EM(|\246\129\ETB \DC2.\176\210\251\128\\\177n\SI\251\EM",PropWildcardSubscriptionAvailable 206]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0xd8, 0x1,  0x7f, 0xa5, 0xcf, 0x1,  0x18, 0x0,  0x0,  0x31, 0x2d, 0x15, 0x0,  0x18, 0x81, 0x89,
                   0x8e, 0xeb, 0x48, 0x20, 0xfb, 0x7c, 0x2c, 0x4b, 0x32, 0xe6, 0xc0, 0x2b, 0x2f, 0x5e, 0xb0, 0x58, 0x85,
                   0xc6, 0x1d, 0x58, 0x5,  0x39, 0x1f, 0x0,  0x9,  0x65, 0x48, 0x8e, 0x33, 0xbd, 0xcb, 0xeb, 0x57, 0x92,
                   0x3,  0x0,  0x16, 0x44, 0xa0, 0x7c, 0xc,  0xed, 0x7b, 0x47, 0x3e, 0xa6, 0xda, 0xbb, 0x91, 0xbb, 0xfa,
                   0x99, 0xaf, 0xd2, 0xf7, 0xf,  0xb,  0x1b, 0xa7, 0x1c, 0x0,  0x0,  0x18, 0x0,  0x0,  0x24, 0x5f, 0x26,
                   0x0,  0x15, 0xa8, 0x3d, 0x52, 0xcb, 0xd3, 0xbb, 0x25, 0xcd, 0x36, 0x21, 0x2a, 0x7a, 0x57, 0x2,  0xbf,
                   0x9d, 0x93, 0x39, 0x3d, 0xb7, 0x79, 0x0,  0x1d, 0x41, 0x8a, 0x85, 0xb2, 0x66, 0xe1, 0x55, 0xd5, 0x34,
                   0x77, 0xf1, 0x54, 0x5e, 0xaf, 0xe2, 0x6c, 0x8a, 0xf8, 0xde, 0x42, 0x65, 0x5e, 0x1f, 0x7b, 0x6d, 0xb8,
                   0xf2, 0x22, 0xa,  0x29, 0xd4, 0x19, 0xbd, 0x27, 0x0,  0x0,  0x35, 0xeb, 0x16, 0x0,  0x4,  0x60, 0x21,
                   0x38, 0x65, 0x2,  0x0,  0x0,  0xf,  0x6b, 0xb,  0x1a, 0x2,  0x0,  0x0,  0x44, 0x10, 0x24, 0x3a, 0x29,
                   0xbc, 0x9,  0x0,  0x8,  0x2a, 0xa2, 0xd4, 0xaa, 0xc9, 0x98, 0xd5, 0x81, 0x19, 0xfb, 0x9,  0x0,  0x19,
                   0xac, 0x69, 0x16, 0x41, 0xc4, 0xb5, 0x19, 0x28, 0x7c, 0xf6, 0x81, 0x17, 0x20, 0x12, 0x2e, 0xb0, 0xd2,
                   0xfb, 0x80, 0x5c, 0xb1, 0x6e, 0xf,  0xfb, 0x19, 0x28, 0xce, 0x1,  0x80, 0x2,  0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32677);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 14851 [Right QoS0,Left SubErrNotAuthorized,Left SubErrUnspecifiedError,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrImplementationSpecificError,Left SubErrNotAuthorized,Left
// SubErrSharedSubscriptionsNotSupported] [PropAuthenticationData ""]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xe, 0x3a, 0x3, 0x3, 0x16, 0x0, 0x0, 0x0, 0x87, 0x80, 0x9e, 0x1, 0x83, 0x87, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14851);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], 0x87);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
}
