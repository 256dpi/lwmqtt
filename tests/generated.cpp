#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

static lwmqtt_properties_t empty_props = lwmqtt_empty_props;

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\136Y\192\226{\129\199E\USu\182\215\SUB'\245\DC4\171\139\NAKY", _pubPktID = 15774, _pubBody = "\255", _pubProps =
// []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x32, 0x19, 0x0,  0x14, 0x88, 0x59, 0xc0, 0xe2, 0x7b, 0x81, 0xc7, 0x45, 0x1f, 0x75,
                   0xb6, 0xd7, 0x1a, 0x27, 0xf5, 0x14, 0xab, 0x8b, 0x15, 0x59, 0x3d, 0x9e, 0xff};

  uint8_t buf[37] = {0};

  uint8_t topic_bytes[] = {0x88, 0x59, 0xc0, 0xe2, 0x7b, 0x81, 0xc7, 0x45, 0x1f, 0x75,
                           0xb6, 0xd7, 0x1a, 0x27, 0xf5, 0x14, 0xab, 0x8b, 0x15, 0x59};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 15774, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129/gG\151\&6y\225\246\193\230",
// _pubPktID = 31160, _pubBody = "\243\207\138\211\213\183N\154\SOafk\220\SUBT", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3d, 0x1e, 0x0,  0xb,  0x81, 0x2f, 0x67, 0x47, 0x97, 0x36, 0x79, 0xe1, 0xf6, 0xc1, 0xe6, 0x79,
                   0xb8, 0xf3, 0xcf, 0x8a, 0xd3, 0xd5, 0xb7, 0x4e, 0x9a, 0xe,  0x61, 0x66, 0x6b, 0xdc, 0x1a, 0x54};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x81, 0x2f, 0x67, 0x47, 0x97, 0x36, 0x79, 0xe1, 0xf6, 0xc1, 0xe6};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf3, 0xcf, 0x8a, 0xd3, 0xd5, 0xb7, 0x4e, 0x9a, 0xe, 0x61, 0x66, 0x6b, 0xdc, 0x1a, 0x54};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 31160, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\FS\174\250\f\SYN6\ENQ\218i\199\ETB\213\180 \FS%", _pubPktID = 27531, _pubBody = "\129\232\a\215w\236",
// _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0x1b, 0x0,  0x11, 0xad, 0x1c, 0xae, 0xfa, 0xc,  0x16, 0x36, 0x5,  0xda, 0x69, 0xc7,
                   0x17, 0xd5, 0xb4, 0x20, 0x1c, 0x25, 0x6b, 0x8b, 0x81, 0xe8, 0x7,  0xd7, 0x77, 0xec};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0xad, 0x1c, 0xae, 0xfa, 0xc,  0x16, 0x36, 0x5, 0xda,
                           0x69, 0xc7, 0x17, 0xd5, 0xb4, 0x20, 0x1c, 0x25};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0xe8, 0x7, 0xd7, 0x77, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 27531, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "y\135\f\ESC\175I\RS=", _pubPktID =
// 3010, _pubBody = "\198L\248\190/9\218\229\251^", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x35, 0x16, 0x0,  0x8,  0x79, 0x87, 0xc,  0x1b, 0xaf, 0x49, 0x1e, 0x3d,
                   0xb,  0xc2, 0xc6, 0x4c, 0xf8, 0xbe, 0x2f, 0x39, 0xda, 0xe5, 0xfb, 0x5e};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0x79, 0x87, 0xc, 0x1b, 0xaf, 0x49, 0x1e, 0x3d};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc6, 0x4c, 0xf8, 0xbe, 0x2f, 0x39, 0xda, 0xe5, 0xfb, 0x5e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 3010, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\fQ\131\202\NAK\EOTT\204\226\174\189\&72w\136\ETX\142I\166)\137*", _pubPktID = 0, _pubBody = "\148\134\189",
// _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x30, 0x1b, 0x0,  0x16, 0xc, 0x51, 0x83, 0xca, 0x15, 0x4,  0x54, 0xcc, 0xe2, 0xae, 0xbd,
                   0x37, 0x32, 0x77, 0x88, 0x3, 0x8e, 0x49, 0xa6, 0x29, 0x89, 0x2a, 0x94, 0x86, 0xbd};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0xc,  0x51, 0x83, 0xca, 0x15, 0x4,  0x54, 0xcc, 0xe2, 0xae, 0xbd,
                           0x37, 0x32, 0x77, 0x88, 0x3,  0x8e, 0x49, 0xa6, 0x29, 0x89, 0x2a};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x94, 0x86, 0xbd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\186\EMG9\192\229\240\204\DC2o",
// _pubPktID = 0, _pubBody = "\166!\209#\147\&1%\222\235\133Gd\174=\SIf\247\215\US^6\b\r", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x38, 0x23, 0x0,  0xa,  0xba, 0x19, 0x47, 0x39, 0xc0, 0xe5, 0xf0, 0xcc, 0x12,
                   0x6f, 0xa6, 0x21, 0xd1, 0x23, 0x93, 0x31, 0x25, 0xde, 0xeb, 0x85, 0x47, 0x64,
                   0xae, 0x3d, 0xf,  0x66, 0xf7, 0xd7, 0x1f, 0x5e, 0x36, 0x8,  0xd};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0xba, 0x19, 0x47, 0x39, 0xc0, 0xe5, 0xf0, 0xcc, 0x12, 0x6f};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0x21, 0xd1, 0x23, 0x93, 0x31, 0x25, 0xde, 0xeb, 0x85, 0x47, 0x64,
                         0xae, 0x3d, 0xf,  0x66, 0xf7, 0xd7, 0x1f, 0x5e, 0x36, 0x8,  0xd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\249\r\220\v\234\SOH\157\DC1_\145mx\199\189\136\241\241\184\225\ETX\132\GS\231\210\133\RS\r", _pubPktID = 32631,
// _pubBody = "\145\209\172\139\202&x\240\162\148\\U", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x33, 0x2b, 0x0,  0x1b, 0xf9, 0xd,  0xdc, 0xb,  0xea, 0x1,  0x9d, 0x11, 0x5f, 0x91, 0x6d,
                   0x78, 0xc7, 0xbd, 0x88, 0xf1, 0xf1, 0xb8, 0xe1, 0x3,  0x84, 0x1d, 0xe7, 0xd2, 0x85, 0x1e,
                   0xd,  0x7f, 0x77, 0x91, 0xd1, 0xac, 0x8b, 0xca, 0x26, 0x78, 0xf0, 0xa2, 0x94, 0x5c, 0x55};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0xf9, 0xd,  0xdc, 0xb,  0xea, 0x1, 0x9d, 0x11, 0x5f, 0x91, 0x6d, 0x78, 0xc7, 0xbd,
                           0x88, 0xf1, 0xf1, 0xb8, 0xe1, 0x3, 0x84, 0x1d, 0xe7, 0xd2, 0x85, 0x1e, 0xd};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x91, 0xd1, 0xac, 0x8b, 0xca, 0x26, 0x78, 0xf0, 0xa2, 0x94, 0x5c, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 32631, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "b\213\SO\144\154E1Y", _pubPktID =
// 17459, _pubBody = "\197\176\151_P\DC4\162Y\176\178\tN}p\223\213\213\215\&9\208.dWr", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0x8,  0x62, 0xd5, 0xe,  0x90, 0x9a, 0x45, 0x31, 0x59, 0x44,
                   0x33, 0xc5, 0xb0, 0x97, 0x5f, 0x50, 0x14, 0xa2, 0x59, 0xb0, 0xb2, 0x9,  0x4e,
                   0x7d, 0x70, 0xdf, 0xd5, 0xd5, 0xd7, 0x39, 0xd0, 0x2e, 0x64, 0x57, 0x72};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0x62, 0xd5, 0xe, 0x90, 0x9a, 0x45, 0x31, 0x59};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc5, 0xb0, 0x97, 0x5f, 0x50, 0x14, 0xa2, 0x59, 0xb0, 0xb2, 0x9,  0x4e,
                         0x7d, 0x70, 0xdf, 0xd5, 0xd5, 0xd7, 0x39, 0xd0, 0x2e, 0x64, 0x57, 0x72};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17459, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\222\129", _pubPktID = 4136,
// _pubBody = "\238\173\129\190\233\254\157\252\185\239@\147\192rs\143\219-\185\140j5\231\226Y\SYN+", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x35, 0x21, 0x0,  0x2,  0xde, 0x81, 0x10, 0x28, 0xee, 0xad, 0x81, 0xbe,
                   0xe9, 0xfe, 0x9d, 0xfc, 0xb9, 0xef, 0x40, 0x93, 0xc0, 0x72, 0x73, 0x8f,
                   0xdb, 0x2d, 0xb9, 0x8c, 0x6a, 0x35, 0xe7, 0xe2, 0x59, 0x16, 0x2b};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0xde, 0x81};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xee, 0xad, 0x81, 0xbe, 0xe9, 0xfe, 0x9d, 0xfc, 0xb9, 0xef, 0x40, 0x93, 0xc0, 0x72,
                         0x73, 0x8f, 0xdb, 0x2d, 0xb9, 0x8c, 0x6a, 0x35, 0xe7, 0xe2, 0x59, 0x16, 0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 4136, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "]Bpc\184\177\176\&3}-\DC4K", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x30, 0xe, 0x0, 0x0, 0x5d, 0x42, 0x70, 0x63, 0xb8, 0xb1, 0xb0, 0x33, 0x7d, 0x2d, 0x14, 0x4b};

  uint8_t buf[26] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5d, 0x42, 0x70, 0x63, 0xb8, 0xb1, 0xb0, 0x33, 0x7d, 0x2d, 0x14, 0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "/u\181\175\201\CANO", _pubPktID = 0,
// _pubBody = "\234\204\242\217\131\187\a+\140\DC4NsE\f\166\DC1\206pf\ETB\150\193\138\249\166r\189-S\EOT", _pubProps =
// []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x38, 0x27, 0x0,  0x7,  0x2f, 0x75, 0xb5, 0xaf, 0xc9, 0x18, 0x4f, 0xea, 0xcc, 0xf2,
                   0xd9, 0x83, 0xbb, 0x7,  0x2b, 0x8c, 0x14, 0x4e, 0x73, 0x45, 0xc,  0xa6, 0x11, 0xce,
                   0x70, 0x66, 0x17, 0x96, 0xc1, 0x8a, 0xf9, 0xa6, 0x72, 0xbd, 0x2d, 0x53, 0x4};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x2f, 0x75, 0xb5, 0xaf, 0xc9, 0x18, 0x4f};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xea, 0xcc, 0xf2, 0xd9, 0x83, 0xbb, 0x7,  0x2b, 0x8c, 0x14, 0x4e, 0x73, 0x45, 0xc,  0xa6,
                         0x11, 0xce, 0x70, 0x66, 0x17, 0x96, 0xc1, 0x8a, 0xf9, 0xa6, 0x72, 0xbd, 0x2d, 0x53, 0x4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "-\243H\202R\162w&\149\233\171\223",
// _pubPktID = 0, _pubBody = "\216\SO\135\ENQ\236\223\tG\203\177\ESC\132\135)\187", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0x1d, 0x0,  0xc, 0x2d, 0xf3, 0x48, 0xca, 0x52, 0xa2, 0x77, 0x26, 0x95, 0xe9, 0xab, 0xdf,
                   0xd8, 0xe,  0x87, 0x5, 0xec, 0xdf, 0x9,  0x47, 0xcb, 0xb1, 0x1b, 0x84, 0x87, 0x29, 0xbb};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0x2d, 0xf3, 0x48, 0xca, 0x52, 0xa2, 0x77, 0x26, 0x95, 0xe9, 0xab, 0xdf};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0xe, 0x87, 0x5, 0xec, 0xdf, 0x9, 0x47, 0xcb, 0xb1, 0x1b, 0x84, 0x87, 0x29, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "W\133\164\255\227+
// \229\201\165[q\DC25\225\242\160 >\bi", _pubPktID = 0, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x30, 0x17, 0x0,  0x15, 0x57, 0x85, 0xa4, 0xff, 0xe3, 0x2b, 0x20, 0xe5, 0xc9,
                   0xa5, 0x5b, 0x71, 0x12, 0x35, 0xe1, 0xf2, 0xa0, 0x20, 0x3e, 0x8,  0x69};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0x57, 0x85, 0xa4, 0xff, 0xe3, 0x2b, 0x20, 0xe5, 0xc9, 0xa5, 0x5b,
                           0x71, 0x12, 0x35, 0xe1, 0xf2, 0xa0, 0x20, 0x3e, 0x8,  0x69};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "R\227\143", _pubPktID = 0, _pubBody
// = "\199\n\253\247[u\151,J\129\t\179\246y0]\143\131\146\&4n*\175\136\&6\181\148Z\ETX", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x3,  0x52, 0xe3, 0x8f, 0xc7, 0xa,  0xfd, 0xf7, 0x5b,
                   0x75, 0x97, 0x2c, 0x4a, 0x81, 0x9,  0xb3, 0xf6, 0x79, 0x30, 0x5d, 0x8f,
                   0x83, 0x92, 0x34, 0x6e, 0x2a, 0xaf, 0x88, 0x36, 0xb5, 0x94, 0x5a, 0x3};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0x52, 0xe3, 0x8f};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0xa,  0xfd, 0xf7, 0x5b, 0x75, 0x97, 0x2c, 0x4a, 0x81, 0x9,  0xb3, 0xf6, 0x79, 0x30,
                         0x5d, 0x8f, 0x83, 0x92, 0x34, 0x6e, 0x2a, 0xaf, 0x88, 0x36, 0xb5, 0x94, 0x5a, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DEL-\129\&3\194M2T6\ETBV5_#\188$\131T\222\ESC\137\a.\147%b", _pubPktID = 0, _pubBody =
// "\v]\154\169\138\225f:\202\251\DLEgw{\243\150\155\DELc8", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x30, 0x30, 0x0,  0x1a, 0x7f, 0x2d, 0x81, 0x33, 0xc2, 0x4d, 0x32, 0x54, 0x36, 0x17, 0x56, 0x35, 0x5f,
                   0x23, 0xbc, 0x24, 0x83, 0x54, 0xde, 0x1b, 0x89, 0x7,  0x2e, 0x93, 0x25, 0x62, 0xb,  0x5d, 0x9a, 0xa9,
                   0x8a, 0xe1, 0x66, 0x3a, 0xca, 0xfb, 0x10, 0x67, 0x77, 0x7b, 0xf3, 0x96, 0x9b, 0x7f, 0x63, 0x38};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x7f, 0x2d, 0x81, 0x33, 0xc2, 0x4d, 0x32, 0x54, 0x36, 0x17, 0x56, 0x35, 0x5f,
                           0x23, 0xbc, 0x24, 0x83, 0x54, 0xde, 0x1b, 0x89, 0x7,  0x2e, 0x93, 0x25, 0x62};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0x5d, 0x9a, 0xa9, 0x8a, 0xe1, 0x66, 0x3a, 0xca, 0xfb,
                         0x10, 0x67, 0x77, 0x7b, 0xf3, 0x96, 0x9b, 0x7f, 0x63, 0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\250\181\213\174\156\146\244\243\180\160\170=", _pubPktID = 24114, _pubBody =
// "\GS-\202|\237\STX\ENQ\EM\159\143\130\NAK\242\212\182Cg\172#\193\150v\226", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x34, 0x27, 0x0,  0xc,  0xfa, 0xb5, 0xd5, 0xae, 0x9c, 0x92, 0xf4, 0xf3, 0xb4, 0xa0,
                   0xaa, 0x3d, 0x5e, 0x32, 0x1d, 0x2d, 0xca, 0x7c, 0xed, 0x2,  0x5,  0x19, 0x9f, 0x8f,
                   0x82, 0x15, 0xf2, 0xd4, 0xb6, 0x43, 0x67, 0xac, 0x23, 0xc1, 0x96, 0x76, 0xe2};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0xfa, 0xb5, 0xd5, 0xae, 0x9c, 0x92, 0xf4, 0xf3, 0xb4, 0xa0, 0xaa, 0x3d};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1d, 0x2d, 0xca, 0x7c, 0xed, 0x2,  0x5,  0x19, 0x9f, 0x8f, 0x82, 0x15,
                         0xf2, 0xd4, 0xb6, 0x43, 0x67, 0xac, 0x23, 0xc1, 0x96, 0x76, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24114, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "K\128\243a\178\253\219\184\171;*\244\172'5\EMTE\CAN", _pubPktID = 30980, _pubBody = "c\SUB\219{", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x3b, 0x1b, 0x0,  0x13, 0x4b, 0x80, 0xf3, 0x61, 0xb2, 0xfd, 0xdb, 0xb8, 0xab, 0x3b, 0x2a,
                   0xf4, 0xac, 0x27, 0x35, 0x19, 0x54, 0x45, 0x18, 0x79, 0x4,  0x63, 0x1a, 0xdb, 0x7b};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0x4b, 0x80, 0xf3, 0x61, 0xb2, 0xfd, 0xdb, 0xb8, 0xab, 0x3b,
                           0x2a, 0xf4, 0xac, 0x27, 0x35, 0x19, 0x54, 0x45, 0x18};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x63, 0x1a, 0xdb, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 30980, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "q\133\153L\176\219b\169Cy", _pubPktID
// = 0, _pubBody = "R\253\227\&8\219\234\CANi\174R\250\248\234\146G]X\252\NAK\167/\195\SUB:\GS\182-", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x39, 0x27, 0x0,  0xa,  0x71, 0x85, 0x99, 0x4c, 0xb0, 0xdb, 0x62, 0xa9, 0x43, 0x79,
                   0x52, 0xfd, 0xe3, 0x38, 0xdb, 0xea, 0x18, 0x69, 0xae, 0x52, 0xfa, 0xf8, 0xea, 0x92,
                   0x47, 0x5d, 0x58, 0xfc, 0x15, 0xa7, 0x2f, 0xc3, 0x1a, 0x3a, 0x1d, 0xb6, 0x2d};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x71, 0x85, 0x99, 0x4c, 0xb0, 0xdb, 0x62, 0xa9, 0x43, 0x79};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x52, 0xfd, 0xe3, 0x38, 0xdb, 0xea, 0x18, 0x69, 0xae, 0x52, 0xfa, 0xf8, 0xea, 0x92,
                         0x47, 0x5d, 0x58, 0xfc, 0x15, 0xa7, 0x2f, 0xc3, 0x1a, 0x3a, 0x1d, 0xb6, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DC2]^:\232\227~//\232\188z\183\183\&6\248\242", _pubPktID = 31614, _pubBody =
// "g\207\142Q\206\&8\FS#f]\154[\195\180\140FW\182\130\168\&6\191\251\b\214\&0\141", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x3d, 0x30, 0x0,  0x11, 0x12, 0x5d, 0x5e, 0x3a, 0xe8, 0xe3, 0x7e, 0x2f, 0x2f, 0xe8, 0xbc, 0x7a, 0xb7,
                   0xb7, 0x36, 0xf8, 0xf2, 0x7b, 0x7e, 0x67, 0xcf, 0x8e, 0x51, 0xce, 0x38, 0x1c, 0x23, 0x66, 0x5d, 0x9a,
                   0x5b, 0xc3, 0xb4, 0x8c, 0x46, 0x57, 0xb6, 0x82, 0xa8, 0x36, 0xbf, 0xfb, 0x8,  0xd6, 0x30, 0x8d};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x12, 0x5d, 0x5e, 0x3a, 0xe8, 0xe3, 0x7e, 0x2f, 0x2f,
                           0xe8, 0xbc, 0x7a, 0xb7, 0xb7, 0x36, 0xf8, 0xf2};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x67, 0xcf, 0x8e, 0x51, 0xce, 0x38, 0x1c, 0x23, 0x66, 0x5d, 0x9a, 0x5b, 0xc3, 0xb4,
                         0x8c, 0x46, 0x57, 0xb6, 0x82, 0xa8, 0x36, 0xbf, 0xfb, 0x8,  0xd6, 0x30, 0x8d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 31614, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "y[U\202v\201A\203\136\164\190[\aZ\201\199", _pubPktID = 0, _pubBody = "`\132\CAN\206_pD[R", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x31, 0x1b, 0x0,  0x10, 0x79, 0x5b, 0x55, 0xca, 0x76, 0xc9, 0x41, 0xcb, 0x88, 0xa4, 0xbe,
                   0x5b, 0x7,  0x5a, 0xc9, 0xc7, 0x60, 0x84, 0x18, 0xce, 0x5f, 0x70, 0x44, 0x5b, 0x52};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0x79, 0x5b, 0x55, 0xca, 0x76, 0xc9, 0x41, 0xcb,
                           0x88, 0xa4, 0xbe, 0x5b, 0x7,  0x5a, 0xc9, 0xc7};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0x84, 0x18, 0xce, 0x5f, 0x70, 0x44, 0x5b, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "]\198\"\SUB3J\207\rX", _pubPktID =
// 0, _pubBody = "\132\170$!\216\174\202%\vC\188\240\ETB'b\DC1\134", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x30, 0x1c, 0x0,  0x9,  0x5d, 0xc6, 0x22, 0x1a, 0x33, 0x4a, 0xcf, 0xd,  0x58, 0x84, 0xaa,
                   0x24, 0x21, 0xd8, 0xae, 0xca, 0x25, 0xb,  0x43, 0xbc, 0xf0, 0x17, 0x27, 0x62, 0x11, 0x86};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0x5d, 0xc6, 0x22, 0x1a, 0x33, 0x4a, 0xcf, 0xd, 0x58};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x84, 0xaa, 0x24, 0x21, 0xd8, 0xae, 0xca, 0x25, 0xb,
                         0x43, 0xbc, 0xf0, 0x17, 0x27, 0x62, 0x11, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O&", _pubPktID = 13252, _pubBody =
// "\169\202l\203dz\202-l\161\226\155\212J@v\179", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x35, 0x17, 0x0,  0x2,  0x4f, 0x26, 0x33, 0xc4, 0xa9, 0xca, 0x6c, 0xcb, 0x64,
                   0x7a, 0xca, 0x2d, 0x6c, 0xa1, 0xe2, 0x9b, 0xd4, 0x4a, 0x40, 0x76, 0xb3};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0x4f, 0x26};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xca, 0x6c, 0xcb, 0x64, 0x7a, 0xca, 0x2d, 0x6c,
                         0xa1, 0xe2, 0x9b, 0xd4, 0x4a, 0x40, 0x76, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 13252, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\164J\248\ACKw\168\152\154\236q\RS\ESC\fX\129\180K\FS", _pubPktID = 14693, _pubBody =
// "3MM\195\166\SIw\199E\250\155\253\164\239\US\195\168\222\171\244\206\&7/\SO ?\231\SIK", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x3b, 0x34, 0x0,  0x13, 0xb,  0xa4, 0x4a, 0xf8, 0x6,  0x77, 0xa8, 0x98, 0x9a, 0xec,
                   0x71, 0x1e, 0x1b, 0xc,  0x58, 0x81, 0xb4, 0x4b, 0x1c, 0x39, 0x65, 0x33, 0x4d, 0x4d,
                   0xc3, 0xa6, 0xf,  0x77, 0xc7, 0x45, 0xfa, 0x9b, 0xfd, 0xa4, 0xef, 0x1f, 0xc3, 0xa8,
                   0xde, 0xab, 0xf4, 0xce, 0x37, 0x2f, 0xe,  0x20, 0x3f, 0xe7, 0xf,  0x4b};

  uint8_t buf[64] = {0};

  uint8_t topic_bytes[] = {0xb,  0xa4, 0x4a, 0xf8, 0x6,  0x77, 0xa8, 0x98, 0x9a, 0xec,
                           0x71, 0x1e, 0x1b, 0xc,  0x58, 0x81, 0xb4, 0x4b, 0x1c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x33, 0x4d, 0x4d, 0xc3, 0xa6, 0xf,  0x77, 0xc7, 0x45, 0xfa, 0x9b, 0xfd, 0xa4, 0xef, 0x1f,
                         0xc3, 0xa8, 0xde, 0xab, 0xf4, 0xce, 0x37, 0x2f, 0xe,  0x20, 0x3f, 0xe7, 0xf,  0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 14693, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\220\170\237\142", _pubPktID = 6499,
// _pubBody = "l\EOT h\135\217\143\178&\ETB$1\239@\177~BO}3V\"\176\SOH\255", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x3a, 0x21, 0x0,  0x4,  0xdc, 0xaa, 0xed, 0x8e, 0x19, 0x63, 0x6c, 0x4,
                   0x20, 0x68, 0x87, 0xd9, 0x8f, 0xb2, 0x26, 0x17, 0x24, 0x31, 0xef, 0x40,
                   0xb1, 0x7e, 0x42, 0x4f, 0x7d, 0x33, 0x56, 0x22, 0xb0, 0x1,  0xff};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0xdc, 0xaa, 0xed, 0x8e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6c, 0x4,  0x20, 0x68, 0x87, 0xd9, 0x8f, 0xb2, 0x26, 0x17, 0x24, 0x31, 0xef,
                         0x40, 0xb1, 0x7e, 0x42, 0x4f, 0x7d, 0x33, 0x56, 0x22, 0xb0, 0x1,  0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6499, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\245Y\170\235\232x1\238Y\148",
// _pubPktID = 0, _pubBody = "\139\217\168\150q\SYN\144\176\SO\NAK\147\237", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x38, 0x18, 0x0,  0xa,  0xf5, 0x59, 0xaa, 0xeb, 0xe8, 0x78, 0x31, 0xee, 0x59,
                   0x94, 0x8b, 0xd9, 0xa8, 0x96, 0x71, 0x16, 0x90, 0xb0, 0xe,  0x15, 0x93, 0xed};

  uint8_t buf[36] = {0};

  uint8_t topic_bytes[] = {0xf5, 0x59, 0xaa, 0xeb, 0xe8, 0x78, 0x31, 0xee, 0x59, 0x94};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0xd9, 0xa8, 0x96, 0x71, 0x16, 0x90, 0xb0, 0xe, 0x15, 0x93, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\DC4\225[\128A\SUB\229p\254\164'\187\153F\223\219\&3\FS\US~\247\227\SYN(B\177\172", _pubPktID = 927, _pubBody =
// "b\DELS\153v\176m?\201\248\140\EOTe\174\196\EM\253\FS", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x34, 0x31, 0x0,  0x1b, 0x14, 0xe1, 0x5b, 0x80, 0x41, 0x1a, 0xe5, 0x70, 0xfe,
                   0xa4, 0x27, 0xbb, 0x99, 0x46, 0xdf, 0xdb, 0x33, 0x1c, 0x1f, 0x7e, 0xf7, 0xe3,
                   0x16, 0x28, 0x42, 0xb1, 0xac, 0x3,  0x9f, 0x62, 0x7f, 0x53, 0x99, 0x76, 0xb0,
                   0x6d, 0x3f, 0xc9, 0xf8, 0x8c, 0x4,  0x65, 0xae, 0xc4, 0x19, 0xfd, 0x1c};

  uint8_t buf[61] = {0};

  uint8_t topic_bytes[] = {0x14, 0xe1, 0x5b, 0x80, 0x41, 0x1a, 0xe5, 0x70, 0xfe, 0xa4, 0x27, 0xbb, 0x99, 0x46,
                           0xdf, 0xdb, 0x33, 0x1c, 0x1f, 0x7e, 0xf7, 0xe3, 0x16, 0x28, 0x42, 0xb1, 0xac};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x62, 0x7f, 0x53, 0x99, 0x76, 0xb0, 0x6d, 0x3f, 0xc9,
                         0xf8, 0x8c, 0x4,  0x65, 0xae, 0xc4, 0x19, 0xfd, 0x1c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 927, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\132\158\245\v\236\159\129\175\159j(", _pubPktID = 19519, _pubBody =
// "\222Ut\223\169\215\ACK\238\228\137\147Z\EM\196", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x33, 0x1d, 0x0,  0xb,  0x84, 0x9e, 0xf5, 0xb, 0xec, 0x9f, 0x81, 0xaf, 0x9f, 0x6a, 0x28, 0x4c,
                   0x3f, 0xde, 0x55, 0x74, 0xdf, 0xa9, 0xd7, 0x6, 0xee, 0xe4, 0x89, 0x93, 0x5a, 0x19, 0xc4};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0x84, 0x9e, 0xf5, 0xb, 0xec, 0x9f, 0x81, 0xaf, 0x9f, 0x6a, 0x28};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xde, 0x55, 0x74, 0xdf, 0xa9, 0xd7, 0x6, 0xee, 0xe4, 0x89, 0x93, 0x5a, 0x19, 0xc4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19519, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "-\187#\178\187\239\RS\172\ETX\144=\172\185\192\232Q\197:A\171^\SUB\135)", _pubPktID = 18146, _pubBody = "\228\167",
// _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x32, 0x1e, 0x0,  0x18, 0x2d, 0xbb, 0x23, 0xb2, 0xbb, 0xef, 0x1e, 0xac, 0x3,  0x90, 0x3d, 0xac,
                   0xb9, 0xc0, 0xe8, 0x51, 0xc5, 0x3a, 0x41, 0xab, 0x5e, 0x1a, 0x87, 0x29, 0x46, 0xe2, 0xe4, 0xa7};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x2d, 0xbb, 0x23, 0xb2, 0xbb, 0xef, 0x1e, 0xac, 0x3,  0x90, 0x3d, 0xac,
                           0xb9, 0xc0, 0xe8, 0x51, 0xc5, 0x3a, 0x41, 0xab, 0x5e, 0x1a, 0x87, 0x29};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe4, 0xa7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 18146, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "]\210f\CAN\144\189+\ETB\v~\235)\166\227\158\211\&9\SOHj\191\242\212T<", _pubPktID = 16544, _pubBody =
// "\210XDU\144\201\&4 \226VBDBmf\138\212\f\195\232", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x3a, 0x30, 0x0,  0x18, 0x5d, 0xd2, 0x66, 0x18, 0x90, 0xbd, 0x2b, 0x17, 0xb,  0x7e, 0xeb, 0x29, 0xa6,
                   0xe3, 0x9e, 0xd3, 0x39, 0x1,  0x6a, 0xbf, 0xf2, 0xd4, 0x54, 0x3c, 0x40, 0xa0, 0xd2, 0x58, 0x44, 0x55,
                   0x90, 0xc9, 0x34, 0x20, 0xe2, 0x56, 0x42, 0x44, 0x42, 0x6d, 0x66, 0x8a, 0xd4, 0xc,  0xc3, 0xe8};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x5d, 0xd2, 0x66, 0x18, 0x90, 0xbd, 0x2b, 0x17, 0xb,  0x7e, 0xeb, 0x29,
                           0xa6, 0xe3, 0x9e, 0xd3, 0x39, 0x1,  0x6a, 0xbf, 0xf2, 0xd4, 0x54, 0x3c};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd2, 0x58, 0x44, 0x55, 0x90, 0xc9, 0x34, 0x20, 0xe2, 0x56,
                         0x42, 0x44, 0x42, 0x6d, 0x66, 0x8a, 0xd4, 0xc,  0xc3, 0xe8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16544, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "/\151\180C\211\173\172u ", _pubPktID
// = 29329, _pubBody = "J\158~x\US\145@z/7C\157R\221Qm", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x35, 0x1d, 0x0,  0x9,  0x2f, 0x97, 0xb4, 0x43, 0xd3, 0xad, 0xac, 0x75, 0x20, 0x72, 0x91, 0x4a,
                   0x9e, 0x7e, 0x78, 0x1f, 0x91, 0x40, 0x7a, 0x2f, 0x37, 0x43, 0x9d, 0x52, 0xdd, 0x51, 0x6d};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0x2f, 0x97, 0xb4, 0x43, 0xd3, 0xad, 0xac, 0x75, 0x20};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x9e, 0x7e, 0x78, 0x1f, 0x91, 0x40, 0x7a,
                         0x2f, 0x37, 0x43, 0x9d, 0x52, 0xdd, 0x51, 0x6d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29329, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "p\197\135\ETX\191\&8\221\RS\229\240\245$_2y\225iz\SYNx", _pubPktID = 12423, _pubBody =
// "\253\147\173\147\169r\130\DLE'\SUB\a\242\DC3/r\237[\213\209\140I\133\196EB\194", _pubProps = []}
TEST(Publish311QCTest, Encode31) {
  uint8_t pkt[] = {0x3c, 0x32, 0x0,  0x14, 0x70, 0xc5, 0x87, 0x3,  0xbf, 0x38, 0xdd, 0x1e, 0xe5,
                   0xf0, 0xf5, 0x24, 0x5f, 0x32, 0x79, 0xe1, 0x69, 0x7a, 0x16, 0x78, 0x30, 0x87,
                   0xfd, 0x93, 0xad, 0x93, 0xa9, 0x72, 0x82, 0x10, 0x27, 0x1a, 0x7,  0xf2, 0x13,
                   0x2f, 0x72, 0xed, 0x5b, 0xd5, 0xd1, 0x8c, 0x49, 0x85, 0xc4, 0x45, 0x42, 0xc2};

  uint8_t buf[62] = {0};

  uint8_t topic_bytes[] = {0x70, 0xc5, 0x87, 0x3,  0xbf, 0x38, 0xdd, 0x1e, 0xe5, 0xf0,
                           0xf5, 0x24, 0x5f, 0x32, 0x79, 0xe1, 0x69, 0x7a, 0x16, 0x78};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfd, 0x93, 0xad, 0x93, 0xa9, 0x72, 0x82, 0x10, 0x27, 0x1a, 0x7,  0xf2, 0x13,
                         0x2f, 0x72, 0xed, 0x5b, 0xd5, 0xd1, 0x8c, 0x49, 0x85, 0xc4, 0x45, 0x42, 0xc2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 12423, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W(p\EOT\215,C\167\EOTJ\137\247C\\\183.\131\171\DELD$\195*\211\ETB\181", _pubPktID = 21051, _pubBody =
// "\131\218+\DC3Y.\244=\217J\173h\245\248\238\&8yD\219u\241", _pubProps = []}
TEST(Publish311QCTest, Encode32) {
  uint8_t pkt[] = {0x3a, 0x33, 0x0,  0x1a, 0x57, 0x28, 0x70, 0x4,  0xd7, 0x2c, 0x43, 0xa7, 0x4,  0x4a,
                   0x89, 0xf7, 0x43, 0x5c, 0xb7, 0x2e, 0x83, 0xab, 0x7f, 0x44, 0x24, 0xc3, 0x2a, 0xd3,
                   0x17, 0xb5, 0x52, 0x3b, 0x83, 0xda, 0x2b, 0x13, 0x59, 0x2e, 0xf4, 0x3d, 0xd9, 0x4a,
                   0xad, 0x68, 0xf5, 0xf8, 0xee, 0x38, 0x79, 0x44, 0xdb, 0x75, 0xf1};

  uint8_t buf[63] = {0};

  uint8_t topic_bytes[] = {0x57, 0x28, 0x70, 0x4,  0xd7, 0x2c, 0x43, 0xa7, 0x4,  0x4a, 0x89, 0xf7, 0x43,
                           0x5c, 0xb7, 0x2e, 0x83, 0xab, 0x7f, 0x44, 0x24, 0xc3, 0x2a, 0xd3, 0x17, 0xb5};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x83, 0xda, 0x2b, 0x13, 0x59, 0x2e, 0xf4, 0x3d, 0xd9, 0x4a, 0xad,
                         0x68, 0xf5, 0xf8, 0xee, 0x38, 0x79, 0x44, 0xdb, 0x75, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 21051, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\231\ACK\254\SIp\166\135\GS[\235\245\182#\181\186\172xu\EOT", _pubPktID = 0, _pubBody =
// "\170\DC1*\DC3\196\248-\191\212\142:", _pubProps = []}
TEST(Publish311QCTest, Encode33) {
  uint8_t pkt[] = {0x38, 0x20, 0x0,  0x13, 0xe7, 0x6, 0xfe, 0xf,  0x70, 0xa6, 0x87, 0x1d, 0x5b, 0xeb, 0xf5, 0xb6, 0x23,
                   0xb5, 0xba, 0xac, 0x78, 0x75, 0x4, 0xaa, 0x11, 0x2a, 0x13, 0xc4, 0xf8, 0x2d, 0xbf, 0xd4, 0x8e, 0x3a};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0xe7, 0x6,  0xfe, 0xf,  0x70, 0xa6, 0x87, 0x1d, 0x5b, 0xeb,
                           0xf5, 0xb6, 0x23, 0xb5, 0xba, 0xac, 0x78, 0x75, 0x4};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xaa, 0x11, 0x2a, 0x13, 0xc4, 0xf8, 0x2d, 0xbf, 0xd4, 0x8e, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESCe\222q\DC1?.N\128}{W\237:\250\ETB\SI\252(g\SIX\130\171\252\158", _pubPktID = 0, _pubBody = "\180v", _pubProps =
// []}
TEST(Publish311QCTest, Encode34) {
  uint8_t pkt[] = {0x31, 0x1e, 0x0,  0x1a, 0x1b, 0x65, 0xde, 0x71, 0x11, 0x3f, 0x2e, 0x4e, 0x80, 0x7d, 0x7b, 0x57,
                   0xed, 0x3a, 0xfa, 0x17, 0xf,  0xfc, 0x28, 0x67, 0xf,  0x58, 0x82, 0xab, 0xfc, 0x9e, 0xb4, 0x76};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x1b, 0x65, 0xde, 0x71, 0x11, 0x3f, 0x2e, 0x4e, 0x80, 0x7d, 0x7b, 0x57, 0xed,
                           0x3a, 0xfa, 0x17, 0xf,  0xfc, 0x28, 0x67, 0xf,  0x58, 0x82, 0xab, 0xfc, 0x9e};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb4, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "6\228\247(\SUB\248\195J\179",
// _pubPktID = 16923, _pubBody = "\178", _pubProps = []}
TEST(Publish311QCTest, Encode35) {
  uint8_t pkt[] = {0x32, 0xe, 0x0, 0x9, 0x36, 0xe4, 0xf7, 0x28, 0x1a, 0xf8, 0xc3, 0x4a, 0xb3, 0x42, 0x1b, 0xb2};

  uint8_t buf[26] = {0};

  uint8_t topic_bytes[] = {0x36, 0xe4, 0xf7, 0x28, 0x1a, 0xf8, 0xc3, 0x4a, 0xb3};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16923, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "B\244\185\173\135\222\r/\201&\STX\197e\196Y\v\221\191\152\GS6r\131\172\188\196", _pubPktID = 7267, _pubBody =
// "ch\183\156\195l\159\210\242\FS\216/\DC4\233", _pubProps = []}
TEST(Publish311QCTest, Encode36) {
  uint8_t pkt[] = {0x3a, 0x2c, 0x0,  0x1a, 0x42, 0xf4, 0xb9, 0xad, 0x87, 0xde, 0xd,  0x2f, 0xc9, 0x26, 0x2,  0xc5,
                   0x65, 0xc4, 0x59, 0xb,  0xdd, 0xbf, 0x98, 0x1d, 0x36, 0x72, 0x83, 0xac, 0xbc, 0xc4, 0x1c, 0x63,
                   0x63, 0x68, 0xb7, 0x9c, 0xc3, 0x6c, 0x9f, 0xd2, 0xf2, 0x1c, 0xd8, 0x2f, 0x14, 0xe9};

  uint8_t buf[56] = {0};

  uint8_t topic_bytes[] = {0x42, 0xf4, 0xb9, 0xad, 0x87, 0xde, 0xd,  0x2f, 0xc9, 0x26, 0x2,  0xc5, 0x65,
                           0xc4, 0x59, 0xb,  0xdd, 0xbf, 0x98, 0x1d, 0x36, 0x72, 0x83, 0xac, 0xbc, 0xc4};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x68, 0xb7, 0x9c, 0xc3, 0x6c, 0x9f, 0xd2, 0xf2, 0x1c, 0xd8, 0x2f, 0x14, 0xe9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7267, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\174N\162+\219#\236%2\208\&5p\160Z\132\133%\ENQ\220", _pubPktID = 16245, _pubBody = "\208\219\197i\234Y\159",
// _pubProps = []}
TEST(Publish311QCTest, Encode37) {
  uint8_t pkt[] = {0x3a, 0x1e, 0x0,  0x13, 0xae, 0x4e, 0xa2, 0x2b, 0xdb, 0x23, 0xec, 0x25, 0x32, 0xd0, 0x35, 0x70,
                   0xa0, 0x5a, 0x84, 0x85, 0x25, 0x5,  0xdc, 0x3f, 0x75, 0xd0, 0xdb, 0xc5, 0x69, 0xea, 0x59, 0x9f};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0xae, 0x4e, 0xa2, 0x2b, 0xdb, 0x23, 0xec, 0x25, 0x32, 0xd0,
                           0x35, 0x70, 0xa0, 0x5a, 0x84, 0x85, 0x25, 0x5,  0xdc};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd0, 0xdb, 0xc5, 0x69, 0xea, 0x59, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16245, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "(3\136}\227\211\FS\ETB&\222\219I\US\220}\129\253\151", _pubPktID = 28557, _pubBody = "\187|", _pubProps = []}
TEST(Publish311QCTest, Encode38) {
  uint8_t pkt[] = {0x3d, 0x18, 0x0,  0x12, 0x28, 0x33, 0x88, 0x7d, 0xe3, 0xd3, 0x1c, 0x17, 0x26,
                   0xde, 0xdb, 0x49, 0x1f, 0xdc, 0x7d, 0x81, 0xfd, 0x97, 0x6f, 0x8d, 0xbb, 0x7c};

  uint8_t buf[36] = {0};

  uint8_t topic_bytes[] = {0x28, 0x33, 0x88, 0x7d, 0xe3, 0xd3, 0x1c, 0x17, 0x26,
                           0xde, 0xdb, 0x49, 0x1f, 0xdc, 0x7d, 0x81, 0xfd, 0x97};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0x7c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 28557, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\215\235\&1\174\249\STX",
// _pubPktID = 17754, _pubBody = "\246?w\EM\240\218\fF", _pubProps = []}
TEST(Publish311QCTest, Encode39) {
  uint8_t pkt[] = {0x32, 0x13, 0x0,  0x7,  0x15, 0xd7, 0xeb, 0x31, 0xae, 0xf9, 0x2,
                   0x45, 0x5a, 0xf6, 0x3f, 0x77, 0x19, 0xf0, 0xda, 0xc,  0x46};

  uint8_t buf[31] = {0};

  uint8_t topic_bytes[] = {0x15, 0xd7, 0xeb, 0x31, 0xae, 0xf9, 0x2};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf6, 0x3f, 0x77, 0x19, 0xf0, 0xda, 0xc, 0x46};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17754, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Q\188\GS\173\231\131\DC4\r\151\251\145\171\&2b\222\209\NUL\250\&4,KR", _pubPktID = 27100, _pubBody =
// "T\DC2\SO\244\150V\ENQ\RS\244\135\238\SIU#[M=#h\232\206U", _pubProps = []}
TEST(Publish311QCTest, Encode40) {
  uint8_t pkt[] = {0x35, 0x30, 0x0,  0x16, 0x51, 0xbc, 0x1d, 0xad, 0xe7, 0x83, 0x14, 0xd,  0x97, 0xfb, 0x91, 0xab, 0x32,
                   0x62, 0xde, 0xd1, 0x0,  0xfa, 0x34, 0x2c, 0x4b, 0x52, 0x69, 0xdc, 0x54, 0x12, 0xe,  0xf4, 0x96, 0x56,
                   0x5,  0x1e, 0xf4, 0x87, 0xee, 0xf,  0x55, 0x23, 0x5b, 0x4d, 0x3d, 0x23, 0x68, 0xe8, 0xce, 0x55};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x51, 0xbc, 0x1d, 0xad, 0xe7, 0x83, 0x14, 0xd,  0x97, 0xfb, 0x91,
                           0xab, 0x32, 0x62, 0xde, 0xd1, 0x0,  0xfa, 0x34, 0x2c, 0x4b, 0x52};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x54, 0x12, 0xe,  0xf4, 0x96, 0x56, 0x5,  0x1e, 0xf4, 0x87, 0xee,
                         0xf,  0x55, 0x23, 0x5b, 0x4d, 0x3d, 0x23, 0x68, 0xe8, 0xce, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 27100, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\t\199\ESC[\fQ\131\177s\220X\DC1^\151s\198\213/`\162\175,\216o\160h[\ESC", _pubPktID = 0, _pubBody = "\132",
// _pubProps = []}
TEST(Publish311QCTest, Encode41) {
  uint8_t pkt[] = {0x30, 0x20, 0x0,  0x1d, 0xa5, 0x9,  0xc7, 0x1b, 0x5b, 0xc,  0x51, 0x83,
                   0xb1, 0x73, 0xdc, 0x58, 0x11, 0x5e, 0x97, 0x73, 0xc6, 0xd5, 0x2f, 0x60,
                   0xa2, 0xaf, 0x2c, 0xd8, 0x6f, 0xa0, 0x68, 0x5b, 0x1b, 0x84};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0xa5, 0x9,  0xc7, 0x1b, 0x5b, 0xc,  0x51, 0x83, 0xb1, 0x73, 0xdc, 0x58, 0x11, 0x5e, 0x97,
                           0x73, 0xc6, 0xd5, 0x2f, 0x60, 0xa2, 0xaf, 0x2c, 0xd8, 0x6f, 0xa0, 0x68, 0x5b, 0x1b};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x84};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\EM\170\165z\183C\231I\198\165a2BX\n\249\&6\157", _pubPktID = 0, _pubBody =
// "\187S\143\219\221B]\180\133k\247\STX6\v'S\152\t\STX\140J \v\173\&1", _pubProps = []}
TEST(Publish311QCTest, Encode42) {
  uint8_t pkt[] = {0x30, 0x2d, 0x0,  0x12, 0x19, 0xaa, 0xa5, 0x7a, 0xb7, 0x43, 0xe7, 0x49, 0xc6, 0xa5, 0x61, 0x32,
                   0x42, 0x58, 0xa,  0xf9, 0x36, 0x9d, 0xbb, 0x53, 0x8f, 0xdb, 0xdd, 0x42, 0x5d, 0xb4, 0x85, 0x6b,
                   0xf7, 0x2,  0x36, 0xb,  0x27, 0x53, 0x98, 0x9,  0x2,  0x8c, 0x4a, 0x20, 0xb,  0xad, 0x31};

  uint8_t buf[57] = {0};

  uint8_t topic_bytes[] = {0x19, 0xaa, 0xa5, 0x7a, 0xb7, 0x43, 0xe7, 0x49, 0xc6,
                           0xa5, 0x61, 0x32, 0x42, 0x58, 0xa,  0xf9, 0x36, 0x9d};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbb, 0x53, 0x8f, 0xdb, 0xdd, 0x42, 0x5d, 0xb4, 0x85, 0x6b, 0xf7, 0x2, 0x36,
                         0xb,  0x27, 0x53, 0x98, 0x9,  0x2,  0x8c, 0x4a, 0x20, 0xb,  0xad, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\DC3puWV\211\161\DC3\DC2\158\213rb\196~o", _pubProps = []}
TEST(Publish311QCTest, Encode43) {
  uint8_t pkt[] = {0x31, 0x12, 0x0,  0x0,  0x13, 0x70, 0x75, 0x57, 0x56, 0xd3,
                   0xa1, 0x13, 0x12, 0x9e, 0xd5, 0x72, 0x62, 0xc4, 0x7e, 0x6f};

  uint8_t buf[30] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x13, 0x70, 0x75, 0x57, 0x56, 0xd3, 0xa1, 0x13,
                         0x12, 0x9e, 0xd5, 0x72, 0x62, 0xc4, 0x7e, 0x6f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\183\171\EM\217\146\128\EOT",
// _pubPktID = 4653, _pubBody = "n\237\EMMW\138\234\154\191\141\158", _pubProps = []}
TEST(Publish311QCTest, Encode44) {
  uint8_t pkt[] = {0x3d, 0x16, 0x0,  0x7,  0xb7, 0xab, 0x19, 0xd9, 0x92, 0x80, 0x4,  0x12,
                   0x2d, 0x6e, 0xed, 0x19, 0x4d, 0x57, 0x8a, 0xea, 0x9a, 0xbf, 0x8d, 0x9e};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0xb7, 0xab, 0x19, 0xd9, 0x92, 0x80, 0x4};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0xed, 0x19, 0x4d, 0x57, 0x8a, 0xea, 0x9a, 0xbf, 0x8d, 0x9e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 4653, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC4\238q\ACK\ESC\142Z\GS\147\186\v?\208O", _pubPktID = 0, _pubBody = "Q4\149", _pubProps = []}
TEST(Publish311QCTest, Encode45) {
  uint8_t pkt[] = {0x30, 0x13, 0x0,  0xe, 0x14, 0xee, 0x71, 0x6,  0x1b, 0x8e, 0x5a,
                   0x1d, 0x93, 0xba, 0xb, 0x3f, 0xd0, 0x4f, 0x51, 0x34, 0x95};

  uint8_t buf[31] = {0};

  uint8_t topic_bytes[] = {0x14, 0xee, 0x71, 0x6, 0x1b, 0x8e, 0x5a, 0x1d, 0x93, 0xba, 0xb, 0x3f, 0xd0, 0x4f};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x51, 0x34, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\180=\US\SYN\229\232", _pubPktID =
// 28144, _pubBody = "\SYN\238,\186\225\221v\229\138\172", _pubProps = []}
TEST(Publish311QCTest, Encode46) {
  uint8_t pkt[] = {0x35, 0x14, 0x0,  0x6,  0xb4, 0x3d, 0x1f, 0x16, 0xe5, 0xe8, 0x6d,
                   0xf0, 0x16, 0xee, 0x2c, 0xba, 0xe1, 0xdd, 0x76, 0xe5, 0x8a, 0xac};

  uint8_t buf[32] = {0};

  uint8_t topic_bytes[] = {0xb4, 0x3d, 0x1f, 0x16, 0xe5, 0xe8};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x16, 0xee, 0x2c, 0xba, 0xe1, 0xdd, 0x76, 0xe5, 0x8a, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 28144, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\186\182n\166", _pubPktID = 0,
// _pubBody = "\234+5&F\SYN\140C!\209\ACK\141C\138\180\SOH", _pubProps = []}
TEST(Publish311QCTest, Encode47) {
  uint8_t pkt[] = {0x39, 0x16, 0x0,  0x4,  0xba, 0xb6, 0x6e, 0xa6, 0xea, 0x2b, 0x35, 0x26,
                   0x46, 0x16, 0x8c, 0x43, 0x21, 0xd1, 0x6,  0x8d, 0x43, 0x8a, 0xb4, 0x1};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0xba, 0xb6, 0x6e, 0xa6};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xea, 0x2b, 0x35, 0x26, 0x46, 0x16, 0x8c, 0x43, 0x21, 0xd1, 0x6, 0x8d, 0x43, 0x8a, 0xb4, 0x1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "3", _pubPktID = 0, _pubBody =
// "\DLE5\164cC\229MU\SYN0\131\230UV\187\196 1\210[2\232", _pubProps = []}
TEST(Publish311QCTest, Encode48) {
  uint8_t pkt[] = {0x38, 0x19, 0x0,  0x1,  0x33, 0x10, 0x35, 0xa4, 0x63, 0x43, 0xe5, 0x4d, 0x55, 0x16,
                   0x30, 0x83, 0xe6, 0x55, 0x56, 0xbb, 0xc4, 0x20, 0x31, 0xd2, 0x5b, 0x32, 0xe8};

  uint8_t buf[37] = {0};

  uint8_t topic_bytes[] = {0x33};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x10, 0x35, 0xa4, 0x63, 0x43, 0xe5, 0x4d, 0x55, 0x16, 0x30, 0x83,
                         0xe6, 0x55, 0x56, 0xbb, 0xc4, 0x20, 0x31, 0xd2, 0x5b, 0x32, 0xe8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\SUB\NUL\215\&1\153\202&79\r",
// _pubPktID = 0, _pubBody = "c\217\202\193\156\199\202\222\SO\143\145\202\135\136\239\147Z\197\245\196\133\249\191A",
// _pubProps = []}
TEST(Publish311QCTest, Encode49) {
  uint8_t pkt[] = {0x31, 0x25, 0x0,  0xb,  0x93, 0x1a, 0x0,  0xd7, 0x31, 0x99, 0xca, 0x26, 0x37,
                   0x39, 0xd,  0x63, 0xd9, 0xca, 0xc1, 0x9c, 0xc7, 0xca, 0xde, 0xe,  0x8f, 0x91,
                   0xca, 0x87, 0x88, 0xef, 0x93, 0x5a, 0xc5, 0xf5, 0xc4, 0x85, 0xf9, 0xbf, 0x41};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0x93, 0x1a, 0x0, 0xd7, 0x31, 0x99, 0xca, 0x26, 0x37, 0x39, 0xd};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x63, 0xd9, 0xca, 0xc1, 0x9c, 0xc7, 0xca, 0xde, 0xe,  0x8f, 0x91, 0xca,
                         0x87, 0x88, 0xef, 0x93, 0x5a, 0xc5, 0xf5, 0xc4, 0x85, 0xf9, 0xbf, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\199\220\252\SI\147K\173", _pubPktID
// = 22359, _pubBody = "\179\135\192#+E7,\SO&0\CAN\239\145\190\193\159\161\ETX\v\205~yy\158v\209Tt\143", _pubProps = []}
TEST(Publish311QCTest, Encode50) {
  uint8_t pkt[] = {0x35, 0x29, 0x0,  0x7,  0xc7, 0xdc, 0xfc, 0xf,  0x93, 0x4b, 0xad, 0x57, 0x57, 0xb3, 0x87,
                   0xc0, 0x23, 0x2b, 0x45, 0x37, 0x2c, 0xe,  0x26, 0x30, 0x18, 0xef, 0x91, 0xbe, 0xc1, 0x9f,
                   0xa1, 0x3,  0xb,  0xcd, 0x7e, 0x79, 0x79, 0x9e, 0x76, 0xd1, 0x54, 0x74, 0x8f};

  uint8_t buf[53] = {0};

  uint8_t topic_bytes[] = {0xc7, 0xdc, 0xfc, 0xf, 0x93, 0x4b, 0xad};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb3, 0x87, 0xc0, 0x23, 0x2b, 0x45, 0x37, 0x2c, 0xe,  0x26, 0x30, 0x18, 0xef, 0x91, 0xbe,
                         0xc1, 0x9f, 0xa1, 0x3,  0xb,  0xcd, 0x7e, 0x79, 0x79, 0x9e, 0x76, 0xd1, 0x54, 0x74, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 22359, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225Uc\EM\147>\149\248\SI9\ENQs\211]\179", _pubPktID = 25366, _pubBody = "\165c\155\220\241\175\249\EM\220Bi\224\t",
// _pubProps = []}
TEST(Publish311QCTest, Encode51) {
  uint8_t pkt[] = {0x32, 0x20, 0x0,  0xf,  0xe1, 0x55, 0x63, 0x19, 0x93, 0x3e, 0x95, 0xf8, 0xf,  0x39, 0x5,  0x73, 0xd3,
                   0x5d, 0xb3, 0x63, 0x16, 0xa5, 0x63, 0x9b, 0xdc, 0xf1, 0xaf, 0xf9, 0x19, 0xdc, 0x42, 0x69, 0xe0, 0x9};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0xe1, 0x55, 0x63, 0x19, 0x93, 0x3e, 0x95, 0xf8, 0xf, 0x39, 0x5, 0x73, 0xd3, 0x5d, 0xb3};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x63, 0x9b, 0xdc, 0xf1, 0xaf, 0xf9, 0x19, 0xdc, 0x42, 0x69, 0xe0, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25366, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "sS\f@K\\`9t", _pubPktID = 0,
// _pubBody = "9?\202\215M\ENQvqz\243\164Lg", _pubProps = []}
TEST(Publish311QCTest, Encode52) {
  uint8_t pkt[] = {0x30, 0x18, 0x0,  0x9,  0x73, 0x53, 0xc,  0x40, 0x4b, 0x5c, 0x60, 0x39, 0x74,
                   0x39, 0x3f, 0xca, 0xd7, 0x4d, 0x5,  0x76, 0x71, 0x7a, 0xf3, 0xa4, 0x4c, 0x67};

  uint8_t buf[36] = {0};

  uint8_t topic_bytes[] = {0x73, 0x53, 0xc, 0x40, 0x4b, 0x5c, 0x60, 0x39, 0x74};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x39, 0x3f, 0xca, 0xd7, 0x4d, 0x5, 0x76, 0x71, 0x7a, 0xf3, 0xa4, 0x4c, 0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\220", _pubPktID = 0, _pubBody =
// "m>\243z\246\250\139\171?\208F\f\240\232\EOTT`\241\212\SOH\182\b\SI@\228A", _pubProps = []}
TEST(Publish311QCTest, Encode53) {
  uint8_t pkt[] = {0x38, 0x1d, 0x0,  0x1, 0xdc, 0x6d, 0x3e, 0xf3, 0x7a, 0xf6, 0xfa, 0x8b, 0xab, 0x3f, 0xd0, 0x46,
                   0xc,  0xf0, 0xe8, 0x4, 0x54, 0x60, 0xf1, 0xd4, 0x1,  0xb6, 0x8,  0xf,  0x40, 0xe4, 0x41};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0xdc};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6d, 0x3e, 0xf3, 0x7a, 0xf6, 0xfa, 0x8b, 0xab, 0x3f, 0xd0, 0x46, 0xc,  0xf0,
                         0xe8, 0x4,  0x54, 0x60, 0xf1, 0xd4, 0x1,  0xb6, 0x8,  0xf,  0x40, 0xe4, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\f\143\204y\245\248\131\153\248\250\nj\156\173\166\174\GSIv\154\166w\r\136Y", _pubPktID = 0, _pubBody =
// "\177\216D\168\tF\242kx1\247\n", _pubProps = []}
TEST(Publish311QCTest, Encode54) {
  uint8_t pkt[] = {0x31, 0x27, 0x0,  0x19, 0xc,  0x8f, 0xcc, 0x79, 0xf5, 0xf8, 0x83, 0x99, 0xf8, 0xfa,
                   0xa,  0x6a, 0x9c, 0xad, 0xa6, 0xae, 0x1d, 0x49, 0x76, 0x9a, 0xa6, 0x77, 0xd,  0x88,
                   0x59, 0xb1, 0xd8, 0x44, 0xa8, 0x9,  0x46, 0xf2, 0x6b, 0x78, 0x31, 0xf7, 0xa};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0xc,  0x8f, 0xcc, 0x79, 0xf5, 0xf8, 0x83, 0x99, 0xf8, 0xfa, 0xa,  0x6a, 0x9c,
                           0xad, 0xa6, 0xae, 0x1d, 0x49, 0x76, 0x9a, 0xa6, 0x77, 0xd,  0x88, 0x59};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb1, 0xd8, 0x44, 0xa8, 0x9, 0x46, 0xf2, 0x6b, 0x78, 0x31, 0xf7, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "x\141i\235F", _pubPktID = 15511,
// _pubBody = "\174]0.\196?\198\195\202m`\179\253E\v|\204\214P\f\229\NAK\154\130", _pubProps = []}
TEST(Publish311QCTest, Encode55) {
  uint8_t pkt[] = {0x32, 0x21, 0x0,  0x5,  0x78, 0x8d, 0x69, 0xeb, 0x46, 0x3c, 0x97, 0xae,
                   0x5d, 0x30, 0x2e, 0xc4, 0x3f, 0xc6, 0xc3, 0xca, 0x6d, 0x60, 0xb3, 0xfd,
                   0x45, 0xb,  0x7c, 0xcc, 0xd6, 0x50, 0xc,  0xe5, 0x15, 0x9a, 0x82};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0x78, 0x8d, 0x69, 0xeb, 0x46};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xae, 0x5d, 0x30, 0x2e, 0xc4, 0x3f, 0xc6, 0xc3, 0xca, 0x6d, 0x60, 0xb3,
                         0xfd, 0x45, 0xb,  0x7c, 0xcc, 0xd6, 0x50, 0xc,  0xe5, 0x15, 0x9a, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 15511, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\207", _pubPktID = 12437, _pubBody =
// "\209\NAKT\231?\229R\176}\ESC\195\172\146\168\148\188;\237\205\216\134\&4\132\&5w", _pubProps = []}
TEST(Publish311QCTest, Encode56) {
  uint8_t pkt[] = {0x3a, 0x1e, 0x0,  0x1,  0xcf, 0x30, 0x95, 0xd1, 0x15, 0x54, 0xe7, 0x3f, 0xe5, 0x52, 0xb0, 0x7d,
                   0x1b, 0xc3, 0xac, 0x92, 0xa8, 0x94, 0xbc, 0x3b, 0xed, 0xcd, 0xd8, 0x86, 0x34, 0x84, 0x35, 0x77};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0xcf};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd1, 0x15, 0x54, 0xe7, 0x3f, 0xe5, 0x52, 0xb0, 0x7d, 0x1b, 0xc3, 0xac, 0x92,
                         0xa8, 0x94, 0xbc, 0x3b, 0xed, 0xcd, 0xd8, 0x86, 0x34, 0x84, 0x35, 0x77};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 12437, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\151\157\DC2\191\177A0d\141\181",
// _pubPktID = 0, _pubBody = "(W\SO\vJ\219Q\170]\to\a3\EOT\245X?\r\255\t&i\EM\213", _pubProps = []}
TEST(Publish311QCTest, Encode57) {
  uint8_t pkt[] = {0x38, 0x24, 0x0,  0xa,  0x97, 0x9d, 0x12, 0xbf, 0xb1, 0x41, 0x30, 0x64, 0x8d,
                   0xb5, 0x28, 0x57, 0xe,  0xb,  0x4a, 0xdb, 0x51, 0xaa, 0x5d, 0x9,  0x6f, 0x7,
                   0x33, 0x4,  0xf5, 0x58, 0x3f, 0xd,  0xff, 0x9,  0x26, 0x69, 0x19, 0xd5};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0x97, 0x9d, 0x12, 0xbf, 0xb1, 0x41, 0x30, 0x64, 0x8d, 0xb5};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x28, 0x57, 0xe,  0xb,  0x4a, 0xdb, 0x51, 0xaa, 0x5d, 0x9,  0x6f, 0x7,
                         0x33, 0x4,  0xf5, 0x58, 0x3f, 0xd,  0xff, 0x9,  0x26, 0x69, 0x19, 0xd5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\133p7\NAK\217\177\185\186:\228-\158\214\255\170", _pubPktID = 5681, _pubBody =
// "\NULT\212\214&\205\222\154\236\130\237_\195\200\186\137\DEL\184\213\&6\192a\241\NUL\231\168\246\180", _pubProps =
// []}
TEST(Publish311QCTest, Encode58) {
  uint8_t pkt[] = {0x3c, 0x30, 0x0,  0x10, 0x17, 0x85, 0x70, 0x37, 0x15, 0xd9, 0xb1, 0xb9, 0xba, 0x3a, 0xe4, 0x2d, 0x9e,
                   0xd6, 0xff, 0xaa, 0x16, 0x31, 0x0,  0x54, 0xd4, 0xd6, 0x26, 0xcd, 0xde, 0x9a, 0xec, 0x82, 0xed, 0x5f,
                   0xc3, 0xc8, 0xba, 0x89, 0x7f, 0xb8, 0xd5, 0x36, 0xc0, 0x61, 0xf1, 0x0,  0xe7, 0xa8, 0xf6, 0xb4};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x17, 0x85, 0x70, 0x37, 0x15, 0xd9, 0xb1, 0xb9,
                           0xba, 0x3a, 0xe4, 0x2d, 0x9e, 0xd6, 0xff, 0xaa};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x0,  0x54, 0xd4, 0xd6, 0x26, 0xcd, 0xde, 0x9a, 0xec, 0x82, 0xed, 0x5f, 0xc3, 0xc8,
                         0xba, 0x89, 0x7f, 0xb8, 0xd5, 0x36, 0xc0, 0x61, 0xf1, 0x0,  0xe7, 0xa8, 0xf6, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5681, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "K#\aZV,bl\168\131\197N", _pubPktID =
// 29545, _pubBody = "q\152\198\DC3v\US", _pubProps = []}
TEST(Publish311QCTest, Encode59) {
  uint8_t pkt[] = {0x3b, 0x16, 0x0,  0xc,  0x4b, 0x23, 0x7,  0x5a, 0x56, 0x2c, 0x62, 0x6c,
                   0xa8, 0x83, 0xc5, 0x4e, 0x73, 0x69, 0x71, 0x98, 0xc6, 0x13, 0x76, 0x1f};

  uint8_t buf[34] = {0};

  uint8_t topic_bytes[] = {0x4b, 0x23, 0x7, 0x5a, 0x56, 0x2c, 0x62, 0x6c, 0xa8, 0x83, 0xc5, 0x4e};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x71, 0x98, 0xc6, 0x13, 0x76, 0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29545, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB./iLG\236\218\159\SOH\n\ESC\203\FSs", _pubPktID = 19215, _pubBody =
// "I\157\182\DEL\135\249\197]P>b\248\202r\201\180\226\179\255", _pubProps = []}
TEST(Publish311QCTest, Encode60) {
  uint8_t pkt[] = {0x34, 0x26, 0x0,  0xf,  0x17, 0x2e, 0x2f, 0x69, 0x4c, 0x47, 0xec, 0xda, 0x9f, 0x1,
                   0xa,  0x1b, 0xcb, 0x1c, 0x73, 0x4b, 0xf,  0x49, 0x9d, 0xb6, 0x7f, 0x87, 0xf9, 0xc5,
                   0x5d, 0x50, 0x3e, 0x62, 0xf8, 0xca, 0x72, 0xc9, 0xb4, 0xe2, 0xb3, 0xff};

  uint8_t buf[50] = {0};

  uint8_t topic_bytes[] = {0x17, 0x2e, 0x2f, 0x69, 0x4c, 0x47, 0xec, 0xda, 0x9f, 0x1, 0xa, 0x1b, 0xcb, 0x1c, 0x73};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x49, 0x9d, 0xb6, 0x7f, 0x87, 0xf9, 0xc5, 0x5d, 0x50, 0x3e,
                         0x62, 0xf8, 0xca, 0x72, 0xc9, 0xb4, 0xe2, 0xb3, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19215, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\ETXv\161\NUL\132\175\165\CAN2\131",
// _pubPktID = 31455, _pubBody = "P\232c#\237\r A\219\192Z\186\241T\196\154", _pubProps = []}
TEST(Publish311QCTest, Encode61) {
  uint8_t pkt[] = {0x35, 0x1e, 0x0,  0xa,  0x3,  0x76, 0xa1, 0x0,  0x84, 0xaf, 0xa5, 0x18, 0x32, 0x83, 0x7a, 0xdf,
                   0x50, 0xe8, 0x63, 0x23, 0xed, 0xd,  0x20, 0x41, 0xdb, 0xc0, 0x5a, 0xba, 0xf1, 0x54, 0xc4, 0x9a};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x3, 0x76, 0xa1, 0x0, 0x84, 0xaf, 0xa5, 0x18, 0x32, 0x83};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xe8, 0x63, 0x23, 0xed, 0xd, 0x20, 0x41, 0xdb, 0xc0, 0x5a, 0xba, 0xf1, 0x54, 0xc4, 0x9a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31455, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "(\193\NAK\240\&3\174\176\CAN:q$\160F7+\162\164\bNCu\128\&3P\131\130\151\239g7", _pubPktID = 31413, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Encode62) {
  uint8_t pkt[] = {0x3d, 0x22, 0x0,  0x1e, 0x28, 0xc1, 0x15, 0xf0, 0x33, 0xae, 0xb0, 0x18,
                   0x3a, 0x71, 0x24, 0xa0, 0x46, 0x37, 0x2b, 0xa2, 0xa4, 0x8,  0x4e, 0x43,
                   0x75, 0x80, 0x33, 0x50, 0x83, 0x82, 0x97, 0xef, 0x67, 0x37, 0x7a, 0xb5};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0x28, 0xc1, 0x15, 0xf0, 0x33, 0xae, 0xb0, 0x18, 0x3a, 0x71, 0x24, 0xa0, 0x46, 0x37, 0x2b,
                           0xa2, 0xa4, 0x8,  0x4e, 0x43, 0x75, 0x80, 0x33, 0x50, 0x83, 0x82, 0x97, 0xef, 0x67, 0x37};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 31413, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "u\197\FS\156\226\226\156\fe7\SUBD\251}\132(:k", _pubPktID = 0, _pubBody =
// "=\RS\224\ENQ\"\187\165\211E\156*\f\133Ox\197\162J\168\131\167I\SUB\190)\240\DEL\EM\216\255", _pubProps = []}
TEST(Publish311QCTest, Encode63) {
  uint8_t pkt[] = {0x30, 0x32, 0x0,  0x12, 0x75, 0xc5, 0x1c, 0x9c, 0xe2, 0xe2, 0x9c, 0xc,  0x65,
                   0x37, 0x1a, 0x44, 0xfb, 0x7d, 0x84, 0x28, 0x3a, 0x6b, 0x3d, 0x1e, 0xe0, 0x5,
                   0x22, 0xbb, 0xa5, 0xd3, 0x45, 0x9c, 0x2a, 0xc,  0x85, 0x4f, 0x78, 0xc5, 0xa2,
                   0x4a, 0xa8, 0x83, 0xa7, 0x49, 0x1a, 0xbe, 0x29, 0xf0, 0x7f, 0x19, 0xd8, 0xff};

  uint8_t buf[62] = {0};

  uint8_t topic_bytes[] = {0x75, 0xc5, 0x1c, 0x9c, 0xe2, 0xe2, 0x9c, 0xc,  0x65,
                           0x37, 0x1a, 0x44, 0xfb, 0x7d, 0x84, 0x28, 0x3a, 0x6b};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3d, 0x1e, 0xe0, 0x5,  0x22, 0xbb, 0xa5, 0xd3, 0x45, 0x9c, 0x2a, 0xc,  0x85, 0x4f, 0x78,
                         0xc5, 0xa2, 0x4a, 0xa8, 0x83, 0xa7, 0x49, 0x1a, 0xbe, 0x29, 0xf0, 0x7f, 0x19, 0xd8, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "s`#B\129\251kP3\n8", _pubPktID =
// 13139, _pubBody = "\SI{\192", _pubProps = []}
TEST(Publish311QCTest, Encode64) {
  uint8_t pkt[] = {0x3c, 0x12, 0x0,  0xb, 0x73, 0x60, 0x23, 0x42, 0x81, 0xfb,
                   0x6b, 0x50, 0x33, 0xa, 0x38, 0x33, 0x53, 0xf,  0x7b, 0xc0};

  uint8_t buf[30] = {0};

  uint8_t topic_bytes[] = {0x73, 0x60, 0x23, 0x42, 0x81, 0xfb, 0x6b, 0x50, 0x33, 0xa, 0x38};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf, 0x7b, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 13139, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163]", _pubPktID = 9229, _pubBody =
// ":,\175v\152}\RS8\178|K\148\f\219\184\129Ep^\n\194\148\SOHv\\\ETB\253^", _pubProps = []}
TEST(Publish311QCTest, Encode65) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x2,  0xa3, 0x5d, 0x24, 0xd,  0x3a, 0x2c, 0xaf, 0x76,
                   0x98, 0x7d, 0x1e, 0x38, 0xb2, 0x7c, 0x4b, 0x94, 0xc,  0xdb, 0xb8, 0x81,
                   0x45, 0x70, 0x5e, 0xa,  0xc2, 0x94, 0x1,  0x76, 0x5c, 0x17, 0xfd, 0x5e};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0xa3, 0x5d};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3a, 0x2c, 0xaf, 0x76, 0x98, 0x7d, 0x1e, 0x38, 0xb2, 0x7c, 0x4b, 0x94, 0xc,  0xdb,
                         0xb8, 0x81, 0x45, 0x70, 0x5e, 0xa,  0xc2, 0x94, 0x1,  0x76, 0x5c, 0x17, 0xfd, 0x5e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 9229, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "'\148R\STX\207v\202o[1\154JIl\129\189\&9.\231\220u\233\200G\f \241\196M:", _pubPktID = 0, _pubBody =
// "\239\141wL\FS\241\255ZW8R\f\CAN\ACKT\215)ZZ\200z\239", _pubProps = []}
TEST(Publish311QCTest, Encode66) {
  uint8_t pkt[] = {0x30, 0x36, 0x0,  0x1e, 0x27, 0x94, 0x52, 0x2,  0xcf, 0x76, 0xca, 0x6f, 0x5b, 0x31,
                   0x9a, 0x4a, 0x49, 0x6c, 0x81, 0xbd, 0x39, 0x2e, 0xe7, 0xdc, 0x75, 0xe9, 0xc8, 0x47,
                   0xc,  0x20, 0xf1, 0xc4, 0x4d, 0x3a, 0xef, 0x8d, 0x77, 0x4c, 0x1c, 0xf1, 0xff, 0x5a,
                   0x57, 0x38, 0x52, 0xc,  0x18, 0x6,  0x54, 0xd7, 0x29, 0x5a, 0x5a, 0xc8, 0x7a, 0xef};

  uint8_t buf[66] = {0};

  uint8_t topic_bytes[] = {0x27, 0x94, 0x52, 0x2,  0xcf, 0x76, 0xca, 0x6f, 0x5b, 0x31, 0x9a, 0x4a, 0x49, 0x6c, 0x81,
                           0xbd, 0x39, 0x2e, 0xe7, 0xdc, 0x75, 0xe9, 0xc8, 0x47, 0xc,  0x20, 0xf1, 0xc4, 0x4d, 0x3a};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xef, 0x8d, 0x77, 0x4c, 0x1c, 0xf1, 0xff, 0x5a, 0x57, 0x38, 0x52,
                         0xc,  0x18, 0x6,  0x54, 0xd7, 0x29, 0x5a, 0x5a, 0xc8, 0x7a, 0xef};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "9\140\202\235A\137*\ESC\202=k\179\211?\NAK\238", _pubPktID = 0, _pubBody =
// "R\140Q\187\192\240\209=*\152Ov\136\254G\251", _pubProps = []}
TEST(Publish311QCTest, Encode67) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x10, 0x39, 0x8c, 0xca, 0xeb, 0x41, 0x89, 0x2a, 0x1b,
                   0xca, 0x3d, 0x6b, 0xb3, 0xd3, 0x3f, 0x15, 0xee, 0x52, 0x8c, 0x51, 0xbb,
                   0xc0, 0xf0, 0xd1, 0x3d, 0x2a, 0x98, 0x4f, 0x76, 0x88, 0xfe, 0x47, 0xfb};

  uint8_t buf[46] = {0};

  uint8_t topic_bytes[] = {0x39, 0x8c, 0xca, 0xeb, 0x41, 0x89, 0x2a, 0x1b,
                           0xca, 0x3d, 0x6b, 0xb3, 0xd3, 0x3f, 0x15, 0xee};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x52, 0x8c, 0x51, 0xbb, 0xc0, 0xf0, 0xd1, 0x3d,
                         0x2a, 0x98, 0x4f, 0x76, 0x88, 0xfe, 0x47, 0xfb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\255\250\242r^\171,{\253\254\200\128\135\225AG\149\&3", _pubPktID = 19170, _pubBody = "\GS", _pubProps = []}
TEST(Publish311QCTest, Encode68) {
  uint8_t pkt[] = {0x35, 0x17, 0x0,  0x12, 0xff, 0xfa, 0xf2, 0x72, 0x5e, 0xab, 0x2c, 0x7b, 0xfd,
                   0xfe, 0xc8, 0x80, 0x87, 0xe1, 0x41, 0x47, 0x95, 0x33, 0x4a, 0xe2, 0x1d};

  uint8_t buf[35] = {0};

  uint8_t topic_bytes[] = {0xff, 0xfa, 0xf2, 0x72, 0x5e, 0xab, 0x2c, 0x7b, 0xfd,
                           0xfe, 0xc8, 0x80, 0x87, 0xe1, 0x41, 0x47, 0x95, 0x33};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19170, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\f<\223\175\243\197\227\253.l\204M\219\195\149\202\132\194\182\a\CAN\n9't=\191\DLEb", _pubPktID = 0, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Encode69) {
  uint8_t pkt[] = {0x31, 0x1f, 0x0,  0x1d, 0xc,  0x3c, 0xdf, 0xaf, 0xf3, 0xc5, 0xe3, 0xfd, 0x2e, 0x6c, 0xcc, 0x4d, 0xdb,
                   0xc3, 0x95, 0xca, 0x84, 0xc2, 0xb6, 0x7,  0x18, 0xa,  0x39, 0x27, 0x74, 0x3d, 0xbf, 0x10, 0x62};

  uint8_t buf[43] = {0};

  uint8_t topic_bytes[] = {0xc,  0x3c, 0xdf, 0xaf, 0xf3, 0xc5, 0xe3, 0xfd, 0x2e, 0x6c, 0xcc, 0x4d, 0xdb, 0xc3, 0x95,
                           0xca, 0x84, 0xc2, 0xb6, 0x7,  0x18, 0xa,  0x39, 0x27, 0x74, 0x3d, 0xbf, 0x10, 0x62};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "3", _pubPktID = 27883, _pubBody =
// "\246\DC1,I\237\135\&0/\210\164\233\223de\144\250\141\134\&7\190\194\144\206f", _pubProps = []}
TEST(Publish311QCTest, Encode70) {
  uint8_t pkt[] = {0x33, 0x1d, 0x0,  0x1,  0x33, 0x6c, 0xeb, 0xf6, 0x11, 0x2c, 0x49, 0xed, 0x87, 0x30, 0x2f, 0xd2,
                   0xa4, 0xe9, 0xdf, 0x64, 0x65, 0x90, 0xfa, 0x8d, 0x86, 0x37, 0xbe, 0xc2, 0x90, 0xce, 0x66};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0x33};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf6, 0x11, 0x2c, 0x49, 0xed, 0x87, 0x30, 0x2f, 0xd2, 0xa4, 0xe9, 0xdf,
                         0x64, 0x65, 0x90, 0xfa, 0x8d, 0x86, 0x37, 0xbe, 0xc2, 0x90, 0xce, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 27883, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\210\n\244+\148\225\234\&5U\226r16\207\137\NAK}\GSX\204\250S\144\151b\224\184", _pubPktID = 20202, _pubBody =
// "\191\207\175uEn7\171\238\203\140\210I\200!", _pubProps = []}
TEST(Publish311QCTest, Encode71) {
  uint8_t pkt[] = {0x3b, 0x2e, 0x0,  0x1b, 0xd2, 0xa,  0xf4, 0x2b, 0x94, 0xe1, 0xea, 0x35, 0x55, 0xe2, 0x72, 0x31,
                   0x36, 0xcf, 0x89, 0x15, 0x7d, 0x1d, 0x58, 0xcc, 0xfa, 0x53, 0x90, 0x97, 0x62, 0xe0, 0xb8, 0x4e,
                   0xea, 0xbf, 0xcf, 0xaf, 0x75, 0x45, 0x6e, 0x37, 0xab, 0xee, 0xcb, 0x8c, 0xd2, 0x49, 0xc8, 0x21};

  uint8_t buf[58] = {0};

  uint8_t topic_bytes[] = {0xd2, 0xa,  0xf4, 0x2b, 0x94, 0xe1, 0xea, 0x35, 0x55, 0xe2, 0x72, 0x31, 0x36, 0xcf,
                           0x89, 0x15, 0x7d, 0x1d, 0x58, 0xcc, 0xfa, 0x53, 0x90, 0x97, 0x62, 0xe0, 0xb8};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbf, 0xcf, 0xaf, 0x75, 0x45, 0x6e, 0x37, 0xab, 0xee, 0xcb, 0x8c, 0xd2, 0x49, 0xc8, 0x21};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 20202, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\240\247\161\170\180S\251(.\139\187\RS\199\\\USs\207!7\250\&8&q\ESC\236\153", _pubPktID = 1829, _pubBody =
// ")B\201\179\163\188%[\184\154\EOT\146x7,\DC3\v\180\DLE", _pubProps = []}
TEST(Publish311QCTest, Encode72) {
  uint8_t pkt[] = {0x3b, 0x31, 0x0,  0x1a, 0xf0, 0xf7, 0xa1, 0xaa, 0xb4, 0x53, 0xfb, 0x28, 0x2e,
                   0x8b, 0xbb, 0x1e, 0xc7, 0x5c, 0x1f, 0x73, 0xcf, 0x21, 0x37, 0xfa, 0x38, 0x26,
                   0x71, 0x1b, 0xec, 0x99, 0x7,  0x25, 0x29, 0x42, 0xc9, 0xb3, 0xa3, 0xbc, 0x25,
                   0x5b, 0xb8, 0x9a, 0x4,  0x92, 0x78, 0x37, 0x2c, 0x13, 0xb,  0xb4, 0x10};

  uint8_t buf[61] = {0};

  uint8_t topic_bytes[] = {0xf0, 0xf7, 0xa1, 0xaa, 0xb4, 0x53, 0xfb, 0x28, 0x2e, 0x8b, 0xbb, 0x1e, 0xc7,
                           0x5c, 0x1f, 0x73, 0xcf, 0x21, 0x37, 0xfa, 0x38, 0x26, 0x71, 0x1b, 0xec, 0x99};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x29, 0x42, 0xc9, 0xb3, 0xa3, 0xbc, 0x25, 0x5b, 0xb8, 0x9a,
                         0x4,  0x92, 0x78, 0x37, 0x2c, 0x13, 0xb,  0xb4, 0x10};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1829, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "2k\146\244f\164\212\DC4o\197\186",
// _pubPktID = 0, _pubBody = "\216C\204\149", _pubProps = []}
TEST(Publish311QCTest, Encode73) {
  uint8_t pkt[] = {0x39, 0x11, 0x0,  0xb,  0x32, 0x6b, 0x92, 0xf4, 0x66, 0xa4,
                   0xd4, 0x14, 0x6f, 0xc5, 0xba, 0xd8, 0x43, 0xcc, 0x95};

  uint8_t buf[29] = {0};

  uint8_t topic_bytes[] = {0x32, 0x6b, 0x92, 0xf4, 0x66, 0xa4, 0xd4, 0x14, 0x6f, 0xc5, 0xba};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0x43, 0xcc, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Q\199\US@hY\186f", _pubPktID = 684,
// _pubBody = "\DC1/\179\209 !\230/\187 \220\191\212", _pubProps = []}
TEST(Publish311QCTest, Encode74) {
  uint8_t pkt[] = {0x3a, 0x19, 0x0,  0x8,  0x51, 0xc7, 0x1f, 0x40, 0x68, 0x59, 0xba, 0x66, 0x2, 0xac,
                   0x11, 0x2f, 0xb3, 0xd1, 0x20, 0x21, 0xe6, 0x2f, 0xbb, 0x20, 0xdc, 0xbf, 0xd4};

  uint8_t buf[37] = {0};

  uint8_t topic_bytes[] = {0x51, 0xc7, 0x1f, 0x40, 0x68, 0x59, 0xba, 0x66};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x11, 0x2f, 0xb3, 0xd1, 0x20, 0x21, 0xe6, 0x2f, 0xbb, 0x20, 0xdc, 0xbf, 0xd4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 684, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\142\&2\163\190T\212+\DC4[\234\248w\231\165@\206\&40", _pubPktID = 9582, _pubBody =
// "[(\157B\171\184\156\f\201\EM\160\166\206\199\168\222\153NX$\247\ACK2\183", _pubProps = []}
TEST(Publish311QCTest, Encode75) {
  uint8_t pkt[] = {0x3b, 0x2e, 0x0,  0x12, 0x8e, 0x32, 0xa3, 0xbe, 0x54, 0xd4, 0x2b, 0x14, 0x5b, 0xea, 0xf8, 0x77,
                   0xe7, 0xa5, 0x40, 0xce, 0x34, 0x30, 0x25, 0x6e, 0x5b, 0x28, 0x9d, 0x42, 0xab, 0xb8, 0x9c, 0xc,
                   0xc9, 0x19, 0xa0, 0xa6, 0xce, 0xc7, 0xa8, 0xde, 0x99, 0x4e, 0x58, 0x24, 0xf7, 0x6,  0x32, 0xb7};

  uint8_t buf[58] = {0};

  uint8_t topic_bytes[] = {0x8e, 0x32, 0xa3, 0xbe, 0x54, 0xd4, 0x2b, 0x14, 0x5b,
                           0xea, 0xf8, 0x77, 0xe7, 0xa5, 0x40, 0xce, 0x34, 0x30};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x28, 0x9d, 0x42, 0xab, 0xb8, 0x9c, 0xc,  0xc9, 0x19, 0xa0, 0xa6,
                         0xce, 0xc7, 0xa8, 0xde, 0x99, 0x4e, 0x58, 0x24, 0xf7, 0x6,  0x32, 0xb7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 9582, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "ox\254Qe\203<\176\195ES", _pubPktID
// = 20876, _pubBody = "J\224\148H\132xS\156Aov\199\244wF[\n\185\190;\142o\SOHg", _pubProps = []}
TEST(Publish311QCTest, Encode76) {
  uint8_t pkt[] = {0x34, 0x27, 0x0,  0xb,  0x6f, 0x78, 0xfe, 0x51, 0x65, 0xcb, 0x3c, 0xb0, 0xc3, 0x45,
                   0x53, 0x51, 0x8c, 0x4a, 0xe0, 0x94, 0x48, 0x84, 0x78, 0x53, 0x9c, 0x41, 0x6f, 0x76,
                   0xc7, 0xf4, 0x77, 0x46, 0x5b, 0xa,  0xb9, 0xbe, 0x3b, 0x8e, 0x6f, 0x1,  0x67};

  uint8_t buf[51] = {0};

  uint8_t topic_bytes[] = {0x6f, 0x78, 0xfe, 0x51, 0x65, 0xcb, 0x3c, 0xb0, 0xc3, 0x45, 0x53};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4a, 0xe0, 0x94, 0x48, 0x84, 0x78, 0x53, 0x9c, 0x41, 0x6f, 0x76, 0xc7,
                         0xf4, 0x77, 0x46, 0x5b, 0xa,  0xb9, 0xbe, 0x3b, 0x8e, 0x6f, 0x1,  0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 20876, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = ")\159\249\220\185\252\230\193",
// _pubPktID = 10776, _pubBody = "\144\230\&6K\134\194\176\153\v\145(]\222\255\155\231\225(?\150}\155\FS\173)",
// _pubProps = []}
TEST(Publish311QCTest, Encode77) {
  uint8_t pkt[] = {0x34, 0x25, 0x0,  0x8,  0x29, 0x9f, 0xf9, 0xdc, 0xb9, 0xfc, 0xe6, 0xc1, 0x2a,
                   0x18, 0x90, 0xe6, 0x36, 0x4b, 0x86, 0xc2, 0xb0, 0x99, 0xb,  0x91, 0x28, 0x5d,
                   0xde, 0xff, 0x9b, 0xe7, 0xe1, 0x28, 0x3f, 0x96, 0x7d, 0x9b, 0x1c, 0xad, 0x29};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0x29, 0x9f, 0xf9, 0xdc, 0xb9, 0xfc, 0xe6, 0xc1};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x90, 0xe6, 0x36, 0x4b, 0x86, 0xc2, 0xb0, 0x99, 0xb,  0x91, 0x28, 0x5d, 0xde,
                         0xff, 0x9b, 0xe7, 0xe1, 0x28, 0x3f, 0x96, 0x7d, 0x9b, 0x1c, 0xad, 0x29};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10776, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "6:\229<\217\235\180", _pubPktID =
// 21683, _pubBody = "y", _pubProps = []}
TEST(Publish311QCTest, Encode78) {
  uint8_t pkt[] = {0x3c, 0xc, 0x0, 0x7, 0x36, 0x3a, 0xe5, 0x3c, 0xd9, 0xeb, 0xb4, 0x54, 0xb3, 0x79};

  uint8_t buf[24] = {0};

  uint8_t topic_bytes[] = {0x36, 0x3a, 0xe5, 0x3c, 0xd9, 0xeb, 0xb4};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 21683, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ",l\239A\255.e\128\238\190\EOT\216\240\231", _pubPktID = 0, _pubBody =
// "\ENQ\DC3z\234.f[;\DC2\214i0\161P\251\171\160\RS\180\222J\202\191\DC2(.", _pubProps = []}
TEST(Publish311QCTest, Encode79) {
  uint8_t pkt[] = {0x31, 0x2a, 0x0,  0xe,  0x2c, 0x6c, 0xef, 0x41, 0xff, 0x2e, 0x65, 0x80, 0xee, 0xbe, 0x4,
                   0xd8, 0xf0, 0xe7, 0x5,  0x13, 0x7a, 0xea, 0x2e, 0x66, 0x5b, 0x3b, 0x12, 0xd6, 0x69, 0x30,
                   0xa1, 0x50, 0xfb, 0xab, 0xa0, 0x1e, 0xb4, 0xde, 0x4a, 0xca, 0xbf, 0x12, 0x28, 0x2e};

  uint8_t buf[54] = {0};

  uint8_t topic_bytes[] = {0x2c, 0x6c, 0xef, 0x41, 0xff, 0x2e, 0x65, 0x80, 0xee, 0xbe, 0x4, 0xd8, 0xf0, 0xe7};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5,  0x13, 0x7a, 0xea, 0x2e, 0x66, 0x5b, 0x3b, 0x12, 0xd6, 0x69, 0x30, 0xa1,
                         0x50, 0xfb, 0xab, 0xa0, 0x1e, 0xb4, 0xde, 0x4a, 0xca, 0xbf, 0x12, 0x28, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\179\182\194\v\149\131\&4\177\175cM\153\251\204B\RS\231\170n}y\198\197)\250\203\147\151\211\138", _pubPktID = 1399,
// _pubBody = "\156\228\194pPo\189\&6\255\NAK\245-\151\170\DC3;\191\196\136\241\191\255V\146`\250\183\234>\138",
// _pubProps = []}
TEST(Publish311QCTest, Encode80) {
  uint8_t pkt[] = {0x3b, 0x40, 0x0,  0x1e, 0xb3, 0xb6, 0xc2, 0xb,  0x95, 0x83, 0x34, 0xb1, 0xaf, 0x63, 0x4d, 0x99, 0xfb,
                   0xcc, 0x42, 0x1e, 0xe7, 0xaa, 0x6e, 0x7d, 0x79, 0xc6, 0xc5, 0x29, 0xfa, 0xcb, 0x93, 0x97, 0xd3, 0x8a,
                   0x5,  0x77, 0x9c, 0xe4, 0xc2, 0x70, 0x50, 0x6f, 0xbd, 0x36, 0xff, 0x15, 0xf5, 0x2d, 0x97, 0xaa, 0x13,
                   0x3b, 0xbf, 0xc4, 0x88, 0xf1, 0xbf, 0xff, 0x56, 0x92, 0x60, 0xfa, 0xb7, 0xea, 0x3e, 0x8a};

  uint8_t buf[76] = {0};

  uint8_t topic_bytes[] = {0xb3, 0xb6, 0xc2, 0xb,  0x95, 0x83, 0x34, 0xb1, 0xaf, 0x63, 0x4d, 0x99, 0xfb, 0xcc, 0x42,
                           0x1e, 0xe7, 0xaa, 0x6e, 0x7d, 0x79, 0xc6, 0xc5, 0x29, 0xfa, 0xcb, 0x93, 0x97, 0xd3, 0x8a};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9c, 0xe4, 0xc2, 0x70, 0x50, 0x6f, 0xbd, 0x36, 0xff, 0x15, 0xf5, 0x2d, 0x97, 0xaa, 0x13,
                         0x3b, 0xbf, 0xc4, 0x88, 0xf1, 0xbf, 0xff, 0x56, 0x92, 0x60, 0xfa, 0xb7, 0xea, 0x3e, 0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1399, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\183\185o\230@UI=\142/\201\188\216sZ\ESC\b\"\182\202\NAKU$`\181\rE\194t\f", _pubPktID = 17758, _pubBody =
// "\251~\215\217\SOH\189L!\244\EM\212\246_\154\185\179.\187\EOTE\242\169", _pubProps = []}
TEST(Publish311QCTest, Encode81) {
  uint8_t pkt[] = {0x33, 0x38, 0x0,  0x1e, 0xb7, 0xb9, 0x6f, 0xe6, 0x40, 0x55, 0x49, 0x3d, 0x8e, 0x2f, 0xc9,
                   0xbc, 0xd8, 0x73, 0x5a, 0x1b, 0x8,  0x22, 0xb6, 0xca, 0x15, 0x55, 0x24, 0x60, 0xb5, 0xd,
                   0x45, 0xc2, 0x74, 0xc,  0x45, 0x5e, 0xfb, 0x7e, 0xd7, 0xd9, 0x1,  0xbd, 0x4c, 0x21, 0xf4,
                   0x19, 0xd4, 0xf6, 0x5f, 0x9a, 0xb9, 0xb3, 0x2e, 0xbb, 0x4,  0x45, 0xf2, 0xa9};

  uint8_t buf[68] = {0};

  uint8_t topic_bytes[] = {0xb7, 0xb9, 0x6f, 0xe6, 0x40, 0x55, 0x49, 0x3d, 0x8e, 0x2f, 0xc9, 0xbc, 0xd8, 0x73, 0x5a,
                           0x1b, 0x8,  0x22, 0xb6, 0xca, 0x15, 0x55, 0x24, 0x60, 0xb5, 0xd,  0x45, 0xc2, 0x74, 0xc};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x7e, 0xd7, 0xd9, 0x1,  0xbd, 0x4c, 0x21, 0xf4, 0x19, 0xd4,
                         0xf6, 0x5f, 0x9a, 0xb9, 0xb3, 0x2e, 0xbb, 0x4,  0x45, 0xf2, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17758, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "", _pubPktID = 3165, _pubBody =
// "\168'\DC2\253\238;d\144\231\186\152t\206\166", _pubProps = []}
TEST(Publish311QCTest, Encode82) {
  uint8_t pkt[] = {0x3d, 0x12, 0x0,  0x0,  0xc,  0x5d, 0xa8, 0x27, 0x12, 0xfd,
                   0xee, 0x3b, 0x64, 0x90, 0xe7, 0xba, 0x98, 0x74, 0xce, 0xa6};

  uint8_t buf[30] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa8, 0x27, 0x12, 0xfd, 0xee, 0x3b, 0x64, 0x90, 0xe7, 0xba, 0x98, 0x74, 0xce, 0xa6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 3165, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\GS\DC2", _pubPktID = 7799, _pubBody
// = "\138\249b\fd \199\239\220\147\235\233\214\152\139\130Q\163v?ZrG\215\139\236\184\230y", _pubProps = []}
TEST(Publish311QCTest, Encode83) {
  uint8_t pkt[] = {0x3a, 0x23, 0x0,  0x2,  0x1d, 0x12, 0x1e, 0x77, 0x8a, 0xf9, 0x62, 0xc,  0x64,
                   0x20, 0xc7, 0xef, 0xdc, 0x93, 0xeb, 0xe9, 0xd6, 0x98, 0x8b, 0x82, 0x51, 0xa3,
                   0x76, 0x3f, 0x5a, 0x72, 0x47, 0xd7, 0x8b, 0xec, 0xb8, 0xe6, 0x79};

  uint8_t buf[47] = {0};

  uint8_t topic_bytes[] = {0x1d, 0x12};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a, 0xf9, 0x62, 0xc,  0x64, 0x20, 0xc7, 0xef, 0xdc, 0x93, 0xeb, 0xe9, 0xd6, 0x98, 0x8b,
                         0x82, 0x51, 0xa3, 0x76, 0x3f, 0x5a, 0x72, 0x47, 0xd7, 0x8b, 0xec, 0xb8, 0xe6, 0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7799, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\208\187K.", _pubPktID = 29034,
// _pubBody = "\221\ACK\199\144\EOTv\ACK\217\\", _pubProps = []}
TEST(Publish311QCTest, Encode84) {
  uint8_t pkt[] = {0x3b, 0x11, 0x0,  0x4,  0xd0, 0xbb, 0x4b, 0x2e, 0x71, 0x6a,
                   0xdd, 0x6,  0xc7, 0x90, 0x4,  0x76, 0x6,  0xd9, 0x5c};

  uint8_t buf[29] = {0};

  uint8_t topic_bytes[] = {0xd0, 0xbb, 0x4b, 0x2e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0x6, 0xc7, 0x90, 0x4, 0x76, 0x6, 0xd9, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29034, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201y\171\155\184C", _pubPktID = 0,
// _pubBody = "\180\178\&2\194\SUB5Z\254\US\217\144\t:4a\154\203\201\ETX\DC3\246_[<\224", _pubProps = []}
TEST(Publish311QCTest, Encode85) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0x6,  0xc9, 0x79, 0xab, 0x9b, 0xb8, 0x43, 0xb4, 0xb2,
                   0x32, 0xc2, 0x1a, 0x35, 0x5a, 0xfe, 0x1f, 0xd9, 0x90, 0x9,  0x3a, 0x34,
                   0x61, 0x9a, 0xcb, 0xc9, 0x3,  0x13, 0xf6, 0x5f, 0x5b, 0x3c, 0xe0};

  uint8_t buf[45] = {0};

  uint8_t topic_bytes[] = {0xc9, 0x79, 0xab, 0x9b, 0xb8, 0x43};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb4, 0xb2, 0x32, 0xc2, 0x1a, 0x35, 0x5a, 0xfe, 0x1f, 0xd9, 0x90, 0x9, 0x3a,
                         0x34, 0x61, 0x9a, 0xcb, 0xc9, 0x3,  0x13, 0xf6, 0x5f, 0x5b, 0x3c, 0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}q\213-\168\195\252$\139j^\DC1o\198\RS\172\159q", _pubPktID = 8388, _pubBody = "\196\&7\f\aA\EOT", _pubProps = []}
TEST(Publish311QCTest, Encode86) {
  uint8_t pkt[] = {0x32, 0x1c, 0x0,  0x12, 0x7d, 0x71, 0xd5, 0x2d, 0xa8, 0xc3, 0xfc, 0x24, 0x8b, 0x6a, 0x5e,
                   0x11, 0x6f, 0xc6, 0x1e, 0xac, 0x9f, 0x71, 0x20, 0xc4, 0xc4, 0x37, 0xc,  0x7,  0x41, 0x4};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0x7d, 0x71, 0xd5, 0x2d, 0xa8, 0xc3, 0xfc, 0x24, 0x8b,
                           0x6a, 0x5e, 0x11, 0x6f, 0xc6, 0x1e, 0xac, 0x9f, 0x71};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc4, 0x37, 0xc, 0x7, 0x41, 0x4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 8388, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\214\177\ETBL\143\b\216", _pubPktID
// = 466, _pubBody = "sz\183u\DC3:\199\242\216%\137\EM\a\203\242\209\144\194fR6\240\163&\200H", _pubProps = []}
TEST(Publish311QCTest, Encode87) {
  uint8_t pkt[] = {0x34, 0x25, 0x0,  0x7,  0xd6, 0xb1, 0x17, 0x4c, 0x8f, 0x8,  0xd8, 0x1,  0xd2,
                   0x73, 0x7a, 0xb7, 0x75, 0x13, 0x3a, 0xc7, 0xf2, 0xd8, 0x25, 0x89, 0x19, 0x7,
                   0xcb, 0xf2, 0xd1, 0x90, 0xc2, 0x66, 0x52, 0x36, 0xf0, 0xa3, 0x26, 0xc8, 0x48};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0xd6, 0xb1, 0x17, 0x4c, 0x8f, 0x8, 0xd8};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0x7a, 0xb7, 0x75, 0x13, 0x3a, 0xc7, 0xf2, 0xd8, 0x25, 0x89, 0x19, 0x7,
                         0xcb, 0xf2, 0xd1, 0x90, 0xc2, 0x66, 0x52, 0x36, 0xf0, 0xa3, 0x26, 0xc8, 0x48};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 466, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\STX\213\240cI\204T-w\154\192|#=\254P\DC24\200\170\228\NUL\186\147/\225\193\b\FS\140", _pubPktID = 26668, _pubBody =
// ".T\237(\238\DELg0 \GS\STX\215*\156\169t\147\b\206\149\172\r\211\RS\205 5\US\t0", _pubProps = []}
TEST(Publish311QCTest, Encode88) {
  uint8_t pkt[] = {0x33, 0x40, 0x0,  0x1e, 0x2,  0xd5, 0xf0, 0x63, 0x49, 0xcc, 0x54, 0x2d, 0x77, 0x9a, 0xc0, 0x7c, 0x23,
                   0x3d, 0xfe, 0x50, 0x12, 0x34, 0xc8, 0xaa, 0xe4, 0x0,  0xba, 0x93, 0x2f, 0xe1, 0xc1, 0x8,  0x1c, 0x8c,
                   0x68, 0x2c, 0x2e, 0x54, 0xed, 0x28, 0xee, 0x7f, 0x67, 0x30, 0x20, 0x1d, 0x2,  0xd7, 0x2a, 0x9c, 0xa9,
                   0x74, 0x93, 0x8,  0xce, 0x95, 0xac, 0xd,  0xd3, 0x1e, 0xcd, 0x20, 0x35, 0x1f, 0x9,  0x30};

  uint8_t buf[76] = {0};

  uint8_t topic_bytes[] = {0x2,  0xd5, 0xf0, 0x63, 0x49, 0xcc, 0x54, 0x2d, 0x77, 0x9a, 0xc0, 0x7c, 0x23, 0x3d, 0xfe,
                           0x50, 0x12, 0x34, 0xc8, 0xaa, 0xe4, 0x0,  0xba, 0x93, 0x2f, 0xe1, 0xc1, 0x8,  0x1c, 0x8c};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2e, 0x54, 0xed, 0x28, 0xee, 0x7f, 0x67, 0x30, 0x20, 0x1d, 0x2,  0xd7, 0x2a, 0x9c, 0xa9,
                         0x74, 0x93, 0x8,  0xce, 0x95, 0xac, 0xd,  0xd3, 0x1e, 0xcd, 0x20, 0x35, 0x1f, 0x9,  0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 26668, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\"X\209\155%
// \FS1[\178\SI\134\232\SI\236n\212\r\FS", _pubPktID = 0, _pubBody =
// "`\190\143p\n\134\145\250\152\151,\233\245\224\143\FS\235_/\133\203", _pubProps = []}
TEST(Publish311QCTest, Encode89) {
  uint8_t pkt[] = {0x39, 0x2a, 0x0,  0x13, 0x22, 0x58, 0xd1, 0x9b, 0x25, 0x20, 0x1c, 0x31, 0x5b, 0xb2, 0xf,
                   0x86, 0xe8, 0xf,  0xec, 0x6e, 0xd4, 0xd,  0x1c, 0x60, 0xbe, 0x8f, 0x70, 0xa,  0x86, 0x91,
                   0xfa, 0x98, 0x97, 0x2c, 0xe9, 0xf5, 0xe0, 0x8f, 0x1c, 0xeb, 0x5f, 0x2f, 0x85, 0xcb};

  uint8_t buf[54] = {0};

  uint8_t topic_bytes[] = {0x22, 0x58, 0xd1, 0x9b, 0x25, 0x20, 0x1c, 0x31, 0x5b, 0xb2,
                           0xf,  0x86, 0xe8, 0xf,  0xec, 0x6e, 0xd4, 0xd,  0x1c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xbe, 0x8f, 0x70, 0xa,  0x86, 0x91, 0xfa, 0x98, 0x97, 0x2c,
                         0xe9, 0xf5, 0xe0, 0x8f, 0x1c, 0xeb, 0x5f, 0x2f, 0x85, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\175\195\208b[q\226\128\DC4'",
// _pubPktID = 14979, _pubBody = "\US", _pubProps = []}
TEST(Publish311QCTest, Encode90) {
  uint8_t pkt[] = {0x3c, 0xf, 0x0, 0xa, 0xaf, 0xc3, 0xd0, 0x62, 0x5b, 0x71, 0xe2, 0x80, 0x14, 0x27, 0x3a, 0x83, 0x1f};

  uint8_t buf[27] = {0};

  uint8_t topic_bytes[] = {0xaf, 0xc3, 0xd0, 0x62, 0x5b, 0x71, 0xe2, 0x80, 0x14, 0x27};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 14979, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\141\253\128M\210\215vFY\193c\236\174\r\155\SYN\\y", _pubPktID = 16476, _pubBody = "\DEL\250\&0\179-", _pubProps =
// []}
TEST(Publish311QCTest, Encode91) {
  uint8_t pkt[] = {0x3b, 0x1b, 0x0, 0x12, 0x8d, 0xfd, 0x80, 0x4d, 0xd2, 0xd7, 0x76, 0x46, 0x59, 0xc1, 0x63,
                   0xec, 0xae, 0xd, 0x9b, 0x16, 0x5c, 0x79, 0x40, 0x5c, 0x7f, 0xfa, 0x30, 0xb3, 0x2d};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0x8d, 0xfd, 0x80, 0x4d, 0xd2, 0xd7, 0x76, 0x46, 0x59,
                           0xc1, 0x63, 0xec, 0xae, 0xd,  0x9b, 0x16, 0x5c, 0x79};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7f, 0xfa, 0x30, 0xb3, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16476, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\172\236
// #(l]\NAK\197K\GS\156j\151\195\144\235C\\\137\199*\177", _pubPktID = 24115, _pubBody = "\138", _pubProps = []}
TEST(Publish311QCTest, Encode92) {
  uint8_t pkt[] = {0x3a, 0x1c, 0x0,  0x17, 0xac, 0xec, 0x20, 0x23, 0x28, 0x6c, 0x5d, 0x15, 0xc5, 0x4b, 0x1d,
                   0x9c, 0x6a, 0x97, 0xc3, 0x90, 0xeb, 0x43, 0x5c, 0x89, 0xc7, 0x2a, 0xb1, 0x5e, 0x33, 0x8a};

  uint8_t buf[40] = {0};

  uint8_t topic_bytes[] = {0xac, 0xec, 0x20, 0x23, 0x28, 0x6c, 0x5d, 0x15, 0xc5, 0x4b, 0x1d, 0x9c,
                           0x6a, 0x97, 0xc3, 0x90, 0xeb, 0x43, 0x5c, 0x89, 0xc7, 0x2a, 0xb1};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 24115, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\SUB\250\FSj@\239n\DEL\t\158:\132\165\249\130\226L", _pubPktID = 159, _pubBody =
// "\131\140\143\172oD6\SIS\196O.\145\141\166\EOT\188\153\251U\SYNJT", _pubProps = []}
TEST(Publish311QCTest, Encode93) {
  uint8_t pkt[] = {0x3d, 0x2c, 0x0,  0x11, 0x1a, 0xfa, 0x1c, 0x6a, 0x40, 0xef, 0x6e, 0x7f, 0x9,  0x9e, 0x3a, 0x84,
                   0xa5, 0xf9, 0x82, 0xe2, 0x4c, 0x0,  0x9f, 0x83, 0x8c, 0x8f, 0xac, 0x6f, 0x44, 0x36, 0xf,  0x53,
                   0xc4, 0x4f, 0x2e, 0x91, 0x8d, 0xa6, 0x4,  0xbc, 0x99, 0xfb, 0x55, 0x16, 0x4a, 0x54};

  uint8_t buf[56] = {0};

  uint8_t topic_bytes[] = {0x1a, 0xfa, 0x1c, 0x6a, 0x40, 0xef, 0x6e, 0x7f, 0x9,
                           0x9e, 0x3a, 0x84, 0xa5, 0xf9, 0x82, 0xe2, 0x4c};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x83, 0x8c, 0x8f, 0xac, 0x6f, 0x44, 0x36, 0xf,  0x53, 0xc4, 0x4f, 0x2e,
                         0x91, 0x8d, 0xa6, 0x4,  0xbc, 0x99, 0xfb, 0x55, 0x16, 0x4a, 0x54};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 159, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192K\248\134\174}\198-\171\235\SUB\214]\204\&3\177\f", _pubPktID = 0, _pubBody =
// "%\131\215\218\147\225\ENQ\173Wh\129\234\197", _pubProps = []}
TEST(Publish311QCTest, Encode94) {
  uint8_t pkt[] = {0x38, 0x20, 0x0,  0x11, 0xc0, 0x4b, 0xf8, 0x86, 0xae, 0x7d, 0xc6, 0x2d,
                   0xab, 0xeb, 0x1a, 0xd6, 0x5d, 0xcc, 0x33, 0xb1, 0xc,  0x25, 0x83, 0xd7,
                   0xda, 0x93, 0xe1, 0x5,  0xad, 0x57, 0x68, 0x81, 0xea, 0xc5};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0xc0, 0x4b, 0xf8, 0x86, 0xae, 0x7d, 0xc6, 0x2d, 0xab,
                           0xeb, 0x1a, 0xd6, 0x5d, 0xcc, 0x33, 0xb1, 0xc};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0x83, 0xd7, 0xda, 0x93, 0xe1, 0x5, 0xad, 0x57, 0x68, 0x81, 0xea, 0xc5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\161&K\GSu\164\DC1W\156\205\DC2e\US\253\SUB\212\GS\146u", _pubPktID = 4938, _pubBody =
// "\197\210\201\164\236`\GSJjyh\252c\GS\185\190\150xY\239>\220\165.", _pubProps = []}
TEST(Publish311QCTest, Encode95) {
  uint8_t pkt[] = {0x3a, 0x2f, 0x0,  0x13, 0xa1, 0x26, 0x4b, 0x1d, 0x75, 0xa4, 0x11, 0x57, 0x9c, 0xcd, 0x12, 0x65, 0x1f,
                   0xfd, 0x1a, 0xd4, 0x1d, 0x92, 0x75, 0x13, 0x4a, 0xc5, 0xd2, 0xc9, 0xa4, 0xec, 0x60, 0x1d, 0x4a, 0x6a,
                   0x79, 0x68, 0xfc, 0x63, 0x1d, 0xb9, 0xbe, 0x96, 0x78, 0x59, 0xef, 0x3e, 0xdc, 0xa5, 0x2e};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0xa1, 0x26, 0x4b, 0x1d, 0x75, 0xa4, 0x11, 0x57, 0x9c, 0xcd,
                           0x12, 0x65, 0x1f, 0xfd, 0x1a, 0xd4, 0x1d, 0x92, 0x75};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0xd2, 0xc9, 0xa4, 0xec, 0x60, 0x1d, 0x4a, 0x6a, 0x79, 0x68, 0xfc,
                         0x63, 0x1d, 0xb9, 0xbe, 0x96, 0x78, 0x59, 0xef, 0x3e, 0xdc, 0xa5, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 4938, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\149\203\181S\"+\168\160\141\DEL~e8\150\193\SYN\t1", _pubPktID = 0, _pubBody = "m#Za\252\192\201Y\NAK\221",
// _pubProps = []}
TEST(Publish311QCTest, Encode96) {
  uint8_t pkt[] = {0x38, 0x1e, 0x0,  0x12, 0x95, 0xcb, 0xb5, 0x53, 0x22, 0x2b, 0xa8, 0xa0, 0x8d, 0x7f, 0x7e, 0x65,
                   0x38, 0x96, 0xc1, 0x16, 0x9,  0x31, 0x6d, 0x23, 0x5a, 0x61, 0xfc, 0xc0, 0xc9, 0x59, 0x15, 0xdd};

  uint8_t buf[42] = {0};

  uint8_t topic_bytes[] = {0x95, 0xcb, 0xb5, 0x53, 0x22, 0x2b, 0xa8, 0xa0, 0x8d,
                           0x7f, 0x7e, 0x65, 0x38, 0x96, 0xc1, 0x16, 0x9,  0x31};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6d, 0x23, 0x5a, 0x61, 0xfc, 0xc0, 0xc9, 0x59, 0x15, 0xdd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\254\DLE\200m\251\190\157\139\&9=\175\219\238~:ap/{\148", _pubPktID = 0, _pubBody = "\163~rt", _pubProps = []}
TEST(Publish311QCTest, Encode97) {
  uint8_t pkt[] = {0x38, 0x1a, 0x0,  0x14, 0xfe, 0x10, 0xc8, 0x6d, 0xfb, 0xbe, 0x9d, 0x8b, 0x39, 0x3d,
                   0xaf, 0xdb, 0xee, 0x7e, 0x3a, 0x61, 0x70, 0x2f, 0x7b, 0x94, 0xa3, 0x7e, 0x72, 0x74};

  uint8_t buf[38] = {0};

  uint8_t topic_bytes[] = {0xfe, 0x10, 0xc8, 0x6d, 0xfb, 0xbe, 0x9d, 0x8b, 0x39, 0x3d,
                           0xaf, 0xdb, 0xee, 0x7e, 0x3a, 0x61, 0x70, 0x2f, 0x7b, 0x94};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa3, 0x7e, 0x72, 0x74};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\253a\DC4gD\189tvCr\177\&0w\132",
// _pubPktID = 26, _pubBody = "\188\SOx\169\171\214_\225\142.\SIW\SO\149\GS\184M\199\137\174\128cS\187OBD\139\218",
// _pubProps = []}
TEST(Publish311QCTest, Encode98) {
  uint8_t pkt[] = {0x3a, 0x2f, 0x0,  0xe,  0xfd, 0x61, 0x14, 0x67, 0x44, 0xbd, 0x74, 0x76, 0x43, 0x72, 0xb1, 0x30, 0x77,
                   0x84, 0x0,  0x1a, 0xbc, 0xe,  0x78, 0xa9, 0xab, 0xd6, 0x5f, 0xe1, 0x8e, 0x2e, 0xf,  0x57, 0xe,  0x95,
                   0x1d, 0xb8, 0x4d, 0xc7, 0x89, 0xae, 0x80, 0x63, 0x53, 0xbb, 0x4f, 0x42, 0x44, 0x8b, 0xda};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0xfd, 0x61, 0x14, 0x67, 0x44, 0xbd, 0x74, 0x76, 0x43, 0x72, 0xb1, 0x30, 0x77, 0x84};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbc, 0xe,  0x78, 0xa9, 0xab, 0xd6, 0x5f, 0xe1, 0x8e, 0x2e, 0xf,  0x57, 0xe,  0x95, 0x1d,
                         0xb8, 0x4d, 0xc7, 0x89, 0xae, 0x80, 0x63, 0x53, 0xbb, 0x4f, 0x42, 0x44, 0x8b, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 26, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\251\169\245\241\201;\SOH\174B\v\STX\SOH\202\137\ETX\139y\235\139\&8~b&\235", _pubPktID = 0, _pubBody =
// "O\222\143\SO\DC2\DC2\180\DC3\242\226I\151\ACKv\247\150\v\DC4\228", _pubProps = []}
TEST(Publish311QCTest, Encode99) {
  uint8_t pkt[] = {0x39, 0x2d, 0x0,  0x18, 0xfb, 0xa9, 0xf5, 0xf1, 0xc9, 0x3b, 0x1,  0xae, 0x42, 0xb,  0x2,  0x1,
                   0xca, 0x89, 0x3,  0x8b, 0x79, 0xeb, 0x8b, 0x38, 0x7e, 0x62, 0x26, 0xeb, 0x4f, 0xde, 0x8f, 0xe,
                   0x12, 0x12, 0xb4, 0x13, 0xf2, 0xe2, 0x49, 0x97, 0x6,  0x76, 0xf7, 0x96, 0xb,  0x14, 0xe4};

  uint8_t buf[57] = {0};

  uint8_t topic_bytes[] = {0xfb, 0xa9, 0xf5, 0xf1, 0xc9, 0x3b, 0x1,  0xae, 0x42, 0xb,  0x2,  0x1,
                           0xca, 0x89, 0x3,  0x8b, 0x79, 0xeb, 0x8b, 0x38, 0x7e, 0x62, 0x26, 0xeb};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0xde, 0x8f, 0xe,  0x12, 0x12, 0xb4, 0x13, 0xf2, 0xe2,
                         0x49, 0x97, 0x6,  0x76, 0xf7, 0x96, 0xb,  0x14, 0xe4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\130\195\DC3\129^;\DC2\222\159\233g\190\156\&9\DC2\149t\138<\191|", _pubPktID = 0, _pubBody =
// "\145m\248\188\208:\172\v\129\EOT\158\139\132\192yQ\206S\252\152\ETBQrEx\t\ENQ^\235\139", _pubProps = []}
TEST(Publish311QCTest, Encode100) {
  uint8_t pkt[] = {0x30, 0x35, 0x0,  0x15, 0x82, 0xc3, 0x13, 0x81, 0x5e, 0x3b, 0x12, 0xde, 0x9f, 0xe9,
                   0x67, 0xbe, 0x9c, 0x39, 0x12, 0x95, 0x74, 0x8a, 0x3c, 0xbf, 0x7c, 0x91, 0x6d, 0xf8,
                   0xbc, 0xd0, 0x3a, 0xac, 0xb,  0x81, 0x4,  0x9e, 0x8b, 0x84, 0xc0, 0x79, 0x51, 0xce,
                   0x53, 0xfc, 0x98, 0x17, 0x51, 0x72, 0x45, 0x78, 0x9,  0x5,  0x5e, 0xeb, 0x8b};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0x82, 0xc3, 0x13, 0x81, 0x5e, 0x3b, 0x12, 0xde, 0x9f, 0xe9, 0x67,
                           0xbe, 0x9c, 0x39, 0x12, 0x95, 0x74, 0x8a, 0x3c, 0xbf, 0x7c};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x91, 0x6d, 0xf8, 0xbc, 0xd0, 0x3a, 0xac, 0xb,  0x81, 0x4,  0x9e, 0x8b, 0x84, 0xc0, 0x79,
                         0x51, 0xce, 0x53, 0xfc, 0x98, 0x17, 0x51, 0x72, 0x45, 0x78, 0x9,  0x5,  0x5e, 0xeb, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, empty_props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\136Y\192\226{\129\199E\USu\182\215\SUB'\245\DC4\171\139\NAKY", _pubPktID = 15774, _pubBody = "\255", _pubProps =
// [PropServerReference "*\172\"2WGRO\157\160<\211\203yR]\221\FS\167\DLE.\140\167U\132",PropServerReference
// "\NAK5\205\240!\219\r\254\f\198W\RS~\224\RSA",PropContentType
// "3\180K\SUB\225\135\158\b\137\130\239",PropServerReference "\133",PropWildcardSubscriptionAvailable
// 28,PropServerReference "&\t\"\195\v\139\254\232\232Q&X\202\192\196",PropCorrelationData "\187A",PropResponseTopic
// "\171\SUB\CAN\EM1\162\189\254uYT\233A\136'\195\195\v;\138t\194\148\153\nZw\189",PropMaximumPacketSize
// 20297,PropMessageExpiryInterval 28350,PropMessageExpiryInterval 1786,PropContentType
// "\173\235}$\DC4\222\167z\DC3\RS;k\180\ETB=\v2e\229$:t\b\243\243",PropServerKeepAlive 24429,PropWillDelayInterval
// 14881,PropServerKeepAlive 4484,PropRequestProblemInformation 52,PropCorrelationData
// "^\239",PropRequestResponseInformation 213,PropReasonString "\179nh28W",PropSessionExpiryInterval
// 12170,PropResponseTopic "\231\217\178\SYN",PropSessionExpiryInterval 28653,PropMessageExpiryInterval
// 23984,PropMessageExpiryInterval 23557,PropContentType "az\SUB\143\135hS\140Wx5m\SI\210\234?dR",PropRetainAvailable
// 216,PropSubscriptionIdentifier 9,PropWildcardSubscriptionAvailable 35]}
TEST(Publish50QCTest, Encode1) {
  uint8_t pkt[] = {
      0x32, 0x92, 0x2,  0x0,  0x14, 0x88, 0x59, 0xc0, 0xe2, 0x7b, 0x81, 0xc7, 0x45, 0x1f, 0x75, 0xb6, 0xd7, 0x1a, 0x27,
      0xf5, 0x14, 0xab, 0x8b, 0x15, 0x59, 0x3d, 0x9e, 0xf7, 0x1,  0x1c, 0x0,  0x19, 0x2a, 0xac, 0x22, 0x32, 0x57, 0x47,
      0x52, 0x4f, 0x9d, 0xa0, 0x3c, 0xd3, 0xcb, 0x79, 0x52, 0x5d, 0xdd, 0x1c, 0xa7, 0x10, 0x2e, 0x8c, 0xa7, 0x55, 0x84,
      0x1c, 0x0,  0x10, 0x15, 0x35, 0xcd, 0xf0, 0x21, 0xdb, 0xd,  0xfe, 0xc,  0xc6, 0x57, 0x1e, 0x7e, 0xe0, 0x1e, 0x41,
      0x3,  0x0,  0xb,  0x33, 0xb4, 0x4b, 0x1a, 0xe1, 0x87, 0x9e, 0x8,  0x89, 0x82, 0xef, 0x1c, 0x0,  0x1,  0x85, 0x28,
      0x1c, 0x1c, 0x0,  0xf,  0x26, 0x9,  0x22, 0xc3, 0xb,  0x8b, 0xfe, 0xe8, 0xe8, 0x51, 0x26, 0x58, 0xca, 0xc0, 0xc4,
      0x9,  0x0,  0x2,  0xbb, 0x41, 0x8,  0x0,  0x1c, 0xab, 0x1a, 0x18, 0x19, 0x31, 0xa2, 0xbd, 0xfe, 0x75, 0x59, 0x54,
      0xe9, 0x41, 0x88, 0x27, 0xc3, 0xc3, 0xb,  0x3b, 0x8a, 0x74, 0xc2, 0x94, 0x99, 0xa,  0x5a, 0x77, 0xbd, 0x27, 0x0,
      0x0,  0x4f, 0x49, 0x2,  0x0,  0x0,  0x6e, 0xbe, 0x2,  0x0,  0x0,  0x6,  0xfa, 0x3,  0x0,  0x19, 0xad, 0xeb, 0x7d,
      0x24, 0x14, 0xde, 0xa7, 0x7a, 0x13, 0x1e, 0x3b, 0x6b, 0xb4, 0x17, 0x3d, 0xb,  0x32, 0x65, 0xe5, 0x24, 0x3a, 0x74,
      0x8,  0xf3, 0xf3, 0x13, 0x5f, 0x6d, 0x18, 0x0,  0x0,  0x3a, 0x21, 0x13, 0x11, 0x84, 0x17, 0x34, 0x9,  0x0,  0x2,
      0x5e, 0xef, 0x19, 0xd5, 0x1f, 0x0,  0x6,  0xb3, 0x6e, 0x68, 0x32, 0x38, 0x57, 0x11, 0x0,  0x0,  0x2f, 0x8a, 0x8,
      0x0,  0x4,  0xe7, 0xd9, 0xb2, 0x16, 0x11, 0x0,  0x0,  0x6f, 0xed, 0x2,  0x0,  0x0,  0x5d, 0xb0, 0x2,  0x0,  0x0,
      0x5c, 0x5,  0x3,  0x0,  0x12, 0x61, 0x7a, 0x1a, 0x8f, 0x87, 0x68, 0x53, 0x8c, 0x57, 0x78, 0x35, 0x6d, 0xf,  0xd2,
      0xea, 0x3f, 0x64, 0x52, 0x25, 0xd8, 0xb,  0x9,  0x28, 0x23, 0xff};

  uint8_t buf[287] = {0};

  uint8_t topic_bytes[] = {0x88, 0x59, 0xc0, 0xe2, 0x7b, 0x81, 0xc7, 0x45, 0x1f, 0x75,
                           0xb6, 0xd7, 0x1a, 0x27, 0xf5, 0x14, 0xab, 0x8b, 0x15, 0x59};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0x2a, 0xac, 0x22, 0x32, 0x57, 0x47, 0x52, 0x4f, 0x9d, 0xa0, 0x3c, 0xd3, 0xcb,
                      0x79, 0x52, 0x5d, 0xdd, 0x1c, 0xa7, 0x10, 0x2e, 0x8c, 0xa7, 0x55, 0x84};
  uint8_t bytes1[] = {0x15, 0x35, 0xcd, 0xf0, 0x21, 0xdb, 0xd, 0xfe, 0xc, 0xc6, 0x57, 0x1e, 0x7e, 0xe0, 0x1e, 0x41};
  uint8_t bytes2[] = {0x33, 0xb4, 0x4b, 0x1a, 0xe1, 0x87, 0x9e, 0x8, 0x89, 0x82, 0xef};
  uint8_t bytes3[] = {0x85};
  uint8_t bytes4[] = {0x26, 0x9, 0x22, 0xc3, 0xb, 0x8b, 0xfe, 0xe8, 0xe8, 0x51, 0x26, 0x58, 0xca, 0xc0, 0xc4};
  uint8_t bytes5[] = {0xbb, 0x41};
  uint8_t bytes6[] = {0xab, 0x1a, 0x18, 0x19, 0x31, 0xa2, 0xbd, 0xfe, 0x75, 0x59, 0x54, 0xe9, 0x41, 0x88,
                      0x27, 0xc3, 0xc3, 0xb,  0x3b, 0x8a, 0x74, 0xc2, 0x94, 0x99, 0xa,  0x5a, 0x77, 0xbd};
  uint8_t bytes7[] = {0xad, 0xeb, 0x7d, 0x24, 0x14, 0xde, 0xa7, 0x7a, 0x13, 0x1e, 0x3b, 0x6b, 0xb4,
                      0x17, 0x3d, 0xb,  0x32, 0x65, 0xe5, 0x24, 0x3a, 0x74, 0x8,  0xf3, 0xf3};
  uint8_t bytes8[] = {0x5e, 0xef};
  uint8_t bytes9[] = {0xb3, 0x6e, 0x68, 0x32, 0x38, 0x57};
  uint8_t bytes10[] = {0xe7, 0xd9, 0xb2, 0x16};
  uint8_t bytes11[] = {0x61, 0x7a, 0x1a, 0x8f, 0x87, 0x68, 0x53, 0x8c, 0x57,
                       0x78, 0x35, 0x6d, 0xf,  0xd2, 0xea, 0x3f, 0x64, 0x52};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20297}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28350}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1786}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24429}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14881}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4484}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12170}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28653}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23984}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23557}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytes11}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 35}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 15774, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129/gG\151\&6y\225\246\193\230",
// _pubPktID = 31160, _pubBody = "\243\207\138\211\213\183N\154\SOafk\220\SUBT", _pubProps = [PropWillDelayInterval
// 165,PropSubscriptionIdentifier 2,PropSubscriptionIdentifierAvailable 145,PropContentType
// "\168\f\245\DLE\253p\136\145\148\ETX6\DELk\198vc\163S\238\230\202!"]}
TEST(Publish50QCTest, Encode2) {
  uint8_t pkt[] = {0x3d, 0x41, 0x0,  0xb,  0x81, 0x2f, 0x67, 0x47, 0x97, 0x36, 0x79, 0xe1, 0xf6, 0xc1, 0xe6, 0x79, 0xb8,
                   0x22, 0x18, 0x0,  0x0,  0x0,  0xa5, 0xb,  0x2,  0x29, 0x91, 0x3,  0x0,  0x16, 0xa8, 0xc,  0xf5, 0x10,
                   0xfd, 0x70, 0x88, 0x91, 0x94, 0x3,  0x36, 0x7f, 0x6b, 0xc6, 0x76, 0x63, 0xa3, 0x53, 0xee, 0xe6, 0xca,
                   0x21, 0xf3, 0xcf, 0x8a, 0xd3, 0xd5, 0xb7, 0x4e, 0x9a, 0xe,  0x61, 0x66, 0x6b, 0xdc, 0x1a, 0x54};

  uint8_t buf[77] = {0};

  uint8_t topic_bytes[] = {0x81, 0x2f, 0x67, 0x47, 0x97, 0x36, 0x79, 0xe1, 0xf6, 0xc1, 0xe6};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf3, 0xcf, 0x8a, 0xd3, 0xd5, 0xb7, 0x4e, 0x9a, 0xe, 0x61, 0x66, 0x6b, 0xdc, 0x1a, 0x54};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytes0[] = {0xa8, 0xc,  0xf5, 0x10, 0xfd, 0x70, 0x88, 0x91, 0x94, 0x3,  0x36,
                      0x7f, 0x6b, 0xc6, 0x76, 0x63, 0xa3, 0x53, 0xee, 0xe6, 0xca, 0x21};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 165}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytes0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 31160, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\173\FS\174\250\f\SYN6\ENQ\218i\199\ETB\213\180 \FS%", _pubPktID = 27531, _pubBody = "\129\232\a\215w\236",
// _pubProps = [PropMessageExpiryInterval 2064,PropAuthenticationMethod
// "5\187MR\NAK#d\135\207",PropSubscriptionIdentifier 13,PropContentType
// "\198\154%(@\179\250\203\246\134\193\194\213@N3\243'\149\DC1\128\163I]\194\138\157{\224",PropSubscriptionIdentifierAvailable
// 172,PropTopicAlias 6079,PropRequestProblemInformation 202,PropWildcardSubscriptionAvailable
// 85,PropSubscriptionIdentifierAvailable 226,PropReasonString "Y\243\204\GS-\161\139n\133",PropSubscriptionIdentifier
// 25,PropSharedSubscriptionAvailable 135,PropTopicAlias 32178,PropMessageExpiryInterval 9754,PropReceiveMaximum
// 27507,PropSubscriptionIdentifierAvailable 136,PropCorrelationData "'Dg",PropMaximumPacketSize 32580,PropContentType
// "\133D\195\150\250#\211ujub\229.P\214`\159ao\154\167.A[\174\132\155P"]}
TEST(Publish50QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0xa2, 0x1,  0x0,  0x11, 0xad, 0x1c, 0xae, 0xfa, 0xc,  0x16, 0x36, 0x5,  0xda, 0x69, 0xc7, 0x17,
                   0xd5, 0xb4, 0x20, 0x1c, 0x25, 0x6b, 0x8b, 0x85, 0x1,  0x2,  0x0,  0x0,  0x8,  0x10, 0x15, 0x0,  0x9,
                   0x35, 0xbb, 0x4d, 0x52, 0x15, 0x23, 0x64, 0x87, 0xcf, 0xb,  0xd,  0x3,  0x0,  0x1d, 0xc6, 0x9a, 0x25,
                   0x28, 0x40, 0xb3, 0xfa, 0xcb, 0xf6, 0x86, 0xc1, 0xc2, 0xd5, 0x40, 0x4e, 0x33, 0xf3, 0x27, 0x95, 0x11,
                   0x80, 0xa3, 0x49, 0x5d, 0xc2, 0x8a, 0x9d, 0x7b, 0xe0, 0x29, 0xac, 0x23, 0x17, 0xbf, 0x17, 0xca, 0x28,
                   0x55, 0x29, 0xe2, 0x1f, 0x0,  0x9,  0x59, 0xf3, 0xcc, 0x1d, 0x2d, 0xa1, 0x8b, 0x6e, 0x85, 0xb,  0x19,
                   0x2a, 0x87, 0x23, 0x7d, 0xb2, 0x2,  0x0,  0x0,  0x26, 0x1a, 0x21, 0x6b, 0x73, 0x29, 0x88, 0x9,  0x0,
                   0x3,  0x27, 0x44, 0x67, 0x27, 0x0,  0x0,  0x7f, 0x44, 0x3,  0x0,  0x1c, 0x85, 0x44, 0xc3, 0x96, 0xfa,
                   0x23, 0xd3, 0x75, 0x6a, 0x75, 0x62, 0xe5, 0x2e, 0x50, 0xd6, 0x60, 0x9f, 0x61, 0x6f, 0x9a, 0xa7, 0x2e,
                   0x41, 0x5b, 0xae, 0x84, 0x9b, 0x50, 0x81, 0xe8, 0x7,  0xd7, 0x77, 0xec};

  uint8_t buf[175] = {0};

  uint8_t topic_bytes[] = {0xad, 0x1c, 0xae, 0xfa, 0xc,  0x16, 0x36, 0x5, 0xda,
                           0x69, 0xc7, 0x17, 0xd5, 0xb4, 0x20, 0x1c, 0x25};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0xe8, 0x7, 0xd7, 0x77, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytes0[] = {0x35, 0xbb, 0x4d, 0x52, 0x15, 0x23, 0x64, 0x87, 0xcf};
  uint8_t bytes1[] = {0xc6, 0x9a, 0x25, 0x28, 0x40, 0xb3, 0xfa, 0xcb, 0xf6, 0x86, 0xc1, 0xc2, 0xd5, 0x40, 0x4e,
                      0x33, 0xf3, 0x27, 0x95, 0x11, 0x80, 0xa3, 0x49, 0x5d, 0xc2, 0x8a, 0x9d, 0x7b, 0xe0};
  uint8_t bytes2[] = {0x59, 0xf3, 0xcc, 0x1d, 0x2d, 0xa1, 0x8b, 0x6e, 0x85};
  uint8_t bytes3[] = {0x27, 0x44, 0x67};
  uint8_t bytes4[] = {0x85, 0x44, 0xc3, 0x96, 0xfa, 0x23, 0xd3, 0x75, 0x6a, 0x75, 0x62, 0xe5, 0x2e, 0x50,
                      0xd6, 0x60, 0x9f, 0x61, 0x6f, 0x9a, 0xa7, 0x2e, 0x41, 0x5b, 0xae, 0x84, 0x9b, 0x50};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2064}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6079}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32178}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9754}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27507}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32580}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytes4}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 27531, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "y\135\f\ESC\175I\RS=", _pubPktID =
// 3010, _pubBody = "\198L\248\190/9\218\229\251^", _pubProps = [PropSubscriptionIdentifier 28,PropMessageExpiryInterval
// 27639,PropRequestResponseInformation 179]}
TEST(Publish50QCTest, Encode4) {
  uint8_t pkt[] = {0x35, 0x20, 0x0, 0x8,  0x79, 0x87, 0xc,  0x1b, 0xaf, 0x49, 0x1e, 0x3d, 0xb,  0xc2, 0x9,  0xb,  0x1c,
                   0x2,  0x0,  0x0, 0x6b, 0xf7, 0x19, 0xb3, 0xc6, 0x4c, 0xf8, 0xbe, 0x2f, 0x39, 0xda, 0xe5, 0xfb, 0x5e};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0x79, 0x87, 0xc, 0x1b, 0xaf, 0x49, 0x1e, 0x3d};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc6, 0x4c, 0xf8, 0xbe, 0x2f, 0x39, 0xda, 0xe5, 0xfb, 0x5e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27639}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 179}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 3010, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\fQ\131\202\NAK\EOTT\204\226\174\189\&72w\136\ETX\142I\166)\137*", _pubPktID = 0, _pubBody = "\148\134\189",
// _pubProps = [PropMaximumQoS 95,PropWillDelayInterval 12953,PropSharedSubscriptionAvailable
// 83,PropRequestResponseInformation 165,PropMaximumQoS 203,PropSubscriptionIdentifier 18,PropMessageExpiryInterval
// 22843,PropWildcardSubscriptionAvailable 157,PropAuthenticationMethod "\244\241\213d\201\142\169J\236\165\229
// \246\133\177\ETX\248\186\174\241e\206\143\143i",PropTopicAlias 24582,PropRequestProblemInformation
// 126,PropWildcardSubscriptionAvailable 45,PropMessageExpiryInterval 2657,PropUserProperty
// "G\207%\tjz\CAN\162O\194\246-\139*O\ta4" "\135\215$\DELp\142B?",PropPayloadFormatIndicator 185,PropTopicAliasMaximum
// 18503,PropAuthenticationMethod "\241!^\f\199\172\144\199\208"]}
TEST(Publish50QCTest, Encode5) {
  uint8_t pkt[] = {0x30, 0x8a, 0x1,  0x0,  0x16, 0xc,  0x51, 0x83, 0xca, 0x15, 0x4,  0x54, 0xcc, 0xe2, 0xae, 0xbd,
                   0x37, 0x32, 0x77, 0x88, 0x3,  0x8e, 0x49, 0xa6, 0x29, 0x89, 0x2a, 0x6e, 0x24, 0x5f, 0x18, 0x0,
                   0x0,  0x32, 0x99, 0x2a, 0x53, 0x19, 0xa5, 0x24, 0xcb, 0xb,  0x12, 0x2,  0x0,  0x0,  0x59, 0x3b,
                   0x28, 0x9d, 0x15, 0x0,  0x19, 0xf4, 0xf1, 0xd5, 0x64, 0xc9, 0x8e, 0xa9, 0x4a, 0xec, 0xa5, 0xe5,
                   0x20, 0xf6, 0x85, 0xb1, 0x3,  0xf8, 0xba, 0xae, 0xf1, 0x65, 0xce, 0x8f, 0x8f, 0x69, 0x23, 0x60,
                   0x6,  0x17, 0x7e, 0x28, 0x2d, 0x2,  0x0,  0x0,  0xa,  0x61, 0x26, 0x0,  0x12, 0x47, 0xcf, 0x25,
                   0x9,  0x6a, 0x7a, 0x18, 0xa2, 0x4f, 0xc2, 0xf6, 0x2d, 0x8b, 0x2a, 0x4f, 0x9,  0x61, 0x34, 0x0,
                   0x8,  0x87, 0xd7, 0x24, 0x7f, 0x70, 0x8e, 0x42, 0x3f, 0x1,  0xb9, 0x22, 0x48, 0x47, 0x15, 0x0,
                   0x9,  0xf1, 0x21, 0x5e, 0xc,  0xc7, 0xac, 0x90, 0xc7, 0xd0, 0x94, 0x86, 0xbd};

  uint8_t buf[151] = {0};

  uint8_t topic_bytes[] = {0xc,  0x51, 0x83, 0xca, 0x15, 0x4,  0x54, 0xcc, 0xe2, 0xae, 0xbd,
                           0x37, 0x32, 0x77, 0x88, 0x3,  0x8e, 0x49, 0xa6, 0x29, 0x89, 0x2a};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x94, 0x86, 0xbd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytes0[] = {0xf4, 0xf1, 0xd5, 0x64, 0xc9, 0x8e, 0xa9, 0x4a, 0xec, 0xa5, 0xe5, 0x20, 0xf6,
                      0x85, 0xb1, 0x3,  0xf8, 0xba, 0xae, 0xf1, 0x65, 0xce, 0x8f, 0x8f, 0x69};
  uint8_t bytes2[] = {0x87, 0xd7, 0x24, 0x7f, 0x70, 0x8e, 0x42, 0x3f};
  uint8_t bytes1[] = {0x47, 0xcf, 0x25, 0x9,  0x6a, 0x7a, 0x18, 0xa2, 0x4f,
                      0xc2, 0xf6, 0x2d, 0x8b, 0x2a, 0x4f, 0x9,  0x61, 0x34};
  uint8_t bytes3[] = {0xf1, 0x21, 0x5e, 0xc, 0xc7, 0xac, 0x90, 0xc7, 0xd0};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12953}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22843}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24582}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2657}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytes1}, .v = {8, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18503}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytes3}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\186\EMG9\192\229\240\204\DC2o",
// _pubPktID = 0, _pubBody = "\166!\209#\147\&1%\222\235\133Gd\174=\SIf\247\215\US^6\b\r", _pubProps =
// [PropMaximumPacketSize 14608,PropServerKeepAlive 13002,PropContentType "\228 \ETX\252\187}P",PropTopicAlias
// 30258,PropUserProperty "\219UyW\v\EOT%\"\138{p\208{~\140\168wg\253" "
// Y\130\222\SYN3tx\NUL\232\&1\242\216_",PropServerKeepAlive 12368]}
TEST(Publish50QCTest, Encode6) {
  uint8_t pkt[] = {0x38, 0x62, 0x0,  0xa,  0xba, 0x19, 0x47, 0x39, 0xc0, 0xe5, 0xf0, 0xcc, 0x12, 0x6f, 0x3e, 0x27, 0x0,
                   0x0,  0x39, 0x10, 0x13, 0x32, 0xca, 0x3,  0x0,  0x7,  0xe4, 0x20, 0x3,  0xfc, 0xbb, 0x7d, 0x50, 0x23,
                   0x76, 0x32, 0x26, 0x0,  0x13, 0xdb, 0x55, 0x79, 0x57, 0xb,  0x4,  0x25, 0x22, 0x8a, 0x7b, 0x70, 0xd0,
                   0x7b, 0x7e, 0x8c, 0xa8, 0x77, 0x67, 0xfd, 0x0,  0xe,  0x20, 0x59, 0x82, 0xde, 0x16, 0x33, 0x74, 0x78,
                   0x0,  0xe8, 0x31, 0xf2, 0xd8, 0x5f, 0x13, 0x30, 0x50, 0xa6, 0x21, 0xd1, 0x23, 0x93, 0x31, 0x25, 0xde,
                   0xeb, 0x85, 0x47, 0x64, 0xae, 0x3d, 0xf,  0x66, 0xf7, 0xd7, 0x1f, 0x5e, 0x36, 0x8,  0xd};

  uint8_t buf[110] = {0};

  uint8_t topic_bytes[] = {0xba, 0x19, 0x47, 0x39, 0xc0, 0xe5, 0xf0, 0xcc, 0x12, 0x6f};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0x21, 0xd1, 0x23, 0x93, 0x31, 0x25, 0xde, 0xeb, 0x85, 0x47, 0x64,
                         0xae, 0x3d, 0xf,  0x66, 0xf7, 0xd7, 0x1f, 0x5e, 0x36, 0x8,  0xd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytes0[] = {0xe4, 0x20, 0x3, 0xfc, 0xbb, 0x7d, 0x50};
  uint8_t bytes2[] = {0x20, 0x59, 0x82, 0xde, 0x16, 0x33, 0x74, 0x78, 0x0, 0xe8, 0x31, 0xf2, 0xd8, 0x5f};
  uint8_t bytes1[] = {0xdb, 0x55, 0x79, 0x57, 0xb,  0x4,  0x25, 0x22, 0x8a, 0x7b,
                      0x70, 0xd0, 0x7b, 0x7e, 0x8c, 0xa8, 0x77, 0x67, 0xfd};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14608}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13002}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30258}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytes1}, .v = {14, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12368}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\249\r\220\v\234\SOH\157\DC1_\145mx\199\189\136\241\241\184\225\ETX\132\GS\231\210\133\RS\r", _pubPktID = 32631,
// _pubBody = "\145\209\172\139\202&x\240\162\148\\U", _pubProps = [PropAuthenticationData
// "z\187\227b\SO\153e",PropSubscriptionIdentifier 1,PropContentType
// "\219\250L\140\ETX\177\238\144\157,\130\236\142\252\249\130g\199\246\248#\176\248x\179\161",PropContentType
// "\178c\180s\128I_\202\t9p\131\141\254\151",PropWildcardSubscriptionAvailable 154,PropTopicAliasMaximum
// 18494,PropCorrelationData "\SIc\230\n\143\128\EOT\194\182=\154R",PropSubscriptionIdentifier 30,PropContentType
// "\207TS\133\FS\211%\242\EM\161\EM\183\219",PropWildcardSubscriptionAvailable 9,PropMaximumQoS 120,PropServerKeepAlive
// 6661,PropUserProperty "\189\208X\237]Q\187F\166P8i\156l\138\255\179\237y" "d\154[\167SH",PropReasonString "\172
// \193V\203\250\230J\151x\209\&9$_\235\150\189O\222\234\129\SYNq",PropRequestResponseInformation
// 71,PropSubscriptionIdentifierAvailable 63,PropResponseInformation
// "\253C\233\219W\193H\130\192\237a\236\254\165\239\ETX\233\248\221\234\231LU\230",PropReasonString
// "\129\209\178\&1\142\RSd",PropMessageExpiryInterval 19943,PropMessageExpiryInterval 21658,PropServerKeepAlive
// 10194,PropMessageExpiryInterval 12759,PropReceiveMaximum 6676,PropResponseTopic
// "\215\&4\214\ETX@A\228\251R\154\254y"]}
TEST(Publish50QCTest, Encode7) {
  uint8_t pkt[] = {
      0x33, 0x9a, 0x2,  0x0,  0x1b, 0xf9, 0xd,  0xdc, 0xb,  0xea, 0x1,  0x9d, 0x11, 0x5f, 0x91, 0x6d, 0x78, 0xc7, 0xbd,
      0x88, 0xf1, 0xf1, 0xb8, 0xe1, 0x3,  0x84, 0x1d, 0xe7, 0xd2, 0x85, 0x1e, 0xd,  0x7f, 0x77, 0xed, 0x1,  0x16, 0x0,
      0x7,  0x7a, 0xbb, 0xe3, 0x62, 0xe,  0x99, 0x65, 0xb,  0x1,  0x3,  0x0,  0x1a, 0xdb, 0xfa, 0x4c, 0x8c, 0x3,  0xb1,
      0xee, 0x90, 0x9d, 0x2c, 0x82, 0xec, 0x8e, 0xfc, 0xf9, 0x82, 0x67, 0xc7, 0xf6, 0xf8, 0x23, 0xb0, 0xf8, 0x78, 0xb3,
      0xa1, 0x3,  0x0,  0xf,  0xb2, 0x63, 0xb4, 0x73, 0x80, 0x49, 0x5f, 0xca, 0x9,  0x39, 0x70, 0x83, 0x8d, 0xfe, 0x97,
      0x28, 0x9a, 0x22, 0x48, 0x3e, 0x9,  0x0,  0xc,  0xf,  0x63, 0xe6, 0xa,  0x8f, 0x80, 0x4,  0xc2, 0xb6, 0x3d, 0x9a,
      0x52, 0xb,  0x1e, 0x3,  0x0,  0xd,  0xcf, 0x54, 0x53, 0x85, 0x1c, 0xd3, 0x25, 0xf2, 0x19, 0xa1, 0x19, 0xb7, 0xdb,
      0x28, 0x9,  0x24, 0x78, 0x13, 0x1a, 0x5,  0x26, 0x0,  0x13, 0xbd, 0xd0, 0x58, 0xed, 0x5d, 0x51, 0xbb, 0x46, 0xa6,
      0x50, 0x38, 0x69, 0x9c, 0x6c, 0x8a, 0xff, 0xb3, 0xed, 0x79, 0x0,  0x6,  0x64, 0x9a, 0x5b, 0xa7, 0x53, 0x48, 0x1f,
      0x0,  0x17, 0xac, 0x20, 0xc1, 0x56, 0xcb, 0xfa, 0xe6, 0x4a, 0x97, 0x78, 0xd1, 0x39, 0x24, 0x5f, 0xeb, 0x96, 0xbd,
      0x4f, 0xde, 0xea, 0x81, 0x16, 0x71, 0x19, 0x47, 0x29, 0x3f, 0x1a, 0x0,  0x18, 0xfd, 0x43, 0xe9, 0xdb, 0x57, 0xc1,
      0x48, 0x82, 0xc0, 0xed, 0x61, 0xec, 0xfe, 0xa5, 0xef, 0x3,  0xe9, 0xf8, 0xdd, 0xea, 0xe7, 0x4c, 0x55, 0xe6, 0x1f,
      0x0,  0x7,  0x81, 0xd1, 0xb2, 0x31, 0x8e, 0x1e, 0x64, 0x2,  0x0,  0x0,  0x4d, 0xe7, 0x2,  0x0,  0x0,  0x54, 0x9a,
      0x13, 0x27, 0xd2, 0x2,  0x0,  0x0,  0x31, 0xd7, 0x21, 0x1a, 0x14, 0x8,  0x0,  0xc,  0xd7, 0x34, 0xd6, 0x3,  0x40,
      0x41, 0xe4, 0xfb, 0x52, 0x9a, 0xfe, 0x79, 0x91, 0xd1, 0xac, 0x8b, 0xca, 0x26, 0x78, 0xf0, 0xa2, 0x94, 0x5c, 0x55};

  uint8_t buf[295] = {0};

  uint8_t topic_bytes[] = {0xf9, 0xd,  0xdc, 0xb,  0xea, 0x1, 0x9d, 0x11, 0x5f, 0x91, 0x6d, 0x78, 0xc7, 0xbd,
                           0x88, 0xf1, 0xf1, 0xb8, 0xe1, 0x3, 0x84, 0x1d, 0xe7, 0xd2, 0x85, 0x1e, 0xd};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x91, 0xd1, 0xac, 0x8b, 0xca, 0x26, 0x78, 0xf0, 0xa2, 0x94, 0x5c, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytes0[] = {0x7a, 0xbb, 0xe3, 0x62, 0xe, 0x99, 0x65};
  uint8_t bytes1[] = {0xdb, 0xfa, 0x4c, 0x8c, 0x3,  0xb1, 0xee, 0x90, 0x9d, 0x2c, 0x82, 0xec, 0x8e,
                      0xfc, 0xf9, 0x82, 0x67, 0xc7, 0xf6, 0xf8, 0x23, 0xb0, 0xf8, 0x78, 0xb3, 0xa1};
  uint8_t bytes2[] = {0xb2, 0x63, 0xb4, 0x73, 0x80, 0x49, 0x5f, 0xca, 0x9, 0x39, 0x70, 0x83, 0x8d, 0xfe, 0x97};
  uint8_t bytes3[] = {0xf, 0x63, 0xe6, 0xa, 0x8f, 0x80, 0x4, 0xc2, 0xb6, 0x3d, 0x9a, 0x52};
  uint8_t bytes4[] = {0xcf, 0x54, 0x53, 0x85, 0x1c, 0xd3, 0x25, 0xf2, 0x19, 0xa1, 0x19, 0xb7, 0xdb};
  uint8_t bytes6[] = {0x64, 0x9a, 0x5b, 0xa7, 0x53, 0x48};
  uint8_t bytes5[] = {0xbd, 0xd0, 0x58, 0xed, 0x5d, 0x51, 0xbb, 0x46, 0xa6, 0x50,
                      0x38, 0x69, 0x9c, 0x6c, 0x8a, 0xff, 0xb3, 0xed, 0x79};
  uint8_t bytes7[] = {0xac, 0x20, 0xc1, 0x56, 0xcb, 0xfa, 0xe6, 0x4a, 0x97, 0x78, 0xd1, 0x39,
                      0x24, 0x5f, 0xeb, 0x96, 0xbd, 0x4f, 0xde, 0xea, 0x81, 0x16, 0x71};
  uint8_t bytes8[] = {0xfd, 0x43, 0xe9, 0xdb, 0x57, 0xc1, 0x48, 0x82, 0xc0, 0xed, 0x61, 0xec,
                      0xfe, 0xa5, 0xef, 0x3,  0xe9, 0xf8, 0xdd, 0xea, 0xe7, 0x4c, 0x55, 0xe6};
  uint8_t bytes9[] = {0x81, 0xd1, 0xb2, 0x31, 0x8e, 0x1e, 0x64};
  uint8_t bytes10[] = {0xd7, 0x34, 0xd6, 0x3, 0x40, 0x41, 0xe4, 0xfb, 0x52, 0x9a, 0xfe, 0x79};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18494}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6661}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytes5}, .v = {6, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19943}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21658}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10194}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12759}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6676}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytes10}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 32631, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "b\213\SO\144\154E1Y", _pubPktID =
// 17459, _pubBody = "\197\176\151_P\DC4\162Y\176\178\tN}p\223\213\213\215\&9\208.dWr", _pubProps =
// [PropRequestProblemInformation 5,PropRequestResponseInformation 145,PropRetainAvailable
// 57,PropAssignedClientIdentifier "\134\178\128F\173\229\ESC\250l(\167\156\201\130\189\187\192}\153>\166\185\219
// sn\195\207",PropWillDelayInterval 10980,PropPayloadFormatIndicator 112,PropResponseInformation "XsO",PropUserProperty
// "<[\227'\208n\249\170\220\133#L\204\168*\198\155Sl\133\223\236\ENQ\152\RS" "\181\DC4\210):",PropSessionExpiryInterval
// 11656,PropUserProperty "\238<\162\202\&2\201-+J\DC1\225\GSt #*\129"
// "\248\222\212+T\180\FS5\netF\175\SOH\GS",PropRetainAvailable 182,PropResponseInformation
// "\221O|\ESCU\171\144\243\\\213\240\"\172X\250\176T",PropReasonString "\166G",PropTopicAliasMaximum
// 18131,PropRetainAvailable 21,PropReasonString "\178\DC4"]}
TEST(Publish50QCTest, Encode8) {
  uint8_t pkt[] = {
      0x35, 0xca, 0x1,  0x0,  0x8,  0x62, 0xd5, 0xe,  0x90, 0x9a, 0x45, 0x31, 0x59, 0x44, 0x33, 0xa4, 0x1,  0x17, 0x5,
      0x19, 0x91, 0x25, 0x39, 0x12, 0x0,  0x1c, 0x86, 0xb2, 0x80, 0x46, 0xad, 0xe5, 0x1b, 0xfa, 0x6c, 0x28, 0xa7, 0x9c,
      0xc9, 0x82, 0xbd, 0xbb, 0xc0, 0x7d, 0x99, 0x3e, 0xa6, 0xb9, 0xdb, 0x20, 0x73, 0x6e, 0xc3, 0xcf, 0x18, 0x0,  0x0,
      0x2a, 0xe4, 0x1,  0x70, 0x1a, 0x0,  0x3,  0x58, 0x73, 0x4f, 0x26, 0x0,  0x19, 0x3c, 0x5b, 0xe3, 0x27, 0xd0, 0x6e,
      0xf9, 0xaa, 0xdc, 0x85, 0x23, 0x4c, 0xcc, 0xa8, 0x2a, 0xc6, 0x9b, 0x53, 0x6c, 0x85, 0xdf, 0xec, 0x5,  0x98, 0x1e,
      0x0,  0x5,  0xb5, 0x14, 0xd2, 0x29, 0x3a, 0x11, 0x0,  0x0,  0x2d, 0x88, 0x26, 0x0,  0x11, 0xee, 0x3c, 0xa2, 0xca,
      0x32, 0xc9, 0x2d, 0x2b, 0x4a, 0x11, 0xe1, 0x1d, 0x74, 0x20, 0x23, 0x2a, 0x81, 0x0,  0xf,  0xf8, 0xde, 0xd4, 0x2b,
      0x54, 0xb4, 0x1c, 0x35, 0xa,  0x65, 0x74, 0x46, 0xaf, 0x1,  0x1d, 0x25, 0xb6, 0x1a, 0x0,  0x11, 0xdd, 0x4f, 0x7c,
      0x1b, 0x55, 0xab, 0x90, 0xf3, 0x5c, 0xd5, 0xf0, 0x22, 0xac, 0x58, 0xfa, 0xb0, 0x54, 0x1f, 0x0,  0x2,  0xa6, 0x47,
      0x22, 0x46, 0xd3, 0x25, 0x15, 0x1f, 0x0,  0x2,  0xb2, 0x14, 0xc5, 0xb0, 0x97, 0x5f, 0x50, 0x14, 0xa2, 0x59, 0xb0,
      0xb2, 0x9,  0x4e, 0x7d, 0x70, 0xdf, 0xd5, 0xd5, 0xd7, 0x39, 0xd0, 0x2e, 0x64, 0x57, 0x72};

  uint8_t buf[215] = {0};

  uint8_t topic_bytes[] = {0x62, 0xd5, 0xe, 0x90, 0x9a, 0x45, 0x31, 0x59};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc5, 0xb0, 0x97, 0x5f, 0x50, 0x14, 0xa2, 0x59, 0xb0, 0xb2, 0x9,  0x4e,
                         0x7d, 0x70, 0xdf, 0xd5, 0xd5, 0xd7, 0x39, 0xd0, 0x2e, 0x64, 0x57, 0x72};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0x86, 0xb2, 0x80, 0x46, 0xad, 0xe5, 0x1b, 0xfa, 0x6c, 0x28, 0xa7, 0x9c, 0xc9, 0x82,
                      0xbd, 0xbb, 0xc0, 0x7d, 0x99, 0x3e, 0xa6, 0xb9, 0xdb, 0x20, 0x73, 0x6e, 0xc3, 0xcf};
  uint8_t bytes1[] = {0x58, 0x73, 0x4f};
  uint8_t bytes3[] = {0xb5, 0x14, 0xd2, 0x29, 0x3a};
  uint8_t bytes2[] = {0x3c, 0x5b, 0xe3, 0x27, 0xd0, 0x6e, 0xf9, 0xaa, 0xdc, 0x85, 0x23, 0x4c, 0xcc,
                      0xa8, 0x2a, 0xc6, 0x9b, 0x53, 0x6c, 0x85, 0xdf, 0xec, 0x5,  0x98, 0x1e};
  uint8_t bytes5[] = {0xf8, 0xde, 0xd4, 0x2b, 0x54, 0xb4, 0x1c, 0x35, 0xa, 0x65, 0x74, 0x46, 0xaf, 0x1, 0x1d};
  uint8_t bytes4[] = {0xee, 0x3c, 0xa2, 0xca, 0x32, 0xc9, 0x2d, 0x2b, 0x4a,
                      0x11, 0xe1, 0x1d, 0x74, 0x20, 0x23, 0x2a, 0x81};
  uint8_t bytes6[] = {0xdd, 0x4f, 0x7c, 0x1b, 0x55, 0xab, 0x90, 0xf3, 0x5c,
                      0xd5, 0xf0, 0x22, 0xac, 0x58, 0xfa, 0xb0, 0x54};
  uint8_t bytes7[] = {0xa6, 0x47};
  uint8_t bytes8[] = {0xb2, 0x14};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10980}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytes2}, .v = {5, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11656}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytes4}, .v = {15, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18131}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytes8}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17459, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\222\129", _pubPktID = 4136,
// _pubBody = "\238\173\129\190\233\254\157\252\185\239@\147\192rs\143\219-\185\140j5\231\226Y\SYN+", _pubProps =
// [PropPayloadFormatIndicator 205,PropSubscriptionIdentifierAvailable 143,PropSharedSubscriptionAvailable
// 37,PropCorrelationData "\203\139a^G\132kL",PropMessageExpiryInterval 3837,PropRequestResponseInformation
// 130,PropRequestResponseInformation 238,PropAssignedClientIdentifier
// "B\DLE\132S\191\218s\135z\187\224\237\130\EOT\ETX\195\US\201\183R>>\SOHvk",PropServerKeepAlive
// 10975,PropTopicAliasMaximum 9324,PropTopicAliasMaximum 30282,PropUserProperty "\221
// v\t\168c,\173\157F\210\233\246\135" "",PropResponseTopic
// "\CAN\159=\DC2>\NAK\132\164\175\130\246\SO>'\187\218\141iF\204\EOT\232^\236{\154=y\135",PropMessageExpiryInterval
// 20998,PropMaximumPacketSize 30109,PropReceiveMaximum 18125,PropReceiveMaximum 19631,PropAuthenticationMethod
// "\211F`x\211\195`\197\211\198\192j\"\218\249\248\NAK",PropSessionExpiryInterval 4788,PropSessionExpiryInterval
// 10477,PropSubscriptionIdentifier 4,PropMaximumPacketSize 16320,PropAuthenticationData
// "\190.\238\220\NAK\230\180\156\228\134/\144\203\&0\b\231[B\129\197",PropPayloadFormatIndicator
// 44,PropSharedSubscriptionAvailable 141,PropRetainAvailable 213,PropRequestProblemInformation
// 147,PropWildcardSubscriptionAvailable 68]}
TEST(Publish50QCTest, Encode9) {
  uint8_t pkt[] = {
      0x35, 0xeb, 0x1,  0x0,  0x2,  0xde, 0x81, 0x10, 0x28, 0xc8, 0x1,  0x1,  0xcd, 0x29, 0x8f, 0x2a, 0x25, 0x9,  0x0,
      0x8,  0xcb, 0x8b, 0x61, 0x5e, 0x47, 0x84, 0x6b, 0x4c, 0x2,  0x0,  0x0,  0xe,  0xfd, 0x19, 0x82, 0x19, 0xee, 0x12,
      0x0,  0x19, 0x42, 0x10, 0x84, 0x53, 0xbf, 0xda, 0x73, 0x87, 0x7a, 0xbb, 0xe0, 0xed, 0x82, 0x4,  0x3,  0xc3, 0x1f,
      0xc9, 0xb7, 0x52, 0x3e, 0x3e, 0x1,  0x76, 0x6b, 0x13, 0x2a, 0xdf, 0x22, 0x24, 0x6c, 0x22, 0x76, 0x4a, 0x26, 0x0,
      0xe,  0xdd, 0x20, 0x76, 0x9,  0xa8, 0x63, 0x2c, 0xad, 0x9d, 0x46, 0xd2, 0xe9, 0xf6, 0x87, 0x0,  0x0,  0x8,  0x0,
      0x1d, 0x18, 0x9f, 0x3d, 0x12, 0x3e, 0x15, 0x84, 0xa4, 0xaf, 0x82, 0xf6, 0xe,  0x3e, 0x27, 0xbb, 0xda, 0x8d, 0x69,
      0x46, 0xcc, 0x4,  0xe8, 0x5e, 0xec, 0x7b, 0x9a, 0x3d, 0x79, 0x87, 0x2,  0x0,  0x0,  0x52, 0x6,  0x27, 0x0,  0x0,
      0x75, 0x9d, 0x21, 0x46, 0xcd, 0x21, 0x4c, 0xaf, 0x15, 0x0,  0x11, 0xd3, 0x46, 0x60, 0x78, 0xd3, 0xc3, 0x60, 0xc5,
      0xd3, 0xc6, 0xc0, 0x6a, 0x22, 0xda, 0xf9, 0xf8, 0x15, 0x11, 0x0,  0x0,  0x12, 0xb4, 0x11, 0x0,  0x0,  0x28, 0xed,
      0xb,  0x4,  0x27, 0x0,  0x0,  0x3f, 0xc0, 0x16, 0x0,  0x14, 0xbe, 0x2e, 0xee, 0xdc, 0x15, 0xe6, 0xb4, 0x9c, 0xe4,
      0x86, 0x2f, 0x90, 0xcb, 0x30, 0x8,  0xe7, 0x5b, 0x42, 0x81, 0xc5, 0x1,  0x2c, 0x2a, 0x8d, 0x25, 0xd5, 0x17, 0x93,
      0x28, 0x44, 0xee, 0xad, 0x81, 0xbe, 0xe9, 0xfe, 0x9d, 0xfc, 0xb9, 0xef, 0x40, 0x93, 0xc0, 0x72, 0x73, 0x8f, 0xdb,
      0x2d, 0xb9, 0x8c, 0x6a, 0x35, 0xe7, 0xe2, 0x59, 0x16, 0x2b};

  uint8_t buf[248] = {0};

  uint8_t topic_bytes[] = {0xde, 0x81};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xee, 0xad, 0x81, 0xbe, 0xe9, 0xfe, 0x9d, 0xfc, 0xb9, 0xef, 0x40, 0x93, 0xc0, 0x72,
                         0x73, 0x8f, 0xdb, 0x2d, 0xb9, 0x8c, 0x6a, 0x35, 0xe7, 0xe2, 0x59, 0x16, 0x2b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytes0[] = {0xcb, 0x8b, 0x61, 0x5e, 0x47, 0x84, 0x6b, 0x4c};
  uint8_t bytes1[] = {0x42, 0x10, 0x84, 0x53, 0xbf, 0xda, 0x73, 0x87, 0x7a, 0xbb, 0xe0, 0xed, 0x82,
                      0x4,  0x3,  0xc3, 0x1f, 0xc9, 0xb7, 0x52, 0x3e, 0x3e, 0x1,  0x76, 0x6b};
  uint8_t bytes3[] = {0};
  uint8_t bytes2[] = {0xdd, 0x20, 0x76, 0x9, 0xa8, 0x63, 0x2c, 0xad, 0x9d, 0x46, 0xd2, 0xe9, 0xf6, 0x87};
  uint8_t bytes4[] = {0x18, 0x9f, 0x3d, 0x12, 0x3e, 0x15, 0x84, 0xa4, 0xaf, 0x82, 0xf6, 0xe,  0x3e, 0x27, 0xbb,
                      0xda, 0x8d, 0x69, 0x46, 0xcc, 0x4,  0xe8, 0x5e, 0xec, 0x7b, 0x9a, 0x3d, 0x79, 0x87};
  uint8_t bytes5[] = {0xd3, 0x46, 0x60, 0x78, 0xd3, 0xc3, 0x60, 0xc5, 0xd3,
                      0xc6, 0xc0, 0x6a, 0x22, 0xda, 0xf9, 0xf8, 0x15};
  uint8_t bytes6[] = {0xbe, 0x2e, 0xee, 0xdc, 0x15, 0xe6, 0xb4, 0x9c, 0xe4, 0x86,
                      0x2f, 0x90, 0xcb, 0x30, 0x8,  0xe7, 0x5b, 0x42, 0x81, 0xc5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3837}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10975}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9324}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30282}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytes2}, .v = {0, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20998}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30109}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18125}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19631}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4788}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10477}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16320}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 4136, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "]Bpc\184\177\176\&3}-\DC4K", _pubProps = [PropRequestProblemInformation 126,PropAuthenticationMethod
// "\199^\140\147\247\203\131+\DLE\174\144\&8wN\203n\207qb\252\200\\\254\ACK`\220",PropWildcardSubscriptionAvailable
// 131,PropMaximumPacketSize 22048,PropRequestProblemInformation 6,PropTopicAlias 5382]}
TEST(Publish50QCTest, Encode10) {
  uint8_t pkt[] = {0x30, 0x3a, 0x0,  0x0,  0x2b, 0x17, 0x7e, 0x15, 0x0,  0x1a, 0xc7, 0x5e, 0x8c, 0x93, 0xf7,
                   0xcb, 0x83, 0x2b, 0x10, 0xae, 0x90, 0x38, 0x77, 0x4e, 0xcb, 0x6e, 0xcf, 0x71, 0x62, 0xfc,
                   0xc8, 0x5c, 0xfe, 0x6,  0x60, 0xdc, 0x28, 0x83, 0x27, 0x0,  0x0,  0x56, 0x20, 0x17, 0x6,
                   0x23, 0x15, 0x6,  0x5d, 0x42, 0x70, 0x63, 0xb8, 0xb1, 0xb0, 0x33, 0x7d, 0x2d, 0x14, 0x4b};

  uint8_t buf[70] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5d, 0x42, 0x70, 0x63, 0xb8, 0xb1, 0xb0, 0x33, 0x7d, 0x2d, 0x14, 0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytes0[] = {0xc7, 0x5e, 0x8c, 0x93, 0xf7, 0xcb, 0x83, 0x2b, 0x10, 0xae, 0x90, 0x38, 0x77,
                      0x4e, 0xcb, 0x6e, 0xcf, 0x71, 0x62, 0xfc, 0xc8, 0x5c, 0xfe, 0x6,  0x60, 0xdc};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22048}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5382}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "/u\181\175\201\CANO", _pubPktID = 0,
// _pubBody = "\234\204\242\217\131\187\a+\140\DC4NsE\f\166\DC1\206pf\ETB\150\193\138\249\166r\189-S\EOT", _pubProps =
// [PropSessionExpiryInterval 16505,PropUserProperty "h(<\233\b\r\183\168]n\190\204\149" "\228hW",PropTopicAliasMaximum
// 22742,PropWildcardSubscriptionAvailable 240,PropAssignedClientIdentifier
// "\133\169",PropSubscriptionIdentifierAvailable 158,PropPayloadFormatIndicator 141,PropSubscriptionIdentifierAvailable
// 8,PropTopicAlias 10002,PropReasonString "\144\205\ft\129\ETX=\129",PropWillDelayInterval 22357]}
TEST(Publish50QCTest, Encode11) {
  uint8_t pkt[] = {0x38, 0x65, 0x0,  0x7,  0x2f, 0x75, 0xb5, 0xaf, 0xc9, 0x18, 0x4f, 0x3d, 0x11, 0x0,  0x0,
                   0x40, 0x79, 0x26, 0x0,  0xd,  0x68, 0x28, 0x3c, 0xe9, 0x8,  0xd,  0xb7, 0xa8, 0x5d, 0x6e,
                   0xbe, 0xcc, 0x95, 0x0,  0x3,  0xe4, 0x68, 0x57, 0x22, 0x58, 0xd6, 0x28, 0xf0, 0x12, 0x0,
                   0x2,  0x85, 0xa9, 0x29, 0x9e, 0x1,  0x8d, 0x29, 0x8,  0x23, 0x27, 0x12, 0x1f, 0x0,  0x8,
                   0x90, 0xcd, 0xc,  0x74, 0x81, 0x3,  0x3d, 0x81, 0x18, 0x0,  0x0,  0x57, 0x55, 0xea, 0xcc,
                   0xf2, 0xd9, 0x83, 0xbb, 0x7,  0x2b, 0x8c, 0x14, 0x4e, 0x73, 0x45, 0xc,  0xa6, 0x11, 0xce,
                   0x70, 0x66, 0x17, 0x96, 0xc1, 0x8a, 0xf9, 0xa6, 0x72, 0xbd, 0x2d, 0x53, 0x4};

  uint8_t buf[113] = {0};

  uint8_t topic_bytes[] = {0x2f, 0x75, 0xb5, 0xaf, 0xc9, 0x18, 0x4f};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xea, 0xcc, 0xf2, 0xd9, 0x83, 0xbb, 0x7,  0x2b, 0x8c, 0x14, 0x4e, 0x73, 0x45, 0xc,  0xa6,
                         0x11, 0xce, 0x70, 0x66, 0x17, 0x96, 0xc1, 0x8a, 0xf9, 0xa6, 0x72, 0xbd, 0x2d, 0x53, 0x4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytes1[] = {0xe4, 0x68, 0x57};
  uint8_t bytes0[] = {0x68, 0x28, 0x3c, 0xe9, 0x8, 0xd, 0xb7, 0xa8, 0x5d, 0x6e, 0xbe, 0xcc, 0x95};
  uint8_t bytes2[] = {0x85, 0xa9};
  uint8_t bytes3[] = {0x90, 0xcd, 0xc, 0x74, 0x81, 0x3, 0x3d, 0x81};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16505}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytes0}, .v = {3, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22742}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10002}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22357}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "-\243H\202R\162w&\149\233\171\223",
// _pubPktID = 0, _pubBody = "\216\SO\135\ENQ\236\223\tG\203\177\ESC\132\135)\187", _pubProps = [PropReceiveMaximum
// 18550,PropTopicAlias 22808,PropMessageExpiryInterval 2858,PropTopicAliasMaximum 31551,PropServerReference
// "\209M\US;?\164H\186*",PropAssignedClientIdentifier
// ".\146\v\NUL\221V\216@cX=\149\167\138\178^\220\223\198\205",PropAssignedClientIdentifier
// "`W\160\157\191",PropSharedSubscriptionAvailable 115,PropRequestProblemInformation 221,PropRequestResponseInformation
// 228,PropRequestResponseInformation 219,PropSharedSubscriptionAvailable 151,PropSessionExpiryInterval
// 10566,PropAuthenticationData "\168DW\140&\184E\132\251a0ln\201",PropRequestResponseInformation
// 16,PropRequestResponseInformation 115,PropRetainAvailable 178,PropSubscriptionIdentifier
// 15,PropAssignedClientIdentifier
// "\240\EM\v\232\222\145\242\221\228\229\GS!\156\195\230\SOH@y\222r'n\195\159)\225",PropAuthenticationMethod
// "t\171\232\148",PropContentType "}\136\SUB\ENQ-jNG\137\241\EOT\198j\200>\171\177S\ETB",PropContentType
// "U\205E\175",PropRequestProblemInformation 90,PropSubscriptionIdentifierAvailable 152]}
TEST(Publish50QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0xc5, 0x1,  0x0,  0xc,  0x2d, 0xf3, 0x48, 0xca, 0x52, 0xa2, 0x77, 0x26, 0x95, 0xe9, 0xab, 0xdf,
                   0xa6, 0x1,  0x21, 0x48, 0x76, 0x23, 0x59, 0x18, 0x2,  0x0,  0x0,  0xb,  0x2a, 0x22, 0x7b, 0x3f, 0x1c,
                   0x0,  0x9,  0xd1, 0x4d, 0x1f, 0x3b, 0x3f, 0xa4, 0x48, 0xba, 0x2a, 0x12, 0x0,  0x14, 0x2e, 0x92, 0xb,
                   0x0,  0xdd, 0x56, 0xd8, 0x40, 0x63, 0x58, 0x3d, 0x95, 0xa7, 0x8a, 0xb2, 0x5e, 0xdc, 0xdf, 0xc6, 0xcd,
                   0x12, 0x0,  0x5,  0x60, 0x57, 0xa0, 0x9d, 0xbf, 0x2a, 0x73, 0x17, 0xdd, 0x19, 0xe4, 0x19, 0xdb, 0x2a,
                   0x97, 0x11, 0x0,  0x0,  0x29, 0x46, 0x16, 0x0,  0xe,  0xa8, 0x44, 0x57, 0x8c, 0x26, 0xb8, 0x45, 0x84,
                   0xfb, 0x61, 0x30, 0x6c, 0x6e, 0xc9, 0x19, 0x10, 0x19, 0x73, 0x25, 0xb2, 0xb,  0xf,  0x12, 0x0,  0x1a,
                   0xf0, 0x19, 0xb,  0xe8, 0xde, 0x91, 0xf2, 0xdd, 0xe4, 0xe5, 0x1d, 0x21, 0x9c, 0xc3, 0xe6, 0x1,  0x40,
                   0x79, 0xde, 0x72, 0x27, 0x6e, 0xc3, 0x9f, 0x29, 0xe1, 0x15, 0x0,  0x4,  0x74, 0xab, 0xe8, 0x94, 0x3,
                   0x0,  0x13, 0x7d, 0x88, 0x1a, 0x5,  0x2d, 0x6a, 0x4e, 0x47, 0x89, 0xf1, 0x4,  0xc6, 0x6a, 0xc8, 0x3e,
                   0xab, 0xb1, 0x53, 0x17, 0x3,  0x0,  0x4,  0x55, 0xcd, 0x45, 0xaf, 0x17, 0x5a, 0x29, 0x98, 0xd8, 0xe,
                   0x87, 0x5,  0xec, 0xdf, 0x9,  0x47, 0xcb, 0xb1, 0x1b, 0x84, 0x87, 0x29, 0xbb};

  uint8_t buf[210] = {0};

  uint8_t topic_bytes[] = {0x2d, 0xf3, 0x48, 0xca, 0x52, 0xa2, 0x77, 0x26, 0x95, 0xe9, 0xab, 0xdf};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0xe, 0x87, 0x5, 0xec, 0xdf, 0x9, 0x47, 0xcb, 0xb1, 0x1b, 0x84, 0x87, 0x29, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytes0[] = {0xd1, 0x4d, 0x1f, 0x3b, 0x3f, 0xa4, 0x48, 0xba, 0x2a};
  uint8_t bytes1[] = {0x2e, 0x92, 0xb,  0x0,  0xdd, 0x56, 0xd8, 0x40, 0x63, 0x58,
                      0x3d, 0x95, 0xa7, 0x8a, 0xb2, 0x5e, 0xdc, 0xdf, 0xc6, 0xcd};
  uint8_t bytes2[] = {0x60, 0x57, 0xa0, 0x9d, 0xbf};
  uint8_t bytes3[] = {0xa8, 0x44, 0x57, 0x8c, 0x26, 0xb8, 0x45, 0x84, 0xfb, 0x61, 0x30, 0x6c, 0x6e, 0xc9};
  uint8_t bytes4[] = {0xf0, 0x19, 0xb, 0xe8, 0xde, 0x91, 0xf2, 0xdd, 0xe4, 0xe5, 0x1d, 0x21, 0x9c,
                      0xc3, 0xe6, 0x1, 0x40, 0x79, 0xde, 0x72, 0x27, 0x6e, 0xc3, 0x9f, 0x29, 0xe1};
  uint8_t bytes5[] = {0x74, 0xab, 0xe8, 0x94};
  uint8_t bytes6[] = {0x7d, 0x88, 0x1a, 0x5,  0x2d, 0x6a, 0x4e, 0x47, 0x89, 0xf1,
                      0x4,  0xc6, 0x6a, 0xc8, 0x3e, 0xab, 0xb1, 0x53, 0x17};
  uint8_t bytes7[] = {0x55, 0xcd, 0x45, 0xaf};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18550}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22808}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2858}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31551}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10566}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "W\133\164\255\227+
// \229\201\165[q\DC25\225\242\160 >\bi", _pubPktID = 0, _pubBody = "", _pubProps = [PropSubscriptionIdentifierAvailable
// 214,PropRetainAvailable 23,PropWildcardSubscriptionAvailable 43,PropAuthenticationData
// "\157<\161\249\233\130",PropUserProperty "n*\177\220\176'\196\135\239a\129\133\166\175\SO#\167\238\SI\217\177"
// "\172K\211\132\226\&2\206\242\179>\244\244\237H\229\244d\247+]\a\177",PropServerReference
// "\ESCW\229\249)\243%\132\SI\136GvI\NAK",PropServerReference
// "\ACKH\235\240\213}\181?1\ACK\184\165\247\179\181\180\209",PropUserProperty
// "^8\DC1*\199/\166\208\172g$\161\210\160\217\\\f\DC2\181\254T"
// "\136o\140\255\237\&74\197\ETB\DEL\137\SO\r\222\US",PropMessageExpiryInterval 30944,PropTopicAlias
// 9769,PropAuthenticationData "\173\245\162\193C\249\t\DEL0#\236\142\175\149Y)\209\161\147\ETB",PropUserProperty
// "\t\148\136\138\241\ETX\198\CAN\130\147\186\148\171]\218I\DEL\158\174\&4\142"
// "Q\235&\DC2\159\DC1>\SYN\194\DC21\NAK\254\177#[\218\218Vb\159\197p<",PropSharedSubscriptionAvailable
// 111,PropMaximumQoS 156,PropAuthenticationData
// "d#p\253\181\237\190\v>&\DC1\150\193bE;\134\ENQ\181\198*]\207i",PropSessionExpiryInterval
// 18301,PropAuthenticationData "\152\168\ETX\\\222v%\252o\185\&9\184\&5\187",PropPayloadFormatIndicator
// 228,PropMaximumQoS 192,PropRetainAvailable 35,PropSubscriptionIdentifierAvailable 215,PropTopicAliasMaximum 19410]}
TEST(Publish50QCTest, Encode13) {
  uint8_t pkt[] = {
      0x30, 0xb7, 0x2,  0x0,  0x15, 0x57, 0x85, 0xa4, 0xff, 0xe3, 0x2b, 0x20, 0xe5, 0xc9, 0xa5, 0x5b, 0x71, 0x12, 0x35,
      0xe1, 0xf2, 0xa0, 0x20, 0x3e, 0x8,  0x69, 0x9e, 0x2,  0x29, 0xd6, 0x25, 0x17, 0x28, 0x2b, 0x16, 0x0,  0x6,  0x9d,
      0x3c, 0xa1, 0xf9, 0xe9, 0x82, 0x26, 0x0,  0x15, 0x6e, 0x2a, 0xb1, 0xdc, 0xb0, 0x27, 0xc4, 0x87, 0xef, 0x61, 0x81,
      0x85, 0xa6, 0xaf, 0xe,  0x23, 0xa7, 0xee, 0xf,  0xd9, 0xb1, 0x0,  0x16, 0xac, 0x4b, 0xd3, 0x84, 0xe2, 0x32, 0xce,
      0xf2, 0xb3, 0x3e, 0xf4, 0xf4, 0xed, 0x48, 0xe5, 0xf4, 0x64, 0xf7, 0x2b, 0x5d, 0x7,  0xb1, 0x1c, 0x0,  0xe,  0x1b,
      0x57, 0xe5, 0xf9, 0x29, 0xf3, 0x25, 0x84, 0xf,  0x88, 0x47, 0x76, 0x49, 0x15, 0x1c, 0x0,  0x11, 0x6,  0x48, 0xeb,
      0xf0, 0xd5, 0x7d, 0xb5, 0x3f, 0x31, 0x6,  0xb8, 0xa5, 0xf7, 0xb3, 0xb5, 0xb4, 0xd1, 0x26, 0x0,  0x15, 0x5e, 0x38,
      0x11, 0x2a, 0xc7, 0x2f, 0xa6, 0xd0, 0xac, 0x67, 0x24, 0xa1, 0xd2, 0xa0, 0xd9, 0x5c, 0xc,  0x12, 0xb5, 0xfe, 0x54,
      0x0,  0xf,  0x88, 0x6f, 0x8c, 0xff, 0xed, 0x37, 0x34, 0xc5, 0x17, 0x7f, 0x89, 0xe,  0xd,  0xde, 0x1f, 0x2,  0x0,
      0x0,  0x78, 0xe0, 0x23, 0x26, 0x29, 0x16, 0x0,  0x14, 0xad, 0xf5, 0xa2, 0xc1, 0x43, 0xf9, 0x9,  0x7f, 0x30, 0x23,
      0xec, 0x8e, 0xaf, 0x95, 0x59, 0x29, 0xd1, 0xa1, 0x93, 0x17, 0x26, 0x0,  0x15, 0x9,  0x94, 0x88, 0x8a, 0xf1, 0x3,
      0xc6, 0x18, 0x82, 0x93, 0xba, 0x94, 0xab, 0x5d, 0xda, 0x49, 0x7f, 0x9e, 0xae, 0x34, 0x8e, 0x0,  0x18, 0x51, 0xeb,
      0x26, 0x12, 0x9f, 0x11, 0x3e, 0x16, 0xc2, 0x12, 0x31, 0x15, 0xfe, 0xb1, 0x23, 0x5b, 0xda, 0xda, 0x56, 0x62, 0x9f,
      0xc5, 0x70, 0x3c, 0x2a, 0x6f, 0x24, 0x9c, 0x16, 0x0,  0x18, 0x64, 0x23, 0x70, 0xfd, 0xb5, 0xed, 0xbe, 0xb,  0x3e,
      0x26, 0x11, 0x96, 0xc1, 0x62, 0x45, 0x3b, 0x86, 0x5,  0xb5, 0xc6, 0x2a, 0x5d, 0xcf, 0x69, 0x11, 0x0,  0x0,  0x47,
      0x7d, 0x16, 0x0,  0xe,  0x98, 0xa8, 0x3,  0x5c, 0xde, 0x76, 0x25, 0xfc, 0x6f, 0xb9, 0x39, 0xb8, 0x35, 0xbb, 0x1,
      0xe4, 0x24, 0xc0, 0x25, 0x23, 0x29, 0xd7, 0x22, 0x4b, 0xd2};

  uint8_t buf[324] = {0};

  uint8_t topic_bytes[] = {0x57, 0x85, 0xa4, 0xff, 0xe3, 0x2b, 0x20, 0xe5, 0xc9, 0xa5, 0x5b,
                           0x71, 0x12, 0x35, 0xe1, 0xf2, 0xa0, 0x20, 0x3e, 0x8,  0x69};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytes0[] = {0x9d, 0x3c, 0xa1, 0xf9, 0xe9, 0x82};
  uint8_t bytes2[] = {0xac, 0x4b, 0xd3, 0x84, 0xe2, 0x32, 0xce, 0xf2, 0xb3, 0x3e, 0xf4,
                      0xf4, 0xed, 0x48, 0xe5, 0xf4, 0x64, 0xf7, 0x2b, 0x5d, 0x7,  0xb1};
  uint8_t bytes1[] = {0x6e, 0x2a, 0xb1, 0xdc, 0xb0, 0x27, 0xc4, 0x87, 0xef, 0x61, 0x81,
                      0x85, 0xa6, 0xaf, 0xe,  0x23, 0xa7, 0xee, 0xf,  0xd9, 0xb1};
  uint8_t bytes3[] = {0x1b, 0x57, 0xe5, 0xf9, 0x29, 0xf3, 0x25, 0x84, 0xf, 0x88, 0x47, 0x76, 0x49, 0x15};
  uint8_t bytes4[] = {0x6, 0x48, 0xeb, 0xf0, 0xd5, 0x7d, 0xb5, 0x3f, 0x31,
                      0x6, 0xb8, 0xa5, 0xf7, 0xb3, 0xb5, 0xb4, 0xd1};
  uint8_t bytes6[] = {0x88, 0x6f, 0x8c, 0xff, 0xed, 0x37, 0x34, 0xc5, 0x17, 0x7f, 0x89, 0xe, 0xd, 0xde, 0x1f};
  uint8_t bytes5[] = {0x5e, 0x38, 0x11, 0x2a, 0xc7, 0x2f, 0xa6, 0xd0, 0xac, 0x67, 0x24,
                      0xa1, 0xd2, 0xa0, 0xd9, 0x5c, 0xc,  0x12, 0xb5, 0xfe, 0x54};
  uint8_t bytes7[] = {0xad, 0xf5, 0xa2, 0xc1, 0x43, 0xf9, 0x9,  0x7f, 0x30, 0x23,
                      0xec, 0x8e, 0xaf, 0x95, 0x59, 0x29, 0xd1, 0xa1, 0x93, 0x17};
  uint8_t bytes9[] = {0x51, 0xeb, 0x26, 0x12, 0x9f, 0x11, 0x3e, 0x16, 0xc2, 0x12, 0x31, 0x15,
                      0xfe, 0xb1, 0x23, 0x5b, 0xda, 0xda, 0x56, 0x62, 0x9f, 0xc5, 0x70, 0x3c};
  uint8_t bytes8[] = {0x9,  0x94, 0x88, 0x8a, 0xf1, 0x3,  0xc6, 0x18, 0x82, 0x93, 0xba,
                      0x94, 0xab, 0x5d, 0xda, 0x49, 0x7f, 0x9e, 0xae, 0x34, 0x8e};
  uint8_t bytes10[] = {0x64, 0x23, 0x70, 0xfd, 0xb5, 0xed, 0xbe, 0xb,  0x3e, 0x26, 0x11, 0x96,
                       0xc1, 0x62, 0x45, 0x3b, 0x86, 0x5,  0xb5, 0xc6, 0x2a, 0x5d, 0xcf, 0x69};
  uint8_t bytes11[] = {0x98, 0xa8, 0x3, 0x5c, 0xde, 0x76, 0x25, 0xfc, 0x6f, 0xb9, 0x39, 0xb8, 0x35, 0xbb};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes1}, .v = {22, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes5}, .v = {15, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30944}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9769}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes8}, .v = {24, (char*)&bytes9}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18301}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytes11}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19410}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "R\227\143", _pubPktID = 0, _pubBody
// = "\199\n\253\247[u\151,J\129\t\179\246y0]\143\131\146\&4n*\175\136\&6\181\148Z\ETX", _pubProps =
// [PropSubscriptionIdentifier 9,PropWildcardSubscriptionAvailable 205,PropSubscriptionIdentifierAvailable
// 20,PropAuthenticationData "`\215\227\DC3k\194\228\153\&4\r\194\144Q\145\169\131m\DC1\205\213j",PropReasonString
// "=N\196\ETX\FSF\244\&1\160W\203\232|\\,\DC3\172{\254\198\&4Y\170?\156N\NUL",PropReceiveMaximum
// 5394,PropSubscriptionIdentifierAvailable 138,PropSharedSubscriptionAvailable 56,PropServerKeepAlive
// 18116,PropTopicAliasMaximum 27624,PropServerKeepAlive 14050,PropServerKeepAlive
// 27431,PropSubscriptionIdentifierAvailable 88,PropResponseTopic
// "%A\213je\227\&9\143\204\&9u_\162\163\185S\191\177\218",PropWildcardSubscriptionAvailable 46,PropReasonString
// "\186I\218\vN\219\220\201",PropContentType "\194n|\131\DC2c\175\141",PropAuthenticationData
// "/\150\178\178\171\234A\ETX\237\&1w\214\150H",PropSubscriptionIdentifier 21,PropServerKeepAlive
// 7628,PropMessageExpiryInterval 30833]}
TEST(Publish50QCTest, Encode14) {
  uint8_t pkt[] = {0x38, 0xbe, 0x1,  0x0,  0x3,  0x52, 0xe3, 0x8f, 0x9a, 0x1,  0xb,  0x9,  0x28, 0xcd, 0x29, 0x14, 0x16,
                   0x0,  0x15, 0x60, 0xd7, 0xe3, 0x13, 0x6b, 0xc2, 0xe4, 0x99, 0x34, 0xd,  0xc2, 0x90, 0x51, 0x91, 0xa9,
                   0x83, 0x6d, 0x11, 0xcd, 0xd5, 0x6a, 0x1f, 0x0,  0x1b, 0x3d, 0x4e, 0xc4, 0x3,  0x1c, 0x46, 0xf4, 0x31,
                   0xa0, 0x57, 0xcb, 0xe8, 0x7c, 0x5c, 0x2c, 0x13, 0xac, 0x7b, 0xfe, 0xc6, 0x34, 0x59, 0xaa, 0x3f, 0x9c,
                   0x4e, 0x0,  0x21, 0x15, 0x12, 0x29, 0x8a, 0x2a, 0x38, 0x13, 0x46, 0xc4, 0x22, 0x6b, 0xe8, 0x13, 0x36,
                   0xe2, 0x13, 0x6b, 0x27, 0x29, 0x58, 0x8,  0x0,  0x13, 0x25, 0x41, 0xd5, 0x6a, 0x65, 0xe3, 0x39, 0x8f,
                   0xcc, 0x39, 0x75, 0x5f, 0xa2, 0xa3, 0xb9, 0x53, 0xbf, 0xb1, 0xda, 0x28, 0x2e, 0x1f, 0x0,  0x8,  0xba,
                   0x49, 0xda, 0xb,  0x4e, 0xdb, 0xdc, 0xc9, 0x3,  0x0,  0x8,  0xc2, 0x6e, 0x7c, 0x83, 0x12, 0x63, 0xaf,
                   0x8d, 0x16, 0x0,  0xe,  0x2f, 0x96, 0xb2, 0xb2, 0xab, 0xea, 0x41, 0x3,  0xed, 0x31, 0x77, 0xd6, 0x96,
                   0x48, 0xb,  0x15, 0x13, 0x1d, 0xcc, 0x2,  0x0,  0x0,  0x78, 0x71, 0xc7, 0xa,  0xfd, 0xf7, 0x5b, 0x75,
                   0x97, 0x2c, 0x4a, 0x81, 0x9,  0xb3, 0xf6, 0x79, 0x30, 0x5d, 0x8f, 0x83, 0x92, 0x34, 0x6e, 0x2a, 0xaf,
                   0x88, 0x36, 0xb5, 0x94, 0x5a, 0x3};

  uint8_t buf[203] = {0};

  uint8_t topic_bytes[] = {0x52, 0xe3, 0x8f};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0xa,  0xfd, 0xf7, 0x5b, 0x75, 0x97, 0x2c, 0x4a, 0x81, 0x9,  0xb3, 0xf6, 0x79, 0x30,
                         0x5d, 0x8f, 0x83, 0x92, 0x34, 0x6e, 0x2a, 0xaf, 0x88, 0x36, 0xb5, 0x94, 0x5a, 0x3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytes0[] = {0x60, 0xd7, 0xe3, 0x13, 0x6b, 0xc2, 0xe4, 0x99, 0x34, 0xd, 0xc2,
                      0x90, 0x51, 0x91, 0xa9, 0x83, 0x6d, 0x11, 0xcd, 0xd5, 0x6a};
  uint8_t bytes1[] = {0x3d, 0x4e, 0xc4, 0x3,  0x1c, 0x46, 0xf4, 0x31, 0xa0, 0x57, 0xcb, 0xe8, 0x7c, 0x5c,
                      0x2c, 0x13, 0xac, 0x7b, 0xfe, 0xc6, 0x34, 0x59, 0xaa, 0x3f, 0x9c, 0x4e, 0x0};
  uint8_t bytes2[] = {0x25, 0x41, 0xd5, 0x6a, 0x65, 0xe3, 0x39, 0x8f, 0xcc, 0x39,
                      0x75, 0x5f, 0xa2, 0xa3, 0xb9, 0x53, 0xbf, 0xb1, 0xda};
  uint8_t bytes3[] = {0xba, 0x49, 0xda, 0xb, 0x4e, 0xdb, 0xdc, 0xc9};
  uint8_t bytes4[] = {0xc2, 0x6e, 0x7c, 0x83, 0x12, 0x63, 0xaf, 0x8d};
  uint8_t bytes5[] = {0x2f, 0x96, 0xb2, 0xb2, 0xab, 0xea, 0x41, 0x3, 0xed, 0x31, 0x77, 0xd6, 0x96, 0x48};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5394}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18116}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27624}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14050}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27431}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7628}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30833}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DEL-\129\&3\194M2T6\ETBV5_#\188$\131T\222\ESC\137\a.\147%b", _pubPktID = 0, _pubBody =
// "\v]\154\169\138\225f:\202\251\DLEgw{\243\150\155\DELc8", _pubProps = [PropWillDelayInterval 7111,PropReasonString
// "\171",PropReasonString "\200\&4\NAKs\227\170{r\135\203\DEL\148\USeA",PropTopicAliasMaximum
// 27837,PropRequestProblemInformation 228,PropMessageExpiryInterval 2640,PropMessageExpiryInterval
// 21020,PropAssignedClientIdentifier "z\208%_;\f\SO3\US\186[\220\191?A\214\162I\248\200\144\172J",PropServerKeepAlive
// 5972,PropSessionExpiryInterval 2704,PropReasonString
// "\"\242\156\182\173n\198\218\207\249\179\194\138\250\145\162y#",PropTopicAliasMaximum 9402,PropRetainAvailable
// 8,PropAssignedClientIdentifier "\167\175
// \144*\243/N\240p\139\237rMY^\128E\EM\SO_\151\SYN\208u]\181\212\190",PropSubscriptionIdentifier 5,PropReasonString
// "\155\254\128)\188\243\147\FS\239",PropServerReference
// "\EM(\162\209\GS\231\140\&3x\209\187\199E\144\201\213\154\252\248CF\226\&0\188\174]}",PropMaximumQoS 2]}
TEST(Publish50QCTest, Encode15) {
  uint8_t pkt[] = {0x30, 0xe6, 0x1,  0x0,  0x1a, 0x7f, 0x2d, 0x81, 0x33, 0xc2, 0x4d, 0x32, 0x54, 0x36, 0x17, 0x56, 0x35,
                   0x5f, 0x23, 0xbc, 0x24, 0x83, 0x54, 0xde, 0x1b, 0x89, 0x7,  0x2e, 0x93, 0x25, 0x62, 0xb4, 0x1,  0x18,
                   0x0,  0x0,  0x1b, 0xc7, 0x1f, 0x0,  0x1,  0xab, 0x1f, 0x0,  0xf,  0xc8, 0x34, 0x15, 0x73, 0xe3, 0xaa,
                   0x7b, 0x72, 0x87, 0xcb, 0x7f, 0x94, 0x1f, 0x65, 0x41, 0x22, 0x6c, 0xbd, 0x17, 0xe4, 0x2,  0x0,  0x0,
                   0xa,  0x50, 0x2,  0x0,  0x0,  0x52, 0x1c, 0x12, 0x0,  0x17, 0x7a, 0xd0, 0x25, 0x5f, 0x3b, 0xc,  0xe,
                   0x33, 0x1f, 0xba, 0x5b, 0xdc, 0xbf, 0x3f, 0x41, 0xd6, 0xa2, 0x49, 0xf8, 0xc8, 0x90, 0xac, 0x4a, 0x13,
                   0x17, 0x54, 0x11, 0x0,  0x0,  0xa,  0x90, 0x1f, 0x0,  0x12, 0x22, 0xf2, 0x9c, 0xb6, 0xad, 0x6e, 0xc6,
                   0xda, 0xcf, 0xf9, 0xb3, 0xc2, 0x8a, 0xfa, 0x91, 0xa2, 0x79, 0x23, 0x22, 0x24, 0xba, 0x25, 0x8,  0x12,
                   0x0,  0x1d, 0xa7, 0xaf, 0x20, 0x90, 0x2a, 0xf3, 0x2f, 0x4e, 0xf0, 0x70, 0x8b, 0xed, 0x72, 0x4d, 0x59,
                   0x5e, 0x80, 0x45, 0x19, 0xe,  0x5f, 0x97, 0x16, 0xd0, 0x75, 0x5d, 0xb5, 0xd4, 0xbe, 0xb,  0x5,  0x1f,
                   0x0,  0x9,  0x9b, 0xfe, 0x80, 0x29, 0xbc, 0xf3, 0x93, 0x1c, 0xef, 0x1c, 0x0,  0x1b, 0x19, 0x28, 0xa2,
                   0xd1, 0x1d, 0xe7, 0x8c, 0x33, 0x78, 0xd1, 0xbb, 0xc7, 0x45, 0x90, 0xc9, 0xd5, 0x9a, 0xfc, 0xf8, 0x43,
                   0x46, 0xe2, 0x30, 0xbc, 0xae, 0x5d, 0x7d, 0x24, 0x2,  0xb,  0x5d, 0x9a, 0xa9, 0x8a, 0xe1, 0x66, 0x3a,
                   0xca, 0xfb, 0x10, 0x67, 0x77, 0x7b, 0xf3, 0x96, 0x9b, 0x7f, 0x63, 0x38};

  uint8_t buf[243] = {0};

  uint8_t topic_bytes[] = {0x7f, 0x2d, 0x81, 0x33, 0xc2, 0x4d, 0x32, 0x54, 0x36, 0x17, 0x56, 0x35, 0x5f,
                           0x23, 0xbc, 0x24, 0x83, 0x54, 0xde, 0x1b, 0x89, 0x7,  0x2e, 0x93, 0x25, 0x62};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0x5d, 0x9a, 0xa9, 0x8a, 0xe1, 0x66, 0x3a, 0xca, 0xfb,
                         0x10, 0x67, 0x77, 0x7b, 0xf3, 0x96, 0x9b, 0x7f, 0x63, 0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytes0[] = {0xab};
  uint8_t bytes1[] = {0xc8, 0x34, 0x15, 0x73, 0xe3, 0xaa, 0x7b, 0x72, 0x87, 0xcb, 0x7f, 0x94, 0x1f, 0x65, 0x41};
  uint8_t bytes2[] = {0x7a, 0xd0, 0x25, 0x5f, 0x3b, 0xc,  0xe,  0x33, 0x1f, 0xba, 0x5b, 0xdc,
                      0xbf, 0x3f, 0x41, 0xd6, 0xa2, 0x49, 0xf8, 0xc8, 0x90, 0xac, 0x4a};
  uint8_t bytes3[] = {0x22, 0xf2, 0x9c, 0xb6, 0xad, 0x6e, 0xc6, 0xda, 0xcf,
                      0xf9, 0xb3, 0xc2, 0x8a, 0xfa, 0x91, 0xa2, 0x79, 0x23};
  uint8_t bytes4[] = {0xa7, 0xaf, 0x20, 0x90, 0x2a, 0xf3, 0x2f, 0x4e, 0xf0, 0x70, 0x8b, 0xed, 0x72, 0x4d, 0x59,
                      0x5e, 0x80, 0x45, 0x19, 0xe,  0x5f, 0x97, 0x16, 0xd0, 0x75, 0x5d, 0xb5, 0xd4, 0xbe};
  uint8_t bytes5[] = {0x9b, 0xfe, 0x80, 0x29, 0xbc, 0xf3, 0x93, 0x1c, 0xef};
  uint8_t bytes6[] = {0x19, 0x28, 0xa2, 0xd1, 0x1d, 0xe7, 0x8c, 0x33, 0x78, 0xd1, 0xbb, 0xc7, 0x45, 0x90,
                      0xc9, 0xd5, 0x9a, 0xfc, 0xf8, 0x43, 0x46, 0xe2, 0x30, 0xbc, 0xae, 0x5d, 0x7d};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7111}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27837}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2640}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21020}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5972}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2704}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9402}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 2}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\250\181\213\174\156\146\244\243\180\160\170=", _pubPktID = 24114, _pubBody =
// "\GS-\202|\237\STX\ENQ\EM\159\143\130\NAK\242\212\182Cg\172#\193\150v\226", _pubProps = [PropResponseInformation
// "O\196\178g\200\DEL*\ETX\SOH\203\FS\162\159\147\DC1(\164\128\203\&4Y*",PropServerReference
// "5\159n\242\179\fp\164\at",PropPayloadFormatIndicator 46,PropWillDelayInterval 4675,PropMaximumPacketSize
// 11858,PropCorrelationData "\219\221\206\252\181\220\196#}0\243y\ETB\ETBM7R\155u\197\239\242\198\209",PropMaximumQoS
// 169,PropAuthenticationData
// "\189]0\223\235\224P'\131He\\\STX<\172\192\202m\242\149^\ETX\ACK,\151",PropSubscriptionIdentifier
// 17,PropSubscriptionIdentifier 29,PropMaximumQoS 216,PropMaximumPacketSize 19820,PropServerKeepAlive 21055]}
TEST(Publish50QCTest, Encode16) {
  uint8_t pkt[] = {0x34, 0xa1, 0x1,  0x0,  0xc,  0xfa, 0xb5, 0xd5, 0xae, 0x9c, 0x92, 0xf4, 0xf3, 0xb4, 0xa0, 0xaa, 0x3d,
                   0x5e, 0x32, 0x79, 0x1a, 0x0,  0x16, 0x4f, 0xc4, 0xb2, 0x67, 0xc8, 0x7f, 0x2a, 0x3,  0x1,  0xcb, 0x1c,
                   0xa2, 0x9f, 0x93, 0x11, 0x28, 0xa4, 0x80, 0xcb, 0x34, 0x59, 0x2a, 0x1c, 0x0,  0xa,  0x35, 0x9f, 0x6e,
                   0xf2, 0xb3, 0xc,  0x70, 0xa4, 0x7,  0x74, 0x1,  0x2e, 0x18, 0x0,  0x0,  0x12, 0x43, 0x27, 0x0,  0x0,
                   0x2e, 0x52, 0x9,  0x0,  0x18, 0xdb, 0xdd, 0xce, 0xfc, 0xb5, 0xdc, 0xc4, 0x23, 0x7d, 0x30, 0xf3, 0x79,
                   0x17, 0x17, 0x4d, 0x37, 0x52, 0x9b, 0x75, 0xc5, 0xef, 0xf2, 0xc6, 0xd1, 0x24, 0xa9, 0x16, 0x0,  0x19,
                   0xbd, 0x5d, 0x30, 0xdf, 0xeb, 0xe0, 0x50, 0x27, 0x83, 0x48, 0x65, 0x5c, 0x2,  0x3c, 0xac, 0xc0, 0xca,
                   0x6d, 0xf2, 0x95, 0x5e, 0x3,  0x6,  0x2c, 0x97, 0xb,  0x11, 0xb,  0x1d, 0x24, 0xd8, 0x27, 0x0,  0x0,
                   0x4d, 0x6c, 0x13, 0x52, 0x3f, 0x1d, 0x2d, 0xca, 0x7c, 0xed, 0x2,  0x5,  0x19, 0x9f, 0x8f, 0x82, 0x15,
                   0xf2, 0xd4, 0xb6, 0x43, 0x67, 0xac, 0x23, 0xc1, 0x96, 0x76, 0xe2};

  uint8_t buf[174] = {0};

  uint8_t topic_bytes[] = {0xfa, 0xb5, 0xd5, 0xae, 0x9c, 0x92, 0xf4, 0xf3, 0xb4, 0xa0, 0xaa, 0x3d};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1d, 0x2d, 0xca, 0x7c, 0xed, 0x2,  0x5,  0x19, 0x9f, 0x8f, 0x82, 0x15,
                         0xf2, 0xd4, 0xb6, 0x43, 0x67, 0xac, 0x23, 0xc1, 0x96, 0x76, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytes0[] = {0x4f, 0xc4, 0xb2, 0x67, 0xc8, 0x7f, 0x2a, 0x3,  0x1,  0xcb, 0x1c,
                      0xa2, 0x9f, 0x93, 0x11, 0x28, 0xa4, 0x80, 0xcb, 0x34, 0x59, 0x2a};
  uint8_t bytes1[] = {0x35, 0x9f, 0x6e, 0xf2, 0xb3, 0xc, 0x70, 0xa4, 0x7, 0x74};
  uint8_t bytes2[] = {0xdb, 0xdd, 0xce, 0xfc, 0xb5, 0xdc, 0xc4, 0x23, 0x7d, 0x30, 0xf3, 0x79,
                      0x17, 0x17, 0x4d, 0x37, 0x52, 0x9b, 0x75, 0xc5, 0xef, 0xf2, 0xc6, 0xd1};
  uint8_t bytes3[] = {0xbd, 0x5d, 0x30, 0xdf, 0xeb, 0xe0, 0x50, 0x27, 0x83, 0x48, 0x65, 0x5c, 0x2,
                      0x3c, 0xac, 0xc0, 0xca, 0x6d, 0xf2, 0x95, 0x5e, 0x3,  0x6,  0x2c, 0x97};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4675}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11858}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19820}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21055}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24114, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "K\128\243a\178\253\219\184\171;*\244\172'5\EMTE\CAN", _pubPktID = 30980, _pubBody = "c\SUB\219{", _pubProps =
// [PropAuthenticationMethod
// "\199\134\152\&6\187\NAK\133\163\179~@Y[\174&\ty\249X\225w\FS\233I\169",PropAuthenticationMethod
// ">\148\231J\209\131\155\194",PropCorrelationData
// "\187\SYNbg\CAN\237\170\148\218f[\237\223O]d|\DEL\225$J",PropServerKeepAlive 27234,PropAuthenticationMethod
// "q\163e\227C0\SUB",PropTopicAliasMaximum 12959,PropSessionExpiryInterval 4732,PropSessionExpiryInterval
// 30800,PropSubscriptionIdentifierAvailable 78,PropMessageExpiryInterval 29659,PropAuthenticationData
// "\207CIS\172\137X^\145^\ACK\200\"+\200\176\b\225\161\DC2",PropResponseInformation
// "J\213h\132",PropSessionExpiryInterval 16307,PropTopicAliasMaximum 7071,PropSubscriptionIdentifier
// 27,PropAssignedClientIdentifier "\160'\ACK\239\137!\211\CAN{?\133\228j\ETB\ENQkDxZ\131E",PropWillDelayInterval
// 22702,PropMessageExpiryInterval 11660,PropTopicAlias 26640,PropUserProperty
// "\b\SUB\v&'u\133K\210\206o\138d\136\189\&9@)\146u\149\244\&3f\181"
// "\238\227|x\222\246\STX=\DC3w{\SOH\211",PropTopicAlias 29877,PropResponseInformation
// "\200\188\219\154\NAKM\173\191\254I\\S",PropRequestResponseInformation 139,PropRequestResponseInformation
// 199,PropResponseTopic "\DC3\ETXh\253\&0\235g\DC4s\163E\132k\203\190\139\150\232,\169\178\DC3\ETB\215\162&\172\169"]}
TEST(Publish50QCTest, Encode17) {
  uint8_t pkt[] = {
      0x3b, 0xaa, 0x2,  0x0,  0x13, 0x4b, 0x80, 0xf3, 0x61, 0xb2, 0xfd, 0xdb, 0xb8, 0xab, 0x3b, 0x2a, 0xf4, 0xac, 0x27,
      0x35, 0x19, 0x54, 0x45, 0x18, 0x79, 0x4,  0x8d, 0x2,  0x15, 0x0,  0x19, 0xc7, 0x86, 0x98, 0x36, 0xbb, 0x15, 0x85,
      0xa3, 0xb3, 0x7e, 0x40, 0x59, 0x5b, 0xae, 0x26, 0x9,  0x79, 0xf9, 0x58, 0xe1, 0x77, 0x1c, 0xe9, 0x49, 0xa9, 0x15,
      0x0,  0x8,  0x3e, 0x94, 0xe7, 0x4a, 0xd1, 0x83, 0x9b, 0xc2, 0x9,  0x0,  0x15, 0xbb, 0x16, 0x62, 0x67, 0x18, 0xed,
      0xaa, 0x94, 0xda, 0x66, 0x5b, 0xed, 0xdf, 0x4f, 0x5d, 0x64, 0x7c, 0x7f, 0xe1, 0x24, 0x4a, 0x13, 0x6a, 0x62, 0x15,
      0x0,  0x7,  0x71, 0xa3, 0x65, 0xe3, 0x43, 0x30, 0x1a, 0x22, 0x32, 0x9f, 0x11, 0x0,  0x0,  0x12, 0x7c, 0x11, 0x0,
      0x0,  0x78, 0x50, 0x29, 0x4e, 0x2,  0x0,  0x0,  0x73, 0xdb, 0x16, 0x0,  0x14, 0xcf, 0x43, 0x49, 0x53, 0xac, 0x89,
      0x58, 0x5e, 0x91, 0x5e, 0x6,  0xc8, 0x22, 0x2b, 0xc8, 0xb0, 0x8,  0xe1, 0xa1, 0x12, 0x1a, 0x0,  0x4,  0x4a, 0xd5,
      0x68, 0x84, 0x11, 0x0,  0x0,  0x3f, 0xb3, 0x22, 0x1b, 0x9f, 0xb,  0x1b, 0x12, 0x0,  0x15, 0xa0, 0x27, 0x6,  0xef,
      0x89, 0x21, 0xd3, 0x18, 0x7b, 0x3f, 0x85, 0xe4, 0x6a, 0x17, 0x5,  0x6b, 0x44, 0x78, 0x5a, 0x83, 0x45, 0x18, 0x0,
      0x0,  0x58, 0xae, 0x2,  0x0,  0x0,  0x2d, 0x8c, 0x23, 0x68, 0x10, 0x26, 0x0,  0x19, 0x8,  0x1a, 0xb,  0x26, 0x27,
      0x75, 0x85, 0x4b, 0xd2, 0xce, 0x6f, 0x8a, 0x64, 0x88, 0xbd, 0x39, 0x40, 0x29, 0x92, 0x75, 0x95, 0xf4, 0x33, 0x66,
      0xb5, 0x0,  0xd,  0xee, 0xe3, 0x7c, 0x78, 0xde, 0xf6, 0x2,  0x3d, 0x13, 0x77, 0x7b, 0x1,  0xd3, 0x23, 0x74, 0xb5,
      0x1a, 0x0,  0xc,  0xc8, 0xbc, 0xdb, 0x9a, 0x15, 0x4d, 0xad, 0xbf, 0xfe, 0x49, 0x5c, 0x53, 0x19, 0x8b, 0x19, 0xc7,
      0x8,  0x0,  0x1c, 0x13, 0x3,  0x68, 0xfd, 0x30, 0xeb, 0x67, 0x14, 0x73, 0xa3, 0x45, 0x84, 0x6b, 0xcb, 0xbe, 0x8b,
      0x96, 0xe8, 0x2c, 0xa9, 0xb2, 0x13, 0x17, 0xd7, 0xa2, 0x26, 0xac, 0xa9, 0x63, 0x1a, 0xdb, 0x7b};

  uint8_t buf[311] = {0};

  uint8_t topic_bytes[] = {0x4b, 0x80, 0xf3, 0x61, 0xb2, 0xfd, 0xdb, 0xb8, 0xab, 0x3b,
                           0x2a, 0xf4, 0xac, 0x27, 0x35, 0x19, 0x54, 0x45, 0x18};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x63, 0x1a, 0xdb, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytes0[] = {0xc7, 0x86, 0x98, 0x36, 0xbb, 0x15, 0x85, 0xa3, 0xb3, 0x7e, 0x40, 0x59, 0x5b,
                      0xae, 0x26, 0x9,  0x79, 0xf9, 0x58, 0xe1, 0x77, 0x1c, 0xe9, 0x49, 0xa9};
  uint8_t bytes1[] = {0x3e, 0x94, 0xe7, 0x4a, 0xd1, 0x83, 0x9b, 0xc2};
  uint8_t bytes2[] = {0xbb, 0x16, 0x62, 0x67, 0x18, 0xed, 0xaa, 0x94, 0xda, 0x66, 0x5b,
                      0xed, 0xdf, 0x4f, 0x5d, 0x64, 0x7c, 0x7f, 0xe1, 0x24, 0x4a};
  uint8_t bytes3[] = {0x71, 0xa3, 0x65, 0xe3, 0x43, 0x30, 0x1a};
  uint8_t bytes4[] = {0xcf, 0x43, 0x49, 0x53, 0xac, 0x89, 0x58, 0x5e, 0x91, 0x5e,
                      0x6,  0xc8, 0x22, 0x2b, 0xc8, 0xb0, 0x8,  0xe1, 0xa1, 0x12};
  uint8_t bytes5[] = {0x4a, 0xd5, 0x68, 0x84};
  uint8_t bytes6[] = {0xa0, 0x27, 0x6,  0xef, 0x89, 0x21, 0xd3, 0x18, 0x7b, 0x3f, 0x85,
                      0xe4, 0x6a, 0x17, 0x5,  0x6b, 0x44, 0x78, 0x5a, 0x83, 0x45};
  uint8_t bytes8[] = {0xee, 0xe3, 0x7c, 0x78, 0xde, 0xf6, 0x2, 0x3d, 0x13, 0x77, 0x7b, 0x1, 0xd3};
  uint8_t bytes7[] = {0x8,  0x1a, 0xb,  0x26, 0x27, 0x75, 0x85, 0x4b, 0xd2, 0xce, 0x6f, 0x8a, 0x64,
                      0x88, 0xbd, 0x39, 0x40, 0x29, 0x92, 0x75, 0x95, 0xf4, 0x33, 0x66, 0xb5};
  uint8_t bytes9[] = {0xc8, 0xbc, 0xdb, 0x9a, 0x15, 0x4d, 0xad, 0xbf, 0xfe, 0x49, 0x5c, 0x53};
  uint8_t bytes10[] = {0x13, 0x3,  0x68, 0xfd, 0x30, 0xeb, 0x67, 0x14, 0x73, 0xa3, 0x45, 0x84, 0x6b, 0xcb,
                       0xbe, 0x8b, 0x96, 0xe8, 0x2c, 0xa9, 0xb2, 0x13, 0x17, 0xd7, 0xa2, 0x26, 0xac, 0xa9};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27234}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12959}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4732}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30800}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29659}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16307}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7071}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22702}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11660}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26640}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytes7}, .v = {13, (char*)&bytes8}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29877}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytes10}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 30980, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "q\133\153L\176\219b\169Cy", _pubPktID
// = 0, _pubBody = "R\253\227\&8\219\234\CANi\174R\250\248\234\146G]X\252\NAK\167/\195\SUB:\GS\182-", _pubProps =
// [PropMessageExpiryInterval 19843,PropSubscriptionIdentifier 31,PropAssignedClientIdentifier
// "\142\128v\185Cql\255\206\&9",PropWildcardSubscriptionAvailable 230,PropMessageExpiryInterval
// 16053,PropWillDelayInterval 26161,PropCorrelationData
// "p\159M\SYN$\nt{\197\200~AN^\136",PropRequestResponseInformation 87,PropRequestResponseInformation 37,PropMaximumQoS
// 209]}
TEST(Publish50QCTest, Encode18) {
  uint8_t pkt[] = {0x39, 0x60, 0x0,  0xa,  0x71, 0x85, 0x99, 0x4c, 0xb0, 0xdb, 0x62, 0xa9, 0x43, 0x79, 0x38, 0x2,  0x0,
                   0x0,  0x4d, 0x83, 0xb,  0x1f, 0x12, 0x0,  0xa,  0x8e, 0x80, 0x76, 0xb9, 0x43, 0x71, 0x6c, 0xff, 0xce,
                   0x39, 0x28, 0xe6, 0x2,  0x0,  0x0,  0x3e, 0xb5, 0x18, 0x0,  0x0,  0x66, 0x31, 0x9,  0x0,  0xf,  0x70,
                   0x9f, 0x4d, 0x16, 0x24, 0xa,  0x74, 0x7b, 0xc5, 0xc8, 0x7e, 0x41, 0x4e, 0x5e, 0x88, 0x19, 0x57, 0x19,
                   0x25, 0x24, 0xd1, 0x52, 0xfd, 0xe3, 0x38, 0xdb, 0xea, 0x18, 0x69, 0xae, 0x52, 0xfa, 0xf8, 0xea, 0x92,
                   0x47, 0x5d, 0x58, 0xfc, 0x15, 0xa7, 0x2f, 0xc3, 0x1a, 0x3a, 0x1d, 0xb6, 0x2d};

  uint8_t buf[108] = {0};

  uint8_t topic_bytes[] = {0x71, 0x85, 0x99, 0x4c, 0xb0, 0xdb, 0x62, 0xa9, 0x43, 0x79};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x52, 0xfd, 0xe3, 0x38, 0xdb, 0xea, 0x18, 0x69, 0xae, 0x52, 0xfa, 0xf8, 0xea, 0x92,
                         0x47, 0x5d, 0x58, 0xfc, 0x15, 0xa7, 0x2f, 0xc3, 0x1a, 0x3a, 0x1d, 0xb6, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytes0[] = {0x8e, 0x80, 0x76, 0xb9, 0x43, 0x71, 0x6c, 0xff, 0xce, 0x39};
  uint8_t bytes1[] = {0x70, 0x9f, 0x4d, 0x16, 0x24, 0xa, 0x74, 0x7b, 0xc5, 0xc8, 0x7e, 0x41, 0x4e, 0x5e, 0x88};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19843}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16053}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26161}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 209}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DC2]^:\232\227~//\232\188z\183\183\&6\248\242", _pubPktID = 31614, _pubBody =
// "g\207\142Q\206\&8\FS#f]\154[\195\180\140FW\182\130\168\&6\191\251\b\214\&0\141", _pubProps = [PropReceiveMaximum
// 12957,PropRequestProblemInformation 52,PropSessionExpiryInterval 17481,PropMaximumQoS 8,PropResponseInformation
// "M\164\SUB\195\a\CAN4\193j\EM\RS\DC4\154\&1\129\200\168:\237\254D\NUL'\227",PropResponseTopic "",PropServerReference
// "'r\202\139\192\&0fnM\183\185",PropSharedSubscriptionAvailable 38,PropTopicAlias 13376,PropServerKeepAlive
// 17639,PropPayloadFormatIndicator 64]}
TEST(Publish50QCTest, Encode19) {
  uint8_t pkt[] = {0x3d, 0x73, 0x0,  0x11, 0x12, 0x5d, 0x5e, 0x3a, 0xe8, 0xe3, 0x7e, 0x2f, 0x2f, 0xe8, 0xbc, 0x7a, 0xb7,
                   0xb7, 0x36, 0xf8, 0xf2, 0x7b, 0x7e, 0x42, 0x21, 0x32, 0x9d, 0x17, 0x34, 0x11, 0x0,  0x0,  0x44, 0x49,
                   0x24, 0x8,  0x1a, 0x0,  0x18, 0x4d, 0xa4, 0x1a, 0xc3, 0x7,  0x18, 0x34, 0xc1, 0x6a, 0x19, 0x1e, 0x14,
                   0x9a, 0x31, 0x81, 0xc8, 0xa8, 0x3a, 0xed, 0xfe, 0x44, 0x0,  0x27, 0xe3, 0x8,  0x0,  0x0,  0x1c, 0x0,
                   0xb,  0x27, 0x72, 0xca, 0x8b, 0xc0, 0x30, 0x66, 0x6e, 0x4d, 0xb7, 0xb9, 0x2a, 0x26, 0x23, 0x34, 0x40,
                   0x13, 0x44, 0xe7, 0x1,  0x40, 0x67, 0xcf, 0x8e, 0x51, 0xce, 0x38, 0x1c, 0x23, 0x66, 0x5d, 0x9a, 0x5b,
                   0xc3, 0xb4, 0x8c, 0x46, 0x57, 0xb6, 0x82, 0xa8, 0x36, 0xbf, 0xfb, 0x8,  0xd6, 0x30, 0x8d};

  uint8_t buf[127] = {0};

  uint8_t topic_bytes[] = {0x12, 0x5d, 0x5e, 0x3a, 0xe8, 0xe3, 0x7e, 0x2f, 0x2f,
                           0xe8, 0xbc, 0x7a, 0xb7, 0xb7, 0x36, 0xf8, 0xf2};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x67, 0xcf, 0x8e, 0x51, 0xce, 0x38, 0x1c, 0x23, 0x66, 0x5d, 0x9a, 0x5b, 0xc3, 0xb4,
                         0x8c, 0x46, 0x57, 0xb6, 0x82, 0xa8, 0x36, 0xbf, 0xfb, 0x8,  0xd6, 0x30, 0x8d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytes0[] = {0x4d, 0xa4, 0x1a, 0xc3, 0x7,  0x18, 0x34, 0xc1, 0x6a, 0x19, 0x1e, 0x14,
                      0x9a, 0x31, 0x81, 0xc8, 0xa8, 0x3a, 0xed, 0xfe, 0x44, 0x0,  0x27, 0xe3};
  uint8_t bytes1[] = {0};
  uint8_t bytes2[] = {0x27, 0x72, 0xca, 0x8b, 0xc0, 0x30, 0x66, 0x6e, 0x4d, 0xb7, 0xb9};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12957}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17481}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13376}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17639}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 64}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 31614, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "y[U\202v\201A\203\136\164\190[\aZ\201\199", _pubPktID = 0, _pubBody = "`\132\CAN\206_pD[R", _pubProps =
// [PropAuthenticationMethod "",PropSubscriptionIdentifier 26,PropTopicAlias 17476,PropReasonString
// "\203\190Y\181\EM\141\216\248R\202\241Fz\153\US\210\233I9\215\226?\238\138\135\238}.",PropSubscriptionIdentifierAvailable
// 151,PropTopicAliasMaximum 576,PropPayloadFormatIndicator 141,PropServerKeepAlive 14965,PropServerReference
// ":\184\148`\218\f{\241\207=\135\198\NAK\166\ENQ\171\176\ETB7\170\&6\196\223\143\154$\249\v",PropWillDelayInterval
// 21964,PropReceiveMaximum 4625,PropAssignedClientIdentifier
// "R\159>E\186\154\156\&0\134\169\200\249\200G\FS^\248\144pX\215\221\228\STX",PropMessageExpiryInterval
// 14507,PropContentType "\253DY\"i\SOHX",PropTopicAlias 4812,PropResponseInformation
// "\142\147\150\140\167;v\247@\174\183\GS\158\187E\212\223m\RS\137 \US\223\197\EOT\228\245\229\230",PropServerKeepAlive
// 27938,PropRetainAvailable 180,PropResponseInformation "\193\241\144\240F5]\202",PropMaximumPacketSize
// 6869,PropRetainAvailable 172]}
TEST(Publish50QCTest, Encode20) {
  uint8_t pkt[] = {0x31, 0xd9, 0x1,  0x0,  0x10, 0x79, 0x5b, 0x55, 0xca, 0x76, 0xc9, 0x41, 0xcb, 0x88, 0xa4, 0xbe, 0x5b,
                   0x7,  0x5a, 0xc9, 0xc7, 0xbc, 0x1,  0x15, 0x0,  0x0,  0xb,  0x1a, 0x23, 0x44, 0x44, 0x1f, 0x0,  0x1c,
                   0xcb, 0xbe, 0x59, 0xb5, 0x19, 0x8d, 0xd8, 0xf8, 0x52, 0xca, 0xf1, 0x46, 0x7a, 0x99, 0x1f, 0xd2, 0xe9,
                   0x49, 0x39, 0xd7, 0xe2, 0x3f, 0xee, 0x8a, 0x87, 0xee, 0x7d, 0x2e, 0x29, 0x97, 0x22, 0x2,  0x40, 0x1,
                   0x8d, 0x13, 0x3a, 0x75, 0x1c, 0x0,  0x1c, 0x3a, 0xb8, 0x94, 0x60, 0xda, 0xc,  0x7b, 0xf1, 0xcf, 0x3d,
                   0x87, 0xc6, 0x15, 0xa6, 0x5,  0xab, 0xb0, 0x17, 0x37, 0xaa, 0x36, 0xc4, 0xdf, 0x8f, 0x9a, 0x24, 0xf9,
                   0xb,  0x18, 0x0,  0x0,  0x55, 0xcc, 0x21, 0x12, 0x11, 0x12, 0x0,  0x18, 0x52, 0x9f, 0x3e, 0x45, 0xba,
                   0x9a, 0x9c, 0x30, 0x86, 0xa9, 0xc8, 0xf9, 0xc8, 0x47, 0x1c, 0x5e, 0xf8, 0x90, 0x70, 0x58, 0xd7, 0xdd,
                   0xe4, 0x2,  0x2,  0x0,  0x0,  0x38, 0xab, 0x3,  0x0,  0x7,  0xfd, 0x44, 0x59, 0x22, 0x69, 0x1,  0x58,
                   0x23, 0x12, 0xcc, 0x1a, 0x0,  0x1d, 0x8e, 0x93, 0x96, 0x8c, 0xa7, 0x3b, 0x76, 0xf7, 0x40, 0xae, 0xb7,
                   0x1d, 0x9e, 0xbb, 0x45, 0xd4, 0xdf, 0x6d, 0x1e, 0x89, 0x20, 0x1f, 0xdf, 0xc5, 0x4,  0xe4, 0xf5, 0xe5,
                   0xe6, 0x13, 0x6d, 0x22, 0x25, 0xb4, 0x1a, 0x0,  0x8,  0xc1, 0xf1, 0x90, 0xf0, 0x46, 0x35, 0x5d, 0xca,
                   0x27, 0x0,  0x0,  0x1a, 0xd5, 0x25, 0xac, 0x60, 0x84, 0x18, 0xce, 0x5f, 0x70, 0x44, 0x5b, 0x52};

  uint8_t buf[230] = {0};

  uint8_t topic_bytes[] = {0x79, 0x5b, 0x55, 0xca, 0x76, 0xc9, 0x41, 0xcb,
                           0x88, 0xa4, 0xbe, 0x5b, 0x7,  0x5a, 0xc9, 0xc7};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0x84, 0x18, 0xce, 0x5f, 0x70, 0x44, 0x5b, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytes0[] = {0};
  uint8_t bytes1[] = {0xcb, 0xbe, 0x59, 0xb5, 0x19, 0x8d, 0xd8, 0xf8, 0x52, 0xca, 0xf1, 0x46, 0x7a, 0x99,
                      0x1f, 0xd2, 0xe9, 0x49, 0x39, 0xd7, 0xe2, 0x3f, 0xee, 0x8a, 0x87, 0xee, 0x7d, 0x2e};
  uint8_t bytes2[] = {0x3a, 0xb8, 0x94, 0x60, 0xda, 0xc,  0x7b, 0xf1, 0xcf, 0x3d, 0x87, 0xc6, 0x15, 0xa6,
                      0x5,  0xab, 0xb0, 0x17, 0x37, 0xaa, 0x36, 0xc4, 0xdf, 0x8f, 0x9a, 0x24, 0xf9, 0xb};
  uint8_t bytes3[] = {0x52, 0x9f, 0x3e, 0x45, 0xba, 0x9a, 0x9c, 0x30, 0x86, 0xa9, 0xc8, 0xf9,
                      0xc8, 0x47, 0x1c, 0x5e, 0xf8, 0x90, 0x70, 0x58, 0xd7, 0xdd, 0xe4, 0x2};
  uint8_t bytes4[] = {0xfd, 0x44, 0x59, 0x22, 0x69, 0x1, 0x58};
  uint8_t bytes5[] = {0x8e, 0x93, 0x96, 0x8c, 0xa7, 0x3b, 0x76, 0xf7, 0x40, 0xae, 0xb7, 0x1d, 0x9e, 0xbb, 0x45,
                      0xd4, 0xdf, 0x6d, 0x1e, 0x89, 0x20, 0x1f, 0xdf, 0xc5, 0x4,  0xe4, 0xf5, 0xe5, 0xe6};
  uint8_t bytes6[] = {0xc1, 0xf1, 0x90, 0xf0, 0x46, 0x35, 0x5d, 0xca};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17476}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 576}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14965}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21964}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4625}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14507}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4812}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27938}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6869}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 172}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "]\198\"\SUB3J\207\rX", _pubPktID =
// 0, _pubBody = "\132\170$!\216\174\202%\vC\188\240\ETB'b\DC1\134", _pubProps = [PropReasonString
// "\242\150\233\253t\128\ENQQR=\181q\164\&2\138\149x5\183\191i\150\206\SOH\130\202:\220\165",PropServerReference
// "\193\167\&6\DC3\205%\197T\206m\207]$\233f\169\250l\238\ETX\146\186\162\149\b",PropAuthenticationMethod
// "\235D",PropServerKeepAlive 7181]}
TEST(Publish50QCTest, Encode21) {
  uint8_t pkt[] = {0x30, 0x61, 0x0,  0x9,  0x5d, 0xc6, 0x22, 0x1a, 0x33, 0x4a, 0xcf, 0xd,  0x58, 0x44, 0x1f, 0x0,  0x1d,
                   0xf2, 0x96, 0xe9, 0xfd, 0x74, 0x80, 0x5,  0x51, 0x52, 0x3d, 0xb5, 0x71, 0xa4, 0x32, 0x8a, 0x95, 0x78,
                   0x35, 0xb7, 0xbf, 0x69, 0x96, 0xce, 0x1,  0x82, 0xca, 0x3a, 0xdc, 0xa5, 0x1c, 0x0,  0x19, 0xc1, 0xa7,
                   0x36, 0x13, 0xcd, 0x25, 0xc5, 0x54, 0xce, 0x6d, 0xcf, 0x5d, 0x24, 0xe9, 0x66, 0xa9, 0xfa, 0x6c, 0xee,
                   0x3,  0x92, 0xba, 0xa2, 0x95, 0x8,  0x15, 0x0,  0x2,  0xeb, 0x44, 0x13, 0x1c, 0xd,  0x84, 0xaa, 0x24,
                   0x21, 0xd8, 0xae, 0xca, 0x25, 0xb,  0x43, 0xbc, 0xf0, 0x17, 0x27, 0x62, 0x11, 0x86};

  uint8_t buf[109] = {0};

  uint8_t topic_bytes[] = {0x5d, 0xc6, 0x22, 0x1a, 0x33, 0x4a, 0xcf, 0xd, 0x58};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x84, 0xaa, 0x24, 0x21, 0xd8, 0xae, 0xca, 0x25, 0xb,
                         0x43, 0xbc, 0xf0, 0x17, 0x27, 0x62, 0x11, 0x86};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytes0[] = {0xf2, 0x96, 0xe9, 0xfd, 0x74, 0x80, 0x5,  0x51, 0x52, 0x3d, 0xb5, 0x71, 0xa4, 0x32, 0x8a,
                      0x95, 0x78, 0x35, 0xb7, 0xbf, 0x69, 0x96, 0xce, 0x1,  0x82, 0xca, 0x3a, 0xdc, 0xa5};
  uint8_t bytes1[] = {0xc1, 0xa7, 0x36, 0x13, 0xcd, 0x25, 0xc5, 0x54, 0xce, 0x6d, 0xcf, 0x5d, 0x24,
                      0xe9, 0x66, 0xa9, 0xfa, 0x6c, 0xee, 0x3,  0x92, 0xba, 0xa2, 0x95, 0x8};
  uint8_t bytes2[] = {0xeb, 0x44};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7181}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O&", _pubPktID = 13252, _pubBody =
// "\169\202l\203dz\202-l\161\226\155\212J@v\179", _pubProps = [PropTopicAlias 5304,PropContentType
// "\242\198\130%\ACK3\"\CAN\140\130\179\213\244\243'\233\186#\254\190\199\ETX\205_\214~\218\v\169\&7",PropPayloadFormatIndicator
// 145,PropRequestResponseInformation 129,PropMaximumQoS 20,PropSubscriptionIdentifierAvailable
// 213,PropRequestResponseInformation 30,PropReceiveMaximum 3053,PropPayloadFormatIndicator 10,PropResponseTopic
// "$\SYN\186A\163\197",PropServerReference "\180<)\225k\209u\147\175\&8",PropAuthenticationData
// "\195\130\223\198\139w\DEL\ETB\200k\251\254\234\255\174\"o\FS\233\RS\143",PropPayloadFormatIndicator
// 213,PropRequestResponseInformation 54,PropServerKeepAlive 5613,PropContentType
// "\209?}'\254m\153\215\146\243\201\251\144\SOH\RSQ\ESC \131E\163\SOH\227\GSI/\182B ",PropUserProperty
// "`\EOT-\149[m\210Z\160\154\142\f\NAK\138isz2\230^"
// "\178o\215\223\233\202\182\172\233\200K0U\135\143\197T\197{\FSQ\220",PropRequestResponseInformation
// 138,PropAuthenticationMethod
// "\147V\147\139z\NUL9j\DLE\219\225i!\220\143&\171\&8\188wF@]Y|\253`\FS",PropSessionExpiryInterval 2432]}
TEST(Publish50QCTest, Encode22) {
  uint8_t pkt[] = {0x35, 0xf6, 0x1,  0x0,  0x2,  0x4f, 0x26, 0x33, 0xc4, 0xdd, 0x1,  0x23, 0x14, 0xb8, 0x3,  0x0,  0x1e,
                   0xf2, 0xc6, 0x82, 0x25, 0x6,  0x33, 0x22, 0x18, 0x8c, 0x82, 0xb3, 0xd5, 0xf4, 0xf3, 0x27, 0xe9, 0xba,
                   0x23, 0xfe, 0xbe, 0xc7, 0x3,  0xcd, 0x5f, 0xd6, 0x7e, 0xda, 0xb,  0xa9, 0x37, 0x1,  0x91, 0x19, 0x81,
                   0x24, 0x14, 0x29, 0xd5, 0x19, 0x1e, 0x21, 0xb,  0xed, 0x1,  0xa,  0x8,  0x0,  0x6,  0x24, 0x16, 0xba,
                   0x41, 0xa3, 0xc5, 0x1c, 0x0,  0xa,  0xb4, 0x3c, 0x29, 0xe1, 0x6b, 0xd1, 0x75, 0x93, 0xaf, 0x38, 0x16,
                   0x0,  0x15, 0xc3, 0x82, 0xdf, 0xc6, 0x8b, 0x77, 0x7f, 0x17, 0xc8, 0x6b, 0xfb, 0xfe, 0xea, 0xff, 0xae,
                   0x22, 0x6f, 0x1c, 0xe9, 0x1e, 0x8f, 0x1,  0xd5, 0x19, 0x36, 0x13, 0x15, 0xed, 0x3,  0x0,  0x1d, 0xd1,
                   0x3f, 0x7d, 0x27, 0xfe, 0x6d, 0x99, 0xd7, 0x92, 0xf3, 0xc9, 0xfb, 0x90, 0x1,  0x1e, 0x51, 0x1b, 0x20,
                   0x83, 0x45, 0xa3, 0x1,  0xe3, 0x1d, 0x49, 0x2f, 0xb6, 0x42, 0x20, 0x26, 0x0,  0x14, 0x60, 0x4,  0x2d,
                   0x95, 0x5b, 0x6d, 0xd2, 0x5a, 0xa0, 0x9a, 0x8e, 0xc,  0x15, 0x8a, 0x69, 0x73, 0x7a, 0x32, 0xe6, 0x5e,
                   0x0,  0x16, 0xb2, 0x6f, 0xd7, 0xdf, 0xe9, 0xca, 0xb6, 0xac, 0xe9, 0xc8, 0x4b, 0x30, 0x55, 0x87, 0x8f,
                   0xc5, 0x54, 0xc5, 0x7b, 0x1c, 0x51, 0xdc, 0x19, 0x8a, 0x15, 0x0,  0x1c, 0x93, 0x56, 0x93, 0x8b, 0x7a,
                   0x0,  0x39, 0x6a, 0x10, 0xdb, 0xe1, 0x69, 0x21, 0xdc, 0x8f, 0x26, 0xab, 0x38, 0xbc, 0x77, 0x46, 0x40,
                   0x5d, 0x59, 0x7c, 0xfd, 0x60, 0x1c, 0x11, 0x0,  0x0,  0x9,  0x80, 0xa9, 0xca, 0x6c, 0xcb, 0x64, 0x7a,
                   0xca, 0x2d, 0x6c, 0xa1, 0xe2, 0x9b, 0xd4, 0x4a, 0x40, 0x76, 0xb3};

  uint8_t buf[259] = {0};

  uint8_t topic_bytes[] = {0x4f, 0x26};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa9, 0xca, 0x6c, 0xcb, 0x64, 0x7a, 0xca, 0x2d, 0x6c,
                         0xa1, 0xe2, 0x9b, 0xd4, 0x4a, 0x40, 0x76, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytes0[] = {0xf2, 0xc6, 0x82, 0x25, 0x6,  0x33, 0x22, 0x18, 0x8c, 0x82, 0xb3, 0xd5, 0xf4, 0xf3, 0x27,
                      0xe9, 0xba, 0x23, 0xfe, 0xbe, 0xc7, 0x3,  0xcd, 0x5f, 0xd6, 0x7e, 0xda, 0xb,  0xa9, 0x37};
  uint8_t bytes1[] = {0x24, 0x16, 0xba, 0x41, 0xa3, 0xc5};
  uint8_t bytes2[] = {0xb4, 0x3c, 0x29, 0xe1, 0x6b, 0xd1, 0x75, 0x93, 0xaf, 0x38};
  uint8_t bytes3[] = {0xc3, 0x82, 0xdf, 0xc6, 0x8b, 0x77, 0x7f, 0x17, 0xc8, 0x6b, 0xfb,
                      0xfe, 0xea, 0xff, 0xae, 0x22, 0x6f, 0x1c, 0xe9, 0x1e, 0x8f};
  uint8_t bytes4[] = {0xd1, 0x3f, 0x7d, 0x27, 0xfe, 0x6d, 0x99, 0xd7, 0x92, 0xf3, 0xc9, 0xfb, 0x90, 0x1, 0x1e,
                      0x51, 0x1b, 0x20, 0x83, 0x45, 0xa3, 0x1,  0xe3, 0x1d, 0x49, 0x2f, 0xb6, 0x42, 0x20};
  uint8_t bytes6[] = {0xb2, 0x6f, 0xd7, 0xdf, 0xe9, 0xca, 0xb6, 0xac, 0xe9, 0xc8, 0x4b,
                      0x30, 0x55, 0x87, 0x8f, 0xc5, 0x54, 0xc5, 0x7b, 0x1c, 0x51, 0xdc};
  uint8_t bytes5[] = {0x60, 0x4, 0x2d, 0x95, 0x5b, 0x6d, 0xd2, 0x5a, 0xa0, 0x9a,
                      0x8e, 0xc, 0x15, 0x8a, 0x69, 0x73, 0x7a, 0x32, 0xe6, 0x5e};
  uint8_t bytes7[] = {0x93, 0x56, 0x93, 0x8b, 0x7a, 0x0,  0x39, 0x6a, 0x10, 0xdb, 0xe1, 0x69, 0x21, 0xdc,
                      0x8f, 0x26, 0xab, 0x38, 0xbc, 0x77, 0x46, 0x40, 0x5d, 0x59, 0x7c, 0xfd, 0x60, 0x1c};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5304}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3053}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5613}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytes5}, .v = {22, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2432}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 13252, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\164J\248\ACKw\168\152\154\236q\RS\ESC\fX\129\180K\FS", _pubPktID = 14693, _pubBody =
// "3MM\195\166\SIw\199E\250\155\253\164\239\US\195\168\222\171\244\206\&7/\SO ?\231\SIK", _pubProps =
// [PropServerKeepAlive 12149,PropMessageExpiryInterval 3682,PropUserProperty "\US"
// "\227\&0RP=\208\227\&6s",PropSubscriptionIdentifier 15,PropSubscriptionIdentifierAvailable
// 12,PropSubscriptionIdentifierAvailable 145,PropRequestResponseInformation 2,PropServerReference
// "\190yV\216\216|\176\DLE\198\\B\131gE\234[\205g\220\252X\US\r\250_\169h]\172",PropPayloadFormatIndicator
// 135,PropResponseTopic "H\142\&67!\178\&8\137c\148\251\172D",PropAuthenticationMethod
// "\222\135\170\SOH\222\221\224\139\130\t\129\ACK",PropAuthenticationMethod
// "\209\192y&\CAN\168\DC3\170m",PropRetainAvailable 19,PropServerKeepAlive 13760,PropSubscriptionIdentifier
// 10,PropWillDelayInterval 3711,PropSubscriptionIdentifier 6]}
TEST(Publish50QCTest, Encode23) {
  uint8_t pkt[] = {0x3b, 0xaf, 0x1,  0x0,  0x13, 0xb,  0xa4, 0x4a, 0xf8, 0x6,  0x77, 0xa8, 0x98, 0x9a, 0xec, 0x71, 0x1e,
                   0x1b, 0xc,  0x58, 0x81, 0xb4, 0x4b, 0x1c, 0x39, 0x65, 0x7a, 0x13, 0x2f, 0x75, 0x2,  0x0,  0x0,  0xe,
                   0x62, 0x26, 0x0,  0x1,  0x1f, 0x0,  0x9,  0xe3, 0x30, 0x52, 0x50, 0x3d, 0xd0, 0xe3, 0x36, 0x73, 0xb,
                   0xf,  0x29, 0xc,  0x29, 0x91, 0x19, 0x2,  0x1c, 0x0,  0x1d, 0xbe, 0x79, 0x56, 0xd8, 0xd8, 0x7c, 0xb0,
                   0x10, 0xc6, 0x5c, 0x42, 0x83, 0x67, 0x45, 0xea, 0x5b, 0xcd, 0x67, 0xdc, 0xfc, 0x58, 0x1f, 0xd,  0xfa,
                   0x5f, 0xa9, 0x68, 0x5d, 0xac, 0x1,  0x87, 0x8,  0x0,  0xd,  0x48, 0x8e, 0x36, 0x37, 0x21, 0xb2, 0x38,
                   0x89, 0x63, 0x94, 0xfb, 0xac, 0x44, 0x15, 0x0,  0xc,  0xde, 0x87, 0xaa, 0x1,  0xde, 0xdd, 0xe0, 0x8b,
                   0x82, 0x9,  0x81, 0x6,  0x15, 0x0,  0x9,  0xd1, 0xc0, 0x79, 0x26, 0x18, 0xa8, 0x13, 0xaa, 0x6d, 0x25,
                   0x13, 0x13, 0x35, 0xc0, 0xb,  0xa,  0x18, 0x0,  0x0,  0xe,  0x7f, 0xb,  0x6,  0x33, 0x4d, 0x4d, 0xc3,
                   0xa6, 0xf,  0x77, 0xc7, 0x45, 0xfa, 0x9b, 0xfd, 0xa4, 0xef, 0x1f, 0xc3, 0xa8, 0xde, 0xab, 0xf4, 0xce,
                   0x37, 0x2f, 0xe,  0x20, 0x3f, 0xe7, 0xf,  0x4b};

  uint8_t buf[188] = {0};

  uint8_t topic_bytes[] = {0xb,  0xa4, 0x4a, 0xf8, 0x6,  0x77, 0xa8, 0x98, 0x9a, 0xec,
                           0x71, 0x1e, 0x1b, 0xc,  0x58, 0x81, 0xb4, 0x4b, 0x1c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x33, 0x4d, 0x4d, 0xc3, 0xa6, 0xf,  0x77, 0xc7, 0x45, 0xfa, 0x9b, 0xfd, 0xa4, 0xef, 0x1f,
                         0xc3, 0xa8, 0xde, 0xab, 0xf4, 0xce, 0x37, 0x2f, 0xe,  0x20, 0x3f, 0xe7, 0xf,  0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytes1[] = {0xe3, 0x30, 0x52, 0x50, 0x3d, 0xd0, 0xe3, 0x36, 0x73};
  uint8_t bytes0[] = {0x1f};
  uint8_t bytes2[] = {0xbe, 0x79, 0x56, 0xd8, 0xd8, 0x7c, 0xb0, 0x10, 0xc6, 0x5c, 0x42, 0x83, 0x67, 0x45, 0xea,
                      0x5b, 0xcd, 0x67, 0xdc, 0xfc, 0x58, 0x1f, 0xd,  0xfa, 0x5f, 0xa9, 0x68, 0x5d, 0xac};
  uint8_t bytes3[] = {0x48, 0x8e, 0x36, 0x37, 0x21, 0xb2, 0x38, 0x89, 0x63, 0x94, 0xfb, 0xac, 0x44};
  uint8_t bytes4[] = {0xde, 0x87, 0xaa, 0x1, 0xde, 0xdd, 0xe0, 0x8b, 0x82, 0x9, 0x81, 0x6};
  uint8_t bytes5[] = {0xd1, 0xc0, 0x79, 0x26, 0x18, 0xa8, 0x13, 0xaa, 0x6d};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12149}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3682}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytes0}, .v = {9, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13760}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3711}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 14693, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\220\170\237\142", _pubPktID = 6499,
// _pubBody = "l\EOT h\135\217\143\178&\ETB$1\239@\177~BO}3V\"\176\SOH\255", _pubProps = [PropMaximumQoS
// 153,PropWildcardSubscriptionAvailable 243,PropSubscriptionIdentifierAvailable 215,PropServerKeepAlive
// 1489,PropSessionExpiryInterval 3944,PropSubscriptionIdentifier 29,PropTopicAlias
// 29387,PropSharedSubscriptionAvailable 8,PropAuthenticationData "\219\145\n\255'",PropWildcardSubscriptionAvailable
// 44,PropMessageExpiryInterval 13597,PropTopicAliasMaximum 14055,PropAuthenticationMethod
// "%\164coT\195\n\208",PropSessionExpiryInterval 24863,PropWildcardSubscriptionAvailable
// 167,PropAssignedClientIdentifier "+\163n\142\SO\179\FS\RSS\US@\130\164\157\DC4",PropUserProperty
// "i\189h\197\245)\194\147i\134>\205.\196\239Z\ESC@|\177Q\r\221C\155\241n\193\FS\183" "a7N5$\208\151\213\173\"%\209Nu5
// \141;\188\184\239\166\164\165\133\DC1\247\253@\132"]}
TEST(Publish50QCTest, Encode24) {
  uint8_t pkt[] = {0x3a, 0xaf, 0x1,  0x0,  0x4,  0xdc, 0xaa, 0xed, 0x8e, 0x19, 0x63, 0x8c, 0x1,  0x24, 0x99, 0x28, 0xf3,
                   0x29, 0xd7, 0x13, 0x5,  0xd1, 0x11, 0x0,  0x0,  0xf,  0x68, 0xb,  0x1d, 0x23, 0x72, 0xcb, 0x2a, 0x8,
                   0x16, 0x0,  0x5,  0xdb, 0x91, 0xa,  0xff, 0x27, 0x28, 0x2c, 0x2,  0x0,  0x0,  0x35, 0x1d, 0x22, 0x36,
                   0xe7, 0x15, 0x0,  0x8,  0x25, 0xa4, 0x63, 0x6f, 0x54, 0xc3, 0xa,  0xd0, 0x11, 0x0,  0x0,  0x61, 0x1f,
                   0x28, 0xa7, 0x12, 0x0,  0xf,  0x2b, 0xa3, 0x6e, 0x8e, 0xe,  0xb3, 0x1c, 0x1e, 0x53, 0x1f, 0x40, 0x82,
                   0xa4, 0x9d, 0x14, 0x26, 0x0,  0x1e, 0x69, 0xbd, 0x68, 0xc5, 0xf5, 0x29, 0xc2, 0x93, 0x69, 0x86, 0x3e,
                   0xcd, 0x2e, 0xc4, 0xef, 0x5a, 0x1b, 0x40, 0x7c, 0xb1, 0x51, 0xd,  0xdd, 0x43, 0x9b, 0xf1, 0x6e, 0xc1,
                   0x1c, 0xb7, 0x0,  0x1e, 0x61, 0x37, 0x4e, 0x35, 0x24, 0xd0, 0x97, 0xd5, 0xad, 0x22, 0x25, 0xd1, 0x4e,
                   0x75, 0x35, 0x20, 0x8d, 0x3b, 0xbc, 0xb8, 0xef, 0xa6, 0xa4, 0xa5, 0x85, 0x11, 0xf7, 0xfd, 0x40, 0x84,
                   0x6c, 0x4,  0x20, 0x68, 0x87, 0xd9, 0x8f, 0xb2, 0x26, 0x17, 0x24, 0x31, 0xef, 0x40, 0xb1, 0x7e, 0x42,
                   0x4f, 0x7d, 0x33, 0x56, 0x22, 0xb0, 0x1,  0xff};

  uint8_t buf[188] = {0};

  uint8_t topic_bytes[] = {0xdc, 0xaa, 0xed, 0x8e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6c, 0x4,  0x20, 0x68, 0x87, 0xd9, 0x8f, 0xb2, 0x26, 0x17, 0x24, 0x31, 0xef,
                         0x40, 0xb1, 0x7e, 0x42, 0x4f, 0x7d, 0x33, 0x56, 0x22, 0xb0, 0x1,  0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytes0[] = {0xdb, 0x91, 0xa, 0xff, 0x27};
  uint8_t bytes1[] = {0x25, 0xa4, 0x63, 0x6f, 0x54, 0xc3, 0xa, 0xd0};
  uint8_t bytes2[] = {0x2b, 0xa3, 0x6e, 0x8e, 0xe, 0xb3, 0x1c, 0x1e, 0x53, 0x1f, 0x40, 0x82, 0xa4, 0x9d, 0x14};
  uint8_t bytes4[] = {0x61, 0x37, 0x4e, 0x35, 0x24, 0xd0, 0x97, 0xd5, 0xad, 0x22, 0x25, 0xd1, 0x4e, 0x75, 0x35,
                      0x20, 0x8d, 0x3b, 0xbc, 0xb8, 0xef, 0xa6, 0xa4, 0xa5, 0x85, 0x11, 0xf7, 0xfd, 0x40, 0x84};
  uint8_t bytes3[] = {0x69, 0xbd, 0x68, 0xc5, 0xf5, 0x29, 0xc2, 0x93, 0x69, 0x86, 0x3e, 0xcd, 0x2e, 0xc4, 0xef,
                      0x5a, 0x1b, 0x40, 0x7c, 0xb1, 0x51, 0xd,  0xdd, 0x43, 0x9b, 0xf1, 0x6e, 0xc1, 0x1c, 0xb7};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1489}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3944}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29387}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13597}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14055}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24863}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytes3}, .v = {30, (char*)&bytes4}}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6499, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\245Y\170\235\232x1\238Y\148",
// _pubPktID = 0, _pubBody = "\139\217\168\150q\SYN\144\176\SO\NAK\147\237", _pubProps = [PropResponseInformation
// "\215\214\227\224\235\211\&1N\159_QX\201x\FS\212\153m\NAK\135\222\SOq}\206a\GS",PropReceiveMaximum
// 3917,PropSubscriptionIdentifier 14,PropMaximumQoS 11,PropPayloadFormatIndicator 61,PropServerKeepAlive
// 13351,PropRequestProblemInformation 172,PropServerReference "\181",PropSubscriptionIdentifierAvailable 167]}
TEST(Publish50QCTest, Encode25) {
  uint8_t pkt[] = {0x38, 0x4b, 0x0,  0xa,  0xf5, 0x59, 0xaa, 0xeb, 0xe8, 0x78, 0x31, 0xee, 0x59, 0x94, 0x32, 0x1a,
                   0x0,  0x1b, 0xd7, 0xd6, 0xe3, 0xe0, 0xeb, 0xd3, 0x31, 0x4e, 0x9f, 0x5f, 0x51, 0x58, 0xc9, 0x78,
                   0x1c, 0xd4, 0x99, 0x6d, 0x15, 0x87, 0xde, 0xe,  0x71, 0x7d, 0xce, 0x61, 0x1d, 0x21, 0xf,  0x4d,
                   0xb,  0xe,  0x24, 0xb,  0x1,  0x3d, 0x13, 0x34, 0x27, 0x17, 0xac, 0x1c, 0x0,  0x1,  0xb5, 0x29,
                   0xa7, 0x8b, 0xd9, 0xa8, 0x96, 0x71, 0x16, 0x90, 0xb0, 0xe,  0x15, 0x93, 0xed};

  uint8_t buf[87] = {0};

  uint8_t topic_bytes[] = {0xf5, 0x59, 0xaa, 0xeb, 0xe8, 0x78, 0x31, 0xee, 0x59, 0x94};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0xd9, 0xa8, 0x96, 0x71, 0x16, 0x90, 0xb0, 0xe, 0x15, 0x93, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytes0[] = {0xd7, 0xd6, 0xe3, 0xe0, 0xeb, 0xd3, 0x31, 0x4e, 0x9f, 0x5f, 0x51, 0x58, 0xc9, 0x78,
                      0x1c, 0xd4, 0x99, 0x6d, 0x15, 0x87, 0xde, 0xe,  0x71, 0x7d, 0xce, 0x61, 0x1d};
  uint8_t bytes1[] = {0xb5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3917}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13351}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 167}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\DC4\225[\128A\SUB\229p\254\164'\187\153F\223\219\&3\FS\US~\247\227\SYN(B\177\172", _pubPktID = 927, _pubBody =
// "b\DELS\153v\176m?\201\248\140\EOTe\174\196\EM\253\FS", _pubProps = [PropResponseTopic
// "\t\v\152\222\231a\251\233\ENQ{'\176",PropAuthenticationMethod "-\183]\ETX*",PropUserProperty "\227F\131\144"
// "\251\139\229\208\248\DELV",PropPayloadFormatIndicator 126,PropServerKeepAlive 123]}
TEST(Publish50QCTest, Encode26) {
  uint8_t pkt[] = {0x34, 0x5e, 0x0,  0x1b, 0x14, 0xe1, 0x5b, 0x80, 0x41, 0x1a, 0xe5, 0x70, 0xfe, 0xa4, 0x27, 0xbb,
                   0x99, 0x46, 0xdf, 0xdb, 0x33, 0x1c, 0x1f, 0x7e, 0xf7, 0xe3, 0x16, 0x28, 0x42, 0xb1, 0xac, 0x3,
                   0x9f, 0x2c, 0x8,  0x0,  0xc,  0x9,  0xb,  0x98, 0xde, 0xe7, 0x61, 0xfb, 0xe9, 0x5,  0x7b, 0x27,
                   0xb0, 0x15, 0x0,  0x5,  0x2d, 0xb7, 0x5d, 0x3,  0x2a, 0x26, 0x0,  0x4,  0xe3, 0x46, 0x83, 0x90,
                   0x0,  0x7,  0xfb, 0x8b, 0xe5, 0xd0, 0xf8, 0x7f, 0x56, 0x1,  0x7e, 0x13, 0x0,  0x7b, 0x62, 0x7f,
                   0x53, 0x99, 0x76, 0xb0, 0x6d, 0x3f, 0xc9, 0xf8, 0x8c, 0x4,  0x65, 0xae, 0xc4, 0x19, 0xfd, 0x1c};

  uint8_t buf[106] = {0};

  uint8_t topic_bytes[] = {0x14, 0xe1, 0x5b, 0x80, 0x41, 0x1a, 0xe5, 0x70, 0xfe, 0xa4, 0x27, 0xbb, 0x99, 0x46,
                           0xdf, 0xdb, 0x33, 0x1c, 0x1f, 0x7e, 0xf7, 0xe3, 0x16, 0x28, 0x42, 0xb1, 0xac};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x62, 0x7f, 0x53, 0x99, 0x76, 0xb0, 0x6d, 0x3f, 0xc9,
                         0xf8, 0x8c, 0x4,  0x65, 0xae, 0xc4, 0x19, 0xfd, 0x1c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytes0[] = {0x9, 0xb, 0x98, 0xde, 0xe7, 0x61, 0xfb, 0xe9, 0x5, 0x7b, 0x27, 0xb0};
  uint8_t bytes1[] = {0x2d, 0xb7, 0x5d, 0x3, 0x2a};
  uint8_t bytes3[] = {0xfb, 0x8b, 0xe5, 0xd0, 0xf8, 0x7f, 0x56};
  uint8_t bytes2[] = {0xe3, 0x46, 0x83, 0x90};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytes2}, .v = {7, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 123}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 927, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\132\158\245\v\236\159\129\175\159j(", _pubPktID = 19519, _pubBody =
// "\222Ut\223\169\215\ACK\238\228\137\147Z\EM\196", _pubProps = [PropWillDelayInterval 25128,PropContentType
// "\241I#\247\141\201\EM\242y\182F^\204\138\a{c\230 ",PropServerReference
// "\136\&3\200\214\186\212\US\156\169\&7\SOH\138\147\&6s\189\US\240\171",PropRequestResponseInformation
// 54,PropReasonString
// "-\218&\130\225\167<6\247B\b\224\178\241\ESC\244\248e<y70s~\157\153\STXf\242\206",PropAuthenticationMethod
// "3Z,\183\251\243\RS\236a)\US\190\253V\RSV\235`",PropPayloadFormatIndicator 253,PropServerKeepAlive
// 3987,PropRequestProblemInformation 84,PropMaximumQoS 187,PropPayloadFormatIndicator 14,PropResponseTopic
// "\182\219<\ENQ\154\201\200G[\EM-\197\162\206_\DC1\242YgAP\SOH\140\182\162Pm",PropMaximumPacketSize
// 17068,PropCorrelationData
// "\NUL\170d\169\rh\175\156|\DC3\217\151\152\237\ESC\213\223\138\NUL\137\DC1\236\189\194\160",PropWillDelayInterval
// 21147,PropMessageExpiryInterval 24324,PropServerKeepAlive 18803,PropTopicAliasMaximum 28153,PropMessageExpiryInterval
// 13344,PropContentType "\ENQ7\250H\a\221e\a",PropContentType "\a\253\178?\DEL\177\241\245"]}
TEST(Publish50QCTest, Encode27) {
  uint8_t pkt[] = {
      0x33, 0xfd, 0x1,  0x0,  0xb,  0x84, 0x9e, 0xf5, 0xb,  0xec, 0x9f, 0x81, 0xaf, 0x9f, 0x6a, 0x28, 0x4c, 0x3f, 0xde,
      0x1,  0x18, 0x0,  0x0,  0x62, 0x28, 0x3,  0x0,  0x13, 0xf1, 0x49, 0x23, 0xf7, 0x8d, 0xc9, 0x19, 0xf2, 0x79, 0xb6,
      0x46, 0x5e, 0xcc, 0x8a, 0x7,  0x7b, 0x63, 0xe6, 0x20, 0x1c, 0x0,  0x13, 0x88, 0x33, 0xc8, 0xd6, 0xba, 0xd4, 0x1f,
      0x9c, 0xa9, 0x37, 0x1,  0x8a, 0x93, 0x36, 0x73, 0xbd, 0x1f, 0xf0, 0xab, 0x19, 0x36, 0x1f, 0x0,  0x1e, 0x2d, 0xda,
      0x26, 0x82, 0xe1, 0xa7, 0x3c, 0x36, 0xf7, 0x42, 0x8,  0xe0, 0xb2, 0xf1, 0x1b, 0xf4, 0xf8, 0x65, 0x3c, 0x79, 0x37,
      0x30, 0x73, 0x7e, 0x9d, 0x99, 0x2,  0x66, 0xf2, 0xce, 0x15, 0x0,  0x12, 0x33, 0x5a, 0x2c, 0xb7, 0xfb, 0xf3, 0x1e,
      0xec, 0x61, 0x29, 0x1f, 0xbe, 0xfd, 0x56, 0x1e, 0x56, 0xeb, 0x60, 0x1,  0xfd, 0x13, 0xf,  0x93, 0x17, 0x54, 0x24,
      0xbb, 0x1,  0xe,  0x8,  0x0,  0x1b, 0xb6, 0xdb, 0x3c, 0x5,  0x9a, 0xc9, 0xc8, 0x47, 0x5b, 0x19, 0x2d, 0xc5, 0xa2,
      0xce, 0x5f, 0x11, 0xf2, 0x59, 0x67, 0x41, 0x50, 0x1,  0x8c, 0xb6, 0xa2, 0x50, 0x6d, 0x27, 0x0,  0x0,  0x42, 0xac,
      0x9,  0x0,  0x19, 0x0,  0xaa, 0x64, 0xa9, 0xd,  0x68, 0xaf, 0x9c, 0x7c, 0x13, 0xd9, 0x97, 0x98, 0xed, 0x1b, 0xd5,
      0xdf, 0x8a, 0x0,  0x89, 0x11, 0xec, 0xbd, 0xc2, 0xa0, 0x18, 0x0,  0x0,  0x52, 0x9b, 0x2,  0x0,  0x0,  0x5f, 0x4,
      0x13, 0x49, 0x73, 0x22, 0x6d, 0xf9, 0x2,  0x0,  0x0,  0x34, 0x20, 0x3,  0x0,  0x8,  0x5,  0x37, 0xfa, 0x48, 0x7,
      0xdd, 0x65, 0x7,  0x3,  0x0,  0x8,  0x7,  0xfd, 0xb2, 0x3f, 0x7f, 0xb1, 0xf1, 0xf5, 0xde, 0x55, 0x74, 0xdf, 0xa9,
      0xd7, 0x6,  0xee, 0xe4, 0x89, 0x93, 0x5a, 0x19, 0xc4};

  uint8_t buf[266] = {0};

  uint8_t topic_bytes[] = {0x84, 0x9e, 0xf5, 0xb, 0xec, 0x9f, 0x81, 0xaf, 0x9f, 0x6a, 0x28};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xde, 0x55, 0x74, 0xdf, 0xa9, 0xd7, 0x6, 0xee, 0xe4, 0x89, 0x93, 0x5a, 0x19, 0xc4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytes0[] = {0xf1, 0x49, 0x23, 0xf7, 0x8d, 0xc9, 0x19, 0xf2, 0x79, 0xb6,
                      0x46, 0x5e, 0xcc, 0x8a, 0x7,  0x7b, 0x63, 0xe6, 0x20};
  uint8_t bytes1[] = {0x88, 0x33, 0xc8, 0xd6, 0xba, 0xd4, 0x1f, 0x9c, 0xa9, 0x37,
                      0x1,  0x8a, 0x93, 0x36, 0x73, 0xbd, 0x1f, 0xf0, 0xab};
  uint8_t bytes2[] = {0x2d, 0xda, 0x26, 0x82, 0xe1, 0xa7, 0x3c, 0x36, 0xf7, 0x42, 0x8,  0xe0, 0xb2, 0xf1, 0x1b,
                      0xf4, 0xf8, 0x65, 0x3c, 0x79, 0x37, 0x30, 0x73, 0x7e, 0x9d, 0x99, 0x2,  0x66, 0xf2, 0xce};
  uint8_t bytes3[] = {0x33, 0x5a, 0x2c, 0xb7, 0xfb, 0xf3, 0x1e, 0xec, 0x61,
                      0x29, 0x1f, 0xbe, 0xfd, 0x56, 0x1e, 0x56, 0xeb, 0x60};
  uint8_t bytes4[] = {0xb6, 0xdb, 0x3c, 0x5,  0x9a, 0xc9, 0xc8, 0x47, 0x5b, 0x19, 0x2d, 0xc5, 0xa2, 0xce,
                      0x5f, 0x11, 0xf2, 0x59, 0x67, 0x41, 0x50, 0x1,  0x8c, 0xb6, 0xa2, 0x50, 0x6d};
  uint8_t bytes5[] = {0x0,  0xaa, 0x64, 0xa9, 0xd,  0x68, 0xaf, 0x9c, 0x7c, 0x13, 0xd9, 0x97, 0x98,
                      0xed, 0x1b, 0xd5, 0xdf, 0x8a, 0x0,  0x89, 0x11, 0xec, 0xbd, 0xc2, 0xa0};
  uint8_t bytes6[] = {0x5, 0x37, 0xfa, 0x48, 0x7, 0xdd, 0x65, 0x7};
  uint8_t bytes7[] = {0x7, 0xfd, 0xb2, 0x3f, 0x7f, 0xb1, 0xf1, 0xf5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25128}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3987}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17068}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21147}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24324}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18803}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28153}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13344}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytes7}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19519, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "-\187#\178\187\239\RS\172\ETX\144=\172\185\192\232Q\197:A\171^\SUB\135)", _pubPktID = 18146, _pubBody = "\228\167",
// _pubProps = [PropServerKeepAlive 1419,PropTopicAliasMaximum 6051,PropAssignedClientIdentifier
// "!T\144\247Dl\230\229\243\SYN\176\178\&2H@\"`\211\EOT\169Z",PropWildcardSubscriptionAvailable
// 64,PropResponseInformation
// ".pc\a\CAN\ACKdN\218\SYN\SUB\130F\ESC\131\NAK\214\182\247&[\240\233\152\150\205\DC2\131",PropSubscriptionIdentifier
// 18,PropSubscriptionIdentifierAvailable 142,PropReasonString "\DELf+",PropMessageExpiryInterval
// 16551,PropSharedSubscriptionAvailable 87,PropWildcardSubscriptionAvailable 138,PropContentType
// "?\FS\147\244\216\204g\SUB\245\181\128N\DC3\205\230Gi\242\170\139\SOM",PropUserProperty
// "w[nZb\204\161?v\196\235\195\181" "\ACKEh\173\&5
// \249\188\254F\252\&0[\149*\174\165\237$*\253",PropSubscriptionIdentifierAvailable 45,PropMaximumQoS 154]}
TEST(Publish50QCTest, Encode28) {
  uint8_t pkt[] = {0x32, 0xb6, 0x1,  0x0,  0x18, 0x2d, 0xbb, 0x23, 0xb2, 0xbb, 0xef, 0x1e, 0xac, 0x3,  0x90, 0x3d, 0xac,
                   0xb9, 0xc0, 0xe8, 0x51, 0xc5, 0x3a, 0x41, 0xab, 0x5e, 0x1a, 0x87, 0x29, 0x46, 0xe2, 0x96, 0x1,  0x13,
                   0x5,  0x8b, 0x22, 0x17, 0xa3, 0x12, 0x0,  0x15, 0x21, 0x54, 0x90, 0xf7, 0x44, 0x6c, 0xe6, 0xe5, 0xf3,
                   0x16, 0xb0, 0xb2, 0x32, 0x48, 0x40, 0x22, 0x60, 0xd3, 0x4,  0xa9, 0x5a, 0x28, 0x40, 0x1a, 0x0,  0x1c,
                   0x2e, 0x70, 0x63, 0x7,  0x18, 0x6,  0x64, 0x4e, 0xda, 0x16, 0x1a, 0x82, 0x46, 0x1b, 0x83, 0x15, 0xd6,
                   0xb6, 0xf7, 0x26, 0x5b, 0xf0, 0xe9, 0x98, 0x96, 0xcd, 0x12, 0x83, 0xb,  0x12, 0x29, 0x8e, 0x1f, 0x0,
                   0x3,  0x7f, 0x66, 0x2b, 0x2,  0x0,  0x0,  0x40, 0xa7, 0x2a, 0x57, 0x28, 0x8a, 0x3,  0x0,  0x16, 0x3f,
                   0x1c, 0x93, 0xf4, 0xd8, 0xcc, 0x67, 0x1a, 0xf5, 0xb5, 0x80, 0x4e, 0x13, 0xcd, 0xe6, 0x47, 0x69, 0xf2,
                   0xaa, 0x8b, 0xe,  0x4d, 0x26, 0x0,  0xd,  0x77, 0x5b, 0x6e, 0x5a, 0x62, 0xcc, 0xa1, 0x3f, 0x76, 0xc4,
                   0xeb, 0xc3, 0xb5, 0x0,  0x15, 0x6,  0x45, 0x68, 0xad, 0x35, 0x20, 0xf9, 0xbc, 0xfe, 0x46, 0xfc, 0x30,
                   0x5b, 0x95, 0x2a, 0xae, 0xa5, 0xed, 0x24, 0x2a, 0xfd, 0x29, 0x2d, 0x24, 0x9a, 0xe4, 0xa7};

  uint8_t buf[195] = {0};

  uint8_t topic_bytes[] = {0x2d, 0xbb, 0x23, 0xb2, 0xbb, 0xef, 0x1e, 0xac, 0x3,  0x90, 0x3d, 0xac,
                           0xb9, 0xc0, 0xe8, 0x51, 0xc5, 0x3a, 0x41, 0xab, 0x5e, 0x1a, 0x87, 0x29};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe4, 0xa7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytes0[] = {0x21, 0x54, 0x90, 0xf7, 0x44, 0x6c, 0xe6, 0xe5, 0xf3, 0x16, 0xb0,
                      0xb2, 0x32, 0x48, 0x40, 0x22, 0x60, 0xd3, 0x4,  0xa9, 0x5a};
  uint8_t bytes1[] = {0x2e, 0x70, 0x63, 0x7,  0x18, 0x6,  0x64, 0x4e, 0xda, 0x16, 0x1a, 0x82, 0x46, 0x1b,
                      0x83, 0x15, 0xd6, 0xb6, 0xf7, 0x26, 0x5b, 0xf0, 0xe9, 0x98, 0x96, 0xcd, 0x12, 0x83};
  uint8_t bytes2[] = {0x7f, 0x66, 0x2b};
  uint8_t bytes3[] = {0x3f, 0x1c, 0x93, 0xf4, 0xd8, 0xcc, 0x67, 0x1a, 0xf5, 0xb5, 0x80,
                      0x4e, 0x13, 0xcd, 0xe6, 0x47, 0x69, 0xf2, 0xaa, 0x8b, 0xe,  0x4d};
  uint8_t bytes5[] = {0x6,  0x45, 0x68, 0xad, 0x35, 0x20, 0xf9, 0xbc, 0xfe, 0x46, 0xfc,
                      0x30, 0x5b, 0x95, 0x2a, 0xae, 0xa5, 0xed, 0x24, 0x2a, 0xfd};
  uint8_t bytes4[] = {0x77, 0x5b, 0x6e, 0x5a, 0x62, 0xcc, 0xa1, 0x3f, 0x76, 0xc4, 0xeb, 0xc3, 0xb5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1419}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6051}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16551}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytes4}, .v = {21, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 154}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 18146, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "]\210f\CAN\144\189+\ETB\v~\235)\166\227\158\211\&9\SOHj\191\242\212T<", _pubPktID = 16544, _pubBody =
// "\210XDU\144\201\&4 \226VBDBmf\138\212\f\195\232", _pubProps = [PropSessionExpiryInterval
// 17156,PropResponseInformation "\247~rK\GSH",PropWillDelayInterval 30700,PropContentType
// "\186\131\DLE\157\EM@",PropResponseInformation "\169\225\203\215\157\199+\199\238=d\248\229",PropContentType
// "\231\185\239\228T\176",PropMessageExpiryInterval 2812,PropResponseInformation
// "\190\219\205v",PropMessageExpiryInterval 378,PropMessageExpiryInterval 30753,PropAssignedClientIdentifier
// "\206\FSP\204\144\130[\230p\217\225]c\146\&7\209[\v\215\213p",PropReceiveMaximum 16299,PropRequestProblemInformation
// 100,PropReasonString
// "\128&\f\DC1#@\249\156\DC3\156\DLE\f\200{\176\\\199\171\139\133u\DC3\139\&9",PropPayloadFormatIndicator
// 12,PropCorrelationData ";\223\185\192\184\178=\RS\181\222\b\165\194&\244 9\219\ESCq\200g\185$\DEL",PropUserProperty
// "U\151\221\218\159\200\252\&3," "$\158\242\244\v\US\DEL~\161\nE\140\SOH@d\188oly\177",PropCorrelationData
// "S\133m\138",PropTopicAlias 625,PropAuthenticationMethod "\168\129S^aX]\251G8\a.#0\t\n
// \160",PropSubscriptionIdentifierAvailable 188,PropServerKeepAlive 10511,PropWillDelayInterval
// 31563,PropTopicAliasMaximum 6951,PropResponseInformation
// "\212-\244\US\n\205\STX\169\201\&9\134\162\200a\214\171\211\174",PropMessageExpiryInterval
// 3365,PropResponseInformation "vh\240\SO\232\130\135\157\138\EM\128R\165\r",PropMessageExpiryInterval
// 27194,PropReasonString "\135\145\218\t\129e"]}
TEST(Publish50QCTest, Encode29) {
  uint8_t pkt[] = {
      0x3a, 0xda, 0x2,  0x0,  0x18, 0x5d, 0xd2, 0x66, 0x18, 0x90, 0xbd, 0x2b, 0x17, 0xb,  0x7e, 0xeb, 0x29, 0xa6, 0xe3,
      0x9e, 0xd3, 0x39, 0x1,  0x6a, 0xbf, 0xf2, 0xd4, 0x54, 0x3c, 0x40, 0xa0, 0xa8, 0x2,  0x11, 0x0,  0x0,  0x43, 0x4,
      0x1a, 0x0,  0x6,  0xf7, 0x7e, 0x72, 0x4b, 0x1d, 0x48, 0x18, 0x0,  0x0,  0x77, 0xec, 0x3,  0x0,  0x6,  0xba, 0x83,
      0x10, 0x9d, 0x19, 0x40, 0x1a, 0x0,  0xd,  0xa9, 0xe1, 0xcb, 0xd7, 0x9d, 0xc7, 0x2b, 0xc7, 0xee, 0x3d, 0x64, 0xf8,
      0xe5, 0x3,  0x0,  0x6,  0xe7, 0xb9, 0xef, 0xe4, 0x54, 0xb0, 0x2,  0x0,  0x0,  0xa,  0xfc, 0x1a, 0x0,  0x4,  0xbe,
      0xdb, 0xcd, 0x76, 0x2,  0x0,  0x0,  0x1,  0x7a, 0x2,  0x0,  0x0,  0x78, 0x21, 0x12, 0x0,  0x15, 0xce, 0x1c, 0x50,
      0xcc, 0x90, 0x82, 0x5b, 0xe6, 0x70, 0xd9, 0xe1, 0x5d, 0x63, 0x92, 0x37, 0xd1, 0x5b, 0xb,  0xd7, 0xd5, 0x70, 0x21,
      0x3f, 0xab, 0x17, 0x64, 0x1f, 0x0,  0x18, 0x80, 0x26, 0xc,  0x11, 0x23, 0x40, 0xf9, 0x9c, 0x13, 0x9c, 0x10, 0xc,
      0xc8, 0x7b, 0xb0, 0x5c, 0xc7, 0xab, 0x8b, 0x85, 0x75, 0x13, 0x8b, 0x39, 0x1,  0xc,  0x9,  0x0,  0x19, 0x3b, 0xdf,
      0xb9, 0xc0, 0xb8, 0xb2, 0x3d, 0x1e, 0xb5, 0xde, 0x8,  0xa5, 0xc2, 0x26, 0xf4, 0x20, 0x39, 0xdb, 0x1b, 0x71, 0xc8,
      0x67, 0xb9, 0x24, 0x7f, 0x26, 0x0,  0x9,  0x55, 0x97, 0xdd, 0xda, 0x9f, 0xc8, 0xfc, 0x33, 0x2c, 0x0,  0x14, 0x24,
      0x9e, 0xf2, 0xf4, 0xb,  0x1f, 0x7f, 0x7e, 0xa1, 0xa,  0x45, 0x8c, 0x1,  0x40, 0x64, 0xbc, 0x6f, 0x6c, 0x79, 0xb1,
      0x9,  0x0,  0x4,  0x53, 0x85, 0x6d, 0x8a, 0x23, 0x2,  0x71, 0x15, 0x0,  0x12, 0xa8, 0x81, 0x53, 0x5e, 0x61, 0x58,
      0x5d, 0xfb, 0x47, 0x38, 0x7,  0x2e, 0x23, 0x30, 0x9,  0xa,  0x20, 0xa0, 0x29, 0xbc, 0x13, 0x29, 0xf,  0x18, 0x0,
      0x0,  0x7b, 0x4b, 0x22, 0x1b, 0x27, 0x1a, 0x0,  0x12, 0xd4, 0x2d, 0xf4, 0x1f, 0xa,  0xcd, 0x2,  0xa9, 0xc9, 0x39,
      0x86, 0xa2, 0xc8, 0x61, 0xd6, 0xab, 0xd3, 0xae, 0x2,  0x0,  0x0,  0xd,  0x25, 0x1a, 0x0,  0xe,  0x76, 0x68, 0xf0,
      0xe,  0xe8, 0x82, 0x87, 0x9d, 0x8a, 0x19, 0x80, 0x52, 0xa5, 0xd,  0x2,  0x0,  0x0,  0x6a, 0x3a, 0x1f, 0x0,  0x6,
      0x87, 0x91, 0xda, 0x9,  0x81, 0x65, 0xd2, 0x58, 0x44, 0x55, 0x90, 0xc9, 0x34, 0x20, 0xe2, 0x56, 0x42, 0x44, 0x42,
      0x6d, 0x66, 0x8a, 0xd4, 0xc,  0xc3, 0xe8};

  uint8_t buf[359] = {0};

  uint8_t topic_bytes[] = {0x5d, 0xd2, 0x66, 0x18, 0x90, 0xbd, 0x2b, 0x17, 0xb,  0x7e, 0xeb, 0x29,
                           0xa6, 0xe3, 0x9e, 0xd3, 0x39, 0x1,  0x6a, 0xbf, 0xf2, 0xd4, 0x54, 0x3c};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd2, 0x58, 0x44, 0x55, 0x90, 0xc9, 0x34, 0x20, 0xe2, 0x56,
                         0x42, 0x44, 0x42, 0x6d, 0x66, 0x8a, 0xd4, 0xc,  0xc3, 0xe8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytes0[] = {0xf7, 0x7e, 0x72, 0x4b, 0x1d, 0x48};
  uint8_t bytes1[] = {0xba, 0x83, 0x10, 0x9d, 0x19, 0x40};
  uint8_t bytes2[] = {0xa9, 0xe1, 0xcb, 0xd7, 0x9d, 0xc7, 0x2b, 0xc7, 0xee, 0x3d, 0x64, 0xf8, 0xe5};
  uint8_t bytes3[] = {0xe7, 0xb9, 0xef, 0xe4, 0x54, 0xb0};
  uint8_t bytes4[] = {0xbe, 0xdb, 0xcd, 0x76};
  uint8_t bytes5[] = {0xce, 0x1c, 0x50, 0xcc, 0x90, 0x82, 0x5b, 0xe6, 0x70, 0xd9, 0xe1,
                      0x5d, 0x63, 0x92, 0x37, 0xd1, 0x5b, 0xb,  0xd7, 0xd5, 0x70};
  uint8_t bytes6[] = {0x80, 0x26, 0xc,  0x11, 0x23, 0x40, 0xf9, 0x9c, 0x13, 0x9c, 0x10, 0xc,
                      0xc8, 0x7b, 0xb0, 0x5c, 0xc7, 0xab, 0x8b, 0x85, 0x75, 0x13, 0x8b, 0x39};
  uint8_t bytes7[] = {0x3b, 0xdf, 0xb9, 0xc0, 0xb8, 0xb2, 0x3d, 0x1e, 0xb5, 0xde, 0x8,  0xa5, 0xc2,
                      0x26, 0xf4, 0x20, 0x39, 0xdb, 0x1b, 0x71, 0xc8, 0x67, 0xb9, 0x24, 0x7f};
  uint8_t bytes9[] = {0x24, 0x9e, 0xf2, 0xf4, 0xb,  0x1f, 0x7f, 0x7e, 0xa1, 0xa,
                      0x45, 0x8c, 0x1,  0x40, 0x64, 0xbc, 0x6f, 0x6c, 0x79, 0xb1};
  uint8_t bytes8[] = {0x55, 0x97, 0xdd, 0xda, 0x9f, 0xc8, 0xfc, 0x33, 0x2c};
  uint8_t bytes10[] = {0x53, 0x85, 0x6d, 0x8a};
  uint8_t bytes11[] = {0xa8, 0x81, 0x53, 0x5e, 0x61, 0x58, 0x5d, 0xfb, 0x47,
                       0x38, 0x7,  0x2e, 0x23, 0x30, 0x9,  0xa,  0x20, 0xa0};
  uint8_t bytes12[] = {0xd4, 0x2d, 0xf4, 0x1f, 0xa,  0xcd, 0x2,  0xa9, 0xc9,
                       0x39, 0x86, 0xa2, 0xc8, 0x61, 0xd6, 0xab, 0xd3, 0xae};
  uint8_t bytes13[] = {0x76, 0x68, 0xf0, 0xe, 0xe8, 0x82, 0x87, 0x9d, 0x8a, 0x19, 0x80, 0x52, 0xa5, 0xd};
  uint8_t bytes14[] = {0x87, 0x91, 0xda, 0x9, 0x81, 0x65};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17156}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30700}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2812}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 378}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30753}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16299}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytes8}, .v = {20, (char*)&bytes9}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 625}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytes11}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10511}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31563}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6951}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytes12}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3365}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytes13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27194}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytes14}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16544, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "/\151\180C\211\173\172u ", _pubPktID
// = 29329, _pubBody = "J\158~x\US\145@z/7C\157R\221Qm", _pubProps = [PropRetainAvailable 214,PropContentType
// "a\238\206\163aD",PropMessageExpiryInterval 11663,PropSessionExpiryInterval 31935,PropReceiveMaximum
// 27442,PropServerKeepAlive 14330,PropMaximumQoS 144,PropReceiveMaximum 14081,PropRequestProblemInformation
// 191,PropTopicAliasMaximum 19680,PropAssignedClientIdentifier
// "\NULK\173\201Dn\236\225\245)\153\&9\184\240",PropWillDelayInterval 30924,PropRetainAvailable 57,PropCorrelationData
// "\162\186\239$\225\241\&1\138Y",PropTopicAliasMaximum 10992,PropSessionExpiryInterval 25505,PropWillDelayInterval
// 1112]}
TEST(Publish50QCTest, Encode30) {
  uint8_t pkt[] = {0x35, 0x74, 0x0,  0x9,  0x2f, 0x97, 0xb4, 0x43, 0xd3, 0xad, 0xac, 0x75, 0x20, 0x72, 0x91, 0x56, 0x25,
                   0xd6, 0x3,  0x0,  0x6,  0x61, 0xee, 0xce, 0xa3, 0x61, 0x44, 0x2,  0x0,  0x0,  0x2d, 0x8f, 0x11, 0x0,
                   0x0,  0x7c, 0xbf, 0x21, 0x6b, 0x32, 0x13, 0x37, 0xfa, 0x24, 0x90, 0x21, 0x37, 0x1,  0x17, 0xbf, 0x22,
                   0x4c, 0xe0, 0x12, 0x0,  0xe,  0x0,  0x4b, 0xad, 0xc9, 0x44, 0x6e, 0xec, 0xe1, 0xf5, 0x29, 0x99, 0x39,
                   0xb8, 0xf0, 0x18, 0x0,  0x0,  0x78, 0xcc, 0x25, 0x39, 0x9,  0x0,  0x9,  0xa2, 0xba, 0xef, 0x24, 0xe1,
                   0xf1, 0x31, 0x8a, 0x59, 0x22, 0x2a, 0xf0, 0x11, 0x0,  0x0,  0x63, 0xa1, 0x18, 0x0,  0x0,  0x4,  0x58,
                   0x4a, 0x9e, 0x7e, 0x78, 0x1f, 0x91, 0x40, 0x7a, 0x2f, 0x37, 0x43, 0x9d, 0x52, 0xdd, 0x51, 0x6d};

  uint8_t buf[128] = {0};

  uint8_t topic_bytes[] = {0x2f, 0x97, 0xb4, 0x43, 0xd3, 0xad, 0xac, 0x75, 0x20};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x9e, 0x7e, 0x78, 0x1f, 0x91, 0x40, 0x7a,
                         0x2f, 0x37, 0x43, 0x9d, 0x52, 0xdd, 0x51, 0x6d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytes0[] = {0x61, 0xee, 0xce, 0xa3, 0x61, 0x44};
  uint8_t bytes1[] = {0x0, 0x4b, 0xad, 0xc9, 0x44, 0x6e, 0xec, 0xe1, 0xf5, 0x29, 0x99, 0x39, 0xb8, 0xf0};
  uint8_t bytes2[] = {0xa2, 0xba, 0xef, 0x24, 0xe1, 0xf1, 0x31, 0x8a, 0x59};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11663}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31935}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27442}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14330}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14081}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19680}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30924}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10992}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25505}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1112}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29329, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "p\197\135\ETX\191\&8\221\RS\229\240\245$_2y\225iz\SYNx", _pubPktID = 12423, _pubBody =
// "\253\147\173\147\169r\130\DLE'\SUB\a\242\DC3/r\237[\213\209\140I\133\196EB\194", _pubProps = [PropUserProperty
// "Y\193\148\194\191\FS\191\207\238\128\243vP\139"
// "\STX\195\DLE\155\177\253\220\202\232F\245jW\139\177\ESC\RS\160\219D",PropTopicAlias 3387,PropMaximumPacketSize
// 29737,PropCorrelationData
// "\193.$b\230\188\168\157\140\236\152l5y\234\SI\234\249c[\209G\160B",PropSessionExpiryInterval
// 8436,PropRetainAvailable 204,PropReasonString "nC\185\132[\233\&9\SI\197;I\b\213\233",PropMessageExpiryInterval
// 30045,PropServerKeepAlive 13596,PropMaximumQoS 201,PropAuthenticationData "\SIV\243\131\137Y4J\245/\229"]}
TEST(Publish50QCTest, Encode31) {
  uint8_t pkt[] = {0x3c, 0xad, 0x1,  0x0,  0x14, 0x70, 0xc5, 0x87, 0x3,  0xbf, 0x38, 0xdd, 0x1e, 0xe5, 0xf0, 0xf5,
                   0x24, 0x5f, 0x32, 0x79, 0xe1, 0x69, 0x7a, 0x16, 0x78, 0x30, 0x87, 0x7a, 0x26, 0x0,  0xe,  0x59,
                   0xc1, 0x94, 0xc2, 0xbf, 0x1c, 0xbf, 0xcf, 0xee, 0x80, 0xf3, 0x76, 0x50, 0x8b, 0x0,  0x14, 0x2,
                   0xc3, 0x10, 0x9b, 0xb1, 0xfd, 0xdc, 0xca, 0xe8, 0x46, 0xf5, 0x6a, 0x57, 0x8b, 0xb1, 0x1b, 0x1e,
                   0xa0, 0xdb, 0x44, 0x23, 0xd,  0x3b, 0x27, 0x0,  0x0,  0x74, 0x29, 0x9,  0x0,  0x18, 0xc1, 0x2e,
                   0x24, 0x62, 0xe6, 0xbc, 0xa8, 0x9d, 0x8c, 0xec, 0x98, 0x6c, 0x35, 0x79, 0xea, 0xf,  0xea, 0xf9,
                   0x63, 0x5b, 0xd1, 0x47, 0xa0, 0x42, 0x11, 0x0,  0x0,  0x20, 0xf4, 0x25, 0xcc, 0x1f, 0x0,  0xe,
                   0x6e, 0x43, 0xb9, 0x84, 0x5b, 0xe9, 0x39, 0xf,  0xc5, 0x3b, 0x49, 0x8,  0xd5, 0xe9, 0x2,  0x0,
                   0x0,  0x75, 0x5d, 0x13, 0x35, 0x1c, 0x24, 0xc9, 0x16, 0x0,  0xb,  0xf,  0x56, 0xf3, 0x83, 0x89,
                   0x59, 0x34, 0x4a, 0xf5, 0x2f, 0xe5, 0xfd, 0x93, 0xad, 0x93, 0xa9, 0x72, 0x82, 0x10, 0x27, 0x1a,
                   0x7,  0xf2, 0x13, 0x2f, 0x72, 0xed, 0x5b, 0xd5, 0xd1, 0x8c, 0x49, 0x85, 0xc4, 0x45, 0x42, 0xc2};

  uint8_t buf[186] = {0};

  uint8_t topic_bytes[] = {0x70, 0xc5, 0x87, 0x3,  0xbf, 0x38, 0xdd, 0x1e, 0xe5, 0xf0,
                           0xf5, 0x24, 0x5f, 0x32, 0x79, 0xe1, 0x69, 0x7a, 0x16, 0x78};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfd, 0x93, 0xad, 0x93, 0xa9, 0x72, 0x82, 0x10, 0x27, 0x1a, 0x7,  0xf2, 0x13,
                         0x2f, 0x72, 0xed, 0x5b, 0xd5, 0xd1, 0x8c, 0x49, 0x85, 0xc4, 0x45, 0x42, 0xc2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytes1[] = {0x2,  0xc3, 0x10, 0x9b, 0xb1, 0xfd, 0xdc, 0xca, 0xe8, 0x46,
                      0xf5, 0x6a, 0x57, 0x8b, 0xb1, 0x1b, 0x1e, 0xa0, 0xdb, 0x44};
  uint8_t bytes0[] = {0x59, 0xc1, 0x94, 0xc2, 0xbf, 0x1c, 0xbf, 0xcf, 0xee, 0x80, 0xf3, 0x76, 0x50, 0x8b};
  uint8_t bytes2[] = {0xc1, 0x2e, 0x24, 0x62, 0xe6, 0xbc, 0xa8, 0x9d, 0x8c, 0xec, 0x98, 0x6c,
                      0x35, 0x79, 0xea, 0xf,  0xea, 0xf9, 0x63, 0x5b, 0xd1, 0x47, 0xa0, 0x42};
  uint8_t bytes3[] = {0x6e, 0x43, 0xb9, 0x84, 0x5b, 0xe9, 0x39, 0xf, 0xc5, 0x3b, 0x49, 0x8, 0xd5, 0xe9};
  uint8_t bytes4[] = {0xf, 0x56, 0xf3, 0x83, 0x89, 0x59, 0x34, 0x4a, 0xf5, 0x2f, 0xe5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytes0}, .v = {20, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3387}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29737}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8436}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30045}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13596}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytes4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 12423, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "W(p\EOT\215,C\167\EOTJ\137\247C\\\183.\131\171\DELD$\195*\211\ETB\181", _pubPktID = 21051, _pubBody =
// "\131\218+\DC3Y.\244=\217J\173h\245\248\238\&8yD\219u\241", _pubProps = [PropContentType
// "a\SI",PropMessageExpiryInterval 28080,PropResponseInformation
// "`$\243\&1\209D\SO\229D",PropSharedSubscriptionAvailable 37,PropWillDelayInterval 14149,PropMaximumQoS
// 135,PropPayloadFormatIndicator 233,PropResponseTopic "\204\198\222\196\208l\GS.",PropSharedSubscriptionAvailable
// 125,PropPayloadFormatIndicator 142,PropWillDelayInterval 28296,PropSubscriptionIdentifier
// 11,PropRequestResponseInformation 191,PropWildcardSubscriptionAvailable 212,PropRequestProblemInformation
// 98,PropAuthenticationMethod "LJ\199*R\148|\n",PropResponseInformation
// "\247\bh\255Dh\142\224\178\&7\149\255\183\210\241\150\163\189\NUL\171\168F",PropContentType
// "\190\147\149\174\168}\v\211\168\225g{\158\254]",PropAuthenticationData "",PropResponseTopic
// "\193\157k\167\243E\156\151\238\134\177",PropSessionExpiryInterval 1889,PropSubscriptionIdentifierAvailable
// 70,PropServerReference "\251{O\213\177\243i\GS>V!\ACK\133n\235\&5\255k\144\242",PropRequestProblemInformation
// 109,PropTopicAlias 26984,PropCorrelationData "=\SYN(\SI\DLE\213\139v\191\214
// (E\143\213\210\232\DC3",PropServerKeepAlive 16628,PropMaximumPacketSize 29670,PropUserProperty "L\248\199^\157o"
// "`\139\175\"\215A\ESC\195\207\CAN\SUB\195\137\SUBFz\159\&2*\DC33R\174\n=[\246C",PropCorrelationData "&\GS"]}
TEST(Publish50QCTest, Encode32) {
  uint8_t pkt[] = {
      0x3a, 0xa5, 0x2,  0x0,  0x1a, 0x57, 0x28, 0x70, 0x4,  0xd7, 0x2c, 0x43, 0xa7, 0x4,  0x4a, 0x89, 0xf7, 0x43, 0x5c,
      0xb7, 0x2e, 0x83, 0xab, 0x7f, 0x44, 0x24, 0xc3, 0x2a, 0xd3, 0x17, 0xb5, 0x52, 0x3b, 0xf0, 0x1,  0x3,  0x0,  0x2,
      0x61, 0xf,  0x2,  0x0,  0x0,  0x6d, 0xb0, 0x1a, 0x0,  0x9,  0x60, 0x24, 0xf3, 0x31, 0xd1, 0x44, 0xe,  0xe5, 0x44,
      0x2a, 0x25, 0x18, 0x0,  0x0,  0x37, 0x45, 0x24, 0x87, 0x1,  0xe9, 0x8,  0x0,  0x8,  0xcc, 0xc6, 0xde, 0xc4, 0xd0,
      0x6c, 0x1d, 0x2e, 0x2a, 0x7d, 0x1,  0x8e, 0x18, 0x0,  0x0,  0x6e, 0x88, 0xb,  0xb,  0x19, 0xbf, 0x28, 0xd4, 0x17,
      0x62, 0x15, 0x0,  0x8,  0x4c, 0x4a, 0xc7, 0x2a, 0x52, 0x94, 0x7c, 0xa,  0x1a, 0x0,  0x16, 0xf7, 0x8,  0x68, 0xff,
      0x44, 0x68, 0x8e, 0xe0, 0xb2, 0x37, 0x95, 0xff, 0xb7, 0xd2, 0xf1, 0x96, 0xa3, 0xbd, 0x0,  0xab, 0xa8, 0x46, 0x3,
      0x0,  0xf,  0xbe, 0x93, 0x95, 0xae, 0xa8, 0x7d, 0xb,  0xd3, 0xa8, 0xe1, 0x67, 0x7b, 0x9e, 0xfe, 0x5d, 0x16, 0x0,
      0x0,  0x8,  0x0,  0xb,  0xc1, 0x9d, 0x6b, 0xa7, 0xf3, 0x45, 0x9c, 0x97, 0xee, 0x86, 0xb1, 0x11, 0x0,  0x0,  0x7,
      0x61, 0x29, 0x46, 0x1c, 0x0,  0x14, 0xfb, 0x7b, 0x4f, 0xd5, 0xb1, 0xf3, 0x69, 0x1d, 0x3e, 0x56, 0x21, 0x6,  0x85,
      0x6e, 0xeb, 0x35, 0xff, 0x6b, 0x90, 0xf2, 0x17, 0x6d, 0x23, 0x69, 0x68, 0x9,  0x0,  0x12, 0x3d, 0x16, 0x28, 0xf,
      0x10, 0xd5, 0x8b, 0x76, 0xbf, 0xd6, 0x20, 0x28, 0x45, 0x8f, 0xd5, 0xd2, 0xe8, 0x13, 0x13, 0x40, 0xf4, 0x27, 0x0,
      0x0,  0x73, 0xe6, 0x26, 0x0,  0x6,  0x4c, 0xf8, 0xc7, 0x5e, 0x9d, 0x6f, 0x0,  0x1c, 0x60, 0x8b, 0xaf, 0x22, 0xd7,
      0x41, 0x1b, 0xc3, 0xcf, 0x18, 0x1a, 0xc3, 0x89, 0x1a, 0x46, 0x7a, 0x9f, 0x32, 0x2a, 0x13, 0x33, 0x52, 0xae, 0xa,
      0x3d, 0x5b, 0xf6, 0x43, 0x9,  0x0,  0x2,  0x26, 0x1d, 0x83, 0xda, 0x2b, 0x13, 0x59, 0x2e, 0xf4, 0x3d, 0xd9, 0x4a,
      0xad, 0x68, 0xf5, 0xf8, 0xee, 0x38, 0x79, 0x44, 0xdb, 0x75, 0xf1};

  uint8_t buf[306] = {0};

  uint8_t topic_bytes[] = {0x57, 0x28, 0x70, 0x4,  0xd7, 0x2c, 0x43, 0xa7, 0x4,  0x4a, 0x89, 0xf7, 0x43,
                           0x5c, 0xb7, 0x2e, 0x83, 0xab, 0x7f, 0x44, 0x24, 0xc3, 0x2a, 0xd3, 0x17, 0xb5};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x83, 0xda, 0x2b, 0x13, 0x59, 0x2e, 0xf4, 0x3d, 0xd9, 0x4a, 0xad,
                         0x68, 0xf5, 0xf8, 0xee, 0x38, 0x79, 0x44, 0xdb, 0x75, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytes0[] = {0x61, 0xf};
  uint8_t bytes1[] = {0x60, 0x24, 0xf3, 0x31, 0xd1, 0x44, 0xe, 0xe5, 0x44};
  uint8_t bytes2[] = {0xcc, 0xc6, 0xde, 0xc4, 0xd0, 0x6c, 0x1d, 0x2e};
  uint8_t bytes3[] = {0x4c, 0x4a, 0xc7, 0x2a, 0x52, 0x94, 0x7c, 0xa};
  uint8_t bytes4[] = {0xf7, 0x8,  0x68, 0xff, 0x44, 0x68, 0x8e, 0xe0, 0xb2, 0x37, 0x95,
                      0xff, 0xb7, 0xd2, 0xf1, 0x96, 0xa3, 0xbd, 0x0,  0xab, 0xa8, 0x46};
  uint8_t bytes5[] = {0xbe, 0x93, 0x95, 0xae, 0xa8, 0x7d, 0xb, 0xd3, 0xa8, 0xe1, 0x67, 0x7b, 0x9e, 0xfe, 0x5d};
  uint8_t bytes6[] = {0};
  uint8_t bytes7[] = {0xc1, 0x9d, 0x6b, 0xa7, 0xf3, 0x45, 0x9c, 0x97, 0xee, 0x86, 0xb1};
  uint8_t bytes8[] = {0xfb, 0x7b, 0x4f, 0xd5, 0xb1, 0xf3, 0x69, 0x1d, 0x3e, 0x56,
                      0x21, 0x6,  0x85, 0x6e, 0xeb, 0x35, 0xff, 0x6b, 0x90, 0xf2};
  uint8_t bytes9[] = {0x3d, 0x16, 0x28, 0xf,  0x10, 0xd5, 0x8b, 0x76, 0xbf,
                      0xd6, 0x20, 0x28, 0x45, 0x8f, 0xd5, 0xd2, 0xe8, 0x13};
  uint8_t bytes11[] = {0x60, 0x8b, 0xaf, 0x22, 0xd7, 0x41, 0x1b, 0xc3, 0xcf, 0x18, 0x1a, 0xc3, 0x89, 0x1a,
                       0x46, 0x7a, 0x9f, 0x32, 0x2a, 0x13, 0x33, 0x52, 0xae, 0xa,  0x3d, 0x5b, 0xf6, 0x43};
  uint8_t bytes10[] = {0x4c, 0xf8, 0xc7, 0x5e, 0x9d, 0x6f};
  uint8_t bytes12[] = {0x26, 0x1d};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28080}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14149}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28296}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1889}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26984}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16628}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29670}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytes10}, .v = {28, (char*)&bytes11}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytes12}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 21051, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\231\ACK\254\SIp\166\135\GS[\235\245\182#\181\186\172xu\EOT", _pubPktID = 0, _pubBody =
// "\170\DC1*\DC3\196\248-\191\212\142:", _pubProps = [PropResponseTopic
// "\180\238>\147\208\SOH\254\251\ESC",PropSubscriptionIdentifier 21]}
TEST(Publish50QCTest, Encode33) {
  uint8_t pkt[] = {0x38, 0x2f, 0x0,  0x13, 0xe7, 0x6,  0xfe, 0xf,  0x70, 0xa6, 0x87, 0x1d, 0x5b, 0xeb, 0xf5, 0xb6, 0x23,
                   0xb5, 0xba, 0xac, 0x78, 0x75, 0x4,  0xe,  0x8,  0x0,  0x9,  0xb4, 0xee, 0x3e, 0x93, 0xd0, 0x1,  0xfe,
                   0xfb, 0x1b, 0xb,  0x15, 0xaa, 0x11, 0x2a, 0x13, 0xc4, 0xf8, 0x2d, 0xbf, 0xd4, 0x8e, 0x3a};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0xe7, 0x6,  0xfe, 0xf,  0x70, 0xa6, 0x87, 0x1d, 0x5b, 0xeb,
                           0xf5, 0xb6, 0x23, 0xb5, 0xba, 0xac, 0x78, 0x75, 0x4};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xaa, 0x11, 0x2a, 0x13, 0xc4, 0xf8, 0x2d, 0xbf, 0xd4, 0x8e, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytes0[] = {0xb4, 0xee, 0x3e, 0x93, 0xd0, 0x1, 0xfe, 0xfb, 0x1b};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESCe\222q\DC1?.N\128}{W\237:\250\ETB\SI\252(g\SIX\130\171\252\158", _pubPktID = 0, _pubBody = "\180v", _pubProps =
// [PropMessageExpiryInterval 24162,PropTopicAlias 24090,PropServerReference "REo48Y9Q\149",PropAuthenticationMethod
// "\188\138\ENQX\201t\192|\160\158A",PropSessionExpiryInterval 25361,PropContentType
// "\142\&9\178i\US\239\&7\189\170\&0\a\"}\227",PropCorrelationData "L",PropResponseTopic
// "\213\193\150\&7Fr_",PropRequestResponseInformation 78,PropRequestResponseInformation 14,PropWillDelayInterval 93]}
TEST(Publish50QCTest, Encode34) {
  uint8_t pkt[] = {0x31, 0x6e, 0x0,  0x1a, 0x1b, 0x65, 0xde, 0x71, 0x11, 0x3f, 0x2e, 0x4e, 0x80, 0x7d, 0x7b, 0x57,
                   0xed, 0x3a, 0xfa, 0x17, 0xf,  0xfc, 0x28, 0x67, 0xf,  0x58, 0x82, 0xab, 0xfc, 0x9e, 0x4f, 0x2,
                   0x0,  0x0,  0x5e, 0x62, 0x23, 0x5e, 0x1a, 0x1c, 0x0,  0x9,  0x52, 0x45, 0x6f, 0x34, 0x38, 0x59,
                   0x39, 0x51, 0x95, 0x15, 0x0,  0xb,  0xbc, 0x8a, 0x5,  0x58, 0xc9, 0x74, 0xc0, 0x7c, 0xa0, 0x9e,
                   0x41, 0x11, 0x0,  0x0,  0x63, 0x11, 0x3,  0x0,  0xe,  0x8e, 0x39, 0xb2, 0x69, 0x1f, 0xef, 0x37,
                   0xbd, 0xaa, 0x30, 0x7,  0x22, 0x7d, 0xe3, 0x9,  0x0,  0x1,  0x4c, 0x8,  0x0,  0x7,  0xd5, 0xc1,
                   0x96, 0x37, 0x46, 0x72, 0x5f, 0x19, 0x4e, 0x19, 0xe,  0x18, 0x0,  0x0,  0x0,  0x5d, 0xb4, 0x76};

  uint8_t buf[122] = {0};

  uint8_t topic_bytes[] = {0x1b, 0x65, 0xde, 0x71, 0x11, 0x3f, 0x2e, 0x4e, 0x80, 0x7d, 0x7b, 0x57, 0xed,
                           0x3a, 0xfa, 0x17, 0xf,  0xfc, 0x28, 0x67, 0xf,  0x58, 0x82, 0xab, 0xfc, 0x9e};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb4, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytes0[] = {0x52, 0x45, 0x6f, 0x34, 0x38, 0x59, 0x39, 0x51, 0x95};
  uint8_t bytes1[] = {0xbc, 0x8a, 0x5, 0x58, 0xc9, 0x74, 0xc0, 0x7c, 0xa0, 0x9e, 0x41};
  uint8_t bytes2[] = {0x8e, 0x39, 0xb2, 0x69, 0x1f, 0xef, 0x37, 0xbd, 0xaa, 0x30, 0x7, 0x22, 0x7d, 0xe3};
  uint8_t bytes3[] = {0x4c};
  uint8_t bytes4[] = {0xd5, 0xc1, 0x96, 0x37, 0x46, 0x72, 0x5f};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24162}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24090}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25361}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 93}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "6\228\247(\SUB\248\195J\179",
// _pubPktID = 16923, _pubBody = "\178", _pubProps = [PropAuthenticationMethod
// "\234\136\193aZ;\148q\168\187I\195\153\248\&5\254\128Q*\180\ACK?\163",PropAuthenticationMethod
// "\ESC'\133^\151\214\151|vvyL\FS4",PropAssignedClientIdentifier
// "\244m\214v5\\\169{\168\167\254",PropMessageExpiryInterval 2708,PropReceiveMaximum 21750,PropReceiveMaximum
// 22454,PropSubscriptionIdentifierAvailable 222,PropSharedSubscriptionAvailable 117,PropServerReference
// "\NUL\"\157p\189\208\177\184d",PropReceiveMaximum 13520,PropSubscriptionIdentifierAvailable 208,PropMaximumQoS
// 87,PropMessageExpiryInterval 14331,PropMaximumPacketSize 15803,PropUserProperty "\247\242\238F\156sz\207\ESC\140"
// "\212\195\252\ACK\242\203\STX\SI\157@\231\157\226J\SOd\136",PropServerKeepAlive 15692,PropMessageExpiryInterval
// 26840,PropSubscriptionIdentifierAvailable 90,PropServerKeepAlive 7831,PropSubscriptionIdentifier 33,PropResponseTopic
// "M4\224\219A\131"]}
TEST(Publish50QCTest, Encode35) {
  uint8_t pkt[] = {0x32, 0xad, 0x1,  0x0,  0x9,  0x36, 0xe4, 0xf7, 0x28, 0x1a, 0xf8, 0xc3, 0x4a, 0xb3, 0x42, 0x1b,
                   0x9d, 0x1,  0x15, 0x0,  0x17, 0xea, 0x88, 0xc1, 0x61, 0x5a, 0x3b, 0x94, 0x71, 0xa8, 0xbb, 0x49,
                   0xc3, 0x99, 0xf8, 0x35, 0xfe, 0x80, 0x51, 0x2a, 0xb4, 0x6,  0x3f, 0xa3, 0x15, 0x0,  0xe,  0x1b,
                   0x27, 0x85, 0x5e, 0x97, 0xd6, 0x97, 0x7c, 0x76, 0x76, 0x79, 0x4c, 0x1c, 0x34, 0x12, 0x0,  0xb,
                   0xf4, 0x6d, 0xd6, 0x76, 0x35, 0x5c, 0xa9, 0x7b, 0xa8, 0xa7, 0xfe, 0x2,  0x0,  0x0,  0xa,  0x94,
                   0x21, 0x54, 0xf6, 0x21, 0x57, 0xb6, 0x29, 0xde, 0x2a, 0x75, 0x1c, 0x0,  0x9,  0x0,  0x22, 0x9d,
                   0x70, 0xbd, 0xd0, 0xb1, 0xb8, 0x64, 0x21, 0x34, 0xd0, 0x29, 0xd0, 0x24, 0x57, 0x2,  0x0,  0x0,
                   0x37, 0xfb, 0x27, 0x0,  0x0,  0x3d, 0xbb, 0x26, 0x0,  0xa,  0xf7, 0xf2, 0xee, 0x46, 0x9c, 0x73,
                   0x7a, 0xcf, 0x1b, 0x8c, 0x0,  0x11, 0xd4, 0xc3, 0xfc, 0x6,  0xf2, 0xcb, 0x2,  0xf,  0x9d, 0x40,
                   0xe7, 0x9d, 0xe2, 0x4a, 0xe,  0x64, 0x88, 0x13, 0x3d, 0x4c, 0x2,  0x0,  0x0,  0x68, 0xd8, 0x29,
                   0x5a, 0x13, 0x1e, 0x97, 0xb,  0x21, 0x8,  0x0,  0x6,  0x4d, 0x34, 0xe0, 0xdb, 0x41, 0x83, 0xb2};

  uint8_t buf[186] = {0};

  uint8_t topic_bytes[] = {0x36, 0xe4, 0xf7, 0x28, 0x1a, 0xf8, 0xc3, 0x4a, 0xb3};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0xea, 0x88, 0xc1, 0x61, 0x5a, 0x3b, 0x94, 0x71, 0xa8, 0xbb, 0x49, 0xc3,
                      0x99, 0xf8, 0x35, 0xfe, 0x80, 0x51, 0x2a, 0xb4, 0x6,  0x3f, 0xa3};
  uint8_t bytes1[] = {0x1b, 0x27, 0x85, 0x5e, 0x97, 0xd6, 0x97, 0x7c, 0x76, 0x76, 0x79, 0x4c, 0x1c, 0x34};
  uint8_t bytes2[] = {0xf4, 0x6d, 0xd6, 0x76, 0x35, 0x5c, 0xa9, 0x7b, 0xa8, 0xa7, 0xfe};
  uint8_t bytes3[] = {0x0, 0x22, 0x9d, 0x70, 0xbd, 0xd0, 0xb1, 0xb8, 0x64};
  uint8_t bytes5[] = {0xd4, 0xc3, 0xfc, 0x6, 0xf2, 0xcb, 0x2, 0xf, 0x9d, 0x40, 0xe7, 0x9d, 0xe2, 0x4a, 0xe, 0x64, 0x88};
  uint8_t bytes4[] = {0xf7, 0xf2, 0xee, 0x46, 0x9c, 0x73, 0x7a, 0xcf, 0x1b, 0x8c};
  uint8_t bytes6[] = {0x4d, 0x34, 0xe0, 0xdb, 0x41, 0x83};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2708}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21750}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22454}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13520}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14331}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15803}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytes4}, .v = {17, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15692}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26840}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7831}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 33}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytes6}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16923, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "B\244\185\173\135\222\r/\201&\STX\197e\196Y\v\221\191\152\GS6r\131\172\188\196", _pubPktID = 7267, _pubBody =
// "ch\183\156\195l\159\210\242\FS\216/\DC4\233", _pubProps = [PropUserProperty
// "\203N\198K\224IH\203\198\DLE\147N\234\219K"
// "\227\b\\J\130\235?\184\140\150_\232m\162\165h\DEL\RS\228?\203[V\252\227",PropResponseTopic
// "\vr#Q#!\234\DEL\252\193\154\132\&8`\195q\242",PropTopicAliasMaximum 25964,PropContentType
// "\f<tX\251\200>\170E\165\218\161\206}",PropResponseInformation
// "\174c\DEL\131\149I\139W\243\&1\190\201\141<\184\179%6\172\&3n",PropMessageExpiryInterval 18451,PropMaximumQoS
// 102,PropCorrelationData
// "q\205\161\173\218c\176%\177\223\&6.\t\ETX\ESCm\179\248\217M\255\217",PropRequestProblemInformation
// 33,PropRequestProblemInformation 200,PropServerKeepAlive 13697,PropMaximumQoS 35,PropWillDelayInterval
// 2122,PropAuthenticationData "\GSa\b\236\243o\144\\",PropSessionExpiryInterval 3573,PropResponseTopic
// "\173d\FS\194i\204\194\188P\EOT\DELqi/0\233xAo\167\183\253\169\200\194",PropSessionExpiryInterval
// 11523,PropRequestProblemInformation 52,PropMessageExpiryInterval 13459,PropMessageExpiryInterval
// 10166,PropContentType "\159S\208\157\199\165\199\b\176\178\RS\215\157\209"]}
TEST(Publish50QCTest, Encode36) {
  uint8_t pkt[] = {
      0x3a, 0x97, 0x2,  0x0,  0x1a, 0x42, 0xf4, 0xb9, 0xad, 0x87, 0xde, 0xd,  0x2f, 0xc9, 0x26, 0x2,  0xc5, 0x65, 0xc4,
      0x59, 0xb,  0xdd, 0xbf, 0x98, 0x1d, 0x36, 0x72, 0x83, 0xac, 0xbc, 0xc4, 0x1c, 0x63, 0xe9, 0x1,  0x26, 0x0,  0xf,
      0xcb, 0x4e, 0xc6, 0x4b, 0xe0, 0x49, 0x48, 0xcb, 0xc6, 0x10, 0x93, 0x4e, 0xea, 0xdb, 0x4b, 0x0,  0x19, 0xe3, 0x8,
      0x5c, 0x4a, 0x82, 0xeb, 0x3f, 0xb8, 0x8c, 0x96, 0x5f, 0xe8, 0x6d, 0xa2, 0xa5, 0x68, 0x7f, 0x1e, 0xe4, 0x3f, 0xcb,
      0x5b, 0x56, 0xfc, 0xe3, 0x8,  0x0,  0x11, 0xb,  0x72, 0x23, 0x51, 0x23, 0x21, 0xea, 0x7f, 0xfc, 0xc1, 0x9a, 0x84,
      0x38, 0x60, 0xc3, 0x71, 0xf2, 0x22, 0x65, 0x6c, 0x3,  0x0,  0xe,  0xc,  0x3c, 0x74, 0x58, 0xfb, 0xc8, 0x3e, 0xaa,
      0x45, 0xa5, 0xda, 0xa1, 0xce, 0x7d, 0x1a, 0x0,  0x15, 0xae, 0x63, 0x7f, 0x83, 0x95, 0x49, 0x8b, 0x57, 0xf3, 0x31,
      0xbe, 0xc9, 0x8d, 0x3c, 0xb8, 0xb3, 0x25, 0x36, 0xac, 0x33, 0x6e, 0x2,  0x0,  0x0,  0x48, 0x13, 0x24, 0x66, 0x9,
      0x0,  0x16, 0x71, 0xcd, 0xa1, 0xad, 0xda, 0x63, 0xb0, 0x25, 0xb1, 0xdf, 0x36, 0x2e, 0x9,  0x3,  0x1b, 0x6d, 0xb3,
      0xf8, 0xd9, 0x4d, 0xff, 0xd9, 0x17, 0x21, 0x17, 0xc8, 0x13, 0x35, 0x81, 0x24, 0x23, 0x18, 0x0,  0x0,  0x8,  0x4a,
      0x16, 0x0,  0x8,  0x1d, 0x61, 0x8,  0xec, 0xf3, 0x6f, 0x90, 0x5c, 0x11, 0x0,  0x0,  0xd,  0xf5, 0x8,  0x0,  0x19,
      0xad, 0x64, 0x1c, 0xc2, 0x69, 0xcc, 0xc2, 0xbc, 0x50, 0x4,  0x7f, 0x71, 0x69, 0x2f, 0x30, 0xe9, 0x78, 0x41, 0x6f,
      0xa7, 0xb7, 0xfd, 0xa9, 0xc8, 0xc2, 0x11, 0x0,  0x0,  0x2d, 0x3,  0x17, 0x34, 0x2,  0x0,  0x0,  0x34, 0x93, 0x2,
      0x0,  0x0,  0x27, 0xb6, 0x3,  0x0,  0xe,  0x9f, 0x53, 0xd0, 0x9d, 0xc7, 0xa5, 0xc7, 0x8,  0xb0, 0xb2, 0x1e, 0xd7,
      0x9d, 0xd1, 0x63, 0x68, 0xb7, 0x9c, 0xc3, 0x6c, 0x9f, 0xd2, 0xf2, 0x1c, 0xd8, 0x2f, 0x14, 0xe9};

  uint8_t buf[292] = {0};

  uint8_t topic_bytes[] = {0x42, 0xf4, 0xb9, 0xad, 0x87, 0xde, 0xd,  0x2f, 0xc9, 0x26, 0x2,  0xc5, 0x65,
                           0xc4, 0x59, 0xb,  0xdd, 0xbf, 0x98, 0x1d, 0x36, 0x72, 0x83, 0xac, 0xbc, 0xc4};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x68, 0xb7, 0x9c, 0xc3, 0x6c, 0x9f, 0xd2, 0xf2, 0x1c, 0xd8, 0x2f, 0x14, 0xe9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytes1[] = {0xe3, 0x8,  0x5c, 0x4a, 0x82, 0xeb, 0x3f, 0xb8, 0x8c, 0x96, 0x5f, 0xe8, 0x6d,
                      0xa2, 0xa5, 0x68, 0x7f, 0x1e, 0xe4, 0x3f, 0xcb, 0x5b, 0x56, 0xfc, 0xe3};
  uint8_t bytes0[] = {0xcb, 0x4e, 0xc6, 0x4b, 0xe0, 0x49, 0x48, 0xcb, 0xc6, 0x10, 0x93, 0x4e, 0xea, 0xdb, 0x4b};
  uint8_t bytes2[] = {0xb,  0x72, 0x23, 0x51, 0x23, 0x21, 0xea, 0x7f, 0xfc,
                      0xc1, 0x9a, 0x84, 0x38, 0x60, 0xc3, 0x71, 0xf2};
  uint8_t bytes3[] = {0xc, 0x3c, 0x74, 0x58, 0xfb, 0xc8, 0x3e, 0xaa, 0x45, 0xa5, 0xda, 0xa1, 0xce, 0x7d};
  uint8_t bytes4[] = {0xae, 0x63, 0x7f, 0x83, 0x95, 0x49, 0x8b, 0x57, 0xf3, 0x31, 0xbe,
                      0xc9, 0x8d, 0x3c, 0xb8, 0xb3, 0x25, 0x36, 0xac, 0x33, 0x6e};
  uint8_t bytes5[] = {0x71, 0xcd, 0xa1, 0xad, 0xda, 0x63, 0xb0, 0x25, 0xb1, 0xdf, 0x36,
                      0x2e, 0x9,  0x3,  0x1b, 0x6d, 0xb3, 0xf8, 0xd9, 0x4d, 0xff, 0xd9};
  uint8_t bytes6[] = {0x1d, 0x61, 0x8, 0xec, 0xf3, 0x6f, 0x90, 0x5c};
  uint8_t bytes7[] = {0xad, 0x64, 0x1c, 0xc2, 0x69, 0xcc, 0xc2, 0xbc, 0x50, 0x4,  0x7f, 0x71, 0x69,
                      0x2f, 0x30, 0xe9, 0x78, 0x41, 0x6f, 0xa7, 0xb7, 0xfd, 0xa9, 0xc8, 0xc2};
  uint8_t bytes8[] = {0x9f, 0x53, 0xd0, 0x9d, 0xc7, 0xa5, 0xc7, 0x8, 0xb0, 0xb2, 0x1e, 0xd7, 0x9d, 0xd1};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytes0}, .v = {25, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25964}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18451}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13697}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2122}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3573}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11523}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13459}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10166}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytes8}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7267, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\174N\162+\219#\236%2\208\&5p\160Z\132\133%\ENQ\220", _pubPktID = 16245, _pubBody = "\208\219\197i\234Y\159",
// _pubProps = [PropReceiveMaximum 8564,PropMaximumPacketSize 24665,PropAssignedClientIdentifier
// "\231\155\&5a#\225c\170S\192\213\136\SYN\210\214b",PropMessageExpiryInterval 9468,PropPayloadFormatIndicator
// 29,PropAuthenticationData "",PropRequestResponseInformation 140,PropRetainAvailable 51,PropPayloadFormatIndicator
// 167,PropWillDelayInterval 2112,PropMessageExpiryInterval 6975,PropAuthenticationData "j\205`\214\138\133
// \193O\GS\245\158\206\t\180\217|\NUL_\SO\ACK\EOT",PropSubscriptionIdentifier 2,PropRequestResponseInformation
// 97,PropSharedSubscriptionAvailable 219,PropPayloadFormatIndicator 171,PropSharedSubscriptionAvailable
// 137,PropPayloadFormatIndicator 33,PropAuthenticationMethod
// "\NAK\175]\246\158zrg\164\182y\223\229",PropSubscriptionIdentifierAvailable 211,PropUserProperty "\184\222\225\157B["
// "\185\201\177\n",PropSubscriptionIdentifier 2,PropSubscriptionIdentifier 11,PropCorrelationData "\135",PropMaximumQoS
// 89,PropReasonString "\230]\196vs\ETXLp\157\143`\r{\187\238\227\133\215-]\202rg\DC4\208AAT\233L",PropReceiveMaximum
// 15736,PropSharedSubscriptionAvailable 99]}
TEST(Publish50QCTest, Encode37) {
  uint8_t pkt[] = {
      0x3a, 0xcb, 0x1,  0x0,  0x13, 0xae, 0x4e, 0xa2, 0x2b, 0xdb, 0x23, 0xec, 0x25, 0x32, 0xd0, 0x35, 0x70, 0xa0, 0x5a,
      0x84, 0x85, 0x25, 0x5,  0xdc, 0x3f, 0x75, 0xab, 0x1,  0x21, 0x21, 0x74, 0x27, 0x0,  0x0,  0x60, 0x59, 0x12, 0x0,
      0x10, 0xe7, 0x9b, 0x35, 0x61, 0x23, 0xe1, 0x63, 0xaa, 0x53, 0xc0, 0xd5, 0x88, 0x16, 0xd2, 0xd6, 0x62, 0x2,  0x0,
      0x0,  0x24, 0xfc, 0x1,  0x1d, 0x16, 0x0,  0x0,  0x19, 0x8c, 0x25, 0x33, 0x1,  0xa7, 0x18, 0x0,  0x0,  0x8,  0x40,
      0x2,  0x0,  0x0,  0x1b, 0x3f, 0x16, 0x0,  0x16, 0x6a, 0xcd, 0x60, 0xd6, 0x8a, 0x85, 0x20, 0xc1, 0x4f, 0x1d, 0xf5,
      0x9e, 0xce, 0x9,  0xb4, 0xd9, 0x7c, 0x0,  0x5f, 0xe,  0x6,  0x4,  0xb,  0x2,  0x19, 0x61, 0x2a, 0xdb, 0x1,  0xab,
      0x2a, 0x89, 0x1,  0x21, 0x15, 0x0,  0xd,  0x15, 0xaf, 0x5d, 0xf6, 0x9e, 0x7a, 0x72, 0x67, 0xa4, 0xb6, 0x79, 0xdf,
      0xe5, 0x29, 0xd3, 0x26, 0x0,  0x6,  0xb8, 0xde, 0xe1, 0x9d, 0x42, 0x5b, 0x0,  0x4,  0xb9, 0xc9, 0xb1, 0xa,  0xb,
      0x2,  0xb,  0xb,  0x9,  0x0,  0x1,  0x87, 0x24, 0x59, 0x1f, 0x0,  0x1e, 0xe6, 0x5d, 0xc4, 0x76, 0x73, 0x3,  0x4c,
      0x70, 0x9d, 0x8f, 0x60, 0xd,  0x7b, 0xbb, 0xee, 0xe3, 0x85, 0xd7, 0x2d, 0x5d, 0xca, 0x72, 0x67, 0x14, 0xd0, 0x41,
      0x41, 0x54, 0xe9, 0x4c, 0x21, 0x3d, 0x78, 0x2a, 0x63, 0xd0, 0xdb, 0xc5, 0x69, 0xea, 0x59, 0x9f};

  uint8_t buf[216] = {0};

  uint8_t topic_bytes[] = {0xae, 0x4e, 0xa2, 0x2b, 0xdb, 0x23, 0xec, 0x25, 0x32, 0xd0,
                           0x35, 0x70, 0xa0, 0x5a, 0x84, 0x85, 0x25, 0x5,  0xdc};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd0, 0xdb, 0xc5, 0x69, 0xea, 0x59, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytes0[] = {0xe7, 0x9b, 0x35, 0x61, 0x23, 0xe1, 0x63, 0xaa, 0x53, 0xc0, 0xd5, 0x88, 0x16, 0xd2, 0xd6, 0x62};
  uint8_t bytes1[] = {0};
  uint8_t bytes2[] = {0x6a, 0xcd, 0x60, 0xd6, 0x8a, 0x85, 0x20, 0xc1, 0x4f, 0x1d, 0xf5,
                      0x9e, 0xce, 0x9,  0xb4, 0xd9, 0x7c, 0x0,  0x5f, 0xe,  0x6,  0x4};
  uint8_t bytes3[] = {0x15, 0xaf, 0x5d, 0xf6, 0x9e, 0x7a, 0x72, 0x67, 0xa4, 0xb6, 0x79, 0xdf, 0xe5};
  uint8_t bytes5[] = {0xb9, 0xc9, 0xb1, 0xa};
  uint8_t bytes4[] = {0xb8, 0xde, 0xe1, 0x9d, 0x42, 0x5b};
  uint8_t bytes6[] = {0x87};
  uint8_t bytes7[] = {0xe6, 0x5d, 0xc4, 0x76, 0x73, 0x3,  0x4c, 0x70, 0x9d, 0x8f, 0x60, 0xd,  0x7b, 0xbb, 0xee,
                      0xe3, 0x85, 0xd7, 0x2d, 0x5d, 0xca, 0x72, 0x67, 0x14, 0xd0, 0x41, 0x41, 0x54, 0xe9, 0x4c};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8564}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24665}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9468}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2112}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6975}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytes4}, .v = {4, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15736}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16245, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "(3\136}\227\211\FS\ETB&\222\219I\US\220}\129\253\151", _pubPktID = 28557, _pubBody = "\187|", _pubProps =
// [PropTopicAlias 10592,PropRequestProblemInformation 176,PropMaximumQoS 205,PropContentType
// "\189\FS\171\DC2\230\253\b\138\209",PropWillDelayInterval 8463,PropAssignedClientIdentifier
// "G\169\190\177\189\188^\DLE\128\FS\225P\195S",PropTopicAlias 9332,PropPayloadFormatIndicator
// 45,PropAuthenticationMethod "\149\180\240 \232\238\178Su*g\152\161\239`\137\128o\177I[\147\209",PropCorrelationData
// "\203\178\143\205\232\129\221f\251L\r",PropSubscriptionIdentifierAvailable 226]}
TEST(Publish50QCTest, Encode38) {
  uint8_t pkt[] = {0x3d, 0x71, 0x0,  0x12, 0x28, 0x33, 0x88, 0x7d, 0xe3, 0xd3, 0x1c, 0x17, 0x26, 0xde, 0xdb, 0x49, 0x1f,
                   0xdc, 0x7d, 0x81, 0xfd, 0x97, 0x6f, 0x8d, 0x58, 0x23, 0x29, 0x60, 0x17, 0xb0, 0x24, 0xcd, 0x3,  0x0,
                   0x9,  0xbd, 0x1c, 0xab, 0x12, 0xe6, 0xfd, 0x8,  0x8a, 0xd1, 0x18, 0x0,  0x0,  0x21, 0xf,  0x12, 0x0,
                   0xe,  0x47, 0xa9, 0xbe, 0xb1, 0xbd, 0xbc, 0x5e, 0x10, 0x80, 0x1c, 0xe1, 0x50, 0xc3, 0x53, 0x23, 0x24,
                   0x74, 0x1,  0x2d, 0x15, 0x0,  0x17, 0x95, 0xb4, 0xf0, 0x20, 0xe8, 0xee, 0xb2, 0x53, 0x75, 0x2a, 0x67,
                   0x98, 0xa1, 0xef, 0x60, 0x89, 0x80, 0x6f, 0xb1, 0x49, 0x5b, 0x93, 0xd1, 0x9,  0x0,  0xb,  0xcb, 0xb2,
                   0x8f, 0xcd, 0xe8, 0x81, 0xdd, 0x66, 0xfb, 0x4c, 0xd,  0x29, 0xe2, 0xbb, 0x7c};

  uint8_t buf[125] = {0};

  uint8_t topic_bytes[] = {0x28, 0x33, 0x88, 0x7d, 0xe3, 0xd3, 0x1c, 0x17, 0x26,
                           0xde, 0xdb, 0x49, 0x1f, 0xdc, 0x7d, 0x81, 0xfd, 0x97};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0x7c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytes0[] = {0xbd, 0x1c, 0xab, 0x12, 0xe6, 0xfd, 0x8, 0x8a, 0xd1};
  uint8_t bytes1[] = {0x47, 0xa9, 0xbe, 0xb1, 0xbd, 0xbc, 0x5e, 0x10, 0x80, 0x1c, 0xe1, 0x50, 0xc3, 0x53};
  uint8_t bytes2[] = {0x95, 0xb4, 0xf0, 0x20, 0xe8, 0xee, 0xb2, 0x53, 0x75, 0x2a, 0x67, 0x98,
                      0xa1, 0xef, 0x60, 0x89, 0x80, 0x6f, 0xb1, 0x49, 0x5b, 0x93, 0xd1};
  uint8_t bytes3[] = {0xcb, 0xb2, 0x8f, 0xcd, 0xe8, 0x81, 0xdd, 0x66, 0xfb, 0x4c, 0xd};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10592}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8463}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9332}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 28557, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\NAK\215\235\&1\174\249\STX",
// _pubPktID = 17754, _pubBody = "\246?w\EM\240\218\fF", _pubProps = [PropSharedSubscriptionAvailable
// 232,PropRequestProblemInformation 84,PropResponseTopic
// "~\240\236\DEL\195\&5\EOT\155\245\199\137w\151",PropSharedSubscriptionAvailable 160,PropSubscriptionIdentifier
// 8,PropResponseInformation
// ")\DC4\248\159\150\218\SOH\151X\221\222\185Ywq(\216tR\193\160",PropWildcardSubscriptionAvailable
// 53,PropPayloadFormatIndicator 189,PropTopicAlias 19435,PropResponseInformation
// "\CAN\184\&5\GS\148\&8<\186\232\138\132Z\ETB\t\SOHG",PropResponseInformation
// "\203w\DEL?W\242\235\137\181;3\132)l\188\ESC\190BKL!D\255\179T\152",PropUserProperty
// "\177\145\187\226:\ENQ\153\235\227\STX!\134xs_\191E-C\155\237"
// "\150L/\224\207\227\177a;*v\212K'\198s\174\144\\\DC4\134\142r\131\217",PropAuthenticationData
// "\202\209\214\199\DC1\147\181\254{j\193\EM\208K\157\162\195\175\250\STX\EOTyt\134\209\195HU\180",PropRetainAvailable
// 137,PropSubscriptionIdentifier 12,PropTopicAliasMaximum 17491,PropTopicAliasMaximum 31162,PropSessionExpiryInterval
// 21546,PropTopicAliasMaximum 29484,PropServerKeepAlive 7974,PropResponseInformation "\170\237",PropCorrelationData
// "\SOH\239\149g\SUB\225nz",PropPayloadFormatIndicator 183,PropReasonString "\226\249\t\229}\131Dp=
// {\181",PropServerReference
// "\242\248\183>\ACK\252_\r\209d/`\199\146\228.\a\253\223i\r\175",PropSubscriptionIdentifierAvailable
// 174,PropRetainAvailable 169,PropMaximumPacketSize 922]}
TEST(Publish50QCTest, Encode39) {
  uint8_t pkt[] = {
      0x32, 0xa7, 0x2,  0x0,  0x7,  0x15, 0xd7, 0xeb, 0x31, 0xae, 0xf9, 0x2,  0x45, 0x5a, 0x92, 0x2,  0x2a, 0xe8, 0x17,
      0x54, 0x8,  0x0,  0xd,  0x7e, 0xf0, 0xec, 0x7f, 0xc3, 0x35, 0x4,  0x9b, 0xf5, 0xc7, 0x89, 0x77, 0x97, 0x2a, 0xa0,
      0xb,  0x8,  0x1a, 0x0,  0x15, 0x29, 0x14, 0xf8, 0x9f, 0x96, 0xda, 0x1,  0x97, 0x58, 0xdd, 0xde, 0xb9, 0x59, 0x77,
      0x71, 0x28, 0xd8, 0x74, 0x52, 0xc1, 0xa0, 0x28, 0x35, 0x1,  0xbd, 0x23, 0x4b, 0xeb, 0x1a, 0x0,  0x10, 0x18, 0xb8,
      0x35, 0x1d, 0x94, 0x38, 0x3c, 0xba, 0xe8, 0x8a, 0x84, 0x5a, 0x17, 0x9,  0x1,  0x47, 0x1a, 0x0,  0x1a, 0xcb, 0x77,
      0x7f, 0x3f, 0x57, 0xf2, 0xeb, 0x89, 0xb5, 0x3b, 0x33, 0x84, 0x29, 0x6c, 0xbc, 0x1b, 0xbe, 0x42, 0x4b, 0x4c, 0x21,
      0x44, 0xff, 0xb3, 0x54, 0x98, 0x26, 0x0,  0x15, 0xb1, 0x91, 0xbb, 0xe2, 0x3a, 0x5,  0x99, 0xeb, 0xe3, 0x2,  0x21,
      0x86, 0x78, 0x73, 0x5f, 0xbf, 0x45, 0x2d, 0x43, 0x9b, 0xed, 0x0,  0x19, 0x96, 0x4c, 0x2f, 0xe0, 0xcf, 0xe3, 0xb1,
      0x61, 0x3b, 0x2a, 0x76, 0xd4, 0x4b, 0x27, 0xc6, 0x73, 0xae, 0x90, 0x5c, 0x14, 0x86, 0x8e, 0x72, 0x83, 0xd9, 0x16,
      0x0,  0x1d, 0xca, 0xd1, 0xd6, 0xc7, 0x11, 0x93, 0xb5, 0xfe, 0x7b, 0x6a, 0xc1, 0x19, 0xd0, 0x4b, 0x9d, 0xa2, 0xc3,
      0xaf, 0xfa, 0x2,  0x4,  0x79, 0x74, 0x86, 0xd1, 0xc3, 0x48, 0x55, 0xb4, 0x25, 0x89, 0xb,  0xc,  0x22, 0x44, 0x53,
      0x22, 0x79, 0xba, 0x11, 0x0,  0x0,  0x54, 0x2a, 0x22, 0x73, 0x2c, 0x13, 0x1f, 0x26, 0x1a, 0x0,  0x2,  0xaa, 0xed,
      0x9,  0x0,  0x8,  0x1,  0xef, 0x95, 0x67, 0x1a, 0xe1, 0x6e, 0x7a, 0x1,  0xb7, 0x1f, 0x0,  0xc,  0xe2, 0xf9, 0x9,
      0xe5, 0x7d, 0x83, 0x44, 0x70, 0x3d, 0x20, 0x7b, 0xb5, 0x1c, 0x0,  0x16, 0xf2, 0xf8, 0xb7, 0x3e, 0x6,  0xfc, 0x5f,
      0xd,  0xd1, 0x64, 0x2f, 0x60, 0xc7, 0x92, 0xe4, 0x2e, 0x7,  0xfd, 0xdf, 0x69, 0xd,  0xaf, 0x29, 0xae, 0x25, 0xa9,
      0x27, 0x0,  0x0,  0x3,  0x9a, 0xf6, 0x3f, 0x77, 0x19, 0xf0, 0xda, 0xc,  0x46};

  uint8_t buf[308] = {0};

  uint8_t topic_bytes[] = {0x15, 0xd7, 0xeb, 0x31, 0xae, 0xf9, 0x2};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf6, 0x3f, 0x77, 0x19, 0xf0, 0xda, 0xc, 0x46};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytes0[] = {0x7e, 0xf0, 0xec, 0x7f, 0xc3, 0x35, 0x4, 0x9b, 0xf5, 0xc7, 0x89, 0x77, 0x97};
  uint8_t bytes1[] = {0x29, 0x14, 0xf8, 0x9f, 0x96, 0xda, 0x1,  0x97, 0x58, 0xdd, 0xde,
                      0xb9, 0x59, 0x77, 0x71, 0x28, 0xd8, 0x74, 0x52, 0xc1, 0xa0};
  uint8_t bytes2[] = {0x18, 0xb8, 0x35, 0x1d, 0x94, 0x38, 0x3c, 0xba, 0xe8, 0x8a, 0x84, 0x5a, 0x17, 0x9, 0x1, 0x47};
  uint8_t bytes3[] = {0xcb, 0x77, 0x7f, 0x3f, 0x57, 0xf2, 0xeb, 0x89, 0xb5, 0x3b, 0x33, 0x84, 0x29,
                      0x6c, 0xbc, 0x1b, 0xbe, 0x42, 0x4b, 0x4c, 0x21, 0x44, 0xff, 0xb3, 0x54, 0x98};
  uint8_t bytes5[] = {0x96, 0x4c, 0x2f, 0xe0, 0xcf, 0xe3, 0xb1, 0x61, 0x3b, 0x2a, 0x76, 0xd4, 0x4b,
                      0x27, 0xc6, 0x73, 0xae, 0x90, 0x5c, 0x14, 0x86, 0x8e, 0x72, 0x83, 0xd9};
  uint8_t bytes4[] = {0xb1, 0x91, 0xbb, 0xe2, 0x3a, 0x5,  0x99, 0xeb, 0xe3, 0x2, 0x21,
                      0x86, 0x78, 0x73, 0x5f, 0xbf, 0x45, 0x2d, 0x43, 0x9b, 0xed};
  uint8_t bytes6[] = {0xca, 0xd1, 0xd6, 0xc7, 0x11, 0x93, 0xb5, 0xfe, 0x7b, 0x6a, 0xc1, 0x19, 0xd0, 0x4b, 0x9d,
                      0xa2, 0xc3, 0xaf, 0xfa, 0x2,  0x4,  0x79, 0x74, 0x86, 0xd1, 0xc3, 0x48, 0x55, 0xb4};
  uint8_t bytes7[] = {0xaa, 0xed};
  uint8_t bytes8[] = {0x1, 0xef, 0x95, 0x67, 0x1a, 0xe1, 0x6e, 0x7a};
  uint8_t bytes9[] = {0xe2, 0xf9, 0x9, 0xe5, 0x7d, 0x83, 0x44, 0x70, 0x3d, 0x20, 0x7b, 0xb5};
  uint8_t bytes10[] = {0xf2, 0xf8, 0xb7, 0x3e, 0x6,  0xfc, 0x5f, 0xd,  0xd1, 0x64, 0x2f,
                       0x60, 0xc7, 0x92, 0xe4, 0x2e, 0x7,  0xfd, 0xdf, 0x69, 0xd,  0xaf};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19435}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes4}, .v = {25, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17491}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31162}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21546}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29484}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7974}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 922}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17754, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Q\188\GS\173\231\131\DC4\r\151\251\145\171\&2b\222\209\NUL\250\&4,KR", _pubPktID = 27100, _pubBody =
// "T\DC2\SO\244\150V\ENQ\RS\244\135\238\SIU#[M=#h\232\206U", _pubProps = [PropReceiveMaximum 28857,PropContentType
// "\205\239\167\US\242\FS4A\153\190\193\DC3\173$}\137l\145",PropMessageExpiryInterval 7312,PropResponseTopic
// "\166\196\170\238\"\137\\\216\214P8\t1\181\&1\219\156\236^",PropPayloadFormatIndicator 208,PropServerKeepAlive
// 30404,PropSubscriptionIdentifierAvailable 210,PropRetainAvailable 83,PropResponseInformation
// "\169\137\228`\164\182\a",PropMaximumQoS 101,PropMaximumQoS 252,PropSharedSubscriptionAvailable
// 56,PropMaximumPacketSize 16247]}
TEST(Publish50QCTest, Encode40) {
  uint8_t pkt[] = {0x35, 0x82, 0x1,  0x0,  0x16, 0x51, 0xbc, 0x1d, 0xad, 0xe7, 0x83, 0x14, 0xd,  0x97, 0xfb, 0x91, 0xab,
                   0x32, 0x62, 0xde, 0xd1, 0x0,  0xfa, 0x34, 0x2c, 0x4b, 0x52, 0x69, 0xdc, 0x51, 0x21, 0x70, 0xb9, 0x3,
                   0x0,  0x12, 0xcd, 0xef, 0xa7, 0x1f, 0xf2, 0x1c, 0x34, 0x41, 0x99, 0xbe, 0xc1, 0x13, 0xad, 0x24, 0x7d,
                   0x89, 0x6c, 0x91, 0x2,  0x0,  0x0,  0x1c, 0x90, 0x8,  0x0,  0x13, 0xa6, 0xc4, 0xaa, 0xee, 0x22, 0x89,
                   0x5c, 0xd8, 0xd6, 0x50, 0x38, 0x9,  0x31, 0xb5, 0x31, 0xdb, 0x9c, 0xec, 0x5e, 0x1,  0xd0, 0x13, 0x76,
                   0xc4, 0x29, 0xd2, 0x25, 0x53, 0x1a, 0x0,  0x7,  0xa9, 0x89, 0xe4, 0x60, 0xa4, 0xb6, 0x7,  0x24, 0x65,
                   0x24, 0xfc, 0x2a, 0x38, 0x27, 0x0,  0x0,  0x3f, 0x77, 0x54, 0x12, 0xe,  0xf4, 0x96, 0x56, 0x5,  0x1e,
                   0xf4, 0x87, 0xee, 0xf,  0x55, 0x23, 0x5b, 0x4d, 0x3d, 0x23, 0x68, 0xe8, 0xce, 0x55};

  uint8_t buf[143] = {0};

  uint8_t topic_bytes[] = {0x51, 0xbc, 0x1d, 0xad, 0xe7, 0x83, 0x14, 0xd,  0x97, 0xfb, 0x91,
                           0xab, 0x32, 0x62, 0xde, 0xd1, 0x0,  0xfa, 0x34, 0x2c, 0x4b, 0x52};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x54, 0x12, 0xe,  0xf4, 0x96, 0x56, 0x5,  0x1e, 0xf4, 0x87, 0xee,
                         0xf,  0x55, 0x23, 0x5b, 0x4d, 0x3d, 0x23, 0x68, 0xe8, 0xce, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytes0[] = {0xcd, 0xef, 0xa7, 0x1f, 0xf2, 0x1c, 0x34, 0x41, 0x99,
                      0xbe, 0xc1, 0x13, 0xad, 0x24, 0x7d, 0x89, 0x6c, 0x91};
  uint8_t bytes1[] = {0xa6, 0xc4, 0xaa, 0xee, 0x22, 0x89, 0x5c, 0xd8, 0xd6, 0x50,
                      0x38, 0x9,  0x31, 0xb5, 0x31, 0xdb, 0x9c, 0xec, 0x5e};
  uint8_t bytes2[] = {0xa9, 0x89, 0xe4, 0x60, 0xa4, 0xb6, 0x7};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28857}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7312}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30404}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16247}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 27100, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\t\199\ESC[\fQ\131\177s\220X\DC1^\151s\198\213/`\162\175,\216o\160h[\ESC", _pubPktID = 0, _pubBody = "\132",
// _pubProps = [PropAssignedClientIdentifier "\150:\SOH\223\195c\DELD",PropContentType
// "",PropWildcardSubscriptionAvailable 127,PropMessageExpiryInterval 1256,PropMaximumQoS 165,PropSubscriptionIdentifier
// 29,PropAssignedClientIdentifier
// "c{\143\174\DC1gN&\201h8\DC1\194\214\207\137\DC3\f\171\160\197\238l\flj\SI\241",PropRetainAvailable
// 246,PropPayloadFormatIndicator 218,PropMaximumQoS 100,PropReceiveMaximum 5446,PropSubscriptionIdentifierAvailable
// 80,PropWildcardSubscriptionAvailable 181,PropUserProperty
// "\164\198R\179r\202K\131`ek\214V\180Nfrk~<Q\230\233\192\168\&9}\142\FS\SOH" "\"",PropSharedSubscriptionAvailable
// 243,PropMaximumPacketSize 30868,PropWillDelayInterval 8435,PropMessageExpiryInterval
// 10574,PropSharedSubscriptionAvailable 249,PropRequestResponseInformation 129,PropTopicAlias 11232,PropMaximumQoS
// 150,PropWillDelayInterval 32726,PropResponseInformation "_\187\133",PropMessageExpiryInterval 1717,PropMaximumQoS
// 15,PropRetainAvailable 188,PropPayloadFormatIndicator 185,PropServerKeepAlive 12309]}
TEST(Publish50QCTest, Encode41) {
  uint8_t pkt[] = {0x30, 0xbe, 0x1,  0x0,  0x1d, 0xa5, 0x9,  0xc7, 0x1b, 0x5b, 0xc,  0x51, 0x83, 0xb1, 0x73, 0xdc, 0x58,
                   0x11, 0x5e, 0x97, 0x73, 0xc6, 0xd5, 0x2f, 0x60, 0xa2, 0xaf, 0x2c, 0xd8, 0x6f, 0xa0, 0x68, 0x5b, 0x1b,
                   0x9c, 0x1,  0x12, 0x0,  0x8,  0x96, 0x3a, 0x1,  0xdf, 0xc3, 0x63, 0x7f, 0x44, 0x3,  0x0,  0x0,  0x28,
                   0x7f, 0x2,  0x0,  0x0,  0x4,  0xe8, 0x24, 0xa5, 0xb,  0x1d, 0x12, 0x0,  0x1c, 0x63, 0x7b, 0x8f, 0xae,
                   0x11, 0x67, 0x4e, 0x26, 0xc9, 0x68, 0x38, 0x11, 0xc2, 0xd6, 0xcf, 0x89, 0x13, 0xc,  0xab, 0xa0, 0xc5,
                   0xee, 0x6c, 0xc,  0x6c, 0x6a, 0xf,  0xf1, 0x25, 0xf6, 0x1,  0xda, 0x24, 0x64, 0x21, 0x15, 0x46, 0x29,
                   0x50, 0x28, 0xb5, 0x26, 0x0,  0x1e, 0xa4, 0xc6, 0x52, 0xb3, 0x72, 0xca, 0x4b, 0x83, 0x60, 0x65, 0x6b,
                   0xd6, 0x56, 0xb4, 0x4e, 0x66, 0x72, 0x6b, 0x7e, 0x3c, 0x51, 0xe6, 0xe9, 0xc0, 0xa8, 0x39, 0x7d, 0x8e,
                   0x1c, 0x1,  0x0,  0x1,  0x22, 0x2a, 0xf3, 0x27, 0x0,  0x0,  0x78, 0x94, 0x18, 0x0,  0x0,  0x20, 0xf3,
                   0x2,  0x0,  0x0,  0x29, 0x4e, 0x2a, 0xf9, 0x19, 0x81, 0x23, 0x2b, 0xe0, 0x24, 0x96, 0x18, 0x0,  0x0,
                   0x7f, 0xd6, 0x1a, 0x0,  0x3,  0x5f, 0xbb, 0x85, 0x2,  0x0,  0x0,  0x6,  0xb5, 0x24, 0xf,  0x25, 0xbc,
                   0x1,  0xb9, 0x13, 0x30, 0x15, 0x84};

  uint8_t buf[203] = {0};

  uint8_t topic_bytes[] = {0xa5, 0x9,  0xc7, 0x1b, 0x5b, 0xc,  0x51, 0x83, 0xb1, 0x73, 0xdc, 0x58, 0x11, 0x5e, 0x97,
                           0x73, 0xc6, 0xd5, 0x2f, 0x60, 0xa2, 0xaf, 0x2c, 0xd8, 0x6f, 0xa0, 0x68, 0x5b, 0x1b};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x84};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0x96, 0x3a, 0x1, 0xdf, 0xc3, 0x63, 0x7f, 0x44};
  uint8_t bytes1[] = {0};
  uint8_t bytes2[] = {0x63, 0x7b, 0x8f, 0xae, 0x11, 0x67, 0x4e, 0x26, 0xc9, 0x68, 0x38, 0x11, 0xc2, 0xd6,
                      0xcf, 0x89, 0x13, 0xc,  0xab, 0xa0, 0xc5, 0xee, 0x6c, 0xc,  0x6c, 0x6a, 0xf,  0xf1};
  uint8_t bytes4[] = {0x22};
  uint8_t bytes3[] = {0xa4, 0xc6, 0x52, 0xb3, 0x72, 0xca, 0x4b, 0x83, 0x60, 0x65, 0x6b, 0xd6, 0x56, 0xb4, 0x4e,
                      0x66, 0x72, 0x6b, 0x7e, 0x3c, 0x51, 0xe6, 0xe9, 0xc0, 0xa8, 0x39, 0x7d, 0x8e, 0x1c, 0x1};
  uint8_t bytes5[] = {0x5f, 0xbb, 0x85};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1256}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5446}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytes3}, .v = {1, (char*)&bytes4}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30868}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8435}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10574}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11232}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32726}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1717}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12309}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\EM\170\165z\183C\231I\198\165a2BX\n\249\&6\157", _pubPktID = 0, _pubBody =
// "\187S\143\219\221B]\180\133k\247\STX6\v'S\152\t\STX\140J \v\173\&1", _pubProps = [PropServerReference "\239\EM<]
// )bJ\156\&70W\192",PropRequestProblemInformation 75,PropTopicAlias 14338,PropPayloadFormatIndicator
// 253,PropSubscriptionIdentifierAvailable 192,PropAuthenticationData "\230\139\ESC\GSC\233V",PropReceiveMaximum
// 21654,PropContentType "\253Q",PropRequestProblemInformation 183,PropRequestResponseInformation
// 219,PropMaximumPacketSize 29457,PropResponseInformation "@\252&GY",PropResponseTopic "\210\213h\247\142lPc
// CJ\bEJ\DELZ\NAK\139\137*\138@\132~\201\163\SUB",PropTopicAliasMaximum 21401,PropMessageExpiryInterval
// 13506,PropRequestProblemInformation 75,PropServerReference "\STX",PropResponseInformation "(\241",PropRetainAvailable
// 85,PropRequestProblemInformation 211,PropTopicAlias 26072,PropUserProperty
// ")6$\CAN\185(\165-\205\STX\212\203\245\130\129\&0+\235\247-" "\133",PropUserProperty "\140\197\129\b\172\255"
// "\169M\204\214\206Xg2\189lb\152g\212\202\DC4",PropTopicAliasMaximum 6561,PropWildcardSubscriptionAvailable 249]}
TEST(Publish50QCTest, Encode42) {
  uint8_t pkt[] = {
      0x30, 0xdd, 0x1,  0x0,  0x12, 0x19, 0xaa, 0xa5, 0x7a, 0xb7, 0x43, 0xe7, 0x49, 0xc6, 0xa5, 0x61, 0x32, 0x42, 0x58,
      0xa,  0xf9, 0x36, 0x9d, 0xae, 0x1,  0x1c, 0x0,  0xd,  0xef, 0x19, 0x3c, 0x5d, 0x20, 0x29, 0x62, 0x4a, 0x9c, 0x37,
      0x30, 0x57, 0xc0, 0x17, 0x4b, 0x23, 0x38, 0x2,  0x1,  0xfd, 0x29, 0xc0, 0x16, 0x0,  0x7,  0xe6, 0x8b, 0x1b, 0x1d,
      0x43, 0xe9, 0x56, 0x21, 0x54, 0x96, 0x3,  0x0,  0x2,  0xfd, 0x51, 0x17, 0xb7, 0x19, 0xdb, 0x27, 0x0,  0x0,  0x73,
      0x11, 0x1a, 0x0,  0x5,  0x40, 0xfc, 0x26, 0x47, 0x59, 0x8,  0x0,  0x1b, 0xd2, 0xd5, 0x68, 0xf7, 0x8e, 0x6c, 0x50,
      0x63, 0x20, 0x43, 0x4a, 0x8,  0x45, 0x4a, 0x7f, 0x5a, 0x15, 0x8b, 0x89, 0x2a, 0x8a, 0x40, 0x84, 0x7e, 0xc9, 0xa3,
      0x1a, 0x22, 0x53, 0x99, 0x2,  0x0,  0x0,  0x34, 0xc2, 0x17, 0x4b, 0x1c, 0x0,  0x1,  0x2,  0x1a, 0x0,  0x2,  0x28,
      0xf1, 0x25, 0x55, 0x17, 0xd3, 0x23, 0x65, 0xd8, 0x26, 0x0,  0x14, 0x29, 0x36, 0x24, 0x18, 0xb9, 0x28, 0xa5, 0x2d,
      0xcd, 0x2,  0xd4, 0xcb, 0xf5, 0x82, 0x81, 0x30, 0x2b, 0xeb, 0xf7, 0x2d, 0x0,  0x1,  0x85, 0x26, 0x0,  0x6,  0x8c,
      0xc5, 0x81, 0x8,  0xac, 0xff, 0x0,  0x10, 0xa9, 0x4d, 0xcc, 0xd6, 0xce, 0x58, 0x67, 0x32, 0xbd, 0x6c, 0x62, 0x98,
      0x67, 0xd4, 0xca, 0x14, 0x22, 0x19, 0xa1, 0x28, 0xf9, 0xbb, 0x53, 0x8f, 0xdb, 0xdd, 0x42, 0x5d, 0xb4, 0x85, 0x6b,
      0xf7, 0x2,  0x36, 0xb,  0x27, 0x53, 0x98, 0x9,  0x2,  0x8c, 0x4a, 0x20, 0xb,  0xad, 0x31};

  uint8_t buf[234] = {0};

  uint8_t topic_bytes[] = {0x19, 0xaa, 0xa5, 0x7a, 0xb7, 0x43, 0xe7, 0x49, 0xc6,
                           0xa5, 0x61, 0x32, 0x42, 0x58, 0xa,  0xf9, 0x36, 0x9d};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbb, 0x53, 0x8f, 0xdb, 0xdd, 0x42, 0x5d, 0xb4, 0x85, 0x6b, 0xf7, 0x2, 0x36,
                         0xb,  0x27, 0x53, 0x98, 0x9,  0x2,  0x8c, 0x4a, 0x20, 0xb,  0xad, 0x31};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytes0[] = {0xef, 0x19, 0x3c, 0x5d, 0x20, 0x29, 0x62, 0x4a, 0x9c, 0x37, 0x30, 0x57, 0xc0};
  uint8_t bytes1[] = {0xe6, 0x8b, 0x1b, 0x1d, 0x43, 0xe9, 0x56};
  uint8_t bytes2[] = {0xfd, 0x51};
  uint8_t bytes3[] = {0x40, 0xfc, 0x26, 0x47, 0x59};
  uint8_t bytes4[] = {0xd2, 0xd5, 0x68, 0xf7, 0x8e, 0x6c, 0x50, 0x63, 0x20, 0x43, 0x4a, 0x8,  0x45, 0x4a,
                      0x7f, 0x5a, 0x15, 0x8b, 0x89, 0x2a, 0x8a, 0x40, 0x84, 0x7e, 0xc9, 0xa3, 0x1a};
  uint8_t bytes5[] = {0x2};
  uint8_t bytes6[] = {0x28, 0xf1};
  uint8_t bytes8[] = {0x85};
  uint8_t bytes7[] = {0x29, 0x36, 0x24, 0x18, 0xb9, 0x28, 0xa5, 0x2d, 0xcd, 0x2,
                      0xd4, 0xcb, 0xf5, 0x82, 0x81, 0x30, 0x2b, 0xeb, 0xf7, 0x2d};
  uint8_t bytes10[] = {0xa9, 0x4d, 0xcc, 0xd6, 0xce, 0x58, 0x67, 0x32, 0xbd, 0x6c, 0x62, 0x98, 0x67, 0xd4, 0xca, 0x14};
  uint8_t bytes9[] = {0x8c, 0xc5, 0x81, 0x8, 0xac, 0xff};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14338}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21654}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29457}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21401}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13506}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26072}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytes7}, .v = {1, (char*)&bytes8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytes9}, .v = {16, (char*)&bytes10}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6561}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 249}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\DC3puWV\211\161\DC3\DC2\158\213rb\196~o", _pubProps = [PropServerReference
// "N\130\229^\ACK\207\215{\212\CAN\212o\193\163\211",PropMessageExpiryInterval 30623,PropMaximumPacketSize
// 4977,PropResponseTopic
// "\t\210\183h#\218$\204\197*\250$\241\EOT\171j\248\238\208\206\167Q\176\171\214\229\231",PropResponseTopic
// "\221\tm\DLEk\206\&5o\245\176|\248!\NUL\210",PropAuthenticationData
// "\209\&2H`\"\252\228\255l\247\234\&4\193\135\217ikb\244\155\153\214\217}\177\228",PropSubscriptionIdentifier
// 23,PropMessageExpiryInterval 15123,PropResponseInformation
// "\v1`\195\&5\EM\f\192\"\DC1\154\203\FSm\190\167\230\173`\177b\226(\208l\ENQg\239\247",PropReceiveMaximum
// 17738,PropReceiveMaximum 22356,PropContentType
// "Z\DC3\163\&9\177\192\208\SO\210-W\252\&7\198\240\159\SYN\DC1\241\251\247\169",PropMaximumPacketSize
// 26713,PropRequestProblemInformation 65,PropMaximumPacketSize 9092,PropSharedSubscriptionAvailable
// 225,PropAuthenticationMethod "\243\191;\231L\SI\234Q]\214\186w\SO\170\195Z",PropMaximumQoS 231]}
TEST(Publish50QCTest, Encode43) {
  uint8_t pkt[] = {0x31, 0xe6, 0x1,  0x0,  0x0,  0xd2, 0x1,  0x1c, 0x0,  0xf,  0x4e, 0x82, 0xe5, 0x5e, 0x6,  0xcf, 0xd7,
                   0x7b, 0xd4, 0x18, 0xd4, 0x6f, 0xc1, 0xa3, 0xd3, 0x2,  0x0,  0x0,  0x77, 0x9f, 0x27, 0x0,  0x0,  0x13,
                   0x71, 0x8,  0x0,  0x1b, 0x9,  0xd2, 0xb7, 0x68, 0x23, 0xda, 0x24, 0xcc, 0xc5, 0x2a, 0xfa, 0x24, 0xf1,
                   0x4,  0xab, 0x6a, 0xf8, 0xee, 0xd0, 0xce, 0xa7, 0x51, 0xb0, 0xab, 0xd6, 0xe5, 0xe7, 0x8,  0x0,  0xf,
                   0xdd, 0x9,  0x6d, 0x10, 0x6b, 0xce, 0x35, 0x6f, 0xf5, 0xb0, 0x7c, 0xf8, 0x21, 0x0,  0xd2, 0x16, 0x0,
                   0x1a, 0xd1, 0x32, 0x48, 0x60, 0x22, 0xfc, 0xe4, 0xff, 0x6c, 0xf7, 0xea, 0x34, 0xc1, 0x87, 0xd9, 0x69,
                   0x6b, 0x62, 0xf4, 0x9b, 0x99, 0xd6, 0xd9, 0x7d, 0xb1, 0xe4, 0xb,  0x17, 0x2,  0x0,  0x0,  0x3b, 0x13,
                   0x1a, 0x0,  0x1d, 0xb,  0x31, 0x60, 0xc3, 0x35, 0x19, 0xc,  0xc0, 0x22, 0x11, 0x9a, 0xcb, 0x1c, 0x6d,
                   0xbe, 0xa7, 0xe6, 0xad, 0x60, 0xb1, 0x62, 0xe2, 0x28, 0xd0, 0x6c, 0x5,  0x67, 0xef, 0xf7, 0x21, 0x45,
                   0x4a, 0x21, 0x57, 0x54, 0x3,  0x0,  0x16, 0x5a, 0x13, 0xa3, 0x39, 0xb1, 0xc0, 0xd0, 0xe,  0xd2, 0x2d,
                   0x57, 0xfc, 0x37, 0xc6, 0xf0, 0x9f, 0x16, 0x11, 0xf1, 0xfb, 0xf7, 0xa9, 0x27, 0x0,  0x0,  0x68, 0x59,
                   0x17, 0x41, 0x27, 0x0,  0x0,  0x23, 0x84, 0x2a, 0xe1, 0x15, 0x0,  0x10, 0xf3, 0xbf, 0x3b, 0xe7, 0x4c,
                   0xf,  0xea, 0x51, 0x5d, 0xd6, 0xba, 0x77, 0xe,  0xaa, 0xc3, 0x5a, 0x24, 0xe7, 0x13, 0x70, 0x75, 0x57,
                   0x56, 0xd3, 0xa1, 0x13, 0x12, 0x9e, 0xd5, 0x72, 0x62, 0xc4, 0x7e, 0x6f};

  uint8_t buf[243] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x13, 0x70, 0x75, 0x57, 0x56, 0xd3, 0xa1, 0x13,
                         0x12, 0x9e, 0xd5, 0x72, 0x62, 0xc4, 0x7e, 0x6f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytes0[] = {0x4e, 0x82, 0xe5, 0x5e, 0x6, 0xcf, 0xd7, 0x7b, 0xd4, 0x18, 0xd4, 0x6f, 0xc1, 0xa3, 0xd3};
  uint8_t bytes1[] = {0x9,  0xd2, 0xb7, 0x68, 0x23, 0xda, 0x24, 0xcc, 0xc5, 0x2a, 0xfa, 0x24, 0xf1, 0x4,
                      0xab, 0x6a, 0xf8, 0xee, 0xd0, 0xce, 0xa7, 0x51, 0xb0, 0xab, 0xd6, 0xe5, 0xe7};
  uint8_t bytes2[] = {0xdd, 0x9, 0x6d, 0x10, 0x6b, 0xce, 0x35, 0x6f, 0xf5, 0xb0, 0x7c, 0xf8, 0x21, 0x0, 0xd2};
  uint8_t bytes3[] = {0xd1, 0x32, 0x48, 0x60, 0x22, 0xfc, 0xe4, 0xff, 0x6c, 0xf7, 0xea, 0x34, 0xc1,
                      0x87, 0xd9, 0x69, 0x6b, 0x62, 0xf4, 0x9b, 0x99, 0xd6, 0xd9, 0x7d, 0xb1, 0xe4};
  uint8_t bytes4[] = {0xb,  0x31, 0x60, 0xc3, 0x35, 0x19, 0xc,  0xc0, 0x22, 0x11, 0x9a, 0xcb, 0x1c, 0x6d, 0xbe,
                      0xa7, 0xe6, 0xad, 0x60, 0xb1, 0x62, 0xe2, 0x28, 0xd0, 0x6c, 0x5,  0x67, 0xef, 0xf7};
  uint8_t bytes5[] = {0x5a, 0x13, 0xa3, 0x39, 0xb1, 0xc0, 0xd0, 0xe,  0xd2, 0x2d, 0x57,
                      0xfc, 0x37, 0xc6, 0xf0, 0x9f, 0x16, 0x11, 0xf1, 0xfb, 0xf7, 0xa9};
  uint8_t bytes6[] = {0xf3, 0xbf, 0x3b, 0xe7, 0x4c, 0xf, 0xea, 0x51, 0x5d, 0xd6, 0xba, 0x77, 0xe, 0xaa, 0xc3, 0x5a};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30623}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4977}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15123}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17738}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22356}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26713}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9092}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\183\171\EM\217\146\128\EOT",
// _pubPktID = 4653, _pubBody = "n\237\EMMW\138\234\154\191\141\158", _pubProps = [PropPayloadFormatIndicator
// 160,PropCorrelationData "\170\169e}\SUB3%\186\201\169-\167\DC4#\ENQ",PropMessageExpiryInterval
// 12439,PropPayloadFormatIndicator 179,PropContentType "\237\231\SO",PropWildcardSubscriptionAvailable
// 10,PropMessageExpiryInterval 27839,PropMessageExpiryInterval 692,PropTopicAliasMaximum
// 30757,PropRequestResponseInformation 215,PropMaximumQoS 178]}
TEST(Publish50QCTest, Encode44) {
  uint8_t pkt[] = {0x3d, 0x4b, 0x0,  0x7,  0xb7, 0xab, 0x19, 0xd9, 0x92, 0x80, 0x4,  0x12, 0x2d, 0x34, 0x1,  0xa0,
                   0x9,  0x0,  0xf,  0xaa, 0xa9, 0x65, 0x7d, 0x1a, 0x33, 0x25, 0xba, 0xc9, 0xa9, 0x2d, 0xa7, 0x14,
                   0x23, 0x5,  0x2,  0x0,  0x0,  0x30, 0x97, 0x1,  0xb3, 0x3,  0x0,  0x3,  0xed, 0xe7, 0xe,  0x28,
                   0xa,  0x2,  0x0,  0x0,  0x6c, 0xbf, 0x2,  0x0,  0x0,  0x2,  0xb4, 0x22, 0x78, 0x25, 0x19, 0xd7,
                   0x24, 0xb2, 0x6e, 0xed, 0x19, 0x4d, 0x57, 0x8a, 0xea, 0x9a, 0xbf, 0x8d, 0x9e};

  uint8_t buf[87] = {0};

  uint8_t topic_bytes[] = {0xb7, 0xab, 0x19, 0xd9, 0x92, 0x80, 0x4};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0xed, 0x19, 0x4d, 0x57, 0x8a, 0xea, 0x9a, 0xbf, 0x8d, 0x9e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytes0[] = {0xaa, 0xa9, 0x65, 0x7d, 0x1a, 0x33, 0x25, 0xba, 0xc9, 0xa9, 0x2d, 0xa7, 0x14, 0x23, 0x5};
  uint8_t bytes1[] = {0xed, 0xe7, 0xe};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12439}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27839}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 692}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30757}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 4653, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC4\238q\ACK\ESC\142Z\GS\147\186\v?\208O", _pubPktID = 0, _pubBody = "Q4\149", _pubProps =
// [PropMessageExpiryInterval 27768,PropReceiveMaximum 25021,PropServerKeepAlive 3033,PropSessionExpiryInterval
// 32101,PropTopicAlias 8081,PropServerReference "}\ESC\227\161{\148K,\162\240",PropSubscriptionIdentifierAvailable
// 199,PropSessionExpiryInterval 26243,PropServerKeepAlive 23252,PropWildcardSubscriptionAvailable
// 242,PropPayloadFormatIndicator 228,PropMessageExpiryInterval 642,PropSharedSubscriptionAvailable
// 78,PropSharedSubscriptionAvailable 4,PropReceiveMaximum 2802,PropAssignedClientIdentifier
// "*jt\210\138@w\SYN|\USy",PropAuthenticationMethod
// "\180\SOHa\177\182\218\&7$\EM3\218\131\249\171d\GSoLA",PropRetainAvailable 173,PropMessageExpiryInterval
// 17814,PropSessionExpiryInterval 27345,PropSharedSubscriptionAvailable 40,PropReceiveMaximum 26257,PropServerKeepAlive
// 13725]}
TEST(Publish50QCTest, Encode45) {
  uint8_t pkt[] = {0x30, 0x86, 0x1,  0x0,  0xe,  0x14, 0xee, 0x71, 0x6,  0x1b, 0x8e, 0x5a, 0x1d, 0x93, 0xba, 0xb,
                   0x3f, 0xd0, 0x4f, 0x72, 0x2,  0x0,  0x0,  0x6c, 0x78, 0x21, 0x61, 0xbd, 0x13, 0xb,  0xd9, 0x11,
                   0x0,  0x0,  0x7d, 0x65, 0x23, 0x1f, 0x91, 0x1c, 0x0,  0xa,  0x7d, 0x1b, 0xe3, 0xa1, 0x7b, 0x94,
                   0x4b, 0x2c, 0xa2, 0xf0, 0x29, 0xc7, 0x11, 0x0,  0x0,  0x66, 0x83, 0x13, 0x5a, 0xd4, 0x28, 0xf2,
                   0x1,  0xe4, 0x2,  0x0,  0x0,  0x2,  0x82, 0x2a, 0x4e, 0x2a, 0x4,  0x21, 0xa,  0xf2, 0x12, 0x0,
                   0xb,  0x2a, 0x6a, 0x74, 0xd2, 0x8a, 0x40, 0x77, 0x16, 0x7c, 0x1f, 0x79, 0x15, 0x0,  0x13, 0xb4,
                   0x1,  0x61, 0xb1, 0xb6, 0xda, 0x37, 0x24, 0x19, 0x33, 0xda, 0x83, 0xf9, 0xab, 0x64, 0x1d, 0x6f,
                   0x4c, 0x41, 0x25, 0xad, 0x2,  0x0,  0x0,  0x45, 0x96, 0x11, 0x0,  0x0,  0x6a, 0xd1, 0x2a, 0x28,
                   0x21, 0x66, 0x91, 0x13, 0x35, 0x9d, 0x51, 0x34, 0x95};

  uint8_t buf[147] = {0};

  uint8_t topic_bytes[] = {0x14, 0xee, 0x71, 0x6, 0x1b, 0x8e, 0x5a, 0x1d, 0x93, 0xba, 0xb, 0x3f, 0xd0, 0x4f};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x51, 0x34, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytes0[] = {0x7d, 0x1b, 0xe3, 0xa1, 0x7b, 0x94, 0x4b, 0x2c, 0xa2, 0xf0};
  uint8_t bytes1[] = {0x2a, 0x6a, 0x74, 0xd2, 0x8a, 0x40, 0x77, 0x16, 0x7c, 0x1f, 0x79};
  uint8_t bytes2[] = {0xb4, 0x1,  0x61, 0xb1, 0xb6, 0xda, 0x37, 0x24, 0x19, 0x33,
                      0xda, 0x83, 0xf9, 0xab, 0x64, 0x1d, 0x6f, 0x4c, 0x41};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27768}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25021}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3033}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32101}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8081}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26243}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23252}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 642}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2802}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17814}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27345}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26257}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13725}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\180=\US\SYN\229\232", _pubPktID =
// 28144, _pubBody = "\SYN\238,\186\225\221v\229\138\172", _pubProps = [PropServerReference
// "\ETB\194\214\169Hf-6U\198\241",PropAuthenticationData "\147\252\ACK\DLE\193\150LS\133\247\159\187",PropResponseTopic
// "{\255\195\STX\152#\182\174\161\186\157\165\SOH\\n\204l\235\235'\144\SYN\251@\166\&5\r5z",PropAuthenticationData
// "\214\135\147e;\152\128\v\139\204\&7h_\190\CAN",PropUserProperty
// "L\213\140\220L\184\129\190\251\205\144\NAK\168\156d" "\224\172",PropMaximumQoS 19,PropAuthenticationMethod
// "\245\130C\228\v\143o\195\184\SYN\FS\131\162\DC4\253(W\149\169",PropAssignedClientIdentifier
// "X\ESC",PropMessageExpiryInterval 4167,PropSessionExpiryInterval 11631,PropCorrelationData
// "\DLE\US\208Q",PropServerKeepAlive 17776,PropAuthenticationMethod "\143g\170\RSu\174\185\238e\\*i",PropReceiveMaximum
// 1155,PropReceiveMaximum 10234]}
TEST(Publish50QCTest, Encode46) {
  uint8_t pkt[] = {0x35, 0xc1, 0x1,  0x0,  0x6,  0xb4, 0x3d, 0x1f, 0x16, 0xe5, 0xe8, 0x6d, 0xf0, 0xab, 0x1,  0x1c, 0x0,
                   0xb,  0x17, 0xc2, 0xd6, 0xa9, 0x48, 0x66, 0x2d, 0x36, 0x55, 0xc6, 0xf1, 0x16, 0x0,  0xc,  0x93, 0xfc,
                   0x6,  0x10, 0xc1, 0x96, 0x4c, 0x53, 0x85, 0xf7, 0x9f, 0xbb, 0x8,  0x0,  0x1d, 0x7b, 0xff, 0xc3, 0x2,
                   0x98, 0x23, 0xb6, 0xae, 0xa1, 0xba, 0x9d, 0xa5, 0x1,  0x5c, 0x6e, 0xcc, 0x6c, 0xeb, 0xeb, 0x27, 0x90,
                   0x16, 0xfb, 0x40, 0xa6, 0x35, 0xd,  0x35, 0x7a, 0x16, 0x0,  0xf,  0xd6, 0x87, 0x93, 0x65, 0x3b, 0x98,
                   0x80, 0xb,  0x8b, 0xcc, 0x37, 0x68, 0x5f, 0xbe, 0x18, 0x26, 0x0,  0xf,  0x4c, 0xd5, 0x8c, 0xdc, 0x4c,
                   0xb8, 0x81, 0xbe, 0xfb, 0xcd, 0x90, 0x15, 0xa8, 0x9c, 0x64, 0x0,  0x2,  0xe0, 0xac, 0x24, 0x13, 0x15,
                   0x0,  0x13, 0xf5, 0x82, 0x43, 0xe4, 0xb,  0x8f, 0x6f, 0xc3, 0xb8, 0x16, 0x1c, 0x83, 0xa2, 0x14, 0xfd,
                   0x28, 0x57, 0x95, 0xa9, 0x12, 0x0,  0x2,  0x58, 0x1b, 0x2,  0x0,  0x0,  0x10, 0x47, 0x11, 0x0,  0x0,
                   0x2d, 0x6f, 0x9,  0x0,  0x4,  0x10, 0x1f, 0xd0, 0x51, 0x13, 0x45, 0x70, 0x15, 0x0,  0xc,  0x8f, 0x67,
                   0xaa, 0x1e, 0x75, 0xae, 0xb9, 0xee, 0x65, 0x5c, 0x2a, 0x69, 0x21, 0x4,  0x83, 0x21, 0x27, 0xfa, 0x16,
                   0xee, 0x2c, 0xba, 0xe1, 0xdd, 0x76, 0xe5, 0x8a, 0xac};

  uint8_t buf[206] = {0};

  uint8_t topic_bytes[] = {0xb4, 0x3d, 0x1f, 0x16, 0xe5, 0xe8};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x16, 0xee, 0x2c, 0xba, 0xe1, 0xdd, 0x76, 0xe5, 0x8a, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytes0[] = {0x17, 0xc2, 0xd6, 0xa9, 0x48, 0x66, 0x2d, 0x36, 0x55, 0xc6, 0xf1};
  uint8_t bytes1[] = {0x93, 0xfc, 0x6, 0x10, 0xc1, 0x96, 0x4c, 0x53, 0x85, 0xf7, 0x9f, 0xbb};
  uint8_t bytes2[] = {0x7b, 0xff, 0xc3, 0x2,  0x98, 0x23, 0xb6, 0xae, 0xa1, 0xba, 0x9d, 0xa5, 0x1,  0x5c, 0x6e,
                      0xcc, 0x6c, 0xeb, 0xeb, 0x27, 0x90, 0x16, 0xfb, 0x40, 0xa6, 0x35, 0xd,  0x35, 0x7a};
  uint8_t bytes3[] = {0xd6, 0x87, 0x93, 0x65, 0x3b, 0x98, 0x80, 0xb, 0x8b, 0xcc, 0x37, 0x68, 0x5f, 0xbe, 0x18};
  uint8_t bytes5[] = {0xe0, 0xac};
  uint8_t bytes4[] = {0x4c, 0xd5, 0x8c, 0xdc, 0x4c, 0xb8, 0x81, 0xbe, 0xfb, 0xcd, 0x90, 0x15, 0xa8, 0x9c, 0x64};
  uint8_t bytes6[] = {0xf5, 0x82, 0x43, 0xe4, 0xb,  0x8f, 0x6f, 0xc3, 0xb8, 0x16,
                      0x1c, 0x83, 0xa2, 0x14, 0xfd, 0x28, 0x57, 0x95, 0xa9};
  uint8_t bytes7[] = {0x58, 0x1b};
  uint8_t bytes8[] = {0x10, 0x1f, 0xd0, 0x51};
  uint8_t bytes9[] = {0x8f, 0x67, 0xaa, 0x1e, 0x75, 0xae, 0xb9, 0xee, 0x65, 0x5c, 0x2a, 0x69};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytes4}, .v = {2, (char*)&bytes5}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4167}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11631}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17776}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1155}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10234}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 28144, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\186\182n\166", _pubPktID = 0,
// _pubBody = "\234+5&F\SYN\140C!\209\ACK\141C\138\180\SOH", _pubProps = [PropTopicAliasMaximum 25404,PropReceiveMaximum
// 6654,PropMaximumQoS 8,PropMaximumQoS 62,PropTopicAliasMaximum 9154,PropResponseInformation
// "f\246\228\213\ENQ\179\DEL^\a\175r\148\154\168\DLE\CAN\170\193\r\254\&5\v\147;",PropMessageExpiryInterval
// 32152,PropPayloadFormatIndicator 23,PropTopicAlias 24375,PropAssignedClientIdentifier
// "\183\220\131\158&\199C\135\SInK_j\211K:F\129\220\229\181\193,\255\246",PropSharedSubscriptionAvailable
// 89,PropServerKeepAlive 9806,PropMaximumQoS 145,PropWillDelayInterval 5362]}
TEST(Publish50QCTest, Encode47) {
  uint8_t pkt[] = {0x39, 0x71, 0x0,  0x4,  0xba, 0xb6, 0x6e, 0xa6, 0x5a, 0x22, 0x63, 0x3c, 0x21, 0x19, 0xfe, 0x24, 0x8,
                   0x24, 0x3e, 0x22, 0x23, 0xc2, 0x1a, 0x0,  0x18, 0x66, 0xf6, 0xe4, 0xd5, 0x5,  0xb3, 0x7f, 0x5e, 0x7,
                   0xaf, 0x72, 0x94, 0x9a, 0xa8, 0x10, 0x18, 0xaa, 0xc1, 0xd,  0xfe, 0x35, 0xb,  0x93, 0x3b, 0x2,  0x0,
                   0x0,  0x7d, 0x98, 0x1,  0x17, 0x23, 0x5f, 0x37, 0x12, 0x0,  0x19, 0xb7, 0xdc, 0x83, 0x9e, 0x26, 0xc7,
                   0x43, 0x87, 0xf,  0x6e, 0x4b, 0x5f, 0x6a, 0xd3, 0x4b, 0x3a, 0x46, 0x81, 0xdc, 0xe5, 0xb5, 0xc1, 0x2c,
                   0xff, 0xf6, 0x2a, 0x59, 0x13, 0x26, 0x4e, 0x24, 0x91, 0x18, 0x0,  0x0,  0x14, 0xf2, 0xea, 0x2b, 0x35,
                   0x26, 0x46, 0x16, 0x8c, 0x43, 0x21, 0xd1, 0x6,  0x8d, 0x43, 0x8a, 0xb4, 0x1};

  uint8_t buf[125] = {0};

  uint8_t topic_bytes[] = {0xba, 0xb6, 0x6e, 0xa6};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xea, 0x2b, 0x35, 0x26, 0x46, 0x16, 0x8c, 0x43, 0x21, 0xd1, 0x6, 0x8d, 0x43, 0x8a, 0xb4, 0x1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytes0[] = {0x66, 0xf6, 0xe4, 0xd5, 0x5,  0xb3, 0x7f, 0x5e, 0x7,  0xaf, 0x72, 0x94,
                      0x9a, 0xa8, 0x10, 0x18, 0xaa, 0xc1, 0xd,  0xfe, 0x35, 0xb,  0x93, 0x3b};
  uint8_t bytes1[] = {0xb7, 0xdc, 0x83, 0x9e, 0x26, 0xc7, 0x43, 0x87, 0xf,  0x6e, 0x4b, 0x5f, 0x6a,
                      0xd3, 0x4b, 0x3a, 0x46, 0x81, 0xdc, 0xe5, 0xb5, 0xc1, 0x2c, 0xff, 0xf6};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25404}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6654}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9154}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32152}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24375}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9806}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5362}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "3", _pubPktID = 0, _pubBody =
// "\DLE5\164cC\229MU\SYN0\131\230UV\187\196 1\210[2\232", _pubProps = [PropReceiveMaximum 11051,PropResponseInformation
// "\237\DC1\140F\SO\185\201\227\173.\211\163\133_~\170e\216\SOS\195\220oN\183\SOH/N\207",PropWildcardSubscriptionAvailable
// 149,PropServerReference "\150\193",PropMessageExpiryInterval 9974,PropWillDelayInterval 9412,PropResponseTopic
// "\171\149)g\242\ENQ\253f",PropAuthenticationData
// "u?\194aH/\233'\182\151\210\150\194c0\201\249\220\EM\163:d\132\140\135\233\179V\DC1\EOT",PropMessageExpiryInterval
// 11961,PropMessageExpiryInterval 11754,PropMaximumPacketSize 9547,PropServerReference
// "\161\234\240<w\224\DLET",PropUserProperty
// "qn\168\250\252I\SYN\EM\172,\b\200\173B\203\255\178\253\154\&6S\191\SO\137P"
// "\RSwl\185?\139\192<qa\ENQv\137\ETX\246\196\178C\DC4\248\206\183\132+M",PropMaximumQoS
// 110,PropWildcardSubscriptionAvailable 245,PropResponseInformation
// "\168\171\189\230up\208N\128\DELv\193\DEL3\FSh\164",PropUserProperty
// "I\235\233)\174\140\&8\187-\248\154\163:;\157\184\214)\182tt\184"
// "\DLE\138UV:<\ENQNk\149\\\EM\211",PropWildcardSubscriptionAvailable 168]}
TEST(Publish50QCTest, Encode48) {
  uint8_t pkt[] = {
      0x38, 0x8e, 0x2,  0x0,  0x1,  0x33, 0xf3, 0x1,  0x21, 0x2b, 0x2b, 0x1a, 0x0,  0x1d, 0xed, 0x11, 0x8c, 0x46, 0xe,
      0xb9, 0xc9, 0xe3, 0xad, 0x2e, 0xd3, 0xa3, 0x85, 0x5f, 0x7e, 0xaa, 0x65, 0xd8, 0xe,  0x53, 0xc3, 0xdc, 0x6f, 0x4e,
      0xb7, 0x1,  0x2f, 0x4e, 0xcf, 0x28, 0x95, 0x1c, 0x0,  0x2,  0x96, 0xc1, 0x2,  0x0,  0x0,  0x26, 0xf6, 0x18, 0x0,
      0x0,  0x24, 0xc4, 0x8,  0x0,  0x8,  0xab, 0x95, 0x29, 0x67, 0xf2, 0x5,  0xfd, 0x66, 0x16, 0x0,  0x1e, 0x75, 0x3f,
      0xc2, 0x61, 0x48, 0x2f, 0xe9, 0x27, 0xb6, 0x97, 0xd2, 0x96, 0xc2, 0x63, 0x30, 0xc9, 0xf9, 0xdc, 0x19, 0xa3, 0x3a,
      0x64, 0x84, 0x8c, 0x87, 0xe9, 0xb3, 0x56, 0x11, 0x4,  0x2,  0x0,  0x0,  0x2e, 0xb9, 0x2,  0x0,  0x0,  0x2d, 0xea,
      0x27, 0x0,  0x0,  0x25, 0x4b, 0x1c, 0x0,  0x8,  0xa1, 0xea, 0xf0, 0x3c, 0x77, 0xe0, 0x10, 0x54, 0x26, 0x0,  0x19,
      0x71, 0x6e, 0xa8, 0xfa, 0xfc, 0x49, 0x16, 0x19, 0xac, 0x2c, 0x8,  0xc8, 0xad, 0x42, 0xcb, 0xff, 0xb2, 0xfd, 0x9a,
      0x36, 0x53, 0xbf, 0xe,  0x89, 0x50, 0x0,  0x19, 0x1e, 0x77, 0x6c, 0xb9, 0x3f, 0x8b, 0xc0, 0x3c, 0x71, 0x61, 0x5,
      0x76, 0x89, 0x3,  0xf6, 0xc4, 0xb2, 0x43, 0x14, 0xf8, 0xce, 0xb7, 0x84, 0x2b, 0x4d, 0x24, 0x6e, 0x28, 0xf5, 0x1a,
      0x0,  0x11, 0xa8, 0xab, 0xbd, 0xe6, 0x75, 0x70, 0xd0, 0x4e, 0x80, 0x7f, 0x76, 0xc1, 0x7f, 0x33, 0x1c, 0x68, 0xa4,
      0x26, 0x0,  0x16, 0x49, 0xeb, 0xe9, 0x29, 0xae, 0x8c, 0x38, 0xbb, 0x2d, 0xf8, 0x9a, 0xa3, 0x3a, 0x3b, 0x9d, 0xb8,
      0xd6, 0x29, 0xb6, 0x74, 0x74, 0xb8, 0x0,  0xd,  0x10, 0x8a, 0x55, 0x56, 0x3a, 0x3c, 0x5,  0x4e, 0x6b, 0x95, 0x5c,
      0x19, 0xd3, 0x28, 0xa8, 0x10, 0x35, 0xa4, 0x63, 0x43, 0xe5, 0x4d, 0x55, 0x16, 0x30, 0x83, 0xe6, 0x55, 0x56, 0xbb,
      0xc4, 0x20, 0x31, 0xd2, 0x5b, 0x32, 0xe8};

  uint8_t buf[283] = {0};

  uint8_t topic_bytes[] = {0x33};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x10, 0x35, 0xa4, 0x63, 0x43, 0xe5, 0x4d, 0x55, 0x16, 0x30, 0x83,
                         0xe6, 0x55, 0x56, 0xbb, 0xc4, 0x20, 0x31, 0xd2, 0x5b, 0x32, 0xe8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytes0[] = {0xed, 0x11, 0x8c, 0x46, 0xe,  0xb9, 0xc9, 0xe3, 0xad, 0x2e, 0xd3, 0xa3, 0x85, 0x5f, 0x7e,
                      0xaa, 0x65, 0xd8, 0xe,  0x53, 0xc3, 0xdc, 0x6f, 0x4e, 0xb7, 0x1,  0x2f, 0x4e, 0xcf};
  uint8_t bytes1[] = {0x96, 0xc1};
  uint8_t bytes2[] = {0xab, 0x95, 0x29, 0x67, 0xf2, 0x5, 0xfd, 0x66};
  uint8_t bytes3[] = {0x75, 0x3f, 0xc2, 0x61, 0x48, 0x2f, 0xe9, 0x27, 0xb6, 0x97, 0xd2, 0x96, 0xc2, 0x63, 0x30,
                      0xc9, 0xf9, 0xdc, 0x19, 0xa3, 0x3a, 0x64, 0x84, 0x8c, 0x87, 0xe9, 0xb3, 0x56, 0x11, 0x4};
  uint8_t bytes4[] = {0xa1, 0xea, 0xf0, 0x3c, 0x77, 0xe0, 0x10, 0x54};
  uint8_t bytes6[] = {0x1e, 0x77, 0x6c, 0xb9, 0x3f, 0x8b, 0xc0, 0x3c, 0x71, 0x61, 0x5,  0x76, 0x89,
                      0x3,  0xf6, 0xc4, 0xb2, 0x43, 0x14, 0xf8, 0xce, 0xb7, 0x84, 0x2b, 0x4d};
  uint8_t bytes5[] = {0x71, 0x6e, 0xa8, 0xfa, 0xfc, 0x49, 0x16, 0x19, 0xac, 0x2c, 0x8,  0xc8, 0xad,
                      0x42, 0xcb, 0xff, 0xb2, 0xfd, 0x9a, 0x36, 0x53, 0xbf, 0xe,  0x89, 0x50};
  uint8_t bytes7[] = {0xa8, 0xab, 0xbd, 0xe6, 0x75, 0x70, 0xd0, 0x4e, 0x80,
                      0x7f, 0x76, 0xc1, 0x7f, 0x33, 0x1c, 0x68, 0xa4};
  uint8_t bytes9[] = {0x10, 0x8a, 0x55, 0x56, 0x3a, 0x3c, 0x5, 0x4e, 0x6b, 0x95, 0x5c, 0x19, 0xd3};
  uint8_t bytes8[] = {0x49, 0xeb, 0xe9, 0x29, 0xae, 0x8c, 0x38, 0xbb, 0x2d, 0xf8, 0x9a,
                      0xa3, 0x3a, 0x3b, 0x9d, 0xb8, 0xd6, 0x29, 0xb6, 0x74, 0x74, 0xb8};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11051}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9974}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9412}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11961}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11754}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9547}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytes5}, .v = {25, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytes8}, .v = {13, (char*)&bytes9}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 168}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\SUB\NUL\215\&1\153\202&79\r",
// _pubPktID = 0, _pubBody = "c\217\202\193\156\199\202\222\SO\143\145\202\135\136\239\147Z\197\245\196\133\249\191A",
// _pubProps = [PropPayloadFormatIndicator 59,PropRequestProblemInformation 156,PropWildcardSubscriptionAvailable
// 155,PropSessionExpiryInterval 11434,PropMaximumPacketSize 9881,PropResponseTopic
// "\208\158\246{?\254G\160}\134\150\&5\159\158\219\152\201",PropServerReference ">j",PropWillDelayInterval
// 18837,PropMaximumPacketSize 6933,PropWillDelayInterval 1171,PropRequestProblemInformation 103,PropTopicAliasMaximum
// 27814,PropPayloadFormatIndicator 5,PropRequestResponseInformation 211,PropCorrelationData "\129\&6:\159OC\247"]}
TEST(Publish50QCTest, Encode49) {
  uint8_t pkt[] = {0x31, 0x71, 0x0,  0xb,  0x93, 0x1a, 0x0,  0xd7, 0x31, 0x99, 0xca, 0x26, 0x37, 0x39, 0xd,  0x4b, 0x1,
                   0x3b, 0x17, 0x9c, 0x28, 0x9b, 0x11, 0x0,  0x0,  0x2c, 0xaa, 0x27, 0x0,  0x0,  0x26, 0x99, 0x8,  0x0,
                   0x11, 0xd0, 0x9e, 0xf6, 0x7b, 0x3f, 0xfe, 0x47, 0xa0, 0x7d, 0x86, 0x96, 0x35, 0x9f, 0x9e, 0xdb, 0x98,
                   0xc9, 0x1c, 0x0,  0x2,  0x3e, 0x6a, 0x18, 0x0,  0x0,  0x49, 0x95, 0x27, 0x0,  0x0,  0x1b, 0x15, 0x18,
                   0x0,  0x0,  0x4,  0x93, 0x17, 0x67, 0x22, 0x6c, 0xa6, 0x1,  0x5,  0x19, 0xd3, 0x9,  0x0,  0x7,  0x81,
                   0x36, 0x3a, 0x9f, 0x4f, 0x43, 0xf7, 0x63, 0xd9, 0xca, 0xc1, 0x9c, 0xc7, 0xca, 0xde, 0xe,  0x8f, 0x91,
                   0xca, 0x87, 0x88, 0xef, 0x93, 0x5a, 0xc5, 0xf5, 0xc4, 0x85, 0xf9, 0xbf, 0x41};

  uint8_t buf[125] = {0};

  uint8_t topic_bytes[] = {0x93, 0x1a, 0x0, 0xd7, 0x31, 0x99, 0xca, 0x26, 0x37, 0x39, 0xd};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x63, 0xd9, 0xca, 0xc1, 0x9c, 0xc7, 0xca, 0xde, 0xe,  0x8f, 0x91, 0xca,
                         0x87, 0x88, 0xef, 0x93, 0x5a, 0xc5, 0xf5, 0xc4, 0x85, 0xf9, 0xbf, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0xd0, 0x9e, 0xf6, 0x7b, 0x3f, 0xfe, 0x47, 0xa0, 0x7d,
                      0x86, 0x96, 0x35, 0x9f, 0x9e, 0xdb, 0x98, 0xc9};
  uint8_t bytes1[] = {0x3e, 0x6a};
  uint8_t bytes2[] = {0x81, 0x36, 0x3a, 0x9f, 0x4f, 0x43, 0xf7};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11434}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9881}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18837}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6933}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1171}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27814}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytes2}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\199\220\252\SI\147K\173", _pubPktID
// = 22359, _pubBody = "\179\135\192#+E7,\SO&0\CAN\239\145\190\193\159\161\ETX\v\205~yy\158v\209Tt\143", _pubProps =
// [PropSharedSubscriptionAvailable 148,PropAuthenticationData "",PropRequestProblemInformation
// 0,PropMessageExpiryInterval 7957,PropAuthenticationData
// "\146p\161Z\171\190\138j\133\135G\205\t\248\243\204\ETB\228\171\US\150\188\223\&4\f_\ESC",PropReceiveMaximum
// 26413,PropMaximumPacketSize 19648,PropCorrelationData "\219>\138\164.\130",PropSubscriptionIdentifierAvailable
// 113,PropPayloadFormatIndicator 27,PropReasonString "w\233j\150#\243\USpoz\183",PropSubscriptionIdentifier
// 27,PropSubscriptionIdentifier 3]}
TEST(Publish50QCTest, Encode50) {
  uint8_t pkt[] = {0x35, 0x7b, 0x0,  0x7,  0xc7, 0xdc, 0xfc, 0xf,  0x93, 0x4b, 0xad, 0x57, 0x57, 0x51, 0x2a, 0x94,
                   0x16, 0x0,  0x0,  0x17, 0x0,  0x2,  0x0,  0x0,  0x1f, 0x15, 0x16, 0x0,  0x1b, 0x92, 0x70, 0xa1,
                   0x5a, 0xab, 0xbe, 0x8a, 0x6a, 0x85, 0x87, 0x47, 0xcd, 0x9,  0xf8, 0xf3, 0xcc, 0x17, 0xe4, 0xab,
                   0x1f, 0x96, 0xbc, 0xdf, 0x34, 0xc,  0x5f, 0x1b, 0x21, 0x67, 0x2d, 0x27, 0x0,  0x0,  0x4c, 0xc0,
                   0x9,  0x0,  0x6,  0xdb, 0x3e, 0x8a, 0xa4, 0x2e, 0x82, 0x29, 0x71, 0x1,  0x1b, 0x1f, 0x0,  0xb,
                   0x77, 0xe9, 0x6a, 0x96, 0x23, 0xf3, 0x1f, 0x70, 0x6f, 0x7a, 0xb7, 0xb,  0x1b, 0xb,  0x3,  0xb3,
                   0x87, 0xc0, 0x23, 0x2b, 0x45, 0x37, 0x2c, 0xe,  0x26, 0x30, 0x18, 0xef, 0x91, 0xbe, 0xc1, 0x9f,
                   0xa1, 0x3,  0xb,  0xcd, 0x7e, 0x79, 0x79, 0x9e, 0x76, 0xd1, 0x54, 0x74, 0x8f};

  uint8_t buf[135] = {0};

  uint8_t topic_bytes[] = {0xc7, 0xdc, 0xfc, 0xf, 0x93, 0x4b, 0xad};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb3, 0x87, 0xc0, 0x23, 0x2b, 0x45, 0x37, 0x2c, 0xe,  0x26, 0x30, 0x18, 0xef, 0x91, 0xbe,
                         0xc1, 0x9f, 0xa1, 0x3,  0xb,  0xcd, 0x7e, 0x79, 0x79, 0x9e, 0x76, 0xd1, 0x54, 0x74, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytes0[] = {0};
  uint8_t bytes1[] = {0x92, 0x70, 0xa1, 0x5a, 0xab, 0xbe, 0x8a, 0x6a, 0x85, 0x87, 0x47, 0xcd, 0x9, 0xf8,
                      0xf3, 0xcc, 0x17, 0xe4, 0xab, 0x1f, 0x96, 0xbc, 0xdf, 0x34, 0xc,  0x5f, 0x1b};
  uint8_t bytes2[] = {0xdb, 0x3e, 0x8a, 0xa4, 0x2e, 0x82};
  uint8_t bytes3[] = {0x77, 0xe9, 0x6a, 0x96, 0x23, 0xf3, 0x1f, 0x70, 0x6f, 0x7a, 0xb7};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7957}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26413}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19648}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 22359, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225Uc\EM\147>\149\248\SI9\ENQs\211]\179", _pubPktID = 25366, _pubBody = "\165c\155\220\241\175\249\EM\220Bi\224\t",
// _pubProps = [PropMaximumQoS 251,PropSubscriptionIdentifier 23,PropPayloadFormatIndicator 215,PropAuthenticationMethod
// "B1\DC41\FS&,Tt\255\134\153>D\195@",PropMaximumPacketSize 24117,PropRequestProblemInformation
// 232,PropRequestProblemInformation 103,PropRetainAvailable 52,PropMaximumQoS 28,PropSharedSubscriptionAvailable
// 192,PropSubscriptionIdentifierAvailable 18,PropSessionExpiryInterval 4955,PropContentType
// "\187\208",PropResponseInformation "\FS\176\183G\252\230\n\141P\184>\DEL&\190",PropMaximumQoS 222,PropContentType
// "\212\r\243\182\226(\"\232\t\226\168\166\132\\\DC3s\242OY\175\207\195\234\188\163",PropResponseInformation
// "\197\197\&8\161\152\243\146\&4\t\164\237"]}
TEST(Publish50QCTest, Encode51) {
  uint8_t pkt[] = {0x32, 0x92, 0x1,  0x0,  0xf,  0xe1, 0x55, 0x63, 0x19, 0x93, 0x3e, 0x95, 0xf8, 0xf,  0x39, 0x5,  0x73,
                   0xd3, 0x5d, 0xb3, 0x63, 0x16, 0x71, 0x24, 0xfb, 0xb,  0x17, 0x1,  0xd7, 0x15, 0x0,  0x10, 0x42, 0x31,
                   0x14, 0x31, 0x1c, 0x26, 0x2c, 0x54, 0x74, 0xff, 0x86, 0x99, 0x3e, 0x44, 0xc3, 0x40, 0x27, 0x0,  0x0,
                   0x5e, 0x35, 0x17, 0xe8, 0x17, 0x67, 0x25, 0x34, 0x24, 0x1c, 0x2a, 0xc0, 0x29, 0x12, 0x11, 0x0,  0x0,
                   0x13, 0x5b, 0x3,  0x0,  0x2,  0xbb, 0xd0, 0x1a, 0x0,  0xe,  0x1c, 0xb0, 0xb7, 0x47, 0xfc, 0xe6, 0xa,
                   0x8d, 0x50, 0xb8, 0x3e, 0x7f, 0x26, 0xbe, 0x24, 0xde, 0x3,  0x0,  0x19, 0xd4, 0xd,  0xf3, 0xb6, 0xe2,
                   0x28, 0x22, 0xe8, 0x9,  0xe2, 0xa8, 0xa6, 0x84, 0x5c, 0x13, 0x73, 0xf2, 0x4f, 0x59, 0xaf, 0xcf, 0xc3,
                   0xea, 0xbc, 0xa3, 0x1a, 0x0,  0xb,  0xc5, 0xc5, 0x38, 0xa1, 0x98, 0xf3, 0x92, 0x34, 0x9,  0xa4, 0xed,
                   0xa5, 0x63, 0x9b, 0xdc, 0xf1, 0xaf, 0xf9, 0x19, 0xdc, 0x42, 0x69, 0xe0, 0x9};

  uint8_t buf[159] = {0};

  uint8_t topic_bytes[] = {0xe1, 0x55, 0x63, 0x19, 0x93, 0x3e, 0x95, 0xf8, 0xf, 0x39, 0x5, 0x73, 0xd3, 0x5d, 0xb3};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x63, 0x9b, 0xdc, 0xf1, 0xaf, 0xf9, 0x19, 0xdc, 0x42, 0x69, 0xe0, 0x9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytes0[] = {0x42, 0x31, 0x14, 0x31, 0x1c, 0x26, 0x2c, 0x54, 0x74, 0xff, 0x86, 0x99, 0x3e, 0x44, 0xc3, 0x40};
  uint8_t bytes1[] = {0xbb, 0xd0};
  uint8_t bytes2[] = {0x1c, 0xb0, 0xb7, 0x47, 0xfc, 0xe6, 0xa, 0x8d, 0x50, 0xb8, 0x3e, 0x7f, 0x26, 0xbe};
  uint8_t bytes3[] = {0xd4, 0xd,  0xf3, 0xb6, 0xe2, 0x28, 0x22, 0xe8, 0x9,  0xe2, 0xa8, 0xa6, 0x84,
                      0x5c, 0x13, 0x73, 0xf2, 0x4f, 0x59, 0xaf, 0xcf, 0xc3, 0xea, 0xbc, 0xa3};
  uint8_t bytes4[] = {0xc5, 0xc5, 0x38, 0xa1, 0x98, 0xf3, 0x92, 0x34, 0x9, 0xa4, 0xed};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24117}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4955}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytes4}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25366, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "sS\f@K\\`9t", _pubPktID = 0,
// _pubBody = "9?\202\215M\ENQvqz\243\164Lg", _pubProps = [PropAssignedClientIdentifier
// "\179\&2\149\157\157\190gRR\140K\EOT\\\161\t\DC2\202`\DEL\200\240\\\a",PropMessageExpiryInterval
// 11207,PropServerReference "\185b+\252\250c\238\250\NAK\193\162Q\252\174\153\203",PropRetainAvailable
// 30,PropTopicAlias 23226,PropContentType "\v\132",PropResponseTopic
// "]U\132\DLE6\131mu\165\ACK\177\254qA?Y!%",PropReceiveMaximum 29851,PropWildcardSubscriptionAvailable
// 64,PropPayloadFormatIndicator 193,PropRetainAvailable 96]}
TEST(Publish50QCTest, Encode52) {
  uint8_t pkt[] = {0x30, 0x73, 0x0,  0x9,  0x73, 0x53, 0xc,  0x40, 0x4b, 0x5c, 0x60, 0x39, 0x74, 0x5a, 0x12, 0x0,  0x17,
                   0xb3, 0x32, 0x95, 0x9d, 0x9d, 0xbe, 0x67, 0x52, 0x52, 0x8c, 0x4b, 0x4,  0x5c, 0xa1, 0x9,  0x12, 0xca,
                   0x60, 0x7f, 0xc8, 0xf0, 0x5c, 0x7,  0x2,  0x0,  0x0,  0x2b, 0xc7, 0x1c, 0x0,  0x10, 0xb9, 0x62, 0x2b,
                   0xfc, 0xfa, 0x63, 0xee, 0xfa, 0x15, 0xc1, 0xa2, 0x51, 0xfc, 0xae, 0x99, 0xcb, 0x25, 0x1e, 0x23, 0x5a,
                   0xba, 0x3,  0x0,  0x2,  0xb,  0x84, 0x8,  0x0,  0x12, 0x5d, 0x55, 0x84, 0x10, 0x36, 0x83, 0x6d, 0x75,
                   0xa5, 0x6,  0xb1, 0xfe, 0x71, 0x41, 0x3f, 0x59, 0x21, 0x25, 0x21, 0x74, 0x9b, 0x28, 0x40, 0x1,  0xc1,
                   0x25, 0x60, 0x39, 0x3f, 0xca, 0xd7, 0x4d, 0x5,  0x76, 0x71, 0x7a, 0xf3, 0xa4, 0x4c, 0x67};

  uint8_t buf[127] = {0};

  uint8_t topic_bytes[] = {0x73, 0x53, 0xc, 0x40, 0x4b, 0x5c, 0x60, 0x39, 0x74};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x39, 0x3f, 0xca, 0xd7, 0x4d, 0x5, 0x76, 0x71, 0x7a, 0xf3, 0xa4, 0x4c, 0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytes0[] = {0xb3, 0x32, 0x95, 0x9d, 0x9d, 0xbe, 0x67, 0x52, 0x52, 0x8c, 0x4b, 0x4,
                      0x5c, 0xa1, 0x9,  0x12, 0xca, 0x60, 0x7f, 0xc8, 0xf0, 0x5c, 0x7};
  uint8_t bytes1[] = {0xb9, 0x62, 0x2b, 0xfc, 0xfa, 0x63, 0xee, 0xfa, 0x15, 0xc1, 0xa2, 0x51, 0xfc, 0xae, 0x99, 0xcb};
  uint8_t bytes2[] = {0xb, 0x84};
  uint8_t bytes3[] = {0x5d, 0x55, 0x84, 0x10, 0x36, 0x83, 0x6d, 0x75, 0xa5,
                      0x6,  0xb1, 0xfe, 0x71, 0x41, 0x3f, 0x59, 0x21, 0x25};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11207}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23226}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29851}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 96}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\220", _pubPktID = 0, _pubBody =
// "m>\243z\246\250\139\171?\208F\f\240\232\EOTT`\241\212\SOH\182\b\SI@\228A", _pubProps = [PropSessionExpiryInterval
// 9445,PropCorrelationData "\235\250\159t\140\135\170\166\245a\r\NAK\138",PropSessionExpiryInterval
// 9422,PropPayloadFormatIndicator 100,PropSubscriptionIdentifier 25,PropSharedSubscriptionAvailable
// 182,PropResponseInformation "\221\146\181f\212\187\134\205"]}
TEST(Publish50QCTest, Encode53) {
  uint8_t pkt[] = {0x38, 0x49, 0x0,  0x1,  0xdc, 0x2b, 0x11, 0x0,  0x0,  0x24, 0xe5, 0x9,  0x0,  0xd,  0xeb,
                   0xfa, 0x9f, 0x74, 0x8c, 0x87, 0xaa, 0xa6, 0xf5, 0x61, 0xd,  0x15, 0x8a, 0x11, 0x0,  0x0,
                   0x24, 0xce, 0x1,  0x64, 0xb,  0x19, 0x2a, 0xb6, 0x1a, 0x0,  0x8,  0xdd, 0x92, 0xb5, 0x66,
                   0xd4, 0xbb, 0x86, 0xcd, 0x6d, 0x3e, 0xf3, 0x7a, 0xf6, 0xfa, 0x8b, 0xab, 0x3f, 0xd0, 0x46,
                   0xc,  0xf0, 0xe8, 0x4,  0x54, 0x60, 0xf1, 0xd4, 0x1,  0xb6, 0x8,  0xf,  0x40, 0xe4, 0x41};

  uint8_t buf[85] = {0};

  uint8_t topic_bytes[] = {0xdc};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6d, 0x3e, 0xf3, 0x7a, 0xf6, 0xfa, 0x8b, 0xab, 0x3f, 0xd0, 0x46, 0xc,  0xf0,
                         0xe8, 0x4,  0x54, 0x60, 0xf1, 0xd4, 0x1,  0xb6, 0x8,  0xf,  0x40, 0xe4, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytes0[] = {0xeb, 0xfa, 0x9f, 0x74, 0x8c, 0x87, 0xaa, 0xa6, 0xf5, 0x61, 0xd, 0x15, 0x8a};
  uint8_t bytes1[] = {0xdd, 0x92, 0xb5, 0x66, 0xd4, 0xbb, 0x86, 0xcd};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9445}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9422}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytes1}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\f\143\204y\245\248\131\153\248\250\nj\156\173\166\174\GSIv\154\166w\r\136Y", _pubPktID = 0, _pubBody =
// "\177\216D\168\tF\242kx1\247\n", _pubProps = [PropMaximumPacketSize 6251,PropSubscriptionIdentifierAvailable
// 225,PropAuthenticationMethod "\fw\226B\SYN9\175O\182\203\229",PropMessageExpiryInterval
// 1651,PropSubscriptionIdentifier 9,PropResponseTopic
// "\142\234\130\217\SI\206\129\148*I\220\223\172\250yR\180ul\220B\147w\136\213",PropWillDelayInterval
// 23126,PropWildcardSubscriptionAvailable 183]}
TEST(Publish50QCTest, Encode54) {
  uint8_t pkt[] = {0x31, 0x67, 0x0,  0x19, 0xc,  0x8f, 0xcc, 0x79, 0xf5, 0xf8, 0x83, 0x99, 0xf8, 0xfa, 0xa,
                   0x6a, 0x9c, 0xad, 0xa6, 0xae, 0x1d, 0x49, 0x76, 0x9a, 0xa6, 0x77, 0xd,  0x88, 0x59, 0x3f,
                   0x27, 0x0,  0x0,  0x18, 0x6b, 0x29, 0xe1, 0x15, 0x0,  0xb,  0xc,  0x77, 0xe2, 0x42, 0x16,
                   0x39, 0xaf, 0x4f, 0xb6, 0xcb, 0xe5, 0x2,  0x0,  0x0,  0x6,  0x73, 0xb,  0x9,  0x8,  0x0,
                   0x19, 0x8e, 0xea, 0x82, 0xd9, 0xf,  0xce, 0x81, 0x94, 0x2a, 0x49, 0xdc, 0xdf, 0xac, 0xfa,
                   0x79, 0x52, 0xb4, 0x75, 0x6c, 0xdc, 0x42, 0x93, 0x77, 0x88, 0xd5, 0x18, 0x0,  0x0,  0x5a,
                   0x56, 0x28, 0xb7, 0xb1, 0xd8, 0x44, 0xa8, 0x9,  0x46, 0xf2, 0x6b, 0x78, 0x31, 0xf7, 0xa};

  uint8_t buf[115] = {0};

  uint8_t topic_bytes[] = {0xc,  0x8f, 0xcc, 0x79, 0xf5, 0xf8, 0x83, 0x99, 0xf8, 0xfa, 0xa,  0x6a, 0x9c,
                           0xad, 0xa6, 0xae, 0x1d, 0x49, 0x76, 0x9a, 0xa6, 0x77, 0xd,  0x88, 0x59};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb1, 0xd8, 0x44, 0xa8, 0x9, 0x46, 0xf2, 0x6b, 0x78, 0x31, 0xf7, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytes0[] = {0xc, 0x77, 0xe2, 0x42, 0x16, 0x39, 0xaf, 0x4f, 0xb6, 0xcb, 0xe5};
  uint8_t bytes1[] = {0x8e, 0xea, 0x82, 0xd9, 0xf,  0xce, 0x81, 0x94, 0x2a, 0x49, 0xdc, 0xdf, 0xac,
                      0xfa, 0x79, 0x52, 0xb4, 0x75, 0x6c, 0xdc, 0x42, 0x93, 0x77, 0x88, 0xd5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6251}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1651}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23126}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "x\141i\235F", _pubPktID = 15511,
// _pubBody = "\174]0.\196?\198\195\202m`\179\253E\v|\204\214P\f\229\NAK\154\130", _pubProps =
// [PropSubscriptionIdentifier 21,PropResponseTopic
// "\221P\183\212\158\183\132\176\213\128wK\"\163\&8\137{B\173\192\186\130",PropResponseTopic
// "e\r:`\149\240\185)g\174M\137\DC4\232C",PropMessageExpiryInterval 16546,PropContentType
// "\231J\190\176\154\213\148$\190\210\r\133",PropRequestProblemInformation 23,PropServerReference
// "\226\&3M1(\147\241|.\129\183\&3Hb\211c\192,\207\EOT"]}
TEST(Publish50QCTest, Encode55) {
  uint8_t pkt[] = {0x32, 0x7c, 0x0,  0x5,  0x78, 0x8d, 0x69, 0xeb, 0x46, 0x3c, 0x97, 0x5a, 0xb,  0x15, 0x8,  0x0,
                   0x16, 0xdd, 0x50, 0xb7, 0xd4, 0x9e, 0xb7, 0x84, 0xb0, 0xd5, 0x80, 0x77, 0x4b, 0x22, 0xa3, 0x38,
                   0x89, 0x7b, 0x42, 0xad, 0xc0, 0xba, 0x82, 0x8,  0x0,  0xf,  0x65, 0xd,  0x3a, 0x60, 0x95, 0xf0,
                   0xb9, 0x29, 0x67, 0xae, 0x4d, 0x89, 0x14, 0xe8, 0x43, 0x2,  0x0,  0x0,  0x40, 0xa2, 0x3,  0x0,
                   0xc,  0xe7, 0x4a, 0xbe, 0xb0, 0x9a, 0xd5, 0x94, 0x24, 0xbe, 0xd2, 0xd,  0x85, 0x17, 0x17, 0x1c,
                   0x0,  0x14, 0xe2, 0x33, 0x4d, 0x31, 0x28, 0x93, 0xf1, 0x7c, 0x2e, 0x81, 0xb7, 0x33, 0x48, 0x62,
                   0xd3, 0x63, 0xc0, 0x2c, 0xcf, 0x4,  0xae, 0x5d, 0x30, 0x2e, 0xc4, 0x3f, 0xc6, 0xc3, 0xca, 0x6d,
                   0x60, 0xb3, 0xfd, 0x45, 0xb,  0x7c, 0xcc, 0xd6, 0x50, 0xc,  0xe5, 0x15, 0x9a, 0x82};

  uint8_t buf[136] = {0};

  uint8_t topic_bytes[] = {0x78, 0x8d, 0x69, 0xeb, 0x46};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xae, 0x5d, 0x30, 0x2e, 0xc4, 0x3f, 0xc6, 0xc3, 0xca, 0x6d, 0x60, 0xb3,
                         0xfd, 0x45, 0xb,  0x7c, 0xcc, 0xd6, 0x50, 0xc,  0xe5, 0x15, 0x9a, 0x82};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0xdd, 0x50, 0xb7, 0xd4, 0x9e, 0xb7, 0x84, 0xb0, 0xd5, 0x80, 0x77,
                      0x4b, 0x22, 0xa3, 0x38, 0x89, 0x7b, 0x42, 0xad, 0xc0, 0xba, 0x82};
  uint8_t bytes1[] = {0x65, 0xd, 0x3a, 0x60, 0x95, 0xf0, 0xb9, 0x29, 0x67, 0xae, 0x4d, 0x89, 0x14, 0xe8, 0x43};
  uint8_t bytes2[] = {0xe7, 0x4a, 0xbe, 0xb0, 0x9a, 0xd5, 0x94, 0x24, 0xbe, 0xd2, 0xd, 0x85};
  uint8_t bytes3[] = {0xe2, 0x33, 0x4d, 0x31, 0x28, 0x93, 0xf1, 0x7c, 0x2e, 0x81,
                      0xb7, 0x33, 0x48, 0x62, 0xd3, 0x63, 0xc0, 0x2c, 0xcf, 0x4};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16546}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytes3}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 15511, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\207", _pubPktID = 12437, _pubBody =
// "\209\NAKT\231?\229R\176}\ESC\195\172\146\168\148\188;\237\205\216\134\&4\132\&5w", _pubProps =
// [PropTopicAliasMaximum 9499,PropAuthenticationMethod "\166\ENQ\132mo\129\187\154%\158\EOT",PropTopicAliasMaximum
// 30051,PropTopicAliasMaximum 8839]}
TEST(Publish50QCTest, Encode56) {
  uint8_t pkt[] = {0x3a, 0x36, 0x0,  0x1,  0xcf, 0x30, 0x95, 0x17, 0x22, 0x25, 0x1b, 0x15, 0x0,  0xb,
                   0xa6, 0x5,  0x84, 0x6d, 0x6f, 0x81, 0xbb, 0x9a, 0x25, 0x9e, 0x4,  0x22, 0x75, 0x63,
                   0x22, 0x22, 0x87, 0xd1, 0x15, 0x54, 0xe7, 0x3f, 0xe5, 0x52, 0xb0, 0x7d, 0x1b, 0xc3,
                   0xac, 0x92, 0xa8, 0x94, 0xbc, 0x3b, 0xed, 0xcd, 0xd8, 0x86, 0x34, 0x84, 0x35, 0x77};

  uint8_t buf[66] = {0};

  uint8_t topic_bytes[] = {0xcf};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd1, 0x15, 0x54, 0xe7, 0x3f, 0xe5, 0x52, 0xb0, 0x7d, 0x1b, 0xc3, 0xac, 0x92,
                         0xa8, 0x94, 0xbc, 0x3b, 0xed, 0xcd, 0xd8, 0x86, 0x34, 0x84, 0x35, 0x77};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytes0[] = {0xa6, 0x5, 0x84, 0x6d, 0x6f, 0x81, 0xbb, 0x9a, 0x25, 0x9e, 0x4};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9499}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30051}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8839}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 12437, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\151\157\DC2\191\177A0d\141\181",
// _pubPktID = 0, _pubBody = "(W\SO\vJ\219Q\170]\to\a3\EOT\245X?\r\255\t&i\EM\213", _pubProps =
// [PropAuthenticationMethod "\DC3\DLEHQ",PropMessageExpiryInterval 4440,PropPayloadFormatIndicator
// 234,PropServerKeepAlive 28079,PropTopicAliasMaximum 11882,PropSessionExpiryInterval 357]}
TEST(Publish50QCTest, Encode57) {
  uint8_t pkt[] = {0x38, 0x3e, 0x0,  0xa,  0x97, 0x9d, 0x12, 0xbf, 0xb1, 0x41, 0x30, 0x64, 0x8d, 0xb5, 0x19, 0x15,
                   0x0,  0x4,  0x13, 0x10, 0x48, 0x51, 0x2,  0x0,  0x0,  0x11, 0x58, 0x1,  0xea, 0x13, 0x6d, 0xaf,
                   0x22, 0x2e, 0x6a, 0x11, 0x0,  0x0,  0x1,  0x65, 0x28, 0x57, 0xe,  0xb,  0x4a, 0xdb, 0x51, 0xaa,
                   0x5d, 0x9,  0x6f, 0x7,  0x33, 0x4,  0xf5, 0x58, 0x3f, 0xd,  0xff, 0x9,  0x26, 0x69, 0x19, 0xd5};

  uint8_t buf[74] = {0};

  uint8_t topic_bytes[] = {0x97, 0x9d, 0x12, 0xbf, 0xb1, 0x41, 0x30, 0x64, 0x8d, 0xb5};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x28, 0x57, 0xe,  0xb,  0x4a, 0xdb, 0x51, 0xaa, 0x5d, 0x9,  0x6f, 0x7,
                         0x33, 0x4,  0xf5, 0x58, 0x3f, 0xd,  0xff, 0x9,  0x26, 0x69, 0x19, 0xd5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0x13, 0x10, 0x48, 0x51};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4440}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28079}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11882}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 357}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\133p7\NAK\217\177\185\186:\228-\158\214\255\170", _pubPktID = 5681, _pubBody =
// "\NULT\212\214&\205\222\154\236\130\237_\195\200\186\137\DEL\184\213\&6\192a\241\NUL\231\168\246\180", _pubProps =
// [PropMessageExpiryInterval 6752,PropResponseInformation "\DC2\DELf\202eTw\149\239",PropMaximumPacketSize
// 16265,PropRetainAvailable 229,PropReasonString "v5*\215u",PropRequestProblemInformation 220]}
TEST(Publish50QCTest, Encode58) {
  uint8_t pkt[] = {0x3c, 0x53, 0x0,  0x10, 0x17, 0x85, 0x70, 0x37, 0x15, 0xd9, 0xb1, 0xb9, 0xba, 0x3a, 0xe4,
                   0x2d, 0x9e, 0xd6, 0xff, 0xaa, 0x16, 0x31, 0x22, 0x2,  0x0,  0x0,  0x1a, 0x60, 0x1a, 0x0,
                   0x9,  0x12, 0x7f, 0x66, 0xca, 0x65, 0x54, 0x77, 0x95, 0xef, 0x27, 0x0,  0x0,  0x3f, 0x89,
                   0x25, 0xe5, 0x1f, 0x0,  0x5,  0x76, 0x35, 0x2a, 0xd7, 0x75, 0x17, 0xdc, 0x0,  0x54, 0xd4,
                   0xd6, 0x26, 0xcd, 0xde, 0x9a, 0xec, 0x82, 0xed, 0x5f, 0xc3, 0xc8, 0xba, 0x89, 0x7f, 0xb8,
                   0xd5, 0x36, 0xc0, 0x61, 0xf1, 0x0,  0xe7, 0xa8, 0xf6, 0xb4};

  uint8_t buf[95] = {0};

  uint8_t topic_bytes[] = {0x17, 0x85, 0x70, 0x37, 0x15, 0xd9, 0xb1, 0xb9,
                           0xba, 0x3a, 0xe4, 0x2d, 0x9e, 0xd6, 0xff, 0xaa};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x0,  0x54, 0xd4, 0xd6, 0x26, 0xcd, 0xde, 0x9a, 0xec, 0x82, 0xed, 0x5f, 0xc3, 0xc8,
                         0xba, 0x89, 0x7f, 0xb8, 0xd5, 0x36, 0xc0, 0x61, 0xf1, 0x0,  0xe7, 0xa8, 0xf6, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytes0[] = {0x12, 0x7f, 0x66, 0xca, 0x65, 0x54, 0x77, 0x95, 0xef};
  uint8_t bytes1[] = {0x76, 0x35, 0x2a, 0xd7, 0x75};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6752}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16265}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5681, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "K#\aZV,bl\168\131\197N", _pubPktID =
// 29545, _pubBody = "q\152\198\DC3v\US", _pubProps = [PropServerReference "\253\161\253",PropCorrelationData
// "\SI\241\169\229\186\174\ETX\EM\n\193\189>\237\214U\ESC\128",PropContentType "\220",PropSharedSubscriptionAvailable
// 10,PropRequestResponseInformation 112,PropSubscriptionIdentifier 22,PropUserProperty
// "\DC2\227j\196\236X8\252*\170Z\b\181\251\&2"
// "\178\140\222\163\ACK\215\&7\183\251\242\251[G\ETX\183\EOTH\SIwD=\141\180j.",PropCorrelationData
// "z\193\213\200\146PY\156\&9m?\166\134\a\206\144!",PropResponseTopic
// "3\248\238\SOu\145=\226+Z,\SO\199E\143\229\220\250iH\145\235)\168y\129,E8\n",PropMessageExpiryInterval
// 12141,PropTopicAlias 4176,PropResponseTopic "gT\208c!\224\151",PropSubscriptionIdentifierAvailable
// 61,PropRequestResponseInformation 138]}
TEST(Publish50QCTest, Encode59) {
  uint8_t pkt[] = {0x3b, 0xb4, 0x1,  0x0,  0xc,  0x4b, 0x23, 0x7,  0x5a, 0x56, 0x2c, 0x62, 0x6c, 0xa8, 0x83, 0xc5, 0x4e,
                   0x73, 0x69, 0x9c, 0x1,  0x1c, 0x0,  0x3,  0xfd, 0xa1, 0xfd, 0x9,  0x0,  0x11, 0xf,  0xf1, 0xa9, 0xe5,
                   0xba, 0xae, 0x3,  0x19, 0xa,  0xc1, 0xbd, 0x3e, 0xed, 0xd6, 0x55, 0x1b, 0x80, 0x3,  0x0,  0x1,  0xdc,
                   0x2a, 0xa,  0x19, 0x70, 0xb,  0x16, 0x26, 0x0,  0xf,  0x12, 0xe3, 0x6a, 0xc4, 0xec, 0x58, 0x38, 0xfc,
                   0x2a, 0xaa, 0x5a, 0x8,  0xb5, 0xfb, 0x32, 0x0,  0x19, 0xb2, 0x8c, 0xde, 0xa3, 0x6,  0xd7, 0x37, 0xb7,
                   0xfb, 0xf2, 0xfb, 0x5b, 0x47, 0x3,  0xb7, 0x4,  0x48, 0xf,  0x77, 0x44, 0x3d, 0x8d, 0xb4, 0x6a, 0x2e,
                   0x9,  0x0,  0x11, 0x7a, 0xc1, 0xd5, 0xc8, 0x92, 0x50, 0x59, 0x9c, 0x39, 0x6d, 0x3f, 0xa6, 0x86, 0x7,
                   0xce, 0x90, 0x21, 0x8,  0x0,  0x1e, 0x33, 0xf8, 0xee, 0xe,  0x75, 0x91, 0x3d, 0xe2, 0x2b, 0x5a, 0x2c,
                   0xe,  0xc7, 0x45, 0x8f, 0xe5, 0xdc, 0xfa, 0x69, 0x48, 0x91, 0xeb, 0x29, 0xa8, 0x79, 0x81, 0x2c, 0x45,
                   0x38, 0xa,  0x2,  0x0,  0x0,  0x2f, 0x6d, 0x23, 0x10, 0x50, 0x8,  0x0,  0x7,  0x67, 0x54, 0xd0, 0x63,
                   0x21, 0xe0, 0x97, 0x29, 0x3d, 0x19, 0x8a, 0x71, 0x98, 0xc6, 0x13, 0x76, 0x1f};

  uint8_t buf[193] = {0};

  uint8_t topic_bytes[] = {0x4b, 0x23, 0x7, 0x5a, 0x56, 0x2c, 0x62, 0x6c, 0xa8, 0x83, 0xc5, 0x4e};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x71, 0x98, 0xc6, 0x13, 0x76, 0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytes0[] = {0xfd, 0xa1, 0xfd};
  uint8_t bytes1[] = {0xf,  0xf1, 0xa9, 0xe5, 0xba, 0xae, 0x3,  0x19, 0xa,
                      0xc1, 0xbd, 0x3e, 0xed, 0xd6, 0x55, 0x1b, 0x80};
  uint8_t bytes2[] = {0xdc};
  uint8_t bytes4[] = {0xb2, 0x8c, 0xde, 0xa3, 0x6, 0xd7, 0x37, 0xb7, 0xfb, 0xf2, 0xfb, 0x5b, 0x47,
                      0x3,  0xb7, 0x4,  0x48, 0xf, 0x77, 0x44, 0x3d, 0x8d, 0xb4, 0x6a, 0x2e};
  uint8_t bytes3[] = {0x12, 0xe3, 0x6a, 0xc4, 0xec, 0x58, 0x38, 0xfc, 0x2a, 0xaa, 0x5a, 0x8, 0xb5, 0xfb, 0x32};
  uint8_t bytes5[] = {0x7a, 0xc1, 0xd5, 0xc8, 0x92, 0x50, 0x59, 0x9c, 0x39,
                      0x6d, 0x3f, 0xa6, 0x86, 0x7,  0xce, 0x90, 0x21};
  uint8_t bytes6[] = {0x33, 0xf8, 0xee, 0xe,  0x75, 0x91, 0x3d, 0xe2, 0x2b, 0x5a, 0x2c, 0xe,  0xc7, 0x45, 0x8f,
                      0xe5, 0xdc, 0xfa, 0x69, 0x48, 0x91, 0xeb, 0x29, 0xa8, 0x79, 0x81, 0x2c, 0x45, 0x38, 0xa};
  uint8_t bytes7[] = {0x67, 0x54, 0xd0, 0x63, 0x21, 0xe0, 0x97};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytes3}, .v = {25, (char*)&bytes4}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12141}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4176}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29545, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB./iLG\236\218\159\SOH\n\ESC\203\FSs", _pubPktID = 19215, _pubBody =
// "I\157\182\DEL\135\249\197]P>b\248\202r\201\180\226\179\255", _pubProps = [PropReasonString
// "\184\168\186\240\234w\SIjs2\217\133r&0Z\DC3-X",PropResponseTopic
// "\221\141\186A\131\ETX\SI\CAN\b\145c\222\DC1\EM",PropRequestResponseInformation 190,PropUserProperty
// "\132\175a9\148\t\220k\EOT\251\161" "\147\133\237C\234C\150\GS\SO\204\245",PropAuthenticationMethod
// "\ETX\251\177?\243\192/\156\149\253\164\205\191\234%\231\223O\184kK%\201\&1\139\211d",PropMessageExpiryInterval
// 20507,PropReasonString "w\132\228[\230\221g\234",PropRequestProblemInformation 10]}
TEST(Publish50QCTest, Encode60) {
  uint8_t pkt[] = {0x34, 0x9b, 0x1,  0x0,  0xf,  0x17, 0x2e, 0x2f, 0x69, 0x4c, 0x47, 0xec, 0xda, 0x9f, 0x1,  0xa,
                   0x1b, 0xcb, 0x1c, 0x73, 0x4b, 0xf,  0x74, 0x1f, 0x0,  0x13, 0xb8, 0xa8, 0xba, 0xf0, 0xea, 0x77,
                   0xf,  0x6a, 0x73, 0x32, 0xd9, 0x85, 0x72, 0x26, 0x30, 0x5a, 0x13, 0x2d, 0x58, 0x8,  0x0,  0xe,
                   0xdd, 0x8d, 0xba, 0x41, 0x83, 0x3,  0xf,  0x18, 0x8,  0x91, 0x63, 0xde, 0x11, 0x19, 0x19, 0xbe,
                   0x26, 0x0,  0xb,  0x84, 0xaf, 0x61, 0x39, 0x94, 0x9,  0xdc, 0x6b, 0x4,  0xfb, 0xa1, 0x0,  0xb,
                   0x93, 0x85, 0xed, 0x43, 0xea, 0x43, 0x96, 0x1d, 0xe,  0xcc, 0xf5, 0x15, 0x0,  0x1b, 0x3,  0xfb,
                   0xb1, 0x3f, 0xf3, 0xc0, 0x2f, 0x9c, 0x95, 0xfd, 0xa4, 0xcd, 0xbf, 0xea, 0x25, 0xe7, 0xdf, 0x4f,
                   0xb8, 0x6b, 0x4b, 0x25, 0xc9, 0x31, 0x8b, 0xd3, 0x64, 0x2,  0x0,  0x0,  0x50, 0x1b, 0x1f, 0x0,
                   0x8,  0x77, 0x84, 0xe4, 0x5b, 0xe6, 0xdd, 0x67, 0xea, 0x17, 0xa,  0x49, 0x9d, 0xb6, 0x7f, 0x87,
                   0xf9, 0xc5, 0x5d, 0x50, 0x3e, 0x62, 0xf8, 0xca, 0x72, 0xc9, 0xb4, 0xe2, 0xb3, 0xff};

  uint8_t buf[168] = {0};

  uint8_t topic_bytes[] = {0x17, 0x2e, 0x2f, 0x69, 0x4c, 0x47, 0xec, 0xda, 0x9f, 0x1, 0xa, 0x1b, 0xcb, 0x1c, 0x73};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x49, 0x9d, 0xb6, 0x7f, 0x87, 0xf9, 0xc5, 0x5d, 0x50, 0x3e,
                         0x62, 0xf8, 0xca, 0x72, 0xc9, 0xb4, 0xe2, 0xb3, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytes0[] = {0xb8, 0xa8, 0xba, 0xf0, 0xea, 0x77, 0xf,  0x6a, 0x73, 0x32,
                      0xd9, 0x85, 0x72, 0x26, 0x30, 0x5a, 0x13, 0x2d, 0x58};
  uint8_t bytes1[] = {0xdd, 0x8d, 0xba, 0x41, 0x83, 0x3, 0xf, 0x18, 0x8, 0x91, 0x63, 0xde, 0x11, 0x19};
  uint8_t bytes3[] = {0x93, 0x85, 0xed, 0x43, 0xea, 0x43, 0x96, 0x1d, 0xe, 0xcc, 0xf5};
  uint8_t bytes2[] = {0x84, 0xaf, 0x61, 0x39, 0x94, 0x9, 0xdc, 0x6b, 0x4, 0xfb, 0xa1};
  uint8_t bytes4[] = {0x3,  0xfb, 0xb1, 0x3f, 0xf3, 0xc0, 0x2f, 0x9c, 0x95, 0xfd, 0xa4, 0xcd, 0xbf, 0xea,
                      0x25, 0xe7, 0xdf, 0x4f, 0xb8, 0x6b, 0x4b, 0x25, 0xc9, 0x31, 0x8b, 0xd3, 0x64};
  uint8_t bytes5[] = {0x77, 0x84, 0xe4, 0x5b, 0xe6, 0xdd, 0x67, 0xea};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytes2}, .v = {11, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20507}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 10}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19215, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\ETXv\161\NUL\132\175\165\CAN2\131",
// _pubPktID = 31455, _pubBody = "P\232c#\237\r A\219\192Z\186\241T\196\154", _pubProps = [PropContentType
// "\SIB\207\144\236\165D\DC2\244\ESCiM\DC1\DC33\NUL\140\183\r+u65\211\GS\DC1",PropReasonString
// "\188Vm\185\DC4\193\251\183\218\ay\240:}\213\237c_\199\199\244T\204A\179L\211\CAN",PropUserProperty
// "\184\231\&3:\178\191\203\198\&5\164\223Z\208\164(oKv\205\146\138\213"
// "\181x\245o\222L\155\234\195\135\SUB\152\189\ACKj\NUL\220\176/\182\146\138(\v",PropSessionExpiryInterval
// 16128,PropServerReference "\221Am\185\221\153\187\227B\226\SIu\200\&4\219\t\137\145\195\SI",PropTopicAlias
// 340,PropTopicAliasMaximum 28072,PropMessageExpiryInterval 27514,PropContentType
// "\141\199\198\159!\171\164\nsz\212\240\224\233\207=\253\132\210\192M~\ETXZ\215\130i)e\243",PropSessionExpiryInterval
// 17275,PropContentType "\202\ETB\213D",PropResponseTopic
// "\ETB\184\SUB\DLE\218'tM!\131\167\158X\218\f\210\SUB\178\172",PropAssignedClientIdentifier
// ",\247\185\216\245\198{\218\DLE\190\SOH9j\237\&4\218\GS\198\200\180\231^\FS\184\134\130",PropWildcardSubscriptionAvailable
// 81,PropPayloadFormatIndicator 136,PropMessageExpiryInterval 32698,PropReceiveMaximum 22407,PropTopicAlias
// 11284,PropWillDelayInterval 22458,PropMessageExpiryInterval 17500,PropServerReference
// "\175\DEL\128\171nB\170Y\204\179\253\DC3",PropTopicAliasMaximum 20435,PropSessionExpiryInterval 23566]}
TEST(Publish50QCTest, Encode61) {
  uint8_t pkt[] = {
      0x35, 0xc6, 0x2,  0x0,  0xa,  0x3,  0x76, 0xa1, 0x0,  0x84, 0xaf, 0xa5, 0x18, 0x32, 0x83, 0x7a, 0xdf, 0xa6, 0x2,
      0x3,  0x0,  0x1a, 0xf,  0x42, 0xcf, 0x90, 0xec, 0xa5, 0x44, 0x12, 0xf4, 0x1b, 0x69, 0x4d, 0x11, 0x13, 0x33, 0x0,
      0x8c, 0xb7, 0xd,  0x2b, 0x75, 0x36, 0x35, 0xd3, 0x1d, 0x11, 0x1f, 0x0,  0x1c, 0xbc, 0x56, 0x6d, 0xb9, 0x14, 0xc1,
      0xfb, 0xb7, 0xda, 0x7,  0x79, 0xf0, 0x3a, 0x7d, 0xd5, 0xed, 0x63, 0x5f, 0xc7, 0xc7, 0xf4, 0x54, 0xcc, 0x41, 0xb3,
      0x4c, 0xd3, 0x18, 0x26, 0x0,  0x16, 0xb8, 0xe7, 0x33, 0x3a, 0xb2, 0xbf, 0xcb, 0xc6, 0x35, 0xa4, 0xdf, 0x5a, 0xd0,
      0xa4, 0x28, 0x6f, 0x4b, 0x76, 0xcd, 0x92, 0x8a, 0xd5, 0x0,  0x18, 0xb5, 0x78, 0xf5, 0x6f, 0xde, 0x4c, 0x9b, 0xea,
      0xc3, 0x87, 0x1a, 0x98, 0xbd, 0x6,  0x6a, 0x0,  0xdc, 0xb0, 0x2f, 0xb6, 0x92, 0x8a, 0x28, 0xb,  0x11, 0x0,  0x0,
      0x3f, 0x0,  0x1c, 0x0,  0x14, 0xdd, 0x41, 0x6d, 0xb9, 0xdd, 0x99, 0xbb, 0xe3, 0x42, 0xe2, 0xf,  0x75, 0xc8, 0x34,
      0xdb, 0x9,  0x89, 0x91, 0xc3, 0xf,  0x23, 0x1,  0x54, 0x22, 0x6d, 0xa8, 0x2,  0x0,  0x0,  0x6b, 0x7a, 0x3,  0x0,
      0x1e, 0x8d, 0xc7, 0xc6, 0x9f, 0x21, 0xab, 0xa4, 0xa,  0x73, 0x7a, 0xd4, 0xf0, 0xe0, 0xe9, 0xcf, 0x3d, 0xfd, 0x84,
      0xd2, 0xc0, 0x4d, 0x7e, 0x3,  0x5a, 0xd7, 0x82, 0x69, 0x29, 0x65, 0xf3, 0x11, 0x0,  0x0,  0x43, 0x7b, 0x3,  0x0,
      0x4,  0xca, 0x17, 0xd5, 0x44, 0x8,  0x0,  0x13, 0x17, 0xb8, 0x1a, 0x10, 0xda, 0x27, 0x74, 0x4d, 0x21, 0x83, 0xa7,
      0x9e, 0x58, 0xda, 0xc,  0xd2, 0x1a, 0xb2, 0xac, 0x12, 0x0,  0x1a, 0x2c, 0xf7, 0xb9, 0xd8, 0xf5, 0xc6, 0x7b, 0xda,
      0x10, 0xbe, 0x1,  0x39, 0x6a, 0xed, 0x34, 0xda, 0x1d, 0xc6, 0xc8, 0xb4, 0xe7, 0x5e, 0x1c, 0xb8, 0x86, 0x82, 0x28,
      0x51, 0x1,  0x88, 0x2,  0x0,  0x0,  0x7f, 0xba, 0x21, 0x57, 0x87, 0x23, 0x2c, 0x14, 0x18, 0x0,  0x0,  0x57, 0xba,
      0x2,  0x0,  0x0,  0x44, 0x5c, 0x1c, 0x0,  0xc,  0xaf, 0x7f, 0x80, 0xab, 0x6e, 0x42, 0xaa, 0x59, 0xcc, 0xb3, 0xfd,
      0x13, 0x22, 0x4f, 0xd3, 0x11, 0x0,  0x0,  0x5c, 0xe,  0x50, 0xe8, 0x63, 0x23, 0xed, 0xd,  0x20, 0x41, 0xdb, 0xc0,
      0x5a, 0xba, 0xf1, 0x54, 0xc4, 0x9a};

  uint8_t buf[339] = {0};

  uint8_t topic_bytes[] = {0x3, 0x76, 0xa1, 0x0, 0x84, 0xaf, 0xa5, 0x18, 0x32, 0x83};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xe8, 0x63, 0x23, 0xed, 0xd, 0x20, 0x41, 0xdb, 0xc0, 0x5a, 0xba, 0xf1, 0x54, 0xc4, 0x9a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytes0[] = {0xf,  0x42, 0xcf, 0x90, 0xec, 0xa5, 0x44, 0x12, 0xf4, 0x1b, 0x69, 0x4d, 0x11,
                      0x13, 0x33, 0x0,  0x8c, 0xb7, 0xd,  0x2b, 0x75, 0x36, 0x35, 0xd3, 0x1d, 0x11};
  uint8_t bytes1[] = {0xbc, 0x56, 0x6d, 0xb9, 0x14, 0xc1, 0xfb, 0xb7, 0xda, 0x7,  0x79, 0xf0, 0x3a, 0x7d,
                      0xd5, 0xed, 0x63, 0x5f, 0xc7, 0xc7, 0xf4, 0x54, 0xcc, 0x41, 0xb3, 0x4c, 0xd3, 0x18};
  uint8_t bytes3[] = {0xb5, 0x78, 0xf5, 0x6f, 0xde, 0x4c, 0x9b, 0xea, 0xc3, 0x87, 0x1a, 0x98,
                      0xbd, 0x6,  0x6a, 0x0,  0xdc, 0xb0, 0x2f, 0xb6, 0x92, 0x8a, 0x28, 0xb};
  uint8_t bytes2[] = {0xb8, 0xe7, 0x33, 0x3a, 0xb2, 0xbf, 0xcb, 0xc6, 0x35, 0xa4, 0xdf,
                      0x5a, 0xd0, 0xa4, 0x28, 0x6f, 0x4b, 0x76, 0xcd, 0x92, 0x8a, 0xd5};
  uint8_t bytes4[] = {0xdd, 0x41, 0x6d, 0xb9, 0xdd, 0x99, 0xbb, 0xe3, 0x42, 0xe2,
                      0xf,  0x75, 0xc8, 0x34, 0xdb, 0x9,  0x89, 0x91, 0xc3, 0xf};
  uint8_t bytes5[] = {0x8d, 0xc7, 0xc6, 0x9f, 0x21, 0xab, 0xa4, 0xa, 0x73, 0x7a, 0xd4, 0xf0, 0xe0, 0xe9, 0xcf,
                      0x3d, 0xfd, 0x84, 0xd2, 0xc0, 0x4d, 0x7e, 0x3, 0x5a, 0xd7, 0x82, 0x69, 0x29, 0x65, 0xf3};
  uint8_t bytes6[] = {0xca, 0x17, 0xd5, 0x44};
  uint8_t bytes7[] = {0x17, 0xb8, 0x1a, 0x10, 0xda, 0x27, 0x74, 0x4d, 0x21, 0x83,
                      0xa7, 0x9e, 0x58, 0xda, 0xc,  0xd2, 0x1a, 0xb2, 0xac};
  uint8_t bytes8[] = {0x2c, 0xf7, 0xb9, 0xd8, 0xf5, 0xc6, 0x7b, 0xda, 0x10, 0xbe, 0x1,  0x39, 0x6a,
                      0xed, 0x34, 0xda, 0x1d, 0xc6, 0xc8, 0xb4, 0xe7, 0x5e, 0x1c, 0xb8, 0x86, 0x82};
  uint8_t bytes9[] = {0xaf, 0x7f, 0x80, 0xab, 0x6e, 0x42, 0xaa, 0x59, 0xcc, 0xb3, 0xfd, 0x13};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytes2}, .v = {24, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16128}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 340}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28072}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27514}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17275}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32698}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22407}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11284}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22458}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17500}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20435}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23566}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31455, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "(\193\NAK\240\&3\174\176\CAN:q$\160F7+\162\164\bNCu\128\&3P\131\130\151\239g7", _pubPktID = 31413, _pubBody = "",
// _pubProps = [PropAuthenticationData
// "\141\201\231\233\244\139\nR\172\254\176\179+\161\136z\STX.\243VS",PropRetainAvailable 236,PropAuthenticationMethod
// "\248\184\140N\231~&C\DC2l\138\130bQ",PropTopicAlias 11716,PropUserProperty "\NULf\251\NUL\213E\217"
// "\"\ETXUz\195v\222\247f-\181)\161\212\170A",PropAuthenticationMethod "\165\235\129",PropRetainAvailable
// 55,PropWillDelayInterval 6889,PropWillDelayInterval 633,PropUserProperty
// "[,$\214\141\169\STX\DC1\255\189\ETX7\GSc,\189\151\217\134\165\196\167\154;" "\DLE",PropSessionExpiryInterval
// 32250,PropContentType "\245{~\213\167]",PropReasonString
// "\242\241B\213\205E\135\215MG\237\ACK\194\SYN",PropAuthenticationMethod "6\210D",PropRetainAvailable
// 129,PropAuthenticationMethod "\158\SIzy",PropMaximumQoS 44,PropCorrelationData "",PropSharedSubscriptionAvailable
// 24,PropResponseInformation
// "\160\184\DC1;\b\184\132\255F\245/\250O\224\US:\146\196~\DC4\189Y\195\247\190$\EOT\SUB\128",PropTopicAlias
// 26050,PropSubscriptionIdentifier 20]}
TEST(Publish50QCTest, Encode62) {
  uint8_t pkt[] = {0x3d, 0xf8, 0x1,  0x0,  0x1e, 0x28, 0xc1, 0x15, 0xf0, 0x33, 0xae, 0xb0, 0x18, 0x3a, 0x71, 0x24, 0xa0,
                   0x46, 0x37, 0x2b, 0xa2, 0xa4, 0x8,  0x4e, 0x43, 0x75, 0x80, 0x33, 0x50, 0x83, 0x82, 0x97, 0xef, 0x67,
                   0x37, 0x7a, 0xb5, 0xd4, 0x1,  0x16, 0x0,  0x15, 0x8d, 0xc9, 0xe7, 0xe9, 0xf4, 0x8b, 0xa,  0x52, 0xac,
                   0xfe, 0xb0, 0xb3, 0x2b, 0xa1, 0x88, 0x7a, 0x2,  0x2e, 0xf3, 0x56, 0x53, 0x25, 0xec, 0x15, 0x0,  0xe,
                   0xf8, 0xb8, 0x8c, 0x4e, 0xe7, 0x7e, 0x26, 0x43, 0x12, 0x6c, 0x8a, 0x82, 0x62, 0x51, 0x23, 0x2d, 0xc4,
                   0x26, 0x0,  0x7,  0x0,  0x66, 0xfb, 0x0,  0xd5, 0x45, 0xd9, 0x0,  0x10, 0x22, 0x3,  0x55, 0x7a, 0xc3,
                   0x76, 0xde, 0xf7, 0x66, 0x2d, 0xb5, 0x29, 0xa1, 0xd4, 0xaa, 0x41, 0x15, 0x0,  0x3,  0xa5, 0xeb, 0x81,
                   0x25, 0x37, 0x18, 0x0,  0x0,  0x1a, 0xe9, 0x18, 0x0,  0x0,  0x2,  0x79, 0x26, 0x0,  0x18, 0x5b, 0x2c,
                   0x24, 0xd6, 0x8d, 0xa9, 0x2,  0x11, 0xff, 0xbd, 0x3,  0x37, 0x1d, 0x63, 0x2c, 0xbd, 0x97, 0xd9, 0x86,
                   0xa5, 0xc4, 0xa7, 0x9a, 0x3b, 0x0,  0x1,  0x10, 0x11, 0x0,  0x0,  0x7d, 0xfa, 0x3,  0x0,  0x6,  0xf5,
                   0x7b, 0x7e, 0xd5, 0xa7, 0x5d, 0x1f, 0x0,  0xe,  0xf2, 0xf1, 0x42, 0xd5, 0xcd, 0x45, 0x87, 0xd7, 0x4d,
                   0x47, 0xed, 0x6,  0xc2, 0x16, 0x15, 0x0,  0x3,  0x36, 0xd2, 0x44, 0x25, 0x81, 0x15, 0x0,  0x4,  0x9e,
                   0xf,  0x7a, 0x79, 0x24, 0x2c, 0x9,  0x0,  0x0,  0x2a, 0x18, 0x1a, 0x0,  0x1d, 0xa0, 0xb8, 0x11, 0x3b,
                   0x8,  0xb8, 0x84, 0xff, 0x46, 0xf5, 0x2f, 0xfa, 0x4f, 0xe0, 0x1f, 0x3a, 0x92, 0xc4, 0x7e, 0x14, 0xbd,
                   0x59, 0xc3, 0xf7, 0xbe, 0x24, 0x4,  0x1a, 0x80, 0x23, 0x65, 0xc2, 0xb,  0x14};

  uint8_t buf[261] = {0};

  uint8_t topic_bytes[] = {0x28, 0xc1, 0x15, 0xf0, 0x33, 0xae, 0xb0, 0x18, 0x3a, 0x71, 0x24, 0xa0, 0x46, 0x37, 0x2b,
                           0xa2, 0xa4, 0x8,  0x4e, 0x43, 0x75, 0x80, 0x33, 0x50, 0x83, 0x82, 0x97, 0xef, 0x67, 0x37};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytes0[] = {0x8d, 0xc9, 0xe7, 0xe9, 0xf4, 0x8b, 0xa,  0x52, 0xac, 0xfe, 0xb0,
                      0xb3, 0x2b, 0xa1, 0x88, 0x7a, 0x2,  0x2e, 0xf3, 0x56, 0x53};
  uint8_t bytes1[] = {0xf8, 0xb8, 0x8c, 0x4e, 0xe7, 0x7e, 0x26, 0x43, 0x12, 0x6c, 0x8a, 0x82, 0x62, 0x51};
  uint8_t bytes3[] = {0x22, 0x3, 0x55, 0x7a, 0xc3, 0x76, 0xde, 0xf7, 0x66, 0x2d, 0xb5, 0x29, 0xa1, 0xd4, 0xaa, 0x41};
  uint8_t bytes2[] = {0x0, 0x66, 0xfb, 0x0, 0xd5, 0x45, 0xd9};
  uint8_t bytes4[] = {0xa5, 0xeb, 0x81};
  uint8_t bytes6[] = {0x10};
  uint8_t bytes5[] = {0x5b, 0x2c, 0x24, 0xd6, 0x8d, 0xa9, 0x2,  0x11, 0xff, 0xbd, 0x3,  0x37,
                      0x1d, 0x63, 0x2c, 0xbd, 0x97, 0xd9, 0x86, 0xa5, 0xc4, 0xa7, 0x9a, 0x3b};
  uint8_t bytes7[] = {0xf5, 0x7b, 0x7e, 0xd5, 0xa7, 0x5d};
  uint8_t bytes8[] = {0xf2, 0xf1, 0x42, 0xd5, 0xcd, 0x45, 0x87, 0xd7, 0x4d, 0x47, 0xed, 0x6, 0xc2, 0x16};
  uint8_t bytes9[] = {0x36, 0xd2, 0x44};
  uint8_t bytes10[] = {0x9e, 0xf, 0x7a, 0x79};
  uint8_t bytes11[] = {0};
  uint8_t bytes12[] = {0xa0, 0xb8, 0x11, 0x3b, 0x8,  0xb8, 0x84, 0xff, 0x46, 0xf5, 0x2f, 0xfa, 0x4f, 0xe0, 0x1f,
                       0x3a, 0x92, 0xc4, 0x7e, 0x14, 0xbd, 0x59, 0xc3, 0xf7, 0xbe, 0x24, 0x4,  0x1a, 0x80};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11716}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytes2}, .v = {16, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6889}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 633}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytes5}, .v = {1, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32250}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytes11}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytes12}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26050}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 31413, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "u\197\FS\156\226\226\156\fe7\SUBD\251}\132(:k", _pubPktID = 0, _pubBody =
// "=\RS\224\ENQ\"\187\165\211E\156*\f\133Ox\197\162J\168\131\167I\SUB\190)\240\DEL\EM\216\255", _pubProps =
// [PropRequestProblemInformation 38,PropServerKeepAlive 10076,PropAuthenticationData
// "\158\&5\RS\EMUr\232\129k\213\201\226\136W\157B\152NfH\226\183\168\149\NUL\208\219\162S\DC3",PropWillDelayInterval
// 21513,PropWildcardSubscriptionAvailable 21,PropWillDelayInterval 20941,PropTopicAliasMaximum 9284,PropUserProperty
// "{\202\ACKK\ETBsGc\ETX\SO\DC1\SI\141\157\193\170]@\191'\212\SO"
// "\156$K\244\&5\190qKYP\197\145",PropSubscriptionIdentifierAvailable 89,PropSessionExpiryInterval 29682,PropTopicAlias
// 27941,PropReceiveMaximum 25188,PropResponseTopic "5\231tlZ\205-\GS7\NULE9\236",PropMaximumPacketSize
// 24955,PropRequestProblemInformation 253,PropServerReference
// "A8}\139\176\238C\248\186\STX\EM\237:e-\185\&5\241\232\255\220\241\196H\198A\206w",PropRequestResponseInformation
// 50,PropSubscriptionIdentifier 5,PropTopicAliasMaximum 7034,PropTopicAliasMaximum 10862,PropPayloadFormatIndicator
// 0,PropReceiveMaximum 6924,PropRetainAvailable 196,PropRetainAvailable 211,PropResponseTopic
// "\179\176S\130|\148C",PropAuthenticationData "\165\225\230b\254\231c",PropMaximumQoS 77,PropAssignedClientIdentifier
// "1\178\254\156",PropRetainAvailable 224,PropSubscriptionIdentifier 27]}
TEST(Publish50QCTest, Encode63) {
  uint8_t pkt[] = {
      0x30, 0x87, 0x2,  0x0,  0x12, 0x75, 0xc5, 0x1c, 0x9c, 0xe2, 0xe2, 0x9c, 0xc,  0x65, 0x37, 0x1a, 0x44, 0xfb, 0x7d,
      0x84, 0x28, 0x3a, 0x6b, 0xd3, 0x1,  0x17, 0x26, 0x13, 0x27, 0x5c, 0x16, 0x0,  0x1e, 0x9e, 0x35, 0x1e, 0x19, 0x55,
      0x72, 0xe8, 0x81, 0x6b, 0xd5, 0xc9, 0xe2, 0x88, 0x57, 0x9d, 0x42, 0x98, 0x4e, 0x66, 0x48, 0xe2, 0xb7, 0xa8, 0x95,
      0x0,  0xd0, 0xdb, 0xa2, 0x53, 0x13, 0x18, 0x0,  0x0,  0x54, 0x9,  0x28, 0x15, 0x18, 0x0,  0x0,  0x51, 0xcd, 0x22,
      0x24, 0x44, 0x26, 0x0,  0x16, 0x7b, 0xca, 0x6,  0x4b, 0x17, 0x73, 0x47, 0x63, 0x3,  0xe,  0x11, 0xf,  0x8d, 0x9d,
      0xc1, 0xaa, 0x5d, 0x40, 0xbf, 0x27, 0xd4, 0xe,  0x0,  0xc,  0x9c, 0x24, 0x4b, 0xf4, 0x35, 0xbe, 0x71, 0x4b, 0x59,
      0x50, 0xc5, 0x91, 0x29, 0x59, 0x11, 0x0,  0x0,  0x73, 0xf2, 0x23, 0x6d, 0x25, 0x21, 0x62, 0x64, 0x8,  0x0,  0xd,
      0x35, 0xe7, 0x74, 0x6c, 0x5a, 0xcd, 0x2d, 0x1d, 0x37, 0x0,  0x45, 0x39, 0xec, 0x27, 0x0,  0x0,  0x61, 0x7b, 0x17,
      0xfd, 0x1c, 0x0,  0x1c, 0x41, 0x38, 0x7d, 0x8b, 0xb0, 0xee, 0x43, 0xf8, 0xba, 0x2,  0x19, 0xed, 0x3a, 0x65, 0x2d,
      0xb9, 0x35, 0xf1, 0xe8, 0xff, 0xdc, 0xf1, 0xc4, 0x48, 0xc6, 0x41, 0xce, 0x77, 0x19, 0x32, 0xb,  0x5,  0x22, 0x1b,
      0x7a, 0x22, 0x2a, 0x6e, 0x1,  0x0,  0x21, 0x1b, 0xc,  0x25, 0xc4, 0x25, 0xd3, 0x8,  0x0,  0x7,  0xb3, 0xb0, 0x53,
      0x82, 0x7c, 0x94, 0x43, 0x16, 0x0,  0x7,  0xa5, 0xe1, 0xe6, 0x62, 0xfe, 0xe7, 0x63, 0x24, 0x4d, 0x12, 0x0,  0x4,
      0x31, 0xb2, 0xfe, 0x9c, 0x25, 0xe0, 0xb,  0x1b, 0x3d, 0x1e, 0xe0, 0x5,  0x22, 0xbb, 0xa5, 0xd3, 0x45, 0x9c, 0x2a,
      0xc,  0x85, 0x4f, 0x78, 0xc5, 0xa2, 0x4a, 0xa8, 0x83, 0xa7, 0x49, 0x1a, 0xbe, 0x29, 0xf0, 0x7f, 0x19, 0xd8, 0xff};

  uint8_t buf[276] = {0};

  uint8_t topic_bytes[] = {0x75, 0xc5, 0x1c, 0x9c, 0xe2, 0xe2, 0x9c, 0xc,  0x65,
                           0x37, 0x1a, 0x44, 0xfb, 0x7d, 0x84, 0x28, 0x3a, 0x6b};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3d, 0x1e, 0xe0, 0x5,  0x22, 0xbb, 0xa5, 0xd3, 0x45, 0x9c, 0x2a, 0xc,  0x85, 0x4f, 0x78,
                         0xc5, 0xa2, 0x4a, 0xa8, 0x83, 0xa7, 0x49, 0x1a, 0xbe, 0x29, 0xf0, 0x7f, 0x19, 0xd8, 0xff};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytes0[] = {0x9e, 0x35, 0x1e, 0x19, 0x55, 0x72, 0xe8, 0x81, 0x6b, 0xd5, 0xc9, 0xe2, 0x88, 0x57, 0x9d,
                      0x42, 0x98, 0x4e, 0x66, 0x48, 0xe2, 0xb7, 0xa8, 0x95, 0x0,  0xd0, 0xdb, 0xa2, 0x53, 0x13};
  uint8_t bytes2[] = {0x9c, 0x24, 0x4b, 0xf4, 0x35, 0xbe, 0x71, 0x4b, 0x59, 0x50, 0xc5, 0x91};
  uint8_t bytes1[] = {0x7b, 0xca, 0x6,  0x4b, 0x17, 0x73, 0x47, 0x63, 0x3,  0xe,  0x11,
                      0xf,  0x8d, 0x9d, 0xc1, 0xaa, 0x5d, 0x40, 0xbf, 0x27, 0xd4, 0xe};
  uint8_t bytes3[] = {0x35, 0xe7, 0x74, 0x6c, 0x5a, 0xcd, 0x2d, 0x1d, 0x37, 0x0, 0x45, 0x39, 0xec};
  uint8_t bytes4[] = {0x41, 0x38, 0x7d, 0x8b, 0xb0, 0xee, 0x43, 0xf8, 0xba, 0x2,  0x19, 0xed, 0x3a, 0x65,
                      0x2d, 0xb9, 0x35, 0xf1, 0xe8, 0xff, 0xdc, 0xf1, 0xc4, 0x48, 0xc6, 0x41, 0xce, 0x77};
  uint8_t bytes5[] = {0xb3, 0xb0, 0x53, 0x82, 0x7c, 0x94, 0x43};
  uint8_t bytes6[] = {0xa5, 0xe1, 0xe6, 0x62, 0xfe, 0xe7, 0x63};
  uint8_t bytes7[] = {0x31, 0xb2, 0xfe, 0x9c};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10076}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21513}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20941}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9284}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytes1}, .v = {12, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29682}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27941}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25188}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24955}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7034}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10862}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6924}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "s`#B\129\251kP3\n8", _pubPktID =
// 13139, _pubBody = "\SI{\192", _pubProps = [PropTopicAliasMaximum 20038,PropWillDelayInterval
// 4,PropMessageExpiryInterval 16799,PropAuthenticationMethod
// "n\245\NUL\b\132\243\147\171\US:\252\174j\252\238\227\US\136\222P*\204\SO",PropWildcardSubscriptionAvailable
// 96,PropUserProperty "\SO5\189\152r\255\130S\241i\bW\182\133G\ENQ\164" "\138",PropAssignedClientIdentifier
// "\185^\DC1\n",PropReceiveMaximum 10939,PropWillDelayInterval 29097,PropReasonString
// "\195\241\255\t\DC3\154\232\EOTC\151\247\159)",PropWildcardSubscriptionAvailable 77,PropReceiveMaximum
// 26989,PropResponseInformation "*\DEL\143\EM\182A\140\169b\SOH\140\220T",PropReceiveMaximum
// 10597,PropMessageExpiryInterval 3410,PropResponseInformation
// "\SO\170\139\156vQ\161\149\ESCb\200\232",PropMaximumPacketSize 6859,PropContentType
// "L\161\225\222E\173&\207\&5M\177\209N\195s\161\181/<\149\147\&8\159.",PropCorrelationData
// "\SYN\231l\140\n\230\254w\228\195\144\244\129\CANo\250j\SYN\177v\190\\g\136{.",PropServerReference
// "\128\253\136A",PropServerReference "\176"]}
TEST(Publish50QCTest, Encode64) {
  uint8_t pkt[] = {0x3c, 0xe7, 0x1,  0x0,  0xb,  0x73, 0x60, 0x23, 0x42, 0x81, 0xfb, 0x6b, 0x50, 0x33, 0xa,  0x38, 0x33,
                   0x53, 0xd3, 0x1,  0x22, 0x4e, 0x46, 0x18, 0x0,  0x0,  0x0,  0x4,  0x2,  0x0,  0x0,  0x41, 0x9f, 0x15,
                   0x0,  0x17, 0x6e, 0xf5, 0x0,  0x8,  0x84, 0xf3, 0x93, 0xab, 0x1f, 0x3a, 0xfc, 0xae, 0x6a, 0xfc, 0xee,
                   0xe3, 0x1f, 0x88, 0xde, 0x50, 0x2a, 0xcc, 0xe,  0x28, 0x60, 0x26, 0x0,  0x11, 0xe,  0x35, 0xbd, 0x98,
                   0x72, 0xff, 0x82, 0x53, 0xf1, 0x69, 0x8,  0x57, 0xb6, 0x85, 0x47, 0x5,  0xa4, 0x0,  0x1,  0x8a, 0x12,
                   0x0,  0x4,  0xb9, 0x5e, 0x11, 0xa,  0x21, 0x2a, 0xbb, 0x18, 0x0,  0x0,  0x71, 0xa9, 0x1f, 0x0,  0xd,
                   0xc3, 0xf1, 0xff, 0x9,  0x13, 0x9a, 0xe8, 0x4,  0x43, 0x97, 0xf7, 0x9f, 0x29, 0x28, 0x4d, 0x21, 0x69,
                   0x6d, 0x1a, 0x0,  0xd,  0x2a, 0x7f, 0x8f, 0x19, 0xb6, 0x41, 0x8c, 0xa9, 0x62, 0x1,  0x8c, 0xdc, 0x54,
                   0x21, 0x29, 0x65, 0x2,  0x0,  0x0,  0xd,  0x52, 0x1a, 0x0,  0xc,  0xe,  0xaa, 0x8b, 0x9c, 0x76, 0x51,
                   0xa1, 0x95, 0x1b, 0x62, 0xc8, 0xe8, 0x27, 0x0,  0x0,  0x1a, 0xcb, 0x3,  0x0,  0x18, 0x4c, 0xa1, 0xe1,
                   0xde, 0x45, 0xad, 0x26, 0xcf, 0x35, 0x4d, 0xb1, 0xd1, 0x4e, 0xc3, 0x73, 0xa1, 0xb5, 0x2f, 0x3c, 0x95,
                   0x93, 0x38, 0x9f, 0x2e, 0x9,  0x0,  0x1a, 0x16, 0xe7, 0x6c, 0x8c, 0xa,  0xe6, 0xfe, 0x77, 0xe4, 0xc3,
                   0x90, 0xf4, 0x81, 0x18, 0x6f, 0xfa, 0x6a, 0x16, 0xb1, 0x76, 0xbe, 0x5c, 0x67, 0x88, 0x7b, 0x2e, 0x1c,
                   0x0,  0x4,  0x80, 0xfd, 0x88, 0x41, 0x1c, 0x0,  0x1,  0xb0, 0xf,  0x7b, 0xc0};

  uint8_t buf[244] = {0};

  uint8_t topic_bytes[] = {0x73, 0x60, 0x23, 0x42, 0x81, 0xfb, 0x6b, 0x50, 0x33, 0xa, 0x38};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf, 0x7b, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytes0[] = {0x6e, 0xf5, 0x0,  0x8,  0x84, 0xf3, 0x93, 0xab, 0x1f, 0x3a, 0xfc, 0xae,
                      0x6a, 0xfc, 0xee, 0xe3, 0x1f, 0x88, 0xde, 0x50, 0x2a, 0xcc, 0xe};
  uint8_t bytes2[] = {0x8a};
  uint8_t bytes1[] = {0xe,  0x35, 0xbd, 0x98, 0x72, 0xff, 0x82, 0x53, 0xf1,
                      0x69, 0x8,  0x57, 0xb6, 0x85, 0x47, 0x5,  0xa4};
  uint8_t bytes3[] = {0xb9, 0x5e, 0x11, 0xa};
  uint8_t bytes4[] = {0xc3, 0xf1, 0xff, 0x9, 0x13, 0x9a, 0xe8, 0x4, 0x43, 0x97, 0xf7, 0x9f, 0x29};
  uint8_t bytes5[] = {0x2a, 0x7f, 0x8f, 0x19, 0xb6, 0x41, 0x8c, 0xa9, 0x62, 0x1, 0x8c, 0xdc, 0x54};
  uint8_t bytes6[] = {0xe, 0xaa, 0x8b, 0x9c, 0x76, 0x51, 0xa1, 0x95, 0x1b, 0x62, 0xc8, 0xe8};
  uint8_t bytes7[] = {0x4c, 0xa1, 0xe1, 0xde, 0x45, 0xad, 0x26, 0xcf, 0x35, 0x4d, 0xb1, 0xd1,
                      0x4e, 0xc3, 0x73, 0xa1, 0xb5, 0x2f, 0x3c, 0x95, 0x93, 0x38, 0x9f, 0x2e};
  uint8_t bytes8[] = {0x16, 0xe7, 0x6c, 0x8c, 0xa,  0xe6, 0xfe, 0x77, 0xe4, 0xc3, 0x90, 0xf4, 0x81,
                      0x18, 0x6f, 0xfa, 0x6a, 0x16, 0xb1, 0x76, 0xbe, 0x5c, 0x67, 0x88, 0x7b, 0x2e};
  uint8_t bytes9[] = {0x80, 0xfd, 0x88, 0x41};
  uint8_t bytes10[] = {0xb0};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20038}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16799}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytes1}, .v = {1, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10939}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29097}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26989}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10597}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3410}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6859}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytes10}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 13139, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163]", _pubPktID = 9229, _pubBody =
// ":,\175v\152}\RS8\178|K\148\f\219\184\129Ep^\n\194\148\SOHv\\\ETB\253^", _pubProps = [PropRequestProblemInformation
// 195]}
TEST(Publish50QCTest, Encode65) {
  uint8_t pkt[] = {0x3c, 0x25, 0x0,  0x2,  0xa3, 0x5d, 0x24, 0xd,  0x2,  0x17, 0xc3, 0x3a, 0x2c,
                   0xaf, 0x76, 0x98, 0x7d, 0x1e, 0x38, 0xb2, 0x7c, 0x4b, 0x94, 0xc,  0xdb, 0xb8,
                   0x81, 0x45, 0x70, 0x5e, 0xa,  0xc2, 0x94, 0x1,  0x76, 0x5c, 0x17, 0xfd, 0x5e};

  uint8_t buf[49] = {0};

  uint8_t topic_bytes[] = {0xa3, 0x5d};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3a, 0x2c, 0xaf, 0x76, 0x98, 0x7d, 0x1e, 0x38, 0xb2, 0x7c, 0x4b, 0x94, 0xc,  0xdb,
                         0xb8, 0x81, 0x45, 0x70, 0x5e, 0xa,  0xc2, 0x94, 0x1,  0x76, 0x5c, 0x17, 0xfd, 0x5e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 9229, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "'\148R\STX\207v\202o[1\154JIl\129\189\&9.\231\220u\233\200G\f \241\196M:", _pubPktID = 0, _pubBody =
// "\239\141wL\FS\241\255ZW8R\f\CAN\ACKT\215)ZZ\200z\239", _pubProps = []}
TEST(Publish50QCTest, Encode66) {
  uint8_t pkt[] = {0x30, 0x37, 0x0,  0x1e, 0x27, 0x94, 0x52, 0x2,  0xcf, 0x76, 0xca, 0x6f, 0x5b, 0x31, 0x9a,
                   0x4a, 0x49, 0x6c, 0x81, 0xbd, 0x39, 0x2e, 0xe7, 0xdc, 0x75, 0xe9, 0xc8, 0x47, 0xc,  0x20,
                   0xf1, 0xc4, 0x4d, 0x3a, 0x0,  0xef, 0x8d, 0x77, 0x4c, 0x1c, 0xf1, 0xff, 0x5a, 0x57, 0x38,
                   0x52, 0xc,  0x18, 0x6,  0x54, 0xd7, 0x29, 0x5a, 0x5a, 0xc8, 0x7a, 0xef};

  uint8_t buf[67] = {0};

  uint8_t topic_bytes[] = {0x27, 0x94, 0x52, 0x2,  0xcf, 0x76, 0xca, 0x6f, 0x5b, 0x31, 0x9a, 0x4a, 0x49, 0x6c, 0x81,
                           0xbd, 0x39, 0x2e, 0xe7, 0xdc, 0x75, 0xe9, 0xc8, 0x47, 0xc,  0x20, 0xf1, 0xc4, 0x4d, 0x3a};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xef, 0x8d, 0x77, 0x4c, 0x1c, 0xf1, 0xff, 0x5a, 0x57, 0x38, 0x52,
                         0xc,  0x18, 0x6,  0x54, 0xd7, 0x29, 0x5a, 0x5a, 0xc8, 0x7a, 0xef};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t proplist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "9\140\202\235A\137*\ESC\202=k\179\211?\NAK\238", _pubPktID = 0, _pubBody =
// "R\140Q\187\192\240\209=*\152Ov\136\254G\251", _pubProps = [PropSessionExpiryInterval 12836,PropReasonString
// "\212\&7L\201\&2RS\250\130\218\228X\171\197",PropPayloadFormatIndicator 191,PropAssignedClientIdentifier
// "\132Z\DC2^H\ti\DC2b{VW\DLE\237\193\236y\207\132\236\133\&2\247\230\185j\233",PropMessageExpiryInterval
// 20000,PropAssignedClientIdentifier "\235\132",PropSubscriptionIdentifierAvailable 255,PropAssignedClientIdentifier
// "\\!\192"]}
TEST(Publish50QCTest, Encode67) {
  uint8_t pkt[] = {0x38, 0x6b, 0x0,  0x10, 0x39, 0x8c, 0xca, 0xeb, 0x41, 0x89, 0x2a, 0x1b, 0xca, 0x3d, 0x6b, 0xb3,
                   0xd3, 0x3f, 0x15, 0xee, 0x48, 0x11, 0x0,  0x0,  0x32, 0x24, 0x1f, 0x0,  0xe,  0xd4, 0x37, 0x4c,
                   0xc9, 0x32, 0x52, 0x53, 0xfa, 0x82, 0xda, 0xe4, 0x58, 0xab, 0xc5, 0x1,  0xbf, 0x12, 0x0,  0x1b,
                   0x84, 0x5a, 0x12, 0x5e, 0x48, 0x9,  0x69, 0x12, 0x62, 0x7b, 0x56, 0x57, 0x10, 0xed, 0xc1, 0xec,
                   0x79, 0xcf, 0x84, 0xec, 0x85, 0x32, 0xf7, 0xe6, 0xb9, 0x6a, 0xe9, 0x2,  0x0,  0x0,  0x4e, 0x20,
                   0x12, 0x0,  0x2,  0xeb, 0x84, 0x29, 0xff, 0x12, 0x0,  0x3,  0x5c, 0x21, 0xc0, 0x52, 0x8c, 0x51,
                   0xbb, 0xc0, 0xf0, 0xd1, 0x3d, 0x2a, 0x98, 0x4f, 0x76, 0x88, 0xfe, 0x47, 0xfb};

  uint8_t buf[119] = {0};

  uint8_t topic_bytes[] = {0x39, 0x8c, 0xca, 0xeb, 0x41, 0x89, 0x2a, 0x1b,
                           0xca, 0x3d, 0x6b, 0xb3, 0xd3, 0x3f, 0x15, 0xee};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x52, 0x8c, 0x51, 0xbb, 0xc0, 0xf0, 0xd1, 0x3d,
                         0x2a, 0x98, 0x4f, 0x76, 0x88, 0xfe, 0x47, 0xfb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytes0[] = {0xd4, 0x37, 0x4c, 0xc9, 0x32, 0x52, 0x53, 0xfa, 0x82, 0xda, 0xe4, 0x58, 0xab, 0xc5};
  uint8_t bytes1[] = {0x84, 0x5a, 0x12, 0x5e, 0x48, 0x9,  0x69, 0x12, 0x62, 0x7b, 0x56, 0x57, 0x10, 0xed,
                      0xc1, 0xec, 0x79, 0xcf, 0x84, 0xec, 0x85, 0x32, 0xf7, 0xe6, 0xb9, 0x6a, 0xe9};
  uint8_t bytes2[] = {0xeb, 0x84};
  uint8_t bytes3[] = {0x5c, 0x21, 0xc0};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12836}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20000}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytes3}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\255\250\242r^\171,{\253\254\200\128\135\225AG\149\&3", _pubPktID = 19170, _pubBody = "\GS", _pubProps =
// [PropSharedSubscriptionAvailable 230,PropSubscriptionIdentifier 28,PropSessionExpiryInterval
// 9477,PropRequestResponseInformation 163,PropMessageExpiryInterval 21809,PropSessionExpiryInterval
// 8934,PropResponseTopic "\199<",PropUserProperty
// "\129\ETX\208\ETB\196\158Qu\159\148\214\188\150\178\245\221\132'\211\210Y3P?\213\203>\FS\CAN\254"
// "\163Q\173\EM\170\129!C\233Q\SYN\222A\247\188\DLEi\212Q&\DC3f\210\EOT)\247|",PropMaximumPacketSize
// 16084,PropReasonString
// "\178qh\NUL\211\202\136\v{\236\\\230\164^\174A\145]\225\172f\226\&6\180\&2\153",PropServerKeepAlive
// 25512,PropMaximumPacketSize 3094,PropSessionExpiryInterval 15014,PropAssignedClientIdentifier
// "G\195%\131\199\242(\164v\GSB\v<\196\189\157\239\176\212\&5",PropRequestProblemInformation 144,PropRetainAvailable
// 71,PropWillDelayInterval 2627,PropReceiveMaximum 5184,PropPayloadFormatIndicator 224,PropMaximumPacketSize
// 19270,PropResponseTopic "\129-",PropResponseTopic
// "\185\237\209\&5,!n\140\229\238\NUL\134\185\187&\156\NUL\146\218\154",PropCorrelationData
// "l\248\NUL\229\&1\216\236\166i\253\ETX\n\171if1\180\130\DC4\192\209\198\146",PropRequestResponseInformation 61]}
TEST(Publish50QCTest, Encode68) {
  uint8_t pkt[] = {
      0x35, 0x82, 0x2,  0x0,  0x12, 0xff, 0xfa, 0xf2, 0x72, 0x5e, 0xab, 0x2c, 0x7b, 0xfd, 0xfe, 0xc8, 0x80, 0x87, 0xe1,
      0x41, 0x47, 0x95, 0x33, 0x4a, 0xe2, 0xe9, 0x1,  0x2a, 0xe6, 0xb,  0x1c, 0x11, 0x0,  0x0,  0x25, 0x5,  0x19, 0xa3,
      0x2,  0x0,  0x0,  0x55, 0x31, 0x11, 0x0,  0x0,  0x22, 0xe6, 0x8,  0x0,  0x2,  0xc7, 0x3c, 0x26, 0x0,  0x1e, 0x81,
      0x3,  0xd0, 0x17, 0xc4, 0x9e, 0x51, 0x75, 0x9f, 0x94, 0xd6, 0xbc, 0x96, 0xb2, 0xf5, 0xdd, 0x84, 0x27, 0xd3, 0xd2,
      0x59, 0x33, 0x50, 0x3f, 0xd5, 0xcb, 0x3e, 0x1c, 0x18, 0xfe, 0x0,  0x1b, 0xa3, 0x51, 0xad, 0x19, 0xaa, 0x81, 0x21,
      0x43, 0xe9, 0x51, 0x16, 0xde, 0x41, 0xf7, 0xbc, 0x10, 0x69, 0xd4, 0x51, 0x26, 0x13, 0x66, 0xd2, 0x4,  0x29, 0xf7,
      0x7c, 0x27, 0x0,  0x0,  0x3e, 0xd4, 0x1f, 0x0,  0x1a, 0xb2, 0x71, 0x68, 0x0,  0xd3, 0xca, 0x88, 0xb,  0x7b, 0xec,
      0x5c, 0xe6, 0xa4, 0x5e, 0xae, 0x41, 0x91, 0x5d, 0xe1, 0xac, 0x66, 0xe2, 0x36, 0xb4, 0x32, 0x99, 0x13, 0x63, 0xa8,
      0x27, 0x0,  0x0,  0xc,  0x16, 0x11, 0x0,  0x0,  0x3a, 0xa6, 0x12, 0x0,  0x14, 0x47, 0xc3, 0x25, 0x83, 0xc7, 0xf2,
      0x28, 0xa4, 0x76, 0x1d, 0x42, 0xb,  0x3c, 0xc4, 0xbd, 0x9d, 0xef, 0xb0, 0xd4, 0x35, 0x17, 0x90, 0x25, 0x47, 0x18,
      0x0,  0x0,  0xa,  0x43, 0x21, 0x14, 0x40, 0x1,  0xe0, 0x27, 0x0,  0x0,  0x4b, 0x46, 0x8,  0x0,  0x2,  0x81, 0x2d,
      0x8,  0x0,  0x14, 0xb9, 0xed, 0xd1, 0x35, 0x2c, 0x21, 0x6e, 0x8c, 0xe5, 0xee, 0x0,  0x86, 0xb9, 0xbb, 0x26, 0x9c,
      0x0,  0x92, 0xda, 0x9a, 0x9,  0x0,  0x17, 0x6c, 0xf8, 0x0,  0xe5, 0x31, 0xd8, 0xec, 0xa6, 0x69, 0xfd, 0x3,  0xa,
      0xab, 0x69, 0x66, 0x31, 0xb4, 0x82, 0x14, 0xc0, 0xd1, 0xc6, 0x92, 0x19, 0x3d, 0x1d};

  uint8_t buf[271] = {0};

  uint8_t topic_bytes[] = {0xff, 0xfa, 0xf2, 0x72, 0x5e, 0xab, 0x2c, 0x7b, 0xfd,
                           0xfe, 0xc8, 0x80, 0x87, 0xe1, 0x41, 0x47, 0x95, 0x33};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0xc7, 0x3c};
  uint8_t bytes2[] = {0xa3, 0x51, 0xad, 0x19, 0xaa, 0x81, 0x21, 0x43, 0xe9, 0x51, 0x16, 0xde, 0x41, 0xf7,
                      0xbc, 0x10, 0x69, 0xd4, 0x51, 0x26, 0x13, 0x66, 0xd2, 0x4,  0x29, 0xf7, 0x7c};
  uint8_t bytes1[] = {0x81, 0x3,  0xd0, 0x17, 0xc4, 0x9e, 0x51, 0x75, 0x9f, 0x94, 0xd6, 0xbc, 0x96, 0xb2, 0xf5,
                      0xdd, 0x84, 0x27, 0xd3, 0xd2, 0x59, 0x33, 0x50, 0x3f, 0xd5, 0xcb, 0x3e, 0x1c, 0x18, 0xfe};
  uint8_t bytes3[] = {0xb2, 0x71, 0x68, 0x0,  0xd3, 0xca, 0x88, 0xb,  0x7b, 0xec, 0x5c, 0xe6, 0xa4,
                      0x5e, 0xae, 0x41, 0x91, 0x5d, 0xe1, 0xac, 0x66, 0xe2, 0x36, 0xb4, 0x32, 0x99};
  uint8_t bytes4[] = {0x47, 0xc3, 0x25, 0x83, 0xc7, 0xf2, 0x28, 0xa4, 0x76, 0x1d,
                      0x42, 0xb,  0x3c, 0xc4, 0xbd, 0x9d, 0xef, 0xb0, 0xd4, 0x35};
  uint8_t bytes5[] = {0x81, 0x2d};
  uint8_t bytes6[] = {0xb9, 0xed, 0xd1, 0x35, 0x2c, 0x21, 0x6e, 0x8c, 0xe5, 0xee,
                      0x0,  0x86, 0xb9, 0xbb, 0x26, 0x9c, 0x0,  0x92, 0xda, 0x9a};
  uint8_t bytes7[] = {0x6c, 0xf8, 0x0,  0xe5, 0x31, 0xd8, 0xec, 0xa6, 0x69, 0xfd, 0x3, 0xa,
                      0xab, 0x69, 0x66, 0x31, 0xb4, 0x82, 0x14, 0xc0, 0xd1, 0xc6, 0x92};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9477}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21809}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8934}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytes1}, .v = {27, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16084}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25512}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3094}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15014}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2627}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5184}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19270}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 61}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19170, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\f<\223\175\243\197\227\253.l\204M\219\195\149\202\132\194\182\a\CAN\n9't=\191\DLEb", _pubPktID = 0, _pubBody = "",
// _pubProps = [PropTopicAlias 334,PropWildcardSubscriptionAvailable 17,PropSubscriptionIdentifier
// 0,PropMaximumPacketSize 32749,PropTopicAlias 3598,PropCorrelationData "",PropRetainAvailable
// 42,PropSessionExpiryInterval 32318,PropReasonString
// "\b\ENQ\138(U2\245\US\160X+l\225\b;\245\194\235\215",PropMessageExpiryInterval 21429,PropMessageExpiryInterval
// 13732,PropContentType "\195\&1\"",PropReceiveMaximum 17292,PropPayloadFormatIndicator 73,PropServerReference
// "X\CAN",PropSessionExpiryInterval 11644,PropMaximumPacketSize 8238,PropSubscriptionIdentifier
// 1,PropAuthenticationMethod "\246\190\168y\189\fU\139%\150w\236\255\134bw$#\156J",PropTopicAliasMaximum 15559]}
TEST(Publish50QCTest, Encode69) {
  uint8_t pkt[] = {0x31, 0x8f, 0x1,  0x0,  0x1d, 0xc,  0x3c, 0xdf, 0xaf, 0xf3, 0xc5, 0xe3, 0xfd, 0x2e, 0x6c, 0xcc, 0x4d,
                   0xdb, 0xc3, 0x95, 0xca, 0x84, 0xc2, 0xb6, 0x7,  0x18, 0xa,  0x39, 0x27, 0x74, 0x3d, 0xbf, 0x10, 0x62,
                   0x6f, 0x23, 0x1,  0x4e, 0x28, 0x11, 0xb,  0x0,  0x27, 0x0,  0x0,  0x7f, 0xed, 0x23, 0xe,  0xe,  0x9,
                   0x0,  0x0,  0x25, 0x2a, 0x11, 0x0,  0x0,  0x7e, 0x3e, 0x1f, 0x0,  0x13, 0x8,  0x5,  0x8a, 0x28, 0x55,
                   0x32, 0xf5, 0x1f, 0xa0, 0x58, 0x2b, 0x6c, 0xe1, 0x8,  0x3b, 0xf5, 0xc2, 0xeb, 0xd7, 0x2,  0x0,  0x0,
                   0x53, 0xb5, 0x2,  0x0,  0x0,  0x35, 0xa4, 0x3,  0x0,  0x3,  0xc3, 0x31, 0x22, 0x21, 0x43, 0x8c, 0x1,
                   0x49, 0x1c, 0x0,  0x2,  0x58, 0x18, 0x11, 0x0,  0x0,  0x2d, 0x7c, 0x27, 0x0,  0x0,  0x20, 0x2e, 0xb,
                   0x1,  0x15, 0x0,  0x14, 0xf6, 0xbe, 0xa8, 0x79, 0xbd, 0xc,  0x55, 0x8b, 0x25, 0x96, 0x77, 0xec, 0xff,
                   0x86, 0x62, 0x77, 0x24, 0x23, 0x9c, 0x4a, 0x22, 0x3c, 0xc7};

  uint8_t buf[156] = {0};

  uint8_t topic_bytes[] = {0xc,  0x3c, 0xdf, 0xaf, 0xf3, 0xc5, 0xe3, 0xfd, 0x2e, 0x6c, 0xcc, 0x4d, 0xdb, 0xc3, 0x95,
                           0xca, 0x84, 0xc2, 0xb6, 0x7,  0x18, 0xa,  0x39, 0x27, 0x74, 0x3d, 0xbf, 0x10, 0x62};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytes0[] = {0};
  uint8_t bytes1[] = {0x8,  0x5,  0x8a, 0x28, 0x55, 0x32, 0xf5, 0x1f, 0xa0, 0x58,
                      0x2b, 0x6c, 0xe1, 0x8,  0x3b, 0xf5, 0xc2, 0xeb, 0xd7};
  uint8_t bytes2[] = {0xc3, 0x31, 0x22};
  uint8_t bytes3[] = {0x58, 0x18};
  uint8_t bytes4[] = {0xf6, 0xbe, 0xa8, 0x79, 0xbd, 0xc,  0x55, 0x8b, 0x25, 0x96,
                      0x77, 0xec, 0xff, 0x86, 0x62, 0x77, 0x24, 0x23, 0x9c, 0x4a};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 334}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32749}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3598}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32318}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21429}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13732}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17292}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11644}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8238}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15559}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "3", _pubPktID = 27883, _pubBody =
// "\246\DC1,I\237\135\&0/\210\164\233\223de\144\250\141\134\&7\190\194\144\206f", _pubProps = [PropAuthenticationMethod
// "\195\194\210\230\229\150\219\249U\138\166",PropWillDelayInterval 14395,PropCorrelationData
// "\158\CAN\204\138JY\200L<\DLE\222\EM)\226\187\231\135\210b\213\210M\138",PropSharedSubscriptionAvailable
// 79,PropWildcardSubscriptionAvailable 151,PropSubscriptionIdentifier 14,PropRequestProblemInformation
// 161,PropMaximumPacketSize 1060,PropUserProperty "\DC3\DC4"
// "\194\228\135J\132\STX\142\240\151\232\&61\SUB\209\&9\196\239>\164\199\135*\DC4i\209U\249\141`",PropCorrelationData
// "\DEL\147\DC4\151\240\167\160",PropAuthenticationMethod ")\144K\213\b\184g\198\155\130\129\226\228",PropMaximumQoS
// 81,PropReceiveMaximum 31610,PropRetainAvailable 169,PropUserProperty ""
// "\STX3{\205\249\CAN\163\249\STX\163[\234w\171y\204\137\132LG\220o\136\232'\139",PropRequestProblemInformation
// 16,PropAuthenticationMethod "Mr\191c\DC3Cu\146",PropMessageExpiryInterval 9582,PropSubscriptionIdentifier
// 30,PropTopicAlias 11509,PropRetainAvailable 152,PropServerReference
// "\202\180om\130\155\ACK\SOH\132\133\GS60\180\192p\134\165XD\141",PropMaximumPacketSize 16715,PropServerKeepAlive
// 20089,PropRequestProblemInformation 33,PropAuthenticationMethod "[\147\255\210\188L\234",PropAuthenticationData
// "\245/\232\f\183\r\203n\143z\223<\DC3\169\173\183\253h\143\247\134b\129H\234",PropSubscriptionIdentifierAvailable
// 150,PropSubscriptionIdentifierAvailable 209,PropMessageExpiryInterval 29310]}
TEST(Publish50QCTest, Encode70) {
  uint8_t pkt[] = {
      0x33, 0xa7, 0x2,  0x0,  0x1,  0x33, 0x6c, 0xeb, 0x88, 0x2,  0x15, 0x0,  0xb,  0xc3, 0xc2, 0xd2, 0xe6, 0xe5, 0x96,
      0xdb, 0xf9, 0x55, 0x8a, 0xa6, 0x18, 0x0,  0x0,  0x38, 0x3b, 0x9,  0x0,  0x17, 0x9e, 0x18, 0xcc, 0x8a, 0x4a, 0x59,
      0xc8, 0x4c, 0x3c, 0x10, 0xde, 0x19, 0x29, 0xe2, 0xbb, 0xe7, 0x87, 0xd2, 0x62, 0xd5, 0xd2, 0x4d, 0x8a, 0x2a, 0x4f,
      0x28, 0x97, 0xb,  0xe,  0x17, 0xa1, 0x27, 0x0,  0x0,  0x4,  0x24, 0x26, 0x0,  0x2,  0x13, 0x14, 0x0,  0x1d, 0xc2,
      0xe4, 0x87, 0x4a, 0x84, 0x2,  0x8e, 0xf0, 0x97, 0xe8, 0x36, 0x31, 0x1a, 0xd1, 0x39, 0xc4, 0xef, 0x3e, 0xa4, 0xc7,
      0x87, 0x2a, 0x14, 0x69, 0xd1, 0x55, 0xf9, 0x8d, 0x60, 0x9,  0x0,  0x7,  0x7f, 0x93, 0x14, 0x97, 0xf0, 0xa7, 0xa0,
      0x15, 0x0,  0xd,  0x29, 0x90, 0x4b, 0xd5, 0x8,  0xb8, 0x67, 0xc6, 0x9b, 0x82, 0x81, 0xe2, 0xe4, 0x24, 0x51, 0x21,
      0x7b, 0x7a, 0x25, 0xa9, 0x26, 0x0,  0x0,  0x0,  0x1a, 0x2,  0x33, 0x7b, 0xcd, 0xf9, 0x18, 0xa3, 0xf9, 0x2,  0xa3,
      0x5b, 0xea, 0x77, 0xab, 0x79, 0xcc, 0x89, 0x84, 0x4c, 0x47, 0xdc, 0x6f, 0x88, 0xe8, 0x27, 0x8b, 0x17, 0x10, 0x15,
      0x0,  0x8,  0x4d, 0x72, 0xbf, 0x63, 0x13, 0x43, 0x75, 0x92, 0x2,  0x0,  0x0,  0x25, 0x6e, 0xb,  0x1e, 0x23, 0x2c,
      0xf5, 0x25, 0x98, 0x1c, 0x0,  0x15, 0xca, 0xb4, 0x6f, 0x6d, 0x82, 0x9b, 0x6,  0x1,  0x84, 0x85, 0x1d, 0x36, 0x30,
      0xb4, 0xc0, 0x70, 0x86, 0xa5, 0x58, 0x44, 0x8d, 0x27, 0x0,  0x0,  0x41, 0x4b, 0x13, 0x4e, 0x79, 0x17, 0x21, 0x15,
      0x0,  0x7,  0x5b, 0x93, 0xff, 0xd2, 0xbc, 0x4c, 0xea, 0x16, 0x0,  0x19, 0xf5, 0x2f, 0xe8, 0xc,  0xb7, 0xd,  0xcb,
      0x6e, 0x8f, 0x7a, 0xdf, 0x3c, 0x13, 0xa9, 0xad, 0xb7, 0xfd, 0x68, 0x8f, 0xf7, 0x86, 0x62, 0x81, 0x48, 0xea, 0x29,
      0x96, 0x29, 0xd1, 0x2,  0x0,  0x0,  0x72, 0x7e, 0xf6, 0x11, 0x2c, 0x49, 0xed, 0x87, 0x30, 0x2f, 0xd2, 0xa4, 0xe9,
      0xdf, 0x64, 0x65, 0x90, 0xfa, 0x8d, 0x86, 0x37, 0xbe, 0xc2, 0x90, 0xce, 0x66};

  uint8_t buf[308] = {0};

  uint8_t topic_bytes[] = {0x33};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf6, 0x11, 0x2c, 0x49, 0xed, 0x87, 0x30, 0x2f, 0xd2, 0xa4, 0xe9, 0xdf,
                         0x64, 0x65, 0x90, 0xfa, 0x8d, 0x86, 0x37, 0xbe, 0xc2, 0x90, 0xce, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0xc3, 0xc2, 0xd2, 0xe6, 0xe5, 0x96, 0xdb, 0xf9, 0x55, 0x8a, 0xa6};
  uint8_t bytes1[] = {0x9e, 0x18, 0xcc, 0x8a, 0x4a, 0x59, 0xc8, 0x4c, 0x3c, 0x10, 0xde, 0x19,
                      0x29, 0xe2, 0xbb, 0xe7, 0x87, 0xd2, 0x62, 0xd5, 0xd2, 0x4d, 0x8a};
  uint8_t bytes3[] = {0xc2, 0xe4, 0x87, 0x4a, 0x84, 0x2,  0x8e, 0xf0, 0x97, 0xe8, 0x36, 0x31, 0x1a, 0xd1, 0x39,
                      0xc4, 0xef, 0x3e, 0xa4, 0xc7, 0x87, 0x2a, 0x14, 0x69, 0xd1, 0x55, 0xf9, 0x8d, 0x60};
  uint8_t bytes2[] = {0x13, 0x14};
  uint8_t bytes4[] = {0x7f, 0x93, 0x14, 0x97, 0xf0, 0xa7, 0xa0};
  uint8_t bytes5[] = {0x29, 0x90, 0x4b, 0xd5, 0x8, 0xb8, 0x67, 0xc6, 0x9b, 0x82, 0x81, 0xe2, 0xe4};
  uint8_t bytes7[] = {0x2,  0x33, 0x7b, 0xcd, 0xf9, 0x18, 0xa3, 0xf9, 0x2,  0xa3, 0x5b, 0xea, 0x77,
                      0xab, 0x79, 0xcc, 0x89, 0x84, 0x4c, 0x47, 0xdc, 0x6f, 0x88, 0xe8, 0x27, 0x8b};
  uint8_t bytes6[] = {0};
  uint8_t bytes8[] = {0x4d, 0x72, 0xbf, 0x63, 0x13, 0x43, 0x75, 0x92};
  uint8_t bytes9[] = {0xca, 0xb4, 0x6f, 0x6d, 0x82, 0x9b, 0x6,  0x1,  0x84, 0x85, 0x1d,
                      0x36, 0x30, 0xb4, 0xc0, 0x70, 0x86, 0xa5, 0x58, 0x44, 0x8d};
  uint8_t bytes10[] = {0x5b, 0x93, 0xff, 0xd2, 0xbc, 0x4c, 0xea};
  uint8_t bytes11[] = {0xf5, 0x2f, 0xe8, 0xc,  0xb7, 0xd,  0xcb, 0x6e, 0x8f, 0x7a, 0xdf, 0x3c, 0x13,
                       0xa9, 0xad, 0xb7, 0xfd, 0x68, 0x8f, 0xf7, 0x86, 0x62, 0x81, 0x48, 0xea};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14395}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1060}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytes2}, .v = {29, (char*)&bytes3}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31610}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytes6}, .v = {26, (char*)&bytes7}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytes8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9582}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11509}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytes9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16715}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20089}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytes10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytes11}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29310}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 27883, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\210\n\244+\148\225\234\&5U\226r16\207\137\NAK}\GSX\204\250S\144\151b\224\184", _pubPktID = 20202, _pubBody =
// "\191\207\175uEn7\171\238\203\140\210I\200!", _pubProps = [PropPayloadFormatIndicator 182,PropMaximumPacketSize
// 28588,PropServerReference "j\171\148\SI\US\208\ENQ`Y;\139\177\US",PropContentType
// "<\SYNI\ACK\SYN\215\212\SUB\196.\133\r\240J\211"]}
TEST(Publish50QCTest, Encode71) {
  uint8_t pkt[] = {0x3b, 0x58, 0x0,  0x1b, 0xd2, 0xa,  0xf4, 0x2b, 0x94, 0xe1, 0xea, 0x35, 0x55, 0xe2, 0x72,
                   0x31, 0x36, 0xcf, 0x89, 0x15, 0x7d, 0x1d, 0x58, 0xcc, 0xfa, 0x53, 0x90, 0x97, 0x62, 0xe0,
                   0xb8, 0x4e, 0xea, 0x29, 0x1,  0xb6, 0x27, 0x0,  0x0,  0x6f, 0xac, 0x1c, 0x0,  0xd,  0x6a,
                   0xab, 0x94, 0xf,  0x1f, 0xd0, 0x5,  0x60, 0x59, 0x3b, 0x8b, 0xb1, 0x1f, 0x3,  0x0,  0xf,
                   0x3c, 0x16, 0x49, 0x6,  0x16, 0xd7, 0xd4, 0x1a, 0xc4, 0x2e, 0x85, 0xd,  0xf0, 0x4a, 0xd3,
                   0xbf, 0xcf, 0xaf, 0x75, 0x45, 0x6e, 0x37, 0xab, 0xee, 0xcb, 0x8c, 0xd2, 0x49, 0xc8, 0x21};

  uint8_t buf[100] = {0};

  uint8_t topic_bytes[] = {0xd2, 0xa,  0xf4, 0x2b, 0x94, 0xe1, 0xea, 0x35, 0x55, 0xe2, 0x72, 0x31, 0x36, 0xcf,
                           0x89, 0x15, 0x7d, 0x1d, 0x58, 0xcc, 0xfa, 0x53, 0x90, 0x97, 0x62, 0xe0, 0xb8};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbf, 0xcf, 0xaf, 0x75, 0x45, 0x6e, 0x37, 0xab, 0xee, 0xcb, 0x8c, 0xd2, 0x49, 0xc8, 0x21};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytes0[] = {0x6a, 0xab, 0x94, 0xf, 0x1f, 0xd0, 0x5, 0x60, 0x59, 0x3b, 0x8b, 0xb1, 0x1f};
  uint8_t bytes1[] = {0x3c, 0x16, 0x49, 0x6, 0x16, 0xd7, 0xd4, 0x1a, 0xc4, 0x2e, 0x85, 0xd, 0xf0, 0x4a, 0xd3};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28588}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytes1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 20202, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\240\247\161\170\180S\251(.\139\187\RS\199\\\USs\207!7\250\&8&q\ESC\236\153", _pubPktID = 1829, _pubBody =
// ")B\201\179\163\188%[\184\154\EOT\146x7,\DC3\v\180\DLE", _pubProps = []}
TEST(Publish50QCTest, Encode72) {
  uint8_t pkt[] = {0x3b, 0x32, 0x0,  0x1a, 0xf0, 0xf7, 0xa1, 0xaa, 0xb4, 0x53, 0xfb, 0x28, 0x2e,
                   0x8b, 0xbb, 0x1e, 0xc7, 0x5c, 0x1f, 0x73, 0xcf, 0x21, 0x37, 0xfa, 0x38, 0x26,
                   0x71, 0x1b, 0xec, 0x99, 0x7,  0x25, 0x0,  0x29, 0x42, 0xc9, 0xb3, 0xa3, 0xbc,
                   0x25, 0x5b, 0xb8, 0x9a, 0x4,  0x92, 0x78, 0x37, 0x2c, 0x13, 0xb,  0xb4, 0x10};

  uint8_t buf[62] = {0};

  uint8_t topic_bytes[] = {0xf0, 0xf7, 0xa1, 0xaa, 0xb4, 0x53, 0xfb, 0x28, 0x2e, 0x8b, 0xbb, 0x1e, 0xc7,
                           0x5c, 0x1f, 0x73, 0xcf, 0x21, 0x37, 0xfa, 0x38, 0x26, 0x71, 0x1b, 0xec, 0x99};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x29, 0x42, 0xc9, 0xb3, 0xa3, 0xbc, 0x25, 0x5b, 0xb8, 0x9a,
                         0x4,  0x92, 0x78, 0x37, 0x2c, 0x13, 0xb,  0xb4, 0x10};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t proplist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1829, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "2k\146\244f\164\212\DC4o\197\186",
// _pubPktID = 0, _pubBody = "\216C\204\149", _pubProps = [PropResponseInformation
// "\189\143\&7\208\157']\n\207h\170\135\185",PropTopicAlias 905,PropResponseInformation
// "(S#\129:\175\&6\\j\f\184",PropRetainAvailable 68,PropMessageExpiryInterval 2801,PropSubscriptionIdentifier
// 20,PropTopicAliasMaximum 11510,PropAuthenticationData "\149\174\219\206\t",PropResponseInformation
// "\241\162\172\ESCY\144\ESCi\173\161\226Ik~\223\241\156x:\146\189M\204\179l(\170\DC4\ESC\177",PropAuthenticationData
// "\228\198\249\US\SYN\174$s\190%\147l\STX\171\225",PropWillDelayInterval 23982,PropTopicAlias
// 22742,PropWillDelayInterval 9688,PropMaximumPacketSize 11022,PropMaximumPacketSize 529,PropContentType
// "\208\ENQ\139\200\190L[\NAK/\159J\166\253\&8\246\US=,\132F\\\">",PropRetainAvailable 140,PropAssignedClientIdentifier
// ".\205\221\172{\ESC\207\246\129",PropReceiveMaximum 15742]}
TEST(Publish50QCTest, Encode73) {
  uint8_t pkt[] = {0x39, 0xbd, 0x1,  0x0,  0xb,  0x32, 0x6b, 0x92, 0xf4, 0x66, 0xa4, 0xd4, 0x14, 0x6f, 0xc5, 0xba,
                   0xaa, 0x1,  0x1a, 0x0,  0xd,  0xbd, 0x8f, 0x37, 0xd0, 0x9d, 0x27, 0x5d, 0xa,  0xcf, 0x68, 0xaa,
                   0x87, 0xb9, 0x23, 0x3,  0x89, 0x1a, 0x0,  0xb,  0x28, 0x53, 0x23, 0x81, 0x3a, 0xaf, 0x36, 0x5c,
                   0x6a, 0xc,  0xb8, 0x25, 0x44, 0x2,  0x0,  0x0,  0xa,  0xf1, 0xb,  0x14, 0x22, 0x2c, 0xf6, 0x16,
                   0x0,  0x5,  0x95, 0xae, 0xdb, 0xce, 0x9,  0x1a, 0x0,  0x1e, 0xf1, 0xa2, 0xac, 0x1b, 0x59, 0x90,
                   0x1b, 0x69, 0xad, 0xa1, 0xe2, 0x49, 0x6b, 0x7e, 0xdf, 0xf1, 0x9c, 0x78, 0x3a, 0x92, 0xbd, 0x4d,
                   0xcc, 0xb3, 0x6c, 0x28, 0xaa, 0x14, 0x1b, 0xb1, 0x16, 0x0,  0xf,  0xe4, 0xc6, 0xf9, 0x1f, 0x16,
                   0xae, 0x24, 0x73, 0xbe, 0x25, 0x93, 0x6c, 0x2,  0xab, 0xe1, 0x18, 0x0,  0x0,  0x5d, 0xae, 0x23,
                   0x58, 0xd6, 0x18, 0x0,  0x0,  0x25, 0xd8, 0x27, 0x0,  0x0,  0x2b, 0xe,  0x27, 0x0,  0x0,  0x2,
                   0x11, 0x3,  0x0,  0x17, 0xd0, 0x5,  0x8b, 0xc8, 0xbe, 0x4c, 0x5b, 0x15, 0x2f, 0x9f, 0x4a, 0xa6,
                   0xfd, 0x38, 0xf6, 0x1f, 0x3d, 0x2c, 0x84, 0x46, 0x5c, 0x22, 0x3e, 0x25, 0x8c, 0x12, 0x0,  0x9,
                   0x2e, 0xcd, 0xdd, 0xac, 0x7b, 0x1b, 0xcf, 0xf6, 0x81, 0x21, 0x3d, 0x7e, 0xd8, 0x43, 0xcc, 0x95};

  uint8_t buf[202] = {0};

  uint8_t topic_bytes[] = {0x32, 0x6b, 0x92, 0xf4, 0x66, 0xa4, 0xd4, 0x14, 0x6f, 0xc5, 0xba};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd8, 0x43, 0xcc, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytes0[] = {0xbd, 0x8f, 0x37, 0xd0, 0x9d, 0x27, 0x5d, 0xa, 0xcf, 0x68, 0xaa, 0x87, 0xb9};
  uint8_t bytes1[] = {0x28, 0x53, 0x23, 0x81, 0x3a, 0xaf, 0x36, 0x5c, 0x6a, 0xc, 0xb8};
  uint8_t bytes2[] = {0x95, 0xae, 0xdb, 0xce, 0x9};
  uint8_t bytes3[] = {0xf1, 0xa2, 0xac, 0x1b, 0x59, 0x90, 0x1b, 0x69, 0xad, 0xa1, 0xe2, 0x49, 0x6b, 0x7e, 0xdf,
                      0xf1, 0x9c, 0x78, 0x3a, 0x92, 0xbd, 0x4d, 0xcc, 0xb3, 0x6c, 0x28, 0xaa, 0x14, 0x1b, 0xb1};
  uint8_t bytes4[] = {0xe4, 0xc6, 0xf9, 0x1f, 0x16, 0xae, 0x24, 0x73, 0xbe, 0x25, 0x93, 0x6c, 0x2, 0xab, 0xe1};
  uint8_t bytes5[] = {0xd0, 0x5,  0x8b, 0xc8, 0xbe, 0x4c, 0x5b, 0x15, 0x2f, 0x9f, 0x4a, 0xa6,
                      0xfd, 0x38, 0xf6, 0x1f, 0x3d, 0x2c, 0x84, 0x46, 0x5c, 0x22, 0x3e};
  uint8_t bytes6[] = {0x2e, 0xcd, 0xdd, 0xac, 0x7b, 0x1b, 0xcf, 0xf6, 0x81};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 905}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2801}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11510}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23982}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22742}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9688}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11022}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 529}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15742}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Q\199\US@hY\186f", _pubPktID = 684,
// _pubBody = "\DC1/\179\209 !\230/\187 \220\191\212", _pubProps = [PropMessageExpiryInterval 7888,PropWillDelayInterval
// 17341,PropResponseInformation "\232fp5\196\NUL",PropServerKeepAlive 17171,PropSharedSubscriptionAvailable
// 63,PropSessionExpiryInterval 30264,PropSharedSubscriptionAvailable 216,PropMaximumQoS 204,PropUserProperty
// "j\212e\SI\142oh\223\173\193z\253\DEL\248\201Ich\ENQ\207k\196\242\191\184T\231\156\222V"
// "\197O\DC1F\226\213\DC2!\CAN<P\138\&8\246\FS\160%\153R\135\156\181(\217\239",PropAuthenticationMethod
// "\EOTHJ\159\152\208\243\227\226\207\160\217\139\a\132t\190J4\SO\SI\STX~M",PropMessageExpiryInterval
// 29306,PropSharedSubscriptionAvailable 55,PropResponseTopic
// "\215\140\157\200\t\132\165\&8\205N",PropSessionExpiryInterval 12057,PropAssignedClientIdentifier
// "\221\208\178\ETX\177\r\208w\136IVu\176\ENQ\247\172",PropTopicAliasMaximum 1861,PropRequestProblemInformation
// 56,PropServerReference "\137\141\230,I\RS\188\RS\NUL5O\180",PropSharedSubscriptionAvailable 249,PropRetainAvailable
// 5,PropWillDelayInterval 18105,PropUserProperty "C\179\FSCR\147^\228l\213"
// "\223\183\156O\RS\244O\NAK\US\251Xb(:0d\ETB\189\200O6A\228,\203"]}
TEST(Publish50QCTest, Encode74) {
  uint8_t pkt[] = {
      0x3a, 0x84, 0x2,  0x0,  0x8,  0x51, 0xc7, 0x1f, 0x40, 0x68, 0x59, 0xba, 0x66, 0x2,  0xac, 0xe9, 0x1,  0x2,  0x0,
      0x0,  0x1e, 0xd0, 0x18, 0x0,  0x0,  0x43, 0xbd, 0x1a, 0x0,  0x6,  0xe8, 0x66, 0x70, 0x35, 0xc4, 0x0,  0x13, 0x43,
      0x13, 0x2a, 0x3f, 0x11, 0x0,  0x0,  0x76, 0x38, 0x2a, 0xd8, 0x24, 0xcc, 0x26, 0x0,  0x1e, 0x6a, 0xd4, 0x65, 0xf,
      0x8e, 0x6f, 0x68, 0xdf, 0xad, 0xc1, 0x7a, 0xfd, 0x7f, 0xf8, 0xc9, 0x49, 0x63, 0x68, 0x5,  0xcf, 0x6b, 0xc4, 0xf2,
      0xbf, 0xb8, 0x54, 0xe7, 0x9c, 0xde, 0x56, 0x0,  0x19, 0xc5, 0x4f, 0x11, 0x46, 0xe2, 0xd5, 0x12, 0x21, 0x18, 0x3c,
      0x50, 0x8a, 0x38, 0xf6, 0x1c, 0xa0, 0x25, 0x99, 0x52, 0x87, 0x9c, 0xb5, 0x28, 0xd9, 0xef, 0x15, 0x0,  0x18, 0x4,
      0x48, 0x4a, 0x9f, 0x98, 0xd0, 0xf3, 0xe3, 0xe2, 0xcf, 0xa0, 0xd9, 0x8b, 0x7,  0x84, 0x74, 0xbe, 0x4a, 0x34, 0xe,
      0xf,  0x2,  0x7e, 0x4d, 0x2,  0x0,  0x0,  0x72, 0x7a, 0x2a, 0x37, 0x8,  0x0,  0xa,  0xd7, 0x8c, 0x9d, 0xc8, 0x9,
      0x84, 0xa5, 0x38, 0xcd, 0x4e, 0x11, 0x0,  0x0,  0x2f, 0x19, 0x12, 0x0,  0x10, 0xdd, 0xd0, 0xb2, 0x3,  0xb1, 0xd,
      0xd0, 0x77, 0x88, 0x49, 0x56, 0x75, 0xb0, 0x5,  0xf7, 0xac, 0x22, 0x7,  0x45, 0x17, 0x38, 0x1c, 0x0,  0xc,  0x89,
      0x8d, 0xe6, 0x2c, 0x49, 0x1e, 0xbc, 0x1e, 0x0,  0x35, 0x4f, 0xb4, 0x2a, 0xf9, 0x25, 0x5,  0x18, 0x0,  0x0,  0x46,
      0xb9, 0x26, 0x0,  0xa,  0x43, 0xb3, 0x1c, 0x43, 0x52, 0x93, 0x5e, 0xe4, 0x6c, 0xd5, 0x0,  0x19, 0xdf, 0xb7, 0x9c,
      0x4f, 0x1e, 0xf4, 0x4f, 0x15, 0x1f, 0xfb, 0x58, 0x62, 0x28, 0x3a, 0x30, 0x64, 0x17, 0xbd, 0xc8, 0x4f, 0x36, 0x41,
      0xe4, 0x2c, 0xcb, 0x11, 0x2f, 0xb3, 0xd1, 0x20, 0x21, 0xe6, 0x2f, 0xbb, 0x20, 0xdc, 0xbf, 0xd4};

  uint8_t buf[273] = {0};

  uint8_t topic_bytes[] = {0x51, 0xc7, 0x1f, 0x40, 0x68, 0x59, 0xba, 0x66};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x11, 0x2f, 0xb3, 0xd1, 0x20, 0x21, 0xe6, 0x2f, 0xbb, 0x20, 0xdc, 0xbf, 0xd4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytes0[] = {0xe8, 0x66, 0x70, 0x35, 0xc4, 0x0};
  uint8_t bytes2[] = {0xc5, 0x4f, 0x11, 0x46, 0xe2, 0xd5, 0x12, 0x21, 0x18, 0x3c, 0x50, 0x8a, 0x38,
                      0xf6, 0x1c, 0xa0, 0x25, 0x99, 0x52, 0x87, 0x9c, 0xb5, 0x28, 0xd9, 0xef};
  uint8_t bytes1[] = {0x6a, 0xd4, 0x65, 0xf, 0x8e, 0x6f, 0x68, 0xdf, 0xad, 0xc1, 0x7a, 0xfd, 0x7f, 0xf8, 0xc9,
                      0x49, 0x63, 0x68, 0x5, 0xcf, 0x6b, 0xc4, 0xf2, 0xbf, 0xb8, 0x54, 0xe7, 0x9c, 0xde, 0x56};
  uint8_t bytes3[] = {0x4,  0x48, 0x4a, 0x9f, 0x98, 0xd0, 0xf3, 0xe3, 0xe2, 0xcf, 0xa0, 0xd9,
                      0x8b, 0x7,  0x84, 0x74, 0xbe, 0x4a, 0x34, 0xe,  0xf,  0x2,  0x7e, 0x4d};
  uint8_t bytes4[] = {0xd7, 0x8c, 0x9d, 0xc8, 0x9, 0x84, 0xa5, 0x38, 0xcd, 0x4e};
  uint8_t bytes5[] = {0xdd, 0xd0, 0xb2, 0x3, 0xb1, 0xd, 0xd0, 0x77, 0x88, 0x49, 0x56, 0x75, 0xb0, 0x5, 0xf7, 0xac};
  uint8_t bytes6[] = {0x89, 0x8d, 0xe6, 0x2c, 0x49, 0x1e, 0xbc, 0x1e, 0x0, 0x35, 0x4f, 0xb4};
  uint8_t bytes8[] = {0xdf, 0xb7, 0x9c, 0x4f, 0x1e, 0xf4, 0x4f, 0x15, 0x1f, 0xfb, 0x58, 0x62, 0x28,
                      0x3a, 0x30, 0x64, 0x17, 0xbd, 0xc8, 0x4f, 0x36, 0x41, 0xe4, 0x2c, 0xcb};
  uint8_t bytes7[] = {0x43, 0xb3, 0x1c, 0x43, 0x52, 0x93, 0x5e, 0xe4, 0x6c, 0xd5};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7888}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17341}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17171}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30264}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytes1}, .v = {25, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29306}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12057}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1861}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18105}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytes7}, .v = {25, (char*)&bytes8}}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 684, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\142\&2\163\190T\212+\DC4[\234\248w\231\165@\206\&40", _pubPktID = 9582, _pubBody =
// "[(\157B\171\184\156\f\201\EM\160\166\206\199\168\222\153NX$\247\ACK2\183", _pubProps =
// [PropSubscriptionIdentifierAvailable 99,PropMessageExpiryInterval 23092,PropSubscriptionIdentifierAvailable
// 180,PropMaximumQoS 127,PropMaximumQoS 156,PropRequestProblemInformation 85]}
TEST(Publish50QCTest, Encode75) {
  uint8_t pkt[] = {0x3b, 0x3e, 0x0,  0x12, 0x8e, 0x32, 0xa3, 0xbe, 0x54, 0xd4, 0x2b, 0x14, 0x5b, 0xea, 0xf8, 0x77,
                   0xe7, 0xa5, 0x40, 0xce, 0x34, 0x30, 0x25, 0x6e, 0xf,  0x29, 0x63, 0x2,  0x0,  0x0,  0x5a, 0x34,
                   0x29, 0xb4, 0x24, 0x7f, 0x24, 0x9c, 0x17, 0x55, 0x5b, 0x28, 0x9d, 0x42, 0xab, 0xb8, 0x9c, 0xc,
                   0xc9, 0x19, 0xa0, 0xa6, 0xce, 0xc7, 0xa8, 0xde, 0x99, 0x4e, 0x58, 0x24, 0xf7, 0x6,  0x32, 0xb7};

  uint8_t buf[74] = {0};

  uint8_t topic_bytes[] = {0x8e, 0x32, 0xa3, 0xbe, 0x54, 0xd4, 0x2b, 0x14, 0x5b,
                           0xea, 0xf8, 0x77, 0xe7, 0xa5, 0x40, 0xce, 0x34, 0x30};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x28, 0x9d, 0x42, 0xab, 0xb8, 0x9c, 0xc,  0xc9, 0x19, 0xa0, 0xa6,
                         0xce, 0xc7, 0xa8, 0xde, 0x99, 0x4e, 0x58, 0x24, 0xf7, 0x6,  0x32, 0xb7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 99}},  {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23092}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 180}}, {.prop = (lwmqtt_prop_t)36, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 156}}, {.prop = (lwmqtt_prop_t)23, .value = {.byte = 85}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 9582, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "ox\254Qe\203<\176\195ES", _pubPktID
// = 20876, _pubBody = "J\224\148H\132xS\156Aov\199\244wF[\n\185\190;\142o\SOHg", _pubProps = [PropResponseTopic
// "\149\NAK\154\213\173\&8\179\SOHD\198=\DEL&\245",PropServerKeepAlive 29491,PropAuthenticationData
// "a\182v\DC1\253",PropTopicAlias 30924,PropSubscriptionIdentifierAvailable 89,PropSubscriptionIdentifierAvailable
// 183,PropReceiveMaximum 4234,PropPayloadFormatIndicator 153,PropWildcardSubscriptionAvailable 17,PropRetainAvailable
// 160,PropAuthenticationData
// "\EM\206d\235w\234\255\225z\a\ENQ\210\231\174>\207\191\167#\164s\SUB\176\130",PropResponseInformation
// "Iy\EM]\189",PropSessionExpiryInterval 7138,PropSubscriptionIdentifierAvailable 233,PropWillDelayInterval 14012]}
TEST(Publish50QCTest, Encode76) {
  uint8_t pkt[] = {0x34, 0x83, 0x1,  0x0,  0xb,  0x6f, 0x78, 0xfe, 0x51, 0x65, 0xcb, 0x3c, 0xb0, 0xc3, 0x45, 0x53, 0x51,
                   0x8c, 0x5b, 0x8,  0x0,  0xe,  0x95, 0x15, 0x9a, 0xd5, 0xad, 0x38, 0xb3, 0x1,  0x44, 0xc6, 0x3d, 0x7f,
                   0x26, 0xf5, 0x13, 0x73, 0x33, 0x16, 0x0,  0x5,  0x61, 0xb6, 0x76, 0x11, 0xfd, 0x23, 0x78, 0xcc, 0x29,
                   0x59, 0x29, 0xb7, 0x21, 0x10, 0x8a, 0x1,  0x99, 0x28, 0x11, 0x25, 0xa0, 0x16, 0x0,  0x18, 0x19, 0xce,
                   0x64, 0xeb, 0x77, 0xea, 0xff, 0xe1, 0x7a, 0x7,  0x5,  0xd2, 0xe7, 0xae, 0x3e, 0xcf, 0xbf, 0xa7, 0x23,
                   0xa4, 0x73, 0x1a, 0xb0, 0x82, 0x1a, 0x0,  0x5,  0x49, 0x79, 0x19, 0x5d, 0xbd, 0x11, 0x0,  0x0,  0x1b,
                   0xe2, 0x29, 0xe9, 0x18, 0x0,  0x0,  0x36, 0xbc, 0x4a, 0xe0, 0x94, 0x48, 0x84, 0x78, 0x53, 0x9c, 0x41,
                   0x6f, 0x76, 0xc7, 0xf4, 0x77, 0x46, 0x5b, 0xa,  0xb9, 0xbe, 0x3b, 0x8e, 0x6f, 0x1,  0x67};

  uint8_t buf[144] = {0};

  uint8_t topic_bytes[] = {0x6f, 0x78, 0xfe, 0x51, 0x65, 0xcb, 0x3c, 0xb0, 0xc3, 0x45, 0x53};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4a, 0xe0, 0x94, 0x48, 0x84, 0x78, 0x53, 0x9c, 0x41, 0x6f, 0x76, 0xc7,
                         0xf4, 0x77, 0x46, 0x5b, 0xa,  0xb9, 0xbe, 0x3b, 0x8e, 0x6f, 0x1,  0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes0[] = {0x95, 0x15, 0x9a, 0xd5, 0xad, 0x38, 0xb3, 0x1, 0x44, 0xc6, 0x3d, 0x7f, 0x26, 0xf5};
  uint8_t bytes1[] = {0x61, 0xb6, 0x76, 0x11, 0xfd};
  uint8_t bytes2[] = {0x19, 0xce, 0x64, 0xeb, 0x77, 0xea, 0xff, 0xe1, 0x7a, 0x7,  0x5,  0xd2,
                      0xe7, 0xae, 0x3e, 0xcf, 0xbf, 0xa7, 0x23, 0xa4, 0x73, 0x1a, 0xb0, 0x82};
  uint8_t bytes3[] = {0x49, 0x79, 0x19, 0x5d, 0xbd};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29491}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30924}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4234}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7138}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14012}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 20876, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = ")\159\249\220\185\252\230\193",
// _pubPktID = 10776, _pubBody = "\144\230\&6K\134\194\176\153\v\145(]\222\255\155\231\225(?\150}\155\FS\173)",
// _pubProps = [PropMessageExpiryInterval 5760,PropSubscriptionIdentifierAvailable 195,PropAuthenticationData
// "\177S",PropServerReference "\158\&4\205\186\200\244\209$u\152\218\202r\162oH\163$\\\212\&4",PropMaximumQoS
// 206,PropCorrelationData "\229\235$;",PropSubscriptionIdentifier 30,PropWildcardSubscriptionAvailable
// 188,PropSharedSubscriptionAvailable 208,PropMessageExpiryInterval 15481,PropResponseInformation
// "n\142\&4\206\224\227*\166N\229\253J\192\206aK\132[\186\143\vh\156",PropPayloadFormatIndicator 86,PropServerReference
// "9@",PropSubscriptionIdentifierAvailable 10,PropWillDelayInterval 10019,PropContentType "u"]}
TEST(Publish50QCTest, Encode77) {
  uint8_t pkt[] = {0x34, 0x8a, 0x1,  0x0,  0x8,  0x29, 0x9f, 0xf9, 0xdc, 0xb9, 0xfc, 0xe6, 0xc1, 0x2a, 0x18, 0x64,
                   0x2,  0x0,  0x0,  0x16, 0x80, 0x29, 0xc3, 0x16, 0x0,  0x2,  0xb1, 0x53, 0x1c, 0x0,  0x15, 0x9e,
                   0x34, 0xcd, 0xba, 0xc8, 0xf4, 0xd1, 0x24, 0x75, 0x98, 0xda, 0xca, 0x72, 0xa2, 0x6f, 0x48, 0xa3,
                   0x24, 0x5c, 0xd4, 0x34, 0x24, 0xce, 0x9,  0x0,  0x4,  0xe5, 0xeb, 0x24, 0x3b, 0xb,  0x1e, 0x28,
                   0xbc, 0x2a, 0xd0, 0x2,  0x0,  0x0,  0x3c, 0x79, 0x1a, 0x0,  0x17, 0x6e, 0x8e, 0x34, 0xce, 0xe0,
                   0xe3, 0x2a, 0xa6, 0x4e, 0xe5, 0xfd, 0x4a, 0xc0, 0xce, 0x61, 0x4b, 0x84, 0x5b, 0xba, 0x8f, 0xb,
                   0x68, 0x9c, 0x1,  0x56, 0x1c, 0x0,  0x2,  0x39, 0x40, 0x29, 0xa,  0x18, 0x0,  0x0,  0x27, 0x23,
                   0x3,  0x0,  0x1,  0x75, 0x90, 0xe6, 0x36, 0x4b, 0x86, 0xc2, 0xb0, 0x99, 0xb,  0x91, 0x28, 0x5d,
                   0xde, 0xff, 0x9b, 0xe7, 0xe1, 0x28, 0x3f, 0x96, 0x7d, 0x9b, 0x1c, 0xad, 0x29};

  uint8_t buf[151] = {0};

  uint8_t topic_bytes[] = {0x29, 0x9f, 0xf9, 0xdc, 0xb9, 0xfc, 0xe6, 0xc1};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x90, 0xe6, 0x36, 0x4b, 0x86, 0xc2, 0xb0, 0x99, 0xb,  0x91, 0x28, 0x5d, 0xde,
                         0xff, 0x9b, 0xe7, 0xe1, 0x28, 0x3f, 0x96, 0x7d, 0x9b, 0x1c, 0xad, 0x29};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytes0[] = {0xb1, 0x53};
  uint8_t bytes1[] = {0x9e, 0x34, 0xcd, 0xba, 0xc8, 0xf4, 0xd1, 0x24, 0x75, 0x98, 0xda,
                      0xca, 0x72, 0xa2, 0x6f, 0x48, 0xa3, 0x24, 0x5c, 0xd4, 0x34};
  uint8_t bytes2[] = {0xe5, 0xeb, 0x24, 0x3b};
  uint8_t bytes3[] = {0x6e, 0x8e, 0x34, 0xce, 0xe0, 0xe3, 0x2a, 0xa6, 0x4e, 0xe5, 0xfd, 0x4a,
                      0xc0, 0xce, 0x61, 0x4b, 0x84, 0x5b, 0xba, 0x8f, 0xb,  0x68, 0x9c};
  uint8_t bytes4[] = {0x39, 0x40};
  uint8_t bytes5[] = {0x75};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5760}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15481}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10019}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytes5}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10776, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "6:\229<\217\235\180", _pubPktID =
// 21683, _pubBody = "y", _pubProps = [PropWillDelayInterval 11318,PropAssignedClientIdentifier
// "7%\147o\ETB\248\231",PropTopicAliasMaximum 5541,PropAuthenticationMethod
// "\153>\209\255L\217",PropPayloadFormatIndicator 24,PropServerKeepAlive 2352,PropSharedSubscriptionAvailable
// 244,PropServerReference "\198!\248h\187y\161\239X",PropServerReference
// "6jm\232\b;\159xm\142\183\216N",PropSubscriptionIdentifier 2,PropWildcardSubscriptionAvailable 204,PropResponseTopic
// "\144\246\212\237\132",PropReceiveMaximum 27177,PropMessageExpiryInterval 2103,PropReasonString
// "\DLEq<\a\178",PropResponseTopic
// "a.\139m\207\184\FS]x\254\DC3\159\208\150\160\179\&3\184\157\189~75Z7\252\202\133",PropCorrelationData
// "\242\228>|&T5\209\178\185\222]\210\198\208\&0\f^\190\238-\NAKf\133\143\231\234,\197\STX",PropContentType
// "i\226)\144\194\SUBH8\159\212\131|\"z\147\135?\214S\"\145\176\ENQ\DEL7"]}
TEST(Publish50QCTest, Encode78) {
  uint8_t pkt[] = {0x3c, 0xc4, 0x1,  0x0,  0x7,  0x36, 0x3a, 0xe5, 0x3c, 0xd9, 0xeb, 0xb4, 0x54, 0xb3, 0xb6, 0x1,  0x18,
                   0x0,  0x0,  0x2c, 0x36, 0x12, 0x0,  0x7,  0x37, 0x25, 0x93, 0x6f, 0x17, 0xf8, 0xe7, 0x22, 0x15, 0xa5,
                   0x15, 0x0,  0x6,  0x99, 0x3e, 0xd1, 0xff, 0x4c, 0xd9, 0x1,  0x18, 0x13, 0x9,  0x30, 0x2a, 0xf4, 0x1c,
                   0x0,  0x9,  0xc6, 0x21, 0xf8, 0x68, 0xbb, 0x79, 0xa1, 0xef, 0x58, 0x1c, 0x0,  0xd,  0x36, 0x6a, 0x6d,
                   0xe8, 0x8,  0x3b, 0x9f, 0x78, 0x6d, 0x8e, 0xb7, 0xd8, 0x4e, 0xb,  0x2,  0x28, 0xcc, 0x8,  0x0,  0x5,
                   0x90, 0xf6, 0xd4, 0xed, 0x84, 0x21, 0x6a, 0x29, 0x2,  0x0,  0x0,  0x8,  0x37, 0x1f, 0x0,  0x5,  0x10,
                   0x71, 0x3c, 0x7,  0xb2, 0x8,  0x0,  0x1c, 0x61, 0x2e, 0x8b, 0x6d, 0xcf, 0xb8, 0x1c, 0x5d, 0x78, 0xfe,
                   0x13, 0x9f, 0xd0, 0x96, 0xa0, 0xb3, 0x33, 0xb8, 0x9d, 0xbd, 0x7e, 0x37, 0x35, 0x5a, 0x37, 0xfc, 0xca,
                   0x85, 0x9,  0x0,  0x1e, 0xf2, 0xe4, 0x3e, 0x7c, 0x26, 0x54, 0x35, 0xd1, 0xb2, 0xb9, 0xde, 0x5d, 0xd2,
                   0xc6, 0xd0, 0x30, 0xc,  0x5e, 0xbe, 0xee, 0x2d, 0x15, 0x66, 0x85, 0x8f, 0xe7, 0xea, 0x2c, 0xc5, 0x2,
                   0x3,  0x0,  0x19, 0x69, 0xe2, 0x29, 0x90, 0xc2, 0x1a, 0x48, 0x38, 0x9f, 0xd4, 0x83, 0x7c, 0x22, 0x7a,
                   0x93, 0x87, 0x3f, 0xd6, 0x53, 0x22, 0x91, 0xb0, 0x5,  0x7f, 0x37, 0x79};

  uint8_t buf[209] = {0};

  uint8_t topic_bytes[] = {0x36, 0x3a, 0xe5, 0x3c, 0xd9, 0xeb, 0xb4};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0x37, 0x25, 0x93, 0x6f, 0x17, 0xf8, 0xe7};
  uint8_t bytes1[] = {0x99, 0x3e, 0xd1, 0xff, 0x4c, 0xd9};
  uint8_t bytes2[] = {0xc6, 0x21, 0xf8, 0x68, 0xbb, 0x79, 0xa1, 0xef, 0x58};
  uint8_t bytes3[] = {0x36, 0x6a, 0x6d, 0xe8, 0x8, 0x3b, 0x9f, 0x78, 0x6d, 0x8e, 0xb7, 0xd8, 0x4e};
  uint8_t bytes4[] = {0x90, 0xf6, 0xd4, 0xed, 0x84};
  uint8_t bytes5[] = {0x10, 0x71, 0x3c, 0x7, 0xb2};
  uint8_t bytes6[] = {0x61, 0x2e, 0x8b, 0x6d, 0xcf, 0xb8, 0x1c, 0x5d, 0x78, 0xfe, 0x13, 0x9f, 0xd0, 0x96,
                      0xa0, 0xb3, 0x33, 0xb8, 0x9d, 0xbd, 0x7e, 0x37, 0x35, 0x5a, 0x37, 0xfc, 0xca, 0x85};
  uint8_t bytes7[] = {0xf2, 0xe4, 0x3e, 0x7c, 0x26, 0x54, 0x35, 0xd1, 0xb2, 0xb9, 0xde, 0x5d, 0xd2, 0xc6, 0xd0,
                      0x30, 0xc,  0x5e, 0xbe, 0xee, 0x2d, 0x15, 0x66, 0x85, 0x8f, 0xe7, 0xea, 0x2c, 0xc5, 0x2};
  uint8_t bytes8[] = {0x69, 0xe2, 0x29, 0x90, 0xc2, 0x1a, 0x48, 0x38, 0x9f, 0xd4, 0x83, 0x7c, 0x22,
                      0x7a, 0x93, 0x87, 0x3f, 0xd6, 0x53, 0x22, 0x91, 0xb0, 0x5,  0x7f, 0x37};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11318}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5541}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2352}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27177}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2103}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytes8}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 21683, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// ",l\239A\255.e\128\238\190\EOT\216\240\231", _pubPktID = 0, _pubBody =
// "\ENQ\DC3z\234.f[;\DC2\214i0\161P\251\171\160\RS\180\222J\202\191\DC2(.", _pubProps = [PropRetainAvailable
// 162,PropAssignedClientIdentifier " \206\r\200\RS\221\EMmd-\178\238(\138\&1G\ESC%\GS",PropResponseTopic
// "o\146\164\247\DLE\168m\130",PropWildcardSubscriptionAvailable 143,PropRequestProblemInformation
// 24,PropServerReference
// "@CxY\197\198\&2\149:B\212\128\US\154\135\234\218p\a\209\178\SUB\SO\128",PropRequestProblemInformation
// 9,PropRequestProblemInformation 127,PropSharedSubscriptionAvailable 106,PropAssignedClientIdentifier
// "",PropMaximumPacketSize 1555,PropResponseTopic "1\150\191\229\249LK\174\148\142~\251<|U\239\205\226\n\134\218
// 3}\SYNH\169",PropServerReference
// "\128k\199{\194\245`\158\194\246?\168\221\140Z\222/X\200x\165-\254\160f\250",PropSessionExpiryInterval 1631]}
TEST(Publish50QCTest, Encode79) {
  uint8_t pkt[] = {0x31, 0xbc, 0x1,  0x0,  0xe,  0x2c, 0x6c, 0xef, 0x41, 0xff, 0x2e, 0x65, 0x80, 0xee, 0xbe, 0x4,
                   0xd8, 0xf0, 0xe7, 0x90, 0x1,  0x25, 0xa2, 0x12, 0x0,  0x13, 0x20, 0xce, 0xd,  0xc8, 0x1e, 0xdd,
                   0x19, 0x6d, 0x64, 0x2d, 0xb2, 0xee, 0x28, 0x8a, 0x31, 0x47, 0x1b, 0x25, 0x1d, 0x8,  0x0,  0x8,
                   0x6f, 0x92, 0xa4, 0xf7, 0x10, 0xa8, 0x6d, 0x82, 0x28, 0x8f, 0x17, 0x18, 0x1c, 0x0,  0x18, 0x40,
                   0x43, 0x78, 0x59, 0xc5, 0xc6, 0x32, 0x95, 0x3a, 0x42, 0xd4, 0x80, 0x1f, 0x9a, 0x87, 0xea, 0xda,
                   0x70, 0x7,  0xd1, 0xb2, 0x1a, 0xe,  0x80, 0x17, 0x9,  0x17, 0x7f, 0x2a, 0x6a, 0x12, 0x0,  0x0,
                   0x27, 0x0,  0x0,  0x6,  0x13, 0x8,  0x0,  0x1b, 0x31, 0x96, 0xbf, 0xe5, 0xf9, 0x4c, 0x4b, 0xae,
                   0x94, 0x8e, 0x7e, 0xfb, 0x3c, 0x7c, 0x55, 0xef, 0xcd, 0xe2, 0xa,  0x86, 0xda, 0x20, 0x33, 0x7d,
                   0x16, 0x48, 0xa9, 0x1c, 0x0,  0x1a, 0x80, 0x6b, 0xc7, 0x7b, 0xc2, 0xf5, 0x60, 0x9e, 0xc2, 0xf6,
                   0x3f, 0xa8, 0xdd, 0x8c, 0x5a, 0xde, 0x2f, 0x58, 0xc8, 0x78, 0xa5, 0x2d, 0xfe, 0xa0, 0x66, 0xfa,
                   0x11, 0x0,  0x0,  0x6,  0x5f, 0x5,  0x13, 0x7a, 0xea, 0x2e, 0x66, 0x5b, 0x3b, 0x12, 0xd6, 0x69,
                   0x30, 0xa1, 0x50, 0xfb, 0xab, 0xa0, 0x1e, 0xb4, 0xde, 0x4a, 0xca, 0xbf, 0x12, 0x28, 0x2e};

  uint8_t buf[201] = {0};

  uint8_t topic_bytes[] = {0x2c, 0x6c, 0xef, 0x41, 0xff, 0x2e, 0x65, 0x80, 0xee, 0xbe, 0x4, 0xd8, 0xf0, 0xe7};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5,  0x13, 0x7a, 0xea, 0x2e, 0x66, 0x5b, 0x3b, 0x12, 0xd6, 0x69, 0x30, 0xa1,
                         0x50, 0xfb, 0xab, 0xa0, 0x1e, 0xb4, 0xde, 0x4a, 0xca, 0xbf, 0x12, 0x28, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytes0[] = {0x20, 0xce, 0xd,  0xc8, 0x1e, 0xdd, 0x19, 0x6d, 0x64, 0x2d,
                      0xb2, 0xee, 0x28, 0x8a, 0x31, 0x47, 0x1b, 0x25, 0x1d};
  uint8_t bytes1[] = {0x6f, 0x92, 0xa4, 0xf7, 0x10, 0xa8, 0x6d, 0x82};
  uint8_t bytes2[] = {0x40, 0x43, 0x78, 0x59, 0xc5, 0xc6, 0x32, 0x95, 0x3a, 0x42, 0xd4, 0x80,
                      0x1f, 0x9a, 0x87, 0xea, 0xda, 0x70, 0x7,  0xd1, 0xb2, 0x1a, 0xe,  0x80};
  uint8_t bytes3[] = {0};
  uint8_t bytes4[] = {0x31, 0x96, 0xbf, 0xe5, 0xf9, 0x4c, 0x4b, 0xae, 0x94, 0x8e, 0x7e, 0xfb, 0x3c, 0x7c,
                      0x55, 0xef, 0xcd, 0xe2, 0xa,  0x86, 0xda, 0x20, 0x33, 0x7d, 0x16, 0x48, 0xa9};
  uint8_t bytes5[] = {0x80, 0x6b, 0xc7, 0x7b, 0xc2, 0xf5, 0x60, 0x9e, 0xc2, 0xf6, 0x3f, 0xa8, 0xdd,
                      0x8c, 0x5a, 0xde, 0x2f, 0x58, 0xc8, 0x78, 0xa5, 0x2d, 0xfe, 0xa0, 0x66, 0xfa};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1555}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1631}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\179\182\194\v\149\131\&4\177\175cM\153\251\204B\RS\231\170n}y\198\197)\250\203\147\151\211\138", _pubPktID = 1399,
// _pubBody = "\156\228\194pPo\189\&6\255\NAK\245-\151\170\DC3;\191\196\136\241\191\255V\146`\250\183\234>\138",
// _pubProps = [PropTopicAlias 10172]}
TEST(Publish50QCTest, Encode80) {
  uint8_t pkt[] = {0x3b, 0x44, 0x0,  0x1e, 0xb3, 0xb6, 0xc2, 0xb,  0x95, 0x83, 0x34, 0xb1, 0xaf, 0x63,
                   0x4d, 0x99, 0xfb, 0xcc, 0x42, 0x1e, 0xe7, 0xaa, 0x6e, 0x7d, 0x79, 0xc6, 0xc5, 0x29,
                   0xfa, 0xcb, 0x93, 0x97, 0xd3, 0x8a, 0x5,  0x77, 0x3,  0x23, 0x27, 0xbc, 0x9c, 0xe4,
                   0xc2, 0x70, 0x50, 0x6f, 0xbd, 0x36, 0xff, 0x15, 0xf5, 0x2d, 0x97, 0xaa, 0x13, 0x3b,
                   0xbf, 0xc4, 0x88, 0xf1, 0xbf, 0xff, 0x56, 0x92, 0x60, 0xfa, 0xb7, 0xea, 0x3e, 0x8a};

  uint8_t buf[80] = {0};

  uint8_t topic_bytes[] = {0xb3, 0xb6, 0xc2, 0xb,  0x95, 0x83, 0x34, 0xb1, 0xaf, 0x63, 0x4d, 0x99, 0xfb, 0xcc, 0x42,
                           0x1e, 0xe7, 0xaa, 0x6e, 0x7d, 0x79, 0xc6, 0xc5, 0x29, 0xfa, 0xcb, 0x93, 0x97, 0xd3, 0x8a};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9c, 0xe4, 0xc2, 0x70, 0x50, 0x6f, 0xbd, 0x36, 0xff, 0x15, 0xf5, 0x2d, 0x97, 0xaa, 0x13,
                         0x3b, 0xbf, 0xc4, 0x88, 0xf1, 0xbf, 0xff, 0x56, 0x92, 0x60, 0xfa, 0xb7, 0xea, 0x3e, 0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10172}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1399, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\183\185o\230@UI=\142/\201\188\216sZ\ESC\b\"\182\202\NAKU$`\181\rE\194t\f", _pubPktID = 17758, _pubBody =
// "\251~\215\217\SOH\189L!\244\EM\212\246_\154\185\179.\187\EOTE\242\169", _pubProps = [PropAuthenticationMethod
// "\230$\159\147\SUB]\144\SUB\221\202P\170\179\154G\210E\219\255\134\132\191\158\133\219q\240\189",PropTopicAliasMaximum
// 24228,PropPayloadFormatIndicator 214,PropSharedSubscriptionAvailable 148,PropPayloadFormatIndicator
// 197,PropWillDelayInterval 5533,PropPayloadFormatIndicator 8,PropServerKeepAlive 5558,PropWillDelayInterval
// 9585,PropServerKeepAlive 27517,PropResponseInformation "\244\135\DC2\245}w\234\135",PropReasonString
// "\n\212NL\t\226\177\238\ESC\175\197\148V\141\194\162\164\190]e'",PropWildcardSubscriptionAvailable
// 226,PropWildcardSubscriptionAvailable 74,PropMessageExpiryInterval 26648,PropMaximumQoS
// 193,PropSubscriptionIdentifier 18,PropSessionExpiryInterval 1981,PropServerReference
// "O\ESCAo\223\174\DELGQ\173\231=\149t\129PE\NAK\201\181\163=I\133",PropServerReference
// "\154\ENQ\214S\202\212\ETXf\192\169\ETB",PropSessionExpiryInterval 23038,PropMaximumQoS 51,PropServerKeepAlive 1930]}
TEST(Publish50QCTest, Encode81) {
  uint8_t pkt[] = {
      0x33, 0xdc, 0x1,  0x0,  0x1e, 0xb7, 0xb9, 0x6f, 0xe6, 0x40, 0x55, 0x49, 0x3d, 0x8e, 0x2f, 0xc9, 0xbc, 0xd8, 0x73,
      0x5a, 0x1b, 0x8,  0x22, 0xb6, 0xca, 0x15, 0x55, 0x24, 0x60, 0xb5, 0xd,  0x45, 0xc2, 0x74, 0xc,  0x45, 0x5e, 0xa2,
      0x1,  0x15, 0x0,  0x1c, 0xe6, 0x24, 0x9f, 0x93, 0x1a, 0x5d, 0x90, 0x1a, 0xdd, 0xca, 0x50, 0xaa, 0xb3, 0x9a, 0x47,
      0xd2, 0x45, 0xdb, 0xff, 0x86, 0x84, 0xbf, 0x9e, 0x85, 0xdb, 0x71, 0xf0, 0xbd, 0x22, 0x5e, 0xa4, 0x1,  0xd6, 0x2a,
      0x94, 0x1,  0xc5, 0x18, 0x0,  0x0,  0x15, 0x9d, 0x1,  0x8,  0x13, 0x15, 0xb6, 0x18, 0x0,  0x0,  0x25, 0x71, 0x13,
      0x6b, 0x7d, 0x1a, 0x0,  0x8,  0xf4, 0x87, 0x12, 0xf5, 0x7d, 0x77, 0xea, 0x87, 0x1f, 0x0,  0x15, 0xa,  0xd4, 0x4e,
      0x4c, 0x9,  0xe2, 0xb1, 0xee, 0x1b, 0xaf, 0xc5, 0x94, 0x56, 0x8d, 0xc2, 0xa2, 0xa4, 0xbe, 0x5d, 0x65, 0x27, 0x28,
      0xe2, 0x28, 0x4a, 0x2,  0x0,  0x0,  0x68, 0x18, 0x24, 0xc1, 0xb,  0x12, 0x11, 0x0,  0x0,  0x7,  0xbd, 0x1c, 0x0,
      0x18, 0x4f, 0x1b, 0x41, 0x6f, 0xdf, 0xae, 0x7f, 0x47, 0x51, 0xad, 0xe7, 0x3d, 0x95, 0x74, 0x81, 0x50, 0x45, 0x15,
      0xc9, 0xb5, 0xa3, 0x3d, 0x49, 0x85, 0x1c, 0x0,  0xb,  0x9a, 0x5,  0xd6, 0x53, 0xca, 0xd4, 0x3,  0x66, 0xc0, 0xa9,
      0x17, 0x11, 0x0,  0x0,  0x59, 0xfe, 0x24, 0x33, 0x13, 0x7,  0x8a, 0xfb, 0x7e, 0xd7, 0xd9, 0x1,  0xbd, 0x4c, 0x21,
      0xf4, 0x19, 0xd4, 0xf6, 0x5f, 0x9a, 0xb9, 0xb3, 0x2e, 0xbb, 0x4,  0x45, 0xf2, 0xa9};

  uint8_t buf[233] = {0};

  uint8_t topic_bytes[] = {0xb7, 0xb9, 0x6f, 0xe6, 0x40, 0x55, 0x49, 0x3d, 0x8e, 0x2f, 0xc9, 0xbc, 0xd8, 0x73, 0x5a,
                           0x1b, 0x8,  0x22, 0xb6, 0xca, 0x15, 0x55, 0x24, 0x60, 0xb5, 0xd,  0x45, 0xc2, 0x74, 0xc};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfb, 0x7e, 0xd7, 0xd9, 0x1,  0xbd, 0x4c, 0x21, 0xf4, 0x19, 0xd4,
                         0xf6, 0x5f, 0x9a, 0xb9, 0xb3, 0x2e, 0xbb, 0x4,  0x45, 0xf2, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytes0[] = {0xe6, 0x24, 0x9f, 0x93, 0x1a, 0x5d, 0x90, 0x1a, 0xdd, 0xca, 0x50, 0xaa, 0xb3, 0x9a,
                      0x47, 0xd2, 0x45, 0xdb, 0xff, 0x86, 0x84, 0xbf, 0x9e, 0x85, 0xdb, 0x71, 0xf0, 0xbd};
  uint8_t bytes1[] = {0xf4, 0x87, 0x12, 0xf5, 0x7d, 0x77, 0xea, 0x87};
  uint8_t bytes2[] = {0xa,  0xd4, 0x4e, 0x4c, 0x9,  0xe2, 0xb1, 0xee, 0x1b, 0xaf, 0xc5,
                      0x94, 0x56, 0x8d, 0xc2, 0xa2, 0xa4, 0xbe, 0x5d, 0x65, 0x27};
  uint8_t bytes3[] = {0x4f, 0x1b, 0x41, 0x6f, 0xdf, 0xae, 0x7f, 0x47, 0x51, 0xad, 0xe7, 0x3d,
                      0x95, 0x74, 0x81, 0x50, 0x45, 0x15, 0xc9, 0xb5, 0xa3, 0x3d, 0x49, 0x85};
  uint8_t bytes4[] = {0x9a, 0x5, 0xd6, 0x53, 0xca, 0xd4, 0x3, 0x66, 0xc0, 0xa9, 0x17};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24228}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5533}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5558}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9585}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27517}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26648}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1981}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23038}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1930}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17758, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "", _pubPktID = 3165, _pubBody =
// "\168'\DC2\253\238;d\144\231\186\152t\206\166", _pubProps = [PropContentType
// "[\236<\152\128\186\169\221\182\180d\214\171d\227>\137\180\ETXQ",PropReceiveMaximum 22525,PropContentType
// "v\166\207e\200_\199\213\250\&4=l$\240,m)\EOT\ETB\171\133\222\ACK\162$\210\158",PropMessageExpiryInterval
// 13876,PropTopicAlias 9953,PropAuthenticationData
// "w\NUL\ACKf\196\178\193Ml}\159\213^\ACK9%\168\158\233r\171\134\223r\140"]}
TEST(Publish50QCTest, Encode82) {
  uint8_t pkt[] = {0x3d, 0x6f, 0x0,  0x0,  0xc,  0x5d, 0x5c, 0x3,  0x0,  0x14, 0x5b, 0xec, 0x3c, 0x98, 0x80, 0xba, 0xa9,
                   0xdd, 0xb6, 0xb4, 0x64, 0xd6, 0xab, 0x64, 0xe3, 0x3e, 0x89, 0xb4, 0x3,  0x51, 0x21, 0x57, 0xfd, 0x3,
                   0x0,  0x1b, 0x76, 0xa6, 0xcf, 0x65, 0xc8, 0x5f, 0xc7, 0xd5, 0xfa, 0x34, 0x3d, 0x6c, 0x24, 0xf0, 0x2c,
                   0x6d, 0x29, 0x4,  0x17, 0xab, 0x85, 0xde, 0x6,  0xa2, 0x24, 0xd2, 0x9e, 0x2,  0x0,  0x0,  0x36, 0x34,
                   0x23, 0x26, 0xe1, 0x16, 0x0,  0x19, 0x77, 0x0,  0x6,  0x66, 0xc4, 0xb2, 0xc1, 0x4d, 0x6c, 0x7d, 0x9f,
                   0xd5, 0x5e, 0x6,  0x39, 0x25, 0xa8, 0x9e, 0xe9, 0x72, 0xab, 0x86, 0xdf, 0x72, 0x8c, 0xa8, 0x27, 0x12,
                   0xfd, 0xee, 0x3b, 0x64, 0x90, 0xe7, 0xba, 0x98, 0x74, 0xce, 0xa6};

  uint8_t buf[123] = {0};

  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa8, 0x27, 0x12, 0xfd, 0xee, 0x3b, 0x64, 0x90, 0xe7, 0xba, 0x98, 0x74, 0xce, 0xa6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytes0[] = {0x5b, 0xec, 0x3c, 0x98, 0x80, 0xba, 0xa9, 0xdd, 0xb6, 0xb4,
                      0x64, 0xd6, 0xab, 0x64, 0xe3, 0x3e, 0x89, 0xb4, 0x3,  0x51};
  uint8_t bytes1[] = {0x76, 0xa6, 0xcf, 0x65, 0xc8, 0x5f, 0xc7, 0xd5, 0xfa, 0x34, 0x3d, 0x6c, 0x24, 0xf0,
                      0x2c, 0x6d, 0x29, 0x4,  0x17, 0xab, 0x85, 0xde, 0x6,  0xa2, 0x24, 0xd2, 0x9e};
  uint8_t bytes2[] = {0x77, 0x0,  0x6,  0x66, 0xc4, 0xb2, 0xc1, 0x4d, 0x6c, 0x7d, 0x9f, 0xd5, 0x5e,
                      0x6,  0x39, 0x25, 0xa8, 0x9e, 0xe9, 0x72, 0xab, 0x86, 0xdf, 0x72, 0x8c};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22525}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13876}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9953}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytes2}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 3165, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\GS\DC2", _pubPktID = 7799, _pubBody
// = "\138\249b\fd \199\239\220\147\235\233\214\152\139\130Q\163v?ZrG\215\139\236\184\230y", _pubProps =
// [PropSubscriptionIdentifierAvailable 186,PropServerReference
// "u\171O\192\245i;\DC1\DEL\SI\143f\146\b\237i\242\250h\147\171\244\CAN\226n",PropSubscriptionIdentifier
// 19,PropResponseInformation "",PropCorrelationData "\197vg\238\248\222\160\219\187\243\b\219\135Ds\218\229C\195'\252h
// 4",PropWildcardSubscriptionAvailable 146]}
TEST(Publish50QCTest, Encode83) {
  uint8_t pkt[] = {0x3a, 0x64, 0x0,  0x2,  0x1d, 0x12, 0x1e, 0x77, 0x40, 0x29, 0xba, 0x1c, 0x0,  0x19, 0x75,
                   0xab, 0x4f, 0xc0, 0xf5, 0x69, 0x3b, 0x11, 0x7f, 0xf,  0x8f, 0x66, 0x92, 0x8,  0xed, 0x69,
                   0xf2, 0xfa, 0x68, 0x93, 0xab, 0xf4, 0x18, 0xe2, 0x6e, 0xb,  0x13, 0x1a, 0x0,  0x0,  0x9,
                   0x0,  0x18, 0xc5, 0x76, 0x67, 0xee, 0xf8, 0xde, 0xa0, 0xdb, 0xbb, 0xf3, 0x8,  0xdb, 0x87,
                   0x44, 0x73, 0xda, 0xe5, 0x43, 0xc3, 0x27, 0xfc, 0x68, 0x20, 0x34, 0x28, 0x92, 0x8a, 0xf9,
                   0x62, 0xc,  0x64, 0x20, 0xc7, 0xef, 0xdc, 0x93, 0xeb, 0xe9, 0xd6, 0x98, 0x8b, 0x82, 0x51,
                   0xa3, 0x76, 0x3f, 0x5a, 0x72, 0x47, 0xd7, 0x8b, 0xec, 0xb8, 0xe6, 0x79};

  uint8_t buf[112] = {0};

  uint8_t topic_bytes[] = {0x1d, 0x12};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a, 0xf9, 0x62, 0xc,  0x64, 0x20, 0xc7, 0xef, 0xdc, 0x93, 0xeb, 0xe9, 0xd6, 0x98, 0x8b,
                         0x82, 0x51, 0xa3, 0x76, 0x3f, 0x5a, 0x72, 0x47, 0xd7, 0x8b, 0xec, 0xb8, 0xe6, 0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytes0[] = {0x75, 0xab, 0x4f, 0xc0, 0xf5, 0x69, 0x3b, 0x11, 0x7f, 0xf,  0x8f, 0x66, 0x92,
                      0x8,  0xed, 0x69, 0xf2, 0xfa, 0x68, 0x93, 0xab, 0xf4, 0x18, 0xe2, 0x6e};
  uint8_t bytes1[] = {0};
  uint8_t bytes2[] = {0xc5, 0x76, 0x67, 0xee, 0xf8, 0xde, 0xa0, 0xdb, 0xbb, 0xf3, 0x8,  0xdb,
                      0x87, 0x44, 0x73, 0xda, 0xe5, 0x43, 0xc3, 0x27, 0xfc, 0x68, 0x20, 0x34};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 146}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7799, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\208\187K.", _pubPktID = 29034,
// _pubBody = "\221\ACK\199\144\EOTv\ACK\217\\", _pubProps = [PropServerKeepAlive 3513,PropUserProperty
// "e\141\b\252'\183<h\128\139V-pFF \DLEf\t\139U" "\215\142\247\170.\166\227\132\183=`",PropContentType
// "\v\238\135k\241\168\218\201\NUL\202\249\237\129\179\196\194\184\252*g\159\248-\a\224\165\157\136\140.",PropTopicAlias
// 9225,PropMessageExpiryInterval 30207,PropAssignedClientIdentifier "#\ETX"]}
TEST(Publish50QCTest, Encode84) {
  uint8_t pkt[] = {0x3b, 0x68, 0x0,  0x4,  0xd0, 0xbb, 0x4b, 0x2e, 0x71, 0x6a, 0x56, 0x13, 0xd,  0xb9, 0x26, 0x0,
                   0x15, 0x65, 0x8d, 0x8,  0xfc, 0x27, 0xb7, 0x3c, 0x68, 0x80, 0x8b, 0x56, 0x2d, 0x70, 0x46, 0x46,
                   0x20, 0x10, 0x66, 0x9,  0x8b, 0x55, 0x0,  0xb,  0xd7, 0x8e, 0xf7, 0xaa, 0x2e, 0xa6, 0xe3, 0x84,
                   0xb7, 0x3d, 0x60, 0x3,  0x0,  0x1e, 0xb,  0xee, 0x87, 0x6b, 0xf1, 0xa8, 0xda, 0xc9, 0x0,  0xca,
                   0xf9, 0xed, 0x81, 0xb3, 0xc4, 0xc2, 0xb8, 0xfc, 0x2a, 0x67, 0x9f, 0xf8, 0x2d, 0x7,  0xe0, 0xa5,
                   0x9d, 0x88, 0x8c, 0x2e, 0x23, 0x24, 0x9,  0x2,  0x0,  0x0,  0x75, 0xff, 0x12, 0x0,  0x2,  0x23,
                   0x3,  0xdd, 0x6,  0xc7, 0x90, 0x4,  0x76, 0x6,  0xd9, 0x5c};

  uint8_t buf[116] = {0};

  uint8_t topic_bytes[] = {0xd0, 0xbb, 0x4b, 0x2e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xdd, 0x6, 0xc7, 0x90, 0x4, 0x76, 0x6, 0xd9, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytes1[] = {0xd7, 0x8e, 0xf7, 0xaa, 0x2e, 0xa6, 0xe3, 0x84, 0xb7, 0x3d, 0x60};
  uint8_t bytes0[] = {0x65, 0x8d, 0x8,  0xfc, 0x27, 0xb7, 0x3c, 0x68, 0x80, 0x8b, 0x56,
                      0x2d, 0x70, 0x46, 0x46, 0x20, 0x10, 0x66, 0x9,  0x8b, 0x55};
  uint8_t bytes2[] = {0xb,  0xee, 0x87, 0x6b, 0xf1, 0xa8, 0xda, 0xc9, 0x0, 0xca, 0xf9, 0xed, 0x81, 0xb3, 0xc4,
                      0xc2, 0xb8, 0xfc, 0x2a, 0x67, 0x9f, 0xf8, 0x2d, 0x7, 0xe0, 0xa5, 0x9d, 0x88, 0x8c, 0x2e};
  uint8_t bytes3[] = {0x23, 0x3};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3513}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes0}, .v = {11, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9225}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30207}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytes3}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29034, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\201y\171\155\184C", _pubPktID = 0,
// _pubBody = "\180\178\&2\194\SUB5Z\254\US\217\144\t:4a\154\203\201\ETX\DC3\246_[<\224", _pubProps =
// [PropServerReference ">\204\&0",PropWildcardSubscriptionAvailable 133,PropRequestProblemInformation
// 134,PropTopicAliasMaximum 26123,PropMessageExpiryInterval 31900,PropPayloadFormatIndicator 100,PropMaximumQoS
// 25,PropSubscriptionIdentifier 24]}
TEST(Publish50QCTest, Encode85) {
  uint8_t pkt[] = {0x38, 0x3a, 0x0,  0x6,  0xc9, 0x79, 0xab, 0x9b, 0xb8, 0x43, 0x18, 0x1c, 0x0,  0x3,  0x3e,
                   0xcc, 0x30, 0x28, 0x85, 0x17, 0x86, 0x22, 0x66, 0xb,  0x2,  0x0,  0x0,  0x7c, 0x9c, 0x1,
                   0x64, 0x24, 0x19, 0xb,  0x18, 0xb4, 0xb2, 0x32, 0xc2, 0x1a, 0x35, 0x5a, 0xfe, 0x1f, 0xd9,
                   0x90, 0x9,  0x3a, 0x34, 0x61, 0x9a, 0xcb, 0xc9, 0x3,  0x13, 0xf6, 0x5f, 0x5b, 0x3c, 0xe0};

  uint8_t buf[70] = {0};

  uint8_t topic_bytes[] = {0xc9, 0x79, 0xab, 0x9b, 0xb8, 0x43};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb4, 0xb2, 0x32, 0xc2, 0x1a, 0x35, 0x5a, 0xfe, 0x1f, 0xd9, 0x90, 0x9, 0x3a,
                         0x34, 0x61, 0x9a, 0xcb, 0xc9, 0x3,  0x13, 0xf6, 0x5f, 0x5b, 0x3c, 0xe0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytes0[] = {0x3e, 0xcc, 0x30};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26123}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31900}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}q\213-\168\195\252$\139j^\DC1o\198\RS\172\159q", _pubPktID = 8388, _pubBody = "\196\&7\f\aA\EOT", _pubProps =
// [PropTopicAlias 5216]}
TEST(Publish50QCTest, Encode86) {
  uint8_t pkt[] = {0x32, 0x20, 0x0,  0x12, 0x7d, 0x71, 0xd5, 0x2d, 0xa8, 0xc3, 0xfc, 0x24, 0x8b, 0x6a, 0x5e, 0x11, 0x6f,
                   0xc6, 0x1e, 0xac, 0x9f, 0x71, 0x20, 0xc4, 0x3,  0x23, 0x14, 0x60, 0xc4, 0x37, 0xc,  0x7,  0x41, 0x4};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0x7d, 0x71, 0xd5, 0x2d, 0xa8, 0xc3, 0xfc, 0x24, 0x8b,
                           0x6a, 0x5e, 0x11, 0x6f, 0xc6, 0x1e, 0xac, 0x9f, 0x71};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc4, 0x37, 0xc, 0x7, 0x41, 0x4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5216}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 8388, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\214\177\ETBL\143\b\216", _pubPktID
// = 466, _pubBody = "sz\183u\DC3:\199\242\216%\137\EM\a\203\242\209\144\194fR6\240\163&\200H", _pubProps =
// [PropSharedSubscriptionAvailable 47,PropRequestProblemInformation 51,PropPayloadFormatIndicator
// 185,PropServerReference "\207\205\ACK\148\196'\225\159\ENQG0\238`r4\135\ENQ\136\149\190",PropMaximumPacketSize
// 612,PropReasonString
// "\181\203E\b\225?8745\236\172$\f\228\247\153\186\163\214\DLE\176\205\b\164\248",PropServerKeepAlive
// 22517,PropAuthenticationMethod "",PropAuthenticationData
// "\a\DC4b7A>\249\247\239>\a\162\216\195",PropMaximumPacketSize 21926,PropAssignedClientIdentifier
// "U\a\203K\156\203\198bi\193\144\143\246XZ\133X",PropAuthenticationData
// "w(2\212\162^R\186\b\CAN\226o/;\155C\184\174\157S~\224Y\DC3\CAN\154r",PropAuthenticationMethod
// ">\254\169\246\252\233\&5\198\noB\228\129tT\237\204",PropMessageExpiryInterval 826,PropMessageExpiryInterval
// 29414,PropTopicAlias 6110,PropMaximumPacketSize 29501,PropMessageExpiryInterval 15604,PropServerReference
// "v\DC2\EOT$\195\182\146\252\207XI\FSF\197\217Sw\207I0e\201\205oj\196\129",PropPayloadFormatIndicator
// 53,PropReceiveMaximum 26780,PropRequestProblemInformation 218]}
TEST(Publish50QCTest, Encode87) {
  uint8_t pkt[] = {
      0x34, 0x84, 0x2,  0x0,  0x7,  0xd6, 0xb1, 0x17, 0x4c, 0x8f, 0x8,  0xd8, 0x1,  0xd2, 0xdd, 0x1,  0x2a, 0x2f, 0x17,
      0x33, 0x1,  0xb9, 0x1c, 0x0,  0x14, 0xcf, 0xcd, 0x6,  0x94, 0xc4, 0x27, 0xe1, 0x9f, 0x5,  0x47, 0x30, 0xee, 0x60,
      0x72, 0x34, 0x87, 0x5,  0x88, 0x95, 0xbe, 0x27, 0x0,  0x0,  0x2,  0x64, 0x1f, 0x0,  0x1a, 0xb5, 0xcb, 0x45, 0x8,
      0xe1, 0x3f, 0x38, 0x37, 0x34, 0x35, 0xec, 0xac, 0x24, 0xc,  0xe4, 0xf7, 0x99, 0xba, 0xa3, 0xd6, 0x10, 0xb0, 0xcd,
      0x8,  0xa4, 0xf8, 0x13, 0x57, 0xf5, 0x15, 0x0,  0x0,  0x16, 0x0,  0xe,  0x7,  0x14, 0x62, 0x37, 0x41, 0x3e, 0xf9,
      0xf7, 0xef, 0x3e, 0x7,  0xa2, 0xd8, 0xc3, 0x27, 0x0,  0x0,  0x55, 0xa6, 0x12, 0x0,  0x11, 0x55, 0x7,  0xcb, 0x4b,
      0x9c, 0xcb, 0xc6, 0x62, 0x69, 0xc1, 0x90, 0x8f, 0xf6, 0x58, 0x5a, 0x85, 0x58, 0x16, 0x0,  0x1b, 0x77, 0x28, 0x32,
      0xd4, 0xa2, 0x5e, 0x52, 0xba, 0x8,  0x18, 0xe2, 0x6f, 0x2f, 0x3b, 0x9b, 0x43, 0xb8, 0xae, 0x9d, 0x53, 0x7e, 0xe0,
      0x59, 0x13, 0x18, 0x9a, 0x72, 0x15, 0x0,  0x11, 0x3e, 0xfe, 0xa9, 0xf6, 0xfc, 0xe9, 0x35, 0xc6, 0xa,  0x6f, 0x42,
      0xe4, 0x81, 0x74, 0x54, 0xed, 0xcc, 0x2,  0x0,  0x0,  0x3,  0x3a, 0x2,  0x0,  0x0,  0x72, 0xe6, 0x23, 0x17, 0xde,
      0x27, 0x0,  0x0,  0x73, 0x3d, 0x2,  0x0,  0x0,  0x3c, 0xf4, 0x1c, 0x0,  0x1b, 0x76, 0x12, 0x4,  0x24, 0xc3, 0xb6,
      0x92, 0xfc, 0xcf, 0x58, 0x49, 0x1c, 0x46, 0xc5, 0xd9, 0x53, 0x77, 0xcf, 0x49, 0x30, 0x65, 0xc9, 0xcd, 0x6f, 0x6a,
      0xc4, 0x81, 0x1,  0x35, 0x21, 0x68, 0x9c, 0x17, 0xda, 0x73, 0x7a, 0xb7, 0x75, 0x13, 0x3a, 0xc7, 0xf2, 0xd8, 0x25,
      0x89, 0x19, 0x7,  0xcb, 0xf2, 0xd1, 0x90, 0xc2, 0x66, 0x52, 0x36, 0xf0, 0xa3, 0x26, 0xc8, 0x48};

  uint8_t buf[273] = {0};

  uint8_t topic_bytes[] = {0xd6, 0xb1, 0x17, 0x4c, 0x8f, 0x8, 0xd8};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0x7a, 0xb7, 0x75, 0x13, 0x3a, 0xc7, 0xf2, 0xd8, 0x25, 0x89, 0x19, 0x7,
                         0xcb, 0xf2, 0xd1, 0x90, 0xc2, 0x66, 0x52, 0x36, 0xf0, 0xa3, 0x26, 0xc8, 0x48};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytes0[] = {0xcf, 0xcd, 0x6,  0x94, 0xc4, 0x27, 0xe1, 0x9f, 0x5,  0x47,
                      0x30, 0xee, 0x60, 0x72, 0x34, 0x87, 0x5,  0x88, 0x95, 0xbe};
  uint8_t bytes1[] = {0xb5, 0xcb, 0x45, 0x8,  0xe1, 0x3f, 0x38, 0x37, 0x34, 0x35, 0xec, 0xac, 0x24,
                      0xc,  0xe4, 0xf7, 0x99, 0xba, 0xa3, 0xd6, 0x10, 0xb0, 0xcd, 0x8,  0xa4, 0xf8};
  uint8_t bytes2[] = {0};
  uint8_t bytes3[] = {0x7, 0x14, 0x62, 0x37, 0x41, 0x3e, 0xf9, 0xf7, 0xef, 0x3e, 0x7, 0xa2, 0xd8, 0xc3};
  uint8_t bytes4[] = {0x55, 0x7,  0xcb, 0x4b, 0x9c, 0xcb, 0xc6, 0x62, 0x69,
                      0xc1, 0x90, 0x8f, 0xf6, 0x58, 0x5a, 0x85, 0x58};
  uint8_t bytes5[] = {0x77, 0x28, 0x32, 0xd4, 0xa2, 0x5e, 0x52, 0xba, 0x8,  0x18, 0xe2, 0x6f, 0x2f, 0x3b,
                      0x9b, 0x43, 0xb8, 0xae, 0x9d, 0x53, 0x7e, 0xe0, 0x59, 0x13, 0x18, 0x9a, 0x72};
  uint8_t bytes6[] = {0x3e, 0xfe, 0xa9, 0xf6, 0xfc, 0xe9, 0x35, 0xc6, 0xa,
                      0x6f, 0x42, 0xe4, 0x81, 0x74, 0x54, 0xed, 0xcc};
  uint8_t bytes7[] = {0x76, 0x12, 0x4,  0x24, 0xc3, 0xb6, 0x92, 0xfc, 0xcf, 0x58, 0x49, 0x1c, 0x46, 0xc5,
                      0xd9, 0x53, 0x77, 0xcf, 0x49, 0x30, 0x65, 0xc9, 0xcd, 0x6f, 0x6a, 0xc4, 0x81};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 612}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22517}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21926}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 826}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29414}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6110}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29501}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15604}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26780}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 218}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 466, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\STX\213\240cI\204T-w\154\192|#=\254P\DC24\200\170\228\NUL\186\147/\225\193\b\FS\140", _pubPktID = 26668, _pubBody =
// ".T\237(\238\DELg0 \GS\STX\215*\156\169t\147\b\206\149\172\r\211\RS\205 5\US\t0", _pubProps = [PropContentType
// "6\198\194G\158_",PropReasonString "\249\167\172\RS/z\220\228",PropPayloadFormatIndicator 170,PropTopicAlias
// 21820,PropAuthenticationMethod "z\139\GS\152\133kU\143",PropResponseInformation
// "\189\218Yv\197\231\179q\216\219\DC2q'\131\227\DLEs}\NUL\200\203o\247y\202\177",PropServerReference
// "H\154\225&\139\196}.\aM~\218",PropWildcardSubscriptionAvailable 175,PropSharedSubscriptionAvailable
// 51,PropRequestProblemInformation 186,PropUserProperty
// "\SUB\200\198\242\189\161\v\242K\145C\155\168\162\204\213Kq\224\180n"
// "k\141Bq@^\DC3\210\226\163\222\211\254\214\211\253",PropTopicAlias 6507]}
TEST(Publish50QCTest, Encode88) {
  uint8_t pkt[] = {0x33, 0xc5, 0x1,  0x0,  0x1e, 0x2,  0xd5, 0xf0, 0x63, 0x49, 0xcc, 0x54, 0x2d, 0x77, 0x9a, 0xc0, 0x7c,
                   0x23, 0x3d, 0xfe, 0x50, 0x12, 0x34, 0xc8, 0xaa, 0xe4, 0x0,  0xba, 0x93, 0x2f, 0xe1, 0xc1, 0x8,  0x1c,
                   0x8c, 0x68, 0x2c, 0x83, 0x1,  0x3,  0x0,  0x6,  0x36, 0xc6, 0xc2, 0x47, 0x9e, 0x5f, 0x1f, 0x0,  0x8,
                   0xf9, 0xa7, 0xac, 0x1e, 0x2f, 0x7a, 0xdc, 0xe4, 0x1,  0xaa, 0x23, 0x55, 0x3c, 0x15, 0x0,  0x8,  0x7a,
                   0x8b, 0x1d, 0x98, 0x85, 0x6b, 0x55, 0x8f, 0x1a, 0x0,  0x1a, 0xbd, 0xda, 0x59, 0x76, 0xc5, 0xe7, 0xb3,
                   0x71, 0xd8, 0xdb, 0x12, 0x71, 0x27, 0x83, 0xe3, 0x10, 0x73, 0x7d, 0x0,  0xc8, 0xcb, 0x6f, 0xf7, 0x79,
                   0xca, 0xb1, 0x1c, 0x0,  0xc,  0x48, 0x9a, 0xe1, 0x26, 0x8b, 0xc4, 0x7d, 0x2e, 0x7,  0x4d, 0x7e, 0xda,
                   0x28, 0xaf, 0x2a, 0x33, 0x17, 0xba, 0x26, 0x0,  0x15, 0x1a, 0xc8, 0xc6, 0xf2, 0xbd, 0xa1, 0xb,  0xf2,
                   0x4b, 0x91, 0x43, 0x9b, 0xa8, 0xa2, 0xcc, 0xd5, 0x4b, 0x71, 0xe0, 0xb4, 0x6e, 0x0,  0x10, 0x6b, 0x8d,
                   0x42, 0x71, 0x40, 0x5e, 0x13, 0xd2, 0xe2, 0xa3, 0xde, 0xd3, 0xfe, 0xd6, 0xd3, 0xfd, 0x23, 0x19, 0x6b,
                   0x2e, 0x54, 0xed, 0x28, 0xee, 0x7f, 0x67, 0x30, 0x20, 0x1d, 0x2,  0xd7, 0x2a, 0x9c, 0xa9, 0x74, 0x93,
                   0x8,  0xce, 0x95, 0xac, 0xd,  0xd3, 0x1e, 0xcd, 0x20, 0x35, 0x1f, 0x9,  0x30};

  uint8_t buf[210] = {0};

  uint8_t topic_bytes[] = {0x2,  0xd5, 0xf0, 0x63, 0x49, 0xcc, 0x54, 0x2d, 0x77, 0x9a, 0xc0, 0x7c, 0x23, 0x3d, 0xfe,
                           0x50, 0x12, 0x34, 0xc8, 0xaa, 0xe4, 0x0,  0xba, 0x93, 0x2f, 0xe1, 0xc1, 0x8,  0x1c, 0x8c};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2e, 0x54, 0xed, 0x28, 0xee, 0x7f, 0x67, 0x30, 0x20, 0x1d, 0x2,  0xd7, 0x2a, 0x9c, 0xa9,
                         0x74, 0x93, 0x8,  0xce, 0x95, 0xac, 0xd,  0xd3, 0x1e, 0xcd, 0x20, 0x35, 0x1f, 0x9,  0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytes0[] = {0x36, 0xc6, 0xc2, 0x47, 0x9e, 0x5f};
  uint8_t bytes1[] = {0xf9, 0xa7, 0xac, 0x1e, 0x2f, 0x7a, 0xdc, 0xe4};
  uint8_t bytes2[] = {0x7a, 0x8b, 0x1d, 0x98, 0x85, 0x6b, 0x55, 0x8f};
  uint8_t bytes3[] = {0xbd, 0xda, 0x59, 0x76, 0xc5, 0xe7, 0xb3, 0x71, 0xd8, 0xdb, 0x12, 0x71, 0x27,
                      0x83, 0xe3, 0x10, 0x73, 0x7d, 0x0,  0xc8, 0xcb, 0x6f, 0xf7, 0x79, 0xca, 0xb1};
  uint8_t bytes4[] = {0x48, 0x9a, 0xe1, 0x26, 0x8b, 0xc4, 0x7d, 0x2e, 0x7, 0x4d, 0x7e, 0xda};
  uint8_t bytes6[] = {0x6b, 0x8d, 0x42, 0x71, 0x40, 0x5e, 0x13, 0xd2, 0xe2, 0xa3, 0xde, 0xd3, 0xfe, 0xd6, 0xd3, 0xfd};
  uint8_t bytes5[] = {0x1a, 0xc8, 0xc6, 0xf2, 0xbd, 0xa1, 0xb,  0xf2, 0x4b, 0x91, 0x43,
                      0x9b, 0xa8, 0xa2, 0xcc, 0xd5, 0x4b, 0x71, 0xe0, 0xb4, 0x6e};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21820}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytes5}, .v = {16, (char*)&bytes6}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6507}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 26668, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\"X\209\155%
// \FS1[\178\SI\134\232\SI\236n\212\r\FS", _pubPktID = 0, _pubBody =
// "`\190\143p\n\134\145\250\152\151,\233\245\224\143\FS\235_/\133\203", _pubProps = []}
TEST(Publish50QCTest, Encode89) {
  uint8_t pkt[] = {0x39, 0x2b, 0x0,  0x13, 0x22, 0x58, 0xd1, 0x9b, 0x25, 0x20, 0x1c, 0x31, 0x5b, 0xb2, 0xf,
                   0x86, 0xe8, 0xf,  0xec, 0x6e, 0xd4, 0xd,  0x1c, 0x0,  0x60, 0xbe, 0x8f, 0x70, 0xa,  0x86,
                   0x91, 0xfa, 0x98, 0x97, 0x2c, 0xe9, 0xf5, 0xe0, 0x8f, 0x1c, 0xeb, 0x5f, 0x2f, 0x85, 0xcb};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0x22, 0x58, 0xd1, 0x9b, 0x25, 0x20, 0x1c, 0x31, 0x5b, 0xb2,
                           0xf,  0x86, 0xe8, 0xf,  0xec, 0x6e, 0xd4, 0xd,  0x1c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xbe, 0x8f, 0x70, 0xa,  0x86, 0x91, 0xfa, 0x98, 0x97, 0x2c,
                         0xe9, 0xf5, 0xe0, 0x8f, 0x1c, 0xeb, 0x5f, 0x2f, 0x85, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t proplist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\175\195\208b[q\226\128\DC4'",
// _pubPktID = 14979, _pubBody = "\US", _pubProps = [PropRetainAvailable 166,PropWildcardSubscriptionAvailable
// 171,PropReceiveMaximum 11631,PropSessionExpiryInterval 20049,PropAuthenticationMethod
// "i\191\170\DC3\254\220\DEL\172\235I\238\185\220~?\217\US$\251`R\NAK"]}
TEST(Publish50QCTest, Encode90) {
  uint8_t pkt[] = {0x3c, 0x35, 0x0,  0xa,  0xaf, 0xc3, 0xd0, 0x62, 0x5b, 0x71, 0xe2, 0x80, 0x14, 0x27,
                   0x3a, 0x83, 0x25, 0x25, 0xa6, 0x28, 0xab, 0x21, 0x2d, 0x6f, 0x11, 0x0,  0x0,  0x4e,
                   0x51, 0x15, 0x0,  0x16, 0x69, 0xbf, 0xaa, 0x13, 0xfe, 0xdc, 0x7f, 0xac, 0xeb, 0x49,
                   0xee, 0xb9, 0xdc, 0x7e, 0x3f, 0xd9, 0x1f, 0x24, 0xfb, 0x60, 0x52, 0x15, 0x1f};

  uint8_t buf[65] = {0};

  uint8_t topic_bytes[] = {0xaf, 0xc3, 0xd0, 0x62, 0x5b, 0x71, 0xe2, 0x80, 0x14, 0x27};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0x69, 0xbf, 0xaa, 0x13, 0xfe, 0xdc, 0x7f, 0xac, 0xeb, 0x49, 0xee,
                      0xb9, 0xdc, 0x7e, 0x3f, 0xd9, 0x1f, 0x24, 0xfb, 0x60, 0x52, 0x15};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11631}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20049}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytes0}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 14979, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\141\253\128M\210\215vFY\193c\236\174\r\155\SYN\\y", _pubPktID = 16476, _pubBody = "\DEL\250\&0\179-", _pubProps =
// [PropAssignedClientIdentifier
// "\216\241+/\207\161\145\DC1\206E/\SO\214\200\165s\SO\188{$/4W-s",PropSubscriptionIdentifierAvailable
// 190,PropTopicAlias 6411,PropRequestResponseInformation 34,PropRequestResponseInformation
// 121,PropMessageExpiryInterval 20715,PropMessageExpiryInterval 12396,PropMaximumQoS
// 106,PropWildcardSubscriptionAvailable 0,PropMessageExpiryInterval 9349,PropMaximumPacketSize
// 8829,PropPayloadFormatIndicator 161,PropMessageExpiryInterval 11310,PropAuthenticationMethod
// "\221\182\153\SYN\195",PropMessageExpiryInterval 3614,PropResponseTopic
// "\248\f\189\DC2_",PropRequestProblemInformation 3,PropWillDelayInterval 19200,PropRetainAvailable
// 72,PropAuthenticationData "I\219D\NUL\130)\131\178",PropTopicAlias 20261,PropReasonString
// "i\130\206\161",PropSharedSubscriptionAvailable 91]}
TEST(Publish50QCTest, Encode91) {
  uint8_t pkt[] = {0x3b, 0x95, 0x1,  0x0,  0x12, 0x8d, 0xfd, 0x80, 0x4d, 0xd2, 0xd7, 0x76, 0x46, 0x59, 0xc1, 0x63, 0xec,
                   0xae, 0xd,  0x9b, 0x16, 0x5c, 0x79, 0x40, 0x5c, 0x79, 0x12, 0x0,  0x19, 0xd8, 0xf1, 0x2b, 0x2f, 0xcf,
                   0xa1, 0x91, 0x11, 0xce, 0x45, 0x2f, 0xe,  0xd6, 0xc8, 0xa5, 0x73, 0xe,  0xbc, 0x7b, 0x24, 0x2f, 0x34,
                   0x57, 0x2d, 0x73, 0x29, 0xbe, 0x23, 0x19, 0xb,  0x19, 0x22, 0x19, 0x79, 0x2,  0x0,  0x0,  0x50, 0xeb,
                   0x2,  0x0,  0x0,  0x30, 0x6c, 0x24, 0x6a, 0x28, 0x0,  0x2,  0x0,  0x0,  0x24, 0x85, 0x27, 0x0,  0x0,
                   0x22, 0x7d, 0x1,  0xa1, 0x2,  0x0,  0x0,  0x2c, 0x2e, 0x15, 0x0,  0x5,  0xdd, 0xb6, 0x99, 0x16, 0xc3,
                   0x2,  0x0,  0x0,  0xe,  0x1e, 0x8,  0x0,  0x5,  0xf8, 0xc,  0xbd, 0x12, 0x5f, 0x17, 0x3,  0x18, 0x0,
                   0x0,  0x4b, 0x0,  0x25, 0x48, 0x16, 0x0,  0x8,  0x49, 0xdb, 0x44, 0x0,  0x82, 0x29, 0x83, 0xb2, 0x23,
                   0x4f, 0x25, 0x1f, 0x0,  0x4,  0x69, 0x82, 0xce, 0xa1, 0x2a, 0x5b, 0x7f, 0xfa, 0x30, 0xb3, 0x2d};

  uint8_t buf[162] = {0};

  uint8_t topic_bytes[] = {0x8d, 0xfd, 0x80, 0x4d, 0xd2, 0xd7, 0x76, 0x46, 0x59,
                           0xc1, 0x63, 0xec, 0xae, 0xd,  0x9b, 0x16, 0x5c, 0x79};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7f, 0xfa, 0x30, 0xb3, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytes0[] = {0xd8, 0xf1, 0x2b, 0x2f, 0xcf, 0xa1, 0x91, 0x11, 0xce, 0x45, 0x2f, 0xe, 0xd6,
                      0xc8, 0xa5, 0x73, 0xe,  0xbc, 0x7b, 0x24, 0x2f, 0x34, 0x57, 0x2d, 0x73};
  uint8_t bytes1[] = {0xdd, 0xb6, 0x99, 0x16, 0xc3};
  uint8_t bytes2[] = {0xf8, 0xc, 0xbd, 0x12, 0x5f};
  uint8_t bytes3[] = {0x49, 0xdb, 0x44, 0x0, 0x82, 0x29, 0x83, 0xb2};
  uint8_t bytes4[] = {0x69, 0x82, 0xce, 0xa1};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6411}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20715}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12396}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9349}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8829}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11310}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3614}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19200}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20261}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 91}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16476, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\172\236
// #(l]\NAK\197K\GS\156j\151\195\144\235C\\\137\199*\177", _pubPktID = 24115, _pubBody = "\138", _pubProps =
// [PropAssignedClientIdentifier "\129a+n\170\188!\135\USlf\EM\248\247\227\155\206{&6",PropUserProperty "\214s\138\221"
// "\203\RSqhCk}E\DC1=C\227VW\189Payz\157",PropRetainAvailable 88,PropAssignedClientIdentifier
// "\243\206\165Q\DC2<s\SOH\US\252\225b\252\239\202,\DC1\DC2\DC2s\217\164",PropCorrelationData
// "\194\169\176u\144\\\202\150\255\196",PropSharedSubscriptionAvailable 43]}
TEST(Publish50QCTest, Encode92) {
  uint8_t pkt[] = {0x3a, 0x7b, 0x0,  0x17, 0xac, 0xec, 0x20, 0x23, 0x28, 0x6c, 0x5d, 0x15, 0xc5, 0x4b, 0x1d, 0x9c,
                   0x6a, 0x97, 0xc3, 0x90, 0xeb, 0x43, 0x5c, 0x89, 0xc7, 0x2a, 0xb1, 0x5e, 0x33, 0x5e, 0x12, 0x0,
                   0x14, 0x81, 0x61, 0x2b, 0x6e, 0xaa, 0xbc, 0x21, 0x87, 0x1f, 0x6c, 0x66, 0x19, 0xf8, 0xf7, 0xe3,
                   0x9b, 0xce, 0x7b, 0x26, 0x36, 0x26, 0x0,  0x4,  0xd6, 0x73, 0x8a, 0xdd, 0x0,  0x14, 0xcb, 0x1e,
                   0x71, 0x68, 0x43, 0x6b, 0x7d, 0x45, 0x11, 0x3d, 0x43, 0xe3, 0x56, 0x57, 0xbd, 0x50, 0x61, 0x79,
                   0x7a, 0x9d, 0x25, 0x58, 0x12, 0x0,  0x16, 0xf3, 0xce, 0xa5, 0x51, 0x12, 0x3c, 0x73, 0x1,  0x1f,
                   0xfc, 0xe1, 0x62, 0xfc, 0xef, 0xca, 0x2c, 0x11, 0x12, 0x12, 0x73, 0xd9, 0xa4, 0x9,  0x0,  0xa,
                   0xc2, 0xa9, 0xb0, 0x75, 0x90, 0x5c, 0xca, 0x96, 0xff, 0xc4, 0x2a, 0x2b, 0x8a};

  uint8_t buf[135] = {0};

  uint8_t topic_bytes[] = {0xac, 0xec, 0x20, 0x23, 0x28, 0x6c, 0x5d, 0x15, 0xc5, 0x4b, 0x1d, 0x9c,
                           0x6a, 0x97, 0xc3, 0x90, 0xeb, 0x43, 0x5c, 0x89, 0xc7, 0x2a, 0xb1};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytes0[] = {0x81, 0x61, 0x2b, 0x6e, 0xaa, 0xbc, 0x21, 0x87, 0x1f, 0x6c,
                      0x66, 0x19, 0xf8, 0xf7, 0xe3, 0x9b, 0xce, 0x7b, 0x26, 0x36};
  uint8_t bytes2[] = {0xcb, 0x1e, 0x71, 0x68, 0x43, 0x6b, 0x7d, 0x45, 0x11, 0x3d,
                      0x43, 0xe3, 0x56, 0x57, 0xbd, 0x50, 0x61, 0x79, 0x7a, 0x9d};
  uint8_t bytes1[] = {0xd6, 0x73, 0x8a, 0xdd};
  uint8_t bytes3[] = {0xf3, 0xce, 0xa5, 0x51, 0x12, 0x3c, 0x73, 0x1,  0x1f, 0xfc, 0xe1,
                      0x62, 0xfc, 0xef, 0xca, 0x2c, 0x11, 0x12, 0x12, 0x73, 0xd9, 0xa4};
  uint8_t bytes4[] = {0xc2, 0xa9, 0xb0, 0x75, 0x90, 0x5c, 0xca, 0x96, 0xff, 0xc4};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytes1}, .v = {20, (char*)&bytes2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 24115, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\SUB\250\FSj@\239n\DEL\t\158:\132\165\249\130\226L", _pubPktID = 159, _pubBody =
// "\131\140\143\172oD6\SIS\196O.\145\141\166\EOT\188\153\251U\SYNJT", _pubProps = [PropSubscriptionIdentifierAvailable
// 66,PropUserProperty "\132\232\DEL\161\210/\187V2\236\214\246\223\229\&1\195\212\193\r\133\199_"
// "\b\255\187\NAK7}S\STX\194b\190\187\223\201\ENQ\164\215F\133\177\136\DC1\DC4,\RS\213<",PropSubscriptionIdentifier
// 16,PropTopicAliasMaximum 671,PropAuthenticationMethod "\190\130\253iM\155\169\208\221o\196\SOH-\179"]}
TEST(Publish50QCTest, Encode93) {
  uint8_t pkt[] = {0x3d, 0x7b, 0x0,  0x11, 0x1a, 0xfa, 0x1c, 0x6a, 0x40, 0xef, 0x6e, 0x7f, 0x9,  0x9e, 0x3a, 0x84,
                   0xa5, 0xf9, 0x82, 0xe2, 0x4c, 0x0,  0x9f, 0x4e, 0x29, 0x42, 0x26, 0x0,  0x16, 0x84, 0xe8, 0x7f,
                   0xa1, 0xd2, 0x2f, 0xbb, 0x56, 0x32, 0xec, 0xd6, 0xf6, 0xdf, 0xe5, 0x31, 0xc3, 0xd4, 0xc1, 0xd,
                   0x85, 0xc7, 0x5f, 0x0,  0x1b, 0x8,  0xff, 0xbb, 0x15, 0x37, 0x7d, 0x53, 0x2,  0xc2, 0x62, 0xbe,
                   0xbb, 0xdf, 0xc9, 0x5,  0xa4, 0xd7, 0x46, 0x85, 0xb1, 0x88, 0x11, 0x14, 0x2c, 0x1e, 0xd5, 0x3c,
                   0xb,  0x10, 0x22, 0x2,  0x9f, 0x15, 0x0,  0xe,  0xbe, 0x82, 0xfd, 0x69, 0x4d, 0x9b, 0xa9, 0xd0,
                   0xdd, 0x6f, 0xc4, 0x1,  0x2d, 0xb3, 0x83, 0x8c, 0x8f, 0xac, 0x6f, 0x44, 0x36, 0xf,  0x53, 0xc4,
                   0x4f, 0x2e, 0x91, 0x8d, 0xa6, 0x4,  0xbc, 0x99, 0xfb, 0x55, 0x16, 0x4a, 0x54};

  uint8_t buf[135] = {0};

  uint8_t topic_bytes[] = {0x1a, 0xfa, 0x1c, 0x6a, 0x40, 0xef, 0x6e, 0x7f, 0x9,
                           0x9e, 0x3a, 0x84, 0xa5, 0xf9, 0x82, 0xe2, 0x4c};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x83, 0x8c, 0x8f, 0xac, 0x6f, 0x44, 0x36, 0xf,  0x53, 0xc4, 0x4f, 0x2e,
                         0x91, 0x8d, 0xa6, 0x4,  0xbc, 0x99, 0xfb, 0x55, 0x16, 0x4a, 0x54};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytes1[] = {0x8, 0xff, 0xbb, 0x15, 0x37, 0x7d, 0x53, 0x2,  0xc2, 0x62, 0xbe, 0xbb, 0xdf, 0xc9,
                      0x5, 0xa4, 0xd7, 0x46, 0x85, 0xb1, 0x88, 0x11, 0x14, 0x2c, 0x1e, 0xd5, 0x3c};
  uint8_t bytes0[] = {0x84, 0xe8, 0x7f, 0xa1, 0xd2, 0x2f, 0xbb, 0x56, 0x32, 0xec, 0xd6,
                      0xf6, 0xdf, 0xe5, 0x31, 0xc3, 0xd4, 0xc1, 0xd,  0x85, 0xc7, 0x5f};
  uint8_t bytes2[] = {0xbe, 0x82, 0xfd, 0x69, 0x4d, 0x9b, 0xa9, 0xd0, 0xdd, 0x6f, 0xc4, 0x1, 0x2d, 0xb3};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytes0}, .v = {27, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 671}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytes2}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 159, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192K\248\134\174}\198-\171\235\SUB\214]\204\&3\177\f", _pubPktID = 0, _pubBody =
// "%\131\215\218\147\225\ENQ\173Wh\129\234\197", _pubProps = [PropTopicAliasMaximum 15959,PropCorrelationData
// "\183\229\218\174\208|K\NAK\b\235",PropSharedSubscriptionAvailable 248,PropSubscriptionIdentifierAvailable
// 251,PropSubscriptionIdentifier 24,PropAuthenticationMethod "b\205\196\b$7\213Q\242
// \179\242]\154\177\163+_\n\153\177\152\132\182\237\141",PropMaximumQoS 85,PropSharedSubscriptionAvailable
// 59,PropServerKeepAlive 25781,PropAuthenticationMethod
// "\198\140+,\192\191g\215\198\&0\135f\234\RS\DEL\DC3X\253\"\254vq\235U\133\136co\146",PropReasonString
// "\204\FSb\221\176\140jj\196\EM\DC2",PropPayloadFormatIndicator 185,PropTopicAliasMaximum
// 30828,PropSubscriptionIdentifierAvailable 0,PropSessionExpiryInterval 22607,PropSharedSubscriptionAvailable
// 176,PropReasonString "\132\132\249\SI{\190\157\241\rZI\205\195.\130^",PropRetainAvailable 81,PropWillDelayInterval
// 8848]}
TEST(Publish50QCTest, Encode94) {
  uint8_t pkt[] = {0x38, 0xb2, 0x1,  0x0,  0x11, 0xc0, 0x4b, 0xf8, 0x86, 0xae, 0x7d, 0xc6, 0x2d, 0xab, 0xeb, 0x1a, 0xd6,
                   0x5d, 0xcc, 0x33, 0xb1, 0xc,  0x90, 0x1,  0x22, 0x3e, 0x57, 0x9,  0x0,  0xa,  0xb7, 0xe5, 0xda, 0xae,
                   0xd0, 0x7c, 0x4b, 0x15, 0x8,  0xeb, 0x2a, 0xf8, 0x29, 0xfb, 0xb,  0x18, 0x15, 0x0,  0x1a, 0x62, 0xcd,
                   0xc4, 0x8,  0x24, 0x37, 0xd5, 0x51, 0xf2, 0x20, 0xb3, 0xf2, 0x5d, 0x9a, 0xb1, 0xa3, 0x2b, 0x5f, 0xa,
                   0x99, 0xb1, 0x98, 0x84, 0xb6, 0xed, 0x8d, 0x24, 0x55, 0x2a, 0x3b, 0x13, 0x64, 0xb5, 0x15, 0x0,  0x1d,
                   0xc6, 0x8c, 0x2b, 0x2c, 0xc0, 0xbf, 0x67, 0xd7, 0xc6, 0x30, 0x87, 0x66, 0xea, 0x1e, 0x7f, 0x13, 0x58,
                   0xfd, 0x22, 0xfe, 0x76, 0x71, 0xeb, 0x55, 0x85, 0x88, 0x63, 0x6f, 0x92, 0x1f, 0x0,  0xb,  0xcc, 0x1c,
                   0x62, 0xdd, 0xb0, 0x8c, 0x6a, 0x6a, 0xc4, 0x19, 0x12, 0x1,  0xb9, 0x22, 0x78, 0x6c, 0x29, 0x0,  0x11,
                   0x0,  0x0,  0x58, 0x4f, 0x2a, 0xb0, 0x1f, 0x0,  0x10, 0x84, 0x84, 0xf9, 0xf,  0x7b, 0xbe, 0x9d, 0xf1,
                   0xd,  0x5a, 0x49, 0xcd, 0xc3, 0x2e, 0x82, 0x5e, 0x25, 0x51, 0x18, 0x0,  0x0,  0x22, 0x90, 0x25, 0x83,
                   0xd7, 0xda, 0x93, 0xe1, 0x5,  0xad, 0x57, 0x68, 0x81, 0xea, 0xc5};

  uint8_t buf[191] = {0};

  uint8_t topic_bytes[] = {0xc0, 0x4b, 0xf8, 0x86, 0xae, 0x7d, 0xc6, 0x2d, 0xab,
                           0xeb, 0x1a, 0xd6, 0x5d, 0xcc, 0x33, 0xb1, 0xc};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x25, 0x83, 0xd7, 0xda, 0x93, 0xe1, 0x5, 0xad, 0x57, 0x68, 0x81, 0xea, 0xc5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytes0[] = {0xb7, 0xe5, 0xda, 0xae, 0xd0, 0x7c, 0x4b, 0x15, 0x8, 0xeb};
  uint8_t bytes1[] = {0x62, 0xcd, 0xc4, 0x8,  0x24, 0x37, 0xd5, 0x51, 0xf2, 0x20, 0xb3, 0xf2, 0x5d,
                      0x9a, 0xb1, 0xa3, 0x2b, 0x5f, 0xa,  0x99, 0xb1, 0x98, 0x84, 0xb6, 0xed, 0x8d};
  uint8_t bytes2[] = {0xc6, 0x8c, 0x2b, 0x2c, 0xc0, 0xbf, 0x67, 0xd7, 0xc6, 0x30, 0x87, 0x66, 0xea, 0x1e, 0x7f,
                      0x13, 0x58, 0xfd, 0x22, 0xfe, 0x76, 0x71, 0xeb, 0x55, 0x85, 0x88, 0x63, 0x6f, 0x92};
  uint8_t bytes3[] = {0xcc, 0x1c, 0x62, 0xdd, 0xb0, 0x8c, 0x6a, 0x6a, 0xc4, 0x19, 0x12};
  uint8_t bytes4[] = {0x84, 0x84, 0xf9, 0xf, 0x7b, 0xbe, 0x9d, 0xf1, 0xd, 0x5a, 0x49, 0xcd, 0xc3, 0x2e, 0x82, 0x5e};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15959}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25781}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30828}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22607}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8848}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\161&K\GSu\164\DC1W\156\205\DC2e\US\253\SUB\212\GS\146u", _pubPktID = 4938, _pubBody =
// "\197\210\201\164\236`\GSJjyh\252c\GS\185\190\150xY\239>\220\165.", _pubProps = [PropUserProperty
// "\168=bnK\172\191t`\165\224\186\165"
// "\184r\211Q.9\174\239\243g\SYN\143\242\138\167\r\253LvD)\212\173:~\249\239w",PropSharedSubscriptionAvailable
// 159,PropMessageExpiryInterval 23375,PropPayloadFormatIndicator 235,PropResponseInformation "+\193=])\213+\RSj\226"]}
TEST(Publish50QCTest, Encode95) {
  uint8_t pkt[] = {0x3a, 0x74, 0x0,  0x13, 0xa1, 0x26, 0x4b, 0x1d, 0x75, 0xa4, 0x11, 0x57, 0x9c, 0xcd, 0x12, 0x65, 0x1f,
                   0xfd, 0x1a, 0xd4, 0x1d, 0x92, 0x75, 0x13, 0x4a, 0x44, 0x26, 0x0,  0xd,  0xa8, 0x3d, 0x62, 0x6e, 0x4b,
                   0xac, 0xbf, 0x74, 0x60, 0xa5, 0xe0, 0xba, 0xa5, 0x0,  0x1c, 0xb8, 0x72, 0xd3, 0x51, 0x2e, 0x39, 0xae,
                   0xef, 0xf3, 0x67, 0x16, 0x8f, 0xf2, 0x8a, 0xa7, 0xd,  0xfd, 0x4c, 0x76, 0x44, 0x29, 0xd4, 0xad, 0x3a,
                   0x7e, 0xf9, 0xef, 0x77, 0x2a, 0x9f, 0x2,  0x0,  0x0,  0x5b, 0x4f, 0x1,  0xeb, 0x1a, 0x0,  0xa,  0x2b,
                   0xc1, 0x3d, 0x5d, 0x29, 0xd5, 0x2b, 0x1e, 0x6a, 0xe2, 0xc5, 0xd2, 0xc9, 0xa4, 0xec, 0x60, 0x1d, 0x4a,
                   0x6a, 0x79, 0x68, 0xfc, 0x63, 0x1d, 0xb9, 0xbe, 0x96, 0x78, 0x59, 0xef, 0x3e, 0xdc, 0xa5, 0x2e};

  uint8_t buf[128] = {0};

  uint8_t topic_bytes[] = {0xa1, 0x26, 0x4b, 0x1d, 0x75, 0xa4, 0x11, 0x57, 0x9c, 0xcd,
                           0x12, 0x65, 0x1f, 0xfd, 0x1a, 0xd4, 0x1d, 0x92, 0x75};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0xd2, 0xc9, 0xa4, 0xec, 0x60, 0x1d, 0x4a, 0x6a, 0x79, 0x68, 0xfc,
                         0x63, 0x1d, 0xb9, 0xbe, 0x96, 0x78, 0x59, 0xef, 0x3e, 0xdc, 0xa5, 0x2e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytes1[] = {0xb8, 0x72, 0xd3, 0x51, 0x2e, 0x39, 0xae, 0xef, 0xf3, 0x67, 0x16, 0x8f, 0xf2, 0x8a,
                      0xa7, 0xd,  0xfd, 0x4c, 0x76, 0x44, 0x29, 0xd4, 0xad, 0x3a, 0x7e, 0xf9, 0xef, 0x77};
  uint8_t bytes0[] = {0xa8, 0x3d, 0x62, 0x6e, 0x4b, 0xac, 0xbf, 0x74, 0x60, 0xa5, 0xe0, 0xba, 0xa5};
  uint8_t bytes2[] = {0x2b, 0xc1, 0x3d, 0x5d, 0x29, 0xd5, 0x2b, 0x1e, 0x6a, 0xe2};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytes0}, .v = {28, (char*)&bytes1}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23375}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytes2}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 4938, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\149\203\181S\"+\168\160\141\DEL~e8\150\193\SYN\t1", _pubPktID = 0, _pubBody = "m#Za\252\192\201Y\NAK\221",
// _pubProps = [PropAuthenticationMethod "\239\NAK Ne\152\241\151\247rn\164\185\146\&1u
// m\132\171O",PropWildcardSubscriptionAvailable 249,PropServerKeepAlive 18975]}
TEST(Publish50QCTest, Encode96) {
  uint8_t pkt[] = {0x38, 0x3c, 0x0,  0x12, 0x95, 0xcb, 0xb5, 0x53, 0x22, 0x2b, 0xa8, 0xa0, 0x8d, 0x7f, 0x7e, 0x65,
                   0x38, 0x96, 0xc1, 0x16, 0x9,  0x31, 0x1d, 0x15, 0x0,  0x15, 0xef, 0x15, 0x20, 0x4e, 0x65, 0x98,
                   0xf1, 0x97, 0xf7, 0x72, 0x6e, 0xa4, 0xb9, 0x92, 0x31, 0x75, 0x20, 0x6d, 0x84, 0xab, 0x4f, 0x28,
                   0xf9, 0x13, 0x4a, 0x1f, 0x6d, 0x23, 0x5a, 0x61, 0xfc, 0xc0, 0xc9, 0x59, 0x15, 0xdd};

  uint8_t buf[72] = {0};

  uint8_t topic_bytes[] = {0x95, 0xcb, 0xb5, 0x53, 0x22, 0x2b, 0xa8, 0xa0, 0x8d,
                           0x7f, 0x7e, 0x65, 0x38, 0x96, 0xc1, 0x16, 0x9,  0x31};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6d, 0x23, 0x5a, 0x61, 0xfc, 0xc0, 0xc9, 0x59, 0x15, 0xdd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytes0[] = {0xef, 0x15, 0x20, 0x4e, 0x65, 0x98, 0xf1, 0x97, 0xf7, 0x72, 0x6e,
                      0xa4, 0xb9, 0x92, 0x31, 0x75, 0x20, 0x6d, 0x84, 0xab, 0x4f};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18975}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\254\DLE\200m\251\190\157\139\&9=\175\219\238~:ap/{\148", _pubPktID = 0, _pubBody = "\163~rt", _pubProps =
// [PropReasonString "\vi\205g&\ENQ\169\&0X\187\&6\214~\131\185\EOT\DLE\140G\203.A\NUL\160\165\FS
// ZkV",PropCorrelationData "\STX",PropSessionExpiryInterval 9141,PropTopicAlias 2629,PropAssignedClientIdentifier
// "\172M)%\189\217zZ\194dR+\177\\Pl\212\201vL\DELs\242\182q",PropMaximumPacketSize 13928,PropMessageExpiryInterval
// 7205,PropRetainAvailable 115,PropReasonString
// "\CAN\180\ETXG~\197N\246%\202\178H\244\r\STXA\241re\225`%s\214l",PropWillDelayInterval
// 319,PropAssignedClientIdentifier "G\221\200e\243\191\v=\221C\177\b\241\227\139\157\213\&4H\187PH\235\222\DLE\ACK
// ",PropServerKeepAlive 3982,PropAuthenticationData
// "\246:\252\141\t\DC2\129p\254{\248\188\255\ESC)}\152\143\245",PropMaximumQoS 212,PropMaximumPacketSize
// 7512,PropCorrelationData "1\238\145\190\242\&3\174\\E\FS\144",PropReasonString
// "p\163{\STXc\219\223O\252\GS\242@|ujA\EOT\179\&7.",PropMessageExpiryInterval 27783,PropMessageExpiryInterval
// 17888,PropUserProperty "\204j\240k\180\&3\197\178\191\&3\137\193\216 \134~,\137k.Rt\129\205p4\249\244\226\241"
// "J\250\201\156*pD\156\248Q\212\212\165\245bf6\140\179\RS\ETB\202\136\238\249\&4^c#",PropTopicAlias
// 8403,PropReceiveMaximum 32198,PropSharedSubscriptionAvailable 103,PropUserProperty "\t'qd1#\255\248\160."
// "\215g\DC2\254\160F\247d\153\130\EM\EOT\\\163\236\189\148\US\154$\150\211\bQ\202\DC1",PropMessageExpiryInterval
// 1577,PropResponseInformation
// "\SUB\252\168\174\204\218\&2\233X\DC3\223,\195\ENQ9\n\DC1\152\239\RS\EM3\250\&6\by[\225\235\152",PropUserProperty
// "r\163\213\CAN\b3\197\201\CAN\DC1\194\211\211\201" "\225~",PropPayloadFormatIndicator 240,PropPayloadFormatIndicator
// 61]}
TEST(Publish50QCTest, Encode97) {
  uint8_t pkt[] = {
      0x38, 0xaf, 0x3,  0x0,  0x14, 0xfe, 0x10, 0xc8, 0x6d, 0xfb, 0xbe, 0x9d, 0x8b, 0x39, 0x3d, 0xaf, 0xdb, 0xee, 0x7e,
      0x3a, 0x61, 0x70, 0x2f, 0x7b, 0x94, 0x93, 0x3,  0x1f, 0x0,  0x1e, 0xb,  0x69, 0xcd, 0x67, 0x26, 0x5,  0xa9, 0x30,
      0x58, 0xbb, 0x36, 0xd6, 0x7e, 0x83, 0xb9, 0x4,  0x10, 0x8c, 0x47, 0xcb, 0x2e, 0x41, 0x0,  0xa0, 0xa5, 0x1c, 0x20,
      0x5a, 0x6b, 0x56, 0x9,  0x0,  0x1,  0x2,  0x11, 0x0,  0x0,  0x23, 0xb5, 0x23, 0xa,  0x45, 0x12, 0x0,  0x19, 0xac,
      0x4d, 0x29, 0x25, 0xbd, 0xd9, 0x7a, 0x5a, 0xc2, 0x64, 0x52, 0x2b, 0xb1, 0x5c, 0x50, 0x6c, 0xd4, 0xc9, 0x76, 0x4c,
      0x7f, 0x73, 0xf2, 0xb6, 0x71, 0x27, 0x0,  0x0,  0x36, 0x68, 0x2,  0x0,  0x0,  0x1c, 0x25, 0x25, 0x73, 0x1f, 0x0,
      0x19, 0x18, 0xb4, 0x3,  0x47, 0x7e, 0xc5, 0x4e, 0xf6, 0x25, 0xca, 0xb2, 0x48, 0xf4, 0xd,  0x2,  0x41, 0xf1, 0x72,
      0x65, 0xe1, 0x60, 0x25, 0x73, 0xd6, 0x6c, 0x18, 0x0,  0x0,  0x1,  0x3f, 0x12, 0x0,  0x1b, 0x47, 0xdd, 0xc8, 0x65,
      0xf3, 0xbf, 0xb,  0x3d, 0xdd, 0x43, 0xb1, 0x8,  0xf1, 0xe3, 0x8b, 0x9d, 0xd5, 0x34, 0x48, 0xbb, 0x50, 0x48, 0xeb,
      0xde, 0x10, 0x6,  0x20, 0x13, 0xf,  0x8e, 0x16, 0x0,  0x13, 0xf6, 0x3a, 0xfc, 0x8d, 0x9,  0x12, 0x81, 0x70, 0xfe,
      0x7b, 0xf8, 0xbc, 0xff, 0x1b, 0x29, 0x7d, 0x98, 0x8f, 0xf5, 0x24, 0xd4, 0x27, 0x0,  0x0,  0x1d, 0x58, 0x9,  0x0,
      0xb,  0x31, 0xee, 0x91, 0xbe, 0xf2, 0x33, 0xae, 0x5c, 0x45, 0x1c, 0x90, 0x1f, 0x0,  0x14, 0x70, 0xa3, 0x7b, 0x2,
      0x63, 0xdb, 0xdf, 0x4f, 0xfc, 0x1d, 0xf2, 0x40, 0x7c, 0x75, 0x6a, 0x41, 0x4,  0xb3, 0x37, 0x2e, 0x2,  0x0,  0x0,
      0x6c, 0x87, 0x2,  0x0,  0x0,  0x45, 0xe0, 0x26, 0x0,  0x1e, 0xcc, 0x6a, 0xf0, 0x6b, 0xb4, 0x33, 0xc5, 0xb2, 0xbf,
      0x33, 0x89, 0xc1, 0xd8, 0x20, 0x86, 0x7e, 0x2c, 0x89, 0x6b, 0x2e, 0x52, 0x74, 0x81, 0xcd, 0x70, 0x34, 0xf9, 0xf4,
      0xe2, 0xf1, 0x0,  0x1d, 0x4a, 0xfa, 0xc9, 0x9c, 0x2a, 0x70, 0x44, 0x9c, 0xf8, 0x51, 0xd4, 0xd4, 0xa5, 0xf5, 0x62,
      0x66, 0x36, 0x8c, 0xb3, 0x1e, 0x17, 0xca, 0x88, 0xee, 0xf9, 0x34, 0x5e, 0x63, 0x23, 0x23, 0x20, 0xd3, 0x21, 0x7d,
      0xc6, 0x2a, 0x67, 0x26, 0x0,  0xa,  0x9,  0x27, 0x71, 0x64, 0x31, 0x23, 0xff, 0xf8, 0xa0, 0x2e, 0x0,  0x1a, 0xd7,
      0x67, 0x12, 0xfe, 0xa0, 0x46, 0xf7, 0x64, 0x99, 0x82, 0x19, 0x4,  0x5c, 0xa3, 0xec, 0xbd, 0x94, 0x1f, 0x9a, 0x24,
      0x96, 0xd3, 0x8,  0x51, 0xca, 0x11, 0x2,  0x0,  0x0,  0x6,  0x29, 0x1a, 0x0,  0x1e, 0x1a, 0xfc, 0xa8, 0xae, 0xcc,
      0xda, 0x32, 0xe9, 0x58, 0x13, 0xdf, 0x2c, 0xc3, 0x5,  0x39, 0xa,  0x11, 0x98, 0xef, 0x1e, 0x19, 0x33, 0xfa, 0x36,
      0x8,  0x79, 0x5b, 0xe1, 0xeb, 0x98, 0x26, 0x0,  0xe,  0x72, 0xa3, 0xd5, 0x18, 0x8,  0x33, 0xc5, 0xc9, 0x18, 0x11,
      0xc2, 0xd3, 0xd3, 0xc9, 0x0,  0x2,  0xe1, 0x7e, 0x1,  0xf0, 0x1,  0x3d, 0xa3, 0x7e, 0x72, 0x74};

  uint8_t buf[444] = {0};

  uint8_t topic_bytes[] = {0xfe, 0x10, 0xc8, 0x6d, 0xfb, 0xbe, 0x9d, 0x8b, 0x39, 0x3d,
                           0xaf, 0xdb, 0xee, 0x7e, 0x3a, 0x61, 0x70, 0x2f, 0x7b, 0x94};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa3, 0x7e, 0x72, 0x74};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytes0[] = {0xb, 0x69, 0xcd, 0x67, 0x26, 0x5,  0xa9, 0x30, 0x58, 0xbb, 0x36, 0xd6, 0x7e, 0x83, 0xb9,
                      0x4, 0x10, 0x8c, 0x47, 0xcb, 0x2e, 0x41, 0x0,  0xa0, 0xa5, 0x1c, 0x20, 0x5a, 0x6b, 0x56};
  uint8_t bytes1[] = {0x2};
  uint8_t bytes2[] = {0xac, 0x4d, 0x29, 0x25, 0xbd, 0xd9, 0x7a, 0x5a, 0xc2, 0x64, 0x52, 0x2b, 0xb1,
                      0x5c, 0x50, 0x6c, 0xd4, 0xc9, 0x76, 0x4c, 0x7f, 0x73, 0xf2, 0xb6, 0x71};
  uint8_t bytes3[] = {0x18, 0xb4, 0x3,  0x47, 0x7e, 0xc5, 0x4e, 0xf6, 0x25, 0xca, 0xb2, 0x48, 0xf4,
                      0xd,  0x2,  0x41, 0xf1, 0x72, 0x65, 0xe1, 0x60, 0x25, 0x73, 0xd6, 0x6c};
  uint8_t bytes4[] = {0x47, 0xdd, 0xc8, 0x65, 0xf3, 0xbf, 0xb,  0x3d, 0xdd, 0x43, 0xb1, 0x8, 0xf1, 0xe3,
                      0x8b, 0x9d, 0xd5, 0x34, 0x48, 0xbb, 0x50, 0x48, 0xeb, 0xde, 0x10, 0x6, 0x20};
  uint8_t bytes5[] = {0xf6, 0x3a, 0xfc, 0x8d, 0x9,  0x12, 0x81, 0x70, 0xfe, 0x7b,
                      0xf8, 0xbc, 0xff, 0x1b, 0x29, 0x7d, 0x98, 0x8f, 0xf5};
  uint8_t bytes6[] = {0x31, 0xee, 0x91, 0xbe, 0xf2, 0x33, 0xae, 0x5c, 0x45, 0x1c, 0x90};
  uint8_t bytes7[] = {0x70, 0xa3, 0x7b, 0x2,  0x63, 0xdb, 0xdf, 0x4f, 0xfc, 0x1d,
                      0xf2, 0x40, 0x7c, 0x75, 0x6a, 0x41, 0x4,  0xb3, 0x37, 0x2e};
  uint8_t bytes9[] = {0x4a, 0xfa, 0xc9, 0x9c, 0x2a, 0x70, 0x44, 0x9c, 0xf8, 0x51, 0xd4, 0xd4, 0xa5, 0xf5, 0x62,
                      0x66, 0x36, 0x8c, 0xb3, 0x1e, 0x17, 0xca, 0x88, 0xee, 0xf9, 0x34, 0x5e, 0x63, 0x23};
  uint8_t bytes8[] = {0xcc, 0x6a, 0xf0, 0x6b, 0xb4, 0x33, 0xc5, 0xb2, 0xbf, 0x33, 0x89, 0xc1, 0xd8, 0x20, 0x86,
                      0x7e, 0x2c, 0x89, 0x6b, 0x2e, 0x52, 0x74, 0x81, 0xcd, 0x70, 0x34, 0xf9, 0xf4, 0xe2, 0xf1};
  uint8_t bytes11[] = {0xd7, 0x67, 0x12, 0xfe, 0xa0, 0x46, 0xf7, 0x64, 0x99, 0x82, 0x19, 0x4,  0x5c,
                       0xa3, 0xec, 0xbd, 0x94, 0x1f, 0x9a, 0x24, 0x96, 0xd3, 0x8,  0x51, 0xca, 0x11};
  uint8_t bytes10[] = {0x9, 0x27, 0x71, 0x64, 0x31, 0x23, 0xff, 0xf8, 0xa0, 0x2e};
  uint8_t bytes12[] = {0x1a, 0xfc, 0xa8, 0xae, 0xcc, 0xda, 0x32, 0xe9, 0x58, 0x13, 0xdf, 0x2c, 0xc3, 0x5,  0x39,
                       0xa,  0x11, 0x98, 0xef, 0x1e, 0x19, 0x33, 0xfa, 0x36, 0x8,  0x79, 0x5b, 0xe1, 0xeb, 0x98};
  uint8_t bytes14[] = {0xe1, 0x7e};
  uint8_t bytes13[] = {0x72, 0xa3, 0xd5, 0x18, 0x8, 0x33, 0xc5, 0xc9, 0x18, 0x11, 0xc2, 0xd3, 0xd3, 0xc9};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9141}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2629}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13928}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7205}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 319}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3982}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7512}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytes7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27783}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17888}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytes8}, .v = {29, (char*)&bytes9}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8403}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32198}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytes10}, .v = {26, (char*)&bytes11}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1577}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytes12}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytes13}, .v = {2, (char*)&bytes14}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 61}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\253a\DC4gD\189tvCr\177\&0w\132",
// _pubPktID = 26, _pubBody = "\188\SOx\169\171\214_\225\142.\SIW\SO\149\GS\184M\199\137\174\128cS\187OBD\139\218",
// _pubProps = [PropAuthenticationData "\226\204/{?\249a\ro\SUB\DEL\SO",PropRetainAvailable 219,PropResponseTopic
// "\234\222\203\USD\DC1N\154B\SOHg\155\148\154\SYN\136\164\b#",PropCorrelationData
// "6\181\218\186\233`7IK\158\241P\191\157^\196\242&\178\ACK\RS\246\r\241h\189b\211",PropResponseInformation
// "Q|\255J\246:",PropMaximumPacketSize 32759,PropTopicAliasMaximum 7804,PropServerReference
// "\178\&2]^r\252qQ",PropPayloadFormatIndicator 84,PropServerReference
// "\216B\204\195\251\NAK\ETBE\179",PropSubscriptionIdentifier 19,PropServerKeepAlive
// 27535,PropWildcardSubscriptionAvailable 84,PropTopicAlias 29554,PropResponseTopic
// "\183\170\178\171",PropMessageExpiryInterval 6362,PropTopicAlias 5792,PropSubscriptionIdentifierAvailable 252]}
TEST(Publish50QCTest, Encode98) {
  uint8_t pkt[] = {0x3a, 0xbc, 0x1,  0x0,  0xe,  0xfd, 0x61, 0x14, 0x67, 0x44, 0xbd, 0x74, 0x76, 0x43, 0x72, 0xb1,
                   0x30, 0x77, 0x84, 0x0,  0x1a, 0x8b, 0x1,  0x16, 0x0,  0xc,  0xe2, 0xcc, 0x2f, 0x7b, 0x3f, 0xf9,
                   0x61, 0xd,  0x6f, 0x1a, 0x7f, 0xe,  0x25, 0xdb, 0x8,  0x0,  0x13, 0xea, 0xde, 0xcb, 0x1f, 0x44,
                   0x11, 0x4e, 0x9a, 0x42, 0x1,  0x67, 0x9b, 0x94, 0x9a, 0x16, 0x88, 0xa4, 0x8,  0x23, 0x9,  0x0,
                   0x1c, 0x36, 0xb5, 0xda, 0xba, 0xe9, 0x60, 0x37, 0x49, 0x4b, 0x9e, 0xf1, 0x50, 0xbf, 0x9d, 0x5e,
                   0xc4, 0xf2, 0x26, 0xb2, 0x6,  0x1e, 0xf6, 0xd,  0xf1, 0x68, 0xbd, 0x62, 0xd3, 0x1a, 0x0,  0x6,
                   0x51, 0x7c, 0xff, 0x4a, 0xf6, 0x3a, 0x27, 0x0,  0x0,  0x7f, 0xf7, 0x22, 0x1e, 0x7c, 0x1c, 0x0,
                   0x8,  0xb2, 0x32, 0x5d, 0x5e, 0x72, 0xfc, 0x71, 0x51, 0x1,  0x54, 0x1c, 0x0,  0x9,  0xd8, 0x42,
                   0xcc, 0xc3, 0xfb, 0x15, 0x17, 0x45, 0xb3, 0xb,  0x13, 0x13, 0x6b, 0x8f, 0x28, 0x54, 0x23, 0x73,
                   0x72, 0x8,  0x0,  0x4,  0xb7, 0xaa, 0xb2, 0xab, 0x2,  0x0,  0x0,  0x18, 0xda, 0x23, 0x16, 0xa0,
                   0x29, 0xfc, 0xbc, 0xe,  0x78, 0xa9, 0xab, 0xd6, 0x5f, 0xe1, 0x8e, 0x2e, 0xf,  0x57, 0xe,  0x95,
                   0x1d, 0xb8, 0x4d, 0xc7, 0x89, 0xae, 0x80, 0x63, 0x53, 0xbb, 0x4f, 0x42, 0x44, 0x8b, 0xda};

  uint8_t buf[201] = {0};

  uint8_t topic_bytes[] = {0xfd, 0x61, 0x14, 0x67, 0x44, 0xbd, 0x74, 0x76, 0x43, 0x72, 0xb1, 0x30, 0x77, 0x84};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbc, 0xe,  0x78, 0xa9, 0xab, 0xd6, 0x5f, 0xe1, 0x8e, 0x2e, 0xf,  0x57, 0xe,  0x95, 0x1d,
                         0xb8, 0x4d, 0xc7, 0x89, 0xae, 0x80, 0x63, 0x53, 0xbb, 0x4f, 0x42, 0x44, 0x8b, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytes0[] = {0xe2, 0xcc, 0x2f, 0x7b, 0x3f, 0xf9, 0x61, 0xd, 0x6f, 0x1a, 0x7f, 0xe};
  uint8_t bytes1[] = {0xea, 0xde, 0xcb, 0x1f, 0x44, 0x11, 0x4e, 0x9a, 0x42, 0x1,
                      0x67, 0x9b, 0x94, 0x9a, 0x16, 0x88, 0xa4, 0x8,  0x23};
  uint8_t bytes2[] = {0x36, 0xb5, 0xda, 0xba, 0xe9, 0x60, 0x37, 0x49, 0x4b, 0x9e, 0xf1, 0x50, 0xbf, 0x9d,
                      0x5e, 0xc4, 0xf2, 0x26, 0xb2, 0x6,  0x1e, 0xf6, 0xd,  0xf1, 0x68, 0xbd, 0x62, 0xd3};
  uint8_t bytes3[] = {0x51, 0x7c, 0xff, 0x4a, 0xf6, 0x3a};
  uint8_t bytes4[] = {0xb2, 0x32, 0x5d, 0x5e, 0x72, 0xfc, 0x71, 0x51};
  uint8_t bytes5[] = {0xd8, 0x42, 0xcc, 0xc3, 0xfb, 0x15, 0x17, 0x45, 0xb3};
  uint8_t bytes6[] = {0xb7, 0xaa, 0xb2, 0xab};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytes2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytes3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32759}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7804}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytes4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytes5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27535}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29554}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytes6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6362}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5792}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 252}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 26, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\251\169\245\241\201;\SOH\174B\v\STX\SOH\202\137\ETX\139y\235\139\&8~b&\235", _pubPktID = 0, _pubBody =
// "O\222\143\SO\DC2\DC2\180\DC3\242\226I\151\ACKv\247\150\v\DC4\228", _pubProps = [PropMaximumQoS 201]}
TEST(Publish50QCTest, Encode99) {
  uint8_t pkt[] = {0x39, 0x30, 0x0,  0x18, 0xfb, 0xa9, 0xf5, 0xf1, 0xc9, 0x3b, 0x1,  0xae, 0x42, 0xb,  0x2,  0x1,  0xca,
                   0x89, 0x3,  0x8b, 0x79, 0xeb, 0x8b, 0x38, 0x7e, 0x62, 0x26, 0xeb, 0x2,  0x24, 0xc9, 0x4f, 0xde, 0x8f,
                   0xe,  0x12, 0x12, 0xb4, 0x13, 0xf2, 0xe2, 0x49, 0x97, 0x6,  0x76, 0xf7, 0x96, 0xb,  0x14, 0xe4};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0xfb, 0xa9, 0xf5, 0xf1, 0xc9, 0x3b, 0x1,  0xae, 0x42, 0xb,  0x2,  0x1,
                           0xca, 0x89, 0x3,  0x8b, 0x79, 0xeb, 0x8b, 0x38, 0x7e, 0x62, 0x26, 0xeb};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0xde, 0x8f, 0xe,  0x12, 0x12, 0xb4, 0x13, 0xf2, 0xe2,
                         0x49, 0x97, 0x6,  0x76, 0xf7, 0x96, 0xb,  0x14, 0xe4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 201}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\130\195\DC3\129^;\DC2\222\159\233g\190\156\&9\DC2\149t\138<\191|", _pubPktID = 0, _pubBody =
// "\145m\248\188\208:\172\v\129\EOT\158\139\132\192yQ\206S\252\152\ETBQrEx\t\ENQ^\235\139", _pubProps =
// [PropServerReference "\168\163\168\138\bJ+*K|I\236\ESC\EOTQ{\129\141\217Oqj\184\219",PropRequestResponseInformation
// 17,PropRequestProblemInformation 13,PropTopicAlias 11748,PropContentType
// "\220\183\162\rn\131\195\155",PropMessageExpiryInterval 13181,PropWillDelayInterval 21300,PropCorrelationData
// "\130S\"\217G\SI\SYN\GS\188&n\184\194,\163\190Tx\159\141\218e\216\222\RS"]}
TEST(Publish50QCTest, Encode100) {
  uint8_t pkt[] = {0x30, 0x89, 0x1,  0x0,  0x15, 0x82, 0xc3, 0x13, 0x81, 0x5e, 0x3b, 0x12, 0xde, 0x9f, 0xe9, 0x67,
                   0xbe, 0x9c, 0x39, 0x12, 0x95, 0x74, 0x8a, 0x3c, 0xbf, 0x7c, 0x53, 0x1c, 0x0,  0x18, 0xa8, 0xa3,
                   0xa8, 0x8a, 0x8,  0x4a, 0x2b, 0x2a, 0x4b, 0x7c, 0x49, 0xec, 0x1b, 0x4,  0x51, 0x7b, 0x81, 0x8d,
                   0xd9, 0x4f, 0x71, 0x6a, 0xb8, 0xdb, 0x19, 0x11, 0x17, 0xd,  0x23, 0x2d, 0xe4, 0x3,  0x0,  0x8,
                   0xdc, 0xb7, 0xa2, 0xd,  0x6e, 0x83, 0xc3, 0x9b, 0x2,  0x0,  0x0,  0x33, 0x7d, 0x18, 0x0,  0x0,
                   0x53, 0x34, 0x9,  0x0,  0x19, 0x82, 0x53, 0x22, 0xd9, 0x47, 0xf,  0x16, 0x1d, 0xbc, 0x26, 0x6e,
                   0xb8, 0xc2, 0x2c, 0xa3, 0xbe, 0x54, 0x78, 0x9f, 0x8d, 0xda, 0x65, 0xd8, 0xde, 0x1e, 0x91, 0x6d,
                   0xf8, 0xbc, 0xd0, 0x3a, 0xac, 0xb,  0x81, 0x4,  0x9e, 0x8b, 0x84, 0xc0, 0x79, 0x51, 0xce, 0x53,
                   0xfc, 0x98, 0x17, 0x51, 0x72, 0x45, 0x78, 0x9,  0x5,  0x5e, 0xeb, 0x8b};

  uint8_t buf[150] = {0};

  uint8_t topic_bytes[] = {0x82, 0xc3, 0x13, 0x81, 0x5e, 0x3b, 0x12, 0xde, 0x9f, 0xe9, 0x67,
                           0xbe, 0x9c, 0x39, 0x12, 0x95, 0x74, 0x8a, 0x3c, 0xbf, 0x7c};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x91, 0x6d, 0xf8, 0xbc, 0xd0, 0x3a, 0xac, 0xb,  0x81, 0x4,  0x9e, 0x8b, 0x84, 0xc0, 0x79,
                         0x51, 0xce, 0x53, 0xfc, 0x98, 0x17, 0x51, 0x72, 0x45, 0x78, 0x9,  0x5,  0x5e, 0xeb, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytes0[] = {0xa8, 0xa3, 0xa8, 0x8a, 0x8,  0x4a, 0x2b, 0x2a, 0x4b, 0x7c, 0x49, 0xec,
                      0x1b, 0x4,  0x51, 0x7b, 0x81, 0x8d, 0xd9, 0x4f, 0x71, 0x6a, 0xb8, 0xdb};
  uint8_t bytes1[] = {0xdc, 0xb7, 0xa2, 0xd, 0x6e, 0x83, 0xc3, 0x9b};
  uint8_t bytes2[] = {0x82, 0x53, 0x22, 0xd9, 0x47, 0xf,  0x16, 0x1d, 0xbc, 0x26, 0x6e, 0xb8, 0xc2,
                      0x2c, 0xa3, 0xbe, 0x54, 0x78, 0x9f, 0x8d, 0xda, 0x65, 0xd8, 0xde, 0x1e};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytes0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11748}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytes1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13181}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21300}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytes2}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "surgemq", _pubPktID = 0, _pubBody =
// "send me home", _pubProps = [PropMessageExpiryInterval 33,PropReasonString "a reason"]}
TEST(Publish50QCTest, Encode0) {
  uint8_t pkt[] = {0x33, 0x28, 0x0,  0x7,  0x73, 0x75, 0x72, 0x67, 0x65, 0x6d, 0x71, 0x0,  0x0,  0x10,
                   0x2,  0x0,  0x0,  0x0,  0x21, 0x1f, 0x0,  0x8,  0x61, 0x20, 0x72, 0x65, 0x61, 0x73,
                   0x6f, 0x6e, 0x73, 0x65, 0x6e, 0x64, 0x20, 0x6d, 0x65, 0x20, 0x68, 0x6f, 0x6d, 0x65};

  uint8_t buf[52] = {0};

  uint8_t topic_bytes[] = {0x73, 0x75, 0x72, 0x67, 0x65, 0x6d, 0x71};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x73, 0x65, 0x6e, 0x64, 0x20, 0x6d, 0x65, 0x20, 0x68, 0x6f, 0x6d, 0x65};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytes0[] = {0x61, 0x20, 0x72, 0x65, 0x61, 0x73, 0x6f, 0x6e};

  lwmqtt_property_t proplist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 33}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytes0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&proplist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
