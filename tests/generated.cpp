#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225w\176\tH\164\231\182-s\240\201\201&@\253\162=", _pubPktID = 25394, _pubBody =
// "\185\216^\ACKI\148P\180>Z9\192\251\254\US\222C\159,\ACK\FS9\205\218@,o", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3a, 0x31, 0x0,  0x12, 0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                   0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d, 0x63, 0x32, 0xb9, 0xd8,
                   0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe, 0x1f,
                   0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  uint8_t topic_bytes[] = {0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                           0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb9, 0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe,
                         0x1f, 0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 25394, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225w\176\tH\164\231\182-s\240\201\201&@\253\162=", _pubPktID = 25394, _pubBody =
// "\185\216^\ACKI\148P\180>Z9\192\251\254\US\222C\159,\ACK\FS9\205\218@,o", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3a, 0x31, 0x0,  0x12, 0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                   0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d, 0x63, 0x32, 0xb9, 0xd8,
                   0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe, 0x1f,
                   0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                               0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9, 0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe,
                              0x1f, 0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25394);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\132\188b\134\236\255\196\158q\191pM\229*\v\144\145\160\165h&\195", _pubPktID = 0, _pubBody = "\ETB\218", _pubProps
// = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x31, 0x1a, 0x0,  0x16, 0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf,
                   0x70, 0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3, 0x17, 0xda};
  uint8_t topic_bytes[] = {0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70,
                           0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x17, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\132\188b\134\236\255\196\158q\191pM\229*\v\144\145\160\165h&\195", _pubPktID = 0, _pubBody = "\ETB\218", _pubProps
// = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x31, 0x1a, 0x0,  0x16, 0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf,
                   0x70, 0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3, 0x17, 0xda};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70,
                               0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x17, 0xda};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\146,\173K\ETBBf8\150", _pubPktID =
// 137, _pubBody = "\EOTF\225\235\204\DC1\196\244\135L\239L|nO\178\220\210\173\181", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x33, 0x21, 0x0,  0x9,  0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38,
                   0x96, 0x0,  0x89, 0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87,
                   0x4c, 0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  uint8_t topic_bytes[] = {0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87, 0x4c,
                         0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 137, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\146,\173K\ETBBf8\150", _pubPktID =
// 137, _pubBody = "\EOTF\225\235\204\DC1\196\244\135L\239L|nO\178\220\210\173\181", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x33, 0x21, 0x0,  0x9,  0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38,
                   0x96, 0x0,  0x89, 0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87,
                   0x4c, 0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87, 0x4c,
                              0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 137);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\187\245\185\SOH\nLz\249\&84\221t4:\ACKMBL", _pubPktID = 0, _pubBody =
// "+\154\198\134\210\202d\129:\164\205\152\155'n", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x38, 0x23, 0x0,  0x12, 0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                   0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c, 0x2b, 0x9a, 0xc6, 0x86,
                   0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  uint8_t topic_bytes[] = {0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                           0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\187\245\185\SOH\nLz\249\&84\221t4:\ACKMBL", _pubPktID = 0, _pubBody =
// "+\154\198\134\210\202d\129:\164\205\152\155'n", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x38, 0x23, 0x0,  0x12, 0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                   0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c, 0x2b, 0x9a, 0xc6, 0x86,
                   0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                               0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242a\252\132ky\210\DC1\220\251*\163s8\DC4@\147\193\170=\251\131\th\RS\SUB", _pubPktID = 16832, _pubBody =
// "\177\211\211/\228\228B\191\NUL\b'\216\220\236\184", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x35, 0x2d, 0x0,  0x1a, 0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3,
                   0x73, 0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a, 0x41, 0xc0,
                   0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0,  0x8,  0x27, 0xd8, 0xdc, 0xec, 0xb8};
  uint8_t topic_bytes[] = {0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3, 0x73,
                           0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0, 0x8, 0x27, 0xd8, 0xdc, 0xec, 0xb8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16832, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242a\252\132ky\210\DC1\220\251*\163s8\DC4@\147\193\170=\251\131\th\RS\SUB", _pubPktID = 16832, _pubBody =
// "\177\211\211/\228\228B\191\NUL\b'\216\220\236\184", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x35, 0x2d, 0x0,  0x1a, 0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3,
                   0x73, 0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a, 0x41, 0xc0,
                   0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0,  0x8,  0x27, 0xd8, 0xdc, 0xec, 0xb8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3, 0x73,
                               0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0, 0x8, 0x27, 0xd8, 0xdc, 0xec, 0xb8};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 16832);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\&6", _pubPktID = 0, _pubBody =
// "\147\221\242\207\140+To \247\210\244", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x31, 0x10, 0x0,  0x2,  0xdd, 0x36, 0x93, 0xdd, 0xf2,
                   0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  uint8_t topic_bytes[] = {0xdd, 0x36};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x93, 0xdd, 0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\&6", _pubPktID = 0, _pubBody =
// "\147\221\242\207\140+To \247\210\244", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x31, 0x10, 0x0,  0x2,  0xdd, 0x36, 0x93, 0xdd, 0xf2,
                   0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdd, 0x36};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x93, 0xdd, 0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\t[\147\134\211N\220\217R\CAN\NAK\\\186G\DLE\137\189\166\158\221=\171", _pubPktID = 2127, _pubBody =
// "n\\\\\STX\237\196\179\185\241\214\171\SO'\156\228!\240\230\146", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x3c, 0x2d, 0x0,  0x16, 0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15, 0x5c,
                   0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab, 0x8,  0x4f, 0x6e, 0x5c, 0x5c, 0x2,
                   0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6, 0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  uint8_t topic_bytes[] = {0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                           0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6e, 0x5c, 0x5c, 0x2,  0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6,
                         0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 2127, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\t[\147\134\211N\220\217R\CAN\NAK\\\186G\DLE\137\189\166\158\221=\171", _pubPktID = 2127, _pubBody =
// "n\\\\\STX\237\196\179\185\241\214\171\SO'\156\228!\240\230\146", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x3c, 0x2d, 0x0,  0x16, 0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15, 0x5c,
                   0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab, 0x8,  0x4f, 0x6e, 0x5c, 0x5c, 0x2,
                   0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6, 0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                               0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6e, 0x5c, 0x5c, 0x2,  0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6,
                              0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2127);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\134\&7\254W\239\197z\v\194\253\227\173o\163\251m\138", _pubPktID = 0, _pubBody =
// "\136i\178\239\188AL\167x\230\227\NULnK\187", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x23, 0x0,  0x12, 0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                   0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a, 0x88, 0x69, 0xb2, 0xef,
                   0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0,  0x6e, 0x4b, 0xbb};
  uint8_t topic_bytes[] = {0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                           0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x88, 0x69, 0xb2, 0xef, 0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0, 0x6e, 0x4b, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\134\&7\254W\239\197z\v\194\253\227\173o\163\251m\138", _pubPktID = 0, _pubBody =
// "\136i\178\239\188AL\167x\230\227\NULnK\187", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x30, 0x23, 0x0,  0x12, 0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                   0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a, 0x88, 0x69, 0xb2, 0xef,
                   0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0,  0x6e, 0x4b, 0xbb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                               0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x88, 0x69, 0xb2, 0xef, 0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0, 0x6e, 0x4b, 0xbb};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "V\DC1\RS\130\DLE\233\142\210e4%k~\132\153", _pubPktID = 0, _pubBody =
// "\200\ENQr=\212\221i\147\216\&3\ENQpG\250\147", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x30, 0x20, 0x0,  0xf, 0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25, 0x6b, 0x7e,
                   0x84, 0x99, 0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5,  0x70, 0x47, 0xfa, 0x93};
  uint8_t topic_bytes[] = {0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25, 0x6b, 0x7e, 0x84, 0x99};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5, 0x70, 0x47, 0xfa, 0x93};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "V\DC1\RS\130\DLE\233\142\210e4%k~\132\153", _pubPktID = 0, _pubBody =
// "\200\ENQr=\212\221i\147\216\&3\ENQpG\250\147", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x30, 0x20, 0x0,  0xf, 0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25, 0x6b, 0x7e,
                   0x84, 0x99, 0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5,  0x70, 0x47, 0xfa, 0x93};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2,
                               0x65, 0x34, 0x25, 0x6b, 0x7e, 0x84, 0x99};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5, 0x70, 0x47, 0xfa, 0x93};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\160\NAK\234\249\209\141\136\198?\243\245hW6\199=`\243C|RQ\216v@\r", _pubPktID = 19217, _pubBody =
// "\212m\146de\171\221qv\142\228\171\234S7\162", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x1a, 0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68,
                   0x57, 0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd,  0x4b, 0x11,
                   0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71, 0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  uint8_t topic_bytes[] = {0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57,
                           0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
                         0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19217, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\160\NAK\234\249\209\141\136\198?\243\245hW6\199=`\243C|RQ\216v@\r", _pubPktID = 19217, _pubBody =
// "\212m\146de\171\221qv\142\228\171\234S7\162", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x34, 0x2e, 0x0,  0x1a, 0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68,
                   0x57, 0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd,  0x4b, 0x11,
                   0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71, 0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57,
                               0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
                              0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 19217);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225w\176\tH\164\231\182-s\240\201\201&@\253\162=", _pubPktID = 25394, _pubBody =
// "\185\216^\ACKI\148P\180>Z9\192\251\254\US\222C\159,\ACK\FS9\205\218@,o", _pubProps = [PropMessageExpiryInterval
// 27711,PropContentType
// "\204\140N\146\vX\bI\130\SOH@'\ETX\182\153\228\142\DC1\247\199R\244",PropWildcardSubscriptionAvailable
// 60,PropWildcardSubscriptionAvailable 45,PropResponseTopic
// "\DEL%\181E\EOT\168\169W?u.;\167\236-\ETX$\USt@\189T\237p\210=",PropAuthenticationData "\161",PropTopicAliasMaximum
// 11625,PropMaximumPacketSize 920,PropSharedSubscriptionAvailable 60,PropWillDelayInterval
// 13422,PropSessionExpiryInterval 17640,PropWildcardSubscriptionAvailable 208,PropMaximumPacketSize
// 13876,PropMaximumQoS 30,PropAuthenticationData "P\128U\"\151\193\151D\169\&8"]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x3a, 0x9f, 0x1,  0x0,  0x12, 0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d, 0x73, 0xf0, 0xc9,
                   0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d, 0x63, 0x32, 0x6d, 0x2,  0x0,  0x0,  0x6c, 0x3f, 0x3,  0x0,  0x16,
                   0xcc, 0x8c, 0x4e, 0x92, 0xb,  0x58, 0x8,  0x49, 0x82, 0x1,  0x40, 0x27, 0x3,  0xb6, 0x99, 0xe4, 0x8e,
                   0x11, 0xf7, 0xc7, 0x52, 0xf4, 0x28, 0x3c, 0x28, 0x2d, 0x8,  0x0,  0x1a, 0x7f, 0x25, 0xb5, 0x45, 0x4,
                   0xa8, 0xa9, 0x57, 0x3f, 0x75, 0x2e, 0x3b, 0xa7, 0xec, 0x2d, 0x3,  0x24, 0x1f, 0x74, 0x40, 0xbd, 0x54,
                   0xed, 0x70, 0xd2, 0x3d, 0x16, 0x0,  0x1,  0xa1, 0x22, 0x2d, 0x69, 0x27, 0x0,  0x0,  0x3,  0x98, 0x2a,
                   0x3c, 0x18, 0x0,  0x0,  0x34, 0x6e, 0x11, 0x0,  0x0,  0x44, 0xe8, 0x28, 0xd0, 0x27, 0x0,  0x0,  0x36,
                   0x34, 0x24, 0x1e, 0x16, 0x0,  0xa,  0x50, 0x80, 0x55, 0x22, 0x97, 0xc1, 0x97, 0x44, 0xa9, 0x38, 0xb9,
                   0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe, 0x1f, 0xde, 0x43, 0x9f,
                   0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  uint8_t topic_bytes[] = {0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                           0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb9, 0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe,
                         0x1f, 0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0xcc, 0x8c, 0x4e, 0x92, 0xb,  0x58, 0x8,  0x49, 0x82, 0x1,  0x40,
                           0x27, 0x3,  0xb6, 0x99, 0xe4, 0x8e, 0x11, 0xf7, 0xc7, 0x52, 0xf4};
  uint8_t bytesprops1[] = {0x7f, 0x25, 0xb5, 0x45, 0x4,  0xa8, 0xa9, 0x57, 0x3f, 0x75, 0x2e, 0x3b, 0xa7,
                           0xec, 0x2d, 0x3,  0x24, 0x1f, 0x74, 0x40, 0xbd, 0x54, 0xed, 0x70, 0xd2, 0x3d};
  uint8_t bytesprops2[] = {0xa1};
  uint8_t bytesprops3[] = {0x50, 0x80, 0x55, 0x22, 0x97, 0xc1, 0x97, 0x44, 0xa9, 0x38};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27711}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11625}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 920}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13422}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17640}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13876}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 25394, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\225w\176\tH\164\231\182-s\240\201\201&@\253\162=", _pubPktID = 25394, _pubBody =
// "\185\216^\ACKI\148P\180>Z9\192\251\254\US\222C\159,\ACK\FS9\205\218@,o", _pubProps = [PropMessageExpiryInterval
// 27711,PropContentType
// "\204\140N\146\vX\bI\130\SOH@'\ETX\182\153\228\142\DC1\247\199R\244",PropWildcardSubscriptionAvailable
// 60,PropWildcardSubscriptionAvailable 45,PropResponseTopic
// "\DEL%\181E\EOT\168\169W?u.;\167\236-\ETX$\USt@\189T\237p\210=",PropAuthenticationData "\161",PropTopicAliasMaximum
// 11625,PropMaximumPacketSize 920,PropSharedSubscriptionAvailable 60,PropWillDelayInterval
// 13422,PropSessionExpiryInterval 17640,PropWildcardSubscriptionAvailable 208,PropMaximumPacketSize
// 13876,PropMaximumQoS 30,PropAuthenticationData "P\128U\"\151\193\151D\169\&8"]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x3a, 0x9f, 0x1,  0x0,  0x12, 0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d, 0x73, 0xf0, 0xc9,
                   0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d, 0x63, 0x32, 0x6d, 0x2,  0x0,  0x0,  0x6c, 0x3f, 0x3,  0x0,  0x16,
                   0xcc, 0x8c, 0x4e, 0x92, 0xb,  0x58, 0x8,  0x49, 0x82, 0x1,  0x40, 0x27, 0x3,  0xb6, 0x99, 0xe4, 0x8e,
                   0x11, 0xf7, 0xc7, 0x52, 0xf4, 0x28, 0x3c, 0x28, 0x2d, 0x8,  0x0,  0x1a, 0x7f, 0x25, 0xb5, 0x45, 0x4,
                   0xa8, 0xa9, 0x57, 0x3f, 0x75, 0x2e, 0x3b, 0xa7, 0xec, 0x2d, 0x3,  0x24, 0x1f, 0x74, 0x40, 0xbd, 0x54,
                   0xed, 0x70, 0xd2, 0x3d, 0x16, 0x0,  0x1,  0xa1, 0x22, 0x2d, 0x69, 0x27, 0x0,  0x0,  0x3,  0x98, 0x2a,
                   0x3c, 0x18, 0x0,  0x0,  0x34, 0x6e, 0x11, 0x0,  0x0,  0x44, 0xe8, 0x28, 0xd0, 0x27, 0x0,  0x0,  0x36,
                   0x34, 0x24, 0x1e, 0x16, 0x0,  0xa,  0x50, 0x80, 0x55, 0x22, 0x97, 0xc1, 0x97, 0x44, 0xa9, 0x38, 0xb9,
                   0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe, 0x1f, 0xde, 0x43, 0x9f,
                   0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe1, 0x77, 0xb0, 0x9,  0x48, 0xa4, 0xe7, 0xb6, 0x2d,
                               0x73, 0xf0, 0xc9, 0xc9, 0x26, 0x40, 0xfd, 0xa2, 0x3d};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9, 0xd8, 0x5e, 0x6,  0x49, 0x94, 0x50, 0xb4, 0x3e, 0x5a, 0x39, 0xc0, 0xfb, 0xfe,
                              0x1f, 0xde, 0x43, 0x9f, 0x2c, 0x6,  0x1c, 0x39, 0xcd, 0xda, 0x40, 0x2c, 0x6f};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25394);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\132\188b\134\236\255\196\158q\191pM\229*\v\144\145\160\165h&\195", _pubPktID = 0, _pubBody = "\ETB\218", _pubProps
// = [PropSubscriptionIdentifier 19,PropMessageExpiryInterval 9382,PropMessageExpiryInterval 14873,PropContentType
// "2\144",PropSessionExpiryInterval 17417,PropServerReference "\239l\200n'",PropMaximumPacketSize
// 25096,PropSessionExpiryInterval 28634,PropReasonString "\182\181\RS\239"]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x31, 0x4a, 0x0,  0x16, 0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70, 0x4d,
                   0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3, 0x2f, 0xb,  0x13, 0x2,  0x0,  0x0,
                   0x24, 0xa6, 0x2,  0x0,  0x0,  0x3a, 0x19, 0x3,  0x0,  0x2,  0x32, 0x90, 0x11, 0x0,  0x0,  0x44,
                   0x9,  0x1c, 0x0,  0x5,  0xef, 0x6c, 0xc8, 0x6e, 0x27, 0x27, 0x0,  0x0,  0x62, 0x8,  0x11, 0x0,
                   0x0,  0x6f, 0xda, 0x1f, 0x0,  0x4,  0xb6, 0xb5, 0x1e, 0xef, 0x17, 0xda};
  uint8_t topic_bytes[] = {0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70,
                           0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x17, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0x32, 0x90};
  uint8_t bytesprops1[] = {0xef, 0x6c, 0xc8, 0x6e, 0x27};
  uint8_t bytesprops2[] = {0xb6, 0xb5, 0x1e, 0xef};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9382}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14873}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17417}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25096}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28634}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\132\188b\134\236\255\196\158q\191pM\229*\v\144\145\160\165h&\195", _pubPktID = 0, _pubBody = "\ETB\218", _pubProps
// = [PropSubscriptionIdentifier 19,PropMessageExpiryInterval 9382,PropMessageExpiryInterval 14873,PropContentType
// "2\144",PropSessionExpiryInterval 17417,PropServerReference "\239l\200n'",PropMaximumPacketSize
// 25096,PropSessionExpiryInterval 28634,PropReasonString "\182\181\RS\239"]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x31, 0x4a, 0x0,  0x16, 0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70, 0x4d,
                   0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3, 0x2f, 0xb,  0x13, 0x2,  0x0,  0x0,
                   0x24, 0xa6, 0x2,  0x0,  0x0,  0x3a, 0x19, 0x3,  0x0,  0x2,  0x32, 0x90, 0x11, 0x0,  0x0,  0x44,
                   0x9,  0x1c, 0x0,  0x5,  0xef, 0x6c, 0xc8, 0x6e, 0x27, 0x27, 0x0,  0x0,  0x62, 0x8,  0x11, 0x0,
                   0x0,  0x6f, 0xda, 0x1f, 0x0,  0x4,  0xb6, 0xb5, 0x1e, 0xef, 0x17, 0xda};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x84, 0xbc, 0x62, 0x86, 0xec, 0xff, 0xc4, 0x9e, 0x71, 0xbf, 0x70,
                               0x4d, 0xe5, 0x2a, 0xb,  0x90, 0x91, 0xa0, 0xa5, 0x68, 0x26, 0xc3};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x17, 0xda};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\146,\173K\ETBBf8\150", _pubPktID =
// 137, _pubBody = "\EOTF\225\235\204\DC1\196\244\135L\239L|nO\178\220\210\173\181", _pubProps =
// [PropResponseInformation
// "\168\187\241F\ETX\DC3\226\235\216?P\236\139p3\137\ENQG\US\171\182\201+U\227\FS\239S",PropReasonString
// "!\212\NAKt\223\170\223\228\158\216\161[@\235\207\t",PropSubscriptionIdentifier 7,PropMaximumPacketSize
// 1128,PropRequestResponseInformation 151,PropContentType
// "\\\182\217\180\DC3\144C\178\191w3\176\185w\187\176\213\164'B\157",PropResponseTopic
// "\213x\192RF\DLE\DC3\170\182Y\SON\132\170\221\FSG8R"]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x33, 0x8b, 0x1,  0x0,  0x9,  0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96, 0x0,  0x89,
                   0x69, 0x1a, 0x0,  0x1c, 0xa8, 0xbb, 0xf1, 0x46, 0x3,  0x13, 0xe2, 0xeb, 0xd8, 0x3f, 0x50, 0xec,
                   0x8b, 0x70, 0x33, 0x89, 0x5,  0x47, 0x1f, 0xab, 0xb6, 0xc9, 0x2b, 0x55, 0xe3, 0x1c, 0xef, 0x53,
                   0x1f, 0x0,  0x10, 0x21, 0xd4, 0x15, 0x74, 0xdf, 0xaa, 0xdf, 0xe4, 0x9e, 0xd8, 0xa1, 0x5b, 0x40,
                   0xeb, 0xcf, 0x9,  0xb,  0x7,  0x27, 0x0,  0x0,  0x4,  0x68, 0x19, 0x97, 0x3,  0x0,  0x15, 0x5c,
                   0xb6, 0xd9, 0xb4, 0x13, 0x90, 0x43, 0xb2, 0xbf, 0x77, 0x33, 0xb0, 0xb9, 0x77, 0xbb, 0xb0, 0xd5,
                   0xa4, 0x27, 0x42, 0x9d, 0x8,  0x0,  0x13, 0xd5, 0x78, 0xc0, 0x52, 0x46, 0x10, 0x13, 0xaa, 0xb6,
                   0x59, 0xe,  0x4e, 0x84, 0xaa, 0xdd, 0x1c, 0x47, 0x38, 0x52, 0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11,
                   0xc4, 0xf4, 0x87, 0x4c, 0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  uint8_t topic_bytes[] = {0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87, 0x4c,
                         0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0xa8, 0xbb, 0xf1, 0x46, 0x3,  0x13, 0xe2, 0xeb, 0xd8, 0x3f, 0x50, 0xec, 0x8b, 0x70,
                           0x33, 0x89, 0x5,  0x47, 0x1f, 0xab, 0xb6, 0xc9, 0x2b, 0x55, 0xe3, 0x1c, 0xef, 0x53};
  uint8_t bytesprops1[] = {0x21, 0xd4, 0x15, 0x74, 0xdf, 0xaa, 0xdf, 0xe4,
                           0x9e, 0xd8, 0xa1, 0x5b, 0x40, 0xeb, 0xcf, 0x9};
  uint8_t bytesprops2[] = {0x5c, 0xb6, 0xd9, 0xb4, 0x13, 0x90, 0x43, 0xb2, 0xbf, 0x77, 0x33,
                           0xb0, 0xb9, 0x77, 0xbb, 0xb0, 0xd5, 0xa4, 0x27, 0x42, 0x9d};
  uint8_t bytesprops3[] = {0xd5, 0x78, 0xc0, 0x52, 0x46, 0x10, 0x13, 0xaa, 0xb6, 0x59,
                           0xe,  0x4e, 0x84, 0xaa, 0xdd, 0x1c, 0x47, 0x38, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1128}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 137, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\146,\173K\ETBBf8\150", _pubPktID =
// 137, _pubBody = "\EOTF\225\235\204\DC1\196\244\135L\239L|nO\178\220\210\173\181", _pubProps =
// [PropResponseInformation
// "\168\187\241F\ETX\DC3\226\235\216?P\236\139p3\137\ENQG\US\171\182\201+U\227\FS\239S",PropReasonString
// "!\212\NAKt\223\170\223\228\158\216\161[@\235\207\t",PropSubscriptionIdentifier 7,PropMaximumPacketSize
// 1128,PropRequestResponseInformation 151,PropContentType
// "\\\182\217\180\DC3\144C\178\191w3\176\185w\187\176\213\164'B\157",PropResponseTopic
// "\213x\192RF\DLE\DC3\170\182Y\SON\132\170\221\FSG8R"]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x33, 0x8b, 0x1,  0x0,  0x9,  0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96, 0x0,  0x89,
                   0x69, 0x1a, 0x0,  0x1c, 0xa8, 0xbb, 0xf1, 0x46, 0x3,  0x13, 0xe2, 0xeb, 0xd8, 0x3f, 0x50, 0xec,
                   0x8b, 0x70, 0x33, 0x89, 0x5,  0x47, 0x1f, 0xab, 0xb6, 0xc9, 0x2b, 0x55, 0xe3, 0x1c, 0xef, 0x53,
                   0x1f, 0x0,  0x10, 0x21, 0xd4, 0x15, 0x74, 0xdf, 0xaa, 0xdf, 0xe4, 0x9e, 0xd8, 0xa1, 0x5b, 0x40,
                   0xeb, 0xcf, 0x9,  0xb,  0x7,  0x27, 0x0,  0x0,  0x4,  0x68, 0x19, 0x97, 0x3,  0x0,  0x15, 0x5c,
                   0xb6, 0xd9, 0xb4, 0x13, 0x90, 0x43, 0xb2, 0xbf, 0x77, 0x33, 0xb0, 0xb9, 0x77, 0xbb, 0xb0, 0xd5,
                   0xa4, 0x27, 0x42, 0x9d, 0x8,  0x0,  0x13, 0xd5, 0x78, 0xc0, 0x52, 0x46, 0x10, 0x13, 0xaa, 0xb6,
                   0x59, 0xe,  0x4e, 0x84, 0xaa, 0xdd, 0x1c, 0x47, 0x38, 0x52, 0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11,
                   0xc4, 0xf4, 0x87, 0x4c, 0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x92, 0x2c, 0xad, 0x4b, 0x17, 0x42, 0x66, 0x38, 0x96};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4,  0x46, 0xe1, 0xeb, 0xcc, 0x11, 0xc4, 0xf4, 0x87, 0x4c,
                              0xef, 0x4c, 0x7c, 0x6e, 0x4f, 0xb2, 0xdc, 0xd2, 0xad, 0xb5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 137);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\187\245\185\SOH\nLz\249\&84\221t4:\ACKMBL", _pubPktID = 0, _pubBody =
// "+\154\198\134\210\202d\129:\164\205\152\155'n", _pubProps = [PropResponseTopic
// "|2\DC1,\157\216\160\155~B\255\169\245\132",PropServerReference
// "\138\205y\bC\181\165\157\235H\200\SOH\137\218\141qZ\243)\DEL\196\232\228<\164",PropRequestResponseInformation
// 183,PropCorrelationData "\247\163[\152\ETB\190t\f\193\SUB",PropMaximumPacketSize 11719,PropAuthenticationData
// "\134Xh\141eI",PropRequestProblemInformation 210,PropSubscriptionIdentifierAvailable 109,PropMessageExpiryInterval
// 25460,PropRetainAvailable 26,PropSubscriptionIdentifierAvailable 168,PropReasonString
// "\146\&8@\SYN\224G\185l\203\160\163\254\206\152",PropPayloadFormatIndicator 60,PropAuthenticationMethod
// "__]qE\180\\\169\199\183\237\&9VH!\151p\238\ETX\241",PropRequestResponseInformation
// 110,PropRequestResponseInformation 156,PropContentType "O",PropWildcardSubscriptionAvailable 11,PropWillDelayInterval
// 18099]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x38, 0xb5, 0x1,  0x0,  0x12, 0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38, 0x34, 0xdd, 0x74,
                   0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c, 0x90, 0x1,  0x8,  0x0,  0xe,  0x7c, 0x32, 0x11, 0x2c, 0x9d, 0xd8,
                   0xa0, 0x9b, 0x7e, 0x42, 0xff, 0xa9, 0xf5, 0x84, 0x1c, 0x0,  0x19, 0x8a, 0xcd, 0x79, 0x8,  0x43, 0xb5,
                   0xa5, 0x9d, 0xeb, 0x48, 0xc8, 0x1,  0x89, 0xda, 0x8d, 0x71, 0x5a, 0xf3, 0x29, 0x7f, 0xc4, 0xe8, 0xe4,
                   0x3c, 0xa4, 0x19, 0xb7, 0x9,  0x0,  0xa,  0xf7, 0xa3, 0x5b, 0x98, 0x17, 0xbe, 0x74, 0xc,  0xc1, 0x1a,
                   0x27, 0x0,  0x0,  0x2d, 0xc7, 0x16, 0x0,  0x6,  0x86, 0x58, 0x68, 0x8d, 0x65, 0x49, 0x17, 0xd2, 0x29,
                   0x6d, 0x2,  0x0,  0x0,  0x63, 0x74, 0x25, 0x1a, 0x29, 0xa8, 0x1f, 0x0,  0xe,  0x92, 0x38, 0x40, 0x16,
                   0xe0, 0x47, 0xb9, 0x6c, 0xcb, 0xa0, 0xa3, 0xfe, 0xce, 0x98, 0x1,  0x3c, 0x15, 0x0,  0x14, 0x5f, 0x5f,
                   0x5d, 0x71, 0x45, 0xb4, 0x5c, 0xa9, 0xc7, 0xb7, 0xed, 0x39, 0x56, 0x48, 0x21, 0x97, 0x70, 0xee, 0x3,
                   0xf1, 0x19, 0x6e, 0x19, 0x9c, 0x3,  0x0,  0x1,  0x4f, 0x28, 0xb,  0x18, 0x0,  0x0,  0x46, 0xb3, 0x2b,
                   0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  uint8_t topic_bytes[] = {0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                           0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x7c, 0x32, 0x11, 0x2c, 0x9d, 0xd8, 0xa0, 0x9b, 0x7e, 0x42, 0xff, 0xa9, 0xf5, 0x84};
  uint8_t bytesprops1[] = {0x8a, 0xcd, 0x79, 0x8,  0x43, 0xb5, 0xa5, 0x9d, 0xeb, 0x48, 0xc8, 0x1, 0x89,
                           0xda, 0x8d, 0x71, 0x5a, 0xf3, 0x29, 0x7f, 0xc4, 0xe8, 0xe4, 0x3c, 0xa4};
  uint8_t bytesprops2[] = {0xf7, 0xa3, 0x5b, 0x98, 0x17, 0xbe, 0x74, 0xc, 0xc1, 0x1a};
  uint8_t bytesprops3[] = {0x86, 0x58, 0x68, 0x8d, 0x65, 0x49};
  uint8_t bytesprops4[] = {0x92, 0x38, 0x40, 0x16, 0xe0, 0x47, 0xb9, 0x6c, 0xcb, 0xa0, 0xa3, 0xfe, 0xce, 0x98};
  uint8_t bytesprops5[] = {0x5f, 0x5f, 0x5d, 0x71, 0x45, 0xb4, 0x5c, 0xa9, 0xc7, 0xb7,
                           0xed, 0x39, 0x56, 0x48, 0x21, 0x97, 0x70, 0xee, 0x3,  0xf1};
  uint8_t bytesprops6[] = {0x4f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11719}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25460}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18099}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\187\245\185\SOH\nLz\249\&84\221t4:\ACKMBL", _pubPktID = 0, _pubBody =
// "+\154\198\134\210\202d\129:\164\205\152\155'n", _pubProps = [PropResponseTopic
// "|2\DC1,\157\216\160\155~B\255\169\245\132",PropServerReference
// "\138\205y\bC\181\165\157\235H\200\SOH\137\218\141qZ\243)\DEL\196\232\228<\164",PropRequestResponseInformation
// 183,PropCorrelationData "\247\163[\152\ETB\190t\f\193\SUB",PropMaximumPacketSize 11719,PropAuthenticationData
// "\134Xh\141eI",PropRequestProblemInformation 210,PropSubscriptionIdentifierAvailable 109,PropMessageExpiryInterval
// 25460,PropRetainAvailable 26,PropSubscriptionIdentifierAvailable 168,PropReasonString
// "\146\&8@\SYN\224G\185l\203\160\163\254\206\152",PropPayloadFormatIndicator 60,PropAuthenticationMethod
// "__]qE\180\\\169\199\183\237\&9VH!\151p\238\ETX\241",PropRequestResponseInformation
// 110,PropRequestResponseInformation 156,PropContentType "O",PropWildcardSubscriptionAvailable 11,PropWillDelayInterval
// 18099]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x38, 0xb5, 0x1,  0x0,  0x12, 0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38, 0x34, 0xdd, 0x74,
                   0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c, 0x90, 0x1,  0x8,  0x0,  0xe,  0x7c, 0x32, 0x11, 0x2c, 0x9d, 0xd8,
                   0xa0, 0x9b, 0x7e, 0x42, 0xff, 0xa9, 0xf5, 0x84, 0x1c, 0x0,  0x19, 0x8a, 0xcd, 0x79, 0x8,  0x43, 0xb5,
                   0xa5, 0x9d, 0xeb, 0x48, 0xc8, 0x1,  0x89, 0xda, 0x8d, 0x71, 0x5a, 0xf3, 0x29, 0x7f, 0xc4, 0xe8, 0xe4,
                   0x3c, 0xa4, 0x19, 0xb7, 0x9,  0x0,  0xa,  0xf7, 0xa3, 0x5b, 0x98, 0x17, 0xbe, 0x74, 0xc,  0xc1, 0x1a,
                   0x27, 0x0,  0x0,  0x2d, 0xc7, 0x16, 0x0,  0x6,  0x86, 0x58, 0x68, 0x8d, 0x65, 0x49, 0x17, 0xd2, 0x29,
                   0x6d, 0x2,  0x0,  0x0,  0x63, 0x74, 0x25, 0x1a, 0x29, 0xa8, 0x1f, 0x0,  0xe,  0x92, 0x38, 0x40, 0x16,
                   0xe0, 0x47, 0xb9, 0x6c, 0xcb, 0xa0, 0xa3, 0xfe, 0xce, 0x98, 0x1,  0x3c, 0x15, 0x0,  0x14, 0x5f, 0x5f,
                   0x5d, 0x71, 0x45, 0xb4, 0x5c, 0xa9, 0xc7, 0xb7, 0xed, 0x39, 0x56, 0x48, 0x21, 0x97, 0x70, 0xee, 0x3,
                   0xf1, 0x19, 0x6e, 0x19, 0x9c, 0x3,  0x0,  0x1,  0x4f, 0x28, 0xb,  0x18, 0x0,  0x0,  0x46, 0xb3, 0x2b,
                   0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0xf5, 0xb9, 0x1,  0xa,  0x4c, 0x7a, 0xf9, 0x38,
                               0x34, 0xdd, 0x74, 0x34, 0x3a, 0x6,  0x4d, 0x42, 0x4c};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x9a, 0xc6, 0x86, 0xd2, 0xca, 0x64, 0x81, 0x3a, 0xa4, 0xcd, 0x98, 0x9b, 0x27, 0x6e};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242a\252\132ky\210\DC1\220\251*\163s8\DC4@\147\193\170=\251\131\th\RS\SUB", _pubPktID = 16832, _pubBody =
// "\177\211\211/\228\228B\191\NUL\b'\216\220\236\184", _pubProps = [PropMessageExpiryInterval
// 3768,PropMessageExpiryInterval 28744]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x35, 0x38, 0x0,  0x1a, 0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a,
                   0xa3, 0x73, 0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a,
                   0x41, 0xc0, 0xa,  0x2,  0x0,  0x0,  0xe,  0xb8, 0x2,  0x0,  0x0,  0x70, 0x48, 0xb1, 0xd3,
                   0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0,  0x8,  0x27, 0xd8, 0xdc, 0xec, 0xb8};
  uint8_t topic_bytes[] = {0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3, 0x73,
                           0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0, 0x8, 0x27, 0xd8, 0xdc, 0xec, 0xb8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3768}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28744}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16832, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242a\252\132ky\210\DC1\220\251*\163s8\DC4@\147\193\170=\251\131\th\RS\SUB", _pubPktID = 16832, _pubBody =
// "\177\211\211/\228\228B\191\NUL\b'\216\220\236\184", _pubProps = [PropMessageExpiryInterval
// 3768,PropMessageExpiryInterval 28744]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x35, 0x38, 0x0,  0x1a, 0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a,
                   0xa3, 0x73, 0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a,
                   0x41, 0xc0, 0xa,  0x2,  0x0,  0x0,  0xe,  0xb8, 0x2,  0x0,  0x0,  0x70, 0x48, 0xb1, 0xd3,
                   0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0,  0x8,  0x27, 0xd8, 0xdc, 0xec, 0xb8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf2, 0x61, 0xfc, 0x84, 0x6b, 0x79, 0xd2, 0x11, 0xdc, 0xfb, 0x2a, 0xa3, 0x73,
                               0x38, 0x14, 0x40, 0x93, 0xc1, 0xaa, 0x3d, 0xfb, 0x83, 0x9,  0x68, 0x1e, 0x1a};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb1, 0xd3, 0xd3, 0x2f, 0xe4, 0xe4, 0x42, 0xbf, 0x0, 0x8, 0x27, 0xd8, 0xdc, 0xec, 0xb8};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 16832);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\&6", _pubPktID = 0, _pubBody =
// "\147\221\242\207\140+To \247\210\244", _pubProps = [PropAuthenticationMethod
// "@\158\&95?=\253\187X\243\172\248",PropPayloadFormatIndicator 13,PropResponseTopic
// "\223F|\CAN\162?\US<AW\ETX\r\214\155\139\201\SOP\177YD\237\237y\170^\208]\157\162",PropMessageExpiryInterval
// 16545,PropMessageExpiryInterval 30239,PropWillDelayInterval 22888,PropCorrelationData
// "J*p\225\213\253d\195\251f\b5I.\197\SUB\206\172",PropRequestResponseInformation 126,PropWillDelayInterval
// 7886,PropContentType "is\198\169\143\216\208U\255*\161\ETX^P\151",PropTopicAliasMaximum
// 9325,PropRequestResponseInformation 124,PropMaximumQoS 45,PropMaximumPacketSize 19068,PropSubscriptionIdentifier
// 7,PropAuthenticationData "J\168<\"\210\150[;|",PropReceiveMaximum 30647,PropUserProperty
// "\DC2\188\155\154-\190\165\142pO?U" "\195q\179\138j\255\165\190\155\253'",PropRequestResponseInformation
// 178,PropMaximumQoS 109,PropReasonString "\203a\161\163;",PropUserProperty "Ed\NUL\195\145R\134\242[<\218\186\234"
// "`\243\137\133\215S\148gF\202?1\EOT\ACK\243!6\252\219"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x31, 0xeb, 0x1,  0x0,  0x2,  0xdd, 0x36, 0xd9, 0x1,  0x15, 0x0,  0xc,  0x40, 0x9e, 0x39, 0x35, 0x3f, 0x3d, 0xfd,
      0xbb, 0x58, 0xf3, 0xac, 0xf8, 0x1,  0xd,  0x8,  0x0,  0x1e, 0xdf, 0x46, 0x7c, 0x18, 0xa2, 0x3f, 0x1f, 0x3c, 0x41,
      0x57, 0x3,  0xd,  0xd6, 0x9b, 0x8b, 0xc9, 0xe,  0x50, 0xb1, 0x59, 0x44, 0xed, 0xed, 0x79, 0xaa, 0x5e, 0xd0, 0x5d,
      0x9d, 0xa2, 0x2,  0x0,  0x0,  0x40, 0xa1, 0x2,  0x0,  0x0,  0x76, 0x1f, 0x18, 0x0,  0x0,  0x59, 0x68, 0x9,  0x0,
      0x12, 0x4a, 0x2a, 0x70, 0xe1, 0xd5, 0xfd, 0x64, 0xc3, 0xfb, 0x66, 0x8,  0x35, 0x49, 0x2e, 0xc5, 0x1a, 0xce, 0xac,
      0x19, 0x7e, 0x18, 0x0,  0x0,  0x1e, 0xce, 0x3,  0x0,  0xf,  0x69, 0x73, 0xc6, 0xa9, 0x8f, 0xd8, 0xd0, 0x55, 0xff,
      0x2a, 0xa1, 0x3,  0x5e, 0x50, 0x97, 0x22, 0x24, 0x6d, 0x19, 0x7c, 0x24, 0x2d, 0x27, 0x0,  0x0,  0x4a, 0x7c, 0xb,
      0x7,  0x16, 0x0,  0x9,  0x4a, 0xa8, 0x3c, 0x22, 0xd2, 0x96, 0x5b, 0x3b, 0x7c, 0x21, 0x77, 0xb7, 0x26, 0x0,  0xc,
      0x12, 0xbc, 0x9b, 0x9a, 0x2d, 0xbe, 0xa5, 0x8e, 0x70, 0x4f, 0x3f, 0x55, 0x0,  0xb,  0xc3, 0x71, 0xb3, 0x8a, 0x6a,
      0xff, 0xa5, 0xbe, 0x9b, 0xfd, 0x27, 0x19, 0xb2, 0x24, 0x6d, 0x1f, 0x0,  0x5,  0xcb, 0x61, 0xa1, 0xa3, 0x3b, 0x26,
      0x0,  0xd,  0x45, 0x64, 0x0,  0xc3, 0x91, 0x52, 0x86, 0xf2, 0x5b, 0x3c, 0xda, 0xba, 0xea, 0x0,  0x13, 0x60, 0xf3,
      0x89, 0x85, 0xd7, 0x53, 0x94, 0x67, 0x46, 0xca, 0x3f, 0x31, 0x4,  0x6,  0xf3, 0x21, 0x36, 0xfc, 0xdb, 0x93, 0xdd,
      0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  uint8_t topic_bytes[] = {0xdd, 0x36};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x93, 0xdd, 0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x40, 0x9e, 0x39, 0x35, 0x3f, 0x3d, 0xfd, 0xbb, 0x58, 0xf3, 0xac, 0xf8};
  uint8_t bytesprops1[] = {0xdf, 0x46, 0x7c, 0x18, 0xa2, 0x3f, 0x1f, 0x3c, 0x41, 0x57, 0x3,  0xd,  0xd6, 0x9b, 0x8b,
                           0xc9, 0xe,  0x50, 0xb1, 0x59, 0x44, 0xed, 0xed, 0x79, 0xaa, 0x5e, 0xd0, 0x5d, 0x9d, 0xa2};
  uint8_t bytesprops2[] = {0x4a, 0x2a, 0x70, 0xe1, 0xd5, 0xfd, 0x64, 0xc3, 0xfb,
                           0x66, 0x8,  0x35, 0x49, 0x2e, 0xc5, 0x1a, 0xce, 0xac};
  uint8_t bytesprops3[] = {0x69, 0x73, 0xc6, 0xa9, 0x8f, 0xd8, 0xd0, 0x55, 0xff, 0x2a, 0xa1, 0x3, 0x5e, 0x50, 0x97};
  uint8_t bytesprops4[] = {0x4a, 0xa8, 0x3c, 0x22, 0xd2, 0x96, 0x5b, 0x3b, 0x7c};
  uint8_t bytesprops6[] = {0xc3, 0x71, 0xb3, 0x8a, 0x6a, 0xff, 0xa5, 0xbe, 0x9b, 0xfd, 0x27};
  uint8_t bytesprops5[] = {0x12, 0xbc, 0x9b, 0x9a, 0x2d, 0xbe, 0xa5, 0x8e, 0x70, 0x4f, 0x3f, 0x55};
  uint8_t bytesprops7[] = {0xcb, 0x61, 0xa1, 0xa3, 0x3b};
  uint8_t bytesprops9[] = {0x60, 0xf3, 0x89, 0x85, 0xd7, 0x53, 0x94, 0x67, 0x46, 0xca,
                           0x3f, 0x31, 0x4,  0x6,  0xf3, 0x21, 0x36, 0xfc, 0xdb};
  uint8_t bytesprops8[] = {0x45, 0x64, 0x0, 0xc3, 0x91, 0x52, 0x86, 0xf2, 0x5b, 0x3c, 0xda, 0xba, 0xea};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16545}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30239}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22888}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7886}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9325}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19068}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30647}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops5}, .v = {11, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops8}, .v = {19, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\221\&6", _pubPktID = 0, _pubBody =
// "\147\221\242\207\140+To \247\210\244", _pubProps = [PropAuthenticationMethod
// "@\158\&95?=\253\187X\243\172\248",PropPayloadFormatIndicator 13,PropResponseTopic
// "\223F|\CAN\162?\US<AW\ETX\r\214\155\139\201\SOP\177YD\237\237y\170^\208]\157\162",PropMessageExpiryInterval
// 16545,PropMessageExpiryInterval 30239,PropWillDelayInterval 22888,PropCorrelationData
// "J*p\225\213\253d\195\251f\b5I.\197\SUB\206\172",PropRequestResponseInformation 126,PropWillDelayInterval
// 7886,PropContentType "is\198\169\143\216\208U\255*\161\ETX^P\151",PropTopicAliasMaximum
// 9325,PropRequestResponseInformation 124,PropMaximumQoS 45,PropMaximumPacketSize 19068,PropSubscriptionIdentifier
// 7,PropAuthenticationData "J\168<\"\210\150[;|",PropReceiveMaximum 30647,PropUserProperty
// "\DC2\188\155\154-\190\165\142pO?U" "\195q\179\138j\255\165\190\155\253'",PropRequestResponseInformation
// 178,PropMaximumQoS 109,PropReasonString "\203a\161\163;",PropUserProperty "Ed\NUL\195\145R\134\242[<\218\186\234"
// "`\243\137\133\215S\148gF\202?1\EOT\ACK\243!6\252\219"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {
      0x31, 0xeb, 0x1,  0x0,  0x2,  0xdd, 0x36, 0xd9, 0x1,  0x15, 0x0,  0xc,  0x40, 0x9e, 0x39, 0x35, 0x3f, 0x3d, 0xfd,
      0xbb, 0x58, 0xf3, 0xac, 0xf8, 0x1,  0xd,  0x8,  0x0,  0x1e, 0xdf, 0x46, 0x7c, 0x18, 0xa2, 0x3f, 0x1f, 0x3c, 0x41,
      0x57, 0x3,  0xd,  0xd6, 0x9b, 0x8b, 0xc9, 0xe,  0x50, 0xb1, 0x59, 0x44, 0xed, 0xed, 0x79, 0xaa, 0x5e, 0xd0, 0x5d,
      0x9d, 0xa2, 0x2,  0x0,  0x0,  0x40, 0xa1, 0x2,  0x0,  0x0,  0x76, 0x1f, 0x18, 0x0,  0x0,  0x59, 0x68, 0x9,  0x0,
      0x12, 0x4a, 0x2a, 0x70, 0xe1, 0xd5, 0xfd, 0x64, 0xc3, 0xfb, 0x66, 0x8,  0x35, 0x49, 0x2e, 0xc5, 0x1a, 0xce, 0xac,
      0x19, 0x7e, 0x18, 0x0,  0x0,  0x1e, 0xce, 0x3,  0x0,  0xf,  0x69, 0x73, 0xc6, 0xa9, 0x8f, 0xd8, 0xd0, 0x55, 0xff,
      0x2a, 0xa1, 0x3,  0x5e, 0x50, 0x97, 0x22, 0x24, 0x6d, 0x19, 0x7c, 0x24, 0x2d, 0x27, 0x0,  0x0,  0x4a, 0x7c, 0xb,
      0x7,  0x16, 0x0,  0x9,  0x4a, 0xa8, 0x3c, 0x22, 0xd2, 0x96, 0x5b, 0x3b, 0x7c, 0x21, 0x77, 0xb7, 0x26, 0x0,  0xc,
      0x12, 0xbc, 0x9b, 0x9a, 0x2d, 0xbe, 0xa5, 0x8e, 0x70, 0x4f, 0x3f, 0x55, 0x0,  0xb,  0xc3, 0x71, 0xb3, 0x8a, 0x6a,
      0xff, 0xa5, 0xbe, 0x9b, 0xfd, 0x27, 0x19, 0xb2, 0x24, 0x6d, 0x1f, 0x0,  0x5,  0xcb, 0x61, 0xa1, 0xa3, 0x3b, 0x26,
      0x0,  0xd,  0x45, 0x64, 0x0,  0xc3, 0x91, 0x52, 0x86, 0xf2, 0x5b, 0x3c, 0xda, 0xba, 0xea, 0x0,  0x13, 0x60, 0xf3,
      0x89, 0x85, 0xd7, 0x53, 0x94, 0x67, 0x46, 0xca, 0x3f, 0x31, 0x4,  0x6,  0xf3, 0x21, 0x36, 0xfc, 0xdb, 0x93, 0xdd,
      0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdd, 0x36};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x93, 0xdd, 0xf2, 0xcf, 0x8c, 0x2b, 0x54, 0x6f, 0x20, 0xf7, 0xd2, 0xf4};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\t[\147\134\211N\220\217R\CAN\NAK\\\186G\DLE\137\189\166\158\221=\171", _pubPktID = 2127, _pubBody =
// "n\\\\\STX\237\196\179\185\241\214\171\SO'\156\228!\240\230\146", _pubProps = [PropAuthenticationMethod
// "}l\146\214\195on\142F\154</\US\246I%\249\178\235\234\150b\DC1\137&\150P\155",PropRequestProblemInformation
// 94,PropAuthenticationData
// "5%*\157\209\178|\151\&0\168\235\153\&5\131\200\175wf\196\tt\208\r\169\157\GS",PropServerReference
// "\243\133\231\\b\254\"/\222 (\245\EM\193\223C?\172g`\180\178+%\187\209",PropRequestResponseInformation
// 136,PropWillDelayInterval 4045,PropMessageExpiryInterval 17128,PropSubscriptionIdentifierAvailable
// 235,PropRequestResponseInformation 124,PropRequestProblemInformation 15]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x3c, 0x9b, 0x1,  0x0,  0x16, 0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                   0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab, 0x8,  0x4f, 0x6d, 0x15, 0x0,
                   0x1c, 0x7d, 0x6c, 0x92, 0xd6, 0xc3, 0x6f, 0x6e, 0x8e, 0x46, 0x9a, 0x3c, 0x2f, 0x1f, 0xf6, 0x49,
                   0x25, 0xf9, 0xb2, 0xeb, 0xea, 0x96, 0x62, 0x11, 0x89, 0x26, 0x96, 0x50, 0x9b, 0x17, 0x5e, 0x16,
                   0x0,  0x1a, 0x35, 0x25, 0x2a, 0x9d, 0xd1, 0xb2, 0x7c, 0x97, 0x30, 0xa8, 0xeb, 0x99, 0x35, 0x83,
                   0xc8, 0xaf, 0x77, 0x66, 0xc4, 0x9,  0x74, 0xd0, 0xd,  0xa9, 0x9d, 0x1d, 0x1c, 0x0,  0x1a, 0xf3,
                   0x85, 0xe7, 0x5c, 0x62, 0xfe, 0x22, 0x2f, 0xde, 0x20, 0x28, 0xf5, 0x19, 0xc1, 0xdf, 0x43, 0x3f,
                   0xac, 0x67, 0x60, 0xb4, 0xb2, 0x2b, 0x25, 0xbb, 0xd1, 0x19, 0x88, 0x18, 0x0,  0x0,  0xf,  0xcd,
                   0x2,  0x0,  0x0,  0x42, 0xe8, 0x29, 0xeb, 0x19, 0x7c, 0x17, 0xf,  0x6e, 0x5c, 0x5c, 0x2,  0xed,
                   0xc4, 0xb3, 0xb9, 0xf1, 0xd6, 0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  uint8_t topic_bytes[] = {0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                           0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x6e, 0x5c, 0x5c, 0x2,  0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6,
                         0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0x7d, 0x6c, 0x92, 0xd6, 0xc3, 0x6f, 0x6e, 0x8e, 0x46, 0x9a, 0x3c, 0x2f, 0x1f, 0xf6,
                           0x49, 0x25, 0xf9, 0xb2, 0xeb, 0xea, 0x96, 0x62, 0x11, 0x89, 0x26, 0x96, 0x50, 0x9b};
  uint8_t bytesprops1[] = {0x35, 0x25, 0x2a, 0x9d, 0xd1, 0xb2, 0x7c, 0x97, 0x30, 0xa8, 0xeb, 0x99, 0x35,
                           0x83, 0xc8, 0xaf, 0x77, 0x66, 0xc4, 0x9,  0x74, 0xd0, 0xd,  0xa9, 0x9d, 0x1d};
  uint8_t bytesprops2[] = {0xf3, 0x85, 0xe7, 0x5c, 0x62, 0xfe, 0x22, 0x2f, 0xde, 0x20, 0x28, 0xf5, 0x19,
                           0xc1, 0xdf, 0x43, 0x3f, 0xac, 0x67, 0x60, 0xb4, 0xb2, 0x2b, 0x25, 0xbb, 0xd1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4045}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17128}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 15}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 2127, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\t[\147\134\211N\220\217R\CAN\NAK\\\186G\DLE\137\189\166\158\221=\171", _pubPktID = 2127, _pubBody =
// "n\\\\\STX\237\196\179\185\241\214\171\SO'\156\228!\240\230\146", _pubProps = [PropAuthenticationMethod
// "}l\146\214\195on\142F\154</\US\246I%\249\178\235\234\150b\DC1\137&\150P\155",PropRequestProblemInformation
// 94,PropAuthenticationData
// "5%*\157\209\178|\151\&0\168\235\153\&5\131\200\175wf\196\tt\208\r\169\157\GS",PropServerReference
// "\243\133\231\\b\254\"/\222 (\245\EM\193\223C?\172g`\180\178+%\187\209",PropRequestResponseInformation
// 136,PropWillDelayInterval 4045,PropMessageExpiryInterval 17128,PropSubscriptionIdentifierAvailable
// 235,PropRequestResponseInformation 124,PropRequestProblemInformation 15]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x3c, 0x9b, 0x1,  0x0,  0x16, 0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                   0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab, 0x8,  0x4f, 0x6d, 0x15, 0x0,
                   0x1c, 0x7d, 0x6c, 0x92, 0xd6, 0xc3, 0x6f, 0x6e, 0x8e, 0x46, 0x9a, 0x3c, 0x2f, 0x1f, 0xf6, 0x49,
                   0x25, 0xf9, 0xb2, 0xeb, 0xea, 0x96, 0x62, 0x11, 0x89, 0x26, 0x96, 0x50, 0x9b, 0x17, 0x5e, 0x16,
                   0x0,  0x1a, 0x35, 0x25, 0x2a, 0x9d, 0xd1, 0xb2, 0x7c, 0x97, 0x30, 0xa8, 0xeb, 0x99, 0x35, 0x83,
                   0xc8, 0xaf, 0x77, 0x66, 0xc4, 0x9,  0x74, 0xd0, 0xd,  0xa9, 0x9d, 0x1d, 0x1c, 0x0,  0x1a, 0xf3,
                   0x85, 0xe7, 0x5c, 0x62, 0xfe, 0x22, 0x2f, 0xde, 0x20, 0x28, 0xf5, 0x19, 0xc1, 0xdf, 0x43, 0x3f,
                   0xac, 0x67, 0x60, 0xb4, 0xb2, 0x2b, 0x25, 0xbb, 0xd1, 0x19, 0x88, 0x18, 0x0,  0x0,  0xf,  0xcd,
                   0x2,  0x0,  0x0,  0x42, 0xe8, 0x29, 0xeb, 0x19, 0x7c, 0x17, 0xf,  0x6e, 0x5c, 0x5c, 0x2,  0xed,
                   0xc4, 0xb3, 0xb9, 0xf1, 0xd6, 0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9,  0x5b, 0x93, 0x86, 0xd3, 0x4e, 0xdc, 0xd9, 0x52, 0x18, 0x15,
                               0x5c, 0xba, 0x47, 0x10, 0x89, 0xbd, 0xa6, 0x9e, 0xdd, 0x3d, 0xab};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6e, 0x5c, 0x5c, 0x2,  0xed, 0xc4, 0xb3, 0xb9, 0xf1, 0xd6,
                              0xab, 0xe,  0x27, 0x9c, 0xe4, 0x21, 0xf0, 0xe6, 0x92};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2127);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\134\&7\254W\239\197z\v\194\253\227\173o\163\251m\138", _pubPktID = 0, _pubBody =
// "\136i\178\239\188AL\167x\230\227\NULnK\187", _pubProps = [PropAssignedClientIdentifier
// "\225\SO\FS\251vB\190\ETB\128\RS\134+o\138\US;\168\226Qn7\fFe\DC4\150\147\&4\145n",PropWildcardSubscriptionAvailable
// 225,PropReceiveMaximum 3746,PropReasonString "\223\163\173)L",PropRequestProblemInformation 142]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x30, 0x54, 0x0,  0x12, 0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,  0xc2, 0xfd,
                   0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a, 0x30, 0x12, 0x0,  0x1e, 0xe1, 0xe,  0x1c, 0xfb,
                   0x76, 0x42, 0xbe, 0x17, 0x80, 0x1e, 0x86, 0x2b, 0x6f, 0x8a, 0x1f, 0x3b, 0xa8, 0xe2, 0x51,
                   0x6e, 0x37, 0xc,  0x46, 0x65, 0x14, 0x96, 0x93, 0x34, 0x91, 0x6e, 0x28, 0xe1, 0x21, 0xe,
                   0xa2, 0x1f, 0x0,  0x5,  0xdf, 0xa3, 0xad, 0x29, 0x4c, 0x17, 0x8e, 0x88, 0x69, 0xb2, 0xef,
                   0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0,  0x6e, 0x4b, 0xbb};
  uint8_t topic_bytes[] = {0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                           0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x88, 0x69, 0xb2, 0xef, 0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0, 0x6e, 0x4b, 0xbb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0xe1, 0xe,  0x1c, 0xfb, 0x76, 0x42, 0xbe, 0x17, 0x80, 0x1e, 0x86, 0x2b, 0x6f, 0x8a, 0x1f,
                           0x3b, 0xa8, 0xe2, 0x51, 0x6e, 0x37, 0xc,  0x46, 0x65, 0x14, 0x96, 0x93, 0x34, 0x91, 0x6e};
  uint8_t bytesprops1[] = {0xdf, 0xa3, 0xad, 0x29, 0x4c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3746}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 142}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\148\134\&7\254W\239\197z\v\194\253\227\173o\163\251m\138", _pubPktID = 0, _pubBody =
// "\136i\178\239\188AL\167x\230\227\NULnK\187", _pubProps = [PropAssignedClientIdentifier
// "\225\SO\FS\251vB\190\ETB\128\RS\134+o\138\US;\168\226Qn7\fFe\DC4\150\147\&4\145n",PropWildcardSubscriptionAvailable
// 225,PropReceiveMaximum 3746,PropReasonString "\223\163\173)L",PropRequestProblemInformation 142]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x30, 0x54, 0x0,  0x12, 0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,  0xc2, 0xfd,
                   0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a, 0x30, 0x12, 0x0,  0x1e, 0xe1, 0xe,  0x1c, 0xfb,
                   0x76, 0x42, 0xbe, 0x17, 0x80, 0x1e, 0x86, 0x2b, 0x6f, 0x8a, 0x1f, 0x3b, 0xa8, 0xe2, 0x51,
                   0x6e, 0x37, 0xc,  0x46, 0x65, 0x14, 0x96, 0x93, 0x34, 0x91, 0x6e, 0x28, 0xe1, 0x21, 0xe,
                   0xa2, 0x1f, 0x0,  0x5,  0xdf, 0xa3, 0xad, 0x29, 0x4c, 0x17, 0x8e, 0x88, 0x69, 0xb2, 0xef,
                   0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0,  0x6e, 0x4b, 0xbb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x94, 0x86, 0x37, 0xfe, 0x57, 0xef, 0xc5, 0x7a, 0xb,
                               0xc2, 0xfd, 0xe3, 0xad, 0x6f, 0xa3, 0xfb, 0x6d, 0x8a};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x88, 0x69, 0xb2, 0xef, 0xbc, 0x41, 0x4c, 0xa7, 0x78, 0xe6, 0xe3, 0x0, 0x6e, 0x4b, 0xbb};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "V\DC1\RS\130\DLE\233\142\210e4%k~\132\153", _pubPktID = 0, _pubBody =
// "\200\ENQr=\212\221i\147\216\&3\ENQpG\250\147", _pubProps = [PropSessionExpiryInterval
// 29575,PropSubscriptionIdentifier 4,PropRequestResponseInformation 238,PropTopicAliasMaximum 7370,PropReceiveMaximum
// 13633,PropTopicAliasMaximum 8689,PropRequestProblemInformation 177,PropRetainAvailable 129,PropCorrelationData "
// z\224\136\241\DC4\164\173S\208\214\133f",PropPayloadFormatIndicator 196]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x30, 0x49, 0x0,  0xf,  0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25,
                   0x6b, 0x7e, 0x84, 0x99, 0x28, 0x11, 0x0,  0x0,  0x73, 0x87, 0xb,  0x4,  0x19, 0xee, 0x22,
                   0x1c, 0xca, 0x21, 0x35, 0x41, 0x22, 0x21, 0xf1, 0x17, 0xb1, 0x25, 0x81, 0x9,  0x0,  0xd,
                   0x20, 0x7a, 0xe0, 0x88, 0xf1, 0x14, 0xa4, 0xad, 0x53, 0xd0, 0xd6, 0x85, 0x66, 0x1,  0xc4,
                   0xc8, 0x5,  0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5,  0x70, 0x47, 0xfa, 0x93};
  uint8_t topic_bytes[] = {0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25, 0x6b, 0x7e, 0x84, 0x99};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5, 0x70, 0x47, 0xfa, 0x93};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x20, 0x7a, 0xe0, 0x88, 0xf1, 0x14, 0xa4, 0xad, 0x53, 0xd0, 0xd6, 0x85, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29575}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7370}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13633}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8689}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "V\DC1\RS\130\DLE\233\142\210e4%k~\132\153", _pubPktID = 0, _pubBody =
// "\200\ENQr=\212\221i\147\216\&3\ENQpG\250\147", _pubProps = [PropSessionExpiryInterval
// 29575,PropSubscriptionIdentifier 4,PropRequestResponseInformation 238,PropTopicAliasMaximum 7370,PropReceiveMaximum
// 13633,PropTopicAliasMaximum 8689,PropRequestProblemInformation 177,PropRetainAvailable 129,PropCorrelationData "
// z\224\136\241\DC4\164\173S\208\214\133f",PropPayloadFormatIndicator 196]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x30, 0x49, 0x0,  0xf,  0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2, 0x65, 0x34, 0x25,
                   0x6b, 0x7e, 0x84, 0x99, 0x28, 0x11, 0x0,  0x0,  0x73, 0x87, 0xb,  0x4,  0x19, 0xee, 0x22,
                   0x1c, 0xca, 0x21, 0x35, 0x41, 0x22, 0x21, 0xf1, 0x17, 0xb1, 0x25, 0x81, 0x9,  0x0,  0xd,
                   0x20, 0x7a, 0xe0, 0x88, 0xf1, 0x14, 0xa4, 0xad, 0x53, 0xd0, 0xd6, 0x85, 0x66, 0x1,  0xc4,
                   0xc8, 0x5,  0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5,  0x70, 0x47, 0xfa, 0x93};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x11, 0x1e, 0x82, 0x10, 0xe9, 0x8e, 0xd2,
                               0x65, 0x34, 0x25, 0x6b, 0x7e, 0x84, 0x99};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc8, 0x5, 0x72, 0x3d, 0xd4, 0xdd, 0x69, 0x93, 0xd8, 0x33, 0x5, 0x70, 0x47, 0xfa, 0x93};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\160\NAK\234\249\209\141\136\198?\243\245hW6\199=`\243C|RQ\216v@\r", _pubPktID = 19217, _pubBody =
// "\212m\146de\171\221qv\142\228\171\234S7\162", _pubProps = [PropWillDelayInterval 18386,PropResponseInformation
// "\161\147\SOH\213o-\142\SO\193Kj\ACK\NAK\159\EM\SI\DC3Cz\ENQ\160\213H\173.\202\222Z\161",PropReasonString
// "\228wh?P\146\151\206\ETB\243SQ]\139D\173\183\132o",PropPayloadFormatIndicator 204,PropAuthenticationData
// "J\195\132\220\FS|\252<\153\147\ENQ\SUBo\225",PropAuthenticationData "\228\156\aHyS\251\241",PropServerKeepAlive
// 6048,PropServerKeepAlive 2861,PropReasonString "\154\&9\243\134\155\DC1]\171\&2",PropContentType
// "\191\193s\148\201\&2\246\&4\167\134\205vH;\205\186kO\ETX\168R\218\149",PropAuthenticationMethod
// "\ENQ`75\185\212\FSo\228\"\GS\196t\206\DC1\SYN\133s.q\141\132\STX\SYN\200\235r\135\176",PropRequestProblemInformation
// 187,PropSubscriptionIdentifier 3,PropMaximumPacketSize 21510,PropMessageExpiryInterval
// 28380,PropMessageExpiryInterval 16492,PropSubscriptionIdentifierAvailable 85,PropWildcardSubscriptionAvailable
// 173,PropMessageExpiryInterval 17645,PropContentType
// "W\226>\SUB\145\FS\US\202\207\164\128\196\249\212\172X[\202\RS\198\157\217\EM",PropCorrelationData
// "k\210\192J",PropRequestResponseInformation 169,PropWillDelayInterval 3416,PropMessageExpiryInterval
// 24592,PropSubscriptionIdentifier 27,PropSubscriptionIdentifier 28]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x34, 0xa2, 0x2,  0x0,  0x1a, 0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57, 0x36,
      0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd,  0x4b, 0x11, 0xf2, 0x1,  0x18, 0x0,  0x0,
      0x47, 0xd2, 0x1a, 0x0,  0x1d, 0xa1, 0x93, 0x1,  0xd5, 0x6f, 0x2d, 0x8e, 0xe,  0xc1, 0x4b, 0x6a, 0x6,  0x15, 0x9f,
      0x19, 0xf,  0x13, 0x43, 0x7a, 0x5,  0xa0, 0xd5, 0x48, 0xad, 0x2e, 0xca, 0xde, 0x5a, 0xa1, 0x1f, 0x0,  0x13, 0xe4,
      0x77, 0x68, 0x3f, 0x50, 0x92, 0x97, 0xce, 0x17, 0xf3, 0x53, 0x51, 0x5d, 0x8b, 0x44, 0xad, 0xb7, 0x84, 0x6f, 0x1,
      0xcc, 0x16, 0x0,  0xe,  0x4a, 0xc3, 0x84, 0xdc, 0x1c, 0x7c, 0xfc, 0x3c, 0x99, 0x93, 0x5,  0x1a, 0x6f, 0xe1, 0x16,
      0x0,  0x8,  0xe4, 0x9c, 0x7,  0x48, 0x79, 0x53, 0xfb, 0xf1, 0x13, 0x17, 0xa0, 0x13, 0xb,  0x2d, 0x1f, 0x0,  0x9,
      0x9a, 0x39, 0xf3, 0x86, 0x9b, 0x11, 0x5d, 0xab, 0x32, 0x3,  0x0,  0x17, 0xbf, 0xc1, 0x73, 0x94, 0xc9, 0x32, 0xf6,
      0x34, 0xa7, 0x86, 0xcd, 0x76, 0x48, 0x3b, 0xcd, 0xba, 0x6b, 0x4f, 0x3,  0xa8, 0x52, 0xda, 0x95, 0x15, 0x0,  0x1d,
      0x5,  0x60, 0x37, 0x35, 0xb9, 0xd4, 0x1c, 0x6f, 0xe4, 0x22, 0x1d, 0xc4, 0x74, 0xce, 0x11, 0x16, 0x85, 0x73, 0x2e,
      0x71, 0x8d, 0x84, 0x2,  0x16, 0xc8, 0xeb, 0x72, 0x87, 0xb0, 0x17, 0xbb, 0xb,  0x3,  0x27, 0x0,  0x0,  0x54, 0x6,
      0x2,  0x0,  0x0,  0x6e, 0xdc, 0x2,  0x0,  0x0,  0x40, 0x6c, 0x29, 0x55, 0x28, 0xad, 0x2,  0x0,  0x0,  0x44, 0xed,
      0x3,  0x0,  0x17, 0x57, 0xe2, 0x3e, 0x1a, 0x91, 0x1c, 0x1f, 0xca, 0xcf, 0xa4, 0x80, 0xc4, 0xf9, 0xd4, 0xac, 0x58,
      0x5b, 0xca, 0x1e, 0xc6, 0x9d, 0xd9, 0x19, 0x9,  0x0,  0x4,  0x6b, 0xd2, 0xc0, 0x4a, 0x19, 0xa9, 0x18, 0x0,  0x0,
      0xd,  0x58, 0x2,  0x0,  0x0,  0x60, 0x10, 0xb,  0x1b, 0xb,  0x1c, 0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
      0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  uint8_t topic_bytes[] = {0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57,
                           0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
                         0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0xa1, 0x93, 0x1,  0xd5, 0x6f, 0x2d, 0x8e, 0xe,  0xc1, 0x4b, 0x6a, 0x6,  0x15, 0x9f, 0x19,
                           0xf,  0x13, 0x43, 0x7a, 0x5,  0xa0, 0xd5, 0x48, 0xad, 0x2e, 0xca, 0xde, 0x5a, 0xa1};
  uint8_t bytesprops1[] = {0xe4, 0x77, 0x68, 0x3f, 0x50, 0x92, 0x97, 0xce, 0x17, 0xf3,
                           0x53, 0x51, 0x5d, 0x8b, 0x44, 0xad, 0xb7, 0x84, 0x6f};
  uint8_t bytesprops2[] = {0x4a, 0xc3, 0x84, 0xdc, 0x1c, 0x7c, 0xfc, 0x3c, 0x99, 0x93, 0x5, 0x1a, 0x6f, 0xe1};
  uint8_t bytesprops3[] = {0xe4, 0x9c, 0x7, 0x48, 0x79, 0x53, 0xfb, 0xf1};
  uint8_t bytesprops4[] = {0x9a, 0x39, 0xf3, 0x86, 0x9b, 0x11, 0x5d, 0xab, 0x32};
  uint8_t bytesprops5[] = {0xbf, 0xc1, 0x73, 0x94, 0xc9, 0x32, 0xf6, 0x34, 0xa7, 0x86, 0xcd, 0x76,
                           0x48, 0x3b, 0xcd, 0xba, 0x6b, 0x4f, 0x3,  0xa8, 0x52, 0xda, 0x95};
  uint8_t bytesprops6[] = {0x5,  0x60, 0x37, 0x35, 0xb9, 0xd4, 0x1c, 0x6f, 0xe4, 0x22, 0x1d, 0xc4, 0x74, 0xce, 0x11,
                           0x16, 0x85, 0x73, 0x2e, 0x71, 0x8d, 0x84, 0x2,  0x16, 0xc8, 0xeb, 0x72, 0x87, 0xb0};
  uint8_t bytesprops7[] = {0x57, 0xe2, 0x3e, 0x1a, 0x91, 0x1c, 0x1f, 0xca, 0xcf, 0xa4, 0x80, 0xc4,
                           0xf9, 0xd4, 0xac, 0x58, 0x5b, 0xca, 0x1e, 0xc6, 0x9d, 0xd9, 0x19};
  uint8_t bytesprops8[] = {0x6b, 0xd2, 0xc0, 0x4a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18386}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6048}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2861}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21510}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28380}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16492}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17645}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3416}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24592}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19217, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\160\NAK\234\249\209\141\136\198?\243\245hW6\199=`\243C|RQ\216v@\r", _pubPktID = 19217, _pubBody =
// "\212m\146de\171\221qv\142\228\171\234S7\162", _pubProps = [PropWillDelayInterval 18386,PropResponseInformation
// "\161\147\SOH\213o-\142\SO\193Kj\ACK\NAK\159\EM\SI\DC3Cz\ENQ\160\213H\173.\202\222Z\161",PropReasonString
// "\228wh?P\146\151\206\ETB\243SQ]\139D\173\183\132o",PropPayloadFormatIndicator 204,PropAuthenticationData
// "J\195\132\220\FS|\252<\153\147\ENQ\SUBo\225",PropAuthenticationData "\228\156\aHyS\251\241",PropServerKeepAlive
// 6048,PropServerKeepAlive 2861,PropReasonString "\154\&9\243\134\155\DC1]\171\&2",PropContentType
// "\191\193s\148\201\&2\246\&4\167\134\205vH;\205\186kO\ETX\168R\218\149",PropAuthenticationMethod
// "\ENQ`75\185\212\FSo\228\"\GS\196t\206\DC1\SYN\133s.q\141\132\STX\SYN\200\235r\135\176",PropRequestProblemInformation
// 187,PropSubscriptionIdentifier 3,PropMaximumPacketSize 21510,PropMessageExpiryInterval
// 28380,PropMessageExpiryInterval 16492,PropSubscriptionIdentifierAvailable 85,PropWildcardSubscriptionAvailable
// 173,PropMessageExpiryInterval 17645,PropContentType
// "W\226>\SUB\145\FS\US\202\207\164\128\196\249\212\172X[\202\RS\198\157\217\EM",PropCorrelationData
// "k\210\192J",PropRequestResponseInformation 169,PropWillDelayInterval 3416,PropMessageExpiryInterval
// 24592,PropSubscriptionIdentifier 27,PropSubscriptionIdentifier 28]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {
      0x34, 0xa2, 0x2,  0x0,  0x1a, 0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57, 0x36,
      0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd,  0x4b, 0x11, 0xf2, 0x1,  0x18, 0x0,  0x0,
      0x47, 0xd2, 0x1a, 0x0,  0x1d, 0xa1, 0x93, 0x1,  0xd5, 0x6f, 0x2d, 0x8e, 0xe,  0xc1, 0x4b, 0x6a, 0x6,  0x15, 0x9f,
      0x19, 0xf,  0x13, 0x43, 0x7a, 0x5,  0xa0, 0xd5, 0x48, 0xad, 0x2e, 0xca, 0xde, 0x5a, 0xa1, 0x1f, 0x0,  0x13, 0xe4,
      0x77, 0x68, 0x3f, 0x50, 0x92, 0x97, 0xce, 0x17, 0xf3, 0x53, 0x51, 0x5d, 0x8b, 0x44, 0xad, 0xb7, 0x84, 0x6f, 0x1,
      0xcc, 0x16, 0x0,  0xe,  0x4a, 0xc3, 0x84, 0xdc, 0x1c, 0x7c, 0xfc, 0x3c, 0x99, 0x93, 0x5,  0x1a, 0x6f, 0xe1, 0x16,
      0x0,  0x8,  0xe4, 0x9c, 0x7,  0x48, 0x79, 0x53, 0xfb, 0xf1, 0x13, 0x17, 0xa0, 0x13, 0xb,  0x2d, 0x1f, 0x0,  0x9,
      0x9a, 0x39, 0xf3, 0x86, 0x9b, 0x11, 0x5d, 0xab, 0x32, 0x3,  0x0,  0x17, 0xbf, 0xc1, 0x73, 0x94, 0xc9, 0x32, 0xf6,
      0x34, 0xa7, 0x86, 0xcd, 0x76, 0x48, 0x3b, 0xcd, 0xba, 0x6b, 0x4f, 0x3,  0xa8, 0x52, 0xda, 0x95, 0x15, 0x0,  0x1d,
      0x5,  0x60, 0x37, 0x35, 0xb9, 0xd4, 0x1c, 0x6f, 0xe4, 0x22, 0x1d, 0xc4, 0x74, 0xce, 0x11, 0x16, 0x85, 0x73, 0x2e,
      0x71, 0x8d, 0x84, 0x2,  0x16, 0xc8, 0xeb, 0x72, 0x87, 0xb0, 0x17, 0xbb, 0xb,  0x3,  0x27, 0x0,  0x0,  0x54, 0x6,
      0x2,  0x0,  0x0,  0x6e, 0xdc, 0x2,  0x0,  0x0,  0x40, 0x6c, 0x29, 0x55, 0x28, 0xad, 0x2,  0x0,  0x0,  0x44, 0xed,
      0x3,  0x0,  0x17, 0x57, 0xe2, 0x3e, 0x1a, 0x91, 0x1c, 0x1f, 0xca, 0xcf, 0xa4, 0x80, 0xc4, 0xf9, 0xd4, 0xac, 0x58,
      0x5b, 0xca, 0x1e, 0xc6, 0x9d, 0xd9, 0x19, 0x9,  0x0,  0x4,  0x6b, 0xd2, 0xc0, 0x4a, 0x19, 0xa9, 0x18, 0x0,  0x0,
      0xd,  0x58, 0x2,  0x0,  0x0,  0x60, 0x10, 0xb,  0x1b, 0xb,  0x1c, 0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
      0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa0, 0x15, 0xea, 0xf9, 0xd1, 0x8d, 0x88, 0xc6, 0x3f, 0xf3, 0xf5, 0x68, 0x57,
                               0x36, 0xc7, 0x3d, 0x60, 0xf3, 0x43, 0x7c, 0x52, 0x51, 0xd8, 0x76, 0x40, 0xd};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd4, 0x6d, 0x92, 0x64, 0x65, 0xab, 0xdd, 0x71,
                              0x76, 0x8e, 0xe4, 0xab, 0xea, 0x53, 0x37, 0xa2};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 19217);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\207", _willMsg = "\237/\240\202>-v\139\210<\241\SOHK\239\SOHIk\183\205++\149GL\188\237\202",
// _willProps = []}), _cleanSession = True, _keepAlive = 14123, _connID =
// "\250\245\195\140\229m`\ETX\CAN9\SYN\SUBhP\159\204\202f\SOH\177f-\239", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x37, 0x2b, 0x0,  0x17,
                   0xfa, 0xf5, 0xc3, 0x8c, 0xe5, 0x6d, 0x60, 0x3,  0x18, 0x39, 0x16, 0x1a, 0x68, 0x50,
                   0x9f, 0xcc, 0xca, 0x66, 0x1,  0xb1, 0x66, 0x2d, 0xef, 0x0,  0x1,  0xcf, 0x0,  0x1b,
                   0xed, 0x2f, 0xf0, 0xca, 0x3e, 0x2d, 0x76, 0x8b, 0xd2, 0x3c, 0xf1, 0x1,  0x4b, 0xef,
                   0x1,  0x49, 0x6b, 0xb7, 0xcd, 0x2b, 0x2b, 0x95, 0x47, 0x4c, 0xbc, 0xed, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcf};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xed, 0x2f, 0xf0, 0xca, 0x3e, 0x2d, 0x76, 0x8b, 0xd2, 0x3c, 0xf1, 0x1,  0x4b, 0xef,
                                  0x1,  0x49, 0x6b, 0xb7, 0xcd, 0x2b, 0x2b, 0x95, 0x47, 0x4c, 0xbc, 0xed, 0xca};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14123;
  uint8_t client_id_bytes[] = {0xfa, 0xf5, 0xc3, 0x8c, 0xe5, 0x6d, 0x60, 0x3,  0x18, 0x39, 0x16, 0x1a,
                               0x68, 0x50, 0x9f, 0xcc, 0xca, 0x66, 0x1,  0xb1, 0x66, 0x2d, 0xef};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\v\155$4", _password = Just "\SUB\f~0\216\NAKr)Qx3B6E\SO\214\193", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 2824, _connID =
// "\151'V\147\201r\NAK\243\154p\179\129\"9\bk$\156#\v\157\187\150x\CAN2\217", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0xb,  0x8,  0x0,  0x1b, 0x97, 0x27, 0x56,
                   0x93, 0xc9, 0x72, 0x15, 0xf3, 0x9a, 0x70, 0xb3, 0x81, 0x22, 0x39, 0x8,  0x6b, 0x24, 0x9c, 0x23, 0xb,
                   0x9d, 0xbb, 0x96, 0x78, 0x18, 0x32, 0xd9, 0x0,  0x4,  0xb,  0x9b, 0x24, 0x34, 0x0,  0x11, 0x1a, 0xc,
                   0x7e, 0x30, 0xd8, 0x15, 0x72, 0x29, 0x51, 0x78, 0x33, 0x42, 0x36, 0x45, 0xe,  0xd6, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2824;
  uint8_t client_id_bytes[] = {0x97, 0x27, 0x56, 0x93, 0xc9, 0x72, 0x15, 0xf3, 0x9a, 0x70, 0xb3, 0x81, 0x22, 0x39,
                               0x8,  0x6b, 0x24, 0x9c, 0x23, 0xb,  0x9d, 0xbb, 0x96, 0x78, 0x18, 0x32, 0xd9};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb, 0x9b, 0x24, 0x34};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1a, 0xc,  0x7e, 0x30, 0xd8, 0x15, 0x72, 0x29, 0x51,
                              0x78, 0x33, 0x42, 0x36, 0x45, 0xe,  0xd6, 0xc1};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "5kK\NUL\RS-\163\145\193\178\170I\198\175\DEL$\176\\\DLEo\DC46", _willMsg =
// "&\155\228\DC3\235\180\DC4#\220\198R\206\178[\NAK\149_\245\206\172\NUL\204\US\211UA", _willProps = []}),
// _cleanSession = True, _keepAlive = 32140, _connID = "vC\248\155\177\213g]\198", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x7d, 0x8c, 0x0,  0x9,  0x76,
                   0x43, 0xf8, 0x9b, 0xb1, 0xd5, 0x67, 0x5d, 0xc6, 0x0,  0x16, 0x35, 0x6b, 0x4b, 0x0,  0x1e,
                   0x2d, 0xa3, 0x91, 0xc1, 0xb2, 0xaa, 0x49, 0xc6, 0xaf, 0x7f, 0x24, 0xb0, 0x5c, 0x10, 0x6f,
                   0x14, 0x36, 0x0,  0x1a, 0x26, 0x9b, 0xe4, 0x13, 0xeb, 0xb4, 0x14, 0x23, 0xdc, 0xc6, 0x52,
                   0xce, 0xb2, 0x5b, 0x15, 0x95, 0x5f, 0xf5, 0xce, 0xac, 0x0,  0xcc, 0x1f, 0xd3, 0x55, 0x41};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x6b, 0x4b, 0x0,  0x1e, 0x2d, 0xa3, 0x91, 0xc1, 0xb2, 0xaa,
                                0x49, 0xc6, 0xaf, 0x7f, 0x24, 0xb0, 0x5c, 0x10, 0x6f, 0x14, 0x36};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x26, 0x9b, 0xe4, 0x13, 0xeb, 0xb4, 0x14, 0x23, 0xdc, 0xc6, 0x52, 0xce, 0xb2,
                                  0x5b, 0x15, 0x95, 0x5f, 0xf5, 0xce, 0xac, 0x0,  0xcc, 0x1f, 0xd3, 0x55, 0x41};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 32140;
  uint8_t client_id_bytes[] = {0x76, 0x43, 0xf8, 0x9b, 0xb1, 0xd5, 0x67, 0x5d, 0xc6};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\181\188RC|\DELPc[\242A\194\140G\NAK\CANu\DC4\178\213\DC4",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "\249=\212\228i\201\&4\178&\RS)\DC4|\174\242w \201", _willMsg =
// "@\162c\242\CAN\208f\191d\161\222\184@fP\222\&7\204\176\212\227_\166\242\155W<\DC43", _willProps = []}),
// _cleanSession = True, _keepAlive = 8577, _connID =
// "\246\235\226\ACK\SI+\255\134\137\158\247\158\138X\147\188\139\218-\154", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x21, 0x81, 0x0,  0x14, 0xf6,
                   0xeb, 0xe2, 0x6,  0xf,  0x2b, 0xff, 0x86, 0x89, 0x9e, 0xf7, 0x9e, 0x8a, 0x58, 0x93, 0xbc,
                   0x8b, 0xda, 0x2d, 0x9a, 0x0,  0x12, 0xf9, 0x3d, 0xd4, 0xe4, 0x69, 0xc9, 0x34, 0xb2, 0x26,
                   0x1e, 0x29, 0x14, 0x7c, 0xae, 0xf2, 0x77, 0x20, 0xc9, 0x0,  0x1d, 0x40, 0xa2, 0x63, 0xf2,
                   0x18, 0xd0, 0x66, 0xbf, 0x64, 0xa1, 0xde, 0xb8, 0x40, 0x66, 0x50, 0xde, 0x37, 0xcc, 0xb0,
                   0xd4, 0xe3, 0x5f, 0xa6, 0xf2, 0x9b, 0x57, 0x3c, 0x14, 0x33};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf9, 0x3d, 0xd4, 0xe4, 0x69, 0xc9, 0x34, 0xb2, 0x26,
                                0x1e, 0x29, 0x14, 0x7c, 0xae, 0xf2, 0x77, 0x20, 0xc9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0xa2, 0x63, 0xf2, 0x18, 0xd0, 0x66, 0xbf, 0x64, 0xa1,
                                  0xde, 0xb8, 0x40, 0x66, 0x50, 0xde, 0x37, 0xcc, 0xb0, 0xd4,
                                  0xe3, 0x5f, 0xa6, 0xf2, 0x9b, 0x57, 0x3c, 0x14, 0x33};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8577;
  uint8_t client_id_bytes[] = {0xf6, 0xeb, 0xe2, 0x6,  0xf,  0x2b, 0xff, 0x86, 0x89, 0x9e,
                               0xf7, 0x9e, 0x8a, 0x58, 0x93, 0xbc, 0x8b, 0xda, 0x2d, 0x9a};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb5, 0xbc, 0x52, 0x43, 0x7c, 0x7f, 0x50, 0x63, 0x5b, 0xf2, 0x41,
                              0xc2, 0x8c, 0x47, 0x15, 0x18, 0x75, 0x14, 0xb2, 0xd5, 0x14};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETB\185M\SUB\222\149", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\128\ETB\EOT\205\173", _willMsg =
// "\198\DC3l\140\230R!E$\SOH\229o,x\187~\139\202\"\DC4V\ACK)", _willProps = []}), _cleanSession = False, _keepAlive =
// 3023, _connID = "]l\128mk1J\129p\141\170Rw\178\NUL\171w\196\n", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0xb,  0xcf, 0x0,  0x13, 0x5d,
                   0x6c, 0x80, 0x6d, 0x6b, 0x31, 0x4a, 0x81, 0x70, 0x8d, 0xaa, 0x52, 0x77, 0xb2, 0x0,  0xab,
                   0x77, 0xc4, 0xa,  0x0,  0x5,  0x80, 0x17, 0x4,  0xcd, 0xad, 0x0,  0x17, 0xc6, 0x13, 0x6c,
                   0x8c, 0xe6, 0x52, 0x21, 0x45, 0x24, 0x1,  0xe5, 0x6f, 0x2c, 0x78, 0xbb, 0x7e, 0x8b, 0xca,
                   0x22, 0x14, 0x56, 0x6,  0x29, 0x0,  0x6,  0x17, 0xb9, 0x4d, 0x1a, 0xde, 0x95};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0x17, 0x4, 0xcd, 0xad};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc6, 0x13, 0x6c, 0x8c, 0xe6, 0x52, 0x21, 0x45, 0x24, 0x1, 0xe5, 0x6f,
                                  0x2c, 0x78, 0xbb, 0x7e, 0x8b, 0xca, 0x22, 0x14, 0x56, 0x6, 0x29};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3023;
  uint8_t client_id_bytes[] = {0x5d, 0x6c, 0x80, 0x6d, 0x6b, 0x31, 0x4a, 0x81, 0x70, 0x8d,
                               0xaa, 0x52, 0x77, 0xb2, 0x0,  0xab, 0x77, 0xc4, 0xa};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x17, 0xb9, 0x4d, 0x1a, 0xde, 0x95};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\FS\ACK\249\148\r\158\162\&8uP\173\212\135\254\214", _password = Just
// "\234\199:\176j\218\226\193U\206-\f\SOHRuz\167\199\196", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\176\DEL\SOH\132>\247\149\GSx", _willMsg =
// "\247Wdo3\141\135\211r\DC4B\b3\225<\247Y7\136\134\&5O\183", _willProps = []}), _cleanSession = True, _keepAlive =
// 13117, _connID = "\226s\168\NUL\201\208\250\224\r\SOZ\221X<[&\\\181\184?\168\RS", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x6c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x33, 0x3d, 0x0,  0x16, 0xe2, 0x73,
                   0xa8, 0x0,  0xc9, 0xd0, 0xfa, 0xe0, 0xd,  0xe,  0x5a, 0xdd, 0x58, 0x3c, 0x5b, 0x26, 0x5c, 0xb5,
                   0xb8, 0x3f, 0xa8, 0x1e, 0x0,  0x9,  0xb0, 0x7f, 0x1,  0x84, 0x3e, 0xf7, 0x95, 0x1d, 0x78, 0x0,
                   0x17, 0xf7, 0x57, 0x64, 0x6f, 0x33, 0x8d, 0x87, 0xd3, 0x72, 0x14, 0x42, 0x8,  0x33, 0xe1, 0x3c,
                   0xf7, 0x59, 0x37, 0x88, 0x86, 0x35, 0x4f, 0xb7, 0x0,  0xf,  0x1c, 0x6,  0xf9, 0x94, 0xd,  0x9e,
                   0xa2, 0x38, 0x75, 0x50, 0xad, 0xd4, 0x87, 0xfe, 0xd6, 0x0,  0x13, 0xea, 0xc7, 0x3a, 0xb0, 0x6a,
                   0xda, 0xe2, 0xc1, 0x55, 0xce, 0x2d, 0xc,  0x1,  0x52, 0x75, 0x7a, 0xa7, 0xc7, 0xc4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb0, 0x7f, 0x1, 0x84, 0x3e, 0xf7, 0x95, 0x1d, 0x78};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf7, 0x57, 0x64, 0x6f, 0x33, 0x8d, 0x87, 0xd3, 0x72, 0x14, 0x42, 0x8,
                                  0x33, 0xe1, 0x3c, 0xf7, 0x59, 0x37, 0x88, 0x86, 0x35, 0x4f, 0xb7};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13117;
  uint8_t client_id_bytes[] = {0xe2, 0x73, 0xa8, 0x0,  0xc9, 0xd0, 0xfa, 0xe0, 0xd,  0xe,  0x5a,
                               0xdd, 0x58, 0x3c, 0x5b, 0x26, 0x5c, 0xb5, 0xb8, 0x3f, 0xa8, 0x1e};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1c, 0x6, 0xf9, 0x94, 0xd, 0x9e, 0xa2, 0x38, 0x75, 0x50, 0xad, 0xd4, 0x87, 0xfe, 0xd6};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xea, 0xc7, 0x3a, 0xb0, 0x6a, 0xda, 0xe2, 0xc1, 0x55, 0xce,
                              0x2d, 0xc,  0x1,  0x52, 0x75, 0x7a, 0xa7, 0xc7, 0xc4};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245H3\185\249\128\172\213o\226N@\DC1", _password = Just
// "\171\195S\150\179\183\184\247*\177\211j.\227\239\199\SUB\r\187\131L\SYN\CAN\239\f\152", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "%W", _willMsg = "l\CAN\147R\DC3", _willProps = []}),
// _cleanSession = True, _keepAlive = 18606, _connID = "6", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x48, 0xae, 0x0,  0x1,
                   0x36, 0x0,  0x2,  0x25, 0x57, 0x0,  0x5,  0x6c, 0x18, 0x93, 0x52, 0x13, 0x0,  0xd,
                   0xf5, 0x48, 0x33, 0xb9, 0xf9, 0x80, 0xac, 0xd5, 0x6f, 0xe2, 0x4e, 0x40, 0x11, 0x0,
                   0x1a, 0xab, 0xc3, 0x53, 0x96, 0xb3, 0xb7, 0xb8, 0xf7, 0x2a, 0xb1, 0xd3, 0x6a, 0x2e,
                   0xe3, 0xef, 0xc7, 0x1a, 0xd,  0xbb, 0x83, 0x4c, 0x16, 0x18, 0xef, 0xc,  0x98};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x25, 0x57};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6c, 0x18, 0x93, 0x52, 0x13};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18606;
  uint8_t client_id_bytes[] = {0x36};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0x48, 0x33, 0xb9, 0xf9, 0x80, 0xac, 0xd5, 0x6f, 0xe2, 0x4e, 0x40, 0x11};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xab, 0xc3, 0x53, 0x96, 0xb3, 0xb7, 0xb8, 0xf7, 0x2a, 0xb1, 0xd3, 0x6a, 0x2e,
                              0xe3, 0xef, 0xc7, 0x1a, 0xd,  0xbb, 0x83, 0x4c, 0x16, 0x18, 0xef, 0xc,  0x98};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\164\ESC\184\140r\249\243:~\182\177\161", _password = Just
// "=\137\152\193\FS\138\CAN\SO\GS\172=$\179\178=\227\216>", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\196", _willMsg = "\189\206O\203\f\146\165\155D\200N\207\198\169;$\242\244\228", _willProps =
// []}), _cleanSession = True, _keepAlive = 14044, _connID = "\158\230\170S\NUL\239\ETB", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x4d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x36, 0xdc, 0x0,  0x7,  0x9e, 0xe6,
                   0xaa, 0x53, 0x0,  0xef, 0x17, 0x0,  0x1,  0xc4, 0x0,  0x13, 0xbd, 0xce, 0x4f, 0xcb, 0xc,  0x92,
                   0xa5, 0x9b, 0x44, 0xc8, 0x4e, 0xcf, 0xc6, 0xa9, 0x3b, 0x24, 0xf2, 0xf4, 0xe4, 0x0,  0xc,  0xa4,
                   0x1b, 0xb8, 0x8c, 0x72, 0xf9, 0xf3, 0x3a, 0x7e, 0xb6, 0xb1, 0xa1, 0x0,  0x12, 0x3d, 0x89, 0x98,
                   0xc1, 0x1c, 0x8a, 0x18, 0xe,  0x1d, 0xac, 0x3d, 0x24, 0xb3, 0xb2, 0x3d, 0xe3, 0xd8, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0xce, 0x4f, 0xcb, 0xc,  0x92, 0xa5, 0x9b, 0x44, 0xc8,
                                  0x4e, 0xcf, 0xc6, 0xa9, 0x3b, 0x24, 0xf2, 0xf4, 0xe4};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14044;
  uint8_t client_id_bytes[] = {0x9e, 0xe6, 0xaa, 0x53, 0x0, 0xef, 0x17};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa4, 0x1b, 0xb8, 0x8c, 0x72, 0xf9, 0xf3, 0x3a, 0x7e, 0xb6, 0xb1, 0xa1};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3d, 0x89, 0x98, 0xc1, 0x1c, 0x8a, 0x18, 0xe,  0x1d,
                              0xac, 0x3d, 0x24, 0xb3, 0xb2, 0x3d, 0xe3, 0xd8, 0x3e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "bl\173\212\183[K\243\204\225\r\255\210,\215\200\142\&1\181\SOH8\206\168", _password
// = Just "\NUL. m\211I\167\170\222\224%\253#\246", _lastWill = Nothing, _cleanSession = False, _keepAlive = 24572,
// _connID = "\182$y\234\226\247:S\142\"\245_\255\&0\203\191_\249P\SUB8\223\190]0\182\ETBg<", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x52, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x5f, 0xfc, 0x0,  0x1d, 0xb6, 0x24, 0x79,
                   0xea, 0xe2, 0xf7, 0x3a, 0x53, 0x8e, 0x22, 0xf5, 0x5f, 0xff, 0x30, 0xcb, 0xbf, 0x5f, 0xf9, 0x50, 0x1a,
                   0x38, 0xdf, 0xbe, 0x5d, 0x30, 0xb6, 0x17, 0x67, 0x3c, 0x0,  0x17, 0x62, 0x6c, 0xad, 0xd4, 0xb7, 0x5b,
                   0x4b, 0xf3, 0xcc, 0xe1, 0xd,  0xff, 0xd2, 0x2c, 0xd7, 0xc8, 0x8e, 0x31, 0xb5, 0x1,  0x38, 0xce, 0xa8,
                   0x0,  0xe,  0x0,  0x2e, 0x20, 0x6d, 0xd3, 0x49, 0xa7, 0xaa, 0xde, 0xe0, 0x25, 0xfd, 0x23, 0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24572;
  uint8_t client_id_bytes[] = {0xb6, 0x24, 0x79, 0xea, 0xe2, 0xf7, 0x3a, 0x53, 0x8e, 0x22, 0xf5, 0x5f, 0xff, 0x30, 0xcb,
                               0xbf, 0x5f, 0xf9, 0x50, 0x1a, 0x38, 0xdf, 0xbe, 0x5d, 0x30, 0xb6, 0x17, 0x67, 0x3c};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x62, 0x6c, 0xad, 0xd4, 0xb7, 0x5b, 0x4b, 0xf3, 0xcc, 0xe1, 0xd, 0xff,
                              0xd2, 0x2c, 0xd7, 0xc8, 0x8e, 0x31, 0xb5, 0x1,  0x38, 0xce, 0xa8};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x0, 0x2e, 0x20, 0x6d, 0xd3, 0x49, 0xa7, 0xaa, 0xde, 0xe0, 0x25, 0xfd, 0x23, 0xf6};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "=\CANt\155_d\FS\f:\252", _password = Just "J\175\SI\188\240", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\181\230\197Xq\187C@;P\208\&1\CAN\191\152w[\185`UI\CAN", _willMsg = "\151\DC4y'PM^\214\&0<^k\179\179:|", _willProps
// = []}), _cleanSession = False, _keepAlive = 147, _connID = "\252{\206-]\238\&1\253 \RS\SIy\178", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x56, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x0,  0x93, 0x0,  0xd,  0xfc,
                   0x7b, 0xce, 0x2d, 0x5d, 0xee, 0x31, 0xfd, 0x20, 0x1e, 0xf,  0x79, 0xb2, 0x0,  0x16, 0xb5,
                   0xe6, 0xc5, 0x58, 0x71, 0xbb, 0x43, 0x40, 0x3b, 0x50, 0xd0, 0x31, 0x18, 0xbf, 0x98, 0x77,
                   0x5b, 0xb9, 0x60, 0x55, 0x49, 0x18, 0x0,  0x10, 0x97, 0x14, 0x79, 0x27, 0x50, 0x4d, 0x5e,
                   0xd6, 0x30, 0x3c, 0x5e, 0x6b, 0xb3, 0xb3, 0x3a, 0x7c, 0x0,  0xa,  0x3d, 0x18, 0x74, 0x9b,
                   0x5f, 0x64, 0x1c, 0xc,  0x3a, 0xfc, 0x0,  0x5,  0x4a, 0xaf, 0xf,  0xbc, 0xf0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0xe6, 0xc5, 0x58, 0x71, 0xbb, 0x43, 0x40, 0x3b, 0x50, 0xd0,
                                0x31, 0x18, 0xbf, 0x98, 0x77, 0x5b, 0xb9, 0x60, 0x55, 0x49, 0x18};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0x14, 0x79, 0x27, 0x50, 0x4d, 0x5e, 0xd6,
                                  0x30, 0x3c, 0x5e, 0x6b, 0xb3, 0xb3, 0x3a, 0x7c};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 147;
  uint8_t client_id_bytes[] = {0xfc, 0x7b, 0xce, 0x2d, 0x5d, 0xee, 0x31, 0xfd, 0x20, 0x1e, 0xf, 0x79, 0xb2};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3d, 0x18, 0x74, 0x9b, 0x5f, 0x64, 0x1c, 0xc, 0x3a, 0xfc};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4a, 0xaf, 0xf, 0xbc, 0xf0};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\207", _willMsg = "\237/\240\202>-v\139\210<\241\SOHK\239\SOHIk\183\205++\149GL\188\237\202",
// _willProps = [PropAuthenticationData "\141\155\&1z\248\251\RS\248#\160\153\235\152",PropServerKeepAlive
// 8955,PropResponseInformation "\"|\207\189\138",PropReasonString
// "\GS$s\149\191\171E\209\184)\ACK\130\DC2=\b",PropSubscriptionIdentifierAvailable 38,PropRequestResponseInformation
// 113,PropMaximumPacketSize 6795,PropSharedSubscriptionAvailable 150,PropMaximumPacketSize 6747,PropTopicAlias
// 13645,PropAssignedClientIdentifier
// "\DC4\DC3Q\196L(\167I,\233\183\237\228\200q\234\232D5\214(\211_xYp\237\226",PropSubscriptionIdentifierAvailable
// 36,PropTopicAliasMaximum 23245,PropContentType "\251XH\239\176\191M\SO\224f\191\173",PropCorrelationData
// "\RSk?:xldE\183",PropMessageExpiryInterval 14702,PropTopicAlias 20067,PropServerKeepAlive 20511,PropTopicAliasMaximum
// 10614,PropRequestProblemInformation 4,PropSubscriptionIdentifier 11,PropReceiveMaximum 28122]}), _cleanSession =
// True, _keepAlive = 14123, _connID = "\250\245\195\140\229m`\ETX\CAN9\SYN\SUBhP\159\204\202f\SOH\177f-\239",
// _properties = [PropWillDelayInterval 31589,PropRetainAvailable 153,PropRetainAvailable
// 231,PropSharedSubscriptionAvailable 208,PropAssignedClientIdentifier "\GSf",PropSharedSubscriptionAvailable
// 135,PropWildcardSubscriptionAvailable 0,PropReceiveMaximum 28907,PropReceiveMaximum 25980,PropAuthenticationData
// "\ESC\169\247\ENQ\244\199\&3\189\211\vU\135\210\152)",PropAssignedClientIdentifier
// ":\SYN\242\142\160ER\200\173n)\208\141\&3P\213\237\199",PropRequestResponseInformation
// 94,PropWildcardSubscriptionAvailable 154,PropTopicAliasMaximum 14579,PropAuthenticationMethod
// "\ETX\226P\160\250",PropContentType "~\249T\SYNVWo\219z,\205\&9o.*\214\208~",PropAuthenticationMethod
// "",PropServerKeepAlive 18921,PropMaximumPacketSize 31691,PropSubscriptionIdentifier 29,PropAuthenticationMethod
// "\DC4\242`)\177\183i?\241\228<3\252\&9\184E\128\169p\b?`\136\148\145\149\249\"",PropRetainAvailable
// 68,PropWillDelayInterval 9234,PropRetainAvailable 190,PropTopicAlias 133,PropCorrelationData
// "\172\ENQi\145t\130\199\199l\144\204\215",PropCorrelationData "\248\177\US\238\196%"]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0x90, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x37, 0x2b, 0xb5, 0x1,  0x18, 0x0,  0x0,  0x7b,
      0x65, 0x25, 0x99, 0x25, 0xe7, 0x2a, 0xd0, 0x12, 0x0,  0x2,  0x1d, 0x66, 0x2a, 0x87, 0x28, 0x0,  0x21, 0x70, 0xeb,
      0x21, 0x65, 0x7c, 0x16, 0x0,  0xf,  0x1b, 0xa9, 0xf7, 0x5,  0xf4, 0xc7, 0x33, 0xbd, 0xd3, 0xb,  0x55, 0x87, 0xd2,
      0x98, 0x29, 0x12, 0x0,  0x12, 0x3a, 0x16, 0xf2, 0x8e, 0xa0, 0x45, 0x52, 0xc8, 0xad, 0x6e, 0x29, 0xd0, 0x8d, 0x33,
      0x50, 0xd5, 0xed, 0xc7, 0x19, 0x5e, 0x28, 0x9a, 0x22, 0x38, 0xf3, 0x15, 0x0,  0x5,  0x3,  0xe2, 0x50, 0xa0, 0xfa,
      0x3,  0x0,  0x12, 0x7e, 0xf9, 0x54, 0x16, 0x56, 0x57, 0x6f, 0xdb, 0x7a, 0x2c, 0xcd, 0x39, 0x6f, 0x2e, 0x2a, 0xd6,
      0xd0, 0x7e, 0x15, 0x0,  0x0,  0x13, 0x49, 0xe9, 0x27, 0x0,  0x0,  0x7b, 0xcb, 0xb,  0x1d, 0x15, 0x0,  0x1c, 0x14,
      0xf2, 0x60, 0x29, 0xb1, 0xb7, 0x69, 0x3f, 0xf1, 0xe4, 0x3c, 0x33, 0xfc, 0x39, 0xb8, 0x45, 0x80, 0xa9, 0x70, 0x8,
      0x3f, 0x60, 0x88, 0x94, 0x91, 0x95, 0xf9, 0x22, 0x25, 0x44, 0x18, 0x0,  0x0,  0x24, 0x12, 0x25, 0xbe, 0x23, 0x0,
      0x85, 0x9,  0x0,  0xc,  0xac, 0x5,  0x69, 0x91, 0x74, 0x82, 0xc7, 0xc7, 0x6c, 0x90, 0xcc, 0xd7, 0x9,  0x0,  0x6,
      0xf8, 0xb1, 0x1f, 0xee, 0xc4, 0x25, 0x0,  0x17, 0xfa, 0xf5, 0xc3, 0x8c, 0xe5, 0x6d, 0x60, 0x3,  0x18, 0x39, 0x16,
      0x1a, 0x68, 0x50, 0x9f, 0xcc, 0xca, 0x66, 0x1,  0xb1, 0x66, 0x2d, 0xef, 0x94, 0x1,  0x16, 0x0,  0xd,  0x8d, 0x9b,
      0x31, 0x7a, 0xf8, 0xfb, 0x1e, 0xf8, 0x23, 0xa0, 0x99, 0xeb, 0x98, 0x13, 0x22, 0xfb, 0x1a, 0x0,  0x5,  0x22, 0x7c,
      0xcf, 0xbd, 0x8a, 0x1f, 0x0,  0xf,  0x1d, 0x24, 0x73, 0x95, 0xbf, 0xab, 0x45, 0xd1, 0xb8, 0x29, 0x6,  0x82, 0x12,
      0x3d, 0x8,  0x29, 0x26, 0x19, 0x71, 0x27, 0x0,  0x0,  0x1a, 0x8b, 0x2a, 0x96, 0x27, 0x0,  0x0,  0x1a, 0x5b, 0x23,
      0x35, 0x4d, 0x12, 0x0,  0x1c, 0x14, 0x13, 0x51, 0xc4, 0x4c, 0x28, 0xa7, 0x49, 0x2c, 0xe9, 0xb7, 0xed, 0xe4, 0xc8,
      0x71, 0xea, 0xe8, 0x44, 0x35, 0xd6, 0x28, 0xd3, 0x5f, 0x78, 0x59, 0x70, 0xed, 0xe2, 0x29, 0x24, 0x22, 0x5a, 0xcd,
      0x3,  0x0,  0xc,  0xfb, 0x58, 0x48, 0xef, 0xb0, 0xbf, 0x4d, 0xe,  0xe0, 0x66, 0xbf, 0xad, 0x9,  0x0,  0x9,  0x1e,
      0x6b, 0x3f, 0x3a, 0x78, 0x6c, 0x64, 0x45, 0xb7, 0x2,  0x0,  0x0,  0x39, 0x6e, 0x23, 0x4e, 0x63, 0x13, 0x50, 0x1f,
      0x22, 0x29, 0x76, 0x17, 0x4,  0xb,  0xb,  0x21, 0x6d, 0xda, 0x0,  0x1,  0xcf, 0x0,  0x1b, 0xed, 0x2f, 0xf0, 0xca,
      0x3e, 0x2d, 0x76, 0x8b, 0xd2, 0x3c, 0xf1, 0x1,  0x4b, 0xef, 0x1,  0x49, 0x6b, 0xb7, 0xcd, 0x2b, 0x2b, 0x95, 0x47,
      0x4c, 0xbc, 0xed, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0x66};
  uint8_t bytesprops1[] = {0x1b, 0xa9, 0xf7, 0x5, 0xf4, 0xc7, 0x33, 0xbd, 0xd3, 0xb, 0x55, 0x87, 0xd2, 0x98, 0x29};
  uint8_t bytesprops2[] = {0x3a, 0x16, 0xf2, 0x8e, 0xa0, 0x45, 0x52, 0xc8, 0xad,
                           0x6e, 0x29, 0xd0, 0x8d, 0x33, 0x50, 0xd5, 0xed, 0xc7};
  uint8_t bytesprops3[] = {0x3, 0xe2, 0x50, 0xa0, 0xfa};
  uint8_t bytesprops4[] = {0x7e, 0xf9, 0x54, 0x16, 0x56, 0x57, 0x6f, 0xdb, 0x7a,
                           0x2c, 0xcd, 0x39, 0x6f, 0x2e, 0x2a, 0xd6, 0xd0, 0x7e};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x14, 0xf2, 0x60, 0x29, 0xb1, 0xb7, 0x69, 0x3f, 0xf1, 0xe4, 0x3c, 0x33, 0xfc, 0x39,
                           0xb8, 0x45, 0x80, 0xa9, 0x70, 0x8,  0x3f, 0x60, 0x88, 0x94, 0x91, 0x95, 0xf9, 0x22};
  uint8_t bytesprops7[] = {0xac, 0x5, 0x69, 0x91, 0x74, 0x82, 0xc7, 0xc7, 0x6c, 0x90, 0xcc, 0xd7};
  uint8_t bytesprops8[] = {0xf8, 0xb1, 0x1f, 0xee, 0xc4, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31589}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28907}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25980}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14579}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18921}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31691}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9234}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 133}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8d, 0x9b, 0x31, 0x7a, 0xf8, 0xfb, 0x1e, 0xf8, 0x23, 0xa0, 0x99, 0xeb, 0x98};
  uint8_t byteswillprops1[] = {0x22, 0x7c, 0xcf, 0xbd, 0x8a};
  uint8_t byteswillprops2[] = {0x1d, 0x24, 0x73, 0x95, 0xbf, 0xab, 0x45, 0xd1, 0xb8, 0x29, 0x6, 0x82, 0x12, 0x3d, 0x8};
  uint8_t byteswillprops3[] = {0x14, 0x13, 0x51, 0xc4, 0x4c, 0x28, 0xa7, 0x49, 0x2c, 0xe9, 0xb7, 0xed, 0xe4, 0xc8,
                               0x71, 0xea, 0xe8, 0x44, 0x35, 0xd6, 0x28, 0xd3, 0x5f, 0x78, 0x59, 0x70, 0xed, 0xe2};
  uint8_t byteswillprops4[] = {0xfb, 0x58, 0x48, 0xef, 0xb0, 0xbf, 0x4d, 0xe, 0xe0, 0x66, 0xbf, 0xad};
  uint8_t byteswillprops5[] = {0x1e, 0x6b, 0x3f, 0x3a, 0x78, 0x6c, 0x64, 0x45, 0xb7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8955}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6795}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6747}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13645}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23245}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14702}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20067}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20511}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10614}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28122}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcf};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xed, 0x2f, 0xf0, 0xca, 0x3e, 0x2d, 0x76, 0x8b, 0xd2, 0x3c, 0xf1, 0x1,  0x4b, 0xef,
                                  0x1,  0x49, 0x6b, 0xb7, 0xcd, 0x2b, 0x2b, 0x95, 0x47, 0x4c, 0xbc, 0xed, 0xca};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14123;
  uint8_t client_id_bytes[] = {0xfa, 0xf5, 0xc3, 0x8c, 0xe5, 0x6d, 0x60, 0x3,  0x18, 0x39, 0x16, 0x1a,
                               0x68, 0x50, 0x9f, 0xcc, 0xca, 0x66, 0x1,  0xb1, 0x66, 0x2d, 0xef};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\v\155$4", _password = Just "\SUB\f~0\216\NAKr)Qx3B6E\SO\214\193", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 2824, _connID =
// "\151'V\147\201r\NAK\243\154p\179\129\"9\bk$\156#\v\157\187\150x\CAN2\217", _properties = [PropCorrelationData
// "\DLE\166\170\155\161N/\SUB\181\153\226\153t\240\222z\162\r\GS\161\&4cD$\ACK",PropServerKeepAlive
// 28555,PropAssignedClientIdentifier
// "\ETB\148\169\SUB\174mP\209\&5\251yz\150>\"\165\NUL\226\GS\208\254\&0\204\135+[",PropCorrelationData
// "wSs\140l\224!\240m\GS\181q\174\US{\243",PropTopicAlias 13037,PropCorrelationData
// "P+",PropSubscriptionIdentifierAvailable 185,PropMessageExpiryInterval 9737,PropWillDelayInterval
// 23768,PropWillDelayInterval 2041,PropTopicAliasMaximum 10457,PropWildcardSubscriptionAvailable 148,PropReceiveMaximum
// 10040,PropAuthenticationMethod "\178\DEL=\250\SO\\d",PropResponseTopic
// "x&\DC3\154C+\DLE\208!\152\207\DEL\134[q\208\193",PropPayloadFormatIndicator 30,PropAuthenticationData
// "!\215\185",PropSubscriptionIdentifier 18,PropUserProperty
// "\247\EOT\221>\EMV\202\NAK(x\215\152\154/\248\199\ACK\131\EMc\176\nl\196Kg\164\fI"
// "'\237\DLE\241\SOH\237\EOT\148\NAK\182\147\218(\ETB\212p){\171\198\189?x\137$\DLEP"]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0x97, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0xb,  0x8,  0xd5, 0x1,  0x9,  0x0,  0x19, 0x10,
      0xa6, 0xaa, 0x9b, 0xa1, 0x4e, 0x2f, 0x1a, 0xb5, 0x99, 0xe2, 0x99, 0x74, 0xf0, 0xde, 0x7a, 0xa2, 0xd,  0x1d, 0xa1,
      0x34, 0x63, 0x44, 0x24, 0x6,  0x13, 0x6f, 0x8b, 0x12, 0x0,  0x1a, 0x17, 0x94, 0xa9, 0x1a, 0xae, 0x6d, 0x50, 0xd1,
      0x35, 0xfb, 0x79, 0x7a, 0x96, 0x3e, 0x22, 0xa5, 0x0,  0xe2, 0x1d, 0xd0, 0xfe, 0x30, 0xcc, 0x87, 0x2b, 0x5b, 0x9,
      0x0,  0x10, 0x77, 0x53, 0x73, 0x8c, 0x6c, 0xe0, 0x21, 0xf0, 0x6d, 0x1d, 0xb5, 0x71, 0xae, 0x1f, 0x7b, 0xf3, 0x23,
      0x32, 0xed, 0x9,  0x0,  0x2,  0x50, 0x2b, 0x29, 0xb9, 0x2,  0x0,  0x0,  0x26, 0x9,  0x18, 0x0,  0x0,  0x5c, 0xd8,
      0x18, 0x0,  0x0,  0x7,  0xf9, 0x22, 0x28, 0xd9, 0x28, 0x94, 0x21, 0x27, 0x38, 0x15, 0x0,  0x7,  0xb2, 0x7f, 0x3d,
      0xfa, 0xe,  0x5c, 0x64, 0x8,  0x0,  0x11, 0x78, 0x26, 0x13, 0x9a, 0x43, 0x2b, 0x10, 0xd0, 0x21, 0x98, 0xcf, 0x7f,
      0x86, 0x5b, 0x71, 0xd0, 0xc1, 0x1,  0x1e, 0x16, 0x0,  0x3,  0x21, 0xd7, 0xb9, 0xb,  0x12, 0x26, 0x0,  0x1d, 0xf7,
      0x4,  0xdd, 0x3e, 0x19, 0x56, 0xca, 0x15, 0x28, 0x78, 0xd7, 0x98, 0x9a, 0x2f, 0xf8, 0xc7, 0x6,  0x83, 0x19, 0x63,
      0xb0, 0xa,  0x6c, 0xc4, 0x4b, 0x67, 0xa4, 0xc,  0x49, 0x0,  0x1b, 0x27, 0xed, 0x10, 0xf1, 0x1,  0xed, 0x4,  0x94,
      0x15, 0xb6, 0x93, 0xda, 0x28, 0x17, 0xd4, 0x70, 0x29, 0x7b, 0xab, 0xc6, 0xbd, 0x3f, 0x78, 0x89, 0x24, 0x10, 0x50,
      0x0,  0x1b, 0x97, 0x27, 0x56, 0x93, 0xc9, 0x72, 0x15, 0xf3, 0x9a, 0x70, 0xb3, 0x81, 0x22, 0x39, 0x8,  0x6b, 0x24,
      0x9c, 0x23, 0xb,  0x9d, 0xbb, 0x96, 0x78, 0x18, 0x32, 0xd9, 0x0,  0x4,  0xb,  0x9b, 0x24, 0x34, 0x0,  0x11, 0x1a,
      0xc,  0x7e, 0x30, 0xd8, 0x15, 0x72, 0x29, 0x51, 0x78, 0x33, 0x42, 0x36, 0x45, 0xe,  0xd6, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x10, 0xa6, 0xaa, 0x9b, 0xa1, 0x4e, 0x2f, 0x1a, 0xb5, 0x99, 0xe2, 0x99, 0x74,
                           0xf0, 0xde, 0x7a, 0xa2, 0xd,  0x1d, 0xa1, 0x34, 0x63, 0x44, 0x24, 0x6};
  uint8_t bytesprops1[] = {0x17, 0x94, 0xa9, 0x1a, 0xae, 0x6d, 0x50, 0xd1, 0x35, 0xfb, 0x79, 0x7a, 0x96,
                           0x3e, 0x22, 0xa5, 0x0,  0xe2, 0x1d, 0xd0, 0xfe, 0x30, 0xcc, 0x87, 0x2b, 0x5b};
  uint8_t bytesprops2[] = {0x77, 0x53, 0x73, 0x8c, 0x6c, 0xe0, 0x21, 0xf0,
                           0x6d, 0x1d, 0xb5, 0x71, 0xae, 0x1f, 0x7b, 0xf3};
  uint8_t bytesprops3[] = {0x50, 0x2b};
  uint8_t bytesprops4[] = {0xb2, 0x7f, 0x3d, 0xfa, 0xe, 0x5c, 0x64};
  uint8_t bytesprops5[] = {0x78, 0x26, 0x13, 0x9a, 0x43, 0x2b, 0x10, 0xd0, 0x21,
                           0x98, 0xcf, 0x7f, 0x86, 0x5b, 0x71, 0xd0, 0xc1};
  uint8_t bytesprops6[] = {0x21, 0xd7, 0xb9};
  uint8_t bytesprops8[] = {0x27, 0xed, 0x10, 0xf1, 0x1,  0xed, 0x4,  0x94, 0x15, 0xb6, 0x93, 0xda, 0x28, 0x17,
                           0xd4, 0x70, 0x29, 0x7b, 0xab, 0xc6, 0xbd, 0x3f, 0x78, 0x89, 0x24, 0x10, 0x50};
  uint8_t bytesprops7[] = {0xf7, 0x4, 0xdd, 0x3e, 0x19, 0x56, 0xca, 0x15, 0x28, 0x78, 0xd7, 0x98, 0x9a, 0x2f, 0xf8,
                           0xc7, 0x6, 0x83, 0x19, 0x63, 0xb0, 0xa,  0x6c, 0xc4, 0x4b, 0x67, 0xa4, 0xc,  0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28555}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13037}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9737}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23768}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2041}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10457}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10040}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops7}, .v = {27, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2824;
  uint8_t client_id_bytes[] = {0x97, 0x27, 0x56, 0x93, 0xc9, 0x72, 0x15, 0xf3, 0x9a, 0x70, 0xb3, 0x81, 0x22, 0x39,
                               0x8,  0x6b, 0x24, 0x9c, 0x23, 0xb,  0x9d, 0xbb, 0x96, 0x78, 0x18, 0x32, 0xd9};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb, 0x9b, 0x24, 0x34};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1a, 0xc,  0x7e, 0x30, 0xd8, 0x15, 0x72, 0x29, 0x51,
                              0x78, 0x33, 0x42, 0x36, 0x45, 0xe,  0xd6, 0xc1};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "5kK\NUL\RS-\163\145\193\178\170I\198\175\DEL$\176\\\DLEo\DC46", _willMsg =
// "&\155\228\DC3\235\180\DC4#\220\198R\206\178[\NAK\149_\245\206\172\NUL\204\US\211UA", _willProps = [PropContentType
// "\DC3:\145S\n\235\164\187?",PropUserProperty "@\190\173$\255\232\248\199\208\132\231\130V"
// "\189\DELI\DC3\146\ENQ\241\&1\DC1\194;<\169&\199\191",PropRequestProblemInformation 157,PropSessionExpiryInterval
// 2676,PropRequestProblemInformation 219,PropSubscriptionIdentifierAvailable 138,PropUserProperty
// "\237N\198/\176\139N\222GF\240\144&\247%\EOT\254q\157{\200\\" "\177\&8\222\185z\\\174\254\134\ESC\229
// \128\EM\226L%\146",PropMessageExpiryInterval 2260,PropResponseInformation "\133dOZ\217\140P*=",PropRetainAvailable
// 122,PropResponseInformation "\171\208\245",PropResponseInformation
// "\201\243\207kk\208\251\204\&6\221!\nb\227j1\181\195\254\146\CAN\255\211",PropResponseInformation
// "\252\249\US\EM\131\255\187\159\141\137\232by",PropSubscriptionIdentifier 1,PropResponseTopic
// "\210MN)n:\246J\201\236%\204\166\244\ACK\181g_\215\217&\236\234\213\b\223L\228\232\181",PropAuthenticationData
// "\249E\182\164\SYN'\238\&3\133\190\254\"t\241+\225\t-U\187\187#z\208\219",PropMaximumPacketSize
// 16575,PropPayloadFormatIndicator 242,PropSessionExpiryInterval 14364,PropWillDelayInterval 8517,PropServerReference
// "n)\186\130\&6\241\&0e\238\170\SOH\136",PropCorrelationData "\222O%",PropRequestResponseInformation
// 46,PropAuthenticationData "O\ETB\208()\DC3\250AI\US",PropServerKeepAlive 3459,PropAuthenticationMethod ".v"]}),
// _cleanSession = True, _keepAlive = 32140, _connID = "vC\248\155\177\213g]\198", _properties = [PropMaximumPacketSize
// 4625,PropCorrelationData
// "\189\FSf\211\&5\225\SOHr\231\205\CAN\"j\171\DC1%\225p{,\DLEB\227\STXk@\140,<\215",PropMaximumPacketSize
// 27111,PropPayloadFormatIndicator 21,PropSubscriptionIdentifierAvailable 88,PropRetainAvailable
// 56,PropSubscriptionIdentifierAvailable 37,PropSessionExpiryInterval 27408,PropTopicAlias 30555,PropTopicAliasMaximum
// 30910,PropMaximumQoS 162,PropSharedSubscriptionAvailable 219,PropMaximumPacketSize 27447,PropUserProperty
// "o\tf\145@&H\b\184\232\232\134\GS}\222s\216\205u\190"
// "\213^\222\132\163\132\195qUw7\241e=\209\DEL\221J\135",PropReceiveMaximum 13982,PropReasonString
// "\239\155d\217\165\168\194{\ENQ\SUB\196\&1",PropWillDelayInterval 27839,PropSubscriptionIdentifier 17]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0xfe, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6,  0x7d, 0x8c, 0x8c, 0x1,  0x27, 0x0,  0x0,  0x12,
      0x11, 0x9,  0x0,  0x1e, 0xbd, 0x1c, 0x66, 0xd3, 0x35, 0xe1, 0x1,  0x72, 0xe7, 0xcd, 0x18, 0x22, 0x6a, 0xab, 0x11,
      0x25, 0xe1, 0x70, 0x7b, 0x2c, 0x10, 0x42, 0xe3, 0x2,  0x6b, 0x40, 0x8c, 0x2c, 0x3c, 0xd7, 0x27, 0x0,  0x0,  0x69,
      0xe7, 0x1,  0x15, 0x29, 0x58, 0x25, 0x38, 0x29, 0x25, 0x11, 0x0,  0x0,  0x6b, 0x10, 0x23, 0x77, 0x5b, 0x22, 0x78,
      0xbe, 0x24, 0xa2, 0x2a, 0xdb, 0x27, 0x0,  0x0,  0x6b, 0x37, 0x26, 0x0,  0x14, 0x6f, 0x9,  0x66, 0x91, 0x40, 0x26,
      0x48, 0x8,  0xb8, 0xe8, 0xe8, 0x86, 0x1d, 0x7d, 0xde, 0x73, 0xd8, 0xcd, 0x75, 0xbe, 0x0,  0x13, 0xd5, 0x5e, 0xde,
      0x84, 0xa3, 0x84, 0xc3, 0x71, 0x55, 0x77, 0x37, 0xf1, 0x65, 0x3d, 0xd1, 0x7f, 0xdd, 0x4a, 0x87, 0x21, 0x36, 0x9e,
      0x1f, 0x0,  0xc,  0xef, 0x9b, 0x64, 0xd9, 0xa5, 0xa8, 0xc2, 0x7b, 0x5,  0x1a, 0xc4, 0x31, 0x18, 0x0,  0x0,  0x6c,
      0xbf, 0xb,  0x11, 0x0,  0x9,  0x76, 0x43, 0xf8, 0x9b, 0xb1, 0xd5, 0x67, 0x5d, 0xc6, 0xa5, 0x2,  0x3,  0x0,  0x9,
      0x13, 0x3a, 0x91, 0x53, 0xa,  0xeb, 0xa4, 0xbb, 0x3f, 0x26, 0x0,  0xd,  0x40, 0xbe, 0xad, 0x24, 0xff, 0xe8, 0xf8,
      0xc7, 0xd0, 0x84, 0xe7, 0x82, 0x56, 0x0,  0x10, 0xbd, 0x7f, 0x49, 0x13, 0x92, 0x5,  0xf1, 0x31, 0x11, 0xc2, 0x3b,
      0x3c, 0xa9, 0x26, 0xc7, 0xbf, 0x17, 0x9d, 0x11, 0x0,  0x0,  0xa,  0x74, 0x17, 0xdb, 0x29, 0x8a, 0x26, 0x0,  0x16,
      0xed, 0x4e, 0xc6, 0x2f, 0xb0, 0x8b, 0x4e, 0xde, 0x47, 0x46, 0xf0, 0x90, 0x26, 0xf7, 0x25, 0x4,  0xfe, 0x71, 0x9d,
      0x7b, 0xc8, 0x5c, 0x0,  0x12, 0xb1, 0x38, 0xde, 0xb9, 0x7a, 0x5c, 0xae, 0xfe, 0x86, 0x1b, 0xe5, 0x20, 0x80, 0x19,
      0xe2, 0x4c, 0x25, 0x92, 0x2,  0x0,  0x0,  0x8,  0xd4, 0x1a, 0x0,  0x9,  0x85, 0x64, 0x4f, 0x5a, 0xd9, 0x8c, 0x50,
      0x2a, 0x3d, 0x25, 0x7a, 0x1a, 0x0,  0x3,  0xab, 0xd0, 0xf5, 0x1a, 0x0,  0x17, 0xc9, 0xf3, 0xcf, 0x6b, 0x6b, 0xd0,
      0xfb, 0xcc, 0x36, 0xdd, 0x21, 0xa,  0x62, 0xe3, 0x6a, 0x31, 0xb5, 0xc3, 0xfe, 0x92, 0x18, 0xff, 0xd3, 0x1a, 0x0,
      0xd,  0xfc, 0xf9, 0x1f, 0x19, 0x83, 0xff, 0xbb, 0x9f, 0x8d, 0x89, 0xe8, 0x62, 0x79, 0xb,  0x1,  0x8,  0x0,  0x1e,
      0xd2, 0x4d, 0x4e, 0x29, 0x6e, 0x3a, 0xf6, 0x4a, 0xc9, 0xec, 0x25, 0xcc, 0xa6, 0xf4, 0x6,  0xb5, 0x67, 0x5f, 0xd7,
      0xd9, 0x26, 0xec, 0xea, 0xd5, 0x8,  0xdf, 0x4c, 0xe4, 0xe8, 0xb5, 0x16, 0x0,  0x19, 0xf9, 0x45, 0xb6, 0xa4, 0x16,
      0x27, 0xee, 0x33, 0x85, 0xbe, 0xfe, 0x22, 0x74, 0xf1, 0x2b, 0xe1, 0x9,  0x2d, 0x55, 0xbb, 0xbb, 0x23, 0x7a, 0xd0,
      0xdb, 0x27, 0x0,  0x0,  0x40, 0xbf, 0x1,  0xf2, 0x11, 0x0,  0x0,  0x38, 0x1c, 0x18, 0x0,  0x0,  0x21, 0x45, 0x1c,
      0x0,  0xc,  0x6e, 0x29, 0xba, 0x82, 0x36, 0xf1, 0x30, 0x65, 0xee, 0xaa, 0x1,  0x88, 0x9,  0x0,  0x3,  0xde, 0x4f,
      0x25, 0x19, 0x2e, 0x16, 0x0,  0xa,  0x4f, 0x17, 0xd0, 0x28, 0x29, 0x13, 0xfa, 0x41, 0x49, 0x1f, 0x13, 0xd,  0x83,
      0x15, 0x0,  0x2,  0x2e, 0x76, 0x0,  0x16, 0x35, 0x6b, 0x4b, 0x0,  0x1e, 0x2d, 0xa3, 0x91, 0xc1, 0xb2, 0xaa, 0x49,
      0xc6, 0xaf, 0x7f, 0x24, 0xb0, 0x5c, 0x10, 0x6f, 0x14, 0x36, 0x0,  0x1a, 0x26, 0x9b, 0xe4, 0x13, 0xeb, 0xb4, 0x14,
      0x23, 0xdc, 0xc6, 0x52, 0xce, 0xb2, 0x5b, 0x15, 0x95, 0x5f, 0xf5, 0xce, 0xac, 0x0,  0xcc, 0x1f, 0xd3, 0x55, 0x41};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbd, 0x1c, 0x66, 0xd3, 0x35, 0xe1, 0x1,  0x72, 0xe7, 0xcd, 0x18, 0x22, 0x6a, 0xab, 0x11,
                           0x25, 0xe1, 0x70, 0x7b, 0x2c, 0x10, 0x42, 0xe3, 0x2,  0x6b, 0x40, 0x8c, 0x2c, 0x3c, 0xd7};
  uint8_t bytesprops2[] = {0xd5, 0x5e, 0xde, 0x84, 0xa3, 0x84, 0xc3, 0x71, 0x55, 0x77,
                           0x37, 0xf1, 0x65, 0x3d, 0xd1, 0x7f, 0xdd, 0x4a, 0x87};
  uint8_t bytesprops1[] = {0x6f, 0x9,  0x66, 0x91, 0x40, 0x26, 0x48, 0x8,  0xb8, 0xe8,
                           0xe8, 0x86, 0x1d, 0x7d, 0xde, 0x73, 0xd8, 0xcd, 0x75, 0xbe};
  uint8_t bytesprops3[] = {0xef, 0x9b, 0x64, 0xd9, 0xa5, 0xa8, 0xc2, 0x7b, 0x5, 0x1a, 0xc4, 0x31};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4625}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27111}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27408}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30555}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30910}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27447}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {19, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13982}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27839}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x13, 0x3a, 0x91, 0x53, 0xa, 0xeb, 0xa4, 0xbb, 0x3f};
  uint8_t byteswillprops2[] = {0xbd, 0x7f, 0x49, 0x13, 0x92, 0x5,  0xf1, 0x31,
                               0x11, 0xc2, 0x3b, 0x3c, 0xa9, 0x26, 0xc7, 0xbf};
  uint8_t byteswillprops1[] = {0x40, 0xbe, 0xad, 0x24, 0xff, 0xe8, 0xf8, 0xc7, 0xd0, 0x84, 0xe7, 0x82, 0x56};
  uint8_t byteswillprops4[] = {0xb1, 0x38, 0xde, 0xb9, 0x7a, 0x5c, 0xae, 0xfe, 0x86,
                               0x1b, 0xe5, 0x20, 0x80, 0x19, 0xe2, 0x4c, 0x25, 0x92};
  uint8_t byteswillprops3[] = {0xed, 0x4e, 0xc6, 0x2f, 0xb0, 0x8b, 0x4e, 0xde, 0x47, 0x46, 0xf0,
                               0x90, 0x26, 0xf7, 0x25, 0x4,  0xfe, 0x71, 0x9d, 0x7b, 0xc8, 0x5c};
  uint8_t byteswillprops5[] = {0x85, 0x64, 0x4f, 0x5a, 0xd9, 0x8c, 0x50, 0x2a, 0x3d};
  uint8_t byteswillprops6[] = {0xab, 0xd0, 0xf5};
  uint8_t byteswillprops7[] = {0xc9, 0xf3, 0xcf, 0x6b, 0x6b, 0xd0, 0xfb, 0xcc, 0x36, 0xdd, 0x21, 0xa,
                               0x62, 0xe3, 0x6a, 0x31, 0xb5, 0xc3, 0xfe, 0x92, 0x18, 0xff, 0xd3};
  uint8_t byteswillprops8[] = {0xfc, 0xf9, 0x1f, 0x19, 0x83, 0xff, 0xbb, 0x9f, 0x8d, 0x89, 0xe8, 0x62, 0x79};
  uint8_t byteswillprops9[] = {0xd2, 0x4d, 0x4e, 0x29, 0x6e, 0x3a, 0xf6, 0x4a, 0xc9, 0xec,
                               0x25, 0xcc, 0xa6, 0xf4, 0x6,  0xb5, 0x67, 0x5f, 0xd7, 0xd9,
                               0x26, 0xec, 0xea, 0xd5, 0x8,  0xdf, 0x4c, 0xe4, 0xe8, 0xb5};
  uint8_t byteswillprops10[] = {0xf9, 0x45, 0xb6, 0xa4, 0x16, 0x27, 0xee, 0x33, 0x85, 0xbe, 0xfe, 0x22, 0x74,
                                0xf1, 0x2b, 0xe1, 0x9,  0x2d, 0x55, 0xbb, 0xbb, 0x23, 0x7a, 0xd0, 0xdb};
  uint8_t byteswillprops11[] = {0x6e, 0x29, 0xba, 0x82, 0x36, 0xf1, 0x30, 0x65, 0xee, 0xaa, 0x1, 0x88};
  uint8_t byteswillprops12[] = {0xde, 0x4f, 0x25};
  uint8_t byteswillprops13[] = {0x4f, 0x17, 0xd0, 0x28, 0x29, 0x13, 0xfa, 0x41, 0x49, 0x1f};
  uint8_t byteswillprops14[] = {0x2e, 0x76};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops1}, .v = {16, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2676}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {22, (char*)&byteswillprops3}, .v = {18, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2260}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16575}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14364}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8517}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3459}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&byteswillprops14}}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x6b, 0x4b, 0x0,  0x1e, 0x2d, 0xa3, 0x91, 0xc1, 0xb2, 0xaa,
                                0x49, 0xc6, 0xaf, 0x7f, 0x24, 0xb0, 0x5c, 0x10, 0x6f, 0x14, 0x36};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x26, 0x9b, 0xe4, 0x13, 0xeb, 0xb4, 0x14, 0x23, 0xdc, 0xc6, 0x52, 0xce, 0xb2,
                                  0x5b, 0x15, 0x95, 0x5f, 0xf5, 0xce, 0xac, 0x0,  0xcc, 0x1f, 0xd3, 0x55, 0x41};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 32140;
  uint8_t client_id_bytes[] = {0x76, 0x43, 0xf8, 0x9b, 0xb1, 0xd5, 0x67, 0x5d, 0xc6};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\181\188RC|\DELPc[\242A\194\140G\NAK\CANu\DC4\178\213\DC4",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "\249=\212\228i\201\&4\178&\RS)\DC4|\174\242w \201", _willMsg =
// "@\162c\242\CAN\208f\191d\161\222\184@fP\222\&7\204\176\212\227_\166\242\155W<\DC43", _willProps =
// [PropAuthenticationData "",PropWillDelayInterval 21611,PropRequestResponseInformation 4,PropCorrelationData
// "\196w\189\139\135\209O\159~",PropSessionExpiryInterval 23150,PropMaximumQoS 17,PropPayloadFormatIndicator
// 173,PropRequestProblemInformation 74,PropSubscriptionIdentifierAvailable 11,PropUserProperty
// "\168R\218\128\144\140$G\245\176o\201B\155\&0\DC1\146"
// "\253\169\189S\248Pa\134\ETB\SYN=\ACK\173\177y(\208",PropReceiveMaximum 4756,PropReceiveMaximum
// 28950,PropMessageExpiryInterval 25517,PropMaximumQoS 253,PropResponseTopic
// "\217\212i\186\f\218K\ENQ|1\229\229=\188Q\145~\184\&1\241!\244\209\236\DC1;\189=\RSg"]}), _cleanSession = True,
// _keepAlive = 8577, _connID = "\246\235\226\ACK\SI+\255\134\137\158\247\158\138X\147\188\139\218-\154", _properties =
// [PropResponseTopic "1\245Am\193[\231\FS|\170\143\206\217M\128\181\EM\196\157\ESC\228\215\&7p",PropReasonString
// "x\240\133\&3\250\227b\239:\144\230\187\221"]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0xf8, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6,  0x21, 0x81, 0x2b, 0x8,  0x0,  0x18,
                   0x31, 0xf5, 0x41, 0x6d, 0xc1, 0x5b, 0xe7, 0x1c, 0x7c, 0xaa, 0x8f, 0xce, 0xd9, 0x4d, 0x80, 0xb5, 0x19,
                   0xc4, 0x9d, 0x1b, 0xe4, 0xd7, 0x37, 0x70, 0x1f, 0x0,  0xd,  0x78, 0xf0, 0x85, 0x33, 0xfa, 0xe3, 0x62,
                   0xef, 0x3a, 0x90, 0xe6, 0xbb, 0xdd, 0x0,  0x14, 0xf6, 0xeb, 0xe2, 0x6,  0xf,  0x2b, 0xff, 0x86, 0x89,
                   0x9e, 0xf7, 0x9e, 0x8a, 0x58, 0x93, 0xbc, 0x8b, 0xda, 0x2d, 0x9a, 0x78, 0x16, 0x0,  0x0,  0x18, 0x0,
                   0x0,  0x54, 0x6b, 0x19, 0x4,  0x9,  0x0,  0x9,  0xc4, 0x77, 0xbd, 0x8b, 0x87, 0xd1, 0x4f, 0x9f, 0x7e,
                   0x11, 0x0,  0x0,  0x5a, 0x6e, 0x24, 0x11, 0x1,  0xad, 0x17, 0x4a, 0x29, 0xb,  0x26, 0x0,  0x11, 0xa8,
                   0x52, 0xda, 0x80, 0x90, 0x8c, 0x24, 0x47, 0xf5, 0xb0, 0x6f, 0xc9, 0x42, 0x9b, 0x30, 0x11, 0x92, 0x0,
                   0x11, 0xfd, 0xa9, 0xbd, 0x53, 0xf8, 0x50, 0x61, 0x86, 0x17, 0x16, 0x3d, 0x6,  0xad, 0xb1, 0x79, 0x28,
                   0xd0, 0x21, 0x12, 0x94, 0x21, 0x71, 0x16, 0x2,  0x0,  0x0,  0x63, 0xad, 0x24, 0xfd, 0x8,  0x0,  0x1e,
                   0xd9, 0xd4, 0x69, 0xba, 0xc,  0xda, 0x4b, 0x5,  0x7c, 0x31, 0xe5, 0xe5, 0x3d, 0xbc, 0x51, 0x91, 0x7e,
                   0xb8, 0x31, 0xf1, 0x21, 0xf4, 0xd1, 0xec, 0x11, 0x3b, 0xbd, 0x3d, 0x1e, 0x67, 0x0,  0x12, 0xf9, 0x3d,
                   0xd4, 0xe4, 0x69, 0xc9, 0x34, 0xb2, 0x26, 0x1e, 0x29, 0x14, 0x7c, 0xae, 0xf2, 0x77, 0x20, 0xc9, 0x0,
                   0x1d, 0x40, 0xa2, 0x63, 0xf2, 0x18, 0xd0, 0x66, 0xbf, 0x64, 0xa1, 0xde, 0xb8, 0x40, 0x66, 0x50, 0xde,
                   0x37, 0xcc, 0xb0, 0xd4, 0xe3, 0x5f, 0xa6, 0xf2, 0x9b, 0x57, 0x3c, 0x14, 0x33};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x31, 0xf5, 0x41, 0x6d, 0xc1, 0x5b, 0xe7, 0x1c, 0x7c, 0xaa, 0x8f, 0xce,
                           0xd9, 0x4d, 0x80, 0xb5, 0x19, 0xc4, 0x9d, 0x1b, 0xe4, 0xd7, 0x37, 0x70};
  uint8_t bytesprops1[] = {0x78, 0xf0, 0x85, 0x33, 0xfa, 0xe3, 0x62, 0xef, 0x3a, 0x90, 0xe6, 0xbb, 0xdd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0xc4, 0x77, 0xbd, 0x8b, 0x87, 0xd1, 0x4f, 0x9f, 0x7e};
  uint8_t byteswillprops3[] = {0xfd, 0xa9, 0xbd, 0x53, 0xf8, 0x50, 0x61, 0x86, 0x17,
                               0x16, 0x3d, 0x6,  0xad, 0xb1, 0x79, 0x28, 0xd0};
  uint8_t byteswillprops2[] = {0xa8, 0x52, 0xda, 0x80, 0x90, 0x8c, 0x24, 0x47, 0xf5,
                               0xb0, 0x6f, 0xc9, 0x42, 0x9b, 0x30, 0x11, 0x92};
  uint8_t byteswillprops4[] = {0xd9, 0xd4, 0x69, 0xba, 0xc,  0xda, 0x4b, 0x5,  0x7c, 0x31,
                               0xe5, 0xe5, 0x3d, 0xbc, 0x51, 0x91, 0x7e, 0xb8, 0x31, 0xf1,
                               0x21, 0xf4, 0xd1, 0xec, 0x11, 0x3b, 0xbd, 0x3d, 0x1e, 0x67};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21611}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23150}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {17, (char*)&byteswillprops2}, .v = {17, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4756}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28950}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25517}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf9, 0x3d, 0xd4, 0xe4, 0x69, 0xc9, 0x34, 0xb2, 0x26,
                                0x1e, 0x29, 0x14, 0x7c, 0xae, 0xf2, 0x77, 0x20, 0xc9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0xa2, 0x63, 0xf2, 0x18, 0xd0, 0x66, 0xbf, 0x64, 0xa1,
                                  0xde, 0xb8, 0x40, 0x66, 0x50, 0xde, 0x37, 0xcc, 0xb0, 0xd4,
                                  0xe3, 0x5f, 0xa6, 0xf2, 0x9b, 0x57, 0x3c, 0x14, 0x33};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8577;
  uint8_t client_id_bytes[] = {0xf6, 0xeb, 0xe2, 0x6,  0xf,  0x2b, 0xff, 0x86, 0x89, 0x9e,
                               0xf7, 0x9e, 0x8a, 0x58, 0x93, 0xbc, 0x8b, 0xda, 0x2d, 0x9a};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb5, 0xbc, 0x52, 0x43, 0x7c, 0x7f, 0x50, 0x63, 0x5b, 0xf2, 0x41,
                              0xc2, 0x8c, 0x47, 0x15, 0x18, 0x75, 0x14, 0xb2, 0xd5, 0x14};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETB\185M\SUB\222\149", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\128\ETB\EOT\205\173", _willMsg =
// "\198\DC3l\140\230R!E$\SOH\229o,x\187~\139\202\"\DC4V\ACK)", _willProps = [PropMessageExpiryInterval
// 30378,PropReasonString "\213P\189Yv\FS\DC3#\224\SI_\155\&5D# \187\201\204\178{\GS$:\251\213",PropRetainAvailable
// 181,PropReasonString "\246\182\199?5rh\a\129F`\163\NAKv\FS\130\249",PropCorrelationData
// ",\ENQ\146\197\197\SI\220y.\150",PropResponseTopic
// "\202\156\&7\199\244\162Cw3\"S\221\245\fi\181\DC2m\139\252\244i\175#",PropAuthenticationMethod
// "\205\228\ESC\n",PropSharedSubscriptionAvailable 45,PropContentType
// "\fILq\240~<+\226\137+O,\218QC\243\141r\154j\139\231=",PropServerReference "\141",PropMessageExpiryInterval
// 2987,PropSessionExpiryInterval 20482,PropTopicAlias 9401,PropRetainAvailable 46]}), _cleanSession = False, _keepAlive
// = 3023, _connID = "]l\128mk1J\129p\141\170Rw\178\NUL\171w\196\n", _properties = [PropPayloadFormatIndicator
// 86,PropMessageExpiryInterval 15264,PropSubscriptionIdentifier 11,PropResponseTopic
// "\ENQ+Vw\177T\218a7I\201\130|\\'Q\231=F\STX\DC3\SUB+E!\231",PropReceiveMaximum 4661,PropResponseInformation
// "\DC4f\213t\230",PropResponseInformation
// "\ENQ\247\209b\172\179\ETB\148\224\136\164o\171U\208\177\ETBJ\t\143\205&\251\152\rO\"\131",PropAuthenticationData
// "\SOHa\ESC\233\&8p\177\162\255\179\132\135",PropServerReference
// "\245\231\b\215}(\213\175\&2~s\128\174\DC4\201\235\250\EOT\214\142",PropUserProperty
// "\212k]b\SO;4\174\179\242\ENQ\135u,`8\204{:L\183a\SYNj\187s" "\235S\183P\187",PropSubscriptionIdentifierAvailable
// 48,PropAuthenticationMethod
// "\GS$\174\239\\S\248+;\145\231\225\231\155\RS\168L\227\247\197\145&",PropAssignedClientIdentifier
// "\171\162\ESC2\168gK\151>\177\147\130\SYN_\174",PropSubscriptionIdentifierAvailable 119,PropMaximumQoS
// 125,PropWildcardSubscriptionAvailable 12,PropRetainAvailable 247,PropSubscriptionIdentifierAvailable
// 152,PropSharedSubscriptionAvailable 76,PropResponseInformation
// "Q\a\236t\STX\128\215\159\\\226%82\DC4<",PropRequestProblemInformation 6,PropAuthenticationData
// "\213",PropWillDelayInterval 11360,PropTopicAliasMaximum 17881,PropServerReference
// "\235s't\243\130]2\206\NAKv\131\CANs\SOH\218\STX",PropWillDelayInterval 16307]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0xee, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0xb,  0xcf, 0x8c, 0x2,  0x1,  0x56, 0x2,  0x0,
      0x0,  0x3b, 0xa0, 0xb,  0xb,  0x8,  0x0,  0x1a, 0x5,  0x2b, 0x56, 0x77, 0xb1, 0x54, 0xda, 0x61, 0x37, 0x49, 0xc9,
      0x82, 0x7c, 0x5c, 0x27, 0x51, 0xe7, 0x3d, 0x46, 0x2,  0x13, 0x1a, 0x2b, 0x45, 0x21, 0xe7, 0x21, 0x12, 0x35, 0x1a,
      0x0,  0x5,  0x14, 0x66, 0xd5, 0x74, 0xe6, 0x1a, 0x0,  0x1c, 0x5,  0xf7, 0xd1, 0x62, 0xac, 0xb3, 0x17, 0x94, 0xe0,
      0x88, 0xa4, 0x6f, 0xab, 0x55, 0xd0, 0xb1, 0x17, 0x4a, 0x9,  0x8f, 0xcd, 0x26, 0xfb, 0x98, 0xd,  0x4f, 0x22, 0x83,
      0x16, 0x0,  0xc,  0x1,  0x61, 0x1b, 0xe9, 0x38, 0x70, 0xb1, 0xa2, 0xff, 0xb3, 0x84, 0x87, 0x1c, 0x0,  0x14, 0xf5,
      0xe7, 0x8,  0xd7, 0x7d, 0x28, 0xd5, 0xaf, 0x32, 0x7e, 0x73, 0x80, 0xae, 0x14, 0xc9, 0xeb, 0xfa, 0x4,  0xd6, 0x8e,
      0x26, 0x0,  0x1a, 0xd4, 0x6b, 0x5d, 0x62, 0xe,  0x3b, 0x34, 0xae, 0xb3, 0xf2, 0x5,  0x87, 0x75, 0x2c, 0x60, 0x38,
      0xcc, 0x7b, 0x3a, 0x4c, 0xb7, 0x61, 0x16, 0x6a, 0xbb, 0x73, 0x0,  0x5,  0xeb, 0x53, 0xb7, 0x50, 0xbb, 0x29, 0x30,
      0x15, 0x0,  0x16, 0x1d, 0x24, 0xae, 0xef, 0x5c, 0x53, 0xf8, 0x2b, 0x3b, 0x91, 0xe7, 0xe1, 0xe7, 0x9b, 0x1e, 0xa8,
      0x4c, 0xe3, 0xf7, 0xc5, 0x91, 0x26, 0x12, 0x0,  0xf,  0xab, 0xa2, 0x1b, 0x32, 0xa8, 0x67, 0x4b, 0x97, 0x3e, 0xb1,
      0x93, 0x82, 0x16, 0x5f, 0xae, 0x29, 0x77, 0x24, 0x7d, 0x28, 0xc,  0x25, 0xf7, 0x29, 0x98, 0x2a, 0x4c, 0x1a, 0x0,
      0xf,  0x51, 0x7,  0xec, 0x74, 0x2,  0x80, 0xd7, 0x9f, 0x5c, 0xe2, 0x25, 0x38, 0x32, 0x14, 0x3c, 0x17, 0x6,  0x16,
      0x0,  0x1,  0xd5, 0x18, 0x0,  0x0,  0x2c, 0x60, 0x22, 0x45, 0xd9, 0x1c, 0x0,  0x11, 0xeb, 0x73, 0x27, 0x74, 0xf3,
      0x82, 0x5d, 0x32, 0xce, 0x15, 0x76, 0x83, 0x18, 0x73, 0x1,  0xda, 0x2,  0x18, 0x0,  0x0,  0x3f, 0xb3, 0x0,  0x13,
      0x5d, 0x6c, 0x80, 0x6d, 0x6b, 0x31, 0x4a, 0x81, 0x70, 0x8d, 0xaa, 0x52, 0x77, 0xb2, 0x0,  0xab, 0x77, 0xc4, 0xa,
      0x97, 0x1,  0x2,  0x0,  0x0,  0x76, 0xaa, 0x1f, 0x0,  0x1a, 0xd5, 0x50, 0xbd, 0x59, 0x76, 0x1c, 0x13, 0x23, 0xe0,
      0xf,  0x5f, 0x9b, 0x35, 0x44, 0x23, 0x20, 0xbb, 0xc9, 0xcc, 0xb2, 0x7b, 0x1d, 0x24, 0x3a, 0xfb, 0xd5, 0x25, 0xb5,
      0x1f, 0x0,  0x11, 0xf6, 0xb6, 0xc7, 0x3f, 0x35, 0x72, 0x68, 0x7,  0x81, 0x46, 0x60, 0xa3, 0x15, 0x76, 0x1c, 0x82,
      0xf9, 0x9,  0x0,  0xa,  0x2c, 0x5,  0x92, 0xc5, 0xc5, 0xf,  0xdc, 0x79, 0x2e, 0x96, 0x8,  0x0,  0x18, 0xca, 0x9c,
      0x37, 0xc7, 0xf4, 0xa2, 0x43, 0x77, 0x33, 0x22, 0x53, 0xdd, 0xf5, 0xc,  0x69, 0xb5, 0x12, 0x6d, 0x8b, 0xfc, 0xf4,
      0x69, 0xaf, 0x23, 0x15, 0x0,  0x4,  0xcd, 0xe4, 0x1b, 0xa,  0x2a, 0x2d, 0x3,  0x0,  0x18, 0xc,  0x49, 0x4c, 0x71,
      0xf0, 0x7e, 0x3c, 0x2b, 0xe2, 0x89, 0x2b, 0x4f, 0x2c, 0xda, 0x51, 0x43, 0xf3, 0x8d, 0x72, 0x9a, 0x6a, 0x8b, 0xe7,
      0x3d, 0x1c, 0x0,  0x1,  0x8d, 0x2,  0x0,  0x0,  0xb,  0xab, 0x11, 0x0,  0x0,  0x50, 0x2,  0x23, 0x24, 0xb9, 0x25,
      0x2e, 0x0,  0x5,  0x80, 0x17, 0x4,  0xcd, 0xad, 0x0,  0x17, 0xc6, 0x13, 0x6c, 0x8c, 0xe6, 0x52, 0x21, 0x45, 0x24,
      0x1,  0xe5, 0x6f, 0x2c, 0x78, 0xbb, 0x7e, 0x8b, 0xca, 0x22, 0x14, 0x56, 0x6,  0x29, 0x0,  0x6,  0x17, 0xb9, 0x4d,
      0x1a, 0xde, 0x95};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5,  0x2b, 0x56, 0x77, 0xb1, 0x54, 0xda, 0x61, 0x37, 0x49, 0xc9, 0x82, 0x7c,
                           0x5c, 0x27, 0x51, 0xe7, 0x3d, 0x46, 0x2,  0x13, 0x1a, 0x2b, 0x45, 0x21, 0xe7};
  uint8_t bytesprops1[] = {0x14, 0x66, 0xd5, 0x74, 0xe6};
  uint8_t bytesprops2[] = {0x5,  0xf7, 0xd1, 0x62, 0xac, 0xb3, 0x17, 0x94, 0xe0, 0x88, 0xa4, 0x6f, 0xab, 0x55,
                           0xd0, 0xb1, 0x17, 0x4a, 0x9,  0x8f, 0xcd, 0x26, 0xfb, 0x98, 0xd,  0x4f, 0x22, 0x83};
  uint8_t bytesprops3[] = {0x1, 0x61, 0x1b, 0xe9, 0x38, 0x70, 0xb1, 0xa2, 0xff, 0xb3, 0x84, 0x87};
  uint8_t bytesprops4[] = {0xf5, 0xe7, 0x8,  0xd7, 0x7d, 0x28, 0xd5, 0xaf, 0x32, 0x7e,
                           0x73, 0x80, 0xae, 0x14, 0xc9, 0xeb, 0xfa, 0x4,  0xd6, 0x8e};
  uint8_t bytesprops6[] = {0xeb, 0x53, 0xb7, 0x50, 0xbb};
  uint8_t bytesprops5[] = {0xd4, 0x6b, 0x5d, 0x62, 0xe,  0x3b, 0x34, 0xae, 0xb3, 0xf2, 0x5,  0x87, 0x75,
                           0x2c, 0x60, 0x38, 0xcc, 0x7b, 0x3a, 0x4c, 0xb7, 0x61, 0x16, 0x6a, 0xbb, 0x73};
  uint8_t bytesprops7[] = {0x1d, 0x24, 0xae, 0xef, 0x5c, 0x53, 0xf8, 0x2b, 0x3b, 0x91, 0xe7,
                           0xe1, 0xe7, 0x9b, 0x1e, 0xa8, 0x4c, 0xe3, 0xf7, 0xc5, 0x91, 0x26};
  uint8_t bytesprops8[] = {0xab, 0xa2, 0x1b, 0x32, 0xa8, 0x67, 0x4b, 0x97, 0x3e, 0xb1, 0x93, 0x82, 0x16, 0x5f, 0xae};
  uint8_t bytesprops9[] = {0x51, 0x7, 0xec, 0x74, 0x2, 0x80, 0xd7, 0x9f, 0x5c, 0xe2, 0x25, 0x38, 0x32, 0x14, 0x3c};
  uint8_t bytesprops10[] = {0xd5};
  uint8_t bytesprops11[] = {0xeb, 0x73, 0x27, 0x74, 0xf3, 0x82, 0x5d, 0x32, 0xce,
                            0x15, 0x76, 0x83, 0x18, 0x73, 0x1,  0xda, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15264}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4661}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops5}, .v = {5, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11360}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17881}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16307}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd5, 0x50, 0xbd, 0x59, 0x76, 0x1c, 0x13, 0x23, 0xe0, 0xf,  0x5f, 0x9b, 0x35,
                               0x44, 0x23, 0x20, 0xbb, 0xc9, 0xcc, 0xb2, 0x7b, 0x1d, 0x24, 0x3a, 0xfb, 0xd5};
  uint8_t byteswillprops1[] = {0xf6, 0xb6, 0xc7, 0x3f, 0x35, 0x72, 0x68, 0x7, 0x81,
                               0x46, 0x60, 0xa3, 0x15, 0x76, 0x1c, 0x82, 0xf9};
  uint8_t byteswillprops2[] = {0x2c, 0x5, 0x92, 0xc5, 0xc5, 0xf, 0xdc, 0x79, 0x2e, 0x96};
  uint8_t byteswillprops3[] = {0xca, 0x9c, 0x37, 0xc7, 0xf4, 0xa2, 0x43, 0x77, 0x33, 0x22, 0x53, 0xdd,
                               0xf5, 0xc,  0x69, 0xb5, 0x12, 0x6d, 0x8b, 0xfc, 0xf4, 0x69, 0xaf, 0x23};
  uint8_t byteswillprops4[] = {0xcd, 0xe4, 0x1b, 0xa};
  uint8_t byteswillprops5[] = {0xc,  0x49, 0x4c, 0x71, 0xf0, 0x7e, 0x3c, 0x2b, 0xe2, 0x89, 0x2b, 0x4f,
                               0x2c, 0xda, 0x51, 0x43, 0xf3, 0x8d, 0x72, 0x9a, 0x6a, 0x8b, 0xe7, 0x3d};
  uint8_t byteswillprops6[] = {0x8d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30378}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2987}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20482}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9401}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 46}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x80, 0x17, 0x4, 0xcd, 0xad};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc6, 0x13, 0x6c, 0x8c, 0xe6, 0x52, 0x21, 0x45, 0x24, 0x1, 0xe5, 0x6f,
                                  0x2c, 0x78, 0xbb, 0x7e, 0x8b, 0xca, 0x22, 0x14, 0x56, 0x6, 0x29};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3023;
  uint8_t client_id_bytes[] = {0x5d, 0x6c, 0x80, 0x6d, 0x6b, 0x31, 0x4a, 0x81, 0x70, 0x8d,
                               0xaa, 0x52, 0x77, 0xb2, 0x0,  0xab, 0x77, 0xc4, 0xa};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x17, 0xb9, 0x4d, 0x1a, 0xde, 0x95};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\FS\ACK\249\148\r\158\162\&8uP\173\212\135\254\214", _password = Just
// "\234\199:\176j\218\226\193U\206-\f\SOHRuz\167\199\196", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS1, _willTopic = "\176\DEL\SOH\132>\247\149\GSx", _willMsg =
// "\247Wdo3\141\135\211r\DC4B\b3\225<\247Y7\136\134\&5O\183", _willProps = [PropServerReference
// "\231",PropResponseTopic "`\NAK\229\r\199e\"<\tn\255lp\211\136p\176W:2\181'",PropRequestResponseInformation
// 153,PropResponseInformation "\DLE\228k\188\169\GS",PropSubscriptionIdentifierAvailable 202,PropMaximumQoS
// 53,PropRequestProblemInformation 41]}), _cleanSession = True, _keepAlive = 13117, _connID =
// "\226s\168\NUL\201\208\250\224\r\SOZ\221X<[&\\\181\184?\168\RS", _properties = [PropAuthenticationData
// "\141\193\180\223\&8'\\\234\EMD\212\175\242b\175",PropAuthenticationData "\221\DLE\EOT\SO;\175",PropTopicAliasMaximum
// 7754]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xba, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x33, 0x3d, 0x1e, 0x16, 0x0,  0xf,  0x8d, 0xc1,
      0xb4, 0xdf, 0x38, 0x27, 0x5c, 0xea, 0x19, 0x44, 0xd4, 0xaf, 0xf2, 0x62, 0xaf, 0x16, 0x0,  0x6,  0xdd, 0x10, 0x4,
      0xe,  0x3b, 0xaf, 0x22, 0x1e, 0x4a, 0x0,  0x16, 0xe2, 0x73, 0xa8, 0x0,  0xc9, 0xd0, 0xfa, 0xe0, 0xd,  0xe,  0x5a,
      0xdd, 0x58, 0x3c, 0x5b, 0x26, 0x5c, 0xb5, 0xb8, 0x3f, 0xa8, 0x1e, 0x2e, 0x1c, 0x0,  0x1,  0xe7, 0x8,  0x0,  0x16,
      0x60, 0x15, 0xe5, 0xd,  0xc7, 0x65, 0x22, 0x3c, 0x9,  0x6e, 0xff, 0x6c, 0x70, 0xd3, 0x88, 0x70, 0xb0, 0x57, 0x3a,
      0x32, 0xb5, 0x27, 0x19, 0x99, 0x1a, 0x0,  0x6,  0x10, 0xe4, 0x6b, 0xbc, 0xa9, 0x1d, 0x29, 0xca, 0x24, 0x35, 0x17,
      0x29, 0x0,  0x9,  0xb0, 0x7f, 0x1,  0x84, 0x3e, 0xf7, 0x95, 0x1d, 0x78, 0x0,  0x17, 0xf7, 0x57, 0x64, 0x6f, 0x33,
      0x8d, 0x87, 0xd3, 0x72, 0x14, 0x42, 0x8,  0x33, 0xe1, 0x3c, 0xf7, 0x59, 0x37, 0x88, 0x86, 0x35, 0x4f, 0xb7, 0x0,
      0xf,  0x1c, 0x6,  0xf9, 0x94, 0xd,  0x9e, 0xa2, 0x38, 0x75, 0x50, 0xad, 0xd4, 0x87, 0xfe, 0xd6, 0x0,  0x13, 0xea,
      0xc7, 0x3a, 0xb0, 0x6a, 0xda, 0xe2, 0xc1, 0x55, 0xce, 0x2d, 0xc,  0x1,  0x52, 0x75, 0x7a, 0xa7, 0xc7, 0xc4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8d, 0xc1, 0xb4, 0xdf, 0x38, 0x27, 0x5c, 0xea, 0x19, 0x44, 0xd4, 0xaf, 0xf2, 0x62, 0xaf};
  uint8_t bytesprops1[] = {0xdd, 0x10, 0x4, 0xe, 0x3b, 0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7754}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe7};
  uint8_t byteswillprops1[] = {0x60, 0x15, 0xe5, 0xd,  0xc7, 0x65, 0x22, 0x3c, 0x9,  0x6e, 0xff,
                               0x6c, 0x70, 0xd3, 0x88, 0x70, 0xb0, 0x57, 0x3a, 0x32, 0xb5, 0x27};
  uint8_t byteswillprops2[] = {0x10, 0xe4, 0x6b, 0xbc, 0xa9, 0x1d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 41}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb0, 0x7f, 0x1, 0x84, 0x3e, 0xf7, 0x95, 0x1d, 0x78};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf7, 0x57, 0x64, 0x6f, 0x33, 0x8d, 0x87, 0xd3, 0x72, 0x14, 0x42, 0x8,
                                  0x33, 0xe1, 0x3c, 0xf7, 0x59, 0x37, 0x88, 0x86, 0x35, 0x4f, 0xb7};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13117;
  uint8_t client_id_bytes[] = {0xe2, 0x73, 0xa8, 0x0,  0xc9, 0xd0, 0xfa, 0xe0, 0xd,  0xe,  0x5a,
                               0xdd, 0x58, 0x3c, 0x5b, 0x26, 0x5c, 0xb5, 0xb8, 0x3f, 0xa8, 0x1e};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1c, 0x6, 0xf9, 0x94, 0xd, 0x9e, 0xa2, 0x38, 0x75, 0x50, 0xad, 0xd4, 0x87, 0xfe, 0xd6};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xea, 0xc7, 0x3a, 0xb0, 0x6a, 0xda, 0xe2, 0xc1, 0x55, 0xce,
                              0x2d, 0xc,  0x1,  0x52, 0x75, 0x7a, 0xa7, 0xc7, 0xc4};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245H3\185\249\128\172\213o\226N@\DC1", _password = Just
// "\171\195S\150\179\183\184\247*\177\211j.\227\239\199\SUB\r\187\131L\SYN\CAN\239\f\152", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "%W", _willMsg = "l\CAN\147R\DC3", _willProps =
// [PropAssignedClientIdentifier "\DC1.l\245\ETB\227M\132\216\236\ETX\237re\244\\\223a",PropResponseTopic
// "_<\199\DLE\156k\229.\160K\224g",PropMaximumQoS 37,PropWillDelayInterval 12106,PropAssignedClientIdentifier "q\no
// \217\233o\236\245\US\227\140D}\187U",PropRetainAvailable 63,PropTopicAlias 1675,PropWillDelayInterval
// 20416,PropUserProperty "\208'\167\227\232\223\190\235\SYN\207\208\DC2"
// "\\\187\235ZBO\EMl\250\&7\232\220\NAK\212G\130\207\251\134",PropTopicAliasMaximum
// 4756,PropWildcardSubscriptionAvailable 186,PropMessageExpiryInterval 15069,PropReasonString
// "\224H\229P\178\195\254\212\GS\241\&2\222%\US\130\\\164Q\161i.\142\136\193\218",PropResponseTopic
// "4g\168\180\254\146\239",PropReasonString "*\173",PropMaximumQoS 90,PropServerReference
// "\190\&6JkD\132W\SYN,\235X`\DLE\163\190SPk\248\140w>",PropMaximumQoS 139,PropResponseTopic
// "<\184\227",PropCorrelationData "",PropMaximumPacketSize 22988,PropTopicAliasMaximum 16579,PropUserProperty
// "\237\214" "\179(\242\170\200\135\167B\159\EOT\129z\158l\233\156\182j\168\196_",PropSubscriptionIdentifier
// 10,PropRequestResponseInformation 133,PropRequestProblemInformation 76,PropTopicAliasMaximum 3903,PropUserProperty "
// \150\204\SYN\231[\131\207\&8o"
// "\194\138\CANn\137po\USO\SI\ETB\164\210\243\137\183/\178\ETB\151\142\a}\230\177\152\129\191\197\239"]}),
// _cleanSession = True, _keepAlive = 18606, _connID = "6", _properties = [PropResponseInformation
// "#\248\162",PropSubscriptionIdentifier 18,PropReceiveMaximum 19652,PropMaximumPacketSize
// 4736,PropMessageExpiryInterval 23889,PropMaximumQoS 178,PropMaximumQoS 151,PropPayloadFormatIndicator
// 229,PropMaximumPacketSize 15274,PropCorrelationData
// "$9@W\211`B\151\175\229\193\195\203\171\235\255\200\128nz{-\158\240",PropResponseInformation
// "+\ACKt\CAN\SUB\247_",PropRetainAvailable 28,PropTopicAliasMaximum 5862]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xb1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x48, 0xae, 0x4a, 0x1a, 0x0,  0x3,  0x23, 0xf8,
      0xa2, 0xb,  0x12, 0x21, 0x4c, 0xc4, 0x27, 0x0,  0x0,  0x12, 0x80, 0x2,  0x0,  0x0,  0x5d, 0x51, 0x24, 0xb2, 0x24,
      0x97, 0x1,  0xe5, 0x27, 0x0,  0x0,  0x3b, 0xaa, 0x9,  0x0,  0x18, 0x24, 0x39, 0x40, 0x57, 0xd3, 0x60, 0x42, 0x97,
      0xaf, 0xe5, 0xc1, 0xc3, 0xcb, 0xab, 0xeb, 0xff, 0xc8, 0x80, 0x6e, 0x7a, 0x7b, 0x2d, 0x9e, 0xf0, 0x1a, 0x0,  0x7,
      0x2b, 0x6,  0x74, 0x18, 0x1a, 0xf7, 0x5f, 0x25, 0x1c, 0x22, 0x16, 0xe6, 0x0,  0x1,  0x36, 0xa1, 0x2,  0x12, 0x0,
      0x12, 0x11, 0x2e, 0x6c, 0xf5, 0x17, 0xe3, 0x4d, 0x84, 0xd8, 0xec, 0x3,  0xed, 0x72, 0x65, 0xf4, 0x5c, 0xdf, 0x61,
      0x8,  0x0,  0xc,  0x5f, 0x3c, 0xc7, 0x10, 0x9c, 0x6b, 0xe5, 0x2e, 0xa0, 0x4b, 0xe0, 0x67, 0x24, 0x25, 0x18, 0x0,
      0x0,  0x2f, 0x4a, 0x12, 0x0,  0x10, 0x71, 0xa,  0x6f, 0x20, 0xd9, 0xe9, 0x6f, 0xec, 0xf5, 0x1f, 0xe3, 0x8c, 0x44,
      0x7d, 0xbb, 0x55, 0x25, 0x3f, 0x23, 0x6,  0x8b, 0x18, 0x0,  0x0,  0x4f, 0xc0, 0x26, 0x0,  0xc,  0xd0, 0x27, 0xa7,
      0xe3, 0xe8, 0xdf, 0xbe, 0xeb, 0x16, 0xcf, 0xd0, 0x12, 0x0,  0x13, 0x5c, 0xbb, 0xeb, 0x5a, 0x42, 0x4f, 0x19, 0x6c,
      0xfa, 0x37, 0xe8, 0xdc, 0x15, 0xd4, 0x47, 0x82, 0xcf, 0xfb, 0x86, 0x22, 0x12, 0x94, 0x28, 0xba, 0x2,  0x0,  0x0,
      0x3a, 0xdd, 0x1f, 0x0,  0x19, 0xe0, 0x48, 0xe5, 0x50, 0xb2, 0xc3, 0xfe, 0xd4, 0x1d, 0xf1, 0x32, 0xde, 0x25, 0x1f,
      0x82, 0x5c, 0xa4, 0x51, 0xa1, 0x69, 0x2e, 0x8e, 0x88, 0xc1, 0xda, 0x8,  0x0,  0x7,  0x34, 0x67, 0xa8, 0xb4, 0xfe,
      0x92, 0xef, 0x1f, 0x0,  0x2,  0x2a, 0xad, 0x24, 0x5a, 0x1c, 0x0,  0x16, 0xbe, 0x36, 0x4a, 0x6b, 0x44, 0x84, 0x57,
      0x16, 0x2c, 0xeb, 0x58, 0x60, 0x10, 0xa3, 0xbe, 0x53, 0x50, 0x6b, 0xf8, 0x8c, 0x77, 0x3e, 0x24, 0x8b, 0x8,  0x0,
      0x3,  0x3c, 0xb8, 0xe3, 0x9,  0x0,  0x0,  0x27, 0x0,  0x0,  0x59, 0xcc, 0x22, 0x40, 0xc3, 0x26, 0x0,  0x2,  0xed,
      0xd6, 0x0,  0x15, 0xb3, 0x28, 0xf2, 0xaa, 0xc8, 0x87, 0xa7, 0x42, 0x9f, 0x4,  0x81, 0x7a, 0x9e, 0x6c, 0xe9, 0x9c,
      0xb6, 0x6a, 0xa8, 0xc4, 0x5f, 0xb,  0xa,  0x19, 0x85, 0x17, 0x4c, 0x22, 0xf,  0x3f, 0x26, 0x0,  0xa,  0x20, 0x96,
      0xcc, 0x16, 0xe7, 0x5b, 0x83, 0xcf, 0x38, 0x6f, 0x0,  0x1e, 0xc2, 0x8a, 0x18, 0x6e, 0x89, 0x70, 0x6f, 0x1f, 0x4f,
      0xf,  0x17, 0xa4, 0xd2, 0xf3, 0x89, 0xb7, 0x2f, 0xb2, 0x17, 0x97, 0x8e, 0x7,  0x7d, 0xe6, 0xb1, 0x98, 0x81, 0xbf,
      0xc5, 0xef, 0x0,  0x2,  0x25, 0x57, 0x0,  0x5,  0x6c, 0x18, 0x93, 0x52, 0x13, 0x0,  0xd,  0xf5, 0x48, 0x33, 0xb9,
      0xf9, 0x80, 0xac, 0xd5, 0x6f, 0xe2, 0x4e, 0x40, 0x11, 0x0,  0x1a, 0xab, 0xc3, 0x53, 0x96, 0xb3, 0xb7, 0xb8, 0xf7,
      0x2a, 0xb1, 0xd3, 0x6a, 0x2e, 0xe3, 0xef, 0xc7, 0x1a, 0xd,  0xbb, 0x83, 0x4c, 0x16, 0x18, 0xef, 0xc,  0x98};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x23, 0xf8, 0xa2};
  uint8_t bytesprops1[] = {0x24, 0x39, 0x40, 0x57, 0xd3, 0x60, 0x42, 0x97, 0xaf, 0xe5, 0xc1, 0xc3,
                           0xcb, 0xab, 0xeb, 0xff, 0xc8, 0x80, 0x6e, 0x7a, 0x7b, 0x2d, 0x9e, 0xf0};
  uint8_t bytesprops2[] = {0x2b, 0x6, 0x74, 0x18, 0x1a, 0xf7, 0x5f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19652}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4736}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23889}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15274}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5862}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x11, 0x2e, 0x6c, 0xf5, 0x17, 0xe3, 0x4d, 0x84, 0xd8,
                               0xec, 0x3,  0xed, 0x72, 0x65, 0xf4, 0x5c, 0xdf, 0x61};
  uint8_t byteswillprops1[] = {0x5f, 0x3c, 0xc7, 0x10, 0x9c, 0x6b, 0xe5, 0x2e, 0xa0, 0x4b, 0xe0, 0x67};
  uint8_t byteswillprops2[] = {0x71, 0xa,  0x6f, 0x20, 0xd9, 0xe9, 0x6f, 0xec,
                               0xf5, 0x1f, 0xe3, 0x8c, 0x44, 0x7d, 0xbb, 0x55};
  uint8_t byteswillprops4[] = {0x5c, 0xbb, 0xeb, 0x5a, 0x42, 0x4f, 0x19, 0x6c, 0xfa, 0x37,
                               0xe8, 0xdc, 0x15, 0xd4, 0x47, 0x82, 0xcf, 0xfb, 0x86};
  uint8_t byteswillprops3[] = {0xd0, 0x27, 0xa7, 0xe3, 0xe8, 0xdf, 0xbe, 0xeb, 0x16, 0xcf, 0xd0, 0x12};
  uint8_t byteswillprops5[] = {0xe0, 0x48, 0xe5, 0x50, 0xb2, 0xc3, 0xfe, 0xd4, 0x1d, 0xf1, 0x32, 0xde, 0x25,
                               0x1f, 0x82, 0x5c, 0xa4, 0x51, 0xa1, 0x69, 0x2e, 0x8e, 0x88, 0xc1, 0xda};
  uint8_t byteswillprops6[] = {0x34, 0x67, 0xa8, 0xb4, 0xfe, 0x92, 0xef};
  uint8_t byteswillprops7[] = {0x2a, 0xad};
  uint8_t byteswillprops8[] = {0xbe, 0x36, 0x4a, 0x6b, 0x44, 0x84, 0x57, 0x16, 0x2c, 0xeb, 0x58,
                               0x60, 0x10, 0xa3, 0xbe, 0x53, 0x50, 0x6b, 0xf8, 0x8c, 0x77, 0x3e};
  uint8_t byteswillprops9[] = {0x3c, 0xb8, 0xe3};
  uint8_t byteswillprops10[] = {0};
  uint8_t byteswillprops12[] = {0xb3, 0x28, 0xf2, 0xaa, 0xc8, 0x87, 0xa7, 0x42, 0x9f, 0x4, 0x81,
                                0x7a, 0x9e, 0x6c, 0xe9, 0x9c, 0xb6, 0x6a, 0xa8, 0xc4, 0x5f};
  uint8_t byteswillprops11[] = {0xed, 0xd6};
  uint8_t byteswillprops14[] = {0xc2, 0x8a, 0x18, 0x6e, 0x89, 0x70, 0x6f, 0x1f, 0x4f, 0xf,
                                0x17, 0xa4, 0xd2, 0xf3, 0x89, 0xb7, 0x2f, 0xb2, 0x17, 0x97,
                                0x8e, 0x7,  0x7d, 0xe6, 0xb1, 0x98, 0x81, 0xbf, 0xc5, 0xef};
  uint8_t byteswillprops13[] = {0x20, 0x96, 0xcc, 0x16, 0xe7, 0x5b, 0x83, 0xcf, 0x38, 0x6f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12106}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1675}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20416}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {12, (char*)&byteswillprops3}, .v = {19, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4756}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15069}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22988}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16579}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops11}, .v = {21, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3903}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&byteswillprops13}, .v = {30, (char*)&byteswillprops14}}}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x25, 0x57};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6c, 0x18, 0x93, 0x52, 0x13};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18606;
  uint8_t client_id_bytes[] = {0x36};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0x48, 0x33, 0xb9, 0xf9, 0x80, 0xac, 0xd5, 0x6f, 0xe2, 0x4e, 0x40, 0x11};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xab, 0xc3, 0x53, 0x96, 0xb3, 0xb7, 0xb8, 0xf7, 0x2a, 0xb1, 0xd3, 0x6a, 0x2e,
                              0xe3, 0xef, 0xc7, 0x1a, 0xd,  0xbb, 0x83, 0x4c, 0x16, 0x18, 0xef, 0xc,  0x98};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\164\ESC\184\140r\249\243:~\182\177\161", _password = Just
// "=\137\152\193\FS\138\CAN\SO\GS\172=$\179\178=\227\216>", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\196", _willMsg = "\189\206O\203\f\146\165\155D\200N\207\198\169;$\242\244\228", _willProps =
// [PropServerKeepAlive 15818,PropUserProperty "\211%\162\170\155j\228\171" "0\140\234.\229v8S\179Q\198
// \221\239\243I\199\189\179Um",PropTopicAliasMaximum 10841,PropSubscriptionIdentifier 19,PropPayloadFormatIndicator
// 208]}), _cleanSession = True, _keepAlive = 14044, _connID = "\158\230\170S\NUL\239\ETB", _properties =
// [PropTopicAlias 25138,PropAssignedClientIdentifier
// "\f\EOT\r@\224\&3\187.\166\145\144\DC2Y-`\228\&8",PropResponseInformation
// "_\by\141]]}\163\DC3\145\232\\m\184>\244\236",PropTopicAliasMaximum 28569,PropServerKeepAlive
// 12548,PropMessageExpiryInterval 20738,PropSessionExpiryInterval 2221,PropWillDelayInterval
// 29838,PropRequestResponseInformation 89,PropSubscriptionIdentifier 19,PropRetainAvailable 96,PropMaximumPacketSize
// 21169,PropTopicAlias 14616,PropSubscriptionIdentifierAvailable 146]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x36, 0xdc, 0x50, 0x23, 0x62, 0x32, 0x12, 0x0,
      0x11, 0xc,  0x4,  0xd,  0x40, 0xe0, 0x33, 0xbb, 0x2e, 0xa6, 0x91, 0x90, 0x12, 0x59, 0x2d, 0x60, 0xe4, 0x38, 0x1a,
      0x0,  0x11, 0x5f, 0x8,  0x79, 0x8d, 0x5d, 0x5d, 0x7d, 0xa3, 0x13, 0x91, 0xe8, 0x5c, 0x6d, 0xb8, 0x3e, 0xf4, 0xec,
      0x22, 0x6f, 0x99, 0x13, 0x31, 0x4,  0x2,  0x0,  0x0,  0x51, 0x2,  0x11, 0x0,  0x0,  0x8,  0xad, 0x18, 0x0,  0x0,
      0x74, 0x8e, 0x19, 0x59, 0xb,  0x13, 0x25, 0x60, 0x27, 0x0,  0x0,  0x52, 0xb1, 0x23, 0x39, 0x18, 0x29, 0x92, 0x0,
      0x7,  0x9e, 0xe6, 0xaa, 0x53, 0x0,  0xef, 0x17, 0x2c, 0x13, 0x3d, 0xca, 0x26, 0x0,  0x8,  0xd3, 0x25, 0xa2, 0xaa,
      0x9b, 0x6a, 0xe4, 0xab, 0x0,  0x15, 0x30, 0x8c, 0xea, 0x2e, 0xe5, 0x76, 0x38, 0x53, 0xb3, 0x51, 0xc6, 0x20, 0xdd,
      0xef, 0xf3, 0x49, 0xc7, 0xbd, 0xb3, 0x55, 0x6d, 0x22, 0x2a, 0x59, 0xb,  0x13, 0x1,  0xd0, 0x0,  0x1,  0xc4, 0x0,
      0x13, 0xbd, 0xce, 0x4f, 0xcb, 0xc,  0x92, 0xa5, 0x9b, 0x44, 0xc8, 0x4e, 0xcf, 0xc6, 0xa9, 0x3b, 0x24, 0xf2, 0xf4,
      0xe4, 0x0,  0xc,  0xa4, 0x1b, 0xb8, 0x8c, 0x72, 0xf9, 0xf3, 0x3a, 0x7e, 0xb6, 0xb1, 0xa1, 0x0,  0x12, 0x3d, 0x89,
      0x98, 0xc1, 0x1c, 0x8a, 0x18, 0xe,  0x1d, 0xac, 0x3d, 0x24, 0xb3, 0xb2, 0x3d, 0xe3, 0xd8, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc,  0x4,  0xd,  0x40, 0xe0, 0x33, 0xbb, 0x2e, 0xa6,
                           0x91, 0x90, 0x12, 0x59, 0x2d, 0x60, 0xe4, 0x38};
  uint8_t bytesprops1[] = {0x5f, 0x8,  0x79, 0x8d, 0x5d, 0x5d, 0x7d, 0xa3, 0x13,
                           0x91, 0xe8, 0x5c, 0x6d, 0xb8, 0x3e, 0xf4, 0xec};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25138}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28569}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12548}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20738}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2221}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29838}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21169}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14616}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x30, 0x8c, 0xea, 0x2e, 0xe5, 0x76, 0x38, 0x53, 0xb3, 0x51, 0xc6,
                               0x20, 0xdd, 0xef, 0xf3, 0x49, 0xc7, 0xbd, 0xb3, 0x55, 0x6d};
  uint8_t byteswillprops0[] = {0xd3, 0x25, 0xa2, 0xaa, 0x9b, 0x6a, 0xe4, 0xab};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15818}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops0}, .v = {21, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10841}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 208}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbd, 0xce, 0x4f, 0xcb, 0xc,  0x92, 0xa5, 0x9b, 0x44, 0xc8,
                                  0x4e, 0xcf, 0xc6, 0xa9, 0x3b, 0x24, 0xf2, 0xf4, 0xe4};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14044;
  uint8_t client_id_bytes[] = {0x9e, 0xe6, 0xaa, 0x53, 0x0, 0xef, 0x17};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa4, 0x1b, 0xb8, 0x8c, 0x72, 0xf9, 0xf3, 0x3a, 0x7e, 0xb6, 0xb1, 0xa1};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3d, 0x89, 0x98, 0xc1, 0x1c, 0x8a, 0x18, 0xe,  0x1d,
                              0xac, 0x3d, 0x24, 0xb3, 0xb2, 0x3d, 0xe3, 0xd8, 0x3e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "bl\173\212\183[K\243\204\225\r\255\210,\215\200\142\&1\181\SOH8\206\168", _password
// = Just "\NUL. m\211I\167\170\222\224%\253#\246", _lastWill = Nothing, _cleanSession = False, _keepAlive = 24572,
// _connID = "\182$y\234\226\247:S\142\"\245_\255\&0\203\191_\249P\SUB8\223\190]0\182\ETBg<", _properties =
// [PropWillDelayInterval 17579,PropMaximumPacketSize 32742,PropAssignedClientIdentifier
// "\DELR\EOT\188\DC4\DC2u\DC2\253",PropSubscriptionIdentifierAvailable 23,PropMaximumPacketSize
// 17824,PropSharedSubscriptionAvailable 192,PropAuthenticationData "s\195i\249C\205",PropSharedSubscriptionAvailable
// 233,PropServerReference "\v\141,\136\189]\149\150e\233\US\149 \241\GSw]\193\t",PropServerReference
// "\DC2\193R\ETB\176M\189\155\134\206\253e\153\EM\152",PropMaximumQoS 124,PropRequestProblemInformation
// 185,PropWillDelayInterval 23945,PropServerKeepAlive 11387,PropMaximumPacketSize 2848,PropAssignedClientIdentifier
// "\DC1\240\252\182N\207M\251\252\RSLoj\180",PropServerKeepAlive 503,PropMaximumPacketSize 19175,PropAuthenticationData
// "R\150\224\199\FSN7\164\DC1\255\v\184\SOH\216R\137\132E\132\ETBT4",PropRetainAvailable 14,PropWillDelayInterval
// 23960]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xf0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x5f, 0xfc, 0x9c, 0x1,  0x18, 0x0,  0x0,  0x44,
      0xab, 0x27, 0x0,  0x0,  0x7f, 0xe6, 0x12, 0x0,  0x9,  0x7f, 0x52, 0x4,  0xbc, 0x14, 0x12, 0x75, 0x12, 0xfd, 0x29,
      0x17, 0x27, 0x0,  0x0,  0x45, 0xa0, 0x2a, 0xc0, 0x16, 0x0,  0x6,  0x73, 0xc3, 0x69, 0xf9, 0x43, 0xcd, 0x2a, 0xe9,
      0x1c, 0x0,  0x13, 0xb,  0x8d, 0x2c, 0x88, 0xbd, 0x5d, 0x95, 0x96, 0x65, 0xe9, 0x1f, 0x95, 0x20, 0xf1, 0x1d, 0x77,
      0x5d, 0xc1, 0x9,  0x1c, 0x0,  0xf,  0x12, 0xc1, 0x52, 0x17, 0xb0, 0x4d, 0xbd, 0x9b, 0x86, 0xce, 0xfd, 0x65, 0x99,
      0x19, 0x98, 0x24, 0x7c, 0x17, 0xb9, 0x18, 0x0,  0x0,  0x5d, 0x89, 0x13, 0x2c, 0x7b, 0x27, 0x0,  0x0,  0xb,  0x20,
      0x12, 0x0,  0xe,  0x11, 0xf0, 0xfc, 0xb6, 0x4e, 0xcf, 0x4d, 0xfb, 0xfc, 0x1e, 0x4c, 0x6f, 0x6a, 0xb4, 0x13, 0x1,
      0xf7, 0x27, 0x0,  0x0,  0x4a, 0xe7, 0x16, 0x0,  0x16, 0x52, 0x96, 0xe0, 0xc7, 0x1c, 0x4e, 0x37, 0xa4, 0x11, 0xff,
      0xb,  0xb8, 0x1,  0xd8, 0x52, 0x89, 0x84, 0x45, 0x84, 0x17, 0x54, 0x34, 0x25, 0xe,  0x18, 0x0,  0x0,  0x5d, 0x98,
      0x0,  0x1d, 0xb6, 0x24, 0x79, 0xea, 0xe2, 0xf7, 0x3a, 0x53, 0x8e, 0x22, 0xf5, 0x5f, 0xff, 0x30, 0xcb, 0xbf, 0x5f,
      0xf9, 0x50, 0x1a, 0x38, 0xdf, 0xbe, 0x5d, 0x30, 0xb6, 0x17, 0x67, 0x3c, 0x0,  0x17, 0x62, 0x6c, 0xad, 0xd4, 0xb7,
      0x5b, 0x4b, 0xf3, 0xcc, 0xe1, 0xd,  0xff, 0xd2, 0x2c, 0xd7, 0xc8, 0x8e, 0x31, 0xb5, 0x1,  0x38, 0xce, 0xa8, 0x0,
      0xe,  0x0,  0x2e, 0x20, 0x6d, 0xd3, 0x49, 0xa7, 0xaa, 0xde, 0xe0, 0x25, 0xfd, 0x23, 0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7f, 0x52, 0x4, 0xbc, 0x14, 0x12, 0x75, 0x12, 0xfd};
  uint8_t bytesprops1[] = {0x73, 0xc3, 0x69, 0xf9, 0x43, 0xcd};
  uint8_t bytesprops2[] = {0xb,  0x8d, 0x2c, 0x88, 0xbd, 0x5d, 0x95, 0x96, 0x65, 0xe9,
                           0x1f, 0x95, 0x20, 0xf1, 0x1d, 0x77, 0x5d, 0xc1, 0x9};
  uint8_t bytesprops3[] = {0x12, 0xc1, 0x52, 0x17, 0xb0, 0x4d, 0xbd, 0x9b, 0x86, 0xce, 0xfd, 0x65, 0x99, 0x19, 0x98};
  uint8_t bytesprops4[] = {0x11, 0xf0, 0xfc, 0xb6, 0x4e, 0xcf, 0x4d, 0xfb, 0xfc, 0x1e, 0x4c, 0x6f, 0x6a, 0xb4};
  uint8_t bytesprops5[] = {0x52, 0x96, 0xe0, 0xc7, 0x1c, 0x4e, 0x37, 0xa4, 0x11, 0xff, 0xb,
                           0xb8, 0x1,  0xd8, 0x52, 0x89, 0x84, 0x45, 0x84, 0x17, 0x54, 0x34};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17579}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32742}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17824}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23945}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11387}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2848}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 503}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19175}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23960}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24572;
  uint8_t client_id_bytes[] = {0xb6, 0x24, 0x79, 0xea, 0xe2, 0xf7, 0x3a, 0x53, 0x8e, 0x22, 0xf5, 0x5f, 0xff, 0x30, 0xcb,
                               0xbf, 0x5f, 0xf9, 0x50, 0x1a, 0x38, 0xdf, 0xbe, 0x5d, 0x30, 0xb6, 0x17, 0x67, 0x3c};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x62, 0x6c, 0xad, 0xd4, 0xb7, 0x5b, 0x4b, 0xf3, 0xcc, 0xe1, 0xd, 0xff,
                              0xd2, 0x2c, 0xd7, 0xc8, 0x8e, 0x31, 0xb5, 0x1,  0x38, 0xce, 0xa8};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x0, 0x2e, 0x20, 0x6d, 0xd3, 0x49, 0xa7, 0xaa, 0xde, 0xe0, 0x25, 0xfd, 0x23, 0xf6};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "=\CANt\155_d\FS\f:\252", _password = Just "J\175\SI\188\240", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\181\230\197Xq\187C@;P\208\&1\CAN\191\152w[\185`UI\CAN", _willMsg = "\151\DC4y'PM^\214\&0<^k\179\179:|", _willProps
// = [PropResponseInformation
// "w\DC2=\165M\231\238\NAK\162\240\206q\152\142\227\220\168\167,K\222y\240w\223\218`\248",PropMessageExpiryInterval
// 11399,PropSessionExpiryInterval 29117,PropAuthenticationData "\a\ENQ\194|\DC3
// \229\186L?\155\167T\FSV\205\146$\166\195\EOT:\fo",PropWillDelayInterval 19781,PropResponseInformation
// ":\253$u\EM\144\&3\139",PropRetainAvailable 243,PropSubscriptionIdentifierAvailable 252,PropUserProperty
// "6\205}\204\235=aO,\v\200p\184b\189\165\ETBN\228-\240\161\233\247" "",PropMessageExpiryInterval
// 5382,PropServerReference "=\147\ETB",PropResponseTopic "~\170Ydd\SYNoj\198*2\187\206C
// O\236\v\223\250\223\222\249\191\170A",PropMessageExpiryInterval 12235,PropSubscriptionIdentifier
// 10,PropSubscriptionIdentifierAvailable 218,PropCorrelationData "K >zG\226d\219\FS\253 ",PropMaximumPacketSize
// 19752,PropAssignedClientIdentifier "\208\222r\156\DEL\206XE",PropMaximumQoS 211,PropMaximumQoS
// 34,PropTopicAliasMaximum 15201,PropSharedSubscriptionAvailable 156]}), _cleanSession = False, _keepAlive = 147,
// _connID = "\252{\206-]\238\&1\253 \RS\SIy\178", _properties = [PropMessageExpiryInterval 15650,PropCorrelationData
// "\168s\144\128\209P\198\193\146\140\173\206v\198\170\169n\EM\\+j-\198u\215\144\\\204\168\"",PropTopicAlias
// 6863,PropSharedSubscriptionAvailable 115,PropWillDelayInterval 9805,PropMessageExpiryInterval
// 13621,PropMaximumPacketSize 29496,PropSubscriptionIdentifierAvailable 181,PropAuthenticationData
// ">\161\NAK\175",PropSubscriptionIdentifier 13,PropMessageExpiryInterval 5726,PropMaximumQoS
// 52,PropAssignedClientIdentifier ")",PropSessionExpiryInterval 13529,PropMaximumQoS
// 103,PropWildcardSubscriptionAvailable 7,PropTopicAlias 4946,PropMaximumPacketSize 20204,PropRetainAvailable
// 45,PropTopicAlias 14764,PropSubscriptionIdentifier 13,PropSharedSubscriptionAvailable 253,PropResponseTopic
// "\145\b\215\250\196&\STX\199\253",PropMessageExpiryInterval 22286]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xa1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x0,  0x93, 0x7b, 0x2,  0x0,  0x0,  0x3d, 0x22,
      0x9,  0x0,  0x1e, 0xa8, 0x73, 0x90, 0x80, 0xd1, 0x50, 0xc6, 0xc1, 0x92, 0x8c, 0xad, 0xce, 0x76, 0xc6, 0xaa, 0xa9,
      0x6e, 0x19, 0x5c, 0x2b, 0x6a, 0x2d, 0xc6, 0x75, 0xd7, 0x90, 0x5c, 0xcc, 0xa8, 0x22, 0x23, 0x1a, 0xcf, 0x2a, 0x73,
      0x18, 0x0,  0x0,  0x26, 0x4d, 0x2,  0x0,  0x0,  0x35, 0x35, 0x27, 0x0,  0x0,  0x73, 0x38, 0x29, 0xb5, 0x16, 0x0,
      0x4,  0x3e, 0xa1, 0x15, 0xaf, 0xb,  0xd,  0x2,  0x0,  0x0,  0x16, 0x5e, 0x24, 0x34, 0x12, 0x0,  0x1,  0x29, 0x11,
      0x0,  0x0,  0x34, 0xd9, 0x24, 0x67, 0x28, 0x7,  0x23, 0x13, 0x52, 0x27, 0x0,  0x0,  0x4e, 0xec, 0x25, 0x2d, 0x23,
      0x39, 0xac, 0xb,  0xd,  0x2a, 0xfd, 0x8,  0x0,  0x9,  0x91, 0x8,  0xd7, 0xfa, 0xc4, 0x26, 0x2,  0xc7, 0xfd, 0x2,
      0x0,  0x0,  0x57, 0xe,  0x0,  0xd,  0xfc, 0x7b, 0xce, 0x2d, 0x5d, 0xee, 0x31, 0xfd, 0x20, 0x1e, 0xf,  0x79, 0xb2,
      0xcd, 0x1,  0x1a, 0x0,  0x1c, 0x77, 0x12, 0x3d, 0xa5, 0x4d, 0xe7, 0xee, 0x15, 0xa2, 0xf0, 0xce, 0x71, 0x98, 0x8e,
      0xe3, 0xdc, 0xa8, 0xa7, 0x2c, 0x4b, 0xde, 0x79, 0xf0, 0x77, 0xdf, 0xda, 0x60, 0xf8, 0x2,  0x0,  0x0,  0x2c, 0x87,
      0x11, 0x0,  0x0,  0x71, 0xbd, 0x16, 0x0,  0x18, 0x7,  0x5,  0xc2, 0x7c, 0x13, 0x20, 0xe5, 0xba, 0x4c, 0x3f, 0x9b,
      0xa7, 0x54, 0x1c, 0x56, 0xcd, 0x92, 0x24, 0xa6, 0xc3, 0x4,  0x3a, 0xc,  0x6f, 0x18, 0x0,  0x0,  0x4d, 0x45, 0x1a,
      0x0,  0x8,  0x3a, 0xfd, 0x24, 0x75, 0x19, 0x90, 0x33, 0x8b, 0x25, 0xf3, 0x29, 0xfc, 0x26, 0x0,  0x18, 0x36, 0xcd,
      0x7d, 0xcc, 0xeb, 0x3d, 0x61, 0x4f, 0x2c, 0xb,  0xc8, 0x70, 0xb8, 0x62, 0xbd, 0xa5, 0x17, 0x4e, 0xe4, 0x2d, 0xf0,
      0xa1, 0xe9, 0xf7, 0x0,  0x0,  0x2,  0x0,  0x0,  0x15, 0x6,  0x1c, 0x0,  0x3,  0x3d, 0x93, 0x17, 0x8,  0x0,  0x1a,
      0x7e, 0xaa, 0x59, 0x64, 0x64, 0x16, 0x6f, 0x6a, 0xc6, 0x2a, 0x32, 0xbb, 0xce, 0x43, 0x20, 0x4f, 0xec, 0xb,  0xdf,
      0xfa, 0xdf, 0xde, 0xf9, 0xbf, 0xaa, 0x41, 0x2,  0x0,  0x0,  0x2f, 0xcb, 0xb,  0xa,  0x29, 0xda, 0x9,  0x0,  0xb,
      0x4b, 0x20, 0x3e, 0x7a, 0x47, 0xe2, 0x64, 0xdb, 0x1c, 0xfd, 0x20, 0x27, 0x0,  0x0,  0x4d, 0x28, 0x12, 0x0,  0x8,
      0xd0, 0xde, 0x72, 0x9c, 0x7f, 0xce, 0x58, 0x45, 0x24, 0xd3, 0x24, 0x22, 0x22, 0x3b, 0x61, 0x2a, 0x9c, 0x0,  0x16,
      0xb5, 0xe6, 0xc5, 0x58, 0x71, 0xbb, 0x43, 0x40, 0x3b, 0x50, 0xd0, 0x31, 0x18, 0xbf, 0x98, 0x77, 0x5b, 0xb9, 0x60,
      0x55, 0x49, 0x18, 0x0,  0x10, 0x97, 0x14, 0x79, 0x27, 0x50, 0x4d, 0x5e, 0xd6, 0x30, 0x3c, 0x5e, 0x6b, 0xb3, 0xb3,
      0x3a, 0x7c, 0x0,  0xa,  0x3d, 0x18, 0x74, 0x9b, 0x5f, 0x64, 0x1c, 0xc,  0x3a, 0xfc, 0x0,  0x5,  0x4a, 0xaf, 0xf,
      0xbc, 0xf0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa8, 0x73, 0x90, 0x80, 0xd1, 0x50, 0xc6, 0xc1, 0x92, 0x8c, 0xad, 0xce, 0x76, 0xc6, 0xaa,
                           0xa9, 0x6e, 0x19, 0x5c, 0x2b, 0x6a, 0x2d, 0xc6, 0x75, 0xd7, 0x90, 0x5c, 0xcc, 0xa8, 0x22};
  uint8_t bytesprops1[] = {0x3e, 0xa1, 0x15, 0xaf};
  uint8_t bytesprops2[] = {0x29};
  uint8_t bytesprops3[] = {0x91, 0x8, 0xd7, 0xfa, 0xc4, 0x26, 0x2, 0xc7, 0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15650}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6863}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9805}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13621}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29496}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5726}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13529}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4946}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20204}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14764}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22286}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x77, 0x12, 0x3d, 0xa5, 0x4d, 0xe7, 0xee, 0x15, 0xa2, 0xf0, 0xce, 0x71, 0x98, 0x8e,
                               0xe3, 0xdc, 0xa8, 0xa7, 0x2c, 0x4b, 0xde, 0x79, 0xf0, 0x77, 0xdf, 0xda, 0x60, 0xf8};
  uint8_t byteswillprops1[] = {0x7,  0x5,  0xc2, 0x7c, 0x13, 0x20, 0xe5, 0xba, 0x4c, 0x3f, 0x9b, 0xa7,
                               0x54, 0x1c, 0x56, 0xcd, 0x92, 0x24, 0xa6, 0xc3, 0x4,  0x3a, 0xc,  0x6f};
  uint8_t byteswillprops2[] = {0x3a, 0xfd, 0x24, 0x75, 0x19, 0x90, 0x33, 0x8b};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops3[] = {0x36, 0xcd, 0x7d, 0xcc, 0xeb, 0x3d, 0x61, 0x4f, 0x2c, 0xb,  0xc8, 0x70,
                               0xb8, 0x62, 0xbd, 0xa5, 0x17, 0x4e, 0xe4, 0x2d, 0xf0, 0xa1, 0xe9, 0xf7};
  uint8_t byteswillprops5[] = {0x3d, 0x93, 0x17};
  uint8_t byteswillprops6[] = {0x7e, 0xaa, 0x59, 0x64, 0x64, 0x16, 0x6f, 0x6a, 0xc6, 0x2a, 0x32, 0xbb, 0xce,
                               0x43, 0x20, 0x4f, 0xec, 0xb,  0xdf, 0xfa, 0xdf, 0xde, 0xf9, 0xbf, 0xaa, 0x41};
  uint8_t byteswillprops7[] = {0x4b, 0x20, 0x3e, 0x7a, 0x47, 0xe2, 0x64, 0xdb, 0x1c, 0xfd, 0x20};
  uint8_t byteswillprops8[] = {0xd0, 0xde, 0x72, 0x9c, 0x7f, 0xce, 0x58, 0x45};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11399}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29117}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19781}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {24, (char*)&byteswillprops3}, .v = {0, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5382}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12235}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19752}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15201}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 156}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0xe6, 0xc5, 0x58, 0x71, 0xbb, 0x43, 0x40, 0x3b, 0x50, 0xd0,
                                0x31, 0x18, 0xbf, 0x98, 0x77, 0x5b, 0xb9, 0x60, 0x55, 0x49, 0x18};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x97, 0x14, 0x79, 0x27, 0x50, 0x4d, 0x5e, 0xd6,
                                  0x30, 0x3c, 0x5e, 0x6b, 0xb3, 0xb3, 0x3a, 0x7c};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 147;
  uint8_t client_id_bytes[] = {0xfc, 0x7b, 0xce, 0x2d, 0x5d, 0xee, 0x31, 0xfd, 0x20, 0x1e, 0xf, 0x79, 0xb2};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3d, 0x18, 0x74, 0x9b, 0x5f, 0x64, 0x1c, 0xc, 0x3a, 0xfc};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4a, 0xaf, 0xf, 0xbc, 0xf0};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 6101 [(",\ENQ\132\182e\220\SYN%\233\253\238",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\RSH\179\141\155\183W\DC3\253\169v6\193;\187`c\217\218\234",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x27, 0x17, 0xd5, 0x0,  0xb,  0x2c, 0x5,  0x84, 0xb6, 0x65, 0xdc, 0x16, 0x25,
                   0xe9, 0xfd, 0xee, 0x1,  0x0,  0x14, 0x1e, 0x48, 0xb3, 0x8d, 0x9b, 0xb7, 0x57, 0x13,
                   0xfd, 0xa9, 0x76, 0x36, 0xc1, 0x3b, 0xbb, 0x60, 0x63, 0xd9, 0xda, 0xea, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x5, 0x84, 0xb6, 0x65, 0xdc, 0x16, 0x25, 0xe9, 0xfd, 0xee};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x48, 0xb3, 0x8d, 0x9b, 0xb7, 0x57, 0x13, 0xfd, 0xa9,
                                     0x76, 0x36, 0xc1, 0x3b, 0xbb, 0x60, 0x63, 0xd9, 0xda, 0xea};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 6101, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25296 [("\DC1\170f\212\242sLZ\148\SIg)\208\ACK\128U\161\186\NUL)\214\158",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x1b, 0x62, 0xd0, 0x0, 0x16, 0x11, 0xaa, 0x66, 0xd4, 0xf2, 0x73, 0x4c, 0x5a, 0x94,
                   0xf,  0x67, 0x29, 0xd0, 0x6, 0x80, 0x55, 0xa1, 0xba, 0x0,  0x29, 0xd6, 0x9e, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0xaa, 0x66, 0xd4, 0xf2, 0x73, 0x4c, 0x5a, 0x94, 0xf,  0x67,
                                     0x29, 0xd0, 0x6,  0x80, 0x55, 0xa1, 0xba, 0x0,  0x29, 0xd6, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25296, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28036 [("Pv\136\129\234\188\197$",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\132\&1/\159\185\&7",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\161\248\233\231\243\148\238\193\NAK\GSx\193",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\SYN\242\243\159\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("yS\"\212\211\222\&7\144*K\137\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x3c, 0x6d, 0x84, 0x0,  0x8,  0x50, 0x76, 0x88, 0x81, 0xea, 0xbc, 0xc5, 0x24, 0x1,  0x0,
                   0x6,  0x84, 0x31, 0x2f, 0x9f, 0xb9, 0x37, 0x1,  0x0,  0xc,  0xa1, 0xf8, 0xe9, 0xe7, 0xf3, 0x94,
                   0xee, 0xc1, 0x15, 0x1d, 0x78, 0xc1, 0x1,  0x0,  0x5,  0x16, 0xf2, 0xf3, 0x9f, 0x1e, 0x0,  0x0,
                   0xc,  0x79, 0x53, 0x22, 0xd4, 0xd3, 0xde, 0x37, 0x90, 0x2a, 0x4b, 0x89, 0xe1, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x50, 0x76, 0x88, 0x81, 0xea, 0xbc, 0xc5, 0x24};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x84, 0x31, 0x2f, 0x9f, 0xb9, 0x37};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa1, 0xf8, 0xe9, 0xe7, 0xf3, 0x94, 0xee, 0xc1, 0x15, 0x1d, 0x78, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x16, 0xf2, 0xf3, 0x9f, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x79, 0x53, 0x22, 0xd4, 0xd3, 0xde, 0x37, 0x90, 0x2a, 0x4b, 0x89, 0xe1};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28036, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8713 [("\fd\209\239\ETB\191E",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\183\248C",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("5",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ETBz+\DC4\ETB\244\SOH\203\149<\224g\247^\243\187\&3\RS<\162\178S]{{\143\226c_",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\238\DC4\212\224g.\142q`8P<\164\172\229\248",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\143Ib3\212\238\222\217k\223\\\SO\SOxm\220}s;^\162\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130\EM\NUL\129\234\143\201xg>\194\173tM\GS\148\201\167\221O\ENQ#ktu89\141",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("B\203O\166\SI\168J\185|\254\215>\177\156",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x92, 0x1,  0x22, 0x9,  0x0,  0x7,  0xc,  0x64, 0xd1, 0xef, 0x17, 0xbf, 0x45, 0x2,  0x0,  0x3,
                   0xb7, 0xf8, 0x43, 0x2,  0x0,  0x1,  0x35, 0x2,  0x0,  0x1d, 0x17, 0x7a, 0x2b, 0x14, 0x17, 0xf4, 0x1,
                   0xcb, 0x95, 0x3c, 0xe0, 0x67, 0xf7, 0x5e, 0xf3, 0xbb, 0x33, 0x1e, 0x3c, 0xa2, 0xb2, 0x53, 0x5d, 0x7b,
                   0x7b, 0x8f, 0xe2, 0x63, 0x5f, 0x1,  0x0,  0x10, 0xee, 0x14, 0xd4, 0xe0, 0x67, 0x2e, 0x8e, 0x71, 0x60,
                   0x38, 0x50, 0x3c, 0xa4, 0xac, 0xe5, 0xf8, 0x1,  0x0,  0x16, 0x8f, 0x49, 0x62, 0x33, 0xd4, 0xee, 0xde,
                   0xd9, 0x6b, 0xdf, 0x5c, 0xe,  0xe,  0x78, 0x6d, 0xdc, 0x7d, 0x73, 0x3b, 0x5e, 0xa2, 0xe2, 0x1,  0x0,
                   0x1c, 0x82, 0x19, 0x0,  0x81, 0xea, 0x8f, 0xc9, 0x78, 0x67, 0x3e, 0xc2, 0xad, 0x74, 0x4d, 0x1d, 0x94,
                   0xc9, 0xa7, 0xdd, 0x4f, 0x5,  0x23, 0x6b, 0x74, 0x75, 0x38, 0x39, 0x8d, 0x0,  0x0,  0xe,  0x42, 0xcb,
                   0x4f, 0xa6, 0xf,  0xa8, 0x4a, 0xb9, 0x7c, 0xfe, 0xd7, 0x3e, 0xb1, 0x9c, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc, 0x64, 0xd1, 0xef, 0x17, 0xbf, 0x45};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb7, 0xf8, 0x43};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x17, 0x7a, 0x2b, 0x14, 0x17, 0xf4, 0x1,  0xcb, 0x95, 0x3c,
                                     0xe0, 0x67, 0xf7, 0x5e, 0xf3, 0xbb, 0x33, 0x1e, 0x3c, 0xa2,
                                     0xb2, 0x53, 0x5d, 0x7b, 0x7b, 0x8f, 0xe2, 0x63, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xee, 0x14, 0xd4, 0xe0, 0x67, 0x2e, 0x8e, 0x71,
                                     0x60, 0x38, 0x50, 0x3c, 0xa4, 0xac, 0xe5, 0xf8};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8f, 0x49, 0x62, 0x33, 0xd4, 0xee, 0xde, 0xd9, 0x6b, 0xdf, 0x5c,
                                     0xe,  0xe,  0x78, 0x6d, 0xdc, 0x7d, 0x73, 0x3b, 0x5e, 0xa2, 0xe2};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0x19, 0x0,  0x81, 0xea, 0x8f, 0xc9, 0x78, 0x67, 0x3e,
                                     0xc2, 0xad, 0x74, 0x4d, 0x1d, 0x94, 0xc9, 0xa7, 0xdd, 0x4f,
                                     0x5,  0x23, 0x6b, 0x74, 0x75, 0x38, 0x39, 0x8d};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0xcb, 0x4f, 0xa6, 0xf, 0xa8, 0x4a, 0xb9, 0x7c, 0xfe, 0xd7, 0x3e, 0xb1, 0x9c};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8713, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22186 [("\SOs\230\200\227!\208>\aj\134P\159@\b\245\135B\251\254\225\t\197\222\144",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("3\163Q\180\141+\131\234M\208\187:\NULW\165\227R1\198\131\168\176\185z\149w",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\131\140\149\244p\253\129\DC2\DC1c#h\224qu\128\166\SICd\174\138\185",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\ESCp",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("9\209\165\252Ue\146\138\159\n%\SOW\252D\212",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x6d, 0x56, 0xaa, 0x0,  0x19, 0xe,  0x73, 0xe6, 0xc8, 0xe3, 0x21, 0xd0, 0x3e, 0x7,  0x6a,
                   0x86, 0x50, 0x9f, 0x40, 0x8,  0xf5, 0x87, 0x42, 0xfb, 0xfe, 0xe1, 0x9,  0xc5, 0xde, 0x90, 0x1,
                   0x0,  0x1a, 0x33, 0xa3, 0x51, 0xb4, 0x8d, 0x2b, 0x83, 0xea, 0x4d, 0xd0, 0xbb, 0x3a, 0x0,  0x57,
                   0xa5, 0xe3, 0x52, 0x31, 0xc6, 0x83, 0xa8, 0xb0, 0xb9, 0x7a, 0x95, 0x77, 0x2,  0x0,  0x17, 0x83,
                   0x8c, 0x95, 0xf4, 0x70, 0xfd, 0x81, 0x12, 0x11, 0x63, 0x23, 0x68, 0xe0, 0x71, 0x75, 0x80, 0xa6,
                   0xf,  0x43, 0x64, 0xae, 0x8a, 0xb9, 0x2,  0x0,  0x2,  0x1b, 0x70, 0x1,  0x0,  0x10, 0x39, 0xd1,
                   0xa5, 0xfc, 0x55, 0x65, 0x92, 0x8a, 0x9f, 0xa,  0x25, 0xe,  0x57, 0xfc, 0x44, 0xd4, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xe,  0x73, 0xe6, 0xc8, 0xe3, 0x21, 0xd0, 0x3e, 0x7, 0x6a, 0x86, 0x50, 0x9f,
                                     0x40, 0x8,  0xf5, 0x87, 0x42, 0xfb, 0xfe, 0xe1, 0x9, 0xc5, 0xde, 0x90};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x33, 0xa3, 0x51, 0xb4, 0x8d, 0x2b, 0x83, 0xea, 0x4d, 0xd0, 0xbb, 0x3a, 0x0,
                                     0x57, 0xa5, 0xe3, 0x52, 0x31, 0xc6, 0x83, 0xa8, 0xb0, 0xb9, 0x7a, 0x95, 0x77};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x83, 0x8c, 0x95, 0xf4, 0x70, 0xfd, 0x81, 0x12, 0x11, 0x63, 0x23, 0x68,
                                     0xe0, 0x71, 0x75, 0x80, 0xa6, 0xf,  0x43, 0x64, 0xae, 0x8a, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1b, 0x70};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x39, 0xd1, 0xa5, 0xfc, 0x55, 0x65, 0x92, 0x8a,
                                     0x9f, 0xa,  0x25, 0xe,  0x57, 0xfc, 0x44, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22186, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16934 [("\ENQ\US\231\182\242\224Rp\134\v\227Heh\CAN\168\243\231\181k7&{\n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("W\201\226%\229\246\253\183\\\FS\242-\246I\DC4\DLE\188y\234\&5\240\DC1\189u\152\SO\240_",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\196\155\175",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("s\255c&\US\DLE@u",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("I4\236\129I\\c\187\205\211J",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("6\246\129_\248\224\199\160MK\168\141hr\171",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\251\&0:\197\176N\128\&0\194\204\246\NAK\236i}|\154\223c\f\220",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("Or\209\133\140\155\171\243\164J\229\235\242\246\132k}\ENQ\138\188\215\185\150%xv)P\ACK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\247\243Q\241\192)\133%\156\243\251\169\\\239\187E\234\163\194\141\&2\246*v\192\175\ETX\201",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xc8, 0x1,  0x42, 0x26, 0x0,  0x18, 0x5,  0x1f, 0xe7, 0xb6, 0xf2, 0xe0, 0x52, 0x70, 0x86, 0xb,
                   0xe3, 0x48, 0x65, 0x68, 0x18, 0xa8, 0xf3, 0xe7, 0xb5, 0x6b, 0x37, 0x26, 0x7b, 0xa,  0x0,  0x0,  0x1c,
                   0x57, 0xc9, 0xe2, 0x25, 0xe5, 0xf6, 0xfd, 0xb7, 0x5c, 0x1c, 0xf2, 0x2d, 0xf6, 0x49, 0x14, 0x10, 0xbc,
                   0x79, 0xea, 0x35, 0xf0, 0x11, 0xbd, 0x75, 0x98, 0xe,  0xf0, 0x5f, 0x1,  0x0,  0x3,  0xc4, 0x9b, 0xaf,
                   0x2,  0x0,  0x0,  0x2,  0x0,  0x8,  0x73, 0xff, 0x63, 0x26, 0x1f, 0x10, 0x40, 0x75, 0x0,  0x0,  0xb,
                   0x49, 0x34, 0xec, 0x81, 0x49, 0x5c, 0x63, 0xbb, 0xcd, 0xd3, 0x4a, 0x1,  0x0,  0xf,  0x36, 0xf6, 0x81,
                   0x5f, 0xf8, 0xe0, 0xc7, 0xa0, 0x4d, 0x4b, 0xa8, 0x8d, 0x68, 0x72, 0xab, 0x0,  0x0,  0x15, 0xfb, 0x30,
                   0x3a, 0xc5, 0xb0, 0x4e, 0x80, 0x30, 0xc2, 0xcc, 0xf6, 0x15, 0xec, 0x69, 0x7d, 0x7c, 0x9a, 0xdf, 0x63,
                   0xc,  0xdc, 0x0,  0x0,  0x1d, 0x4f, 0x72, 0xd1, 0x85, 0x8c, 0x9b, 0xab, 0xf3, 0xa4, 0x4a, 0xe5, 0xeb,
                   0xf2, 0xf6, 0x84, 0x6b, 0x7d, 0x5,  0x8a, 0xbc, 0xd7, 0xb9, 0x96, 0x25, 0x78, 0x76, 0x29, 0x50, 0x6,
                   0x0,  0x0,  0x1d, 0xa9, 0xf7, 0xf3, 0x51, 0xf1, 0xc0, 0x29, 0x85, 0x25, 0x9c, 0xf3, 0xfb, 0xa9, 0x5c,
                   0xef, 0xbb, 0x45, 0xea, 0xa3, 0xc2, 0x8d, 0x32, 0xf6, 0x2a, 0x76, 0xc0, 0xaf, 0x3,  0xc9, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5,  0x1f, 0xe7, 0xb6, 0xf2, 0xe0, 0x52, 0x70, 0x86, 0xb,  0xe3, 0x48,
                                     0x65, 0x68, 0x18, 0xa8, 0xf3, 0xe7, 0xb5, 0x6b, 0x37, 0x26, 0x7b, 0xa};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x57, 0xc9, 0xe2, 0x25, 0xe5, 0xf6, 0xfd, 0xb7, 0x5c, 0x1c,
                                     0xf2, 0x2d, 0xf6, 0x49, 0x14, 0x10, 0xbc, 0x79, 0xea, 0x35,
                                     0xf0, 0x11, 0xbd, 0x75, 0x98, 0xe,  0xf0, 0x5f};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x9b, 0xaf};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x73, 0xff, 0x63, 0x26, 0x1f, 0x10, 0x40, 0x75};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x49, 0x34, 0xec, 0x81, 0x49, 0x5c, 0x63, 0xbb, 0xcd, 0xd3, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x36, 0xf6, 0x81, 0x5f, 0xf8, 0xe0, 0xc7, 0xa0,
                                     0x4d, 0x4b, 0xa8, 0x8d, 0x68, 0x72, 0xab};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfb, 0x30, 0x3a, 0xc5, 0xb0, 0x4e, 0x80, 0x30, 0xc2, 0xcc, 0xf6,
                                     0x15, 0xec, 0x69, 0x7d, 0x7c, 0x9a, 0xdf, 0x63, 0xc,  0xdc};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4f, 0x72, 0xd1, 0x85, 0x8c, 0x9b, 0xab, 0xf3, 0xa4, 0x4a,
                                     0xe5, 0xeb, 0xf2, 0xf6, 0x84, 0x6b, 0x7d, 0x5,  0x8a, 0xbc,
                                     0xd7, 0xb9, 0x96, 0x25, 0x78, 0x76, 0x29, 0x50, 0x6};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa9, 0xf7, 0xf3, 0x51, 0xf1, 0xc0, 0x29, 0x85, 0x25, 0x9c,
                                     0xf3, 0xfb, 0xa9, 0x5c, 0xef, 0xbb, 0x45, 0xea, 0xa3, 0xc2,
                                     0x8d, 0x32, 0xf6, 0x2a, 0x76, 0xc0, 0xaf, 0x3,  0xc9};
  lwmqtt_string_t topic_filter_s9 = {29, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16934, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19450 [("-\157He_V\165gmY\135\DC1\242\b\132\141\234\205\247",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("X+\208\242
// 0\199d9\203\NAK)\182AKX:\187*\247|\177\229",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("-\200\196\v\SON\152\156\131\233\ESC\181(\174\ESC_\182(",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\245",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\"\DLE\152\151\134\RS\b7\133\240",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\155\200\218O\139Q\137\183r>\FSZ()\163@C\240\153\197\175\164w\237\244\214",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(":%\214!\232hqh\239\137?\SYN\253\231\130\239Ki",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\211\242#\201}dL\240\189\150\251\185\231~?\227\158\152z\251\SUB\DELS\174E",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("%\GS>\174RN3\188KZ\169\ETB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xb5, 0x1,  0x4b, 0xfa, 0x0,  0x13, 0x2d, 0x9d, 0x48, 0x65, 0x5f, 0x56, 0xa5, 0x67, 0x6d, 0x59,
                   0x87, 0x11, 0xf2, 0x8,  0x84, 0x8d, 0xea, 0xcd, 0xf7, 0x0,  0x0,  0x17, 0x58, 0x2b, 0xd0, 0xf2, 0x20,
                   0x30, 0xc7, 0x64, 0x39, 0xcb, 0x15, 0x29, 0xb6, 0x41, 0x4b, 0x58, 0x3a, 0xbb, 0x2a, 0xf7, 0x7c, 0xb1,
                   0xe5, 0x2,  0x0,  0x12, 0x2d, 0xc8, 0xc4, 0xb,  0xe,  0x4e, 0x98, 0x9c, 0x83, 0xe9, 0x1b, 0xb5, 0x28,
                   0xae, 0x1b, 0x5f, 0xb6, 0x28, 0x1,  0x0,  0x1,  0xf5, 0x1,  0x0,  0xa,  0x22, 0x10, 0x98, 0x97, 0x86,
                   0x1e, 0x8,  0x37, 0x85, 0xf0, 0x0,  0x0,  0x1a, 0x9b, 0xc8, 0xda, 0x4f, 0x8b, 0x51, 0x89, 0xb7, 0x72,
                   0x3e, 0x1c, 0x5a, 0x28, 0x29, 0xa3, 0x40, 0x43, 0xf0, 0x99, 0xc5, 0xaf, 0xa4, 0x77, 0xed, 0xf4, 0xd6,
                   0x2,  0x0,  0x12, 0x3a, 0x25, 0xd6, 0x21, 0xe8, 0x68, 0x71, 0x68, 0xef, 0x89, 0x3f, 0x16, 0xfd, 0xe7,
                   0x82, 0xef, 0x4b, 0x69, 0x1,  0x0,  0x19, 0xd3, 0xf2, 0x23, 0xc9, 0x7d, 0x64, 0x4c, 0xf0, 0xbd, 0x96,
                   0xfb, 0xb9, 0xe7, 0x7e, 0x3f, 0xe3, 0x9e, 0x98, 0x7a, 0xfb, 0x1a, 0x7f, 0x53, 0xae, 0x45, 0x1,  0x0,
                   0xc,  0x25, 0x1d, 0x3e, 0xae, 0x52, 0x4e, 0x33, 0xbc, 0x4b, 0x5a, 0xa9, 0x17, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x2d, 0x9d, 0x48, 0x65, 0x5f, 0x56, 0xa5, 0x67, 0x6d, 0x59,
                                     0x87, 0x11, 0xf2, 0x8,  0x84, 0x8d, 0xea, 0xcd, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x58, 0x2b, 0xd0, 0xf2, 0x20, 0x30, 0xc7, 0x64, 0x39, 0xcb, 0x15, 0x29,
                                     0xb6, 0x41, 0x4b, 0x58, 0x3a, 0xbb, 0x2a, 0xf7, 0x7c, 0xb1, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0xc8, 0xc4, 0xb,  0xe,  0x4e, 0x98, 0x9c, 0x83,
                                     0xe9, 0x1b, 0xb5, 0x28, 0xae, 0x1b, 0x5f, 0xb6, 0x28};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf5};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x22, 0x10, 0x98, 0x97, 0x86, 0x1e, 0x8, 0x37, 0x85, 0xf0};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9b, 0xc8, 0xda, 0x4f, 0x8b, 0x51, 0x89, 0xb7, 0x72, 0x3e, 0x1c, 0x5a, 0x28,
                                     0x29, 0xa3, 0x40, 0x43, 0xf0, 0x99, 0xc5, 0xaf, 0xa4, 0x77, 0xed, 0xf4, 0xd6};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3a, 0x25, 0xd6, 0x21, 0xe8, 0x68, 0x71, 0x68, 0xef,
                                     0x89, 0x3f, 0x16, 0xfd, 0xe7, 0x82, 0xef, 0x4b, 0x69};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd3, 0xf2, 0x23, 0xc9, 0x7d, 0x64, 0x4c, 0xf0, 0xbd, 0x96, 0xfb, 0xb9, 0xe7,
                                     0x7e, 0x3f, 0xe3, 0x9e, 0x98, 0x7a, 0xfb, 0x1a, 0x7f, 0x53, 0xae, 0x45};
  lwmqtt_string_t topic_filter_s7 = {25, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x25, 0x1d, 0x3e, 0xae, 0x52, 0x4e, 0x33, 0xbc, 0x4b, 0x5a, 0xa9, 0x17};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19450, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18336 [("M\159.\194\192\a\198\148]\234\233",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\189\222HE\204\236\228\133\ACK*\236X\128\&0\229;n\245ORb\196",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("!\228\203\199\141\147\FS\178d6\b\237y\140c\213\DEL\141D \168\b\t\231C\"\STX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\208N\231\188\204\CANY\CAN+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("1\138\249\166\182\244n<\189\SI\a\192\&8W~\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("Nt",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\182",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\NUL\n1\166lT'\255\146\189^\227\207\&3W\174*\171\194",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("O",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("^\230>\180\243\221\ENQ\146K\SYN\153i:\167\222\r",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x47, 0xa0, 0x0,  0xb,  0x4d, 0x9f, 0x2e, 0xc2, 0xc0, 0x7,  0xc6, 0x94, 0x5d, 0xea,
                   0xe9, 0x0,  0x0,  0x16, 0xbd, 0xde, 0x48, 0x45, 0xcc, 0xec, 0xe4, 0x85, 0x6,  0x2a, 0xec, 0x58, 0x80,
                   0x30, 0xe5, 0x3b, 0x6e, 0xf5, 0x4f, 0x52, 0x62, 0xc4, 0x0,  0x0,  0x1b, 0x21, 0xe4, 0xcb, 0xc7, 0x8d,
                   0x93, 0x1c, 0xb2, 0x64, 0x36, 0x8,  0xed, 0x79, 0x8c, 0x63, 0xd5, 0x7f, 0x8d, 0x44, 0x20, 0xa8, 0x8,
                   0x9,  0xe7, 0x43, 0x22, 0x2,  0x0,  0x0,  0x9,  0xd0, 0x4e, 0xe7, 0xbc, 0xcc, 0x18, 0x59, 0x18, 0x2b,
                   0x1,  0x0,  0x10, 0x31, 0x8a, 0xf9, 0xa6, 0xb6, 0xf4, 0x6e, 0x3c, 0xbd, 0xf,  0x7,  0xc0, 0x38, 0x57,
                   0x7e, 0xf,  0x0,  0x0,  0x2,  0x4e, 0x74, 0x0,  0x0,  0x1,  0xb6, 0x0,  0x0,  0x14, 0x31, 0x0,  0xa,
                   0x31, 0xa6, 0x6c, 0x54, 0x27, 0xff, 0x92, 0xbd, 0x5e, 0xe3, 0xcf, 0x33, 0x57, 0xae, 0x2a, 0xab, 0xc2,
                   0x1,  0x0,  0x1,  0x4f, 0x0,  0x0,  0x0,  0x2,  0x0,  0x10, 0x5e, 0xe6, 0x3e, 0xb4, 0xf3, 0xdd, 0x5,
                   0x92, 0x4b, 0x16, 0x99, 0x69, 0x3a, 0xa7, 0xde, 0xd,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x4d, 0x9f, 0x2e, 0xc2, 0xc0, 0x7, 0xc6, 0x94, 0x5d, 0xea, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xde, 0x48, 0x45, 0xcc, 0xec, 0xe4, 0x85, 0x6,  0x2a, 0xec,
                                     0x58, 0x80, 0x30, 0xe5, 0x3b, 0x6e, 0xf5, 0x4f, 0x52, 0x62, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x21, 0xe4, 0xcb, 0xc7, 0x8d, 0x93, 0x1c, 0xb2, 0x64, 0x36, 0x8,  0xed, 0x79, 0x8c,
                                     0x63, 0xd5, 0x7f, 0x8d, 0x44, 0x20, 0xa8, 0x8,  0x9,  0xe7, 0x43, 0x22, 0x2};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd0, 0x4e, 0xe7, 0xbc, 0xcc, 0x18, 0x59, 0x18, 0x2b};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x8a, 0xf9, 0xa6, 0xb6, 0xf4, 0x6e, 0x3c,
                                     0xbd, 0xf,  0x7,  0xc0, 0x38, 0x57, 0x7e, 0xf};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0x74};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb6};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x31, 0x0,  0xa,  0x31, 0xa6, 0x6c, 0x54, 0x27, 0xff, 0x92,
                                     0xbd, 0x5e, 0xe3, 0xcf, 0x33, 0x57, 0xae, 0x2a, 0xab, 0xc2};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4f};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5e, 0xe6, 0x3e, 0xb4, 0xf3, 0xdd, 0x5,  0x92,
                                      0x4b, 0x16, 0x99, 0x69, 0x3a, 0xa7, 0xde, 0xd};
  lwmqtt_string_t topic_filter_s10 = {16, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18336, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3357 [("\203$[\200\&9\130F\142\249\232\189\167\148L",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("<\n\188
// \193>c\237\242\202\GSX\216\222e\204\149;\226",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("(.\204\183\ESC\178*",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("fld~\ACK9Z//1\205\SUB~\211l\241D\196`T",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("<\215\129\217-\248\223\vA\CAN$\203\213IH\227)\200\233[\174/\236\234\235\206\245\154\236\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x6b, 0xd,  0x1d, 0x0,  0xe,  0xcb, 0x24, 0x5b, 0xc8, 0x39, 0x82, 0x46, 0x8e, 0xf9, 0xe8,
                   0xbd, 0xa7, 0x94, 0x4c, 0x1,  0x0,  0x13, 0x3c, 0xa,  0xbc, 0x20, 0xc1, 0x3e, 0x63, 0xed, 0xf2,
                   0xca, 0x1d, 0x58, 0xd8, 0xde, 0x65, 0xcc, 0x95, 0x3b, 0xe2, 0x2,  0x0,  0x7,  0x28, 0x2e, 0xcc,
                   0xb7, 0x1b, 0xb2, 0x2a, 0x2,  0x0,  0x14, 0x66, 0x6c, 0x64, 0x7e, 0x6,  0x39, 0x5a, 0x2f, 0x2f,
                   0x31, 0xcd, 0x1a, 0x7e, 0xd3, 0x6c, 0xf1, 0x44, 0xc4, 0x60, 0x54, 0x0,  0x0,  0x1e, 0x3c, 0xd7,
                   0x81, 0xd9, 0x2d, 0xf8, 0xdf, 0xb,  0x41, 0x18, 0x24, 0xcb, 0xd5, 0x49, 0x48, 0xe3, 0x29, 0xc8,
                   0xe9, 0x5b, 0xae, 0x2f, 0xec, 0xea, 0xeb, 0xce, 0xf5, 0x9a, 0xec, 0xfd, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xcb, 0x24, 0x5b, 0xc8, 0x39, 0x82, 0x46,
                                     0x8e, 0xf9, 0xe8, 0xbd, 0xa7, 0x94, 0x4c};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3c, 0xa,  0xbc, 0x20, 0xc1, 0x3e, 0x63, 0xed, 0xf2, 0xca,
                                     0x1d, 0x58, 0xd8, 0xde, 0x65, 0xcc, 0x95, 0x3b, 0xe2};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x28, 0x2e, 0xcc, 0xb7, 0x1b, 0xb2, 0x2a};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x66, 0x6c, 0x64, 0x7e, 0x6,  0x39, 0x5a, 0x2f, 0x2f, 0x31,
                                     0xcd, 0x1a, 0x7e, 0xd3, 0x6c, 0xf1, 0x44, 0xc4, 0x60, 0x54};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3c, 0xd7, 0x81, 0xd9, 0x2d, 0xf8, 0xdf, 0xb,  0x41, 0x18,
                                     0x24, 0xcb, 0xd5, 0x49, 0x48, 0xe3, 0x29, 0xc8, 0xe9, 0x5b,
                                     0xae, 0x2f, 0xec, 0xea, 0xeb, 0xce, 0xf5, 0x9a, 0xec, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3357, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18395 [("v2\217\195\171\136\254\128:i",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\249i9\228\SII\156\192\&7/.\187\203%",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\245\205\t;\164#p\ESC\CAN\168,\134\NUL{\RS\164\CAN^\223\149",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x3b, 0x47, 0xdb, 0x0,  0xa,  0x76, 0x32, 0xd9, 0xc3, 0xab, 0x88, 0xfe, 0x80, 0x3a, 0x69,
                   0x1,  0x0,  0xe,  0xf9, 0x69, 0x39, 0xe4, 0xf,  0x49, 0x9c, 0xc0, 0x37, 0x2f, 0x2e, 0xbb, 0xcb,
                   0x25, 0x2,  0x0,  0x14, 0xf5, 0xcd, 0x9,  0x3b, 0xa4, 0x23, 0x70, 0x1b, 0x18, 0xa8, 0x2c, 0x86,
                   0x0,  0x7b, 0x1e, 0xa4, 0x18, 0x5e, 0xdf, 0x95, 0x0,  0x0,  0x1,  0x1a, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0x32, 0xd9, 0xc3, 0xab, 0x88, 0xfe, 0x80, 0x3a, 0x69};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf9, 0x69, 0x39, 0xe4, 0xf, 0x49, 0x9c, 0xc0, 0x37, 0x2f, 0x2e, 0xbb, 0xcb, 0x25};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf5, 0xcd, 0x9, 0x3b, 0xa4, 0x23, 0x70, 0x1b, 0x18, 0xa8,
                                     0x2c, 0x86, 0x0, 0x7b, 0x1e, 0xa4, 0x18, 0x5e, 0xdf, 0x95};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1a};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18395, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 6101 [(",\ENQ\132\182e\220\SYN%\233\253\238",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\RSH\179\141\155\183W\DC3\253\169v6\193;\187`c\217\218\234",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropMessageExpiryInterval 19065,PropTopicAlias
// 12758,PropMaximumQoS 101,PropWillDelayInterval 331,PropWillDelayInterval 6082]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x3c, 0x17, 0xd5, 0x14, 0x2,  0x0,  0x0,  0x4a, 0x79, 0x23, 0x31, 0xd6, 0x24, 0x65, 0x18,
                   0x0,  0x0,  0x1,  0x4b, 0x18, 0x0,  0x0,  0x17, 0xc2, 0x0,  0xb,  0x2c, 0x5,  0x84, 0xb6, 0x65,
                   0xdc, 0x16, 0x25, 0xe9, 0xfd, 0xee, 0x1,  0x0,  0x14, 0x1e, 0x48, 0xb3, 0x8d, 0x9b, 0xb7, 0x57,
                   0x13, 0xfd, 0xa9, 0x76, 0x36, 0xc1, 0x3b, 0xbb, 0x60, 0x63, 0xd9, 0xda, 0xea, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x5, 0x84, 0xb6, 0x65, 0xdc, 0x16, 0x25, 0xe9, 0xfd, 0xee};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x48, 0xb3, 0x8d, 0x9b, 0xb7, 0x57, 0x13, 0xfd, 0xa9,
                                     0x76, 0x36, 0xc1, 0x3b, 0xbb, 0x60, 0x63, 0xd9, 0xda, 0xea};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19065}}, {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12758}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 101}},   {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 331}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6082}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 6101, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25296 [("\DC1\170f\212\242sLZ\148\SIg)\208\ACK\128U\161\186\NUL)\214\158",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropMaximumPacketSize 28140,PropSharedSubscriptionAvailable 62,PropAuthenticationMethod
// "\234\191Q\135\223\255\&4\216^",PropMessageExpiryInterval 588,PropResponseTopic
// "U\ETX\ACK\231\140\239\243\SYN\253\134\RS\136j",PropReceiveMaximum 21402,PropSubscriptionIdentifier
// 8,PropSharedSubscriptionAvailable 83,PropMaximumPacketSize 23375,PropTopicAliasMaximum
// 28613,PropRequestProblemInformation 212,PropTopicAlias 6168,PropAuthenticationMethod
// "#\147\231\SYNFp\218\170h\EM\137\192\241\176V\148N\255z\DC2)",PropWildcardSubscriptionAvailable
// 114,PropServerReference "",PropContentType "\139\237\217J\ne\152C\254\170\236\141\174\&1@\147\&8",PropMaximumQoS
// 64,PropMessageExpiryInterval 3635,PropMessageExpiryInterval 29474,PropRequestProblemInformation
// 130,PropSubscriptionIdentifier 18,PropMessageExpiryInterval 7025,PropTopicAlias 17854,PropMaximumPacketSize
// 13771,PropWildcardSubscriptionAvailable 166,PropWildcardSubscriptionAvailable 26,PropSubscriptionIdentifierAvailable
// 63,PropCorrelationData "\214\238\129dj\201_\a1\172\157\157\141'\201h\171\147!\162\&8\EM",PropSubscriptionIdentifier
// 0]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0xc8, 0x1,  0x62, 0xd0, 0xab, 0x1,  0x27, 0x0,  0x0,  0x6d, 0xec, 0x2a, 0x3e, 0x15, 0x0,  0x9,
                   0xea, 0xbf, 0x51, 0x87, 0xdf, 0xff, 0x34, 0xd8, 0x5e, 0x2,  0x0,  0x0,  0x2,  0x4c, 0x8,  0x0,  0xd,
                   0x55, 0x3,  0x6,  0xe7, 0x8c, 0xef, 0xf3, 0x16, 0xfd, 0x86, 0x1e, 0x88, 0x6a, 0x21, 0x53, 0x9a, 0xb,
                   0x8,  0x2a, 0x53, 0x27, 0x0,  0x0,  0x5b, 0x4f, 0x22, 0x6f, 0xc5, 0x17, 0xd4, 0x23, 0x18, 0x18, 0x15,
                   0x0,  0x15, 0x23, 0x93, 0xe7, 0x16, 0x46, 0x70, 0xda, 0xaa, 0x68, 0x19, 0x89, 0xc0, 0xf1, 0xb0, 0x56,
                   0x94, 0x4e, 0xff, 0x7a, 0x12, 0x29, 0x28, 0x72, 0x1c, 0x0,  0x0,  0x3,  0x0,  0x11, 0x8b, 0xed, 0xd9,
                   0x4a, 0xa,  0x65, 0x98, 0x43, 0xfe, 0xaa, 0xec, 0x8d, 0xae, 0x31, 0x40, 0x93, 0x38, 0x24, 0x40, 0x2,
                   0x0,  0x0,  0xe,  0x33, 0x2,  0x0,  0x0,  0x73, 0x22, 0x17, 0x82, 0xb,  0x12, 0x2,  0x0,  0x0,  0x1b,
                   0x71, 0x23, 0x45, 0xbe, 0x27, 0x0,  0x0,  0x35, 0xcb, 0x28, 0xa6, 0x28, 0x1a, 0x29, 0x3f, 0x9,  0x0,
                   0x16, 0xd6, 0xee, 0x81, 0x64, 0x6a, 0xc9, 0x5f, 0x7,  0x31, 0xac, 0x9d, 0x9d, 0x8d, 0x27, 0xc9, 0x68,
                   0xab, 0x93, 0x21, 0xa2, 0x38, 0x19, 0xb,  0x0,  0x0,  0x16, 0x11, 0xaa, 0x66, 0xd4, 0xf2, 0x73, 0x4c,
                   0x5a, 0x94, 0xf,  0x67, 0x29, 0xd0, 0x6,  0x80, 0x55, 0xa1, 0xba, 0x0,  0x29, 0xd6, 0x9e, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0xaa, 0x66, 0xd4, 0xf2, 0x73, 0x4c, 0x5a, 0x94, 0xf,  0x67,
                                     0x29, 0xd0, 0x6,  0x80, 0x55, 0xa1, 0xba, 0x0,  0x29, 0xd6, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0xea, 0xbf, 0x51, 0x87, 0xdf, 0xff, 0x34, 0xd8, 0x5e};
  uint8_t bytesprops1[] = {0x55, 0x3, 0x6, 0xe7, 0x8c, 0xef, 0xf3, 0x16, 0xfd, 0x86, 0x1e, 0x88, 0x6a};
  uint8_t bytesprops2[] = {0x23, 0x93, 0xe7, 0x16, 0x46, 0x70, 0xda, 0xaa, 0x68, 0x19, 0x89,
                           0xc0, 0xf1, 0xb0, 0x56, 0x94, 0x4e, 0xff, 0x7a, 0x12, 0x29};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x8b, 0xed, 0xd9, 0x4a, 0xa,  0x65, 0x98, 0x43, 0xfe,
                           0xaa, 0xec, 0x8d, 0xae, 0x31, 0x40, 0x93, 0x38};
  uint8_t bytesprops5[] = {0xd6, 0xee, 0x81, 0x64, 0x6a, 0xc9, 0x5f, 0x7,  0x31, 0xac, 0x9d,
                           0x9d, 0x8d, 0x27, 0xc9, 0x68, 0xab, 0x93, 0x21, 0xa2, 0x38, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28140}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 588}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21402}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23375}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28613}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6168}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3635}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29474}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7025}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17854}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13771}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25296, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28036 [("Pv\136\129\234\188\197$",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\132\&1/\159\185\&7",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\161\248\233\231\243\148\238\193\NAK\GSx\193",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\SYN\242\243\159\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("yS\"\212\211\222\&7\144*K\137\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] [PropCorrelationData " Ga\182
// 7\156\&9\204\155\202d\148\&4\212a\206\255|\150\178\176\208b",PropAuthenticationData
// "\137\223P\139\214f\177\194\174\189\187\173\ETB",PropRequestResponseInformation 187,PropContentType
// "\144\192\&7b3\148\218\b\163!\235\130V\214\133f}S\GS\"\224\136\165\245\ESC;\147",PropServerReference
// "",PropAuthenticationData "~\EOT,\220D\184M\236\240\GS\231\213\202\&4a",PropSharedSubscriptionAvailable
// 178,PropReasonString "\255\201k \150\DC4\140\246k#^\157w\219\130\169\186\137",PropRetainAvailable 80,PropTopicAlias
// 4645,PropContentType "\212@\230+j\173ke",PropAuthenticationMethod
// "\248J\CAN\148\&0\180\208\181'\224,",PropMessageExpiryInterval 26316,PropPayloadFormatIndicator
// 218,PropRequestProblemInformation 99,PropMaximumPacketSize 5815,PropWildcardSubscriptionAvailable
// 167,PropAuthenticationMethod "\RSc\229\154",PropResponseInformation "b \147",PropPayloadFormatIndicator
// 236,PropAssignedClientIdentifier "*\233\189\219\157R",PropCorrelationData
// "\201;\128\&2:\162\r\SYNI\229\240\167\212i>B\155\&41\222\234\158EJX\187\188\236k\176",PropAuthenticationMethod
// "\173\145\DC3\NUL\RS\NAKn$\164]",PropTopicAliasMaximum 18831,PropReceiveMaximum 20663,PropServerReference
// "3w\150\205\244\251]\161\142\230\DC3\205\132\178\129\193uQ}^\199C[\"9\128\137v",PropReasonString
// "7C\227\DLE^;\211\r\245~\217ou\217\224vk",PropCorrelationData
// "h\211&C1\197IM\DC1N\187\240\135_\204\219\202\157\244\EM\138\176B\224B\150",PropAuthenticationData
// "\213\&6\250\ENQ\t\139\235\189\168K\178\222\205\144$\213\ENQ\169\206\185\188",PropWillDelayInterval 26355]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x82, 0x9c, 0x3,  0x6d, 0x84, 0xde, 0x2,  0x9,  0x0,  0x18, 0x20, 0x47, 0x61, 0xb6, 0x20, 0x37, 0x9c, 0x39, 0xcc,
      0x9b, 0xca, 0x64, 0x94, 0x34, 0xd4, 0x61, 0xce, 0xff, 0x7c, 0x96, 0xb2, 0xb0, 0xd0, 0x62, 0x16, 0x0,  0xd,  0x89,
      0xdf, 0x50, 0x8b, 0xd6, 0x66, 0xb1, 0xc2, 0xae, 0xbd, 0xbb, 0xad, 0x17, 0x19, 0xbb, 0x3,  0x0,  0x1b, 0x90, 0xc0,
      0x37, 0x62, 0x33, 0x94, 0xda, 0x8,  0xa3, 0x21, 0xeb, 0x82, 0x56, 0xd6, 0x85, 0x66, 0x7d, 0x53, 0x1d, 0x22, 0xe0,
      0x88, 0xa5, 0xf5, 0x1b, 0x3b, 0x93, 0x1c, 0x0,  0x0,  0x16, 0x0,  0xf,  0x7e, 0x4,  0x2c, 0xdc, 0x44, 0xb8, 0x4d,
      0xec, 0xf0, 0x1d, 0xe7, 0xd5, 0xca, 0x34, 0x61, 0x2a, 0xb2, 0x1f, 0x0,  0x12, 0xff, 0xc9, 0x6b, 0x20, 0x96, 0x14,
      0x8c, 0xf6, 0x6b, 0x23, 0x5e, 0x9d, 0x77, 0xdb, 0x82, 0xa9, 0xba, 0x89, 0x25, 0x50, 0x23, 0x12, 0x25, 0x3,  0x0,
      0x8,  0xd4, 0x40, 0xe6, 0x2b, 0x6a, 0xad, 0x6b, 0x65, 0x15, 0x0,  0xb,  0xf8, 0x4a, 0x18, 0x94, 0x30, 0xb4, 0xd0,
      0xb5, 0x27, 0xe0, 0x2c, 0x2,  0x0,  0x0,  0x66, 0xcc, 0x1,  0xda, 0x17, 0x63, 0x27, 0x0,  0x0,  0x16, 0xb7, 0x28,
      0xa7, 0x15, 0x0,  0x4,  0x1e, 0x63, 0xe5, 0x9a, 0x1a, 0x0,  0x3,  0x62, 0x20, 0x93, 0x1,  0xec, 0x12, 0x0,  0x6,
      0x2a, 0xe9, 0xbd, 0xdb, 0x9d, 0x52, 0x9,  0x0,  0x1e, 0xc9, 0x3b, 0x80, 0x32, 0x3a, 0xa2, 0xd,  0x16, 0x49, 0xe5,
      0xf0, 0xa7, 0xd4, 0x69, 0x3e, 0x42, 0x9b, 0x34, 0x31, 0xde, 0xea, 0x9e, 0x45, 0x4a, 0x58, 0xbb, 0xbc, 0xec, 0x6b,
      0xb0, 0x15, 0x0,  0xa,  0xad, 0x91, 0x13, 0x0,  0x1e, 0x15, 0x6e, 0x24, 0xa4, 0x5d, 0x22, 0x49, 0x8f, 0x21, 0x50,
      0xb7, 0x1c, 0x0,  0x1c, 0x33, 0x77, 0x96, 0xcd, 0xf4, 0xfb, 0x5d, 0xa1, 0x8e, 0xe6, 0x13, 0xcd, 0x84, 0xb2, 0x81,
      0xc1, 0x75, 0x51, 0x7d, 0x5e, 0xc7, 0x43, 0x5b, 0x22, 0x39, 0x80, 0x89, 0x76, 0x1f, 0x0,  0x11, 0x37, 0x43, 0xe3,
      0x10, 0x5e, 0x3b, 0xd3, 0xd,  0xf5, 0x7e, 0xd9, 0x6f, 0x75, 0xd9, 0xe0, 0x76, 0x6b, 0x9,  0x0,  0x1a, 0x68, 0xd3,
      0x26, 0x43, 0x31, 0xc5, 0x49, 0x4d, 0x11, 0x4e, 0xbb, 0xf0, 0x87, 0x5f, 0xcc, 0xdb, 0xca, 0x9d, 0xf4, 0x19, 0x8a,
      0xb0, 0x42, 0xe0, 0x42, 0x96, 0x16, 0x0,  0x15, 0xd5, 0x36, 0xfa, 0x5,  0x9,  0x8b, 0xeb, 0xbd, 0xa8, 0x4b, 0xb2,
      0xde, 0xcd, 0x90, 0x24, 0xd5, 0x5,  0xa9, 0xce, 0xb9, 0xbc, 0x18, 0x0,  0x0,  0x66, 0xf3, 0x0,  0x8,  0x50, 0x76,
      0x88, 0x81, 0xea, 0xbc, 0xc5, 0x24, 0x1,  0x0,  0x6,  0x84, 0x31, 0x2f, 0x9f, 0xb9, 0x37, 0x1,  0x0,  0xc,  0xa1,
      0xf8, 0xe9, 0xe7, 0xf3, 0x94, 0xee, 0xc1, 0x15, 0x1d, 0x78, 0xc1, 0x1,  0x0,  0x5,  0x16, 0xf2, 0xf3, 0x9f, 0x1e,
      0x0,  0x0,  0xc,  0x79, 0x53, 0x22, 0xd4, 0xd3, 0xde, 0x37, 0x90, 0x2a, 0x4b, 0x89, 0xe1, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x50, 0x76, 0x88, 0x81, 0xea, 0xbc, 0xc5, 0x24};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x84, 0x31, 0x2f, 0x9f, 0xb9, 0x37};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa1, 0xf8, 0xe9, 0xe7, 0xf3, 0x94, 0xee, 0xc1, 0x15, 0x1d, 0x78, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x16, 0xf2, 0xf3, 0x9f, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x79, 0x53, 0x22, 0xd4, 0xd3, 0xde, 0x37, 0x90, 0x2a, 0x4b, 0x89, 0xe1};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x20, 0x47, 0x61, 0xb6, 0x20, 0x37, 0x9c, 0x39, 0xcc, 0x9b, 0xca, 0x64,
                           0x94, 0x34, 0xd4, 0x61, 0xce, 0xff, 0x7c, 0x96, 0xb2, 0xb0, 0xd0, 0x62};
  uint8_t bytesprops1[] = {0x89, 0xdf, 0x50, 0x8b, 0xd6, 0x66, 0xb1, 0xc2, 0xae, 0xbd, 0xbb, 0xad, 0x17};
  uint8_t bytesprops2[] = {0x90, 0xc0, 0x37, 0x62, 0x33, 0x94, 0xda, 0x8,  0xa3, 0x21, 0xeb, 0x82, 0x56, 0xd6,
                           0x85, 0x66, 0x7d, 0x53, 0x1d, 0x22, 0xe0, 0x88, 0xa5, 0xf5, 0x1b, 0x3b, 0x93};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x7e, 0x4, 0x2c, 0xdc, 0x44, 0xb8, 0x4d, 0xec, 0xf0, 0x1d, 0xe7, 0xd5, 0xca, 0x34, 0x61};
  uint8_t bytesprops5[] = {0xff, 0xc9, 0x6b, 0x20, 0x96, 0x14, 0x8c, 0xf6, 0x6b,
                           0x23, 0x5e, 0x9d, 0x77, 0xdb, 0x82, 0xa9, 0xba, 0x89};
  uint8_t bytesprops6[] = {0xd4, 0x40, 0xe6, 0x2b, 0x6a, 0xad, 0x6b, 0x65};
  uint8_t bytesprops7[] = {0xf8, 0x4a, 0x18, 0x94, 0x30, 0xb4, 0xd0, 0xb5, 0x27, 0xe0, 0x2c};
  uint8_t bytesprops8[] = {0x1e, 0x63, 0xe5, 0x9a};
  uint8_t bytesprops9[] = {0x62, 0x20, 0x93};
  uint8_t bytesprops10[] = {0x2a, 0xe9, 0xbd, 0xdb, 0x9d, 0x52};
  uint8_t bytesprops11[] = {0xc9, 0x3b, 0x80, 0x32, 0x3a, 0xa2, 0xd,  0x16, 0x49, 0xe5, 0xf0, 0xa7, 0xd4, 0x69, 0x3e,
                            0x42, 0x9b, 0x34, 0x31, 0xde, 0xea, 0x9e, 0x45, 0x4a, 0x58, 0xbb, 0xbc, 0xec, 0x6b, 0xb0};
  uint8_t bytesprops12[] = {0xad, 0x91, 0x13, 0x0, 0x1e, 0x15, 0x6e, 0x24, 0xa4, 0x5d};
  uint8_t bytesprops13[] = {0x33, 0x77, 0x96, 0xcd, 0xf4, 0xfb, 0x5d, 0xa1, 0x8e, 0xe6, 0x13, 0xcd, 0x84, 0xb2,
                            0x81, 0xc1, 0x75, 0x51, 0x7d, 0x5e, 0xc7, 0x43, 0x5b, 0x22, 0x39, 0x80, 0x89, 0x76};
  uint8_t bytesprops14[] = {0x37, 0x43, 0xe3, 0x10, 0x5e, 0x3b, 0xd3, 0xd, 0xf5,
                            0x7e, 0xd9, 0x6f, 0x75, 0xd9, 0xe0, 0x76, 0x6b};
  uint8_t bytesprops15[] = {0x68, 0xd3, 0x26, 0x43, 0x31, 0xc5, 0x49, 0x4d, 0x11, 0x4e, 0xbb, 0xf0, 0x87,
                            0x5f, 0xcc, 0xdb, 0xca, 0x9d, 0xf4, 0x19, 0x8a, 0xb0, 0x42, 0xe0, 0x42, 0x96};
  uint8_t bytesprops16[] = {0xd5, 0x36, 0xfa, 0x5,  0x9,  0x8b, 0xeb, 0xbd, 0xa8, 0x4b, 0xb2,
                            0xde, 0xcd, 0x90, 0x24, 0xd5, 0x5,  0xa9, 0xce, 0xb9, 0xbc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4645}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26316}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5815}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18831}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20663}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26355}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28036, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8713 [("\fd\209\239\ETB\191E",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\183\248C",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("5",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ETBz+\DC4\ETB\244\SOH\203\149<\224g\247^\243\187\&3\RS<\162\178S]{{\143\226c_",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\238\DC4\212\224g.\142q`8P<\164\172\229\248",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\143Ib3\212\238\222\217k\223\\\SO\SOxm\220}s;^\162\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130\EM\NUL\129\234\143\201xg>\194\173tM\GS\148\201\167\221O\ENQ#ktu89\141",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("B\203O\166\SI\168J\185|\254\215>\177\156",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2})] [PropContentType "\"*8\173\t\"\NUL\161F\201\245\146P\ETX^"]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0xa5, 0x1,  0x22, 0x9,  0x12, 0x3,  0x0,  0xf,  0x22, 0x2a, 0x38, 0xad, 0x9,  0x22, 0x0,  0xa1,
                   0x46, 0xc9, 0xf5, 0x92, 0x50, 0x3,  0x5e, 0x0,  0x7,  0xc,  0x64, 0xd1, 0xef, 0x17, 0xbf, 0x45, 0x2,
                   0x0,  0x3,  0xb7, 0xf8, 0x43, 0x2,  0x0,  0x1,  0x35, 0x2,  0x0,  0x1d, 0x17, 0x7a, 0x2b, 0x14, 0x17,
                   0xf4, 0x1,  0xcb, 0x95, 0x3c, 0xe0, 0x67, 0xf7, 0x5e, 0xf3, 0xbb, 0x33, 0x1e, 0x3c, 0xa2, 0xb2, 0x53,
                   0x5d, 0x7b, 0x7b, 0x8f, 0xe2, 0x63, 0x5f, 0x1,  0x0,  0x10, 0xee, 0x14, 0xd4, 0xe0, 0x67, 0x2e, 0x8e,
                   0x71, 0x60, 0x38, 0x50, 0x3c, 0xa4, 0xac, 0xe5, 0xf8, 0x1,  0x0,  0x16, 0x8f, 0x49, 0x62, 0x33, 0xd4,
                   0xee, 0xde, 0xd9, 0x6b, 0xdf, 0x5c, 0xe,  0xe,  0x78, 0x6d, 0xdc, 0x7d, 0x73, 0x3b, 0x5e, 0xa2, 0xe2,
                   0x1,  0x0,  0x1c, 0x82, 0x19, 0x0,  0x81, 0xea, 0x8f, 0xc9, 0x78, 0x67, 0x3e, 0xc2, 0xad, 0x74, 0x4d,
                   0x1d, 0x94, 0xc9, 0xa7, 0xdd, 0x4f, 0x5,  0x23, 0x6b, 0x74, 0x75, 0x38, 0x39, 0x8d, 0x0,  0x0,  0xe,
                   0x42, 0xcb, 0x4f, 0xa6, 0xf,  0xa8, 0x4a, 0xb9, 0x7c, 0xfe, 0xd7, 0x3e, 0xb1, 0x9c, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc, 0x64, 0xd1, 0xef, 0x17, 0xbf, 0x45};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb7, 0xf8, 0x43};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x17, 0x7a, 0x2b, 0x14, 0x17, 0xf4, 0x1,  0xcb, 0x95, 0x3c,
                                     0xe0, 0x67, 0xf7, 0x5e, 0xf3, 0xbb, 0x33, 0x1e, 0x3c, 0xa2,
                                     0xb2, 0x53, 0x5d, 0x7b, 0x7b, 0x8f, 0xe2, 0x63, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xee, 0x14, 0xd4, 0xe0, 0x67, 0x2e, 0x8e, 0x71,
                                     0x60, 0x38, 0x50, 0x3c, 0xa4, 0xac, 0xe5, 0xf8};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8f, 0x49, 0x62, 0x33, 0xd4, 0xee, 0xde, 0xd9, 0x6b, 0xdf, 0x5c,
                                     0xe,  0xe,  0x78, 0x6d, 0xdc, 0x7d, 0x73, 0x3b, 0x5e, 0xa2, 0xe2};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0x19, 0x0,  0x81, 0xea, 0x8f, 0xc9, 0x78, 0x67, 0x3e,
                                     0xc2, 0xad, 0x74, 0x4d, 0x1d, 0x94, 0xc9, 0xa7, 0xdd, 0x4f,
                                     0x5,  0x23, 0x6b, 0x74, 0x75, 0x38, 0x39, 0x8d};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0xcb, 0x4f, 0xa6, 0xf, 0xa8, 0x4a, 0xb9, 0x7c, 0xfe, 0xd7, 0x3e, 0xb1, 0x9c};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x22, 0x2a, 0x38, 0xad, 0x9, 0x22, 0x0, 0xa1, 0x46, 0xc9, 0xf5, 0x92, 0x50, 0x3, 0x5e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8713, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22186 [("\SOs\230\200\227!\208>\aj\134P\159@\b\245\135B\251\254\225\t\197\222\144",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("3\163Q\180\141+\131\234M\208\187:\NULW\165\227R1\198\131\168\176\185z\149w",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\131\140\149\244p\253\129\DC2\DC1c#h\224qu\128\166\SICd\174\138\185",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\ESCp",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("9\209\165\252Ue\146\138\159\n%\SOW\252D\212",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropAuthenticationMethod "\209zPGD{e$"]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x79, 0x56, 0xaa, 0xb,  0x15, 0x0,  0x8,  0xd1, 0x7a, 0x50, 0x47, 0x44, 0x7b, 0x65, 0x24,
                   0x0,  0x19, 0xe,  0x73, 0xe6, 0xc8, 0xe3, 0x21, 0xd0, 0x3e, 0x7,  0x6a, 0x86, 0x50, 0x9f, 0x40,
                   0x8,  0xf5, 0x87, 0x42, 0xfb, 0xfe, 0xe1, 0x9,  0xc5, 0xde, 0x90, 0x1,  0x0,  0x1a, 0x33, 0xa3,
                   0x51, 0xb4, 0x8d, 0x2b, 0x83, 0xea, 0x4d, 0xd0, 0xbb, 0x3a, 0x0,  0x57, 0xa5, 0xe3, 0x52, 0x31,
                   0xc6, 0x83, 0xa8, 0xb0, 0xb9, 0x7a, 0x95, 0x77, 0x2,  0x0,  0x17, 0x83, 0x8c, 0x95, 0xf4, 0x70,
                   0xfd, 0x81, 0x12, 0x11, 0x63, 0x23, 0x68, 0xe0, 0x71, 0x75, 0x80, 0xa6, 0xf,  0x43, 0x64, 0xae,
                   0x8a, 0xb9, 0x2,  0x0,  0x2,  0x1b, 0x70, 0x1,  0x0,  0x10, 0x39, 0xd1, 0xa5, 0xfc, 0x55, 0x65,
                   0x92, 0x8a, 0x9f, 0xa,  0x25, 0xe,  0x57, 0xfc, 0x44, 0xd4, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xe,  0x73, 0xe6, 0xc8, 0xe3, 0x21, 0xd0, 0x3e, 0x7, 0x6a, 0x86, 0x50, 0x9f,
                                     0x40, 0x8,  0xf5, 0x87, 0x42, 0xfb, 0xfe, 0xe1, 0x9, 0xc5, 0xde, 0x90};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x33, 0xa3, 0x51, 0xb4, 0x8d, 0x2b, 0x83, 0xea, 0x4d, 0xd0, 0xbb, 0x3a, 0x0,
                                     0x57, 0xa5, 0xe3, 0x52, 0x31, 0xc6, 0x83, 0xa8, 0xb0, 0xb9, 0x7a, 0x95, 0x77};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x83, 0x8c, 0x95, 0xf4, 0x70, 0xfd, 0x81, 0x12, 0x11, 0x63, 0x23, 0x68,
                                     0xe0, 0x71, 0x75, 0x80, 0xa6, 0xf,  0x43, 0x64, 0xae, 0x8a, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1b, 0x70};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x39, 0xd1, 0xa5, 0xfc, 0x55, 0x65, 0x92, 0x8a,
                                     0x9f, 0xa,  0x25, 0xe,  0x57, 0xfc, 0x44, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xd1, 0x7a, 0x50, 0x47, 0x44, 0x7b, 0x65, 0x24};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22186, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16934 [("\ENQ\US\231\182\242\224Rp\134\v\227Heh\CAN\168\243\231\181k7&{\n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("W\201\226%\229\246\253\183\\\FS\242-\246I\DC4\DLE\188y\234\&5\240\DC1\189u\152\SO\240_",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\196\155\175",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("s\255c&\US\DLE@u",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("I4\236\129I\\c\187\205\211J",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("6\246\129_\248\224\199\160MK\168\141hr\171",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\251\&0:\197\176N\128\&0\194\204\246\NAK\236i}|\154\223c\f\220",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("Or\209\133\140\155\171\243\164J\229\235\242\246\132k}\ENQ\138\188\215\185\150%xv)P\ACK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\247\243Q\241\192)\133%\156\243\251\169\\\239\187E\234\163\194\141\&2\246*v\192\175\ETX\201",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropMaximumPacketSize 16232,PropRetainAvailable 225,PropSharedSubscriptionAvailable 54,PropRetainAvailable
// 75,PropMaximumPacketSize 25795,PropRetainAvailable 163,PropReceiveMaximum 32676,PropRequestResponseInformation
// 93,PropMaximumQoS 79,PropMessageExpiryInterval 4955,PropCorrelationData
// "5\SI\206\f\247\EM5",PropSharedSubscriptionAvailable 194,PropWillDelayInterval 26681,PropTopicAlias 16992]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xfb, 0x1,  0x42, 0x26, 0x32, 0x27, 0x0,  0x0,  0x3f, 0x68, 0x25, 0xe1, 0x2a, 0x36, 0x25, 0x4b,
                   0x27, 0x0,  0x0,  0x64, 0xc3, 0x25, 0xa3, 0x21, 0x7f, 0xa4, 0x19, 0x5d, 0x24, 0x4f, 0x2,  0x0,  0x0,
                   0x13, 0x5b, 0x9,  0x0,  0x7,  0x35, 0xf,  0xce, 0xc,  0xf7, 0x19, 0x35, 0x2a, 0xc2, 0x18, 0x0,  0x0,
                   0x68, 0x39, 0x23, 0x42, 0x60, 0x0,  0x18, 0x5,  0x1f, 0xe7, 0xb6, 0xf2, 0xe0, 0x52, 0x70, 0x86, 0xb,
                   0xe3, 0x48, 0x65, 0x68, 0x18, 0xa8, 0xf3, 0xe7, 0xb5, 0x6b, 0x37, 0x26, 0x7b, 0xa,  0x0,  0x0,  0x1c,
                   0x57, 0xc9, 0xe2, 0x25, 0xe5, 0xf6, 0xfd, 0xb7, 0x5c, 0x1c, 0xf2, 0x2d, 0xf6, 0x49, 0x14, 0x10, 0xbc,
                   0x79, 0xea, 0x35, 0xf0, 0x11, 0xbd, 0x75, 0x98, 0xe,  0xf0, 0x5f, 0x1,  0x0,  0x3,  0xc4, 0x9b, 0xaf,
                   0x2,  0x0,  0x0,  0x2,  0x0,  0x8,  0x73, 0xff, 0x63, 0x26, 0x1f, 0x10, 0x40, 0x75, 0x0,  0x0,  0xb,
                   0x49, 0x34, 0xec, 0x81, 0x49, 0x5c, 0x63, 0xbb, 0xcd, 0xd3, 0x4a, 0x1,  0x0,  0xf,  0x36, 0xf6, 0x81,
                   0x5f, 0xf8, 0xe0, 0xc7, 0xa0, 0x4d, 0x4b, 0xa8, 0x8d, 0x68, 0x72, 0xab, 0x0,  0x0,  0x15, 0xfb, 0x30,
                   0x3a, 0xc5, 0xb0, 0x4e, 0x80, 0x30, 0xc2, 0xcc, 0xf6, 0x15, 0xec, 0x69, 0x7d, 0x7c, 0x9a, 0xdf, 0x63,
                   0xc,  0xdc, 0x0,  0x0,  0x1d, 0x4f, 0x72, 0xd1, 0x85, 0x8c, 0x9b, 0xab, 0xf3, 0xa4, 0x4a, 0xe5, 0xeb,
                   0xf2, 0xf6, 0x84, 0x6b, 0x7d, 0x5,  0x8a, 0xbc, 0xd7, 0xb9, 0x96, 0x25, 0x78, 0x76, 0x29, 0x50, 0x6,
                   0x0,  0x0,  0x1d, 0xa9, 0xf7, 0xf3, 0x51, 0xf1, 0xc0, 0x29, 0x85, 0x25, 0x9c, 0xf3, 0xfb, 0xa9, 0x5c,
                   0xef, 0xbb, 0x45, 0xea, 0xa3, 0xc2, 0x8d, 0x32, 0xf6, 0x2a, 0x76, 0xc0, 0xaf, 0x3,  0xc9, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5,  0x1f, 0xe7, 0xb6, 0xf2, 0xe0, 0x52, 0x70, 0x86, 0xb,  0xe3, 0x48,
                                     0x65, 0x68, 0x18, 0xa8, 0xf3, 0xe7, 0xb5, 0x6b, 0x37, 0x26, 0x7b, 0xa};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x57, 0xc9, 0xe2, 0x25, 0xe5, 0xf6, 0xfd, 0xb7, 0x5c, 0x1c,
                                     0xf2, 0x2d, 0xf6, 0x49, 0x14, 0x10, 0xbc, 0x79, 0xea, 0x35,
                                     0xf0, 0x11, 0xbd, 0x75, 0x98, 0xe,  0xf0, 0x5f};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x9b, 0xaf};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x73, 0xff, 0x63, 0x26, 0x1f, 0x10, 0x40, 0x75};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x49, 0x34, 0xec, 0x81, 0x49, 0x5c, 0x63, 0xbb, 0xcd, 0xd3, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x36, 0xf6, 0x81, 0x5f, 0xf8, 0xe0, 0xc7, 0xa0,
                                     0x4d, 0x4b, 0xa8, 0x8d, 0x68, 0x72, 0xab};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfb, 0x30, 0x3a, 0xc5, 0xb0, 0x4e, 0x80, 0x30, 0xc2, 0xcc, 0xf6,
                                     0x15, 0xec, 0x69, 0x7d, 0x7c, 0x9a, 0xdf, 0x63, 0xc,  0xdc};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4f, 0x72, 0xd1, 0x85, 0x8c, 0x9b, 0xab, 0xf3, 0xa4, 0x4a,
                                     0xe5, 0xeb, 0xf2, 0xf6, 0x84, 0x6b, 0x7d, 0x5,  0x8a, 0xbc,
                                     0xd7, 0xb9, 0x96, 0x25, 0x78, 0x76, 0x29, 0x50, 0x6};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa9, 0xf7, 0xf3, 0x51, 0xf1, 0xc0, 0x29, 0x85, 0x25, 0x9c,
                                     0xf3, 0xfb, 0xa9, 0x5c, 0xef, 0xbb, 0x45, 0xea, 0xa3, 0xc2,
                                     0x8d, 0x32, 0xf6, 0x2a, 0x76, 0xc0, 0xaf, 0x3,  0xc9};
  lwmqtt_string_t topic_filter_s9 = {29, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0x35, 0xf, 0xce, 0xc, 0xf7, 0x19, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16232}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25795}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32676}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4955}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26681}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16992}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16934, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19450 [("-\157He_V\165gmY\135\DC1\242\b\132\141\234\205\247",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("X+\208\242
// 0\199d9\203\NAK)\182AKX:\187*\247|\177\229",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("-\200\196\v\SON\152\156\131\233\ESC\181(\174\ESC_\182(",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\245",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\"\DLE\152\151\134\RS\b7\133\240",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\155\200\218O\139Q\137\183r>\FSZ()\163@C\240\153\197\175\164w\237\244\214",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(":%\214!\232hqh\239\137?\SYN\253\231\130\239Ki",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\211\242#\201}dL\240\189\150\251\185\231~?\227\158\152z\251\SUB\DELS\174E",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("%\GS>\174RN3\188KZ\169\ETB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] [PropSharedSubscriptionAvailable 66,PropUserProperty
// "\239r\235n\146\&6\EOT\162\193z|\DC3l\176\217\238r|\138\249^\245\EM\207\215\228"
// "y\147c9\137j-\230\189\DLE/k\189\DLE}\134\240\SI\255>\140<",PropAuthenticationData
// "\US\210\SO*\139\EOT!\208\230\191\151\246\207\175\170\209\152C\220\DC2\146\FS\131\135",PropAuthenticationData
// "\196\157U\211\r\233\130\EM{\131\197%\\\168s",PropReasonString "\237\DC2\244\202\154\\\252\226\t",PropServerReference
// "\141g5\ETXV\193\"\r\218HU\ESCY\222+_\213\185\SO\188",PropAuthenticationData
// "\ETX\228\224\143\243\234\"ld\161\233\193\243W\187&\145\139y\195~1\202\255\254\231\&1",PropWillDelayInterval
// 16995,PropAuthenticationData "!\163\179\196OQ\201\234\147W\140\224",PropServerKeepAlive
// 9589,PropAssignedClientIdentifier
// "\218=\228~O\GSN\SYN\137\128tP\151\149\211$\197%\215a\249\135\162\167\230:^\142",PropAuthenticationData
// "\US\237\184s\148\161\162\FS{\204.@{N\151\146\DC4|\DC1\135v\138\209\199w\171aDK",PropRequestProblemInformation
// 225,PropWillDelayInterval 22189,PropRetainAvailable 69,PropCorrelationData
// "T|H${3\147\FSz\ESC<\199~\245\DC1t\159#\193\234\205\139.\DC3",PropSharedSubscriptionAvailable
// 87,PropSharedSubscriptionAvailable 195,PropWildcardSubscriptionAvailable 248,PropServerReference
// "\162y\196\223\GS\200\DC3\188\b\197yr\DC2\DC4}A\131\224M\151ND\NAK",PropRequestProblemInformation 2]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xf8, 0x3,  0x4b, 0xfa, 0xc1, 0x2,  0x2a, 0x42, 0x26, 0x0,  0x1a, 0xef, 0x72, 0xeb, 0x6e, 0x92, 0x36, 0x4,
      0xa2, 0xc1, 0x7a, 0x7c, 0x13, 0x6c, 0xb0, 0xd9, 0xee, 0x72, 0x7c, 0x8a, 0xf9, 0x5e, 0xf5, 0x19, 0xcf, 0xd7, 0xe4,
      0x0,  0x16, 0x79, 0x93, 0x63, 0x39, 0x89, 0x6a, 0x2d, 0xe6, 0xbd, 0x10, 0x2f, 0x6b, 0xbd, 0x10, 0x7d, 0x86, 0xf0,
      0xf,  0xff, 0x3e, 0x8c, 0x3c, 0x16, 0x0,  0x18, 0x1f, 0xd2, 0xe,  0x2a, 0x8b, 0x4,  0x21, 0xd0, 0xe6, 0xbf, 0x97,
      0xf6, 0xcf, 0xaf, 0xaa, 0xd1, 0x98, 0x43, 0xdc, 0x12, 0x92, 0x1c, 0x83, 0x87, 0x16, 0x0,  0xf,  0xc4, 0x9d, 0x55,
      0xd3, 0xd,  0xe9, 0x82, 0x19, 0x7b, 0x83, 0xc5, 0x25, 0x5c, 0xa8, 0x73, 0x1f, 0x0,  0x9,  0xed, 0x12, 0xf4, 0xca,
      0x9a, 0x5c, 0xfc, 0xe2, 0x9,  0x1c, 0x0,  0x14, 0x8d, 0x67, 0x35, 0x3,  0x56, 0xc1, 0x22, 0xd,  0xda, 0x48, 0x55,
      0x1b, 0x59, 0xde, 0x2b, 0x5f, 0xd5, 0xb9, 0xe,  0xbc, 0x16, 0x0,  0x1b, 0x3,  0xe4, 0xe0, 0x8f, 0xf3, 0xea, 0x22,
      0x6c, 0x64, 0xa1, 0xe9, 0xc1, 0xf3, 0x57, 0xbb, 0x26, 0x91, 0x8b, 0x79, 0xc3, 0x7e, 0x31, 0xca, 0xff, 0xfe, 0xe7,
      0x31, 0x18, 0x0,  0x0,  0x42, 0x63, 0x16, 0x0,  0xc,  0x21, 0xa3, 0xb3, 0xc4, 0x4f, 0x51, 0xc9, 0xea, 0x93, 0x57,
      0x8c, 0xe0, 0x13, 0x25, 0x75, 0x12, 0x0,  0x1c, 0xda, 0x3d, 0xe4, 0x7e, 0x4f, 0x1d, 0x4e, 0x16, 0x89, 0x80, 0x74,
      0x50, 0x97, 0x95, 0xd3, 0x24, 0xc5, 0x25, 0xd7, 0x61, 0xf9, 0x87, 0xa2, 0xa7, 0xe6, 0x3a, 0x5e, 0x8e, 0x16, 0x0,
      0x1d, 0x1f, 0xed, 0xb8, 0x73, 0x94, 0xa1, 0xa2, 0x1c, 0x7b, 0xcc, 0x2e, 0x40, 0x7b, 0x4e, 0x97, 0x92, 0x14, 0x7c,
      0x11, 0x87, 0x76, 0x8a, 0xd1, 0xc7, 0x77, 0xab, 0x61, 0x44, 0x4b, 0x17, 0xe1, 0x18, 0x0,  0x0,  0x56, 0xad, 0x25,
      0x45, 0x9,  0x0,  0x18, 0x54, 0x7c, 0x48, 0x24, 0x7b, 0x33, 0x93, 0x1c, 0x7a, 0x1b, 0x3c, 0xc7, 0x7e, 0xf5, 0x11,
      0x74, 0x9f, 0x23, 0xc1, 0xea, 0xcd, 0x8b, 0x2e, 0x13, 0x2a, 0x57, 0x2a, 0xc3, 0x28, 0xf8, 0x1c, 0x0,  0x17, 0xa2,
      0x79, 0xc4, 0xdf, 0x1d, 0xc8, 0x13, 0xbc, 0x8,  0xc5, 0x79, 0x72, 0x12, 0x14, 0x7d, 0x41, 0x83, 0xe0, 0x4d, 0x97,
      0x4e, 0x44, 0x15, 0x17, 0x2,  0x0,  0x13, 0x2d, 0x9d, 0x48, 0x65, 0x5f, 0x56, 0xa5, 0x67, 0x6d, 0x59, 0x87, 0x11,
      0xf2, 0x8,  0x84, 0x8d, 0xea, 0xcd, 0xf7, 0x0,  0x0,  0x17, 0x58, 0x2b, 0xd0, 0xf2, 0x20, 0x30, 0xc7, 0x64, 0x39,
      0xcb, 0x15, 0x29, 0xb6, 0x41, 0x4b, 0x58, 0x3a, 0xbb, 0x2a, 0xf7, 0x7c, 0xb1, 0xe5, 0x2,  0x0,  0x12, 0x2d, 0xc8,
      0xc4, 0xb,  0xe,  0x4e, 0x98, 0x9c, 0x83, 0xe9, 0x1b, 0xb5, 0x28, 0xae, 0x1b, 0x5f, 0xb6, 0x28, 0x1,  0x0,  0x1,
      0xf5, 0x1,  0x0,  0xa,  0x22, 0x10, 0x98, 0x97, 0x86, 0x1e, 0x8,  0x37, 0x85, 0xf0, 0x0,  0x0,  0x1a, 0x9b, 0xc8,
      0xda, 0x4f, 0x8b, 0x51, 0x89, 0xb7, 0x72, 0x3e, 0x1c, 0x5a, 0x28, 0x29, 0xa3, 0x40, 0x43, 0xf0, 0x99, 0xc5, 0xaf,
      0xa4, 0x77, 0xed, 0xf4, 0xd6, 0x2,  0x0,  0x12, 0x3a, 0x25, 0xd6, 0x21, 0xe8, 0x68, 0x71, 0x68, 0xef, 0x89, 0x3f,
      0x16, 0xfd, 0xe7, 0x82, 0xef, 0x4b, 0x69, 0x1,  0x0,  0x19, 0xd3, 0xf2, 0x23, 0xc9, 0x7d, 0x64, 0x4c, 0xf0, 0xbd,
      0x96, 0xfb, 0xb9, 0xe7, 0x7e, 0x3f, 0xe3, 0x9e, 0x98, 0x7a, 0xfb, 0x1a, 0x7f, 0x53, 0xae, 0x45, 0x1,  0x0,  0xc,
      0x25, 0x1d, 0x3e, 0xae, 0x52, 0x4e, 0x33, 0xbc, 0x4b, 0x5a, 0xa9, 0x17, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x2d, 0x9d, 0x48, 0x65, 0x5f, 0x56, 0xa5, 0x67, 0x6d, 0x59,
                                     0x87, 0x11, 0xf2, 0x8,  0x84, 0x8d, 0xea, 0xcd, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x58, 0x2b, 0xd0, 0xf2, 0x20, 0x30, 0xc7, 0x64, 0x39, 0xcb, 0x15, 0x29,
                                     0xb6, 0x41, 0x4b, 0x58, 0x3a, 0xbb, 0x2a, 0xf7, 0x7c, 0xb1, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0xc8, 0xc4, 0xb,  0xe,  0x4e, 0x98, 0x9c, 0x83,
                                     0xe9, 0x1b, 0xb5, 0x28, 0xae, 0x1b, 0x5f, 0xb6, 0x28};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf5};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x22, 0x10, 0x98, 0x97, 0x86, 0x1e, 0x8, 0x37, 0x85, 0xf0};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9b, 0xc8, 0xda, 0x4f, 0x8b, 0x51, 0x89, 0xb7, 0x72, 0x3e, 0x1c, 0x5a, 0x28,
                                     0x29, 0xa3, 0x40, 0x43, 0xf0, 0x99, 0xc5, 0xaf, 0xa4, 0x77, 0xed, 0xf4, 0xd6};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3a, 0x25, 0xd6, 0x21, 0xe8, 0x68, 0x71, 0x68, 0xef,
                                     0x89, 0x3f, 0x16, 0xfd, 0xe7, 0x82, 0xef, 0x4b, 0x69};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd3, 0xf2, 0x23, 0xc9, 0x7d, 0x64, 0x4c, 0xf0, 0xbd, 0x96, 0xfb, 0xb9, 0xe7,
                                     0x7e, 0x3f, 0xe3, 0x9e, 0x98, 0x7a, 0xfb, 0x1a, 0x7f, 0x53, 0xae, 0x45};
  lwmqtt_string_t topic_filter_s7 = {25, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x25, 0x1d, 0x3e, 0xae, 0x52, 0x4e, 0x33, 0xbc, 0x4b, 0x5a, 0xa9, 0x17};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops1[] = {0x79, 0x93, 0x63, 0x39, 0x89, 0x6a, 0x2d, 0xe6, 0xbd, 0x10, 0x2f,
                           0x6b, 0xbd, 0x10, 0x7d, 0x86, 0xf0, 0xf,  0xff, 0x3e, 0x8c, 0x3c};
  uint8_t bytesprops0[] = {0xef, 0x72, 0xeb, 0x6e, 0x92, 0x36, 0x4,  0xa2, 0xc1, 0x7a, 0x7c, 0x13, 0x6c,
                           0xb0, 0xd9, 0xee, 0x72, 0x7c, 0x8a, 0xf9, 0x5e, 0xf5, 0x19, 0xcf, 0xd7, 0xe4};
  uint8_t bytesprops2[] = {0x1f, 0xd2, 0xe,  0x2a, 0x8b, 0x4,  0x21, 0xd0, 0xe6, 0xbf, 0x97, 0xf6,
                           0xcf, 0xaf, 0xaa, 0xd1, 0x98, 0x43, 0xdc, 0x12, 0x92, 0x1c, 0x83, 0x87};
  uint8_t bytesprops3[] = {0xc4, 0x9d, 0x55, 0xd3, 0xd, 0xe9, 0x82, 0x19, 0x7b, 0x83, 0xc5, 0x25, 0x5c, 0xa8, 0x73};
  uint8_t bytesprops4[] = {0xed, 0x12, 0xf4, 0xca, 0x9a, 0x5c, 0xfc, 0xe2, 0x9};
  uint8_t bytesprops5[] = {0x8d, 0x67, 0x35, 0x3,  0x56, 0xc1, 0x22, 0xd,  0xda, 0x48,
                           0x55, 0x1b, 0x59, 0xde, 0x2b, 0x5f, 0xd5, 0xb9, 0xe,  0xbc};
  uint8_t bytesprops6[] = {0x3,  0xe4, 0xe0, 0x8f, 0xf3, 0xea, 0x22, 0x6c, 0x64, 0xa1, 0xe9, 0xc1, 0xf3, 0x57,
                           0xbb, 0x26, 0x91, 0x8b, 0x79, 0xc3, 0x7e, 0x31, 0xca, 0xff, 0xfe, 0xe7, 0x31};
  uint8_t bytesprops7[] = {0x21, 0xa3, 0xb3, 0xc4, 0x4f, 0x51, 0xc9, 0xea, 0x93, 0x57, 0x8c, 0xe0};
  uint8_t bytesprops8[] = {0xda, 0x3d, 0xe4, 0x7e, 0x4f, 0x1d, 0x4e, 0x16, 0x89, 0x80, 0x74, 0x50, 0x97, 0x95,
                           0xd3, 0x24, 0xc5, 0x25, 0xd7, 0x61, 0xf9, 0x87, 0xa2, 0xa7, 0xe6, 0x3a, 0x5e, 0x8e};
  uint8_t bytesprops9[] = {0x1f, 0xed, 0xb8, 0x73, 0x94, 0xa1, 0xa2, 0x1c, 0x7b, 0xcc, 0x2e, 0x40, 0x7b, 0x4e, 0x97,
                           0x92, 0x14, 0x7c, 0x11, 0x87, 0x76, 0x8a, 0xd1, 0xc7, 0x77, 0xab, 0x61, 0x44, 0x4b};
  uint8_t bytesprops10[] = {0x54, 0x7c, 0x48, 0x24, 0x7b, 0x33, 0x93, 0x1c, 0x7a, 0x1b, 0x3c, 0xc7,
                            0x7e, 0xf5, 0x11, 0x74, 0x9f, 0x23, 0xc1, 0xea, 0xcd, 0x8b, 0x2e, 0x13};
  uint8_t bytesprops11[] = {0xa2, 0x79, 0xc4, 0xdf, 0x1d, 0xc8, 0x13, 0xbc, 0x8,  0xc5, 0x79, 0x72,
                            0x12, 0x14, 0x7d, 0x41, 0x83, 0xe0, 0x4d, 0x97, 0x4e, 0x44, 0x15};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16995}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9589}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22189}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19450, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18336 [("M\159.\194\192\a\198\148]\234\233",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\189\222HE\204\236\228\133\ACK*\236X\128\&0\229;n\245ORb\196",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("!\228\203\199\141\147\FS\178d6\b\237y\140c\213\DEL\141D \168\b\t\231C\"\STX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\208N\231\188\204\CANY\CAN+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("1\138\249\166\182\244n<\189\SI\a\192\&8W~\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("Nt",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\182",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\NUL\n1\166lT'\255\146\189^\227\207\&3W\174*\171\194",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("O",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("^\230>\180\243\221\ENQ\146K\SYN\153i:\167\222\r",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropRetainAvailable 177,PropContentType
// "\177b\143\183U\DC2[&\221\SOH\241f",PropAssignedClientIdentifier
// "\173s\f\207k$\250\208\181\240\161\189\226\EOT\243?\140\US93",PropRequestProblemInformation
// 101,PropMessageExpiryInterval 27033,PropServerKeepAlive 14517,PropPayloadFormatIndicator 214,PropResponseTopic
// "O);NP\195\240\RS\b\145R\178\FS\236\254\\\"\244>\NAK\nV\132o\DC1\153\&1\249\&4\DC1",PropTopicAliasMaximum
// 24352,PropAuthenticationMethod "\197\134)\138\167\141\199\217\139%\167X\217q\192T\196\181\"F\NAK:",PropTopicAlias
// 15336,PropSharedSubscriptionAvailable 6,PropWillDelayInterval 30622,PropRequestProblemInformation
// 44,PropResponseInformation
// "k\134\199\247&g\215\191\209z\218\SO\161\167\204,\230\164\&0F\DC3\192w",PropServerReference
// "\156\244fb\141\233\a\186_|4>b\ETB\214Z\166",PropContentType
// "\242\&9\169\138D\138\EM\143%\193\238\213\216\&9\170\DC2\178(\173i[p\173~\CAN\CAN\171?\215",PropTopicAlias
// 13053,PropMessageExpiryInterval 7710,PropAssignedClientIdentifier
// "w\194\243\EM\ETB\218\196\US]\241\r\160\137\207x",PropServerKeepAlive 6792]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x82, 0x8a, 0x3,  0x47, 0xa0, 0xe8, 0x1,  0x25, 0xb1, 0x3,  0x0,  0xc,  0xb1, 0x62, 0x8f, 0xb7, 0x55, 0x12, 0x5b,
      0x26, 0xdd, 0x1,  0xf1, 0x66, 0x12, 0x0,  0x14, 0xad, 0x73, 0xc,  0xcf, 0x6b, 0x24, 0xfa, 0xd0, 0xb5, 0xf0, 0xa1,
      0xbd, 0xe2, 0x4,  0xf3, 0x3f, 0x8c, 0x1f, 0x39, 0x33, 0x17, 0x65, 0x2,  0x0,  0x0,  0x69, 0x99, 0x13, 0x38, 0xb5,
      0x1,  0xd6, 0x8,  0x0,  0x1e, 0x4f, 0x29, 0x3b, 0x4e, 0x50, 0xc3, 0xf0, 0x1e, 0x8,  0x91, 0x52, 0xb2, 0x1c, 0xec,
      0xfe, 0x5c, 0x22, 0xf4, 0x3e, 0x15, 0xa,  0x56, 0x84, 0x6f, 0x11, 0x99, 0x31, 0xf9, 0x34, 0x11, 0x22, 0x5f, 0x20,
      0x15, 0x0,  0x16, 0xc5, 0x86, 0x29, 0x8a, 0xa7, 0x8d, 0xc7, 0xd9, 0x8b, 0x25, 0xa7, 0x58, 0xd9, 0x71, 0xc0, 0x54,
      0xc4, 0xb5, 0x22, 0x46, 0x15, 0x3a, 0x23, 0x3b, 0xe8, 0x2a, 0x6,  0x18, 0x0,  0x0,  0x77, 0x9e, 0x17, 0x2c, 0x1a,
      0x0,  0x17, 0x6b, 0x86, 0xc7, 0xf7, 0x26, 0x67, 0xd7, 0xbf, 0xd1, 0x7a, 0xda, 0xe,  0xa1, 0xa7, 0xcc, 0x2c, 0xe6,
      0xa4, 0x30, 0x46, 0x13, 0xc0, 0x77, 0x1c, 0x0,  0x11, 0x9c, 0xf4, 0x66, 0x62, 0x8d, 0xe9, 0x7,  0xba, 0x5f, 0x7c,
      0x34, 0x3e, 0x62, 0x17, 0xd6, 0x5a, 0xa6, 0x3,  0x0,  0x1d, 0xf2, 0x39, 0xa9, 0x8a, 0x44, 0x8a, 0x19, 0x8f, 0x25,
      0xc1, 0xee, 0xd5, 0xd8, 0x39, 0xaa, 0x12, 0xb2, 0x28, 0xad, 0x69, 0x5b, 0x70, 0xad, 0x7e, 0x18, 0x18, 0xab, 0x3f,
      0xd7, 0x23, 0x32, 0xfd, 0x2,  0x0,  0x0,  0x1e, 0x1e, 0x12, 0x0,  0xf,  0x77, 0xc2, 0xf3, 0x19, 0x17, 0xda, 0xc4,
      0x1f, 0x5d, 0xf1, 0xd,  0xa0, 0x89, 0xcf, 0x78, 0x13, 0x1a, 0x88, 0x0,  0xb,  0x4d, 0x9f, 0x2e, 0xc2, 0xc0, 0x7,
      0xc6, 0x94, 0x5d, 0xea, 0xe9, 0x0,  0x0,  0x16, 0xbd, 0xde, 0x48, 0x45, 0xcc, 0xec, 0xe4, 0x85, 0x6,  0x2a, 0xec,
      0x58, 0x80, 0x30, 0xe5, 0x3b, 0x6e, 0xf5, 0x4f, 0x52, 0x62, 0xc4, 0x0,  0x0,  0x1b, 0x21, 0xe4, 0xcb, 0xc7, 0x8d,
      0x93, 0x1c, 0xb2, 0x64, 0x36, 0x8,  0xed, 0x79, 0x8c, 0x63, 0xd5, 0x7f, 0x8d, 0x44, 0x20, 0xa8, 0x8,  0x9,  0xe7,
      0x43, 0x22, 0x2,  0x0,  0x0,  0x9,  0xd0, 0x4e, 0xe7, 0xbc, 0xcc, 0x18, 0x59, 0x18, 0x2b, 0x1,  0x0,  0x10, 0x31,
      0x8a, 0xf9, 0xa6, 0xb6, 0xf4, 0x6e, 0x3c, 0xbd, 0xf,  0x7,  0xc0, 0x38, 0x57, 0x7e, 0xf,  0x0,  0x0,  0x2,  0x4e,
      0x74, 0x0,  0x0,  0x1,  0xb6, 0x0,  0x0,  0x14, 0x31, 0x0,  0xa,  0x31, 0xa6, 0x6c, 0x54, 0x27, 0xff, 0x92, 0xbd,
      0x5e, 0xe3, 0xcf, 0x33, 0x57, 0xae, 0x2a, 0xab, 0xc2, 0x1,  0x0,  0x1,  0x4f, 0x0,  0x0,  0x0,  0x2,  0x0,  0x10,
      0x5e, 0xe6, 0x3e, 0xb4, 0xf3, 0xdd, 0x5,  0x92, 0x4b, 0x16, 0x99, 0x69, 0x3a, 0xa7, 0xde, 0xd,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x4d, 0x9f, 0x2e, 0xc2, 0xc0, 0x7, 0xc6, 0x94, 0x5d, 0xea, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xde, 0x48, 0x45, 0xcc, 0xec, 0xe4, 0x85, 0x6,  0x2a, 0xec,
                                     0x58, 0x80, 0x30, 0xe5, 0x3b, 0x6e, 0xf5, 0x4f, 0x52, 0x62, 0xc4};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x21, 0xe4, 0xcb, 0xc7, 0x8d, 0x93, 0x1c, 0xb2, 0x64, 0x36, 0x8,  0xed, 0x79, 0x8c,
                                     0x63, 0xd5, 0x7f, 0x8d, 0x44, 0x20, 0xa8, 0x8,  0x9,  0xe7, 0x43, 0x22, 0x2};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd0, 0x4e, 0xe7, 0xbc, 0xcc, 0x18, 0x59, 0x18, 0x2b};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x8a, 0xf9, 0xa6, 0xb6, 0xf4, 0x6e, 0x3c,
                                     0xbd, 0xf,  0x7,  0xc0, 0x38, 0x57, 0x7e, 0xf};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0x74};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb6};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x31, 0x0,  0xa,  0x31, 0xa6, 0x6c, 0x54, 0x27, 0xff, 0x92,
                                     0xbd, 0x5e, 0xe3, 0xcf, 0x33, 0x57, 0xae, 0x2a, 0xab, 0xc2};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4f};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5e, 0xe6, 0x3e, 0xb4, 0xf3, 0xdd, 0x5,  0x92,
                                      0x4b, 0x16, 0x99, 0x69, 0x3a, 0xa7, 0xde, 0xd};
  lwmqtt_string_t topic_filter_s10 = {16, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xb1, 0x62, 0x8f, 0xb7, 0x55, 0x12, 0x5b, 0x26, 0xdd, 0x1, 0xf1, 0x66};
  uint8_t bytesprops1[] = {0xad, 0x73, 0xc,  0xcf, 0x6b, 0x24, 0xfa, 0xd0, 0xb5, 0xf0,
                           0xa1, 0xbd, 0xe2, 0x4,  0xf3, 0x3f, 0x8c, 0x1f, 0x39, 0x33};
  uint8_t bytesprops2[] = {0x4f, 0x29, 0x3b, 0x4e, 0x50, 0xc3, 0xf0, 0x1e, 0x8,  0x91, 0x52, 0xb2, 0x1c, 0xec, 0xfe,
                           0x5c, 0x22, 0xf4, 0x3e, 0x15, 0xa,  0x56, 0x84, 0x6f, 0x11, 0x99, 0x31, 0xf9, 0x34, 0x11};
  uint8_t bytesprops3[] = {0xc5, 0x86, 0x29, 0x8a, 0xa7, 0x8d, 0xc7, 0xd9, 0x8b, 0x25, 0xa7,
                           0x58, 0xd9, 0x71, 0xc0, 0x54, 0xc4, 0xb5, 0x22, 0x46, 0x15, 0x3a};
  uint8_t bytesprops4[] = {0x6b, 0x86, 0xc7, 0xf7, 0x26, 0x67, 0xd7, 0xbf, 0xd1, 0x7a, 0xda, 0xe,
                           0xa1, 0xa7, 0xcc, 0x2c, 0xe6, 0xa4, 0x30, 0x46, 0x13, 0xc0, 0x77};
  uint8_t bytesprops5[] = {0x9c, 0xf4, 0x66, 0x62, 0x8d, 0xe9, 0x7,  0xba, 0x5f,
                           0x7c, 0x34, 0x3e, 0x62, 0x17, 0xd6, 0x5a, 0xa6};
  uint8_t bytesprops6[] = {0xf2, 0x39, 0xa9, 0x8a, 0x44, 0x8a, 0x19, 0x8f, 0x25, 0xc1, 0xee, 0xd5, 0xd8, 0x39, 0xaa,
                           0x12, 0xb2, 0x28, 0xad, 0x69, 0x5b, 0x70, 0xad, 0x7e, 0x18, 0x18, 0xab, 0x3f, 0xd7};
  uint8_t bytesprops7[] = {0x77, 0xc2, 0xf3, 0x19, 0x17, 0xda, 0xc4, 0x1f, 0x5d, 0xf1, 0xd, 0xa0, 0x89, 0xcf, 0x78};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27033}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14517}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24352}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15336}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30622}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13053}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7710}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6792}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18336, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3357 [("\203$[\200\&9\130F\142\249\232\189\167\148L",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("<\n\188
// \193>c\237\242\202\GSX\216\222e\204\149;\226",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("(.\204\183\ESC\178*",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("fld~\ACK9Z//1\205\SUB~\211l\241D\196`T",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("<\215\129\217-\248\223\vA\CAN$\203\213IH\227)\200\233[\174/\236\234\235\206\245\154\236\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropRequestProblemInformation 141,PropReasonString "\182",PropReasonString
// "\202\SI\202\227&\182\161X2u\219;\201\203",PropCorrelationData
// "]\144\214>\132\vl\239`\208,s\b\225\194\142<n\235\a\f\207,\247\225L",PropResponseTopic
// "\176\&0\242\US\146\164\241\FS;[1\189\SIl",PropContentType "z1\250\r\199x",PropWillDelayInterval
// 7173,PropAuthenticationData "\200\136\207\185\175",PropMaximumPacketSize 15115,PropServerReference
// "\193\204\212\194\136\ESC",PropMaximumQoS 7,PropAssignedClientIdentifier "",PropMessageExpiryInterval 3043]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0xdf, 0x1,  0xd,  0x1d, 0x73, 0x17, 0x8d, 0x1f, 0x0,  0x1,  0xb6, 0x1f, 0x0,  0xe,  0xca, 0xf,  0xca, 0xe3,
      0x26, 0xb6, 0xa1, 0x58, 0x32, 0x75, 0xdb, 0x3b, 0xc9, 0xcb, 0x9,  0x0,  0x1a, 0x5d, 0x90, 0xd6, 0x3e, 0x84, 0xb,
      0x6c, 0xef, 0x60, 0xd0, 0x2c, 0x73, 0x8,  0xe1, 0xc2, 0x8e, 0x3c, 0x6e, 0xeb, 0x7,  0xc,  0xcf, 0x2c, 0xf7, 0xe1,
      0x4c, 0x8,  0x0,  0xe,  0xb0, 0x30, 0xf2, 0x1f, 0x92, 0xa4, 0xf1, 0x1c, 0x3b, 0x5b, 0x31, 0xbd, 0xf,  0x6c, 0x3,
      0x0,  0x6,  0x7a, 0x31, 0xfa, 0xd,  0xc7, 0x78, 0x18, 0x0,  0x0,  0x1c, 0x5,  0x16, 0x0,  0x5,  0xc8, 0x88, 0xcf,
      0xb9, 0xaf, 0x27, 0x0,  0x0,  0x3b, 0xb,  0x1c, 0x0,  0x6,  0xc1, 0xcc, 0xd4, 0xc2, 0x88, 0x1b, 0x24, 0x7,  0x12,
      0x0,  0x0,  0x2,  0x0,  0x0,  0xb,  0xe3, 0x0,  0xe,  0xcb, 0x24, 0x5b, 0xc8, 0x39, 0x82, 0x46, 0x8e, 0xf9, 0xe8,
      0xbd, 0xa7, 0x94, 0x4c, 0x1,  0x0,  0x13, 0x3c, 0xa,  0xbc, 0x20, 0xc1, 0x3e, 0x63, 0xed, 0xf2, 0xca, 0x1d, 0x58,
      0xd8, 0xde, 0x65, 0xcc, 0x95, 0x3b, 0xe2, 0x2,  0x0,  0x7,  0x28, 0x2e, 0xcc, 0xb7, 0x1b, 0xb2, 0x2a, 0x2,  0x0,
      0x14, 0x66, 0x6c, 0x64, 0x7e, 0x6,  0x39, 0x5a, 0x2f, 0x2f, 0x31, 0xcd, 0x1a, 0x7e, 0xd3, 0x6c, 0xf1, 0x44, 0xc4,
      0x60, 0x54, 0x0,  0x0,  0x1e, 0x3c, 0xd7, 0x81, 0xd9, 0x2d, 0xf8, 0xdf, 0xb,  0x41, 0x18, 0x24, 0xcb, 0xd5, 0x49,
      0x48, 0xe3, 0x29, 0xc8, 0xe9, 0x5b, 0xae, 0x2f, 0xec, 0xea, 0xeb, 0xce, 0xf5, 0x9a, 0xec, 0xfd, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xcb, 0x24, 0x5b, 0xc8, 0x39, 0x82, 0x46,
                                     0x8e, 0xf9, 0xe8, 0xbd, 0xa7, 0x94, 0x4c};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3c, 0xa,  0xbc, 0x20, 0xc1, 0x3e, 0x63, 0xed, 0xf2, 0xca,
                                     0x1d, 0x58, 0xd8, 0xde, 0x65, 0xcc, 0x95, 0x3b, 0xe2};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x28, 0x2e, 0xcc, 0xb7, 0x1b, 0xb2, 0x2a};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x66, 0x6c, 0x64, 0x7e, 0x6,  0x39, 0x5a, 0x2f, 0x2f, 0x31,
                                     0xcd, 0x1a, 0x7e, 0xd3, 0x6c, 0xf1, 0x44, 0xc4, 0x60, 0x54};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3c, 0xd7, 0x81, 0xd9, 0x2d, 0xf8, 0xdf, 0xb,  0x41, 0x18,
                                     0x24, 0xcb, 0xd5, 0x49, 0x48, 0xe3, 0x29, 0xc8, 0xe9, 0x5b,
                                     0xae, 0x2f, 0xec, 0xea, 0xeb, 0xce, 0xf5, 0x9a, 0xec, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0xb6};
  uint8_t bytesprops1[] = {0xca, 0xf, 0xca, 0xe3, 0x26, 0xb6, 0xa1, 0x58, 0x32, 0x75, 0xdb, 0x3b, 0xc9, 0xcb};
  uint8_t bytesprops2[] = {0x5d, 0x90, 0xd6, 0x3e, 0x84, 0xb,  0x6c, 0xef, 0x60, 0xd0, 0x2c, 0x73, 0x8,
                           0xe1, 0xc2, 0x8e, 0x3c, 0x6e, 0xeb, 0x7,  0xc,  0xcf, 0x2c, 0xf7, 0xe1, 0x4c};
  uint8_t bytesprops3[] = {0xb0, 0x30, 0xf2, 0x1f, 0x92, 0xa4, 0xf1, 0x1c, 0x3b, 0x5b, 0x31, 0xbd, 0xf, 0x6c};
  uint8_t bytesprops4[] = {0x7a, 0x31, 0xfa, 0xd, 0xc7, 0x78};
  uint8_t bytesprops5[] = {0xc8, 0x88, 0xcf, 0xb9, 0xaf};
  uint8_t bytesprops6[] = {0xc1, 0xcc, 0xd4, 0xc2, 0x88, 0x1b};
  uint8_t bytesprops7[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7173}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15115}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3043}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3357, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18395 [("v2\217\195\171\136\254\128:i",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\249i9\228\SII\156\192\&7/.\187\203%",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\245\205\t;\164#p\ESC\CAN\168,\134\NUL{\RS\164\CAN^\223\149",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropResponseTopic
// ")\184o\240\251\169\SOH\173\212S\199~\229\169\189\162\251^3\241\233i]\155\225F\NUL",PropServerReference
// "\250n\r6\219\249\254\205\147*\EM\199\&2\197\213N\248\v\198",PropPayloadFormatIndicator
// 113,PropWildcardSubscriptionAvailable 172,PropSessionExpiryInterval 17048,PropPayloadFormatIndicator
// 125,PropRequestProblemInformation 204,PropSubscriptionIdentifier 16,PropResponseTopic
// "{\210?\179\230\213H\158",PropAssignedClientIdentifier
// "P&\248\DC2i\243\STX-\162\189\223\186\134:\154\&9\225^\214\239\255\196 ",PropMaximumQoS 247]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0xa6, 0x1,  0x47, 0xdb, 0x6a, 0x8,  0x0,  0x1b, 0x29, 0xb8, 0x6f, 0xf0, 0xfb, 0xa9, 0x1,  0xad,
                   0xd4, 0x53, 0xc7, 0x7e, 0xe5, 0xa9, 0xbd, 0xa2, 0xfb, 0x5e, 0x33, 0xf1, 0xe9, 0x69, 0x5d, 0x9b, 0xe1,
                   0x46, 0x0,  0x1c, 0x0,  0x13, 0xfa, 0x6e, 0xd,  0x36, 0xdb, 0xf9, 0xfe, 0xcd, 0x93, 0x2a, 0x19, 0xc7,
                   0x32, 0xc5, 0xd5, 0x4e, 0xf8, 0xb,  0xc6, 0x1,  0x71, 0x28, 0xac, 0x11, 0x0,  0x0,  0x42, 0x98, 0x1,
                   0x7d, 0x17, 0xcc, 0xb,  0x10, 0x8,  0x0,  0x8,  0x7b, 0xd2, 0x3f, 0xb3, 0xe6, 0xd5, 0x48, 0x9e, 0x12,
                   0x0,  0x17, 0x50, 0x26, 0xf8, 0x12, 0x69, 0xf3, 0x2,  0x2d, 0xa2, 0xbd, 0xdf, 0xba, 0x86, 0x3a, 0x9a,
                   0x39, 0xe1, 0x5e, 0xd6, 0xef, 0xff, 0xc4, 0x20, 0x24, 0xf7, 0x0,  0xa,  0x76, 0x32, 0xd9, 0xc3, 0xab,
                   0x88, 0xfe, 0x80, 0x3a, 0x69, 0x1,  0x0,  0xe,  0xf9, 0x69, 0x39, 0xe4, 0xf,  0x49, 0x9c, 0xc0, 0x37,
                   0x2f, 0x2e, 0xbb, 0xcb, 0x25, 0x2,  0x0,  0x14, 0xf5, 0xcd, 0x9,  0x3b, 0xa4, 0x23, 0x70, 0x1b, 0x18,
                   0xa8, 0x2c, 0x86, 0x0,  0x7b, 0x1e, 0xa4, 0x18, 0x5e, 0xdf, 0x95, 0x0,  0x0,  0x1,  0x1a, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0x32, 0xd9, 0xc3, 0xab, 0x88, 0xfe, 0x80, 0x3a, 0x69};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf9, 0x69, 0x39, 0xe4, 0xf, 0x49, 0x9c, 0xc0, 0x37, 0x2f, 0x2e, 0xbb, 0xcb, 0x25};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf5, 0xcd, 0x9, 0x3b, 0xa4, 0x23, 0x70, 0x1b, 0x18, 0xa8,
                                     0x2c, 0x86, 0x0, 0x7b, 0x1e, 0xa4, 0x18, 0x5e, 0xdf, 0x95};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1a};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x29, 0xb8, 0x6f, 0xf0, 0xfb, 0xa9, 0x1,  0xad, 0xd4, 0x53, 0xc7, 0x7e, 0xe5, 0xa9,
                           0xbd, 0xa2, 0xfb, 0x5e, 0x33, 0xf1, 0xe9, 0x69, 0x5d, 0x9b, 0xe1, 0x46, 0x0};
  uint8_t bytesprops1[] = {0xfa, 0x6e, 0xd,  0x36, 0xdb, 0xf9, 0xfe, 0xcd, 0x93, 0x2a,
                           0x19, 0xc7, 0x32, 0xc5, 0xd5, 0x4e, 0xf8, 0xb,  0xc6};
  uint8_t bytesprops2[] = {0x7b, 0xd2, 0x3f, 0xb3, 0xe6, 0xd5, 0x48, 0x9e};
  uint8_t bytesprops3[] = {0x50, 0x26, 0xf8, 0x12, 0x69, 0xf3, 0x2,  0x2d, 0xa2, 0xbd, 0xdf, 0xba,
                           0x86, 0x3a, 0x9a, 0x39, 0xe1, 0x5e, 0xd6, 0xef, 0xff, 0xc4, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17048}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18395, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
